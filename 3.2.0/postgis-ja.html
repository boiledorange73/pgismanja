<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>PostGIS 3.2.0 マニュアル</title><link rel="stylesheet" type="text/css" href="docbook.css"><link rel="stylesheet" type="text/css" href="style.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><meta name="description" content="PostGISは、オブジェクトRDBであるPostgreSQLの拡張で、GIS (地理情報システム)オブジェクトを格納することができます。PostGISは、GiSTベースのR木空間インデクスをサポートし、GISオブジェクトの解析および処理を行う機能を持ちます。  本マニュアルは、3.2.0版のマニュアルです。 この作品はクリエイティブ・コモンズ 表示 - 継承 3.0 非移植 ライセンスの下に提供されています。好きなようにこの材料を使うことができますが、PostGIS Project のクレジット提示を求めます。また可能な限りhttp://postgis.netへのリンクを求めます。"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div lang="ja" class="book"><div class="titlepage"><div><div><h1 class="title"><a name="idp49543424"></a>PostGIS 3.2.0 マニュアル</h1></div><div><h3 class="corpauthor">PostGIS開発グループ</h3></div><div><div class="abstract"><div class="abstract-title">概要</div><p>PostGISは、オブジェクトRDBであるPostgreSQLの拡張で、GIS (地理情報システム)オブジェクトを格納することができます。PostGISは、GiSTベースのR木空間インデクスをサポートし、GISオブジェクトの解析および処理を行う機能を持ちます。</p><p><span class="inlinemediaobject"><img src="images/PostGIS_logo.png"></span>
            <span class="inlinemediaobject"><img src="images/osgeo_logo.png"></span>
      </p><p>本マニュアルは、3.2.0版のマニュアルです。</p><p><span class="inlinemediaobject"><img src="images/ccbysa.png"></span> この作品は<a class="ulink" href="http://creativecommons.org/licenses/by-sa/3.0/deed.ja" target="_top">クリエイティブ・コモンズ 表示 - 継承 3.0 非移植 ライセンス</a>の下に提供されています。好きなようにこの材料を使うことができますが、PostGIS Project のクレジット提示を求めます。また可能な限り<a class="ulink" href="http://postgis.net" target="_top">http://postgis.net</a>へのリンクを求めます。</p></div></div></div><hr></div><div class="toc"><div class="toc-title">目次</div><dl class="toc"><dt><span class="chapter"><a href="#postgis_introduction">1. 導入</a></span></dt><dd><dl><dt><span class="sect1"><a href="#psc">1.1. プロジェクト運営委員会</a></span></dt><dt><span class="sect1"><a href="#credits_core_present">1.2. 現在の中核貢献者</a></span></dt><dt><span class="sect1"><a href="#credits_core_past">1.3. 過去の中核貢献者</a></span></dt><dt><span class="sect1"><a href="#credits_other_contributors">1.4. 他の貢献者</a></span></dt></dl></dd><dt><span class="chapter"><a href="#postgis_installation">2. PostGISインストール</a></span></dt><dd><dl><dt><span class="sect1"><a href="#install_short_version">2.1. 簡略版</a></span></dt><dt><span class="sect1"><a href="#PGInstall">2.2. ソースからのコンパイルとインストール</a></span></dt><dd><dl><dt><span class="sect2"><a href="#install_getting_source">2.2.1. ソースの取得</a></span></dt><dt><span class="sect2"><a href="#install_requirements">2.2.2. インストール要件</a></span></dt><dt><span class="sect2"><a href="#installation_configuration">2.2.3. ビルドコンフィギュレーション</a></span></dt><dt><span class="sect2"><a href="#idp50007936">2.2.4. ビルド</a></span></dt><dt><span class="sect2"><a href="#make_install_postgis_extensions">2.2.5. PostGISエクステンションのビルドとデプロイ</a></span></dt><dt><span class="sect2"><a href="#idp50037120">2.2.6. テスト</a></span></dt><dt><span class="sect2"><a href="#idp50048640">2.2.7. インストール</a></span></dt></dl></dd><dt><span class="sect1"><a href="#installing_pagc_address_standardizer">2.3. PAGC住所標準化ツールのインストールと使用</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp50078592">2.3.1. Regex::Assembleのインストール</a></span></dt></dl></dd><dt><span class="sect1"><a href="#loading_extras_tiger_geocoder">2.4. Tigerジオコーダのインストールとアップグレードとデータロード</a></span></dt><dd><dl><dt><span class="sect2"><a href="#install_tiger_geocoder_extension">2.4.1. TigerジオコーダをPostGISデータベースで有効にする: エクステンションを使用</a></span></dt><dt><span class="sect2"><a href="#install_tiger_geocoder">2.4.2. TigerジオコーダをPostGISデータベースで有効にする: エクステンション不使用</a></span></dt><dt><span class="sect2"><a href="#tiger_pagc_address_standardizing">2.4.3. TigerジオコーダをPostGISデータベースで有効にする: エクステンションを使用</a></span></dt><dt><span class="sect2"><a href="#tiger_geocoder_loading_data">2.4.4. Tigerデータのロード</a></span></dt><dt><span class="sect2"><a href="#upgrade_tiger_geocoder">2.4.5. Tigerジオコーダのアップグレード</a></span></dt></dl></dd><dt><span class="sect1"><a href="#idp50198528">2.5. 共通の問題</a></span></dt></dl></dd><dt><span class="chapter"><a href="#postgis_administration">3. PostGIS管理</a></span></dt><dd><dl><dt><span class="sect1"><a href="#database_tuning_configuration">3.1. パフォーマンスチューニング</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp50591104">3.1.1. 起動時</a></span></dt><dt><span class="sect2"><a href="#idp50600960">3.1.2. 実行時</a></span></dt></dl></dd><dt><span class="sect1"><a href="#raster_configuration">3.2. ラスタ機能の設定</a></span></dt><dt><span class="sect1"><a href="#create_spatial_db">3.3. 空間テーブルの作成</a></span></dt><dd><dl><dt><span class="sect2"><a href="#create_new_db_extensions">3.3.1. エクステンションを使って空間データベースを有効にする</a></span></dt><dt><span class="sect2"><a href="#create_new_db">3.3.2. エクステンションを使わずに空間データベースを有効にする (非推奨)</a></span></dt><dt><span class="sect2"><a href="#templatepostgis">3.3.3. 空間データベースをテンプレートから生成する</a></span></dt></dl></dd><dt><span class="sect1"><a href="#upgrading">3.4. 空間データベースのアップグレード</a></span></dt><dd><dl><dt><span class="sect2"><a href="#soft_upgrade">3.4.1. ソフトアップグレード </a></span></dt><dt><span class="sect2"><a href="#hard_upgrade">3.4.2. ハードアップグレード</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#using_postgis_dbmanagement">4. データ管理</a></span></dt><dd><dl><dt><span class="sect1"><a href="#RefObject">4.1. 空間データ モデル</a></span></dt><dd><dl><dt><span class="sect2"><a href="#OGC_Geometry">4.1.1. OGC ジオメトリ</a></span></dt><dt><span class="sect2"><a href="#SQL_MM_Part3">4.1.2. SQL/MM Part 3 - 曲線</a></span></dt><dt><span class="sect2"><a href="#OpenGISWKBWKT">4.1.3. WKTとWKB</a></span></dt></dl></dd><dt><span class="sect1"><a href="#PostGIS_Geometry">4.2. ジオメトリデータタイプ</a></span></dt><dd><dl><dt><span class="sect2"><a href="#EWKB_EWKT">4.2.1. PostGIS EWKBとEWKT</a></span></dt></dl></dd><dt><span class="sect1"><a href="#PostGIS_Geography">4.3. ジオグラフィデータタイプ</a></span></dt><dd><dl><dt><span class="sect2"><a href="#Create_Geography_Tables">4.3.1. ジオグラフィテーブルの生成</a></span></dt><dt><span class="sect2"><a href="#Use_Geography_Tables">4.3.2. ジオグラフィテーブルの使用</a></span></dt><dt><span class="sect2"><a href="#PostGIS_GeographyVSGeometry">4.3.3. ジオグラフィ型を使用すべき時</a></span></dt><dt><span class="sect2"><a href="#PostGIS_Geography_AdvancedFAQ">4.3.4. ジオグラフィに関する高度なよくある質問</a></span></dt></dl></dd><dt><span class="sect1"><a href="#idp51104128">4.4. 空間テーブル</a></span></dt><dd><dl><dt><span class="sect2"><a href="#Create_Spatial_Table">4.4.1. 空間テーブルを作る</a></span></dt><dt><span class="sect2"><a href="#geometry_columns">4.4.2. GEOMETRY_COLUMNSビュー</a></span></dt><dt><span class="sect2"><a href="#Manual_Register_Spatial_Column">4.4.3. 手動でジオメトリカラムをgeometry_columnsに登録する</a></span></dt></dl></dd><dt><span class="sect1"><a href="#spatial_ref_sys">4.5. 空間参照系</a></span></dt><dd><dl><dt><span class="sect2"><a href="#spatial_ref_sys_table">4.5.1. SPATIAL_REF_SYSテーブル</a></span></dt><dt><span class="sect2"><a href="#user-spatial-ref-sys">4.5.2. ユーザ定義空間参照系</a></span></dt></dl></dd><dt><span class="sect1"><a href="#OGC_Validity">4.6. ジオメトリ検証</a></span></dt><dt><span class="sect1"><a href="#loading-data">4.7. 空間データのロード</a></span></dt><dd><dl><dt><span class="sect2"><a href="#load-data-sql">4.7.1. SQLを使ってロードする</a></span></dt><dt><span class="sect2"><a href="#shp2pgsql_usage">4.7.2. シェープファイルローダを使う</a></span></dt></dl></dd><dt><span class="sect1"><a href="#extracting-data">4.8. 空間データの抽出</a></span></dt><dd><dl><dt><span class="sect2"><a href="#extract-data-sql">4.8.1. SQLを使ってデータを抽出する</a></span></dt><dt><span class="sect2"><a href="#pgsql2shp-usage">4.8.2. ダンパを使う</a></span></dt></dl></dd><dt><span class="sect1"><a href="#build-indexes">4.9. 空間インデックス</a></span></dt><dd><dl><dt><span class="sect2"><a href="#gist_indexes">4.9.1. GiSTインデックス</a></span></dt><dt><span class="sect2"><a href="#brin_indexes">4.9.2. BRINインデックス</a></span></dt><dt><span class="sect2"><a href="#spgist_indexes">4.9.3. SP-GiSTインデックス</a></span></dt><dt><span class="sect2"><a href="#tuning-index-usage">4.9.4. インデックス使用のチューニング</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#using_postgis_query">5. 空間クエリ</a></span></dt><dd><dl><dt><span class="sect1"><a href="#eval_spatial_rel">5.1. 空間関係の決定</a></span></dt><dd><dl><dt><span class="sect2"><a href="#DE-9IM">5.1.1. Dimensionally Extended 9-Intersection Model</a></span></dt><dt><span class="sect2"><a href="#named-spatial-rel">5.1.2. 名前付き空間関係</a></span></dt><dt><span class="sect2"><a href="#general-spatial-rel">5.1.3. 一般的な空間関係</a></span></dt></dl></dd><dt><span class="sect1"><a href="#using-query-indexes">5.2. 空間インデックスを使う</a></span></dt><dt><span class="sect1"><a href="#examples_spatial_sql">5.3. 空間SQLの例</a></span></dt></dl></dd><dt><span class="chapter"><a href="#performance_tips">6. 性能向上に関する技法</a></span></dt><dd><dl><dt><span class="sect1"><a href="#small_tables_large_objects">6.1. 大きなジオメトリを持つ小さなテーブル</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp52572416">6.1.1. 問題の説明</a></span></dt><dt><span class="sect2"><a href="#idp51466624">6.1.2. 応急処置</a></span></dt></dl></dd><dt><span class="sect1"><a href="#database_clustering">6.2. ジオメトリインデクスでCLUSTERを実行する</a></span></dt><dt><span class="sect1"><a href="#avoiding_dimension_conversion">6.3. 次元変換の回避</a></span></dt></dl></dd><dt><span class="chapter"><a href="#idp52623104">7. アプリケーションのビルド</a></span></dt><dd><dl><dt><span class="sect1"><a href="#Using_MapServer">7.1. MapServerを使う</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp52627968">7.1.1. 基本的な使い方</a></span></dt><dt><span class="sect2"><a href="#idp52659968">7.1.2. よくある質問</a></span></dt><dt><span class="sect2"><a href="#idp52679936">7.1.3. 踏み込んだ使用法</a></span></dt><dt><span class="sect2"><a href="#idp52688384">7.1.4. 例</a></span></dt></dl></dd><dt><span class="sect1"><a href="#idp52694912">7.2. Javaクライアント (JDBC)</a></span></dt><dt><span class="sect1"><a href="#idp52738816">7.3. Cクライアント (libpq)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp52739840">7.3.1. テキストカーソル</a></span></dt><dt><span class="sect2"><a href="#idp52740992">7.3.2. バイナリカーソル</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#reference">8. PostGISリファレンス</a></span></dt><dd><dl><dt><span class="sect1"><a href="#PostGIS_Types">8.1. PostGIS Geometry/Geography/Box データ型</a></span></dt><dt><span class="sect1"><a href="#PostGIS_GUC">8.2. Grand Unified Custom変数 (GUC)</a></span></dt><dt><span class="sect1"><a href="#Management_Functions">8.3. テーブル管理関数</a></span></dt><dt><span class="sect1"><a href="#Geometry_Constructors">8.4. ジオメトリ コンストラクタ</a></span></dt><dt><span class="sect1"><a href="#Geometry_Accessors">8.5. ジオメトリアクセサ</a></span></dt><dt><span class="sect1"><a href="#Geometry_Editors">8.6. ジオメトリエディタ</a></span></dt><dt><span class="sect1"><a href="#Geometry_Outputs">8.7. ジオメトリ出力</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp57208576">8.7.1. Well-Known Text (WKT)</a></span></dt><dt><span class="sect2"><a href="#idp57301632">8.7.2. Well-Known Binary (WKB)</a></span></dt><dt><span class="sect2"><a href="#idp57392256">8.7.3. その他の書式</a></span></dt></dl></dd><dt><span class="sect1"><a href="#Operators">8.8. 演算子</a></span></dt><dd><dl><dt><span class="sect2"><a href="#operators-bbox">8.8.1. バウンディングボックス演算子</a></span></dt><dt><span class="sect2"><a href="#operators-distance">8.8.2. 距離演算子</a></span></dt></dl></dd><dt><span class="sect1"><a href="#Measurement_Functions">8.9. 計測関数</a></span></dt><dt><span class="sect1"><a href="#reference_sfcgal">8.10. SFCGAL関数</a></span></dt><dt><span class="sect1"><a href="#Geometry_Processing">8.11. ジオメトリ処理関数</a></span></dt><dt><span class="sect1"><a href="#Linear_Referencing">8.12. 線型参照</a></span></dt><dt><span class="sect1"><a href="#Long_Transactions_Support">8.13. ロングトランザクション機能</a></span></dt></dl></dd><dt><span class="chapter"><a href="#PostGIS_FAQ">9. PostGIS よくある質問</a></span></dt><dt><span class="chapter"><a href="#Topology">10. トポロジ</a></span></dt><dd><dl><dt><span class="sect1"><a href="#Topology_Types">10.1. トポロジ型</a></span></dt><dt><span class="sect1"><a href="#Topology_Domains">10.2. トポロジドメイン</a></span></dt><dt><span class="sect1"><a href="#Topology_ManagementFunctions">10.3. トポロジ管理とTopoGeometry管理</a></span></dt><dt><span class="sect1"><a href="#Topology_StatsManagement">10.4. トポロジ統計管理</a></span></dt><dt><span class="sect1"><a href="#Topology_Constructors">10.5. トポロジコンストラクタ</a></span></dt><dt><span class="sect1"><a href="#Topology_Editing">10.6. トポロジエディタ</a></span></dt><dt><span class="sect1"><a href="#Topology_Accessors">10.7. トポロジアクセサ</a></span></dt><dt><span class="sect1"><a href="#Topology_Processing">10.8. トポロジ処理</a></span></dt><dt><span class="sect1"><a href="#TopoGeometry_Constructors">10.9. TopoGeometryコンストラクタ</a></span></dt><dt><span class="sect1"><a href="#TopoGeometry_Editors">10.10. TopoGeometryエディタ</a></span></dt><dt><span class="sect1"><a href="#TopoGeom_Accessors">10.11. TopoGeometryアクセサ</a></span></dt><dt><span class="sect1"><a href="#TopoGeometry_Outputs">10.12. TopoGeometry出力</a></span></dt><dt><span class="sect1"><a href="#Topology_Relationships">10.13. トポロジ空間関係関数</a></span></dt></dl></dd><dt><span class="chapter"><a href="#using_raster_dataman">11. ラスタデータの管理、クエリ、アプリケーション</a></span></dt><dd><dl><dt><span class="sect1"><a href="#RT_Loading_Rasters">11.1. ラスタのロードと生成</a></span></dt><dd><dl><dt><span class="sect2"><a href="#RT_Raster_Loader">11.1.1. raster2pgsqlを使ってラスタをロードする</a></span></dt><dt><span class="sect2"><a href="#RT_Creating_Rasters">11.1.2. PostGISラスタ関数を用いたラスタの生成</a></span></dt><dt><span class="sect2"><a href="#RT_Cloud_Rasters">11.1.3. 「データベース外」クラウドラスタの使用</a></span></dt></dl></dd><dt><span class="sect1"><a href="#RT_Raster_Catalog">11.2. ラスタカタログ</a></span></dt><dd><dl><dt><span class="sect2"><a href="#RT_Raster_Columns">11.2.1. ラスタカラムカタログ</a></span></dt><dt><span class="sect2"><a href="#RT_Raster_Overviews">11.2.2. ラスタオーバビュー</a></span></dt></dl></dd><dt><span class="sect1"><a href="#RT_Raster_Applications">11.3. PostGISラスタを使ったカスタムアプリケーションの構築</a></span></dt><dd><dl><dt><span class="sect2"><a href="#RT_PHP_Output">11.3.1. ST_AsPNG を他の関数とあわせて使った PHP 出力例</a></span></dt><dt><span class="sect2"><a href="#RT_Net_Output_CS">11.3.2. ST_AsPNGを他の関数とあわせて使ったASP.NET C#出力例</a></span></dt><dt><span class="sect2"><a href="#RT_Java_Console_App">11.3.3. rasterクエリを画像ファイルで出力するJavaコンソールアプリケーション</a></span></dt><dt><span class="sect2"><a href="#RT_PLPython">11.3.4. PLPython を使って SQL を介して画像をダンプする</a></span></dt><dt><span class="sect2"><a href="#RasterOutput_PSQL">11.3.5. PSQLでラスタを出力する</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#RT_reference">12. ラスタ リファレンス</a></span></dt><dd><dl><dt><span class="sect1"><a href="#Raster_Types">12.1. ラスタサポートデータ型</a></span></dt><dt><span class="sect1"><a href="#Raster_Management_Functions">12.2. ラスタ管理</a></span></dt><dt><span class="sect1"><a href="#Raster_Constructors">12.3. ラスタコンストラクタ</a></span></dt><dt><span class="sect1"><a href="#Raster_Accessors">12.4. ラスタアクセサ</a></span></dt><dt><span class="sect1"><a href="#RasterBand_Accessors">12.5. ラスタバンドアクセサ</a></span></dt><dt><span class="sect1"><a href="#Raster_Pixel_Accessors">12.6. ラスタピクセルアクセサとセッター</a></span></dt><dt><span class="sect1"><a href="#Raster_Editors">12.7. ラスタエディタ</a></span></dt><dt><span class="sect1"><a href="#RasterBand_Editors">12.8. ラスタバンドエディタ</a></span></dt><dt><span class="sect1"><a href="#RasterBand_Stats">12.9. ラスタバンド統計情報と解析</a></span></dt><dt><span class="sect1"><a href="#Raster_Inputs">12.10. ラスタ入力</a></span></dt><dt><span class="sect1"><a href="#Raster_Outputs">12.11. 出力</a></span></dt><dt><span class="sect1"><a href="#Raster_Processing_MapAlgebra">12.12. ラスタ処理: 地図代数</a></span></dt><dt><span class="sect1"><a href="#Raster_Processing_MapAlgebra_Callbacks">12.13. 組み込み地図代数コールバック関数</a></span></dt><dt><span class="sect1"><a href="#Raster_Processing_DEM">12.14. ラスタ処理: DEM (標高)</a></span></dt><dt><span class="sect1"><a href="#Raster_Processing_Geometry">12.15. ラスタ処理: ラスタからジオメトリ</a></span></dt><dt><span class="sect1"><a href="#RT_Operators">12.16. ラスタ演算子</a></span></dt><dt><span class="sect1"><a href="#Raster_Relationships">12.17. ラスタとラスタバンドの空間関係関数</a></span></dt><dt><span class="sect1"><a href="#Raster_Tips">12.18. ラスタに関する技法</a></span></dt><dd><dl><dt><span class="sect2"><a href="#outdb">12.18.1. データベース外ラスタ</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#RT_FAQ">13. PostGISラスタ よくある質問</a></span></dt><dt><span class="chapter"><a href="#Extras">14. PostGIS追加機能</a></span></dt><dd><dl><dt><span class="sect1"><a href="#Address_Standardizer">14.1. 住所標準化</a></span></dt><dd><dl><dt><span class="sect2"><a href="#Address_Standardizer_Basics">14.1.1. パーサの動作</a></span></dt><dt><span class="sect2"><a href="#Address_Standardizer_Types">14.1.2. 住所標準化の型</a></span></dt><dt><span class="sect2"><a href="#Address_Standardizer_Tables">14.1.3. 住所標準化テーブル</a></span></dt><dt><span class="sect2"><a href="#Address_Standardizer_Functions">14.1.4. 住所標準化関数</a></span></dt></dl></dd><dt><span class="sect1"><a href="#Tiger_Geocoder">14.2. Tigerジオコーダ</a></span></dt></dl></dd><dt><span class="chapter"><a href="#PostGIS_Special_Functions_Index">15. PostGIS関数索引</a></span></dt><dd><dl><dt><span class="sect1"><a href="#PostGIS_Aggregate_Functions">15.1. PostGIS集約関数</a></span></dt><dt><span class="sect1"><a href="#PostGIS_Window_Functions">15.2. PostGISウィンドウ関数</a></span></dt><dt><span class="sect1"><a href="#PostGIS_SQLMM_Functions">15.3. PostGIS SQL-MM準拠関数</a></span></dt><dt><span class="sect1"><a href="#PostGIS_GeographyFunctions">15.4. PostGISジオグラフィ対応関数</a></span></dt><dt><span class="sect1"><a href="#PostGIS_RasterFunctions">15.5. PostGISラスタ機能関数</a></span></dt><dt><span class="sect1"><a href="#PostGIS_Geometry_DumpFunctions">15.6. PostGISジオメトリ/ジオグラフィ/ラスタのダンプ関数</a></span></dt><dt><span class="sect1"><a href="#PostGIS_BoxFunctions">15.7. PostGISボックス関数</a></span></dt><dt><span class="sect1"><a href="#PostGIS_3D_Functions">15.8. 3次元対応PostGIS関数</a></span></dt><dt><span class="sect1"><a href="#PostGIS_Curved_GeometryFunctions">15.9. PostGIS曲線ジオメトリ対応関数</a></span></dt><dt><span class="sect1"><a href="#PostGIS_PS_GeometryFunctions">15.10. PostGIS多面体サーフェス対応関数</a></span></dt><dt><span class="sect1"><a href="#PostGIS_TypeFunctionMatrix">15.11. PostGIS関数対応マトリクス</a></span></dt><dt><span class="sect1"><a href="#NewFunctions">15.12. 新規作成/機能強化/変更されたPostGIS関数</a></span></dt><dd><dl><dt><span class="sect2"><a href="#NewFunctions_3_2">15.12.1. PostGIS 3.2で新規作成/機能強化された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_3_1">15.12.2. PostGIS 3.1で新規作成/機能強化された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_3_0">15.12.3. PostGIS 3.0で新規作成/機能強化された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_2_5">15.12.4. PostGIS 2.5で新規作成/機能強化された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_2_4">15.12.5. PostGIS 2.4で新規作成/機能強化された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_2_3">15.12.6. PostGIS 2.3で新規作成/機能強化された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_2_2">15.12.7. PostGIS 2.2で新規作成/機能強化された関数</a></span></dt><dt><span class="sect2"><a href="#ChangedFunctions_2_2">15.12.8. PostGIS 2.2で大幅に変更された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_2_1">15.12.9. PostGIS 2.1で新規作成/機能強化された関数</a></span></dt><dt><span class="sect2"><a href="#ChangedFunctions_2_1">15.12.10. PostGIS 2.1で大幅に変更された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_2_0">15.12.11. PostGIS 2.0で新規作成/機能強化/変更された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_2_0_Changed">15.12.12. PostGIS 2.0で変更された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_1_5">15.12.13. PostGIS 1.5で新規作成/機能強化/変更された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_1_4">15.12.14. PostGIS 1.4で新規作成/機能強化/変更された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_1_3">15.12.15. PostGIS 1.3で新規作成された関数</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#idp88933504">16. 問題を報告する</a></span></dt><dd><dl><dt><span class="sect1"><a href="#idp88934144">16.1. ソフトウェアのバグを報告する</a></span></dt><dt><span class="sect1"><a href="#idp88971392">16.2. 文書の問題を報告する</a></span></dt></dl></dd><dt><span class="appendix"><a href="#release_notes">A. 付録</a></span></dt><dd><dl><dt><span class="sect1"><a href="#idp88998016">A.1. PostGIS 3.2.0 (Olivier Courtin版)</a></span></dt><dt><span class="sect1"><a href="#idp89075328">A.2. PostGIS 3.2.0beta2</a></span></dt><dt><span class="sect1"><a href="#idp89082112">A.3. リリース 3.2.0beta2</a></span></dt><dt><span class="sect1"><a href="#idp89087872">A.4. リリース 3.2.0beta1</a></span></dt><dt><span class="sect1"><a href="#idp89093632">A.5. リリース 3.2.0alpha1</a></span></dt><dt><span class="sect1"><a href="#idp89120768">A.6. リリース 3.1.0beta1</a></span></dt><dt><span class="sect1"><a href="#idp89126144">A.7. リリース 3.1.0alpha3</a></span></dt><dt><span class="sect1"><a href="#idp89144448">A.8. リリース 3.1.0alpha2</a></span></dt><dt><span class="sect1"><a href="#idp89155968">A.9. リリース 3.1.0alpha1</a></span></dt><dt><span class="sect1"><a href="#idp89167744">A.10. リリース 3.0.0</a></span></dt><dt><span class="sect1"><a href="#idp89198720">A.11. リリース 3.0.0rc2</a></span></dt><dt><span class="sect1"><a href="#idp89202944">A.12. リリース 3.0.0rc1</a></span></dt><dt><span class="sect1"><a href="#idp89206784">A.13. リリース 3.0.0beta1</a></span></dt><dt><span class="sect1"><a href="#idp89230976">A.14. リリース 3.0.0alpha4</a></span></dt><dt><span class="sect1"><a href="#idp89240448">A.15. リリース 3.0.0alpha3</a></span></dt><dt><span class="sect1"><a href="#idp89248640">A.16. リリース 3.0.0alpha2</a></span></dt><dt><span class="sect1"><a href="#idp89252480">A.17. リリース 3.0.0alpha1</a></span></dt><dt><span class="sect1"><a href="#idp89276416">A.18. リリース 2.5.0</a></span></dt><dt><span class="sect1"><a href="#idp89298176">A.19. リリース 2.4.5</a></span></dt><dt><span class="sect1"><a href="#idp89309440">A.20. リリース 2.4.4</a></span></dt><dt><span class="sect1"><a href="#idp89318016">A.21. リリース 2.4.3</a></span></dt><dt><span class="sect1"><a href="#idp89323008">A.22. リリース 2.4.2</a></span></dt><dt><span class="sect1"><a href="#idp89330688">A.23. リリース 2.4.1</a></span></dt><dt><span class="sect1"><a href="#idp89338880">A.24. リリース 2.4.0</a></span></dt><dt><span class="sect1"><a href="#idp89356544">A.25. リリース 2.3.3</a></span></dt><dt><span class="sect1"><a href="#idp89411968">A.26. リリース 2.3.2</a></span></dt><dt><span class="sect1"><a href="#idp89416192">A.27. リリース 2.3.1</a></span></dt><dt><span class="sect1"><a href="#idp89422592">A.28. リリース 2.3.0</a></span></dt><dt><span class="sect1"><a href="#idp89441280">A.29. リリース 2.2.2</a></span></dt><dt><span class="sect1"><a href="#idp89460480">A.30. リリース 2.2.1</a></span></dt><dt><span class="sect1"><a href="#idp89471616">A.31. リリース 2.2.0</a></span></dt><dt><span class="sect1"><a href="#idp89550080">A.32. リリース 2.1.8</a></span></dt><dt><span class="sect1"><a href="#idp89555456">A.33. リリース 2.1.7</a></span></dt><dt><span class="sect1"><a href="#idp89571200">A.34. リリース 2.1.6</a></span></dt><dt><span class="sect1"><a href="#idp89579776">A.35. リリース 2.1.5</a></span></dt><dt><span class="sect1"><a href="#idp89590016">A.36. リリース 2.1.4</a></span></dt><dt><span class="sect1"><a href="#idp89634304">A.37. リリース 2.1.3</a></span></dt><dt><span class="sect1"><a href="#idp89641216">A.38. リリース 2.1.2</a></span></dt><dt><span class="sect1"><a href="#idp89682432">A.39. リリース 2.1.1</a></span></dt><dt><span class="sect1"><a href="#idp89696640">A.40. リリース 2.1.0</a></span></dt><dt><span class="sect1"><a href="#idp89836032">A.41. リリース 2.0.5</a></span></dt><dt><span class="sect1"><a href="#idp89850496">A.42. リリース 2.0.4</a></span></dt><dt><span class="sect1"><a href="#idp89895936">A.43. リリース 2.0.3</a></span></dt><dt><span class="sect1"><a href="#idp89912448">A.44. リリース 2.0.2</a></span></dt><dt><span class="sect1"><a href="#idp89975808">A.45. リリース 2.0.1</a></span></dt><dt><span class="sect1"><a href="#idp90023808">A.46. リリース 2.0.0</a></span></dt><dt><span class="sect1"><a href="#idp90087680">A.47. リリース 1.5.4</a></span></dt><dt><span class="sect1"><a href="#idp90110976">A.48. リリース 1.5.3</a></span></dt><dt><span class="sect1"><a href="#idp90127232">A.49. リリース 1.5.2</a></span></dt><dt><span class="sect1"><a href="#idp90143872">A.50. リリース 1.5.1</a></span></dt><dt><span class="sect1"><a href="#idp90153344">A.51. リリース 1.5.0</a></span></dt><dt><span class="sect1"><a href="#idp90175232">A.52. リリース 1.4.0</a></span></dt><dt><span class="sect1"><a href="#idp90195584">A.53. リリース 1.3.6</a></span></dt><dt><span class="sect1"><a href="#idp90213504">A.54. リリース 1.3.5</a></span></dt><dt><span class="sect1"><a href="#idp90215040">A.55. リリース 1.3.4</a></span></dt><dt><span class="sect1"><a href="#idp90216960">A.56. リリース 1.3.3</a></span></dt><dt><span class="sect1"><a href="#idp90218496">A.57. リリース 1.3.2</a></span></dt><dt><span class="sect1"><a href="#idp90220032">A.58. リリース 1.3.1</a></span></dt><dt><span class="sect1"><a href="#idp90221568">A.59. リリース 1.3.0</a></span></dt><dt><span class="sect1"><a href="#idp90229120">A.60. リリース 1.2.1</a></span></dt><dt><span class="sect1"><a href="#idp89037440">A.61. リリース 1.2.0</a></span></dt><dt><span class="sect1"><a href="#idp90232576">A.62. リリース 1.1.6</a></span></dt><dt><span class="sect1"><a href="#idp90242944">A.63. リリース 1.1.5</a></span></dt><dt><span class="sect1"><a href="#idp90253056">A.64. リリース 1.1.4</a></span></dt><dt><span class="sect1"><a href="#idp90268032">A.65. リリース 1.1.3</a></span></dt><dt><span class="sect1"><a href="#idp90283520">A.66. リリース 1.1.2</a></span></dt><dt><span class="sect1"><a href="#idp90300032">A.67. リリース 1.1.1</a></span></dt><dt><span class="sect1"><a href="#idp90311936">A.68. リリース 1.1.0</a></span></dt><dt><span class="sect1"><a href="#idp90353792">A.69. リリース 1.0.6</a></span></dt><dt><span class="sect1"><a href="#idp90364160">A.70. リリース 1.0.5</a></span></dt><dt><span class="sect1"><a href="#idp90376576">A.71. リリース 1.0.4</a></span></dt><dt><span class="sect1"><a href="#rel_1.0.3_upgrading">A.72. リリース 1.0.3</a></span></dt><dt><span class="sect1"><a href="#idp90419072">A.73. リリース 1.0.2</a></span></dt><dt><span class="sect1"><a href="#idp90426880">A.74. リリース 1.0.1</a></span></dt><dt><span class="sect1"><a href="#idp90440704">A.75. リリース 1.0.0</a></span></dt><dt><span class="sect1"><a href="#idp90450048">A.76. リリース 1.0.0RC6</a></span></dt><dt><span class="sect1"><a href="#idp90457600">A.77. リリース 1.0.0RC5</a></span></dt><dt><span class="sect1"><a href="#idp90464640">A.78. リリース 1.0.0RC4</a></span></dt><dt><span class="sect1"><a href="#idp90477056">A.79. リリース 1.0.0RC3</a></span></dt><dt><span class="sect1"><a href="#idp90489600">A.80. リリース 1.0.0RC2</a></span></dt><dt><span class="sect1"><a href="#idp89258496">A.81. リリース 1.0.0RC1</a></span></dt></dl></dd></dl></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="postgis_introduction"></a>第1章 導入</h1></div></div></div><div class="toc"><div class="toc-title">目次</div><dl class="toc"><dt><span class="sect1"><a href="#psc">1.1. プロジェクト運営委員会</a></span></dt><dt><span class="sect1"><a href="#credits_core_present">1.2. 現在の中核貢献者</a></span></dt><dt><span class="sect1"><a href="#credits_core_past">1.3. 過去の中核貢献者</a></span></dt><dt><span class="sect1"><a href="#credits_other_contributors">1.4. 他の貢献者</a></span></dt></dl></div><p>PostGISは、PostgreSQLリレーショナルデータベースの空間拡張です。Refractions Research Incが、空間データベース技術の研究プロジェクトとして作成しました。Refractionsはカナダ・ブリティッシュコロンビア州・ビクトリアにある、データインテグレーションとカスタムソフトウェア開発に特化した、GISとデータベースのコンサルティング会社です。</p><p>PostGISは、現在ではOSGeo財団のプロジェクトです。多数のFOSS4G開発者とPostGISの機能と多彩さから大きな利益を得る世界中の企業が、PostGISの開発と資金提供を行っています。</p><p>PostGISプロジェクトの開発グループは、PostGISが、OpenGISとSQL/MM空間標準の領域における重要なGIS機能、高度なトポロジ構築 (カバレッジ、サーフェス、ネットワーク)、GISデータの表示と編集を行うデスクトップユーザインタフェースツール、およびウェブベースのアクセスツールのためのデータソースに、より良く対応するよう、サポートと機能強化を行う予定です。</p><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="psc"></a>1.1. プロジェクト運営委員会</h2></div></div></div><p>PostGISプロジェクト運営委員会 (PostGIS Project Steering Committee, PSC)は、総合的な指示、リリースサイクル、ドキュメンテーション、支援活動に関する調整を行っています。また、委員会は、全体的なユーザサポート、PostGISコミュニティからのパッチの受け付けと適用、 開発者のコミットのアクセス、新しい委員、APIの重要な変更といった、PostGISを含む雑多な問題に関する投票を行っています。 </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Raúl Marín Rodríguez</span></dt><dd><p>MVT機能、誤り修正、パフォーマンスと安定性の向上、GitHubキュレーション、PostGISとPostgreSQLのリリースの調整</p></dd><dt><span class="term">Regina Obe</span></dt><dd><p>Buildbotのメンテナンス、Windows版と試験版のビルド、ドキュメンテーション、PostgreSQLとの調整、X3D対応、Tiger Geocoder機能、関数管理。</p></dd><dt><span class="term">Bborie Park</span></dt><dd><p>ラスタ開発、GDALとの統合、ラスタローダ、ユーザサポート、一般的なバグフィクス、様々なOS (Slackware, Mac, Windows他)での試験。</p></dd><dt><span class="term">Darafei Praliaskouski</span></dt><dd><p>インデックス改善、誤り修正とジオメトリ/ジオグラフィ関数の改善、SFCGAL、ラスタ、GitHubキュレーション、Travis Botのメンテナンス。</p></dd><dt><span class="term">Paul Ramsey (委員長)</span></dt><dd><p>PostGISプロジェクトの副創始者。総合的なバグフィクス、ジオグラフィ機能、ジオグラフィとジオメトリのインデックス機能 (2次元,、3次元、n次元インデクスとあらゆる空間インデクス)、ジオメトリ内部構造、GEOS機能の統合とGEOSリリースとの調整、PostgreSQLのリリースとの調整、ローダ/ダンパ、シェープファイルGUIローダ。</p></dd><dt><span class="term">Sandro Santilli</span></dt><dd><p>誤り修正とメンテナンス、ビルドボットのメンテナンス、gitミラーの管理、関数管理、GEOSの新機能の統合、GEOSリリースとの調整、トポロジ機能、ラスタフレームワークと低水準API関数。</p></dd></dl></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="credits_core_present"></a>1.2. 現在の中核貢献者</h2></div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Jorge Arévalo</span></dt><dd><p>ラスタ開発、GDALドライバ機能、ローダ。</p></dd><dt><span class="term">Nicklas Avén</span></dt><dd><p>距離関数の強化 (3次元距離、関係関数を含む)と追加、Tiny WKB出力書式（TWKB）と一般的なユーザサポート。</p></dd><dt><span class="term">Dan Baston</span></dt><dd><p>ジオメトリクラスタリング関数の追加、他のジオメトリアルゴリズムの強化、GEOSの強化、および全体のユーザ対応</p></dd><dt><span class="term">Olivier Courtin</span></dt><dd><p>XML (KML, GML)/GeoJSON入出力関数と3次元対応と誤り修正。</p></dd><dt><span class="term">Martin Davis</span></dt><dd><p>GEOS機能強化と文書</p></dd><dt><span class="term">Björn Harrtell</span></dt><dd><p>MapBox Vector Tile関数とGeoBuf関数、Gogsの試験とGitLabの実験。</p></dd><dt><span class="term">Mateusz Loskot</span></dt><dd><p>CMakeのPostGISへの対応、Python版のオリジナルのラスタローダと低級ラスタAPI関数の構築。</p></dd><dt><span class="term">Pierre Racine</span></dt><dd><p>ラスタ全体のアーキテクチャ、プロトタイピング、プログラミング支援。</p></dd></dl></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="credits_core_past"></a>1.3. 過去の中核貢献者</h2></div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Mark Cave-Ayland</span></dt><dd><p>以前のPSCメンバ。誤り修正とメンテナンスの活動、空間インデックス選択性とバインディング、ローダ/ダンパ、およびシェープファイルGUIローダの調整、新機能の統合と強化。</p></dd><dt><span class="term">Chris Hodgson</span></dt><dd><p>以前のPSCメンバ。一般的な開発、サイトとBuildbotのメンテナンス、OSGeoインキュベーション管理。</p></dd><dt><span class="term">Kevin Neufeld</span></dt><dd><p>以前のPSCメンバ。文書と文書補助ツール、Buildbotのメンテナンス、PostGISニュースグループでの高度なユーザサポート、PostGISメンテナンス機能の強化。</p></dd><dt><span class="term">Dave Blasby</span></dt><dd><p>PostGISのオリジナルの開発/副創始者。サーバサイドのオブジェクト、インデクスのバインディングや多数のサーバサイドの解析機能を記述。</p></dd><dt><span class="term">Jeff Lounsbury</span></dt><dd><p>シェープファイルのローダ/ダンパのオリジナル開発者</p></dd><dt><span class="term">Mark Leslie</span></dt><dd><p>中核機能の、継続的なメンテナンスと開発。曲線機能の強化。シェープファイルGUIローダ。</p></dd><dt><span class="term">David Zwarg</span></dt><dd><p>ラスタ開発 (ほとんど地図代数解析関数)。</p></dd></dl></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="credits_other_contributors"></a>1.4. 他の貢献者</h2></div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">個人</span></dt><dd><p>
				</p><table border="0" summary="Simple list" class="simplelist"><tr><td>Alex Bodnaru</td><td>Gerald Fenoy</td><td>Maxime Guillaud</td></tr><tr><td>Alex Mayrhofer</td><td>Gino Lucrezi</td><td>Maxime van Noppen</td></tr><tr><td>Andrea Peri</td><td>Greg Troxel</td><td>Michael Fuhr</td></tr><tr><td>Andreas Forø Tollefsen</td><td>Guillaume Lelarge</td><td>Mike Toews</td></tr><tr><td>Andreas Neumann</td><td>Haribabu Kommi</td><td>Nathan Wagner</td></tr><tr><td>Anne Ghisla</td><td>Havard Tveite</td><td>Nathaniel Clay</td></tr><tr><td>Antoine Bajolet</td><td>IIDA Tetsushi</td><td>Nikita Shulga</td></tr><tr><td>Artur Zakirov</td><td>Ingvild Nystuen</td><td>Norman Vine</td></tr><tr><td>Barbara Phillipot</td><td>Jackie Leng</td><td>Patricia Tozer</td></tr><tr><td>Ben Jubb</td><td>James Marca</td><td>Rafal Magda</td></tr><tr><td>Bernhard Reiter</td><td>Jason Smith</td><td>Ralph Mason</td></tr><tr><td>Björn Esser</td><td>Jeff Adams</td><td>Rémi Cura</td></tr><tr><td>Brian Hamlin</td><td>Jonne Savolainen</td><td>Richard Greenwood</td></tr><tr><td>Bruce Rindahl</td><td>Jose Carlos Martinez Llari</td><td>Roger Crew</td></tr><tr><td>Bruno Wolff III</td><td>Jörg Habenicht</td><td>Ron Mayer</td></tr><tr><td>Bryce L. Nordgren</td><td>Julien Rouhaud</td><td>Sebastiaan Couwenberg</td></tr><tr><td>Carl Anderson</td><td>Kashif Rasul</td><td>Sergey Fedoseev</td></tr><tr><td>Charlie Savage</td><td>Klaus Foerster</td><td>Shinichi Sugiyama</td></tr><tr><td>Christoph Berg</td><td>Kris Jurka</td><td>Shoaib Burq</td></tr><tr><td>Christoph Moench-Tegeder</td><td>Laurenz Albe</td><td>Silvio Grosso</td></tr><tr><td>Dane Springmeyer</td><td>Lars Roessiger</td><td>Steffen Macke</td></tr><tr><td>Dave Fuhry</td><td>Leo Hsu</td><td>Stepan Kuzmin</td></tr><tr><td>David Garnier</td><td>Loic Dachary</td><td>Stephen Frost</td></tr><tr><td>David Skea</td><td>Luca S. Percich</td><td>Talha Rizwan</td></tr><tr><td>David Techer</td><td>Maria Arias de Reyna</td><td>Tom Glancy</td></tr><tr><td>Dmitry Vasilyev</td><td>Marc Ducobu</td><td>Tom van Tilburg</td></tr><tr><td>Eduin Carrillo</td><td>Mark Sondheim</td><td>Vincent Mora</td></tr><tr><td>Eugene Antimirov</td><td>Markus Schaber</td><td>Vincent Picavet</td></tr><tr><td>Even Rouault</td><td>Markus Wanner</td><td>Volf Tomáš</td></tr><tr><td>Frank Warmerdam</td><td>Matt Amos</td><td> </td></tr><tr><td>George Silva</td><td>Matthias Bay</td><td> </td></tr></table><p>
			</p></dd><dt><span class="term">企業</span></dt><dd><p>これらは、PostGISプロジェクトに開発者の時間、ホスティング、または直接の資金提供のいずれかの貢献をした企業です。アルファベット順: </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="ulink" href="https://arrival3d.com" target="_top">Arrival 3D</a></li><li class="listitem"><a class="ulink" href="http://gfoss.it" target="_top">Associazione Italiana per l'Informazione Geografica Libera (GFOSS.it)</a></li><li class="listitem"><a class="ulink" href="https://www.ausvet.com.au" target="_top">AusVet</a></li><li class="listitem">Avencia</li><li class="listitem"><a class="ulink" href="https://www.azavea.com" target="_top">Azavea</a></li><li class="listitem"><a class="ulink" href="https://www.boundlessgeo.com" target="_top">Boundless</a></li><li class="listitem"><a class="ulink" href="https://www.cadcorp.com" target="_top">Cadcorp</a></li><li class="listitem"><a class="ulink" href="https://www.camptocamp.com" target="_top">Camptocamp</a></li><li class="listitem"><a class="ulink" href="https://carto.com" target="_top">Carto</a></li><li class="listitem"><a class="ulink" href="https://www.boston.gov" target="_top">ボストン市 (近隣地区開発局)</a></li><li class="listitem"><a class="ulink" href="https://www.hel.fi" target="_top">ヘルシンキ市</a></li><li class="listitem"><a class="ulink" href="https://blog.cleverelephant.ca" target="_top">Clever Elephant Solutions</a></li><li class="listitem"><a class="ulink" href="https://www.alveo.coop" target="_top">Cooperativa Alveo</a></li><li class="listitem"><a class="ulink" href="http://www.elecnor-deimos.com" target="_top">Deimos Space</a></li><li class="listitem"><a class="ulink" href="https://www.faunalia.eu" target="_top">Faunalia</a></li><li class="listitem"><a class="ulink" href="https://gov.bc.ca" target="_top">Geographic Data BC</a></li><li class="listitem"><a class="ulink" href="http://www.hunterbiometrics.com" target="_top">Hunter Systems Group</a></li><li class="listitem"><a class="ulink" href="https://www.isciences.com" target="_top">ISciences, LLC</a></li><li class="listitem"><a class="ulink" href="https://www.lidwala.com" target="_top">Lidwala Consulting Engineers</a></li><li class="listitem"><a class="ulink" href="https://www.jirotech.com" target="_top">LISAsoft</a></li><li class="listitem">Logical Tracking &amp; Tracing International AG</li><li class="listitem">Maponics</li><li class="listitem"><a class="ulink" href="http://www.mtri.org" target="_top">Michigan Tech Research Institute</a></li><li class="listitem"><a class="ulink" href="https://www.nrcan.gc.ca" target="_top">カナダ天然資源省</a></li><li class="listitem">ノルウェー森林景観研究所</li><li class="listitem"><a class="ulink" href="https://www.nibio.no/" target="_top">ノルウェー生物経済研究所 (NIBIO)</a></li><li class="listitem"><a class="ulink" href="https://www.osgeo.org" target="_top">OSGeo</a></li><li class="listitem"><a class="ulink" href="https://oslandia.com" target="_top">Oslandia</a></li><li class="listitem"><a class="ulink" href="https://www.palantir.com" target="_top">Palantir Technologies</a></li><li class="listitem"><a class="ulink" href="https://www.paragoncorporation.com" target="_top">Paragon Corporation</a></li><li class="listitem"><a class="ulink" href="https://www.r3-gis.com" target="_top">R3 GIS</a></li><li class="listitem"><a class="ulink" href="http://www.refractions.net" target="_top">Refractions Research</a></li><li class="listitem"><a class="ulink" href="https://www.regione.toscana.it" target="_top">Regione Toscana - SITA</a></li><li class="listitem"><a class="ulink" href="https://www.safe.com" target="_top">Safe Software</a></li><li class="listitem">Sirius Corporation plc</li><li class="listitem"><a class="ulink" href="http://www.uster.ch" target="_top">Stadt Uster</a></li><li class="listitem"><a class="ulink" href="https://www.ucdavis.edu" target="_top">UC Davis Center for Vectorborne Diseases</a></li><li class="listitem"><a class="ulink" href="https://www.ulaval.ca" target="_top">Université Laval</a></li><li class="listitem"><a class="ulink" href="https://hiu.state.gov" target="_top">米国国務省 (人道情報部門)</a></li><li class="listitem"><a class="ulink" href="https://www.zonarsystems.com" target="_top">Zonar Systems</a></li></ul></div><p>
		</p></dd><dt><span class="term">クラウドファンディングキャンペーン</span></dt><dd><p>クラウドファンディングキャンペーンは、PostGIS開発チームが走らせているキャンペーンです。欲しくて仕方ない機能に資金を与えて、多数の人々にサービスを提供できるようにするためのものです。それぞれのキャンペーンでは、特定の機能または機能の集合に焦点があてられます。それぞれのスポンサーは、必要な資金提供のうち少しだけを提供し、十分な人/組織の寄付で、たくさんの助けになる作業に支払う基金を持ちます。他の多くの人が寄付に協力してくれそうな機能に関するアイデアがありましたら、<a class="ulink" href="https://lists.osgeo.org/mailman/listinfo/postgis-users" target="_top">PostGIS newsgroup</a>に、その考えを投稿して下さい。一緒に実現できます。 </p><p>PostGIS 2.0.0はこの戦略を実施する最初のリリースです。<a class="ulink" href="http://www.pledgebank.com" target="_top">PledgeBank</a>を使い、2件のキャンペーンが成功しました。</p><p><a class="ulink" href="http://www.pledgebank.com/postgistopology" target="_top"><span class="bold"><strong>postgistopology</strong></span></a> - 10以上のスポンサーがTopoGeometry機能の構築と2.0.0でのトポロジ対応強化とのために、それぞれ250米ドルを寄付しました。</p><p><a class="ulink" href="http://www.pledgebank.com/postgis64windows" target="_top"><span class="bold"><strong>postgis64windows</strong></span></a> - 20のスポンサーが、Windows上でのPostGIS 64ビット版に必要な作業のために、それぞれ100米ドルを寄付しました。</p></dd><dt><span class="term">重要なサポートライブラリ </span></dt><dd><p>ジオメトリ演算ライブラリ<a class="ulink" href="https://geos.osgeo.org" target="_top">GEOS</a></p><p>地理空間データ抽象化ライブラリ<a class="ulink" href="https://www.gdal.org" target="_top">GDAL</a>は、PostGIS 2で導入されたラスタ機能の多くに使われています。また、GDALのPostGIS対応に必要な改善はGDALプロジェクトに貢献しています。</p><p>地図投影ライブラリ<a class="ulink" href="https://www.proj4.org" target="_top">PROJ</a></p><p>最後ですがおろそかにできないのが<a class="ulink" href="http://www.postgresql.org" target="_top">PostgreSQL</a>です。PostGISはこの巨人に立っています。PostGISの速度と柔軟性は、PostgreSQLが提供する拡張性、優れたクエリプランナ、GiSTインデックス、多数のSQL機能があって初めて成り立ちます。</p></dd></dl></div></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="postgis_installation"></a>第2章 PostGISインストール</h1></div></div></div><div class="toc"><div class="toc-title">目次</div><dl class="toc"><dt><span class="sect1"><a href="#install_short_version">2.1. 簡略版</a></span></dt><dt><span class="sect1"><a href="#PGInstall">2.2. ソースからのコンパイルとインストール</a></span></dt><dd><dl><dt><span class="sect2"><a href="#install_getting_source">2.2.1. ソースの取得</a></span></dt><dt><span class="sect2"><a href="#install_requirements">2.2.2. インストール要件</a></span></dt><dt><span class="sect2"><a href="#installation_configuration">2.2.3. ビルドコンフィギュレーション</a></span></dt><dt><span class="sect2"><a href="#idp50007936">2.2.4. ビルド</a></span></dt><dt><span class="sect2"><a href="#make_install_postgis_extensions">2.2.5. PostGISエクステンションのビルドとデプロイ</a></span></dt><dt><span class="sect2"><a href="#idp50037120">2.2.6. テスト</a></span></dt><dt><span class="sect2"><a href="#idp50048640">2.2.7. インストール</a></span></dt></dl></dd><dt><span class="sect1"><a href="#installing_pagc_address_standardizer">2.3. PAGC住所標準化ツールのインストールと使用</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp50078592">2.3.1. Regex::Assembleのインストール</a></span></dt></dl></dd><dt><span class="sect1"><a href="#loading_extras_tiger_geocoder">2.4. Tigerジオコーダのインストールとアップグレードとデータロード</a></span></dt><dd><dl><dt><span class="sect2"><a href="#install_tiger_geocoder_extension">2.4.1. TigerジオコーダをPostGISデータベースで有効にする: エクステンションを使用</a></span></dt><dt><span class="sect2"><a href="#install_tiger_geocoder">2.4.2. TigerジオコーダをPostGISデータベースで有効にする: エクステンション不使用</a></span></dt><dt><span class="sect2"><a href="#tiger_pagc_address_standardizing">2.4.3. TigerジオコーダをPostGISデータベースで有効にする: エクステンションを使用</a></span></dt><dt><span class="sect2"><a href="#tiger_geocoder_loading_data">2.4.4. Tigerデータのロード</a></span></dt><dt><span class="sect2"><a href="#upgrade_tiger_geocoder">2.4.5. Tigerジオコーダのアップグレード</a></span></dt></dl></dd><dt><span class="sect1"><a href="#idp50198528">2.5. 共通の問題</a></span></dt></dl></div><p>本章では、PostGISのインストールに必要な手順について説明します。 </p><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="install_short_version"></a>2.1. 簡略版</h2></div></div></div><p>全ての依存がパスに入っているとする場合、次のようにコンパイルします。</p><pre class="programlisting">tar -xvfz postgis-3.2.0.tar.gz
cd postgis-3.2.0
./configure
make
make install</pre><p>PostGISがインストールされたら、使用したい個々のデータベースで有効にする (<a class="xref" href="#create_spatial_db" title="3.3. 空間テーブルの作成">「空間テーブルの作成」</a>)かアップグレード (<a class="xref" href="#upgrading" title="3.4. 空間データベースのアップグレード">「空間データベースのアップグレード」</a>)する必要があります。  </p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="PGInstall"></a>2.2. ソースからのコンパイルとインストール</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="#install_getting_source">2.2.1. ソースの取得</a></span></dt><dt><span class="sect2"><a href="#install_requirements">2.2.2. インストール要件</a></span></dt><dt><span class="sect2"><a href="#installation_configuration">2.2.3. ビルドコンフィギュレーション</a></span></dt><dt><span class="sect2"><a href="#idp50007936">2.2.4. ビルド</a></span></dt><dt><span class="sect2"><a href="#make_install_postgis_extensions">2.2.5. PostGISエクステンションのビルドとデプロイ</a></span></dt><dt><span class="sect2"><a href="#idp50037120">2.2.6. テスト</a></span></dt><dt><span class="sect2"><a href="#idp50048640">2.2.7. インストール</a></span></dt></dl></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>多くのOSで、ビルドされたPostgreSQL/PostGISパッケージがあります。多くの場合、コンパイルが必要なのは、最もひどい最先端の版が欲しい場合やパッケージメンテナンスを行う人ぐらいです。 </p><p>本節では、一般的なコンパイル手順を示します。Windows用や他のOS用等にコンパイルするなら、<a class="ulink" href="http://trac.osgeo.org/postgis/wiki/UsersWikiInstall" target="_top">PostGIS User contributed compile guides</a>や<a class="ulink" href="http://trac.osgeo.org/postgis/wiki/DevWikiMain" target="_top">PostGIS Dev Wiki</a>で、より詳細な助けが見つかるかも知れません。</p><p>多くのOS用のビルド済みパッケージの一覧は<a class="ulink" href="http://trac.osgeo.org/postgis/wiki/UsersWikiPackages" target="_top">PostGIS Pre-built Packages</a>にあります。</p><p>Windowsユーザは、スタックビルダか<a class="ulink" href="https://postgis.net/windows_downloads" target="_top">PostGIS Windows download site</a>から安定したビルドを得ることができます。また、通常は週に1回か2回で、何かあったときはその都度ビルドする<a class="ulink" href="https://postgis.net/windows_downloads" target="_top">very bleeding-edge windows experimental builds</a>もあります。これは、PostGISの進行中のリリースを試すのに使います。</p></td></tr></table></div><p>PostGISモジュールは、PostgreSQLバックエンドサーバの拡張です。PostGIS 3.2.0では、コンパイルのために、完全なPostgreSQLサーバヘッダが<span class="emphasis"><em>必要です</em></span>。PostgreSQL 3.2.0以上でビルドできます。古い版のPostgreSQLは<span class="emphasis"><em>サポートされません</em></span>。 </p><p>PostgreSQLをインストールしていないならPostgreSQLインストールガイドを参照して下さい。<a class="ulink" href="http://www.postgresql.org/" target="_top">http://www.postgresql.org/</a>にあります。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>GEOS機能を有効にするために、PostgreSQLをインストール時に明示的に標準C++ライブラリに対する明示的なリンクが必要になる場合があります。 </p><pre class="programlisting">LDFLAGS=-lstdc++ ./configure [コンフィギュアオプション]</pre><p>これは、古い開発ツールとインチキC++例外との対話のための応急処置です。怪しい問題 (望んでいないのにバックエンドが閉じたりそれに近い挙動を起こす)を経験したなら、このトリックを試してみて下さい。もちろん、これを行うにはPostgreSQLをはじめからコンパイルし直す必要があります。 </p></td></tr></table></div><p>次のステップでは、PostGISソースのコンフィギュレーションとコンパイルに概要を記述します。これらは、Linuxユーザ用に書いてありますので、WindowsやMacでは動作しません。 </p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="install_getting_source"></a>2.2.1. ソースの取得</h3></div></div></div><p>ダウンロードサイト<a class="ulink" href="http://download.osgeo.org/postgis/source/postgis-3.2.0.tar.gz" target="_top">http://download.osgeo.org/postgis/source/postgis-3.2.0.tar.gz</a>からソースのアーカイブを入手します。 </p><pre class="programlisting">wget http://download.osgeo.org/postgis/source/postgis-3.2.0.tar.gz
tar -xvzf postgis-3.2.0.tar.gz</pre><p>これで、カレントディレクトリの下に<code class="varname">postgis-3.2.0</code>ができます。 </p><p>もしくは、<a class="ulink" href="https://git-scm.com/" target="_top"> git </a>レポジトリの<a class="ulink" href="https://git.osgeo.org/gitea/postgis/postgis/" target="_top"> https://git.osgeo.org/gitea/postgis/postgis/ </a>からソースをチェックアウトします。 </p><pre class="programlisting">git clone https://git.osgeo.org/gitea/postgis/postgis.git postgis</pre><p>新しく作られた<code class="varname">postgis</code>ディレクトトリに移動して、インストールを続けます。 </p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="install_requirements"></a>2.2.2. インストール要件</h3></div></div></div><p>PostGISのビルドと利用のために、次のものが必要です。 </p><p>
	  <span class="bold"><strong>必須</strong></span>
	</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>PostgreSQL 9.6以上。PostgreSQLの完全なインストール (サーバヘッダを含む)が必要です。PostgreSQLは<a class="ulink" href="http://www.postgresql.org/" target="_top"> http://www.postgresql.org/</a>にあります。 </p><p>完全なPosgreSQL/PostGIS対応表とPostGIS/GEOS対応表については<a class="ulink" href="http://trac.osgeo.org/postgis/wiki/UsersWikiPostgreSQLPostGIS" target="_top">http://trac.osgeo.org/postgis/wiki/UsersWikiPostgreSQLPostGIS</a>をご覧ください。 </p></li><li class="listitem"><p>GNU Cコンパイラ (<code class="filename">gcc</code>)。ANSI Cコンパイラの中には、PostGISをコンパイルできるものもありますが、<code class="filename">gcc</code>でコンパイルするのが最も問題が少ないと見ています。 </p></li><li class="listitem"><p>GNU Make (<code class="filename">gmake</code>または<code class="filename">make</code>)。多くのシステムで、GNU makeがデフォルトのmakeになっています。<code class="filename">make -v</code>を実行して版を確認して下さい。他版の<code class="filename">make</code>では、PostGISの<code class="filename">Makefile</code>を完全に処理しきれないかもしれません。 </p></li><li class="listitem"><p>投影変換ライブラリ Proj。4.9以上が必要です。Projライブラリは、PostGISの座標系投影変換機能に使われます。Projは <a class="ulink" href="https://proj.org/" target="_top"> https://proj.org/ </a>からダウンロードできます。 </p></li><li class="listitem"><p>ジオメトリライブラリGEOS、3.6版以降が必要ですが、新しい関数と機能の最大限に活用するためには3.9以上をお勧めします。GEOSは<a class="ulink" href="http://trac.osgeo.org/geos/" target="_top"> http://trac.osgeo.org/geos/ </a>からダウンロード可能です。 </p></li><li class="listitem"><p>LibXML2の2.5.x以上。LibXML2は現在取り込み関数 (ST_GeomFromGMLとST_GeomFromKML)で使っています。LibXML2は<a class="ulink" href="http://xmlsoft.org/downloads.html" target="_top">http://xmlsoft.org/downloads.html</a>からダウンロード可能です。 </p></li><li class="listitem"><p>JSON-C 0.9以上。JSON-Cは現在、ST_GeomFromGeoJsonによるGeoJSONの取り込みに使われます。JSON-Cは<a class="ulink" href="https://github.com/json-c/json-c/releases/" target="_top">https://github.com/json-c/json-c/releases/</a>からダウンロード可能です。 </p></li><li class="listitem"><p>GDAL 2以上が必要ですが、3以上の方が良いです。ラスタ機能に必要です。<a class="ulink" href="http://trac.osgeo.org/gdal/wiki/DownloadSource/" target="_top">http://trac.osgeo.org/gdal/wiki/DownloadSource/</a>からダウンロード可能です。 </p></li><li class="listitem"><p>PostgreSQL+JITでコンパイルする場合には、LLVM 6版以上が必要です。<a class="ulink" href="https://trac.osgeo.org/postgis/ticket/4125" target="_top">https://trac.osgeo.org/postgis/ticket/4125</a>を参照して下さい。 </p></li></ul></div><p>
	  <span class="bold"><strong>オプション</strong></span>
	</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>GDAL (擬似的任意)ラスタが必要ない場合に限り不要です。<a class="xref" href="#raster_configuration" title="3.2. ラスタ機能の設定">「ラスタ機能の設定」</a>の説明に従って使用したいドライバを有効にしてください。 </p></li><li class="listitem"><p>GTK (GTK+2.0, 2.8+が必要)。シェープファイルのローダであるshp2pgsql-guiのコンパイル用です。<a class="ulink" href="http://www.gtk.org/" target="_top">http://www.gtk.org/</a>にあります。 </p></li><li class="listitem"><p>SFCGAL 1.3.1版以上。追加的な2次元や3次元の高度な解析関数をPostGISで使うために使用するものです。<a class="xref" href="#reference_sfcgal" title="8.10. SFCGAL関数">「SFCGAL関数」</a>をご覧下さい。また、GEOSを使う2次元関数のうちいくつか (たとえばST_IntersectionやST_Area)は、GEOSでなくSFCGALを使用することができます。PostgreSQLコンフィギュレーション変数<code class="code">postgis.backend</code>によって、SFCGALがインストールされている場合にはエンドユーザがバックエンドを制御することができます (デフォルトではGEOS)。SFCGAL 1.2は少なくともCGAL 4.3とBoost 1.54 (<a class="ulink" href="https://oslandia.gitlab.io/SFCGAL/dev.html" target="_top">https://oslandia.gitlab.io/SFCGAL/dev.html</a>をご覧下さい)が必要ですのでご注意下さい。<a class="ulink" href="https://gitlab.com/Oslandia/SFCGAL/" target="_top">https://gitlab.com/Oslandia/SFCGAL/</a>にあります。 </p></li><li class="listitem"><p><a class="xref" href="#Address_Standardizer" title="14.1. 住所標準化">「住所標準化」</a>をビルドするには、PCRE <a class="ulink" href="http://www.pcre.org" target="_top">http://www.pcre.org</a> (Unix系システムには通常はインストール済みです)も必要です。<code class="filename">parseaddress-stcities.h</code>内のエンコードしたデータを再構築したい場合には、Perl CPANの<code class="code">Regex::Assemble</code>パッケージのみ必要です。<a class="xref" href="#Address_Standardizer" title="14.1. 住所標準化">「住所標準化」</a>は、PCREライブラリを検出するか、コンフィギュレーションで適切に<code class="varname">--with-pcre-dir=/path/to/pcre</code>を指定すると、自動的にビルドされます。 </p></li><li class="listitem"><p>ST_AsMVTを有効にするにはprotobuf-cライブラリ (使用時)とprotoc-cコンパイラ (ビルド時)が必要です。さらに、protobuf-cの正しい最小バージョンを確認するためにpkg-configが必要です。<a class="ulink" href="https://github.com/protobuf-c/protobuf-c" target="_top">protobuf-c</a>をご参照下さい。デフォルトでは、PostGISはMVTポリゴンの評価を速く行うためにWagyuを使いますが、C++11コンパイラが必要です。CXXFLAGSを使い、PostgreSQLのインストールと同じコンパイラを使います。これを無効にし、GEOSを代わりに使うには、コンフィギュア時に<code class="varname">--without-wagyu</code>を付けます。 </p></li><li class="listitem"><p>CUnit (<code class="filename">CUnit</code>)。レグレッションテストに必要です。<a class="ulink" href="http://cunit.sourceforge.net/" target="_top">http://cunit.sourceforge.net/</a>にあります。 </p></li><li class="listitem"><p>DocBook (<code class="filename">xsltproc</code>)。文書のビルドに必要です。<a class="ulink" href="http://www.docbook.org/" target="_top">http://www.docbook.org/</a>にあります。 </p></li><li class="listitem"><p>DBLatex (<code class="filename">dblatex</code>)。文書をPDFでビルドするのに必要です。<a class="ulink" href="http://dblatex.sourceforge.net/" target="_top">http://dblatex.sourcforge.net/</a>にあります。 </p></li><li class="listitem"><p>ImageMagick (<code class="filename">convert</code>)。文書で使う画像を生成するのに必要です。<a class="ulink" href="http://www.imagemagick.org/" target="_top">http://www.imagemagick.org/</a>にあります。 </p></li></ul></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="installation_configuration"></a>2.2.3. ビルドコンフィギュレーション</h3></div></div></div><p>ほとんどのLinuxのインストールと同様に、最初のステップでは、ソースコードのビルドに使われるMakefileを生成します。これは、シェルスクリプトが行います。 </p><p>
		<span class="command"><strong>./configure</strong></span>
	  </p><p>パラメータを付けない場合には、このコマンドは自動で、PostGISのソースコードのビルドを行うのに必要なコンポーネントやライブラリをシステム上で探します。<span class="command"><strong>./configure</strong></span>とするのが一般的な使い方ですが、標準的でない位置に必要なライブラリやプログラムを置いてある場合のために、いくつかのパラメータを受け付けます。 </p><p>次のリストで、共通して使われるパラメータを示します。 完全なリストについては、<span class="command"><strong>--help</strong></span>または<span class="command"><strong>--help=short</strong></span>パラメータを使って下さい。 </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="command"><strong>--with-library-minor-version</strong></span></span></dt><dd><p>PostGIS 3.0以降では、デフォルトではライブラリファイルのファイル名にマイナーバージョンが入らなくなりました。PostGIS 3のライブラリは<code class="code">postgis-3</code>で終わります。pg_upgradeを簡単にするために実施された変更ですが、サーバにPostGIS 3シリーズは一つのマイナーバージョンのものだけしかインストールできません。<code class="code">postgis-3.0</code>といったようにマイナーバージョンをファイル名に含む古い振る舞いにしたいなら、コンフィギュレーション実行の際に次のスイッチを追加します。</p></dd><dt><span class="term"><span class="command"><strong>--prefix=PREFIX</strong></span></span></dt><dd><p>これは、PostGISローダの実行ファイルと共有ライブラリがインストールされる位置です。デフォルトでは、この位置は、検出されたPostgreSQLのインストール先と同じです。 </p><div class="caution"><table border="0" summary="Caution"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注意]" src="images/caution.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>このパラメータは現在のところ壊れていて、PostgreSQLのインストール先にしかインストールされません。このバグのトラックについては<a class="ulink" href="http://trac.osgeo.org/postgis/ticket/635" target="_top">http://trac.osgeo.org/postgis/ticket/635</a>をご覧ください。 </p></td></tr></table></div></dd><dt><span class="term"><span class="command"><strong>--with-pgconfig=FILE</strong></span></span></dt><dd><p>PostgreSQLは、PostGISなどの拡張に対してPostgreSQLのインストール先ディレクトリを伝える<span class="command"><strong>pg_config</strong></span>というユーティリティを持っています。PostGISの対象とする特定のPostgreSQLのインストール先を手動で指定する場合に、このパラメータ(<span class="command"><strong>--with-pgconfig=/path/to/pg_config</strong></span>)を使います。 </p></dd><dt><span class="term"><span class="command"><strong>--with-gdalconfig=FILE</strong></span></span></dt><dd><p>必須ライブラリであるGDALは、ラスタ機能に必要な機能を提供します。GDALには、インストール先ディレクトリをインストールスクリプトに伝える<span class="command"><strong>gdal-config</strong></span>があります。PostGISのビルドに使う特定のGDALを手動で指定する場合に、このパラメータ (<span class="command"><strong>--with-gdalconfig=/path/to/gdal-config</strong></span>)を使います。 </p></dd><dt><span class="term"><span class="command"><strong>--with-geosconfig=FILE</strong></span></span></dt><dd><p>必須のジオメトリライブラリであるGEOSには、ソフトウェアのインストール時にGEOSのインストール先ディレクトリを伝える<span class="command"><strong>geos-config</strong></span>というユーティリティがあります。PostGISのビルドに使う特定のGEOSを手動で指定する場合に、このパラメータ (<span class="command"><strong>--with-geosconfig=/path/to/geos-config</strong></span>)を使います。 </p></dd><dt><span class="term"><span class="command"><strong>--with-xml2config=FILE</strong></span></span></dt><dd><p>LibXMLはGeomFromKML/GML処理を行うのに必須のライブラリです。通常はlibxmlをインストールしているなら発見されますが、発見できない場合や特定の版を使用したい場合は、<code class="filename">xml2-config</code>を指定してインストールスクリプトにLibXMLのインストール先ディレクトリを伝えます。PostGISのビルドに使う特定のLibXMLを手動で指定する場合に、このパラメータ (<span class="command"><strong>
&gt;--with-xml2config=/path/to/xml2-config</strong></span>)を使います。 </p></dd><dt><span class="term"><span class="command"><strong>--with-projdir=DIR</strong></span></span></dt><dd><p>ProjはPostGISに必須の投影変換ライブラリです。PostGISのビルドに使う特定のProjのディレクトリを手動で指定する場合は、このパラメータ (<span class="command"><strong>--with-projdir=/path/to/projdir</strong></span>)を使います。 </p></dd><dt><span class="term"><span class="command"><strong>--with-libiconv=DIR</strong></span></span></dt><dd><p>iconvのインストール先ディレクトリを指定します。 </p></dd><dt><span class="term"><span class="command"><strong>--with-jsondir=DIR</strong></span></span></dt><dd><p><a class="ulink" href="http://oss.metaparadigm.com/json-c/" target="_top">JSON-C</a>は、MITライセンスのJSONライブラリで、PostGISのST_GeomFromJSONに必須です。PostGISのビルドに使う特定のJSON-Cを手動で指定する場合に、このパラメータ (<span class="command"><strong>--with-jsondir=/path/to/jsondir</strong></span>)を使います。 </p></dd><dt><span class="term"><span class="command"><strong>--with-pcredir=DIR</strong></span></span></dt><dd><p><a class="ulink" href="http://www.pcre.org/" target="_top">PCRE</a>は、BSDライセンスのPerl互換正規表現ライブラリです。住所標準化エクステンションに必須です。PostGISのビルド対象としている特定のPCREを手動で指定する場合に、このパラメータ (<span class="command"><strong>--with-pcredir=/path/to/pcredir</strong></span>)を使います。 </p></dd><dt><span class="term"><span class="command"><strong>--with-gui</strong></span></span></dt><dd><p>データインポートGUI (GTK+2.0が必要)をコンパイルします。このパラメータによって、shp2pgsql-guiという、shp2pgsqlのグラフィカルユーザインタフェースが作成されます。 </p></dd><dt><span class="term"><span class="command"><strong>--without-raster</strong></span></span></dt><dd><p>ラスタ機能なしでコンパイルします。 </p></dd><dt><span class="term"><span class="command"><strong>--without-topology</strong></span></span></dt><dd><p>トポロジ対応を無くしてコンパイルします。トポロジに必要なロジックは全てpostgis-3.2.0ライブラリ内に作られるので、関連ライブラリはありません。 </p></dd><dt><span class="term"><span class="command"><strong>--with-gettext=no</strong></span></span></dt><dd><p>デフォルトでは、gettextの検出とこれを用いたコンパイルを試みますが、ローダ破損を引き起こす非互換性問題のもとで実行する場合には、このコマンドで無効にできます。これを使ったコンフィギュレーションによって解決する問題の例は<a class="ulink" href="http://trac.osgeo.org/postgis/ticket/748" target="_top">http://trac.osgeo.org/postgis/ticket/748</a>にあります。ご注意: これを切ることで多くの機能がなくなるわけではありません。まだ文書化されていなくて試験段階であるGUIローダにおける内部のヘルプ/ラベル機能に使われています。 </p></dd><dt><span class="term"><span class="command"><strong>--with-sfcgal=PATH</strong></span></span></dt><dd><p>デフォルトでは、このスイッチなしではSFCGAL対応でインストールされません。<code class="varname">PATH</code>は、sfcgal-configへのパスを指定することができる追加的な引数です。 </p></dd><dt><span class="term"><span class="command"><strong>--without-phony-revision</strong></span></span></dt><dd><p>Gitレポジトリの現在のHEADに一致するように、postgis_revision.hの更新を無効にします。 </p></dd></dl></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><a class="ulink" href="https://trac.osgeo.org/postgis/wiki/CodeRepository" target="_top">コードレポジトリ</a>からPostGISを取得した場合には、最初のステップとしてスクリプトを実行します。 </p><p>
		  <span class="command"><strong>./autogen.sh</strong></span>
		</p><p>このスクリプトによって<span class="command"><strong>configure</strong></span>スクリプトが生成されます。これはPostGISのインストールに関するカスタマイズに使われます。 </p><p>PostGISをアーカイブファイルで入手する場合には、<span class="command"><strong>configure</strong></span>が既に生成されているので<span class="command"><strong>./autogen.sh</strong></span>は不要です。 </p></td></tr></table></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idp50007936"></a>2.2.4. ビルド</h3></div></div></div><p>Makefileが生成されたら、PostGISのビルドは、次のコマンドを実行するだけです。 </p><p>
		<span class="command"><strong>make</strong></span>
	  </p><p>出力の最後の行に"<code class="code">PostGIS was built successfully. Ready to install.</code>"と出れば終わりです。 </p><p>PostGIS 1.4.0版からは、全ての関数に文書から生成されるコメントが付きます。これらのコメントを後からインストールするには、次のコマンドを実行しますが、docbookが必要です。アーカイブファイルからインストールする場合は、postgis_comments.sql, raster_comments.sql, topology_comments.sqlは、docフォルダにあるので、コメントを作成する必要はありません。コメントはCREATE EXTENSIONによるインストールの一部として取り込まれます。 </p><p>
		<span class="command"><strong>make comments</strong></span>
	  </p><p>PostGIS 2.0で導入されました。早見表に、または学習中の方のハンドアウトに適しているHTMLチートシートを生成します。xsltprocが必要で、<code class="filename">topology_cheatsheet.html</code>, <code class="filename">tiger_geocoder_cheatsheet.html</code>, <code class="filename">raster_cheatsheet.html</code>, <code class="filename">postgis_cheatsheet.html</code>の4ファイルが生成されます。 </p><p>HTMLとPDFのビルド済みのものは<a class="ulink" href="http://www.postgis.us/study_guides" target="_top">PostGIS / PostgreSQL Study Guides</a>にあります。</p><p>
		<span class="command"><strong>make cheatsheets</strong></span>
	  </p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="make_install_postgis_extensions"></a>2.2.5. PostGISエクステンションのビルドとデプロイ</h3></div></div></div><p>PostgreSQL 9.1以上を使用している場合は、PostGISエクステンションが自動的にビルド、インストールされます。 </p><p>ソースレポジトリからビルドしている場合は、関数の記述を最初にビルドする必要があります。これらは、docbookがインストールされている時にビルドされます。手動でインストールするには次のようにします。 </p><p>
	  <span class="command"><strong>make comments</strong></span>
    </p><p>アーカイブファイルからのビルドの場合は、ビルド済みのものがあるので、コメントのビルドは必須ではありません。</p><p>エクステンションはmake installの過程の一部として自動的にビルドされるはずです。必要ならエクステンションフォルダからビルドすることもできますし、他のサーバに必要ならファイルを複製することもできます。 </p><pre class="programlisting">cd extensions
cd postgis
make clean
make
export PGUSER=postgres #overwrite psql variables
make check #to test before install
make install
# エクステンションのテスト
make check RUNTESTFLAGS=--extension</pre><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="code">make check</code>は、テスト実行のためにpsqlを使用し、psql環境変数を使用します。一般的なpsql環境変数で上書きすると便利なのが<code class="varname">PGUSER</code>,<code class="varname">PGPORT</code>, <code class="varname">PGHOST</code>です。<a class="ulink" href="https://www.postgresql.jp/document/current/html/libpq-envars.html" target="_top">環境変数</a>を参照して下さい。 </p></td></tr></table></div><p>エクステンションのファイルは、PostGISとPostgreSQLの同じバージョンでは、OSに関わらず、常に同じです。サーバにPostGISのバイナリがインストールされている限り、あるOSから他のOSにエクステンションファイルを上書き複製するのは問題ありません。 </p><p>開発用と異なる別のサーバでエクステンションを手動でインストールしたい場合は、サーバにない時に必要となる通常のPostGISのバイナリだけでなく、次のファイルをextensionsフォルダからPostgreSQLインストール先の<code class="filename">PostgreSQL / share / extension</code>フォルダに複写します。 </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>指定されていない場合のインストールするエクステンションの版等の情報を示す制御ファイ<code class="filename">postgis.control, postgis_topology.control</code>。 </p></li><li class="listitem"><p>エクステンションごとの/sqlフォルダにあるファイル全て。<code class="filename">extensions/postgis/sql/*.sql</code>, <code class="filename">extensions/postgis_topology/sql/*.sql</code>はPostgreSQL share/extensionフォルダの最上位に複写する必要があることに注意して下さい。 </p></li></ul></div><p>以上を実行すると、PgAdmin -&gt; extensionで<code class="varname">postgis</code>, <code class="varname">postgis_topology</code>が有効なエクステンションとして見えます。</p><p>psqlを使う場合は、次のクエリを実行してエクステンションがインストールされていることを確認できます。</p><pre class="programlisting">SELECT name, default_version,installed_version
FROM pg_available_extensions WHERE name LIKE 'postgis%' or name LIKE 'address%';

             name             | default_version | installed_version
------------------------------+-----------------+-------------------
 address_standardizer         | 3.2.0         | 3.2.0
 address_standardizer_data_us | 3.2.0         | 3.2.0
 postgis                      | 3.2.0         | 3.2.0
 postgis_raster               | 3.2.0         | 3.2.0
 postgis_sfcgal               | 3.2.0         |
 postgis_tiger_geocoder       | 3.2.0         | 3.2.0
 postgis_topology             | 3.2.0         |
(6 rows)</pre><p>クエリを行ったデータベースにエクステンションがインストールされている場合は、<code class="varname">installed_version</code>カラムに記載が見えます。レコードが返ってこない場合は、PostGIS EXTENSIONがインストールされていないことになります。PgAdmin III 1.14以上では、データベースブラウザツリーの<code class="varname">extensions</code>セクションで提供されていて、右クリックでアップグレードまたアンインストールできます。</p><p>有効なエクステンションがある場合、pgAdminエクステンションインタフェースまたは次のSQLの実行によって、選択したデータベースにPostGISエクステンションをインストールできます。</p><pre class="programlisting">CREATE EXTENSION postgis;
CREATE EXTENSION postgis_raster;
CREATE EXTENSION postgis_sfcgal;
 --postgis_tiger_geocoderに必要です
CREATE EXTENSION fuzzystrmatch;
-- postgis_tiger_geocoderで使用しますが、スタンドアロンでも使えます
CREATE EXTENSION address_standardizer;
CREATE EXTENSION address_standardizer_data_us;
CREATE EXTENSION postgis_tiger_geocoder;
CREATE EXTENSION postgis_topology;</pre><p>psqlでは、どの版が、どのスキーマにインストールされているかを見ることができます。 </p><pre class="programlisting">\connect mygisdb
\x
\dx postgis*</pre><pre class="screen">List of installed extensions
-[ RECORD 1 ]-------------------------------------------------
Name        | postgis
Version     | 3.2.0
Schema      | public
Description | PostGIS geometry, geography, and raster spat..
-[ RECORD 2 ]-------------------------------------------------
Name        | postgis_raster
Version     | 3.0.0dev
Schema      | public
Description | PostGIS raster types and functions
-[ RECORD 3 ]-------------------------------------------------
Name        | postgis_tiger_geocoder
Version     | 3.2.0
Schema      | tiger
Description | PostGIS tiger geocoder and reverse geocoder
-[ RECORD 4 ]-------------------------------------------------
Name        | postgis_topology
Version     | 3.2.0
Schema      | topology
Description | PostGIS topology spatial types and functions</pre><div class="warning"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>エクステンションのテーブル<code class="varname">spatial_ref_sys</code>, <code class="varname">layer</code>, <code class="varname">topology</code>は、明示的にバックアップできません。それぞれの<code class="varname">postgis</code>または<code class="varname">postgis_topology</code>エクステンションがバックアップされる時のみバックアップできます。これは、データベース全体のバックアップの時のみ行われます。PostGIS 2.0.1の時点では、データベースがバックアップされる際に、PostGISでパッケージ化されていないsridレコードのみバックアップされます。パッケージに入っているsridの変更は巡回せず、変更はそこにあるものと期待されます。PostGIS 2.0.1の時点では、データベースがバックアップされるときにPostGISに入っていないsridのレコードだけがバックアップされます。PostGISに入っていて後に変更されたsridの変更については巡回しません。問題が見られたら、チケットを発行して下さい。エクステンションテーブルの構造は<code class="code">CREATE EXTENSION</code>で生成されるので、バックアップを行いません。エクステンションの与えられた版と同じものであると仮定されます。この挙動は現在のPostgreSQL エクステンションモデルに組み込まれているため、これについては何もできません。</p></td></tr></table></div><p>素晴らしいエクステンション機構を使わずに3.2.0をインストールした場合には、それぞれのエクステンションが持つ関数をパッケージするためのコマンドを実行して、エクステンションに基づくように変更できます。 </p><pre class="programlisting">CREATE EXTENSION postgis FROM unpackaged;
CREATE EXTENSION postgis_raster FROM unpackaged;
CREATE EXTENSION postgis_topology FROM unpackaged;
CREATE EXTENSION postgis_tiger_geocoder FROM unpackaged;
</pre></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idp50037120"></a>2.2.6. テスト</h3></div></div></div><p>PostGISのテストを行うには、次のコマンドを実行します。 </p><p>
		<span class="command"><strong>make check</strong></span>
	  </p><p>このコマンドで、実際のPostgreSQLデータベースに対して生成したライブラリを使用した、様々なチェックとレグレッションテストを行います。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>コンフィギュレーションを行ったPostGISが標準の場所に無いPostgreSQL、GEOSまたはProjを使う場合には、これらのライブラリの位置を<code class="varname">LD_LIBRARY_PATH</code>環境変数に追加する必要があるかも知れません。 </p></td></tr></table></div><div class="caution"><table border="0" summary="Caution"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注意]" src="images/caution.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>現在のところ<span class="command"><strong>make check</strong></span>は、チェックを行う際に 環境変数<code class="code">PATH</code>と<code class="code">PGPORT</code>によっています。コンフィギュレーションパラメータ<span class="command"><strong>--with-pgconfig</strong></span>を使って特定したPostgreSQLでは<span class="emphasis"><em>ありません</em></span>。PATHを編集して、コンフィギュレーションの際に検出したPostgreSQLと一致するようにして下さい。もしくは、間もなく襲ってくる頭痛の準備をしておいて下さい。 </p></td></tr></table></div><p>成功した場合、make checkを行うと約500個のテストが出力されます。結果は次のようになります (多数の行数を示します)。 </p><pre class="programlisting">CUnit - A unit testing framework for C - Version 2.1-3
     http://cunit.sourceforge.net/

        .
        .
        .

Run Summary:    Type  Total    Ran Passed Failed Inactive
              suites     44     44    n/a      0        0
               tests    300    300    300      0        0
             asserts   4215   4215   4215      0      n/a
Elapsed time =    0.229 seconds

        .
        .
        .

Running tests

        .
        .
        .

Run tests: 134
Failed: 0


-- if you build with SFCGAL

        .
        .
        .

Running tests

        .
        .
        .

Run tests: 13
Failed: 0

-- if you built with raster support

        .
        .
        .

Run Summary:    Type  Total    Ran Passed Failed Inactive
              suites     12     12    n/a      0        0
               tests     65     65     65      0        0
             asserts  45896  45896  45896      0      n/a


        .
        .
        .

Running tests

        .
        .
        .

Run tests: 101
Failed: 0

-- topology regress

.
.
.

Running tests

        .
        .
        .

Run tests: 51
Failed: 0

-- if you built --with-gui, you should see this too

     CUnit - A unit testing framework for C - Version 2.1-2
     http://cunit.sourceforge.net/

        .
        .
        .

Run Summary:    Type  Total    Ran Passed Failed Inactive
              suites      2      2    n/a      0        0
               tests      4      4      4      0        0
             asserts      4      4      4      0      n/a</pre><p><code class="varname">postgis_tiger_geocoder</code>と<code class="varname">address_standardizer</code>は、現在は、標準的なPostgreSQLインストールチェックにのみ対応しています。これらをテストするには、次のようにします。ご注意: PostGISコードフォルダのルートでmake installを既に行っている場合には、make installは必要ではありません。</p><p>address_standardizer用: </p><pre class="programlisting">cd extensions/address_standardizer
make install
make installcheck
          </pre><p>出力は次のようなかんじになります。 </p><pre class="screen">============== dropping database "contrib_regression" ==============
DROP DATABASE
============== creating database "contrib_regression" ==============
CREATE DATABASE
ALTER DATABASE
============== running regression test queries        ==============
test test-init-extensions     ... ok
test test-parseaddress        ... ok
test test-standardize_address_1 ... ok
test test-standardize_address_2 ... ok

=====================
 All 4 tests passed.
=====================</pre><p>Tiger Geocodeを使う場合には、使用するPostgreSQLインスタンス内にPostGISとfuzzystrmatchのエクステンションが必要です。PostGISをaddress_standardizer機能付きでビルドした場合は、address_standardizerのテストも行います。 </p><pre class="programlisting">cd extensions/postgis_tiger_geocoder
make install
make installcheck
          </pre><p>出力は次のようなかんじになります。 </p><pre class="screen">============== dropping database "contrib_regression" ==============
DROP DATABASE
============== creating database "contrib_regression" ==============
CREATE DATABASE
ALTER DATABASE
============== installing fuzzystrmatch               ==============
CREATE EXTENSION
============== installing postgis                     ==============
CREATE EXTENSION
============== installing postgis_tiger_geocoder      ==============
CREATE EXTENSION
============== installing address_standardizer        ==============
CREATE EXTENSION
============== running regression test queries        ==============
test test-normalize_address   ... ok
test test-pagc_normalize_address ... ok

=====================
All 2 tests passed.
=====================</pre></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idp50048640"></a>2.2.7. インストール</h3></div></div></div><p>PostGISをインストールするには、次のコマンドを実行します。 </p><p>
		<span class="command"><strong>make install</strong></span>
	  </p><p>これにより、PostGISのインストールファイルが、<span class="command"><strong>--prefix</strong></span>パラメータで指定した、適切なサブディレクトリに複写されます。次に特筆すべきサブディレクトリを示します。 </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>ローダとダンパのバイナリのインストール先は<code class="filename">[prefix]/bin</code>です。 </p></li><li class="listitem"><p><code class="filename">postgis.sql</code>などのSQLファイルのインストール先は<code class="filename">[prefix]/share/contrib</code>です。 </p></li><li class="listitem"><p>PostGISライブラリのインストール先は<code class="filename">[prefix]/lib</code>です。 </p></li></ul></div><p>先に<span class="command"><strong>make comments</strong></span>を実行して<code class="filename">postgis_comments.sql</code>, <code class="filename">raster_comments.sql</code>を生成していた場合は、次のコマンドを実行すると、これらのSQLファイルがインストールされます。 </p><p>
		<span class="command"><strong>make comments-install</strong></span>
	  </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="filename">postgis_comments.sql</code>, <code class="filename">raster_comments.sql</code>, <code class="filename">topology_comments.sql</code>は、<span class="command"><strong>xsltproc</strong></span>の外部依存ができたので、通常のビルドとインストールから切り離されました。 </p></td></tr></table></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="installing_pagc_address_standardizer"></a>2.3. PAGC住所標準化ツールのインストールと使用</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="#idp50078592">2.3.1. Regex::Assembleのインストール</a></span></dt></dl></div><p><code class="code">address_standardizer</code>エクステンションは、別途ダウンロードする必要がある別パッケージとしていました。PostGIS 2.2からは同梱されています。address_standardizeの追加情報、できること、および、コンフィギュレーション方法については、<a class="xref" href="#Address_Standardizer" title="14.1. 住所標準化">「住所標準化」</a>をご覧下さい。</p><p>標準化エクステンションは、<a class="xref" href="#Normalize_Address" title="Normalize_Address">Normalize_Address</a>の後継で、PostGISに入っているTigerジオコーダエクステンションに使うことができます。この場合の使い方については<a class="xref" href="#tiger_pagc_address_standardizing" title="2.4.3. TigerジオコーダをPostGISデータベースで有効にする: エクステンションを使用">「TigerジオコーダをPostGISデータベースで有効にする: エクステンションを使用」</a>を参照して下さい。また、ユーザ自身がつくるジオコーダの要素として使用したり、住所の比較を簡単にするために住所を標準化するために使うことができます。</p><p>住所標準化エクステンションはPCREに依存しています。PCREは多くのUNIX系システムにインストールされていますが、<a class="ulink" href="http://www.pcre.org" target="_top">http://www.pcre.org</a>から最新版をダウンロードできます。<a class="xref" href="#installation_configuration" title="2.2.3. ビルドコンフィギュレーション">「ビルドコンフィギュレーション」</a>の際にPCREを発見すると、住所標準化エクステンションが自動的にビルドされます。使用したいPCREのインストールが独自なものである場合は、configureに<code class="code">--with-pcredir=/path/to/pcre</code>を渡します。<code class="filename">/path/to/pcre</code>は、PCREのincludeとlibのあるルートフォルダです。</p><p>Windowsでは、PostGIS 2.1以上に住所標準化エクステンションが同梱されているので、コンパイルを行わずに、すぐに<code class="code">CREATE EXTENSION</code>に行くことができます。</p><p>インストールしたら、対象データベースに接続して次のSQLが実行できます。</p><pre class="programlisting">CREATE EXTENSION address_standardizer;</pre><p>次のテストでは、rules, gaz, lexテーブルは必要ありません。</p><pre class="programlisting">SELECT num, street, city, state, zip
 FROM parse_address('1 Devonshire Place PH301, Boston, MA 02109');</pre><p>出力は次のようになります。</p><pre class="screen">num |         street         |  city  | state |  zip
-----+------------------------+--------+-------+-------
 1   | Devonshire Place PH301 | Boston | MA    | 02109</pre><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idp50078592"></a>2.3.1. Regex::Assembleのインストール</h3></div></div></div><p>PerlのRegex::Assembleは、ソースツリーの一部がこれで作られていますが、住所標準化エクステンションではもはや不要です。ただし、<code class="filename">usps-st-city-orig.txt</code>または<code class="filename">usps-st-city-orig.txt usps-st-city-adds.tx</code>を編集する必要がある場合は、<code class="filename">parseaddress-stcities.h</code>のリビルドでRegex:Assembleが必要です。</p><pre class="programlisting">cpan Regexp::Assemble</pre><p>Ubuntu / Degianの場合には、次のようにしなければならないかも知れません。</p><pre class="programlisting">sudo perl -MCPAN -e "install Regexp::Assemble"</pre></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="loading_extras_tiger_geocoder"></a>2.4. Tigerジオコーダのインストールとアップグレードとデータロード</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="#install_tiger_geocoder_extension">2.4.1. TigerジオコーダをPostGISデータベースで有効にする: エクステンションを使用</a></span></dt><dt><span class="sect2"><a href="#install_tiger_geocoder">2.4.2. TigerジオコーダをPostGISデータベースで有効にする: エクステンション不使用</a></span></dt><dt><span class="sect2"><a href="#tiger_pagc_address_standardizing">2.4.3. TigerジオコーダをPostGISデータベースで有効にする: エクステンションを使用</a></span></dt><dt><span class="sect2"><a href="#tiger_geocoder_loading_data">2.4.4. Tigerデータのロード</a></span></dt><dt><span class="sect2"><a href="#upgrade_tiger_geocoder">2.4.5. Tigerジオコーダのアップグレード</a></span></dt></dl></div><p>Tigerジオコーダのような拡張機能はPostGISディストリビューションに同梱されていません。Tigerジオコーダエクステンションが無かったり、インストールしているものより新しい版のものが欲しい場合には、<a class="ulink" href="http://postgis.net/windows_downloads/" target="_top">Windows Unreleased Versions</a>節でPostgreSQLの版に合ったパッケージにある<code class="filename">share/extension/postgis_tiger_geocoder.*</code>ファイルを使います。これらのパッケージはWindows用ですが、postgis_tige_geocoderエクステンションファイルは、SQLとPL/pgSQLだけですので、他のOSでも動作します。</p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="install_tiger_geocoder_extension"></a>2.4.1. TigerジオコーダをPostGISデータベースで有効にする: エクステンションを使用</h3></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect3"><a href="#convert_tiger_geocoder_extension">2.4.1.1. Tigerジオコーダ通常インストールのエクステンションモデルへの変換</a></span></dt></dl></div><p>PostgreSQL 9.1以上とPostGIS 2.1.0を使用している場合は、Tigerジオコーダのインストールで、新しいエクステンションモデルの利点を得ることができます。次のようにします。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>まず、通常の方法で、PostGIS 2.1.0のバイナリを取得するか、コンパイルしてインストールします。これにより重要なエクステンションファイルとTigerジオコーダのファイルがインストールされます。</p></li><li class="listitem"><p>psql、pgAdminまたは他のツールでデータベースに接続して、次のSQLコマンドを実行します。既にPostGISを持っているデータベースにインストールする場合は、一つ目の手順は不要です。<code class="varname">fuzzystrmatch</code>エクステンションが既にインストールされている場合は、二つ目の手順は不要です。</p><pre class="programlisting">CREATE EXTENSION postgis;
CREATE EXTENSION fuzzystrmatch;
CREATE EXTENSION postgis_tiger_geocoder;
-- 規則を基にした住所標準化 (pagc_normalize_address)を使いたい場合の任意実行
CREATE EXTENSION address_standardizer;</pre><p>既にpostgis_tiger_geocoderエクステンションをインストールしていて、最新版に更新するだけの場合には、次を実行します。</p><pre class="programlisting">ALTER EXTENSION postgis UPDATE;
ALTER EXTENSION postgis_tiger_geocoder UPDATE;</pre><p>独自のエントリを生成した場合や、<code class="varname">tiger.loader_platform</code>と<code class="varname">tiger.loader_variables</code>に変更を加えた場合には、これらをアップデートしなければならないことがあります。</p></li><li class="listitem"><p>正しくインストールされたかを確認するために、インストール対象データベース内で次のSQLを実行します。</p><pre class="programlisting">SELECT na.address, na.streetname,na.streettypeabbrev, na.zip
        FROM normalize_address('1 Devonshire Place, Boston, MA 02109') AS na;</pre><p>出力は次のようになります。</p><pre class="screen">address | streetname | streettypeabbrev |  zip
---------+------------+------------------+-------
           1 | Devonshire | Pl               | 02109</pre></li><li class="listitem"><p><code class="varname">tiger.loader_platform</code>テーブルの、実行ファイルやサーバのパスを持つ新しいレコードを生成します。 </p><p><code class="code">sh</code>コンベンションのあとにdebbieというプロファイルを生成する例として、次のコマンドを実行します。</p><pre class="programlisting">INSERT INTO tiger.loader_platform(os, declare_sect, pgbin, wget, unzip_command, psql, path_sep,
                   loader, environ_set_command, county_process_command)
SELECT 'debbie', declare_sect, pgbin, wget, unzip_command, psql, path_sep,
           loader, environ_set_command, county_process_command
  FROM tiger.loader_platform
  WHERE os = 'sh';</pre><p>それから、<span class="emphasis"><em>declare_sect</em></span>カラム内のパスを編集して、Debbieのpg, unzip, shp2pgsql, psql他のパス位置に適応するようにします。</p><p><code class="varname">loader_platform</code>テーブルを編集しない場合は、一般的なアイテムの位置を持っているので、スクリプトが生成された後で、スクリプトを編集しなければなりません。</p></li><li class="listitem"><p>PostGIS 2.4.1からは、<code class="varname">ZTCA5</code> (Zip Code 5 digit Tabulation Area)のロード手順が変更され、有効になった時に<a class="xref" href="#Loader_Generate_Nation_Script" title="Loader_Generate_Nation_Script">Loader_Generate_Nation_Script</a>の一部として現在のZCTA5データをロードするようになりました。デフォルトでは切られています。ロードにかなりの時間 (20から60分)が取られ、かなりのディスクスペースを占有するのに、そんなに頻繁には使わないためです。</p><p>有効にするには、次のようにします。</p><pre class="programlisting">UPDATE tiger.loader_lookuptables SET load = true WHERE table_name = 'zcta510';</pre><p>境界のフィルタが追加され、ちょうど境界内のZIPに制限された場合に、<a class="xref" href="#Geocode" title="Geocode">Geocode</a>関数は、ZCTA5が存在するなら使います。<a class="xref" href="#Reverse_Geocode" title="Reverse_Geocode">Reverse_Geocode</a>関数は、返された住所にZIPコードが無い場合に (しばしば高速道路での逆ジオコーディングで発生します)、これを使います。</p></li><li class="listitem"><p>サーバまたはローカル (サーバへのネットワーク接続が早い場合)のルートに<code class="filename">gisdata</code>というフォルダを作成します。このフォルダはTigerファイルがダウンロードされ、処理される場所です。サーバのルートにフォルダを作ると不幸になる場合や、単に他のフォルダに移したい場合には、<code class="varname">tiger.loader_variables</code>テーブルの<code class="varname">staging_fold</code>フィールドを編集します。</p></li><li class="listitem"><p><code class="filename">gisdata</code>フォルダ内にtempというフォルダを作成します。もしくは、<code class="varname">staging_fold</code>で示されたフォルダを作成します。ローダがダウンロードしたTigerデータを展開する場所です。</p></li><li class="listitem"><p>そして、SQL関数<a class="xref" href="#Loader_Generate_Nation_Script" title="Loader_Generate_Nation_Script">Loader_Generate_Nation_Script</a>を実行して、独自のプロファイルの名前を使うか確認し、.shまたは.batファイルにスクリプトを複写します。たとえば、新しいプロファイルで国のロードを行う場合には、次のようにします。</p><pre class="programlisting">psql -c "SELECT Loader_Generate_Nation_Script('debbie')" -d geocoder -tA 
&gt; /gisdata/nation_script_load.sh</pre></li><li class="listitem"><p>生成された国データをロードするコマンドラインスクリプトを実行します。</p><pre class="programlisting">cd /gisdata
sh nation_script_load.sh</pre></li><li class="listitem"><p>国スクリプトを実行した後、<code class="code">tiger_data</code>スキーマに三つのテーブルが作られ、データが格納されています。次のクエリをpsqlかpgAdminから実行して、確認します。</p><pre class="programlisting">SELECT count(*) FROM tiger_data.county_all;</pre><pre class="screen">count
-------
  3233
(1 row)</pre><pre class="programlisting">SELECT count(*) FROM tiger_data.state_all;</pre><pre class="screen">count
-------
    56
(1 row)
</pre></li><li class="listitem"><p>デフォルトでは<code class="varname">bg</code>, <code class="varname">tract</code>, <code class="varname">tabblock</code>に対応するテーブルはロードされません。ジオコーダはこれらのテーブルを使いませんが、一般に、人口統計に使います。州データのロードの一部としてロードするには、次の手続きを実行して有効にします。</p><pre class="programlisting">UPDATE tiger.loader_lookuptables SET load = true WHERE load = false AND lookup_name IN('tract', 'bg', 'tabblock');</pre><p>もしくは、<a class="xref" href="#Loader_Generate_Census_Script" title="Loader_Generate_Census_Script">Loader_Generate_Census_Script</a>を使って州のデータをロードした後に、これらのテーブルだけをロードできます。</p></li><li class="listitem"><p>データをロードしたい州ごとに、<a class="xref" href="#Loader_Generate_Script" title="Loader_Generate_Script">Loader_Generate_Script</a>で州スクリプトを作ります。</p><div class="warning"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>国データのロードを完了する前に*州スクリプトを作ってはなりません*。州スクリプトは国スクリプトでロードされる国リストを利用するためです。</p></td></tr></table></div></li><li class="listitem"><pre class="programlisting">psql -c "SELECT Loader_Generate_Script(ARRAY['MA'], 'debbie')" -d geocoder -tA 
&gt; /gisdata/ma_load.sh</pre></li><li class="listitem"><p>生成されたコマンドラインスクリプトを実行します。</p><pre class="programlisting">cd /gisdata
sh ma_load.sh</pre></li><li class="listitem"><p>全てのデータのロードが完了するか中断ポイントに達した後に、全てのtigerテーブルに対してanalyzeを実行して、(継承されたものも含めて)状態を更新するのは良いことです。</p><pre class="programlisting">SELECT install_missing_indexes();
vacuum (analyze, verbose) tiger.addr;
vacuum (analyze, verbose) tiger.edges;
vacuum (analyze, verbose) tiger.faces;
vacuum (analyze, verbose) tiger.featnames;
vacuum (analyze, verbose) tiger.place;
vacuum (analyze, verbose) tiger.cousub;
vacuum (analyze, verbose) tiger.county;
vacuum (analyze, verbose) tiger.state;
vacuum (analyze, verbose) tiger.zip_lookup_base;
vacuum (analyze, verbose) tiger.zip_state;
vacuum (analyze, verbose) tiger.zip_state_loc;</pre></li></ol></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="convert_tiger_geocoder_extension"></a>2.4.1.1. Tigerジオコーダ通常インストールのエクステンションモデルへの変換</h4></div></div></div><p>エクステンションモデルを使わずにTigerジオコーダをインストールしている場合に、次のようにして、エクステンションモデルに変換できます。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><a class="xref" href="#upgrade_tiger_geocoder" title="2.4.5. Tigerジオコーダのアップグレード">「Tigerジオコーダのアップグレード」</a>の指示に従って非エクステンションモデルのアップグレードを行います。</p></li><li class="listitem"><p>psqlまたはpgAdminでデータベースに接続して、次のコマンドを実行します。</p><pre class="programlisting">CREATE EXTENSION postgis_tiger_geocoder FROM unpackaged;</pre></li></ol></div></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="install_tiger_geocoder"></a>2.4.2. TigerジオコーダをPostGISデータベースで有効にする: エクステンション不使用</h3></div></div></div><p>まず、上述の手順でPostGISをインストールします。 </p><p>extrasフォルダが無い場合、<a class="ulink" href="http://download.osgeo.org/postgis/source/postgis-3.2.0.tar.gz" target="_top">http://download.osgeo.org/postgis/source/postgis-3.2.0.tar.gz</a>をダウンロードします。 </p><p>
		  <span class="command"><strong>tar xvfz postgis-3.2.0.tar.gz</strong></span>
		</p><p>
		  <span class="command"><strong>cd postgis-3.2.0/extras/tiger_geocoder</strong></span>
		</p><p><code class="filename">tiger_loader_2015.sql</code> (違う年のものをロードしたくないならば最新のローダファイル)をあなたの実行サーバ等のパスに編集します。もしくは<code class="varname">loader_platform</code>がインストールされた後に一度これを更新します。このファイルも<code class="varname">loader_platform</code>も編集しない場合には、一般的なアイテムの位置を持っているだけなので、<a class="xref" href="#Loader_Generate_Nation_Script" title="Loader_Generate_Nation_Script">Loader_Generate_Nation_Script</a>と<a class="xref" href="#Loader_Generate_Script" title="Loader_Generate_Script">Loader_Generate_Script</a>を実行した後に、生成されたスクリプトを編集しなければなりません。 </p><p>初めてTigerジオコーダをインストールする場合は、Windowsでは<code class="filename">create_geocode.bat</code>を、またLinux/Unix/Mac OSXでは<code class="filename">create_geocode.sh</code>を、使用するPostgreSQLにとって独自の設定に変更したうえで、コマンドラインから対応するスクリプトを実行します。 </p><p>データベースに<code class="varname">tiger</code>スキーマがあることを確認します。もし無い場合は、次の行を参考に、コマンドを実行します。 </p><pre class="programlisting">ALTER DATABASE geocoder SET search_path=public, tiger;</pre><p>住所正規化機能は、トリッキーな住所を除いて、大体データなしで動作します。テストを実行して次のように見えることを確認して下さい。 </p><pre class="programlisting">SELECT pprint_addy(normalize_address('202 East Fremont Street, Las Vegas, Nevada 89101')) As pretty_address;
pretty_address
---------------------------------------
202 E Fremont St, Las Vegas, NV 89101
                        </pre><p>
		</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="tiger_pagc_address_standardizing"></a>2.4.3. TigerジオコーダをPostGISデータベースで有効にする: エクステンションを使用</h3></div></div></div><p>皆さんが問題と思われるの多くのことのひとつに、ジオコーディング前の準備に住所を正規化する関数<a class="xref" href="#Normalize_Address" title="Normalize_Address">Normalize_Address</a>があります。住所正規化は万全と言うにはほど遠く、パッチをあてようとすると膨大な資源を費やします。よって、より良い住所標準化エンジンを持つ他のプロジェクトに統合しました。この新しい住所標準化を使うには、<a class="xref" href="#installing_pagc_address_standardizer" title="2.3. PAGC住所標準化ツールのインストールと使用">「PAGC住所標準化ツールのインストールと使用」</a>で記述するようにエクステンションをコンパイルし、使用するデータベースにインストールします。</p><p>このエクステンションを<code class="code">postgis_tiger_geocoder</code>をインストールしているデータベースにインストールすると、<a class="xref" href="#Pagc_Normalize_Address" title="Pagc_Normalize_Address文字列のストリート住所を与えると、道路後置辞、前置辞、標準タイプ、番地、ストリート名等を複数フィールドに分解して持つnorm_addy複合型を返します。この関数は、tiger_geocoder同梱のルックアップテーブルだけを使います (Tigerデータは不要です)。住所標準化エクステンションが必要です。">Pagc_Normalize_Address文字列のストリート住所を与えると、道路後置辞、前置辞、標準タイプ、番地、ストリート名等を複数フィールドに分解して持つ<code class="varname">norm_addy</code>複合型を返します。この関数は、tiger_geocoder同梱のルックアップテーブルだけを使います (Tigerデータは不要です)。住所標準化エクステンションが必要です。</a>を、<a class="xref" href="#Normalize_Address" title="Normalize_Address">Normalize_Address</a>の代わりに使うことができます。このエクステンションはTigerジオコーダからは見えないので、国際的な住所といった他のデータソースでも使えます。Tigerジオコーダエクステンションは、その版の<a class="xref" href="#rulestab" title="規則テーブル">規則テーブル</a> (<code class="code">tiger.pagc_rules</code>), <a class="xref" href="#gaztab" title="gaz table">gaz table</a> (<code class="code">tiger.pagc_gaz</code>), <a class="xref" href="#lextab" title="lexテーブル">lexテーブル</a> (<code class="code">tiger.pagc_lex</code>)を同梱しています。これらは、必要に応じて標準化の改善のために追加や更新ができます。</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="tiger_geocoder_loading_data"></a>2.4.4. Tigerデータのロード</h3></div></div></div><p>データロードの説明の詳細は<code class="filename">extras/tiger_geocoder/tiger_2011/README</code>にあります。これは一般的な手順を示しています。</p><p>ロードプロセスによって、米センサスウェブサイトから個々の国ファイル、リクエストされた州のデータをダウンロードし、ファイルを展開し、個別の州をそれぞれの州テーブルの集合にロードします。各州のテーブルは、<code class="varname">tiger</code>スキーマで定義されたテーブルを継承しているので、これらのテーブルに対して全てのデータにアクセスするためのクエリを出すことができますし、州の再読み込みが必要となったり、州が必要ない場合には、<a class="xref" href="#Drop_State_Tables_Generate_Script" title="Drop_State_Tables_Generate_Script">Drop_State_Tables_Generate_Script</a>で、いつでも州テーブルの集合を削除するクエリを出すことができます。</p><p>データのロードを可能にするためには次のツールが必要です。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>センサスウェブサイトから取得するZIPファイルを展開するツール。</p><p>Unix系システムでは、<code class="varname">unzip</code>実行ファイルです。通常は、ほとんどのUnix系プラットフォームで既にインストールされています。</p><p>Windowsでは7-zipです。<a class="ulink" href="http://www.7-zip.org/" target="_top">http://www.7-zip.org/</a>からダウンロードできる無償の圧縮解答ツールです。 </p></li><li class="listitem"><p><code class="filename">shp2pgsql</code>コマンド。PostGISインストール時にデフォルトでインストールされます。</p></li><li class="listitem"><p><code class="filename">wget</code>コマンド。通常はほとんどのUnix/Linuxシステムにインストールされている、ウェブ取得ツールです。</p><p>Windows用については、コンパイル済みのバイナリを<a class="ulink" href="http://gnuwin32.sourceforge.net/packages/wget.htm" target="_top">http://gnuwin32.sourceforge.net/packages/wget.htm</a>から取得できます。 </p></li></ul></div><p>tiger_2010からアップグレードする場合には、最初に<a class="xref" href="#Drop_Nation_Tables_Generate_Script" title="Drop_Nation_Tables_Generate_Script">Drop_Nation_Tables_Generate_Script</a>を生成、実行する必要があります。州データをロードする前に、<a class="xref" href="#Loader_Generate_Nation_Script" title="Loader_Generate_Nation_Script">Loader_Generate_Nation_Script</a>で国データをロードする必要があります。これによって、環境に合ったローダスクリプトが生成されます。<a class="xref" href="#Loader_Generate_Nation_Script" title="Loader_Generate_Nation_Script">Loader_Generate_Nation_Script</a>は、一度の操作で、(2010からの)アップグレードと、新しいインストールが行われます。</p><p>州データをロードするには、<a class="xref" href="#Loader_Generate_Script" title="Loader_Generate_Script">Loader_Generate_Script</a>を参照して、手持ちのプラットフォームで動作する、求める州データをロードするデータロードスクリプトを生成します。州データはひとつずつダウンロードできることに注意して下さい。一度に必要な州の全てについてデータをロードする必要はありません。必要なだけダウンロードできます。</p><p>求める州データをロードした後は、<a class="xref" href="#Install_Missing_Indexes" title="Install_Missing_Indexes">Install_Missing_Indexes</a>に示すように、</p><pre class="programlisting">SELECT install_missing_indexes();</pre><p>を実行するようにして下さい。</p><p>行うべきことができたかをテストするために、<a class="xref" href="#Geocode" title="Geocode">Geocode</a>を使用する州の中の住所についてジオコーダを実行してみます。 </p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="upgrade_tiger_geocoder"></a>2.4.5. Tigerジオコーダのアップグレード</h3></div></div></div><p>2.0以上に含まれるTigerジオコーダがインストールされている場合には、どうしても必要な訂正があるときは、いつでも臨時のアーカイブファイルからでも機能のアップグレードができます。 これは、エクステンションでインストールされていないTigerジオコーダで動作します。 </p><p>extrasフォルダが無い場合、<a class="ulink" href="http://download.osgeo.org/postgis/source/postgis-3.2.0.tar.gz" target="_top">http://download.osgeo.org/postgis/source/postgis-3.2.0.tar.gz</a>をダウンロードします。 </p><p>
		  <span class="command"><strong>tar xvfz postgis-3.2.0.tar.gz</strong></span>
		</p><p>
		  <span class="command"><strong>cd postgis-3.2.0/extras/tiger_geocoder/tiger_2011</strong></span>
		</p><p>Windowsの場合は<code class="filename">upgrade_geocoder.bat</code>スクリプト、Linux/Unix/MacOS Xの場合は<code class="filename">upgrade_geocoder.sh</code>スクリプトの位置を特定します。 PostGISデータベースの資格情報を持つように編集します。</p><p>2010または2011からアップグレードする場合には、確実にローダスクリプトのコメントアウトを消すと、2012データのロードのための最新のスクリプトを得ます。</p><p>対応するスクリプトをコマンドラインから実行します。 </p><p>次に、全ての国テーブルを削除し、新しい国テーブルをロードします。<a class="xref" href="#Drop_Nation_Tables_Generate_Script" title="Drop_Nation_Tables_Generate_Script">Drop_Nation_Tables_Generate_Script</a>に詳細がある通り、このSQLステートメントを使った削除スクリプトを生成します。</p><pre class="programlisting">SELECT drop_nation_tables_generate_script();</pre><p>生成した削除SQLステートメントを実行します。</p><p><a class="xref" href="#Loader_Generate_Nation_Script" title="Loader_Generate_Nation_Script">Loader_Generate_Nation_Script</a>に詳細がある通り、このSELECTステートメントを使った削除スクリプトを生成します。</p><p><span class="bold"><strong>Windows向け</strong></span></p><pre class="programlisting">SELECT loader_generate_nation_script('windows'); </pre><p><span class="bold"><strong>Unix/Linux向け</strong></span></p><pre class="programlisting">SELECT loader_generate_nation_script('sh');</pre><p>生成したスクリプトの実行方法に関する説明は、<a class="xref" href="#tiger_geocoder_loading_data" title="2.4.4. Tigerデータのロード">「Tigerデータのロード」</a>を参照して下さい。これは一度だけ実行する必要があります。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>2010/2011州テーブルを混在させることができ、それぞれの州について個別にアップグレードできます。2011にアップグレードする前に、まず、<a class="xref" href="#Drop_State_Tables_Generate_Script" title="Drop_State_Tables_Generate_Script">Drop_State_Tables_Generate_Script</a>を使って、2010州テーブルを削除します。</p></td></tr></table></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp50198528"></a>2.5. 共通の問題</h2></div></div></div><p>インストールやアップグレードが思うようにいかない時にチェックすることがいくつかあります。 </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>PostgreSQL 9.6以上をインストールしているか、実行中のPostgreSQLと同じ版のソースでコンパイルしているか、をチェックします。(Linuxの)ディストリビューションによって既にPostgreSQLがインストールされている時や、 PostgreSQLを以前にインストールして忘れた場合に、 混乱が発生することがあります。PostGISはPostgreSQL 9.6以上で動作します。古い版のものを使った場合には、おかしな予想外のエラーメッセージが表示されます。実行中のPostgreSQLの版をチェックするには、psqlを使ってデータベースを接続して、次のクエリを実行して下さい。 </p><pre class="programlisting">SELECT version();</pre><p>RPMベースのディストリビューションを実行している場合、 プリインストールされたパッケージが存在するかのチェックは、<span class="command"><strong>rpm</strong></span> コマンドを使って<span class="command"><strong>rpm -qa | grep postgresql</strong></span>でチェックできます。 </p></li><li class="listitem"><p>アップグレードに失敗する場合、既にPostGISがインストールされているデータベースにリストアしているか確認して下さい。</p><pre class="programlisting">SELECT postgis_full_version();</pre></li></ol></div><p>また、コンフィギュアが正しくPostgreSQL、Projライブラリ、GEOSライブラリのインストール先を検出したかチェックして下さい。 </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>コンフィギュアからの出力で<code class="filename">postgis_config.h</code>ファイルが作られます。<code class="varname">POSTGIS_PGSQL_VERSION</code>、<code class="varname">POSTGIS_PROJ_VERSION</code>および<code class="varname">POSTGIS_GEOS_VERSION</code>変数が正しくセットされたかをチェックして下さい。 </p></li></ol></div></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="postgis_administration"></a>第3章 PostGIS管理</h1></div></div></div><div class="toc"><div class="toc-title">目次</div><dl class="toc"><dt><span class="sect1"><a href="#database_tuning_configuration">3.1. パフォーマンスチューニング</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp50591104">3.1.1. 起動時</a></span></dt><dt><span class="sect2"><a href="#idp50600960">3.1.2. 実行時</a></span></dt></dl></dd><dt><span class="sect1"><a href="#raster_configuration">3.2. ラスタ機能の設定</a></span></dt><dt><span class="sect1"><a href="#create_spatial_db">3.3. 空間テーブルの作成</a></span></dt><dd><dl><dt><span class="sect2"><a href="#create_new_db_extensions">3.3.1. エクステンションを使って空間データベースを有効にする</a></span></dt><dt><span class="sect2"><a href="#create_new_db">3.3.2. エクステンションを使わずに空間データベースを有効にする (非推奨)</a></span></dt><dt><span class="sect2"><a href="#templatepostgis">3.3.3. 空間データベースをテンプレートから生成する</a></span></dt></dl></dd><dt><span class="sect1"><a href="#upgrading">3.4. 空間データベースのアップグレード</a></span></dt><dd><dl><dt><span class="sect2"><a href="#soft_upgrade">3.4.1. ソフトアップグレード </a></span></dt><dt><span class="sect2"><a href="#hard_upgrade">3.4.2. ハードアップグレード</a></span></dt></dl></dd></dl></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="database_tuning_configuration"></a>3.1. パフォーマンスチューニング</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="#idp50591104">3.1.1. 起動時</a></span></dt><dt><span class="sect2"><a href="#idp50600960">3.1.2. 実行時</a></span></dt></dl></div><p>PostGISの調整はPostgreSQLの作業量の調整と非常に似ています。ジオメトリとラスタは重く、メモリ関連の最適化は他のPostgreSQLクエリと比べて影響が大きい点だけは留意して下さい。</p><p>PostgreSQLの最適化に関する一般的な詳細は、<a class="ulink" href="https://wiki.postgresql.org/wiki/Tuning_Your_PostgreSQL_Server" target="_top">Tuning your PostgreSQL Server</a>をご覧ください。</p><p>PostgreSQL 9.4以上では、<code class="code">ALTER SYSTEM</code>を使うことで、<code class="code">postgresql.conf</code>や<code class="code">postgresql.auto.conf</code>を触ることなくサーバレベルで設定できます。</p><pre class="programlisting">ALTER SYSTEM SET work_mem = '256MB';
-- 起動時設定でない設定を強制します。新規接続に影響を与えます。
SELECT pg_reload_conf();
-- 現在の設定値を表示
-- 全ての設定を見るにはSHOW ALLを使います
SHOW work_mem;</pre><p>PostgreSQLの設定に加えて、PostGISには<a class="xref" href="#PostGIS_GUC" title="8.2. Grand Unified Custom変数 (GUC)">「Grand Unified Custom変数 (GUC)」</a>で挙げる独自設定があります。</p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idp50591104"></a>3.1.1. 起動時</h3></div></div></div><p>次に示す設定は<code class="code">postgresql.conf</code>にあります。 </p><p>
         <a class="ulink" href="http://www.postgresql.org/docs/current/static/runtime-config-query.html#GUC-CONSTRAINT-EXCLUSION" target="_top">constraint_exclusion</a>
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>デフォルト: partition </p></li><li class="listitem"><p>一般的にテーブルのパーティショニングに使われます。デフォルトとして"partition"に設定されています。継承階層内にあり、プランナにペナルティ以外を払わないなら、クエリプランナにテーブルの制約条件の解析だけを行わせるので、PostgreSQL 8.4以上ではこれが理想的です。 </p></li></ul></div><p>
         <a class="ulink" href="http://www.postgresql.org/docs/current/static/runtime-config-resource.html#GUC-SHARED-BUFFERS" target="_top">shared_buffers</a>
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>デフォルト: PostgreSQL 9.6では128MB以下 </p></li><li class="listitem"><p>利用可能なRAMの25%から40%を設定します。Windowsでは高く設定することができないかも知れません。 </p></li></ul></div><p><a class="ulink" href="https://www.postgresql.org/docs/current/static/runtime-config-resource.html#GUC-MAX-WORKER-PROCESSES" target="_top">max_worker_processes</a> これは、PostgreSQL 9.4以上で有効です。PostgreSQL 9.6以上では、パラレルクエリ処理に使うプロセス数の最大値の制御で、さらに重要なものとなっています。 </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>デフォルト: 8 </p></li><li class="listitem"><p>システムが対応できるバックグラウンドプロセスの最大値を設定します。このパラメータはサーバ起動時のみ設定できます。 </p></li></ul></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idp50600960"></a>3.1.2. 実行時</h3></div></div></div><p><a class="ulink" href="http://www.postgresql.org/docs/current/static/runtime-config-resource.html#GUC-WORK-MEM" target="_top">work_mem</a> - 並べ替えや複雑なクエリに使われるメモリのサイズの設定 </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>デフォルト: 1-4MB </p></li><li class="listitem"><p>大きなデータベースの場合や、複雑なクエリの場合、RAMが多い場合は値を大きくするように調整します。 </p></li><li class="listitem"><p>同時接続ユーザ数が多い場合や、RAMが少ない場合には値を小さくするように調整します。 </p></li><li class="listitem"><p>たくさんのRAMを持ち、少数の開発者しかいない場合は次のようにします。 </p><pre class="programlisting">SET work_mem TO '256MB';</pre><p>
          </p></li></ul></div><p><a class="ulink" href="http://www.postgresql.org/docs/current/static/runtime-config-resource.html#GUC-MAINTENANCE-WORK-MEM" target="_top">maintenance_work_mem</a> - VACUUM, CREATE INDEX等で使われるメモリのサイズ </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>デフォルト: 16-64MB </p></li><li class="listitem"><p>一般的には低すぎます - メモリスワップの間、入出力が拘束され、オブジェクトがロックされます。 </p></li><li class="listitem"><p>たくさんのRAMを持つ本番サーバでは32MBから1GBが推奨ですが、同時接続ユーザ数に依存します。たくさんのRAMを持ち、少数の開発者しかいない場合は次のようにします。 </p><pre class="programlisting">SET maintenance_work_mem TO '1GB';</pre><p>
          </p></li></ul></div><p>
        <a class="ulink" href="https://www.postgresql.org/docs/current/static/runtime-config-resource.html#GUC-MAX-PARALLEL-WORKERS-PER-GATHER" target="_top">max_parallel_workers_per_gather</a>
      </p><p>この設定はPostgreSQL 9.6以上で使用でき、並列クエリに対応しているPostGIS 2.3以上に影響は限られます。0より大きい値に設定すると、<code class="code">ST_Intersects</code>といった関係関数を含むクエリで、複数プロセッサが使われるようにできます。その時、2倍を超える速度が出る可能性があります。予備のプロセッサが多数ある場合には、この値をプロセッサ数に変更するべきです。また、<code class="code">max_worker_processes</code>をこの値と同じにするようにします。 </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>デフォルト: 0 </p></li><li class="listitem"><p>単一の<code class="varname">Gather</code>ノードが開始できるワーカの最大数を設定します。並列ワーカは、<code class="varname">max_worker_processes</code>で確立されたプロセスのプールから取得されます。要求したワーカ数は、実際には実行可能になっていない場合があることに注意して下さい。これが発生する場合には、想定より少ないワーカでプランが実行され、非効率になります。これの値を0 (デフォルト値)にすると、パラレルクエリ実行が無効になります。 </p></li></ul></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="raster_configuration"></a>3.2. ラスタ機能の設定</h2></div></div></div><p>ラスタ機能を有効にしたら、下に示す確実な設定方法を読んだ方がいいです。 </p><p>PostGIS 2.1.3以降では、データベース外ラスタと全てのラスタドライバは、デフォルトでは無効になっています。これらを有効にするには、サーバ上で、環境変数<code class="varname">POSTGIS_GDAL_ENABLED_DRIVERS</code>と<code class="varname">POSTGIS_ENABLE_OUTDB_RASTERS</code>を設定します。PostGIS 2.2では、<a class="xref" href="#PostGIS_GUC" title="8.2. Grand Unified Custom変数 (GUC)">「Grand Unified Custom変数 (GUC)」</a>に従って設定する、クロスプラットフォームな手法があります。</p><p>データベース外ラスタを有効にするには次のようにします。</p><pre class="programlisting">POSTGIS_ENABLE_OUTDB_RASTERS=1</pre><p>他の値を入れたり、値を入れない場合には、データベース外ラスタは無効になります。</p><p>インストールしたGDALのドライバを有効にするには、次の環境変数を設定します。</p><pre class="programlisting">POSTGIS_GDAL_ENABLED_DRIVERS=ENABLE_ALL</pre><p>一部のドライバのみ有効にしたい場合には、環境変数を次のように設定します。</p><pre class="programlisting">POSTGIS_GDAL_ENABLED_DRIVERS="GTiff PNG JPEG GIF XYZ"</pre><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Windows上の場合は、ドライバリストに引用符をつけないで下さい。</p></td></tr></table></div><p>環境変数の設定はOSによって異なります。UbuntuまたはDebian上でapt-postgresqlを経由したPostgreSQLのインストールについては、<code class="filename">/etc/postgresql/<em class="replaceable"><code>10</code></em>/<em class="replaceable"><code>main</code></em>/environment</code>を編集するのが好ましい方法です。 ここで、10はPostgreSQLのバージョンを指し、mainはクラスタを指します。</p><p>Windowsでサービスとして実行している場合には、システム変数で設定します。Windows 7では、コンピュータを右クリックしてプロパティをクリックするか、エクスプローラの検索バーに<code class="varname">コントロール パネル\すべてのコントロール パネル項目\システム</code>を指定します。<span class="emphasis"><em>システムの詳細設定 -&gt; 詳細設定 -&gt; 環境変数</em></span>を順にクリックして、新しいシステム環境変数を追加します。</p><p>環境変数を設定した後は、設定を反映させるために、PostgreSQLサービスの再起動が必要です。</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="create_spatial_db"></a>3.3. 空間テーブルの作成</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="#create_new_db_extensions">3.3.1. エクステンションを使って空間データベースを有効にする</a></span></dt><dt><span class="sect2"><a href="#create_new_db">3.3.2. エクステンションを使わずに空間データベースを有効にする (非推奨)</a></span></dt><dt><span class="sect2"><a href="#templatepostgis">3.3.3. 空間データベースをテンプレートから生成する</a></span></dt></dl></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="create_new_db_extensions"></a>3.3.1. エクステンションを使って空間データベースを有効にする</h3></div></div></div><p>PostgreSQL 9.1以上を使っていて、エクステンションのPostGISモジュールをコンパイル、インストールしている場合には、エクステンションというメカニズムを使用して、データベースを空間データベースに切り替えることができます。 </p><p>中核となるPostGISエクステンションには、ジオメトリ、ジオグラフィ、spatial_ref_sysおよび全ての関数とコメントが含まれています。ラスタとトポロジは別のエクステンションになっています。 </p><p>空間データベースにしたいデータベース上で次のSQLを実行します。 </p><pre class="programlisting">CREATE EXTENSION IF NOT EXISTS plpgsql;
      CREATE EXTENSION postgis;
      CREATE EXTENSION postgis_raster; -- OPTIONAL
      CREATE EXTENSION postgis_topology; -- OPTIONAL
</pre><p>
	</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="create_new_db"></a>3.3.2. エクステンションを使わずに空間データベースを有効にする (非推奨)</h3></div></div></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これは、通常はPostgreSQLのエクステンションのディレクトリ内にPostGISをインストールできないか、したくない場合 (たとえばテスト中や開発中、または制限のある環境内)にのみ必要となります。</p></td></tr></table></div><p>ビルドの際に指定した<code class="filename">[prefix]/share/contrib</code>内にある様々なSQLファイルをロードしてPostGISオブジェクトと関数の定義をデータベースに追加します。 </p><p>中核のPostGISオブジェクト (ジオメトリ型とジオグラフィ型、これらに対応する関数)は<code class="filename">postgis.sql</code>スクリプトにあります。ラスタオブジェクトは<code class="filename">rtpostgis.sql</code>スクリプトにあります。トポロジオブジェクトは<code class="filename">topology.sql</code>スクリプトにあります。 </p><p>完全なEPSG座標系定義IDセットについては、<code class="filename">spatial_ref_sys.sql</code>定義ファイルをロードして<code class="varname">spatial_ref_sys</code>テーブルを生成して下さい。これによりジオメトリ関数ST_Transform()が実行できるようになります。 </p><p>PostGIS関数にコメントを追加したい場合には、<code class="filename">postgis_comments.sql</code>スクリプト内のコメントが見つかると思います。コメントは<span class="command"><strong>psql</strong></span>のターミナルウィンドウから単に<span class="command"><strong>\dd [関数名]</strong></span>と打ち込むだけで見ることができます。 </p><p>ターミナルで次のシェルコマンドを実行します。 </p><pre class="programlisting">DB=[データベース名]
    SCRIPTSDIR=`pg_config --sharedir`/contrib/postgis-3.1/

    # Core objects
    psql -d ${DB} -f ${SCRIPTSDIR}/postgis.sql
    psql -d ${DB} -f ${SCRIPTSDIR}/spatial_ref_sys.sql
    psql -d ${DB} -f ${SCRIPTSDIR}/postgis_comments.sql # OPTIONAL

    # Raster support (OPTIONAL)
    psql -d ${DB} -f ${SCRIPTSDIR}/rtpostgis.sql
    psql -d ${DB} -f ${SCRIPTSDIR}/raster_comments.sql # OPTIONAL

    # Topology support (OPTIONAL)
    psql -d ${DB} -f ${SCRIPTSDIR}/topology.sql
    psql -d ${DB} -f ${SCRIPTSDIR}/topology_comments.sql # OPTIONAL
</pre><p>
  </p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="templatepostgis"></a>3.3.3. 空間データベースをテンプレートから生成する</h3></div></div></div><p>PostGISのディストリビューション (特にPostGIS &gt;= 1.1.5のWin32インストーラ)の中には、<code class="varname">template_postgis</code>というテンプレートにPostGIS関数をロードしていることがあります。PostgreSQLに<code class="varname">template_postgis</code>データベースが存在するなら、ユーザやアプリケーションは、空間データベースの生成をコマンドひとつで済ませられます。この2種類のやり方のどちらを使うににしても、データベースユーザは、新しいデータベースを作成する権限を与えられている必要があります。 </p><p>シェルからの実行は次の通りです。 </p><pre class="programlisting"># createdb -T template_postgis my_spatial_db</pre><p>SQLからの実行は次の通りです。 </p><pre class="programlisting">postgres=# CREATE DATABASE my_spatial_db TEMPLATE=template_postgis</pre></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="upgrading"></a>3.4. 空間データベースのアップグレード</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="#soft_upgrade">3.4.1. ソフトアップグレード </a></span></dt><dt><span class="sect2"><a href="#hard_upgrade">3.4.2. ハードアップグレード</a></span></dt></dl></div><p>既存の空間データベースのアップグレードは、新しいPostGISオブジェクト定義の置き換えや導入を必要とするとき、慎重を要することがあります。 </p><p>不幸なことに、定義の全てが実行中のデータベース内で簡単には置き換えられるわけではないので、ダンプ/リロードが最善策となることがあります。 </p><p>PostGISには、マイナーバージョンアップやバグフィクスリリースの場合に使うソフトアップグレードと、メジャーアップグレードで使うハードアップグレードが用意されています。 </p><p>PostGISをアップグレードしようとする前にデータのバックアップを取ることは、常に価値のあるものです。pg_dumpで -Fc フラグを使うと、ハードアップグレードによってダンプを常にリストアすることができます。 </p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="soft_upgrade"></a>3.4.1. ソフトアップグレード </h3></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect3"><a href="#soft_upgrade_sql_script">3.4.1.1. 9.1より前またはエクステンションを使わないソフトアップグレード</a></span></dt><dt><span class="sect3"><a href="#soft_upgrade_extensions">3.4.1.2. 9.1以上でエクステンションを使ったソフトアップグレード</a></span></dt></dl></div><p>エクステンションを使ってインストールした場合は、エクステンションモデルでアップグレードしなければなりません。 古いSQLスクリプトを使ってインストールした場合は、SQLスクリプトでアップグレードすべきです。適切な方を参照して下さい。</p><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="soft_upgrade_sql_script"></a>3.4.1.1. 9.1より前またはエクステンションを使わないソフトアップグレード</h4></div></div></div><p>PostGISをエクステンションを使わずにインストールした人向けです。エクステンションを使っていてこの方法を使うと、次のようなメッセージが現れます。</p><pre class="programlisting">can't drop ... because postgis extension depends on it</pre><p>ご注意: PostGIS 1.*またはr7429以前のPostGIS 2.*へ移行する場合には、この手続きを使うことができませんが、<a class="link" href="#hard_upgrade" title="3.4.2. ハードアップグレード">HARD UPGRADE</a>を実行する必要があります。 </p><p>コンパイルとインストール (make install)の実行後に、インストール先フォルダ内にある<code class="filename">*_upgrade.sql</code>のファイルの集合を見つけておくべきです。次のコマンドで一覧を得られます。 </p><pre class="programlisting">ls `pg_config --sharedir`/contrib/postgis-3.2.0/*_upgrade.sql</pre><p><code class="filename">postgis_upgrade.sql</code>から順番に全てをロードします。 </p><pre class="programlisting">psql -f postgis_upgrade.sql -d [データベース名]</pre><p>同じ手続きをラスタ、トポロジ、SFCGALエクステンションに適用します。それぞれのファイル名は<code class="filename">rtpostgis_upgrade.sql</code>, <code class="filename">topology_upgrade.sql</code>, <code class="filename">sfcgal_upgrade.sql</code>になります。次のように実行します。 </p><pre class="programlisting">psql -f rtpostgis_upgrade.sql -d [データベース名]</pre><pre class="programlisting">psql -f topology_upgrade.sql -d [データベース名]</pre><pre class="programlisting">psql -f sfcgal_upgrade.sql -d [データベース名]</pre><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>求める版へのアップグレードに使う特定の<code class="filename">postgis_upgrade.sql</code>が発見できない場合には、ソフトアップグレードを実行するにはあまりに前の版を使っています。<a class="link" href="#hard_upgrade" title="3.4.2. ハードアップグレード">ハードアップグレード</a>が必要です。 </p></td></tr></table></div><p><a class="xref" href="#">???</a>関数の"procs need upgrade"というメッセージで、この種のアップグレードを実行する必要性についての情報が得られます。 </p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="soft_upgrade_extensions"></a>3.4.1.2. 9.1以上でエクステンションを使ったソフトアップグレード</h4></div></div></div><p>エクステンションを使ってPostGISをインストールした場合には、エクステンションを使ってアップグレードする必要があります。エクステンションを使ったマイナーアップグレードはかなり楽です。</p><pre class="programlisting">ALTER EXTENSION postgis UPDATE TO "3.2.0";
ALTER EXTENSION postgis_topology UPDATE TO "3.2.0";</pre><p>次のようなエラー通知が表示されることがあります。</p><pre class="programlisting">No migration path defined for ... to 3.2.0</pre><p>この場合は、データベースをバックアップして、<a class="xref" href="#create_new_db_extensions" title="3.3.1. エクステンションを使って空間データベースを有効にする">「エクステンションを使って空間データベースを有効にする」</a>に記述されているように新しいデータベースを生成し、バックアップを新しいデータベースにリストアしなければなりません。</p><p>次のようなメッセージを得ることがあります。</p><pre class="programlisting">Version "3.2.0" of extension "postgis" is already installed</pre><p>この場合は、全てアップデートされていて、安全に無視できます。SVN版から次版 (新しい版番号を得ていないもの)にアップグレード<span class="bold"><strong>しようとしない限り</strong></span>、"next"を版文字列に追加できます。ただし、次回に"next"を削除する必要があります。 </p><pre class="programlisting">ALTER EXTENSION postgis UPDATE TO "3.2.0next";
ALTER EXTENSION postgis_topology UPDATE TO "3.2.0next";</pre><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>PostGISをバージョン指定なしにインストールした場合には、 しばしばリストアの前のPostGIS EXTENSIONの再インストールをとばすことができます。 バックアップは<code class="code">CREATE EXTENSION postgis</code>だけで、リストアの間に最新版になります。</p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>PostGISエクステンションを3.0.0以前からアップグレードする場合には、PostGISラスタ機能はパッケージ化されずに終わります。ラスタ機能の再パッケージは次のコマンドでできます。</p><pre class="programlisting">
    CREATE EXTENSION postgis_raster FROM unpackaged;
    </pre><p> その後、不要なら削除します。次のようにします。 </p><pre class="programlisting">DROP EXTENSION postgis_raster;
    </pre><p>
    </p></td></tr></table></div></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="hard_upgrade"></a>3.4.2. ハードアップグレード</h3></div></div></div><p>ハードアップグレードとは、PostGISで利用可能なデータの完全なダンプ/リロードを意味します。PostGISオブジェクトの内部格納状態が変更される場合や、ソフトアップグレードができない場合に、ハードアップグレードが必要です。付録の<a class="link" href="#release_notes" title="付録A 付録">リリースノート</a>に、版ごとについて、ダンプ/リロード (ハードアップグレード)の要否を記載しています。 </p><p>ダンプ/リロード作業はpostgis_restore.plスクリプトが補助します。このスクリプトは、PostGIS (古いものを含む)に属する定義を全て飛ばすように注意します。また、重複シンボルエラーや非推奨オブジェクトを持越すことなく、スキーマとデータをPostGISをインストールしたデータベースにリストアできます 。 </p><p>Windows用に関する追加情報は<a class="ulink" href="http://trac.osgeo.org/postgis/wiki/UsersWikiWinUpgrade" target="_top">Windows Hard upgrade</a>にあります。</p><p>手続きは次の通りです。  </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>アップグレードしたデータベース (<code class="varname">olddb</code>と呼ぶことにしましょう)の「カスタム書式」のダンプを、バイナリBLOBデータを含めたダンプを指定して (-b)、verboseモード (-v)で生成します。ユーザはデータベースのオーナーになることができ、PostgreSQLのスーパーユーザである必要はありません。 </p><pre class="programlisting">pg_dump -h localhost -p 5432 -U postgres -Fc -b -v -f "/somepath/olddb.backup" olddb</pre></li><li class="listitem"><p>新しいデータベースにPostGISを、PostGISが無い状態からインストールします。このデータベースを<code class="varname">newdb</code>と呼ぶことにします。この作業に関する説明については<a class="xref" href="#create_new_db" title="3.3.2. エクステンションを使わずに空間データベースを有効にする (非推奨)">「エクステンションを使わずに空間データベースを有効にする (非推奨)」</a>と<a class="xref" href="#create_new_db_extensions" title="3.3.1. エクステンションを使って空間データベースを有効にする">「エクステンションを使って空間データベースを有効にする」</a>とを参照して下さい。 </p><p>ダンプにあるspatial_ref_sysは、リストアされますが、既にあるspatial_ref_sysを上書きしません。リストア対象のデータベースに公式データセットの訂正が確実に伝わるようにするためです。標準のエントリを上書きしたい場合は、newdbを生成する際にspaltial_ref_sys.sqlファイルをロードしないだけです。 </p><p>データベースが本当に古く、ビューや関数に、長く非推奨になっている関数があるような場合には、関数やビューを使えるようにする<code class="filename">legacy.sql</code>をロードする必要があるでしょう。ただし、本当に必要な場合に限ります。可能なら、ビューや関数をダンプせずにアップグレードすることを検討して下さい。非推奨関数は、<code class="filename">uninstall_legacy.sql</code>で後から削除することができます。 </p></li><li class="listitem"><p>バックアップを新しい<code class="varname">newdb</code>データベースにリストアするには、postgis_restore.plを使います。psqlが予期せぬエラーを標準エラー出力に出すことがあります。これらのログを保存しておいて下さい。 </p><pre class="programlisting">perl utils/postgis_restore.pl "/somepath/olddb.backup" | psql -h localhost -p 5432 -U postgres newdb 2
&gt; errors.txt</pre></li></ol></div><p>エラーは次の場合に起こりえます。 </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>ビューまたは関数の中に非推奨のPostGISオブジェクトを使っているものがある場合。これの訂正には、リストア前に<code class="filename">legacy.sql</code>スクリプトのロードを試してみることができます。非推奨オブジェクトをまだ持っている版のPostGISにリストアして、コードを作り替えた後に再び移動させることもできます。 <code class="filename">legacy.sql</code>を利用する場合は、非推奨関数を使うのをやめたコードに訂正して、<code class="filename">uninstall_legacy.sql</code>をロードするのを忘れないでください。 </p></li><li class="listitem"><p>ダンプファイル内のspatial_ref_sysにあるカスタムレコードが不正なSRIDになっていることがあります。妥当なSRID値は0より大きく999000より小さくなります。999000から999999の間は内部利用のための予約領域ですが、999999より大きい値は一切使用できません。全ての不正なSRIDを持つ独自レコードは、予約領域に移動しても保持されます。しかし、spatial_ref_sysテーブルから、値が保持されるように設定されているチェック制約が外れます。場合によっては (複数の不正なSRIDが同じ予約領域のSRID値に変換されるとき)、主キーも外れます。 </p><p>これを修正するために、独自のSRSを妥当な値 (910000..910999の範囲)のSRIDに複写し、全てのテーブルを新しいSRIDに変更 (<a class="xref" href="#UpdateGeometrySRID" title="UpdateGeometrySRID">UpdateGeometrySRID</a>)し、spatial_ref_sysから不正なエントリを削除します。そして、次のようにチェック制約を再構築します。</p><pre class="programlisting">ALTER TABLE spatial_ref_sys ADD CONSTRAINT spatial_ref_sys_srid_check check (srid &gt; 0 AND srid &lt; 999000 );</pre><pre class="programlisting">ALTER TABLE spatial_ref_sys ADD PRIMARY KEY(srid));</pre><p>フランス<a class="ulink" href="https://en.wikipedia.org/wiki/Institut_g%C3%A9ographique_national" target="_top">IGN</a>地図を含む古いデータベースをアップグレードする場合には、おそらくSRIDが範囲外になり、データベースのインポート時に次のような問題に遭遇します。</p><pre class="programlisting"> WARNING: SRID 310642222 converted to 999175 (in reserved zone)</pre><p>この場合には、次のステップを試すことができます。最初にpostgis_restore.plから出たIGNをSQLから完全に破棄します。そのために次のコマンドを実行します。</p><pre class="programlisting">perl utils/postgis_restore.pl "/somepath/olddb.backup" 
&gt; olddb.sql</pre><p>さらに、次のコマンドを実行します。</p><pre class="programlisting">grep -v IGNF olddb.sql 
&gt; olddb-without-IGN.sql</pre><p>その後、新しいデータベースを生成し、必要なPostGISエクステンションを有効化して、<a class="ulink" href="https://raw.githubusercontent.com/Remi-C/IGN_spatial_ref_for_PostGIS/master/Put_IGN_SRS_into_Postgis.sql" target="_top">このスクリプト</a>で確実にフランスIGNの系を挿入します。これらの処理の後、次のようにデータのインポートを行います。 </p><pre class="programlisting">psql -h localhost -p 5432 -U postgres -d newdb -f olddb-without-IGN.sql  2
&gt; errors.txt</pre><p>

	</p></li></ol></div></div></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="using_postgis_dbmanagement"></a>第4章 データ管理</h1></div></div></div><div class="toc"><div class="toc-title">目次</div><dl class="toc"><dt><span class="sect1"><a href="#RefObject">4.1. 空間データ モデル</a></span></dt><dd><dl><dt><span class="sect2"><a href="#OGC_Geometry">4.1.1. OGC ジオメトリ</a></span></dt><dt><span class="sect2"><a href="#SQL_MM_Part3">4.1.2. SQL/MM Part 3 - 曲線</a></span></dt><dt><span class="sect2"><a href="#OpenGISWKBWKT">4.1.3. WKTとWKB</a></span></dt></dl></dd><dt><span class="sect1"><a href="#PostGIS_Geometry">4.2. ジオメトリデータタイプ</a></span></dt><dd><dl><dt><span class="sect2"><a href="#EWKB_EWKT">4.2.1. PostGIS EWKBとEWKT</a></span></dt></dl></dd><dt><span class="sect1"><a href="#PostGIS_Geography">4.3. ジオグラフィデータタイプ</a></span></dt><dd><dl><dt><span class="sect2"><a href="#Create_Geography_Tables">4.3.1. ジオグラフィテーブルの生成</a></span></dt><dt><span class="sect2"><a href="#Use_Geography_Tables">4.3.2. ジオグラフィテーブルの使用</a></span></dt><dt><span class="sect2"><a href="#PostGIS_GeographyVSGeometry">4.3.3. ジオグラフィ型を使用すべき時</a></span></dt><dt><span class="sect2"><a href="#PostGIS_Geography_AdvancedFAQ">4.3.4. ジオグラフィに関する高度なよくある質問</a></span></dt></dl></dd><dt><span class="sect1"><a href="#idp51104128">4.4. 空間テーブル</a></span></dt><dd><dl><dt><span class="sect2"><a href="#Create_Spatial_Table">4.4.1. 空間テーブルを作る</a></span></dt><dt><span class="sect2"><a href="#geometry_columns">4.4.2. GEOMETRY_COLUMNSビュー</a></span></dt><dt><span class="sect2"><a href="#Manual_Register_Spatial_Column">4.4.3. 手動でジオメトリカラムをgeometry_columnsに登録する</a></span></dt></dl></dd><dt><span class="sect1"><a href="#spatial_ref_sys">4.5. 空間参照系</a></span></dt><dd><dl><dt><span class="sect2"><a href="#spatial_ref_sys_table">4.5.1. SPATIAL_REF_SYSテーブル</a></span></dt><dt><span class="sect2"><a href="#user-spatial-ref-sys">4.5.2. ユーザ定義空間参照系</a></span></dt></dl></dd><dt><span class="sect1"><a href="#OGC_Validity">4.6. ジオメトリ検証</a></span></dt><dt><span class="sect1"><a href="#loading-data">4.7. 空間データのロード</a></span></dt><dd><dl><dt><span class="sect2"><a href="#load-data-sql">4.7.1. SQLを使ってロードする</a></span></dt><dt><span class="sect2"><a href="#shp2pgsql_usage">4.7.2. シェープファイルローダを使う</a></span></dt></dl></dd><dt><span class="sect1"><a href="#extracting-data">4.8. 空間データの抽出</a></span></dt><dd><dl><dt><span class="sect2"><a href="#extract-data-sql">4.8.1. SQLを使ってデータを抽出する</a></span></dt><dt><span class="sect2"><a href="#pgsql2shp-usage">4.8.2. ダンパを使う</a></span></dt></dl></dd><dt><span class="sect1"><a href="#build-indexes">4.9. 空間インデックス</a></span></dt><dd><dl><dt><span class="sect2"><a href="#gist_indexes">4.9.1. GiSTインデックス</a></span></dt><dt><span class="sect2"><a href="#brin_indexes">4.9.2. BRINインデックス</a></span></dt><dt><span class="sect2"><a href="#spgist_indexes">4.9.3. SP-GiSTインデックス</a></span></dt><dt><span class="sect2"><a href="#tuning-index-usage">4.9.4. インデックス使用のチューニング</a></span></dt></dl></dd></dl></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="RefObject"></a>4.1. 空間データ モデル</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="#OGC_Geometry">4.1.1. OGC ジオメトリ</a></span></dt><dt><span class="sect2"><a href="#SQL_MM_Part3">4.1.2. SQL/MM Part 3 - 曲線</a></span></dt><dt><span class="sect2"><a href="#OpenGISWKBWKT">4.1.3. WKTとWKB</a></span></dt></dl></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="OGC_Geometry"></a>4.1.1. OGC ジオメトリ</h3></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect3"><a href="#Point">4.1.1.1. ポイント (Point)</a></span></dt><dt><span class="sect3"><a href="#LineString">4.1.1.2. ラインストリング (LineString)</a></span></dt><dt><span class="sect3"><a href="#LinearRing">4.1.1.3. リニアリング (LinearRing)</a></span></dt><dt><span class="sect3"><a href="#Polygon">4.1.1.4. ポリゴン (Polygon)</a></span></dt><dt><span class="sect3"><a href="#MultiPoint">4.1.1.5. マルチポイント (MultiPoint)</a></span></dt><dt><span class="sect3"><a href="#MultiLineString">4.1.1.6. マルチラインストリング (MultiLineString)</a></span></dt><dt><span class="sect3"><a href="#MultiPolygon">4.1.1.7. マルチポリゴン (MultiPolygon)</a></span></dt><dt><span class="sect3"><a href="#GeometryCollection">4.1.1.8. ジオメトリコレクション (GeometryCollection)</a></span></dt><dt><span class="sect3"><a href="#PolyhedralSurface">4.1.1.9. 多面体サーフェス (PolyhedralSurface)</a></span></dt><dt><span class="sect3"><a href="#Triangle">4.1.1.10. 三角形 (Triangle)</a></span></dt><dt><span class="sect3"><a href="#TIN">4.1.1.11. TIN</a></span></dt></dl></div><p>Open Geospatial Consortium (OGC)は、地理空間データのモデルを提供するために<a class="ulink" href="https://www.ogc.org/standards/sfa" target="_top"><span class="emphasis"><em>Simple Features Access</em></span></a> (SFA)標準を開発しました。これは、<span class="bold"><strong>ジオメトリ (Geometry)</strong></span>の基本的な空間タイプを、空間解析処理実行のための操作や変換といった演算に沿って定義します。 </p><p>ジオメトリは<span class="emphasis"><em>抽象的な</em></span>タイプです。ジオメトリ値は複数ある<span class="emphasis"><em>具体的な</em></span>サブタイプの一つに属します。サブタイプは様々な種類の様々な次元のジオメトリの形状を表現するものです。これらには<span class="bold"><strong>原子的な</strong></span>タイプである<a class="link" href="#Point" title="4.1.1.1. ポイント (Point)">ポイント (Point)</a>、<a class="link" href="#LineString" title="4.1.1.2. ラインストリング (LineString)">ラインストリング (LineString)</a>、<a class="link" href="#LinearRing" title="4.1.1.3. リニアリング (LinearRing)">リニアリング (LinearRing)</a>、<a class="link" href="#Polygon" title="4.1.1.4. ポリゴン (Polygon)">ポリゴン (Polygon)</a>があります。また、<a class="link" href="#MultiPoint" title="4.1.1.5. マルチポイント (MultiPoint)">マルチポイント (MultiPoint)</a>、<a class="link" href="#MultiLineString" title="4.1.1.6. マルチラインストリング (MultiLineString)">マルチラインストリング (MultiLineString)</a>、<a class="link" href="#MultiPolygon" title="4.1.1.7. マルチポリゴン (MultiPolygon)">マルチポリゴン (MultiPolygon)</a>、<a class="link" href="#GeometryCollection" title="4.1.1.8. ジオメトリコレクション (GeometryCollection)">ジオメトリコレクション (GeometryCollection)</a>の<span class="bold"><strong>コレクション (collection)</strong></span> (訳注: 「マルチ系」と書いている場合があります)タイプがあります。 <a class="ulink" href="https://portal.ogc.org/files/?artifact_id=25355" target="_top"><span class="emphasis"><em>Simple Features Access - Part 1: Common architecture v1.2.1</em></span></a>では<a class="link" href="#PolyhedralSurface" title="4.1.1.9. 多面体サーフェス (PolyhedralSurface)">多面体サーフェス (PolyhedralSurface)</a>、<a class="link" href="#Triangle" title="4.1.1.10. 三角形 (Triangle)">三角形 (Triangle)</a>、<a class="link" href="#TIN" title="4.1.1.11. TIN">TIN</a>が追加されています。 </p><p>ジオメトリは2次元デカルト平面上の形状をモデル化しています。多面体サーフェス、三角形、TINは3次元空間内の形状を表現することもできます。形状のサイズと位置は<span class="bold"><strong>座標</strong></span>によって指定されます。それぞれの座標は、平面上で位置を判定するXとYの<span class="bold"><strong>座標軸</strong></span>値を持っています。形状はポイントと線分から構築され、ポイントは単一の座標で定められ、線分は二つの座標値から定められます。 </p><p>座標は任意軸ZとMを持つことができます。Z軸はしばしば標高を示すために使われます。M軸は計測値が入りますが、計測値は時間であったり距離であったりします。Z値またはM値はジオメトリ値の中にあり、ジオメトリの各ポイントで定義されているものです。ジオメトリがZ値またはM値を持っている場合には<span class="bold"><strong>座標次元</strong></span>は三次元です。Z値とM値の両方を持っている場合には四次元です。 </p><p>ジオメトリ値は、そのジオメトリが組み込まれている座標系を示す<span class="bold"><strong>空間参照系</strong></span>に関連付けられます。空間参照系はジオメトリのSRID番号で識別されます。
X軸とY軸の単位は空間参照系によって決まります。<span class="bold"><strong>平面</strong></span>参照系では伝統的にX座標値とY座標値が東、北をそれぞれ示します。<span class="bold"><strong>地理</strong></span>参照系では、経度と緯度を表現しています。
SRIDが0の場合には、軸の単位が無い、無限の直交平面を表します。<a class="xref" href="#spatial_ref_sys" title="4.5. 空間参照系">「空間参照系」</a>を参照して下さい。 </p><p>ジオメトリの<span class="bold"><strong>次元</strong></span>は、ジオメトリタイプのプロパティです。ポイントタイプは0次元、ラインタイプは1次元、ポリゴンタイプは2次元、コレクションは要素の次元の最大値、となります。 </p><p>ジオメトリ値は<span class="bold"><strong>empty</strong></span>になることがあります。空値とは、非マルチ系ジオメトリの場合は頂点を持っていないという意味で、コレクションでは要素を持っていないという意味です。 </p><p>ジオメトリ値の重要なプロパティは<span class="bold"><strong>範囲 (extent)</strong></span>または<span class="bold"><strong>バウンディングボックス (bounding box)</strong></span>です。OGCモデルでは<span class="bold"><strong>エンベロープ (envelope)</strong></span>と呼ばれています。これは、ジオメトリの座標を囲む2次元または3次元のボックスです。ジオメトリの座標空間内の範囲を表現するための、また、二つのジオメトリの相互関係をチェックするための、効率の良い方法です。 </p><p>ジオメトリモデルでは、<a class="xref" href="#DE-9IM" title="5.1.1. Dimensionally Extended 9-Intersection Model">「Dimensionally Extended 9-Intersection Model」</a>に示されている通り、トポロジ空間関係を評価することができます。これに対応するために、<span class="bold"><strong>内部 (interior)</strong></span>、<span class="bold"><strong>境界 (boundary)</strong></span>、<span class="bold"><strong>外部 (exterior)</strong></span>の概念が、ジオメトリタイプ毎に定義されます。ジオメトリはトポロジ的に閉じていて、常に境界を持っています。境界の次元はジオメトリの次元より1小さくなります。 </p><p>OGCジオメトリモデルは、ジオメトリタイプ毎に妥当性規則が定義されています。これらの規則によって、ジオメトリ値が現実的な状況を示すようになります (たとえば、外部に穴を持つポリゴンを指定できますが、ジオメトリ的に無意味であり、よって不正とします)。PostGISは不正なジオメトリ値を格納、操作することができます。これによって、必要なら修正できることになります。<a class="xref" href="#OGC_Validity" title="4.6. ジオメトリ検証">「ジオメトリ検証」</a>を参照して下さい。 </p><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="Point"></a>4.1.1.1. ポイント (Point)</h4></div></div></div><p>ポイントは、座標空間内の一つの位置を表現する0次元ジオメトリです。</p><pre class="programlisting">POINT (1 2)
POINT Z (1 2 3)
POINT ZM (1 2 3 4)
</pre></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="LineString"></a>4.1.1.2. ラインストリング (LineString)</h4></div></div></div><p>ラインストリングは連続する一連の線分で形成される1次元のラインです。線分はそれぞれ2点で定義付けられ、ある線分の終点は次の線分の始点を形成します。OGC妥当なラインストリングには、0または2以上のポイントがあります。ただしPostGISはラインストリングの一つのポイントを許容します。ラインストリングは、自身とクロスする場合があります (自己交差)。始端と終端とが同じ場合にはラインストリングは<span class="bold"><strong>閉じた</strong></span>ことになります。自己交差しない場合には、ラインストリングは<span class="bold"><strong>単純</strong></span>です。 </p><pre class="programlisting">LINESTRING (1 2, 3 4, 5 6)</pre></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="LinearRing"></a>4.1.1.3. リニアリング (LinearRing)</h4></div></div></div><p>リニアリングは閉じていて、かつ単純なラインスリングです。始端と終端は同じでなければなりませんし、ラインは自己交差してはなりません。</p><pre class="programlisting">LINEARRING (0 0 0, 4 0 0, 4 4 0, 0 4 0, 0 0 0)</pre></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="Polygon"></a>4.1.1.4. ポリゴン (Polygon)</h4></div></div></div><p>ポリゴンは2次元平面領域です。一つの外側の境界 (殻)と0個以上の内の境界 (穴)とで区切られています。それぞれの境界は<a class="link" href="#LinearRing" title="4.1.1.3. リニアリング (LinearRing)">リニアリング</a>です。 </p><pre class="programlisting">POLYGON ((0 0 0,4 0 0,4 4 0,0 4 0,0 0 0),(1 1 0,2 1 0,2 2 0,1 2 0,1 1 0))</pre></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="MultiPoint"></a>4.1.1.5. マルチポイント (MultiPoint)</h4></div></div></div><p>マルチポイントはポイントのコレクションです。</p><pre class="programlisting">MULTIPOINT ( (0 0), (1 2) )</pre></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="MultiLineString"></a>4.1.1.6. マルチラインストリング (MultiLineString)</h4></div></div></div><p>マルチラインストリングはラインストリングのコレクションです。各要素が閉じている場合には、そのマルチラインストリングは閉じています。 </p><pre class="programlisting">MULTILINESTRING ( (0 0,1 1,1 2), (2 3,3 2,5 4) )</pre></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="MultiPolygon"></a>4.1.1.7. マルチポリゴン (MultiPolygon)</h4></div></div></div><p>マルチポリゴンは相互にオーバラップも隣接もしていないポリゴンのコレクションです。コレクション内のポリゴンの接触は有限数のポイントでのみ可能です。 </p><pre class="programlisting">MULTIPOLYGON (((1 5, 5 5, 5 1, 1 1, 1 5)), ((6 5, 9 1, 6 1, 6 5)))</pre></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="GeometryCollection"></a>4.1.1.8. ジオメトリコレクション (GeometryCollection)</h4></div></div></div><p>ジオメトリコレクションは、ジオメトリの異種 (混合)のコレクションです。</p><pre class="programlisting">GEOMETRYCOLLECTION ( POINT(2 3), LINESTRING(2 3, 3 4))</pre></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="PolyhedralSurface"></a>4.1.1.9. 多面体サーフェス (PolyhedralSurface)</h4></div></div></div><p>多角形はサーフェスは、パッチまたはエッジを共有する面の隣接するコレクションです。それぞれのパッチは平面ポリゴンです。ポリゴンがZ値を持つ場合には、サーフェスは3次元になります。</p><pre class="programlisting">POLYHEDRALSURFACE Z (
  ((0 0 0, 0 0 1, 0 1 1, 0 1 0, 0 0 0)),
  ((0 0 0, 0 1 0, 1 1 0, 1 0 0, 0 0 0)),
  ((0 0 0, 1 0 0, 1 0 1, 0 0 1, 0 0 0)),
  ((1 1 0, 1 1 1, 1 0 1, 1 0 0, 1 1 0)),
  ((0 1 0, 0 1 1, 1 1 1, 1 1 0, 0 1 0)),
  ((0 0 1, 1 0 1, 1 1 1, 0 1 1, 0 0 1)) )</pre></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="Triangle"></a>4.1.1.10. 三角形 (Triangle)</h4></div></div></div><p>三角形は三つの異なる非共線頂点で定義されるポリゴンです。三角形はポリゴンですので、四つの座標で指定され、一つ目と四つ目は同じです。 </p><pre class="programlisting">TRIANGLE ((0 0, 0 9, 9 0, 0 0))</pre></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="TIN"></a>4.1.1.11. TIN</h4></div></div></div><p>TINは<a class="ulink" href="https://en.wikipedia.org/wiki/Triangulated_irregular_network" target="_top">Triangulated Irregular Network</a>を表現する、オーバラップしない<a class="link" href="#Triangle" title="4.1.1.10. 三角形 (Triangle)">三角形</a>のコレクションです。 </p><pre class="programlisting">TIN Z ( ((0 0 0, 0 0 1, 0 1 0, 0 0 0)), ((0 0 0, 0 1 0, 1 1 0, 0 0 0)) )</pre></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="SQL_MM_Part3"></a>4.1.2. SQL/MM Part 3 - 曲線</h3></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect3"><a href="#CircularString">4.1.2.1. 曲線ストリング (CircularStringCircularString)</a></span></dt><dt><span class="sect3"><a href="#CompoundCurve">4.1.2.2. 複合曲線 (CompoundCurve)</a></span></dt><dt><span class="sect3"><a href="#CurvePolygon">4.1.2.3. 曲線ポリゴン (CurvePolygon)</a></span></dt><dt><span class="sect3"><a href="#MultiCurve">4.1.2.4. マルチ曲線 (Multicurve)</a></span></dt><dt><span class="sect3"><a href="#MultiSurface">4.1.2.5. マルチサーフェス (MultiSurface)</a></span></dt></dl></div><p><a class="ulink" href="https://www.iso.org/obp/ui/#iso:std:iso-iec:13249:-3:ed-5:v1:en" target="_top"><span class="emphasis"><em>ISO/IEC 13249-3 SQL Multimedia - Spatial</em></span></a>標準 (SQL/MM) は、OGC SFAを拡張して、曲線ジオメトリを含むサブタイプを定義しています。SQL/MMタイプはXYM, XYZ, XYZMに対応します。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>SQL-MM実装での全ての浮動小数点数の比較では、所定の丸め誤差があります。現在は1E-8です。</p></td></tr></table></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="CircularString"></a>4.1.2.1. 曲線ストリング (CircularStringCircularString)</h4></div></div></div><p>曲線ストリングは、基本的な曲線タイプです。線形の世界のラインストリングに似ています。単一の円弧線分は、始点、終点 (1番目と3番目)、弧の他の点の三つの点で定義されます。閉じた円を指定するには、開始点と終了点を同じにし、中間点を対称点 (円弧の中心)に置きます。連続する円弧では、前の円弧の終端と次の円弧の始端とが同じです。よって曲線ストリングは1以上の奇数個のポイントを持つことになります。</p><pre class="programlisting">CIRCULARSTRING(0 0, 1 1, 1 0)

CIRCULARSTRING(0 0, 4 0, 4 4, 0 4, 0 0)</pre></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="CompoundCurve"></a>4.1.2.2. 複合曲線 (CompoundCurve)</h4></div></div></div><p>複合曲線は、曲線区間と直線区間の両方を含むことができる単一の連続した曲線です。このことは、整形された要素を持つことに加えて、全ての要素の最後のポイントは次の要素の最初のポイントでなければならないことを意味します。</p><pre class="programlisting">COMPOUNDCURVE( CIRCULARSTRING(0 0, 1 1, 1 0),(1 0, 0 1))</pre></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="CurvePolygon"></a>4.1.2.3. 曲線ポリゴン (CurvePolygon)</h4></div></div></div><p>曲線ポリゴンは、外側の輪がひとつで0以上の内側のリングがある点はポリゴンに似ています。違いは、ポリゴンのリングはラインストリングですが曲線ポリゴンのリングは曲線ストリングまたは複合ストリングである点です。 </p><p>PostGIS 1.4から、PostGISで曲線ポリゴンで複合曲線をサポートするようになりました。</p><pre class="programlisting">CURVEPOLYGON(
  CIRCULARSTRING(0 0, 4 0, 4 4, 0 4, 0 0),
  (1 1, 3 3, 3 1, 1 1) )</pre><p>例: CIRCULARSTRINGとLINESTRINGからなるCOMPOUNDCURVEで定義される外殻を持ち、CIRCULARSTRINGで定義される穴を持つCURVEPOLYGON</p><pre class="programlisting">CURVEPOLYGON(
  COMPOUNDCURVE( CIRCULARSTRING(0 0,2 0, 2 1, 2 3, 4 3),
                 (4 3, 4 5, 1 4, 0 0)),
  CIRCULARSTRING(1.7 1, 1.4 0.4, 1.6 0.4, 1.6 0.5, 1.7 1) )</pre></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="MultiCurve"></a>4.1.2.4. マルチ曲線 (Multicurve)</h4></div></div></div><p>マルチ曲線は曲線のコレクションで、ラインストリング、曲線ストリング、複合曲線を含むことができます。</p><pre class="programlisting">MULTICURVE( (0 0, 5 5), CIRCULARSTRING(4 0, 4 4, 8 4))</pre></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="MultiSurface"></a>4.1.2.5. マルチサーフェス (MultiSurface)</h4></div></div></div><p>マルチサーフェスはサーフェスのコレクションです。サーフェスは(線形)ポリゴンまたは曲線ポリゴンとなることができます。</p><pre class="programlisting">MULTISURFACE(
  CURVEPOLYGON(
    CIRCULARSTRING( 0 0, 4 0, 4 4, 0 4, 0 0),
    (1 1, 3 3, 3 1, 1 1)),
  ((10 10, 14 12, 11 10, 10 10), (11 11, 11.5 11, 11 11.5, 11 11)))</pre></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="OpenGISWKBWKT"></a>4.1.3. WKTとWKB</h3></div></div></div><p>OGC SFA仕様では、ジオメトリ値を外部で使用するための表現として二つの標準書式が定義されています。Well-Known Text (WKT)とWell-Known Binary (WKB)です。WKTとWKBは両方ともそのオブジェクトを定義するタイプと座標に関する情報を含んでいます。</p><p>Well-Known Text (WKT)で空間データの標準的な文字表現が可能です。空間オブジェクトのWKT表現の例を次に挙げます。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>POINT(0 0)</p></li><li class="listitem"><p>POINT Z (0 0 0)</p></li><li class="listitem"><p>POINT ZM (0 0 0 0)</p></li><li class="listitem"><p>POINT EMPTY</p></li><li class="listitem"><p>LINESTRING(0 0,1 1,1 2)</p></li><li class="listitem"><p>LINESTRING EMPTY</p></li><li class="listitem"><p>POLYGON((0 0,4 0,4 4,0 4,0 0),(1 1, 2 1, 2 2, 1 2,1 1))</p></li><li class="listitem"><p>MULTIPOINT((0 0),(1 2))</p></li><li class="listitem"><p>MULTIPOINT Z ((0 0 0),(1 2 3))</p></li><li class="listitem"><p>MULTIPOINT EMPTY</p></li><li class="listitem"><p>MULTILINESTRING((0 0,1 1,1 2),(2 3,3 2,5 4))</p></li><li class="listitem"><p>MULTIPOLYGON(((0 0,4 0,4 4,0 4,0 0),(1 1,2 1,2 2,1 2,1 1)), ((-1 -1,-1 -2,-2 -2,-2 -1,-1 -1)))</p></li><li class="listitem"><p>GEOMETRYCOLLECTION(POINT(2 3),LINESTRING(2 3,3 4))</p></li><li class="listitem"><p>GEOMETRYCOLLECTION EMPTY</p></li></ul></div><p>WKTの入出力は関数<a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a>と<a class="xref" href="#">???</a>によって提供されます。</p><pre class="programlisting">text WKT = ST_AsText(geometry);
geometry = ST_GeomFromText(text WKT, SRID);</pre><p>例えば、WKTとSRIDからの空間オブジェクトの生成と挿入のステートメントは次の通りです。</p><pre class="programlisting">INSERT INTO geotable ( geom, name )
  VALUES ( ST_GeomFromText('POINT(-126.4 45.32)', 312), 'A Place');</pre><p>Well-Known Binary (WKB)は、空間データのバイナリデータ (バイト列)で、移植可能かつ正確な表現です。空間オブジェクトのWKB表現を次に挙げます。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>WKT: POINT(1 1)</p><p>WKB: 0101000000000000000000F03F000000000000F03</p></li><li class="listitem"><p>WKT: LINESTRING (2 2, 9 9)</p><p>WKB: 0102000000020000000000000000000040000000000000004000000000000022400000000000002240</p></li></ul></div><p>WKBの入出力は関数<a class="xref" href="#ST_AsBinary" title="ST_AsBinary">ST_AsBinary</a>と<a class="xref" href="#">???</a>が提供されています。次のように使います。</p><pre class="programlisting">bytea WKB = ST_AsBinary(geometry);
geometry = ST_GeomFromWKB(bytea WKB, SRID);
</pre><p>たとえば、WKBから空間オブジェクトの生成、挿入は次のようにします。</p><pre class="programlisting">INSERT INTO geotable ( geom, name )
  VALUES ( ST_GeomFromWKB('\x0101000000000000000000f03f000000000000f03f', 312), 'A Place');</pre></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="PostGIS_Geometry"></a>4.2. ジオメトリデータタイプ</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="#EWKB_EWKT">4.2.1. PostGIS EWKBとEWKT</a></span></dt></dl></div><p>PostGISは、<code class="varname">geometry</code>というPostgreSQIデータ型を定義して、OGC Simple Features model を実装しています。これで、内部タイプコード (<a class="xref" href="#GeometryType" title="GeometryType">GeometryType</a>と<a class="xref" href="#ST_GeometryType" title="ST_GeometryType">ST_GeometryType</a>参照)で全てのジオメトリのサブタイプを表現します。これにより、カラム型で定義されたテーブルの行として、空間地物をモデリングすることが可能となります。 </p><p><code class="varname">geometry</code>データ型は<span class="emphasis"><em>透過</em></span>です。ジオメトリ値に関する関数から全てにアクセスできることを意味します。関数によって、ジオメトリオブジェクトの生成、全ての内部フィールドへのアクセスと更新、新しいジオメトリ値の計算が可能です。PostGISは、OGC <a class="ulink" href="https://portal.ogc.org/files/?artifact_id=25354" target="_top"><span class="emphasis"><em>Simple feature access - Part 2: SQL option</em></span></a> (SFS)仕様で定義されている全ての関数に、他の多数の関数とあわせて対応しています。関数の完全な一覧は<a class="xref" href="#reference" title="第8章 PostGISリファレンス">8章<i>PostGISリファレンス</i></a>をご覧下さい。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>PostGISは、空間関数にプリフィクス"ST_"を付けて、SFA標準に従っています。これは、"Spatial and Temporal (空間と時間)"を示していますが、標準の時間の部分はまだ開発していません。その代わりに"Spatial Type (空間タイプ)"と解釈できます。 </p></td></tr></table></div><p>SFA標準は、空間オブジェクトは空間参照系識別子 (SRID)を含むと規程しています。SRIDは、空間オブジェクトをデータベースに挿入するために生成した時に求められます (デフォルトとして0になるかも知れません)。<a class="xref" href="#">???</a>と<a class="xref" href="#spatial_ref_sys" title="4.5. 空間参照系">「空間参照系」</a>をご覧下さい。</p><p>ジオメトリのクエリを効率的にするため、PostGISでは様々な種類の空間インデクスを定義しています。詳細については<a class="xref" href="#build-indexes" title="4.9. 空間インデックス">「空間インデックス」</a>と<a class="xref" href="#using-query-indexes" title="5.2. 空間インデックスを使う">「空間インデックスを使う」</a>をご覧下さい。 </p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="EWKB_EWKT"></a>4.2.1. PostGIS EWKBとEWKT</h3></div></div></div><p>OGC SFA仕様は、まず2次元ジオメトリのみに対応しました。また、入出力表現にジオメトリのSRIDは取り入れていまません。OGC SFA仕様 1.2.1 (ISO 19125標準に準拠)では3次元 (XYZ)とM値 (XYMとXYZM)座標に対応するようになりましたが、SIRD値の取り込みは依然行われていません。</p><p>これらの制限のため、PostGISでは拡張書式であるEWKBとEWKTを定義しました。3次元 (XYZ, XYM)と4次元 (XYZN)座標系に対応し、SRID情報を取り込めるようにしました。すべてのジオメトリ情報を含めたので、PostGISはEWKBを格納用書式 (DUMPファイル等)として使えるようになりました。 </p><p>PostGISデータオブジェクトの「カノニカルな形式」のためにEWKBとEWKTを使います。入力では、バイナリデータのカノニカルな形式はEWKB、テキストデータについてはEWKBかEWKTが受け付けられます。これにより、HEXEWKBまたはEWKTのテキスト値から<code class="varname">::geometry</code>を使用してキャストを行い、ジオメトリ値が生成できるようになりました。出力では、バイナリのカノニカルな形式はEWKBで、テキストはHEXEWKB (HEXエンコードを施したEWKB)です。 </p><p>たとえば、この手続きでは、EWKTテキスト値からのキャストでジオメトリを生成して、HEXWKBのカノニカルな形式を使った出力を行います。</p><pre class="programlisting">SELECT 'SRID=4;POINT(0 0)'::geometry;
  geometry
  ----------------------------------------------------
  01010000200400000000000000000000000000000000000000
</pre><p>PostGIS EWKT出力はOGC WKTと次の通り相違点があります。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>XYZジオメトリでZ修飾子が省略されます。</p><p>OGC: POINT Z (1 2 3)</p><p>EWKT: POINT (1 2 3)</p></li><li class="listitem"><p>M値を含むXYMジオメトリ:</p><p>OGC: POINT M (1 2 3)</p><p>EWKT: POINTM (1 2 3)</p></li><li class="listitem"><p>4次元ジオメトリでZM修飾子を省略:</p><p>OGC: POINT ZM (1 2 3 4)</p><p>EWKT: POINT (1 2 3 4)</p></li></ul></div><p>EWKTは、次のようにOGC/ISO書式で発生しうる過剰次元と不整合を回避しています。 </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>POINT ZM (1 1)</p></li><li class="listitem"><p>POINT ZM (1 1 1)</p></li><li class="listitem"><p>POINT (1 1 1 1)</p></li></ul></div><div class="caution"><table border="0" summary="Caution"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注意]" src="images/caution.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>PostGISの拡張書式はOGC書式の上位互換であり、全ての妥当なOGC WKB/WKTは妥当なEWKB/EWKTでもあります。しかし、OGCがPostGISの定義と衝突する方法で書式を拡張した場合には、将来的に書式を変更する可能性があります。ゆえに、この互換性に*頼るべきではありません*。</p></td></tr></table></div><p>空間オブジェクトのEWKTテキスト表現の例:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>POINT(0 0 0) -- XYZ</p></li><li class="listitem"><p>SRID=32632;POINT(0 0) -- SRID付きXY</p></li><li class="listitem"><p>POINTM(0 0 0) -- XYM</p></li><li class="listitem"><p>POINT(0 0 0 0) -- XYZM</p></li><li class="listitem"><p>SRID=4326;MULTIPOINTM(0 0 0,1 2 1) -- SRID付きXYM</p></li><li class="listitem"><p>MULTILINESTRING((0 0 0,1 1 0,1 2 1),(2 3 1,3 2 1,5 4 1))</p></li><li class="listitem"><p>POLYGON((0 0 0,4 0 0,4 4 0,0 4 0,0 0 0),(1 1 0,2 1 0,2 2 0,1 2 0,1 1 0))</p></li><li class="listitem"><p>MULTIPOLYGON(((0 0 0,4 0 0,4 4 0,0 4 0,0 0 0),(1 1 0,2 1 0,2 2 0,1 2 0,1 1 0)),((-1 -1 0,-1 -2 0,-2 -2 0,-2 -1 0,-1 -1 0)))</p></li><li class="listitem"><p>GEOMETRYCOLLECTIONM( POINTM(2 3 9), LINESTRINGM(2 3 4, 3 4 5) )</p></li><li class="listitem"><p>MULTICURVE( (0 0, 5 5), CIRCULARSTRING(4 0, 4 4, 8 4) )</p></li><li class="listitem"><p>POLYHEDRALSURFACE( ((0 0 0, 0 0 1, 0 1 1, 0 1 0, 0 0 0)), ((0 0 0, 0 1 0, 1 1 0, 1 0 0, 0 0 0)), ((0 0 0, 1 0 0, 1 0 1, 0 0 1, 0 0 0)), ((1 1 0, 1 1 1, 1 0 1, 1 0 0, 1 1 0)), ((0 1 0, 0 1 1, 1 1 1, 1 1 0, 0 1 0)), ((0 0 1, 1 0 1, 1 1 1, 0 1 1, 0 0 1)) )</p></li><li class="listitem"><p>TRIANGLE ((0 0, 0 9, 9 0, 0 0))</p></li><li class="listitem"><p>TIN( ((0 0 0, 0 0 1, 0 1 0, 0 0 0)), ((0 0 0, 0 1 0, 1 1 0, 0 0 0)) )</p></li></ul></div><p>これらの書式を使う入出力は次の関数を使うと有効です。</p><pre class="programlisting">バイト配列 EWKB = ST_AsEWKB(geometry);
テキスト EWKT = ST_AsEWKT(geometry);
ジオメトリ = ST_GeomFromEWKB(bytea EWKB);
ジオメトリ = ST_GeomFromEWKT(text EWKT);</pre><p>たとえば、EWKTを使ってPostGISの空間オブジェクトを作成し挿入するステートメントは次の通りです。</p><pre class="programlisting">INSERT INTO geotable ( geom, name )
  VALUES ( ST_GeomFromEWKT('SRID=312;POINTM(-126.4 45.32 15)'), 'A Place' )</pre></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="PostGIS_Geography"></a>4.3. ジオグラフィデータタイプ</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="#Create_Geography_Tables">4.3.1. ジオグラフィテーブルの生成</a></span></dt><dt><span class="sect2"><a href="#Use_Geography_Tables">4.3.2. ジオグラフィテーブルの使用</a></span></dt><dt><span class="sect2"><a href="#PostGIS_GeographyVSGeometry">4.3.3. ジオグラフィ型を使用すべき時</a></span></dt><dt><span class="sect2"><a href="#PostGIS_Geography_AdvancedFAQ">4.3.4. ジオグラフィに関する高度なよくある質問</a></span></dt></dl></div><p><code class="varname">geography</code>データタイプによって地理座標 ("geographic", "geodetic", "lat/lon", "lon/lat"など)上の空間地物表現にネイティブに対応できます。地理座標系は角度 (度)単位で表現される球面座標系です。 </p><p>PostGISジオメトリ型の基礎は平面です。平面上の2点間の最短経路は直線です。ジオメトリに関する関数 (面積、距離、長さ、インタセクション等)は直線ベクトルとデカルト平面を使って計算しています。これで実装が簡単になり実行速度も上がりますが、地球の球面の上にあるデータについては不正確になります。 </p><p>PostGISジオグラフィというデータ型は球面モデルに基づいています。球面上の2点の最短経路は大円の弧にあたります。ジオグラフィの関数 (面積、距離、長さ、インタセクション等)は球面上の弧を使います。球面上の世界の形状を考慮に入れるので、より正確な結果が得られます。</p><p>基礎となる数学はより複雑になるため、ジオグラフィ型で定義された関数はジオメトリ型で定義された関数よりも少なくなります。時間が経つにつれて新しいアルゴリズムが追加されて、ジオグラフィの機能が拡大していきます。回避策として、ジオメトリ型とジオグラフィ型との相互変換が可能です。</p><p>ジオグラフィ型は、ジオメトリ型のように、空間参照系識別子 (SRID)を介して空間参照系と関連付けられます。<code class="varname">spatial_ref_sys</code>テーブルで定義されているあらゆる地理空間参照系 (経度/緯度を使う)が使えます (PostGIS 2.2より前ではジオグラフィ型はWGS 84地理座標系 (SRID:4326)にのみ対応していました)。<a class="xref" href="#user-spatial-ref-sys" title="4.5.2. ユーザ定義空間参照系">「ユーザ定義空間参照系」</a>に書いている通り、独自の空間参照系を追加することもできます。</p><p>計測関数 (例 <a class="xref" href="#ST_Distance" title="ST_Distance">ST_Distance</a>、<a class="xref" href="#ST_Length" title="ST_Length">ST_Length</a>、<a class="xref" href="#ST_Perimeter" title="ST_Perimeter">ST_Perimeter</a>、<a class="xref" href="#ST_Area" title="ST_Area">ST_Area</a>)によって返されるものの単位と、<a class="xref" href="#">???</a>の引数で与えられる距離との、空間参照系の単位は、メートルです。</p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="Create_Geography_Tables"></a>4.3.1. ジオグラフィテーブルの生成</h3></div></div></div><p>ジオグラフィデータを格納するテーブルは、SQLステートメント<a class="ulink" href="https://www.postgresql.org/docs/current/sql-createtable.html" target="_top">CREATE TABLE</a>に<code class="varname">geography</code>型のカラムを付けることで生成することができます。2次元ラインストリングをWGS84地理座標系 (SRID 4326)で保存するジオグラフィカラムを持つテーブルを生成する例を次に示します。</p><pre class="programlisting">CREATE TABLE global_points (
    id SERIAL PRIMARY KEY,
    name VARCHAR(64),
    location geography(POINT,4326)
  );</pre><p>二つの任意の型修飾子に対応するジオグラフィ型:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>空間の型修飾子は、カラム内で許される形状の種類や次元を規制します。値によって空間型はPOINT、LINESTRING、POLYGON、MULTIPOINT、MULTILINESTRING、MULTIPOLYGON、GEOMETRYCOLLECTIONが可能です。ジオグラフィ型は曲線や三角形、多面体サーフェスに対応していません。型修飾子に後置詞Z、M、ZMを付けることで、座標次元の制約に対応しています。たとえば、'LINESTRINGM'は、3次元で3番目の軸はMであるラインストリングのみを許します。同様に'POINTZM'では4次元 (XYZM)データが求められます。 </p></li><li class="listitem"><p>SRID修飾子は空間参照系(SRID)を特定の数値になるよう制約します。省略した場合には、デフォルトは4326 (WGS84地理座標系)となり、全ての計算はWGS84を使ったものになります。 </p></li></ul></div><p></p><p>ジオグラフィカラムを持つテーブルの生成の例を次に挙げます。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>SRIDがデフォルトの4326 (WGS84 経度/緯度)である2次元ポイントジオグラフィを持つテーブルの生成:</p><pre class="programlisting">CREATE TABLE ptgeogwgs(gid serial PRIMARY KEY, geog geography(POINT) );</pre></li><li class="listitem"><p>NAD83緯度/経度の2次元ポイントジオグラフィを持つテーブルの生成:</p><pre class="programlisting">CREATE TABLE ptgeognad83(gid serial PRIMARY KEY, geog geography(POINT,4269) );</pre></li><li class="listitem"><p>SRIDを4326で明示した3次元 (XYZ)ポイントジオグラフィを持つテーブルの生成:</p><pre class="programlisting">CREATE TABLE ptzgeogwgs84(gid serial PRIMARY KEY, geog geography(POINTZ,4326) );</pre></li><li class="listitem"><p>SRIDがデフォルトの4326である2次元ラインストリングジオグラフィを持つテーブルの生成:</p><pre class="programlisting">CREATE TABLE lgeog(gid serial PRIMARY KEY, geog geography(LINESTRING) );</pre></li><li class="listitem"><p>SRIDがデ4326 (NAD 1927 経度/緯度)である2次元ポリゴンジオグラフィを持つテーブルの生成:</p><pre class="programlisting">CREATE TABLE lgeognad27(gid serial PRIMARY KEY, geog geography(POLYGON,4267) );</pre></li></ul></div><p>ジオグラフィカラムは<code class="varname">geography_columns</code>システムビューに登録されます。<code class="varname">geography_columns</code>ビューにクエリを出してテーブルを見るには、次の通りにします。</p><pre class="programlisting">SELECT * FROM geography_columns;</pre><p>空間インデックスはジオメトリカラムと同じように機能します。PostGISは、カラム型がジオグラフィであると通知したうえで、ジオメトリに使う通常の平面用インデックスでなく、球面を基にした適切なインデックスを生成します。</p><pre class="programlisting">-- testテーブルに球面インデックスを作成
CREATE INDEX global_points_gix ON global_points USING GIST ( location );</pre></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="Use_Geography_Tables"></a>4.3.2. ジオグラフィテーブルの使用</h3></div></div></div><p>ジオメトリと同じ方法でジオグラフィテーブルにデータを挿入できます。ジオメトリデータは、SRID 4326の場合には、ジオグラフィ型に自動キャストされます。<a class="link" href="#EWKB_EWKT" title="4.2.1. PostGIS EWKBとEWKT">EWKTとEWKB</a>書式はジオグラフィ値を指定するために使うことができます。</p><pre class="programlisting">-- testテーブルにデータを追加する
INSERT INTO global_points (name, location) VALUES ('Town', 'SRID=4326;POINT(-110 30)');
INSERT INTO global_points (name, location) VALUES ('Forest', 'SRID=4326;POINT(-109 29)');
INSERT INTO global_points (name, location) VALUES ('London', 'SRID=4326;POINT(0 49)');
</pre><p><code class="varname">spatial_ref_sys</code>テーブルにある地理 (経度/緯度)参照系は、ジオグラフィのSRIDとして指定することができます。非地理座標系を使うとエラーが発生します。 </p><pre class="programlisting">-- NAD 83 経度/緯度
SELECT 'SRID=4269;POINT(-123 34)'::geography;
                    geography
----------------------------------------------------
 0101000020AD1000000000000000C05EC00000000000004140
</pre><pre class="programlisting">-- NAD27 経度/緯度
SELECT 'SRID=4267;POINT(-123 34)'::geography;
                    geography
----------------------------------------------------
 0101000020AB1000000000000000C05EC00000000000004140
</pre><pre class="programlisting">-- NAD83 UTM zone メートル単位 - メートル単位の平面投影法なのでエラーが発生します
SELECT 'SRID=26910;POINT(-123 34)'::geography;

ERROR:  Only lon/lat coordinate systems are supported in geography.
</pre><p>クエリと計測関数はメートル単位となります。そのため距離パラメータはメートル (面積の場合は平方メートル)単位となります。</p><pre class="programlisting">-- 1000km範囲の距離に関するクエリ
SELECT name FROM global_points WHERE ST_DWithin(location, 'SRID=4326;POINT(-110 29)'::geography, 1000000);</pre><p>シアトルからロンドンへの (LINESTRING(-122.33 47.606, 0.0 51.5))大円航路を行く航空機がレイキャビク (POINT(-21.96 64.15)) にどれだけ近づくかを計算することで、ジオグラフィの力を見ことができます (<a class="ulink" href="http://gc.kls2.com/cgi-bin/gc?PATH=SEA-LHR" target="_top">航路の地図表示</a>)。 </p><p>ジオグラフィ型は、レイキャビクとシアトル－ロンドン間の大円航路との距離について、球面上で122.235 kmという本当の最短距離を計算します。</p><pre class="programlisting">-- GEOGRAPHYを使った距離計算
SELECT ST_Distance('LINESTRING(-122.33 47.606, 0.0 51.5)'::geography, 'POINT(-21.96 64.15)'::geography);
   st_distance
-----------------
 122235.23815667</pre><p>ジオメトリ型では、平面の世界地図上で見て、レイキャビクとシアトル－ロンドン間の直線とのデカルト距離が計算され、意味がありません。計算結果の名目上の単位は「度」ですが、点間の本当の角度差に応じるものではなく、「度」と呼ぶこと自体が不正確です。</p><pre class="programlisting">-- GEOMETRYを使った距離計算
SELECT ST_Distance('LINESTRING(-122.33 47.606, 0.0 51.5)'::geometry, 'POINT(-21.96 64.15)'::geometry);
      st_distance
--------------------
 13.342271221453624
</pre></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="PostGIS_GeographyVSGeometry"></a>4.3.3. ジオグラフィ型を使用すべき時</h3></div></div></div><p>ジオグラフィ型によって、経度緯度座標でデータを格納できるようになりましたが、ジオグラフィで定義されている関数が、ジオメトリより少ないのと、実行にCPU時間がかかる、というところが犠牲になっています。</p><p>選択した型が、期待する領域から出ないことを、ジオメトリ型にして使用する条件とすべきです。使用するデータは地球全体か、大陸か、州か、自治体か? </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>データが小さいエリア内におさまるなら、適切な投影を選択してジオメトリを使うのが、効率面でも機能面でも最も良い方法です。</p></li><li class="listitem"><p>データが地球全体か大陸なら、ジオグラフィで投影法の細かい問題を気にせずにシステムを構築できるでしょう。経度/緯度のデータを保存して、ジオグラフィで定義された関数使います。</p></li><li class="listitem"><p>投影法を理解していなくて、学習したくもなくて、かつ、ジオグラフィで使える関数が限られていることを受け入れるのなら、ジオグラフィを使った方が簡単です。単純にデータを経度/緯度でロードして、そこから進めて下さい。</p></li></ul></div><p>ジオグラフィとジオメトリ間のサポート状況の比較については<a class="xref" href="#PostGIS_TypeFunctionMatrix" title="15.11. PostGIS関数対応マトリクス">「PostGIS関数対応マトリクス」</a>をご覧下さい。ジオグラフィ関数の簡潔なリストと説明については<a class="xref" href="#PostGIS_GeographyFunctions" title="15.4. PostGISジオグラフィ対応関数">「PostGISジオグラフィ対応関数」</a>をご覧下さい。 </p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="PostGIS_Geography_AdvancedFAQ"></a>4.3.4. ジオグラフィに関する高度なよくある質問</h3></div></div></div><div class="qandaset"><a name="idp51094656"></a><dl><dt>4.3.4.1. <a href="#idp51094912">球または回転楕円体のどちらで計算するのでしょうか?</a></dt><dt>4.3.4.2. <a href="#idp51097216">日付変更線や極に関してはどうなっていますか?</a></dt><dt>4.3.4.3. <a href="#idp51099136">処理できる最も長い弧はどうなりますか?</a></dt><dt>4.3.4.4. <a href="#idp51101056">なぜヨーロッパやロシアといった大きな範囲の面積計算はとても遅いのですか?</a></dt></dl><table border="0" style="width: 100%;"><colgroup><col align="left" width="1%"><col></colgroup><tbody><tr class="question"><td align="left" valign="top"><a name="idp51094912"></a><a name="idp51095168"></a><p><b>4.3.4.1.</b></p></td><td align="left" valign="top"><p>球または回転楕円体のどちらで計算するのでしょうか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>デフォルトでは、全ての距離と面積の計算は回転楕円体で行います。局所的なエリアでの計算結果と良好な投影を施した平面での結果と比較して下さい。大きなエリアの場合は、回転楕円体計算は、投影平面上でのどの計算よりも精度が高くなります。 </p><p>全てのジオグラフィ関数には、最後の真偽パラメータを'FALSE'にすると球面を使った計算を行うというオプションがあります。これは、特にジオメトリが非常に単純である場合に計算を速くするためのものです。</p></td></tr><tr class="question"><td align="left" valign="top"><a name="idp51097216"></a><a name="idp51097472"></a><p><b>4.3.4.2.</b></p></td><td align="left" valign="top"><p>日付変更線や極に関してはどうなっていますか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>全ての計算に日付変更線や極の概念がありません。座標は球 (経度/緯度)であるので、日付変更線とクロスする形状は、計算の観点からは、他のものと変わりありません。 </p></td></tr><tr class="question"><td align="left" valign="top"><a name="idp51099136"></a><a name="idp51099392"></a><p><b>4.3.4.3.</b></p></td><td align="left" valign="top"><p>処理できる最も長い弧はどうなりますか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>大圏の弧を2点の「補完線」として使用しています。任意の2点は、実際には2方向につながっていて、どちらの方向に行くかに依存します。PostGISの全てのコードは、大圏コースの2コースのうち*短い*方でつながっていると仮定しています。結果として、180度以上の弧を持つ形状は正しくモデル化されません。</p></td></tr><tr class="question"><td align="left" valign="top"><a name="idp51101056"></a><a name="idp51101312"></a><p><b>4.3.4.4.</b></p></td><td align="left" valign="top"><p>なぜヨーロッパやロシアといった大きな範囲の面積計算はとても遅いのですか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>ポリゴンがとんでもなく大きいからです。二つの理由から、大きなエリアは悪いです。一つは、バウンダリボックスが大きいため、どのようなクエリを走らせても、インデックスがフィーチャーを引っ張ってくる傾向にあるためです。もう一つは、頂点数が巨大で、テスト (距離、包含)関数では、少なくとも1回、通常はN (Nは、もう一方のフィーチャーの頂点数)回、頂点を横断しなければならないためです。 </p><p>ジオメトリでは、大きなポリゴンを持っているけれども小さな範囲のクエリを実行する時、ジオメトリデータ情報を小片に「非正規化」します。これにより、インデックスが効果的にオブジェクトの一部を問い合わせるようになり、またクエリが常にオブジェクト全体を引っ張りこむようなことがないようになります。<a class="xref" href="#">???</a>を参照して下さい。ヨーロッパ全体を一つのポリゴンに*格納できる*からといって、*そうすべき*だというわけではありません。</p></td></tr></tbody></table></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp51104128"></a>4.4. 空間テーブル</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="#Create_Spatial_Table">4.4.1. 空間テーブルを作る</a></span></dt><dt><span class="sect2"><a href="#geometry_columns">4.4.2. GEOMETRY_COLUMNSビュー</a></span></dt><dt><span class="sect2"><a href="#Manual_Register_Spatial_Column">4.4.3. 手動でジオメトリカラムをgeometry_columnsに登録する</a></span></dt></dl></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="Create_Spatial_Table"></a>4.4.1. 空間テーブルを作る</h3></div></div></div><p><code class="varname">geometry</code>型のカラムを付けた<a class="ulink" href="https://www.postgresql.org/docs/current/sql-createtable.html" target="_top">CREATE TABLE</a> SQLステートメントでジオメトリデータを保存するテーブルを生成することができます。次の例では、BC-アルベルス座標系 (SRID 3005)の2次元 (XY)ラインストリングを保存するジオメトリカラムを持つテーブルを生成します。</p><pre class="programlisting">CREATE TABLE roads (
    id SERIAL PRIMARY KEY,
    name VARCHAR(64),
    geom geometry(LINESTRING,3005)
  );</pre><p><code class="varname">geometry</code>型は、次の通り、二つの任意指定<span class="bold"><strong>型修飾子</strong></span>に対応しています。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <span class="bold"><strong>空間タイプ修飾子</strong></span>はカラムで許される形状と次元の種類を制約するものです。値は、対応している<a class="link" href="#RefObject" title="4.1. 空間データ モデル">ジオメトリタイプ</a> (POINT, LINESTRING, POLYGON, MULTIPOINT, MULTILINESTRING, MULTIPOLYGON, GEOMETRYCOLLECTION等)なら全て可能です。空間タイプ修飾子は、後置詞 Z, M, ZMを付け加えることで座標次元の制約に対応します。例えば、`LINESTRINGM`修飾子では、3次元で3番目がM軸となるラインストリングだけを許します。同様に、'POINTZM'では4次元 (XYZM)データが求められます。 </p></li><li class="listitem"><p><span class="bold"><strong>SRID修飾子</strong></span>は<a class="link" href="#spatial_ref_sys" title="4.5. 空間参照系">空間参照系</a>のSRIDを特定の数値に制約します。省略した場合には、デフォルトは0となります。
 restricts the <a class="link" href="#spatial_ref_sys" title="4.5. 空間参照系">spatial reference system</a> SRID to a particular number. If omitted, the SRID defaults to 0. </p></li></ul></div><p></p><p>ジオグラフィカラムを持つテーブルの生成の例を次に挙げます。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>デフォルトSRIDであらゆる種類のジオメトリを保持するテーブルの生成:</p><pre class="programlisting">CREATE TABLE geoms(gid serial PRIMARY KEY, geom geometry );</pre></li><li class="listitem"><p>2次元ポイントでSRIDがデフォルトのテーブル作成:</p><pre class="programlisting">CREATE TABLE pts(gid serial PRIMARY KEY, geom geometry(POINT) );</pre></li><li class="listitem"><p>3次元 (XYZ)ポイントでSRIDが3005のテーブル作成:</p><pre class="programlisting">CREATE TABLE pts(gid serial PRIMARY KEY, geom geometry(POINTZ,3005) );</pre></li><li class="listitem"><p>4次元 (XYZM)ラインストリングでSRIDがデフォルトのテーブル作成:</p><pre class="programlisting">CREATE TABLE lines(gid serial PRIMARY KEY, geom geometry(LINESTRINGZM) );</pre></li><li class="listitem"><p>2次元ポリゴンでSRIDが4276 (NAD 1927地理座標系)のテーブル作成:</p><pre class="programlisting">CREATE TABLE polys(gid serial PRIMARY KEY, geom geometry(POLYGON,4267) );</pre></li></ul></div><p>一つのテーブルが一つ以上のジオメトリカラムを持つことができます。テーブル生成時に指定するか、<a class="ulink" href="https://www.postgresql.org/docs/current/sql-altertable.html" target="_top">ALTER TABLE</a> SQLステートメントを使って追加するかで実現できます。次に3次元ラインストリングを格納するカラムを追加する例を示します。</p><pre class="programlisting">ALTER TABLE roads ADD COLUMN geom2 geometry(LINESTRINGZ,4326);</pre></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="geometry_columns"></a>4.4.2. GEOMETRY_COLUMNSビュー</h3></div></div></div><p>OGC <span class="emphasis"><em>Simple Features Specification for SQL</em></span>は、ジオメトリテーブル構造を記述するための<code class="varname">GEOMETRY_COLUMNS</code>メタデータテーブルを定義しています。PostGISでは<code class="varname">geometry_columns</code>は、データベースのシステムカタログテーブルから読み取るビューです。これによって、空間メタデータ情報が常に現在定義されているテーブルやビューと矛盾しなくなります。</p><pre class="programlisting">\d geometry_columns</pre><pre class="screen">View "public.geometry_columns"
      Column       |          Type          | Modifiers
-------------------+------------------------+-----------
 f_table_catalog   | character varying(256) |
 f_table_schema    | character varying(256) |
 f_table_name      | character varying(256) |
 f_geometry_column | character varying(256) |
 coord_dimension   | integer                |
 srid              | integer                |
 type              | character varying(30)  |</pre><p>カラムは次の通りです。</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">f_table_catalog, f_table_schema, f_table_name</span></dt><dd><p>ジオメトリカラムを持っている地物テーブルの完全修飾名。PostgreSQLには"catalog"の類似カラムが無いので、このカラムは空白のままです。"schema"についてはPostgreSQLスキーマ名が使われます (デフォルトは<code class="varname">public</code>です)。</p></dd><dt><span class="term">f_geometry_column</span></dt><dd><p>フィーチャーテーブル内のジオメトリカラムの名前。</p></dd><dt><span class="term">coord_dimension</span></dt><dd><p>カラムの座標次元 (2, 3, 4)</p></dd><dt><span class="term">srid</span></dt><dd><p>このテーブルのジオメトリの座標系として使用される座標系空間参照系のIDです。<code class="varname">spatial_ref_sys</code>テーブルを参照する外部キーです (<a class="xref" href="#spatial_ref_sys_table" title="4.5.1. SPATIAL_REF_SYSテーブル">「SPATIAL_REF_SYSテーブル」</a>を参照して下さい)。</p></dd><dt><span class="term">type</span></dt><dd><p>空間オブジェクトの型。空間カラムを単一型に制限するには、POINT、LINESTRING、POLYGON、MULTIPOINT、MULTILINESTRING、MULTIPOLYGON、GEOMETRYCOLLECTIONのうちのいずれかを、また、XYMで使う場合には、LINESTRINGM、POLYGONM、MULTIPOINTM、MULTILINESTRINGM、MULTIPOLYGONM、GEOMETRYCOLLECTIONMのうちのいずれかを使います。複数の型が混合するコレクションの場合は"GEOMETRY"を型とすることができます。</p></dd></dl></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="Manual_Register_Spatial_Column"></a>4.4.3. 手動でジオメトリカラムをgeometry_columnsに登録する</h3></div></div></div><p>これが必要になる事例に、SQLビューとバルクインサートの二つがあります。バルクインサートの場合には、カラムに制約を与えるか、ALTER TABLEを実行することで、geometry_columnsテーブル内の登録を訂正することができます。ビューの場合には、CAST演算を使用します。カラムが型修飾子に基づく場合には、生成処理によって正しく登録されるので、何も行う必要がありません。ジオメトリに適用する空間関数を持たないビューも、基礎となるテーブルのジオメトリカラムと同じように登録されます。</p><pre class="programlisting">-- 次のようなビューがあるとします
CREATE VIEW public.vwmytablemercator AS
        SELECT gid, ST_Transform(geom, 3395) As geom, f_name
        FROM public.mytable;

-- 正しく登録するには、
-- ジオメトリをキャストします。
--
DROP VIEW public.vwmytablemercator;
CREATE VIEW  public.vwmytablemercator AS
        SELECT gid, ST_Transform(geom, 3395)::geometry(Geometry, 3395) As geom, f_name
        FROM public.mytable;

-- ジオメトリタイプが確実に2次元ポリゴンだと知っているなら
-- 次のようにできます。
DROP VIEW public.vwmytablemercator;
CREATE VIEW  public.vwmytablemercator AS
        SELECT gid, ST_Transform(geom,3395)::geometry(Polygon, 3395) As geom, f_name
        FROM public.mytable;</pre><pre class="programlisting">-- 次のように、バルクインサートで派生テーブルを生成したとしましょう
SELECT poi.gid, poi.geom, citybounds.city_name
INTO myschema.my_special_pois
FROM poi INNER JOIN citybounds ON ST_Intersects(citybounds.geom, poi.geom);

-- 新しいテーブルに2次元インデックスを作ります
CREATE INDEX idx_myschema_myspecialpois_geom_gist
  ON myschema.my_special_pois USING gist(geom);

-- ポイントが3次元ポイントであったり、XYMポイントであったりした場合には、
-- 次のように、2次元インデックスでなくN次元インデックスを作ることになるかも
-- 知れません。
CREATE INDEX my_special_pois_geom_gist_nd
        ON my_special_pois USING gist(geom gist_geometry_ops_nd);

-- 新しいテーブルのジオメトリカラムをgeometry_columnsに手動登録するには、
-- 次のようにします。
-- カラムを型修飾子ベースにするために、基礎となるテーブル構造も変更することに
-- 注意して下さい。
SELECT populate_geometry_columns('myschema.my_special_pois'::regclass);

-- PostGIS 2.0を使っていて、何らかの理由で古い制約をもとにした定義を行う
-- (派生テーブルが同じタイプやSRIDを持たないといった場合)ことが必要な場合には、
-- 新しい任意変数use_typemodをfalseにします。
SELECT populate_geometry_columns('myschema.my_special_pois'::regclass, false); </pre><p>古い制約を基にした手法は現在も対応していますが、制約を基にしたジオメトリカラムで直接的にビューで使われている場合は、型修飾子のようには正しくgeometry_columnsに登録されません。次の例では、型修飾子を使ったカラム定義と、制約に基づくカラムの定義とを行っています。</p><pre class="programlisting">CREATE TABLE pois_ny(gid SERIAL PRIMARY KEY, poi_name text, cat text, geom geometry(POINT,4326));
SELECT AddGeometryColumn('pois_ny', 'geom_2160', 2160, 'POINT', 2, false);</pre><p>psqlで次を実行します。</p><pre class="programlisting">\d pois_ny;</pre><p>型修飾子と制約に基づくのとでは異なった定義になっているのが見えます。</p><pre class="screen">Table "public.pois_ny"
  Column   |         Type          |                       Modifiers

-----------+-----------------------+------------------------------------------------------
 gid       | integer               | not null default nextval('pois_ny_gid_seq'::regclass)
 poi_name  | text                  |
 cat       | character varying(20) |
 geom      | geometry(Point,4326)  |
 geom_2160 | geometry              |
Indexes:
    "pois_ny_pkey" PRIMARY KEY, btree (gid)
Check constraints:
    "enforce_dims_geom_2160" CHECK (st_ndims(geom_2160) = 2)
    "enforce_geotype_geom_2160" CHECK (geometrytype(geom_2160) = 'POINT'::text
        OR geom_2160 IS NULL)
    "enforce_srid_geom_2160" CHECK (st_srid(geom_2160) = 2160)</pre><p>geometry_columnsでは、両方とも正しく登録されています。</p><pre class="programlisting">SELECT f_table_name, f_geometry_column, srid, type
        FROM geometry_columns
        WHERE f_table_name = 'pois_ny';</pre><pre class="screen">f_table_name | f_geometry_column | srid | type
-------------+-------------------+------+-------
pois_ny      | geom              | 4326 | POINT
pois_ny      | geom_2160         | 2160 | POINT</pre><p>しかし、次のようにビューを作ろうとします。</p><pre class="programlisting">CREATE VIEW vw_pois_ny_parks AS
SELECT *
  FROM pois_ny
  WHERE cat='park';

SELECT f_table_name, f_geometry_column, srid, type
        FROM geometry_columns
        WHERE f_table_name = 'vw_pois_ny_parks';</pre><p>型修飾子によるgeomのビューカラムは正しく登録されますが、制約に基づくものは正しく登録されません。</p><pre class="screen">f_table_name   | f_geometry_column | srid |   type
------------------+-------------------+------+----------
 vw_pois_ny_parks | geom              | 4326 | POINT
 vw_pois_ny_parks | geom_2160         |    0 | GEOMETRY</pre><p>これは、将来的にPostGISの版で変更されるかもしれませんが、今のところは、制約に基づくビューカラムを正しく登録させるには、次のようにします。</p><pre class="programlisting">DROP VIEW vw_pois_ny_parks;
CREATE VIEW vw_pois_ny_parks AS
SELECT gid, poi_name, cat,
  geom,
  geom_2160::geometry(POINT,2160) As geom_2160
  FROM pois_ny
  WHERE cat = 'park';
SELECT f_table_name, f_geometry_column, srid, type
        FROM geometry_columns
        WHERE f_table_name = 'vw_pois_ny_parks';</pre><pre class="screen">f_table_name   | f_geometry_column | srid | type
------------------+-------------------+------+-------
 vw_pois_ny_parks | geom              | 4326 | POINT
 vw_pois_ny_parks | geom_2160         | 2160 | POINT</pre></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spatial_ref_sys"></a>4.5. 空間参照系</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="#spatial_ref_sys_table">4.5.1. SPATIAL_REF_SYSテーブル</a></span></dt><dt><span class="sect2"><a href="#user-spatial-ref-sys">4.5.2. ユーザ定義空間参照系</a></span></dt></dl></div><p><a class="ulink" href="https://en.wikipedia.org/wiki/Spatial_reference_system" target="_top">Spatial Reference Systems</a> (SRS, 空間参照系)は、どのようにジオメトリが地表位置に参照されるかを定義しています。</p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="spatial_ref_sys_table"></a>4.5.1. SPATIAL_REF_SYSテーブル</h3></div></div></div><p>PostGISで使用される<code class="varname">SPATIAL_REF_SYS</code>テーブルは、有効な空間参照系を定義するOGC準拠のデータベーステーブルです。数字の識別子と文字列の空間参照系の説明を持ちます。主に<a class="xref" href="#">???</a>を用いた空間参照系間の変換 (投影変換)に対応するために使用されています。 </p><p><code class="varname">spatial_ref_sys</code>の定義は次の通りです。</p><pre class="programlisting">CREATE TABLE spatial_ref_sys (
  srid       INTEGER NOT NULL PRIMARY KEY,
  auth_name  VARCHAR(256),
  auth_srid  INTEGER,
  srtext     VARCHAR(2048),
  proj4text  VARCHAR(2048)
)</pre><p>カラムは次の通りです。</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">srid</span></dt><dd><p>データベース内の<a class="ulink" href="http://en.wikipedia.org/wiki/SRID" target="_top">Spatial Reference System</a> (SRS, 空間参照系)で一意に識別される整数コードです。</p></dd><dt><span class="term">auth_name</span></dt><dd><p>この参照系に引用されている標準の名前もしくは標準そのものです。たとえば「EPSG」は妥当な<code class="varname">auth_name</code>です。</p></dd><dt><span class="term">auth_srid</span></dt><dd><p><code class="varname">auth_name</code>で引用されている団体によって定義された空間参照系のIDです。EPSGの場合、EPSG投影コードが入ります。</p></dd><dt><span class="term">srtext</span></dt><dd><p>空間参照系のWell-Knownテキスト表現です。たとえば、WKT SRSの表現は、次のようになります。</p><pre class="programlisting">PROJCS["NAD83 / UTM Zone 10N",
  GEOGCS["NAD83",
        DATUM["North_American_Datum_1983",
          SPHEROID["GRS 1980",6378137,298.257222101]
        ],
        PRIMEM["Greenwich",0],
        UNIT["degree",0.0174532925199433]
  ],
  PROJECTION["Transverse_Mercator"],
  PARAMETER["latitude_of_origin",0],
  PARAMETER["central_meridian",-123],
  PARAMETER["scale_factor",0.9996],
  PARAMETER["false_easting",500000],
  PARAMETER["false_northing",0],
  UNIT["metre",1]
]</pre><p>EPSG投影コードと対応するWKT表現の一覧については、<a class="ulink" href="http://www.opengeospatial.org/" target="_top">http://www.opengeospatial.org/</a>をご覧下さい。SRSのWKTについての一般的な議論については、OpenGISの<a class="ulink" href="http://www.opengeospatial.org/standards" target="_top">http://www.opengeospatial.org/standards</a>にある「座標変換サービス実装仕様」をご覧下さい。欧州石油調査グループ(European Petroleum Survey Group, EPSG)とEPSG空間参照系のデータベースに関する情報は、<a class="ulink" href="http://www.epsg.org/" target="_top">http://www.epsg.org/</a>をご覧下さい。</p></dd><dt><span class="term">proj4text</span></dt><dd><p>PostGISは座標変換機能を提供するためにProj4ライブラリを用いています。 <code class="varname">proj4text</code>カラムには、特定のSRIDを示すProj4座標定義文字列が入ります。たとえば次のようになります。</p><pre class="programlisting">+proj=utm +zone=10 +ellps=clrk66 +datum=NAD27 +units=m</pre><p>詳細情報については<a class="ulink" href="https://proj.org/" target="_top">PROJウェブサイト</a>をご覧下さい。<code class="filename">spatial_ref_sys.sql</code>ファイルには、全てのEPSG投影について、<code class="varname">srtext</code>と<code class="varname">proj4text</code>の定義があります。</p></dd></dl></div><p>投影変換で空間参照系の定義を使用する場合には、次の戦略を取ります。 </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="varname">auth_name</code>と<code class="varname">auth_srid</code>がある (NULLでない)場合には、これに基づいてPROJSRSを使います (存在する場合)。 </p></li><li class="listitem"><p><code class="varname">srtext</code>がある場合には、可能ならそれを使用してSRSを生成します。 </p></li><li class="listitem"><p><code class="varname">proj4text</code>がある場合には、可能ならこれを使用してSRSを生成します。 </p></li></ul></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="user-spatial-ref-sys"></a>4.5.2. ユーザ定義空間参照系</h3></div></div></div><p>PostGIS<code class="varname">spatial_ref_sys</code>テーブルには<a class="ulink" href="https://proj.org/" target="_top">PROJ</a>投影ライブラリで処理される最も一般的な空間参照系定義3000件以上があります。しかし、そこに無い多くの座標系があります。空間参照系に関する必要な情報がある場合は、SRS定義をテーブルに追加できます。PROJに詳しいなら独自の空間参照系を定義することもできます。ほとんどの空間参照系は地域的なものであり、目的の範囲外で使用する場合は意味を持たない点に注意してください。</p><p>PostGISのコアセットに入っていない空間参照系を探すための素晴らしい資料が<a class="ulink" href="http://spatialreference.org/" target="_top">http://spatialreference.org/</a>にあります。</p><p>一般的に使用される空間参照系には<a class="ulink" href="http://spatialreference.org/ref/epsg/4326/" target="_top">4326 - WGS 84経度緯度</a>、<a class="ulink" href="http://spatialreference.org/ref/epsg/4269/" target="_top">4269 - NAD 83 経度緯度</a>、<a class="ulink" href="http://spatialreference.org/ref/epsg/3395/" target="_top">3395 - WGS 84 メルカトル</a>、<a class="ulink" href="http://spatialreference.org/ref/epsg/2163/" target="_top">2163 - 米国ナショナルアトラス正積図法</a>、60個のWGS84 UTMゾーンがあります。UTMゾーンは計測に最適ですが、6度 (訳注: 経度)の領域のみをカバーします (対象地域に使用するUTMゾーンを決定するには<a class="ulink" href="http://trac.osgeo.org/postgis/wiki/UsersWikiplpgsqlfunctionsDistance" target="_top">utmzone PostGIS plpgsql helper function</a>を参照してください)。 </p><p>米国の州では、州平面空間参照系 (メートルまたはフィート単位)を使用します。この空間参照系は州ごとに一つか二つ存在します。ほとんどのメートル単位のものはコアのセットに存在しますが、フィート単位の多数のものやESRIが作成したものは<a class="ulink" href="http://spatialreference.org" target="_top">spatialreference.org</a>からロードする必要があります。 </p><p>地球外の座標系でさえも定義することができます。たとえば<a class="ulink" href="http://spatialreference.org/ref/iau2000/mars-2000/" target="_top">Mars 2000</a>です。この火星の座標系は非平面 (回転楕円体の度)ですが、<code class="varname">geography</code>型で、度でなくメートル単位で長さや近接測定値を取得することができます。</p><p>割当外のSRIDとPROJ定義を使って米国中央のランベルト正角円錐図法の独自座標系をロードする例を次に示します。</p><pre class="programlisting">INSERT INTO spatial_ref_sys (srid, proj4text)
VALUES ( 990000,
  '+proj=lcc  +lon_0=-95 +lat_0=25 +lat_1=25 +lat_2=25 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs'
);
</pre></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="OGC_Validity"></a>4.6. ジオメトリ検証</h2></div></div></div><p>PostGISはOpen Geospatial Consortium (OGC)のOpenGIS仕様に準拠しています。多くのPostGISメソッドは、操作対象のジオメトリが単純かつ妥当であることが求められます (正確に言うとそう仮定します)。たとえば、ポリゴンの外に穴があるようなものの面積を計算したり、単純でない境界線を持つポリゴンを作ったりするのは、意味がありません。</p><p>OGS仕様に沿うと、<span class="emphasis"><em>単純な</em></span>ジオメトリとは、自己インタセクトや自己接触のような、異常な幾何点を持たないことです。主に0次元または1次元のジオメトリ (<code class="varname">[MULTI]POINT, [MULTI]LINESTRING</code>))に適用します。 他方、ジオメトリの妥当性は、主に2次元ジオメトリ (<code class="varname">[MULTI]POLYGON</code>)に適用し、妥当なポリゴンを特徴づける位置指定子の集合を定義します。個々のジオメトリクラスには、単純性と妥当性をさらに詳細に述べる特定の条件があります。</p><p><code class="varname">POINT</code>は0次元ジオメトリオブジェクトとして常に<span class="emphasis"><em>単純</em></span>です。</p><p><code class="varname">MULTIPOINT</code>は、二つの座標値 (<code class="varname">POINT</code>)が同じでないなら<span class="emphasis"><em>単純</em></span>です。</p><p><code class="varname">LINESTRING</code>は、2度同じ<code class="varname">POINT</code>を通らない (終点は除きます。この場合は線型環と呼ばれ、さらに言うと閉じていると思われます)なら<span class="emphasis"><em>単純</em></span>です。</p><div class="informaltable"><table class="informaltable" style="border: none;"><colgroup><col><col></colgroup><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><div class="informalfigure"><div class="mediaobject"><img src="images/st_issimple01.png"><div class="caption"><p><span class="bold"><strong>(a)</strong></span></p></div></div></div></td><td style="border-bottom: 1px solid ; " align="center"><div class="informalfigure"><div class="mediaobject"><img src="images/st_issimple02.png"><div class="caption"><p><span class="bold"><strong>(b)</strong></span></p></div></div></div></td></tr><tr><td style="border-right: 1px solid ; " align="center"><div class="informalfigure"><div class="mediaobject"><img src="images/st_issimple03.png"><div class="caption"><p><span class="bold"><strong>(c)</strong></span></p></div></div></div></td><td style="" align="center"><div class="informalfigure"><div class="mediaobject"><img src="images/st_issimple04.png"><div class="caption"><p><span class="bold"><strong>(d)</strong></span></p></div></div></div></td></tr></tbody></table><table class="informaltable" style="border: none;"><colgroup><col></colgroup><tbody><tr><td style=""><p><span class="bold"><strong>(a)</strong></span>と<span class="bold"><strong>(c)</strong></span>は単純な<code class="varname">LINESTRING</code>です。<span class="bold"><strong>(b)</strong></span>と<span class="bold"><strong>(d)</strong></span>は単純ではありません。</p></td></tr></tbody></table></div><p><code class="varname">MULTILINESTRING</code>は、 全ての要素が単純で、かつ任意の2要素のインタセクトが要素の境界である<code class="varname">POINT</code>でだけ発生する場合に限って<span class="emphasis"><em>単純</em></span>です。 </p><div class="informaltable"><table class="informaltable" style="border: none;"><colgroup><col><col><col></colgroup><tbody><tr><td style="border-right: 1px solid ; " align="center"><div class="informalfigure"><div class="mediaobject"><img src="images/st_issimple05.png"><div class="caption"><p><span class="bold"><strong>(e)</strong></span></p></div></div></div></td><td style="border-right: 1px solid ; " align="center"><div class="informalfigure"><div class="mediaobject"><img src="images/st_issimple06.png"><div class="caption"><p><span class="bold"><strong>(f)</strong></span></p></div></div></div></td><td style="" align="center"><div class="informalfigure"><div class="mediaobject"><img src="images/st_issimple07.png"><div class="caption"><p><span class="bold"><strong>(g)</strong></span></p></div></div></div></td></tr></tbody></table><table class="informaltable" style="border: none;"><colgroup><col></colgroup><tbody><tr><td style=""><p><span class="bold"><strong>(e)</strong></span>と<span class="bold"><strong>(f)</strong></span>は単純な<code class="varname">MULTILINESTRING</code>です。<span class="bold"><strong>(g)</strong></span>は単純ではありません。</p></td></tr></tbody></table></div><p>定義から<code class="varname">POLYGON</code>は常に単純です。バウンダリ内の環 (外環と内環からなる)のうち二つがクロスしていないなら<span class="emphasis"><em>妥当</em></span>です。<code class="varname">POLYGON</code>の境界は、<code class="varname">POINT</code>とインタセクトするかも知れませんが、接点にしかなりません (すなわち線上にない)。<code class="varname">POLYGON</code>はカットラインまたはスパイクを持たなくても良く、内環は外環の中に完全に含まれていなければなりません。</p><div class="informaltable"><table class="informaltable" style="border: none;"><colgroup><col><col><col></colgroup><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><div class="informalfigure"><div class="mediaobject"><img src="images/st_isvalid01.png"><div class="caption"><p><span class="bold"><strong>(h)</strong></span></p></div></div></div></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><div class="informalfigure"><div class="mediaobject"><img src="images/st_isvalid02.png"><div class="caption"><p><span class="bold"><strong>(i)</strong></span></p></div></div></div></td><td style="border-bottom: 1px solid ; " align="center"><div class="informalfigure"><div class="mediaobject"><img src="images/st_isvalid03.png"><div class="caption"><p><span class="bold"><strong>(j)</strong></span></p></div></div></div></td></tr><tr><td style="border-right: 1px solid ; " align="center"><div class="informalfigure"><div class="mediaobject"><img src="images/st_isvalid04.png"><div class="caption"><p><span class="bold"><strong>(k)</strong></span></p></div></div></div></td><td style="border-right: 1px solid ; " align="center"><div class="informalfigure"><div class="mediaobject"><img src="images/st_isvalid05.png"><div class="caption"><p><span class="bold"><strong>(l)</strong></span></p></div></div></div></td><td style="" align="center"><div class="informalfigure"><div class="mediaobject"><img src="images/st_isvalid06.png"><div class="caption"><p><span class="bold"><strong>(m)</strong></span></p></div></div></div></td></tr></tbody></table><table class="informaltable" style="border: none;"><colgroup><col></colgroup><tbody><tr><td style=""><p><span class="bold"><strong>(h)</strong></span>と<span class="bold"><strong>(i)</strong></span>は妥当な<code class="varname">POLYGON</code>です。<span class="bold"><strong>(jからm)</strong></span>は単一の<code class="varname">POLYGON</code>としては表現できませんが、<span class="bold"><strong>(j)</strong></span>と<span class="bold"><strong>(m)</strong></span>は妥当な<code class="varname">MULTIPOLYGON</code>として表現できます。 </p></td></tr></tbody></table></div><p><code class="varname">MULTIPOLYGON</code>は、全ての要素が妥当で、二つのポリゴン要素について内側がインタセクトしていない場合は<span class="emphasis"><em>妥当</em></span>です。ポリゴン要素の任意の二つの境界は接触してもよいですが、有限な数の<code class="varname">POINT</code>でなければなりません。</p><div class="informaltable"><table class="informaltable" style="border: none;"><colgroup><col><col></colgroup><tbody><tr><td style="border-right: 1px solid ; " align="center"><div class="informalfigure"><div class="mediaobject"><img src="images/st_isvalid07.png"><div class="caption"><p><span class="bold"><strong>(n)</strong></span></p></div></div></div></td><td style="" align="center"><div class="informalfigure"><div class="mediaobject"><img src="images/st_isvalid08.png"><div class="caption"><p><span class="bold"><strong>(o)</strong></span></p></div></div></div></td><td style="" align="center"><div class="informalfigure"><div class="mediaobject"><img src="images/st_isvalid09.png"><div class="caption"><p><span class="bold"><strong>(p)</strong></span></p></div></div></div></td></tr></tbody></table><table class="informaltable" style="border: none;"><colgroup><col></colgroup><tbody><tr><td style=""><p><span class="bold"><strong>(n)</strong></span>と<span class="bold"><strong>(o)</strong></span>は妥当でない<code class="varname">MULTIPOLYGON</code>です。<span class="bold"><strong>(p)</strong></span>は妥当です。</p></td></tr></tbody></table></div><p>GEOSライブラリを使って実装されている関数のほとんどは、ジオメトリがOpenGISシンプルフィーチャー仕様で定義されているように妥当であると仮定しています。ジオメトリが単純であるか、また妥当であるか、のチェックとして<a class="link" href="#ST_IsSimple" title="ST_IsSimple">ST_IsSimple()</a>と<a class="link" href="#">ST_IsValid()</a>が使えます。</p><pre class="programlisting">-- 一般的に、線フィーチャーの妥当性のチェックは
-- 常にTRUEを返すので意味がありません
-- しかし、この例では、PostGISがOGCのIsValidの定義を拡張して
-- *一意な頂点*が2より少ないラインストリングについてFALSEを
-- 返すようにしています
gisdb=# SELECT
   ST_IsValid('LINESTRING(0 0, 1 1)'),
   ST_IsValid('LINESTRING(0 0, 0 0, 0 0)');

 st_isvalid | st_isvalid
------------+-----------
      t     |     f</pre><p>デフォルトでは、PostGISはジオメトリ入力に関するこの妥当性チェックを適用しません。複雑なジオメトリの妥当性のチェックはCPU時間を多く必要とするためです。データソースが信用できない場合は、手動でこのチェックを強制するための制約を付けることができます。</p><pre class="programlisting">ALTER TABLE mytable
  ADD CONSTRAINT geometry_valid_check
        CHECK (ST_IsValid(geom));</pre><p>妥当な入力ジオメトリでPostGIS関数を呼んだのに「GEOS Intersection()がエラーを投げました!」というようなエラーメッセージに遭遇したなら、PostGISまたは使用しているライブラリの中のエラーを発見しました。PostGIS開発者に連絡するべきです。PostGIS関数が妥当である入力ジオメトリから妥当でないジオメトリが返る場合も同じです。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><a class="link" href="#">ST_IsValid()</a>関数はZ値とM値を確認しません。 </p></td></tr></table></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="loading-data"></a>4.7. 空間データのロード</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="#load-data-sql">4.7.1. SQLを使ってロードする</a></span></dt><dt><span class="sect2"><a href="#shp2pgsql_usage">4.7.2. シェープファイルローダを使う</a></span></dt></dl></div><p>空間テーブルを作成したら、これでGISデータをデータベースにアップロードする準備ができたことになります。現在、PostGIS/PostgreSQLデータベースにデータをロードするには、SQLステートメントを使う、またはシェープファイルのローダ/ダンパを使う、という二つの方法があります。</p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="load-data-sql"></a>4.7.1. SQLを使ってロードする</h3></div></div></div><p>空間データを文字表現 (WKTかWKB)に変換できたら、SQLを使うのがPostGISにデータを持たせる最も簡単です。SQLユーティリティの<code class="code">psql</code>を使用して、SQLの<code class="code">INSERT</code>ステートメントのテキストファイルをロードすると、データをPostGIS/PostgreSQLに一括読み込みできます。</p><p>データアップロードファイル (たとえば<code class="filename">roads.sql</code>)は次のようになるでしょう。</p><pre class="programlisting">BEGIN;
INSERT INTO roads (road_id, roads_geom, road_name)
  VALUES (1,'LINESTRING(191232 243118,191108 243242)','Jeff Rd');
INSERT INTO roads (road_id, roads_geom, road_name)
  VALUES (2,'LINESTRING(189141 244158,189265 244817)','Geordie Rd');
INSERT INTO roads (road_id, roads_geom, road_name)
  VALUES (3,'LINESTRING(192783 228138,192612 229814)','Paul St');
INSERT INTO roads (road_id, roads_geom, road_name)
  VALUES (4,'LINESTRING(189412 252431,189631 259122)','Graeme Ave');
INSERT INTO roads (road_id, roads_geom, road_name)
  VALUES (5,'LINESTRING(190131 224148,190871 228134)','Phil Tce');
INSERT INTO roads (road_id, roads_geom, road_name)
  VALUES (6,'LINESTRING(198231 263418,198213 268322)','Dave Cres');
COMMIT;</pre><p>SQLファイルのPostgreSQLへのロードは<code class="code">psql</code>を使います。次のようにします。</p><pre class="programlisting">psql -d [データベース名] -f roads.sql</pre></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="shp2pgsql_usage"></a>4.7.2. シェープファイルローダを使う</h3></div></div></div><p><code class="filename">shp2pgsql</code>データローダは、ESRIシェープファイルをPostGIS/PostgreSQLデータベースに、ジオメトリまたはジオグラフィとして挿入するための適切なSQLに変換します。ローダには、次に示すコマンドラインフラグによって区別される、いくつかの操作モードがあります。 </p><p>グラフィカルユーザインタフェースを持つ<code class="filename">shp2pgsql-gui</code>もあります。コマンドラインローダのオプションのほとんどが使えます。これは、スクリプト化されていない1回限りのロードの場合や、PostGIS初心者がロードする場合に、簡単に使用できます。PgAdminIIIのプラグインとすることもできます。 </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">(c|a|d|p) 相互に排他的なオプションです</span></dt><dd><p>
          </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">-c</span></dt><dd><p>新しいテーブルの作成とシェープファイルからのデータの読み込みを行います。<span class="emphasis"><em>これがデフォルトモードです</em></span>。 </p></dd><dt><span class="term">-a</span></dt><dd><p>シェープファイルからデータベーステーブルにデータを追加します。複数のファイルをロードするためにこのオプションを使う場合は、これらのファイルは同じ属性と同じデータ型を持つ必要があります。 </p></dd><dt><span class="term">-d</span></dt><dd><p>シェープファイルにあるデータを持つ新しいテーブルを作成する前にデータベーステーブルを削除します。 </p></dd><dt><span class="term">-p</span></dt><dd><p>テーブル作成のSQLコードを生成するだけで、実際のデータは追加しません。このモードは、テーブル作成とデータロードとを完全に分けたい場合に使用します。 </p></dd></dl></div><p>
        </p></dd><dt><span class="term">-?</span></dt><dd><p>ヘルプ画面を表示します。 </p></dd><dt><span class="term">-D</span></dt><dd><p>出力データにPostgreSQLのダンプ書式を用います。このモードは-a, -c, -dと組み合わせて利用します。デフォルトの"insert"によるSQL書式よりも、大変早くロードできます。大きなデータセットではこちらを使用して下さい。 </p></dd><dt><span class="term">-s [&lt;FROM_SRID&gt;:]&lt;SRID&gt;</span></dt><dd><p>指定したSRIDを持つジオメトリテーブルの生成や追加を行います。FROM_SRIDが与えられた場合には、入力シェープファイルに、これを使います 。この場合には、ジオメトリは変更先SRIDに投影変換します。 </p></dd><dt><span class="term">-k</span></dt><dd><p>識別子 (カラム、スキーマおよび属性)の大文字小文字を保持します。シェープファイルの属性は全て大文字であることに注意して下さい。 </p></dd><dt><span class="term">-i</span></dt><dd><p>全ての整数を標準の32ビット整数に強制します。DBFヘッダではそれが正当であったとしても、64ビットのbigintを生成しません。 </p></dd><dt><span class="term">-I</span></dt><dd><p>ジオメトリカラムにGiSTインデックスを生成します。 </p></dd><dt><span class="term">-m</span></dt><dd><p>-m <code class="filename">a_file_name</code>で、長いカラム名を10文字のDBFカラム名に対応付けるファイルを指定します。ファイルは、1以上の行を持ちます。各行は空白区切りで二つの名前を持ち、行頭行末に空白を入れません。例を次に示します。 </p><pre class="programlisting">COLUMNNAME DBFFIELD1
AVERYLONGCOLUMNNAME DBFFIELD2</pre><p>
        </p></dd><dt><span class="term">-S </span></dt><dd><p>マルチ系ジオメトリの替りに単一ジオメトリを生成します。全てのジオメトリが実際に単一である (たとえば単一の外環でなるMULTIPOLYGONや単一の頂点でなるMULTIPOINT)場合にのみ成功します。 </p></dd><dt><span class="term">-t &lt;次元&gt;</span></dt><dd><p>出力ジオメトリが特定の次元を持つよう強制します。次元は、2D, 3DZ, 3DM, 4Dの文字列を使います。 </p><p>入力の次元が出力より小さい場合には、出力では0が入ります。入力の次元が大きい場合には、外されます。 </p></dd><dt><span class="term">-w</span></dt><dd><p>出力書式をWKBでなくWKTにします。精度が低下して、座標変動が発生しうることに注意が必要です。 </p></dd><dt><span class="term">-e</span></dt><dd><p>トランザクションを使わずに、ステートメントごとに実行するようにします。エラーの元となる不良なジオメトリがいくつか含んでいる時に、大半の良好なデータのロードが可能にするものです。ダンプ書式ではトランザクションを常に使うので、-Dフラグを指定している場合には使えません。 </p></dd><dt><span class="term">-W &lt;エンコーディング&gt;</span></dt><dd><p>入力データ (dbfファイル)のエンコーディングを指定します。全てのdbfの属性は指定されたエンコーディングからUTF8に変換されます。SQL出力結果には <code class="code">SET CLIENT_ENCODING to UTF8</code>が含まれるようになり、バックエンドはUTF-8からデータベースが内部利用のために設定したエンコーディングに再変換できます。 </p></dd><dt><span class="term">-N &lt;方針&gt;</span></dt><dd><p>NULLジオメトリ操作方針(insert*=挿入, skip=スキップ, abort=強制終了)を選択します。 </p></dd><dt><span class="term">-n</span></dt><dd><p>DBFファイルのみインポートします。対応するシェープファイルを持っていない場合、 自動的にこのモードになり、DBFファイルのみロードします。 このフラグは、完全なシェープファイル群を持っていて、属性データだけが欲しくてジオメトリが欲しくない時のみ使用します。 </p></dd><dt><span class="term">-G</span></dt><dd><p>ジオメトリ型のかわりに、ジオグラフィ型で、WGS84経度緯度 (SRID=4326)を使用します (経度緯度データが必要です)。 </p></dd><dt><span class="term">-T &lt;tablespace&gt;</span></dt><dd><p>新しいテーブルのテーブル空間を指定します。 -Xパラメータが使われない場合には、インデックスはデフォルトのテーブル空間を使用します。PostgreSQL文書には、テーブル空間を用いるべき時に関する良い文書があります。 </p></dd><dt><span class="term">-X &lt;tablespace&gt;</span></dt><dd><p>新しいテーブルのインデックスで使われるテーブル空間を指定します。 主キーインデックスに適用され、-Iが合わせて使われている場合にはGiST空間インデックスにも適用されます。 </p></dd><dt><span class="term">-Z</span></dt><dd><p>このフラグをこれを使う時、<code class="code">ANALYZE</code>手続きの生成を防ぎます。-Zフラグが無い (デフォルトの振る舞い)場合には、<code class="code">ANALYZE</code>手続きが生成されます。 </p></dd></dl></div><p>ローダを使って入力ファイルを生成してアップロードするセッション例は次の通りです。 </p><pre class="programlisting"># shp2pgsql -c -D -s 4269 -i -I shaperoads.shp myschema.roadstable &gt; roads.sql
# psql -d roadsdb -f roads.sql</pre><p>変換とアップロードはUNIXのパイプを使うと一回で実行できます。 </p><pre class="programlisting"># shp2pgsql shaperoads.shp myschema.roadstable | psql -d roadsdb</pre></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="extracting-data"></a>4.8. 空間データの抽出</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="#extract-data-sql">4.8.1. SQLを使ってデータを抽出する</a></span></dt><dt><span class="sect2"><a href="#pgsql2shp-usage">4.8.2. ダンパを使う</a></span></dt></dl></div><p>空間データはSQLかシェープファイルダンパを使うと抽出できます。SQLの節では空間テーブルで比較とクエリに使用できる関数を示します。 </p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="extract-data-sql"></a>4.8.1. SQLを使ってデータを抽出する</h3></div></div></div><p>データベース外へのデータ抽出の最も簡単な方法は、抽出するデータセットを定義し、<code class="code">SELECT</code>問い合わせを使って、結果カラムを解析可能なテキストファイルにダンプすることです。</p><pre class="programlisting">db=# SELECT road_id, ST_AsText(road_geom) AS geom, road_name FROM roads;

road_id | geom                                    | road_name
--------+-----------------------------------------+-----------
          1 | LINESTRING(191232 243118,191108 243242) | Jeff Rd
          2 | LINESTRING(189141 244158,189265 244817) | Geordie Rd
          3 | LINESTRING(192783 228138,192612 229814) | Paul St
          4 | LINESTRING(189412 252431,189631 259122) | Graeme Ave
          5 | LINESTRING(190131 224148,190871 228134) | Phil Tce
          6 | LINESTRING(198231 263418,198213 268322) | Dave Cres
          7 | LINESTRING(218421 284121,224123 241231) | Chris Way
(6 rows)</pre><p>返されるレコードの数を減らすためにある種の制限が必要になる場合があります。属性ベースで制限をかける場合には、非空間テーブルで使うのと同じSQL文を使います。空間に制限をかけるには次の関数を使います。</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">ST_Intersects</span></dt><dd><p>この関数は、二つのジオメトリが空間を共有しているかどうかをテストします。</p></dd><dt><span class="term">=</span></dt><dd><p>この関数で、二つのジオメトリが幾何的に同一であるかを見ることができます。たとえば、'POLYGON((0 0,1 1,1 0,0 0))' は 'POLYGON((0 0,1 1,1 0,0 0))' と同じかを見ることができます (これは同じとなります)。 </p></dd></dl></div><p>次に、これらの演算子をクエリで使うことができます。SQLコマンドラインからジオメトリとボックスの指定を行うときは、明示的に文字列表現をジオメトリに変換しなければならないことに注意して下さい。たとえば、次のようになります。ただし312は架空の空間参照系番号で、ここでのデータに合致しています。</p><pre class="programlisting">SELECT road_id, road_name
  FROM roads
  WHERE roads_geom='SRID=312;LINESTRING(191232 243118,191108 243242)'::geometry;</pre><p>上のクエリは"ROADS_GEOM"テーブルから、その値と等価である単一のレコードを返します。</p><p>道路がポリゴンで定義した面を通過するかどうかをチェックするには次のようにします。</p><pre class="programlisting">SELECT road_id, road_name
FROM roads
WHERE ST_Intersects(roads_geom, 'SRID=312;POLYGON((...))');</pre><p>最も一般的な空間クエリは「フレームベース」のクエリでしょう。これは、表示するためのデータの価値のある「マップフレーム」を取得するために、データブラウザやウェブマッパのようなクライアントソフトウェアに使われます。 </p><p>"&amp;&amp;"演算子を使うとき、比較フィーチャーをBOX3DかGEOMETRYかに指定することができます。ただし、GEOMETRYを指定すると、それのバウンディングボックスが比較に使われます。</p><p>次に示すクエリのように、フレームにBOX3Dオブジェクトを使います。</p><pre class="programlisting">SELECT ST_AsText(roads_geom) AS geom
FROM roads
WHERE
  roads_geom &amp;&amp; ST_MakeEnvelope(191232, 243117,191232, 243119,312);</pre><p>エンベロープの投影を指定するためにSRID 312を使っていることに注意して下さい。</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="pgsql2shp-usage"></a>4.8.2. ダンパを使う</h3></div></div></div><p><code class="filename">pgsql2shp</code>テーブルダンパは、データベースに直接接続して、テーブル (あるいはクエリによって定義されたもの)をシェープファイルに変換するものです。基本的な文は次の通りです。</p><pre class="programlisting">pgsql2shp [&lt;オプション&gt;] &lt;database&gt; [&lt;スキーマ&gt;.]&lt;table&gt;</pre><pre class="programlisting">pgsql2shp [&lt;オプション&gt;] &lt;データベース&gt; &lt;クエリ&gt;</pre><p>コマンドラインオプションは次の通りです。</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">-f &lt;ファイル名&gt;</span></dt><dd><p>特定のファイル名に出力を書きこみます。</p></dd><dt><span class="term">-h &lt;ホスト&gt;</span></dt><dd><p>接続先データベースのホスト名。</p></dd><dt><span class="term">-p &lt;ポート&gt;</span></dt><dd><p>接続先データベースのポート。</p></dd><dt><span class="term">-P &lt;パスワード&gt;</span></dt><dd><p>データベースに接続するためのパスワード。</p></dd><dt><span class="term">-u &lt;ユーザ名&gt;</span></dt><dd><p>データベースに接続する際のユーザ名。</p></dd><dt><span class="term">-g &lt;ジオメトリカラム&gt;</span></dt><dd><p>複数のジオメトリカラムを持つテーブルの場合の、シェープファイルの出力に使用するジオメトリカラム。</p></dd><dt><span class="term">-b</span></dt><dd><p>バイナリカーソルを使います。これは、実行時間を短くしますが、テーブルの非ジオメトリ属性がテキストへのキャストを持っていない場合には、動作しません。</p></dd><dt><span class="term">-r</span></dt><dd><p>Rawモード。<code class="varname">gid</code>フィールドを落としたり、カラム名をエスケープしてはいけません。</p></dd><dt><span class="term">-m <code class="varname">ファイル名</code></span></dt><dd><p>識別名を10文字名に再割り当てします。 ファイルの中身は、一つの空白で区切られ、前と後に空白が無い二つのシンボルの行からなります。VERYLONGSYMBOL SHORTONE ANOTHERVERYLONGSYMBOL SHORTER等となります。</p></dd></dl></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="build-indexes"></a>4.9. 空間インデックス</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="#gist_indexes">4.9.1. GiSTインデックス</a></span></dt><dt><span class="sect2"><a href="#brin_indexes">4.9.2. BRINインデックス</a></span></dt><dt><span class="sect2"><a href="#spgist_indexes">4.9.3. SP-GiSTインデックス</a></span></dt><dt><span class="sect2"><a href="#tuning-index-usage">4.9.4. インデックス使用のチューニング</a></span></dt></dl></div><p>インデックスによって巨大データセットの空間データベースの使用が可能となります。インデックス無しでは、地物の検索を行う際に、データベースの全てのレコードに対するシーケンシャルスキャンが必要となります。インデックスによって、レコード探索のために早く移動できる構造を構築するので、検索速度が向上します。 </p><p>一般的に属性データに使われるインデックス手法でありB木は、空間データではあまり有用ではありません。1次元データの格納とクエリにだけしか対応していないためです。ジオメトリのような2次元以上の次元を持つデータでは、全ての次元の範囲を指定できるインデックス手法が求められます。PostgreSQLの空間データ処理に関する主要な利点の一つに、多次元データで上手く動作するGiST、BRIN、SP-GiSTの複数のインデックス手法を提供していることです。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="bold"><strong>GiST (Generalized Search Tree)</strong></span>インデックスは、データを「一方にあるもの」「オーバラップするもの」「内部にあるもの」に分解するもので、GISデータを含む幅広い範囲で使えます。PostGISはGiSTインデックス空間データをR木インデックス実装のベースにています。GiSTは最も一般的に使われ、多目的なインデックス手法で、非常に良好な問い合わせ効率を提供しています。 </p></li><li class="listitem"><p><span class="bold"><strong>BRIN (Block Range Index)</strong></span>インデックスは、空間範囲を集計することで動作します。探索は範囲のスキャンを通して行われます。BRINは一部の種類 (空間的にソートされ、更新がほぼ無いか全く無い)のデータだけに適切です。しかし、インデックス生成時間は非所に早く、インデックスサイズは非常に小さくなります。 </p></li><li class="listitem"><p><span class="bold"><strong>SP-GiST (Space-Partitioned Generalized Search Tree)</strong></span>は4分木、kd木、基数木 (トライ木)のような部分木探索に対応する一般的なインデックス手法です。 </p></li></ul></div><p>空間インデックスはジオメトリのバウンディングボックスだけを格納します。空間クエリはインデックスは<span class="bold"><strong>初期フィルタ</strong></span>として使用して、クエリ条件に一致する可能性のあるジオメトリを早く求めます。ほとんどの空間クエリでは、空間述語関数を使って特定の空間条件をテストする<span class="bold"><strong>二次フィルタ</strong></span>が必要です。空間述語関数を使ったクエリの詳細情報については<a class="xref" href="#using-query-indexes" title="5.2. 空間インデックスを使う">「空間インデックスを使う」</a>をご覧下さい。 </p><p>また、<a class="ulink" href="https://postgis.net/workshops/postgis-intro/indexing.html" target="_top">PostGIS Workshop section on spatial indexes</a>と<a class="ulink" href="https://www.postgresql.org/docs/current/indexes.html" target="_top">PostgreSQL manual</a>もご覧下さい。 </p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="gist_indexes"></a>4.9.1. GiSTインデックス</h3></div></div></div><p>GiSTは「汎用検索木 (Generalized Search Tree)」の意味で、多次元データのインデックスの一般化された形式です。PostGISはGiST上で実装しているR木インデックスをを空間データのインデックスに使用しています。GiSTは最も一般的に使われ、多目的なインデックス手法で、クエリ能率を非常に良くします。他のGiSTの実装は、通常のB木インデックスに従わない全ての種類の不規則なデータ構造 (整数配列, スペクトラルデータ等)の検索速度を向上させるために使います。詳細情報については<a class="ulink" href="https://www.postgresql.org/docs/current/gist.html" target="_top">PostgreSQL manual</a>をご覧ください。 </p><p>GISデータテーブルが数千行を超えたら、空間検索の速度向上のためインデックスを構築したくなるでしょう (これは属性検索でない場合です。属性でしたら通常のインデックスを属性フィールドに追加します)。</p><p>GiSTインデックスをジオメトリカラムに追加するための文は次の通りです。</p><pre class="programlisting">CREATE INDEX [インデックス名] ON [テーブル名] USING GIST ( [ジオメトリカラム名] ); </pre><p>上の文では常に2次元インデックスを構築します。n次元インデックスをジオメトリ型で使うには、次の文でインデックスを生成できます。</p><pre class="programlisting">CREATE INDEX [インデックス名] ON [テーブル名] USING GIST ( [ジオメトリカラム名] gist_geometry_ops_nd);</pre><p>空間インデックスの構築は、計算量を集中させて行われます。また、この時には、テーブルへの書き込みアクセスがブロックされます。そのため、本番システムではより遅いCONCURRENTLYを選択するかも知れません。次のようにします。</p><pre class="programlisting">CREATE INDEX CONCURRENTLY [インデックス名] ON [テーブル名] USING GIST ( [ジオメトリカラム名] ); </pre><p>インデックス構築後に、時々PostgreSQLにテーブルの統計情報を集めさせると助かります。クエリプランの最適化に使われます。</p><pre class="programlisting">VACUUM ANALYZE [テーブル名] [(カラム名)];</pre></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="brin_indexes"></a>4.9.2. BRINインデックス</h3></div></div></div><p>BRINは"Block Range Index"の略です。PostgreSQL 9.5で導入された汎用インデックス手法です。BRINは<span class="emphasis"><em>不可逆</em></span>インデックス手法であり、レコードが与えた検索条件に合致することを確認する二番目のチェックが必要であることを意味しています (全ての空間インデックスで言えます)。非常に速いインデックス作成、非常に小さいインデックスサイズで、合理的な読み込み効率を持ちます。主目的は、非常に大きいテーブルのテーブル内の物理位置と関係があるカラムにインデックスを作ることに対応するためです。空間インデックスに加えて、BRINは様々な種類の属性データ構造 (整数、配列等)で速度向上させることができます。詳細情報については<a class="ulink" href="https://www.postgresql.org/docs/current/brin.html" target="_top">PostgreSQL manual</a>をご覧ください。 </p><p>空間テーブルが、ひとたび数千行を超えると、データの空間検索の速度向上にインデックスが必要と感じることになります。GiSTインデックスは、サイズがデータベースで使えるRAM容量を超えず、インデックスのストレージサイズに余裕があり、書き込み時のインデックス更新コストにも余裕があるなら、非常に高いパフォーマンスを発揮します。そうでない場合には、非常に大きなテーブルにおいては、BRINインデックスを代替に考えることができます。</p><p>BRINインデックスは、連続するテーブルブロックの集合 (<span class="emphasis"><em>ブロック範囲</em></span>と言います)の全てのジオメトリを囲むバウンディングボックスを格納します。インデックスを使用した問い合わせを実行する時に、問い合わせ範囲とインタセクトするブロック範囲を見つけるためにスキャンします。これは、データが物理的に整列していて、ブロック範囲のバウンディングボックスのオーバラップが最小である (理想的には相互に排他的である)場合に限って効率的です。結果インデックスは非常に小さいサイズですが、通常、読み込み効率は、同じデータにおけるGiSTインデックスより悪くなります。</p><p>BRINインデックスの構築は、はGiSTインデックスと比べて、CPU集中を非常に減らします。BRINインデックスはGiSTインデックスよりも、同じデータに対して10倍速く構築するのが普通です。BRINインデックスはテーブルブロックの範囲ごとに一つのバウンディングボックスしか格納しないので、GiSTインデックスと比べて、ディスクスペースを1000倍少なくできます。</p><p>レンジ内で要約するブロック数を選択できます。この数字を減らすと、インデックスは大きくなりますが、効率向上の助けになる可能性があります。</p><p>BRINを効果的にするには、テーブルデータをブロック範囲のオーバラップの量を最小にするような物理的オーダーで格納します。データが既に適切に並び替えられているかも知れません (たとえば、既に空間オーダーで並び替えられているデータセットを他のデータベースからロードする場合)。そうでない場合には、一つの空間キーによるデータの並べ替えで実現できます。一つの方法として、ジオメトリ値で並べ替えた新しいテーブルを生成することです (最近のPostGISのバージョンで効果的なヒルベルト曲線オーダーが使われています)。 </p><pre class="programlisting">CREATE TABLE table_sorted AS
   SELECT * FROM table  ORDER BY geom;
</pre><p>もしくは、データは、ジオハッシュを (一時的な)インデックスに使い、そのインデックスでクラスタリングを行うことによって適切に並べ替えることができます。 </p><pre class="programlisting">CREATE INDEX idx_temp_geohash ON table
    USING btree (ST_GeoHash( ST_Transform( geom, 4326 ), 20));
CLUSTER table USING idx_temp_geohash;
</pre><p>BRINインデックスを<code class="code">ジオメトリ</code>カラムに追加するための文は次の通りです。</p><pre class="programlisting">CREATE INDEX [インデックス名] ON [テーブル名] USING BRIN ( [ジオメトリカラム名] ); </pre><p>上の文で2次元インデックスを構築します。3次元インデックスをビルドするには、この文を使います。</p><pre class="programlisting">CREATE INDEX [インデックス名] ON [テーブル名]
    USING BRIN ( [ジオメトリカラム名] brin_geometry_inclusion_ops_3d);</pre><p>また、4次元演算子クラスを使う4次元インデックスを使うこともできます。</p><pre class="programlisting">CREATE INDEX [インデックス名] ON [テーブル名]
    USING BRIN ( [ジオメトリカラム名] brin_geometry_inclusion_ops_4d);</pre><p>上記のコマンドでは、範囲のブロック数はデフォルトの128を使用しています。集計で範囲のブロック数を指定するには、この文を使います。</p><pre class="programlisting">CREATE INDEX [インデックス名] ON [テーブル名]
    USING BRIN ( [ジオメトリカラム名] ) WITH (pages_per_range = [数字]); </pre><p>また、BRINインデックスは、多数の行で一つのインデックス値を格納することを心に留めておいて下さい。テーブルに違う次元のジオメトリを格納する場合には、インデックスの効率が悪くなります。この効率欠落を回避するには、格納したジオメトリの次元数の最小値となる演算子クラスを選択します。 </p><p>「ジオグラフィ」型もまたBRINインデックスに対応しています。BRINインデックスを「ジオグラフィ」カラムに構築するための文は次の通りです。</p><pre class="programlisting">CREATE INDEX [インデックス名] ON [テーブル名] USING BRIN ( [ジオメトリカラム名] ); </pre><p>上の文では常に回転楕円体面上の地理空間オブジェクトの2次元インデックスを構築します。 </p><p>現在のところは「包括対応」だけをここで考えています。これは、<code class="varname">&amp;&amp;</code>, <code class="varname">~</code>, <code class="varname">@</code>の演算子だけが2次元で使われることを意味します (<code class="code">ジオメトリ</code>と<code class="code">ジオグラフィ</code>の両方)。 <code class="varname">&amp;&amp;&amp;</code>演算子は3次元ジオメトリで使えます。しばらくはKNN検索に対応しません。</p><p>BRINと他のインデックスとの重要な違いは、データベースがインデックスを動的に保守しないことです。テーブルの空間データを変更すると、単純にインデックスの末尾に追加しています。このためインデックス探索の能率が時間とともに低下します。インデックスは<code class="code">VACUUM</code>か空間関数<code class="code">brin_summarize_new_values(regclass)</code>を実行することで更新できます。このため、BRINは読み込み専用か、書き込みがほとんど発生しないよなデータでの利用では最も適切になりえます。詳細情報については、<a class="ulink" href="https://www.postgresql.org/docs/current/brin-intro.html#BRIN-OPERATION" target="_top">manual</a>をご覧下さい。 </p><p>空間データにBRINを使用して集計するには: </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>インデックス構築時間は非常に速く、インデックスサイズは非常に小さいです。</p></li><li class="listitem"><p>インデックスのクエリ時間はGiSTより遅いですが、十分許容できます。</p></li><li class="listitem"><p>テーブルデータを空間順序で並べ替える必要があります。</p></li><li class="listitem"><p>手動でインデックスの保守をする必要があります。</p></li><li class="listitem"><p>巨大なテーブルであって、オーバラップが少ないか無く (ポイントなど)、かつ静的か頻繁には変更しないようなものに、最も適しています。</p></li><li class="listitem"><p>比較的多数のデータレコードを返すクエリでの使用が、より効果的です。</p></li></ul></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="spgist_indexes"></a>4.9.3. SP-GiSTインデックス</h3></div></div></div><p>SP-GiSTは、「空間分割された一般探索木」を表します。四分木、k次元木、基数木 (トライ木)のような分割探索木に対応するインデックスの総称的な形式です。このデータ構造の一般的な機能は、検索空間を反復して分割することですが、分割は等しいサイズである必要はありません。SP-GiSTは、GISインデックスだけでなく、電話回線のルーティングや、IPルーティング、部分文字列検索等といった、様々な種類のデータを探索する速度の向上に使われます。詳細情報については<a class="ulink" href="https://www.postgresql.org/docs/current/spgist.html" target="_top">PostgreSQL manual</a>をご覧下さい。 </p><p>GiSTインデックスを利用しているので、空間オブジェクトを覆うバウンディングボックスを保存するという意味で、SP-GiSTインデックスは不可逆です。SP-GiSTインデックスは、GiSTインデックスの代替と考えることができます。</p><p>一度GISデータテーブルが数千行を超えると、データの空間探索の速度向上にSP-GiSTインデックスを使うと良いかも知れません。「ジオメトリ」カラムにSP-GiSTインデックスを構築するための文は次の通りです。</p><pre class="programlisting">CREATE INDEX [インデックス名] ON [テーブル名] USING SPGIST ( [ジオメトリカラム] ); </pre><p>上の文では、2次元インデックスを構築します。ジオメトリ型の3次元インデックスは、次のように、3次元演算子クラスを使用して生成します。</p><pre class="programlisting">CREATE INDEX [インデックス名] ON [テーブル名] USING SPGIST ([ジオメトリカラム] spgist_geometry_ops_3d);</pre><p>空間インデックスの構築は、計算量を集中させて行われます。また、この時には、テーブルへの書き込みアクセスがブロックされます。そのため、本番システムでは、より遅いCONCURRENTLYを選択するかも知れません。次のようにします。</p><pre class="programlisting">CREATE INDEX CONCURRENTLY [インデックス名] ON [テーブル名] USING SPGIST ( [ジオメトリカラム] ); </pre><p>インデックス構築後に、時々PostgreSQLにテーブルの統計情報を集めさせると助かります。クエリプランの最適化に使われます。</p><pre class="programlisting">VACUUM ANALYZE [テーブル名] [(カラム名)];</pre><p>SP-GiSTインデックスは次の演算子を含むクエリの実行速度を向上させられます。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>2次元インデックスについては &lt;&lt;, &amp;&lt;, &amp;&gt;, &gt;&gt;, &lt;&lt;|, &amp;&lt;|, |&amp;&gt;, |&gt;&gt;, &amp;&amp;, @&gt;, &lt;@, and ~= 。</p></li><li class="listitem"><p>3次元インデックスについては &amp;/&amp;, ~==, @&gt;&gt;, and &lt;&lt;@ 。</p></li></ul></div><p>現時点ではkNN探索に対応していません。</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="tuning-index-usage"></a>4.9.4. インデックス使用のチューニング</h3></div></div></div><p>通常、インデックスは知らないうちにデータアクセスの速度を向上します。ひとたびインデックスを構築すれば、PostgreSQLクエリプランナは自動的にクエリの能率を向上させるために使うべきかどうかを決定します。しかし、プランナが既存のインデックスを選択せず、遅いシーケンシャルスキャンを使い続ける場合があります。</p><p>空間インデックスが使われていないのが分かった場合には、少しの行えることがあります。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>クエリプランの試験とクエリの確認で、必要なものを計算できます。誤ったJOINや忘れ去られたテーブルや間違ったテーブルでは、予期しないテーブルレコード検索が複数回行われることがありえます。クエリプランを得るにはクエリの先頭に<code class="code">EXPLAIN</code>を付けて実行します。</p></li><li class="listitem"><p>テーブル内の値の数量と分布に関する統計情報を収集するとともに、クエリプランナにインデックス使用にかかる意思決定のための、より良い情報を与えるようにします。<span class="command"><strong>VACUUM ANALYZE</strong></span>は両方を計算します。</p><p>データベースに対する定期的なvacuumは常に実行するべきです。多くのPostgreSQLデータベースエージェントは、閑散時のcronジョブとして定期的に<span class="command"><strong>VACUUM</strong></span>を実行します。</p></li><li class="listitem"><p>VACUUMが役に立たない場合には、<span class="command"><strong>SET ENABLE_SEQSCAN TO OFF;</strong></span>コマンドを使用して、一時的にプランナにインデックス情報の使用を強制することができます。この方法で、プランナがインデックス使用を多くしたクエリプランを生成できるかどうかを確認できます。このコマンドはデバッグにのみ使用してください。一般的に言えば、プランナはインデックスを使用するタイミングをよく知っています。クエリを実行したら<span class="command"><strong>SET ENABLE_SEQSCAN TO ON;</strong></span>を実行して、他のクエリでは通常操作にすることを忘れないでください。</p></li><li class="listitem"><p><span class="command"><strong>SET ENABLE_SEQSCAN TO OFF;</strong></span>でクエリ速度が向上する場合には、PostgreSQLのハードウェア関連のチューンが行われていないのかも知れません。プランナがシーケンシャル対インデックスのコストが誤っている場合には、<code class="code">postgresql.conf</code>内にある<code class="varname">RANDOM_PAGE_COST</code>の値を変更してみて下さい。<span class="command"><strong>SET RANDOM_PAGE_COST TO 1.1;</strong></span>とします。<code class="varname">RANDOM_PAGE_COST</code>のデフォルト値は4.0です。1.1 (SSDの場合)または2.0 (高速磁気ディスクの場合)を試してみて下さい。値を小さくするほど、プランナがインデックススキャンをしやすくなります。</p></li><li class="listitem"><p><span class="command"><strong>SET ENABLE_SEQSCAN TO OFF;</strong></span>がクエリの助けにならないなら、クエリはPostgreSQLプランナがまだ最適化できないSQL構成なのかも知れません。プランナが処理できるようにクエリを再記述できるかもしれません。例えば、インラインSELECTを持つ副問い合わせがあると、効果的なプランを作らないことがあり、LATERAL JOINを使うように書き換えることができます。</p></li></ul></div><p>詳細情報についてはPostgreSQLマニュアルの<a class="ulink" href="https://www.postgresql.jp/document/current/html/runtime-config-query.html" target="_top">問い合わせ計画</a>節をご覧下さい。 </p></div></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="using_postgis_query"></a>第5章 空間クエリ</h1></div></div></div><div class="toc"><div class="toc-title">目次</div><dl class="toc"><dt><span class="sect1"><a href="#eval_spatial_rel">5.1. 空間関係の決定</a></span></dt><dd><dl><dt><span class="sect2"><a href="#DE-9IM">5.1.1. Dimensionally Extended 9-Intersection Model</a></span></dt><dt><span class="sect2"><a href="#named-spatial-rel">5.1.2. 名前付き空間関係</a></span></dt><dt><span class="sect2"><a href="#general-spatial-rel">5.1.3. 一般的な空間関係</a></span></dt></dl></dd><dt><span class="sect1"><a href="#using-query-indexes">5.2. 空間インデックスを使う</a></span></dt><dt><span class="sect1"><a href="#examples_spatial_sql">5.3. 空間SQLの例</a></span></dt></dl></div><p>空間データベースの<span class="emphasis"><em>レゾンデートル</em></span>は、通常はデスクトップGISの機能が必要なクエリをデータベース内で実行することです。PostGISを使うには、使用可能な空間関数は何かを知り、またクエリ内でどう使うかを知って、適切なインデックスで能率を向上させることが求められます。 </p><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="eval_spatial_rel"></a>5.1. 空間関係の決定</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="#DE-9IM">5.1.1. Dimensionally Extended 9-Intersection Model</a></span></dt><dt><span class="sect2"><a href="#named-spatial-rel">5.1.2. 名前付き空間関係</a></span></dt><dt><span class="sect2"><a href="#general-spatial-rel">5.1.3. 一般的な空間関係</a></span></dt></dl></div><p>空間関係は、二つのジオメトリについて、一方がもう一方にどのような相互関係ちなっているかを示すものです。ジオメトリのクエリにおける基本的な機能です。 </p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="DE-9IM"></a>5.1.1. Dimensionally Extended 9-Intersection Model</h3></div></div></div><p><a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features Implementation Specification for SQL</a>によると「二つのジオメトリの比較の基本的なアプローチは、二つのジオメトリの内部、境界、外部のインタセクションの比較と、『インタセクション行列』の要素に基づく2ジオメトリの関係の分類です」。</p><p>点集合トポロジ理論では、2次元空間に埋め込まれたジオメトリの中にあるポイントは、次に示す三つの集合に分類されます。 </p><div class="glosslist"><dl><dt><span class="glossterm">境界 (Boundary)</span></dt><dd class="glossdef"><p>ジオメトリの境界は、一次元低いジオメトリです。<code class="varname">POINT</code>では、次元が0になり、境界は空集合です。<code class="varname">LINESTRING</code>の境界は二つの端点です。<code class="varname">POLYGON</code>の境界は、外環と内環の線です。</p></dd><dt><span class="glossterm">内部 (Interior)</span></dt><dd class="glossdef"><p>ジオメトリの内部は、ジオメトリの境界以外のポイントです。<code class="varname">POINT</code>では、内部はポイント自体です。<code class="varname">LINESTRING</code>の内部は端点の間のポイントの集合です。<code class="varname">POLYGON</code>の内部は、ポリゴン内部の面です。</p></dd><dt><span class="glossterm">外部 (Exterior)</span></dt><dd class="glossdef"><p>ジオメトリの外部はジオメトリが組み込まれた空間の残りです。言い換えると、ジオメトリの内部にも境界にもない点の全てです。これは2次元の閉じていない面になります。 </p></dd></dl></div><p><a class="ulink" href="http://en.wikipedia.org/wiki/DE-9IM" target="_top">Dimensionally Extended 9-Intersection Model</a> (DE-9IM)は、二つのジオメトリの空間関係を九つの交差の次元を指定することで記述します。交差次元は3×3の<span class="bold"><strong>交差行列</strong></span>で正式に表現することができます。 </p><p>ジオメトリ<span class="emphasis"><em>g</em></span>に対する<span class="emphasis"><em>内部</em></span>、<span class="emphasis"><em>境界</em></span>、<span class="emphasis"><em>外部</em></span>は<span class="emphasis"><em>I(g)</em></span>、<span class="emphasis"><em>B(g)</em></span>、<span class="emphasis"><em>E(g)</em></span>と表記します。また、<span class="emphasis"><em>dim(s)</em></span>は<span class="emphasis"><em>s</em></span>の集合を<code class="literal">{0,1,2,F}</code>の値で示すます。 </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">0</code> =&gt; 点</p></li><li class="listitem"><p><code class="literal">1</code> =&gt; 線</p></li><li class="listitem"><p><code class="literal">2</code> =&gt; 面</p></li><li class="listitem"><p><code class="literal">F</code> =&gt; 空集合</p></li></ul></div><p>この表記法を使うと、二つのジオメトリ<span class="emphasis"><em>a</em></span>と<span class="emphasis"><em>b</em></span>の交差行列は次の通りです。</p><div class="styledtable"><table class="styledtable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col><col><col><col></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </th><th style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="bold"><strong>内部 (Interior)</strong></span></th><th style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="bold"><strong>境界 (Boundary)</strong></span></th><th style="border-bottom: 1px solid ; " align="center"><span class="bold"><strong>外部 (Exterior)</strong></span></th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="bold"><strong>内部 (Interior)</strong></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="emphasis"><em>dim( I(a) ∩ I(b) )</em></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="emphasis"><em>dim( I(a) ∩ B(b) )</em></span></td><td style="border-bottom: 1px solid ; " align="center"><span class="emphasis"><em>dim( I(a) ∩ E(b) )</em></span></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="bold"><strong>境界 (Boundary)</strong></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="emphasis"><em>dim( B(a) ∩ I(b) )</em></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="emphasis"><em>dim( B(a) ∩ B(b) )</em></span></td><td style="border-bottom: 1px solid ; " align="center"><span class="emphasis"><em>dim( B(a) ∩ E(b) )</em></span></td></tr><tr><td style="border-right: 1px solid ; " align="center"><span class="bold"><strong>外部 (Exterior)</strong></span></td><td style="border-right: 1px solid ; " align="center"><span class="emphasis"><em>dim( E(a) ∩ I(b) )</em></span></td><td style="border-right: 1px solid ; " align="center"><span class="emphasis"><em>dim( E(a) ∩ B(b) )</em></span></td><td style="" align="center"><span class="emphasis"><em>dim( E(a) ∩ E(b) )</em></span></td></tr></tbody></table></div><p>二つのオーバラップするポリゴンについて可視化すると、次のようになります。</p><div class="informaltable"><table class="informaltable" style="border: none;"><colgroup><col width="80pt"><col></colgroup><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "> </td><td style="border-bottom: 1px solid ; " align="center"><div class="informalfigure"><div align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;"><tr><td align="center" valign="middle"><img src="images/de9im04.png" align="middle"></td></tr></table></div></div></td></tr><tr><td style="border-right: 1px solid ; " align="center" valign="middle"><div class="informalfigure"><div align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;"><tr><td align="center" valign="middle"><img src="images/de9im03.png" align="middle"></td></tr></table></div></div></td><td style=""><p> </p><div class="styledtable"><table class="styledtable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col><col><col><col></colgroup><thead valign="middle"><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center" valign="middle"> </th><th style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center" valign="middle"><span class="bold"><strong>内部 (Interior)</strong></span></th><th style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center" valign="middle"><span class="bold"><strong>境界 (Boundary)</strong></span></th><th style="border-bottom: 1px solid ; " align="center" valign="middle"><span class="bold"><strong>外部 (Exterior)</strong></span></th></tr></thead><tbody valign="middle"><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center" valign="middle"><span class="bold"><strong>内部 (Interior)</strong></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center" valign="middle"><div class="informalfigure"><div><img src="images/de9im05.png"></div></div><p><span class="emphasis"><em>dim( I(a) ∩ I(b) ) = </em></span><span class="bold"><strong>2</strong></span></p></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center" valign="middle"><div class="informalfigure"><div><img src="images/de9im06.png"></div></div><p><span class="emphasis"><em>dim( I(a) ∩ B(b) = </em></span><span class="bold"><strong>1</strong></span></p></td><td style="border-bottom: 1px solid ; " align="center" valign="middle"><div class="informalfigure"><div><img src="images/de9im07.png"></div></div><p><span class="emphasis"><em>dim( I(a) ∩ E(b) ) = </em></span><span class="bold"><strong>2</strong></span></p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center" valign="middle"><span class="bold"><strong>境界 (Boundary)</strong></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center" valign="middle"><div class="informalfigure"><div><img src="images/de9im08.png"></div></div><p><span class="emphasis"><em>dim( B(a) ∩ I(b) ) = </em></span><span class="bold"><strong>1</strong></span></p></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center" valign="middle"><div class="informalfigure"><div><img src="images/de9im09.png"></div></div><p><span class="emphasis"><em>dim( B(a) ∩ B(b) ) = </em></span><span class="bold"><strong>0</strong></span></p></td><td style="border-bottom: 1px solid ; " align="center" valign="middle"><div class="informalfigure"><div><img src="images/de9im10.png"></div></div><p><span class="emphasis"><em>dim( B(a) ∩ E(b) ) = </em></span><span class="bold"><strong>1</strong></span></p></td></tr><tr><td style="border-right: 1px solid ; " align="center" valign="middle"><span class="bold"><strong>外部 (Exterior)</strong></span></td><td style="border-right: 1px solid ; " align="center" valign="middle"><div class="informalfigure"><div><img src="images/de9im11.png"></div></div><p><span class="emphasis"><em>dim( E(a) ∩ I(b) ) = </em></span><span class="bold"><strong>2</strong></span></p></td><td style="border-right: 1px solid ; " align="center" valign="middle"><div class="informalfigure"><div><img src="images/de9im12.png"></div></div><p><span class="emphasis"><em>dim( E(a) ∩ B(b) ) = </em></span><span class="bold"><strong>1</strong></span></p></td><td style="" align="center" valign="middle"><div class="informalfigure"><div><img src="images/de9im13.png"></div></div><p><span class="emphasis"><em>dim( E(a) ∩ E(b) = </em></span><span class="bold"><strong>2</strong></span></p></td></tr></tbody></table></div></td></tr></tbody></table></div><p>左から右に、上から下に読みます。交差行列の文字列表現は'<span class="bold"><strong>212101212</strong></span>'です。</p><p>詳細情報については次をご覧下さい。</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p><a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features Implementation Specification for SQL</a> (1.1版, 2.1.13.2節)</p></li><li class="listitem"><p><a class="ulink" href="https://en.wikipedia.org/wiki/DE-9IM" target="_top">Wikipedia: Dimensionally Extended Nine-Intersection Model (DE-9IM)</a></p></li><li class="listitem"><p><a class="ulink" href="http://docs.geotools.org/latest/userguide/library/jts/dim9.html" target="_top">GeoTools: Point Set Theory and the DE-9IM Matrix</a></p></li></ul></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="named-spatial-rel"></a>5.1.2. 名前付き空間関係</h3></div></div></div><p>共通の空間関係を簡単に決定できるように、PGC SFSは<span class="emphasis"><em>名前付き空間関係述語</em></span>の集合を定義しています。PostGISでは<a class="xref" href="#">???</a>、<a class="xref" href="#">???</a>、<a class="xref" href="#">???</a>、<a class="xref" href="#">???</a>、<a class="xref" href="#">???</a>、<a class="xref" href="#">???</a>、<a class="xref" href="#">???</a>、<a class="xref" href="#">???</a>が提供されています。非標準の空間関係述語<a class="xref" href="#">???</a>、<a class="xref" href="#">???</a>、<a class="xref" href="#">???</a>も定義されています。 </p><p>空間述語は通常SQLの<code class="code">WHERE</code>節や<code class="code">JOIN</code>節内で条件に使用されます。名前付き空間述語は、インデックスが有効なら自動的に空間インデックスを使うので、バウンディングボックス演算子<code class="code">&amp;&amp;</code>を使う必要はありません。例えば次のようになります。 </p><pre class="programlisting">SELECT city.name, state.name, city.geom
FROM city JOIN state ON ST_Intersects(city.geom, state.geom);
</pre><p>詳細や図については<a class="ulink" href="https://postgis.net/workshops/postgis-intro/spatial_relationships.html" target="_top">PostGIS Workshop</a>をご覧下さい。</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="general-spatial-rel"></a>5.1.3. 一般的な空間関係</h3></div></div></div><p>名前付き空間関係が求める空間フィルタ条件を与えるのに不十分となる場合があります。 </p><div class="informaltable"><table class="informaltable" style="border: none;"><colgroup><col></colgroup><tbody><tr><td style=""><div class="informalfigure-float" style="float: right;"><div class="informalfigure"><div align="left"><img src="images/de9im01.png" align="left"></div></div></div><p>例えば、道路ネットワークを表現する線データセットを考えてみます。点でなく線で交差する全ての道路の辺を識別しなければならないことがあります (ビジネスルールの検証のためならありえます)。この場合、<a class="xref" href="#">???</a>では、点で交差する場合しか<code class="varname">true</code>を返さないので、必要な空間フィルタになりません。 </p>
                <p>2ステップ解決法を示します。まず、空間的にインタセクトしている同路線の二本を抜き出し (<a class="xref" href="#">???</a>)、実際にインタセクトしている部分を計算 (<a class="xref" href="#">???</a>)します。次いで、インタセクトしている部分の<a class="xref" href="#ST_GeometryType" title="ST_GeometryType">ST_GeometryType</a>が<code class="varname">LINESTRING</code>' かどうかを確認します (<code class="varname">[MULTI]POINT</code>、<code class="varname">[MULTI]LINESTRING</code>等の<code class="varname">GEOMETRYCOLLECTION</code>を返す場合に適切に処理します)。</p>
                <p>明らかに、より単純でより速い解法が望ましいです。</p></td></tr></tbody></table></div><div class="informaltable"><table class="informaltable" style="border: none;"><colgroup><col></colgroup><tbody><tr><td style=""><p> </p><div class="informalfigure-float" style="float: right;"><div class="informalfigure"><div align="right"><img src="images/de9im02.png" align="right"></div></div></div> <p>二つ目の例では、湖の境界とインタセクトし、かつ終端が岸に上がっている波止場を見つけます。言い換えると、波止場が湖に含まれるが完全には含まれず、湖の境界線とインタセクトして、波止場の終端が確実に湖内または境界にある場合を指します。空間述語を併用すると求める地物を見つけることができます。</p> <div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="#">???</a>(lake, wharf) = TRUE</p></li><li class="listitem"><p><a class="xref" href="#">???</a>(lake, wharf) = FALSE</p></li><li class="listitem"><p><a class="xref" href="#ST_GeometryType" title="ST_GeometryType">ST_GeometryType</a>(<a class="xref" href="#">???</a>(wharf, lake)) = 'LINESTRING'</p></li><li class="listitem"><p><a class="xref" href="#ST_NumGeometries" title="ST_NumGeometries">ST_NumGeometries</a>(<a class="xref" href="#ST_Multi" title="ST_Multi">ST_Multi</a>(<a class="xref" href="#">???</a>(<a class="xref" href="#ST_Boundary" title="ST_Boundary">ST_Boundary</a>(wharf), <a class="xref" href="#ST_Boundary" title="ST_Boundary">ST_Boundary</a>(lake)))) = 1</p><p>… 言うまでもないですが非常に複雑ですね。</p></li></ul></div></td></tr></tbody></table></div><p>この要件は完全なDE-9IM交差行列の計算で満たすことができます。PostGISは、これを行う<a class="xref" href="#">???</a>関数を提供しています。次のようにします。 </p><pre class="programlisting">SELECT ST_Relate( 'LINESTRING (1 1, 5 5)',
                  'POLYGON ((3 3, 3 7, 7 7, 7 3, 3 3))' );
st_relate
-----------
1010F0212
</pre><p>特定の空間関係をテストするには、<span class="bold"><strong>交差行列パターン</strong></span>を使います。これは、追加シンボル<code class="literal">{T,*}</code>で拡張された行列表現です。 </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">T</code> =&gt; インタセクションの次元は空ではないという意味です。すなわち<code class="literal">{0,1,2}</code>のいずれかです。</p></li><li class="listitem"><p><code class="literal">*</code> =&gt; 何でも良い</p></li></ul></div><p>交差行列パターンを使って、特定の空間関係の評価がより簡潔な方法で可能です。交差行列パターンのテストに<a class="xref" href="#">???</a>と<a class="xref" href="#">???</a>を使うことができます。上に挙げた一つ目の例では、二つのラインがライン内部でインタセクトする交差行列パターンは'<span class="bold"><strong>1*1***1**</strong></span>'となります。</p><pre class="programlisting">-- ライン内でインタセクトする道路区間を見つける
SELECT a.id
FROM roads a, roads b
WHERE a.id != b.id
      AND a.geom &amp;&amp; b.geom
      AND ST_Relate(a.geom, b.geom, '1*1***1**');</pre><p>二つ目の例です。一本のラインが部分的にポリゴン内部とポリゴン外部とにある場合の交差行列パターンは '<span class="bold"><strong>102101FF2</strong></span>'となります。</p><pre class="programlisting">-- 一部が湖の水涯線上にある波止場を見つける
SELECT a.lake_id, b.wharf_id
FROM lakes a, wharfs b
WHERE a.geom &amp;&amp; b.geom
      AND ST_Relate(a.geom, b.geom, '102101FF2');</pre></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="using-query-indexes"></a>5.2. 空間インデックスを使う</h2></div></div></div><p>空間条件を使用するクエリを構築する時、最良の効果を得るには、空間インデックスが存在する場合に (<a class="xref" href="#build-indexes" title="4.9. 空間インデックス">「空間インデックス」</a>参照)これを確実に使用することが重要です。そのためには、<code class="code">WHERE</code>節や<code class="code">ON</code>節で、空間演算子またはインデックス対応関数を使用しなければなりません。 </p><p>空間演算子には、バウンディングボックス演算子 (最もよく使われるのは<a class="xref" href="#geometry_overlaps" title="&amp;&amp;">&amp;&amp;</a>です。<a class="xref" href="#operators-bbox" title="8.8.1. バウンディングボックス演算子">「バウンディングボックス演算子」</a>参照)、および近傍クエリで使用される距離演算子 (最もよく使われるのは<a class="xref" href="#geometry_distance_knn" title="&lt;-&gt;">&lt;-&gt;</a>です。<a class="xref" href="#operators-distance" title="8.8.2. 距離演算子">「距離演算子」</a>参照)が含まれます。 </p><p>インデックス対応関数は、自動的にバウンディングボックス演算子を空間条件に追加します。インデックス対応関数は空間関係述語を含みます。空間関係述語には、<a class="xref" href="#">???</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#">???</a>があり、距離述語には<a class="xref" href="#">???</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#">???</a> があります。 </p><p><a class="xref" href="#ST_Distance" title="ST_Distance">ST_Distance</a>といった関数は、演算の最適化のためにはインデックスを<span class="emphasis"><em>使用しません</em></span>。例えば、次のクエリは、大きなテーブルでは非常に遅くなります。</p><pre class="programlisting">SELECT geom
FROM geom_table
WHERE ST_Distance( geom, 'SRID=312;POINT(100000 200000)' ) &lt; 100</pre><p>このクエリは<code class="code">geom_table</code>テーブル内の、(100000, 200000)のポイントから100単位内にある全てのジオメトリを選択します。テーブル内の個々のポイントと指定したポイントとの距離を計算しているため、非常に遅くなります。すなわち、1回の<code class="varname">ST_Distance()</code>の計算で、テーブルの<span class="bold"><strong>全ての</strong></span>行について計算することになります。 </p><p>インデックス対応関数<a class="xref" href="#">???</a>を使用すると、処理行数を実質的に減らすことができます。次のようにします。</p><pre class="programlisting">SELECT geom
FROM geom_table
WHERE ST_DWithin( geom, 'SRID=312;POINT(100000 200000)', 100 )
</pre><p>このクエリは、同じジオメトリを選択しますが、より効率的な方法を取ります。 <code class="varname">ST_DWithin()</code>が内部で<code class="varname">&amp;&amp;</code>演算子をクエリジオメトリのバウンディングボックスを拡大したボックスで使うことによって可能となります。<code class="code">the_geom</code>上に空間インデックスが存在するなら、クエリプランナは距離計算の前に対象行数を減らすためにインデックスを使えることを認識します。空間インデックスによって、バウンディングボックスが拡張された範囲とオーバラップするジオメトリだけを検索して、そのため、求めようとする距離内にある<span class="emphasis"><em>かも知れない</em></span>ジオメトリを検索することができます。その後で、結果集合内のレコードを含めるかどうかを確認するための実際の距離計算が行われます。 </p><p>詳細情報と例については<a class="ulink" href="https://postgis.net/workshops/postgis-intro/indexing.html" target="_top">PostGIS Workshop</a>をご覧下さい。 </p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="examples_spatial_sql"></a>5.3. 空間SQLの例</h2></div></div></div><p>本節の例では、線型の道、ポリゴンの自治体境界、の二つのテーブルを使います。テーブルの定義をしまします。<code class="varname">bc_roads</code>については次の通りです。</p><pre class="programlisting">Column      | Type              | Description
------------+-------------------+-------------------
gid         | integer           | Unique ID
name        | character varying | Road Name
the_geom    | geometry          | Location Geometry (Linestring)</pre><p><code class="varname">bc_municipality</code>テーブルの定義については次の通りです。</p><pre class="programlisting">Column     | Type              | Description
-----------+-------------------+-------------------
gid        | integer           | Unique ID
code       | integer           | Unique ID
name       | character varying | City / Town Name
the_geom   | geometry          | Location Geometry (Polygon)</pre><div class="qandaset"><a name="idp52344320"></a><dl><dt>5.3.1. <a href="#qa_total_length_roads">道路の総延長はkm表記でいくらになるでしょう?</a></dt><dt>5.3.2. <a href="#idp52347264">プリンスジョージ市の大きさはha表記でいくらになるでしょう?</a></dt><dt>5.3.3. <a href="#idp52362112">県内で最も大きな面積となる自治体はどこでしょう?</a></dt><dt>5.3.4. <a href="#idp52364928">各自治体内に含まれる道路の総延長はいくらでしょう?</a></dt><dt>5.3.5. <a href="#idp52367744">プリンスジョージ市内の全ての道路からなるテーブルを作る</a></dt><dt>5.3.6. <a href="#idp52370176">ビクトリア州の「ダグラス通り」の長さはkm表記でいくらになるでしょう?</a></dt><dt>5.3.7. <a href="#idp52372224">穴を持つ自治体ポリゴンのうち最も大きいのはどれでしょう?</a></dt></dl><table border="0" style="width: 100%;"><colgroup><col align="left" width="1%"><col></colgroup><tbody><tr class="question"><td align="left" valign="top"><a name="qa_total_length_roads"></a><a name="idp52344960"></a><p><b>5.3.1.</b></p></td><td align="left" valign="top"><p>道路の総延長はkm表記でいくらになるでしょう?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>この問題は、次のようなとても単純なSQLで答えを得ることができます。</p><pre class="programlisting">SELECT sum(ST_Length(the_geom))/1000 AS km_roads FROM bc_roads;

km_roads
------------------
70842.1243039643
(1 row)</pre></td></tr><tr class="question"><td align="left" valign="top"><a name="idp52347264"></a><a name="idp52347520"></a><p><b>5.3.2.</b></p></td><td align="left" valign="top"><p>プリンスジョージ市の大きさはha表記でいくらになるでしょう?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>このクエリでは、属性条件 (municipality name, 自治体名)に空間計算 (面積)を併用しています。</p><pre class="programlisting">SELECT
  ST_Area(the_geom)/10000 AS hectares
FROM bc_municipality
WHERE name = 'PRINCE GEORGE';

hectares
------------------
32657.9103824927
(1 row)</pre></td></tr><tr class="question"><td align="left" valign="top"><a name="idp52362112"></a><a name="idp52362368"></a><p><b>5.3.3.</b></p></td><td align="left" valign="top"><p>県内で最も大きな面積となる自治体はどこでしょう?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>このクエリは、空間計測をクエリ条件に持ってきています。この問題へのアプローチの方法はいくつかありますが、最も効率的なのは次の通りです。</p><pre class="programlisting">SELECT
  name,
  ST_Area(the_geom)/10000 AS hectares
FROM
  bc_municipality
ORDER BY hectares DESC
LIMIT 1;

name           | hectares
---------------+-----------------
TUMBLER RIDGE  | 155020.02556131
(1 row)</pre><p>このクエリの答えを出すためには、全てのポリゴンの面積を求める必要があることに注意して下さい。このクエリを多く実行する場合、性能向上のためにテーブルにareaカラムを追加して、別のインデックスを追加することができるようにするのは、意義のあることです。結果を距離について降順に並べ替え、PostgreSQLの"LIMIT"コマンドを用いることで、max()のような集約関数を使わずに、簡単に最も大きい値を集約関数を得ることができます。</p></td></tr><tr class="question"><td align="left" valign="top"><a name="idp52364928"></a><a name="idp52365184"></a><p><b>5.3.4.</b></p></td><td align="left" valign="top"><p>各自治体内に含まれる道路の総延長はいくらでしょう?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>これは、二つのテーブルからデータを持ち込んで (結合して)いるので「空間結合」の例です。しかし、結合の条件として共通キーの上で接続するという普通のリレーションのやり方でなく空間インタラクション条件 (「含む」)を使っています。</p><pre class="programlisting">SELECT
  m.name,
  sum(ST_Length(r.the_geom))/1000 as roads_km
FROM
  bc_roads AS r,
  bc_municipality AS m
WHERE
  ST_Contains(m.the_geom, r.the_geom)
GROUP BY m.name
ORDER BY roads_km;

name                        | roads_km
----------------------------+------------------
SURREY                      | 1539.47553551242
VANCOUVER                   | 1450.33093486576
LANGLEY DISTRICT            | 833.793392535662
BURNABY                     | 773.769091404338
PRINCE GEORGE               | 694.37554369147
...</pre><p>このクエリは、テーブル内の全ての道路の合計を最終結果 (この例での話ですが約250Kmの道です)にまとめられるので、少し時間がかかります。より小さいオーバレイ (数百の道路で数千のレコード)の場合、応答はもっと早くなりえます。</p></td></tr><tr class="question"><td align="left" valign="top"><a name="idp52367744"></a><a name="idp52368000"></a><p><b>5.3.5.</b></p></td><td align="left" valign="top"><p>プリンスジョージ市内の全ての道路からなるテーブルを作る</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>これは「オーバレイ」の例です。つまり、二つのテーブルを取得して、空間的に切り取られた結果からなる新しいテーブルを出力します。上で示した「空間結合」と違い、このクエリは実際に新しいジオメトリを生成します。生成されたオーバレイはターボのかかった空間結合みたいなもので、より確かな解析作業に便利です。</p><pre class="programlisting">CREATE TABLE pg_roads as
SELECT
  ST_Intersection(r.the_geom, m.the_geom) AS intersection_geom,
  ST_Length(r.the_geom) AS rd_orig_length,
  r.*
FROM
  bc_roads AS r,
  bc_municipality AS m
WHERE
  m.name = 'PRINCE GEORGE'
        AND ST_Intersects(r.the_geom, m.the_geom);</pre></td></tr><tr class="question"><td align="left" valign="top"><a name="idp52370176"></a><a name="idp52370432"></a><p><b>5.3.6.</b></p></td><td align="left" valign="top"><p>ビクトリア州の「ダグラス通り」の長さはkm表記でいくらになるでしょう?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><pre class="programlisting">SELECT
  sum(ST_Length(r.the_geom))/1000 AS kilometers
FROM
  bc_roads r,
  bc_municipality m
WHERE
        r.name = 'Douglas St'
        AND m.name = 'VICTORIA'
        AND ST_Intersects(m.the_geom, r.the_geom);

kilometers
------------------
4.89151904172838
(1 row)</pre></td></tr><tr class="question"><td align="left" valign="top"><a name="idp52372224"></a><a name="idp52372480"></a><p><b>5.3.7.</b></p></td><td align="left" valign="top"><p>穴を持つ自治体ポリゴンのうち最も大きいのはどれでしょう?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><pre class="programlisting">SELECT gid, name, ST_Area(the_geom) AS area
FROM bc_municipality
WHERE ST_NRings(the_geom) &gt; 1
ORDER BY area DESC LIMIT 1;

gid  | name         | area
-----+--------------+------------------
12   | SPALLUMCHEEN | 257374619.430216
(1 row)</pre></td></tr></tbody></table></div></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="performance_tips"></a>第6章 性能向上に関する技法</h1></div></div></div><div class="toc"><div class="toc-title">目次</div><dl class="toc"><dt><span class="sect1"><a href="#small_tables_large_objects">6.1. 大きなジオメトリを持つ小さなテーブル</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp52572416">6.1.1. 問題の説明</a></span></dt><dt><span class="sect2"><a href="#idp51466624">6.1.2. 応急処置</a></span></dt></dl></dd><dt><span class="sect1"><a href="#database_clustering">6.2. ジオメトリインデクスでCLUSTERを実行する</a></span></dt><dt><span class="sect1"><a href="#avoiding_dimension_conversion">6.3. 次元変換の回避</a></span></dt></dl></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="small_tables_large_objects"></a>6.1. 大きなジオメトリを持つ小さなテーブル</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="#idp52572416">6.1.1. 問題の説明</a></span></dt><dt><span class="sect2"><a href="#idp51466624">6.1.2. 応急処置</a></span></dt></dl></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idp52572416"></a>6.1.1. 問題の説明</h3></div></div></div><p>現版のPostgreSQL (9.6を含む)では、TOASTテーブルに従うクエリオプティマイザの弱さに苦しみます。 TOASTテーブルは、(長いテキスト、イメージ、多数の頂点を持つ複合ジオメトリといった)通常のデータページに適合しない、(データサイズという意味では)巨大な値を納めるための「拡張部屋」の一種です。詳細情報は <a class="ulink" href="http://www.postgresql.org/docs/current/static/storage-toast.html" target="_top">the PostgreSQL Documentation for TOAST</a>をご覧ください。</p><p>(高解像度で全てのヨーロッパの国の境界を含むテーブルのような)大きなジオメトリがあるうえ、行がそう多くないテーブルを持つようになると、この問題が出てきます。テーブル自体は小さいのですが、多くのTOASTスペースを使います。例として、テーブル自体は概ね80行で3データページしか使わなくてもTOASTテーブルで8225ページを使うとします。</p><p>ここで、ジオメトリ演算子の&amp;&amp;を使って、ほとんどマッチしないようなバウンダリボックスを検索するクエリを出してみます。クエリオプティマイザにはテーブルは3ページ80行しかないように見えます。オプティマイザは、小さなテーブルを順に走査する方がインデクスを使うよりも早いと見積もります。そして、GiSTインデクスは無視すると決めます。通常なら、この見積もりは正しいです。しかし、この場合は&amp;&amp;演算子が全てのジオメトリをディスクから呼び出してバウンディングボックスと比較しなければならなくなり、ゆえに、全てのTOASTページもまた呼び出す必要があります。</p><p>この問題に苦しむかどうかを見るには、PostgreSQLの"EXPLAIN ANALYZE"コマンドを使います。詳細情報と技術情報については、PostgreSQL性能メーリングリストのスレッド<a class="ulink" href="http://archives.postgresql.org/pgsql-performance/2005-02/msg00030.php" target="_top">http://archives.postgresql.org/pgsql-performance/2005-02/msg00030.php</a>をご覧下さい。</p><p>また、PostGISの新しいスレッド<a class="ulink" href="https://lists.osgeo.org/pipermail/postgis-devel/2017-June/026209.html" target="_top">https://lists.osgeo.org/pipermail/postgis-devel/2017-June/026209.html</a>もご覧下さい。</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idp51466624"></a>6.1.2. 応急処置</h3></div></div></div><p>PostgreSQLコミュニティでは、TOASTを意識したクエリ見積もりを作ることで、この問題を解決しようとしています。今のところは、二つの応急処置があります。</p><p>一つは、クエリプランナにインデクスの使用を強制することです。クエリを発行する前に"SET enable_seqscan TO off;"をサーバに送信します。これは基本的にクエリプランナに対して可能な限り順に走査することを避けるよう強制します。そのためGiSTインデクスを通常使うようになります。しかし、このフラグは接続するたびに設定しなければならず、他のケースにおいてはクエリプランナに誤った見積もりをさせることになるので、 "SET enable_seqscan TO on;"をクエリの後に送信すべきです。</p><p>もう一つは、順に走査することをクエリプランナが考える程度に早くすることです。これは、バウンダリボックスの「キャッシュ」を行う追加カラムを作成し、このカラムにマッチさせるようにすることで達成することができます。ここでの例では次のようになります。</p><pre class="programlisting">SELECT AddGeometryColumn('myschema','mytable','bbox','4326','GEOMETRY','2');
UPDATE mytable SET bbox = ST_Envelope(ST_Force2D(geom));</pre><p>そして、次のように、&amp;&amp;演算子をgeom_columnに対して行っていたものをbboxに変更します。</p><pre class="programlisting">SELECT geom_column
FROM mytable
WHERE bbox &amp;&amp; ST_SetSRID('BOX3D(0 0,1 1)'::box3d,4326);</pre><p>もちろん、mytableの行を変更または追加したら、bboxを「同期」するようにしなければなりません。最もすっきりした方法はトリガです。もしくは、アプリケーションを変更してbboxカラムの現状を保持するか、テーブル更新後にいつもUPDATEクエリを実行するかでも対応できます。</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="database_clustering"></a>6.2. ジオメトリインデクスでCLUSTERを実行する</h2></div></div></div><p>読み込むことがほとんどで、かつほとんどのクエリでひとつのインデクスを使うようなテーブルのために、PostgreSQLはCLUSTERコマンドを提供しています。このコマンドは、全てのデータ行を、インデクス基準にあわせて物理的に再整理するので、二つの性能の利点を生みます。一つは、インデクスの範囲走査のために、データテーブルのシーク回数が劇的に減少することです。もう一つは、いくつかの小さなインデクス間隔に集中する場合には、データ行が分布するデータページがより少なくなるので、より効率的なキャッシュを持つことです (この点で、PostgreSQLマニュアルのCLUSTERコマンドのドキュメントを読むように仕向けられていると感じて下さい)。</p><p>しかし、GiSTインデクスは単純にNULL値を無視するため現在のところPostGISのGiSTインデクスのクラスタリングはできず、次のようなエラーメッセージを得ます。</p><pre class="programlisting">lwgeom=# CLUSTER my_geom_index ON my_table;
ERROR: cannot cluster when index access method does not handle null values
HINT: You may be able to work around this by marking column "geom" NOT NULL.</pre><p>ヒントメッセージにある通り、テーブルに"not null"制限を追加することで、この欠陥にとりあえず対応できます。例を示します。</p><pre class="programlisting">lwgeom=# ALTER TABLE my_table ALTER COLUMN geom SET not null;
ALTER TABLE</pre><p>もちろん、ジオメトリカラムで実際にNULL値が必要な場合、この対応はできません。さらには、制限を追加するには上の方法を使わなければならず、"ALTER TABLE blubb ADD CHECK (geometry is not null);"のようなCHECK制限は使えません。</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="avoiding_dimension_conversion"></a>6.3. 次元変換の回避</h2></div></div></div><p>ときどき、テーブルで3次元、4次元のデータを持つのに、常にOpenGIS準拠のST_AsText()またはST_AsBinary()関数を使ってアクセスして 2次元ジオメトリを出力させるようなことが起きます。内部でST_Force_2d()関数を呼んでいるために発生しますが、これは、大きなジオメトリでは重大なオーバヘッドを誘引することになります。このオーバヘッドを回避するには、一度追加された次元を前もって落とし、かつこれを永続化するのが適当かも知れません。</p><pre class="programlisting">UPDATE mytable SET geom = ST_Force2D(geom);
VACUUM FULL ANALYZE mytable;</pre><p>AddGeometryColumn()を使ってジオメトリカラムを追加した場合、ジオメトリの次元に関する制限があることに注意してください。この制限を迂回するには、制限の削除が必要になります。geometry_columnsテーブル内のエントリを更新して、その後で制限を再作成することを忘れないで下さい。</p><p>大きなテーブルの場合、WHERE節、およびプライマリキー若しくは他の適切な基準によってテーブルの一部へのUPDATEを制限させて、UPDATEをより小さい塊に分割して、UPDATEの実行の間に単に"VACUUM;"と実行するのが賢いやり方かもしれません。これにより、テンポラリディスクスペースが劇的に減少します。さらに、次元混合のジオメトリを持つ場合、"WHERE dimension(the_geom)&gt;2"によってUPDATEを制限することで、2次元で書かれているジオメトリの再書き込みをスキップさせることができます。</p></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="idp52623104"></a>第7章 アプリケーションのビルド</h1></div></div></div><div class="toc"><div class="toc-title">目次</div><dl class="toc"><dt><span class="sect1"><a href="#Using_MapServer">7.1. MapServerを使う</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp52627968">7.1.1. 基本的な使い方</a></span></dt><dt><span class="sect2"><a href="#idp52659968">7.1.2. よくある質問</a></span></dt><dt><span class="sect2"><a href="#idp52679936">7.1.3. 踏み込んだ使用法</a></span></dt><dt><span class="sect2"><a href="#idp52688384">7.1.4. 例</a></span></dt></dl></dd><dt><span class="sect1"><a href="#idp52694912">7.2. Javaクライアント (JDBC)</a></span></dt><dt><span class="sect1"><a href="#idp52738816">7.3. Cクライアント (libpq)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp52739840">7.3.1. テキストカーソル</a></span></dt><dt><span class="sect2"><a href="#idp52740992">7.3.2. バイナリカーソル</a></span></dt></dl></dd></dl></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Using_MapServer"></a>7.1. MapServerを使う</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="#idp52627968">7.1.1. 基本的な使い方</a></span></dt><dt><span class="sect2"><a href="#idp52659968">7.1.2. よくある質問</a></span></dt><dt><span class="sect2"><a href="#idp52679936">7.1.3. 踏み込んだ使用法</a></span></dt><dt><span class="sect2"><a href="#idp52688384">7.1.4. 例</a></span></dt></dl></div><p>Minnesota MapServer は、OpenGIS Web Map Service仕様に準拠したインターネットWebマッピングサーバです。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>MapServerのウェブサイトは<a class="ulink" href="http://mapserver.org/" target="_top">http://mapserver.org/</a>です。</p></li><li class="listitem"><p>OpenGIS Web Map Serviceの仕様書は<a class="ulink" href="http://www.opengeospatial.org/standards/wms" target="_top">http://www.opengeospatial.org/standards/wms</a>にあります。</p></li></ul></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idp52627968"></a>7.1.1. 基本的な使い方</h3></div></div></div><p>PostGISとMapServerとを併用するには、MapServerの設定方法を知る必要がありますが、本文書の範囲外です。本節では、PostGIS独特の問題と設定詳細について説明します。</p><p>PostGISをMapServerで使うには、次のものが必要です。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>PostGIS 0.6以上</p></li><li class="listitem"><p>MapServer 3.5以上</p></li></ul></div><p>MapServerは、他のPostgreSQLクライアントと同じくPostGIS/PostgreSQLデータにアクセスします。アクセスには<code class="filename">libpq</code>インタフェースを使います。つまり、MapServerは、PostGISサーバにアクセスするあらゆるネットワークに繋がっている計算機にインストールすることができ、PostGISをデータソースとして利用できます。システム間の接続が速いほど良くなります。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>"--with-postgis"と好きなconfigureオプションを付けてMpaServerのコンパイルとインストールを行います。</p></li><li class="listitem"><p>Mapserverのmapファイルの中に、PostGISレイヤを追加します。たとえば次のようになります。</p><pre class="programlisting">LAYER
  CONNECTIONTYPE postgis
  NAME "widehighways"
  # リモートの空間データベースに接続します
  CONNECTION "user=dbuser dbname=gisdatabase host=bigserver"
  PROCESSING "CLOSE_CONNECTION=DEFER"
  # 'roads'テーブルの'geom'カラムからラインを取得します
  DATA "geom from roads using srid=4326 using unique gid"
  STATUS ON
  TYPE LINE
  # 範囲内のラインである広い高速道路のみ描画します
  FILTER "type = 'highway' and numlanes &gt;= 4"
  CLASS
    # 非常に広い高速道路はより明るい色かつ2ピクセル幅にします
    EXPRESSION ([numlanes] &gt;= 6)
    STYLE
      COLOR 255 22 22
      WIDTH 2
    END
  END
  CLASS
     # 残りは、暗い色かつ1ピクセル幅です
    EXPRESSION ([numlanes] &lt; 6)
    STYLE
      COLOR 205 92 82
    END
  END
END</pre><p>上の例におけるPostGIS特有のディレクティブは次の通りです。</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">CONNECTIONTYPE</span></dt><dd><p>PostGISレイヤでは常に"postgis"とします。</p></dd><dt><span class="term">CONNECTION</span></dt><dd><p>データベース接続は「接続文字列」によって制御されます。接続文字列は、次に示すような標準的なキーと値からなります(&lt;&gt;内はデフォルト値)。</p><p>user=&lt;ユーザ名&gt; password=&lt;パスワード&gt; dbname=&lt;ユーザ名&gt; hostname=&lt;サーバ&gt; port=&lt;5432&gt;</p><p>空の接続文字列も妥当とされますし、あらゆるキーと値のペアは省略できます。接続するためには一般的にはdbnameとusernameとが最少で与えるものとなります。</p></dd><dt><span class="term">DATA</span></dt><dd><p>このパラメータの形式は "&lt;カラム名&gt; from &lt;テーブル名&gt; using srid=&lt;SRID&gt; using unique &lt;主キー&gt;"となります。ここで、カラム名は地図に描画したい空間カラムを指し、SRIDはそのカラムで使われるSRIDで、主キーはそのテーブルの主キー (またはインデックスを伴う一意の値を持つカラム)です。</p><p>"using srid"と"using unique"節は省略できます。MapServerは可能なら自動的に正しい値を判断しますが、地図を描画するサーバ上で余分なクエリを若干実行するコストがかかります。</p></dd><dt><span class="term">PROCESSING</span></dt><dd><p>接続を閉じずに複数のレイヤで再利用する場合にCLOSE_CONNECTION=DEFERとします。速度が改善します。詳細な説明については<a class="ulink" href="http://blog.cleverelephant.ca/2008/10/mapserverpostgis-performance-tips.html" target="_top">MapServer PostGIS Performance Tips</a>を参照して下さい。 </p></dd><dt><span class="term">FILTER</span></dt><dd><p>フィルタは、妥当なSQL文字列でなければなりません。この文字列は、通常はSQLクエリにおける"WHERE"に続く論理式に対応します。たとえば、6レーン以上の道路だけを描画する場合には、"num_lanes &gt;= 6"というフィルタを使います。</p></dd></dl></div></li><li class="listitem"><p>空間データベースにおいては、空間 (GiST)インデックスを、マップに描かれるレイヤ全てに構築していることを保証して下さい。</p><pre class="programlisting">CREATE INDEX [インデックス名] ON [テーブル名] USING GIST ( [ジオメトリカラム] );</pre></li><li class="listitem"><p>MapServerを使用するレイヤのクエリを実行する場合には、"using unique"節もDATAステートメントに追加しなければなりません。</p><p>MapServerでは、クエリ実行の際には、それぞれの空間レコードを識別するための一意な識別子が必要です。MapServerのPostGISモジュールは、一意な識別子を提供するために、ユーザ指定の一意な値を使います。テーブルの主キーを使うのが最も良い方法です。</p></li></ol></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idp52659968"></a>7.1.2. よくある質問</h3></div></div></div><div class="qandaset"><a name="idp52660608"></a><dl><dt>7.1.2.1. <a href="#idp52660864">EXPRESSIONをマップファイルで使う時に、値がテーブルにあるのを確認しているのに条件がtrueになりません。</a></dt><dt>7.1.2.2. <a href="#idp52663936">シェープファイルに使用している FILTER が、同じデータを持つPostGISテーブルでは動作しません。</a></dt><dt>7.1.2.3. <a href="#idp52666368">PostGISレイヤは、シェープファイルレイヤよりもはるかに遅く描画しますが、これは正常ですか?</a></dt><dt>7.1.2.4. <a href="#idp52669184">PostGISレイヤはちゃんと描けましたが、クエリが本当に遅いです。何が問題なのですか?</a></dt><dt>7.1.2.5. <a href="#idp52672640">ジオグラフィカラム (PostGIS 1.5で機能追加)をMapServerのレイヤのソースとして使用できますか?</a></dt></dl><table border="0" style="width: 100%;"><colgroup><col align="left" width="1%"><col></colgroup><tbody><tr class="question"><td align="left" valign="top"><a name="idp52660864"></a><a name="idp52661120"></a><p><b>7.1.2.1.</b></p></td><td align="left" valign="top"><p><code class="varname">EXPRESSION</code>をマップファイルで使う時に、値がテーブルにあるのを確認しているのに条件がtrueになりません。</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>EXPRESIONで使うフィールド名は、シェープファイルと違ってPostGISの場合<span class="emphasis"><em>小文字</em></span>になります。</p><pre class="programlisting">EXPRESSION ([numlanes] &gt;= 6)</pre></td></tr><tr class="question"><td align="left" valign="top"><a name="idp52663936"></a><a name="idp52664192"></a><p><b>7.1.2.2.</b></p></td><td align="left" valign="top"><p>シェープファイルに使用している FILTER が、同じデータを持つPostGISテーブルでは動作しません。</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>シェープファイルと違い、PostGISレイヤのフィルタはSQL構文を使います (PostGISコネクタがMapServerでレイヤを描画するために生成するSQLステートメントに追加されます)。</p><pre class="programlisting">FILTER "type = 'highway' and numlanes &gt;= 4"</pre></td></tr><tr class="question"><td align="left" valign="top"><a name="idp52666368"></a><a name="idp52666624"></a><p><b>7.1.2.3.</b></p></td><td align="left" valign="top"><p>PostGISレイヤは、シェープファイルレイヤよりもはるかに遅く描画しますが、これは正常ですか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>一般に、与えられた地図に描画する地物が多いほど、PostGISはシェープファイルより遅くなる可能性が高くなります。相対的に地物が少ない (100個台)地図では、PostGISの方が速くなることがしばしばあります。地物が少多い (1000個台)地図では、PostGISは常に遅くなります。 </p><p>重大な描画性能の問題があるようでしたら、テーブルにある空間インデックスを構築していないというのがありそうです。</p><pre class="programlisting">postgis# CREATE INDEX geotable_gix ON geotable USING GIST ( geocolumn );
postgis# VACUUM ANALYZE;</pre></td></tr><tr class="question"><td align="left" valign="top"><a name="idp52669184"></a><a name="idp52669440"></a><p><b>7.1.2.4.</b></p></td><td align="left" valign="top"><p>PostGISレイヤはちゃんと描けましたが、クエリが本当に遅いです。何が問題なのですか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>クエリを早くするには、空間テーブルに一意なキーを持たせ、そのキーにインデックスを持たせなければなりません。</p><p><code class="varname">DATA</code>行の<code class="varname">USING UNIQUE</code>節で、MapServerで使用する一意なキーをどれにするか指定することができます。</p><pre class="programlisting">DATA "geom FROM geotable USING UNIQUE gid"</pre></td></tr><tr class="question"><td align="left" valign="top"><a name="idp52672640"></a><a name="idp52672896"></a><p><b>7.1.2.5.</b></p></td><td align="left" valign="top"><p>ジオグラフィカラム (PostGIS 1.5で機能追加)をMapServerのレイヤのソースとして使用できますか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>できます!MapServerはジオグラフィカラムをジオメトリカラムと同じに認識します。しかし、常にSRIDを4326とします。"using srid=4326"節を<code class="varname">DATA</code>ステートメントに入れて下さい。他の部分はジオメトリの場合と同じです。</p><pre class="programlisting">DATA "geog FROM geogtable USING SRID=4326 USING UNIQUE gid"</pre></td></tr></tbody></table></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idp52679936"></a>7.1.3. 踏み込んだ使用法</h3></div></div></div><p><code class="varname">USING</code>疑似SQL節を使ってMapServerがより複雑なクエリの結果を理解できるようにするための情報を追加します。より詳しく言うと、ビューまたは副問い合わせが元テーブル (<code class="varname">DATA</code>定義で"FROM"の右にあるもの)として使われる時、MapServerが自動的に一意な識別子がそれぞれの行にあるか、また、SRIDがテーブルにあるかを判別するのは困難です。<code class="varname">USING</code>節によって、MapServerがこれらの情報を得ることができます。例を次に挙げます。</p><pre class="programlisting">DATA "geom FROM (
  SELECT
    table1.geom AS geom,
    table1.gid AS gid,
    table2.data AS data
  FROM table1
  LEFT JOIN table2
  ON table1.id = table2.id
) AS new_table USING UNIQUE gid USING SRID=4326"</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term">USING UNIQUE &lt;uniqueid&gt;</span></dt><dd><p>MapServerは、マップクエリを実行する際、行識別のために、それぞれの行に一意な識別子を求めます。通常ならシステムテーブルから主キーを識別しますが、ビューや副問い合わせでは、一意性のあるカラムを自動的に知ることができません。MapServerのクエリ機能を使いたいなら、一意性のあるカラムをビューまたは副問い合わせに追加する必要があり、<code class="varname">USING UNIQUE</code>宣言を付ける必要があります。たとえば、この目的のための主キー値のテーブルでのカラム名や、結果セットで一意性が保障されたカラムを明示的にSELECTに入れることができます。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>「マップクエリ」はマップ上でクリックして、その場所におけるフィーチャーに関する情報を問い合わせる動作です。「マップクエリ」と<code class="varname">DATA</code>定義におけるSQLクエリと混同しないで下さい。</p></td></tr></table></div></dd><dt><span class="term">USING SRID=&lt;srid&gt;</span></dt><dd><p>PostGISは、MapServerに正しいデータを返すために、ジオメトリがどの空間参照系を使っているかを知る必要があります。通常は、この情報はPostGISデータベースの"geometry_columns"テーブルから得ることができます。しかし、副問い合わせやビューのような一時テーブルでは、この方法は不可能です。そこで、 <code class="varname">USING SRID=</code>オプションを使って、正しいSRIDが<code class="varname">DATA</code>定義で使われるように指定します。</p></dd></dl></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idp52688384"></a>7.1.4. 例</h3></div></div></div><p>簡単な例から始めて、ステップアップしていきましょう。次のMapServerレイヤ定義を考えて下さい。</p><pre class="programlisting">LAYER
  CONNECTIONTYPE postgis
  NAME "roads"
  CONNECTION "user=theuser password=thepass dbname=thedb host=theserver"
  DATA "geom from roads"
  STATUS ON
  TYPE LINE
  CLASS
    STYLE
      COLOR 0 0 0
    END
  END
END</pre><p>このレイヤは"roads"テーブルにある道路ジオメトリの全部を黒線で表示するものです。</p><p>では、少なくとも1:100000にズームするまでは高速道路だけを表示したい、としましょう。次の二つのレイヤで、その効果が実現できます。</p><pre class="programlisting">LAYER
  CONNECTIONTYPE postgis
  CONNECTION "user=theuser password=thepass dbname=thedb host=theserver"
  PROCESSING "CLOSE_CONNECTION=DEFER"
  DATA "geom from roads"
  MINSCALE 100000
  STATUS ON
  TYPE LINE
  FILTER "road_type = 'highway'"
  CLASS
    COLOR 0 0 0
  END
END
LAYER
  CONNECTIONTYPE postgis
  CONNECTION "user=theuser password=thepass dbname=thedb host=theserver"
  PROCESSING "CLOSE_CONNECTION=DEFER"
  DATA "geom from roads"
  MAXSCALE 100000
  STATUS ON
  TYPE LINE
  CLASSITEM road_type
  CLASS
    EXPRESSION "highway"
    STYLE
      WIDTH 2
      COLOR 255 0 0
    END
  END
  CLASS
    STYLE
      COLOR 0 0 0
    END
  END
END</pre><p>一つ目のレイヤはスケールが1:100000以上であるときに使われ、道路タイプが"highway"である道路のみ黒線で表示されます。<code class="varname">FILTER</code>オプションによって、道路タイプが"highway"の場合のみ表示することになります。</p><p>二つ目のレイヤはスケールが1:100000未満である時に使われ、"highway"は赤い二重細線で表示され、他の道路は黒線で表示されます。</p><p>さて、MapServerの機能を使うだけで、二つのおもしろいことを実行しました。しかし、<code class="varname">DATA</code>のSQLステートメントは、単純なままです。道路名が (どういう理由かは知りませんが)他のテーブルに収められていて、それのデータを取得するためにテーブルを連結して、道路のラベルを取る必要がある、とします。</p><pre class="programlisting">LAYER
  CONNECTIONTYPE postgis
  CONNECTION "user=theuser password=thepass dbname=thedb host=theserver"
  DATA "geom FROM (SELECT roads.gid AS gid, roads.geom AS geom,
        road_names.name as name FROM roads LEFT JOIN road_names ON
        roads.road_name_id = road_names.road_name_id)
        AS named_roads USING UNIQUE gid USING SRID=4326"
  MAXSCALE 20000
  STATUS ON
  TYPE ANNOTATION
  LABELITEM name
  CLASS
    LABEL
      ANGLE auto
      SIZE 8
      COLOR 0 192 0
      TYPE truetype
      FONT arial
    END
  END
END</pre><p>このANNOTAIONレイヤでは、縮尺が1:20000以下のときに、全ての道路に緑色のラベルを表示します。また、この例は、 <code class="varname">DATA</code>定義で、SQLのJOINを使用する方法も示しています。</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp52694912"></a>7.2. Javaクライアント (JDBC)</h2></div></div></div><p>Javaクライアントは、直接的にテキスト表現として、またはPostGISに同梱されているJDBC拡張オブジェクトを使用して、PostgreSQLデータベース内にある、PostGISの"geometry"オブジェクトにアクセスできます。JDBC拡張オブジェクトを使うためには、"postgis.jar"ファイルを、JDBCドライバパッケージの"postgresql.jar"とともに、 CLASSPATHに置く必要があります。</p><pre class="programlisting">import java.sql.*;
import java.util.*;
import java.lang.*;
import org.postgis.*;

public class JavaGIS {

public static void main(String[] args) {

  java.sql.Connection conn;

  try {
    /*
    * JDBCドライバをロードして接続を確立します。
    */
    Class.forName("org.postgresql.Driver");
    String url = "jdbc:postgresql://localhost:5432/database";
    conn = DriverManager.getConnection(url, "postgres", "");
    /*
    * ジオメトリ型を接続に追加します。
    * ご注意 : addDateType()を呼ぶ前に
    *   接続をpgsql特有の接続実装にキャストしなければなりません。
    */
    ((org.postgresql.PGConnection)conn).addDataType("geometry",Class.forName("org.postgis.PGgeometry"));
    ((org.postgresql.PGConnection)conn).addDataType("box3d",Class.forName("org.postgis.PGbox3d"));
    /*
    * ステートメントの生成とSELECTクエリの実行を行います。
    */
    Statement s = conn.createStatement();
    ResultSet r = s.executeQuery("select geom,id from geomtable");
    while( r.next() ) {
      /*
      * ジオメトリをオブジェクトとして検索してジオメトリ型にキャストします。
      * オブジェクトを印字します
      */
      PGgeometry geom = (PGgeometry)r.getObject(1);
      int id = r.getInt(2);
      System.out.println("Row " + id + ":");
      System.out.println(geom.toString());
    }
    s.close();
    conn.close();
  }
catch( Exception e ) {
  e.printStackTrace();
  }
}
}</pre><p>"PGeometry"オブジェクトは、Point、LineString、Polygon、MultiPoint、MultiLineString、MultiPolygonの各型に依存する、特定のトポロジカルジオメトリオブジェクト ("Geometory"抽象クラスの子クラス)を持つラッパオブジェクトです。</p><pre class="programlisting">PGgeometry geom = (PGgeometry)r.getObject(1);
if( geom.getType() == Geometry.POLYGON ) {
  Polygon pl = (Polygon)geom.getGeometry();
  for( int r = 0; r &lt; pl.numRings(); r++) {
    LinearRing rng = pl.getRing(r);
    System.out.println("Ring: " + r);
    for( int p = 0; p &lt; rng.numPoints(); p++ ) {
      Point pt = rng.getPoint(p);
      System.out.println("Point: " + p);
      System.out.println(pt.toString());
    }
  }
}</pre><p>幾何オブジェクトのさまざまなデータアクセサ関数に関する参照情報については、拡張オブジェクトのJavaDocをご覧下さい。</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp52738816"></a>7.3. Cクライアント (libpq)</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="#idp52739840">7.3.1. テキストカーソル</a></span></dt><dt><span class="sect2"><a href="#idp52740992">7.3.2. バイナリカーソル</a></span></dt></dl></div><p>...</p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idp52739840"></a>7.3.1. テキストカーソル</h3></div></div></div><p>...</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idp52740992"></a>7.3.2. バイナリカーソル</h3></div></div></div><p>...</p></div></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="reference"></a>第8章 PostGISリファレンス</h1></div></div></div><div class="toc"><div class="toc-title">目次</div><dl class="toc"><dt><span class="sect1"><a href="#PostGIS_Types">8.1. PostGIS Geometry/Geography/Box データ型</a></span></dt><dt><span class="sect1"><a href="#PostGIS_GUC">8.2. Grand Unified Custom変数 (GUC)</a></span></dt><dt><span class="sect1"><a href="#Management_Functions">8.3. テーブル管理関数</a></span></dt><dt><span class="sect1"><a href="#Geometry_Constructors">8.4. ジオメトリ コンストラクタ</a></span></dt><dt><span class="sect1"><a href="#Geometry_Accessors">8.5. ジオメトリアクセサ</a></span></dt><dt><span class="sect1"><a href="#Geometry_Editors">8.6. ジオメトリエディタ</a></span></dt><dt><span class="sect1"><a href="#Geometry_Outputs">8.7. ジオメトリ出力</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp57208576">8.7.1. Well-Known Text (WKT)</a></span></dt><dt><span class="sect2"><a href="#idp57301632">8.7.2. Well-Known Binary (WKB)</a></span></dt><dt><span class="sect2"><a href="#idp57392256">8.7.3. その他の書式</a></span></dt></dl></dd><dt><span class="sect1"><a href="#Operators">8.8. 演算子</a></span></dt><dd><dl><dt><span class="sect2"><a href="#operators-bbox">8.8.1. バウンディングボックス演算子</a></span></dt><dt><span class="sect2"><a href="#operators-distance">8.8.2. 距離演算子</a></span></dt></dl></dd><dt><span class="sect1"><a href="#Measurement_Functions">8.9. 計測関数</a></span></dt><dt><span class="sect1"><a href="#reference_sfcgal">8.10. SFCGAL関数</a></span></dt><dt><span class="sect1"><a href="#Geometry_Processing">8.11. ジオメトリ処理関数</a></span></dt><dt><span class="sect1"><a href="#Linear_Referencing">8.12. 線型参照</a></span></dt><dt><span class="sect1"><a href="#Long_Transactions_Support">8.13. ロングトランザクション機能</a></span></dt></dl></div><p>ここで示す関数はPostGISユーザが必要とすると思われる関数です。この他に、一般的なユーザが使わないPostGISオブジェクトに対して求められるサポート関数があります。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>PostGISは、既存の名前付け方針からSQL-MM中心の方針への切り替えを開始しています。結果として、ユーザが知っていて愛用している関数の多くが標準空間型 (ST) プレフィクスを使うように名前変更されました。以前の関数はまだ有効ですが、更新された等価な関数があるものについては、この文書の一覧から外しています (訳注: 非推奨関数はPostGIS 2.0では基本的に外れています)。これらの関数は非推奨であり、将来のリリースでは削除されますので、*使わないでください*。</p></td></tr></table></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="PostGIS_Types"></a>8.1. PostGIS Geometry/Geography/Box データ型</h2></div><div><div class="abstract"><div class="abstract-title">概要</div><p>このセクションでは、空間データを表現するためにPostGISとともにインストールされたカスタムPostgreSQLデータ型の一覧を示します。 </p><p>データ型ごとに、型キャストのふるまいが記述されています。<a class="ulink" href="https://www.postgresql.jp/document/current/html/sql-expressions.html#SQL-SYNTAX-TYPE-CASTS" target="_top">型キャスト</a>によって、あるデータ型の値が他のデータ型に変換されます。PostgreSQLでは、型を変換するために使われる関数に加えて、ユーザ定義型のキャストのふるまいの定義が可能です。キャストは<span class="bold"><strong>自動</strong></span>的なふるまいを持つことができ、それによって、関数の引数をその関数が対応する型に自動的に変換できます。</p><p>キャストには<span class="bold"><strong>明示的な</strong></span>ふるまいがあります。このふるまいは、キャストは<code class="varname">CAST(myval As sometype)</code>または<code class="varname">myval::sometype</code>という書式で指定されます。与えられた型に対応していないオーバロード関数を使うときに発生するあいまいなキャストの問題は、明示的なキャストによって回避できます。例えば、関数はbox2dまたはbox3dを受け付けるがジオメトリを受け付けない場合です。ジオメトリはボックス型の両方への自動キャストが可能なため、「あいまいな関数」エラーが発生します。このエラーを防ぐには、求められるボックス型への明示的なキャストを使用します。</p><p>全てのデータ型は<code class="varname">text</code>にキャストできます。このため、明示的に指定する必要はありません。</p></div></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#box2d_type">box2d</a></span><span class="refpurpose"> — 2次元バウンディングボックスを表現する型。 </span></dt><dt><span class="refentrytitle"><a href="#box3d_type">box3d</a></span><span class="refpurpose"> — 3次元バウンディングボックスを表現する型。 </span></dt><dt><span class="refentrytitle"><a href="#geometry">geometry</a></span><span class="refpurpose"> — 平面座標系を持つ空間地物を表現する型。</span></dt><dt><span class="refentrytitle"><a href="#geometry_dump">geometry_dump</a></span><span class="refpurpose"> — 複雑なジオメトリの部品を記述するために使われる複合型です。</span></dt><dt><span class="refentrytitle"><a href="#geography">geography</a></span><span class="refpurpose"> — 地理座標系 (回転楕円体)座標系を持つ空間地物を表現する型です。</span></dt></dl></div><div class="refentry"><a name="box2d_type"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>box2d — 2次元バウンディングボックスを表現する型。 </p></div><div class="refsection"><a name="idp52830592"></a><h2>説明</h2><p><code class="varname">box2d</code>は、ジオメトリまたはジオメトリコレクションの、2次元の囲い込んでいるボックスを表現するために使われる空間データ型です。たとえば、集約関数<a class="xref" href="#">???</a>は<code class="varname">box2d</code>インスタンスを返します。</p><p><code class="varname">xmin, ymin, xmax, ymax</code>の値を含む表現。これらは、XとYの範囲の最小値と最大値を示しています。 </p><p><code class="varname">box2d</code>のテキスト表現は<code class="code">BOX(1 2,5 6)</code>のようになります。 </p></div><div class="refsection"><a name="idp52834432"></a><h2>キャストの挙動</h2><p>このテーブルでは、このデータ型で許容される明示的なキャストと自動キャストの一覧を挙げます。</p><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col><col></colgroup><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">キャスト先</td><td style="border-bottom: 1px solid ; ">挙動</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">box3d</td><td style="border-bottom: 1px solid ; ">自動</td></tr><tr><td style="border-right: 1px solid ; ">geometry</td><td style="">自動</td></tr></tbody></table></div></div><div class="refsection"><a name="idp52840576"></a><h2>関連情報</h2><p><a class="xref" href="#PostGIS_BoxFunctions" title="15.7. PostGISボックス関数">「PostGISボックス関数」</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="box3d_type"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>box3d — 3次元バウンディングボックスを表現する型。 </p></div><div class="refsection"><a name="idp52843648"></a><h2>説明</h2><p><code class="varname">box3d</code>は、ジオメトリまたはジオメトリのコレクションを囲む3次元のボックスを表現するために使われるPostGIS空間データ型です。たとえば、集約関数の<a class="xref" href="#">???</a>は<code class="varname">box3d</code>オブジェクトを返します。 </p><p>この表現は、<code class="varname">xmin, ymin, zmin, xmax, ymax, zmax</code>です。これらは、X, Y, Zの範囲の最小値と最大値を取ります。 </p><p><code class="varname">box3d</code>のテキスト表現は<code class="code">BOX3D(1 2 3,5 6 5)</code>のようになります。 </p></div><div class="refsection"><a name="idp52847616"></a><h2>キャストの挙動</h2><p>このテーブルでは、このデータ型で許容される明示的なキャストと自動キャストの一覧を挙げます。</p><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col><col></colgroup><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">キャスト先</td><td style="border-bottom: 1px solid ; ">挙動</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">box</td><td style="border-bottom: 1px solid ; ">自動</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">box2d</td><td style="border-bottom: 1px solid ; ">自動</td></tr><tr><td style="border-right: 1px solid ; ">geometry</td><td style="">自動</td></tr></tbody></table></div></div><div class="refsection"><a name="idp52859008"></a><h2>関連情報</h2><p><a class="xref" href="#PostGIS_BoxFunctions" title="15.7. PostGISボックス関数">「PostGISボックス関数」</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="geometry"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>geometry — 平面座標系を持つ空間地物を表現する型。</p></div><div class="refsection"><a name="idp52861952"></a><h2>説明</h2><p><code class="varname">geometry</code>は、平面 (ユークリッド)座標系上の地物を表現するために使われる基本的なPostGISの空間データ型です。</p><p>ジオメトリ上の全ての空間演算子は、ジオメトリが所属する空間参照系の単位を使います。</p></div><div class="refsection"><a name="idp52863872"></a><h2>キャストの挙動</h2><p>このテーブルでは、このデータ型で許容される明示的なキャストと自動キャストの一覧を挙げます。</p><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col><col></colgroup><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">キャスト先</td><td style="border-bottom: 1px solid ; ">挙動</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">box</td><td style="border-bottom: 1px solid ; ">自動</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">box2d</td><td style="border-bottom: 1px solid ; ">自動</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">box3d</td><td style="border-bottom: 1px solid ; ">自動</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">bytea</td><td style="border-bottom: 1px solid ; ">自動</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">geography</td><td style="border-bottom: 1px solid ; ">自動</td></tr><tr><td style="border-right: 1px solid ; ">text</td><td style="">自動</td></tr></tbody></table></div></div><div class="refsection"><a name="idp52874624"></a><h2>関連情報</h2><p><a class="xref" href="#RefObject" title="4.1. 空間データ モデル">「空間データ モデル」</a>, <a class="xref" href="#PostGIS_SQLMM_Functions" title="15.3. PostGIS SQL-MM準拠関数">「PostGIS SQL-MM準拠関数」</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="geometry_dump"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>geometry_dump — 複雑なジオメトリの部品を記述するために使われる複合型です。</p></div><div class="refsection"><a name="idp52877952"></a><h2>説明</h2><p><code class="varname">geometry_dump</code>は、次のフィールドを持つ<a class="ulink" href="https://www.postgresql.jp/document/current/html/rowtypes.html" target="_top">複合型</a>です。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="varname">geom</code> - ダンプされたジオメトリの要素を表現するジオメトリです。ジオメトリタイプは、使われた関数に依存します。</p></li><li class="listitem"><p><code class="varname">path[]</code> - ダンプされたジオメトリ内における<code class="varname">geom</code>要素へのパスを定義する1次整数配列。パス配列は1始まりです (<code class="varname">path[1]</code>が最初の要素です)。</p></li></ul></div><p><code class="varname">ST_Dump*</code>系関数で複雑なジオメトリを構成部品に分解する出力型として使います。</p></div><div class="refsection"><a name="idp52883712"></a><h2>関連情報</h2><p><a class="xref" href="#PostGIS_Geometry_DumpFunctions" title="15.6. PostGISジオメトリ/ジオグラフィ/ラスタのダンプ関数">「PostGISジオメトリ/ジオグラフィ/ラスタのダンプ関数」</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="geography"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>geography — 地理座標系 (回転楕円体)座標系を持つ空間地物を表現する型です。</p></div><div class="refsection"><a name="idp52886784"></a><h2>説明</h2><p><code class="varname">geography</code>は、地理座標系上で地物を表現するために使われる空間型です。地理座標系は回転楕円体で地球をモデル化します。 </p><p>ジオグラフィ型を用いた空間演算によって、回転楕円体モデルを考慮するので、より精度の良い結果が得られます。 </p></div><div class="refsection"><a name="idp52888576"></a><h2>キャストの挙動</h2><p>このテーブルでは、このデータ型で許容される明示的なキャストと自動キャストの一覧を挙げます。</p><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col><col></colgroup><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">キャスト先</td><td style="border-bottom: 1px solid ; ">挙動</td></tr><tr><td style="border-right: 1px solid ; ">geometry</td><td style="">明示的なキャスト</td></tr></tbody></table></div></div><div class="refsection"><a name="idp52905856"></a><h2>関連情報</h2><p><a class="xref" href="#PostGIS_Geography" title="4.3. ジオグラフィデータタイプ">「ジオグラフィデータタイプ」</a>, <a class="xref" href="#PostGIS_GeographyFunctions" title="15.4. PostGISジオグラフィ対応関数">「PostGISジオグラフィ対応関数」</a></p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="PostGIS_GUC"></a>8.2. Grand Unified Custom変数 (GUC)</h2></div><div><div class="abstract"><div class="abstract-title">概要</div><p>本節では、PostGIS GUC (Grand Unified Custom)変数の一覧を上げます。これらは、グローバル、データベースごと、セッションごと、またはトランザクションごとに設定できます。グローバルまたはデータベースごとの設定が最善です。</p></div></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#postgis_backend">postgis.backend</a></span><span class="refpurpose"> — GEOSとSFCGALで重複する関数を提供するバックエンドです。GEOSまたはSFCGALを選択します。デフォルトはGEOSです。</span></dt><dt><span class="refentrytitle"><a href="#postgis_gdal_datapath">postgis.gdal_datapath</a></span><span class="refpurpose"> — GDALのGDAL_DATAオプションの値を設定するためのコンフィギュレーションオプションです。設定しない場合には、GDAL_DATA環境変数が使われます。 </span></dt><dt><span class="refentrytitle"><a href="#postgis_gdal_enabled_drivers">postgis.gdal_enabled_drivers</a></span><span class="refpurpose"> — PostGIS環境でGDALドライバを有効にするコンフィギュレーションオプションです。GDALコンフィギュレーション変数GDAL_SKIPに影響を与えます。 </span></dt><dt><span class="refentrytitle"><a href="#postgis_enable_outdb_rasters">postgis.enable_outdb_rasters</a></span><span class="refpurpose"> — データベース外ラスタのバンドにアクセスできるようにする、真偽型のコンフィギュレーションオプション。 </span></dt><dt><span class="refentrytitle"><a href="#postgis_gdal_vsi_options">postgis.gdal_config_options</a></span><span class="refpurpose"> — データベース外ラスタを操作する時に使用するオプションを設定するためのコンフィギュレーション。 </span></dt></dl></div><div class="refentry"><a name="postgis_backend"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>postgis.backend — GEOSとSFCGALで重複する関数を提供するバックエンドです。GEOSまたはSFCGALを選択します。デフォルトはGEOSです。</p></div><div class="refsection"><a name="idp51148416"></a><h2>説明</h2><p>このGUCはSFCGALサポートでPostGISをコンパイルした場合にのみ適切なものとなります。デフォルトでは、<code class="varname">geos</code>バックエンドはGEOSとSFCGALが同じ名前の関数を持つ関数で使われます。この変数によって、SFCGALをリクエストを提供するバックエンドにすることができます。</p><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp51150336"></a><h2>例</h2><p>バックエンドを接続時にだけ設定します。</p><pre class="programlisting">set postgis.backend = sfcgal;</pre><p>データベースへの新規接続にバックエンドを設定します。</p><pre class="programlisting">ALTER DATABASE mygisdb SET postgis.backend = sfcgal;</pre></div><div class="refsection"><a name="idp51152896"></a><h2>関連情報</h2><p><a class="xref" href="#reference_sfcgal" title="8.10. SFCGAL関数">「SFCGAL関数」</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="postgis_gdal_datapath"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>postgis.gdal_datapath — GDALのGDAL_DATAオプションの値を設定するためのコンフィギュレーションオプションです。設定しない場合には、GDAL_DATA環境変数が使われます。 </p></div><div class="refsection"><a name="idp51155840"></a><h2>説明</h2><p>GDALのGDAL_DATAオプションの値の設定に使うPostgreSQL GUC変数です。<code class="varname">postgis.gdal_datapath</code>値は完全にGDALのデータファイルへの物理的なパスになるべきものです。 </p><p>コンフィギュレーションオプションは、GDALのデータファイルパスがハードコーディングされていないWindowsプラットフォームのためにほとんど使われます。このオプションは、GDALのデータファイルがGDALの期待されているパスに無いときに設定します。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>このオプションは、PostgreSQLのコンフィギュレーションファイルpostgresql.confで設定できます。コネクションまたはトランザクションでも設定できます。 </p></td></tr></table></div><p>Availability: 2.2.0</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>GDAL_DATAに関する追加情報報は、GDALの<a class="ulink" href="http://trac.osgeo.org/gdal/wiki/ConfigOptions" target="_top">Configuration Options</a>にあります。 </p></td></tr></table></div></div><div class="refsection"><a name="idp52966528"></a><h2>例</h2><p><code class="varname">postgis.gdal_datapath</code>の設定とリセット。</p><pre class="programlisting">SET postgis.gdal_datapath TO '/usr/local/share/gdal.hidden';
SET postgis.gdal_datapath TO default;
                </pre><p>Windows上における特定のデータベース上で設定する場合は次の通りです。</p><pre class="programlisting">ALTER DATABASE gisdb
SET postgis.gdal_datapath = 'C:/Program Files/PostgreSQL/9.3/gdal-data';</pre></div><div class="refsection"><a name="idp52969472"></a><h2>関連情報</h2><p><a class="xref" href="#RT_PostGIS_GDAL_Version" title="PostGIS_GDAL_Version">PostGIS_GDAL_Version</a>, <a class="xref" href="#RT_ST_Transform" title="ST_Transform">ST_Transform</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="postgis_gdal_enabled_drivers"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>postgis.gdal_enabled_drivers — PostGIS環境でGDALドライバを有効にするコンフィギュレーションオプションです。GDALコンフィギュレーション変数GDAL_SKIPに影響を与えます。 </p></div><div class="refsection"><a name="idp52972928"></a><h2>説明</h2><p>PostGIS環境でGDALドライバを有効にするコンフィギュレーションオプションです。GDALコンフィギュレーション変数GDAL_SKIPに影響を与えます。このオプションは、PostgreSQLのコンフィギュレーションファイルpostgresql.confで設定できます。コネクションまたはトランザクションでも設定できます。 </p><p><code class="varname">postgis.gdal_enabled_drivers</code>の初期値は、PostgreSQL開始プロセスに渡される、有効とするドライバの一覧からなる環境変数<code class="varname">POSTGIS_GDAL_ENABLED_DRIVERS</code>によって設定されます。 </p><p>有効にするGDALドライバは、ドライバの短縮名またはコードで指定します。ドライバの短縮名またはコードは<a class="ulink" href="http://www.gdal.org/formats_list.html" target="_top">GDAL Raster Formats</a>にあります。複数のドライバを指定するには、ドライバの間に一つの空白を置きます。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">postgis.gdal_enabled_drivers</code>には三つの特別なコードがあります。大文字小文字を区別します。 </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="varname">DISABLE_ALL</code> 全てのGDALドライバを無効にします。これが出現すると、 <code class="varname">postgis.gdal_enabled_drivers</code>にある他の全ての値を上書きします。</p></li><li class="listitem"><p><code class="varname">ENABLE_ALL</code> 全てのGDALドライバを有効にします。</p></li><li class="listitem"><p><code class="varname">VSICURL</code> GDALの仮想ファイルシステム<code class="varname">/vsicurl/</code>を有効にします。</p></li></ul></div><p>
                    </p><p><code class="varname">postgis.gdal_enabled_drivers</code>がDISABLE_ALLにっていされると、データベース外ラスタ, ST_FromGDALRaster(), ST_AsGDALRaster(), ST_AsTIFF(), ST_AsJPEG(), ST_AsPNG()を使おうとすると、エラーメッセージが返されます。 </p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>標準的なPostGISのインストールでは、 <code class="varname">postgis.gdal_enabled_drivers</code>はDISALBE_ALLに設定されます。 </p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>GDAL_SKIPに関する追加情報は、GDALの<a class="ulink" href="http://trac.osgeo.org/gdal/wiki/ConfigOptions" target="_top">Configuration Options</a>にあります。 </p></td></tr></table></div><p>Availability: 2.2.0</p></div><div class="refsection"><a name="idp52984960"></a><h2>例</h2><p> <code class="varname">postgis.gdal_enabled_drivers</code>の設定とリセット。</p><p>データベースへの新規接続にバックエンドを設定します。</p><pre class="programlisting">ALTER DATABASE mygisdb SET postgis.gdal_enabled_drivers TO 'GTiff PNG JPEG';</pre><p>サーバへの全ての新規接続のための、有効なドライバのデフォルトを設定します。スーパーユーザ権限とPostgreSQL 9.4以上が必要です。データベース設定、セッション設定、ユーザ設定によって上書きされます。</p><pre class="programlisting">ALTER SYSTEM SET postgis.gdal_enabled_drivers TO 'GTiff PNG JPEG';
SELECT pg_reload_conf();
                </pre><pre class="programlisting">SET postgis.gdal_enabled_drivers TO 'GTiff PNG JPEG';
SET postgis.gdal_enabled_drivers = default;
                </pre><p>全てのGDALドライバを有効にします。</p><pre class="programlisting">SET postgis.gdal_enabled_drivers = 'ENABLE_ALL';
                </pre><p>全てのGDALドライバを無効にします。</p><pre class="programlisting">SET postgis.gdal_enabled_drivers = 'DISABLE_ALL';
                </pre></div><div class="refsection"><a name="idp52990720"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_FromGDALRaster" title="ST_FromGDALRaster">ST_FromGDALRaster</a>, <a class="xref" href="#RT_ST_AsGDALRaster" title="ST_AsGDALRaster">ST_AsGDALRaster</a>, <a class="xref" href="#RT_ST_AsTIFF" title="ST_AsTIFF">ST_AsTIFF</a>, <a class="xref" href="#RT_ST_AsPNG" title="ST_AsPNG">ST_AsPNG</a>, <a class="xref" href="#RT_ST_AsJPEG" title="ST_AsJPEG">ST_AsJPEG</a>, <a class="xref" href="#postgis_enable_outdb_rasters" title="postgis.enable_outdb_rasters">postgis.enable_outdb_rasters</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="postgis_enable_outdb_rasters"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>postgis.enable_outdb_rasters — データベース外ラスタのバンドにアクセスできるようにする、真偽型のコンフィギュレーションオプション。 </p></div><div class="refsection"><a name="idp52995712"></a><h2>説明</h2><p>データベース外ラスタのバンドにアクセスできるようにする、真偽型のコンフィギュレーションオプションです。このオプションは、PostgreSQLのコンフィギュレーションファイルpostgresql.confで設定できます。コネクションまたはトランザクションでも設定できます。 </p><p><code class="varname">postgis.enable_outdb_rasters</code>の初期値は、環境変数<code class="varname">POSTGIS_ENABLE_OUTDB_RASTERS</code>が0でない値で、PostgreSQL開始プロセスに渡されることでで設定されます。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">postgis.enable_outdb_rasters</code>がTRUEであってでも、GUC <code class="varname">postgis.gdal_enabled_drivers</code>は、アクセス可能なラスタ書式を判定します。 </p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>標準的なPostGISのインストールでは、<code class="varname">postgis.enable_outdb_rasters</code>はFALSEに設定されています。 </p></td></tr></table></div><p>Availability: 2.2.0</p></div><div class="refsection"><a name="idp53004928"></a><h2>例</h2><p>現在のセッションでの<code class="varname">postgis.enable_outdb_rasters</code>の設定とリセット。</p><pre class="programlisting">SET postgis.enable_outdb_rasters TO True;
SET postgis.enable_outdb_rasters = default;
SET postgis.enable_outdb_rasters = True;
SET postgis.enable_outdb_rasters = False;
                </pre><p>特定のデータベースに対する設定</p><pre class="programlisting">ALTER DATABASE gisdb SET postgis.enable_outdb_rasters = true;
                </pre><p>データベースクラスタ全体の設定。変更を有効にするには、データベースに再接続する必要があります。</p><pre class="programlisting">-- postgres.auto.confへの書き込み
ALTER SYSTEM postgis.enable_outdb_rasters = true;
 --postgres confの再読み込み
SELECT pg_reload_conf();
                </pre></div><div class="refsection"><a name="idp53008768"></a><h2>関連情報</h2><p>
                    <a class="xref" href="#postgis_gdal_enabled_drivers" title="postgis.gdal_enabled_drivers">postgis.gdal_enabled_drivers</a>
                    <a class="xref" href="#postgis_gdal_vsi_options" title="postgis.gdal_config_options">postgis.gdal_config_options</a>
                </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="postgis_gdal_vsi_options"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>postgis.gdal_config_options — データベース外ラスタを操作する時に使用するオプションを設定するためのコンフィギュレーション。 </p></div><div class="refsection"><a name="idp53012352"></a><h2>説明</h2><p>データベース外ラスタを操作する時に使用するオプションを設定するためのコンフィギュレーション。<a class="ulink" href="http://trac.osgeo.org/gdal/wiki/ConfigOptions" target="_top">Configuration options</a>によって、どれだけGDALがローカルデータキャッシュを確保するか、オーバビューを読むかどうか、リモートのデータベース外データソースを使う際のアクセスキー等を制御します。 </p><p>Availability: 3.2.0</p></div><div class="refsection"><a name="idp53014400"></a><h2>例</h2><p>現在のセッションでの<code class="varname">postgis.gdal_vsi_options</code>の設定:</p><pre class="programlisting">SET postgis.gdal_config_options = 'AWS_ACCESS_KEY_ID=xxxxxxxxxxxxxxx AWS_SECRET_ACCESS_KEY=yyyyyyyyyyyyyyyyyyyyyyyyyy';
                </pre><p><code class="varname">LOCAL</code>キーワードを使う<span class="emphasis"><em>現在のトランザクション</em></span>のための<code class="varname">postgis.gdal_vsi_options</code>の設定:</p><pre class="programlisting">SET LOCAL postgis.gdal_config_options = 'AWS_ACCESS_KEY_ID=xxxxxxxxxxxxxxx AWS_SECRET_ACCESS_KEY=yyyyyyyyyyyyyyyyyyyyyyyyyy';
                </pre></div><div class="refsection"><a name="idp53018368"></a><h2>関連情報</h2><p>
                    <a class="xref" href="#postgis_enable_outdb_rasters" title="postgis.enable_outdb_rasters">postgis.enable_outdb_rasters</a>
                    <a class="xref" href="#postgis_gdal_enabled_drivers" title="postgis.gdal_enabled_drivers">postgis.gdal_enabled_drivers</a>
                </p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Management_Functions"></a>8.3. テーブル管理関数</h2></div><div><div class="abstract"><div class="abstract-title">概要</div><p>これらの関数は、ジオメトリカラムを含むテーブルの定義を支援します。 </p></div></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#AddGeometryColumn">AddGeometryColumn</a></span><span class="refpurpose"> — ジオメトリカラムを既存のテーブルに追加します。</span></dt><dt><span class="refentrytitle"><a href="#DropGeometryColumn">DropGeometryColumn</a></span><span class="refpurpose"> — ジオメトリカラムを空間テーブルから除去します。</span></dt><dt><span class="refentrytitle"><a href="#DropGeometryTable">DropGeometryTable</a></span><span class="refpurpose"> — テーブルとgeometry_columnsの当該テーブルへの参照の全てを削除します。</span></dt><dt><span class="refentrytitle"><a href="#Find_SRID">Find_SRID</a></span><span class="refpurpose"> — ジオメトリカラムで定義されているSRIDを返します。</span></dt><dt><span class="refentrytitle"><a href="#Populate_Geometry_Columns">Populate_Geometry_Columns</a></span><span class="refpurpose"> — ジオメトリカラムが型修飾子で定義されるか、適切な空間制約を持つようにします。</span></dt><dt><span class="refentrytitle"><a href="#UpdateGeometrySRID">UpdateGeometrySRID</a></span><span class="refpurpose"> — ジオメトリカラム内の全ての地物のSRIDを更新し、テーブルのメタデータを更新します。 </span></dt></dl></div><div class="refentry"><a name="AddGeometryColumn"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>AddGeometryColumn — ジオメトリカラムを既存のテーブルに追加します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">AddGeometryColumn</b>(</code>varchar  <var class="pdparam">table_name</var>, varchar  <var class="pdparam">column_name</var>, integer  <var class="pdparam">srid</var>, varchar  <var class="pdparam">type</var>, integer  <var class="pdparam">dimension</var>, boolean  <var class="pdparam">use_typmod=true</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">AddGeometryColumn</b>(</code>varchar  <var class="pdparam">schema_name</var>, varchar  <var class="pdparam">table_name</var>, varchar  <var class="pdparam">column_name</var>, integer  <var class="pdparam">srid</var>, varchar  <var class="pdparam">type</var>, integer  <var class="pdparam">dimension</var>, boolean  <var class="pdparam">use_typmod=true</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">AddGeometryColumn</b>(</code>varchar  <var class="pdparam">catalog_name</var>, varchar  <var class="pdparam">schema_name</var>, varchar  <var class="pdparam">table_name</var>, varchar  <var class="pdparam">column_name</var>, integer  <var class="pdparam">srid</var>, varchar  <var class="pdparam">type</var>, integer  <var class="pdparam">dimension</var>, boolean  <var class="pdparam">use_typmod=true</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp53156224"></a><h2>説明</h2><p>ジオメトリカラムを既存の属性テーブルに追加します。<code class="varname">schema_name</code>はスキーマ名です。<code class="varname">srid</code>はSPATIAL_REF_SYSテーブルのエントリを参照する整数でなければなりません。<code class="varname">type</code>は'POLYGON'や'MULTILINESTRING'といった、ジオメトリタイプを示す文字でなければなりません。指定したスキーマが存在しない (または現在のsearch_pathからは見えない)場合、または指定したSRID、ジオメトリタイプもしくは次元が不正である場合はエラーが投げられます。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Changed: 2.0.0 geometry_columnsがシステムカタログを読むビューになったため、geometry_columnsを更新しないようになりました。デフォルトでは制約を生成せず、PostgreSQLの型修飾子を使います。この関数によるWGS 84のPOINTカラムの構築と<code class="code">ALTER TABLE some_table ADD COLUMN geom geometry(Point,4326);</code>とは等価です。 </p><p>Changed: 2.0.0 制約を使う必要がある場合には、<code class="varname">use_typmod</code>をFALSEにします。</p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Changed: 2.0.0 ビューについては、geometry_columnsへの手動登録はできなくなりました。しかし、typmodテーブルジオメトリに対して構築されていて、かつラッパ関数が無いビューは、親テーブルカラムのtypmodの挙動を継承するので、正しく登録されます。他のジオメトリを出力するジオメトリ関数を使うビューについては、ビューのジオメトリカラムが正しく登録されるようにするため、typmodジオメトリへのキャストが必要です。<a class="xref" href="#Manual_Register_Spatial_Column" title="4.4.3. 手動でジオメトリカラムをgeometry_columnsに登録する">「手動でジオメトリカラムをgeometry_columnsに登録する」</a>を参照して下さい。 </p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OGC Simple Features
 Implementation Specification for SQL 1.1.</a></p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p>Enhanced: 2.0.0 use_typmod引数が導入されました。デフォルトでは制約を基にしたものでなくtypmodジオメトリカラムが生成されます。</p></div><div class="refsection"><a name="idp53190016"></a><h2>例</h2><pre class="programlisting">-- データを保持するスキーマの生成
CREATE SCHEMA my_schema;
-- 新しい単純なPostgreSQLテーブルの生成
CREATE TABLE my_schema.my_spatial_table (id serial);

-- "id"カラムのみを持つ単純なテーブルの説明
postgis=# \d my_schema.my_spatial_table
                                                         Table "my_schema.my_spatial_table"
 Column |  Type   |                                Modifiers
--------+---------+-------------------------------------------------------------------------
 id     | integer | not null default nextval('my_schema.my_spatial_table_id_seq'::regclass)

-- テーブルにジオメトリカラムを追加\
SELECT AddGeometryColumn ('my_schema','my_spatial_table','geom',4326,'POINT',2);

-- 制約を基にした古い方法でPOINTカラムを追加
SELECT AddGeometryColumn ('my_schema','my_spatial_table','geom_c',4326,'POINT',2, false);

-- 制約を基にした古い方法でCURVEPOLYGONカラムを追加
SELECT AddGeometryColumn ('my_schema','my_spatial_table','geomcp_c',4326,'CURVEPOLYGON',2, false);

-- 再度説明を表示し、新しいジオメトリカラムの追加を明らかにする
\d my_schema.my_spatial_table
                            addgeometrycolumn
-------------------------------------------------------------------------
 my_schema.my_spatial_table.geomcp_c SRID:4326 TYPE:CURVEPOLYGON DIMS:2
(1 row)

                                    Table "my_schema.my_spatial_table"
  Column  |         Type         |                                Modifiers
----------+----------------------+-------------------------------------------------------------------------
 id       | integer              | not null default nextval('my_schema.my_spatial_table_id_seq'::regclass)
 geom     | geometry(Point,4326) |
 geom_c   | geometry             |
 geomcp_c | geometry             |
Check constraints:
    "enforce_dims_geom_c" CHECK (st_ndims(geom_c) = 2)
    "enforce_dims_geomcp_c" CHECK (st_ndims(geomcp_c) = 2)
    "enforce_geotype_geom_c" CHECK (geometrytype(geom_c) = 'POINT'::text OR geom_c IS NULL)
    "enforce_geotype_geomcp_c" CHECK (geometrytype(geomcp_c) = 'CURVEPOLYGON'::text OR geomcp_c IS NULL)
    "enforce_srid_geom_c" CHECK (st_srid(geom_c) = 4326)
    "enforce_srid_geomcp_c" CHECK (st_srid(geomcp_c) = 4326)

-- geometry_columnsビューにも新しいカラムが登録されています --
SELECT f_geometry_column As col_name, type, srid, coord_dimension As ndims
    FROM geometry_columns
    WHERE f_table_name = 'my_spatial_table' AND f_table_schema = 'my_schema';

 col_name |     type     | srid | ndims
----------+--------------+------+-------
 geom     | Point        | 4326 |     2
 geom_c   | Point        | 4326 |     2
 geomcp_c | CurvePolygon | 4326 |     2
</pre></div><div class="refsection"><a name="idp53191296"></a><h2>関連情報</h2><p><a class="xref" href="#DropGeometryColumn" title="DropGeometryColumn">DropGeometryColumn</a>, <a class="xref" href="#DropGeometryTable" title="DropGeometryTable">DropGeometryTable</a>, <a class="xref" href="#geometry_columns" title="4.4.2. GEOMETRY_COLUMNSビュー">「GEOMETRY_COLUMNSビュー」</a>, <a class="xref" href="#Manual_Register_Spatial_Column" title="4.4.3. 手動でジオメトリカラムをgeometry_columnsに登録する">「手動でジオメトリカラムをgeometry_columnsに登録する」</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="DropGeometryColumn"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>DropGeometryColumn — ジオメトリカラムを空間テーブルから除去します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">DropGeometryColumn</b>(</code>varchar  <var class="pdparam">table_name</var>, varchar  <var class="pdparam">column_name</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">DropGeometryColumn</b>(</code>varchar  <var class="pdparam">schema_name</var>, varchar  <var class="pdparam">table_name</var>, varchar  <var class="pdparam">column_name</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">DropGeometryColumn</b>(</code>varchar  <var class="pdparam">catalog_name</var>, varchar  <var class="pdparam">schema_name</var>, varchar  <var class="pdparam">table_name</var>, varchar  <var class="pdparam">column_name</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp53237376"></a><h2>説明</h2><p>ジオメトリカラムを空間テーブルから除去します。schema_nameはgeometry_columnsテーブルの該当行のf_table_schemaフィールドと一致しなければならないことにご注意ください。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OGC Simple Features
 Implementation Specification for SQL 1.1.</a></p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Changed: 2.0.0 この関数は後方互換のためのものです。geometry_columnsは現在はシステムカタログに対するビューですので、他のテーブルのカラムと同じように<code class="code">ALTER TABLE</code>を使った削除が可能です。</p></td></tr></table></div></div><div class="refsection"><a name="idp53243776"></a><h2>例</h2><pre class="programlisting">SELECT DropGeometryColumn ('my_schema','my_spatial_table','geom');
                        ---- 結果出力 ----
                                          dropgeometrycolumn
------------------------------------------------------
 my_schema.my_spatial_table.geom effectively removed.

-- PostGIS 2.0以上では標準的なALTER TABLEと上の例とは等価です
-- 両方ともgeometry_columnsの登録を抹消します
ALTER TABLE my_schema.my_spatial_table DROP column geom;
                </pre></div><div class="refsection"><a name="idp53245056"></a><h2>関連情報</h2><p><a class="xref" href="#AddGeometryColumn" title="AddGeometryColumn">AddGeometryColumn</a>, <a class="xref" href="#DropGeometryTable" title="DropGeometryTable">DropGeometryTable</a>, <a class="xref" href="#geometry_columns" title="4.4.2. GEOMETRY_COLUMNSビュー">「GEOMETRY_COLUMNSビュー」</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="DropGeometryTable"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>DropGeometryTable — テーブルとgeometry_columnsの当該テーブルへの参照の全てを削除します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">DropGeometryTable</b>(</code>varchar  <var class="pdparam">table_name</var><code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">DropGeometryTable</b>(</code>varchar  <var class="pdparam">schema_name</var>, varchar  <var class="pdparam">table_name</var><code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">DropGeometryTable</b>(</code>varchar  <var class="pdparam">catalog_name</var>, varchar  <var class="pdparam">schema_name</var>, varchar  <var class="pdparam">table_name</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp53259008"></a><h2>説明</h2><p>テーブルとgeometry_columnsの当該テーブルへの参照の全てを削除します。スキーマ対応版PostgreSQLではスキーマが与えられない場合はcurrent_schema()を使います。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Changed: 2.0.0で この関数は後方互換のためのものです。geometry_columnsは現在はシステムカタログに対するビューですので、他のテーブルのカラムと同じように<code class="code">DROP TABLE</code>を使った削除が可能です。</p></td></tr></table></div></div><div class="refsection"><a name="idp53261312"></a><h2>例</h2><pre class="programlisting">SELECT DropGeometryTable ('my_schema','my_spatial_table');
---- 結果出力 ----
my_schema.my_spatial_table dropped.

-- 上の例は次の例と等価です --
DROP TABLE my_schema.my_spatial_table;
                </pre></div><div class="refsection"><a name="idp53262592"></a><h2>関連情報</h2><p><a class="xref" href="#AddGeometryColumn" title="AddGeometryColumn">AddGeometryColumn</a>, <a class="xref" href="#DropGeometryColumn" title="DropGeometryColumn">DropGeometryColumn</a>, <a class="xref" href="#geometry_columns" title="4.4.2. GEOMETRY_COLUMNSビュー">「GEOMETRY_COLUMNSビュー」</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="Find_SRID"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Find_SRID — ジオメトリカラムで定義されているSRIDを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">Find_SRID</b>(</code>varchar  <var class="pdparam">a_schema_name</var>, varchar  <var class="pdparam">a_table_name</var>, varchar  <var class="pdparam">a_geomfield_name</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp53283456"></a><h2>説明</h2><p>指定したジオメトリカラムSRID整数値をGEOMETRY_COLUMNSテーブルの探索によって返します。ジオメトリカラムが正しく追加されていない (例: <a class="xref" href="#AddGeometryColumn" title="AddGeometryColumn">AddGeometryColumn</a>関数)場合には、この関数は動作しません。</p></div><div class="refsection"><a name="idp53284992"></a><h2>例</h2><pre class="programlisting">SELECT Find_SRID('public', 'tiger_us_state_2007', 'geom_4269');
find_srid
----------
4269
</pre></div><div class="refsection"><a name="idp53286528"></a><h2>関連情報</h2><p><a class="xref" href="#">???</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="Populate_Geometry_Columns"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Populate_Geometry_Columns — ジオメトリカラムが型修飾子で定義されるか、適切な空間制約を持つようにします。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">Populate_Geometry_Columns</b>(</code>boolean  <var class="pdparam">use_typmod=true</var><code>)</code>;</p><p><code class="funcdef">int <b class="fsfunc">Populate_Geometry_Columns</b>(</code>oid <var class="pdparam">relation_oid</var>, boolean  <var class="pdparam">use_typmod=true</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp53295616"></a><h2>説明</h2><p>ジオメトリカラムが適切な型修飾子を持つか、<code class="varname">geometry_columns</code>ビュー内で正しく登録されていることを確実にするために空間制約を持つようにします。デフォルトでは、型修飾子を持たないすべてのジオメトリカラムを型修飾子を持つカラムに変換します。 </p><p>後方互換のためと、それぞれの子テーブルが異なるジオメトリタイプを持つテーブル継承といった空間テーブルにとって必要があるためとの二つの理由から、古いCHECK制約の挙動がなお有効になっています。古い挙動が必要な場合には、新しいオプション引数で<code class="varname">use_typmod=false</code>を渡す必要があります。これが実行されると、型修飾子なしのジオメトリカラムが生成され、三つの制約が定義されます。特に、これは、テーブルに属するすべてのジオメトリカラムが少なくとも三つの制約を持つことを意味します。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="varname">enforce_dims_the_geom</code> - あらゆるジオメトリが同じ次元を持つことを確実にします (<a class="xref" href="#ST_NDims" title="ST_NDims">ST_NDims</a>をご覧下さい)</p></li><li class="listitem"><p><code class="varname">enforce_geotype_the_geom</code> - あらゆるジオメトリが同じ型を持つことを確実にします (<a class="xref" href="#GeometryType" title="GeometryType">GeometryType</a>をご覧下さい)</p></li><li class="listitem"><p><code class="varname">enforce_srid_the_geom</code> - あらゆるジオメトリが同じ投影法になることを確実にします (<a class="xref" href="#">???</a>をご覧下さい)</p></li></ul></div><p>テーブルに<code class="varname">oid</code>がある場合には、この関数はテーブルのジオメトリカラム全てについて、SRIDと次元とジオメトリタイプを判定して、必要に応じて制約を追加しようとします。 成功した場合には、<code class="varname">geometry_columns</code>に適切な行が追加され、その他の場合には、例外が捕まえられ、問題を記述したエラーが通知されます。</p><p>ビューの<code class="varname">oid</code>がある場合、テーブルの場合と同じで、SIRDと次元とジオメトリタイプを判定して、適切なエントリを<code class="varname">geometry_columns</code>テーブルに挿入しますが、制約の追加はされません。</p><p>パラメタの無い形式は、<code class="varname">geometry_columns</code>の行を削除したうえで、全ての空間テーブルと空間ビューについて再挿入し、適切な空間制約をテーブルに追加する、パラメタ付きの形式の単純なラッパです。パラメタが無い形式は、検出したジオメトリカラムの数の要約と<code class="varname">geometry_columns</code>に挿入された行の数とを返します。パラメタ付きの形式は単純に<code class="varname">geometry_columns</code>に挿入された行の数を返します。</p><p>Availability: 1.4.0</p><p>Changed: 2.0.0 デフォルトでは、ジオメトリタイプの制限について、制約を確認する代わりに型修飾子を使います。新しい<code class="varname">use_typmod</code>をFALSEに設定して使うことで、制約確認を使用することができます。</p><p>Enhanced: 2.0.0 <code class="varname">use_typmod</code>任意引数が導入されました。カラムが型修飾子で生成されるか制約チェックで作られるかの制御ができます。</p></div><div class="refsection"><a name="idp53308288"></a><h2>例</h2><pre class="programlisting">CREATE TABLE public.myspatial_table(gid serial, geom geometry);
INSERT INTO myspatial_table(geom) VALUES(ST_GeomFromText('LINESTRING(1 2, 3 4)',4326) );
-- 型修飾子を使います
-- 動作するにはデータが存在していなければなりません
SELECT Populate_Geometry_Columns('public.myspatial_table'::regclass);

populate_geometry_columns
--------------------------
                        1


\d myspatial_table

                                   Table "public.myspatial_table"
 Column |           Type            |                           Modifiers
--------+---------------------------+---------------------------------------------------------------
 gid    | integer                   | not null default nextval('myspatial_table_gid_seq'::regclass)
 geom   | geometry(LineString,4326) |
</pre><pre class="programlisting">-- カラムが型修飾子でないか、既に制約が存在している場合には制約を使います
-- 動作するにはデータが存在していなければなりません
CREATE TABLE public.myspatial_table_cs(gid serial, geom geometry);
INSERT INTO myspatial_table_cs(geom) VALUES(ST_GeomFromText('LINESTRING(1 2, 3 4)',4326) );
SELECT Populate_Geometry_Columns('public.myspatial_table_cs'::regclass, false);
populate_geometry_columns
--------------------------
                        1
\d myspatial_table_cs

                          Table "public.myspatial_table_cs"
 Column |   Type   |                            Modifiers
--------+----------+------------------------------------------------------------------
 gid    | integer  | not null default nextval('myspatial_table_cs_gid_seq'::regclass)
 geom   | geometry |
Check constraints:
    "enforce_dims_geom" CHECK (st_ndims(geom) = 2)
    "enforce_geotype_geom" CHECK (geometrytype(geom) = 'LINESTRING'::text OR geom IS NULL)
    "enforce_srid_geom" CHECK (st_srid(geom) = 4326)</pre></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="UpdateGeometrySRID"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>UpdateGeometrySRID — ジオメトリカラム内の全ての地物のSRIDを更新し、テーブルのメタデータを更新します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">UpdateGeometrySRID</b>(</code>varchar  <var class="pdparam">table_name</var>, varchar  <var class="pdparam">column_name</var>, integer  <var class="pdparam">srid</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">UpdateGeometrySRID</b>(</code>varchar  <var class="pdparam">schema_name</var>, varchar  <var class="pdparam">table_name</var>, varchar  <var class="pdparam">column_name</var>, integer  <var class="pdparam">srid</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">UpdateGeometrySRID</b>(</code>varchar  <var class="pdparam">catalog_name</var>, varchar  <var class="pdparam">schema_name</var>, varchar  <var class="pdparam">table_name</var>, varchar  <var class="pdparam">column_name</var>, integer  <var class="pdparam">srid</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp53328640"></a><h2>説明</h2><p>ジオメトリカラム内の全ての地物のSRIDを更新し、制約を更新し、geometry_columnsの参照を更新します。カラムが型定義で強制されているなら、型定義は変更されます。ご注意: スキーマ対応版PostgreSQLでは、スキーマが提供されていない場合には、current_schema()を使用します。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p></div><div class="refsection"><a name="idp53332352"></a><h2>例</h2><p>ジオメトリを、<a class="link" href="#">EWKT書式</a>を使って、SRIDを持つ道路テーブルに挿入します。</p><pre class="programlisting">COPY roads (geom) FROM STDIN;
SRID=4326;LINESTRING(0 0, 10 10)
SRID=4326;LINESTRING(10 10, 15 0)
\.
                </pre><p>これにより道路テーブルが、以前がどんなSRIDであっても、4326に変更されます。</p><pre class="programlisting">SELECT UpdateGeometrySRID('roads','geom',4326);</pre><p>上述の例と、次のDDL手続き (訳注: DDLはData Definition Languageの略で、データ構造の操作を行う言語を指し、この場合は CREATE TABLEやALTER TABLE等が該当します)とは同じです。</p><pre class="programlisting">ALTER TABLE roads
  ALTER COLUMN geom TYPE geometry(MULTILINESTRING, 4326)
    USING ST_SetSRID(geom,4326);</pre><p>ロードしたデータの変換座標系が誤りである (またはunknownになっている)けれどもWebメルカトルに一度の処理で変換したい場合、DDLで実行可能ですが、PostGIS管理関数では一度の処理ですむ等価なものはありません。</p><pre class="programlisting">ALTER TABLE roads
 ALTER COLUMN geom TYPE geometry(MULTILINESTRING, 3857) USING ST_Transform(ST_SetSRID(geom,4326),3857) ;</pre></div><div class="refsection"><a name="idp53337472"></a><h2>関連情報</h2><p><a class="xref" href="#RT_UpdateRasterSRID" title="UpdateRasterSRID">UpdateRasterSRID</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#">???</a> </p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Geometry_Constructors"></a>8.4. ジオメトリ コンストラクタ</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#ST_Collect">ST_Collect</a></span><span class="refpurpose"> — ジオメトリの集合からジオメトリコレクションまたはマルチ系ジオメトリを生成します。</span></dt><dt><span class="refentrytitle"><a href="#ST_LineFromMultiPoint">ST_LineFromMultiPoint</a></span><span class="refpurpose"> — マルチポイントジオメトリからラインストリングを生成します。</span></dt><dt><span class="refentrytitle"><a href="#ST_MakeEnvelope">ST_MakeEnvelope</a></span><span class="refpurpose"> — 座標値の最小値と最大値から矩形ポリゴンを生成します。</span></dt><dt><span class="refentrytitle"><a href="#ST_MakeLine">ST_MakeLine</a></span><span class="refpurpose"> — POINT、MULTIPOINT、LINESTRINGからLINESTRINGを生成します。</span></dt><dt><span class="refentrytitle"><a href="#ST_MakePoint">ST_MakePoint</a></span><span class="refpurpose"> — 2次元、3次元 (XYZ)、4次元のポイントを生成します。</span></dt><dt><span class="refentrytitle"><a href="#ST_MakePointM">ST_MakePointM</a></span><span class="refpurpose"> — X, Y, M値からのポイントを生成します。</span></dt><dt><span class="refentrytitle"><a href="#ST_MakePolygon">ST_MakePolygon</a></span><span class="refpurpose"> — 外殻と穴のリストからポリゴンを生成します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Point">ST_Point</a></span><span class="refpurpose"> — 与えられた座標値からポイントを生成します。ST_MakePointの別名です。</span></dt><dt><span class="refentrytitle"><a href="#ST_PointZ">ST_PointZ</a></span><span class="refpurpose"> — 与えた座標とSRID値を持つポイントを生成します。</span></dt><dt><span class="refentrytitle"><a href="#ST_PointM">ST_PointM</a></span><span class="refpurpose"> — 与えた座標とSRID値を持つポイントを生成します。</span></dt><dt><span class="refentrytitle"><a href="#ST_PointZM">ST_PointZM</a></span><span class="refpurpose"> — 与えた座標とSRID値を持つポイントを生成します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Polygon">ST_Polygon</a></span><span class="refpurpose"> — ラインストリングから指定したSRIDを持つポリゴンを生成します。</span></dt><dt><span class="refentrytitle"><a href="#ST_TileEnvelope">ST_TileEnvelope</a></span><span class="refpurpose"> — Webメルカトル (SRID:3857)上で XYZタイルを使った矩形ポリゴンを生成します。</span></dt><dt><span class="refentrytitle"><a href="#ST_HexagonGrid">ST_HexagonGrid</a></span><span class="refpurpose"> — 引数ジオメトリの境界を完全にカバーする六角形とセルインデックスを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Hexagon">ST_Hexagon</a></span><span class="refpurpose"> — 与えられたエッジサイズと六角形グリッド空間内のセル座標を使って単一の六角形を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_SquareGrid">ST_SquareGrid</a></span><span class="refpurpose"> — 引数ジオメトリの境界を完全にカバーするグリッド正方形とセルインデックスを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Square">ST_Square</a></span><span class="refpurpose"> — 与えられたエッジサイズと六角形グリッド空間内のセル座標を使って単一の正方形を返します。</span></dt></dl></div><div class="refentry"><a name="ST_Collect"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Collect — ジオメトリの集合からジオメトリコレクションまたはマルチ系ジオメトリを生成します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Collect</b>(</code>geometry <var class="pdparam">g1</var>, geometry <var class="pdparam">g2</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_Collect</b>(</code>geometry[] <var class="pdparam">g1_array</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_Collect</b>(</code>geometry set <var class="pdparam">g1field</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp53511936"></a><h2>説明</h2><p>ジオメトリを集めてジオメトリコレクションにします。結果はマルチ系ジオメトリかジオメトリコレクションかのいずれかで、この差は、入力ジオメトリのタイプが同じか異なるか(均質か不均質か)で決まります。入力ジオメトリはコレクション内で変更されることはありません。 </p><p><span class="bold"><strong>1番目の形式:</strong></span> 二つの入力ジオメトリを受け付ける。</p><p><span class="bold"><strong>2番目の形式:</strong></span> ジオメトリの配列を受け付ける。</p><p><span class="bold"><strong>3番目の形式:</strong></span> ジオメトリの行集合を受け付ける集約関数。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>入力ジオメトリのいずれかがコレクション (マルチ系ジオメトリまたはジオメトリコレクション)の場合には、ST_Collectはジオメトリコレクションを返します (入れ子になったコレクションを含む唯一のタイプであるため)。これを避けるには、サブクエリで<a class="xref" href="#ST_Dump" title="ST_Dump">ST_Dump</a> を使い、入力コレクションを分解できない要素にまで分解します (下に例があります)。 </p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_Collectと<a class="xref" href="#">???</a>は似ているように見えますが、実際には全く異なる処理を行います。ST_Collectは入力ジオメトリを変更せずにコレクションにする集約関数です。ST_Unionは、オーバラップしている時は幾何学的に併合し、インタセクトするところでラインストリングを分割します。境界をディゾルブするときには単一のジオメトリを返す可能性があります。 </p></td></tr></table></div><p>Availability: 1.4.0 - ST_Collect(geometry)が導入されました。ST_Collectがより多くのジオメトリをより早く扱えるよう強化されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p></div><div class="refsection"><a name="idp53520256"></a><h2>例 - 二つ入力を引数に取る形式</h2><p>2次元ポイントの収集</p><pre class="programlisting">SELECT ST_AsText( ST_Collect( ST_GeomFromText('POINT(1 2)'),
        ST_GeomFromText('POINT(-2 3)') ));

st_astext
----------
MULTIPOINT(1 2,-2 3)
</pre><p>2次元ポイントの収集</p><pre class="programlisting">SELECT ST_AsEWKT( ST_Collect( ST_GeomFromEWKT('POINT(1 2 3)'),
                ST_GeomFromEWKT('POINT(1 2 4)') ) );

                st_asewkt
-------------------------
 MULTIPOINT(1 2 3,1 2 4)
 </pre><p>曲線の収集</p><pre class="programlisting">SELECT ST_AsText( ST_Collect( 'CIRCULARSTRING(220268 150415,220227 150505,220227 150406)',
                'CIRCULARSTRING(220227 150406,2220227 150407,220227 150406)'));

                st_astext
------------------------------------------------------------------------------------
MULTICURVE(CIRCULARSTRING(220268 150415,220227 150505,220227 150406),
 CIRCULARSTRING(220227 150406,2220227 150407,220227 150406))
</pre></div><div class="refsection"><a name="idp53523712"></a><h2>例 - 配列を引数に取る形式</h2><p>サブクエリから配列を生成するコンストラクタの使用。</p><pre class="programlisting">SELECT ST_Collect( ARRAY( SELECT geom FROM sometable ) );
</pre><p>値から配列を生成するコンストラクタの使用。</p><pre class="programlisting">SELECT ST_AsText(  ST_Collect(
                ARRAY[ ST_GeomFromText('LINESTRING(1 2, 3 4)'),
                        ST_GeomFromText('LINESTRING(3 4, 4 5)') ] )) As wktcollect;

--wkt collect --
MULTILINESTRING((1 2,3 4),(3 4,4 5))
</pre></div><div class="refsection"><a name="idp53526272"></a><h2>例 - 集約関数の形式</h2><p>テーブル内のジオメトリのグループ化による複数コレクションの生成</p><pre class="programlisting">SELECT stusps, ST_Collect(f.geom) as geom
         FROM (SELECT stusps, (ST_Dump(geom)).geom As geom
                                FROM
                                somestatetable ) As f
        GROUP BY stusps
</pre></div><div class="refsection"><a name="idp53527936"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Dump" title="ST_Dump">ST_Dump</a>, <a class="xref" href="#">???</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_LineFromMultiPoint"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_LineFromMultiPoint — マルチポイントジオメトリからラインストリングを生成します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_LineFromMultiPoint</b>(</code>geometry  <var class="pdparam">aMultiPoint</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp53546368"></a><h2>説明</h2><p>マルチポイントジオメトリからラインストリングを生成します。</p><p>ポイントまたはラインストリングの入力からラインを生成するには<a class="xref" href="#ST_MakeLine" title="ST_MakeLine">ST_MakeLine</a>を使います。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp53549696"></a><h2>例</h2><p>3次元マルチポイントから3次元ラインストリングの生成</p><pre class="programlisting">SELECT ST_AsEWKT(  ST_LineFromMultiPoint('MULTIPOINT(1 2 3, 4 5 6, 7 8 9)')  ));

-- 結果 --
LINESTRING(1 2 3,4 5 6,7 8 9)
</pre></div><div class="refsection"><a name="idp53551616"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a>, <a class="xref" href="#ST_MakeLine" title="ST_MakeLine">ST_MakeLine</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_MakeEnvelope"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MakeEnvelope — 座標値の最小値と最大値から矩形ポリゴンを生成します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_MakeEnvelope</b>(</code>float <var class="pdparam">xmin</var>, float <var class="pdparam">ymin</var>, float <var class="pdparam">xmax</var>, float <var class="pdparam">ymax</var>, integer <var class="pdparam">srid=unknown</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp53582464"></a><h2>説明</h2><p>XとYの最小値と最大値から矩形ポリゴンを生成します。入力値はSRIDで指定された空間参照系に合わせなければなりません。SRIDが指定されていない場合には、不明な空間参照系 (SRID 0)が使われます。</p><p>Availability: 1.5</p><p>Enhanced: 2.0 SRID指定なしでエンベロープを指定できるようになりました。</p></div><div class="refsection"><a name="idp53584384"></a><h2>例: バウンディングボックスポリゴンの生成</h2><pre class="programlisting">SELECT ST_AsText( ST_MakeEnvelope(10, 10, 11, 11, 4326) );

st_asewkt
-----------
POLYGON((10 10, 10 11, 11 11, 11 10, 10 10))
</pre></div><div class="refsection"><a name="idp53585792"></a><h2>関連情報</h2><p><a class="xref" href="#ST_MakePoint" title="ST_MakePoint">ST_MakePoint</a>, <a class="xref" href="#ST_MakeLine" title="ST_MakeLine">ST_MakeLine</a>, <a class="xref" href="#ST_MakePolygon" title="ST_MakePolygon">ST_MakePolygon</a>, <a class="xref" href="#ST_TileEnvelope" title="ST_TileEnvelope">ST_TileEnvelope</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_MakeLine"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MakeLine — POINT、MULTIPOINT、LINESTRINGからLINESTRINGを生成します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_MakeLine</b>(</code>geometry <var class="pdparam">geom1</var>, geometry <var class="pdparam">geom2</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_MakeLine</b>(</code>geometry[] <var class="pdparam">geoms_array</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_MakeLine</b>(</code>geometry set <var class="pdparam">geoms</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp53598080"></a><h2>説明</h2><p>ポイント、マルチポイントまたはラインストリングのジオメトリの点を含むラインストリングを生成します。他のジオメトリではエラーが発生します。 </p><p><span class="bold"><strong>1番目の形式:</strong></span> 二つの入力ジオメトリを受け付ける。</p><p><span class="bold"><strong>2番目の形式:</strong></span> ジオメトリの配列を受け付ける。</p><p><span class="bold"><strong>形式3:</strong></span> ジオメトリの行集合を受け付ける約関数。入力ジオメトリの順序を確実にするには、関数呼び出しで<code class="varname">ORDER BY</code>を使うか、<code class="varname">ORDER BY</code>節を持つサブクエリを使います。</p><p>入力ラインストリングの開始位置で重複するノードは単一のポイントに減らされます。ポイントとマルチポイントの入力での重複するポイントは減らされません。出力ラインストリングから重複ポイントを削除するには<a class="xref" href="#ST_RemoveRepeatedPoints" title="ST_RemoveRepeatedPoints">ST_RemoveRepeatedPoints</a>が使えます。 </p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p>Availability: 2.3.0 - MULTIPOINT入力要素への対応が導入されました</p><p>Availability: 2.0.0 - LINESTRING入力要素への対応が導入されました</p><p>Availability: 1.4.0 - ST_MakeLine(geomarray)が導入されました。ST_MakeLine集約関数はより多くのポイントをより早く扱うための強化が施されています。</p></div><div class="refsection"><a name="idp53605632"></a><h2>例: 二つ入力を引数に取る形式</h2><p>二つのポイントで構成されるラインの生成。</p><pre class="programlisting">SELECT ST_AsText( ST_MakeLine(ST_Point(1,2), ST_Point(3,4)) );

          st_astext
---------------------
 LINESTRING(1 2,3 4)
</pre><p>二つの3次元ポイントからの3次元ラインの生成。</p><pre class="programlisting">SELECT ST_AsEWKT( ST_MakeLine(ST_MakePoint(1,2,3), ST_MakePoint(3,4,5) ));

                st_asewkt
-------------------------
 LINESTRING(1 2 3,3 4 5)
</pre><p>二つの接続されていないラインストリングからのラインの生成。</p><pre class="programlisting">select ST_AsText( ST_MakeLine( 'LINESTRING(0 0, 1 1)', 'LINESTRING(2 2, 3 3)' ) );

          st_astext
-----------------------------
 LINESTRING(0 0,1 1,2 2,3 3)
</pre></div><div class="refsection"><a name="idp53609216"></a><h2>例: 配列を引数に取る形式</h2><p>並べ替えを伴うサブクエリで作られた配列からのラインの生成。</p><pre class="programlisting">SELECT ST_MakeLine( ARRAY( SELECT ST_Centroid(geom) FROM visit_locations ORDER BY visit_time) );
</pre><p>3次元ポイントの配列からの次元ラインの生成。</p><pre class="programlisting">SELECT ST_AsEWKT( ST_MakeLine(
          ARRAY[ ST_MakePoint(1,2,3), ST_MakePoint(3,4,5), ST_MakePoint(6,6,6) ]  ));

                st_asewkt
-------------------------
LINESTRING(1 2 3,3 4 5,6 6 6)
</pre></div><div class="refsection"><a name="idp53611776"></a><h2>例: 集約関数の形式</h2><p>この例ではGPSトラックの集合からポイントの時間ベースのシーケンスを問い合わせています。結果ジオメトリは、GPSトラックの移動順ポイントで構成されるラインストリングです。</p><p><code class="varname">ORDER BY</code>節を使うことで、正しい順序のLINESTRINGが生成できます。</p><pre class="programlisting">SELECT gps.track_id, ST_MakeLine(gps.geom ORDER BY gps_time) As geom
        FROM gps_points As gps
        GROUP BY track_id;</pre><p>PostgreSQL 9より前の版では、サブクエリでの順序付けを使うことができます。ただし、クエリプランでサブクエリの並び順が尊重されない場合があります。</p><pre class="programlisting">SELECT gps.track_id, ST_MakeLine(gps.geom) As geom
        FROM ( SELECT track_id, gps_time, geom
                        FROM gps_points ORDER BY track_id, gps_time ) As gps
        GROUP BY track_id;</pre></div><div class="refsection"><a name="idp53615104"></a><h2>関連情報</h2><p><a class="xref" href="#ST_RemoveRepeatedPoints" title="ST_RemoveRepeatedPoints">ST_RemoveRepeatedPoints</a>, <a class="xref" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a>, <a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#ST_MakePoint" title="ST_MakePoint">ST_MakePoint</a>, <a class="xref" href="#ST_Point" title="ST_Point">ST_Point</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_MakePoint"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MakePoint — 2次元、3次元 (XYZ)、4次元のポイントを生成します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_MakePoint</b>(</code>float <var class="pdparam">x</var>, float <var class="pdparam">y</var><code>)</code>;</p></div><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_MakePoint</b>(</code>float <var class="pdparam">x</var>, float <var class="pdparam">y</var>, float <var class="pdparam">z</var><code>)</code>;</p></div><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_MakePoint</b>(</code>float <var class="pdparam">x</var>, float <var class="pdparam">y</var>, float <var class="pdparam">z</var>, float <var class="pdparam">m</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp53633920"></a><h2>説明</h2><p>2次元、3次元 (XYZ)、4次元 (XYZM)のポイントを生成します。</p><p>XYM座標を持つポイントを作るには<a class="xref" href="#ST_MakePointM" title="ST_MakePointM">ST_MakePointM</a>を使います。</p><p>OGC準拠ではありませんが、<code class="varname">ST_MakePoint</code>は<a class="xref" href="#">???</a>や<a class="xref" href="#">???</a>より高速かつ正確です。また、簡単に数値の座標値を使用できます。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>地理座標系について、<code class="varname">X</code>は経度で、<code class="varname">Y</code>は緯度です。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp53644160"></a><h2>例</h2><pre class="programlisting">-- SRID不明のポイントを返します
SELECT ST_MakePoint(-71.1043443253471, 42.3150676015829);

-- WGS 84経度緯度とするポイントを返します。
SELECT ST_SetSRID(ST_MakePoint(-71.1043443253471, 42.3150676015829),4326);

-- 3次元ポイント (たとえば標高を持つ)を返します
SELECT ST_MakePoint(1, 2,1.5);

-- ポイントのZ値を得ます
SELECT ST_Z(ST_MakePoint(1, 2,1.5));
result
-------
1.5</pre></div><div class="refsection"><a name="idp53645440"></a><h2>関連情報</h2><p><a class="xref" href="#">???</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#ST_MakePointM" title="ST_MakePointM">ST_MakePointM</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_MakePointM"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MakePointM — X, Y, M値からのポイントを生成します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_MakePointM</b>(</code>float <var class="pdparam">x</var>, float <var class="pdparam">y</var>, float <var class="pdparam">m</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp53654400"></a><h2>説明</h2><p>X, Y, M (Measure) 値からのポイントを生成します。 </p><p>XY, XYZ, XYZM座標のポイントを作るには<a class="xref" href="#ST_MakePoint" title="ST_MakePoint">ST_MakePoint</a>を使います。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>地理座標系について、<code class="varname">X</code>は経度で、<code class="varname">Y</code>は緯度です。</p></td></tr></table></div></div><div class="refsection"><a name="idp53657600"></a><h2>例</h2><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><a class="xref" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a> は文字列出力のために使います。<a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a>がM値に対応していないためです。</p></td></tr></table></div><p>不明なSRIDでのポイントの生成。</p><pre class="programlisting">SELECT ST_AsEWKT(  ST_MakePointM(-71.1043443253471, 42.3150676015829, 10)  );

                                   st_asewkt
-----------------------------------------------
 POINTM(-71.1043443253471 42.3150676015829 10)
</pre><p>WGS ８４地理座標系のM値を持つポイントの生成。</p><pre class="programlisting">SELECT ST_AsEWKT( ST_SetSRID(  ST_MakePointM(-71.104, 42.315, 10),  4326));

                                                st_asewkt
---------------------------------------------------------
SRID=4326;POINTM(-71.104 42.315 10)
</pre><p>生成したポイントのM値の取得。</p><pre class="programlisting">SELECT ST_M(  ST_MakePointM(-71.104, 42.315, 10)  );

result
-------
10
</pre></div><div class="refsection"><a name="idp53662208"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a>, <a class="xref" href="#ST_MakePoint" title="ST_MakePoint">ST_MakePoint</a>, <a class="xref" href="#">???</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_MakePolygon"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MakePolygon — 外殻と穴のリストからポリゴンを生成します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_MakePolygon</b>(</code>geometry <var class="pdparam">linestring</var><code>)</code>;</p></div><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_MakePolygon</b>(</code>geometry <var class="pdparam">outerlinestring</var>, geometry[] <var class="pdparam">interiorlinestrings</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp53672192"></a><h2>説明</h2><p>与えられた外殻と任意指定の穴の配列で掲載されるポリゴンを生成します。入力ジオメトリは閉じたラインストリング (リング)でなければなりません。</p><p><span class="bold"><strong>形式1:</strong></span> 一つの外殻のラインストリングを受け付けます。</p><p><span class="bold"><strong>形式2:</strong></span> 外殻のラインストリングと内部 (穴)のラインストリングの配列とを受け付けます。ジオメトリ配列はPostgreSQLのarray_agg(), ARRAY[], ARRAY()コンストラクタを使います。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はマルチラインストリングを受け付けません。ラインストリングの生成には<a class="xref" href="#ST_LineMerge" title="ST_LineMerge">ST_LineMerge</a>を使用します。また、ラインストリングを抽出するには<a class="xref" href="#ST_Dump" title="ST_Dump">ST_Dump</a>を使用します。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp53690112"></a><h2>例: 単一入力の形式</h2><p>2次元ラインストリングからのポリゴンの生成。</p><pre class="programlisting">SELECT ST_MakePolygon( ST_GeomFromText('LINESTRING(75 29,77 29,77 29, 75 29)'));
</pre><p>開いたラインストリングを閉じるために<a class="xref" href="#ST_StartPoint" title="ST_StartPoint">ST_StartPoint</a>と<a class="xref" href="#ST_AddPoint" title="ST_AddPoint">ST_AddPoint</a>を使用したうえでのポリゴンの生成。</p><pre class="programlisting">SELECT ST_MakePolygon( ST_AddPoint(foo.open_line, ST_StartPoint(foo.open_line)) )
FROM (
  SELECT ST_GeomFromText('LINESTRING(75 29,77 29,77 29, 75 29)') As open_line) As foo;
</pre><p>3次元ラインストリングからのポリゴンの生成。</p><pre class="programlisting">SELECT ST_AsEWKT( ST_MakePolygon( 'LINESTRING(75.15 29.53 1,77 29 1,77.6 29.5 1, 75.15 29.53 1)'));

st_asewkt
-----------
POLYGON((75.15 29.53 1,77 29 1,77.6 29.5 1,75.15 29.53 1))
</pre><p>M値を持つラインストリングからのポリゴンの生成。</p><pre class="programlisting">SELECT ST_AsEWKT( ST_MakePolygon( 'LINESTRINGM(75.15 29.53 1,77 29 1,77.6 29.5 2, 75.15 29.53 2)' ));

st_asewkt
----------
POLYGONM((75.15 29.53 1,77 29 1,77.6 29.5 2,75.15 29.53 2))
</pre></div><div class="refsection"><a name="idp53695232"></a><h2>例: 内部の穴を持つ外殻の形式</h2><p>余分な穴を持つドーナツポリゴンの生成。</p><pre class="programlisting">SELECT ST_MakePolygon( ST_ExteriorRing( ST_Buffer(ring.line,10)),
        ARRAY[  ST_Translate(ring.line, 1, 1),
                ST_ExteriorRing(ST_Buffer(ST_Point(20,20),1)) ]
        )
FROM (SELECT ST_ExteriorRing(
        ST_Buffer(ST_Point(10,10),10,10)) AS line ) AS ring;
</pre><p>湖を表現する穴を持つ県の境界の集合を生成します。入力は県ポリゴン/マルチポリゴンのテーブルと水涯線のラインストリングのテーブルです。湖を構成するラインは<a class="xref" href="#ST_IsClosed" title="ST_IsClosed">ST_IsClosed</a>で判定します。県を示すラインは<a class="xref" href="#ST_Boundary" title="ST_Boundary">ST_Boundary</a>で抽出します。<code class="code">ST_MakePolygon</code>が必要ですので、境界を<a class="xref" href="#ST_LineMerge" title="ST_LineMerge">ST_LineMerge</a>で単一のLINESTRINGに強制します(県が二つ以上の領域を持つか島を持つ場合には、不正なポリゴンを生成します)。LEFT JOINを使って、湖の無い県を含む全ての県が返ることを保証しています。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>NULL配列をST_MakePolygonに渡すとNULLが返るので、CASE式を使っています。</p></td></tr></table></div><pre class="programlisting">SELECT p.gid, p.province_name,
        CASE WHEN array_agg(w.geom) IS NULL
        THEN p.geom
        ELSE  ST_MakePolygon( ST_LineMerge(ST_Boundary(p.geom)),
                        array_agg(w.geom)) END
FROM
        provinces p LEFT JOIN waterlines w
                ON (ST_Within(w.geom, p.geom) AND ST_IsClosed(w.geom))
GROUP BY p.gid, p.province_name, p.geom;
</pre><p>他には、相関サブクエリと行集合を配列に変換するARRAY()コンストラクタとを使う手法があります。</p><pre class="programlisting">SELECT p.gid,  p.province_name,
    CASE WHEN EXISTS( SELECT w.geom
        FROM waterlines w
        WHERE ST_Within(w.geom, p.geom)
        AND ST_IsClosed(w.geom))
    THEN ST_MakePolygon(
        ST_LineMerge(ST_Boundary(p.geom)),
        ARRAY( SELECT w.geom
            FROM waterlines w
            WHERE ST_Within(w.geom, p.geom)
            AND ST_IsClosed(w.geom)))
    ELSE p.geom
    END AS geom
FROM provinces p;
</pre></div><div class="refsection"><a name="idp53700736"></a><h2>関連情報</h2><p>
				<a class="xref" href="#ST_BuildArea" title="ST_BuildArea">ST_BuildArea</a>
				<a class="xref" href="#ST_Polygon" title="ST_Polygon">ST_Polygon</a>
			</p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Point"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Point — 与えられた座標値からポイントを生成します。ST_MakePointの別名です。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Point</b>(</code>float <var class="pdparam">x</var>, float <var class="pdparam">y</var><code>)</code>;</p></div><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Point</b>(</code>float <var class="pdparam">x</var>, float <var class="pdparam">y</var>, integer <var class="pdparam">srid=unknown</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp53737216"></a><h2>説明</h2><p>与えられたXとYの座標値からポイントを返します。これは、XとYを取る形式の<a class="xref" href="#ST_MakePoint" title="ST_MakePoint">ST_MakePoint</a>の、SQL-MM用の別名です。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>地理座標系について、<code class="varname">X</code>は経度で、<code class="varname">Y</code>は緯度です。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 6.1.2</p></div><div class="refsection"><a name="idp53742592"></a><h2>例: ジオメトリ</h2><pre class="programlisting">SELECT ST_SetSRID( ST_Point( -71.104, 42.315), 4326)</pre></div><div class="refsection"><a name="idp53743872"></a><h2>例: ジオグラフィ</h2><pre class="programlisting">SELECT CAST(ST_SetSRID( ST_Point( -71.104, 42.315), 4326) AS geography);</pre><p>PostgreSQLはキャストの簡略表記として<code class="varname">::</code>を提供しています。</p><pre class="programlisting">SELECT ST_SetSRID( ST_Point( -71.104, 42.315), 4326)::geography;</pre><p>ポイントの座標が地理座標系 (WGS84等)でない場合には、ジオグラフィにキャストする前に座標系変換を行う必要があります。この例では、ペンシルバニア州平面フィート (SRID 2273)上のポイントをWGS84 (SRID 4326)に座標系変換を行っています。</p><pre class="programlisting">SELECT ST_Transform(ST_SetSRID( ST_Point( 3637510, 3014852 ), 2273), 4326)::geography;</pre></div><div class="refsection"><a name="idp53747584"></a><h2>関連情報</h2><p><a class="xref" href="#PostGIS_Geography" title="4.3. ジオグラフィデータタイプ">「ジオグラフィデータタイプ」</a>, <a class="xref" href="#ST_MakePoint" title="ST_MakePoint">ST_MakePoint</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#ST_PointZ" title="ST_PointZ">ST_PointZ</a>, <a class="xref" href="#ST_PointM" title="ST_PointM">ST_PointM</a>, <a class="xref" href="#ST_PointZM" title="ST_PointZM">ST_PointZM</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_PointZ"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_PointZ — 与えた座標とSRID値を持つポイントを生成します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_PointZ</b>(</code>float <var class="pdparam">x</var>, float <var class="pdparam">y</var>, float <var class="pdparam">z</var>, integer <var class="pdparam">srid=unknown</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp53783424"></a><h2>説明</h2><p>与えたX,Y,Z座標値を持ち、与えた場合はSRID値も持つポイントを生成します。</p></div><div class="refsection"><a name="idp53784576"></a><h2>例</h2><pre class="programlisting">SELECT ST_PointZ(-71.104, 42.315, 3.4, 4326)</pre><pre class="programlisting">SELECT ST_PointZ(-71.104, 42.315, 3.4, srid =
&gt; 4326)</pre><pre class="programlisting">SELECT ST_PointZ(-71.104, 42.315, 3.4)</pre></div><div class="refsection"><a name="idp53786880"></a><h2>関連情報</h2><p><a class="xref" href="#ST_MakePoint" title="ST_MakePoint">ST_MakePoint</a>, <a class="xref" href="#ST_Point" title="ST_Point">ST_Point</a>, <a class="xref" href="#ST_PointM" title="ST_PointM">ST_PointM</a>, <a class="xref" href="#ST_PointZM" title="ST_PointZM">ST_PointZM</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_PointM"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_PointM — 与えた座標とSRID値を持つポイントを生成します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_PointZ</b>(</code>float <var class="pdparam">x</var>, float <var class="pdparam">y</var>, float <var class="pdparam">m</var>, integer <var class="pdparam">srid=unknown</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp53796992"></a><h2>説明</h2><p>与えたX,Y,M座標値を持ち、与えた場合はSRID値も持つポイントを生成します。</p></div><div class="refsection"><a name="idp53798144"></a><h2>例</h2><pre class="programlisting">SELECT ST_PointM(-71.104, 42.315, 3.4, 4326)</pre><pre class="programlisting">SELECT ST_PointM(-71.104, 42.315, 3.4, srid =
&gt; 4326)</pre><pre class="programlisting">SELECT ST_PointM(-71.104, 42.315, 3.4)</pre></div><div class="refsection"><a name="idp53800448"></a><h2>関連情報</h2><p><a class="xref" href="#ST_MakePoint" title="ST_MakePoint">ST_MakePoint</a>, <a class="xref" href="#ST_Point" title="ST_Point">ST_Point</a>, <a class="xref" href="#ST_PointZ" title="ST_PointZ">ST_PointZ</a>, <a class="xref" href="#ST_PointZM" title="ST_PointZM">ST_PointZM</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_PointZM"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_PointZM — 与えた座標とSRID値を持つポイントを生成します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_PointZM</b>(</code>float <var class="pdparam">x</var>, float <var class="pdparam">y</var>, float <var class="pdparam">z</var>, float <var class="pdparam">m</var>, integer <var class="pdparam">srid=unknown</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp53811584"></a><h2>説明</h2><p>与えたX,Y,Z,M座標値を持ち、与えた場合はSRID値も持つポイントを生成します。</p></div><div class="refsection"><a name="idp53812736"></a><h2>例</h2><pre class="programlisting">SELECT ST_PointZM(-71.104, 42.315, 3.4, 4.5, 4326)</pre><pre class="programlisting">SELECT ST_PointZM(-71.104, 42.315, 3.4, 4.5, srid =
&gt; 4326)</pre><pre class="programlisting">SELECT ST_PointZM(-71.104, 42.315, 3.4, 4.5)</pre></div><div class="refsection"><a name="idp53815040"></a><h2>関連情報</h2><p><a class="xref" href="#ST_MakePoint" title="ST_MakePoint">ST_MakePoint</a>, <a class="xref" href="#ST_Point" title="ST_Point">ST_Point</a>, <a class="xref" href="#ST_PointM" title="ST_PointM">ST_PointM</a>, <a class="xref" href="#ST_PointZ" title="ST_PointZ">ST_PointZ</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Polygon"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Polygon — ラインストリングから指定したSRIDを持つポリゴンを生成します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Polygon</b>(</code>geometry  <var class="pdparam">lineString</var>, integer  <var class="pdparam">srid</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp53822976"></a><h2>説明</h2><p>与えられたラインストリングから構築し、<code class="varname">srid</code>から空間参照系を指定したポリゴンを返します。</p><p>ST_Polygonは<a class="xref" href="#ST_MakePolygon" title="ST_MakePolygon">ST_MakePolygon</a>の形式1の、SRIDの設定を追加したものに似ています。</p><p>穴を持つポリゴンを生成するには、<a class="xref" href="#ST_MakePolygon" title="ST_MakePolygon">ST_MakePolygon</a>の形式2を使い、<a class="xref" href="#">???</a>を使います。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はマルチラインストリングを受け付けません。ラインストリングの生成には<a class="xref" href="#ST_LineMerge" title="ST_LineMerge">ST_LineMerge</a>を使用します。また、ラインストリングを抽出するには<a class="xref" href="#ST_Dump" title="ST_Dump">ST_Dump</a>を使用します。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OGC Simple Features
 Implementation Specification for SQL 1.1.</a></p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 8.3.2</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp53836416"></a><h2>例</h2><p>2次元ポリゴンの生成。</p><pre class="programlisting">SELECT ST_AsText( ST_Polygon('LINESTRING(75 29, 77 29, 77 29, 75 29)'::geometry, 4326) );

-- 結果 --
POLYGON((75 29, 77 29, 77 29, 75 29))
</pre><p>3次元ポリゴン</p><pre class="programlisting">SELECT ST_AsEWKT( ST_Polygon( ST_GeomFromEWKT('LINESTRING(75 29 1, 77 29 2, 77 29 3, 75 29 1)'), 4326) );

-- 結果--
SRID=4326;POLYGON((75 29 1, 77 29 2, 77 29 3, 75 29 1))
</pre></div><div class="refsection"><a name="idp53851520"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a>, <a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#ST_LineMerge" title="ST_LineMerge">ST_LineMerge</a>, <a class="xref" href="#ST_MakePolygon" title="ST_MakePolygon">ST_MakePolygon</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_TileEnvelope"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_TileEnvelope — <a class="ulink" href="https://en.wikipedia.org/wiki/Web_Mercator_projection" target="_top">Webメルカトル</a> (SRID:3857)上で <a class="ulink" href="https://en.wikipedia.org/wiki/Tiled_web_map" target="_top">XYZタイル</a>を使った矩形ポリゴンを生成します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_TileEnvelope</b>(</code>integer <var class="pdparam">tileZoom</var>, integer <var class="pdparam">tileX</var>, integer <var class="pdparam">tileY</var>, geometry <var class="pdparam">bounds=SRID=3857;LINESTRING(-20037508.342789 -20037508.342789,20037508.342789 20037508.342789)</var>, float <var class="pdparam">margin=0.0</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp53864448"></a><h2>説明</h2><p><a class="ulink" href="https://en.wikipedia.org/wiki/Web_Mercator_projection" target="_top">Webメルカトル</a> (SRID:3857)上で <a class="ulink" href="https://en.wikipedia.org/wiki/Tiled_web_map" target="_top">XYZタイル</a>を使った矩形ポリゴンを生成します。デフォルトでは、境界は、標準のWebメルカトルの範囲 (-20037508.342789, 20037508.342789)を使ったEPSG:3857です。任意指定のboundsパラメータを変更することで、SRIDと、タイル系が内接する「ズームレベル 0」の矩形の範囲を持つジオメトリを提供することができ、あらゆるタイル体系に使うことができます。</p><p>任意パラメータmarginは、与えられた率でタイルを拡大するのに使います。たとえばmargin=0.125ではタイルは12.5%拡大します。<a class="xref" href="#ST_AsMVTGeom" title="ST_AsMVTGeom">ST_AsMVTGeom</a>で言うところのextent=4096の時のbuffer=512と同じです。これは、タイルの表示範囲の外側のデータを取り込むために使われるタイルバッファの生成に便利ですが、その範囲は現在のタイルの描画に影響を与えます。たとえば、市名 (ポイント)はタイルのエッジの近くにある場合がありますが、テキストは、ポイントが単一のタイルの領域上にあってでも、二つのタイルの上で描画する必要があります。拡大したタイルを検索に使うと、両方のタイルで市のポイントを含むことになります。代わりにタイルを小さくするには負の値を使います。-0.5より小さい値だと、タイルを完全に削除することになるので、禁止されています。marginをST_AsMVTGeom()と共には使わないでください。例は<a class="xref" href="#ST_AsMVT" title="ST_AsMVT">ST_AsMVT</a>を参照して下さい。</p><p>Enhanced: 3.1.0 marginパラメータが追加されました。</p><p>Availability: 3.0.0</p></div><div class="refsection"><a name="idp53868416"></a><h2>例: タイルエンベロープの構築</h2><pre class="programlisting">SELECT ST_AsText( ST_TileEnvelope(2, 1, 1) );

 st_astext
------------------------------
 POLYGON((-10018754.1713945 0,-10018754.1713945 10018754.1713945,0 10018754.1713945,0 0,-10018754.1713945 0))

SELECT ST_AsText( ST_TileEnvelope(3, 1, 1, ST_MakeEnvelope(-180, -90, 180, 90, 4326) ) );

                      st_astext
------------------------------------------------------
 POLYGON((-135 45,-135 67.5,-90 67.5,-90 45,-135 45))
</pre></div><div class="refsection"><a name="idp53881984"></a><h2>関連情報</h2><p><a class="xref" href="#ST_MakeEnvelope" title="ST_MakeEnvelope">ST_MakeEnvelope</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_HexagonGrid"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_HexagonGrid — 引数ジオメトリの境界を完全にカバーする六角形とセルインデックスを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">setof record <b class="fsfunc">ST_HexagonGrid</b>(</code>float8 <var class="pdparam">size</var>, geometry <var class="pdparam">bounds</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp53888768"></a><h2>説明</h2><p>平面の六角形タイルの概念から始まります。(地球の六角形タイルではなく<a class="ulink" href="https://github.com/uber/h3" target="_top">H3</a>タイルスキーマではありません)。平面 SRS とエッジサイズを与えると、SRS の原点から始まり、平面の一意な六角形のタイル、すなわち Tiling(SRS, Size)が一つ存在します。この関数は、指定されたTiling(SRS, Size)内の六角形が指定された境界を覆っているかどうかという質問に答えます。</p><p><span class="inlinemediaobject"><img src="images/st_hexagongrid01.png"></span></p><p>出力六角形のSRSは境界ジオメトリのSRSです。</p><p>六角形の辺の長さを2倍または3倍にすることで、元のタイルに適合する新しい親タイルが生成されます。残念ながら子タイルが完全に親タイルの中に入るような親六角形タイルを生成することはできません。</p><p><span class="inlinemediaobject"><img src="images/st_hexagongrid02.png"></span></p><p>Availability: 3.1.0</p></div><div class="refsection"><a name="idp53893632"></a><h2>例: 六角形の中の点を数え上げる</h2><p>六角形タイリングに対してポイントをまとめるには、ポイントの範囲を境界として使って六角形グリッドを生成し、グリッドに空間的に結合します。</p><pre class="programlisting">SELECT COUNT(*), hexes.geom
FROM
    ST_HexagonGrid(
        10000,
        ST_SetSRID(ST_EstimatedExtent('pointtable', 'geom'), 3857)
    ) AS hexes
    INNER JOIN
    pointtable AS pts
    ON ST_Intersects(pts.geom, hexes.geom)
GROUP BY hexes.geom;</pre></div><div class="refsection"><a name="idp53895296"></a><h2>例: ポリゴンの六角形カバレッジの生成</h2><p>ポリゴン境界ごとに六角形の集合を生成し、六角形とインタセクトしないものを除外すると、ポリゴンごとのタイルとなります。</p><p><span class="inlinemediaobject"><img src="images/st_hexagongrid03.png"></span></p><p>州のタイルは、それぞれの州の六角形のカバレッジとなり、複数の六角形が州境界で重なります。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>LATERALキーワードは、FROMリスト内の、対象より前のテーブルを参照する時は、集合を返す関数に暗黙的に含まれます。 CROSS JOIN LATERAL、CROSS JOIN、指定なし、は、この例の同じ構成要素です。</p></td></tr></table></div><pre class="programlisting">SELECT admin1.gid, hex.geom
FROM
    admin1
    CROSS JOIN
    ST_HexagonGrid(100000, admin1.geom) AS hex
WHERE
    adm0_a3 = 'USA'
    AND
    ST_Intersects(admin1.geom, hex.geom)</pre></div><div class="refsection"><a name="idp53898880"></a><h2>関連情報</h2><p><a class="xref" href="#">???</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#ST_SquareGrid" title="ST_SquareGrid">ST_SquareGrid</a>, <a class="xref" href="#ST_TileEnvelope" title="ST_TileEnvelope">ST_TileEnvelope</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Hexagon"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Hexagon — 与えられたエッジサイズと六角形グリッド空間内のセル座標を使って単一の六角形を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Hexagon</b>(</code>float8 <var class="pdparam">size</var>, integer <var class="pdparam">cell_i</var>, integer <var class="pdparam">cell_j</var>, geometry <var class="pdparam">origin</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp53908992"></a><h2>説明</h2><p><a class="xref" href="#ST_HexagonGrid" title="ST_HexagonGrid">ST_HexagonGrid</a>と同じ六角形タイルの概念を使いますが、求めるセルの座標に一つだけの六角形を生成します。任意でタイルの原点の座標を調整できます。デフォルトの原点座標は0,0です。 </p><p>六角形はSRIDの設定なしで生成されるので、SRIDを期待する値に設定するために<a class="xref" href="#">???</a>を使います。</p><p>Availability: 3.1.0</p></div><div class="refsection"><a name="idp53911552"></a><h2>例: 原点で六角形の生成</h2><pre class="programlisting">SELECT ST_AsText(ST_SetSRID(ST_Hexagon(1.0, 0, 0), 3857));

POLYGON((-1 0,-0.5
         -0.866025403784439,0.5
         -0.866025403784439,1
         0,0.5
         0.866025403784439,-0.5
         0.866025403784439,-1 0)) </pre></div><div class="refsection"><a name="idp53912832"></a><h2>関連情報</h2><p><a class="xref" href="#ST_TileEnvelope" title="ST_TileEnvelope">ST_TileEnvelope</a>, <a class="xref" href="#ST_HexagonGrid" title="ST_HexagonGrid">ST_HexagonGrid</a>, <a class="xref" href="#ST_Square" title="ST_Square">ST_Square</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_SquareGrid"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SquareGrid — 引数ジオメトリの境界を完全にカバーするグリッド正方形とセルインデックスを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">setof record <b class="fsfunc">ST_SquareGrid</b>(</code>float8 <var class="pdparam">size</var>, geometry <var class="pdparam">bounds</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp53920512"></a><h2>説明</h2><p>平面の正方形タイルの概念から始まります。与えられた平面SRSとエッジサイズに対して、SRS原点から始まり、一意の平面の正方形タイル(SRS, Size)が一つ存在します。この関数は、与えられたタイル(SRS, Size)内のグリッド内のどのタイルが与えられた境界とオーバラップするかという問題に答えを出します。</p><p>出力正方形のSRSは境界ジオメトリのSRSです。</p><p>正方形の2倍またはエッジサイズによって、新しい親タイルが生成されます。親タイルは完全に元のタイルに適合します。標準のウェブマップにおけるメルカトルのタイルは、メルカトル平面の2の累乗での正方形です。</p><p>Availability: 3.1.0</p></div><div class="refsection"><a name="idp53922816"></a><h2>例: 国の1度グリッドの生成</h2><p>グリッドは国の境界全体を埋めます。国に接触する四角形が欲しい場合には、ST_Intersects後にフィルタリングする必要があります。</p><pre class="programlisting">WITH grid AS (
SELECT (ST_SquareGrid(1, ST_Transform(geom,4326))).*
FROM admin0 WHERE name = 'Canada'
)
  SELEcT ST_AsText(geom)
  FROM grid</pre></div><div class="refsection"><a name="idp53924480"></a><h2>例: 正方形内のポイントの数え上げ (細かくした単一のグリッドを使用)</h2><p>正方形タイルのポイントのサマリを行うには、境界としてポイントの拡張を使った正方形グリッドを生成し、グリッドに空間的に結合します。推定範囲は実際の範囲と異なる場合があるのでご注意下さい。慎重に取り扱うようにし、最低でも確実にテーブルを解析して下さい。</p><pre class="programlisting">SELECT COUNT(*), squares.geom
    FROM
    pointtable AS pts
    INNER JOIN
    ST_SquareGrid(
        1000,
        ST_SetSRID(ST_EstimatedExtent('pointtable', 'geom'), 3857)
    ) AS squares
    ON ST_Intersects(pts.geom, squares.geom)
    GROUP BY squares.geom</pre></div><div class="refsection"><a name="idp53926144"></a><h2>例: ポイントごとのグリッドの集合を使った正方形内のポイント数え上げ</h2><p>これは最初の例と同じ結果になりますが、ポイント数が多くなると遅くなります。</p><pre class="programlisting">SELECT COUNT(*), squares.geom
    FROM
    pointtable AS pts
    INNER JOIN
    ST_SquareGrid(
        1000,
       pts.geom
    ) AS squares
    ON ST_Intersects(pts.geom, squares.geom)
    GROUP BY squares.geom</pre></div><div class="refsection"><a name="idp53927808"></a><h2>関連情報</h2><p><a class="xref" href="#ST_TileEnvelope" title="ST_TileEnvelope">ST_TileEnvelope</a>, <a class="xref" href="#ST_HexagonGrid" title="ST_HexagonGrid">ST_HexagonGrid</a> , <a class="xref" href="#">???</a> , <a class="xref" href="#">???</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Square"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Square — 与えられたエッジサイズと六角形グリッド空間内のセル座標を使って単一の正方形を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Square</b>(</code>float8 <var class="pdparam">size</var>, integer <var class="pdparam">cell_i</var>, integer <var class="pdparam">cell_j</var>, geometry <var class="pdparam">origin</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp53937920"></a><h2>説明</h2><p><a class="xref" href="#ST_SquareGrid" title="ST_SquareGrid">ST_SquareGrid</a>と同じ正方形タイルの概念を使っていますが、求めるセルの座標に一つだけの正方形を生成します。任意でタイルの原点の座標を調整できます。デフォルトの原点座標は0,0です。 </p><p>四角形はSRIDの設定なしで生成されるので、SRIDを期待する値に設定するために<a class="xref" href="#">???</a>を使います。</p><p>Availability: 3.1.0</p></div><div class="refsection"><a name="idp53940480"></a><h2>例: 原点で四角形の生成</h2><pre class="programlisting">SELECT ST_AsText(ST_SetSRID(ST_Square(1.0, 0, 0), 3857));

 POLYGON((0 0,0 1,1 1,1 0,0 0))</pre></div><div class="refsection"><a name="idp53941760"></a><h2>関連情報</h2><p><a class="xref" href="#ST_TileEnvelope" title="ST_TileEnvelope">ST_TileEnvelope</a>, <a class="xref" href="#ST_SquareGrid" title="ST_SquareGrid">ST_SquareGrid</a>, <a class="xref" href="#ST_Hexagon" title="ST_Hexagon">ST_Hexagon</a></p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Geometry_Accessors"></a>8.5. ジオメトリアクセサ</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#GeometryType">GeometryType</a></span><span class="refpurpose"> — ジオメトリの型を文字列で返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Boundary">ST_Boundary</a></span><span class="refpurpose"> — ジオメトリの境界を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_BoundingDiagonal">ST_BoundingDiagonal</a></span><span class="refpurpose"> — ジオメトリのバウンディングボックスの対角線を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_CoordDim">ST_CoordDim</a></span><span class="refpurpose"> — ジオメトリの座標次元を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Dimension">ST_Dimension</a></span><span class="refpurpose"> — ジオメトリのトポロジ次元を返します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_Dump">ST_Dump</a></span><span class="refpurpose"> — ジオメトリの要素ごとの<code class="varname">geometry_dump</code>行の集合を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_DumpPoints">ST_DumpPoints</a></span><span class="refpurpose"> — ジオメトリの座標の<code class="varname">geometry_dump</code>行の集合を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_DumpSegments">ST_DumpSegments</a></span><span class="refpurpose"> — ジオメトリの辺の<code class="varname">geometry_dump</code>行の集合を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_DumpRings">ST_DumpRings</a></span><span class="refpurpose"> — ポリゴンのリングごとの<code class="varname">geometry_dump</code>行の集合を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_EndPoint">ST_EndPoint</a></span><span class="refpurpose"> — LINESTRINGまたはCIRCULARLINESTRINGの終端のポイントを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Envelope">ST_Envelope</a></span><span class="refpurpose"> — ジオメトリのバウンディングボックスを表現するジオメトリを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_ExteriorRing">ST_ExteriorRing</a></span><span class="refpurpose"> — ポリゴンの外環を表現するラインストリングを返します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_GeometryN">ST_GeometryN</a></span><span class="refpurpose"> — ジオメトリコレクションの要素を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_GeometryType">ST_GeometryType</a></span><span class="refpurpose"> — ジオメトリのSQL-MM型を文字列で返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_HasArc">ST_HasArc</a></span><span class="refpurpose"> — ジオメトリに円弧が含まれているかどうかテストします。</span></dt><dt><span class="refentrytitle"><a href="#ST_InteriorRingN">ST_InteriorRingN</a></span><span class="refpurpose"> — ポリゴンのN番目の内環 (穴)を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_IsClosed">ST_IsClosed</a></span><span class="refpurpose"> — ラインストリングの始点と終点が一致しているかをテストします。多面体サーフェスについては閉じているか (立体であるか)をテストします。 </span></dt><dt><span class="refentrytitle"><a href="#ST_IsCollection">ST_IsCollection</a></span><span class="refpurpose"> — ジオメトリのタイプがジオメトリコレクションかをテストします。</span></dt><dt><span class="refentrytitle"><a href="#ST_IsEmpty">ST_IsEmpty</a></span><span class="refpurpose"> — ジオメトリが空かをテストします。</span></dt><dt><span class="refentrytitle"><a href="#ST_IsPolygonCCW">ST_IsPolygonCCW </a></span><span class="refpurpose"> — ポリゴンが反時計回りの外環を持っていて、時計回りの内環を持っているかをテストします。 </span></dt><dt><span class="refentrytitle"><a href="#ST_IsPolygonCW">ST_IsPolygonCW </a></span><span class="refpurpose"> — ポリゴンが時計回りの外環を持っていて、反時計回りの内環を持っているかをテストします。 </span></dt><dt><span class="refentrytitle"><a href="#ST_IsRing">ST_IsRing</a></span><span class="refpurpose"> — ラインストリングが閉じていてかつ単純であるかをテストします。</span></dt><dt><span class="refentrytitle"><a href="#ST_IsSimple">ST_IsSimple</a></span><span class="refpurpose"> — ジオメトリが自己インタセクトまたは自己接触となるポイントが無いかをテストします。</span></dt><dt><span class="refentrytitle"><a href="#ST_M">ST_M</a></span><span class="refpurpose"> — ポイントのM値を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_MemSize">ST_MemSize</a></span><span class="refpurpose"> — ジオメトリが取るメモリ空間の合計を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_NDims">ST_NDims</a></span><span class="refpurpose"> — じゅいおめとりの座標次元を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_NPoints">ST_NPoints</a></span><span class="refpurpose"> — ジオメトリのポイント (頂点)の数を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_NRings">ST_NRings</a></span><span class="refpurpose"> — ポリゴンジオメトリのリング数を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_NumGeometries">ST_NumGeometries</a></span><span class="refpurpose"> — ジオメトリコレクションの要素数を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_NumInteriorRings">ST_NumInteriorRings</a></span><span class="refpurpose"> — ポリゴンの内環 (穴)の数を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_NumInteriorRing">ST_NumInteriorRing</a></span><span class="refpurpose"> — ポリゴンの内環 (穴)の数を返します。ST_NumInteriorRingsの別名です。</span></dt><dt><span class="refentrytitle"><a href="#ST_NumPatches">ST_NumPatches</a></span><span class="refpurpose"> — 多面体サーフェスのフェイス数を返します。多面体でないジオメトリの場合にはNULLを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_NumPoints">ST_NumPoints</a></span><span class="refpurpose"> — ラインストリングまたは曲線ストリングのポイント数を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_PatchN">ST_PatchN</a></span><span class="refpurpose"> — 多面体サーフェスのN番目のジオメトリ (フェイス)を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_PointN">ST_PointN</a></span><span class="refpurpose"> — ジオメトリの最初のラインストリングまたは曲線ストリングのN番目のポイントを返します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_Points">ST_Points</a></span><span class="refpurpose"> — ジオメトリの座標を含むMULTIPOINTを返します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_StartPoint">ST_StartPoint</a></span><span class="refpurpose"> — ラインストリングの始点を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Summary">ST_Summary</a></span><span class="refpurpose"> — ジオメトリの中身の概要を文字列で返します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_X">ST_X</a></span><span class="refpurpose"> — ポイントのX値を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Y">ST_Y</a></span><span class="refpurpose"> — ポイントのY値を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Z">ST_Z</a></span><span class="refpurpose"> — ポイントのZ値を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Zmflag">ST_Zmflag</a></span><span class="refpurpose"> — ジオメトリのZM座標次元を示す符号を返します。</span></dt></dl></div><div class="refentry"><a name="GeometryType"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>GeometryType — ジオメトリの型を文字列で返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">GeometryType</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp54358272"></a><h2>説明</h2><p>ジオメトリの型を'LINESTRING', 'POLYGON', 'MULTIPOINT'等のような文字列で返します。</p><p>OGC SPEC s2.1.1.1 - このジオメトリインスタンスがメンバーになっているジオメトリのインスタンス化可能な派生タイプの名前を返します。インスタンス化可能な派生タイプの名前は、文字列として返されます。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数は、'POINTM'等が返るので、ジオメトリがM値を持っているかどうかも示します。</p></td></tr></table></div><p>Enhanced: 2.0.0 多面体サーフェス対応、三角対応、TIN対応が導入されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OGC Simple Features
 Implementation Specification for SQL 1.1.</a></p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div><div class="refsection"><a name="idp52817920"></a><h2>例</h2><pre class="programlisting">SELECT GeometryType(ST_GeomFromText('LINESTRING(77.29 29.07,77.42 29.26,77.27 29.31,77.29 29.07)'));
 geometrytype
--------------
 LINESTRING
</pre><pre class="programlisting">SELECT ST_GeometryType(ST_GeomFromEWKT('POLYHEDRALSURFACE( ((0 0 0, 0 0 1, 0 1 1, 0 1 0, 0 0 0)),
                ((0 0 0, 0 1 0, 1 1 0, 1 0 0, 0 0 0)), ((0 0 0, 1 0 0, 1 0 1, 0 0 1, 0 0 0)),
                ((1 1 0, 1 1 1, 1 0 1, 1 0 0, 1 1 0)),
                ((0 1 0, 0 1 1, 1 1 1, 1 1 0, 0 1 0)), ((0 0 1, 1 0 1, 1 1 1, 0 1 1, 0 0 1)) )'));
                        -- 結果 --
                        POLYHEDRALSURFACE
                        </pre><pre class="programlisting">SELECT GeometryType(geom) as result
  FROM
    (SELECT
       ST_GeomFromEWKT('TIN (((
                0 0 0,
                0 0 1,
                0 1 0,
                0 0 0
            )), ((
                0 0 0,
                0 1 0,
                1 1 0,
                0 0 0
            ))
            )')  AS geom
    ) AS g;
 result
--------
 TIN    </pre></div><div class="refsection"><a name="idp52820480"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeometryType" title="ST_GeometryType">ST_GeometryType</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Boundary"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Boundary — ジオメトリの境界を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Boundary</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp54378624"></a><h2>説明</h2><p>ジオメトリの組み合わせ境界の閉包を返します (訳注: ラインストリングは端点、ポリゴンはエッジ、複合オブジェクトは境界のうち奇数番)。組み合わせ境界はOGC仕様の3.12.3.2節に記述されています。結果として出てくる境界は、OGC SPEC 3.12.2で議論されているように、ジオメトリプリミティブを使って表現できます。</p><p>GEOSモジュールによって実現しています。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>2.0.0より前の版では、この関数は<code class="varname">GEOMETRYCOLLECTION</code>.を与えると例外を投げました。2.0.0以上では代わりにNULLが返ります (非対応入力)。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OGC Simple Features
 Implementation Specification for SQL 1.1.</a> OGC SPEC s2.1.1.1</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 5.1.14</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p>Enhanced: 2.1.0で三角対応が導入されました。</p><p>Changed: 3.2.0 TINへの対応、GEOSを使わないよう変更、曲線を直線化しないよう変更</p></div><div class="refsection"><a name="idp54415232"></a><h2>例</h2><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col><col></colgroup><tbody><tr><td style="border-right: 1px solid ; "><div class="informalfigure"><div class="mediaobject"><img src="images/st_boundary01.png"><div class="caption"><p>境界ポイントを重ねたラインストリング</p></div></div></div><p>
				</p><pre class="programlisting">SELECT ST_Boundary(geom)
FROM (SELECT 'LINESTRING(100 150,50 60, 70 80, 160 170)'::geometry As geom) As f;
                                </pre><p>
</p><pre class="screen">-- ST_AsText 出力
MULTIPOINT(100 150,160 170)
</pre><p>
						  </p></td><td style=""><div class="informalfigure"><div class="mediaobject"><img src="images/st_boundary02.png"><div class="caption"><p>境界マルチラインストリングを重ねたポリゴンの穴</p></div></div></div><p>
				</p><pre class="programlisting">SELECT ST_Boundary(geom)
FROM (SELECT
'POLYGON (( 10 130, 50 190, 110 190, 140 150, 150 80, 100 10, 20 40, 10 130 ),
        ( 70 40, 100 50, 120 80, 80 110, 50 90, 70 40 ))'::geometry As geom) As f;
                                </pre><p>
</p><pre class="screen">-- ST_AsText 出力 --
MULTILINESTRING((10 130,50 190,110 190,140 150,150 80,100 10,20 40,10 130),
        (70 40,100 50,120 80,80 110,50 90,70 40))
</pre><p>
						</p></td></tr></tbody></table></div><pre class="programlisting">SELECT ST_AsText(ST_Boundary(ST_GeomFromText('LINESTRING(1 1,0 0, -1 1)')));
st_astext
-----------
MULTIPOINT(1 1,-1 1)

SELECT ST_AsText(ST_Boundary(ST_GeomFromText('POLYGON((1 1,0 0, -1 1, 1 1))')));
st_astext
----------
LINESTRING(1 1,0 0,-1 1,1 1)

-- 3次元ポリゴンを使用
SELECT ST_AsEWKT(ST_Boundary(ST_GeomFromEWKT('POLYGON((1 1 1,0 0 1, -1 1 1, 1 1 1))')));

st_asewkt
-----------------------------------
LINESTRING(1 1 1,0 0 1,-1 1 1,1 1 1)

-- 3次元マルチラインストリングを使用
SELECT ST_AsEWKT(ST_Boundary(ST_GeomFromEWKT('MULTILINESTRING((1 1 1,0 0 0.5, -1 1 1),(1 1 0.5,0 0 0.5, -1 1 0.5, 1 1 0.5) )')));

st_asewkt
----------
MULTIPOINT(-1 1 1,1 1 0.75)
</pre></div><div class="refsection"><a name="idp54425344"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a>, <a class="xref" href="#ST_ExteriorRing" title="ST_ExteriorRing">ST_ExteriorRing</a>, <a class="xref" href="#ST_MakePolygon" title="ST_MakePolygon">ST_MakePolygon</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_BoundingDiagonal"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_BoundingDiagonal — ジオメトリのバウンディングボックスの対角線を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_BoundingDiagonal</b>(</code>geometry  <var class="pdparam">geom</var>, boolean  <var class="pdparam">fits=false</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp54428928"></a><h2>説明</h2><p>ジオメトリのバウンディングボックスの対角線をLINESTRINGで返します。対角線は、各軸の最小値となる点を始端とし、最大値となる点を終端とする2点のLINESTRINGです。入力ジオメトリが空である場合にはLINESTRING EMPTYを返します。 </p><p>任意パラメータ<code class="varname">fits</code>は、最適な適合が必要かどうかを指定するものです。FALSEの場合には、より大きいバウンディングボックスの対角線を受け付けます (多数の頂点を持つジオメトリではより速くなります)。いずれの場合でも、返り値の対角線のバウンディングボックスは、常に入力ジオメトリを含みます。 </p><p>返されたジオメトリは、入力ジオメトリのSRIDと次元 (Z, M)が維持されています。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>縮退する場合 (入力に頂点が一つだけ等の場合)には、返されるラインストリングは正式には不正になります (内部領域なし)。結果はトポロジ的に有効です。 </p></td></tr></table></div><p>Availability: 2.2.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports M coordinates.</p></div><div class="refsection"><a name="idp54436096"></a><h2>例</h2><pre class="programlisting">-- ポイント周りのバッファのXの最小値を得る
SELECT ST_X(ST_StartPoint(ST_BoundingDiagonal(
  ST_Buffer(ST_Point(0,0),10)
)));
 st_x
------
  -10
                </pre></div><div class="refsection"><a name="idp54437376"></a><h2>関連情報</h2><p><a class="xref" href="#ST_StartPoint" title="ST_StartPoint">ST_StartPoint</a>, <a class="xref" href="#ST_EndPoint" title="ST_EndPoint">ST_EndPoint</a>, <a class="xref" href="#ST_X" title="ST_X">ST_X</a>, <a class="xref" href="#ST_Y" title="ST_Y">ST_Y</a>, <a class="xref" href="#ST_Z" title="ST_Z">ST_Z</a>, <a class="xref" href="#ST_M" title="ST_M">ST_M</a>, <a class="xref" href="#ST_Envelope" title="ST_Envelope">ST_Envelope</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_CoordDim"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_CoordDim — ジオメトリの座標次元を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_CoordDim</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp54445568"></a><h2>説明</h2><p>ST_Geometry値の座標次元を返します。</p><p>この関数は<a class="xref" href="#ST_NDims" title="ST_NDims">ST_NDims</a>のMM対応の別名です。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OGC Simple Features
 Implementation Specification for SQL 1.1.</a></p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 5.1.3</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div><div class="refsection"><a name="idp54455808"></a><h2>例</h2><pre class="programlisting">SELECT ST_CoordDim('CIRCULARSTRING(1 2 3, 1 3 4, 5 6 7, 8 9 10, 11 12 13)');
                        -- 結果 --
                                3

                                SELECT ST_CoordDim(ST_Point(1,2));
                        -- 結果 --
                                2

                </pre></div><div class="refsection"><a name="idp54457344"></a><h2>関連情報</h2><p><a class="xref" href="#ST_NDims" title="ST_NDims">ST_NDims</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Dimension"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Dimension — ジオメトリのトポロジ次元を返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_Dimension</b>(</code>geometry  <var class="pdparam">g</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp54463104"></a><h2>説明</h2><p>ジオメトリのトポロジ次元を返します。 </p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 5.1.2</p><p>Enhanced: 2.0.0 多面体サーフェス対応とTIN対応が導入されました。空ジオメトリを与えた場合に例外を投げなくなりました。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>2.0.0より前では、空ジオメトリを与えると例外を投げていました。 </p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div><div class="refsection"><a name="idp54469504"></a><h2>例</h2><pre class="programlisting">SELECT ST_Dimension('GEOMETRYCOLLECTION(LINESTRING(1 1,0 0),POINT(0 0))');
ST_Dimension
-----------
1
</pre></div><div class="refsection"><a name="idp54470784"></a><h2>関連情報</h2><p><a class="xref" href="#ST_NDims" title="ST_NDims">ST_NDims</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Dump"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Dump — ジオメトリの要素ごとの<code class="varname">geometry_dump</code>行の集合を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry_dump[] <b class="fsfunc">ST_Dump</b>(</code>geometry  <var class="pdparam">g1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp54476928"></a><h2>説明</h2><p>ジオメトリ要素を抽出する、集合を返す関数 (SRF=Set-Returning Function)です。ジオメトリ (<em class="parameter"><code>geom</code></em>フィールド)と整数配列 (<em class="parameter"><code>path</code></em>フィールド)からなる<a class="xref" href="#geometry_dump" title="geometry_dump">geometry_dump</a>行の集合を返します。 </p><p>非マルチ系ジオメトリタイプ (POINT,LINESTRING,POLYGON)では、<em class="parameter"><code>path</code></em>配列が空で<em class="parameter"><code>geom</code></em>.が入力ジオメトリと同じになる一の行が帰ります。コレクションまたはマルチ系ジオメトリでは、個々の要素と、コレクションの要素位置を示す<em class="parameter"><code>path</code></em>とからなる行を返します。</p><p>ST_Dumpはジオメトリを展開するのに使います。<a class="xref" href="#ST_Collect" title="ST_Collect">ST_Collect</a>/GROUP BYの逆で、この関数の中で新行を作成します。たとえば、MULTIPOLYGONをPOLYGONに展開するために使います。</p><p>Enhanced: 2.0.0 多面体サーフェス対応、三角対応、TIN対応が導入されました。</p><p>Availability: PostGIS 1.0.0RC1 PostgreSQL 7.3以上が必要です。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>1.3.4より前では、曲線を含むジオメトリで使用すると、この関数はクラッシュします。これは1.3.4以上で訂正されています。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp54489088"></a><h2>標準的な例</h2><pre class="programlisting">SELECT sometable.field1, sometable.field1,
      (ST_Dump(sometable.geom)).geom AS geom
FROM sometable;

-- 複合曲線を構成要素のLINESTRINGとCIRCULARSTRINGに分解
SELECT ST_AsEWKT(a.geom), ST_HasArc(a.geom)
  FROM ( SELECT (ST_Dump(p_geom)).geom AS geom
         FROM (SELECT ST_GeomFromEWKT('COMPOUNDCURVE(CIRCULARSTRING(0 0, 1 1, 1 0),(1 0, 0 1))') AS p_geom) AS b
        ) AS a;
          st_asewkt          | st_hasarc
-----------------------------+----------
 CIRCULARSTRING(0 0,1 1,1 0) | t
 LINESTRING(1 0,0 1)         | f
(2 rows)</pre></div><div class="refsection"><a name="idp54490368"></a><h2>多面体サーフェス、TIN、三角形の例</h2><pre class="programlisting">-- 多面体サーフェスの例
-- 多面体サーフェスを面に分解
SELECT (a.p_geom).path[1] As path, ST_AsEWKT((a.p_geom).geom) As geom_ewkt
  FROM (SELECT ST_Dump(ST_GeomFromEWKT('POLYHEDRALSURFACE(
((0 0 0, 0 0 1, 0 1 1, 0 1 0, 0 0 0)),
((0 0 0, 0 1 0, 1 1 0, 1 0 0, 0 0 0)), ((0 0 0, 1 0 0, 1 0 1, 0 0 1, 0 0 0)),  ((1 1 0, 1 1 1, 1 0 1, 1 0 0, 1 1 0)),
((0 1 0, 0 1 1, 1 1 1, 1 1 0, 0 1 0)),  ((0 0 1, 1 0 1, 1 1 1, 0 1 1, 0 0 1))
)') ) AS p_geom )  AS a;

 path |                geom_ewkt
------+------------------------------------------
    1 | POLYGON((0 0 0,0 0 1,0 1 1,0 1 0,0 0 0))
    2 | POLYGON((0 0 0,0 1 0,1 1 0,1 0 0,0 0 0))
    3 | POLYGON((0 0 0,1 0 0,1 0 1,0 0 1,0 0 0))
    4 | POLYGON((1 1 0,1 1 1,1 0 1,1 0 0,1 1 0))
    5 | POLYGON((0 1 0,0 1 1,1 1 1,1 1 0,0 1 0))
    6 | POLYGON((0 0 1,1 0 1,1 1 1,0 1 1,0 0 1))</pre><pre class="programlisting">-- TIN --
SELECT (g.gdump).path, ST_AsEWKT((g.gdump).geom) as wkt
  FROM
    (SELECT
       ST_Dump( ST_GeomFromEWKT('TIN (((
                0 0 0,
                0 0 1,
                0 1 0,
                0 0 0
            )), ((
                0 0 0,
                0 1 0,
                1 1 0,
                0 0 0
            ))
            )') ) AS gdump
    ) AS g;
-- 結果 --
 path |                 wkt
------+-------------------------------------
 {1}  | TRIANGLE((0 0 0,0 0 1,0 1 0,0 0 0))
 {2}  | TRIANGLE((0 0 0,0 1 0,1 1 0,0 0 0))
</pre></div><div class="refsection"><a name="idp54492032"></a><h2>関連情報</h2><p><a class="xref" href="#geometry_dump" title="geometry_dump">geometry_dump</a>, <a class="xref" href="#PostGIS_Geometry_DumpFunctions" title="15.6. PostGISジオメトリ/ジオグラフィ/ラスタのダンプ関数">「PostGISジオメトリ/ジオグラフィ/ラスタのダンプ関数」</a>, <a class="xref" href="#ST_Collect" title="ST_Collect">ST_Collect</a>, <a class="xref" href="#ST_GeometryN" title="ST_GeometryN">ST_GeometryN</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_DumpPoints"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_DumpPoints — ジオメトリの座標の<code class="varname">geometry_dump</code>行の集合を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry_dump[] <b class="fsfunc">ST_DumpPoints</b>(</code>geometry  <var class="pdparam">geom</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp54499328"></a><h2>説明</h2><p>ジオメトリの座標値 (頂点)を抽出する、集合を返す関数 (SRF=Set-Returning Function)です。ジオメトリ (<em class="parameter"><code>geom</code></em>フィールド)と整数配列 (<em class="parameter"><code>path</code></em>フィールド)からなる<a class="xref" href="#geometry_dump" title="geometry_dump">geometry_dump</a>行の集合を返します。 </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><em class="parameter"><code>geom</code></em>フィールド 与えたジオメトリの座標値を表現する<code class="varname">POINT</code>。 </p></li><li class="listitem"><p><em class="parameter"><code>path</code></em>フィールド (<code class="varname">integer[]</code>)は、与えられたジオメトリの要素内の座標の位置を列挙するインデックスです。インデックスは1はじまりです。たとえば、<code class="varname">LINESTRING</code>について、pathは<code class="varname">{i}</code>です。ただし<code class="varname">i</code>は、<code class="varname">LINESTRING</code>の<code class="varname">nth</code>番目の座標です。また、<code class="varname">POLYGON</code>については、pathは<code class="varname">{i,j}</code>です。ただし、<code class="varname">i</code>はリング番号(1は外側リングで内側リングが続きます)で、<code class="varname">j</code>はリング内の座標の位置です。 </p></li></ul></div><p>座標を含む単一ジオメトリを得るには<a class="xref" href="#ST_Points" title="ST_Points">ST_Points</a>を使います。 </p><p>Enhanced: 2.1.0 速度向上しました。C言語で実装しなおしました。</p><p>Enhanced: 2.0.0 多面体サーフェス対応、三角対応、TIN対応が導入されました。</p><p>Availability: 1.5.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp54516096"></a><h2>ラインストリングのテーブルのノードへの古典的な分割</h2><pre class="programlisting">SELECT edge_id, (dp).path[1] As index, ST_AsText((dp).geom) As wktnode
FROM (SELECT 1 As edge_id
        , ST_DumpPoints(ST_GeomFromText('LINESTRING(1 2, 3 4, 10 10)')) AS dp
     UNION ALL
     SELECT 2 As edge_id
        , ST_DumpPoints(ST_GeomFromText('LINESTRING(3 5, 5 6, 9 10)')) AS dp
   ) As foo;
 edge_id | index |    wktnode
---------+-------+--------------
       1 |     1 | POINT(1 2)
       1 |     2 | POINT(3 4)
       1 |     3 | POINT(10 10)
       2 |     1 | POINT(3 5)
       2 |     2 | POINT(5 6)
       2 |     3 | POINT(9 10)</pre></div><div class="refsection"><a name="idp54517248"></a><h2>標準的なジオメトリの例</h2><div class="informalfigure"><div class="mediaobject"><img src="images/st_dumppoints01.png"></div></div><pre class="programlisting">SELECT path, ST_AsText(geom)
FROM (
  SELECT (ST_DumpPoints(g.geom)).*
  FROM
    (SELECT
       'GEOMETRYCOLLECTION(
          POINT ( 0 1 ),
          LINESTRING ( 0 3, 3 4 ),
          POLYGON (( 2 0, 2 3, 0 2, 2 0 )),
          POLYGON (( 3 0, 3 3, 6 3, 6 0, 3 0 ),
                   ( 5 1, 4 2, 5 2, 5 1 )),
          MULTIPOLYGON (
                  (( 0 5, 0 8, 4 8, 4 5, 0 5 ),
                   ( 1 6, 3 6, 2 7, 1 6 )),
                  (( 5 4, 5 8, 6 7, 5 4 ))
          )
        )'::geometry AS geom
    ) AS g
  ) j;

   path    | st_astext
-----------+------------
 {1,1}     | POINT(0 1)
 {2,1}     | POINT(0 3)
 {2,2}     | POINT(3 4)
 {3,1,1}   | POINT(2 0)
 {3,1,2}   | POINT(2 3)
 {3,1,3}   | POINT(0 2)
 {3,1,4}   | POINT(2 0)
 {4,1,1}   | POINT(3 0)
 {4,1,2}   | POINT(3 3)
 {4,1,3}   | POINT(6 3)
 {4,1,4}   | POINT(6 0)
 {4,1,5}   | POINT(3 0)
 {4,2,1}   | POINT(5 1)
 {4,2,2}   | POINT(4 2)
 {4,2,3}   | POINT(5 2)
 {4,2,4}   | POINT(5 1)
 {5,1,1,1} | POINT(0 5)
 {5,1,1,2} | POINT(0 8)
 {5,1,1,3} | POINT(4 8)
 {5,1,1,4} | POINT(4 5)
 {5,1,1,5} | POINT(0 5)
 {5,1,2,1} | POINT(1 6)
 {5,1,2,2} | POINT(3 6)
 {5,1,2,3} | POINT(2 7)
 {5,1,2,4} | POINT(1 6)
 {5,2,1,1} | POINT(5 4)
 {5,2,1,2} | POINT(5 8)
 {5,2,1,3} | POINT(6 7)
 {5,2,1,4} | POINT(5 4)
(29 rows)</pre></div><div class="refsection"><a name="idp54520192"></a><h2>多面体サーフェス、TIN、三角形の例</h2><pre class="programlisting">-- 多面体サーフェスの立方体--
SELECT (g.gdump).path, ST_AsEWKT((g.gdump).geom) as wkt
  FROM
    (SELECT
       ST_DumpPoints(ST_GeomFromEWKT('POLYHEDRALSURFACE( ((0 0 0, 0 0 1, 0 1 1, 0 1 0, 0 0 0)),
((0 0 0, 0 1 0, 1 1 0, 1 0 0, 0 0 0)), ((0 0 0, 1 0 0, 1 0 1, 0 0 1, 0 0 0)),
((1 1 0, 1 1 1, 1 0 1, 1 0 0, 1 1 0)),
((0 1 0, 0 1 1, 1 1 1, 1 1 0, 0 1 0)), ((0 0 1, 1 0 1, 1 1 1, 0 1 1, 0 0 1)) )') ) AS gdump
    ) AS g;
-- 結果 --
  path   |     wkt
---------+--------------
 {1,1,1} | POINT(0 0 0)
 {1,1,2} | POINT(0 0 1)
 {1,1,3} | POINT(0 1 1)
 {1,1,4} | POINT(0 1 0)
 {1,1,5} | POINT(0 0 0)
 {2,1,1} | POINT(0 0 0)
 {2,1,2} | POINT(0 1 0)
 {2,1,3} | POINT(1 1 0)
 {2,1,4} | POINT(1 0 0)
 {2,1,5} | POINT(0 0 0)
 {3,1,1} | POINT(0 0 0)
 {3,1,2} | POINT(1 0 0)
 {3,1,3} | POINT(1 0 1)
 {3,1,4} | POINT(0 0 1)
 {3,1,5} | POINT(0 0 0)
 {4,1,1} | POINT(1 1 0)
 {4,1,2} | POINT(1 1 1)
 {4,1,3} | POINT(1 0 1)
 {4,1,4} | POINT(1 0 0)
 {4,1,5} | POINT(1 1 0)
 {5,1,1} | POINT(0 1 0)
 {5,1,2} | POINT(0 1 1)
 {5,1,3} | POINT(1 1 1)
 {5,1,4} | POINT(1 1 0)
 {5,1,5} | POINT(0 1 0)
 {6,1,1} | POINT(0 0 1)
 {6,1,2} | POINT(1 0 1)
 {6,1,3} | POINT(1 1 1)
 {6,1,4} | POINT(0 1 1)
 {6,1,5} | POINT(0 0 1)
(30 rows)</pre><pre class="programlisting">-- 三角形 --
SELECT (g.gdump).path, ST_AsText((g.gdump).geom) as wkt
  FROM
    (SELECT
       ST_DumpPoints( ST_GeomFromEWKT('TRIANGLE ((
                0 0,
                0 9,
                9 0,
                0 0
            ))') ) AS gdump
    ) AS g;
-- 結果 --
 path |    wkt
------+------------
 {1}  | POINT(0 0)
 {2}  | POINT(0 9)
 {3}  | POINT(9 0)
 {4}  | POINT(0 0)
</pre><pre class="programlisting">-- TIN --
SELECT (g.gdump).path, ST_AsEWKT((g.gdump).geom) as wkt
  FROM
    (SELECT
       ST_DumpPoints( ST_GeomFromEWKT('TIN (((
                0 0 0,
                0 0 1,
                0 1 0,
                0 0 0
            )), ((
                0 0 0,
                0 1 0,
                1 1 0,
                0 0 0
            ))
            )') ) AS gdump
    ) AS g;
-- 結果 --
  path   |     wkt
---------+--------------
 {1,1,1} | POINT(0 0 0)
 {1,1,2} | POINT(0 0 1)
 {1,1,3} | POINT(0 1 0)
 {1,1,4} | POINT(0 0 0)
 {2,1,1} | POINT(0 0 0)
 {2,1,2} | POINT(0 1 0)
 {2,1,3} | POINT(1 1 0)
 {2,1,4} | POINT(0 0 0)
(8 rows)
</pre></div><div class="refsection"><a name="idp54534784"></a><h2>関連情報</h2><p><a class="xref" href="#geometry_dump" title="geometry_dump">geometry_dump</a>, <a class="xref" href="#PostGIS_Geometry_DumpFunctions" title="15.6. PostGISジオメトリ/ジオグラフィ/ラスタのダンプ関数">「PostGISジオメトリ/ジオグラフィ/ラスタのダンプ関数」</a>, <a class="xref" href="#ST_Dump" title="ST_Dump">ST_Dump</a>, <a class="xref" href="#ST_DumpRings" title="ST_DumpRings">ST_DumpRings</a>, <a class="xref" href="#ST_Points" title="ST_Points">ST_Points</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_DumpSegments"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_DumpSegments — ジオメトリの辺の<code class="varname">geometry_dump</code>行の集合を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry_dump[] <b class="fsfunc">ST_DumpSegments</b>(</code>geometry  <var class="pdparam">geom</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp54554752"></a><h2>説明</h2><p>ジオメトリの辺を抽出する、集合を返す関数 (SRF=Set-Returning Function)です。ジオメトリ (<em class="parameter"><code>geom</code></em>フィールド)と整数配列 (<em class="parameter"><code>path</code></em>フィールド)からなる<a class="xref" href="#geometry_dump" title="geometry_dump">geometry_dump</a>行の集合を返します。 </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><em class="parameter"><code>geom</code></em>フィールド 与えられたジオメトリの辺の<code class="varname">LINESTRING</code>表現 </p></li><li class="listitem"><p><em class="parameter"><code>path</code></em>フィールド (<code class="varname">integer[]</code>)は、与えられたジオメトリの要素内の辺の位置を列挙するインデックスです。インデックスは1はじまりです。たとえば、<code class="varname">LINESTRING</code>について、pathは<code class="varname">{i}</code>です。ただし<code class="varname">i</code>は、<code class="varname">LINESTRING</code>の<code class="varname">nth</code>番目の辺の始端位置です。また、<code class="varname">POLYGON</code>については、pathは<code class="varname">{i,j}</code>です。ただし、<code class="varname">i</code>はリング番号 (1は外側リングで内側リングが続きます)で、<code class="varname">j</code>はリング内の辺の始端位置です。 </p></li></ul></div><p>Availability: 3.2.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp54567552"></a><h2>標準的なジオメトリの例</h2><pre class="programlisting">SELECT path, ST_AsText(geom)
FROM (
    SELECT (ST_DumpSegments(g.geom)).*
    FROM (SELECT 'GEOMETRYCOLLECTION(
    LINESTRING(1 1, 3 3, 4 4),
    POLYGON((5 5, 6 6, 7 7, 5 5))
)'::geometry AS geom
        ) AS g
) j;

  path   │      st_astext
---------------------------------
 {1,1}   │ LINESTRING(1 1,3 3)
 {1,2}   │ LINESTRING(3 3,4 4)
 {2,1,1} │ LINESTRING(5 5,6 6)
 {2,1,2} │ LINESTRING(6 6,7 7)
 {2,1,3} │ LINESTRING(7 7,5 5)
(5 rows)</pre></div><div class="refsection"><a name="idp54568832"></a><h2>TINと三角形の例</h2><pre class="programlisting">-- 三角形 --
SELECT path, ST_AsText(geom)
FROM (
    SELECT (ST_DumpSegments(g.geom)).*
    FROM (SELECT 'TRIANGLE((
        0 0,
        0 9,
        9 0,
        0 0
    ))'::geometry AS geom
        ) AS g
) j;

 path  │      st_astext
 ---------------------------------
 {1,1} │ LINESTRING(0 0,0 9)
 {1,2} │ LINESTRING(0 9,9 0)
 {1,3} │ LINESTRING(9 0,0 0)
(3 rows)
</pre><pre class="programlisting">-- TIN --
SELECT path, ST_AsEWKT(geom)
FROM (
    SELECT (ST_DumpSegments(g.geom)).*
    FROM (SELECT 'TIN(((
        0 0 0,
        0 0 1,
        0 1 0,
        0 0 0
    )), ((
        0 0 0,
        0 1 0,
        1 1 0,
        0 0 0
    ))
    )'::geometry AS geom
        ) AS g
) j;

  path   │        st_asewkt
  ---------------------------------
 {1,1,1} │ LINESTRING(0 0 0,0 0 1)
 {1,1,2} │ LINESTRING(0 0 1,0 1 0)
 {1,1,3} │ LINESTRING(0 1 0,0 0 0)
 {2,1,1} │ LINESTRING(0 0 0,0 1 0)
 {2,1,2} │ LINESTRING(0 1 0,1 1 0)
 {2,1,3} │ LINESTRING(1 1 0,0 0 0)
(6 rows)
</pre></div><div class="refsection"><a name="idp54570624"></a><h2>関連情報</h2><p><a class="xref" href="#geometry_dump" title="geometry_dump">geometry_dump</a>, <a class="xref" href="#PostGIS_Geometry_DumpFunctions" title="15.6. PostGISジオメトリ/ジオグラフィ/ラスタのダンプ関数">「PostGISジオメトリ/ジオグラフィ/ラスタのダンプ関数」</a>, <a class="xref" href="#ST_Dump" title="ST_Dump">ST_Dump</a>, <a class="xref" href="#ST_DumpRings" title="ST_DumpRings">ST_DumpRings</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_DumpRings"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_DumpRings — ポリゴンのリングごとの<code class="varname">geometry_dump</code>行の集合を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry_dump[] <b class="fsfunc">ST_DumpRings</b>(</code>geometry  <var class="pdparam">a_polygon</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp54582016"></a><h2>説明</h2><p>ポリゴンのリングを抽出する、集合を返す関数 (SRF=Set-Returning Function)です。ジオメトリ (<em class="parameter"><code>geom</code></em>フィールド)と整数配列 (<em class="parameter"><code>path</code></em>フィールド)からなる<a class="xref" href="#geometry_dump" title="geometry_dump">geometry_dump</a>行の集合を返します。 </p><p><em class="parameter"><code>geom</code></em>フィールドは、個々のリングをPOLYGONとして持っています。<em class="parameter"><code>path</code></em>フィールドは、長さ1の整数配列で、リングのインデックスを示す値を持ちます。外側リング (殻)のインデックスは0です。内側リング (穴)は1以上です。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これは、POLYGONジオメトリでのみ動作します。MULTOPLYGONでは動作しません。</p></td></tr></table></div><p>Availability: PostGIS 1.1.3 PostgreSQL 7.3以上が必要です。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp54588288"></a><h2>例</h2><p>クエリの一般的な形式。</p><pre class="programlisting">SELECT polyTable.field1, polyTable.field1,
          (ST_DumpRings(polyTable.geom)).geom As geom
FROM polyTable;
</pre><p>穴を一つ持つポリゴン</p><pre class="programlisting">SELECT path, ST_AsEWKT(geom) As geom
        FROM ST_DumpRings(
                ST_GeomFromEWKT('POLYGON((-8149064 5133092 1,-8149064 5132986 1,-8148996 5132839 1,-8148972 5132767 1,-8148958 5132508 1,-8148941 5132466 1,-8148924 5132394 1,
                -8148903 5132210 1,-8148930 5131967 1,-8148992 5131978 1,-8149237 5132093 1,-8149404 5132211 1,-8149647 5132310 1,-8149757 5132394 1,
                -8150305 5132788 1,-8149064 5133092 1),
                (-8149362 5132394 1,-8149446 5132501 1,-8149548 5132597 1,-8149695 5132675 1,-8149362 5132394 1))')
                )  as foo;
 path |                                            geom
----------------------------------------------------------------------------------------------------------------
  {0} | POLYGON((-8149064 5133092 1,-8149064 5132986 1,-8148996 5132839 1,-8148972 5132767 1,-8148958 5132508 1,
          |          -8148941 5132466 1,-8148924 5132394 1,
          |          -8148903 5132210 1,-8148930 5131967 1,
          |          -8148992 5131978 1,-8149237 5132093 1,
          |          -8149404 5132211 1,-8149647 5132310 1,-8149757 5132394 1,-8150305 5132788 1,-8149064 5133092 1))
  {1} | POLYGON((-8149362 5132394 1,-8149446 5132501 1,
          |          -8149548 5132597 1,-8149695 5132675 1,-8149362 5132394 1))</pre></div><div class="refsection"><a name="idp54591232"></a><h2>関連情報</h2><p><a class="xref" href="#geometry_dump" title="geometry_dump">geometry_dump</a>, <a class="xref" href="#PostGIS_Geometry_DumpFunctions" title="15.6. PostGISジオメトリ/ジオグラフィ/ラスタのダンプ関数">「PostGISジオメトリ/ジオグラフィ/ラスタのダンプ関数」</a>, <a class="xref" href="#ST_Dump" title="ST_Dump">ST_Dump</a>, <a class="xref" href="#ST_ExteriorRing" title="ST_ExteriorRing">ST_ExteriorRing</a>, <a class="xref" href="#ST_InteriorRingN" title="ST_InteriorRingN">ST_InteriorRingN</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_EndPoint"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_EndPoint — LINESTRINGまたはCIRCULARLINESTRINGの終端のポイントを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_EndPoint</b>(</code>geometry  <var class="pdparam">g</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp54598528"></a><h2>説明</h2><p><code class="varname">LINESTRING</code>または<code class="varname">CIRCULARLINESTRING</code>ジオメトリの、最後のポイントを<code class="varname">POINT</code>で返します。入力パラメータが<code class="varname">LINESTRING</code>でも<code class="varname">CIRCULARLINESTRING</code>でもない場合には、<code class="varname">NULL</code>を返します。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 7.1.4</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Changed: 2.0.0 一つのジオメトリマルチラインストリングで動作しなくなりました。PostGIS の古いバージョンでは、この関数は一つのマルチラインストリングで動作し、終端ポイントを返します。2.0.0では、他のマルチラインストリングと同様にNULLを返します。古い動作は文書化されていない機能でしたが、データをLINESTRINGとして格納していると思われるユーザーは、2.0.0 でNULLが返されることを経験するかも知れません。</p></td></tr></table></div></div><div class="refsection"><a name="idp54606336"></a><h2>例</h2><p>ラインストリングの終端ポイント</p><pre class="programlisting">postgis=# SELECT ST_AsText(ST_EndPoint('LINESTRING(1 1, 2 2, 3 3)'::geometry));
 st_astext
------------
 POINT(3 3)
</pre><p>ラインストリング以外の終端ポイントはNULL</p><pre class="programlisting">SELECT ST_EndPoint('POINT(1 1)'::geometry) IS NULL AS is_null;
  is_null
----------
 t
</pre><p>3次元ラインストリングの終端ポイント</p><pre class="programlisting">-- 3次元終端ポイント
SELECT ST_AsEWKT(ST_EndPoint('LINESTRING(1 1 2, 1 2 3, 0 0 5)'));
  st_asewkt
--------------
 POINT(0 0 5)
</pre><p>CIRCULARSTRINGの終端ポイント</p><pre class="programlisting">SELECT ST_AsText(ST_EndPoint('CIRCULARSTRING(5 2,-3 1.999999, -2 1, -4 2, 6 3)'::geometry));
 st_astext
------------
 POINT(6 3)
</pre></div><div class="refsection"><a name="idp54610816"></a><h2>関連情報</h2><p><a class="xref" href="#ST_PointN" title="ST_PointN">ST_PointN</a>, <a class="xref" href="#ST_StartPoint" title="ST_StartPoint">ST_StartPoint</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Envelope"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Envelope — ジオメトリのバウンディングボックスを表現するジオメトリを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Envelope</b>(</code>geometry  <var class="pdparam">g1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp54616960"></a><h2>説明</h2><p>与えられたジオメトリの倍精度浮動小数点数 (float8)の最小バウンディングボックスをジオメトリで返します。ポリゴンはバウンディングボックスの角のポイントで定義されます ((<code class="varname">MINX</code>, <code class="varname">MINY</code>), (<code class="varname">MINX</code>, <code class="varname">MAXY</code>), (<code class="varname">MAXX</code>, <code class="varname">MAXY</code>), (<code class="varname">MAXX</code>, <code class="varname">MINY</code>), (<code class="varname">MINX</code>, <code class="varname">MINY</code>))。(PostGISは<code class="varname">ZMIN</code>/<code class="varname">ZMAX</code>も追加します).</p><p>縮退する場合 (縦のライン、ポイント)は<code class="varname">POLYGON</code>より低い次元のジオメトリ、すなわち<code class="varname">POINT</code>または<code class="varname">LINESTRING</code>を返します。</p><p>Availability: 1.5.0 挙動が変更され出力がfloat4からfloat8になりました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OGC Simple Features
 Implementation Specification for SQL 1.1.</a> s2.1.1.1</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 5.1.15</p></div><div class="refsection"><a name="idp54631808"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(ST_Envelope('POINT(1 3)'::geometry));
 st_astext
------------
 POINT(1 3)
(1 row)


SELECT ST_AsText(ST_Envelope('LINESTRING(0 0, 1 3)'::geometry));
                   st_astext
--------------------------------
 POLYGON((0 0,0 3,1 3,1 0,0 0))
(1 row)


SELECT ST_AsText(ST_Envelope('POLYGON((0 0, 0 1, 1.0000001 1, 1.0000001 0, 0 0))'::geometry));
                                                  st_astext
--------------------------------------------------------------
 POLYGON((0 0,0 1,1.00000011920929 1,1.00000011920929 0,0 0))
(1 row)
SELECT ST_AsText(ST_Envelope('POLYGON((0 0, 0 1, 1.0000000001 1, 1.0000000001 0, 0 0))'::geometry));
                                                  st_astext
--------------------------------------------------------------
 POLYGON((0 0,0 1,1.00000011920929 1,1.00000011920929 0,0 0))
(1 row)

SELECT Box3D(geom), Box2D(geom), ST_AsText(ST_Envelope(geom)) As envelopewkt
        FROM (SELECT 'POLYGON((0 0, 0 1000012333334.34545678, 1.0000001 1, 1.0000001 0, 0 0))'::geometry As geom) As foo;


        </pre><div class="informalfigure"><div class="mediaobject"><img src="images/st_envelope01.png"><div class="caption"><p>ポイントとラインストリングの最小バウンディングボックス</p></div></div></div><pre class="programlisting">SELECT ST_AsText(ST_Envelope(
                ST_Collect(
                        ST_GeomFromText('LINESTRING(55 75,125 150)'),
                                ST_Point(20, 80))
                                )) As wktenv;
wktenv
-----------
POLYGON((20 75,20 150,125 150,125 75,20 75))</pre></div><div class="refsection"><a name="idp54636032"></a><h2>関連情報</h2><p><a class="xref" href="#">???</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#ST_OrientedEnvelope" title="ST_OrientedEnvelope">ST_OrientedEnvelope</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_ExteriorRing"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ExteriorRing — ポリゴンの外環を表現するラインストリングを返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_ExteriorRing</b>(</code>geometry  <var class="pdparam">a_polygon</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp54642560"></a><h2>説明</h2><p>POLYGONの外側リング (殻)を表現するLINESTRINGを返します。ジオメトリがPOLYGONでない場合にはNULLを返します。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はMULTIPOLYGONに対応していません。MULTIPOLYGONに対しては<a class="xref" href="#ST_GeometryN" title="ST_GeometryN">ST_GeometryN</a>または<a class="xref" href="#ST_Dump" title="ST_Dump">ST_Dump</a>とを併用します。 </p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OGC Simple Features
 Implementation Specification for SQL 1.1.</a> 2.1.5.1</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 8.2.3, 8.3.3</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp54649728"></a><h2>例</h2><pre class="programlisting">-- ポリゴンのテーブルをお持ちの場合
SELECT gid, ST_ExteriorRing(geom) AS ering
FROM sometable;

-- MULTIPOLYGONのテーブルをお持ちで
-- ポリゴンの外側リングで構成されるMULTIPOLYGONを求める場合
SELECT gid, ST_Collect(ST_ExteriorRing(geom)) AS erings
        FROM (SELECT gid, (ST_Dump(geom)).geom As geom
                        FROM sometable) As foo
GROUP BY gid;

-- 3次元の例
SELECT ST_AsEWKT(
        ST_ExteriorRing(
        ST_GeomFromEWKT('POLYGON((0 0 1, 1 1 1, 1 2 1, 1 1 1, 0 0 1))')
        )
);

st_asewkt
---------
LINESTRING(0 0 1,1 1 1,1 2 1,1 1 1,0 0 1)
</pre></div><div class="refsection"><a name="idp54651008"></a><h2>関連情報</h2><p><a class="xref" href="#ST_InteriorRingN" title="ST_InteriorRingN">ST_InteriorRingN</a>, <a class="xref" href="#ST_Boundary" title="ST_Boundary">ST_Boundary</a>, <a class="xref" href="#ST_NumInteriorRings" title="ST_NumInteriorRings">ST_NumInteriorRings</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_GeometryN"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_GeometryN — ジオメトリコレクションの要素を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_GeometryN</b>(</code>geometry  <var class="pdparam">geomA</var>, integer  <var class="pdparam">n</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp54658688"></a><h2>説明</h2><p>入力ジオメトリが GEOMETRYCOLLECTION, MULTIPOINT, MULTILINESTRING, MULTICURVE, MULTI)POLYGON, POLYHEDRALSURFACEの場合には、1始まりでN番目の要素を返します。他の場合にはNULLを返します。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>OGC仕様のため0.8.0版からインデクスを1始まりにしています。これより前の版では0始まりになっています。</p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ジオメトリのすべての要素を抽出するなら<a class="xref" href="#ST_Dump" title="ST_Dump">ST_Dump</a>の方が効率的ですし、非マルチジオメトリでも動作します。</p></td></tr></table></div><p>Enhanced: 2.0.0 多面体サーフェス対応、三角対応、TIN対応が導入されました。</p><p>Changed: 2.0.0 以前の版では非マルチのジオメトリではNULLが返りました。ST_GeometryN(..,1)の場合にはジオメトリを返すよう変更されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OGC Simple Features
 Implementation Specification for SQL 1.1.</a></p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 9.1.5</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div><div class="refsection"><a name="idp54683136"></a><h2>標準的な例</h2><pre class="programlisting">-- 3次元MULTIPOINTからPOINTの部分集合を抽出
SELECT n, ST_AsEWKT(ST_GeometryN(geom, n)) As geomewkt
FROM (
VALUES (ST_GeomFromEWKT('MULTIPOINT(1 2 7, 3 4 7, 5 6 7, 8 9 10)') ),
( ST_GeomFromEWKT('MULTICURVE(CIRCULARSTRING(2.5 2.5,4.5 2.5, 3.5 3.5), (10 11, 12 11))') )
        )As foo(geom)
        CROSS JOIN generate_series(1,100) n
WHERE n &lt;= ST_NumGeometries(geom);

 n |               geomewkt
---+-----------------------------------------
 1 | POINT(1 2 7)
 2 | POINT(3 4 7)
 3 | POINT(5 6 7)
 4 | POINT(8 9 10)
 1 | CIRCULARSTRING(2.5 2.5,4.5 2.5,3.5 3.5)
 2 | LINESTRING(10 11,12 11)


-- 全てのジオメトリを抽出 (idの割当に便利)
SELECT gid, n, ST_GeometryN(geom, n)
FROM sometable CROSS JOIN generate_series(1,100) n
WHERE n &lt;= ST_NumGeometries(geom);</pre></div><div class="refsection"><a name="idp54684416"></a><h2>多面体サーフェス、TIN、三角形の例</h2><pre class="programlisting">-- 多面体サーフェスの例
-- 多面体サーフェスをフェイスに分解します。
SELECT ST_AsEWKT(ST_GeometryN(p_geom,3)) As geom_ewkt
  FROM (SELECT ST_GeomFromEWKT('POLYHEDRALSURFACE(
((0 0 0, 0 0 1, 0 1 1, 0 1 0, 0 0 0)),
((0 0 0, 0 1 0, 1 1 0, 1 0 0, 0 0 0)),
((0 0 0, 1 0 0, 1 0 1, 0 0 1, 0 0 0)),
((1 1 0, 1 1 1, 1 0 1, 1 0 0, 1 1 0)),
((0 1 0, 0 1 1, 1 1 1, 1 1 0, 0 1 0)),
((0 0 1, 1 0 1, 1 1 1, 0 1 1, 0 0 1))
)')  AS p_geom )  AS a;

                geom_ewkt
------------------------------------------
 POLYGON((0 0 0,1 0 0,1 0 1,0 0 1,0 0 0))</pre><pre class="programlisting">-- TIN --
SELECT ST_AsEWKT(ST_GeometryN(geom,2)) as wkt
  FROM
    (SELECT
       ST_GeomFromEWKT('TIN (((
                0 0 0,
                0 0 1,
                0 1 0,
                0 0 0
            )), ((
                0 0 0,
                0 1 0,
                1 1 0,
                0 0 0
            ))
            )')  AS geom
    ) AS g;
-- 結果--
                 wkt
-------------------------------------
 TRIANGLE((0 0 0,0 1 0,1 1 0,0 0 0))</pre></div><div class="refsection"><a name="idp54686336"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Dump" title="ST_Dump">ST_Dump</a>, <a class="xref" href="#ST_NumGeometries" title="ST_NumGeometries">ST_NumGeometries</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_GeometryType"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_GeometryType — ジオメトリのSQL-MM型を文字列で返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_GeometryType</b>(</code>geometry  <var class="pdparam">g1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp54692480"></a><h2>説明</h2><p>ジオメトリ型を'ST_LineString', 'ST_Polygon', 'ST_MultiPolygon'等の文字列で返します。この関数はGeometryType(geometry)とは異なり、先頭に'ST'が付き、M値を持っているかを示しません。</p><p>Enhanced: 2.0.0 多面体サーフェス対応が導入されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 5.1.4</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p></div><div class="refsection"><a name="idp54698240"></a><h2>例</h2><pre class="programlisting">SELECT ST_GeometryType(ST_GeomFromText('LINESTRING(77.29 29.07,77.42 29.26,77.27 29.31,77.29 29.07)'));
                        -- 結果
                        ST_LineString</pre><pre class="programlisting">SELECT ST_GeometryType(ST_GeomFromEWKT('POLYHEDRALSURFACE( ((0 0 0, 0 0 1, 0 1 1, 0 1 0, 0 0 0)),
                ((0 0 0, 0 1 0, 1 1 0, 1 0 0, 0 0 0)), ((0 0 0, 1 0 0, 1 0 1, 0 0 1, 0 0 0)),
                ((1 1 0, 1 1 1, 1 0 1, 1 0 0, 1 1 0)),
                ((0 1 0, 0 1 1, 1 1 1, 1 1 0, 0 1 0)), ((0 0 1, 1 0 1, 1 1 1, 0 1 1, 0 0 1)) )'));
                        --結果 --
                        ST_PolyhedralSurface</pre><pre class="programlisting">SELECT ST_GeometryType(ST_GeomFromEWKT('POLYHEDRALSURFACE( ((0 0 0, 0 0 1, 0 1 1, 0 1 0, 0 0 0)),
                ((0 0 0, 0 1 0, 1 1 0, 1 0 0, 0 0 0)), ((0 0 0, 1 0 0, 1 0 1, 0 0 1, 0 0 0)),
                ((1 1 0, 1 1 1, 1 0 1, 1 0 0, 1 1 0)),
                ((0 1 0, 0 1 1, 1 1 1, 1 1 0, 0 1 0)), ((0 0 1, 1 0 1, 1 1 1, 0 1 1, 0 0 1)) )'));
                        --結果 --
                        ST_PolyhedralSurface</pre><pre class="programlisting">SELECT ST_GeometryType(geom) as result
  FROM
    (SELECT
       ST_GeomFromEWKT('TIN (((
                0 0 0,
                0 0 1,
                0 1 0,
                0 0 0
            )), ((
                0 0 0,
                0 1 0,
                1 1 0,
                0 0 0
            ))
            )')  AS geom
    ) AS g;
 result
--------
 ST_Tin    </pre></div><div class="refsection"><a name="idp54701056"></a><h2>関連情報</h2><p><a class="xref" href="#GeometryType" title="GeometryType">GeometryType</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_HasArc"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_HasArc — ジオメトリに円弧が含まれているかどうかテストします。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_HasArc</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp54706816"></a><h2>説明</h2><p>ジオメトリまたはジオメトリコレクションに曲線ラインストリングが含まれている場合にTRUEを返します。</p><p>Availability: 1.2.3?</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p></div><div class="refsection"><a name="idp54710912"></a><h2>例</h2><pre class="programlisting">SELECT ST_HasArc(ST_Collect('LINESTRING(1 2, 3 4, 5 6)', 'CIRCULARSTRING(1 1, 2 3, 4 5, 6 7, 5 6)'));
                st_hasarc
                --------
                t
                </pre></div><div class="refsection"><a name="idp54712448"></a><h2>関連情報</h2><p><a class="xref" href="#ST_CurveToLine" title="ST_CurveToLine">ST_CurveToLine</a>, <a class="xref" href="#ST_LineToCurve" title="ST_LineToCurve">ST_LineToCurve</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_InteriorRingN"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_InteriorRingN — ポリゴンのN番目の内環 (穴)を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_InteriorRingN</b>(</code>geometry  <var class="pdparam">a_polygon</var>, integer  <var class="pdparam">n</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp54723712"></a><h2>説明</h2><p>POLYGONジオメトリのN番目の内側リング (穴)をLINESTRINGで返します。インデックスは1はじまりです。ジオメトリがPOLYGONでない場合はインデックスが範囲外の場合にはNULLを返します。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はMULTIPOLYGONに対応していません。MULTIPOLYGONに対しては<a class="xref" href="#ST_GeometryN" title="ST_GeometryN">ST_GeometryN</a>または<a class="xref" href="#ST_Dump" title="ST_Dump">ST_Dump</a>とを併用します。 </p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OGC Simple Features
 Implementation Specification for SQL 1.1.</a></p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 8.2.6, 8.3.5</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp54739200"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(ST_InteriorRingN(geom, 1)) As geom
FROM (SELECT ST_BuildArea(
                ST_Collect(ST_Buffer(ST_Point(1,2), 20,3),
                        ST_Buffer(ST_Point(1, 2), 10,3))) As geom
                )  as foo;
                </pre></div><div class="refsection"><a name="idp54740736"></a><h2>関連情報</h2><p><a class="xref" href="#ST_ExteriorRing" title="ST_ExteriorRing">ST_ExteriorRing</a>, <a class="xref" href="#ST_BuildArea" title="ST_BuildArea">ST_BuildArea</a>, <a class="xref" href="#ST_Collect" title="ST_Collect">ST_Collect</a>, <a class="xref" href="#ST_Dump" title="ST_Dump">ST_Dump</a>, <a class="xref" href="#ST_NumInteriorRing" title="ST_NumInteriorRing">ST_NumInteriorRing</a>, <a class="xref" href="#ST_NumInteriorRings" title="ST_NumInteriorRings">ST_NumInteriorRings</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_IsClosed"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_IsClosed — ラインストリングの始点と終点が一致しているかをテストします。多面体サーフェスについては閉じているか (立体であるか)をテストします。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_IsClosed</b>(</code>geometry  <var class="pdparam">g</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp54748544"></a><h2>説明</h2><p><code class="varname">LINESTRING</code>の始点と終点が一致する場合に<code class="varname">TRUE</code>を返します。多面体サーフェスについては、サーフェスが面 (開いている)か立体 (閉じている)かをテストします。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OGC Simple Features
 Implementation Specification for SQL 1.1.</a></p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 7.1.5, 9.3.3</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>SQL-MMでは<code class="function">ST_IsClosed(<code class="varname">NULL</code>)</code>は0を返しますが、PostGISでは<code class="varname">NULL</code>を返します。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p>Enhanced: 2.0.0 多面体サーフェス対応が導入されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p></div><div class="refsection"><a name="idp54759680"></a><h2>ラインストリングとポイントの例</h2><pre class="programlisting">postgis=# SELECT ST_IsClosed('LINESTRING(0 0, 1 1)'::geometry);
 st_isclosed
-------------
 f
(1 row)

postgis=# SELECT ST_IsClosed('LINESTRING(0 0, 0 1, 1 1, 0 0)'::geometry);
 st_isclosed
-------------
 t
(1 row)

postgis=# SELECT ST_IsClosed('MULTILINESTRING((0 0, 0 1, 1 1, 0 0),(0 0, 1 1))'::geometry);
 st_isclosed
-------------
 f
(1 row)

postgis=# SELECT ST_IsClosed('POINT(0 0)'::geometry);
 st_isclosed
-------------
 t
(1 row)

postgis=# SELECT ST_IsClosed('MULTIPOINT((0 0), (1 1))'::geometry);
 st_isclosed
-------------
 t
(1 row)</pre></div><div class="refsection"><a name="idp54760960"></a><h2>多面体サーフェスの例</h2><pre class="programlisting">-- 立方体 --
                SELECT ST_IsClosed(ST_GeomFromEWKT('POLYHEDRALSURFACE( ((0 0 0, 0 0 1, 0 1 1, 0 1 0, 0 0 0)),
                ((0 0 0, 0 1 0, 1 1 0, 1 0 0, 0 0 0)), ((0 0 0, 1 0 0, 1 0 1, 0 0 1, 0 0 0)),
                ((1 1 0, 1 1 1, 1 0 1, 1 0 0, 1 1 0)),
                ((0 1 0, 0 1 1, 1 1 1, 1 1 0, 0 1 0)), ((0 0 1, 1 0 1, 1 1 1, 0 1 1, 0 0 1)) )'));

 st_isclosed
-------------
 t


 -- 立方体のようなものだけれども側面が一つ無いもの--
 SELECT ST_IsClosed(ST_GeomFromEWKT('POLYHEDRALSURFACE( ((0 0 0, 0 0 1, 0 1 1, 0 1 0, 0 0 0)),
                ((0 0 0, 0 1 0, 1 1 0, 1 0 0, 0 0 0)), ((0 0 0, 1 0 0, 1 0 1, 0 0 1, 0 0 0)),
                ((1 1 0, 1 1 1, 1 0 1, 1 0 0, 1 1 0)),
                ((0 1 0, 0 1 1, 1 1 1, 1 1 0, 0 1 0)) )'));

 st_isclosed
-------------
 f

</pre></div><div class="refsection"><a name="idp54762240"></a><h2>関連情報</h2><p><a class="xref" href="#ST_IsRing" title="ST_IsRing">ST_IsRing</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_IsCollection"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_IsCollection — ジオメトリのタイプがジオメトリコレクションかをテストします。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_IsCollection</b>(</code>geometry  <var class="pdparam">g</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp54768000"></a><h2>説明</h2><p>ジオメトリのタイプがジオメトリコレクションである場合に<code class="varname">TRUE</code>を返します。コレクションは次の通りです。 </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>ジオメトリコレクション</p></li><li class="listitem"><p>マルチポイント、マルチポリゴン、マルチラインストリング、マルチ曲線、マルチサーフェス</p></li><li class="listitem"><p>複合曲線</p></li></ul></div><p>
                </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はジオメトリのタイプを解析します。これは、空のコレクションである場合、または一つのエレメントを持つコレクションである場合には<code class="varname">TRUE</code>を返すことを意味します。 </p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p></div><div class="refsection"><a name="idp54775296"></a><h2>例</h2><pre class="programlisting">postgis=# SELECT ST_IsCollection('LINESTRING(0 0, 1 1)'::geometry);
 st_iscollection
-------------
 f
(1 row)

postgis=# SELECT ST_IsCollection('MULTIPOINT EMPTY'::geometry);
 st_iscollection
-------------
 t
(1 row)

postgis=# SELECT ST_IsCollection('MULTIPOINT((0 0))'::geometry);
 st_iscollection
-------------
 t
(1 row)

postgis=# SELECT ST_IsCollection('MULTIPOINT((0 0), (42 42))'::geometry);
 st_iscollection
-------------
 t
(1 row)

postgis=# SELECT ST_IsCollection('GEOMETRYCOLLECTION(POINT(0 0))'::geometry);
 st_iscollection
-------------
 t
(1 row)</pre></div><div class="refsection"><a name="idp54776576"></a><h2>関連情報</h2><p><a class="xref" href="#ST_NumGeometries" title="ST_NumGeometries">ST_NumGeometries</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_IsEmpty"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_IsEmpty — ジオメトリが空かをテストします。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_IsEmpty</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp54782336"></a><h2>説明</h2><p>ジオメトリが空ジオメトリの場合にtrueを返します。 trueの場合には、このジオメトリは、空のジオメトリコレクション、ポリゴン、ポイント等です。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>SQL-MMでは、ST_IsEmpty(NULL)は0を返しますが、PostGISではNULLを返します。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OGC Simple Features
 Implementation Specification for SQL 1.1.</a> s2.1.1.1</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 5.1.7</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><div class="warning"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Changed: 2.0.0 以前の版のPostGISではST_GeomFromText('GEOMETRYCOLLECTION(EMPTY)')を許しました。PostGIS 2.0.0では、SQL/MM標準により準拠させるため、これは不正となります。</p></td></tr></table></div></div><div class="refsection"><a name="idp54793088"></a><h2>例</h2><pre class="programlisting">SELECT ST_IsEmpty(ST_GeomFromText('GEOMETRYCOLLECTION EMPTY'));
 st_isempty
------------
 t
(1 row)

 SELECT ST_IsEmpty(ST_GeomFromText('POLYGON EMPTY'));
 st_isempty
------------
 t
(1 row)

SELECT ST_IsEmpty(ST_GeomFromText('POLYGON((1 2, 3 4, 5 6, 1 2))'));

 st_isempty
------------
 f
(1 row)

 SELECT ST_IsEmpty(ST_GeomFromText('POLYGON((1 2, 3 4, 5 6, 1 2))')) = false;
 ?column?
----------
 t
(1 row)

 SELECT ST_IsEmpty(ST_GeomFromText('CIRCULARSTRING EMPTY'));
  st_isempty
------------
 t
(1 row)


                </pre></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_IsPolygonCCW"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_IsPolygonCCW  — ポリゴンが反時計回りの外環を持っていて、時計回りの内環を持っているかをテストします。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef"> boolean <b class="fsfunc">ST_IsPolygonCCW</b> (</code> geometry <var class="pdparam">geom</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp54799360"></a><h2>説明</h2><p>入力ジオメトリの全てのポリゴン要素の外環については反時計回りで、全ての内環については時計回りである場合には、TRUEを返します。 </p><p>ジオメトリがポリゴン要素を持っていない場合にはTRUEを返します。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>閉じたラインストリングはポリゴン要素とみなされません。単一の閉じたラインストリングを渡すと、右回り左回りにかかわらずTRUEが得られます。 </p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ポリゴン要素の内環が逆回りになっていない (すなわち外環と同じ方向で回る内環が1個以上ある)場合には、ST_IsPolygonCWとST_IsPolygonCCW の両方ともにFALSEを返します。 </p></td></tr></table></div><p>Availability: 2.4.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports M coordinates.</p></div><div class="refsection"><a name="idp54805632"></a><h2>関連情報</h2><p><a class="xref" href="#ST_ForcePolygonCW" title="ST_ForcePolygonCW">ST_ForcePolygonCW </a>, <a class="xref" href="#ST_ForcePolygonCCW" title="ST_ForcePolygonCCW">ST_ForcePolygonCCW </a>, <a class="xref" href="#ST_IsPolygonCW" title="ST_IsPolygonCW">ST_IsPolygonCW </a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_IsPolygonCW"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_IsPolygonCW  — ポリゴンが時計回りの外環を持っていて、反時計回りの内環を持っているかをテストします。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef"> boolean <b class="fsfunc">ST_IsPolygonCW</b> (</code> geometry <var class="pdparam">geom</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp54816896"></a><h2>説明</h2><p>入力ジオメトリの全てのポリゴン要素の外環については時計回りで、全ての内環については反時計回りである場合には、TRUEを返します。 </p><p>ジオメトリがポリゴン要素を持っていない場合にはTRUEを返します。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>閉じたラインストリングはポリゴン要素とみなされません。単一の閉じたラインストリングを渡すと、右回り左回りにかかわらずTRUEが得られます。 </p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ポリゴン要素の内環が逆回りになっていない (すなわち外環と同じ方向で回る内環が1個以上ある)場合には、ST_IsPolygonCWとST_IsPolygonCCW の両方ともにFALSEを返します。 </p></td></tr></table></div><p>Availability: 2.4.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports M coordinates.</p></div><div class="refsection"><a name="idp54823168"></a><h2>関連情報</h2><p><a class="xref" href="#ST_ForcePolygonCW" title="ST_ForcePolygonCW">ST_ForcePolygonCW </a>, <a class="xref" href="#ST_ForcePolygonCCW" title="ST_ForcePolygonCCW">ST_ForcePolygonCCW </a>, <a class="xref" href="#ST_IsPolygonCW" title="ST_IsPolygonCW">ST_IsPolygonCW </a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_IsRing"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_IsRing — ラインストリングが閉じていてかつ単純であるかをテストします。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_IsRing</b>(</code>geometry  <var class="pdparam">g</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp54829824"></a><h2>説明</h2><p><code class="varname">LINESTRING</code>が<a class="xref" href="#ST_IsClosed" title="ST_IsClosed">ST_IsClosed</a> (<code class="function">ST_StartPoint(<em class="parameter"><code>g</code></em>)</code> <code class="function">~=</code> <code class="function">ST_Endpoint(<em class="parameter"><code>g</code></em>)</code>)で、かつ<a class="xref" href="#ST_IsSimple" title="ST_IsSimple">ST_IsSimple</a> (自己インタセクションが無い)場合に<code class="varname">TRUE</code>を返します。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OGC Simple Features
 Implementation Specification for SQL 1.1.</a> 2.1.5.1</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 7.1.6</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>SQL-MMでは、<code class="function">ST_IsRing(<code class="varname">NULL</code>)</code>は0を返しますが、PostGISでは<code class="varname">NULL</code>を返します。</p></td></tr></table></div></div><div class="refsection"><a name="idp54852352"></a><h2>例</h2><pre class="programlisting">SELECT ST_IsRing(geom), ST_IsClosed(geom), ST_IsSimple(geom)
FROM (SELECT 'LINESTRING(0 0, 0 1, 1 1, 1 0, 0 0)'::geometry AS geom) AS foo;
 st_isring | st_isclosed | st_issimple
-----------+-------------+-------------
 t         | t           | t
(1 row)

SELECT ST_IsRing(geom), ST_IsClosed(geom), ST_IsSimple(geom)
FROM (SELECT 'LINESTRING(0 0, 0 1, 1 0, 1 1, 0 0)'::geometry AS geom) AS foo;
 st_isring | st_isclosed | st_issimple
-----------+-------------+-------------
 f         | t           | f
(1 row)</pre></div><div class="refsection"><a name="idp54853632"></a><h2>関連情報</h2><p><a class="xref" href="#ST_IsClosed" title="ST_IsClosed">ST_IsClosed</a>, <a class="xref" href="#ST_IsSimple" title="ST_IsSimple">ST_IsSimple</a>, <a class="xref" href="#ST_StartPoint" title="ST_StartPoint">ST_StartPoint</a>, <a class="xref" href="#ST_EndPoint" title="ST_EndPoint">ST_EndPoint</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_IsSimple"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_IsSimple — ジオメトリが自己インタセクトまたは自己接触となるポイントが無いかをテストします。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_IsSimple</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp54860672"></a><h2>説明</h2><p>ジオメトリに自己交差や自己接線等の幾何学的異常点がある場合にはTRUEを返します。OGCのジオメトリ単純性と妥当性の定義に関する追加情報については<a class="link" href="#OGC_Validity" title="4.6. ジオメトリ検証">"Ensuring OpenGIS compliancy of geometries"</a>をご覧下さい。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>SQL-MMでは、ST_IsSimple(NULL)は0を返しますが、PostGISではNULLを返します。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OGC Simple Features
 Implementation Specification for SQL 1.1.</a> s2.1.1.1</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 5.1.8</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp54867584"></a><h2>例</h2><pre class="programlisting">SELECT ST_IsSimple(ST_GeomFromText('POLYGON((1 2, 3 4, 5 6, 1 2))'));
 st_issimple
-------------
 t
(1 row)

 SELECT ST_IsSimple(ST_GeomFromText('LINESTRING(1 1,2 2,2 3.5,1 3,1 2,2 1)'));
 st_issimple
-------------
 f
(1 row)</pre></div><div class="refsection"><a name="idp54868864"></a><h2>関連情報</h2><p><a class="xref" href="#">???</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_M"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_M — ポイントのM値を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_M</b>(</code>geometry  <var class="pdparam">a_point</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp54874624"></a><h2>説明</h2><p>ポイントのM座標値を返し、有効でないならNULLを返します。入力はポイントでなければなりません。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これは (いまだに)OGC仕様に入っていませんが、ポイント座標抽出関数のリストを完全にするために挙げています。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OGC Simple Features
 Implementation Specification for SQL 1.1.</a></p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp54880896"></a><h2>例</h2><pre class="programlisting">SELECT ST_M(ST_GeomFromEWKT('POINT(1 2 3 4)'));
 st_m
------
        4
(1 row)

                </pre></div><div class="refsection"><a name="idp54882432"></a><h2>関連情報</h2><p><a class="xref" href="#">???</a>, <a class="xref" href="#ST_X" title="ST_X">ST_X</a>, <a class="xref" href="#ST_Y" title="ST_Y">ST_Y</a>, <a class="xref" href="#ST_Z" title="ST_Z">ST_Z</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_MemSize"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MemSize — ジオメトリが取るメモリ空間の合計を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_MemSize</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp54893440"></a><h2>説明</h2><p>ジオメトリが取るメモリ空間の合計をバイト単位で返します。 </p><p>この関数は、PostgreSQLビルトイン<a class="ulink" href="https://www.postgresql.jp/document/current/html/functions-admin.html#FUNCTIONS-ADMIN-DBOBJECT" target="_top">データベースオブジェクト管理関数</a>のpg_column_size, pg_size_pretty, pg_relation_size, pg_total_relation_sizeを補完します。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>テーブルのバイト単位のサイズを与えるpg_relation_sizeはST_Mem_Sizeより小さいバイト数が返ります。これはpg_relation_sizeがTOAST化されたテーブルの寄与を追加せず、TOASTテーブルに格納された大きなジオメトリを加えないためです。</p><p>pg_total_relation_size - テーブル、TOASTテーブル、インデクスを含みます。</p><p>pg_column_sizeは、ジオメトリがカラム内で取る領域がどれだけかを、圧縮を考慮して返します。そのため、ST_MemSizeより小さくなることがあります。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p><p>Changed: 2.2.0 命名規則に従うためにST_MemSizeに変更しました。</p></div><div class="refsection"><a name="idp54902656"></a><h2>例</h2><pre class="programlisting">-- マサチューセッツのデータセットでボストンが占めるバイト単位の容量を返します
SELECT pg_size_pretty(SUM(ST_MemSize(geom))) as totgeomsum,
pg_size_pretty(SUM(CASE WHEN town = 'BOSTON' THEN ST_MemSize(geom) ELSE 0 END)) As bossum,
CAST(SUM(CASE WHEN town = 'BOSTON' THEN ST_MemSize(geom) ELSE 0 END)*1.00 /
                SUM(ST_MemSize(geom))*100 As numeric(10,2)) As perbos
FROM towns;

totgeomsum        bossum        perbos
----------        ------        ------
1522 kB                30 kB        1.99


SELECT ST_MemSize(ST_GeomFromText('CIRCULARSTRING(220268 150415,220227 150505,220227 150406)'));

---
73

-- ジオメトリがテーブルに占める割合
SELECT pg_total_relation_size('public.neighborhoods') As fulltable_size, sum(ST_MemSize(geom)) As geomsize,
sum(ST_MemSize(geom))*1.00/pg_total_relation_size('public.neighborhoods')*100 As pergeom
FROM neighborhoods;
fulltable_size geomsize  pergeom
------------------------------------------------
262144         96238         36.71188354492187500000
        </pre></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_NDims"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_NDims — じゅいおめとりの座標次元を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_NDims</b>(</code>geometry  <var class="pdparam">g1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp54916608"></a><h2>説明</h2><p>ジオメトリの座標次元返します。PostGISでは、2 - (X,Y), 3 - (X,Y,Z), (X,Y,M), 4 - (X,Y,Z,M)に対応しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp54919168"></a><h2>例</h2><pre class="programlisting">SELECT ST_NDims(ST_GeomFromText('POINT(1 1)')) As d2point,
        ST_NDims(ST_GeomFromEWKT('POINT(1 1 2)')) As d3point,
        ST_NDims(ST_GeomFromEWKT('POINTM(1 1 0.5)')) As d2pointm;

         d2point | d3point | d2pointm
---------+---------+----------
           2 |       3 |        3
                        </pre></div><div class="refsection"><a name="idp54920448"></a><h2>関連情報</h2><p><a class="xref" href="#ST_CoordDim" title="ST_CoordDim">ST_CoordDim</a>, <a class="xref" href="#ST_Dimension" title="ST_Dimension">ST_Dimension</a>, <a class="xref" href="#">???</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_NPoints"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_NPoints — ジオメトリのポイント (頂点)の数を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_NPoints</b>(</code>geometry  <var class="pdparam">g1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp54926976"></a><h2>説明</h2><p>ジオメトリのポイントの数を返します。全てのジオメトリに対して動作します。</p><p>Enhanced: 2.0.0 多面体サーフェス対応が導入されました。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>1.3.4より前では、曲線を含むジオメトリで使用すると、この関数はクラッシュします。これは1.3.4以上で訂正されています。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p></div><div class="refsection"><a name="idp54932992"></a><h2>例</h2><pre class="programlisting">SELECT ST_NPoints(ST_GeomFromText('LINESTRING(77.29 29.07,77.42 29.26,77.27 29.31,77.29 29.07)'));
-- 結果
4

-- 3次元空間上のポリゴン
SELECT ST_NPoints(ST_GeomFromEWKT('LINESTRING(77.29 29.07 1,77.42 29.26 0,77.27 29.31 -1,77.29 29.07 3)'))
-- 結果
4</pre></div><div class="refsection"><a name="idp54934272"></a><h2>関連情報</h2><p><a class="xref" href="#ST_NumPoints" title="ST_NumPoints">ST_NumPoints</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_NRings"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_NRings — ポリゴンジオメトリのリング数を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_NRings</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp54940032"></a><h2>説明</h2><p>ジオメトリがポリゴンまたはマルチポリゴンの場合、リング数を返します。NumInteriorRingsと違い、外環も数えます。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p></div><div class="refsection"><a name="idp54943744"></a><h2>例</h2><pre class="programlisting">SELECT ST_NRings(geom) As Nrings, ST_NumInteriorRings(geom) As ninterrings
                                        FROM (SELECT ST_GeomFromText('POLYGON((1 2, 3 4, 5 6, 1 2))') As geom) As foo;
         nrings | ninterrings
--------+-------------
          1 |           0
(1 row)
</pre></div><div class="refsection"><a name="idp54945280"></a><h2>関連情報</h2><p><a class="xref" href="#ST_NumInteriorRings" title="ST_NumInteriorRings">ST_NumInteriorRings</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_NumGeometries"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_NumGeometries — ジオメトリコレクションの要素数を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_NumGeometries</b>(</code>geometry  <var class="pdparam">geom</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp54951040"></a><h2>説明</h2><p>ジオメトリの数を返します。ジオメトリがジオメトリコレクションまたはマルチ系の場合は、ジオメトリの数を返し、単一のジオメトリの場合は1を返し、それ以外の場合はNULLを返します。</p><p>Enhanced: 2.0.0 多面体サーフェス対応、三角対応、TIN対応が導入されました。</p><p>Changed: 2.0.0 前の版では、ジオメトリがコレクション/マルチ系でない場合にはNULLを返しました。2.0.0以上では、POLYGON, LINESTRING, POINTといった単一ジオメトリについては1を返します。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 9.1.4</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div><div class="refsection"><a name="idp54958592"></a><h2>例</h2><pre class="programlisting">-- 以前の版ではNULLが返りました
-- 2.0.0から1が返ります
SELECT ST_NumGeometries(ST_GeomFromText('LINESTRING(77.29 29.07,77.42 29.26,77.27 29.31,77.29 29.07)'));
-- 結果
1

-- ジオメトリコレクションの例
-- - マルチ系はコレクションで一つのジオメトリと数えます。
SELECT ST_NumGeometries(ST_GeomFromEWKT('GEOMETRYCOLLECTION(MULTIPOINT(-2 3 , -2 2),
LINESTRING(5 5 ,10 10),
POLYGON((-7 4.2,-7.1 5,-7.1 4.3,-7 4.2)))'));
-- 結果
3
</pre></div><div class="refsection"><a name="idp54959872"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeometryN" title="ST_GeometryN">ST_GeometryN</a>, <a class="xref" href="#ST_Multi" title="ST_Multi">ST_Multi</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_NumInteriorRings"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_NumInteriorRings — ポリゴンの内環 (穴)の数を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_NumInteriorRings</b>(</code>geometry  <var class="pdparam">a_polygon</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp54966016"></a><h2>説明</h2><p>ポリゴンジオメトリの内環の数を返します。ジオメトリがポリゴンでない場合には、NULLを返します。 </p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 8.2.5</p><p>Changed: 2.0.0 - 以前の版では、MULTIPOLYGONを渡して最初のPOLYGONの内環の数を返すことができました。</p></div><div class="refsection"><a name="idp54968960"></a><h2>例</h2><pre class="programlisting">-- 通常のポリゴンの場合
SELECT gid, field1, field2, ST_NumInteriorRings(geom) AS numholes
FROM sometable;

-- マルチポリゴンで内側リングの総数を知りたい場合
SELECT gid, field1, field2, SUM(ST_NumInteriorRings(geom)) AS numholes
FROM (SELECT gid, field1, field2, (ST_Dump(geom)).geom As geom
        FROM sometable) As foo
GROUP BY gid, field1,field2;
                        </pre></div><div class="refsection"><a name="idp54970240"></a><h2>関連情報</h2><p><a class="xref" href="#ST_NumInteriorRing" title="ST_NumInteriorRing">ST_NumInteriorRing</a>, <a class="xref" href="#ST_InteriorRingN" title="ST_InteriorRingN">ST_InteriorRingN</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_NumInteriorRing"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_NumInteriorRing — ポリゴンの内環 (穴)の数を返します。ST_NumInteriorRingsの別名です。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_NumInteriorRing</b>(</code>geometry  <var class="pdparam">a_polygon</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp54976384"></a><h2>関連情報</h2><p><a class="xref" href="#ST_NumInteriorRings" title="ST_NumInteriorRings">ST_NumInteriorRings</a>, <a class="xref" href="#ST_InteriorRingN" title="ST_InteriorRingN">ST_InteriorRingN</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_NumPatches"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_NumPatches — 多面体サーフェスのフェイス数を返します。多面体でないジオメトリの場合にはNULLを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_NumPatches</b>(</code>geometry  <var class="pdparam">g1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp54982528"></a><h2>説明</h2><p>多面体サーフェスのフェイス数を返します。多面体でないジオメトリの場合にはNULLを返します。ST_NumGeometriesの別名で、MMの名前付けに対応するためのものです。MM規約を気にしない場合はST_NumGeometriesの方が速いです。</p><p>Availability: 2.0.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OGC Simple Features
 Implementation Specification for SQL 1.1.</a></p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: ?</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p></div><div class="refsection"><a name="idp54989824"></a><h2>例</h2><pre class="programlisting">SELECT ST_NumPatches(ST_GeomFromEWKT('POLYHEDRALSURFACE( ((0 0 0, 0 0 1, 0 1 1, 0 1 0, 0 0 0)),
                ((0 0 0, 0 1 0, 1 1 0, 1 0 0, 0 0 0)), ((0 0 0, 1 0 0, 1 0 1, 0 0 1, 0 0 0)),
                ((1 1 0, 1 1 1, 1 0 1, 1 0 0, 1 1 0)),
                ((0 1 0, 0 1 1, 1 1 1, 1 1 0, 0 1 0)), ((0 0 1, 1 0 1, 1 1 1, 0 1 1, 0 0 1)) )'));
                -- 結果 --
                6
                </pre></div><div class="refsection"><a name="idp54991104"></a><h2>関連情報</h2><p><a class="xref" href="#">???</a>, <a class="xref" href="#ST_NumGeometries" title="ST_NumGeometries">ST_NumGeometries</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_NumPoints"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_NumPoints — ラインストリングまたは曲線ストリングのポイント数を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_NumPoints</b>(</code>geometry  <var class="pdparam">g1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp55009536"></a><h2>説明</h2><p>ST_LineStringまたはST_CircularString内のポイント数を返します。1.4より前では、LINESTRINGでのみ動作しました。1.4からは、LINESTRINGでないものの頂点数を返すST_NPointsの別名となりました。多目的かつ多数のジオメトリタイプに対応するST_NPointsの使用を検討して下さい。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OGC Simple Features
 Implementation Specification for SQL 1.1.</a></p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 7.2.4</p></div><div class="refsection"><a name="idp55034112"></a><h2>例</h2><pre class="programlisting">SELECT ST_NumPoints(ST_GeomFromText('LINESTRING(77.29 29.07,77.42 29.26,77.27 29.31,77.29 29.07)'));
                -- 結果
                4
                </pre></div><div class="refsection"><a name="idp55035392"></a><h2>関連情報</h2><p><a class="xref" href="#ST_NPoints" title="ST_NPoints">ST_NPoints</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_PatchN"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_PatchN — 多面体サーフェスのN番目のジオメトリ (フェイス)を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_PatchN</b>(</code>geometry  <var class="pdparam">geomA</var>, integer  <var class="pdparam">n</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp55042176"></a><h2>説明</h2><p>ジオメトリがPOLYHEDRALSURFACEまたはPOLYHEDRALSURFACEMの場合には、1はじまりのN番目のジオメトリ (面)を返します。他の場合にはNULLを返します。PolyhedralSurfacesに対するST_GeometryNと同じ結果を得ます。ST_GeometryNの方が速くなります。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>インデクスは1始まりです。</p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ジオメトリの全ての要素を抽出するには<a class="xref" href="#ST_Dump" title="ST_Dump">ST_Dump</a>が最も効率的です。</p></td></tr></table></div><p>Availability: 2.0.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: ?</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p></div><div class="refsection"><a name="idp55049856"></a><h2>例</h2><pre class="programlisting">-- 多面体サーフェスの2番目のフェイスを抽出
SELECT ST_AsEWKT(ST_PatchN(geom, 2)) As geomewkt
FROM (
VALUES (ST_GeomFromEWKT('POLYHEDRALSURFACE( ((0 0 0, 0 0 1, 0 1 1, 0 1 0, 0 0 0)),
        ((0 0 0, 0 1 0, 1 1 0, 1 0 0, 0 0 0)), ((0 0 0, 1 0 0, 1 0 1, 0 0 1, 0 0 0)),
        ((1 1 0, 1 1 1, 1 0 1, 1 0 0, 1 1 0)),
        ((0 1 0, 0 1 1, 1 1 1, 1 1 0, 0 1 0)), ((0 0 1, 1 0 1, 1 1 1, 0 1 1, 0 0 1)) )')) ) As foo(geom);

              geomewkt
---+-----------------------------------------
 POLYGON((0 0 0,0 1 0,1 1 0,1 0 0,0 0 0))
</pre></div><div class="refsection"><a name="idp55051392"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#ST_Dump" title="ST_Dump">ST_Dump</a>, <a class="xref" href="#ST_GeometryN" title="ST_GeometryN">ST_GeometryN</a>, <a class="xref" href="#ST_NumGeometries" title="ST_NumGeometries">ST_NumGeometries</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_PointN"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_PointN — ジオメトリの最初のラインストリングまたは曲線ストリングのN番目のポイントを返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_PointN</b>(</code>geometry  <var class="pdparam">a_linestring</var>, integer  <var class="pdparam">n</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp55059840"></a><h2>説明</h2><p>ラインストリングまたは曲線ストリングのN番目の点を返します。負数はラインストリングの終端から逆方向に遡って数えます。-1は終端を指します。ジオメトリにラインストリングが無い場合には、NULLを返します。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>OGC仕様のため0.8.0版からインデックスを1始まりにしています。これより前の版では0はじまりになっています。後方インデックス (負数インデックス)はOGC仕様ではありません。</p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>マルチラインストリング内のラインストリングのN番目のポイントを得るには、ST_Dumpを併用します。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OGC Simple Features
 Implementation Specification for SQL 1.1.</a></p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 7.2.5, 7.3.5</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Changed: 2.0.0 単一ジオメトリのMULTILINESTRINGで動作しなくなりました。単一のラインストリングからなるMULTILINESTRINGについては幸運にも動いていて、最初のポイントを返していました。2.0.0では他のMULTILINESTRINGと同様にNULLを返すようになりました。</p><p>Changed: 2.3.0 : 負数インデックスが有効になりました (-1は終端を指します) </p></td></tr></table></div></div><div class="refsection"><a name="idp55069056"></a><h2>例</h2><pre class="programlisting">-- LINESTRINGから全てのPOINTを抽出
SELECT ST_AsText(
   ST_PointN(
          column1,
          generate_series(1, ST_NPoints(column1))
   ))
FROM ( VALUES ('LINESTRING(0 0, 1 1, 2 2)'::geometry) ) AS foo;

 st_astext
------------
 POINT(0 0)
 POINT(1 1)
 POINT(2 2)
(3 rows)

-- 曲線ストリングの例
SELECT ST_AsText(ST_PointN(ST_GeomFromText('CIRCULARSTRING(1 2, 3 2, 1 2)'), 2));

 st_astext
------------
 POINT(3 2)
(1 row)

SELECT ST_AsText(f)
FROM ST_GeomFromText('LINESTRING(0 0 0, 1 1 1, 2 2 2)') AS g
  ,ST_PointN(g, -2) AS f; -- 1 based index

    st_astext
-----------------
 POINT Z (1 1 1)
(1 row)

</pre></div><div class="refsection"><a name="idp55070336"></a><h2>関連情報</h2><p><a class="xref" href="#ST_NPoints" title="ST_NPoints">ST_NPoints</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Points"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Points — ジオメトリの座標を含むMULTIPOINTを返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Points</b>(</code> geometry <var class="pdparam">geom</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp55076352"></a><h2>説明</h2><p>ジオメトリのすべての座標を含むMULTIPOINTを返します。リングジオメトリの始端と終端を含む、ジオメトリ内で繰り返されるポイントは、削除されません。この振る舞いが望ましくない場合には、<a class="xref" href="#ST_RemoveRepeatedPoints" title="ST_RemoveRepeatedPoints">ST_RemoveRepeatedPoints</a>で重複点を削除できます)。 </p><p>親ジオメトリ内のそれぞれの座標ポイントに関する情報を得るには<a class="xref" href="#ST_DumpPoints" title="ST_DumpPoints">ST_DumpPoints</a>を使います。 </p><p>M値とZ値が存在する場合には保持されます。 </p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p>Availability: 2.3.0</p></div><div class="refsection"><a name="idp55082112"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(ST_Points('POLYGON Z ((30 10 4,10 30 5,40 40 6, 30 10))'));

-- 結果
MULTIPOINT Z (30 10 4,10 30 5,40 40 6, 30 10 4)
                        </pre></div><div class="refsection"><a name="idp55083392"></a><h2>関連情報</h2><p><a class="xref" href="#ST_RemoveRepeatedPoints" title="ST_RemoveRepeatedPoints">ST_RemoveRepeatedPoints</a>, <a class="xref" href="#ST_DumpPoints" title="ST_DumpPoints">ST_DumpPoints</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_StartPoint"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_StartPoint — ラインストリングの始点を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_StartPoint</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp55089536"></a><h2>説明</h2><p><code class="varname">LINESTRING</code>または<code class="varname">CIRCULARLINESTRING</code>ジオメトリの、最初のポイントを<code class="varname">POINT</code>で返します。入力パラメータが<code class="varname">LINESTRING</code>でも<code class="varname">CIRCULARLINESTRING</code>でもない場合には、<code class="varname">NULL</code>を返します。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 7.1.3</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Enhanced: 3.2.0 全てのジオメトリのポイントを返すようになりました。これより前では入力がLINESTRINGでない場合にNULLを返しました。</p><p>Changed: 2.0.0 一つのMULTILINESTRINGで動作しなくなりました。PostGIS の古いバージョンでは、この関数は、一つのラインストリングからなるMULTILINESTRINGについては幸運にも動いていて、始端ポイントを返していました。2.0.0では他のMULTILINESTRINGと同様にNULLを返すようになりました。古い動作は文書化されていない機能でしたが、データをLINESTRINGとして格納していると思われるユーザーは、2.0.0 でNULLが返されることを経験するかも知れません。</p></td></tr></table></div></div><div class="refsection"><a name="idp55097984"></a><h2>例</h2><p>ラインストリングの始端ポイント</p><pre class="programlisting">SELECT ST_AsText(ST_StartPoint('LINESTRING(0 1, 0 2)'::geometry));
 st_astext
------------
 POINT(0 1)
</pre><p>ラインストリングでないものの始端ポイントはNULL</p><pre class="programlisting">SELECT ST_StartPoint('POINT(0 1)'::geometry) IS NULL AS is_null;
  is_null
----------
 t
</pre><p>3次元ラインストリングの始端ポイント</p><pre class="programlisting">SELECT ST_AsEWKT(ST_StartPoint('LINESTRING(0 1 1, 0 2 2)'::geometry));
 st_asewkt
------------
 POINT(0 1 1)
</pre><p>CIRCULARSTRINGの始端ポイント</p><pre class="programlisting">SELECT ST_AsText(ST_StartPoint('CIRCULARSTRING(5 2,-3 1.999999, -2 1, -4 2, 6 3)'::geometry));
 st_astext
------------
 POINT(5 2)
</pre></div><div class="refsection"><a name="idp55102336"></a><h2>関連情報</h2><p><a class="xref" href="#ST_EndPoint" title="ST_EndPoint">ST_EndPoint</a>, <a class="xref" href="#ST_PointN" title="ST_PointN">ST_PointN</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Summary"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Summary — ジオメトリの中身の概要を文字列で返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_Summary</b>(</code>geometry  <var class="pdparam">g</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">ST_Summary</b>(</code>geography  <var class="pdparam">g</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp55114752"></a><h2>説明</h2><p>ジオメトリの内容についての要約文を返します。</p><p>ジオメトリ型の後の角括弧で示されたフラグには次の意味があります。 </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>M: M値を持ちます</p></li><li class="listitem"><p>Z: Z値を持ちます</p></li><li class="listitem"><p>B: バウンディングボックスを持ちます</p></li><li class="listitem"><p>G: 測地座標系 (ジオグラフィ)です</p></li><li class="listitem"><p>S: 空間参照系を持ちます</p></li></ul></div><p>
                </p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p><p>Availability: 1.2.2</p><p>Enhanced: 2.0.0でジオグラフィ対応が追加されました。</p><p>Enhanced: 2.1.0 空間参照系を持つかを示すSフラグが追加されました。</p><p>Enhanced: 2.2.0 TINと曲線の対応が追加されました。</p></div><div class="refsection"><a name="idp55125504"></a><h2>例</h2><pre class="programlisting">=# SELECT ST_Summary(ST_GeomFromText('LINESTRING(0 0, 1 1)')) as geom,
        ST_Summary(ST_GeogFromText('POLYGON((0 0, 1 1, 1 2, 1 1, 0 0))')) geog;
            geom             |          geog
-----------------------------+--------------------------
 LineString[B] with 2 points | Polygon[BGS] with 1 rings
                             | ring 0 has 5 points
                             :
(1 row)


=# SELECT ST_Summary(ST_GeogFromText('LINESTRING(0 0 1, 1 1 1)')) As geog_line,
        ST_Summary(ST_GeomFromText('SRID=4326;POLYGON((0 0 1, 1 1 2, 1 2 3, 1 1 1, 0 0 1))')) As geom_poly;
;
           geog_line             |        geom_poly
-------------------------------- +--------------------------
 LineString[ZBGS] with 2 points | Polygon[ZBS] with 1 rings
                                :    ring 0 has 5 points
                                :
(1 row)

</pre></div><div class="refsection"><a name="idp55126784"></a><h2>関連情報</h2><p><a class="xref" href="#">???</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#ST_Force_3DM" title="ST_Force3DM">ST_Force3DM</a>, <a class="xref" href="#ST_Force_3DZ" title="ST_Force3DZ">ST_Force3DZ</a>, <a class="xref" href="#ST_Force2D" title="ST_Force2D">ST_Force2D</a>, <a class="xref" href="#geography" title="geography">geography</a> </p><p><a class="xref" href="#">???</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#">???</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_X"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_X — ポイントのX値を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_X</b>(</code>geometry  <var class="pdparam">a_point</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp55136384"></a><h2>説明</h2><p>ポイントのX値を返します。引数が有効でない場合にはNULLを返します。入力はポイントでなければなりません。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ジオメトリのX値の最小値と最大値を得るには<a class="xref" href="#">???</a>と<a class="xref" href="#">???</a>を使います。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 6.1.3</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp55141632"></a><h2>例</h2><pre class="programlisting">SELECT ST_X(ST_GeomFromEWKT('POINT(1 2 3 4)'));
 st_x
------
        1
(1 row)

SELECT ST_Y(ST_Centroid(ST_GeomFromEWKT('LINESTRING(1 2 3 4, 1 1 1 1)')));
 st_y
------
  1.5
(1 row)

                </pre></div><div class="refsection"><a name="idp55143168"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Centroid" title="ST_Centroid">ST_Centroid</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#ST_M" title="ST_M">ST_M</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#ST_Y" title="ST_Y">ST_Y</a>, <a class="xref" href="#ST_Z" title="ST_Z">ST_Z</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Y"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Y — ポイントのY値を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_Y</b>(</code>geometry  <var class="pdparam">a_point</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp55151232"></a><h2>説明</h2><p>ポイントのY値を返します。引数が有効でない場合にはNULLを返します。入力はポイントでなければなりません。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ジオメトリの値の最小値と最大値を得るには<a class="xref" href="#">???</a>と<a class="xref" href="#">???</a>を使います。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OGC Simple Features
 Implementation Specification for SQL 1.1.</a></p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 6.1.4</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp55174400"></a><h2>例</h2><pre class="programlisting">SELECT ST_Y(ST_GeomFromEWKT('POINT(1 2 3 4)'));
 st_y
------
        2
(1 row)

SELECT ST_Y(ST_Centroid(ST_GeomFromEWKT('LINESTRING(1 2 3 4, 1 1 1 1)')));
 st_y
------
  1.5
(1 row)


                </pre></div><div class="refsection"><a name="idp55175936"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Centroid" title="ST_Centroid">ST_Centroid</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#ST_M" title="ST_M">ST_M</a>, <a class="xref" href="#ST_X" title="ST_X">ST_X</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#ST_Z" title="ST_Z">ST_Z</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Z"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Z — ポイントのZ値を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_Z</b>(</code>geometry  <var class="pdparam">a_point</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp55184000"></a><h2>説明</h2><p>ポイントのZ値を返します。引数が有効でない場合にはNULLを返します。入力はポイントでなければなりません。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ジオメトリのZ値の最小値と最大値を得るには<a class="xref" href="#">???</a>と<a class="xref" href="#">???</a>を使います。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp55193344"></a><h2>例</h2><pre class="programlisting">SELECT ST_Z(ST_GeomFromEWKT('POINT(1 2 3 4)'));
 st_z
------
        3
(1 row)

                </pre></div><div class="refsection"><a name="idp55194880"></a><h2>関連情報</h2><p><a class="xref" href="#">???</a>, <a class="xref" href="#ST_M" title="ST_M">ST_M</a>, <a class="xref" href="#ST_X" title="ST_X">ST_X</a>, <a class="xref" href="#ST_Y" title="ST_Y">ST_Y</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#">???</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Zmflag"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Zmflag — ジオメトリのZM座標次元を示す符号を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">smallint <b class="fsfunc">ST_Zmflag</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp53879680"></a><h2>説明</h2><p>ジオメトリのZM座標次元を示す符号を返します。 </p><p>値は 0=XY, 1=XYM, 2=XYZ, 3=XYZMとなります。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p></div><div class="refsection"><a name="idp55202688"></a><h2>例</h2><pre class="programlisting">SELECT ST_Zmflag(ST_GeomFromEWKT('LINESTRING(1 2, 3 4)'));
 st_zmflag
-----------
                 0

SELECT ST_Zmflag(ST_GeomFromEWKT('LINESTRINGM(1 2 3, 3 4 3)'));
 st_zmflag
-----------
                 1

SELECT ST_Zmflag(ST_GeomFromEWKT('CIRCULARSTRING(1 2 3, 3 4 3, 5 6 3)'));
 st_zmflag
-----------
                 2
SELECT ST_Zmflag(ST_GeomFromEWKT('POINT(1 2 3 4)'));
 st_zmflag
-----------
                 3
</pre></div><div class="refsection"><a name="idp55204224"></a><h2>関連情報</h2><p><a class="xref" href="#ST_CoordDim" title="ST_CoordDim">ST_CoordDim</a>, <a class="xref" href="#ST_NDims" title="ST_NDims">ST_NDims</a>, <a class="xref" href="#ST_Dimension" title="ST_Dimension">ST_Dimension</a></p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Geometry_Editors"></a>8.6. ジオメトリエディタ</h2></div><div><div class="abstract"><div class="abstract-title">概要</div><p>これらの関数は、タイプ、構造または頂点の変更によって編集されたジオメトリを生成します。 </p></div></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#ST_AddPoint">ST_AddPoint</a></span><span class="refpurpose"> — ラインストリングにポイントを追加します。</span></dt><dt><span class="refentrytitle"><a href="#ST_CollectionExtract">ST_CollectionExtract</a></span><span class="refpurpose"> — ジオメトリコレクションを与えると、指定されたタイプの要素だけからなるマルチジオメトリを返します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_CollectionHomogenize">ST_CollectionHomogenize</a></span><span class="refpurpose"> — ジオメトリコレクションを与えると、最も単純な表現を返します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_CurveToLine">ST_CurveToLine</a></span><span class="refpurpose"> — 曲線を含むジオメトリを線ジオメトリに変換します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Scroll">ST_Scroll</a></span><span class="refpurpose"> — 閉じたLINESTRINGの開始点を変更する</span></dt><dt><span class="refentrytitle"><a href="#ST_FlipCoordinates">ST_FlipCoordinates</a></span><span class="refpurpose"> — X値とY値を入れ替えたジオメトリを返します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_Force2D">ST_Force2D</a></span><span class="refpurpose"> — ジオメトリを2次元モードに強制します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Force_3D">ST_Force3D</a></span><span class="refpurpose"> — ジオメトリをXYZモードに強制します。これはST_Force3DZの別名です。</span></dt><dt><span class="refentrytitle"><a href="#ST_Force_3DZ">ST_Force3DZ</a></span><span class="refpurpose"> — ジオメトリをXYZモードに強制します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Force_3DM">ST_Force3DM</a></span><span class="refpurpose"> — ジオメトリをXYMモードに強制します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Force_4D">ST_Force4D</a></span><span class="refpurpose"> — ジオメトリをXYZMモードに強制します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_ForcePolygonCCW">ST_ForcePolygonCCW </a></span><span class="refpurpose"> — 全ての外環を反時計回りに、全ての内環を時計回りに、それぞれ強制します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_Force_Collection">ST_ForceCollection</a></span><span class="refpurpose"> — ジオメトリをジオメトリコレクションに変換します。</span></dt><dt><span class="refentrytitle"><a href="#ST_ForcePolygonCW">ST_ForcePolygonCW </a></span><span class="refpurpose"> — 全ての外環を時計回りに、全ての内環を反時計回りに、それぞれ強制します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_ForceSFS">ST_ForceSFS</a></span><span class="refpurpose"> — SFS 1.1ジオメトリタイプのみ使うようジオメトリに強制します。</span></dt><dt><span class="refentrytitle"><a href="#ST_ForceRHR">ST_ForceRHR</a></span><span class="refpurpose"> — ポリゴンの頂点の方向を右回りに強制します。</span></dt><dt><span class="refentrytitle"><a href="#ST_ForceCurve">ST_ForceCurve</a></span><span class="refpurpose"> — 該当する場合は、ジオメトリを曲線タイプに変換します。</span></dt><dt><span class="refentrytitle"><a href="#ST_LineToCurve">ST_LineToCurve</a></span><span class="refpurpose"> — 曲線を含むジオメトリを線ジオメトリに変換します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Multi">ST_Multi</a></span><span class="refpurpose"> — マルチ系ジオメトリを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Normalize">ST_Normalize</a></span><span class="refpurpose"> — 標準的な形式に変えたジオメトリを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_QuantizeCoordinates">ST_QuantizeCoordinates </a></span><span class="refpurpose"> — 座標値の最下位ビットを0にします。 </span></dt><dt><span class="refentrytitle"><a href="#ST_RemovePoint">ST_RemovePoint</a></span><span class="refpurpose"> — ラインストリングからポイントを削除します。</span></dt><dt><span class="refentrytitle"><a href="#ST_RemoveRepeatedPoints">ST_RemoveRepeatedPoints</a></span><span class="refpurpose"> — 入力ジオメトリから重複ポイントを除いたものを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Reverse">ST_Reverse</a></span><span class="refpurpose"> — 頂点の順序を逆にしたジオメトリを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Segmentize">ST_Segmentize</a></span><span class="refpurpose"> — 与えた距離を超える線分を持たないよう変更したジオメトリ/ジオグラフィを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_SetPoint">ST_SetPoint</a></span><span class="refpurpose"> — ラインストリングのポイントを与えられたポイントに置き換えます。</span></dt><dt><span class="refentrytitle"><a href="#ST_Shift_Longitude">ST_ShiftLongitude</a></span><span class="refpurpose"> — 経度座標値を-180度から180度の範囲と0度から360度の範囲との二つの範囲を行き来するようシフトします。</span></dt><dt><span class="refentrytitle"><a href="#ST_WrapX">ST_WrapX</a></span><span class="refpurpose"> — ジオメトリをX値で回り込ませます。</span></dt><dt><span class="refentrytitle"><a href="#ST_SnapToGrid">ST_SnapToGrid</a></span><span class="refpurpose"> — 入力ジオメトリの全ての点を規則的なグリッドにスナップします。 </span></dt><dt><span class="refentrytitle"><a href="#ST_Snap">ST_Snap</a></span><span class="refpurpose"> — 入力ジオメトリの辺と頂点を参照ジオメトリの頂点にスナップします。 </span></dt><dt><span class="refentrytitle"><a href="#ST_SwapOrdinates">ST_SwapOrdinates</a></span><span class="refpurpose"> — 与えられたジオメトリにおいて与えられた座標の値を入れ替えたジオメトリを返します。 </span></dt></dl></div><div class="refentry"><a name="ST_AddPoint"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AddPoint — ラインストリングにポイントを追加します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_AddPoint</b>(</code>geometry <var class="pdparam">linestring</var>, geometry <var class="pdparam">point</var><code>)</code>;</p></div><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_AddPoint</b>(</code>geometry <var class="pdparam">linestring</var>, geometry <var class="pdparam">point</var>, integer <var class="pdparam">position = -1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp55916544"></a><h2>説明</h2><p>LINESTRINGの<em class="parameter"><code>position</code></em>の位置 (0はじまり)の前にポイントを追加します。<em class="parameter"><code>position</code></em>パラメータが省略されるか-1の場合には、LINESTRINGの末尾に追加されます。</p><p>Availability: 1.1.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp55920512"></a><h2>例</h2><p>3次元ラインの末尾へのポイントの追加</p><pre class="programlisting">SELECT ST_AsEWKT(ST_AddPoint('LINESTRING(0 0 1, 1 1 1)', ST_MakePoint(1, 2, 3)));

    st_asewkt
    ----------
    LINESTRING(0 0 1,1 1 1,1 2 3)
</pre><p>テーブル内の全てのラインについて、閉じていないラインにだけ始端を末尾に追加することで、閉じていることを保証します。 </p><pre class="programlisting">UPDATE sometable
SET geom = ST_AddPoint(geom, ST_StartPoint(geom))
FROM sometable
WHERE ST_IsClosed(geom) = false;
</pre></div><div class="refsection"><a name="idp55927296"></a><h2>関連情報</h2><p><a class="xref" href="#ST_RemovePoint" title="ST_RemovePoint">ST_RemovePoint</a>, <a class="xref" href="#ST_SetPoint" title="ST_SetPoint">ST_SetPoint</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_CollectionExtract"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_CollectionExtract — ジオメトリコレクションを与えると、指定されたタイプの要素だけからなるマルチジオメトリを返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_CollectionExtract</b>(</code>geometry  <var class="pdparam">collection</var><code>)</code>;</p></div><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_CollectionExtract</b>(</code>geometry  <var class="pdparam">collection</var>, integer  <var class="pdparam">type</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp55936896"></a><h2>説明</h2><p>ジオメトリコレクションを指定すると、要素のタイプが統一されたマルチジオメトリを返します。</p><p><em class="parameter"><code>type</code></em>が指定されていない場合には、最大次元のジオメトリだけを含むマルチジオメトリを返します。このため、ポリゴンはラインに優先され、ラインはポイントに優先されます。 </p><p><em class="parameter"><code>type</code></em>が指定されている場合には、指定されたタイプだけを含むマルチジオメトリを返します。指定されたタイプの要素が無い場合には、EMPTYジオメトリを返します。ポイント、ライン、ポリゴンだけに対応しています。タイプの番号は次の通りです。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>1 == POINT</p></li><li class="listitem"><p>2 == LINESTRING</p></li><li class="listitem"><p>3 == POLYGON</p></li></ul></div><p>非マルチジオメトリの入力に対しては、ジオメトリのタイプと指定したタイプが合致している場合には変更せず返します。合致しない場合には、指定したタイプのEMPTYジオメトリを返します。ST_Multi"/&gt;を使ってマルチ系ジオメトリに変換する必要があるなら<a class="xref" href="#ST_Multi" title="ST_Multi">ST_Multi</a>を使います。 </p><div class="warning"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>マルチポリゴンの結果は妥当性チェックを行いません。ポリゴン要素が隣接やオーバラップしている場合には、結果ジオメトリは不正となります (たとえば、この関数を<a class="xref" href="#">???</a>の結果に適用すると発生します)。この状況に陥っているかは<a class="xref" href="#">???</a>で確認でき、<a class="xref" href="#">???</a>で修復できます。 </p></td></tr></table></div><p>Availability: 1.5.0</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>1.5.3より前のこの関数は非マルチジオメトリの入力に対して、指定タイプに関係なく変更せずに返しました。1.5.3で指定タイプに合致しない単一ジオメトリ入力に対してNULLを返すようになりました。2.0.0で、合致しないジオメトリに対して、指定タイプのEMPTYジオメトリを返すようになりました。 </p></td></tr></table></div></div><div class="refsection"><a name="idp55957120"></a><h2>例</h2><p>最大次元となるタイプの抽出:</p><pre class="programlisting">SELECT ST_AsText(ST_CollectionExtract(
        'GEOMETRYCOLLECTION( POINT(0 0), LINESTRING(1 1, 2 2) )'));
    st_astext
    ---------------
    MULTILINESTRING((1 1, 2 2))
</pre><p>ポイントの抽出 (type 1 == POINT):</p><pre class="programlisting">SELECT ST_AsText(ST_CollectionExtract(
        'GEOMETRYCOLLECTION(GEOMETRYCOLLECTION(POINT(0 0)))',
        1 ));
    st_astext
    ---------------
    MULTIPOINT(0 0)
</pre><p>ラインの抽出 (type 2 == LINESTRING):</p><pre class="programlisting">SELECT ST_AsText(ST_CollectionExtract(
        'GEOMETRYCOLLECTION(GEOMETRYCOLLECTION(LINESTRING(0 0, 1 1)),LINESTRING(2 2, 3 3))',
        2 ));
    st_astext
    ---------------
    MULTILINESTRING((0 0, 1 1), (2 2, 3 3))
</pre></div><div class="refsection"><a name="idp55960576"></a><h2>関連情報</h2><p><a class="xref" href="#ST_CollectionHomogenize" title="ST_CollectionHomogenize">ST_CollectionHomogenize</a>, <a class="xref" href="#ST_Multi" title="ST_Multi">ST_Multi</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#">???</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_CollectionHomogenize"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_CollectionHomogenize — ジオメトリコレクションを与えると、最も単純な表現を返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_CollectionHomogenize</b>(</code>geometry  <var class="pdparam">collection</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp55963520"></a><h2>説明</h2><p>ジオメトリコレクションを与えると、「最も単純な」表現を返します。 </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>同種の要素からなるコレクションが適切なマルチ系ジオメトリとして返されます。</p></li><li class="listitem"><p>タイプ混合のコレクションはフラットな単一のGEOMETRYCOLLECTIONに変換されます。</p></li><li class="listitem"><p>単一の非マルチジオメトリ要素からなるコレクションはその要素が返されます。</p></li><li class="listitem"><p>非マルチジオメトリは変更されずに返ります。マルチジオメトリへの変換が必要なら<a class="xref" href="#ST_Multi" title="ST_Multi">ST_Multi</a>を使います。</p></li></ul></div><div class="warning"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数は結果ジオメトリの妥当性を保証されず、隣接やオーバラップする複数ポリゴンからは不正なMULTIPOLYGONが生成されます。この状況に陥っているかは<a class="xref" href="#">???</a>で確認でき、<a class="xref" href="#">???</a>で修復できます。 </p></td></tr></table></div><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp55969280"></a><h2>例</h2><p>単一要素のコレクションから非マルチジオメトリへの変換</p><pre class="programlisting">SELECT ST_AsText(ST_CollectionHomogenize('GEOMETRYCOLLECTION(POINT(0 0))'));

        st_astext
        ------------
        POINT(0 0)
</pre><p>ネスト下単一要素のコレクションから非マルチジオメトリへの変換:</p><pre class="programlisting">SELECT ST_AsText(ST_CollectionHomogenize('GEOMETRYCOLLECTION(MULTIPOINT((0 0)))'));

        st_astext
        ------------
        POINT(0 0)
</pre><p>コレクションからマルチ系ジオメトリへの変換:</p><pre class="programlisting">SELECT ST_AsText(ST_CollectionHomogenize('GEOMETRYCOLLECTION(POINT(0 0),POINT(1 1))'));

        st_astext
        ---------------------
        MULTIPOINT(0 0,1 1)
</pre><p>ネストしたタイプ混合のコレクションからフラットなジオメトリコレクションへの変換:</p><pre class="programlisting">SELECT ST_AsText(ST_CollectionHomogenize('GEOMETRYCOLLECTION(POINT(0 0), GEOMETRYCOLLECTION( LINESTRING(1 1, 2 2)))'));

        st_astext
        ---------------------
        GEOMETRYCOLLECTION(POINT(0 0),LINESTRING(1 1,2 2))
</pre><p>ポリゴンのコレクションから (不正な)マルチポリゴンへの変換:</p><pre class="programlisting">SELECT ST_AsText(ST_CollectionHomogenize('GEOMETRYCOLLECTION (POLYGON ((10 50, 50 50, 50 10, 10 10, 10 50)), POLYGON ((90 50, 90 10, 50 10, 50 50, 90 50)))'));

        st_astext
        ---------------------
        MULTIPOLYGON(((10 50,50 50,50 10,10 10,10 50)),((90 50,90 10,50 10,50 50,90 50)))
</pre></div><div class="refsection"><a name="idp55974656"></a><h2>関連情報</h2><p><a class="xref" href="#ST_CollectionExtract" title="ST_CollectionExtract">ST_CollectionExtract</a>, <a class="xref" href="#ST_Multi" title="ST_Multi">ST_Multi</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#">???</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_CurveToLine"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_CurveToLine — 曲線を含むジオメトリを線ジオメトリに変換します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_CurveToLine</b>(</code>geometry <var class="pdparam">curveGeom</var>, float <var class="pdparam">tolerance</var>, integer <var class="pdparam">tolerance_type</var>, integer <var class="pdparam">flags</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp55984896"></a><h2>説明</h2><p>CIRCULARSTRINGをLINESTRINGに、CURVEPOLYGONをPOLYGONに、MULTISURFACEをMULTIPOLYGONに、それぞれ変換します。CIRCULARSTRINGジオメトリタイプに対応していないデバイスへの出力に使用します。</p><p>与えられたジオメトリを線型ジオメトリに変換します。それぞれの曲線ジオメトリまたは辺は、`tolerance` とオプションを使用して線形近似に変換します (デフォルトでは4分の1円ごとに32辺でオプションなしです)。</p><p>'tolerance_type'引数によって`tolerance`引数の解釈が決定されます。 </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>0 (デフォルト): toleranceは4分の1円の最大辺数です。</p></li><li class="listitem"><p>1: toleranceは曲線からラインまでの最大差です。単位は入力ジオメトリの単位です。</p></li><li class="listitem"><p>2: toleranceは生成される半径がなす角度のラジアン単位の最大値です。</p></li></ul></div><p>
    </p><p>'flags'引数はビットフィールドです。デフォルトでは0です。次のビットに対応します。 </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>1: 対称となる (方向独立)出力。</p></li><li class="listitem"><p>2: 角度維持。対称出力を生成する時に角度 (辺長)減少を避けます。対称フラグがOFFの時は何の効果もありません。</p></li></ul></div><p>
    </p><p>Availability: 1.3.0</p><p>Enhanced: 2.4.0 最大距離差による許容範囲と最大角度による許容範囲に対応し、対称出力に対応しました。</p><p>Enhanced: 3.0.0 線形化した弧ごとの最小線分数を実装しました。トポロジ的な崩壊を防ぐためです。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OGC Simple Features
 Implementation Specification for SQL 1.1.</a></p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 7.1.7</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p></div><div class="refsection"><a name="idp56002560"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(ST_CurveToLine(ST_GeomFromText('CIRCULARSTRING(220268 150415,220227 150505,220227 150406)')));

--Result --
 LINESTRING(220268 150415,220269.95064912 150416.539364228,220271.823415575 150418.17258804,220273.613787707 150419.895736857,
 220275.317452352 150421.704659462,220276.930305234 150423.594998003,220278.448460847 150425.562198489,
 220279.868261823 150427.60152176,220281.186287736 150429.708054909,220282.399363347 150431.876723113,
 220283.50456625 150434.10230186,220284.499233914 150436.379429536,220285.380970099 150438.702620341,220286.147650624 150441.066277505,
 220286.797428488 150443.464706771,220287.328738321 150445.892130112,220287.740300149 150448.342699654,
 220288.031122486 150450.810511759,220288.200504713 150453.289621251,220288.248038775 150455.77405574,
 220288.173610157 150458.257830005,220287.977398166 150460.734960415,220287.659875492 150463.199479347,
 220287.221807076 150465.64544956,220286.664248262 150468.066978495,220285.988542259 150470.458232479,220285.196316903 150472.81345077,
 220284.289480732 150475.126959442,220283.270218395 150477.39318505,220282.140985384 150479.606668057,
 220280.90450212 150481.762075989,220279.5637474 150483.85421628,220278.12195122 150485.87804878,
 220276.582586992 150487.828697901,220274.949363179 150489.701464356,220273.226214362 150491.491836488,
 220271.417291757 150493.195501133,220269.526953216 150494.808354014,220267.559752731 150496.326509628,
 220265.520429459 150497.746310603,220263.41389631 150499.064336517,220261.245228106 150500.277412127,
 220259.019649359 150501.38261503,220256.742521683 150502.377282695,220254.419330878 150503.259018879,
 220252.055673714 150504.025699404,220249.657244448 150504.675477269,220247.229821107 150505.206787101,
 220244.779251566 150505.61834893,220242.311439461 150505.909171266,220239.832329968 150506.078553494,
 220237.347895479 150506.126087555,220234.864121215 150506.051658938,220232.386990804 150505.855446946,
 220229.922471872 150505.537924272,220227.47650166 150505.099855856,220225.054972724 150504.542297043,
 220222.663718741 150503.86659104,220220.308500449 150503.074365683,
 220217.994991777 150502.167529512,220215.72876617 150501.148267175,
 220213.515283163 150500.019034164,220211.35987523 150498.7825509,
 220209.267734939 150497.441796181,220207.243902439 150496,
 220205.293253319 150494.460635772,220203.420486864 150492.82741196,220201.630114732 150491.104263143,
 220199.926450087 150489.295340538,220198.313597205 150487.405001997,220196.795441592 150485.437801511,
 220195.375640616 150483.39847824,220194.057614703 150481.291945091,220192.844539092 150479.123276887,220191.739336189 150476.89769814,
 220190.744668525 150474.620570464,220189.86293234 150472.297379659,220189.096251815 150469.933722495,
 220188.446473951 150467.535293229,220187.915164118 150465.107869888,220187.50360229 150462.657300346,
 220187.212779953 150460.189488241,220187.043397726 150457.710378749,220186.995863664 150455.22594426,
 220187.070292282 150452.742169995,220187.266504273 150450.265039585,220187.584026947 150447.800520653,
 220188.022095363 150445.35455044,220188.579654177 150442.933021505,220189.25536018 150440.541767521,
 220190.047585536 150438.18654923,220190.954421707 150435.873040558,220191.973684044 150433.60681495,
 220193.102917055 150431.393331943,220194.339400319 150429.237924011,220195.680155039 150427.14578372,220197.12195122 150425.12195122,
 220198.661315447 150423.171302099,220200.29453926 150421.298535644,220202.017688077 150419.508163512,220203.826610682 150417.804498867,
 220205.716949223 150416.191645986,220207.684149708 150414.673490372,220209.72347298 150413.253689397,220211.830006129 150411.935663483,
 220213.998674333 150410.722587873,220216.22425308 150409.61738497,220218.501380756 150408.622717305,220220.824571561 150407.740981121,
 220223.188228725 150406.974300596,220225.586657991 150406.324522731,220227 150406)

--3d example
SELECT ST_AsEWKT(ST_CurveToLine(ST_GeomFromEWKT('CIRCULARSTRING(220268 150415 1,220227 150505 2,220227 150406 3)')));
Output
------
 LINESTRING(220268 150415 1,220269.95064912 150416.539364228 1.0181172856673,
 220271.823415575 150418.17258804 1.03623457133459,220273.613787707 150419.895736857 1.05435185700189,....AD INFINITUM ....
    220225.586657991 150406.324522731 1.32611114201132,220227 150406 3)

--use only 2 segments to approximate quarter circle
SELECT ST_AsText(ST_CurveToLine(ST_GeomFromText('CIRCULARSTRING(220268 150415,220227 150505,220227 150406)'),2));
st_astext
------------------------------
 LINESTRING(220268 150415,220287.740300149 150448.342699654,220278.12195122 150485.87804878,
 220244.779251566 150505.61834893,220207.243902439 150496,220187.50360229 150462.657300346,
 220197.12195122 150425.12195122,220227 150406)

-- Ensure approximated line is no further than 20 units away from
-- original curve, and make the result direction-neutral
SELECT ST_AsText(ST_CurveToLine(
 'CIRCULARSTRING(0 0,100 -100,200 0)'::geometry,
    20, -- Tolerance
    1, -- Above is max distance between curve and line
    1  -- Symmetric flag
));
st_astext
-------------------------------------------------------------------------------------------
 LINESTRING(0 0,50 -86.6025403784438,150 -86.6025403784439,200 -1.1331077795296e-13,200 0)


        </pre></div><div class="refsection"><a name="idp56004096"></a><h2>関連情報</h2><p><a class="xref" href="#ST_LineToCurve" title="ST_LineToCurve">ST_LineToCurve</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Scroll"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Scroll — 閉じたLINESTRINGの開始点を変更する</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Scroll</b>(</code>geometry <var class="pdparam">linestring</var>, geometry <var class="pdparam">point</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp56035456"></a><h2>説明</h2><p>閉じたLINESTRINGの開始/終了点を <em class="parameter"><code>point</code></em>で指定した頂点に変更します。 </p><p>Availability: 3.2.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports M coordinates.</p></div><div class="refsection"><a name="idp56040320"></a><h2>例</h2><p>閉じたラインの3番目の頂点を開始点にする</p><pre class="programlisting">SELECT ST_AsEWKT(ST_Scroll('SRID=4326;LINESTRING(0 0 0 1, 10 0 2 0, 5 5 4 2,0 0 0 1)', 'POINT(5 5 4 2)'));

st_asewkt
----------
SRID=4326;LINESTRING(5 5 4 2,0 0 0 1,10 0 2 0,5 5 4 2)
</pre></div><div class="refsection"><a name="idp56041984"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Normalize" title="ST_Normalize">ST_Normalize</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_FlipCoordinates"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_FlipCoordinates — X値とY値を入れ替えたジオメトリを返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_FlipCoordinates</b>(</code>geometry <var class="pdparam">geom</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp56047872"></a><h2>説明</h2><p>与えられたジオメトリのX値とY値を入れ替えたものを返します。緯度経度 (Y,X)で表現される座標値を持つジオメトリを修正するのに使います。</p><p>Availability: 2.0.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports M coordinates.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div><div class="refsection"><a name="idp56056192"></a><h2>例</h2><pre class="programlisting">
SELECT ST_AsEWKT(ST_FlipCoordinates(GeomFromEWKT('POINT(1 2)')));
 st_asewkt
------------
POINT(2 1)
         </pre></div><div class="refsection"><a name="idp56057728"></a><h2>関連情報</h2><p> <a class="xref" href="#ST_SwapOrdinates" title="ST_SwapOrdinates">ST_SwapOrdinates</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Force2D"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Force2D — ジオメトリを2次元モードに強制します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Force2D</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp56063744"></a><h2>説明</h2><p>ジオメトリを「2次元モード」に強制させます。全ての出力表現はXY座標値のみを持つことになります。OGC準拠の出力 (OGCは2次元ジオメトリのみ策定しています)に強制するために使われます。</p><p>Enhanced: 2.0.0 多面体サーフェス対応が導入されました。</p><p>Changed: 2.1.0 2.0.xの間はST_Force_2Dと呼ばれていました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp56069632"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsEWKT(ST_Force2D(ST_GeomFromEWKT('CIRCULARSTRING(1 1 2, 2 3 2, 4 5 2, 6 7 2, 5 6 2)')));
                st_asewkt
-------------------------------------
CIRCULARSTRING(1 1,2 3,4 5,6 7,5 6)

SELECT  ST_AsEWKT(ST_Force2D('POLYGON((0 0 2,0 5 2,5 0 2,0 0 2),(1 1 2,3 1 2,1 3 2,1 1 2))'));

                                  st_asewkt
----------------------------------------------
 POLYGON((0 0,0 5,5 0,0 0),(1 1,3 1,1 3,1 1))

                </pre></div><div class="refsection"><a name="idp56071168"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Force_3D" title="ST_Force3D">ST_Force3D</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Force_3D"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Force3D — ジオメトリをXYZモードに強制します。これはST_Force3DZの別名です。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Force3D</b>(</code>geometry  <var class="pdparam">geomA</var>, float  <var class="pdparam">Zvalue = 0.0</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp56077952"></a><h2>説明</h2><p>ジオメトリをXYZモードに強制します。これはST_Force_3DZの別名です。ジオメトリがZ値を持っていない場合は<em class="parameter"><code>Zvalue</code></em>のZ値を追加します。</p><p>Enhanced: 2.0.0 多面体サーフェス対応が導入されました。</p><p>Changed: 2.1.0 2.0.xの間はST_Force_3Dと呼ばれていました。</p><p>Changed: 3.1.0. 0でないZ値を指定できるようになりました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp56084736"></a><h2>例</h2><pre class="programlisting">-- 既に3次元ジオメトリになっている場合は何も起きません
                SELECT ST_AsEWKT(ST_Force3D(ST_GeomFromEWKT('CIRCULARSTRING(1 1 2, 2 3 2, 4 5 2, 6 7 2, 5 6 2)')));
                                   st_asewkt
-----------------------------------------------
 CIRCULARSTRING(1 1 2,2 3 2,4 5 2,6 7 2,5 6 2)


SELECT  ST_AsEWKT(ST_Force3D('POLYGON((0 0,0 5,5 0,0 0),(1 1,3 1,1 3,1 1))'));

                                                 st_asewkt
--------------------------------------------------------------
 POLYGON((0 0 0,0 5 0,5 0 0,0 0 0),(1 1 0,3 1 0,1 3 0,1 1 0))
                </pre></div><div class="refsection"><a name="idp56086272"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a>, <a class="xref" href="#ST_Force2D" title="ST_Force2D">ST_Force2D</a>, <a class="xref" href="#ST_Force_3DM" title="ST_Force3DM">ST_Force3DM</a>, <a class="xref" href="#ST_Force_3DZ" title="ST_Force3DZ">ST_Force3DZ</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Force_3DZ"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Force3DZ — ジオメトリをXYZモードに強制します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Force3DZ</b>(</code>geometry  <var class="pdparam">geomA</var>, float  <var class="pdparam">Zvalue = 0.0</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp56106496"></a><h2>説明</h2><p>ジオメトリをXYZモードに強制します。これはST_Force_3DZの別名です。ジオメトリがZ値を持っていない場合は<em class="parameter"><code>Zvalue</code></em>のZ値を追加します。</p><p>Enhanced: 2.0.0 多面体サーフェス対応が導入されました。</p><p>Changed: 2.1.0 2.0.xの間はST_Force_3DZと呼ばれていました。</p><p>Changed: 3.1.0. 0でないZ値を指定できるようになりました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p></div><div class="refsection"><a name="idp56117376"></a><h2>例</h2><pre class="programlisting">-- 既に3次元ジオメトリになっている場合は何も起きません
SELECT ST_AsEWKT(ST_Force3DZ(ST_GeomFromEWKT('CIRCULARSTRING(1 1 2, 2 3 2, 4 5 2, 6 7 2, 5 6 2)')));
                                   st_asewkt
-----------------------------------------------
 CIRCULARSTRING(1 1 2,2 3 2,4 5 2,6 7 2,5 6 2)


SELECT  ST_AsEWKT(ST_Force3DZ('POLYGON((0 0,0 5,5 0,0 0),(1 1,3 1,1 3,1 1))'));

                                                 st_asewkt
--------------------------------------------------------------
 POLYGON((0 0 0,0 5 0,5 0 0,0 0 0),(1 1 0,3 1 0,1 3 0,1 1 0))
                </pre></div><div class="refsection"><a name="idp56118912"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a>, <a class="xref" href="#ST_Force2D" title="ST_Force2D">ST_Force2D</a>, <a class="xref" href="#ST_Force_3DM" title="ST_Force3DM">ST_Force3DM</a>, <a class="xref" href="#ST_Force_3D" title="ST_Force3D">ST_Force3D</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Force_3DM"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Force3DM — ジオメトリをXYMモードに強制します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Force3DM</b>(</code>geometry  <var class="pdparam">geomA</var>, float  <var class="pdparam">Mvalue = 0.0</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp56126848"></a><h2>説明</h2><p>ジオメトリをXYMモードに強制します。ジオメトリがM値を持っていない場合は<em class="parameter"><code>Mvalue</code></em>のM値を追加します。Z値を持っている場合はZ値は除去されます。</p><p>Changed: 2.1.0 2.0.xの間はST_Force_3DMと呼ばれていました。</p><p>Changed: 3.1.0. 0でないM値を指定できるようになりました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p></div><div class="refsection"><a name="idp56130432"></a><h2>例</h2><pre class="programlisting">-- 既に3次元ジオメトリになっている場合は何も起きません
SELECT ST_AsEWKT(ST_Force3DM(ST_GeomFromEWKT('CIRCULARSTRING(1 1 2, 2 3 2, 4 5 2, 6 7 2, 5 6 2)')));
                                   st_asewkt
------------------------------------------------
 CIRCULARSTRINGM(1 1 0,2 3 0,4 5 0,6 7 0,5 6 0)


SELECT  ST_AsEWKT(ST_Force3DM('POLYGON((0 0 1,0 5 1,5 0 1,0 0 1),(1 1 1,3 1 1,1 3 1,1 1 1))'));

                                                  st_asewkt
---------------------------------------------------------------
 POLYGONM((0 0 0,0 5 0,5 0 0,0 0 0),(1 1 0,3 1 0,1 3 0,1 1 0))

                </pre></div><div class="refsection"><a name="idp56131968"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a>, <a class="xref" href="#ST_Force2D" title="ST_Force2D">ST_Force2D</a>, <a class="xref" href="#ST_Force_3DM" title="ST_Force3DM">ST_Force3DM</a>, <a class="xref" href="#ST_Force_3D" title="ST_Force3D">ST_Force3D</a>, <a class="xref" href="#">???</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Force_4D"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Force4D — ジオメトリをXYZMモードに強制します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Force4D</b>(</code>geometry  <var class="pdparam">geomA</var>, float  <var class="pdparam">Zvalue = 0.0</var>, float  <var class="pdparam">Mvalue = 0.0</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp56141312"></a><h2>説明</h2><p>ジオメトリをXYZMモードに強制します。Z値やM値が無い場合は<em class="parameter"><code>Zvalue</code></em>と<em class="parameter"><code>Mvalue</code></em>を追加します。 </p><p>Changed: 2.1.0 2.0.xの間はST_Force_4Dと呼ばれていました。</p><p>Changed: 3.1.0. 0でないZ値とM値を指定できるようになりました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p></div><div class="refsection"><a name="idp56146816"></a><h2>例</h2><pre class="programlisting">-- 既に3次元ジオメトリになっている場合は何も起きません
SELECT ST_AsEWKT(ST_Force4D(ST_GeomFromEWKT('CIRCULARSTRING(1 1 2, 2 3 2, 4 5 2, 6 7 2, 5 6 2)')));
                                                st_asewkt
---------------------------------------------------------
 CIRCULARSTRING(1 1 2 0,2 3 2 0,4 5 2 0,6 7 2 0,5 6 2 0)



SELECT  ST_AsEWKT(ST_Force4D('MULTILINESTRINGM((0 0 1,0 5 2,5 0 3,0 0 4),(1 1 1,3 1 1,1 3 1,1 1 1))'));

                                                                          st_asewkt
--------------------------------------------------------------------------------------
 MULTILINESTRING((0 0 0 1,0 5 0 2,5 0 0 3,0 0 0 4),(1 1 0 1,3 1 0 1,1 3 0 1,1 1 0 1))

                </pre></div><div class="refsection"><a name="idp56148352"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a>, <a class="xref" href="#ST_Force2D" title="ST_Force2D">ST_Force2D</a>, <a class="xref" href="#ST_Force_3DM" title="ST_Force3DM">ST_Force3DM</a>, <a class="xref" href="#ST_Force_3D" title="ST_Force3D">ST_Force3D</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_ForcePolygonCCW"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ForcePolygonCCW  — 全ての外環を反時計回りに、全ての内環を時計回りに、それぞれ強制します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef"> geometry <b class="fsfunc">ST_ForcePolygonCCW</b> (</code> geometry <var class="pdparam">geom</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp56167936"></a><h2>説明</h2><p>(マルチ)ポリゴンに対して、外環を反時計回りに、内環を時計回りに強制します。ポリゴンでないジオメトリは、変更されずに返されます。 </p><p>Availability: 2.4.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports M coordinates.</p></div><div class="refsection"><a name="idp56172288"></a><h2>関連情報</h2><p><a class="xref" href="#ST_ForcePolygonCW" title="ST_ForcePolygonCW">ST_ForcePolygonCW </a>, <a class="xref" href="#ST_IsPolygonCCW" title="ST_IsPolygonCCW">ST_IsPolygonCCW </a>, <a class="xref" href="#ST_IsPolygonCW" title="ST_IsPolygonCW">ST_IsPolygonCW </a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Force_Collection"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ForceCollection — ジオメトリをジオメトリコレクションに変換します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_ForceCollection</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp56178944"></a><h2>説明</h2><p>ジオメトリをジオメトリコレクションに変換します。これはWKB表現を単純化するのに便利です。</p><p>Enhanced: 2.0.0 多面体サーフェス対応が導入されました。</p><p>Availability: 1.2.2 1.3.4より前は、曲線を含むジオメトリで使うとクラッシュしました。これは1.3.4以上では訂正されています。</p><p>Changed: 2.1.0 2.0.xの間はST_Force_Collectionと呼ばれていました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p></div><div class="refsection"><a name="idp56205696"></a><h2>例</h2><pre class="programlisting">SELECT  ST_AsEWKT(ST_ForceCollection('POLYGON((0 0 1,0 5 1,5 0 1,0 0 1),(1 1 1,3 1 1,1 3 1,1 1 1))'));

                                                                   st_asewkt
----------------------------------------------------------------------------------
 GEOMETRYCOLLECTION(POLYGON((0 0 1,0 5 1,5 0 1,0 0 1),(1 1 1,3 1 1,1 3 1,1 1 1)))


  SELECT ST_AsText(ST_ForceCollection('CIRCULARSTRING(220227 150406,2220227 150407,220227 150406)'));
                                                                   st_astext
--------------------------------------------------------------------------------
 GEOMETRYCOLLECTION(CIRCULARSTRING(220227 150406,2220227 150407,220227 150406))
(1 row)

                </pre><pre class="programlisting">-- 多面体の例 --
SELECT ST_AsEWKT(ST_ForceCollection('POLYHEDRALSURFACE(((0 0 0,0 0 1,0 1 1,0 1 0,0 0 0)),
 ((0 0 0,0 1 0,1 1 0,1 0 0,0 0 0)),
 ((0 0 0,1 0 0,1 0 1,0 0 1,0 0 0)),
 ((1 1 0,1 1 1,1 0 1,1 0 0,1 1 0)),
 ((0 1 0,0 1 1,1 1 1,1 1 0,0 1 0)),
 ((0 0 1,1 0 1,1 1 1,0 1 1,0 0 1)))'))

                                                                   st_asewkt
----------------------------------------------------------------------------------
GEOMETRYCOLLECTION(
  POLYGON((0 0 0,0 0 1,0 1 1,0 1 0,0 0 0)),
  POLYGON((0 0 0,0 1 0,1 1 0,1 0 0,0 0 0)),
  POLYGON((0 0 0,1 0 0,1 0 1,0 0 1,0 0 0)),
  POLYGON((1 1 0,1 1 1,1 0 1,1 0 0,1 1 0)),
  POLYGON((0 1 0,0 1 1,1 1 1,1 1 0,0 1 0)),
  POLYGON((0 0 1,1 0 1,1 1 1,0 1 1,0 0 1))
)
                </pre></div><div class="refsection"><a name="idp56207744"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a>, <a class="xref" href="#ST_Force2D" title="ST_Force2D">ST_Force2D</a>, <a class="xref" href="#ST_Force_3DM" title="ST_Force3DM">ST_Force3DM</a>, <a class="xref" href="#ST_Force_3D" title="ST_Force3D">ST_Force3D</a>, <a class="xref" href="#">???</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_ForcePolygonCW"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ForcePolygonCW  — 全ての外環を時計回りに、全ての内環を反時計回りに、それぞれ強制します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef"> geometry <b class="fsfunc">ST_ForcePolygonCW</b> (</code> geometry <var class="pdparam">geom</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp56215424"></a><h2>説明</h2><p>(マルチ)ポリゴンに対して、外環を時計回りに、内環を反時計回りに強制します。ポリゴンでないジオメトリは、変更されずに返されます。 </p><p>Availability: 2.4.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports M coordinates.</p></div><div class="refsection"><a name="idp56219776"></a><h2>関連情報</h2><p><a class="xref" href="#ST_ForcePolygonCCW" title="ST_ForcePolygonCCW">ST_ForcePolygonCCW </a>, <a class="xref" href="#ST_IsPolygonCCW" title="ST_IsPolygonCCW">ST_IsPolygonCCW </a>, <a class="xref" href="#ST_IsPolygonCW" title="ST_IsPolygonCW">ST_IsPolygonCW </a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_ForceSFS"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ForceSFS — SFS 1.1ジオメトリタイプのみ使うようジオメトリに強制します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_ForceSFS</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_ForceSFS</b>(</code>geometry  <var class="pdparam">geomA</var>, text  <var class="pdparam">version</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp56233728"></a><h2>説明</h2><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_ForceRHR"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ForceRHR — ポリゴンの頂点の方向を右回りに強制します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_ForceRHR</b>(</code>geometry <var class="pdparam">g</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp56244352"></a><h2>説明</h2><p>ポリゴンの頂点の方向はRight-Hand-Ruleに従います。この際、ポリゴンの領域は、境界線の右側になります。特に、外環は時計回りに強制され、内環は反時計回りに強制されます。この関数は<a class="xref" href="#ST_ForcePolygonCW" title="ST_ForcePolygonCW">ST_ForcePolygonCW </a>の別名です。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>上のRHRの定義は、他の文脈で使われる場合の定義と矛盾します。これを解消するには、ST_ForcePolygonCWを使うことを推奨します。 </p></td></tr></table></div><p>Enhanced: 2.0.0 多面体サーフェス対応が導入されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p></div><div class="refsection"><a name="idp56249856"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsEWKT(
  ST_ForceRHR(
        'POLYGON((0 0 2, 5 0 2, 0 5 2, 0 0 2),(1 1 2, 1 3 2, 3 1 2, 1 1 2))'
  )
);
                                                  st_asewkt
--------------------------------------------------------------
 POLYGON((0 0 2,0 5 2,5 0 2,0 0 2),(1 1 2,3 1 2,1 3 2,1 1 2))
(1 row)</pre></div><div class="refsection"><a name="idp56251136"></a><h2>関連情報</h2><p><a class="xref" href="#ST_ForcePolygonCCW" title="ST_ForcePolygonCCW">ST_ForcePolygonCCW </a>, <a class="xref" href="#ST_ForcePolygonCW" title="ST_ForcePolygonCW">ST_ForcePolygonCW </a>, <a class="xref" href="#ST_IsPolygonCCW" title="ST_IsPolygonCCW">ST_IsPolygonCCW </a>, <a class="xref" href="#ST_IsPolygonCW" title="ST_IsPolygonCW">ST_IsPolygonCW </a>, <a class="xref" href="#ST_BuildArea" title="ST_BuildArea">ST_BuildArea</a>, <a class="xref" href="#ST_Polygonize" title="ST_Polygonize">ST_Polygonize</a>, <a class="xref" href="#ST_Reverse" title="ST_Reverse">ST_Reverse</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_ForceCurve"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ForceCurve — 該当する場合は、ジオメトリを曲線タイプに変換します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_ForceCurve</b>(</code>geometry <var class="pdparam">g</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp56259200"></a><h2>説明</h2><p>可能ならジオメトリを曲線表現に変更します。ラインは複合曲線になり、マルチラインはマルチ曲線になり、ポリゴンは曲線ポリゴンになり、マルチポリゴンはマルチサーフェスになります。入力ジオメトリが既に曲線表現であるなら、入力と同じ値が返されます。 </p><p>Availability: 2.2.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p></div><div class="refsection"><a name="idp56275840"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(
  ST_ForceCurve(
        'POLYGON((0 0 2, 5 0 2, 0 5 2, 0 0 2),(1 1 2, 1 3 2, 3 1 2, 1 1 2))'::geometry
  )
);
                              st_astext
----------------------------------------------------------------------
 CURVEPOLYGON Z ((0 0 2,5 0 2,0 5 2,0 0 2),(1 1 2,1 3 2,3 1 2,1 1 2))
(1 row)</pre></div><div class="refsection"><a name="idp56277120"></a><h2>関連情報</h2><p><a class="xref" href="#ST_LineToCurve" title="ST_LineToCurve">ST_LineToCurve</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_LineToCurve"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_LineToCurve — 曲線を含むジオメトリを線ジオメトリに変換します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_LineToCurve</b>(</code>geometry  <var class="pdparam">geomANoncircular</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp56282880"></a><h2>説明</h2><p>LINESTRING/POLYGONをCIRCULARSTRINGと曲線ポリゴンに変換します。等価の曲線を記述するのに必要なポイントが少なくなります。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>入力ラインストリング/ポリゴンが、曲線をはっきりと表現するのには不十分な場合には、関数は入力ジオメトリと同じものを返します。</p></td></tr></table></div><p>Availability: 1.3.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p></div><div class="refsection"><a name="idp56287488"></a><h2>例</h2><pre class="programlisting">--  2次元の例
SELECT ST_AsText(ST_LineToCurve(foo.geom)) As curvedastext,ST_AsText(foo.geom) As non_curvedastext
    FROM (SELECT ST_Buffer('POINT(1 3)'::geometry, 3) As geom) As foo;

curvedatext                                                            non_curvedastext
--------------------------------------------------------------------|-----------------------------------------------------------------
CURVEPOLYGON(CIRCULARSTRING(4 3,3.12132034355964 0.878679656440359, | POLYGON((4 3,3.94235584120969 2.41472903395162,3.77163859753386 1.85194970290473,
1 0,-1.12132034355965 5.12132034355963,4 3))                        |  3.49440883690764 1.33328930094119,3.12132034355964 0.878679656440359,
                                                                    |  2.66671069905881 0.505591163092366,2.14805029709527 0.228361402466141,
                                                                    |  1.58527096604839 0.0576441587903094,1 0,
                                                                    |  0.414729033951621 0.0576441587903077,-0.148050297095264 0.228361402466137,
                                                                    |  -0.666710699058802 0.505591163092361,-1.12132034355964 0.878679656440353,
                                                                    |  -1.49440883690763 1.33328930094119,-1.77163859753386 1.85194970290472
                                                                    |  --ETC-- ,3.94235584120969 3.58527096604839,4 3))

--3次元の例
SELECT ST_AsText(ST_LineToCurve(geom)) As curved, ST_AsText(geom) AS not_curved
FROM (SELECT ST_Translate(ST_Force3D(ST_Boundary(ST_Buffer(ST_Point(1,3), 2,2))),0,0,3) AS geom) AS foo;

                        curved                        |               not_curved
------------------------------------------------------+---------------------------------------------------------------------
 CIRCULARSTRING Z (3 3 3,-1 2.99999999999999 3,3 3 3) | LINESTRING Z (3 3 3,2.4142135623731 1.58578643762691 3,1 1 3,
                                                      | -0.414213562373092 1.5857864376269 3,-1 2.99999999999999 3,
                                                      | -0.414213562373101 4.41421356237309 3,
                                                      | 0.999999999999991 5 3,2.41421356237309 4.4142135623731 3,3 3 3)
(1 row)
</pre></div><div class="refsection"><a name="idp56289024"></a><h2>関連情報</h2><p><a class="xref" href="#ST_CurveToLine" title="ST_CurveToLine">ST_CurveToLine</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Multi"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Multi — マルチ系ジオメトリを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Multi</b>(</code>geometry  <var class="pdparam">geom</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp56315264"></a><h2>説明</h2><p>マルチ系ジオメトリを返します。ジオメトリが既にマルチ系なら変更せずに返します。</p></div><div class="refsection"><a name="idp56316544"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(ST_Multi('POLYGON ((10 30, 30 30, 30 10, 10 10, 10 30))'));
                    st_astext
    -------------------------------------------------
    MULTIPOLYGON(((10 30,30 30,30 10,10 10,10 30)))
</pre></div><div class="refsection"><a name="idp56317824"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Normalize"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Normalize — 標準的な形式に変えたジオメトリを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Normalize</b>(</code>geometry  <var class="pdparam">geom</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp56323584"></a><h2>説明</h2><p>正規化/標準化された形式のジオメトリを返します。ポリゴンの環における頂点の順序、ポリゴンにおける環の順序、複合ジオメトリにおける要素の順序が変更されることがあります。 </p><p>ほとんどの場合、試験目的 (期待した結果と実際に得た結果との比較)でのみ使用します。 </p><p>Availability: 2.3.0</p></div><div class="refsection"><a name="idp56325632"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(ST_Normalize(ST_GeomFromText(
  'GEOMETRYCOLLECTION(
    POINT(2 3),
    MULTILINESTRING((0 0, 1 1),(2 2, 3 3)),
    POLYGON(
      (0 10,0 0,10 0,10 10,0 10),
      (4 2,2 2,2 4,4 4,4 2),
      (6 8,8 8,8 6,6 6,6 8)
    )
  )'
)));
                                                                     st_astext
----------------------------------------------------------------------------------------------------------------------------------------------------
 GEOMETRYCOLLECTION(POLYGON((0 0,0 10,10 10,10 0,0 0),(6 6,8 6,8 8,6 8,6 6),(2 2,4 2,4 4,2 4,2 2)),MULTILINESTRING((2 2,3 3),(0 0,1 1)),POINT(2 3))
(1 row)
                        </pre></div><div class="refsection"><a name="idp56331008"></a><h2>関連情報</h2><p><a class="xref" href="#">???</a>, </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_QuantizeCoordinates"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_QuantizeCoordinates  — 座標値の最下位ビットを0にします。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef"> geometry <b class="fsfunc">ST_QuantizeCoordinates</b> (</code> geometry <var class="pdparam">g</var> ,  int <var class="pdparam">prec_x</var> ,  int <var class="pdparam">prec_y</var> ,  int <var class="pdparam">prec_z</var> ,  int <var class="pdparam">prec_m</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp56346496"></a><h2>説明</h2><p><code class="code">ST_QuantizeCoordinates</code>は、指定した小数点以下の桁数での座標値表現に必要なビット数 (<code class="code">N</code>)を決定し、最大の有効ビット数<code class="code">N</code>以外を0にします。結果の座標値は元の値を丸めますが、圧縮性が改善されます。これにより、ジオメトリカラムが<a class="ulink" href="https://www.postgresql.org/docs/current/static/storage-toast.html#STORAGE-TOAST-ONDISK" target="_top"> compressible storage type</a>を使って、ディスク使用を劇的に減少させることができます。この関数によって、小数点以下の桁数の異なる指定が可能になります。指定されていない次元は<code class="code">x</code>次元の精度を持つものとします。負の桁数は、小数点以上の桁数の参照と解釈されます (例: <code class="code">prec_x=-2</code>は100付近の座標値を保存します)。 </p><p><code class="code">ST_QuantizeCoordinates</code>が生成する座標は、これらの座標を含むジオメトリや、ジオメトリ内のこれらの相対的な位置から独立しています。結果として、ジオメトリ間に存在するトポロジ関係は、この関数の使用によって影響を受けることはありません。この関数は、ジオメトリの内在的な精度より低い桁数では不正なジオメトリを生成する可能性があります。 </p><p>Availability: 2.5.0</p></div><div class="refsection"><a name="idp56351104"></a><h2>技術背景</h2><p>PostGIS はすべての座標値を倍精度浮動小数点数として格納し、15桁の有効桁数を確実に表すことができます。ただし、PostGISでは、本質的に15桁未満のデータの管理ができます。例としては、小数点以下6桁の精度の地理座標として提供されるTigerデータがあります (故に、必要な有効桁数は、経度は9桁、緯度は8桁です)。 </p><p>有効桁数が15の時、多数のありえる9桁の表現があります。倍精度浮動小数点数は52の明示的なビット数を座標の仮数部に使っています。有効桁数9桁では仮数部は30ビットだけ必要で、22ビットは有効ではありません。これらの値を好きなものにすることができ、結局は入力値を丸める数字となります。例えば、100.123456という値は100.123456000000, 100.123456000001および100.123456432199に近い数として表現されます。全ては等しく妥当で、これらの入力では<code class="code">ST_AsText(geom, 6)</code>は同じ結果を返します。これらのビット数をあらゆる値にセットすることができるので、<code class="code">ST_QuantizeCoordinates</code>は無効ビットとなる22ビットに0をセットします。長い座標値のビット列では、連続的な0のブロックから、PostgreSQLによって効率的に圧縮されたパターンを生成します。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ジオメトリのディスク上のサイズだけが<code class="code">ST_QuantizeCoordinates</code>の影響を潜在的に受けます。ジオメトリのメモリ利用を報告する<a class="xref" href="#ST_MemSize" title="ST_MemSize">ST_MemSize</a>は、ジオメトリに使われるディスク上のサイズにかかわらず同じ値を返します。 </p></td></tr></table></div></div><div class="refsection"><a name="idp56355072"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(ST_QuantizeCoordinates('POINT (100.123456 0)'::geometry, 4));
st_astext
-------------------------
POINT(100.123455047607 0)
                        </pre><pre class="programlisting">WITH test AS (SELECT 'POINT (123.456789123456 123.456789123456)'::geometry AS geom)
SELECT
  digits,
  encode(ST_QuantizeCoordinates(geom, digits), 'hex'),
  ST_AsText(ST_QuantizeCoordinates(geom, digits))
FROM test, generate_series(15, -15, -1) AS digits;

digits  |                   encode                   |                st_astext
--------+--------------------------------------------+------------------------------------------
15      | 01010000005f9a72083cdd5e405f9a72083cdd5e40 | POINT(123.456789123456 123.456789123456)
14      | 01010000005f9a72083cdd5e405f9a72083cdd5e40 | POINT(123.456789123456 123.456789123456)
13      | 01010000005f9a72083cdd5e405f9a72083cdd5e40 | POINT(123.456789123456 123.456789123456)
12      | 01010000005c9a72083cdd5e405c9a72083cdd5e40 | POINT(123.456789123456 123.456789123456)
11      | 0101000000409a72083cdd5e40409a72083cdd5e40 | POINT(123.456789123456 123.456789123456)
10      | 0101000000009a72083cdd5e40009a72083cdd5e40 | POINT(123.456789123455 123.456789123455)
9       | 0101000000009072083cdd5e40009072083cdd5e40 | POINT(123.456789123418 123.456789123418)
8       | 0101000000008072083cdd5e40008072083cdd5e40 | POINT(123.45678912336 123.45678912336)
7       | 0101000000000070083cdd5e40000070083cdd5e40 | POINT(123.456789121032 123.456789121032)
6       | 0101000000000040083cdd5e40000040083cdd5e40 | POINT(123.456789076328 123.456789076328)
5       | 0101000000000000083cdd5e40000000083cdd5e40 | POINT(123.456789016724 123.456789016724)
4       | 0101000000000000003cdd5e40000000003cdd5e40 | POINT(123.456787109375 123.456787109375)
3       | 0101000000000000003cdd5e40000000003cdd5e40 | POINT(123.456787109375 123.456787109375)
2       | 01010000000000000038dd5e400000000038dd5e40 | POINT(123.45654296875 123.45654296875)
1       | 01010000000000000000dd5e400000000000dd5e40 | POINT(123.453125 123.453125)
0       | 01010000000000000000dc5e400000000000dc5e40 | POINT(123.4375 123.4375)
-1      | 01010000000000000000c05e400000000000c05e40 | POINT(123 123)
-2      | 01010000000000000000005e400000000000005e40 | POINT(120 120)
-3      | 010100000000000000000058400000000000005840 | POINT(96 96)
-4      | 010100000000000000000058400000000000005840 | POINT(96 96)
-5      | 010100000000000000000058400000000000005840 | POINT(96 96)
-6      | 010100000000000000000058400000000000005840 | POINT(96 96)
-7      | 010100000000000000000058400000000000005840 | POINT(96 96)
-8      | 010100000000000000000058400000000000005840 | POINT(96 96)
-9      | 010100000000000000000058400000000000005840 | POINT(96 96)
-10     | 010100000000000000000058400000000000005840 | POINT(96 96)
-11     | 010100000000000000000058400000000000005840 | POINT(96 96)
-12     | 010100000000000000000058400000000000005840 | POINT(96 96)
-13     | 010100000000000000000058400000000000005840 | POINT(96 96)
-14     | 010100000000000000000058400000000000005840 | POINT(96 96)
-15     | 010100000000000000000058400000000000005840 | POINT(96 96)
</pre></div><div class="refsection"><a name="idp56356864"></a><h2>関連情報</h2><p><a class="xref" href="#ST_SnapToGrid" title="ST_SnapToGrid">ST_SnapToGrid</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_RemovePoint"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_RemovePoint — ラインストリングからポイントを削除します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_RemovePoint</b>(</code>geometry <var class="pdparam">linestring</var>, integer <var class="pdparam">offset</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp56396416"></a><h2>説明</h2><p>ラインストリングからポイントを削除します。インデックスは0始まりです。閉じたリングを開いたラインストリングに変えるのに使います。 </p><p>Enhanced: 3.2.0</p><p>Availability: 1.1.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp56399744"></a><h2>例</h2><p>閉じたライン (リング)の終点を削除するとラインが閉じなくなることが保証されています。geomがLINESTRINGであると仮定するします。</p><pre class="programlisting">UPDATE sometable
        SET geom = ST_RemovePoint(geom, ST_NPoints(geom) - 1)
        FROM sometable
        WHERE ST_IsClosed(geom);
</pre></div><div class="refsection"><a name="idp56401408"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AddPoint" title="ST_AddPoint">ST_AddPoint</a>, <a class="xref" href="#ST_NPoints" title="ST_NPoints">ST_NPoints</a>, <a class="xref" href="#ST_NumPoints" title="ST_NumPoints">ST_NumPoints</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_RemoveRepeatedPoints"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_RemoveRepeatedPoints — 入力ジオメトリから重複ポイントを除いたものを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_RemoveRepeatedPoints</b>(</code>geometry <var class="pdparam">geom</var>, float8 <var class="pdparam">tolerance</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp56409088"></a><h2>説明</h2><p>入力ジオメトリから重複ポイントを除いたものを返します。実際には(MULTI)LINE, (MULTI)POLYGONとMULTIPOINTで動作します。あらゆる種類のジオメトリで安全に呼び出せます。簡略化がオブジェクトごとに行われるので、ジオメトリコレクションでこの関数を呼ぶことができます。</p><p>tolerance引数を与えると、他の頂点との距離が許容値内にある頂点は、削除の目的から、「同じ」と考えます。</p><p>Enhanced: 3.2.0</p><p>Availability: 2.2.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp56414208"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Simplify" title="ST_Simplify">ST_Simplify</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Reverse"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Reverse — 頂点の順序を逆にしたジオメトリを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Reverse</b>(</code>geometry  <var class="pdparam">g1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp56419968"></a><h2>説明</h2><p>どのジオメトリでも使用可能です。頂点の順序を逆にします。</p><p>Enhanced: 2.4.0 曲線対応が導入されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p></div><div class="refsection"><a name="idp56424320"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(geom) as line, ST_AsText(ST_Reverse(geom)) As reverseline
FROM
(SELECT ST_MakeLine(ST_Point(1,2),
                ST_Point(1,10)) As geom) as foo;
-- 結果
                line         |     reverseline
---------------------+----------------------
LINESTRING(1 2,1 10) | LINESTRING(1 10,1 2)
</pre></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Segmentize"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Segmentize — 与えた距離を超える線分を持たないよう変更したジオメトリ/ジオグラフィを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Segmentize</b>(</code>geometry  <var class="pdparam">geom</var>, float  <var class="pdparam">max_segment_length</var><code>)</code>;</p><p><code class="funcdef">geography <b class="fsfunc">ST_Segmentize</b>(</code>geography  <var class="pdparam">geog</var>, float  <var class="pdparam">max_segment_length</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp56454912"></a><h2>説明</h2><p><code class="varname">max_segment_length</code>より長い辺を持たないジオメトリ/ジオグラフィに編集して返します。距離計算は2次元のみで行います。ジオメトリの場合、距離の単位は空間参照系の単位です。ジオグラフィの場合、メートル単位となります。</p><p>Availability: 1.2.2</p><p>Enhanced: 3.0.0 ジオグラフィの分割において、現在は、同じ長さに分割しています。</p><p>Enhanced: 2.3.0 ジオグラフィの分割において、現在は、同じ長さに分割しています。</p><p>Enhanced: 2.1.0 ジオグラフィ対応が導入されました。</p><p>Changed: 2.1.0 ジオグラフィ対応導入の結果として、<code class="code">SELECT ST_Segmentize('LINESTRING(1 2, 3 4)',0.5);</code>では、あいまいな関数呼び出しエラーとなります。確実にタイプを指定したオブジェクトを持たせる必要があります。たとえば、ジオメトリ/ジオグラフィカラムであったり、ST_GeomFromText, ST_GeogFromTextを使ったり、<code class="code">SELECT ST_Segmentize('LINESTRING(1 2, 3 4)'::geometry,0.5);</code>としたりします。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数によって辺の数が増えるだけです。最大長より短い辺の長さを伸ばすことはしません。</p></td></tr></table></div></div><div class="refsection"><a name="idp56459520"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(ST_Segmentize(
ST_GeomFromText('MULTILINESTRING((-29 -27,-30 -29.7,-36 -31,-45 -33),(-45 -33,-46 -32))')
                ,5)
);
st_astext
--------------------------------------------------------------------------------------------------
MULTILINESTRING((-29 -27,-30 -29.7,-34.886615700134 -30.758766735029,-36 -31,
-40.8809353009198 -32.0846522890933,-45 -33),
(-45 -33,-46 -32))
(1 row)

SELECT ST_AsText(ST_Segmentize(ST_GeomFromText('POLYGON((-29 28, -30 40, -29 28))'),10));
st_astext
-----------------------
POLYGON((-29 28,-29.8304547985374 37.9654575824488,-30 40,-29.1695452014626 30.0345424175512,-29 28))
(1 row)

                        </pre></div><div class="refsection"><a name="idp56460800"></a><h2>関連情報</h2><p><a class="xref" href="#ST_LineSubstring" title="ST_LineSubstring">ST_LineSubstring</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_SetPoint"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SetPoint — ラインストリングのポイントを与えられたポイントに置き換えます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_SetPoint</b>(</code>geometry <var class="pdparam">linestring</var>, integer <var class="pdparam">zerobasedposition</var>, geometry <var class="pdparam">point</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp56493184"></a><h2>説明</h2><p>ラインストリングのN番目を与えられたポイントに置き換えます。インデクスは0はじまりです。負のインデックス値を与えると末尾から数えます。-1は末尾のポイントを指します。これは、頂点が一つ動いた時に接続のリレーションシップを維持しようとする場合のトリガに特に便利です。</p><p>Availability: 1.1.0</p><p>Updated 2.3.0 : 添え字の負数</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp56496512"></a><h2>例</h2><pre class="programlisting">-- 最初のポイントを -1 3 から -1 1 に変更
SELECT ST_AsText(ST_SetPoint('LINESTRING(-1 2,-1 3)', 0, 'POINT(-1 1)'));
           st_astext
-----------------------
 LINESTRING(-1 1,-1 3)

-- ラインストリングの最後のポイントを変更 (このクエリでは3次元ラインストリングでやってみましょう)
SELECT ST_AsEWKT(ST_SetPoint(foo.geom, ST_NumPoints(foo.geom) - 1, ST_GeomFromEWKT('POINT(-1 1 3)')))
FROM (SELECT ST_GeomFromEWKT('LINESTRING(-1 2 3,-1 3 4, 5 6 7)') As geom) As foo;
           st_asewkt
-----------------------
LINESTRING(-1 2 3,-1 3 4,-1 1 3)

SELECT ST_AsText(ST_SetPoint(g, -3, p))
FROM ST_GEomFromText('LINESTRING(0 0, 1 1, 2 2, 3 3, 4 4)') AS g
        , ST_PointN(g,1) as p;
           st_astext
-----------------------
LINESTRING(0 0,1 1,0 0,3 3,4 4)

                        </pre></div><div class="refsection"><a name="idp56497792"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AddPoint" title="ST_AddPoint">ST_AddPoint</a>, <a class="xref" href="#ST_NPoints" title="ST_NPoints">ST_NPoints</a>, <a class="xref" href="#ST_NumPoints" title="ST_NumPoints">ST_NumPoints</a>, <a class="xref" href="#ST_PointN" title="ST_PointN">ST_PointN</a>, <a class="xref" href="#ST_RemovePoint" title="ST_RemovePoint">ST_RemovePoint</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Shift_Longitude"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ShiftLongitude — 経度座標値を-180度から180度の範囲と0度から360度の範囲との二つの範囲を行き来するようシフトします。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_ShiftLongitude</b>(</code>geometry  <var class="pdparam">geom</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp56505088"></a><h2>説明</h2><p>ジオメトリの全てのポイント/頂点を読み、経度値が-180度から0度の範囲にあるのを180度から360度の範囲にシフトして、180度から360度の範囲にあるのを-180度から0度の範囲にシフトします。この関数は対称となりますので、-180度から180度の範囲のデータを0度から360度の範囲の表現にし、0度から360度の範囲のデータを-180度から180度の範囲の表現にします。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数は、SRID 436 (WGS84地理座標系)のような緯度経度の座標値を持つデータの場合に限って使います。</p></td></tr></table></div><div class="warning"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>1.3.4より前ではMULTIPOINTでは動作しないバグがありました。1.3.4以上ではMULTIPOINTでも動作します。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p>Enhanced: 2.0.0 多面体サーフェス対応とTIN対応が導入されました。</p><p>ご注意: この関数は2.0.0で"ST_Shift_Longitude"から名称変更しました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div><div class="refsection"><a name="idp56512512"></a><h2>例</h2><pre class="programlisting">-- 単一ポイントの前方への変換
SELECT ST_AsText(ST_ShiftLongitude('SRID=4326;POINT(270 0)'::geometry))

st_astext
----------
POINT(-90 0)


-- 単一ポイントの逆方向への変換
SELECT ST_AsText(ST_ShiftLongitude('SRID=4326;POINT(-90 0)'::geometry))

st_astext
----------
POINT(270 0)


-- ラインストリングでは十分な座標値にのみ影響を与えます
SELECT ST_AsText(ST_ShiftLongitude('SRID=4326;LINESTRING(174 12, 182 13)'::geometry))

st_astext
----------
LINESTRING(174 12,-178 13)
        </pre></div><div class="refsection"><a name="idp56514048"></a><h2>関連情報</h2><p>
      <a class="xref" href="#ST_WrapX" title="ST_WrapX">ST_WrapX</a>
    </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_WrapX"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_WrapX — ジオメトリをX値で回り込ませます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_WrapX</b>(</code>geometry  <var class="pdparam">geom</var>, float8  <var class="pdparam">wrap</var>, float8  <var class="pdparam">move</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp56522112"></a><h2>説明</h2><p>入力ジオメトリを分割して、全ての結果要素が「回り込み ('wrap')」線から’move'パラメータで決められた方向、すなわち、右側 ('move'が負数)または左側 ('move'が正数)に全ての要素が落ちるように移動させ、最後に再結合します。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>経度緯度入力を「再センタリング」して、対象地物が一方からもう一方に飛ばないようにするのに使えます。 </p></td></tr></table></div><p>Availability: 2.3.0 GEOSが必要です。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp56538112"></a><h2>例</h2><pre class="programlisting">-- 与えられたジオメトリのうち、
-- バウンディングボックスが完全にx=0の左側にあるもののについて
-- X値に360を足して移動させます。
select ST_WrapX(the_geom, 0, 360);

-- 与えられたジオメトリのうち、
-- バウンディングボックスが完全にx=-30の左側にあるもののについて
-- X値に360を足して移動させます。
select ST_WrapX(the_geom, -30, 360);
        </pre></div><div class="refsection"><a name="idp56539648"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Shift_Longitude" title="ST_ShiftLongitude">ST_ShiftLongitude</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_SnapToGrid"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SnapToGrid — 入力ジオメトリの全ての点を規則的なグリッドにスナップします。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_SnapToGrid</b>(</code>geometry  <var class="pdparam">geomA</var>, float  <var class="pdparam">originX</var>, float  <var class="pdparam">originY</var>, float  <var class="pdparam">sizeX</var>, float  <var class="pdparam">sizeY</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_SnapToGrid</b>(</code>geometry  <var class="pdparam">geomA</var>, float  <var class="pdparam">sizeX</var>, float  <var class="pdparam">sizeY</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_SnapToGrid</b>(</code>geometry  <var class="pdparam">geomA</var>, float  <var class="pdparam">size</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_SnapToGrid</b>(</code>geometry  <var class="pdparam">geomA</var>, geometry  <var class="pdparam">pointOrigin</var>, float  <var class="pdparam">sizeX</var>, float  <var class="pdparam">sizeY</var>, float  <var class="pdparam">sizeZ</var>, float  <var class="pdparam">sizeM</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp56564224"></a><h2>説明</h2><p>1, 2, 3番目の形式では、入力ジオメトリの全てのポイントを原点とセルサイズを定めたグリッドにスナップします。同じセルに落ちた、連続するポイントを削除します。引数ジオメトリのジオメトリタイプを定義できないポイントしか残らなかった場合は、NULLを返します。コレクション内で崩壊したジオメトリはそこから削除されます。精度を落とすのに使います。 </p><p>4番目の形式は、1.1.0で導入されました。入力ジオメトリの全てのポイントを原点 (第2引数で指定するもので、ポイントでなければなりません)とセルサイズを定めたグリッドにスナップします。グリッドにスナップしたくない次元についてはサイズに0を指定します。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>返されるジオメトリは単純性が失われているかも知れません (<a class="xref" href="#ST_IsSimple" title="ST_IsSimple">ST_IsSimple</a>を参照してください)。</p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>1.1.0版より前では、この関数は常に2次元ジオメトリを返しました。1.1.0版からは、返されるジオメトリの次元数は、入力値のうちで手のつけられていない最大の次元と同じになります。全てのグリッドの次元を定義するには、第2引数にジオメトリを取る形式を使って下さい。</p></td></tr></table></div><p>Availability: 1.0.0RC1</p><p>Availability: 1.1.0 - Z値とM値に対応しました</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp56569856"></a><h2>例</h2><pre class="programlisting">-- 10^-3の精度のグリッドにジオメトリをスナップ
UPDATE mytable
   SET geom = ST_SnapToGrid(geom, 0.001);

SELECT ST_AsText(ST_SnapToGrid(
                        ST_GeomFromText('LINESTRING(1.1115678 2.123, 4.111111 3.2374897, 4.11112 3.23748667)'),
                        0.001)
                );
                          st_astext
-------------------------------------
 LINESTRING(1.112 2.123,4.111 3.237)
 -- 4次元ジオメトリをスナップ
SELECT ST_AsEWKT(ST_SnapToGrid(
        ST_GeomFromEWKT('LINESTRING(-1.1115678 2.123 2.3456 1.11111,
                4.111111 3.2374897 3.1234 1.1111, -1.11111112 2.123 2.3456 1.1111112)'),
 ST_GeomFromEWKT('POINT(1.12 2.22 3.2 4.4444)'),
 0.1, 0.1, 0.1, 0.01) );
                                                                  st_asewkt
------------------------------------------------------------------------------
 LINESTRING(-1.08 2.12 2.3 1.1144,4.12 3.22 3.1 1.1144,-1.08 2.12 2.3 1.1144)


-- 4次元ジオメトリ - ST_SnapToGrid(geom,size)はX値とY値に触るだけで、M値とZ値はそのままです
SELECT ST_AsEWKT(ST_SnapToGrid(ST_GeomFromEWKT('LINESTRING(-1.1115678 2.123 3 2.3456,
                4.111111 3.2374897 3.1234 1.1111)'),
           0.01)      );
                                                st_asewkt
---------------------------------------------------------
 LINESTRING(-1.11 2.12 3 2.3456,4.11 3.24 3.1234 1.1111)

                </pre></div><div class="refsection"><a name="idp56571392"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Snap" title="ST_Snap">ST_Snap</a>, <a class="xref" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a>, <a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#ST_Simplify" title="ST_Simplify">ST_Simplify</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Snap"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Snap — 入力ジオメトリの辺と頂点を参照ジオメトリの頂点にスナップします。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Snap</b>(</code>geometry  <var class="pdparam">input</var>, geometry  <var class="pdparam">reference</var>, float  <var class="pdparam">tolerance</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp56581248"></a><h2>説明</h2><p>ジオメトリの頂点と辺を、もう一つのジオメトリの頂点にスナップします。スナップが実行される位置を制御するにはスナップ距離許容値を使います。結果ジオメトリはスナップされた頂点を持つ入力ジオメトリです。スナップが発生しなかった場合には、入力ジオメトリが変更されずに返されます。 </p><p>一つのジオメトリからもう一つへの変換によって、近傍エッジ (ノード生成とインタセクション計算で問題を引き起こします)を除くことになり、オーバレイ演算のロバスト性が改善されます。 </p><p>あまりに多数のスナップを行った場合には、生成されるトポロジが不正になる可能性があります。いつスナップが安全かを判定するために、ヒューリスティックにスナップされた頂点の数と位置が決めるしかありません。しかし、省略された潜在的なスナップになりえます。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>返されるジオメトリは単純性が失われているかも知れません (<a class="xref" href="#ST_IsSimple" title="ST_IsSimple">ST_IsSimple</a>を参照してください)し、妥当性が失われているかも知れません (<a class="xref" href="#">???</a>を参照して下さい)。 </p></td></tr></table></div><p>GEOSモジュールで実現しています。</p><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp56585472"></a><h2>例</h2><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col class="column1"><col class="column2"></colgroup><tbody><tr><td style="border-bottom: 1px solid ; " colspan="2" align="center"><div class="informalfigure"><div class="mediaobject"><img src="images/st_snap01.png"><div class="caption"><p>マルチポリゴンとラインストリング (スナップ前)</p></div></div></div>
					   </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><div class="informalfigure"><div class="mediaobject"><img src="images/st_snap02.png"><div class="caption"><p>ラインストリングに1.01の許容距離でマルチポリゴンをスナップします。新しいマルチポリゴンはラインストリングにつながります。</p></div></div></div><p>
				</p><pre class="programlisting">SELECT ST_AsText(ST_Snap(poly,line, ST_Distance(poly,line)*1.01)) AS polysnapped
FROM (SELECT
   ST_GeomFromText('MULTIPOLYGON(
     ((26 125, 26 200, 126 200, 126 125, 26 125 ),
      ( 51 150, 101 150, 76 175, 51 150 )),
      (( 151 100, 151 200, 176 175, 151 100 )))') As poly,
       ST_GeomFromText('LINESTRING (5 107, 54 84, 101 100)') As line
        ) As foo;

                             polysnapped
---------------------------------------------------------------------
 MULTIPOLYGON(((26 125,26 200,126 200,126 125,101 100,26 125),
 (51 150,101 150,76 175,51 150)),((151 100,151 200,176 175,151 100)))
                                </pre>
					</td><td style="border-bottom: 1px solid ; "><div class="informalfigure"><div class="mediaobject"><img src="images/st_snap04.png"><div class="caption"><p>マルチラインストリングに1.25の許容距離でマルチポリゴンをスナップします。新しいマルチポリゴンはラインストリングにつながります。</p></div></div></div><p>
				</p><pre class="programlisting">SELECT ST_AsText(
    ST_Snap(poly,line, ST_Distance(poly,line)*1.25)
  ) AS polysnapped
FROM (SELECT
  ST_GeomFromText('MULTIPOLYGON(
    (( 26 125, 26 200, 126 200, 126 125, 26 125 ),
      ( 51 150, 101 150, 76 175, 51 150 )),
      (( 151 100, 151 200, 176 175, 151 100 )))') As poly,
       ST_GeomFromText('LINESTRING (5 107, 54 84, 101 100)') As line
        ) As foo;

                             polysnapped
---------------------------------------------------------------------
MULTIPOLYGON(((5 107,26 200,126 200,126 125,101 100,54 84,5 107),
(51 150,101 150,76 175,51 150)),((151 100,151 200,176 175,151 100)))
                                </pre>
						</td></tr><tr><td style="border-right: 1px solid ; "><div class="informalfigure"><div class="mediaobject"><img src="images/st_snap03.png"><div class="caption"><p>元のマルチポリゴンに1.01の許容距離でラインストリングをスナップします。新しいラインストリングはマルチポリゴンにつながります。</p></div></div></div><p>
				</p><pre class="programlisting">SELECT ST_AsText(
   ST_Snap(line, poly, ST_Distance(poly,line)*1.01)
  ) AS linesnapped
FROM (SELECT
  ST_GeomFromText('MULTIPOLYGON(
     ((26 125, 26 200, 126 200, 126 125, 26 125),
      (51 150, 101 150, 76 175, 51 150 )),
      ((151 100, 151 200, 176 175, 151 100)))') As poly,
       ST_GeomFromText('LINESTRING (5 107, 54 84, 101 100)') As line
        ) As foo;

              linesnapped
----------------------------------------
 LINESTRING(5 107,26 125,54 84,101 100)
                                </pre><p>
						  </p>
					</td><td style=""><div class="informalfigure"><div class="mediaobject"><img src="images/st_snap05.png"><div class="caption"><p>元のマルチポリゴンに1.25の許容距離でラインストリングをスナップします。新しいラインストリングはマルチポリゴンにつながります。</p></div></div></div><p>
				</p><pre class="programlisting">SELECT ST_AsText(
 ST_Snap(line, poly, ST_Distance(poly,line)*1.25)
  ) AS linesnapped
FROM (SELECT
  ST_GeomFromText('MULTIPOLYGON(
     (( 26 125, 26 200, 126 200, 126 125, 26 125 ),
      (51 150, 101 150, 76 175, 51 150 )),
      ((151 100, 151 200, 176 175, 151 100 )))') As poly,
       ST_GeomFromText('LINESTRING (5 107, 54 84, 101 100)') As line
        ) As foo;
              linesnapped
---------------------------------------
LINESTRING(26 125,54 84,101 100)
                                </pre>
					</td></tr></tbody></table></div></div><div class="refsection"><a name="idp56605568"></a><h2>関連情報</h2><p>
		<a class="xref" href="#ST_SnapToGrid" title="ST_SnapToGrid">ST_SnapToGrid</a>
		</p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_SwapOrdinates"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SwapOrdinates — 与えられたジオメトリにおいて与えられた座標の値を入れ替えたジオメトリを返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_SwapOrdinates</b>(</code>geometry <var class="pdparam">geom</var>, cstring <var class="pdparam">ords</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp56616832"></a><h2>説明</h2><p>与えられたジオメトリにおいて与えられた座標の値を入れ替えたジオメトリを返します。 </p><p><code class="varname">ords</code>引数は2文字の文字列で、入れ替える座標名を示します。座標名はx, y, z, mが有効です。 </p><p>Availability: 2.2.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports M coordinates.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div><div class="refsection"><a name="idp56626048"></a><h2>例</h2><pre class="programlisting">
-- M値を2倍にする
-- (訳注: M値の拡大縮小はST_Scaleだけではできません)
SELECT ST_AsText(
  ST_SwapOrdinates(
    ST_Scale(
      ST_SwapOrdinates(g,'xm'),
      2, 1
    ),
  'xm')
) FROM ( SELECT 'POINT ZM (0 0 0 2)'::geometry g ) foo;
     st_astext
--------------------
 POINT ZM (0 0 0 4)
                 </pre></div><div class="refsection"><a name="idp56627584"></a><h2>関連情報</h2><p> <a class="xref" href="#ST_FlipCoordinates" title="ST_FlipCoordinates">ST_FlipCoordinates</a> </p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Geometry_Outputs"></a>8.7. ジオメトリ出力</h2></div><div><div class="abstract"><div class="abstract-title">概要</div><p>これらの関数は、ジオメトリオブジェクトを様々な文字列形式やバイナリ形式に変換するものです。</p></div></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="#idp57208576">8.7.1. Well-Known Text (WKT)</a></span></dt><dt><span class="sect2"><a href="#idp57301632">8.7.2. Well-Known Binary (WKB)</a></span></dt><dt><span class="sect2"><a href="#idp57392256">8.7.3. その他の書式</a></span></dt></dl></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idp57208576"></a>8.7.1. Well-Known Text (WKT)</h3></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#ST_AsEWKT">ST_AsEWKT</a></span><span class="refpurpose"> — ジオメトリのSRIDメタデータが付いたWell-Known Text (WKT)表現を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_AsText">ST_AsText</a></span><span class="refpurpose"> — ジオメトリ/ジオグラフィのSRIDメタデータのないWell-Known Text (WKT)表現を返します。</span></dt></dl></div><div class="refentry"><a name="ST_AsEWKT"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsEWKT — ジオメトリのSRIDメタデータが付いたWell-Known Text (WKT)表現を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_AsEWKT</b>(</code>geometry  <var class="pdparam">g1</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">ST_AsEWKT</b>(</code>geometry  <var class="pdparam">g1</var>, integer  <var class="pdparam">maxdecimaldigits=15</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">ST_AsEWKT</b>(</code>geography  <var class="pdparam">g1</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">ST_AsEWKT</b>(</code>geography  <var class="pdparam">g1</var>, integer  <var class="pdparam">maxdecimaldigits=15</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp57238784"></a><h2>説明</h2><p>SRIDを前に置いたジオメトリのWell-Known Text表現を返します。任意引数<em class="parameter"><code>maxdecimaldigits</code></em>で、出力で使用される小数点以下の最大桁数を減らすことができます (デフォルトは15です)。</p><p>EWKT表現をPostGISジオメトリに逆変換するには<a class="xref" href="#">???</a>を使用します。</p><div class="warning"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>任意引数<em class="parameter"><code>maxdecimaldigits</code></em>を使用することで、出力ジオメトリが不正になる可能性があります。これを回避するには、前もって<a class="xref" href="#ST_ReducePrecision" title="ST_ReducePrecision">ST_ReducePrecision</a>に適切なグリッドサイズを与えてこれを使用します。 </p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>WKT仕様はSRIDを含みません。OGC WKT書式を得るには<a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a>を使用します。</p></td></tr></table></div><div class="warning"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>WKT書式は精度を維持しないので、切り捨てを防ぐには、データ転送に<a class="xref" href="#ST_AsBinary" title="ST_AsBinary">ST_AsBinary</a>または<a class="xref" href="#ST_AsEWKB" title="ST_AsEWKB">ST_AsEWKB</a>を使用します。</p></td></tr></table></div><p>Enhanced: 3.1.0 精度パラメータ (任意)に対応しました</p><p>Enhanced: 2.0.0 ジオグラフィ対応、多面体サーフェス対応、三角形対応、TIN対応が導入されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div><div class="refsection"><a name="idp57251968"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsEWKT('0103000020E61000000100000005000000000000
                        000000000000000000000000000000000000000000000000000000
                        F03F000000000000F03F000000000000F03F000000000000F03
                        F000000000000000000000000000000000000000000000000'::geometry);

                   st_asewkt
--------------------------------
SRID=4326;POLYGON((0 0,0 1,1 1,1 0,0 0))
(1 row)

SELECT ST_AsEWKT('0108000080030000000000000060E30A4100000000785C0241000000000000F03F0000000018
E20A4100000000485F024100000000000000400000000018
E20A4100000000305C02410000000000000840')

--st_asewkt---
CIRCULARSTRING(220268 150415 1,220227 150505 2,220227 150406 3)
</pre></div><div class="refsection"><a name="idp57265792"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsBinary" title="ST_AsBinary">ST_AsBinary</a>, <a class="xref" href="#ST_AsEWKB" title="ST_AsEWKB">ST_AsEWKB</a>, <a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a>, <a class="xref" href="#">???</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_AsText"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsText — ジオメトリ/ジオグラフィのSRIDメタデータのないWell-Known Text (WKT)表現を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_AsText</b>(</code>geometry  <var class="pdparam">g1</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">ST_AsText</b>(</code>geometry  <var class="pdparam">g1</var>, integer  <var class="pdparam">maxdecimaldigits = 15</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">ST_AsText</b>(</code>geography  <var class="pdparam">g1</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">ST_AsText</b>(</code>geography  <var class="pdparam">g1</var>, integer  <var class="pdparam">maxdecimaldigits = 15</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp57281536"></a><h2>説明</h2><p>ジオメトリ/ジオグラフィの<a class="link" href="#OpenGISWKBWKT" title="4.1.3. WKTとWKB">Well-Known Text</a> (WKT)表現を返します。任意引数<em class="parameter"><code>maxdecimaldigits</code></em>は、出力で使われる小数点以下の最大桁数を制限するのに使います (デフォルトは15)。</p><p>ＷKT表現をPostGISジオメトリに逆変換するには<a class="xref" href="#">???</a>を使います。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>標準のOGC WKT表現はSRIDを含みません。出力表現にSRIDを持たせるには、非標準のPostGIS関数<a class="xref" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a>を使います。</p></td></tr></table></div><div class="warning"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>WKTにおける数字の文字表現では、完全な浮動小数点数の精度を維持しないことがあります。データ保存や転送で完全な精度を得るには<a class="link" href="#OpenGISWKBWKT" title="4.1.3. WKTとWKB">Well-Known Binary</a> (WKB)書式を使用するのが最善です (<a class="xref" href="#ST_AsBinary" title="ST_AsBinary">ST_AsBinary</a>および<em class="parameter"><code>maxdecimaldigits</code></em>をご覧下さい)。</p></td></tr></table></div><div class="warning"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>任意引数<em class="parameter"><code>maxdecimaldigits</code></em>を使用することで、出力ジオメトリが不正になる可能性があります。これを回避するには、前もって<a class="xref" href="#ST_ReducePrecision" title="ST_ReducePrecision">ST_ReducePrecision</a>に適切なグリッドサイズを与えてこれを使用します。 </p></td></tr></table></div><p>Availability: 1.5 - ジオグラフィ対応が導入されました。</p><p>Enhanced: 2.5 - 精度の任意引数が導入されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OGC Simple Features
 Implementation Specification for SQL 1.1.</a> s2.1.1.1</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 5.1.25</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p></div><div class="refsection"><a name="idp57294720"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText('01030000000100000005000000000000000000
000000000000000000000000000000000000000000000000
F03F000000000000F03F000000000000F03F000000000000F03
F000000000000000000000000000000000000000000000000');

    st_astext
--------------------------------
 POLYGON((0 0,0 1,1 1,1 0,0 0))
</pre><p>完全な出力制度がデフォルトです。</p><pre class="programlisting">SELECT ST_AsText('POINT(111.1111111 1.1111111)'));
    st_astext
------------------------------
 POINT(111.1111111 1.1111111)
</pre><p>引数<em class="parameter"><code>maxdecimaldigits</code></em>は、出力精度の制限に使います。</p><pre class="programlisting">SELECT ST_AsText('POINT(111.1111111 1.1111111)'), 2);
    st_astext
--------------------
 POINT(111.11 1.11)
</pre></div><div class="refsection"><a name="idp57298688"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsBinary" title="ST_AsBinary">ST_AsBinary</a>, <a class="xref" href="#ST_AsEWKB" title="ST_AsEWKB">ST_AsEWKB</a>, <a class="xref" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a>, <a class="xref" href="#">???</a></p></div></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idp57301632"></a>8.7.2. Well-Known Binary (WKB)</h3></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#ST_AsBinary">ST_AsBinary</a></span><span class="refpurpose"> — ジオメトリ/ジオグラフィの、SRIDメタデータを持たないOGC/ISO Well-Knownバイナリ (WKB)表現を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_AsEWKB">ST_AsEWKB</a></span><span class="refpurpose"> — ジオメトリの、SRIDメタデータを持つExtended Well-Knownバイナリ (EWKB)表現を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_AsHEXEWKB">ST_AsHEXEWKB</a></span><span class="refpurpose"> — ジオメトリのHEXEWKB表現を (文字列として)返します。リトルエンディアン (NDR)またはビッグエンディアン (XDR)のどちらかのエンコーディングを使います。</span></dt></dl></div><div class="refentry"><a name="ST_AsBinary"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsBinary — ジオメトリ/ジオグラフィの、SRIDメタデータを持たないOGC/ISO Well-Knownバイナリ (WKB)表現を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">bytea <b class="fsfunc">ST_AsBinary</b>(</code>geometry  <var class="pdparam">g1</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsBinary</b>(</code>geometry  <var class="pdparam">g1</var>, text <var class="pdparam">NDR_or_XDR</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsBinary</b>(</code>geography  <var class="pdparam">g1</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsBinary</b>(</code>geography  <var class="pdparam">g1</var>, text <var class="pdparam">NDR_or_XDR</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp57314944"></a><h2>説明</h2><p>ジオメトリのOGC/ISO<a class="link" href="#OpenGISWKBWKT" title="4.1.3. WKTとWKB">Well-Knownバイナリ</a> (WKB)表現を返します。最初の形式では、サーバ機のエンディアンをデフォルトとして使います。二つ目の形式では、リトルエンディアン ('NDR')またはビッグエンディアン ('XDR')を指定する文字列を取ります。</p><p>WKB書式は、ジオメトリデータをデータベースから、完全な数値精度を維持して読み取るために使われます。これにより、WKT等のテキスト書式で発生する丸め誤差を回避できます。</p><p>ＷKB表現をPostGISジオメトリに逆変換するには<a class="xref" href="#">???</a>を使います。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>OGC/ISO WKB書式はSRIDを持ちません。SRIDを含むEWKB書式を得るには<a class="xref" href="#ST_AsEWKB" title="ST_AsEWKB">ST_AsEWKB</a>を使います。</p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>PostgreSQL 9.0でのデフォルトの振る舞いが変更され、出力がbytea型の16進数エンコーディングなりました。GUIツールで古い振る舞いが必要な場合には、データベース内で SET bytea_output='escape' を実行します。</p></td></tr></table></div><p>Enhanced: 2.0.0 多面体サーフェス対応、三角対応、TIN対応が導入されました。</p><p>Enhanced: 2.0.0 高次元が導入されました。</p><p>Enhanced: 2.0.0 ジオグラフィでのエンディアン指定が導入されました。</p><p>Availability: 1.5.0 ジオグラフィが導入されました。</p><p>Changed: 2.0.0 この関数への入力は不明な型にすることができなくなり、必ずジオメトリでなければなりません。<code class="code">ST_AsBinary('POINT(1 2)')</code>といった構築ではもはや妥当ではなく、<code class="code">n st_asbinary(unknown) is not unique error</code>が得られます。このようなコードは<code class="code">ST_AsBinary('POINT(1 2)'::geometry);</code>に変更する必要があります。これが不可能な場合には<code class="filename">legacy.sql</code>をインストールして下さい。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OGC Simple Features
 Implementation Specification for SQL 1.1.</a> s2.1.1.1</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 5.1.37</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp57331712"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsBinary(ST_GeomFromText('POLYGON((0 0,0 1,1 1,1 0,0 0))',4326));

                   st_asbinary
--------------------------------
\x01030000000100000005000000000000000000000000000000000000000000000000000000000000
000000f03f000000000000f03f000000000000f03f000000000000f03f0000000000000000000000
00000000000000000000000000
</pre><pre class="programlisting">SELECT ST_AsBinary(ST_GeomFromText('POLYGON((0 0,0 1,1 1,1 0,0 0))',4326), 'XDR');
                   st_asbinary
--------------------------------
\x000000000300000001000000050000000000000000000000000000000000000000000000003ff000
00000000003ff00000000000003ff00000000000003ff00000000000000000000000000000000000
00000000000000000000000000
</pre></div><div class="refsection"><a name="idp57333760"></a><h2>関連情報</h2><p><a class="xref" href="#">???</a>, <a class="xref" href="#ST_AsEWKB" title="ST_AsEWKB">ST_AsEWKB</a>, <a class="xref" href="#ST_AsTWKB" title="ST_AsTWKB">ST_AsTWKB</a>, <a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a>, </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_AsEWKB"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsEWKB — ジオメトリの、SRIDメタデータを持つExtended Well-Knownバイナリ (EWKB)表現を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">bytea <b class="fsfunc">ST_AsEWKB</b>(</code>geometry  <var class="pdparam">g1</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsEWKB</b>(</code>geometry  <var class="pdparam">g1</var>, text <var class="pdparam">NDR_or_XDR</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp57343872"></a><h2>説明</h2><p>ジオメトリの、SRIDメタデータを持つ<a class="link" href="#EWKB_EWKT" title="4.2.1. PostGIS EWKBとEWKT">Extended Well-Knownバイナリ</a> (EWKB)表現を返します。最初の形式では、サーバ機のエンディアンをデフォルトとして使います。二つ目の形式では、リトルエンディアン ('NDR')またはビッグエンディアン ('XDR')を指定する文字列を取ります。</p><p>WKB書式は、ジオメトリデータをデータベースから、完全な数値精度を維持して読み取るために使われます。これにより、WKT等のテキスト書式で発生する丸め誤差を回避できます。</p><p>EＷKB表現をPostGISジオメトリに逆変換するには<a class="xref" href="#">???</a>を使います。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>OGC/ISO WKB書式を得るには<a class="xref" href="#ST_AsBinary" title="ST_AsBinary">ST_AsBinary</a>を使います。OGC/ISO WKB書式はSRIDを持たないことに注意して下さい。 </p></td></tr></table></div><p>Enhanced: 2.0.0 多面体サーフェス対応、三角対応、TIN対応が導入されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div><div class="refsection"><a name="idp57374208"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsEWKB(ST_GeomFromText('POLYGON((0 0,0 1,1 1,1 0,0 0))',4326));

                   st_asewkb
--------------------------------
\x0103000020e610000001000000050000000000000000000000000000000000000000000000000000
00000000000000f03f000000000000f03f000000000000f03f000000000000f03f00000000000000
0000000000000000000000000000000000
</pre><pre class="programlisting">SELECT ST_AsEWKB(ST_GeomFromText('POLYGON((0 0,0 1,1 1,1 0,0 0))',4326), 'XDR');
                   st_asewkb
--------------------------------
\x0020000003000010e600000001000000050000000000000000000000000000000000000000000000
003ff00000000000003ff00000000000003ff00000000000003ff000000000000000000000000000
0000000000000000000000000000000000
                </pre></div><div class="refsection"><a name="idp57376256"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsBinary" title="ST_AsBinary">ST_AsBinary</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#">???</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_AsHEXEWKB"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsHEXEWKB — ジオメトリのHEXEWKB表現を (文字列として)返します。リトルエンディアン (NDR)またはビッグエンディアン (XDR)のどちらかのエンコーディングを使います。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_AsHEXEWKB</b>(</code>geometry  <var class="pdparam">g1</var>, text  <var class="pdparam">NDRorXDR</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">ST_AsHEXEWKB</b>(</code>geometry  <var class="pdparam">g1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp57385984"></a><h2>説明</h2><p>ジオメトリのHEXEWKB表現を (文字列として)返します。リトルエンディアン (NDR)またはビッグエンディアン (XDR)のどちらかのエンコーディングを使います。エンコーディングを指定しない場合はNDRを使います。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Availability: 1.2.2</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p></div><div class="refsection"><a name="idp57390464"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsHEXEWKB(ST_GeomFromText('POLYGON((0 0,0 1,1 1,1 0,0 0))',4326));
                which gives same answer as

                SELECT ST_GeomFromText('POLYGON((0 0,0 1,1 1,1 0,0 0))',4326)::text;

                st_ashexewkb
                --------
                0103000020E6100000010000000500
                00000000000000000000000000000000
                00000000000000000000000000000000F03F
                000000000000F03F000000000000F03F000000000000F03
                F000000000000000000000000000000000000000000000000</pre></div></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idp57392256"></a>8.7.3. その他の書式</h3></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#ST_AsEncodedPolyline">ST_AsEncodedPolyline</a></span><span class="refpurpose"> — ラインストリングジオメトリから符号化したポリラインを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_AsFlatGeobuf">ST_AsFlatGeobuf</a></span><span class="refpurpose"> — 行の集合のFlatGeobuf表現を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_AsGeobuf">ST_AsGeobuf</a></span><span class="refpurpose"> — 行集合のGeobuf表現を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_AsGeoJSON">ST_AsGeoJSON</a></span><span class="refpurpose"> — ジオメトリをGeoJSON要素として返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_AsGML">ST_AsGML</a></span><span class="refpurpose"> — GML第2版または第3版としてジオメトリを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_AsKML">ST_AsKML</a></span><span class="refpurpose"> — KML要素としてジオメトリを返します。いくつかの形式があります。デフォルトはversion=2, maxdecimaldigits=15です。</span></dt><dt><span class="refentrytitle"><a href="#ST_AsLatLonText">ST_AsLatLonText</a></span><span class="refpurpose"> — 与えられたポイントの度・分・秒表現を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_AsMVTGeom">ST_AsMVTGeom</a></span><span class="refpurpose"> — ジオメトリをMapbox Vector Tileの座標空間に変換します。</span></dt><dt><span class="refentrytitle"><a href="#ST_AsMVT">ST_AsMVT</a></span><span class="refpurpose"> — 行集合のMapbox Vector Tile表現を返す集約関数です。</span></dt><dt><span class="refentrytitle"><a href="#ST_AsSVG">ST_AsSVG</a></span><span class="refpurpose"> — ジオメトリからSVGパスデータを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_AsTWKB">ST_AsTWKB</a></span><span class="refpurpose"> — TWKB (Tiny Well-Known Binary)としてジオメトリを出力します。</span></dt><dt><span class="refentrytitle"><a href="#ST_AsX3D">ST_AsX3D</a></span><span class="refpurpose"> — ジオメトリをX3Dノード要素書式　(ISO-IEC-19776-1.2-X3DEncodings-XML)で返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_GeoHash">ST_GeoHash</a></span><span class="refpurpose"> — ジオメトリのGeoHash表現を返します。</span></dt></dl></div><div class="refentry"><a name="ST_AsEncodedPolyline"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsEncodedPolyline — ラインストリングジオメトリから符号化したポリラインを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_AsEncodedPolyline</b>(</code>geometry <var class="pdparam">geom</var>, integer  <var class="pdparam">precision=5</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp57398400"></a><h2>説明</h2><p>符号化したポリラインを返します。この書式はGoogle Mapsではprecision=5で、Open Source Routing Machineでは precision=5と6を使います。</p><p>任意パラメータ<code class="varname">precision</code>は、ポリライン符号化の際の桁数を決定するものです。符号化と復号とで同じ値であるべきで、異なる場合には座標が正しくなりません。</p><p>Availability: 2.2.0</p></div><div class="refsection"><a name="idp57400704"></a><h2>例</h2><p>基本 </p><pre class="programlisting">SELECT ST_AsEncodedPolyline(GeomFromEWKT('SRID=4326;LINESTRING(-120.2 38.5,-120.95 40.7,-126.453 43.252)'));
        --結果--
        |_p~iF~ps|U_ulLnnqC_mqNvxq`@
        </pre><p>ジオグラフィ型のラインストリングとジオグラフィ型のセグメント化したラインストリングを結合してGoogle Mapsに置きます。</p><pre class="programlisting">-- ボストンからサンフランシスコまでの線を100kmでセグメント化するSQL
        SELECT ST_AsEncodedPolyline(
                ST_Segmentize(
                        ST_GeogFromText('LINESTRING(-71.0519 42.4935,-122.4483 37.64)'),
                                100000)::geometry) As encodedFlightPath;</pre><p>JavaScriptコードは、クエリの結果を$変数と置き換えると次のようになります。</p><pre class="programlisting">&lt;script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?libraries=geometry"
&gt;&lt;/script&gt;
&lt;script type="text/javascript"&gt;
         flightPath = new google.maps.Polyline({
                        path:  google.maps.geometry.encoding.decodePath("$encodedFlightPath"),
                        map: map,
                        strokeColor: '#0000CC',
                        strokeOpacity: 1.0,
                        strokeWeight: 4
                });
&lt;/script&gt;
        </pre></div><div class="refsection"><a name="idp57404416"></a><h2>関連情報</h2><p><a class="xref" href="#">???</a>, <a class="xref" href="#ST_Segmentize" title="ST_Segmentize">ST_Segmentize</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_AsFlatGeobuf"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsFlatGeobuf — 行の集合のFlatGeobuf表現を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">bytea <b class="fsfunc">ST_AsFlatGeobuf</b>(</code>anyelement set  <var class="pdparam">row</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsFlatGeobuf</b>(</code>anyelement  <var class="pdparam">row</var>, bool  <var class="pdparam">index</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsFlatGeobuf</b>(</code>anyelement  <var class="pdparam">row</var>, bool  <var class="pdparam">index</var>, text  <var class="pdparam">geom_name</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp57417984"></a><h2>説明</h2><p>FeatureCollectionに対応する行の集合のFlatGeobuf表現 (<a class="ulink" href="http://flatgeobuf.org" target="_top">http://flatgeobuf.org</a>) を返します。ご注意: PostgreSQLのbytea型は1GBを超えられません。 </p><p><code class="varname">row</code> 少なくとも一つのジオメトリカラムを持つ行データ</p><p><code class="varname">index</code> 空間インデックスの生成の切り替え。デフォルトはFALSEです。</p><p><code class="varname">geom_name</code> 行データにおけるジオメトリカラムのカラム名。NULLの場合には、最初に見つけたジオメトリカラムとします。</p><p>Availability: 3.2.0</p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_AsGeobuf"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsGeobuf — 行集合のGeobuf表現を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">bytea <b class="fsfunc">ST_AsGeobuf</b>(</code>anyelement set  <var class="pdparam">row</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsGeobuf</b>(</code>anyelement  <var class="pdparam">row</var>, text  <var class="pdparam">geom_name</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp57429632"></a><h2>説明</h2><p>FeatureCollectionに対応する行集合のGeobuf表現 (<a class="ulink" href="https://github.com/mapbox/geobuf" target="_top">https://github.com/mapbox/geobuf</a>)を返します。最適な格納のために最大精度を決定しますが、そのために全ての入力ジオメトリは解析されます。現在の形式でのGeobufはストリーム化できないので、完全な出力はメモリ内で組み立てられることに注意して下さい。 </p><p><code class="varname">row</code> 少なくとも一つのジオメトリカラムを持つ行データ</p><p><code class="varname">geom_name</code> 行データにおけるジオメトリカラムのカラム名。NULLの場合には、最初に見つけたジオメトリカラムとします。</p><p>Availability: 2.4.0</p></div><div class="refsection"><a name="idp57433088"></a><h2>例</h2><pre class="programlisting">SELECT encode(ST_AsGeobuf(q, 'geom'), 'base64')
    FROM (SELECT ST_GeomFromText('POLYGON((0 0,0 1,1 1,1 0,0 0))') AS geom) AS q;
 st_asgeobuf
----------------------------------
 GAAiEAoOCgwIBBoIAAAAAgIAAAE=

                
                </pre></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_AsGeoJSON"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsGeoJSON — ジオメトリをGeoJSON要素として返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_AsGeoJSON</b>(</code>record  <var class="pdparam">feature</var>, text  <var class="pdparam">geomcolumnname</var>, integer  <var class="pdparam">maxdecimaldigits=9</var>, boolean  <var class="pdparam">pretty_bool=false</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">ST_AsGeoJSON</b>(</code>geometry  <var class="pdparam">geom</var>, integer  <var class="pdparam">maxdecimaldigits=9</var>, integer  <var class="pdparam">options=8</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">ST_AsGeoJSON</b>(</code>geography  <var class="pdparam">geog</var>, integer  <var class="pdparam">maxdecimaldigits=9</var>, integer  <var class="pdparam">options=0</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp56193792"></a><h2>説明</h2><p>ジオメトリをGeoJSONのgeometryとして返すか、行をGeoJSONのfeatureとして返します (<a class="ulink" href="https://tools.ietf.org/html/rfc7946" target="_top">GeoJSON specifications RFC 7946</a>をご覧下さい)。2次元と3次元の両方のジオメトリに対応します。GeoJSONはSFS 1.1のジオメトリタイプにのみ対応します (たとえば曲線には対応していません)。</p><p><code class="varname">maxdecimaldigits</code>引数は、出力で使用される小数部の桁数の最大値を減らすために使われます (デフォルトでは9)。EPSG:4326を使っていて、表示専用でジオメトリを出力する場合には、<code class="varname">maxdecimaldigits</code>=6が、多くの地図で良い選択となります。</p><div class="warning"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>任意引数<em class="parameter"><code>maxdecimaldigits</code></em>を使用することで、出力ジオメトリが不正になる可能性があります。これを回避するには、前もって<a class="xref" href="#ST_ReducePrecision" title="ST_ReducePrecision">ST_ReducePrecision</a>に適切なグリッドサイズを与えてこれを使用します。 </p></td></tr></table></div><p><code class="varname">options</code>引数は、GeoJSON出力でBBOXまたはCRSを追加するために使われます。次のようにします。 </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>0: オプションなし</p></li><li class="listitem"><p>1: GeoJSON BBOX</p></li><li class="listitem"><p>2: GeoJSON Short CRS (たとえば EPSG:4326)</p></li><li class="listitem"><p>4: GeoJSON Long CRS (たとえば urn:ogc:def:crs:EPSG:4326)</p></li><li class="listitem"><p>8: EPSG:4326でない場合にGeoJSON Short CRS (デフォルト)</p></li></ul></div><p>
			</p><p>GeoJSON仕様では、ポリゴンは右手規則を使い、この方向を求めるクライアントがあります。これは<a class="xref" href="#ST_ForcePolygonCCW" title="ST_ForcePolygonCCW">ST_ForcePolygonCCW </a>を使用して確実に対応します。仕様はまたジオメトリの座標系としてWGS84 (SRID=4326)が求められます。必要なら<a class="xref" href="#">???</a>を<code class="code">ST_Transform( geom, 4326 )</code>のように使って、ジオメトリをWGS84に座標変換します。 </p><p>GeoJSONは<a class="ulink" href="http://geojson.io/" target="_top">geojson.io</a>と <a class="ulink" href="http://geojson.io/" target="_top">geojsonlint.com</a>で、オンラインでのテストと表示が可能です。また、Webマッピングフレームワークで広く対応されています。 </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="ulink" href="https://openlayers.org/en/latest/examples/geojson.html" target="_top">OpenLayers GeoJSONの例</a></p></li><li class="listitem"><p><a class="ulink" href="https://leafletjs.com/examples/geojson/" target="_top">Leaflet GeoJSONの例</a></p></li><li class="listitem"><p><a class="ulink" href="https://www.mapbox.com/mapbox-gl-js/example/multiple-geometries/" target="_top">Mapbox GL GeoJSONの例</a></p></li></ul></div><p>
            </p><p>Availability: 1.3.4</p><p>Availability: 1.5.0 ジオグラフィが導入されました。</p><p>Changed: 2.0.0 デフォルト引数と名前付き引数に対応しました。</p><p>Changed: 3.0.0 レコードの入力に対応しました</p><p>Changed: 3.0.0 EPSG:4326以外の場合のSRID出力</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp57457664"></a><h2>例</h2><p>FeatureCollectionの生成:</p><pre class="programlisting">SELECT json_build_object(
    'type', 'FeatureCollection',
    'features', json_agg(ST_AsGeoJSON(t.*)::json)
    )
FROM ( VALUES (1, 'one', 'POINT(1 1)'::geometry),
              (2, 'two', 'POINT(2 2)'),
              (3, 'three', 'POINT(3 3)')
     ) as t(id, name, geom);</pre><pre class="screen">{"type" : "FeatureCollection", "features" : [{"type": "Feature", "geometry": {"type":"Point","coordinates":[1,1]}, "properties": {"id": 1, "name": "one"}}, {"type": "Feature", "geometry": {"type":"Point","coordinates":[2,2]}, "properties": {"id": 2, "name": "two"}}, {"type": "Feature", "geometry": {"type":"Point","coordinates":[3,3]}, "properties": {"id": 3, "name": "three"}}]}</pre><p>Featureの生成:</p><pre class="programlisting">SELECT ST_AsGeoJSON(t.*)
FROM (VALUES (1, 'one', 'POINT(1 1)'::geometry)) AS t(id, name, geom);</pre><pre class="screen">st_asgeojson
-----------------------------------------------------------------------------------------------------------------
 {"type": "Feature", "geometry": {"type":"Point","coordinates":[1,1]}, "properties": {"id": 1, "name": "one"}}
</pre><p><code class="varname">id</code>プロパティを持つFeatureを生成する別の方法には、JSONB関数と演算子の使用があります。</p><pre class="programlisting">SELECT jsonb_build_object(
    'type',       'Feature',
    'id',         id,
    'geometry',   ST_AsGeoJSON(geom)::jsonb,
    'properties', to_jsonb( t.* ) - 'id' - 'geom'
    ) AS json
FROM (VALUES (1, 'one', 'POINT(1 1)'::geometry)) AS t(id, name, geom);</pre><pre class="screen">json
-----------------------------------------------------------------------------------------------------------------
 {"id": 1, "type": "Feature", "geometry": {"type": "Point", "coordinates": [1, 1]}, "properties": {"name": "one"}}
</pre><p>データをGeoJSON使用に準拠したWGS84経度緯度に変換するのを忘れないで下さい。</p><pre class="programlisting">SELECT ST_AsGeoJSON(ST_Transform(geom,4326)) from fe_edges limit 1;</pre><pre class="screen">st_asgeojson
-----------------------------------------------------------------------------------------------------------

{"type":"MultiLineString","coordinates":[[[-89.734634999999997,31.492072000000000],
[-89.734955999999997,31.492237999999997]]]}
</pre><p>3次元ジオメトリへの対応:</p><pre class="programlisting">SELECT ST_AsGeoJSON('LINESTRING(1 2 3, 4 5 6)');</pre><pre class="screen">{"type":"LineString","coordinates":[[1,2,3],[4,5,6]]}</pre></div><div class="refsection"><a name="idp57469952"></a><h2>関連情報</h2><p><a class="xref" href="#">???</a>, <a class="xref" href="#ST_ForcePolygonCCW" title="ST_ForcePolygonCCW">ST_ForcePolygonCCW </a>, <a class="xref" href="#">???</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_AsGML"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsGML — GML第2版または第3版としてジオメトリを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_AsGML</b>(</code>geometry  <var class="pdparam">geom</var>, integer  <var class="pdparam">maxdecimaldigits=15</var>, integer  <var class="pdparam">options=0</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">ST_AsGML</b>(</code>geography  <var class="pdparam">geog</var>, integer  <var class="pdparam">maxdecimaldigits=15</var>, integer  <var class="pdparam">options=0</var>, text  <var class="pdparam">nprefix=null</var>, text  <var class="pdparam">id=null</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">ST_AsGML</b>(</code>integer  <var class="pdparam">version</var>, geometry  <var class="pdparam">geom</var>, integer  <var class="pdparam">maxdecimaldigits=15</var>, integer  <var class="pdparam">options=0</var>, text  <var class="pdparam">nprefix=null</var>, text  <var class="pdparam">id=null</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">ST_AsGML</b>(</code>integer  <var class="pdparam">version</var>, geography  <var class="pdparam">geog</var>, integer  <var class="pdparam">maxdecimaldigits=15</var>, integer  <var class="pdparam">options=0</var>, text  <var class="pdparam">nprefix=null</var>, text  <var class="pdparam">id=null</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp57513600"></a><h2>説明</h2><p>Geography Markup Language (GML)要素としてジオメトリを返します。versionパラメータは、指定する場合には2か3になります。versionパラメータが無い場合には、デフォルトは2です。</p><div class="warning"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>任意引数<em class="parameter"><code>maxdecimaldigits</code></em>を使用することで、出力ジオメトリが不正になる可能性があります。これを回避するには、前もって<a class="xref" href="#ST_ReducePrecision" title="ST_ReducePrecision">ST_ReducePrecision</a>に適切なグリッドサイズを与えてこれを使用します。 </p></td></tr></table></div><p>GML2では2.1.2版を参照し、GML3では3.1.1を参照します。</p><p>最後の'options'引数はビットフィールドです。GML出力のCRS出力型を定義するために、また緯度/経度でデータを宣言するために使います。 </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>0: GML Short CRS (たとえば EPSG:4326)、デフォルト値</p></li><li class="listitem"><p>1: GML Long CRS (たとえば urn:ogc:def:crs:EPSG:4326)</p></li><li class="listitem"><p>2: GML 3のみ対応。srsDimension属性を出力から削除します。</p></li><li class="listitem"><p>4: GML 3のみ対応。線について&lt;Curve&gt;でなく&lt;LineString&gt;要素を使います。</p></li><li class="listitem"><p>16: データは緯度/経度 (すなわち SRID=4326)です。デフォルトではデータは平面上にあると仮定します。このオプションはGML 3.1.1による出力でのみ使われ、軸のオーダに関連します。これを設定すると、座標の順序を入れ替えるので、データベースの経度/緯度の順でなく緯度/経度の順になります。</p></li><li class="listitem"><p>32: ジオメトリのボックス (エンベロープ)を出力します。</p></li></ul></div><p>
						</p><p>'namespace prefix'引数は、カスタム名前空間のプリフィクスを指定したり、名前空間プリフィクスを指定しない (空にした場合)ために使用します。NULLを指定するか省略した場合には、'gml'プレフィクスを使用します。</p><p>Availability: 1.3.2</p><p>Availability: 1.5.0 ジオグラフィが導入されました。</p><p>Enhanced: 2.0.0 プレフィクスが導入されました。 GML 3用であるoptionsの4は、曲線のかわりにラインストリングを使えるようにするためのものです。GML 3の多面体サーフェスとTINが導入されました。optionsの32はボックスを出力するために導入されました。</p><p>Changed: 2.0.0 デフォルトの名前付き引数を使います。</p><p>Enhanced: 2.1.0 GML 3用にidが導入されました。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_AsGMLのGML 3版以上では多面体サーフェスとTINに対応しています。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div><div class="refsection"><a name="idp57529600"></a><h2>例: 2版</h2><pre class="programlisting">SELECT ST_AsGML(ST_GeomFromText('POLYGON((0 0,0 1,1 1,1 0,0 0))',4326));
                st_asgml
                --------
                &lt;gml:Polygon srsName="EPSG:4326"
&gt;&lt;gml:outerBoundaryIs
&gt;&lt;gml:LinearRing
&gt;&lt;gml:coordinates
&gt;0,0 0,1 1,1 1,0 0,0&lt;/gml:coordinates
&gt;&lt;/gml:LinearRing
&gt;&lt;/gml:outerBoundaryIs
&gt;&lt;/gml:Polygon
&gt;
                        </pre></div><div class="refsection"><a name="idp57530880"></a><h2>例: 3版</h2><pre class="programlisting">-- 座標を入れ替え、拡張EPSGで出力 (16 | 1)--
SELECT ST_AsGML(3, ST_GeomFromText('POINT(5.234234233242 6.34534534534)',4326), 5, 17);
                        st_asgml
                        --------
                &lt;gml:Point srsName="urn:ogc:def:crs:EPSG::4326"
&gt;&lt;gml:pos
&gt;6.34535 5.23423&lt;/gml:pos
&gt;&lt;/gml:Point
&gt;
                        </pre><pre class="programlisting">-- エンベロープ出力 (32) --
SELECT ST_AsGML(3, ST_GeomFromText('LINESTRING(1 2, 3 4, 10 20)',4326), 5, 32);
                st_asgml
                --------
        &lt;gml:Envelope srsName="EPSG:4326"&gt;
                &lt;gml:lowerCorner
&gt;1 2&lt;/gml:lowerCorner&gt;
                &lt;gml:upperCorner
&gt;10 20&lt;/gml:upperCorner&gt;
        &lt;/gml:Envelope
&gt;
                        </pre><pre class="programlisting">-- エンベロープ出力 (32)、座標入れ替え (経度緯度を緯度経度に)、Long CRS(1)
 = 32 | 16 | 1 = 49 --
SELECT ST_AsGML(3, ST_GeomFromText('LINESTRING(1 2, 3 4, 10 20)',4326), 5, 49);
        st_asgml
        --------
&lt;gml:Envelope srsName="urn:ogc:def:crs:EPSG::4326"&gt;
        &lt;gml:lowerCorner
&gt;2 1&lt;/gml:lowerCorner&gt;
        &lt;gml:upperCorner
&gt;20 10&lt;/gml:upperCorner&gt;
&lt;/gml:Envelope
&gt;
                        </pre><pre class="programlisting">-- 多面体サーフェスの例 --
SELECT ST_AsGML(3, ST_GeomFromEWKT('POLYHEDRALSURFACE( ((0 0 0, 0 0 1, 0 1 1, 0 1 0, 0 0 0)),
((0 0 0, 0 1 0, 1 1 0, 1 0 0, 0 0 0)), ((0 0 0, 1 0 0, 1 0 1, 0 0 1, 0 0 0)),
((1 1 0, 1 1 1, 1 0 1, 1 0 0, 1 1 0)),
((0 1 0, 0 1 1, 1 1 1, 1 1 0, 0 1 0)), ((0 0 1, 1 0 1, 1 1 1, 0 1 1, 0 0 1)) )'));
        st_asgml
        --------
 &lt;gml:PolyhedralSurface&gt;
&lt;gml:polygonPatches&gt;
   &lt;gml:PolygonPatch&gt;
                &lt;gml:exterior&gt;
                          &lt;gml:LinearRing&gt;
                                   &lt;gml:posList srsDimension="3"
&gt;0 0 0 0 0 1 0 1 1 0 1 0 0 0 0&lt;/gml:posList&gt;
                          &lt;/gml:LinearRing&gt;
                &lt;/gml:exterior&gt;
   &lt;/gml:PolygonPatch&gt;
   &lt;gml:PolygonPatch&gt;
                &lt;gml:exterior&gt;
                          &lt;gml:LinearRing&gt;
                                   &lt;gml:posList srsDimension="3"
&gt;0 0 0 0 1 0 1 1 0 1 0 0 0 0 0&lt;/gml:posList&gt;
                          &lt;/gml:LinearRing&gt;
                &lt;/gml:exterior&gt;
   &lt;/gml:PolygonPatch&gt;
   &lt;gml:PolygonPatch&gt;
                &lt;gml:exterior&gt;
                          &lt;gml:LinearRing&gt;
                                   &lt;gml:posList srsDimension="3"
&gt;0 0 0 1 0 0 1 0 1 0 0 1 0 0 0&lt;/gml:posList&gt;
                          &lt;/gml:LinearRing&gt;
                &lt;/gml:exterior&gt;
   &lt;/gml:PolygonPatch&gt;
   &lt;gml:PolygonPatch&gt;
                &lt;gml:exterior&gt;
                          &lt;gml:LinearRing&gt;
                                   &lt;gml:posList srsDimension="3"
&gt;1 1 0 1 1 1 1 0 1 1 0 0 1 1 0&lt;/gml:posList&gt;
                          &lt;/gml:LinearRing&gt;
                &lt;/gml:exterior&gt;
   &lt;/gml:PolygonPatch&gt;
   &lt;gml:PolygonPatch&gt;
                &lt;gml:exterior&gt;
                          &lt;gml:LinearRing&gt;
                                   &lt;gml:posList srsDimension="3"
&gt;0 1 0 0 1 1 1 1 1 1 1 0 0 1 0&lt;/gml:posList&gt;
                          &lt;/gml:LinearRing&gt;
                &lt;/gml:exterior&gt;
   &lt;/gml:PolygonPatch&gt;
   &lt;gml:PolygonPatch&gt;
                &lt;gml:exterior&gt;
                          &lt;gml:LinearRing&gt;
                                   &lt;gml:posList srsDimension="3"
&gt;0 0 1 1 0 1 1 1 1 0 1 1 0 0 1&lt;/gml:posList&gt;
                          &lt;/gml:LinearRing&gt;
                &lt;/gml:exterior&gt;
   &lt;/gml:PolygonPatch&gt;
&lt;/gml:polygonPatches&gt;
&lt;/gml:PolyhedralSurface
&gt;
                        </pre></div><div class="refsection"><a name="idp57533696"></a><h2>関連情報</h2><p><a class="xref" href="#">???</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_AsKML"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsKML — KML要素としてジオメトリを返します。いくつかの形式があります。デフォルトはversion=2, maxdecimaldigits=15です。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_AsKML</b>(</code>geometry  <var class="pdparam">geom</var>, integer  <var class="pdparam">maxdecimaldigits=15</var>, text  <var class="pdparam">nprefix=NULL</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">ST_AsKML</b>(</code>geography  <var class="pdparam">geog</var>, integer  <var class="pdparam">maxdecimaldigits=15</var>, text  <var class="pdparam">nprefix=NULL</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp57574912"></a><h2>説明</h2><p>ジオメトリをKeyhole Markup Language (KML)要素で返します。この関数にはいくつかの形式があります。出力に使われる小数位の最大数のデフォルトは15で、デフォルトのバージョンは2で、デフォルトの名前空間はプリフィクス無しです。</p><div class="warning"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>任意引数<em class="parameter"><code>maxdecimaldigits</code></em>を使用することで、出力ジオメトリが不正になる可能性があります。これを回避するには、前もって<a class="xref" href="#ST_ReducePrecision" title="ST_ReducePrecision">ST_ReducePrecision</a>に適切なグリッドサイズを与えてこれを使用します。 </p></td></tr></table></div><p>一つ目の形式: ST_AsKML(geom_or_geog, maxdecimaldigits) / version=2 / maxdecimaldigits=15  </p><p>二つ目の形式: ST_AsKML(version, geom_or_geog, maxdecimaldigits, nprefix) maxdecimaldigits=15 / nprefix=NULL </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>PostGISがProj対応でコンパイルされている必要があります。<a class="xref" href="#">???</a>を使ってProj対応でコンパイルされているか確認して下さい。</p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Availability: 1.2.2 - versionパラメータが付く形式は1.3.2からです。</p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Enhanced: 2.0.0 - プレフィクス名前空間を追加しました。デフォルトではプリフィクス無しです。</p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Changed: 2.0.0 - デフォルト引数と名前付き引数に対応しました。</p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>AsKML出力はSRIDを持たないジオメトリでは動作しません。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp57604736"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsKML(ST_GeomFromText('POLYGON((0 0,0 1,1 1,1 0,0 0))',4326));

                st_askml
                --------
                &lt;Polygon
&gt;&lt;outerBoundaryIs
&gt;&lt;LinearRing
&gt;&lt;coordinates
&gt;0,0 0,1 1,1 1,0 0,0&lt;/coordinates
&gt;&lt;/LinearRing
&gt;&lt;/outerBoundaryIs
&gt;&lt;/Polygon&gt;

                -- 3次元ラインストリング
                SELECT ST_AsKML('SRID=4326;LINESTRING(1 2 3, 4 5 6)');
                &lt;LineString
&gt;&lt;coordinates
&gt;1,2,3 4,5,6&lt;/coordinates
&gt;&lt;/LineString&gt;
                
                </pre></div><div class="refsection"><a name="idp57626496"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsSVG" title="ST_AsSVG">ST_AsSVG</a>, <a class="xref" href="#ST_AsGML" title="ST_AsGML">ST_AsGML</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_AsLatLonText"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsLatLonText — 与えられたポイントの度・分・秒表現を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_AsLatLonText</b>(</code>geometry  <var class="pdparam">pt</var>, text  <var class="pdparam">format=''</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp57633664"></a><h2>説明</h2><p>ポイントの度・分・秒表現を返します。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>緯度/経度座標系のポイントを前提としています。X(経度)とY(緯度)座標系は「正常な」範囲 (経度は-180から180、緯度は-90から90)に正常化されます。</p></td></tr></table></div><p>text引数は結果文字列のための書式を含む書式文字列です。日付書式文字列に近いものです。妥当なトークンは"D"が度、"M"が分、"S"が秒、"C" (cardinal direction)が4方位 (NSEW)です。DMSトークンは、求める幅と精度で示すために、繰り返せます ("SSS.SSSS"では" 1.0023"になります)。 </p><p>"M"と"S"と"C"は必須ではありません。"C"が省略された場合には、南または西の場合には"-"符号がついたうえで、指定した精度で、度が表示されます。"M"も省略された場合には、指定した精度の桁数で十進の度が表示されます。 </p><p>書式文字列が省略された (または長さが0の)場合には、デフォルトの書式が使われます。 </p><p>Availability: 2.0</p></div><div class="refsection"><a name="idp57637248"></a><h2>例</h2><p>デフォルト書式。</p><pre class="programlisting">SELECT (ST_AsLatLonText('POINT (-3.2342342 -2.32498)'));
      st_aslatlontext
----------------------------
 2°19'29.928"S 3°14'3.243"W
</pre><p>書式を指定 (デフォルトと同じ)。</p><pre class="programlisting">SELECT (ST_AsLatLonText('POINT (-3.2342342 -2.32498)', 'D°M''S.SSS"C'));
      st_aslatlontext
----------------------------
 2°19'29.928"S 3°14'3.243"W
</pre><p>D, M, S, C以外の文字は通過するだけです。</p><pre class="programlisting">SELECT (ST_AsLatLonText('POINT (-3.2342342 -2.32498)', 'D degrees, M minutes, S seconds to the C'));
                                   st_aslatlontext
--------------------------------------------------------------------------------------
 2 degrees, 19 minutes, 30 seconds to the S 3 degrees, 14 minutes, 3 seconds to the W
</pre><p>4方位文字でなく符号で示された度。</p><pre class="programlisting">SELECT (ST_AsLatLonText('POINT (-3.2342342 -2.32498)', 'D°M''S.SSS"'));
      st_aslatlontext
----------------------------
 -2°19'29.928" -3°14'3.243"
</pre><p>十進の度。</p><pre class="programlisting">SELECT (ST_AsLatLonText('POINT (-3.2342342 -2.32498)', 'D.DDDD degrees C'));
          st_aslatlontext
-----------------------------------
 2.3250 degrees S 3.2342 degrees W
</pre><p>過大な値が正常化されます。</p><pre class="programlisting">SELECT (ST_AsLatLonText('POINT (-302.2342342 -792.32498)'));
        st_aslatlontext
-------------------------------
 72°19'29.928"S 57°45'56.757"E
</pre></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_AsMVTGeom"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsMVTGeom — ジオメトリを<a class="ulink" href="https://www.mapbox.com/vector-tiles/" target="_top">Mapbox Vector Tile</a>の座標空間に変換します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_AsMVTGeom</b>(</code>geometry  <var class="pdparam">geom</var>, box2d  <var class="pdparam">bounds</var>, integer  <var class="pdparam">extent=4096</var>, integer  <var class="pdparam">buffer=256</var>, boolean  <var class="pdparam">clip_geom=true</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp57653120"></a><h2>説明</h2><p>ジオメトリをレイヤに対応する行集合の<a class="ulink" href="https://www.mapbox.com/vector-tiles/" target="_top">Mapbox Vector Tile</a>の座標空間に変換します。妥当性の維持と訂正のための最善の努力をしますが、ジオメトリを低い次元にすることがあります。 </p><p><code class="varname">geom</code>は、変換するジオメトリです。</p><p><code class="varname">bounds</code>は、バッファの無いタイルコンテンツの幾何的な境界です。</p><p><code class="varname">extent</code>は、<a class="ulink" href="https://www.mapbox.com/vector-tiles/specification/" target="_top">specification</a>で定義されているタイル座標空間内のタイル範囲です。NULLの場合には4096をデフォルト値とします。</p><p><code class="varname">buffer</code>は、随意でジオメトリを切り取るためのタイル座標空間内のバッファ距離です。NULLの場合には、256をデフォルト値とします。</p><p><code class="varname">clip_geom</code>は、ジオメトリを切り抜くか、そのままエンコードするか、を制御するための真偽値です。NULLの場合には、TRUEをデフォルト値とします。</p><p>Availability: 2.4.0</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>3.0からは、MVTポリゴンのクリップと検証にコンフィギュア時にWagyuを選択することができるようになりました。このライブラリは、デフォルトのGEOSと比べて、速度が速く、より正確な結果が得られますが、小さいポリゴンが削除されることがあります。</p></td></tr></table></div></div><div class="refsection"><a name="idp57659648"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(ST_AsMVTGeom(
        ST_GeomFromText('POLYGON ((0 0, 10 0, 10 5, 0 -5, 0 0))'),
        ST_MakeBox2D(ST_Point(0, 0), ST_Point(4096, 4096)),
        4096, 0, false));
                              st_astext
--------------------------------------------------------------------
 MULTIPOLYGON(((5 4096,10 4091,10 4096,5 4096)),((5 4096,0 4101,0 4096,5 4096)))

                
                </pre></div><div class="refsection"><a name="idp57660928"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsMVT" title="ST_AsMVT">ST_AsMVT</a>, <a class="xref" href="#ST_TileEnvelope" title="ST_TileEnvelope">ST_TileEnvelope</a>, <a class="xref" href="#">???</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_AsMVT"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsMVT — 行集合のMapbox Vector Tile表現を返す集約関数です。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">bytea <b class="fsfunc">ST_AsMVT</b>(</code>anyelement set  <var class="pdparam">row</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsMVT</b>(</code>anyelement  <var class="pdparam">row</var>, text  <var class="pdparam">name</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsMVT</b>(</code>anyelement  <var class="pdparam">row</var>, text  <var class="pdparam">name</var>, integer  <var class="pdparam">extent</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsMVT</b>(</code>anyelement  <var class="pdparam">row</var>, text  <var class="pdparam">name</var>, integer  <var class="pdparam">extent</var>, text  <var class="pdparam">geom_name</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsMVT</b>(</code>anyelement  <var class="pdparam">row</var>, text  <var class="pdparam">name</var>, integer  <var class="pdparam">extent</var>, text  <var class="pdparam">geom_name</var>, text  <var class="pdparam">feature_id_name</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp57690624"></a><h2>説明</h2><p>タイルレイヤに対応する行集合の<a class="ulink" href="https://www.mapbox.com/vector-tiles/" target="_top">Mapbox Vector Tile</a>表現をバイナリで返す集約関数です。行には、地物ジオメトリとして符号化されるジオメトリカラムを含ませるべきです。 </p><p><a class="ulink" href="https://www.mapbox.com/vector-tiles/" target="_top">Mapbox Vector Tile</a>書式は、様々な属性就業を持つ地物を格納することができます。この能力を使うには、JSONオブジェクトを１レベルの深さで持っている行データ内のJSONBカラムを提供します。JSONB値のキーと値は地物の属性として符号化されます。 </p><p>複数レイヤのタイルは、この関数の複数の呼び出しを<code class="varname">||</code>で繋げて作成することができます。 </p><div class="important"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[重要]" src="images/important.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">GEOMETRYCOLLECTION</code>を行の要素として、この関数を呼ばないでください。しかしながら、ジオメトリコレクションを含ませるための準備として、<a class="xref" href="#ST_AsMVTGeom" title="ST_AsMVTGeom">ST_AsMVTGeom</a>を使うことができます。</p></td></tr></table></div><p><code class="varname">row</code> 少なくとも一つのジオメトリカラムを持つ行データ</p><p><code class="varname">name</code>はレイヤ名です。デフォルトは"default"という文字列です。</p><p><code class="varname">extent</code>は、仕様で定義されている画面空間内のタイル範囲です。NULLの場合には、4096をデフォルト値とします。</p><p><code class="varname">geom_name</code>は行データのジオメトリカラムの名前です。デフォルトは最初のジオメトリカラムです。</p><p><code class="varname">feature_id_name</code>は行データの地物IDカラムの名前です。NULLまたは負数の場合には地物IDは設定されません。名前が合致し、妥当な型 (smallint, integer, bigint)である最初のカラムが地物IDに使われます。後続のカラムは全てプロパティとして追加されます。JSONプロパティには対応していません。</p><p>Enhanced: 3.0 - 地物IDへの対応を追加。</p><p>Enhanced: 2.5.0 - パラレルクエリへの対応の追加。</p><p>Availability: 2.4.0</p></div><div class="refsection"><a name="idp57712128"></a><h2>例</h2><pre class="programlisting">WITH mvtgeom AS
(
  SELECT ST_AsMVTGeom(geom, ST_TileEnvelope(12, 513, 412), extent =
&gt; 4096, buffer =
&gt; 64) AS geom, name, description
  FROM points_of_interest
  WHERE geom &amp;&amp; ST_TileEnvelope(12, 513, 412, margin =
&gt; (64.0 / 4096))
)
SELECT ST_AsMVT(mvtgeom.*)
FROM mvtgeom;
</pre></div><div class="refsection"><a name="idp57713408"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsMVTGeom" title="ST_AsMVTGeom">ST_AsMVTGeom</a>, <a class="xref" href="#ST_TileEnvelope" title="ST_TileEnvelope">ST_TileEnvelope</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_AsSVG"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsSVG — ジオメトリからSVGパスデータを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_AsSVG</b>(</code>geometry  <var class="pdparam">geom</var>, integer  <var class="pdparam">rel=0</var>, integer  <var class="pdparam">maxdecimaldigits=15</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">ST_AsSVG</b>(</code>geography  <var class="pdparam">geog</var>, integer  <var class="pdparam">rel=0</var>, integer  <var class="pdparam">maxdecimaldigits=15</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp57726464"></a><h2>説明</h2><p>Scalar Vector Graphics (SVG)としてジオメトリを返します。 第2引数に1を指定すると、相対移動によるパスデータ実装を返し、絶対移動の場合はデフォルト (または0)とします。第3引数は、出力の十進数の最大桁数を減らすために使います (デフォルトは15です)。ポイントジオメトリは、'rel'が0のときはポイントはcx/cyに、'rel'が1のときはx/yに、それぞれ出力されます。マルチポイントはコンマ (",")で区切られ、ジオメトリコレクションはセミコロン (";")で区切られます。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Availability: 1.2.2. Availability: 1.4.0 PostGIS 1.4.0で<a class="ulink" href="http://www.w3.org/TR/SVG/paths.html#PathDataBNF" target="_top">http://www.w3.org/TR/SVG/paths.html#PathDataBNF</a>に従うため、絶対パスにLコマンドが入りました。</p></td></tr></table></div><p>Changed: 2.0.0 - デフォルト引数と名前付き引数に対応しました。</p></div><div class="refsection"><a name="idp57729408"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsSVG('POLYGON((0 0,0 1,1 1,1 0,0 0))');

                st_assvg
                --------
                M 0 0 L 0 -1 1 -1 1 0 Z</pre></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_AsTWKB"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsTWKB — TWKB (Tiny Well-Known Binary)としてジオメトリを出力します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">bytea <b class="fsfunc">ST_AsTWKB</b>(</code>geometry  <var class="pdparam">g1</var>, integer  <var class="pdparam">decimaldigits_xy=0</var>, integer  <var class="pdparam">decimaldigits_z=0</var>, integer  <var class="pdparam">decimaldigits_m=0</var>, boolean  <var class="pdparam">include_sizes=false</var>, boolean  <var class="pdparam">include_bounding boxes=false</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsTWKB</b>(</code>geometry[]  <var class="pdparam">geometries</var>, bigint[]  <var class="pdparam">unique_ids</var>, integer  <var class="pdparam">decimaldigits_xy=0</var>, integer  <var class="pdparam">decimaldigits_z=0</var>, integer  <var class="pdparam">decimaldigits_m=0</var>, boolean  <var class="pdparam">include_sizes=false</var>, boolean  <var class="pdparam">include_bounding_boxes=false</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp57748608"></a><h2>説明</h2><p>TWKB (Tiny Well-Known Binary) 書式としてジオメトリを返します。
TWKBは、出力サイズを最小化することに焦点を当てた<a class="ulink" href="https://github.com/TWKB/Specification/blob/master/twkb.md" target="_top">compressed binary format</a> (圧縮バイナリ書式)です。 </p><p>decimaldigitsパラメータによって、出力に持たせる精度を制御できます。デフォルトでは、符号化前に値は単位上の最近値に丸められます。精度が高いものを転送したいなら、これの数字を大きくします。たとえば、1の値は小数点の右に1桁の数字が保存されます。</p><p>include_sizesとinclude_bounding_boxesパラメータによって、符号化オブジェクトの長さに関する任意情報の有無やオブジェクトの境界の有無を制御できます。デフォルトでは、無しです。クライアントソフトウェアが、これらの情報を使用しないなら、このパラメータを有効にしないで下さい。空白が増える (しかも空白の抑制がTWKBのポイントである)ためです。</p><p>配列入力の形式は、ジオメトリのコレクションを変換して、一意の識別子をTWKBコレクションに持たせるためのものです。これは、コレクションを展開して、オブジェクト内部に関する情報にさらにアクセスするのに使えます。<a class="ulink" href="http://www.postgresql.org/docs/9.4/static/functions-aggregate.html" target="_top">array_agg</a>関数を使用して配列を生成できます。他のパラメータは、単純な形式のものと同じです。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>書式仕様は<a class="ulink" href="https://github.com/TWKB/Specification" target="_top">https://github.com/TWKB/Specification</a>にあります。JavaScriptクライアントを構築するプログラムは<a class="ulink" href="https://github.com/TWKB/twkb.js" target="_top">https://github.com/TWKB/twkb.js</a>にあります。</p></td></tr></table></div><p>Enhanced: 2.4.0 メモリと速度の改善。</p><p>Availability: 2.2.0</p></div><div class="refsection"><a name="idp57754624"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsTWKB('LINESTRING(1 1,5 5)'::geometry);
                 st_astwkb
--------------------------------------------
\x02000202020808

</pre><p> 識別子を含むTWKBオブジェクトの集計を生成するには、まず、"array_agg()"を使って求めるジオメトリとオブジェクトを集計して、その後に適切なTWKB関数を呼んでいます。 </p><pre class="programlisting">SELECT ST_AsTWKB(array_agg(geom), array_agg(gid)) FROM mytable;
                 st_astwkb
--------------------------------------------
\x040402020400000202
</pre></div><div class="refsection"><a name="idp57756800"></a><h2>関連情報</h2><p><a class="xref" href="#">???</a>, <a class="xref" href="#ST_AsBinary" title="ST_AsBinary">ST_AsBinary</a>, <a class="xref" href="#ST_AsEWKB" title="ST_AsEWKB">ST_AsEWKB</a>, <a class="xref" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a>, <a class="xref" href="#">???</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_AsX3D"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsX3D — ジオメトリをX3Dノード要素書式　(ISO-IEC-19776-1.2-X3DEncodings-XML)で返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_AsX3D</b>(</code>geometry  <var class="pdparam">g1</var>, integer  <var class="pdparam">maxdecimaldigits=15</var>, integer  <var class="pdparam">options=0</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp57770496"></a><h2>説明</h2><p>X3D XMLで表されたノード要素 <a class="ulink" href="http://www.web3d.org/standards/number/19776-1" target="_top">http://www.web3d.org/standards/number/19776-1</a>としたジオメトリを返します。<code class="varname">maxdecimaldigits</code> (精度)を指定しない場合には、デフォルトは15です。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>PostGISジオメトリをX3Dに変換するための任意引数が様々あります。X3Dジオメトリ型は、PostGISジオメトリタイプに対応付けされていないためです。また、より良い対応付けになると思われるものの、ほとんどのレンダリングツールが今のところは対応していないため、開発者が避けてきた新しいX3Dタイプに対応付けをしていないためでもあります。これらは開発者が決定した対応付けです。開発者が皆さんにより好まれる対応付けを示せるようなアイデアや方法に関する考えを持っているなら、お気軽にバグチケットを出して下さい。</p><p>次に現時点のPostGIS 2次元/3次元型からX3D型への対応付けを示します。</p></td></tr></table></div><p>'options'引数はビットフィールドです。PostGIS 2.2以上では、これはX3D GeoCoordinates Geospatialノードを表現するかどうか、また、X/Y軸を反対にするかどうかで使います。<code class="code">ST_AsX3D</code>は、デフォルトではデータベースの形式(経度, 緯度またはX, Y)で出力しますが、X3Dのlat/lon, y/xのデフォルトが好まれるでしょう。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>0: データベース内のX/Y順 (経度/緯度=X, Yが標準です)とします。デフォルト値です。非空間座標 (一般的な古いCoordinate要素です)です。</p></li><li class="listitem"><p>1: XとYを反対にします。GeoCoordinate任意スイッチと併せて使用されると、出力は"latitude_first" (緯度が先)となり、座標が同じように反対になります。</p></li><li class="listitem"><p>2: GeoSpatial GeoCoordinates内への座標出力。WGS 84経度緯度 (SRID: 4326)でない場合にエラーが投げられます。現在はGeoCoordinate型のみ対応します。
<a class="ulink" href="http://www.web3d.org/documents/specifications/19775-1/V3.2/Part01/components/geodata.html#Specifyingaspatialreference" target="_top">X3D specs specifying a spatial reference system.</a>を参照して下さい。デフォルト出力は<code class="code">GeoCoordinate geoSystem='"GD" "WE" "longitude_first"'</code>となります。X3Dのデフォルトである<code class="code">GeoCoordinate geoSystem='"GD" "WE" "latitude_first"'</code>とするには、<code class="code">(2 + 1)</code> = <code class="code">3</code>とします。 </p></li></ul></div><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col><col><col></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">PostGISタイプ</th><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">2次元X3Dタイプ</th><th style="border-bottom: 1px solid ; ">3次元X3Dタイプ</th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">LINESTRING</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">未実装 - PolyLine2Dの予定</td><td style="border-bottom: 1px solid ; ">LineSet</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">MULTILINESTRING</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">未実装 - PolyLine2Dの予定</td><td style="border-bottom: 1px solid ; ">IndexedLineSet</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">MULTIPOINT</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">Polypoint2D</td><td style="border-bottom: 1px solid ; ">PointSet</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">POINT</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">空白区切り座標値を出力</td><td style="border-bottom: 1px solid ; ">空白区切り座標値を出力</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">(MULTI) POLYGON, POLYHEDRALSURFACE</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">不正なX3Dマークアップ</td><td style="border-bottom: 1px solid ; ">IndexedFaceSet (内環は現在は他のfacesetとして出力)</td></tr><tr><td style="border-right: 1px solid ; ">TIN</td><td style="border-right: 1px solid ; ">TriangleSet2D (未実装)</td><td style="">IndexedTriangleSet</td></tr></tbody></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>2次元ジオメトリ対応はまだ不完全です。 内環は現在は分けられたポリゴンとして描画されるだけです。作業中です。</p></td></tr></table></div><p>3次元空間については、特に<a class="ulink" href="https://www.web3d.org/wiki/index.php/X3D_and_HTML5" target="_top">X3D Integration with HTML5</a>で大きな進歩があります。</p><p>また、描画されたジオメトリを閲覧するための素晴らしいオープンソースのX3Dビューアがあります。Free Wrl <a class="ulink" href="http://freewrl.sourceforge.net/" target="_top">http://freewrl.sourceforge.net/</a>のバイナリがMac, Linux, Windows用であります。ジオメトリを見るためのパッケージであるFreeWRL_Launcherを使います。</p><p>また、この関数と<a class="ulink" href="http://www.x3dom.org/" target="_top">x3dDom html/js open source toolkit</a>を用いる<a class="ulink" href="https://github.com/robe2/postgis_x3d_viewer" target="_top">PostGIS minimalist X3D viewer</a>をチェックアウトしてみて下さい。</p><p>Availability: 2.0.0: ISO-IEC-19776-1.2-X3DEncodings-XML</p><p>Enhanced: 2.2.0: GeoCoordinatesと軸 (x/y, 経度/緯度)の反転に対応しました。詳細はoptionsを見て下さい。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div><div class="refsection"><a name="idp57813632"></a><h2>例: 完全に機能するX3D文書の作成 - FreeWrlや他のX3Dビューアで見ることができる立方体を生成しています。</h2><pre class="programlisting">SELECT '&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE X3D PUBLIC "ISO//Web3D//DTD X3D 3.0//EN" "http://www.web3d.org/specifications/x3d-3.0.dtd"&gt;
&lt;X3D&gt;
  &lt;Scene&gt;
    &lt;Transform&gt;
      &lt;Shape&gt;
       &lt;Appearance&gt;
            &lt;Material emissiveColor=''0 0 1''/&gt;
       &lt;/Appearance
&gt; ' ||
       ST_AsX3D( ST_GeomFromEWKT('POLYHEDRALSURFACE( ((0 0 0, 0 0 1, 0 1 1, 0 1 0, 0 0 0)),
((0 0 0, 0 1 0, 1 1 0, 1 0 0, 0 0 0)), ((0 0 0, 1 0 0, 1 0 1, 0 0 1, 0 0 0)),
((1 1 0, 1 1 1, 1 0 1, 1 0 0, 1 1 0)),
((0 1 0, 0 1 1, 1 1 1, 1 1 0, 0 1 0)), ((0 0 1, 1 0 1, 1 1 1, 0 1 1, 0 0 1)) )')) ||
      '&lt;/Shape&gt;
    &lt;/Transform&gt;
  &lt;/Scene&gt;
&lt;/X3D
&gt;' As x3ddoc;

                x3ddoc
                --------
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE X3D PUBLIC "ISO//Web3D//DTD X3D 3.0//EN" "http://www.web3d.org/specifications/x3d-3.0.dtd"&gt;
&lt;X3D&gt;
  &lt;Scene&gt;
    &lt;Transform&gt;
      &lt;Shape&gt;
       &lt;Appearance&gt;
            &lt;Material emissiveColor='0 0 1'/&gt;
       &lt;/Appearance&gt;
       &lt;IndexedFaceSet  coordIndex='0 1 2 3 -1 4 5 6 7 -1 8 9 10 11 -1 12 13 14 15 -1 16 17 18 19 -1 20 21 22 23'&gt;
            &lt;Coordinate point='0 0 0 0 0 1 0 1 1 0 1 0 0 0 0 0 1 0 1 1 0 1 0 0 0 0 0 1 0 0 1 0 1 0 0 1 1 1 0 1 1 1 1 0 1 1 0 0 0 1 0 0 1 1 1 1 1 1 1 0 0 0 1 1 0 1 1 1 1 0 1 1' /&gt;
      &lt;/IndexedFaceSet&gt;
      &lt;/Shape&gt;
    &lt;/Transform&gt;
  &lt;/Scene&gt;
&lt;/X3D
&gt;</pre></div><div class="refsection"><a name="idp57819008"></a><h2>例: 高さ3単位で精度が6桁の八角柱</h2><pre class="programlisting">SELECT ST_AsX3D(
ST_Translate(
    ST_Force_3d(
        ST_Buffer(ST_Point(10,10),5, 'quad_segs=2')), 0,0,
    3)
  ,6) As x3dfrag;

x3dfrag
--------
&lt;IndexedFaceSet coordIndex="0 1 2 3 4 5 6 7"&gt;
    &lt;Coordinate point="15 10 3 13.535534 6.464466 3 10 5 3 6.464466 6.464466 3 5 10 3 6.464466 13.535534 3 10 15 3 13.535534 13.535534 3 " /&gt;
&lt;/IndexedFaceSet
&gt;</pre></div><div class="refsection"><a name="idp57820288"></a><h2>例: TIN</h2><pre class="programlisting">SELECT ST_AsX3D(ST_GeomFromEWKT('TIN (((
                0 0 0,
                0 0 1,
                0 1 0,
                0 0 0
            )), ((
                0 0 0,
                0 1 0,
                1 1 0,
                0 0 0
            ))
            )')) As x3dfrag;

                x3dfrag
                --------
&lt;IndexedTriangleSet  index='0 1 2 3 4 5'
&gt;&lt;Coordinate point='0 0 0 0 0 1 0 1 0 0 0 0 0 1 0 1 1 0'/&gt;&lt;/IndexedTriangleSet
&gt;</pre></div><div class="refsection"><a name="idp57821568"></a><h2>例: 閉じたラインストリング (穴のあるポリゴンの境界)</h2><pre class="programlisting">SELECT ST_AsX3D(
                    ST_GeomFromEWKT('MULTILINESTRING((20 0 10,16 -12 10,0 -16 10,-12 -12 10,-20 0 10,-12 16 10,0 24 10,16 16 10,20 0 10),
  (12 0 10,8 8 10,0 12 10,-8 8 10,-8 0 10,-8 -4 10,0 -8 10,8 -4 10,12 0 10))')
) As x3dfrag;

                x3dfrag
                --------
&lt;IndexedLineSet  coordIndex='0 1 2 3 4 5 6 7 0 -1 8 9 10 11 12 13 14 15 8'&gt;
    &lt;Coordinate point='20 0 10 16 -12 10 0 -16 10 -12 -12 10 -20 0 10 -12 16 10 0 24 10 16 16 10 12 0 10 8 8 10 0 12 10 -8 8 10 -8 0 10 -8 -4 10 0 -8 10 8 -4 10 ' /&gt;
 &lt;/IndexedLineSet
&gt;</pre></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_GeoHash"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_GeoHash — ジオメトリのGeoHash表現を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_GeoHash</b>(</code>geometry  <var class="pdparam">geom</var>, integer  <var class="pdparam">maxchars=full_precision_of_point</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp57828480"></a><h2>説明</h2><p>ジオメトリのGeoHash表現 (<a class="ulink" href="http://en.wikipedia.org/wiki/Geohash" target="_top">http://en.wikipedia.org/wiki/Geohash</a>)を返します。GeoHashによって、ポイントは、prefixingに基づいてソートと検索が可能なテキスト形式にエンコードされます。短いGeoHashは低精度のポイント表現です。実際の点を含むボックスとも考えられます。</p><p><code class="varname">maxchars</code>を指定しない場合には、ST_GeoHashは、入力ジオメトリタイプの、完全な精度に基づくGeoHashを返します。ポイントについては20文字の精度を持つGeoHashを返します (入力の倍精度を完全に保持するのに概ね十分です)。他のタイプでは、フィーチャーのサイズをもとに、可変的な精度量を持つGeoHashを返します。大きなフィーチャーは低精度で表現され、小さいフィーチャーは高精度で表現されます。GeoHashが含むボックスは常に入力フィーチャーを含むようにしています。</p><p><code class="varname">maxchars</code>を指定した場合には、ST_GeoHashは、最高でもその文字数によるGeoHashを返し、入力ジオメトリはおそらく低精度表現となります。ポイント以外では、計算の開始点はジオメトリのバウンディングボックスの中心となります。</p><p>Availability: 1.4.0</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_GeoHashはジオグラフィ (経度緯度)座標系では動作しません。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p></div><div class="refsection"><a name="idp57833728"></a><h2>例</h2><pre class="programlisting">SELECT ST_GeoHash(ST_SetSRID(ST_Point(-126,48),4326));

         st_geohash
----------------------
 c0w3hf1s70w3hf1s70w3

SELECT ST_GeoHash(ST_SetSRID(ST_Point(-126,48),4326),5);

 st_geohash
------------
 c0w3h
                
                </pre></div><div class="refsection"><a name="idp57835008"></a><h2>関連情報</h2><p><a class="xref" href="#">???</a></p></div></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Operators"></a>8.8. 演算子</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="#operators-bbox">8.8.1. バウンディングボックス演算子</a></span></dt><dt><span class="sect2"><a href="#operators-distance">8.8.2. 距離演算子</a></span></dt></dl></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="operators-bbox"></a>8.8.1. バウンディングボックス演算子</h3></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#geometry_overlaps">&amp;&amp;</a></span><span class="refpurpose"> — Aの2次元バウンディングボックスがBの2次元バウンディングボックスとインタセクトする場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#overlaps_geometry_box2df">&amp;&amp;(geometry,box2df)</a></span><span class="refpurpose"> — ジオメトリの (キャッシュされている)2次元バウンディングボックスが単精度浮動小数点数による2次元バウンディングボックスとインタセクトする場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#overlaps_box2df_geometry">&amp;&amp;(box2df,geometry)</a></span><span class="refpurpose"> — 単精度浮動小数点数による2次元バウンディングボックスがジオメトリの (キャッシュされている)2次元バウンディングボックスとインタセクトする場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#overlaps_box2df_box2df">&amp;&amp;(box2df,box2df)</a></span><span class="refpurpose"> — 二つの単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)が相互にインタセクトする場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#geometry_overlaps_nd">&amp;&amp;&amp;</a></span><span class="refpurpose"> — Aのn次元バウンディングボックスがBのn次元バウンディングボックスとインタセクトする場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#overlaps_nd_geometry_gidx">&amp;&amp;&amp;(geometry,gidx)</a></span><span class="refpurpose"> — ジオメトリの (キャッシュされている)n次元バウンディングボックスが単精度浮動小数点数によるn次元バウンディングボックス (GIDX)とインタセクトする場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#overlaps_nd_gidx_geometry">&amp;&amp;&amp;(gidx,geometry)</a></span><span class="refpurpose"> — 単精度浮動小数点数によるn次元バウンディングボックス (GIDX)がジオメトリの (キャッシュされている)n次元バウンディングボックスとインタセクトする場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#overlaps_nd_gidx_gidx">&amp;&amp;&amp;(gidx,gidx)</a></span><span class="refpurpose"> — 二つの単精度浮動小数点数によるn次元バウンディングボックス (GIDX)が相互にインタセクトする場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Geometry_Overleft">&amp;&lt;</a></span><span class="refpurpose"> — AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの左にある場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Geometry_Overbelow">&amp;&lt;|</a></span><span class="refpurpose"> — AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの下にある場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Geometry_Overright">&amp;&gt;</a></span><span class="refpurpose"> — AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの右にある場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Geometry_Left">&lt;&lt;</a></span><span class="refpurpose"> — Aのバウンダリボックスが、厳密にBのバウンダリボックスの左にある場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Geometry_Below">&lt;&lt;|</a></span><span class="refpurpose"> — Aのバウンダリボックスが、厳密にBのバウンダリボックスの下にある場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Geometry_EQ">=</a></span><span class="refpurpose"> — ジオメトリ/ジオグラフィ Aの座標と座標の並び順がジオメトリ/ジオグラフィ Bと同じ場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Geometry_Right">&gt;&gt;</a></span><span class="refpurpose"> — Aのバウンダリボックスが、厳密にBのバウンダリボックスの右にある場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Geometry_Contained">@</a></span><span class="refpurpose"> — AのバウンダリボックスがBのバウンダリボックスに含まれている場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#is_contained_geometry_box2df">@(geometry,box2df)</a></span><span class="refpurpose"> — ジオメトリの2次元バウンディングボックスが単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)に包含される場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#is_contained_box2df_geometry">@(box2df,geometry)</a></span><span class="refpurpose"> — 単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)がジオメトリの2次元バウンディングボックスに包含される場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#is_contained_box2df_box2df">@(box2df,box2df)</a></span><span class="refpurpose"> — 二つの単精度浮動小数点数によるn次元バウンディングボックス (GIDX)の一方がもう一方を包含する場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Geometry_Overabove">|&amp;&gt;</a></span><span class="refpurpose"> — AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの上にある場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Geometry_Above">|&gt;&gt;</a></span><span class="refpurpose"> — Aのバウンダリボックスが、厳密にBのバウンダリボックスの上にある場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Geometry_Contain">~</a></span><span class="refpurpose"> — AのバウンディングボックスがBのバウンディングボックスを含む場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#contains_geometry_box2df">~(geometry,box2df)</a></span><span class="refpurpose"> — ジオメトリの (キャッシュされている)2次元バウンディングボックスが単精度浮動小数点数によるn次元バウンディングボックス (GIDX)を包含する場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#contains_box2df_geometry">~(box2df,geometry)</a></span><span class="refpurpose"> — 単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)をジオメトリの (キャッシュされている)2次元バウンディングボックスが包含する場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#contains_box2df_box2df">~(box2df,box2df)</a></span><span class="refpurpose"> — 二つの単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)の一方がもう一方を包含する場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Geometry_Same">~=</a></span><span class="refpurpose"> — AのバウンディングボックスがBのバウンディングボックスと同じ場合にTRUEを返します。</span></dt></dl></div><div class="refentry"><a name="geometry_overlaps"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>&amp;&amp; — Aの2次元バウンディングボックスがBの2次元バウンディングボックスとインタセクトする場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">&amp;&amp;</b>(</code> geometry  <var class="pdparam">A</var> ,  geometry  <var class="pdparam">B</var> <code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">&amp;&amp;</b>(</code> geography  <var class="pdparam">A</var> ,  geography  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp58341760"></a><h2>説明</h2><p><code class="varname">&amp;&amp;</code>演算子は、Aの2次元バウンディングボックスがBの2次元バウンディングボックスとインタセクトする場合に<code class="varname">TRUE</code>を返します。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これのオペランドは、ジオメトリで使用できるインデクスを使用します。</p></td></tr></table></div><p>Enhanced: 2.0.0 多面体サーフェス対応が導入されました。</p><p>Availability: 1.5.0 ジオグラフィ対応が導入されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p></div><div class="refsection"><a name="idp58347392"></a><h2>例</h2><pre class="programlisting">SELECT tbl1.column1, tbl2.column1, tbl1.column2 &amp;&amp; tbl2.column2 AS overlaps
FROM ( VALUES
        (1, 'LINESTRING(0 0, 3 3)'::geometry),
        (2, 'LINESTRING(0 1, 0 5)'::geometry)) AS tbl1,
( VALUES
        (3, 'LINESTRING(1 2, 4 6)'::geometry)) AS tbl2;

 column1 | column1 | overlaps
---------+---------+----------
           1 |       3 | t
           2 |       3 | f
(2 rows)</pre></div><div class="refsection"><a name="idp58348928"></a><h2>関連情報</h2><p><a class="xref" href="#">???</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#ST_Geometry_Overabove" title="|&amp;&gt;">|&amp;&gt;</a>, <a class="xref" href="#ST_Geometry_Overright" title="&amp;&gt;">&amp;&gt;</a>, <a class="xref" href="#ST_Geometry_Overbelow" title="&amp;&lt;|">&amp;&lt;|</a>, <a class="xref" href="#ST_Geometry_Overleft" title="&amp;&lt;">&amp;&lt;</a>, <a class="xref" href="#ST_Geometry_Contain" title="~">~</a>, <a class="xref" href="#ST_Geometry_Contained" title="@">@</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="overlaps_geometry_box2df"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>&amp;&amp;(geometry,box2df) — ジオメトリの (キャッシュされている)2次元バウンディングボックスが単精度浮動小数点数による2次元バウンディングボックスとインタセクトする場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">&amp;&amp;</b>(</code> geometry  <var class="pdparam">A</var> ,  box2df <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp58367616"></a><h2>説明</h2><p><code class="varname">&amp;&amp;</code>演算子は、ジオメトリAのキャッシュされた2次元バウンディングボックスが、2次元バウンディングボックスBとインタセクトする場合に、<code class="varname">TRUE</code>を返します。単精度浮動小数点数によるバウンディングボックスを使います。Bが倍精度浮動小数点数を使うbox2dである場合には、単精度浮動小数点数によるバウンディングボックス (BOX2DF)に変換されることになります。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この被演算子は、ユーザが使うためというよりも内部でBRINインデックスに使うために導入されました。</p></td></tr></table></div><p>Availability: 2.3.0 BRIN (Block Range INdexes)が導入されました。PostgreSQL 9.5以上が必要です。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p></div><div class="refsection"><a name="idp58372864"></a><h2>例</h2><pre class="programlisting">SELECT ST_Point(1,1) &amp;&amp; ST_MakeBox2D(ST_Point(0,0), ST_Point(2,2)) AS overlaps;

 overlaps
----------
 t
(1 row)</pre></div><div class="refsection"><a name="idp58374144"></a><h2>関連情報</h2><p><a class="xref" href="#overlaps_box2df_geometry" title="&amp;&amp;(box2df,geometry)">&amp;&amp;(box2df,geometry)</a>, <a class="xref" href="#overlaps_box2df_box2df" title="&amp;&amp;(box2df,box2df)">&amp;&amp;(box2df,box2df)</a>, <a class="xref" href="#contains_geometry_box2df" title="~(geometry,box2df)">~(geometry,box2df)</a>, <a class="xref" href="#contains_box2df_geometry" title="~(box2df,geometry)">~(box2df,geometry)</a>, <a class="xref" href="#contains_box2df_box2df" title="~(box2df,box2df)">~(box2df,box2df)</a>, <a class="xref" href="#is_contained_geometry_box2df" title="@(geometry,box2df)">@(geometry,box2df)</a>, <a class="xref" href="#is_contained_box2df_geometry" title="@(box2df,geometry)">@(box2df,geometry)</a>, <a class="xref" href="#is_contained_box2df_box2df" title="@(box2df,box2df)">@(box2df,box2df)</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="overlaps_box2df_geometry"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>&amp;&amp;(box2df,geometry) — 単精度浮動小数点数による2次元バウンディングボックスがジオメトリの (キャッシュされている)2次元バウンディングボックスとインタセクトする場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">&amp;&amp;</b>(</code> box2df  <var class="pdparam">A</var> ,  geometry  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp58384512"></a><h2>説明</h2><p><code class="varname">&amp;&amp;</code>演算子は、2次元バウンディングボックスAが、ジオメトリBのキャッシュされた2次元バウンディングボックスとインタセクトする場合に、<code class="varname">TRUE</code>を返します。単精度浮動小数点数によるバウンディングボックスを使います。Aが倍精度浮動小数点数を使うbox2dである場合には、単精度浮動小数点数によるバウンディングボックス (BOX2DF)に変換されることになります。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この被演算子は、ユーザが使うためというよりも内部でBRINインデックスに使うために導入されました。</p></td></tr></table></div><p>Availability: 2.3.0 BRIN (Block Range INdexes)が導入されました。PostgreSQL 9.5以上が必要です。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p></div><div class="refsection"><a name="idp58402048"></a><h2>例</h2><pre class="programlisting">SELECT ST_MakeBox2D(ST_Point(0,0), ST_Point(2,2)) &amp;&amp; ST_Point(1,1) AS overlaps;

 overlaps
----------
 t
(1 row)</pre></div><div class="refsection"><a name="idp58403328"></a><h2>関連情報</h2><p><a class="xref" href="#overlaps_geometry_box2df" title="&amp;&amp;(geometry,box2df)">&amp;&amp;(geometry,box2df)</a>, <a class="xref" href="#overlaps_box2df_box2df" title="&amp;&amp;(box2df,box2df)">&amp;&amp;(box2df,box2df)</a>, <a class="xref" href="#contains_geometry_box2df" title="~(geometry,box2df)">~(geometry,box2df)</a>, <a class="xref" href="#contains_box2df_geometry" title="~(box2df,geometry)">~(box2df,geometry)</a>, <a class="xref" href="#contains_box2df_box2df" title="~(box2df,box2df)">~(box2df,box2df)</a>, <a class="xref" href="#is_contained_geometry_box2df" title="@(geometry,box2df)">@(geometry,box2df)</a>, <a class="xref" href="#is_contained_box2df_geometry" title="@(box2df,geometry)">@(box2df,geometry)</a>, <a class="xref" href="#is_contained_box2df_box2df" title="@(box2df,box2df)">@(box2df,box2df)</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="overlaps_box2df_box2df"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>&amp;&amp;(box2df,box2df) — 二つの単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)が相互にインタセクトする場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">&amp;&amp;</b>(</code> box2df  <var class="pdparam">A</var> ,  box2df  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp58413696"></a><h2>説明</h2><p><code class="varname">&amp;&amp;</code>演算子は、2次元バウンディングボックスAとBが相互にインタセクトする場合に、<code class="varname">TRUE</code>を返します。単精度浮動小数点数によるバウンディングボックスを使います。AまたはBが倍精度浮動小数点数を使うbox2dである場合には、バウンディングボックス (BOX2DF)に変換されることになります。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この演算子は、ユーザが使うためというよりも内部でBRINインデックスに使うために導入されました。</p></td></tr></table></div><p>Availability: 2.3.0 BRIN (Block Range INdexes)が導入されました。PostgreSQL 9.5以上が必要です。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p></div><div class="refsection"><a name="idp58418944"></a><h2>例</h2><pre class="programlisting">SELECT ST_MakeBox2D(ST_Point(0,0), ST_Point(2,2)) &amp;&amp; ST_MakeBox2D(ST_Point(1,1), ST_Point(3,3)) AS overlaps;

 overlaps
----------
 t
(1 row)</pre></div><div class="refsection"><a name="idp58420224"></a><h2>関連情報</h2><p><a class="xref" href="#overlaps_geometry_box2df" title="&amp;&amp;(geometry,box2df)">&amp;&amp;(geometry,box2df)</a>, <a class="xref" href="#overlaps_box2df_geometry" title="&amp;&amp;(box2df,geometry)">&amp;&amp;(box2df,geometry)</a>, <a class="xref" href="#contains_geometry_box2df" title="~(geometry,box2df)">~(geometry,box2df)</a>, <a class="xref" href="#contains_box2df_geometry" title="~(box2df,geometry)">~(box2df,geometry)</a>, <a class="xref" href="#contains_box2df_box2df" title="~(box2df,box2df)">~(box2df,box2df)</a>, <a class="xref" href="#is_contained_geometry_box2df" title="@(geometry,box2df)">@(geometry,box2df)</a>, <a class="xref" href="#is_contained_box2df_geometry" title="@(box2df,geometry)">@(box2df,geometry)</a>, <a class="xref" href="#is_contained_box2df_box2df" title="@(box2df,box2df)">@(box2df,box2df)</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="geometry_overlaps_nd"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>&amp;&amp;&amp; — Aのn次元バウンディングボックスがBのn次元バウンディングボックスとインタセクトする場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">&amp;&amp;&amp;</b>(</code> geometry  <var class="pdparam">A</var> ,  geometry  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp58430592"></a><h2>説明</h2><p><code class="varname">&amp;&amp;&amp;</code>演算子は、Aのn次元バウンディングボックスがBのn次元バウンディングボックスとインタセクトする場合に<code class="varname">TRUE</code>を返します。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これのオペランドは、ジオメトリで使用できるインデクスを使用します。</p></td></tr></table></div><p>Availability: 2.0.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp58438656"></a><h2>例: 3次元ラインストリング</h2><pre class="programlisting">SELECT tbl1.column1, tbl2.column1, tbl1.column2 &amp;&amp;&amp; tbl2.column2 AS overlaps_3d,
                                    tbl1.column2 &amp;&amp; tbl2.column2 AS overlaps_2d
FROM ( VALUES
        (1, 'LINESTRING Z(0 0 1, 3 3 2)'::geometry),
        (2, 'LINESTRING Z(1 2 0, 0 5 -1)'::geometry)) AS tbl1,
( VALUES
        (3, 'LINESTRING Z(1 2 1, 4 6 1)'::geometry)) AS tbl2;

 column1 | column1 | overlaps_3d | overlaps_2d
---------+---------+-------------+-------------
       1 |       3 | t           | t
       2 |       3 | f           | t
</pre></div><div class="refsection"><a name="idp58439936"></a><h2>例: XYMラインストリング</h2><pre class="programlisting">SELECT tbl1.column1, tbl2.column1, tbl1.column2 &amp;&amp;&amp; tbl2.column2 AS overlaps_3zm,
                                    tbl1.column2 &amp;&amp; tbl2.column2 AS overlaps_2d
FROM ( VALUES
        (1, 'LINESTRING M(0 0 1, 3 3 2)'::geometry),
        (2, 'LINESTRING M(1 2 0, 0 5 -1)'::geometry)) AS tbl1,
( VALUES
        (3, 'LINESTRING M(1 2 1, 4 6 1)'::geometry)) AS tbl2;

 column1 | column1 | overlaps_3zm | overlaps_2d
---------+---------+-------------+-------------
       1 |       3 | t           | t
       2 |       3 | f           | t
</pre></div><div class="refsection"><a name="idp58441216"></a><h2>関連情報</h2><p><a class="xref" href="#geometry_overlaps" title="&amp;&amp;">&amp;&amp;</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="overlaps_nd_geometry_gidx"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>&amp;&amp;&amp;(geometry,gidx) — ジオメトリの (キャッシュされている)n次元バウンディングボックスが単精度浮動小数点数によるn次元バウンディングボックス (GIDX)とインタセクトする場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">&amp;&amp;&amp;</b>(</code> geometry  <var class="pdparam">A</var> ,  gidx  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp58448896"></a><h2>説明</h2><p><code class="varname">&amp;&amp;&amp;</code>演算子は、ジオメトリAのキャッシュされたn次元バウンディングボックスが、n次元バウンディングボックスBとインタセクトする場合に、<code class="varname">TRUE</code>を返します。単精度浮動小数点数によるバウンディングボックスを使います。Bが倍精度浮動小数点数を使うbox3dである場合には、単精度浮動小数点数による3次元バウンディングボックス (GIDX)に変換されることになります。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この演算子は、ユーザが使うためというよりも内部でBRINインデックスに使うために導入されました。</p></td></tr></table></div><p>Availability: 2.3.0 BRIN (Block Range INdexes)が導入されました。PostgreSQL 9.5以上が必要です。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp58477440"></a><h2>例</h2><pre class="programlisting">SELECT ST_MakePoint(1,1,1) &amp;&amp;&amp; ST_3DMakeBox(ST_MakePoint(0,0,0), ST_MakePoint(2,2,2)) AS overlaps;

 overlaps
----------
 t
(1 row)</pre></div><div class="refsection"><a name="idp58478720"></a><h2>関連情報</h2><p><a class="xref" href="#overlaps_nd_gidx_geometry" title="&amp;&amp;&amp;(gidx,geometry)">&amp;&amp;&amp;(gidx,geometry)</a>, <a class="xref" href="#overlaps_nd_gidx_gidx" title="&amp;&amp;&amp;(gidx,gidx)">&amp;&amp;&amp;(gidx,gidx)</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="overlaps_nd_gidx_geometry"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>&amp;&amp;&amp;(gidx,geometry) — 単精度浮動小数点数によるn次元バウンディングボックス (GIDX)がジオメトリの (キャッシュされている)n次元バウンディングボックスとインタセクトする場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">&amp;&amp;&amp;</b>(</code> gidx  <var class="pdparam">A</var> ,  geometry  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp58486784"></a><h2>説明</h2><p><code class="varname">&amp;&amp;&amp;</code>演算子は、n次元バウンディングボックスAが、ジオメトリBのキャッシュされたn次元バウンディングボックスとインタセクトする場合に、<code class="varname">TRUE</code>を返します。単精度浮動小数点数によるバウンディングボックスを使います。Aが倍精度浮動小数点数を使うbox3dである場合には、単精度浮動小数点数による3次元バウンディングボックス (GIDX)に変換されることになります。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この演算子は、ユーザが使うためというよりも内部でBRINインデックスに使うために導入されました。</p></td></tr></table></div><p>Availability: 2.3.0 BRIN (Block Range INdexes)が導入されました。PostgreSQL 9.5以上が必要です。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp58494848"></a><h2>例</h2><pre class="programlisting">SELECT ST_3DMakeBox(ST_MakePoint(0,0,0), ST_MakePoint(2,2,2)) &amp;&amp;&amp; ST_MakePoint(1,1,1) AS overlaps;

 overlaps
----------
 t
(1 row)</pre></div><div class="refsection"><a name="idp58496128"></a><h2>関連情報</h2><p><a class="xref" href="#overlaps_nd_geometry_gidx" title="&amp;&amp;&amp;(geometry,gidx)">&amp;&amp;&amp;(geometry,gidx)</a>, <a class="xref" href="#overlaps_nd_gidx_gidx" title="&amp;&amp;&amp;(gidx,gidx)">&amp;&amp;&amp;(gidx,gidx)</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="overlaps_nd_gidx_gidx"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>&amp;&amp;&amp;(gidx,gidx) — 二つの単精度浮動小数点数によるn次元バウンディングボックス (GIDX)が相互にインタセクトする場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">&amp;&amp;&amp;</b>(</code> gidx  <var class="pdparam">A</var> ,  gidx  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp58504192"></a><h2>説明</h2><p><code class="varname">&amp;&amp;&amp;</code>演算子は、n次元バウンディングボックスAとBが相互にインタセクトする場合に、<code class="varname">TRUE</code>を返します。単精度浮動小数点数によるバウンディングボックスを使います。AまたはBが倍精度浮動小数点数を使うbox3dである場合には、単精度浮動小数点数による3次元バウンディングボックス (GIDX)に変換されることになります。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この演算子は、ユーザが使うためというよりも内部でBRINインデックスに使うために導入されました。</p></td></tr></table></div><p>Availability: 2.3.0 BRIN (Block Range INdexes)が導入されました。PostgreSQL 9.5以上が必要です。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp58545024"></a><h2>例</h2><pre class="programlisting">SELECT ST_3DMakeBox(ST_MakePoint(0,0,0), ST_MakePoint(2,2,2)) &amp;&amp;&amp; ST_3DMakeBox(ST_MakePoint(1,1,1), ST_MakePoint(3,3,3)) AS overlaps;

 overlaps
----------
 t
(1 row)</pre></div><div class="refsection"><a name="idp58546304"></a><h2>関連情報</h2><p><a class="xref" href="#overlaps_nd_geometry_gidx" title="&amp;&amp;&amp;(geometry,gidx)">&amp;&amp;&amp;(geometry,gidx)</a>, <a class="xref" href="#overlaps_nd_gidx_geometry" title="&amp;&amp;&amp;(gidx,geometry)">&amp;&amp;&amp;(gidx,geometry)</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Geometry_Overleft"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>&amp;&lt; — AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの左にある場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">&amp;&lt;</b>(</code> geometry  <var class="pdparam">A</var> ,  geometry  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp58558464"></a><h2>説明</h2><p><code class="varname">&amp;&lt;</code>演算子は、AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの左にある場合に<code class="varname">TRUE</code>を返します。条件についてより詳細に言うと、BのバウンディングボックスをオーバラップするかBのバウンディングボックスの右に*ない*場合です。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これのオペランドは、ジオメトリで使用できるインデクスを使用します。</p></td></tr></table></div></div><div class="refsection"><a name="idp58560768"></a><h2>例</h2><pre class="programlisting">SELECT tbl1.column1, tbl2.column1, tbl1.column2 &amp;&lt; tbl2.column2 AS overleft
FROM
  ( VALUES
        (1, 'LINESTRING(1 2, 4 6)'::geometry)) AS tbl1,
  ( VALUES
        (2, 'LINESTRING(0 0, 3 3)'::geometry),
        (3, 'LINESTRING(0 1, 0 5)'::geometry),
        (4, 'LINESTRING(6 0, 6 1)'::geometry)) AS tbl2;

 column1 | column1 | overleft
---------+---------+----------
           1 |       2 | f
           1 |       3 | f
           1 |       4 | t
(3 rows)</pre></div><div class="refsection"><a name="idp58562048"></a><h2>関連情報</h2><p><a class="xref" href="#geometry_overlaps" title="&amp;&amp;">&amp;&amp;</a>, <a class="xref" href="#ST_Geometry_Overabove" title="|&amp;&gt;">|&amp;&gt;</a>, <a class="xref" href="#ST_Geometry_Overright" title="&amp;&gt;">&amp;&gt;</a>, <a class="xref" href="#ST_Geometry_Overbelow" title="&amp;&lt;|">&amp;&lt;|</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Geometry_Overbelow"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>&amp;&lt;| — AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの下にある場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">&amp;&lt;|</b>(</code> geometry  <var class="pdparam">A</var> ,  geometry  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp58574976"></a><h2>説明</h2><p><code class="varname">&amp;&lt;|</code>演算子は、AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの下にある場合に<code class="varname">TRUE</code>を返します。条件についてより詳細に言うと、BのバウンディングボックスをオーバラップするかBのバウンディングボックスの上に*ない*場合です。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これのオペランドは、ジオメトリで使用できるインデクスを使用します。</p></td></tr></table></div></div><div class="refsection"><a name="idp58579840"></a><h2>例</h2><pre class="programlisting">SELECT tbl1.column1, tbl2.column1, tbl1.column2 &amp;&lt;| tbl2.column2 AS overbelow
FROM
  ( VALUES
        (1, 'LINESTRING(6 0, 6 4)'::geometry)) AS tbl1,
  ( VALUES
        (2, 'LINESTRING(0 0, 3 3)'::geometry),
        (3, 'LINESTRING(0 1, 0 5)'::geometry),
        (4, 'LINESTRING(1 2, 4 6)'::geometry)) AS tbl2;

 column1 | column1 | overbelow
---------+---------+-----------
           1 |       2 | f
           1 |       3 | t
           1 |       4 | t
(3 rows)</pre></div><div class="refsection"><a name="idp58581120"></a><h2>関連情報</h2><p><a class="xref" href="#geometry_overlaps" title="&amp;&amp;">&amp;&amp;</a>, <a class="xref" href="#ST_Geometry_Overabove" title="|&amp;&gt;">|&amp;&gt;</a>, <a class="xref" href="#ST_Geometry_Overright" title="&amp;&gt;">&amp;&gt;</a>, <a class="xref" href="#ST_Geometry_Overleft" title="&amp;&lt;">&amp;&lt;</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Geometry_Overright"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>&amp;&gt; — AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの右にある場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">&amp;&gt;</b>(</code> geometry  <var class="pdparam">A</var> ,  geometry  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp58589952"></a><h2>説明</h2><p><code class="varname">&amp;&gt;</code>演算子は、AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの右にある場合に<code class="varname">TRUE</code>を返します。条件についてより詳細に言うと、BのバウンディングボックスをオーバラップするかBのバウンディングボックスの左に*ない*場合です。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これのオペランドは、ジオメトリで使用できるインデクスを使用します。</p></td></tr></table></div></div><div class="refsection"><a name="idp58592256"></a><h2>例</h2><pre class="programlisting">SELECT tbl1.column1, tbl2.column1, tbl1.column2 &amp;&gt; tbl2.column2 AS overright
FROM
  ( VALUES
        (1, 'LINESTRING(1 2, 4 6)'::geometry)) AS tbl1,
  ( VALUES
        (2, 'LINESTRING(0 0, 3 3)'::geometry),
        (3, 'LINESTRING(0 1, 0 5)'::geometry),
        (4, 'LINESTRING(6 0, 6 1)'::geometry)) AS tbl2;

 column1 | column1 | overright
---------+---------+-----------
           1 |       2 | t
           1 |       3 | t
           1 |       4 | f
(3 rows)</pre></div><div class="refsection"><a name="idp58593536"></a><h2>関連情報</h2><p><a class="xref" href="#geometry_overlaps" title="&amp;&amp;">&amp;&amp;</a>, <a class="xref" href="#ST_Geometry_Overabove" title="|&amp;&gt;">|&amp;&gt;</a>, <a class="xref" href="#ST_Geometry_Overbelow" title="&amp;&lt;|">&amp;&lt;|</a>, <a class="xref" href="#ST_Geometry_Overleft" title="&amp;&lt;">&amp;&lt;</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Geometry_Left"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>&lt;&lt; — Aのバウンダリボックスが、厳密にBのバウンダリボックスの左にある場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">&lt;&lt;</b>(</code> geometry  <var class="pdparam">A</var> ,  geometry  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp58602368"></a><h2>説明</h2><p><code class="varname">&lt;&lt;</code>演算子はAのバウンダリボックスが、厳密にBのバウンダリボックスの左にある場合に<code class="varname">TRUE</code>を返します。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これのオペランドは、ジオメトリで使用できるインデクスを使用します。</p></td></tr></table></div></div><div class="refsection"><a name="idp58604800"></a><h2>例</h2><pre class="programlisting">SELECT tbl1.column1, tbl2.column1, tbl1.column2 &lt;&lt; tbl2.column2 AS left
FROM
  ( VALUES
        (1, 'LINESTRING (1 2, 1 5)'::geometry)) AS tbl1,
  ( VALUES
        (2, 'LINESTRING (0 0, 4 3)'::geometry),
        (3, 'LINESTRING (6 0, 6 5)'::geometry),
        (4, 'LINESTRING (2 2, 5 6)'::geometry)) AS tbl2;

 column1 | column1 | left
---------+---------+------
           1 |       2 | f
           1 |       3 | t
           1 |       4 | t
(3 rows)</pre></div><div class="refsection"><a name="idp58606080"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Geometry_Right" title="&gt;&gt;">&gt;&gt;</a>, <a class="xref" href="#ST_Geometry_Above" title="|&gt;&gt;">|&gt;&gt;</a>, <a class="xref" href="#ST_Geometry_Below" title="&lt;&lt;|">&lt;&lt;|</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Geometry_Below"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>&lt;&lt;| — Aのバウンダリボックスが、厳密にBのバウンダリボックスの下にある場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">&lt;&lt;|</b>(</code> geometry  <var class="pdparam">A</var> ,  geometry  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp58614528"></a><h2>説明</h2><p><code class="varname">&lt;&lt;|</code>演算子は、Aのバウンダリボックスが、厳密にBのバウンダリボックスの下にある場合に<code class="varname">TRUE</code>を返します。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これのオペランドは、ジオメトリで使用できるインデクスを使用します。</p></td></tr></table></div></div><div class="refsection"><a name="idp58616960"></a><h2>例</h2><pre class="programlisting">SELECT tbl1.column1, tbl2.column1, tbl1.column2 &lt;&lt;| tbl2.column2 AS below
FROM
  ( VALUES
        (1, 'LINESTRING (0 0, 4 3)'::geometry)) AS tbl1,
  ( VALUES
        (2, 'LINESTRING (1 4, 1 7)'::geometry),
        (3, 'LINESTRING (6 1, 6 5)'::geometry),
        (4, 'LINESTRING (2 3, 5 6)'::geometry)) AS tbl2;

 column1 | column1 | below
---------+---------+-------
           1 |       2 | t
           1 |       3 | f
           1 |       4 | f
(3 rows)</pre></div><div class="refsection"><a name="idp58618240"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Geometry_Left" title="&lt;&lt;">&lt;&lt;</a>, <a class="xref" href="#ST_Geometry_Right" title="&gt;&gt;">&gt;&gt;</a>, <a class="xref" href="#ST_Geometry_Above" title="|&gt;&gt;">|&gt;&gt;</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Geometry_EQ"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>= — ジオメトリ/ジオグラフィ Aの座標と座標の並び順がジオメトリ/ジオグラフィ Bと同じ場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">=</b>(</code> geometry  <var class="pdparam">A</var> ,  geometry  <var class="pdparam">B</var> <code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">=</b>(</code> geography  <var class="pdparam">A</var> ,  geography  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp58630528"></a><h2>説明</h2><p><code class="varname">=</code>演算子は、ジオメトリ/ジオグラフィ Aの座標と座標の並び順がジオメトリ/ジオグラフィ Bと同じ場合に<code class="varname">TRUE</code>を返します。PostgreSQLは、ジオメトリの内部の順位付けと比較 (GROUP BYやORDER BY節などで使います)のために、ジオメトリ用に定義されている=, &lt;および&gt; 演算子を使います。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この演算子は、同じ座標値と並び順である、全ての点で確実に同じジオメトリ/ジオグラフィだけを同じと考えます。「空間的に等価」、つまり、並び順は無視し、異なる表現でも同じ空間領域を占めるかどうかをテストするには、<a class="xref" href="#">???</a>または<a class="xref" href="#">???</a>を使います。</p></td></tr></table></div><div class="caution"><table border="0" summary="Caution"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注意]" src="images/caution.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この演算子は、ジオメトリで有効なインデックスを一切*使いません*。インデックスを使った確実な等価性試験を行うには、=と&amp;&amp;を併用します。</p></td></tr></table></div><p>Changed: 2.4.0, 以前の版では、ジオメトリ自体の等価性でなくバウンディングボックスが等価かどうかを見ていました。バウンディングボックスが等価かどうかを知る必要がある場合には、替わりに<a class="xref" href="#ST_Geometry_Same" title="~=">~=</a>を使います。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p></div><div class="refsection"><a name="idp57007488"></a><h2>例</h2><pre class="programlisting">SELECT 'LINESTRING(0 0, 0 1, 1 0)'::geometry = 'LINESTRING(1 1, 0 0)'::geometry;
 ?column?
----------
 f
(1 row)

SELECT ST_AsText(column1)
FROM ( VALUES
        ('LINESTRING(0 0, 1 1)'::geometry),
        ('LINESTRING(1 1, 0 0)'::geometry)) AS foo;
          st_astext
---------------------
 LINESTRING(0 0,1 1)
 LINESTRING(1 1,0 0)
(2 rows)

-- ご注意: GROUP BYは、ジオメトリの等価性比較のために"="を使います。
SELECT ST_AsText(column1)
FROM ( VALUES
        ('LINESTRING(0 0, 1 1)'::geometry),
        ('LINESTRING(1 1, 0 0)'::geometry)) AS foo
GROUP BY column1;
      st_astext
---------------------
 LINESTRING(0 0,1 1)
 LINESTRING(1 1,0 0)
(2 rows)

-- 2.0より前ではTRUEを返しました --
 SELECT ST_GeomFromText('POINT(1707296.37 4820536.77)') =
        ST_GeomFromText('POINT(1707296.27 4820536.87)') As pt_intersect;

--pt_intersect --
f
</pre></div><div class="refsection"><a name="idp57008768"></a><h2>関連情報</h2><p><a class="xref" href="#">???</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#ST_Geometry_Same" title="~=">~=</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Geometry_Right"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>&gt;&gt; — Aのバウンダリボックスが、厳密にBのバウンダリボックスの右にある場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">&gt;&gt;</b>(</code> geometry  <var class="pdparam">A</var> ,  geometry  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp58643456"></a><h2>説明</h2><p><code class="varname">&gt;&gt;</code>演算子は、Aのバウンダリボックスが、厳密にBのバウンダリボックスの右にある場合に<code class="varname">TRUE</code>を返します。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これのオペランドは、ジオメトリで使用できるインデクスを使用します。</p></td></tr></table></div></div><div class="refsection"><a name="idp58645888"></a><h2>例</h2><pre class="programlisting">SELECT tbl1.column1, tbl2.column1, tbl1.column2 &gt;&gt; tbl2.column2 AS right
FROM
  ( VALUES
        (1, 'LINESTRING (2 3, 5 6)'::geometry)) AS tbl1,
  ( VALUES
        (2, 'LINESTRING (1 4, 1 7)'::geometry),
        (3, 'LINESTRING (6 1, 6 5)'::geometry),
        (4, 'LINESTRING (0 0, 4 3)'::geometry)) AS tbl2;

 column1 | column1 | right
---------+---------+-------
           1 |       2 | t
           1 |       3 | f
           1 |       4 | f
(3 rows)</pre></div><div class="refsection"><a name="idp58647168"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Geometry_Left" title="&lt;&lt;">&lt;&lt;</a>, <a class="xref" href="#ST_Geometry_Above" title="|&gt;&gt;">|&gt;&gt;</a>, <a class="xref" href="#ST_Geometry_Below" title="&lt;&lt;|">&lt;&lt;|</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Geometry_Contained"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>@ — AのバウンダリボックスがBのバウンダリボックスに含まれている場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">@</b>(</code> geometry  <var class="pdparam">A</var> ,  geometry  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp57541504"></a><h2>説明</h2><p><code class="varname">@</code>演算子は、AのバウンダリボックスがBのバウンダリボックスに、完全に含まれている場合に<code class="varname">TRUE</code>を返します。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これのオペランドは、ジオメトリで使用できるインデクスを使用します。</p></td></tr></table></div></div><div class="refsection"><a name="idp57544192"></a><h2>例</h2><pre class="programlisting">SELECT tbl1.column1, tbl2.column1, tbl1.column2 @ tbl2.column2 AS contained
FROM
  ( VALUES
        (1, 'LINESTRING (1 1, 3 3)'::geometry)) AS tbl1,
  ( VALUES
        (2, 'LINESTRING (0 0, 4 4)'::geometry),
        (3, 'LINESTRING (2 2, 4 4)'::geometry),
        (4, 'LINESTRING (1 1, 3 3)'::geometry)) AS tbl2;

 column1 | column1 | contained
---------+---------+-----------
           1 |       2 | t
           1 |       3 | f
           1 |       4 | t
(3 rows)</pre></div><div class="refsection"><a name="idp57545472"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Geometry_Contain" title="~">~</a>, <a class="xref" href="#geometry_overlaps" title="&amp;&amp;">&amp;&amp;</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="is_contained_geometry_box2df"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>@(geometry,box2df) — ジオメトリの2次元バウンディングボックスが単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)に包含される場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">@</b>(</code> geometry  <var class="pdparam">A</var> ,  box2df  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp57553536"></a><h2>説明</h2><p><code class="varname">@</code>演算子は、ジオメトリAの2次元バウンディングボックスが、2次元バウンディングボックスBに包含される場合に、<code class="varname">TRUE</code>を返します。単精度浮動小数点数によるバウンディングボックスを使います。Bが倍精度浮動小数点数を使うbox2dである場合には、単精度浮動小数点数によるバウンディングボックス (BOX2DF)に変換されることになります。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この被演算子は、ユーザが使うためというよりも内部でBRINインデックスに使うために導入されました。</p></td></tr></table></div><p>Availability: 2.3.0 BRIN (Block Range INdexes)が導入されました。PostgreSQL 9.5以上が必要です。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p></div><div class="refsection"><a name="idp57558784"></a><h2>例</h2><pre class="programlisting">SELECT ST_Buffer(ST_GeomFromText('POINT(2 2)'), 1) @ ST_MakeBox2D(ST_Point(0,0), ST_Point(5,5)) AS is_contained;

 is_contained
--------------
 t
(1 row)</pre></div><div class="refsection"><a name="idp57560064"></a><h2>関連情報</h2><p><a class="xref" href="#overlaps_geometry_box2df" title="&amp;&amp;(geometry,box2df)">&amp;&amp;(geometry,box2df)</a>, <a class="xref" href="#overlaps_box2df_geometry" title="&amp;&amp;(box2df,geometry)">&amp;&amp;(box2df,geometry)</a>, <a class="xref" href="#overlaps_box2df_box2df" title="&amp;&amp;(box2df,box2df)">&amp;&amp;(box2df,box2df)</a>, <a class="xref" href="#contains_geometry_box2df" title="~(geometry,box2df)">~(geometry,box2df)</a>, <a class="xref" href="#contains_box2df_geometry" title="~(box2df,geometry)">~(box2df,geometry)</a>, <a class="xref" href="#contains_box2df_box2df" title="~(box2df,box2df)">~(box2df,box2df)</a>, <a class="xref" href="#is_contained_box2df_geometry" title="@(box2df,geometry)">@(box2df,geometry)</a>, <a class="xref" href="#is_contained_box2df_box2df" title="@(box2df,box2df)">@(box2df,box2df)</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="is_contained_box2df_geometry"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>@(box2df,geometry) — 単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)がジオメトリの2次元バウンディングボックスに包含される場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">@</b>(</code> box2df  <var class="pdparam">A</var> ,  geometry  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp58655872"></a><h2>説明</h2><p><code class="varname">@</code>演算子は、2次元バウンディングボックスAが、ジオメトリBの2次元バウンディングボックスに包含される場合に、<code class="varname">TRUE</code>を返します。単精度浮動小数点数によるバウンディングボックスを使います。Aが倍精度浮動小数点数を使うbox2dである場合には、単精度浮動小数点数によるバウンディングボックス (BOX2DF)に変換されることになります。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この被演算子は、ユーザが使うためというよりも内部でBRINインデックスに使うために導入されました。</p></td></tr></table></div><p>Availability: 2.3.0 BRIN (Block Range INdexes)が導入されました。PostgreSQL 9.5以上が必要です。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p></div><div class="refsection"><a name="idp58661120"></a><h2>例</h2><pre class="programlisting">SELECT ST_MakeBox2D(ST_Point(2,2), ST_Point(3,3)) @ ST_Buffer(ST_GeomFromText('POINT(1 1)'), 10) AS is_contained;

 is_contained
--------------
 t
(1 row)</pre></div><div class="refsection"><a name="idp58662400"></a><h2>関連情報</h2><p><a class="xref" href="#overlaps_geometry_box2df" title="&amp;&amp;(geometry,box2df)">&amp;&amp;(geometry,box2df)</a>, <a class="xref" href="#overlaps_box2df_geometry" title="&amp;&amp;(box2df,geometry)">&amp;&amp;(box2df,geometry)</a>, <a class="xref" href="#overlaps_box2df_box2df" title="&amp;&amp;(box2df,box2df)">&amp;&amp;(box2df,box2df)</a>, <a class="xref" href="#contains_geometry_box2df" title="~(geometry,box2df)">~(geometry,box2df)</a>, <a class="xref" href="#contains_box2df_geometry" title="~(box2df,geometry)">~(box2df,geometry)</a>, <a class="xref" href="#contains_box2df_box2df" title="~(box2df,box2df)">~(box2df,box2df)</a>, <a class="xref" href="#is_contained_geometry_box2df" title="@(geometry,box2df)">@(geometry,box2df)</a>, <a class="xref" href="#is_contained_box2df_box2df" title="@(box2df,box2df)">@(box2df,box2df)</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="is_contained_box2df_box2df"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>@(box2df,box2df) — 二つの単精度浮動小数点数によるn次元バウンディングボックス (GIDX)の一方がもう一方を包含する場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">@</b>(</code> box2df  <var class="pdparam">A</var> ,  box2df  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp58676864"></a><h2>説明</h2><p><code class="varname">@</code>演算子は、2次元バウンディングボックスAが2次元バウンディングボックスBに包含される場合には、<code class="varname">TRUE</code>を返します。単精度浮動小数点数によるバウンディングボックスを使います。AまたはBが倍精度浮動小数点数を使うbox2dである場合には、単精度浮動小数点数によるバウンディングボックス (BOX2DF)に変換されることになります。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この被演算子は、ユーザが使うためというよりも内部でBRINインデックスに使うために導入されました。</p></td></tr></table></div><p>Availability: 2.3.0 BRIN (Block Range INdexes)が導入されました。PostgreSQL 9.5以上が必要です。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p></div><div class="refsection"><a name="idp58682112"></a><h2>例</h2><pre class="programlisting">SELECT ST_MakeBox2D(ST_Point(2,2), ST_Point(3,3)) @ ST_MakeBox2D(ST_Point(0,0), ST_Point(5,5)) AS is_contained;

 is_contained
--------------
 t
(1 row)</pre></div><div class="refsection"><a name="idp58683392"></a><h2>関連情報</h2><p><a class="xref" href="#overlaps_geometry_box2df" title="&amp;&amp;(geometry,box2df)">&amp;&amp;(geometry,box2df)</a>, <a class="xref" href="#overlaps_box2df_geometry" title="&amp;&amp;(box2df,geometry)">&amp;&amp;(box2df,geometry)</a>, <a class="xref" href="#overlaps_box2df_box2df" title="&amp;&amp;(box2df,box2df)">&amp;&amp;(box2df,box2df)</a>, <a class="xref" href="#contains_geometry_box2df" title="~(geometry,box2df)">~(geometry,box2df)</a>, <a class="xref" href="#contains_box2df_geometry" title="~(box2df,geometry)">~(box2df,geometry)</a>, <a class="xref" href="#contains_box2df_box2df" title="~(box2df,box2df)">~(box2df,box2df)</a>, <a class="xref" href="#is_contained_geometry_box2df" title="@(geometry,box2df)">@(geometry,box2df)</a>, <a class="xref" href="#is_contained_box2df_geometry" title="@(box2df,geometry)">@(box2df,geometry)</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Geometry_Overabove"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>|&amp;&gt; — AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの上にある場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">|&amp;&gt;</b>(</code> geometry  <var class="pdparam">A</var> ,  geometry  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp58693760"></a><h2>説明</h2><p><code class="varname">|&amp;&gt;</code>演算子は、AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの上にある場合に<code class="varname">TRUE</code>を返します。条件についてより詳細に言うと、BのバウンディングボックスをオーバラップするかBのバウンディングボックスの下に*ない*場合です。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これのオペランドは、ジオメトリで使用できるインデクスを使用します。</p></td></tr></table></div></div><div class="refsection"><a name="idp58696064"></a><h2>例</h2><pre class="programlisting">SELECT tbl1.column1, tbl2.column1, tbl1.column2 |&amp;&gt; tbl2.column2 AS overabove
FROM
  ( VALUES
        (1, 'LINESTRING(6 0, 6 4)'::geometry)) AS tbl1,
  ( VALUES
        (2, 'LINESTRING(0 0, 3 3)'::geometry),
        (3, 'LINESTRING(0 1, 0 5)'::geometry),
        (4, 'LINESTRING(1 2, 4 6)'::geometry)) AS tbl2;

 column1 | column1 | overabove
---------+---------+-----------
           1 |       2 | t
           1 |       3 | f
           1 |       4 | f
(3 rows)</pre></div><div class="refsection"><a name="idp58697344"></a><h2>関連情報</h2><p><a class="xref" href="#geometry_overlaps" title="&amp;&amp;">&amp;&amp;</a>, <a class="xref" href="#ST_Geometry_Overright" title="&amp;&gt;">&amp;&gt;</a>, <a class="xref" href="#ST_Geometry_Overbelow" title="&amp;&lt;|">&amp;&lt;|</a>, <a class="xref" href="#ST_Geometry_Overleft" title="&amp;&lt;">&amp;&lt;</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Geometry_Above"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>|&gt;&gt; — Aのバウンダリボックスが、厳密にBのバウンダリボックスの上にある場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">|&gt;&gt;</b>(</code> geometry  <var class="pdparam">A</var> ,  geometry  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp58726656"></a><h2>説明</h2><p><code class="varname">|&gt;&gt;</code>演算子は、Aのバウンダリボックスが、厳密にBのバウンダリボックスの上にある場合に<code class="varname">TRUE</code>を返します。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これのオペランドは、ジオメトリで使用できるインデクスを使用します。</p></td></tr></table></div></div><div class="refsection"><a name="idp58729088"></a><h2>例</h2><pre class="programlisting">SELECT tbl1.column1, tbl2.column1, tbl1.column2 |&gt;&gt; tbl2.column2 AS above
FROM
  ( VALUES
        (1, 'LINESTRING (1 4, 1 7)'::geometry)) AS tbl1,
  ( VALUES
        (2, 'LINESTRING (0 0, 4 2)'::geometry),
        (3, 'LINESTRING (6 1, 6 5)'::geometry),
        (4, 'LINESTRING (2 3, 5 6)'::geometry)) AS tbl2;

 column1 | column1 | above
---------+---------+-------
           1 |       2 | t
           1 |       3 | f
           1 |       4 | f
(3 rows)</pre></div><div class="refsection"><a name="idp58730368"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Geometry_Left" title="&lt;&lt;">&lt;&lt;</a>, <a class="xref" href="#ST_Geometry_Right" title="&gt;&gt;">&gt;&gt;</a>, <a class="xref" href="#ST_Geometry_Below" title="&lt;&lt;|">&lt;&lt;|</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Geometry_Contain"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>~ — AのバウンディングボックスがBのバウンディングボックスを含む場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">~</b>(</code> geometry  <var class="pdparam">A</var> ,  geometry  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp58738816"></a><h2>説明</h2><p><code class="varname">~</code>演算子は、AのバウンディングボックスがBのバウンディングボックスを、完全に含む場合に<code class="varname">TRUE</code>を返します。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これのオペランドは、ジオメトリで使用できるインデクスを使用します。</p></td></tr></table></div></div><div class="refsection"><a name="idp58741248"></a><h2>例</h2><pre class="programlisting">SELECT tbl1.column1, tbl2.column1, tbl1.column2 ~ tbl2.column2 AS contains
FROM
  ( VALUES
        (1, 'LINESTRING (0 0, 3 3)'::geometry)) AS tbl1,
  ( VALUES
        (2, 'LINESTRING (0 0, 4 4)'::geometry),
        (3, 'LINESTRING (1 1, 2 2)'::geometry),
        (4, 'LINESTRING (0 0, 3 3)'::geometry)) AS tbl2;

 column1 | column1 | contains
---------+---------+----------
           1 |       2 | f
           1 |       3 | t
           1 |       4 | t
(3 rows)</pre></div><div class="refsection"><a name="idp58742528"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Geometry_Contained" title="@">@</a>, <a class="xref" href="#geometry_overlaps" title="&amp;&amp;">&amp;&amp;</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="contains_geometry_box2df"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>~(geometry,box2df) — ジオメトリの (キャッシュされている)2次元バウンディングボックスが単精度浮動小数点数によるn次元バウンディングボックス (GIDX)を包含する場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">~</b>(</code> geometry  <var class="pdparam">A</var> ,  box2df  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp58750592"></a><h2>説明</h2><p><code class="varname">~</code>演算子は、ジオメトリAの2次元バウンディングボックスが、2次元バウンディングボックスBを包含する場合に、<code class="varname">TRUE</code>を返します。単精度浮動小数点数によるバウンディングボックスを使います。Bが倍精度浮動小数点数を使うbox2dである場合には、単精度浮動小数点数によるバウンディングボックス (BOX2DF)に変換されることになります。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この被演算子は、ユーザが使うためというよりも内部でBRINインデックスに使うために導入されました。</p></td></tr></table></div><p>Availability: 2.3.0 BRIN (Block Range INdexes)が導入されました。PostgreSQL 9.5以上が必要です。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p></div><div class="refsection"><a name="idp58755840"></a><h2>例</h2><pre class="programlisting">SELECT ST_Buffer(ST_GeomFromText('POINT(1 1)'), 10) ~ ST_MakeBox2D(ST_Point(0,0), ST_Point(2,2)) AS contains;

 contains
----------
 t
(1 row)</pre></div><div class="refsection"><a name="idp58757120"></a><h2>関連情報</h2><p><a class="xref" href="#overlaps_geometry_box2df" title="&amp;&amp;(geometry,box2df)">&amp;&amp;(geometry,box2df)</a>, <a class="xref" href="#overlaps_box2df_geometry" title="&amp;&amp;(box2df,geometry)">&amp;&amp;(box2df,geometry)</a>, <a class="xref" href="#overlaps_box2df_box2df" title="&amp;&amp;(box2df,box2df)">&amp;&amp;(box2df,box2df)</a>, <a class="xref" href="#contains_box2df_geometry" title="~(box2df,geometry)">~(box2df,geometry)</a>, <a class="xref" href="#contains_box2df_box2df" title="~(box2df,box2df)">~(box2df,box2df)</a>, <a class="xref" href="#is_contained_geometry_box2df" title="@(geometry,box2df)">@(geometry,box2df)</a>, <a class="xref" href="#is_contained_box2df_geometry" title="@(box2df,geometry)">@(box2df,geometry)</a>, <a class="xref" href="#is_contained_box2df_box2df" title="@(box2df,box2df)">@(box2df,box2df)</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="contains_box2df_geometry"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>~(box2df,geometry) — 単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)をジオメトリの (キャッシュされている)2次元バウンディングボックスが包含する場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">~</b>(</code> box2df  <var class="pdparam">A</var> ,  geometry  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp58767488"></a><h2>説明</h2><p><code class="varname">~</code>演算子は、2次元バウンディングボックスAが、ジオメトリBの2次元バウンディングボックスを包含する場合に、<code class="varname">TRUE</code>を返します。単精度浮動小数点数によるバウンディングボックスを使います。Aが倍精度浮動小数点数を使うbox2dである場合には、単精度浮動小数点数によるバウンディングボックス (BOX2DF)に変換されることになります。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この被演算子は、ユーザが使うためというよりも内部でBRINインデックスに使うために導入されました。</p></td></tr></table></div><p>Availability: 2.3.0 BRIN (Block Range INdexes)が導入されました。PostgreSQL 9.5以上が必要です。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p></div><div class="refsection"><a name="idp58772736"></a><h2>例</h2><pre class="programlisting">SELECT ST_MakeBox2D(ST_Point(0,0), ST_Point(5,5)) ~ ST_Buffer(ST_GeomFromText('POINT(2 2)'), 1) AS contains;

 contains
----------
 t
(1 row)</pre></div><div class="refsection"><a name="idp58774016"></a><h2>関連情報</h2><p><a class="xref" href="#overlaps_geometry_box2df" title="&amp;&amp;(geometry,box2df)">&amp;&amp;(geometry,box2df)</a>, <a class="xref" href="#overlaps_box2df_geometry" title="&amp;&amp;(box2df,geometry)">&amp;&amp;(box2df,geometry)</a>, <a class="xref" href="#overlaps_box2df_box2df" title="&amp;&amp;(box2df,box2df)">&amp;&amp;(box2df,box2df)</a>, <a class="xref" href="#contains_geometry_box2df" title="~(geometry,box2df)">~(geometry,box2df)</a>, <a class="xref" href="#contains_box2df_box2df" title="~(box2df,box2df)">~(box2df,box2df)</a>, <a class="xref" href="#is_contained_geometry_box2df" title="@(geometry,box2df)">@(geometry,box2df)</a>, <a class="xref" href="#is_contained_box2df_geometry" title="@(box2df,geometry)">@(box2df,geometry)</a>, <a class="xref" href="#is_contained_box2df_box2df" title="@(box2df,box2df)">@(box2df,box2df)</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="contains_box2df_box2df"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>~(box2df,box2df) — 二つの単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)の一方がもう一方を包含する場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">~</b>(</code> box2df  <var class="pdparam">A</var> ,  box2df  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp58784384"></a><h2>説明</h2><p><code class="varname">~</code>演算子は、2次元バウンディングボックスAが、2次元バウンディングボックスBを包含する場合に、<code class="varname">TRUE</code>を返します。単精度浮動小数点数によるバウンディングボックスを使います。AまたはBが倍精度浮動小数点数を使うbox2dである場合には、単精度浮動小数点数によるバウンディングボックス (BOX2DF)に変換されることになります。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この被演算子は、ユーザが使うためというよりも内部でBRINインデックスに使うために導入されました。</p></td></tr></table></div><p>Availability: 2.3.0 BRIN (Block Range INdexes)が導入されました。PostgreSQL 9.5以上が必要です。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p></div><div class="refsection"><a name="idp58789632"></a><h2>例</h2><pre class="programlisting">SELECT ST_MakeBox2D(ST_Point(0,0), ST_Point(5,5)) ~ ST_MakeBox2D(ST_Point(2,2), ST_Point(3,3)) AS contains;

 contains
----------
 t
(1 row)</pre></div><div class="refsection"><a name="idp58790912"></a><h2>関連情報</h2><p><a class="xref" href="#overlaps_geometry_box2df" title="&amp;&amp;(geometry,box2df)">&amp;&amp;(geometry,box2df)</a>, <a class="xref" href="#overlaps_box2df_geometry" title="&amp;&amp;(box2df,geometry)">&amp;&amp;(box2df,geometry)</a>, <a class="xref" href="#overlaps_box2df_box2df" title="&amp;&amp;(box2df,box2df)">&amp;&amp;(box2df,box2df)</a>, <a class="xref" href="#contains_geometry_box2df" title="~(geometry,box2df)">~(geometry,box2df)</a>, <a class="xref" href="#contains_box2df_geometry" title="~(box2df,geometry)">~(box2df,geometry)</a>, <a class="xref" href="#is_contained_geometry_box2df" title="@(geometry,box2df)">@(geometry,box2df)</a>, <a class="xref" href="#is_contained_box2df_geometry" title="@(box2df,geometry)">@(box2df,geometry)</a>, <a class="xref" href="#is_contained_box2df_box2df" title="@(box2df,box2df)">@(box2df,box2df)</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Geometry_Same"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>~= — AのバウンディングボックスがBのバウンディングボックスと同じ場合にTRUEを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">~=</b>(</code> geometry  <var class="pdparam">A</var> ,  geometry  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp58813184"></a><h2>説明</h2><p><code class="varname">~=</code>演算子はジオメトリ/ジオグラフィAのバウンディングボックスがジオメトリ/ジオグラフィBのバウンディングボックスと同じ場合に<code class="varname">TRUE</code>を返します。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これのオペランドは、ジオメトリで使用できるインデクスを使用します。</p></td></tr></table></div><p>Availability: 1.5.0 挙動が変更されました</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><div class="warning"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この演算子の挙動はPostGIS 1.5で、実際のジオメトリとしての等価性のテストから、バウンディングボックスの等価性のテストに変更されました。ハードアップグレードまたはソフトアップグレードを実行している場合は、データベースがどの挙動を持つかに動作が依存して、ややこしくなります。データベースがどの挙動を持つか判断するために、下のクエリを実行することができます。本当の等価性をチェックするには<a class="xref" href="#">???</a>または <a class="xref" href="#">???</a>を使用します。</p></td></tr></table></div></div><div class="refsection"><a name="idp58818816"></a><h2>例</h2><pre class="programlisting">select 'LINESTRING(0 0, 1 1)'::geometry ~= 'LINESTRING(0 1, 1 0)'::geometry as equality;
 equality   |
-----------------+
          t    |
                        </pre></div><div class="refsection"><a name="idp58820096"></a><h2>関連情報</h2><p><a class="xref" href="#">???</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#ST_Geometry_EQ" title="=">=</a></p></div></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="operators-distance"></a>8.8.2. 距離演算子</h3></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#geometry_distance_knn">&lt;-&gt;</a></span><span class="refpurpose"> — AとBの2次元距離を返します。 </span></dt><dt><span class="refentrytitle"><a href="#geometry_distance_cpa">|=|</a></span><span class="refpurpose"> — AトラジェクトリとBトラジェクトリとの最接近する時の距離を返します。 </span></dt><dt><span class="refentrytitle"><a href="#geometry_distance_box">&lt;#&gt;</a></span><span class="refpurpose"> — AのバウンディングボックスとBのバウンディングボックスの2次元距離を返します。 </span></dt><dt><span class="refentrytitle"><a href="#geometry_distance_centroid_nd">&lt;&lt;-&gt;&gt;</a></span><span class="refpurpose"> — AのバウンディングボックスとBのバウンディングボックスのn次元距離を返します。 </span></dt><dt><span class="refentrytitle"><a href="#geometry_distance_box_nd">&lt;&lt;#&gt;&gt;</a></span><span class="refpurpose"> — AのバウンディングボックスとBのバウンディングボックスのn次元距離を返します。 </span></dt></dl></div><div class="refentry"><a name="geometry_distance_knn"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>&lt;-&gt; — AとBの2次元距離を返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">double precision <b class="fsfunc">&lt;-&gt;</b>(</code> geometry  <var class="pdparam">A</var> ,  geometry  <var class="pdparam">B</var> <code>)</code>;</p><p><code class="funcdef">double precision <b class="fsfunc">&lt;-&gt;</b>(</code> geography  <var class="pdparam">A</var> ,  geography  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp58833024"></a><h2>説明</h2><p><code class="varname">&lt;-&gt;</code>演算子は二つのジオメトリの2次元距離を返します。"ORDER BY"句内で使われ、インデクスの援助を受けた近傍結果集合を提供します。PostgreSQL 9.5より前では、バウンディングボックスの中心距離を出すだけでしたが、PostgreSQL 9.5以上では、ジオメトリ間の本当の距離が与えられた本当のKNN距離検索を行います。ジオグラフィでは球面上の距離を計算します。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これのオペランドはジオメトリで利用できるインデクスを使用します。他の演算子との相違点は、ORDER BY句でのみインデクスが使用される点です。</p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ジオメトリのひとつが定数となる (副問い合わせ/共通テーブル式にない)場合 (a.geomでなく'SRID=3005;POINT(1011102 450541)'::geometry等となる場合)には、インデクスが有効になるだけです。</p></td></tr></table></div><p>詳細な例については<a class="ulink" href="http://workshops.opengeo.org/postgis-intro/knn.html" target="_top">OpenGeo workshop: Nearest-Neighbour Searching</a>を参照して下さい。</p><p>Enhanced: 2.2.0 ジオメトリとジオグラフィとのKNN (k近傍法)の動作が本当のものになりました。ジオグラフィのKNNは回転楕円体面上でなく球面上の計算となることに注意して下さい。PostgreSQL 9.4以下では、ジオグラフィに対応していますが、バウンディングボックスの重心に対応するだけです。</p><p>Changed: 2.2.0 PostgreSQL 9.5では、古いハイブリッド書式は遅くなりる可能性があります。そのため、PostGIS 2.2以上かつPostgreSQL 9.5以上においてのみ動作させる場合には、そのやり方をり除きたくなるでしょう。</p><p>Availability: 2.0.0 弱いKNNによって、実際の距離の代わりにジオメトリの重心による近傍が得られます。ポイントは確実な結果を得て、他のタイプは全て不確実な結果を得ます。PostgreSQL 9.1以上で有効です。</p></div><div class="refsection"><a name="idp58837504"></a><h2>例</h2><pre class="programlisting">SELECT ST_Distance(geom, 'SRID=3005;POINT(1011102 450541)'::geometry) as d,edabbr, vaabbr
FROM va2005
ORDER BY d limit 10;

        d         | edabbr | vaabbr
------------------+--------+--------
                0 | ALQ    | 128
 5541.57712511724 | ALQ    | 129A
 5579.67450712005 | ALQ    | 001
  6083.4207708641 | ALQ    | 131
  7691.2205404848 | ALQ    | 003
 7900.75451037313 | ALQ    | 122
 8694.20710669982 | ALQ    | 129B
 9564.24289057111 | ALQ    | 130
  12089.665931705 | ALQ    | 127
 18472.5531479404 | ALQ    | 002
(10 rows)
</pre><p>KNNの生の答は次のとおりです。 </p><pre class="programlisting">SELECT st_distance(geom, 'SRID=3005;POINT(1011102 450541)'::geometry) as d,edabbr, vaabbr
FROM va2005
ORDER BY geom &lt;-&gt; 'SRID=3005;POINT(1011102 450541)'::geometry limit 10;

        d         | edabbr | vaabbr
------------------+--------+--------
                0 | ALQ    | 128
 5541.57712511724 | ALQ    | 129A
 5579.67450712005 | ALQ    | 001
  6083.4207708641 | ALQ    | 131
  7691.2205404848 | ALQ    | 003
 7900.75451037313 | ALQ    | 122
 8694.20710669982 | ALQ    | 129B
 9564.24289057111 | ALQ    | 130
  12089.665931705 | ALQ    | 127
 18472.5531479404 | ALQ    | 002
(10 rows)
</pre><p>二つのクエリで"EXPLAIN ANALYZE"を実行すると、二つ目で速度が改善したことが分かります。 </p><p>PostgreSQL 9.5未満では、実際の近傍を発見するために、ハイブリッドのクエリを使います。最初にインデクスを用いたKNNを使って共通テーブル式 (CTE)クエリを行い、正しい順序を得る確実なクエリを実行します。 </p><pre class="programlisting">WITH index_query AS (
  SELECT ST_Distance(geom, 'SRID=3005;POINT(1011102 450541)'::geometry) as d,edabbr, vaabbr
        FROM va2005
  ORDER BY geom &lt;-&gt; 'SRID=3005;POINT(1011102 450541)'::geometry LIMIT 100)
  SELECT *
        FROM index_query
  ORDER BY d limit 10;

        d         | edabbr | vaabbr
------------------+--------+--------
                0 | ALQ    | 128
 5541.57712511724 | ALQ    | 129A
 5579.67450712005 | ALQ    | 001
  6083.4207708641 | ALQ    | 131
  7691.2205404848 | ALQ    | 003
 7900.75451037313 | ALQ    | 122
 8694.20710669982 | ALQ    | 129B
 9564.24289057111 | ALQ    | 130
  12089.665931705 | ALQ    | 127
 18472.5531479404 | ALQ    | 002
(10 rows)

                        </pre></div><div class="refsection"><a name="idp58849280"></a><h2>関連情報</h2><p><a class="xref" href="#">???</a>, <a class="xref" href="#ST_Distance" title="ST_Distance">ST_Distance</a>, <a class="xref" href="#geometry_distance_box" title="&lt;#&gt;">&lt;#&gt;</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="geometry_distance_cpa"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>|=| — AトラジェクトリとBトラジェクトリとの最接近する時の距離を返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">double precision <b class="fsfunc">|=|</b>(</code> geometry  <var class="pdparam">A</var> ,  geometry  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp58886016"></a><h2>説明</h2><p><code class="varname">|=|</code>演算子は二つのトラジェクトリの3次元距離を返します (<a class="xref" href="#">???</a>を参照して下さい)。これは、<a class="xref" href="#">???</a>と同じですが、N次元インデクスを使った近傍探索 (PostgreSQL 9.5.0以上)で使われる演算子です。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この演算子は、ジオメトリで使用可能なND GiST (n次元GiST)インデクスを使用します。他の空間インデクスを使う演算子と違い、ORDER BY句でのみ空間インデクスを使います。</p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ジオメトリのひとつが定数となる (副問い合わせ/共通テーブル式にない)場合 (a.geomでなく'SRID=3005;LINESTRINGM(0 0 0,0 0 1)'::geometry等となる場合)には、インデクスが有効になるだけです。</p></td></tr></table></div><p>Availability:: 2.2.0 インデクス対応はPostgreSQL 9.5以上でのみ有効です。</p></div><div class="refsection"><a name="idp58889728"></a><h2>例</h2><pre class="programlisting">-- psql変数にリテラルクエリのトラジェクトリを保存
\set qt 'ST_AddMeasure(ST_MakeLine(ST_MakePointM(-350,300,0),ST_MakePointM(-410,490,0)),10,20)'
-- クエリを実行
SELECT track_id, dist FROM (
  SELECT track_id, ST_DistanceCPA(tr,:qt) dist
  FROM trajectories
  ORDER BY tr |=| :qt
  LIMIT 5
) foo;
 track_id        dist
----------+-------------------
      395 | 0.576496831518066
      380 |  5.06797130410151
      390 |  7.72262293958322
      385 |   9.8004461358071
      405 |  10.9534397988433
(5 rows)
</pre></div><div class="refsection"><a name="idp58895104"></a><h2>関連情報</h2><p><a class="xref" href="#">???</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#">???</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="geometry_distance_box"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>&lt;#&gt; — AのバウンディングボックスとBのバウンディングボックスの2次元距離を返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">double precision <b class="fsfunc">&lt;#&gt;</b>(</code> geometry  <var class="pdparam">A</var> ,  geometry  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp58903296"></a><h2>説明</h2><p><code class="varname">&lt;#&gt;</code>演算子は二つの浮動小数点数によるバウンディングボックス間の距離を返します。可能なら空間インデクス (PostgreSQL 9.1以上が必要です)を読みます。近傍の<span class="strong"><strong>概ねの</strong></span>距離による並び替えに使います。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これのオペランドはジオメトリで利用できるインデクスを使用します。他の演算子との相違点は、ORDER BY句でのみインデクスが使用される点です。</p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ジオメトリのひとつがg1.geom &lt;#&gt;と違って ORDER BY (ST_GeomFromText('POINT(1 2)') &lt;#&gt; geom)というように定数である場合には、インデクスが有効になるだけです。</p></td></tr></table></div><p>Availability: 2.0.0 PostgreSQL 9.1以上でのみ有効です。</p></div><div class="refsection"><a name="idp58906624"></a><h2>例</h2><pre class="programlisting">SELECT *
FROM (
SELECT b.tlid, b.mtfcc,
        b.geom &lt;#
&gt; ST_GeomFromText('LINESTRING(746149 2948672,745954 2948576,
                745787 2948499,745740 2948468,745712 2948438,
                745690 2948384,745677 2948319)',2249) As b_dist,
                ST_Distance(b.geom, ST_GeomFromText('LINESTRING(746149 2948672,745954 2948576,
                745787 2948499,745740 2948468,745712 2948438,
                745690 2948384,745677 2948319)',2249)) As act_dist
    FROM bos_roads As b
    ORDER BY b_dist, b.tlid
    LIMIT 100) As foo
    ORDER BY act_dist, tlid LIMIT 10;

   tlid    | mtfcc |      b_dist      |     act_dist
-----------+-------+------------------+------------------
  85732027 | S1400 |                0 |                0
  85732029 | S1400 |                0 |                0
  85732031 | S1400 |                0 |                0
  85734335 | S1400 |                0 |                0
  85736037 | S1400 |                0 |                0
 624683742 | S1400 |                0 | 128.528874268666
  85719343 | S1400 | 260.839270432962 | 260.839270432962
  85741826 | S1400 | 164.759294123275 | 260.839270432962
  85732032 | S1400 |           277.75 | 311.830282365264
  85735592 | S1400 |           222.25 | 311.830282365264
(10 rows)
</pre></div><div class="refsection"><a name="idp58907904"></a><h2>関連情報</h2><p><a class="xref" href="#">???</a>, <a class="xref" href="#ST_Distance" title="ST_Distance">ST_Distance</a>, <a class="xref" href="#geometry_distance_knn" title="&lt;-&gt;">&lt;-&gt;</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="geometry_distance_centroid_nd"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>&lt;&lt;-&gt;&gt; — AのバウンディングボックスとBのバウンディングボックスのn次元距離を返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">double precision <b class="fsfunc">&lt;&lt;-&gt;&gt;</b>(</code> geometry  <var class="pdparam">A</var> ,  geometry  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp58936448"></a><h2>説明</h2><p><code class="varname">&lt;&lt;-&gt;&gt;</code>演算子は、二つのジオメトリのバウンディングボックスの重心のn次元 (ユークリッド)距離を返します。近傍の<span class="strong"><strong>概ねの</strong></span>距離による並び替えに使います。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これのオペランドはジオメトリで利用できるインデクスを使用します。他の演算子との相違点は、ORDER BY句でのみインデクスが使用される点です。 </p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ジオメトリのひとつが定数となる (副問い合わせ/共通テーブル式にない)場合 (a.geomでなく'SRID=3005;POINT(1011102 450541)'::geometry等となる場合)には、インデクスが有効になるだけです。 </p></td></tr></table></div><p>Availability: 2.0.0 KNNはPostgreSQL 9.1以上でのみ有効です。</p></div><div class="refsection"><a name="idp58939776"></a><h2>関連情報</h2><p><a class="xref" href="#geometry_distance_box_nd" title="&lt;&lt;#&gt;&gt;">&lt;&lt;#&gt;&gt;</a>, <a class="xref" href="#geometry_distance_knn" title="&lt;-&gt;">&lt;-&gt;</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="geometry_distance_box_nd"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>&lt;&lt;#&gt;&gt; — AのバウンディングボックスとBのバウンディングボックスのn次元距離を返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">double precision <b class="fsfunc">&lt;&lt;#&gt;&gt;</b>(</code> geometry  <var class="pdparam">A</var> ,  geometry  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp58947584"></a><h2>説明</h2><p><code class="varname">&lt;&lt;#&gt;&gt;</code>演算子は二つの浮動小数点数バウンディングボックスの距離を返します。可能なら空間インデクス  (PostgreSQL 9.1以上が必要です)を読みます。近傍の<span class="strong"><strong>概ねの</strong></span>距離による並び替えに使います。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これのオペランドはジオメトリで利用できるインデクスを使用します。他の演算子との相違点は、ORDER BY句でのみインデクスが使用される点です。</p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ジオメトリの一つがg1.geom &lt;&lt;#&gt;&gt;.と違ってORDER BY (ST_GeomFromText('POINT(1 2)') &lt;&lt;#&gt;&gt; geom)といった定数である場合には、インデクスが有効になるだけです。 </p></td></tr></table></div><p>Availability: 2.0.0 KNNはPostgreSQL 9.1以上でのみ有効です。</p></div><div class="refsection"><a name="idp58950912"></a><h2>関連情報</h2><p><a class="xref" href="#geometry_distance_centroid_nd" title="&lt;&lt;-&gt;&gt;">&lt;&lt;-&gt;&gt;</a>, <a class="xref" href="#geometry_distance_box" title="&lt;#&gt;">&lt;#&gt;</a> </p></div></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Measurement_Functions"></a>8.9. 計測関数</h2></div><div><div class="abstract"><div class="abstract-title">概要</div><p>この関数は、距離、面積、角度の測定値を計算します。測定値から決定されるジオメトリ値を計算する関数もあります。</p></div></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#ST_Area">ST_Area</a></span><span class="refpurpose"> — ポリゴンジオメトリの面積を返します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_Azimuth">ST_Azimuth</a></span><span class="refpurpose"> — 北を基準とした2点間の線の方位角を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Angle">ST_Angle</a></span><span class="refpurpose"> — 3点もしくは4点、または2線で定義される二つのベクタ間の角度を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_ClosestPoint">ST_ClosestPoint</a></span><span class="refpurpose"> — g1上の、g2に最も近い2次元ポイントを返します。これは最短ラインの始点です。</span></dt><dt><span class="refentrytitle"><a href="#ST_3DClosestPoint">ST_3DClosestPoint</a></span><span class="refpurpose"> — g1上の、g2に最も近い3次元ポイントを返します。これは3次元の最短ラインの始点です。 </span></dt><dt><span class="refentrytitle"><a href="#ST_Distance">ST_Distance</a></span><span class="refpurpose"> — 二つのジオメトリ値またはジオグラフィ値間の距離を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_3DDistance">ST_3DDistance</a></span><span class="refpurpose"> — 投影座標系の単位で、二つのジオメトリ間の3次元デカルト距離の最小値を返します (空間参照系に基づきます)。 </span></dt><dt><span class="refentrytitle"><a href="#ST_DistanceSphere">ST_DistanceSphere</a></span><span class="refpurpose"> — 球面の地球モデルを使って、二つの経度/緯度ジオメトリの最小距離をメートル単位で返します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_Distance_Spheroid">ST_DistanceSpheroid</a></span><span class="refpurpose"> — 回転楕円体面の地球モデルを使って、二つの経度/緯度ジオメトリの最小距離を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_FrechetDistance">ST_FrechetDistance</a></span><span class="refpurpose"> — 二つのジオメトリのフレシェ距離を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_HausdorffDistance">ST_HausdorffDistance</a></span><span class="refpurpose"> — 二つのジオメトリ間のハウスドルフ距離を返します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_Length">ST_Length</a></span><span class="refpurpose"> — 線系ジオメトリの2次元長を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Length2D">ST_Length2D</a></span><span class="refpurpose"> — ラインジオメトリの2次元長を返します。<code class="varname">ST_Length</code>の別名です。</span></dt><dt><span class="refentrytitle"><a href="#ST_3DLength">ST_3DLength</a></span><span class="refpurpose"> — 線ジオメトリの3次元長を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Length_Spheroid">ST_LengthSpheroid</a></span><span class="refpurpose"> — 回転楕円体面上の経度緯度のジオメトリの2次元または3次元の長さ/周長を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_LongestLine">ST_LongestLine</a></span><span class="refpurpose"> — 二つのジオメトリ間の2次元最長ラインを返します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_3DLongestLine">ST_3DLongestLine</a></span><span class="refpurpose"> — 二つのジオメトリ間の3次元最長ラインを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_MaxDistance">ST_MaxDistance</a></span><span class="refpurpose"> — 二つのジオメトリ間の2次元最長距離を空間参照系の単位で返します</span></dt><dt><span class="refentrytitle"><a href="#ST_3DMaxDistance">ST_3DMaxDistance</a></span><span class="refpurpose"> — 二つのジオメトリ間の3次元最大デカルト距離 (空間参照系に基づく)を空間参照系の単位で返します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_MinimumClearance">ST_MinimumClearance</a></span><span class="refpurpose"> — ジオメトリのクリアランスの最小値を返します。この値はジオメトリのロバスト性を示すものです。</span></dt><dt><span class="refentrytitle"><a href="#ST_MinimumClearanceLine">ST_MinimumClearanceLine</a></span><span class="refpurpose"> — ジオメトリの最小クリアランスを示す、2点のラインストリングを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Perimeter">ST_Perimeter</a></span><span class="refpurpose"> — ポリゴンジオメトリまたはジオグラフィの境界の長さを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Perimeter2D">ST_Perimeter2D</a></span><span class="refpurpose"> — ポリゴンジオメトリの2次元周長を返します。<code class="varname">ST_Perimeter</code>の別名です。</span></dt><dt><span class="refentrytitle"><a href="#ST_3DPerimeter">ST_3DPerimeter</a></span><span class="refpurpose"> — ポリゴンジオメトリの3次元周長を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Project">ST_Project</a></span><span class="refpurpose"> — 始点から距離と方位で算出されたポイントを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_ShortestLine">ST_ShortestLine</a></span><span class="refpurpose"> — 二つのジオメトリの3次元の最短ラインを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_3DShortestLine">ST_3DShortestLine</a></span><span class="refpurpose"> — 二つのジオメトリの3次元の最短ラインを返します。</span></dt></dl></div><div class="refentry"><a name="ST_Area"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Area — ポリゴンジオメトリの面積を返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_Area</b>(</code>geometry <var class="pdparam">g1</var><code>)</code>;</p><p><code class="funcdef">float <b class="fsfunc">ST_Area</b>(</code>geography <var class="pdparam">geog</var>, boolean <var class="pdparam">use_spheroid=true</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp59541248"></a><h2>説明</h2><p>ポリゴンジオメトリの面積を返します。ジオメトリ型では2次元のデカルト (平面)面積が、SRIDで指定した単位で計算されます。ジオグラフィ型では、デフォルトでは、面積は回転楕円体上にあるものとし、平方メートル単位で計算されます。より速いものの精度が落ちる計算のために、 <code class="varname">ST_Area(geog,false)</code>で球面モデルを使った計算ができます。 </p><p>Enhanced: 2.0.0 - 2次元多面体サーフェス対応が導入されました。</p><p>Enhanced: 2.2.0 - 精度とロバスト性の向上のためにGeographicLibを使って回転楕円体面上での計測を行うようにしています。この新機能を使うには、Proj 4.9.0以上が必要です。</p><p>Changed: 3.0.0 - SFCGALに依存しなくなりました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OGC Simple Features
 Implementation Specification for SQL 1.1.</a></p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 8.1.2, 9.5.3</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>多面体サーフェスについて、2次元多面体サーフェスのみ対応します (2.5次元は対応しません)。2.5次元について、0でない答が与えられるかも知れませんが、完全にXY平面に付いているサーフェスのみです。</p></td></tr></table></div></div><div class="refsection"><a name="idp59561216"></a><h2>例</h2><p>マサチューセッツのプロットから平方フィートの面積を返すものと、乗算で平方フィートから平方メートルに変換するものです。EPSG:2249はマサチューセッツ州フィート平面であるので、平方フィートで面積が出ることに注意して下さい。 </p><pre class="programlisting">select ST_Area(geom) sqft,
    ST_Area(geom) * 0.3048 ^ 2 sqm
from (
         select 'SRID=2249;POLYGON((743238 2967416,743238 2967450,
                                 743265 2967450,743265.625 2967416,743238 2967416))' :: geometry geom
     ) subquery;
┌─────────┬─────────────┐
│  sqft   │     sqm     │
├─────────┼─────────────┤
│ 928.625 │ 86.27208552 │
└─────────┴─────────────┘
</pre><p>平方フィートの面積を返すものと、マサチューセッツ州メートル平面 (EPSG:26986)に変換して平方メートルを得るものです。EPSG:2249はマサチューセッツ州フィート平面であり、EPSG:26986はマサチューセッツ州メートル平面であることに注意して下さい。 </p><pre class="programlisting">select ST_Area(geom) sqft,
    ST_Area(ST_Transform(geom, 26986)) As sqm
from (
         select
             'SRID=2249;POLYGON((743238 2967416,743238 2967450,
             743265 2967450,743265.625 2967416,743238 2967416))' :: geometry geom
     ) subquery;
┌─────────┬─────────────────┐
│  sqft   │       sqm       │
├─────────┼─────────────────┤
│ 928.625 │ 86.272430607008 │
└─────────┴─────────────────┘
</pre><p>ジオグラフィ型を使って平方フィートと平方メートルを返すものです。 ジオメトリをジオグラフィに変換することに注意して下さい (変換に先立ってジオメトリがWGS 84緯度経度のEPSG:4326であることを確認します)。ジオグラフィは常にメートルで計測されます。これは比較のためのデモンストレーションです。通常は、ジオグラフィ型が既に格納されているものです。</p><pre class="programlisting">select ST_Area(geog) / 0.3048 ^ 2 sqft_spheroid,
    ST_Area(geog, false) / 0.3048 ^ 2 sqft_sphere,
    ST_Area(geog) sqm_spheroid
from (
         select ST_Transform(
                    'SRID=2249;POLYGON((743238 2967416,743238 2967450,743265 2967450,743265.625 2967416,743238 2967416))'::geometry,
                    4326
             ) :: geography geog
     ) as subquery;
┌──────────────────┬──────────────────┬──────────────────┐
│  sqft_spheroid   │   sqft_sphere    │   sqm_spheroid   │
├──────────────────┼──────────────────┼──────────────────┤
│ 928.684405784452 │ 927.049336105925 │ 86.2776044979692 │
└──────────────────┴──────────────────┴──────────────────┘
</pre><p>ジオグラフィのデータが既にある場合</p><pre class="programlisting">select ST_Area(geog) / 0.3048 ^ 2 sqft,
    ST_Area(the_geog) sqm
from somegeogtable;</pre></div><div class="refsection"><a name="idp59565568"></a><h2>関連情報</h2><p><a class="xref" href="#ST_3DArea" title="ST_3DArea">ST_3DArea</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#">???</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Azimuth"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Azimuth — 北を基準とした2点間の線の方位角を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_Azimuth</b>(</code>geometry <var class="pdparam">pointA</var>, geometry <var class="pdparam">pointB</var><code>)</code>;</p><p><code class="funcdef">float <b class="fsfunc">ST_Azimuth</b>(</code>geography <var class="pdparam">pointA</var>, geography <var class="pdparam">pointB</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp59588864"></a><h2>説明</h2><p>与えられたポイントジオメトリで定義される線分の方位をラジアン単位で返します。2点が一致する場合にはNULLを返します。方位は北 (Y軸の正方向)を基準として時計回りに計測します。北は0、北東はπ/4、東はπ/2、南東は3π/4、南はπ、南西は5π/4、西は3π/2、北西は7π/4になります。</p><p>ジオグラフィでは、方位角計算問題は<a class="ulink" href="https://en.wikipedia.org/wiki/Geodesics_on_an_ellipsoid" target="_top">inverse geodesic problem</a>として知られます。</p><p>方位角は参照平面と一つのポイントの間の角度と定義される数学的概念で、角度の単位はラジアンです。ラジアン単位の結果はPostgreSQL関数<code class="varname">degrees()</code>で度に変換できます。</p><p>方位角は、垂直軸に沿ってシフトさせるには<a class="xref" href="#">???</a>と併用します。実装については<a class="ulink" href="http://trac.osgeo.org/postgis/wiki/UsersWikiplpgsqlfunctions" target="_top">PostGIS wiki</a>内の関数<code class="varname">upgis_lineshift()</code>をご覧下さい。</p><p>Availability: 1.1.0</p><p>Enhanced: 2.0.0 ジオグラフィ対応が導入されました。</p><p>Enhanced: 2.2.0 精度とロバスト性向上のために回転楕円体面上の計測をGeographicLibで行うようにしました。この新機能を使うには、Proj 4.9.0以上が必要です。</p></div><div class="refsection"><a name="idp59594496"></a><h2>例</h2><p>度単位のジオメトリの方位 </p><pre class="programlisting">SELECT degrees(ST_Azimuth( ST_Point(25, 45),  ST_Point(75, 100))) AS degA_B,
           degrees(ST_Azimuth( ST_Point(75, 100), ST_Point(25, 45) )) AS degB_A;

      dega_b       |     degb_a
------------------+------------------
 42.2736890060937 | 222.273689006094
</pre><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col><col></colgroup><tbody><tr><td style="border-right: 1px solid ; "><div class="informalfigure"><div class="mediaobject"><img src="images/st_azimuth01.png"><div class="caption"><p>緑: 開始点 (25,45)で、鉛直方向に行きます。黄: degA_Bを示す行程 (方位)です。</p></div></div></div><p>
				</p></td><td style=""><div class="informalfigure"><div class="mediaobject"><img src="images/st_azimuth02.png"><div class="caption"><p>緑: (75,100)が開始点で、鉛直方向に行きます。黄: degB_Aを示す行程 (方位)です。</p></div></div></div><p>
				</p></td></tr></tbody></table></div></div><div class="refsection"><a name="idp59602944"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Angle" title="ST_Angle">ST_Angle</a>, <a class="xref" href="#ST_Point" title="ST_Point">ST_Point</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#ST_Project" title="ST_Project">ST_Project</a>, <a class="ulink" href="http://www.postgresql.org/docs/current/interactive/functions-math.html" target="_top">PostgreSQL Math Functions</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Angle"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Angle — 3点もしくは4点、または2線で定義される二つのベクタ間の角度を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_Angle</b>(</code>geometry <var class="pdparam">point1</var>, geometry <var class="pdparam">point2</var>, geometry <var class="pdparam">point3</var>, geometry <var class="pdparam">point4</var><code>)</code>;</p><p><code class="funcdef">float <b class="fsfunc">ST_Angle</b>(</code>geometry <var class="pdparam">line1</var>, geometry <var class="pdparam">line2</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp59616000"></a><h2>説明</h2><p>二つのベクタの時計回りの角度を計算します。 </p><p><span class="bold"><strong>1番目の形式:</strong></span> ポイントP1-P2-P3で囲まれた角度の計算。四つ目のポイントが与えられた場合にはP1-P2とP3-P4との角度を計算します。</p><p><span class="bold"><strong>2番目の形式:</strong></span> S1-E1ベクタとS2-E2ベクタの間の角度の計算、入力ラインの始点と終点で定義されます。 </p><p>結果は0から2πラジアンの間の正数です。PostgreSQL関数<code class="varname">degrees()</code>を使うと、結果のラジアンを度に変換できます </p><p><code class="varname">ST_Angle(P1,P2,P3) = ST_Angle(P2,P1,P2,P3)</code>となることに注意して下さい。</p><p>Availability: 2.5.0</p></div><div class="refsection"><a name="idp59620480"></a><h2>例</h2><p>3点間の角度</p><pre class="programlisting">SELECT degrees( ST_Angle('POINT(0 0)', 'POINT(10 10)', 'POINT(20 0)') );

 degrees
---------
     270
</pre><p>4点で定義されたベクタ間の角度</p><pre class="programlisting">SELECT degrees( ST_Angle('POINT (10 10)', 'POINT (0 0)', 'POINT(90 90)', 'POINT (100 80)') );

      degrees
-------------------
 269.9999999999999
</pre><p>ラインの始端と終端で定義されるベクタ間の角度</p><pre class="programlisting">SELECT degrees( ST_Angle('LINESTRING(0 0, 0.3 0.7, 1 1)', 'LINESTRING(0 0, 0.2 0.5, 1 0)') );

      degrees
--------------
           45
</pre></div><div class="refsection"><a name="idp59623936"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Azimuth" title="ST_Azimuth">ST_Azimuth</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_ClosestPoint"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ClosestPoint — g1上の、g2に最も近い2次元ポイントを返します。これは最短ラインの始点です。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_ClosestPoint</b>(</code>geometry  <var class="pdparam">g1</var>, geometry  <var class="pdparam">g2</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp59630720"></a><h2>説明</h2><p>g1上の、g2に最も近い2次元ポイントを返します。これは最短ラインの始点です。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>3次元ジオメトリの場合には<a class="xref" href="#ST_3DClosestPoint" title="ST_3DClosestPoint">ST_3DClosestPoint</a>の方が良いでしょう。</p></td></tr></table></div><p>Availability: 1.5.0</p></div><div class="refsection"><a name="idp59633152"></a><h2>例</h2><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col><col></colgroup><tbody><tr><td style="border-right: 1px solid ; "><div class="informalfigure"><div class="mediaobject"><img src="images/st_closestpoint01.png"><div class="caption"><p>ポイントとラインストリングの間の最短は、ポイントそのものです。ラインストリングとポイントの間の最短は、ラインストリング上の最短となるポイントです。</p></div></div></div><p>
				</p><pre class="programlisting">SELECT ST_AsText(ST_ClosestPoint(pt,line)) AS cp_pt_line,
        ST_AsText(ST_ClosestPoint(line,pt)) As cp_line_pt
FROM (SELECT 'POINT(100 100)'::geometry As pt,
                'LINESTRING (20 80, 98 190, 110 180, 50 75 )'::geometry As line
        ) As foo;


   cp_pt_line   |                cp_line_pt
----------------+------------------------------------------
 POINT(100 100) | POINT(73.0769230769231 115.384615384615)
                                </pre><p>
						  </p></td><td style=""><div class="informalfigure"><div class="mediaobject"><img src="images/st_closestpoint02.png"><div class="caption"><p>ポリゴンA上のポリゴンBへの最短点</p></div></div></div><p>
				</p><pre class="programlisting">SELECT ST_AsText(
                ST_ClosestPoint(
                        ST_GeomFromText('POLYGON((175 150, 20 40, 50 60, 125 100, 175 150))'),
                        ST_Buffer(ST_GeomFromText('POINT(110 170)'), 20)
                        )
                ) As ptwkt;

                  ptwkt
------------------------------------------
 POINT(140.752120669087 125.695053378061)
                                </pre><p>
						</p></td></tr></tbody></table></div></div><div class="refsection"><a name="idp59645824"></a><h2>関連情報</h2><p><a class="xref" href="#ST_3DClosestPoint" title="ST_3DClosestPoint">ST_3DClosestPoint</a>,<a class="xref" href="#ST_Distance" title="ST_Distance">ST_Distance</a>, <a class="xref" href="#ST_LongestLine" title="ST_LongestLine">ST_LongestLine</a>, <a class="xref" href="#ST_ShortestLine" title="ST_ShortestLine">ST_ShortestLine</a>, <a class="xref" href="#ST_MaxDistance" title="ST_MaxDistance">ST_MaxDistance</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_3DClosestPoint"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_3DClosestPoint — g1上の、g2に最も近い3次元ポイントを返します。これは3次元の最短ラインの始点です。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_3DClosestPoint</b>(</code>geometry  <var class="pdparam">g1</var>, geometry  <var class="pdparam">g2</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp59691008"></a><h2>説明</h2><p>g1上の、g2に最も近い3次元ポイントを返します。3次元最短線の一つ目のポイントです。3次元最短線の長さは、3次元距離と同じです。 </p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p>Availability: 2.0.0</p><p>Changed: 2.2.0 - 二つの2次元ジオメトリが入力である場合には、2次元ポイントが返ります (古い挙動では、存在しないZの値について0を仮定していました)。2次元と3次元の場合には、もはや、存在しないZの値について0を仮定しません。</p></div><div class="refsection"><a name="idp59696000"></a><h2>例</h2><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col></colgroup><tbody><tr><td style="border-bottom: 1px solid ; "><p>ラインストリングとポイント -- 3次元と2次元の両方の最も近いポイント </p><pre class="programlisting">SELECT ST_AsEWKT(ST_3DClosestPoint(line,pt)) AS cp3d_line_pt,
                ST_AsEWKT(ST_ClosestPoint(line,pt)) As cp2d_line_pt
        FROM (SELECT 'POINT(100 100 30)'::geometry As pt,
                        'LINESTRING (20 80 20, 98 190 1, 110 180 3, 50 75 1000)'::geometry As line
                ) As foo;


 cp3d_line_pt                                                |               cp2d_line_pt
-----------------------------------------------------------+------------------------------------------
 POINT(54.6993798867619 128.935022917228 11.5475869506606) | POINT(73.0769230769231 115.384615384615)
                                        </pre><p>
							  </p></td></tr><tr><td style="border-bottom: 1px solid ; "><p>ラインストリングとマルチポイント -- 3次元と2次元の両方の最も近いポイント </p><pre class="programlisting">SELECT ST_AsEWKT(ST_3DClosestPoint(line,pt)) AS cp3d_line_pt,
                ST_AsEWKT(ST_ClosestPoint(line,pt)) As cp2d_line_pt
        FROM (SELECT 'MULTIPOINT(100 100 30, 50 74 1000)'::geometry As pt,
                        'LINESTRING (20 80 20, 98 190 1, 110 180 3, 50 75 900)'::geometry As line
                ) As foo;


                       cp3d_line_pt                        | cp2d_line_pt
-----------------------------------------------------------+--------------
 POINT(54.6993798867619 128.935022917228 11.5475869506606) | POINT(50 75)
                                        </pre><p>
							  </p></td></tr><tr><td style=""><p>マルチラインストリングとポリゴン -- 3次元と2次元の両方の最も近いポイント </p><pre class="programlisting">SELECT ST_AsEWKT(ST_3DClosestPoint(poly, mline)) As cp3d,
    ST_AsEWKT(ST_ClosestPoint(poly, mline)) As cp2d
        FROM (SELECT  ST_GeomFromEWKT('POLYGON((175 150 5, 20 40 5, 35 45 5, 50 60 5, 100 100 5, 175 150 5))') As poly,
                ST_GeomFromEWKT('MULTILINESTRING((175 155 2, 20 40 20, 50 60 -2, 125 100 1, 175 155 1),
                (1 10 2, 5 20 1))') As mline ) As foo;
                   cp3d                    |     cp2d
-------------------------------------------+--------------
 POINT(39.993580415989 54.1889925532825 5) | POINT(20 40)
             </pre><p>
							  </p></td></tr></tbody></table></div></div><div class="refsection"><a name="idp59751424"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a>, <a class="xref" href="#ST_ClosestPoint" title="ST_ClosestPoint">ST_ClosestPoint</a>, <a class="xref" href="#ST_3DDistance" title="ST_3DDistance">ST_3DDistance</a>, <a class="xref" href="#ST_3DShortestLine" title="ST_3DShortestLine">ST_3DShortestLine</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Distance"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Distance — 二つのジオメトリ値またはジオグラフィ値間の距離を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_Distance</b>(</code>geometry  <var class="pdparam">g1</var>, geometry  <var class="pdparam">g2</var><code>)</code>;</p><p><code class="funcdef">float <b class="fsfunc">ST_Distance</b>(</code>geography  <var class="pdparam">geog1</var>, geography  <var class="pdparam">geog2</var>, boolean  <var class="pdparam">use_spheroid=true</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp59784192"></a><h2>説明</h2><p><a class="xref" href="#geometry" title="geometry">geometry</a>型では、二つのジオメトリ間の2次元のデカルト (平面)距離の最小値を返します。単位は投影の単位 (空間参照系の単位)です。 </p><p><a class="xref" href="#geography" title="geography">geography</a>型では、二つのジオグラフィ間の最小の測地距離を、メートル単位で返します。SRIDで決定される回転楕円体で計算します。<code class="varname">use_spheroid</code>がFALSEの場合には、球面が計算に使われます。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OGC Simple Features
 Implementation Specification for SQL 1.1.</a></p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 5.1.23</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p>Availability: 1.5.0 1.5でジオグラフィ対応が導入されました。大きいジオメトリや頂点の多いジオメトリについての速度が改善しました。</p><p>Enhanced: 2.1.0 ジオグラフィでの速度が改善されました。詳細は<a class="ulink" href="http://boundlessgeo.com/2012/07/making-geography-faster/" target="_top">Making Geography faster</a>をご覧ください。</p><p>Enhanced: 2.1.0 - 曲線ジオメトリ対応が導入されました。</p><p>Enhanced: 2.2.0 - 精度とロバスト性の向上のためにGeographicLibを使って回転楕円体面上での計測を行うようにしています。この新機能を使うには、Proj 4.9.0以上が必要です。</p><p>Changed: 3.0.0 - SFCGALに依存しなくなりました。</p></div><div class="refsection"><a name="idp59793280"></a><h2>基本的なジオメトリの例</h2><p>ジオメトリの例 - 平面の単位で4326はWGS84経度緯度なので、単位は度。</p><pre class="programlisting">SELECT ST_Distance(
                'SRID=4326;POINT(-72.1235 42.3521)'::geometry,
                'SRID=4326;LINESTRING(-72.1260 42.45, -72.123 42.1546)'::geometry
        );
st_distance
-----------------
0.00150567726382282</pre><p>ジオメトリの例 - メートル単位 (SIRD: 3857, 一般的なWebマップのピクセルに比例)。値は正しくありませんが、近傍の比較は正しくでき、KNNやKMeansなどのアルゴリズムに適しています。</p><pre class="programlisting">SELECT ST_Distance(
                        ST_Transform('SRID=4326;POINT(-72.1235 42.3521)'::geometry, 3857),
                        ST_Transform('SRID=4326;LINESTRING(-72.1260 42.45, -72.123 42.1546)'::geometry, 3857)
                );
st_distance
-----------------
167.441410065196</pre><p>ジオメトリの例 - メートル単位 (SRID:3857, 上と同じですが、歪みを考慮してcos(lat)で修正しています)</p><pre class="programlisting">SELECT ST_Distance(
                        ST_Transform('SRID=4326;POINT(-72.1235 42.3521)'::geometry, 3857),
                        ST_Transform('SRID=4326;LINESTRING(-72.1260 42.45, -72.123 42.1546)'::geometry, 3857)
                ) * cosd(42.3521);
st_distance
-----------------
123.742351254151</pre><p>ジオメトリの例 - メートル単位 (SRID: 26986, マサチューセッツ州平面メートル) (マサチューセッツで最も精度が高い)</p><pre class="programlisting">SELECT ST_Distance(
                        ST_Transform('SRID=4326;POINT(-72.1235 42.3521)'::geometry, 26986),
                        ST_Transform('SRID=4326;LINESTRING(-72.1260 42.45, -72.123 42.1546)'::geometry, 26986)
                );
st_distance
-----------------
123.797937878454</pre><p>ジオメトリの例 - メートル単位 (SRID: 2163, 米国ナショナルアトラス正積図法) (最も精度が低い) </p><pre class="programlisting">SELECT ST_Distance(
                        ST_Transform('SRID=4326;POINT(-72.1235 42.3521)'::geometry, 2163),
                        ST_Transform('SRID=4326;LINESTRING(-72.1260 42.45, -72.123 42.1546)'::geometry, 2163)
                );

st_distance
------------------
126.664256056812</pre></div><div class="refsection"><a name="idp59810944"></a><h2>ジオグラフィの例</h2><p>ジオメトリの例と同じですが、メートル単位である点に注意して下さい - 球面の使用で、わずかな速度向上と低精度の計算を行います。</p><pre class="programlisting">SELECT ST_Distance(gg1, gg2) As spheroid_dist, ST_Distance(gg1, gg2, false) As sphere_dist
FROM (SELECT
        'SRID=4326;POINT(-72.1235 42.3521)'::geography as gg1,
        'SRID=4326;LINESTRING(-72.1260 42.45, -72.123 42.1546)'::geography as gg2
        ) As foo  ;

  spheroid_dist   |   sphere_dist
------------------+------------------
 123.802076746848 | 123.475736916397</pre></div><div class="refsection"><a name="idp59812608"></a><h2>関連情報</h2><p><a class="xref" href="#ST_3DDistance" title="ST_3DDistance">ST_3DDistance</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#ST_DistanceSphere" title="ST_DistanceSphere">ST_DistanceSphere</a>, <a class="xref" href="#ST_Distance_Spheroid" title="ST_DistanceSpheroid">ST_DistanceSpheroid</a>, <a class="xref" href="#ST_MaxDistance" title="ST_MaxDistance">ST_MaxDistance</a>, <a class="xref" href="#ST_HausdorffDistance" title="ST_HausdorffDistance">ST_HausdorffDistance</a>, <a class="xref" href="#ST_FrechetDistance" title="ST_FrechetDistance">ST_FrechetDistance</a>, <a class="xref" href="#">???</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_3DDistance"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_3DDistance — 投影座標系の単位で、二つのジオメトリ間の3次元デカルト距離の最小値を返します (空間参照系に基づきます)。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_3DDistance</b>(</code>geometry  <var class="pdparam">g1</var>, geometry  <var class="pdparam">g2</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp59822080"></a><h2>説明</h2><p>投影座標系の単位で、二つのジオメトリ間の3次元デカルト距離の最小値を返します (空間参照系に基づきます)。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM ?</p><p>Availability: 2.0.0</p><p>Changed: 2.2.0 - 2次元と3次元の場合には、もはや、存在しないZの値について0を仮定しません。</p><p>Changed: 3.0.0 - SFCGAL版は削除されました</p></div><div class="refsection"><a name="idp59828864"></a><h2>例</h2><pre class="programlisting">-- ジオメトリの例 - メートル単位 (SRID: 2163, 米国ナショナルアトラス正積図法) (2次元のポイントとラインと比較される3次元のポイントとライン)
-- ご注意: 現在は鉛直基準面に対応していません。Z値は変換されずに、最終の単位と同じ単位と推定されます。
SELECT ST_3DDistance(
                        ST_Transform('SRID=4326;POINT(-72.1235 42.3521 4)'::geometry,2163),
                        ST_Transform('SRID=4326;LINESTRING(-72.1260 42.45 15, -72.123 42.1546 20)'::geometry,2163)
                ) As dist_3d,
                ST_Distance(
                        ST_Transform('SRID=4326;POINT(-72.1235 42.3521)'::geometry,2163),
                        ST_Transform('SRID=4326;LINESTRING(-72.1260 42.45, -72.123 42.1546)'::geometry,2163)
                ) As dist_2d;

     dist_3d      |     dist_2d
------------------+-----------------
 127.295059324629 | 126.66425605671
</pre><pre class="programlisting">-- マルチラインストリングとポリゴンの3次元距離と2次元距離
-- 3次元最近点の例と同じです
SELECT ST_3DDistance(poly, mline) As dist3d,
    ST_Distance(poly, mline) As dist2d
        FROM (SELECT  'POLYGON((175 150 5, 20 40 5, 35 45 5, 50 60 5, 100 100 5, 175 150 5))'::geometry as poly,
               'MULTILINESTRING((175 155 2, 20 40 20, 50 60 -2, 125 100 1, 175 155 1), (1 10 2, 5 20 1))'::geometry as mline) as foo;
      dist3d       | dist2d
-------------------+--------
 0.716635696066337 |      0
</pre></div><div class="refsection"><a name="idp59830656"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Distance" title="ST_Distance">ST_Distance</a>, <a class="xref" href="#ST_3DClosestPoint" title="ST_3DClosestPoint">ST_3DClosestPoint</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#ST_3DMaxDistance" title="ST_3DMaxDistance">ST_3DMaxDistance</a>, <a class="xref" href="#ST_3DShortestLine" title="ST_3DShortestLine">ST_3DShortestLine</a>, <a class="xref" href="#">???</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_DistanceSphere"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_DistanceSphere — 球面の地球モデルを使って、二つの経度/緯度ジオメトリの最小距離をメートル単位で返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_DistanceSphere</b>(</code>geometry  <var class="pdparam">geomlonlatA</var>, geometry  <var class="pdparam">geomlonlatB</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp59855744"></a><h2>説明</h2><p>二つの経度緯度ジオメトリの間の最短距離をメートル単位で返します。SRIDで定義された回転楕円体に由来する半径となる球面を使います。<a class="xref" href="#ST_Distance_Spheroid" title="ST_DistanceSpheroid">ST_DistanceSpheroid</a>より高速ですが、精度が悪くなります。PostGISの1.5より前の版ではポイント間の距離の計測だけを実装していました。</p><p>Availability: 1.5 - ポイント以外のジオメトリが導入されました。以前の版ではポイントでのみ動作しました。</p><p>Changed: 2.2.0 前の版ではこの関数はST_Distance_Sphereと呼ばれていました。</p></div><div class="refsection"><a name="idp59858048"></a><h2>例</h2><pre class="programlisting">SELECT round(CAST(ST_DistanceSphere(ST_Centroid(geom), ST_GeomFromText('POINT(-118 38)',4326)) As numeric),2) As dist_meters,
round(CAST(ST_Distance(ST_Transform(ST_Centroid(geom),32611),
                ST_Transform(ST_GeomFromText('POINT(-118 38)', 4326),32611)) As numeric),2) As dist_utm11_meters,
round(CAST(ST_Distance(ST_Centroid(geom), ST_GeomFromText('POINT(-118 38)', 4326)) As numeric),5) As dist_degrees,
round(CAST(ST_Distance(ST_Transform(geom,32611),
                ST_Transform(ST_GeomFromText('POINT(-118 38)', 4326),32611)) As numeric),2) As min_dist_line_point_meters
FROM
        (SELECT ST_GeomFromText('LINESTRING(-118.584 38.374,-118.583 38.5)', 4326) As geom) as foo;
         dist_meters | dist_utm11_meters | dist_degrees | min_dist_line_point_meters
        -------------+-------------------+--------------+----------------------------
                70424.47 |          70438.00 |      0.72900 |                   65871.18

        </pre></div><div class="refsection"><a name="idp59859584"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Distance" title="ST_Distance">ST_Distance</a>, <a class="xref" href="#ST_Distance_Spheroid" title="ST_DistanceSpheroid">ST_DistanceSpheroid</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Distance_Spheroid"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_DistanceSpheroid — 回転楕円体面の地球モデルを使って、二つの経度/緯度ジオメトリの最小距離を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_DistanceSpheroid</b>(</code>geometry  <var class="pdparam">geomlonlatA</var>, geometry  <var class="pdparam">geomlonlatB</var>, spheroid  <var class="pdparam">measurement_spheroid</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp59867904"></a><h2>説明</h2><p>与えられた回転楕円体面の、二つの経度/緯度ジオメトリの最小距離をメートル単位で返します。回転楕円体面の詳細については<a class="xref" href="#ST_Length_Spheroid" title="ST_LengthSpheroid">ST_LengthSpheroid</a>をご覧下さい。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はジオメトリのSRIDを見ません。ジオメトリの座標は与えられた回転楕円体に基づくものと仮定します。 </p></td></tr></table></div><p>Availability: 1.5 - ポイント以外のジオメトリが導入されました。以前の版ではポイントでのみ動作しました。</p><p>Changed: 2.2.0 前の版ではこの関数はST_Distance_Sphereと呼ばれていました。</p></div><div class="refsection"><a name="idp59870976"></a><h2>例</h2><pre class="programlisting">SELECT round(CAST(
                ST_DistanceSpheroid(ST_Centroid(geom), ST_GeomFromText('POINT(-118 38)',4326), 'SPHEROID["WGS 84",6378137,298.257223563]')
                        As numeric),2) As dist_meters_spheroid,
                round(CAST(ST_DistanceSphere(ST_Centroid(geom), ST_GeomFromText('POINT(-118 38)',4326)) As numeric),2) As dist_meters_sphere,
round(CAST(ST_Distance(ST_Transform(ST_Centroid(geom),32611),
                ST_Transform(ST_GeomFromText('POINT(-118 38)', 4326),32611)) As numeric),2) As dist_utm11_meters
FROM
        (SELECT ST_GeomFromText('LINESTRING(-118.584 38.374,-118.583 38.5)', 4326) As geom) as foo;
 dist_meters_spheroid | dist_meters_sphere | dist_utm11_meters
----------------------+--------------------+-------------------
                         70454.92 |           70424.47 |          70438.00

        </pre></div><div class="refsection"><a name="idp59872512"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Distance" title="ST_Distance">ST_Distance</a>, <a class="xref" href="#ST_DistanceSphere" title="ST_DistanceSphere">ST_DistanceSphere</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_FrechetDistance"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_FrechetDistance — 二つのジオメトリのフレシェ距離を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_FrechetDistance</b>(</code>geometry  <var class="pdparam">g1</var>, geometry  <var class="pdparam">g2</var>, float <var class="pdparam">densifyFrac = -1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp59880704"></a><h2>説明</h2><p>両方のジオメトリの離散点への制限を受けたフレシェ距離の計算アルゴリズムの実装は<a class="ulink" href="http://www.kr.tuwien.ac.at/staff/eiter/et-archive/cdtr9464.pdf" target="_top">Computing Discrete Fréchet Distance</a>を基にしています。フレシェ距離は曲線の位置と点の並び順とを考慮に入れた曲線間の類似度を計測するものです。ハウスドルフ距離よりも良いことがしばしばあります。 </p><p>任意引数densifyFracが指定されると、この関数は、離散フレシェ距離の計算の前に、辺密度を増加させます。densifyFracパラメータは辺の高密度化に使う比率を設定します。それぞれの辺は多数の等長の辺に分割され、分割辺長の合計長に対する比は与えた比率に近くなります。 </p><p>単位はジオメトリの空間参照系の単位です。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>現在の実装では、離散位置は、頂点のみに対応しています。任意の密度でポイントを使用することができるよう拡張されています。 </p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>densityFracに小さい値を指定すると、フレシェ距離の精度が増します。しかし、分割辺数の2乗に比例して計算時間とメモリ利用量が増大します。 </p></td></tr></table></div><p>GEOSモジュールで実現しています。</p><p>Availability: 2.4.0 - GEOS 3.7.0以上が必要です。</p></div><div class="refsection"><a name="idp59885696"></a><h2>例</h2><pre class="programlisting">postgres=# SELECT st_frechetdistance('LINESTRING (0 0, 100 0)'::geometry, 'LINESTRING (0 0, 50 50, 100 0)'::geometry);
 st_frechetdistance
--------------------
   70.7106781186548
(1 row)
                        </pre><pre class="programlisting">SELECT st_frechetdistance('LINESTRING (0 0, 100 0)'::geometry, 'LINESTRING (0 0, 50 50, 100 0)'::geometry, 0.5);
 st_frechetdistance
--------------------
                 50
(1 row)
                        </pre></div><div class="refsection"><a name="idp59887488"></a><h2>関連情報</h2><p><a class="xref" href="#ST_HausdorffDistance" title="ST_HausdorffDistance">ST_HausdorffDistance</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_HausdorffDistance"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_HausdorffDistance — 二つのジオメトリ間のハウスドルフ距離を返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_HausdorffDistance</b>(</code>geometry  <var class="pdparam">g1</var>, geometry  <var class="pdparam">g2</var><code>)</code>;</p><p><code class="funcdef">float <b class="fsfunc">ST_HausdorffDistance</b>(</code>geometry  <var class="pdparam">g1</var>, geometry  <var class="pdparam">g2</var>, float <var class="pdparam">densifyFrac</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp59898496"></a><h2>説明</h2><p>二つのジオメトリ間のハウスドルフ距離を返します。二つのジオメトリがどれだけ似ているかを示す値です。 </p><p>「離散ハウスドルフ距離」とみなすことができる距離基準を計算します。これは、一つのジオメトリの離散点に制限されたハウスドルフ距離です。<a class="ulink" href="http://en.wikipedia.org/wiki/Hausdorff_distance" target="_top">Hausdorff distanceに関するWikiPedia英語版の記事</a>や<a class="ulink" href="http://lin-ear-th-inking.blogspot.com/2009/01/computing-geometric-similarity.html" target="_top">Martin Davis note on how Hausdorff Distance calculation was used to prove correctness of the CascadePolygonUnion approach.</a>などを参照して下さい。</p><p>densifyFracが指定された際には、離散ハウスドルフ距離を計算する前に、線分の密度を高めます。densifyFracパラメータは線分ごとの密度を高める小数です。それぞれの線分が、等分に分割されます。線分の長さに対する分割線分の長さの比は与えられた小数に近くなります。 </p><p>単位はジオメトリの空間参照系の単位です。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>現在の実装では、離散位置は、頂点のみに対応しています。任意の密度でポイントを使用することができるよう拡張されています。 </p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>このアルゴリズムは標準的なハウスドルフ距離と等価では*ありません*。しかし、使用可能な場面の大部分で正しくなる近似計算がなされています。重要なものに、それぞれが概ね平行で概ね等しい長さのラインストリングがあります。これはラインのマッチングに使える基準です。 </p></td></tr></table></div><p>Availability: 1.5.0</p></div><div class="refsection"><a name="idp59924480"></a><h2>例</h2><p>建物ごとに、建物を表現する最善の区画を見つけます。まず、ジオメトリとインタセクトする区画を求めます。DISTINCT ONで、建物が一覧に一度だけ出現するのを保障します。ORDER BY ... ST_HausdorffDistanceで、最も建物に近い区画が前に出ます。</p><pre class="programlisting">SELECT DISTINCT ON(buildings.gid) buildings.gid, parcels.parcel_id
   FROM buildings INNER JOIN parcels ON ST_Intersects(buildings.geom,parcels.geom)
     ORDER BY buildings.gid, ST_HausdorffDistance(buildings.geom, parcels.geom);</pre><pre class="programlisting">postgis=# SELECT ST_HausdorffDistance(
                                'LINESTRING (0 0, 2 0)'::geometry,
                                'MULTIPOINT (0 1, 1 0, 2 1)'::geometry);
 st_hausdorffdistance
 ----------------------
                                         1
(1 row)
                        </pre><pre class="programlisting">postgis=# SELECT st_hausdorffdistance('LINESTRING (130 0, 0 0, 0 150)'::geometry, 'LINESTRING (10 10, 10 150, 130 10)'::geometry, 0.5);
 st_hausdorffdistance
 ----------------------
                                        70
(1 row)
                        </pre></div><div class="refsection"><a name="idp59927168"></a><h2>関連情報</h2><p><a class="xref" href="#ST_FrechetDistance" title="ST_FrechetDistance">ST_FrechetDistance</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Length"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Length — 線系ジオメトリの2次元長を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_Length</b>(</code>geometry <var class="pdparam">a_2dlinestring</var><code>)</code>;</p><p><code class="funcdef">float <b class="fsfunc">ST_Length</b>(</code>geography <var class="pdparam">geog</var>, boolean <var class="pdparam">use_spheroid=true</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp59935872"></a><h2>説明</h2><p>ジオメトリ型: LINESTRING, MULTILINESTRING, ST_Curve, ST_MultiCurveの場合には2次元デカルト距離を返します。面ジオメトリでは0を返すので<a class="xref" href="#ST_Perimeter" title="ST_Perimeter">ST_Perimeter</a>を代わりに使います。長さの単位はジオメトリの空間参照系で決まります。</p><p>ジオグラフィ型: 計算は逆測地問題を用いています。長さの単位はメートルです。PROJ 4.8.0以上をでPostGISをコンパイルしている場合には、回転楕円体面はSRIDで指定されたものとなり、それより前はWGS84となります。<code class="varname">use_spheroid=false</code>とすると、計算は回転楕円体面でなく真球面で行います。 </p><p>現在は、ジオメトリに対してはST_Length2Dの別名ですが、高次元対応に変更されるかも知れません。</p><div class="warning"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Changed: 2.0.0 大幅な変更 -- 以前の版ではジオグラフィのPOLYGONやMULTIPOLYGONへの適用によってPOLYGONやMULTIPOLYGONの周囲長を返しました。2.0.0版ではジオメトリの挙動に従うため0を返すように変更しました。ポリゴンの周囲長を求める場合は、ST_Perimeterを使います。</p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ジオグラフィでは計算は回転楕円体面モデルを使用します。計算が速い反面精度が低い球面計算を使うには、 ST_Length(gg,false)とします。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OGC Simple Features
 Implementation Specification for SQL 1.1.</a> s2.1.5.1</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 7.1.2, 9.3.4</p><p>Availability: 1.5.0 ジオグラフィt対応が導入されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method is also provided by SFCGAL backend.</p></div><div class="refsection"><a name="idp59949696"></a><h2>ジオメトリの例</h2><p>ラインストリングのフィート単位の長さを返します。EPSG:2249はフィート単位のマサチューセッツ州平面なので、フィート単位になることに注意して下さい。</p><pre class="programlisting">SELECT ST_Length(ST_GeomFromText('LINESTRING(743238 2967416,743238 2967450,743265 2967450,
743265.625 2967416,743238 2967416)',2249));

st_length
---------
 122.630744000095


-- WGS84ラインストリングをメートル単位のマサチューセッツ州平面に変換
SELECT ST_Length(
        ST_Transform(
                ST_GeomFromEWKT('SRID=4326;LINESTRING(-72.1260 42.45, -72.1240 42.45666, -72.123 42.1546)'),
                26986
        )
);

st_length
---------
34309.4563576191
                        </pre></div><div class="refsection"><a name="idp59951360"></a><h2>ジオグラフィの例</h2><p>WGS84ジオグラフィのラインの長さを返します。</p><pre class="programlisting">-- デフォルトでは計算に回転楕円体面を使用
SELECT ST_Length(the_geog) As length_spheroid,  ST_Length(the_geog,false) As length_sphere
FROM (SELECT ST_GeographyFromText(
'SRID=4326;LINESTRING(-72.1260 42.45, -72.1240 42.45666, -72.123 42.1546)') As the_geog)
 As foo;

 length_spheroid  |  length_sphere
------------------+------------------
 34310.5703627288 | 34346.2060960742
                        </pre></div><div class="refsection"><a name="idp59953152"></a><h2>関連情報</h2><p><a class="xref" href="#">???</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#ST_Length_Spheroid" title="ST_LengthSpheroid">ST_LengthSpheroid</a>, <a class="xref" href="#ST_Perimeter" title="ST_Perimeter">ST_Perimeter</a>, <a class="xref" href="#">???</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Length2D"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Length2D — ラインジオメトリの2次元長を返します。<code class="varname">ST_Length</code>の別名です。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_Length2D</b>(</code>geometry  <var class="pdparam">a_2dlinestring</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp59960832"></a><h2>説明</h2><p>ラインストリングまたはマルチラインストリングの場合には、ジオメトリの2次元長を返します。これは<code class="varname">ST_Length</code>の別名です。</p></div><div class="refsection"><a name="idp59962624"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Length" title="ST_Length">ST_Length</a>, <a class="xref" href="#ST_3DLength" title="ST_3DLength">ST_3DLength</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_3DLength"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_3DLength — 線ジオメトリの3次元長を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_3DLength</b>(</code>geometry  <var class="pdparam">a_3dlinestring</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp59968768"></a><h2>説明</h2><p>LINESTRINGまたはMULTILINESTRINGに対して、ジオメトリの3次元長または2次元長を返します。2次元ラインについては、2次元長を返します (ST_LengthやST_Length2Dと同じです)。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p>Changed: 2.0.0 以前の版ではST_Length3Dと呼ばれていました。</p></div><div class="refsection"><a name="idp59971712"></a><h2>例</h2><p>3次元ケーブルの長さをフィート単位で返します。EPSG:2249はフィート単位のマサチューセッツ州平面なので、フィート単位になることに注意して下さい。</p><pre class="programlisting">SELECT ST_3DLength(ST_GeomFromText('LINESTRING(743238 2967416 1,743238 2967450 1,743265 2967450 3,
743265.625 2967416 3,743238 2967416 3)',2249));
ST_3DLength
-----------
122.704716741457
                </pre></div><div class="refsection"><a name="idp59973632"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Length" title="ST_Length">ST_Length</a>, <a class="xref" href="#ST_Length2D" title="ST_Length2D">ST_Length2D</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Length_Spheroid"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_LengthSpheroid — 回転楕円体面上の経度緯度のジオメトリの2次元または3次元の長さ/周長を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_LengthSpheroid</b>(</code>geometry  <var class="pdparam">a_geometry</var>, spheroid  <var class="pdparam">a_spheroid</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp59980928"></a><h2>説明</h2><p>回転楕円体面上のジオメトリの周長を返します。この関数は、ジオメトリの座標が経度/緯度で、投影変換なしで長さを求めたい場合に使います。</p><div class="literallayout"><p>SPHEROID[&lt;名称&gt;,&lt;長軸半径&gt;,&lt;扁平率の逆数&gt;]</p></div><p>例:</p><div class="literallayout"><p>SPHEROID["GRS_1980",6378137,298.257222101]</p></div><p>Availability: 1.2.2</p><p>Changed: 2.2.0 これより前の版では、これはST_Length_Spheroidと呼ばれ、ST_3DLength_Spheroidという別名を持っていました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp59985920"></a><h2>例</h2><pre class="programlisting">SELECT ST_LengthSpheroid( geometry_column,
                          'SPHEROID["GRS_1980",6378137,298.257222101]' )
                          FROM geometry_table;

SELECT ST_LengthSpheroid( geom, sph_m ) As tot_len,
ST_LengthSpheroid(ST_GeometryN(geom,1), sph_m) As len_line1,
ST_LengthSpheroid(ST_GeometryN(geom,2), sph_m) As len_line2
                          FROM (SELECT ST_GeomFromText('MULTILINESTRING((-118.584 38.374,-118.583 38.5),
        (-71.05957 42.3589 , -71.061 43))') As geom,
CAST('SPHEROID["GRS_1980",6378137,298.257222101]' As spheroid) As sph_m)  as foo;
        tot_len      |    len_line1     |    len_line2
------------------+------------------+------------------
 85204.5207562955 | 13986.8725229309 | 71217.6482333646

 --3D
SELECT ST_LengthSpheroid( geom, sph_m ) As tot_len,
ST_LengthSpheroid(ST_GeometryN(geom,1), sph_m) As len_line1,
ST_LengthSpheroid(ST_GeometryN(geom,2), sph_m) As len_line2
                          FROM (SELECT ST_GeomFromEWKT('MULTILINESTRING((-118.584 38.374 20,-118.583 38.5 30),
        (-71.05957 42.3589 75, -71.061 43 90))') As geom,
CAST('SPHEROID["GRS_1980",6378137,298.257222101]' As spheroid) As sph_m)  as foo;

         tot_len      |    len_line1    |    len_line2
------------------+-----------------+------------------
 85204.5259107402 | 13986.876097711 | 71217.6498130292

</pre></div><div class="refsection"><a name="idp59987456"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeometryN" title="ST_GeometryN">ST_GeometryN</a>, <a class="xref" href="#ST_Length" title="ST_Length">ST_Length</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_LongestLine"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_LongestLine — 二つのジオメトリ間の2次元最長ラインを返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_LongestLine</b>(</code>geometry  <var class="pdparam">g1</var>, geometry  <var class="pdparam">g2</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp59994624"></a><h2>説明</h2><p>二つのジオメトリの2次元長が最長となるポイントを返します。 </p><p>最長ラインが複数現れた場合には、最初の最長ラインを返します。ラインはg1で始まりg2で終わります。ラインの長さは<a class="xref" href="#ST_MaxDistance" title="ST_MaxDistance">ST_MaxDistance</a>で返される距離と同じです。 </p><p>Availability: 1.5.0</p></div><div class="refsection"><a name="idp59996928"></a><h2>例</h2><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col></colgroup><tbody><tr><td style="border-bottom: 1px solid ; "><div class="informalfigure"><div class="mediaobject"><img src="images/st_longestline01.png"><div class="caption"><p>ポイントとラインストリングの間の最長となるライン</p></div></div></div><p>
				</p><pre class="programlisting">SELECT ST_AsText(
        ST_LongestLine('POINT(100 100)'::geometry,
                'LINESTRING (20 80, 98 190, 110 180, 50 75 )'::geometry)
        ) As lline;


   lline
-----------------
LINESTRING(100 100,98 190)
                                </pre><p>
						  </p></td></tr><tr><td style=""><div class="informalfigure"><div class="mediaobject"><img src="images/st_longestline02.png"><div class="caption"><p>二つのポリゴンの間の最長となるライン</p></div></div></div><p>
				</p><pre class="programlisting">SELECT ST_AsText(
        ST_LongestLine(
                ST_GeomFromText('POLYGON((175 150, 20 40,
                        50 60, 125 100, 175 150))'),
                ST_Buffer(ST_GeomFromText('POINT(110 170)'), 20)
                )
        ) As llinewkt;

   lline
-----------------
LINESTRING(20 40,121.111404660392 186.629392246051)
                                </pre><p>
						</p></td></tr></tbody></table></div><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col></colgroup><tbody><tr><td style=""><div class="informalfigure"><div class="mediaobject"><img src="images/st_longestline03.png"><div class="caption"><p>市内のある場所から別の場所への移動で最長となる直線距離。最長距離はラインの長さと同じとなることに注意して下さい。</p></div></div></div><p>
				</p><pre class="programlisting">SELECT ST_AsText( ST_LongestLine(c.geom, c.geom)) AS llinewkt,
       ST_MaxDistance( c.geom,c.geom) AS max_dist,
       ST_Length( ST_LongestLine(c.geom, c.geom)) AS lenll
FROM (SELECT ST_MakeValid( ST_Collect(geom)) AS geom
      FROM (SELECT ST_Translate( ST_SnapToGrid(
                ST_Buffer(
                    ST_Point(50 ,generate_series(50,190, 50)),
                    40, 'quad_segs=2'),1), x, 0) AS geom
            FROM generate_series(1,100,50) As x) AS foo
      ) AS c;

          llinewkt          |     max_dist     |      lenll
---------------------------+------------------+------------------
 LINESTRING(23 22,129 178) | 188.605408193933 | 188.605408193933
                                </pre><p>
						</p></td></tr></tbody></table></div></div><div class="refsection"><a name="idp60010624"></a><h2>関連情報</h2><p><a class="xref" href="#ST_MaxDistance" title="ST_MaxDistance">ST_MaxDistance</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#ST_ShortestLine" title="ST_ShortestLine">ST_ShortestLine</a>, <a class="xref" href="#ST_3DLongestLine" title="ST_3DLongestLine">ST_3DLongestLine</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_3DLongestLine"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_3DLongestLine — 二つのジオメトリ間の3次元最長ラインを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_3DLongestLine</b>(</code>geometry  <var class="pdparam">g1</var>, geometry  <var class="pdparam">g2</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp60018560"></a><h2>説明</h2><p>二つのジオメトリ間の3次元最長ラインを返します。該当が複数ある場合には最初の最長ラインを返します。返されるラインは、g1から始まりg2で終わります。ラインの3次元長は<a class="xref" href="#ST_3DMaxDistance" title="ST_3DMaxDistance">ST_3DMaxDistance</a>が返す距離と同じです。 </p><p>Availability: 2.0.0</p><p>Changed: 2.2.0 - 二つの2次元ジオメトリが入力である場合には、2次元ポイントが返ります (古い挙動では、存在しないZの値について0を仮定していました)。2次元と3次元の場合には、もはや、存在しないZの値について0を仮定しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p></div><div class="refsection"><a name="idp60023936"></a><h2>例</h2><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col></colgroup><tbody><tr><td style="border-bottom: 1px solid ; "><p>ラインストリングとポイント -- 3次元と2次元の最長ライン </p><pre class="programlisting">SELECT ST_AsEWKT(ST_3DLongestLine(line,pt)) AS lol3d_line_pt,
                ST_AsEWKT(ST_LongestLine(line,pt)) As lol2d_line_pt
        FROM (SELECT 'POINT(100 100 30)'::geometry As pt,
                        'LINESTRING (20 80 20, 98 190 1, 110 180 3, 50 75 1000)'::geometry As line
                ) As foo;


           lol3d_line_pt           |       lol2d_line_pt
-----------------------------------+----------------------------
 LINESTRING(50 75 1000,100 100 30) | LINESTRING(98 190,100 100)
                                        </pre><p>
							  </p></td></tr><tr><td style="border-bottom: 1px solid ; "><p>ラインストリングとマルチポイント -- 3次元と2次元の最長ライン </p><pre class="programlisting">SELECT ST_AsEWKT(ST_3DLongestLine(line,pt)) AS lol3d_line_pt,
                ST_AsEWKT(ST_LongestLine(line,pt)) As lol2d_line_pt
        FROM (SELECT 'MULTIPOINT(100 100 30, 50 74 1000)'::geometry As pt,
                        'LINESTRING (20 80 20, 98 190 1, 110 180 3, 50 75 900)'::geometry As line
                ) As foo;


          lol3d_line_pt          |      lol2d_line_pt
---------------------------------+--------------------------
 LINESTRING(98 190 1,50 74 1000) | LINESTRING(98 190,50 74)
                                        </pre><p>
							  </p></td></tr><tr><td style=""><p>マルチラインストリングとポリゴンの3次元と2次元の最長ライン </p><pre class="programlisting">SELECT ST_AsEWKT(ST_3DLongestLine(poly, mline)) As lol3d,
    ST_AsEWKT(ST_LongestLine(poly, mline)) As lol2d
        FROM (SELECT  ST_GeomFromEWKT('POLYGON((175 150 5, 20 40 5, 35 45 5, 50 60 5, 100 100 5, 175 150 5))') As poly,
                ST_GeomFromEWKT('MULTILINESTRING((175 155 2, 20 40 20, 50 60 -2, 125 100 1, 175 155 1),
                (1 10 2, 5 20 1))') As mline ) As foo;
            lol3d             |          lol2d
------------------------------+--------------------------
 LINESTRING(175 150 5,1 10 2) | LINESTRING(175 150,1 10)
             </pre><p>
							  </p></td></tr></tbody></table></div></div><div class="refsection"><a name="idp60030208"></a><h2>関連情報</h2><p><a class="xref" href="#ST_3DClosestPoint" title="ST_3DClosestPoint">ST_3DClosestPoint</a>, <a class="xref" href="#ST_3DDistance" title="ST_3DDistance">ST_3DDistance</a>, <a class="xref" href="#ST_LongestLine" title="ST_LongestLine">ST_LongestLine</a>, <a class="xref" href="#ST_3DShortestLine" title="ST_3DShortestLine">ST_3DShortestLine</a>, <a class="xref" href="#ST_3DMaxDistance" title="ST_3DMaxDistance">ST_3DMaxDistance</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_MaxDistance"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MaxDistance — 二つのジオメトリ間の2次元最長距離を空間参照系の単位で返します</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_MaxDistance</b>(</code>geometry  <var class="pdparam">g1</var>, geometry  <var class="pdparam">g2</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp60038528"></a><h2>説明</h2><p>二つのジオメトリの2次元最長距離を空間参照系の単位で返します。最長距離は常に二つの頂点間で発生します。これは<a class="xref" href="#ST_LongestLine" title="ST_LongestLine">ST_LongestLine</a>が返すラインの長さと同じです。 </p><p>g1とg2が同じジオメトリであった場合には、そのジオメトリ内の最も遠くなる二つの頂点間の距離を返します。 </p><p>Availability: 1.5.0</p></div><div class="refsection"><a name="idp60041088"></a><h2>例</h2><p>ポイントとラインの最長距離。</p><pre class="programlisting">postgis=# SELECT ST_MaxDistance('POINT(0 0)'::geometry, 'LINESTRING ( 2 0, 0 2 )'::geometry);
   st_maxdistance
-----------------
 2

postgis=# SELECT ST_MaxDistance('POINT(0 0)'::geometry, 'LINESTRING ( 2 2, 2 2 )'::geometry);
  st_maxdistance
------------------
 2.82842712474619
</pre><p>一つのジオメトリ内の頂点間の最長距離。</p><pre class="programlisting">SELECT ST_MaxDistance('POLYGON ((10 10, 10 0, 0 0, 10 10))'::geometry,
                      'POLYGON ((10 10, 10 0, 0 0, 10 10))'::geometry);
  st_maxdistance
------------------
 14.142135623730951
</pre></div><div class="refsection"><a name="idp60043904"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Distance" title="ST_Distance">ST_Distance</a>, <a class="xref" href="#ST_LongestLine" title="ST_LongestLine">ST_LongestLine</a>, <a class="xref" href="#">???</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_3DMaxDistance"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_3DMaxDistance — 二つのジオメトリ間の3次元最大デカルト距離 (空間参照系に基づく)を空間参照系の単位で返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_3DMaxDistance</b>(</code>geometry  <var class="pdparam">g1</var>, geometry  <var class="pdparam">g2</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp60063744"></a><h2>説明</h2><p>二つのジオメトリ間の3次元の最大デカルト距離を空間参照系の単位で返します。 </p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p>Availability: 2.0.0</p><p>Changed: 2.2.0 - 2次元と3次元の場合には、もはや、存在しないZの値について0を仮定しません。</p></div><div class="refsection"><a name="idp60068736"></a><h2>例</h2><pre class="programlisting">-- ジオメトリの例 - メートル単位(SRID: 2163 米国ナショナルアトラス正積図法)
-- (3次元ポイントとラインの距離と、2次元ポイントとラインの距離とを比較)
-- ご注意: 現在は垂直データムに対応していないので、Zは変換されずに、最終的に同じであると仮定されます。
SELECT ST_3DMaxDistance(
                        ST_Transform(ST_GeomFromEWKT('SRID=4326;POINT(-72.1235 42.3521 10000)'),2163),
                        ST_Transform(ST_GeomFromEWKT('SRID=4326;LINESTRING(-72.1260 42.45 15, -72.123 42.1546 20)'),2163)
                ) As dist_3d,
                ST_MaxDistance(
                        ST_Transform(ST_GeomFromEWKT('SRID=4326;POINT(-72.1235 42.3521 10000)'),2163),
                        ST_Transform(ST_GeomFromEWKT('SRID=4326;LINESTRING(-72.1260 42.45 15, -72.123 42.1546 20)'),2163)
                ) As dist_2d;

     dist_3d      |     dist_2d
------------------+------------------
 24383.7467488441 | 22247.8472107251
</pre></div><div class="refsection"><a name="idp60070016"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Distance" title="ST_Distance">ST_Distance</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#ST_3DMaxDistance" title="ST_3DMaxDistance">ST_3DMaxDistance</a>, <a class="xref" href="#">???</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_MinimumClearance"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MinimumClearance — ジオメトリのクリアランスの最小値を返します。この値はジオメトリのロバスト性を示すものです。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_MinimumClearance</b>(</code>geometry <var class="pdparam">g</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp60076800"></a><h2>説明</h2><p><a class="xref" href="#">???</a> (ポリゴン)または<a class="xref" href="#ST_IsSimple" title="ST_IsSimple">ST_IsSimple</a> (ライン)に従って、ジオメトリは妥当性基準を満たせますが、そのうちの一つの頂点が短い距離だけ移動すると不正になります。これは、テキスト書式 (WKT, KML, GML, GeoJSON等)に変換する際の精度の損失や、倍精度浮動小数点座標値を使わない書式 (MapInfo TAB等)で発生する可能性があります。 </p><p>クリアランスの最小値は、座標精度を変更するためのジオメトリのロバスト性を定量的に計測したものです。ジオメトリの頂点が不正なジオメトリとなることなしに移動できる最大距離です。最小クリアランスは、その値が大きいほどロバスト性が大きいことを示しています。 </p><p>ジオメトリがクリアランスの最小値<code class="varname">e</code>を持つ場合: </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>距離<code class="varname">e</code>より近くなるジオメトリ内の二つの個別の頂点はありません。 </p></li><li class="listitem"><p>頂点について、その頂点の端点となる辺を除いて、辺との距離が<code class="varname">e</code>より近いものは存在しない </p></li></ul></div><p>
		</p><p>ジオメトリで最小クリアランスを持たない (単一のポイント、要素ポイントが全く同じのマルチポイントなど)場合には、<code class="varname">Infinity</code>.を返します。 </p><p>精度の損失による有効性の問題を回避するには、 <a class="xref" href="#ST_ReducePrecision" title="ST_ReducePrecision">ST_ReducePrecision</a>を使うと、ポリゴンジオメトリの妥当性を確実に維持しつつ座標値の精度を減らせられます。 </p><p>Availability: 2.3.0</p></div><div class="refsection"><a name="idp60088576"></a><h2>例</h2><pre class="programlisting">SELECT ST_MinimumClearance('POLYGON ((0 0, 1 0, 1 1, 0.5 3.2e-4, 0 0))');
 st_minimumclearance
---------------------
             0.00032
     </pre></div><div class="refsection"><a name="idp60089856"></a><h2>関連情報</h2><p><a class="xref" href="#ST_MinimumClearanceLine" title="ST_MinimumClearanceLine">ST_MinimumClearanceLine</a>, <a class="xref" href="#ST_IsSimple" title="ST_IsSimple">ST_IsSimple</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#ST_ReducePrecision" title="ST_ReducePrecision">ST_ReducePrecision</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_MinimumClearanceLine"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MinimumClearanceLine — ジオメトリの最小クリアランスを示す、2点のラインストリングを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">Geometry <b class="fsfunc">ST_MinimumClearanceLine</b>(</code>geometry  <var class="pdparam">g</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp58454400"></a><h2>説明</h2><p>ジオメトリの最小クリアランスを示す、2点のラインストリングを返します。ジオメトリが最小クリアランスを持たない場合には、<code class="varname">LINESTRING EMPTY</code>が返ります。 </p><p>GEOSモジュールで実現しています。</p><p>Availability: 2.3.0 - GEOS 3.6.0以上が必要です。</p></div><div class="refsection"><a name="idp58456832"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(ST_MinimumClearanceLine('POLYGON ((0 0, 1 0, 1 1, 0.5 3.2e-4, 0 0))'));
st_astext
-------------------------------
LINESTRING(0.5 0.00032,0.5 0)
                  </pre></div><div class="refsection"><a name="idp58458112"></a><h2>関連情報</h2><p>
			<a class="xref" href="#ST_MinimumClearance" title="ST_MinimumClearance">ST_MinimumClearance</a>
		</p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Perimeter"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Perimeter — ポリゴンジオメトリまたはジオグラフィの境界の長さを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_Perimeter</b>(</code>geometry <var class="pdparam">g1</var><code>)</code>;</p><p><code class="funcdef">float <b class="fsfunc">ST_Perimeter</b>(</code>geography <var class="pdparam">geog</var>, boolean <var class="pdparam">use_spheroid=true</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp58467072"></a><h2>説明</h2><p>ジオメトリ/ジオグラフィがST_SrrfaceまたはST_MultiSurface (POLYGONまたはMULTIPOLYGON)の場合に、2次元周囲長を返します。面ジオメトリでない場合には0を返します。ラインストリングについては<a class="xref" href="#ST_Length" title="ST_Length">ST_Length</a>を使います。ジオメトリに対しては、周囲長の計測単位は空間参照系によります。</p><p>ジオグラフィに対しては、測地線の逆問題を使って計算し、長さの単位はメートルです。PostGISをPROJ 4.8.0以上でコンパイルしているなら、回転楕円体面はSRIDで指定されたものですが、そうでなければ、WGS84に限定されます。<code class="varname">use_spheroid=false</code>とすると、回転楕円体面でなく近似する球面で計算します。</p><p>現在は、この関数はST_Perimeter2Dの別名ですが、高次元対応に変更されるかも知れません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OGC Simple Features
 Implementation Specification for SQL 1.1.</a> s2.1.5.1</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 8.1.3, 9.5.4</p><p>Availability: 2.0.0 ジオグラフィ対応が導入されました。</p></div><div class="refsection"><a name="idp60095360"></a><h2>例: ジオメトリ</h2><p>POLYGONとMULTIPOLYGONに対するフィート単位の周囲長を返します。EPSG:2249はフィート単位のマサチューセッツ平面なので、フィート単位です。</p><pre class="programlisting">SELECT ST_Perimeter(ST_GeomFromText('POLYGON((743238 2967416,743238 2967450,743265 2967450,
743265.625 2967416,743238 2967416))', 2249));
st_perimeter
---------
 122.630744000095
(1 row)

SELECT ST_Perimeter(ST_GeomFromText('MULTIPOLYGON(((763104.471273676 2949418.44119003,
763104.477769673 2949418.42538203,
763104.189609677 2949418.22343004,763104.471273676 2949418.44119003)),
((763104.471273676 2949418.44119003,763095.804579742 2949436.33850239,
763086.132105649 2949451.46730207,763078.452329651 2949462.11549407,
763075.354136904 2949466.17407812,763064.362142565 2949477.64291974,
763059.953961626 2949481.28983009,762994.637609571 2949532.04103014,
762990.568508415 2949535.06640477,762986.710889563 2949539.61421415,
763117.237897679 2949709.50493431,763235.236617789 2949617.95619822,
763287.718121842 2949562.20592617,763111.553321674 2949423.91664605,
763104.471273676 2949418.44119003)))', 2249));
st_perimeter
---------
 845.227713366825
(1 row)
                        </pre></div><div class="refsection"><a name="idp60097024"></a><h2>例: ジオグラフィ</h2><p>ポリゴンとマルチポリゴンのメートル単位とフィート単位の周囲長を返します。ジオグラフィ (WGS 84経度緯度)であることに注意して下さい。</p><pre class="programlisting">SELECT  ST_Perimeter(geog) As per_meters, ST_Perimeter(geog)/0.3048 As per_ft
FROM ST_GeogFromText('POLYGON((-71.1776848522251 42.3902896512902,-71.1776843766326 42.3903829478009,
-71.1775844305465 42.3903826677917,-71.1775825927231 42.3902893647987,-71.1776848522251 42.3902896512902))') As geog;

   per_meters    |      per_ft
-----------------+------------------
37.3790462565251 | 122.634666195949


-- MultiPolygon example --
SELECT  ST_Perimeter(geog) As per_meters, ST_Perimeter(geog,false) As per_sphere_meters,  ST_Perimeter(geog)/0.3048 As per_ft
FROM ST_GeogFromText('MULTIPOLYGON(((-71.1044543107478 42.340674480411,-71.1044542869917 42.3406744369506,
-71.1044553562977 42.340673886454,-71.1044543107478 42.340674480411)),
((-71.1044543107478 42.340674480411,-71.1044860600303 42.3407237015564,-71.1045215770124 42.3407653385914,
-71.1045498002983 42.3407946553165,-71.1045611902745 42.3408058316308,-71.1046016507427 42.340837442371,
-71.104617893173 42.3408475056957,-71.1048586153981 42.3409875993595,-71.1048736143677 42.3409959528211,
-71.1048878050242 42.3410084812078,-71.1044020965803 42.3414730072048,
-71.1039672113619 42.3412202916693,-71.1037740497748 42.3410666421308,
-71.1044280218456 42.3406894151355,-71.1044543107478 42.340674480411)))') As geog;

    per_meters    | per_sphere_meters |      per_ft
------------------+-------------------+------------------
 257.634283683311 |  257.412311446337 | 845.256836231335
                        </pre></div><div class="refsection"><a name="idp60098688"></a><h2>関連情報</h2><p><a class="xref" href="#">???</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#ST_Length" title="ST_Length">ST_Length</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Perimeter2D"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Perimeter2D — ポリゴンジオメトリの2次元周長を返します。<code class="varname">ST_Perimeter</code>の別名です。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_Perimeter2D</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp60105600"></a><h2>説明</h2><p>ポリゴンジオメトリの2次元周長を返します。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これは、現在はST_Perimeterの別名です。将来的に、ST_Perimeterがジオメトリの最大次元の周囲長を返すようになるかも知れません。これは、まだ考慮中です。</p></td></tr></table></div></div><div class="refsection"><a name="idp60108032"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Perimeter" title="ST_Perimeter">ST_Perimeter</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_3DPerimeter"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_3DPerimeter — ポリゴンジオメトリの3次元周長を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_3DPerimeter</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp60113792"></a><h2>説明</h2><p>POLYGONまたはMULTIPOLYGONジオメトリの場合には、3次元周囲長を返します。ジオメトリが2次元の場合には、2次元周囲長を返します。 </p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p>Changed: 2.0.0 以前の版ではST_Perimeter3Dと呼ばれていました。</p></div><div class="refsection"><a name="idp60116736"></a><h2>例</h2><p>フィート単位のマサチューセッツ州平面での、大気中にある、わずかに持ち上げられたポリゴンの周囲長です。</p><pre class="programlisting">SELECT ST_3DPerimeter(geom), ST_Perimeter2d(geom), ST_Perimeter(geom) FROM
                        (SELECT ST_GeomFromEWKT('SRID=2249;POLYGON((743238 2967416 2,743238 2967450 1,
743265.625 2967416 1,743238 2967416 2))') As geom) As foo;

  ST_3DPerimeter  |  st_perimeter2d  |   st_perimeter
------------------+------------------+------------------
 105.465793597674 | 105.432997272188 | 105.432997272188

</pre></div><div class="refsection"><a name="idp60118656"></a><h2>関連情報</h2><p><a class="xref" href="#">???</a>, <a class="xref" href="#ST_Perimeter" title="ST_Perimeter">ST_Perimeter</a>, <a class="xref" href="#ST_Perimeter2D" title="ST_Perimeter2D">ST_Perimeter2D</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Project"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Project — 始点から距離と方位で算出されたポイントを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geography <b class="fsfunc">ST_Project</b>(</code>geography  <var class="pdparam">g1</var>, float  <var class="pdparam">distance</var>, float  <var class="pdparam">azimuth</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp60127232"></a><h2>説明</h2><p>始点から測地線に沿って与えられた距離と方位で算出されたポイントを返します。測地問題と言われるものです。</p><p>距離はメートルで与えます。負数に対応しています。</p><p>方位はラジアンで与えます。真北 (方位 0)から時計回りに増えます。 東は方位 π/2 (90度)、南は方位 π (180度)、西は方位 3π/2 (270度)です。負数と2π (360度)以上の値に対応しています。 </p><p>Availability: 2.0.0</p><p>Enhanced: 2.4.0 負の距離と非正規化方位を許容するようになりました</p></div><div class="refsection"><a name="idp60129920"></a><h2>例: 100,000メートル、方位45度で計算されるポイント </h2><pre class="programlisting">SELECT ST_AsText(ST_Project('POINT(0 0)'::geography, 100000, radians(45.0)));

                 st_astext
--------------------------------------------
 POINT(0.635231029125537 0.639472334729198)
(1 row)
      </pre></div><div class="refsection"><a name="idp60131200"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Azimuth" title="ST_Azimuth">ST_Azimuth</a>, <a class="xref" href="#ST_Distance" title="ST_Distance">ST_Distance</a>, <a class="ulink" href="http://www.postgresql.org/docs/current/interactive/functions-math.html" target="_top">PostgreSQL function radians()</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_ShortestLine"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ShortestLine — 二つのジオメトリの3次元の最短ラインを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_ShortestLine</b>(</code>geometry  <var class="pdparam">g1</var>, geometry  <var class="pdparam">g2</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp60159360"></a><h2>説明</h2><p>二つのジオメトリの2次元最短ラインを返します。複数発見した場合には、最初のラインを返します。g1とg2が1点でインタセクトする場合には、インタセクトした点を始点と終点として返します。g1とg2が複数点でインタセクトする場合には、インタセクトした点からなるラインを返しますが、どの点になるかは分かりません。返されるラインは常にg1が始点でg2が終点です。この関数が返すラインの長さは常にg1とg2を引数に取ったST_Distanceの返り値と同じです。 </p><p>Availability: 1.5.0</p></div><div class="refsection"><a name="idp60160896"></a><h2>例</h2><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col><col></colgroup><tbody><tr><td style="border-right: 1px solid ; "><div class="informalfigure"><div class="mediaobject"><img src="images/st_shortestline01.png"><div class="caption"><p>ポイントとラインストリングの最短ライン</p></div></div></div><p>
				</p><pre class="programlisting">SELECT ST_AsText(
        ST_ShortestLine('POINT(100 100)'::geometry,
                'LINESTRING (20 80, 98 190, 110 180, 50 75 )'::geometry)
        ) As sline;


   sline
-----------------
LINESTRING(100 100,73.0769230769231 115.384615384615)
                                </pre><p>
						  </p></td><td style=""><div class="informalfigure"><div class="mediaobject"><img src="images/st_shortestline02.png"><div class="caption"><p>ポリゴンとポリゴンの最短ライン</p></div></div></div><p>
				</p><pre class="programlisting">SELECT ST_AsText(
                ST_ShortestLine(
                        ST_GeomFromText('POLYGON((175 150, 20 40, 50 60, 125 100, 175 150))'),
                        ST_Buffer(ST_GeomFromText('POINT(110 170)'), 20)
                        )
                ) As slinewkt;

 LINESTRING(140.752120669087 125.695053378061,121.111404660392 153.370607753949)
                                </pre><p>
						</p></td></tr></tbody></table></div></div><div class="refsection"><a name="idp60169472"></a><h2>関連情報</h2><p><a class="xref" href="#ST_ClosestPoint" title="ST_ClosestPoint">ST_ClosestPoint</a>, <a class="xref" href="#ST_Distance" title="ST_Distance">ST_Distance</a>, <a class="xref" href="#ST_LongestLine" title="ST_LongestLine">ST_LongestLine</a>, <a class="xref" href="#ST_MaxDistance" title="ST_MaxDistance">ST_MaxDistance</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_3DShortestLine"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_3DShortestLine — 二つのジオメトリの3次元の最短ラインを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_3DShortestLine</b>(</code>geometry  <var class="pdparam">g1</var>, geometry  <var class="pdparam">g2</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp60177408"></a><h2>説明</h2><p>二つのジオメトリの3次元長が最短となるラインを返します。見つかった最短線が複数ある場合は、最初のもののみ返します。g1とg2が1点のみでインタセクトする場合は、インタセクション点を開始点と終了点とします。g1とg2が1点より多くインタセクトする場合は、同じ点を開始点と終了点としますが、その点は不定です。返されるラインは常にg1側を始点、g2側を終点とします。この関数が返すラインの長さは、常にg1とg2を指定した場合の<a class="xref" href="#ST_3DDistance" title="ST_3DDistance">ST_3DDistance</a>が返す値と同じになります。 </p><p>Availability: 2.0.0</p><p>Changed: 2.2.0 - 二つの2次元ジオメトリが入力である場合には、2次元ポイントが返ります (古い挙動では、存在しないZの値について0を仮定していました)。2次元と3次元の場合には、もはや、存在しないZの値について0を仮定しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p></div><div class="refsection"><a name="idp60182784"></a><h2>例</h2><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col></colgroup><tbody><tr><td style="border-bottom: 1px solid ; "><p>ラインストリングとポイント -- 3次元と2次元の最短ライン </p><pre class="programlisting">SELECT ST_AsEWKT(ST_3DShortestLine(line,pt)) AS shl3d_line_pt,
                ST_AsEWKT(ST_ShortestLine(line,pt)) As shl2d_line_pt
        FROM (SELECT 'POINT(100 100 30)'::geometry As pt,
                        'LINESTRING (20 80 20, 98 190 1, 110 180 3, 50 75 1000)'::geometry As line
                ) As foo;


 shl3d_line_pt                                                                 |               shl2d_line_pt
----------------------------------------------------------------------------+------------------------------------------------------
 LINESTRING(54.6993798867619 128.935022917228 11.5475869506606,100 100 30)  | LINESTRING(73.0769230769231 115.384615384615,100 100)
                                        </pre><p>
							  </p></td></tr><tr><td style="border-bottom: 1px solid ; "><p>ラインストリングとマルチポイント -- 3次元と2次元の最短ライン </p><pre class="programlisting">SELECT ST_AsEWKT(ST_3DShortestLine(line,pt)) AS shl3d_line_pt,
                ST_AsEWKT(ST_ShortestLine(line,pt)) As shl2d_line_pt
        FROM (SELECT 'MULTIPOINT(100 100 30, 50 74 1000)'::geometry As pt,
                        'LINESTRING (20 80 20, 98 190 1, 110 180 3, 50 75 900)'::geometry As line
                ) As foo;


                       shl3d_line_pt                                       | shl2d_line_pt
---------------------------------------------------------------------------+------------------------
 LINESTRING(54.6993798867619 128.935022917228 11.5475869506606,100 100 30) | LINESTRING(50 75,50 74)
                                        </pre><p>
							  </p></td></tr><tr><td style=""><p>マルチラインストリングとポリゴンの3次元と2次元の最短ライン </p><pre class="programlisting">SELECT ST_AsEWKT(ST_3DShortestLine(poly, mline)) As shl3d,
    ST_AsEWKT(ST_ShortestLine(poly, mline)) As shl2d
        FROM (SELECT  ST_GeomFromEWKT('POLYGON((175 150 5, 20 40 5, 35 45 5, 50 60 5, 100 100 5, 175 150 5))') As poly,
                ST_GeomFromEWKT('MULTILINESTRING((175 155 2, 20 40 20, 50 60 -2, 125 100 1, 175 155 1),
                (1 10 2, 5 20 1))') As mline ) As foo;
                   shl3d                                                                           |     shl2d
---------------------------------------------------------------------------------------------------+------------------------
 LINESTRING(39.993580415989 54.1889925532825 5,40.4078575708294 53.6052383805529 5.03423778139177) | LINESTRING(20 40,20 40)
             </pre><p>
							  </p></td></tr></tbody></table></div></div><div class="refsection"><a name="idp60189056"></a><h2>関連情報</h2><p><a class="xref" href="#ST_3DClosestPoint" title="ST_3DClosestPoint">ST_3DClosestPoint</a>, <a class="xref" href="#ST_3DDistance" title="ST_3DDistance">ST_3DDistance</a>, <a class="xref" href="#ST_LongestLine" title="ST_LongestLine">ST_LongestLine</a>, <a class="xref" href="#ST_ShortestLine" title="ST_ShortestLine">ST_ShortestLine</a>, <a class="xref" href="#ST_3DMaxDistance" title="ST_3DMaxDistance">ST_3DMaxDistance</a></p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="reference_sfcgal"></a>8.10. SFCGAL関数</h2></div><div><div class="abstract"><div class="abstract-title">概要</div><p>SFCGALはCGALのC++ラッパライブラリです。CGALは高度な2次元と3次元の空間関数を提供します。堅牢性のためにジオメトリ座標は正確な有理数表現を持ちます。 </p><p>このライブラリのインストール手順はSFCGALサイト (<a class="ulink" href="http://www.sfcgal.org" target="_top">http://www.sfcgal.org</a>)にあります。機能を有効にするには<code class="code">create extension postgis_sfcgal</code>とします。 </p></div></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#postgis_sfcgal_version">postgis_sfcgal_version</a></span><span class="refpurpose"> — 使用しているSFCGALの版を返します</span></dt><dt><span class="refentrytitle"><a href="#ST_Extrude">ST_Extrude</a></span><span class="refpurpose"> — 関連するボリュームにサーフェスを押し出します。</span></dt><dt><span class="refentrytitle"><a href="#ST_StraightSkeleton">ST_StraightSkeleton</a></span><span class="refpurpose"> — ジオメトリからストレートスケルトンを計算します。</span></dt><dt><span class="refentrytitle"><a href="#ST_ApproximateMedialAxis">ST_ApproximateMedialAxis</a></span><span class="refpurpose"> — 面ジオメトリの近似的な中心軸を計算します。</span></dt><dt><span class="refentrytitle"><a href="#ST_IsPlanar">ST_IsPlanar</a></span><span class="refpurpose"> — サーフェスが平面であるかないかをチェックします。</span></dt><dt><span class="refentrytitle"><a href="#ST_Orientation">ST_Orientation</a></span><span class="refpurpose"> — サーフェスの方向を判定します。</span></dt><dt><span class="refentrytitle"><a href="#ST_ForceLHR">ST_ForceLHR</a></span><span class="refpurpose"> — LHR (Left Hand Rule)方向に強制します。</span></dt><dt><span class="refentrytitle"><a href="#ST_MinkowskiSum">ST_MinkowskiSum</a></span><span class="refpurpose"> — ミンコフスキー和を求めます。</span></dt><dt><span class="refentrytitle"><a href="#ST_ConstrainedDelaunayTriangles">ST_ConstrainedDelaunayTriangles</a></span><span class="refpurpose"> — 入力ジオメトリの周りの制約付きドロネー三角形を返します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_3DIntersection">ST_3DIntersection</a></span><span class="refpurpose"> — 3次元のインタセクトした (共有する)部分を計算します。</span></dt><dt><span class="refentrytitle"><a href="#ST_3DDifference">ST_3DDifference</a></span><span class="refpurpose"> — 3次元の差分を計算します。</span></dt><dt><span class="refentrytitle"><a href="#ST_3DUnion">ST_3DUnion</a></span><span class="refpurpose"> — 3次元の結合を計算します。</span></dt><dt><span class="refentrytitle"><a href="#ST_3DArea">ST_3DArea</a></span><span class="refpurpose"> — 3次元の面ジオメトリの面積を計算します。立体の場合は0を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Tesselate">ST_Tesselate</a></span><span class="refpurpose"> — ポリゴンまたは多面体サーフェスのテッセレーションを計算し、TINまたはTINコレクションを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Volume">ST_Volume</a></span><span class="refpurpose"> — 3次元立体の体積を計算します。面ジオメトリは (閉じていても)0を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_MakeSolid">ST_MakeSolid</a></span><span class="refpurpose"> — ジオメトリを立体にキャストします。チェックはしません。妥当な立体を得るには、入力ジオメトリは閉じた多面体サーフェスか閉じたTINでなければなりません。</span></dt><dt><span class="refentrytitle"><a href="#ST_IsSolid">ST_IsSolid</a></span><span class="refpurpose"> — ジオメトリが立体であるかどうかをテストします。妥当性チェックは行いません。</span></dt></dl></div><div class="refentry"><a name="postgis_sfcgal_version"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>postgis_sfcgal_version — 使用しているSFCGALの版を返します</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">postgis_sfcgal_version</b>(</code><code>void)</code>;</p></div></div><div class="refsection"><a name="idp60739072"></a><h2>説明</h2><p>Availability: 2.1.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method needs SFCGAL backend.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Extrude"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Extrude — 関連するボリュームにサーフェスを押し出します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Extrude</b>(</code>geometry <var class="pdparam">geom</var>, float <var class="pdparam">x</var>, float <var class="pdparam">y</var>, float <var class="pdparam">z</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp60795520"></a><h2>説明</h2><p>Availability: 2.1.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method needs SFCGAL backend.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div><div class="refsection"><a name="idp60802304"></a><h2>例</h2><p>PostGIS関数<a class="xref" href="#ST_AsX3D" title="ST_AsX3D">ST_AsX3D</a>を使って3次元イメージを生成し、<a class="ulink" href="http://www.x3dom.org" target="_top">X3Dom HTML Javascript redering library</a>を使ってHTMLでの描画を行います。</p><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col><col></colgroup><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><p>
						</p><pre class="programlisting">SELECT ST_Buffer(ST_GeomFromText('POINT(100 90)'),
  50, 'quad_segs=2'),0,0,30);</pre><p>
						</p><div class="informalfigure"><div class="mediaobject"><img src="images/st_extrude01.png"><div class="caption"><p>ポイントのバッファから形成された元の八角形</p></div></div></div>
					  </td><td style="border-bottom: 1px solid ; "><p>
					  </p><pre class="programlisting">ST_Extrude(ST_Buffer(ST_GeomFromText('POINT(100 90)'),
 50, 'quad_segs=2'),0,0,30);</pre><p>
					  </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_extrude02.png"><div class="caption"><p>Z方向に30単位押し出して得たPolyhedralSurfaceZ</p></div></div></div>
					  </td></tr><tr><td style="border-right: 1px solid ; "><p>
						</p><pre class="programlisting">SELECT ST_GeomFromText('LINESTRING(50 50, 100 90, 95 150)')</pre><p>
						</p><div class="informalfigure"><div class="mediaobject"><img src="images/st_extrude03.png"><div class="caption"><p>元のラインストリング</p></div></div></div>
					  </td><td style=""><p>
					  </p><pre class="programlisting">SELECT ST_Extrude(
 ST_GeomFromText('LINESTRING(50 50, 100 90, 95 150)'),0,0,10));</pre><p>
					  </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_extrude04.png"><div class="caption"><p>ラインストリングをZ方向に押し出したPolyhedralSurfaceZ</p></div></div></div>
					  </td></tr></tbody></table></div></div><div class="refsection"><a name="idp60831488"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsX3D" title="ST_AsX3D">ST_AsX3D</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_StraightSkeleton"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_StraightSkeleton — ジオメトリからストレートスケルトンを計算します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_StraightSkeleton</b>(</code>geometry <var class="pdparam">geom</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp60837248"></a><h2>説明</h2><p>Availability: 2.1.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method needs SFCGAL backend.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div><div class="refsection"><a name="idp60844032"></a><h2>例</h2><pre class="programlisting">SELECT ST_StraightSkeleton(ST_GeomFromText('POLYGON (( 190 190, 10 190, 10 10, 190 10, 190 20, 160 30, 60 30, 60 130, 190 140, 190 190 ))'));</pre><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col><col></colgroup><tbody><tr><td style="border-right: 1px solid ; "><div class="informalfigure"><div class="mediaobject"><img src="images/st_straightskeleton01.png"><div class="caption"><p>元のポリゴン</p></div></div></div>
					  </td><td style=""><div class="informalfigure"><div class="mediaobject"><img src="images/st_straightskeleton02.png"><div class="caption"><p>ポリゴンのストレートスケルトン</p></div></div></div>
					  </td></tr></tbody></table></div></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_ApproximateMedialAxis"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ApproximateMedialAxis — 面ジオメトリの近似的な中心軸を計算します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_ApproximateMedialAxis</b>(</code>geometry <var class="pdparam">geom</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp60856448"></a><h2>説明</h2><p>ストレートスケルトンを基に、入力された面の近似的な中心軸を返します。可能な版 (1.2.0以上)でビルドすると、SFCGAL独自APIを使います。そうでない場合はST_StraightSkeleton (遅い)のラップとなります。 </p><p>Availability: 2.2.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method needs SFCGAL backend.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div><div class="refsection"><a name="idp60863616"></a><h2>例</h2><pre class="programlisting">SELECT ST_ApproximateMedialAxis(ST_GeomFromText('POLYGON (( 190 190, 10 190, 10 10, 190 10, 190 20, 160 30, 60 30, 60 130, 190 140, 190 190 ))'));</pre><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col></colgroup><tbody><tr><td style=""><div class="informalfigure"><div class="mediaobject"><img src="images/st_approximatemedialaxis01.png"><div class="caption"><p>ポリゴンと近似的な中心軸</p></div></div></div>
					  </td></tr></tbody></table></div></div><div class="refsection"><a name="idp60868992"></a><h2>関連情報</h2><p><a class="xref" href="#ST_StraightSkeleton" title="ST_StraightSkeleton">ST_StraightSkeleton</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_IsPlanar"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_IsPlanar — サーフェスが平面であるかないかをチェックします。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_IsPlanar</b>(</code>geometry <var class="pdparam">geom</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp60874752"></a><h2>説明</h2><p>Availability: 2.2.0: これは2.1.0のマニュアルに記述されていましたが、2.1版では偶然に外れてしまいました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method needs SFCGAL backend.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Orientation"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Orientation — サーフェスの方向を判定します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_Orientation</b>(</code>geometry <var class="pdparam">geom</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp59702272"></a><h2>説明</h2><p>この関数はポリゴンのみ受け付けます。ポリゴンが反時計回りなら-1を返し、時計回りなら1を返します。</p><p>Availability: 2.1.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method needs SFCGAL backend.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_ForceLHR"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ForceLHR — LHR (Left Hand Rule)方向に強制します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_ForceLHR</b>(</code>geometry <var class="pdparam">geom</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp59711104"></a><h2>説明</h2><p>Availability: 2.1.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method needs SFCGAL backend.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_MinkowskiSum"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MinkowskiSum — ミンコフスキー和を求めます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_MinkowskiSum</b>(</code>geometry <var class="pdparam">geom1</var>, geometry <var class="pdparam">geom2</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp59723392"></a><h2>説明</h2><p>ポリゴンと、ポイント、ライン、ポリゴンのいずれかとの2次元のミンコフスキー和を計算します。</p><p>二つのジオメトリAとBのミンコフスキー和はAとBのあらゆるポイントの和の集合です。ミンコフスキー和は、しばしば動作計画とCADで使われます。より詳細な情報について<a class="ulink" href="https://en.wikipedia.org/wiki/Minkowski_addition" target="_top">Wikipedia Minkowski addition</a>をご覧ください。</p><p>一つ目の引数は2次元ジオメトリ (ポイント、ラインストリング、ポリゴン)とすることができます。3次元ジオメトリを渡すと、Zを0とした2次元に強制され、この場合は無効と考えられます。二つ目の引数は2次元ポリゴンでなければなりません。</p><p><a class="ulink" href="http://doc.cgal.org/latest/Minkowski_sum_2/" target="_top">CGAL 2D Minkowskisum</a>を利用して実装しています。</p><p>Availability: 2.1.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method needs SFCGAL backend.</p></div><div class="refsection"><a name="idp59728384"></a><h2>例</h2><p>ラインストリングと円ポリゴンであって、ラインストリングがポリゴンを横切るミンコフスキー和</p><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col><col></colgroup><tbody><tr><td style="border-right: 1px solid ; ">
                         <p>
                            </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_minkowskisum01.png"><div class="caption"><p>ミンコフスキー和を実行する前</p></div></div></div><p>
                                               </p>
                        </td><td style="">
                           <p>
                            </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_minkowskisum02.png"><div class="caption"><p>ミンコフスキー和実行後</p></div></div></div><p>
                                              </p>
                        </td></tr></tbody></table></div><pre class="programlisting">SELECT ST_MinkowskiSum(line, circle))
FROM (SELECT
    ST_MakeLine(ST_Point(10, 10),ST_Point(100, 100)) As line,
    ST_Buffer(ST_GeomFromText('POINT(50 50)'), 30) As circle) As foo;

-- wkt --
MULTIPOLYGON(((30 59.9999999999999,30.5764415879031 54.1472903395161,32.2836140246614 48.5194970290472,35.0559116309237 43.3328930094119,38.7867965644036 38.7867965644035,43.332893009412 35.0559116309236,48.5194970290474 32.2836140246614,54.1472903395162 30.5764415879031,60.0000000000001 30,65.8527096604839 30.5764415879031,71.4805029709527 32.2836140246614,76.6671069905881 35.0559116309237,81.2132034355964 38.7867965644036,171.213203435596 128.786796564404,174.944088369076 133.332893009412,177.716385975339 138.519497029047,179.423558412097 144.147290339516,180 150,179.423558412097 155.852709660484,177.716385975339 161.480502970953,174.944088369076 166.667106990588,171.213203435596 171.213203435596,166.667106990588 174.944088369076,
161.480502970953 177.716385975339,155.852709660484 179.423558412097,150 180,144.147290339516 179.423558412097,138.519497029047 177.716385975339,133.332893009412 174.944088369076,128.786796564403 171.213203435596,38.7867965644035 81.2132034355963,35.0559116309236 76.667106990588,32.2836140246614 71.4805029709526,30.5764415879031 65.8527096604838,30 59.9999999999999)))
            </pre><p>ポリゴンとマルチポイントとのミンコフスキー和</p><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col><col></colgroup><tbody><tr><td style="border-right: 1px solid ; ">
                         <p>
                            </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_minkowskisum03.png"><div class="caption"><p>ミンコフスキー和を実行する前</p></div></div></div><p>
                          </p>
                        </td><td style="">
                           <p>
                            </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_minkowskisum04.png"><div class="caption"><p>ミンコフスキー和実行後: ポリゴンが二つになり、ポイントの位置に移動しています。</p></div></div></div><p>
                           </p>
                        </td></tr></tbody></table></div><pre class="programlisting">SELECT ST_MinkowskiSum(mp, poly)
FROM (SELECT 'MULTIPOINT(25 50,70 25)'::geometry As mp,
   'POLYGON((130 150, 20 40, 50 60, 125 100, 130 150))'::geometry As poly
    ) As foo


-- wkt --
MULTIPOLYGON(
    ((70 115,100 135,175 175,225 225,70 115)),
    ((120 65,150 85,225 125,275 175,120 65))
    )
            </pre></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_ConstrainedDelaunayTriangles"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ConstrainedDelaunayTriangles — 入力ジオメトリの周りの制約付きドロネー三角形を返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_ConstrainedDelaunayTriangles</b>(</code>geometry  <var class="pdparam">g1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp60905600"></a><h2>説明</h2><p>入力ジオメトリの周りの制約付きドロネー三角形 (<a class="ulink" href="https://en.wikipedia.org/wiki/Constrained_Delaunay_triangulation" target="_top">Constrained Delaunay triangulation</a>)を返します。出力はTINです。 </p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method needs SFCGAL backend.</p><p>Availability: 3.0.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp60910464"></a><h2>例</h2><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col><col></colgroup><tbody><tr><td style="border-right: 1px solid ; "><div class="informalfigure"><div class="mediaobject"><img src="images/st_constraineddelaunaytriangles01.png"><div class="caption"><p>二つのポリゴンのST_ConstrainedDelaunayTriangles</p></div></div></div><p>
						  </p><pre class="programlisting">select ST_ConstrainedDelaunayTriangles(
               ST_Union(
                       'POLYGON((175 150, 20 40, 50 60, 125 100, 175 150))'::geometry,
                       ST_Buffer('POINT(110 170)'::geometry, 20)
                   )
           );
                                </pre><p>
						  </p></td><td style=""><div class="informalfigure"><div class="mediaobject"><img src="images/st_constraineddelaunaytriangles02.png"><div class="caption"><p><a class="xref" href="#ST_DelaunayTriangles" title="ST_DelaunayTriangles">ST_DelaunayTriangles</a> 二つのポリゴン。三角形の辺はポリゴンの境界にクロスしています。</p></div></div></div><p>
						  </p><pre class="programlisting">select ST_DelaunayTriangles(
               ST_Union(
                       'POLYGON((175 150, 20 40, 50 60, 125 100, 175 150))'::geometry,
                       ST_Buffer('POINT(110 170)'::geometry, 20)
                   )
           );
</pre><p>
						  </p></td></tr></tbody></table></div></div><div class="refsection"><a name="idp60919296"></a><h2>関連情報</h2><p><a class="xref" href="#ST_DelaunayTriangles" title="ST_DelaunayTriangles">ST_DelaunayTriangles</a>, <a class="xref" href="#ST_Tesselate" title="ST_Tesselate">ST_Tesselate</a>, <a class="xref" href="#ST_ConcaveHull" title="ST_ConcaveHull">ST_ConcaveHull</a>, <a class="xref" href="#ST_Dump" title="ST_Dump">ST_Dump</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_3DIntersection"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_3DIntersection — 3次元のインタセクトした (共有する)部分を計算します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_3DIntersection</b>(</code>geometry <var class="pdparam">geom1</var>, geometry <var class="pdparam">geom2</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp60927360"></a><h2>説明</h2><p>geom1とgeom2の間で共有される部分のジオメトリを返します。</p><p>Availability: 2.1.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method needs SFCGAL backend.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div><div class="refsection"><a name="idp60934528"></a><h2>例</h2><p>PostGIS関数<a class="xref" href="#ST_AsX3D" title="ST_AsX3D">ST_AsX3D</a>を使って3次元イメージを生成し、<a class="ulink" href="http://www.x3dom.org" target="_top">X3Dom HTML Javascript redering library</a>を使ってHTMLでの描画を行います。</p><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col><col></colgroup><tbody><tr><td style="border-right: 1px solid ; "><p>
                </p><pre class="programlisting">SELECT ST_Extrude(ST_Buffer(ST_GeomFromText('POINT(100 90)'),
 50, 'quad_segs=2'),0,0,30) AS geom1,
        ST_Extrude(ST_Buffer(ST_GeomFromText('POINT(80 80)'),
 50, 'quad_segs=1'),0,0,30) AS geom2;
                </pre><p>
                </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_3ddifference01.png"><div class="caption"><p>元の3次元ジオメトリを重ねたもの。geom2は半透明で示しています。</p></div></div></div>
              </td><td style=""><p>
              </p><pre class="programlisting">SELECT ST_3DIntersection(geom1,geom2)
FROM ( SELECT ST_Extrude(ST_Buffer(ST_GeomFromText('POINT(100 90)'),
 50, 'quad_segs=2'),0,0,30) AS geom1,
        ST_Extrude(ST_Buffer(ST_GeomFromText('POINT(80 80)'),
 50, 'quad_segs=1'),0,0,30) AS geom2 ) As t;</pre><p>
              </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_3dintersection01.png"><div class="caption"><p>geom1とgeom2の共有部分</p></div></div></div>
              </td></tr></tbody></table></div><p>3次元ラインストリングとポリゴン</p><pre class="programlisting">SELECT ST_AsText(ST_3DIntersection(linestring, polygon)) As wkt
FROM  ST_GeomFromText('LINESTRING Z (2 2 6,1.5 1.5 7,1 1 8,0.5 0.5 8,0 0 10)') AS linestring
 CROSS JOIN ST_GeomFromText('POLYGON((0 0 8, 0 1 8, 1 1 8, 1 0 8, 0 0 8))') AS polygon;

              wkt
--------------------------------
 LINESTRING Z (1 1 8,0.5 0.5 8)
                </pre><p>立方体 (閉じた多面体サーフェス)と3次元ポリゴン</p><pre class="programlisting">SELECT ST_AsText(ST_3DIntersection(
                ST_GeomFromText('POLYHEDRALSURFACE Z( ((0 0 0, 0 0 1, 0 1 1, 0 1 0, 0 0 0)),
        ((0 0 0, 0 1 0, 1 1 0, 1 0 0, 0 0 0)), ((0 0 0, 1 0 0, 1 0 1, 0 0 1, 0 0 0)),
        ((1 1 0, 1 1 1, 1 0 1, 1 0 0, 1 1 0)),
        ((0 1 0, 0 1 1, 1 1 1, 1 1 0, 0 1 0)), ((0 0 1, 1 0 1, 1 1 1, 0 1 1, 0 0 1)) )'),
        'POLYGON Z ((0 0 0, 0 0 0.5, 0 0.5 0.5, 0 0.5 0, 0 0 0))'::geometry))</pre><pre class="screen">TIN Z (((0 0 0,0 0 0.5,0 0.5 0.5,0 0 0)),((0 0.5 0,0 0 0,0 0.5 0.5,0 0.5 0)))</pre><p>二つの立体の共通部分もまた立体です (ST_Dimensionで3を返します)。</p><pre class="programlisting">SELECT ST_AsText(ST_3DIntersection( ST_Extrude(ST_Buffer('POINT(10 20)'::geometry,10,1),0,0,30),
 ST_Extrude(ST_Buffer('POINT(10 20)'::geometry,10,1),2,0,10) ));</pre><pre class="screen">POLYHEDRALSURFACE Z (((13.3333333333333 13.3333333333333 10,20 20 0,20 20 10,13.3333333333333 13.3333333333333 10)),
        ((20 20 10,16.6666666666667 23.3333333333333 10,13.3333333333333 13.3333333333333 10,20 20 10)),
        ((20 20 0,16.6666666666667 23.3333333333333 10,20 20 10,20 20 0)),
        ((13.3333333333333 13.3333333333333 10,10 10 0,20 20 0,13.3333333333333 13.3333333333333 10)),
        ((16.6666666666667 23.3333333333333 10,12 28 10,13.3333333333333 13.3333333333333 10,16.6666666666667 23.3333333333333 10)),
        ((20 20 0,9.99999999999995 30 0,16.6666666666667 23.3333333333333 10,20 20 0)),
        ((10 10 0,9.99999999999995 30 0,20 20 0,10 10 0)),((13.3333333333333 13.3333333333333 10,12 12 10,10 10 0,13.3333333333333 13.3333333333333 10)),
        ((12 28 10,12 12 10,13.3333333333333 13.3333333333333 10,12 28 10)),
        ((16.6666666666667 23.3333333333333 10,9.99999999999995 30 0,12 28 10,16.6666666666667 23.3333333333333 10)),
        ((10 10 0,0 20 0,9.99999999999995 30 0,10 10 0)),
        ((12 12 10,11 11 10,10 10 0,12 12 10)),((12 28 10,11 11 10,12 12 10,12 28 10)),
        ((9.99999999999995 30 0,11 29 10,12 28 10,9.99999999999995 30 0)),((0 20 0,2 20 10,9.99999999999995 30 0,0 20 0)),
        ((10 10 0,2 20 10,0 20 0,10 10 0)),((11 11 10,2 20 10,10 10 0,11 11 10)),((12 28 10,11 29 10,11 11 10,12 28 10)),
        ((9.99999999999995 30 0,2 20 10,11 29 10,9.99999999999995 30 0)),((11 11 10,11 29 10,2 20 10,11 11 10)))</pre></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_3DDifference"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_3DDifference — 3次元の差分を計算します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_3DDifference</b>(</code>geometry <var class="pdparam">geom1</var>, geometry <var class="pdparam">geom2</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp60953856"></a><h2>説明</h2><p>geom2に含まれないgeom1の一部を返します</p><p>Availability: 2.2.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method needs SFCGAL backend.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div><div class="refsection"><a name="idp60961024"></a><h2>例</h2><p>PostGIS関数<a class="xref" href="#ST_AsX3D" title="ST_AsX3D">ST_AsX3D</a>を使って3次元イメージを生成し、<a class="ulink" href="http://www.x3dom.org" target="_top">X3Dom HTML Javascript redering library</a>を使ってHTMLでの描画を行います。</p><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col><col></colgroup><tbody><tr><td style="border-right: 1px solid ; "><p>
                </p><pre class="programlisting">SELECT ST_Extrude(ST_Buffer(ST_GeomFromText('POINT(100 90)'),
 50, 'quad_segs=2'),0,0,30) AS geom1,
        ST_Extrude(ST_Buffer(ST_GeomFromText('POINT(80 80)'),
 50, 'quad_segs=1'),0,0,30) AS geom2;
                </pre><p>
                </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_3ddifference01.png"><div class="caption"><p>元の3次元ジオメトリを重ねたもの。geom2は削除部分にあたります。</p></div></div></div>
              </td><td style=""><p>
              </p><pre class="programlisting">SELECT ST_3DDifference(geom1,geom2)
FROM ( SELECT ST_Extrude(ST_Buffer(ST_GeomFromText('POINT(100 90)'),
 50, 'quad_segs=2'),0,0,30) AS geom1,
        ST_Extrude(ST_Buffer(ST_GeomFromText('POINT(80 80)'),
 50, 'quad_segs=1'),0,0,30) AS geom2 ) As t;</pre><p>
              </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_3ddifference02.png"><div class="caption"><p>geom2を削除した後に残るもの</p></div></div></div>
              </td></tr></tbody></table></div></div><div class="refsection"><a name="idp60971136"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Extrude" title="ST_Extrude">ST_Extrude</a>, <a class="xref" href="#ST_AsX3D" title="ST_AsX3D">ST_AsX3D</a>, <a class="xref" href="#ST_3DIntersection" title="ST_3DIntersection">ST_3DIntersection</a> <a class="xref" href="#ST_3DUnion" title="ST_3DUnion">ST_3DUnion</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_3DUnion"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_3DUnion — 3次元の結合を計算します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_3DUnion</b>(</code>geometry <var class="pdparam">geom1</var>, geometry <var class="pdparam">geom2</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp60979200"></a><h2>説明</h2><p>Availability: 2.2.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method needs SFCGAL backend.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div><div class="refsection"><a name="idp60985984"></a><h2>例</h2><p>PostGIS関数<a class="xref" href="#ST_AsX3D" title="ST_AsX3D">ST_AsX3D</a>を使って3次元イメージを生成し、<a class="ulink" href="http://www.x3dom.org" target="_top">X3Dom HTML Javascript redering library</a>を使ってHTMLでの描画を行います。</p><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col><col></colgroup><tbody><tr><td style="border-right: 1px solid ; "><p>
                </p><pre class="programlisting">SELECT ST_Extrude(ST_Buffer(ST_GeomFromText('POINT(100 90)'),
 50, 'quad_segs=2'),0,0,30) AS geom1,
        ST_Extrude(ST_Buffer(ST_GeomFromText('POINT(80 80)'),
 50, 'quad_segs=1'),0,0,30) AS geom2;
                </pre><p>
                </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_3ddifference01.png"><div class="caption"><p>元の3次元ジオメトリを重ねたもの。geom2は半透明で示しています。</p></div></div></div>
              </td><td style=""><p>
              </p><pre class="programlisting">SELECT ST_3DUnion(geom1,geom2)
FROM ( SELECT ST_Extrude(ST_Buffer(ST_GeomFromText('POINT(100 90)'),
 50, 'quad_segs=2'),0,0,30) AS geom1,
        ST_Extrude(ST_Buffer(ST_GeomFromText('POINT(80 80)'),
 50, 'quad_segs=1'),0,0,30) AS geom2 ) As t;</pre><p>
              </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_3dunion01.png"><div class="caption"><p>geom1とgeom2の結合</p></div></div></div>
              </td></tr></tbody></table></div></div><div class="refsection"><a name="idp61000192"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Extrude" title="ST_Extrude">ST_Extrude</a>, <a class="xref" href="#ST_AsX3D" title="ST_AsX3D">ST_AsX3D</a>, <a class="xref" href="#ST_3DIntersection" title="ST_3DIntersection">ST_3DIntersection</a> <a class="xref" href="#ST_3DDifference" title="ST_3DDifference">ST_3DDifference</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_3DArea"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_3DArea — 3次元の面ジオメトリの面積を計算します。立体の場合は0を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float<b class="fsfunc">ST_3DArea</b>(</code>geometry <var class="pdparam">geom1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp61007232"></a><h2>説明</h2><p>Availability: 2.1.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method needs SFCGAL backend.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div><div class="refsection"><a name="idp61014016"></a><h2>例</h2><p>ご注意: デフォルトでは、WKTから生成されたPolyhedralSurfaceは面ジオメトリで、立体ではありません。サーフェス面を持ちます。立体に変換すると、面を持ちません。</p><pre class="programlisting">SELECT ST_3DArea(geom) As cube_surface_area,
        ST_3DArea(ST_MakeSolid(geom)) As solid_surface_area
  FROM (SELECT 'POLYHEDRALSURFACE( ((0 0 0, 0 0 1, 0 1 1, 0 1 0, 0 0 0)),
    ((0 0 0, 0 1 0, 1 1 0, 1 0 0, 0 0 0)),
    ((0 0 0, 1 0 0, 1 0 1, 0 0 1, 0 0 0)),
    ((1 1 0, 1 1 1, 1 0 1, 1 0 0, 1 1 0)),
    ((0 1 0, 0 1 1, 1 1 1, 1 1 0, 0 1 0)),
    ((0 0 1, 1 0 1, 1 1 1, 0 1 1, 0 0 1)) )'::geometry) As f(geom);

 cube_surface_area | solid_surface_area
-------------------+--------------------
                 6 |                  0    </pre></div><div class="refsection"><a name="idp61015552"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Area" title="ST_Area">ST_Area</a>, <a class="xref" href="#ST_MakeSolid" title="ST_MakeSolid">ST_MakeSolid</a>, <a class="xref" href="#ST_IsSolid" title="ST_IsSolid">ST_IsSolid</a>, <a class="xref" href="#ST_Area" title="ST_Area">ST_Area</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Tesselate"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Tesselate — ポリゴンまたは多面体サーフェスのテッセレーションを計算し、TINまたはTINコレクションを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Tesselate</b>(</code>geometry <var class="pdparam">geom</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp61022464"></a><h2>説明</h2><p>(MULTI)POLYGONまたはPOLYHEDRALSURFACEのような面を入力に取り、三角形を使ったテッセレーション処理を通してTIN表現を返します。</p><p>Availability: 2.1.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method needs SFCGAL backend.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div><div class="refsection"><a name="idp59641088"></a><h2>例</h2><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col><col></colgroup><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><p>
						</p><pre class="programlisting">SELECT ST_GeomFromText('POLYHEDRALSURFACE Z( ((0 0 0, 0 0 1, 0 1 1, 0 1 0, 0 0 0)),
                ((0 0 0, 0 1 0, 1 1 0, 1 0 0, 0 0 0)), ((0 0 0, 1 0 0, 1 0 1, 0 0 1, 0 0 0)),
                ((1 1 0, 1 1 1, 1 0 1, 1 0 0, 1 1 0)),
                ((0 1 0, 0 1 1, 1 1 1, 1 1 0, 0 1 0)), ((0 0 1, 1 0 1, 1 1 1, 0 1 1, 0 0 1)) )');</pre><p>
						</p><div class="informalfigure"><div class="mediaobject"><img src="images/st_tesselate01.png"><div class="caption"><p>元の立方体</p></div></div></div>
					  </td><td style="border-bottom: 1px solid ; "><p>
					  </p><pre class="programlisting">SELECT ST_Tesselate(ST_GeomFromText('POLYHEDRALSURFACE Z( ((0 0 0, 0 0 1, 0 1 1, 0 1 0, 0 0 0)),
        ((0 0 0, 0 1 0, 1 1 0, 1 0 0, 0 0 0)), ((0 0 0, 1 0 0, 1 0 1, 0 0 1, 0 0 0)),
        ((1 1 0, 1 1 1, 1 0 1, 1 0 0, 1 1 0)),
        ((0 1 0, 0 1 1, 1 1 1, 1 1 0, 0 1 0)), ((0 0 1, 1 0 1, 1 1 1, 0 1 1, 0 0 1)) )'));</pre>
		<p>ST_AsTextの出力:</p>
		<pre class="screen">TIN Z (((0 0 0,0 0 1,0 1 1,0 0 0)),((0 1 0,0 0 0,0 1 1,0 1 0)),
        ((0 0 0,0 1 0,1 1 0,0 0 0)),
        ((1 0 0,0 0 0,1 1 0,1 0 0)),((0 0 1,1 0 0,1 0 1,0 0 1)),
        ((0 0 1,0 0 0,1 0 0,0 0 1)),
        ((1 1 0,1 1 1,1 0 1,1 1 0)),((1 0 0,1 1 0,1 0 1,1 0 0)),
        ((0 1 0,0 1 1,1 1 1,0 1 0)),((1 1 0,0 1 0,1 1 1,1 1 0)),
        ((0 1 1,1 0 1,1 1 1,0 1 1)),((0 1 1,0 0 1,1 0 1,0 1 1)))</pre>
		       <p> </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_tesselate02.png"><div class="caption"><p>彩色した三角形によるテッセレーションを施した立方体</p></div></div></div>
					  </td></tr><tr><td style="border-right: 1px solid ; "><p>
						</p><pre class="programlisting">SELECT 'POLYGON (( 10 190, 10 70, 80 70, 80 130, 50 160, 120 160, 120 190, 10 190 ))'::geometry;</pre><p>
						</p><div class="informalfigure"><div class="mediaobject"><img src="images/st_tesselate03.png"><div class="caption"><p>元のポリゴン</p></div></div></div>
					  </td><td style=""><p>
					  </p><pre class="programlisting">SELECT
        ST_Tesselate('POLYGON (( 10 190, 10 70, 80 70, 80 130, 50 160, 120 160, 120 190, 10 190 ))'::geometry);</pre><p>
	</p>
	<p>ST_AsTextの出力:</p>
	<pre class="screen">TIN(((80 130,50 160,80 70,80 130)),((50 160,10 190,10 70,50 160)),
         ((80 70,50 160,10 70,80 70)),((120 160,120 190,50 160,120 160)),
 ((120 190,10 190,50 160,120 190)))</pre>
					  <div class="informalfigure"><div class="mediaobject"><img src="images/st_tesselate04.png"><div class="caption"><p>テッセレーションを施したポリゴン</p></div></div></div>
					  </td></tr></tbody></table></div></div><div class="refsection"><a name="idp61072128"></a><h2>関連情報</h2><p><a class="xref" href="#ST_ConstrainedDelaunayTriangles" title="ST_ConstrainedDelaunayTriangles">ST_ConstrainedDelaunayTriangles</a>, <a class="xref" href="#ST_DelaunayTriangles" title="ST_DelaunayTriangles">ST_DelaunayTriangles</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Volume"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Volume — 3次元立体の体積を計算します。面ジオメトリは (閉じていても)0を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_Volume</b>(</code>geometry <var class="pdparam">geom1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp61078272"></a><h2>説明</h2><p>Availability: 2.2.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method needs SFCGAL backend.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div><div class="refsection"><a name="idp61085056"></a><h2>例</h2><p>WKTで閉じた面を生成した時、それは立体でなく面として扱われるます。立体にするには<a class="xref" href="#ST_MakeSolid" title="ST_MakeSolid">ST_MakeSolid</a>を使います。面ジオメトリは堆積を持ちません。例を挙げます。</p><pre class="programlisting">SELECT ST_Volume(geom) As cube_surface_vol,
        ST_Volume(ST_MakeSolid(geom)) As solid_surface_vol
  FROM (SELECT 'POLYHEDRALSURFACE( ((0 0 0, 0 0 1, 0 1 1, 0 1 0, 0 0 0)),
    ((0 0 0, 0 1 0, 1 1 0, 1 0 0, 0 0 0)),
    ((0 0 0, 1 0 0, 1 0 1, 0 0 1, 0 0 0)),
    ((1 1 0, 1 1 1, 1 0 1, 1 0 0, 1 1 0)),
    ((0 1 0, 0 1 1, 1 1 1, 1 1 0, 0 1 0)),
    ((0 0 1, 1 0 1, 1 1 1, 0 1 1, 0 0 1)) )'::geometry) As f(geom);

 cube_surface_vol | solid_surface_vol
------------------+-------------------
                0 |                 1
              </pre></div><div class="refsection"><a name="idp61087104"></a><h2>関連情報</h2><p><a class="xref" href="#ST_3DArea" title="ST_3DArea">ST_3DArea</a>, <a class="xref" href="#ST_MakeSolid" title="ST_MakeSolid">ST_MakeSolid</a>, <a class="xref" href="#ST_IsSolid" title="ST_IsSolid">ST_IsSolid</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_MakeSolid"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MakeSolid — ジオメトリを立体にキャストします。チェックはしません。妥当な立体を得るには、入力ジオメトリは閉じた多面体サーフェスか閉じたTINでなければなりません。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry<b class="fsfunc">ST_MakeSolid</b>(</code>geometry <var class="pdparam">geom1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp61093632"></a><h2>説明</h2><p>Availability: 2.2.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method needs SFCGAL backend.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_IsSolid"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_IsSolid — ジオメトリが立体であるかどうかをテストします。妥当性チェックは行いません。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean<b class="fsfunc">ST_IsSolid</b>(</code>geometry <var class="pdparam">geom1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp61104896"></a><h2>説明</h2><p>Availability: 2.2.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method needs SFCGAL backend.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Geometry_Processing"></a>8.11. ジオメトリ処理関数</h2></div><div><div class="abstract"><div class="abstract-title">概要</div><p>これらの関数は幾何的構造の計算、すなわちジオメトリのサイズや形状を変更します。 </p></div></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#ST_Buffer">ST_Buffer</a></span><span class="refpurpose"> — あるジオメトリからの距離が指定された距離以下となる点全ての集合となるジオメトリを返します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_BuildArea">ST_BuildArea</a></span><span class="refpurpose"> — 与えられたジオメトリの構成ラインから面ジオメトリを生成します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Centroid">ST_Centroid</a></span><span class="refpurpose"> — ジオメトリの幾何学的重心を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_ConcaveHull">ST_ConcaveHull</a></span><span class="refpurpose"> — 全ての入力ジオメトリの頂点を囲むことができる凹多角形のジオメトリを計算します。</span></dt><dt><span class="refentrytitle"><a href="#ST_ConvexHull">ST_ConvexHull</a></span><span class="refpurpose"> — ジオメトリの凸包を計算します。</span></dt><dt><span class="refentrytitle"><a href="#ST_DelaunayTriangles">ST_DelaunayTriangles</a></span><span class="refpurpose"> — ジオメトリの頂点のドローネ三角形を返します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_FilterByM">ST_FilterByM</a></span><span class="refpurpose"> — M値に基づいて頂点を削除します。</span></dt><dt><span class="refentrytitle"><a href="#ST_GeneratePoints">ST_GeneratePoints</a></span><span class="refpurpose"> — ポリゴン内やマルチポリゴン内にランダムなポイントを生成します。</span></dt><dt><span class="refentrytitle"><a href="#ST_GeometricMedian">ST_GeometricMedian </a></span><span class="refpurpose"> — マルチポイントの幾何学的中央値を返します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_LineMerge">ST_LineMerge</a></span><span class="refpurpose"> — MULTILINESTRINGを縫い合わせて形成したラインを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_MaximumInscribedCircle">ST_MaximumInscribedCircle</a></span><span class="refpurpose"> — ジオメトリに完全に含まれる最大の円を計算します。</span></dt><dt><span class="refentrytitle"><a href="#ST_MinimumBoundingCircle">ST_MinimumBoundingCircle</a></span><span class="refpurpose"> — 入力ジオメトリを含む最小の円を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_MinimumBoundingRadius">ST_MinimumBoundingRadius</a></span><span class="refpurpose"> — ジオメトリを完全に包含する最小円の中心ポイントと半径を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_OrientedEnvelope">ST_OrientedEnvelope</a></span><span class="refpurpose"> — ジオメトリを囲む最小の回転四角形を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_OffsetCurve">ST_OffsetCurve</a></span><span class="refpurpose"> — 与えられた距離と方面に入力ラインをずらしたラインを返します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_PointOnSurface">ST_PointOnSurface</a></span><span class="refpurpose"> — ポリゴン内またはジオメトリ上にあるのが保証されたポイントを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Polygonize">ST_Polygonize</a></span><span class="refpurpose"> — ジオメトリ集合のラインから形成されるポリゴンのコレクションを計算します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_ReducePrecision">ST_ReducePrecision</a></span><span class="refpurpose"> — 全ての与えられたグリッド許容値に丸められたポイントからなる妥当なジオメトリを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_SharedPaths">ST_SharedPaths</a></span><span class="refpurpose"> — 二つのLINESTRING/MULTILINESTRINGの入力が共有するパスのコレクションを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Simplify">ST_Simplify</a></span><span class="refpurpose"> — Douglas-Peukerアルゴリズムを使用して、与えられたジオメトリを簡略化したものを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_SimplifyPreserveTopology">ST_SimplifyPreserveTopology</a></span><span class="refpurpose"> — Douglas-Peukerアルゴリズムを使用して、与えられたジオメトリを簡略化したものを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_SimplifyVW">ST_SimplifyVW</a></span><span class="refpurpose"> — Visvalingam-Whyattアルゴリズムを使用して、入力ジオメトリを簡略化したジオメトリを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_ChaikinSmoothing">ST_ChaikinSmoothing</a></span><span class="refpurpose"> —  チャイキンのアルゴリズムを使って、与えられたジオメトリの平滑化されたものを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_SetEffectiveArea">ST_SetEffectiveArea</a></span><span class="refpurpose"> — Visvalingam-Whyattアルゴリズムを使って有効範囲となる個々の頂点を置きます。 </span></dt><dt><span class="refentrytitle"><a href="#ST_VoronoiLines">ST_VoronoiLines</a></span><span class="refpurpose"> — ジオメトリの頂点からボロノイ図のセルを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_VoronoiPolygons">ST_VoronoiPolygons</a></span><span class="refpurpose"> — ジオメトリの頂点からボロノイ図のセルを返します。</span></dt></dl></div><div class="refentry"><a name="ST_Buffer"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Buffer — あるジオメトリからの距離が指定された距離以下となる点全ての集合となるジオメトリを返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Buffer</b>(</code>geometry  <var class="pdparam">g1</var>, float  <var class="pdparam">radius_of_buffer</var>, text  <var class="pdparam">buffer_style_parameters = ''</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_Buffer</b>(</code>geometry  <var class="pdparam">g1</var>, float  <var class="pdparam">radius_of_buffer</var>, integer  <var class="pdparam">num_seg_quarter_circle</var><code>)</code>;</p><p><code class="funcdef">geography <b class="fsfunc">ST_Buffer</b>(</code>geography  <var class="pdparam">g1</var>, float  <var class="pdparam">radius_of_buffer</var>, text  <var class="pdparam">buffer_style_parameters</var><code>)</code>;</p><p><code class="funcdef">geography <b class="fsfunc">ST_Buffer</b>(</code>geography  <var class="pdparam">g1</var>, float  <var class="pdparam">radius_of_buffer</var>, integer  <var class="pdparam">num_seg_quarter_circle</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp61454720"></a><h2>説明</h2><p>あるジオメトリ/ジオグラフィからの距離が指定された距離以下となる全ての点を表現するPOLYGONまたはMULTIPOLYGONを計算します。距離に負数を指定すると、ジオメトリは拡大されずに縮小されます。負の距離はポリゴンを完全に縮退させる可能性があり、その場合には、POLYGON EMPTYが返ります。ポイントとラインの負の距離は常に空を返します。 </p><p>ジオメトリの場合、指定される距離の単位は、ジオメトリの空間参照系の単位です。ジオグラフィの場合、指定される距離の単位はメートルです。</p><p>3番目のパラメータは任意で、バッファの精度とスタイルを扱います。バッファの円弧の精度は四分の一円の近似に使用される辺の数です (デフォルトは8)。バッファのスタイルは キー=値 のペアを空白区切りでリストにして指定します。キーは次の通りです。 </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>'quad_segs=#' : 四分の一円近似に使う辺の数 (デフォルトは8)。</p></li><li class="listitem"><p>'endcap=round|flat|square' : 終端スタイル (デフォルトは "round")。'butt'は'flat'の同義語として受け付けます。</p></li><li class="listitem"><p>'join=round|mitre|bevel' : 接続スタイル (デフォルトは"round")。'miter'も'mitre'の同義語として受け付けます。</p></li><li class="listitem"><p>'mitre_limit=#.#' : マイター比 (訳注: 継ぎ目の内側と外側の距離と線幅との比)の最大値 (継ぎ目スタイルがmiterである場合のみ有効)。'miter_limit'は'mitre_limit'の同義語として受け付けます。</p></li><li class="listitem"><p>'side=both|left|right' : 'left'または'right'については、線の方向から見た相対的なサイドで、ジオメトリの片側バッファを実行します。これはLINESTRINGジオメトリにだけ関連して、POINTまたはPOLYGONジオメトリには影響がありません。デフォルトでは終端スタイルは四角形です。</p></li></ul></div><p>
                </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ジオグラフィでは、この関数はジオメトリ実装をラップした関数です。ジオグラフィオブジェクトおｎバウンディングボックスに最も適した平面空間参照系を決定します (UTM、北極南極のランベルト正積方位図法 (LAEA)、最後はメルカトルを試していきます)。バッファは平面空間上で計算され、WGS84に戻されます。入力オブジェクトがUTMゾーンより非常に大きい場合や日付変更線を超える場合には、望ましくない振る舞いになる場合があります。 </p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>バッファ出力は常に妥当なポリゴンジオメトリです。バッファは不正な入力を処理できるので、不正なポリゴンを修復する方法として、距離0のバッファリングが使われます。同じ目的の関数としては<a class="xref" href="#">???</a>が使われます。 </p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>バッファ作成は時々、距離内にある地物を検索する際に使われます。この使い方については、<a class="xref" href="#">???</a>の方が効率的です。</p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はZ値を無視します。この関数を3次元ジオメトリ上で使用したとしても、常に2次元の結果となります。</p></td></tr></table></div><p>Enhanced: 2.5.0 - ST_Bufferのジオメトリ対応版が強化され、バッファを施す側を<code class="code">side=both|left|right</code>で指定できるようになりました。</p><p>Availability: 1.5 - ST_Bufferが強化され、様々な終端と継ぎ目に対応するようになりました。たとえば、道路ラインストリングを道路ポリゴンに変換する際に終端を丸でなく平面や四角で処理したい場合などに使えます。ジオグラフィ用の薄いラッパが追加されました。 </p><p>GEOSモジュールで実現しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OGC Simple Features
 Implementation Specification for SQL 1.1.</a> s2.1.1.3</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 5.1.17</p></div><div class="refsection"><a name="idp61468416"></a><h2>例</h2><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col><col></colgroup><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><div class="informalfigure"><div class="mediaobject"><img src="images/st_buffer01.png"><div class="caption"><p>quad_segs=8 (デフォルト)</p></div></div></div><p>
                </p><pre class="programlisting">SELECT ST_Buffer(
 ST_GeomFromText('POINT(100 90)'),
 50, 'quad_segs=8');
                </pre><p>
                          </p></td><td style="border-bottom: 1px solid ; "><div class="informalfigure"><div class="mediaobject"><img src="images/st_buffer02.png"><div class="caption"><p>quad_segs=2 (不十分)</p></div></div></div><p>
                </p><pre class="programlisting">SELECT ST_Buffer(
 ST_GeomFromText('POINT(100 90)'),
 50, 'quad_segs=2');
                </pre><p>
                        </p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><div class="informalfigure"><div class="mediaobject"><img src="images/st_buffer03.png"><div class="caption"><p>endcap=round join=round (デフォルト)</p></div></div></div><p>
                </p><pre class="programlisting">SELECT ST_Buffer(
 ST_GeomFromText(
  'LINESTRING(50 50,150 150,150 50)'
 ), 10, 'endcap=round join=round');
                </pre><p>
                         </p></td><td style="border-bottom: 1px solid ; "><div class="informalfigure"><div class="mediaobject"><img src="images/st_buffer04.png"><div class="caption"><p>endcap=square</p></div></div></div><p>
                </p><pre class="programlisting">SELECT ST_Buffer(
 ST_GeomFromText(
  'LINESTRING(50 50,150 150,150 50)'
 ), 10, 'endcap=square join=round');
                </pre><p>
                          </p></td><td style="border-bottom: 1px solid ; "><div class="informalfigure"><div class="mediaobject"><img src="images/st_buffer05.png"><div class="caption"><p>endcap=flat</p></div></div></div><p>
                </p><pre class="programlisting">SELECT ST_Buffer(
 ST_GeomFromText(
  'LINESTRING(50 50,150 150,150 50)'
 ), 10, 'endcap=flat join=round');
                </pre><p>
                          </p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><div class="informalfigure"><div class="mediaobject"><img src="images/st_buffer07.png"><div class="caption"><p>join=bevel</p></div></div></div><p>
                </p><pre class="programlisting">SELECT ST_Buffer(
 ST_GeomFromText(
  'LINESTRING(50 50,150 150,150 50)'
 ), 10, 'join=bevel');
                </pre><p>
                          </p></td><td style="border-bottom: 1px solid ; "><div class="informalfigure"><div class="mediaobject"><img src="images/st_buffer06.png"><div class="caption"><p>join=mitre mitre_limit=5.0 (デフォルトの最大マイター比)</p></div></div></div><p>
                </p><pre class="programlisting">SELECT ST_Buffer(
 ST_GeomFromText(
  'LINESTRING(50 50,150 150,150 50)'
 ), 10, 'join=mitre mitre_limit=5.0');
                </pre><p>
                          </p></td><td style="border-bottom: 1px solid ; "><div class="informalfigure"><div class="mediaobject"><img src="images/st_buffer08.png"><div class="caption"><p>join=mitre mitre_limit=1</p></div></div></div><p>
                </p><pre class="programlisting">SELECT ST_Buffer(
 ST_GeomFromText(
  'LINESTRING(50 50,150 150,150 50)'
 ), 10, 'join=mitre mitre_limit=1.0');
                </pre><p>
                          </p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><div class="informalfigure"><div class="mediaobject"><img src="images/st_buffer09.png"><div class="caption"><p>side=left</p></div></div></div><p>
                </p><pre class="programlisting">SELECT ST_Buffer(
 ST_GeomFromText(
  'LINESTRING(50 50,150 150,150 50)'
 ), 10, 'side=left');
                </pre><p>
                          </p></td><td style="border-bottom: 1px solid ; "><div class="informalfigure"><div class="mediaobject"><img src="images/st_buffer10.png"><div class="caption"><p>side=right</p></div></div></div><p>
                </p><pre class="programlisting">SELECT ST_Buffer(
 ST_GeomFromText(
  'LINESTRING(50 50,150 150,150 50)'
 ), 10, 'side=right');
                </pre><p>
                          </p></td><td style="border-bottom: 1px solid ; "><div class="informalfigure"><div class="mediaobject"><img src="images/st_buffer11.png"><div class="caption"><p>side=left join=mitre</p></div></div></div><p>
                </p><pre class="programlisting">SELECT ST_Buffer(
 ST_GeomFromText(
  'LINESTRING(50 50,150 150,150 50)'
 ), 10, 'side=left join=mitre');
                </pre><p>
                          </p></td></tr><tr><td style="border-right: 1px solid ; "><div class="informalfigure"><div class="mediaobject"><img src="images/st_buffer12.png"><div class="caption"><p>右回り、ポリゴン境界は左</p></div></div></div><p>
                </p><pre class="programlisting">SELECT ST_Buffer(
ST_ForceRHR(
ST_Boundary(
 ST_GeomFromText(
'POLYGON ((50 50, 50 150, 150 150, 150 50, 50 50))'))),
 ), 20, 'side=left');
                </pre><p>
                          </p></td><td style=""><div class="informalfigure"><div class="mediaobject"><img src="images/st_buffer13.png"><div class="caption"><p>右回り、ポリゴン境界は右</p></div></div></div><p>
                </p><pre class="programlisting">SELECT ST_Buffer(
ST_ForceRHR(
ST_Boundary(
 ST_GeomFromText(
'POLYGON ((50 50, 50 150, 150 150, 150 50, 50 50))'))
), 20,'side=right')
                </pre><p>
                </p></td></tr></tbody></table></div><pre class="programlisting">-- ポイントに対する近似円バッファ
-- 4分の1円を2点で近似するようポイントに施したバッファは8辺のポリゴンです。
-- (ダイアグラム参照)
SELECT ST_NPoints(ST_Buffer(ST_GeomFromText('POINT(100 90)'), 50)) As promisingcircle_pcount,
ST_NPoints(ST_Buffer(ST_GeomFromText('POINT(100 90)'), 50, 2)) As lamecircle_pcount;

promisingcircle_pcount | lamecircle_pcount
------------------------+-------------------
             33 |                9

-- 手軽だけれども不十分な円(4分の1円で2点だけの八角形)
-- 次に示すのは100メートルの八角形です。
-- 座標系は、元はNAD 83経度緯度で、
-- メートル単位マサチューセッツ州平面に変換してから、
-- メートルでバッファを取っています。
SELECT ST_AsText(ST_Buffer(
ST_Transform(
ST_SetSRID(ST_Point(-71.063526, 42.35785),4269), 26986)
,100,2)) As octagon;
----------------------
POLYGON((236057.59057465 900908.759918696,236028.301252769 900838.049240578,235
957.59057465 900808.759918696,235886.879896532 900838.049240578,235857.59057465
900908.759918696,235886.879896532 900979.470596815,235957.59057465 901008.759918
696,236028.301252769 900979.470596815,236057.59057465 900908.759918696))
        </pre></div><div class="refsection"><a name="idp61513600"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Collect" title="ST_Collect">ST_Collect</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#">???</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_BuildArea"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_BuildArea — 与えられたジオメトリの構成ラインから面ジオメトリを生成します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_BuildArea</b>(</code>geometry  <var class="pdparam">geom</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp61529472"></a><h2>説明</h2><p>与えられたジオメトリの構成ラインから面ジオメトリを生成します。入力としてLINESTRING, MULTILINESTRING, POLYGON, MULTIPOLYGON, GEOMETRYCOLLECTIONを取ることができます。返り値は、ポリゴンまたはマルチポリゴンで、どちらになるかは入力に依存します。入力構成ラインがポリゴンを形成しない場合はNULLを返します。 </p><p>この関数は全ての内部ジオメトリが穴を表現すると仮定します。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数が正しく動作するには、入力ラインに正しくノードが作成されている必要があります。</p></td></tr></table></div><p>Availability: 1.1.0</p></div><div class="refsection"><a name="idp61532160"></a><h2>例</h2><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col></colgroup><tbody><tr><td style=""><div class="informalfigure"><div class="mediaobject"><img src="images/st_buildarea01.png"><div class="caption"><p>ドーナツを生成します。</p></div></div></div><p>
                </p><pre class="programlisting">-- ポリゴンを使用
SELECT ST_BuildArea(ST_Collect(smallc,bigc))
FROM (SELECT
    ST_Buffer(
      ST_GeomFromText('POINT(100 90)'), 25) As smallc,
    ST_Buffer(ST_GeomFromText('POINT(100 90)'), 50) As bigc) As foo;
                </pre><p>

                </p><pre class="programlisting">-- ラインストリングを使用
SELECT ST_BuildArea(ST_Collect(smallc,bigc))
FROM (SELECT
    ST_ExteriorRing(ST_Buffer(
      ST_GeomFromText('POINT(100 90)'), 25)) As smallc,
    ST_ExteriorRing(ST_Buffer(ST_GeomFromText('POINT(100 90)'), 50)) As bigc) As foo;</pre><p>
                          </p></td></tr></tbody></table></div></div><div class="refsection"><a name="idp61538176"></a><h2>関連情報</h2><p><a class="xref" href="#">???</a>, <a class="xref" href="#ST_MakePolygon" title="ST_MakePolygon">ST_MakePolygon</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#">???</a> (wrappers to this function with standard OGC interface)</p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Centroid"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Centroid — ジオメトリの幾何学的重心を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Centroid</b>(</code>geometry  <var class="pdparam">g1</var><code>)</code>;</p><p><code class="funcdef">geography <b class="fsfunc">ST_Centroid</b>(</code>geography  <var class="pdparam">g1</var>, boolean  <var class="pdparam">use_spheroid=true</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp61565312"></a><h2>説明</h2><p>ジオメトリの幾何学的重心を計算します。[<code class="varname">MULTI</code>]<code class="varname">POINT</code>に対しては、入力座標の算術平均として計算されます。 [<code class="varname">MULTI</code>]<code class="varname">LINESTRING</code>に対しては、各辺の重み付き長さとして計算されます。 [<code class="varname">MULTI</code>]<code class="varname">POLYGON</code>に対しては、面積から計算されます。空ジオメトリが与えられた場合には、空の<code class="varname">GEOMETRYCOLLECTION</code>が返されます。<code class="varname">NULL</code>が与えられた場合には、<code class="varname">NULL</code>が返されます。<code class="varname">CIRCULARSTRING</code>または<code class="varname">COMPOUNDCURVE</code>が与えられた場合には、まずCurveToLineで直線に変換されてから、<code class="varname">LINESTRING</code>と同じ計算を行います。 </p><p>入力が混合次元の場合には、結果は最大次元のジオメトリの重心と同じになります (低次元ジオメトリは重心に0の「重み」を与えるためです)。</p><p>ポリゴンジオメトリに対しては、重心は必ずしもポリゴンの内部にあるわけではないことに注意して下さい。たとえば、下図のCの形のポリゴンの重心をご覧下さい。ポリゴン内部にポイントがあることを保障するには<a class="xref" href="#ST_PointOnSurface" title="ST_PointOnSurface">ST_PointOnSurface</a>を使います。 </p><p>New in 2.3.0 : <code class="varname">CIRCULARSTRING</code>と<code class="varname">COMPOUNDCURVE</code>に対応するようになりました (CurveToLineを使います)。</p><p>Availability: 2.4.0 ジオグラフィが導入されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OGC Simple Features
 Implementation Specification for SQL 1.1.</a></p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 8.1.4, 9.5.5</p></div><div class="refsection"><a name="idp61576704"></a><h2>例</h2><p>次に示す図では、緑点が入力ジオメトリの重心です。</p><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col><col></colgroup><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><div class="informalfigure"><div class="mediaobject"><img src="images/st_centroid01.png"><div class="caption"><p><code class="varname">MULTIPOINT</code>の重心</p></div></div></div></td><td style="border-bottom: 1px solid ; "><div class="informalfigure"><div class="mediaobject"><img src="images/st_centroid02.png"><div class="caption"><p><code class="varname">LINESTRING</code>の重心</p></div></div></div></td></tr><tr><td style="border-right: 1px solid ; "><div class="informalfigure"><div class="mediaobject"><img src="images/st_centroid03.png"><div class="caption"><p><code class="varname">POLYGON</code>の重心</p></div></div></div></td><td style=""><div class="informalfigure"><div class="mediaobject"><img src="images/st_centroid04.png"><div class="caption"><p><code class="varname">GEOMETRYCOLLECTION</code>の重心</p></div></div></div></td></tr></tbody></table></div><pre class="programlisting">SELECT ST_AsText(ST_Centroid('MULTIPOINT ( -1 0, -1 2, -1 3, -1 4, -1 7, 0 1, 0 3, 1 1, 2 0, 6 0, 7 8, 9 8, 10 6 )'));
                st_astext
------------------------------------------
 POINT(2.30769230769231 3.30769230769231)
(1 row)

SELECT ST_AsText(ST_centroid(g))
FROM  ST_GeomFromText('CIRCULARSTRING(0 2, -1 1,0 0, 0.5 0, 1 0, 2 1, 1 2, 0.5 2, 0 2)')  AS g ;
------------------------------------------
POINT(0.5 1)


SELECT ST_AsText(ST_centroid(g))
FROM  ST_GeomFromText('COMPOUNDCURVE(CIRCULARSTRING(0 2, -1 1,0 0),(0 0, 0.5 0, 1 0),CIRCULARSTRING( 1 0, 2 1, 1 2),(1 2, 0.5 2, 0 2))' ) AS g;
------------------------------------------
POINT(0.5 1)

</pre></div><div class="refsection"><a name="idp61595264"></a><h2>関連情報</h2><p><a class="xref" href="#ST_PointOnSurface" title="ST_PointOnSurface">ST_PointOnSurface</a>, <a class="xref" href="#ST_GeometricMedian" title="ST_GeometricMedian">ST_GeometricMedian </a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_ConcaveHull"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ConcaveHull — 全ての入力ジオメトリの頂点を囲むことができる凹多角形のジオメトリを計算します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_ConcaveHull</b>(</code>geometry  <var class="pdparam">geom</var>, float  <var class="pdparam">target_percent</var>, boolean  <var class="pdparam">allow_holes = false</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp61620096"></a><h2>説明</h2><p>ジオメトリの凹包は入力ジオメトリを囲む凹多角形のジオメトリを表現します。返り値は単一のポリゴン、ラインストリングまたはポイントです。任意引数<code class="varname">allow_holes</code>をTRUEに指定しない限り、穴を持ちません。 </p><p>凹包はジオメトリ集合の収縮包装で得られるジオメトリとみることができます。ジオメトリの周囲にゴムバンドをかけたような凸包と違う点です。凸包より計算時間がかかりますが、一般により小さい面積で、より入力ジオメトリに対して自然な境界を表現します。</p><p><code class="varname">target_percent</code>は、この関数が漸近を試みる、凸包の面積の百分率です。target_percentに1を与えると、凸包と同じ結果が得られます。 target_percentが0から0.99の間では、凸包より小さい面積の結果を返します。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>目標割合を小さくすると、凹包処理が長くなり、トポロジ例外が発生しやすくなります。蓄積される浮動小数点数とポイントの数もまた多くなります。最初に0.99で実行してみて下さい。普通は非常に速く、時々凸包と同じ速さです。99%縮小ではほとんどの場合行き過ぎになるので、通常は99%縮小より良い結果になります。次に0.98で実行すると、2乗のオーダーで遅くなります。ST_ConcaveHull実行後に、精度と浮動小数点数を減らすために、<a class="xref" href="#ST_SimplifyPreserveTopology" title="ST_SimplifyPreserveTopology">ST_SimplifyPreserveTopology</a>または<a class="xref" href="#ST_SnapToGrid" title="ST_SnapToGrid">ST_SnapToGrid</a>を使用します。ST_SnapToGridは少し早くなりますが、不正なジオメトリが得られることがあります。ST_SimplifyPreserveTopologyは常にジオメトリの妥当性を確保します。</p></td></tr></table></div><p>集約関数ではありません。ジオメトリ集合の凹包を計算するには、<a class="xref" href="#ST_Collect" title="ST_Collect">ST_Collect</a>または<a class="xref" href="#">???</a>を使います (<code class="code">ST_ConcaveHull(ST_Collect(somepointfield), 0.80)</code>等)。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ポイントまたはラインストリングの集合を使うには<code class="code">ST_Collect</code>を使います。ポリゴンの集合を使うには、無効なジオメトリで失敗する可能性があるため<code class="code">ST_Union</code>を使います。</p></td></tr></table></div><p>現実世界の例と技術面でのしっかりした説明は、<a class="ulink" href="http://www.bostongis.com/postgis_concavehull.snippet" target="_top">http://www.bostongis.com/postgis_concavehull.snippet</a>にあります。</p><p>Oracle 11G R2で導入された凹包のデモンストレーションに関するSimon Greenerさんの記事も見てください。<a class="ulink" href="http://www.spatialdbadvisor.com/oracle_spatial_tips_tricks/172/concave-hull-geometries-in-oracle-11gr2" target="_top">http://www.spatialdbadvisor.com/oracle_spatial_tips_tricks/172/concave-hull-geometries-in-oracle-11gr2</a>にあります。凸包に対する目標割合を0.75にした際の形状がSimonさんOracleのSDO_CONCAVEHULL_BOUNDARYで得た形状と似ています。</p><p>GEOSモジュールによって実現しています。</p><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp61629440"></a><h2>例</h2><pre class="programlisting">-- 観察ポイントを基に感染域の見積もりを得ます
SELECT d.disease_type,
    ST_ConcaveHull(ST_Collect(d.pnt_geom), 0.99) As geom
    FROM disease_obs As d
    GROUP BY d.disease_type;
</pre><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col><col></colgroup><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><div class="informalfigure"><div class="mediaobject"><img src="images/st_concavehull03.png"><div class="caption"><p> 縮小目標割合100%にした場合の2ポリゴンのST_ConcaveHull</p></div></div></div><p>
                </p><pre class="programlisting">-- 目標縮小率を100%にした (凸包と同じとなり、縮小していません)場合の凹包で
-- 覆ったジオメトリ
SELECT
    ST_ConcaveHull(
        ST_Union(ST_GeomFromText('POLYGON((175 150, 20 40,
            50 60, 125 100, 175 150))'),
        ST_Buffer(ST_GeomFromText('POINT(110 170)'), 20)
        ), 1)
     As convexhull;
                </pre><p>
                          </p></td><td style="border-bottom: 1px solid ; "><div class="informalfigure"><div class="mediaobject"><img src="images/st_concavehull02.png"><div class="caption"><p>凸包に対する縮小目標割合を90%にした凹包で覆われるジオメトリ</p></div></div></div><p>
                </p><pre class="programlisting">-- 目標縮小率を90%にした 場合の凹包で覆ったジオメトリ
SELECT
    ST_ConcaveHull(
        ST_Union(ST_GeomFromText('POLYGON((175 150, 20 40,
            50 60, 125 100, 175 150))'),
        ST_Buffer(ST_GeomFromText('POINT(110 170)'), 20)
        ), 0.9)
     As target_90;
                </pre><p>
                        </p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><div class="informalfigure"><div class="mediaobject"><img src="images/st_concavehull04.png"><div class="caption"><p>凸包で覆われたL字型のポイント群</p></div></div></div><p>
                </p><pre class="programlisting">-- 42ポイントでL字型を形成するテーブルを生成
SELECT (ST_DumpPoints(ST_GeomFromText(
'MULTIPOINT(14 14,34 14,54 14,74 14,94 14,114 14,134 14,
150 14,154 14,154 6,134 6,114 6,94 6,74 6,54 6,34 6,
14 6,10 6,8 6,7 7,6 8,6 10,6 30,6 50,6 70,6 90,6 110,6 130,
6 150,6 170,6 190,6 194,14 194,14 174,14 154,14 134,14 114,
14 94,14 74,14 54,14 34,14 14)'))).geom
    INTO TABLE l_shape;

SELECT ST_ConvexHull(ST_Collect(geom))
FROM l_shape;
                </pre><p>
                          </p></td><td style="border-bottom: 1px solid ; "><div class="informalfigure"><div class="mediaobject"><img src="images/st_concavehull05.png"><div class="caption"><p>凸包に対する縮小目標割合を99%としたL字型のポイント群の凹包</p></div></div></div><p>
                </p><pre class="programlisting">SELECT ST_ConcaveHull(ST_Collect(geom), 0.99)
    FROM l_shape;
                </pre><p>
                          </p></td></tr><tr><td style="border-right: 1px solid ; "><div class="informalfigure"><div class="mediaobject"><img src="images/st_concavehull06.png"><div class="caption"><p>凸包に対する縮小目標割合を80%としたL字型のポイント群の凹包</p></div></div></div><p>
    </p><pre class="programlisting">-- 凸包に対する縮小目標割合を80%としたL字型のポイント群の凹包
    SELECT ST_ConcaveHull(ST_Collect(geom), 0.80)
    FROM l_shape;
    </pre><p>
            </p>
            </td><td style=""><p>
                </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_concavehull07.png"><div class="caption"><p>凸包に覆われたマルチラインストリング</p></div></div></div><p>
                </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_concavehull08.png"><div class="caption"><p>凸包に対する縮小目標割合を99% (第1段階)とした凹包に覆われたマルチラインストリング</p></div></div></div><p>
    </p><pre class="programlisting">SELECT ST_ConcaveHull(ST_GeomFromText('MULTILINESTRING((106 164,30 112,74 70,82 112,130 94,
    130 62,122 40,156 32,162 76,172 88),
(132 178,134 148,128 136,96 128,132 108,150 130,
170 142,174 110,156 96,158 90,158 88),
(22 64,66 28,94 38,94 68,114 76,112 30,
132 10,168 18,178 34,186 52,184 74,190 100,
190 122,182 148,178 170,176 184,156 164,146 178,
132 186,92 182,56 158,36 150,62 150,76 128,88 118))'),0.99)
    </pre><p>
            </p>
            </td></tr></tbody></table></div></div><div class="refsection"><a name="idp61654272"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Collect" title="ST_Collect">ST_Collect</a>, <a class="xref" href="#ST_ConvexHull" title="ST_ConvexHull">ST_ConvexHull</a>, <a class="xref" href="#ST_SimplifyPreserveTopology" title="ST_SimplifyPreserveTopology">ST_SimplifyPreserveTopology</a>, <a class="xref" href="#ST_SnapToGrid" title="ST_SnapToGrid">ST_SnapToGrid</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_ConvexHull"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ConvexHull — ジオメトリの凸包を計算します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_ConvexHull</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp61661184"></a><h2>説明</h2><p>ジオメトリの凸包を計算します。凸包は、入力ジオメトリのすべてを囲む最小の凸ジオメトリです。</p><p>凸包は、ジオメトリ集合にゴムバンドをかけて得られたジオメトリとみることができます。ジオメトリの収縮包装に似ている凹包と違う点です。凸包は、しばしば観察値のポイントの集合を基にして、影響を受ける範囲を決定するのに使用します。</p><p>凸包は一般的にポリゴンです。二つ以上の同一線上のポイントの凸包は、2点のラインストリングになります。一つ以上の同一ポイントの凸包はポイントです。</p><p>集約関数ではありません。ジオメトリ集合の凸包を計算するには、ジオメトリ集合をジオメトリコレクションに集約する<a class="xref" href="#ST_Collect" title="ST_Collect">ST_Collect</a>を使います (<code class="code">ST_ConvexHull(ST_Collect(geom))</code>等)。</p><p>GEOSモジュールによって実現しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OGC Simple Features
 Implementation Specification for SQL 1.1.</a> s2.1.1.3</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 5.1.16</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp61669120"></a><h2>例</h2><p>
    </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_convexhull01.png"><div class="caption"><p>マルチラインストリングとマルチポイントの凸包</p></div></div></div><p>
    </p><pre class="programlisting">SELECT ST_AsText(ST_ConvexHull(
    ST_Collect(
        ST_GeomFromText('MULTILINESTRING((100 190,10 8),(150 10, 20 30))'),
            ST_GeomFromText('MULTIPOINT(50 5, 150 30, 50 10, 10 10)')
            )) );
---st_astext--
POLYGON((50 5,10 8,10 10,100 190,150 30,150 10,50 5))
    </pre><p>
</p><p>ST_Collectを使ってジオメトリ集合の凸包を計算します。</p><pre class="programlisting">-- 観測ポイントに基づく感染面積の推定
SELECT d.disease_type,
    ST_ConvexHull(ST_Collect(d.geom)) As geom
    FROM disease_obs As d
    GROUP BY d.disease_type;
</pre></div><div class="refsection"><a name="idp61673856"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Collect" title="ST_Collect">ST_Collect</a>, <a class="xref" href="#ST_ConcaveHull" title="ST_ConcaveHull">ST_ConcaveHull</a>, <a class="xref" href="#ST_MinimumBoundingCircle" title="ST_MinimumBoundingCircle">ST_MinimumBoundingCircle</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_DelaunayTriangles"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_DelaunayTriangles — ジオメトリの頂点のドローネ三角形を返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_DelaunayTriangles</b>(</code>geometry  <var class="pdparam">g1</var>, float  <var class="pdparam">tolerance</var>, int4  <var class="pdparam">flags</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp61707008"></a><h2>説明</h2><p>入力ジオメトリの頂点の周りの<a class="ulink" href="http://ja.wikipedia.org/wiki/%E3%83%89%E3%83%AD%E3%83%8D%E3%83%BC%E5%9B%B3" target="_top">ドロネー三角形</a>を返します。出力はポリゴンのコレクション (flags=0の場合)、MULTILINESTRING (flags=1の場合)、TIN(flags=2の場合)のいずれかになります。いずれの場合も、入力の頂点を一緒にスナップするために許容誤差が使われます。 </p><p>GEOSモジュールで実現しています。</p><p>Availability: 2.1.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div><div class="refsection"><a name="idp61712256"></a><h2>2次元の例</h2><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col></colgroup><tbody><tr><td style="border-bottom: 1px solid ; "><div class="informalfigure"><div class="mediaobject"><img src="images/st_delaunaytriangles01.png"><div class="caption"><p>元のポリゴン</p></div></div></div>
<pre class="programlisting">-- 元のジオメトリ --
    ST_Union(ST_GeomFromText('POLYGON((175 150, 20 40,
            50 60, 125 100, 175 150))'),
        ST_Buffer(ST_GeomFromText('POINT(110 170)'), 20)
        )</pre></td></tr><tr><td style="border-bottom: 1px solid ; "><div class="informalfigure"><div class="mediaobject"><img src="images/st_delaunaytriangles03.png"><div class="caption"><p>二つのポリゴンのST_DelaunayTriangles: ポリゴンごとに異なる色をつけたドロネー三角形ポリゴン</p></div></div></div><p>
                </p><pre class="programlisting">-- マルチラインストリングによる三角形を載せたジオメトリ
SELECT
    ST_DelaunayTriangles(
        ST_Union(ST_GeomFromText('POLYGON((175 150, 20 40,
            50 60, 125 100, 175 150))'),
        ST_Buffer(ST_GeomFromText('POINT(110 170)'), 20)
        ))
     As  dtriag;
                </pre><p>
                          </p></td></tr><tr><td style="border-bottom: 1px solid ; "><div class="informalfigure"><div class="mediaobject"><img src="images/st_delaunaytriangles02.png"><div class="caption"><p>マルチラインストリングにしたドロネー三角形</p></div></div></div><p>
                </p><pre class="programlisting">SELECT
    ST_DelaunayTriangles(
        ST_Union(ST_GeomFromText('POLYGON((175 150, 20 40,
            50 60, 125 100, 175 150))'),
        ST_Buffer(ST_GeomFromText('POINT(110 170)'), 20)
        ),0.001,1)
     As  dtriag;</pre><p>
                        </p></td></tr><tr><td style=""><div class="informalfigure"><div class="mediaobject"><img src="images/st_delaunaytriangles04.png"><div class="caption"><p>45個のポイントから生成した55個のドロネー三角形</p></div></div></div><p>
                </p><pre class="programlisting">-- L字型に42個のポイントを持つテーブルを生成
SELECT (ST_DumpPoints(ST_GeomFromText(
'MULTIPOINT(14 14,34 14,54 14,74 14,94 14,114 14,134 14,
150 14,154 14,154 6,134 6,114 6,94 6,74 6,54 6,34 6,
14 6,10 6,8 6,7 7,6 8,6 10,6 30,6 50,6 70,6 90,6 110,6 130,
6 150,6 170,6 190,6 194,14 194,14 174,14 154,14 134,14 114,
14 94,14 74,14 54,14 34,14 14)'))).geom
    INTO TABLE l_shape;
-- 個別の三角形ポリゴンとして出力
SELECT ST_AsText((ST_Dump(geom)).geom) As wkt
FROM ( SELECT ST_DelaunayTriangles(ST_Collect(geom)) As geom
FROM l_shape) As foo;

---wkt ---
POLYGON((6 194,6 190,14 194,6 194))
POLYGON((14 194,6 190,14 174,14 194))
POLYGON((14 194,14 174,154 14,14 194))
POLYGON((154 14,14 174,14 154,154 14))
POLYGON((154 14,14 154,150 14,154 14))
POLYGON((154 14,150 14,154 6,154 14))
:
:
</pre><p>
                        </p></td></tr></tbody></table></div></div><div class="refsection"><a name="idp61739904"></a><h2>3次元の例</h2><pre class="programlisting">-- 3次元マルチポイント --
SELECT ST_AsText(ST_DelaunayTriangles(ST_GeomFromText(
'MULTIPOINT Z(14 14 10,
150 14 100,34 6 25, 20 10 150)'))) As wkt;

----- WKT ----
GEOMETRYCOLLECTION Z (POLYGON Z ((14 14 10,20 10 150,34 6 25,14 14 10))
 ,POLYGON Z ((14 14 10,34 6 25,150 14 100,14 14 10)))</pre></div><div class="refsection"><a name="idp61741184"></a><h2>関連情報</h2><p><a class="xref" href="#ST_ConstrainedDelaunayTriangles" title="ST_ConstrainedDelaunayTriangles">ST_ConstrainedDelaunayTriangles</a>, <a class="xref" href="#ST_ConcaveHull" title="ST_ConcaveHull">ST_ConcaveHull</a>, <a class="xref" href="#ST_Dump" title="ST_Dump">ST_Dump</a>, <a class="xref" href="#ST_Tesselate" title="ST_Tesselate">ST_Tesselate</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_FilterByM"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_FilterByM — M値に基づいて頂点を削除します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_FilterByM</b>(</code>geometry <var class="pdparam">geom</var>, double precision <var class="pdparam">min</var>, double precision <var class="pdparam">max = null</var>, boolean <var class="pdparam">returnM = false</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp61751296"></a><h2>説明</h2><p>M値に基づいた頂点ポイントのフィルタリングを行います。返されるジオメトリは最小値(min値)以上かつ最大値(max値)以下のM値を持つポイントだけでできています。最大値の引数が指定されていない場合には、最小値のみ考慮されます。第4引数が指定されていない場合には、M値は結果ジオメトリに存在しません。結果ジオメトリの頂点ポイントの数が、ジオメトリを構成するに必要な数に達しない場合には、空ジオメトリが返されます。ジオメトリコレクション内の、十分なポイントを持たないジオメトリ要素は消えます。</p><p>この関数は主にST_SetEffectiveAreaとの併用を意図しています。ST_SetEffectiveAreaは頂点の有効面積をM値に設定します。ST_FilterByMによるフィルタリングだけで、他の計算なしに簡略化されたジオメトリを得られます。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ポイント数が基準を満たすのに十分でない時のST_SimplifyVWの返り値とST_FilterByMの返り値とで違いがあります。ST_FilterByMは空ジオメトリを返し、ST_SimplifyVWは十分なポイントを持つジオメトリを返します。</p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>返されるジオメトリは不正である場合があることに注意して下さい。</p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数は全ての次元を返し、Z値もM値も残ります。</p></td></tr></table></div><p>Availability: 2.5.0</p></div><div class="refsection"><a name="idp61754752"></a><h2>例</h2><p>フィルタリングされたラインストリング</p><pre class="programlisting">SELECT ST_AsText(ST_FilterByM(geom,30)) simplified
FROM (SELECT  ST_SetEffectiveArea('LINESTRING(5 2, 3 8, 6 20, 7 25, 10 10)'::geometry) geom) As foo;
-- 結果 --
         simplified
----------------------------
 LINESTRING(5 2,7 25,10 10)
                </pre></div><div class="refsection"><a name="idp61756416"></a><h2>関連情報</h2><p><a class="xref" href="#ST_SetEffectiveArea" title="ST_SetEffectiveArea">ST_SetEffectiveArea</a>, <a class="xref" href="#ST_SimplifyVW" title="ST_SimplifyVW">ST_SimplifyVW</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_GeneratePoints"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_GeneratePoints — ポリゴン内やマルチポリゴン内にランダムなポイントを生成します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_GeneratePoints</b>(</code> <var class="pdparam">g</var> geometry ,  <var class="pdparam">npoints</var> integer <code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_GeneratePoints</b>(</code> geometry <var class="pdparam">g</var> ,  integer <var class="pdparam">npoints</var> ,  integer <var class="pdparam">seed</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp61769088"></a><h2>説明</h2><p>ST_GeneratePointsは、入力の面内に指定した個数のポイントが出現するまで疑似乱数によるポイントを生成します。任意引数の<code class="code">seed</code>は、ポイント列の再生成が決定的にするために使い、0より大きい数でなければなりません。 </p><p>Availability: 2.3.0</p><p>Enhanced: 3.0.0 seedパラメータの追加</p></div><div class="refsection"><a name="idp61771520"></a><h2>例</h2><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col><col></colgroup><tbody><tr><td style="border-right: 1px solid ; ">
                        <div class="informalfigure"><div class="mediaobject"><img src="images/st_generatepoints01.png"><div class="caption"><p>元のポリゴン</p></div></div></div><p>
                        </p>
                    </td><td style=""><div class="informalfigure"><div class="mediaobject"><img src="images/st_generatepoints02.png"><div class="caption"><p>乱数シード値に1996を使った元のポリゴンの上に重なった12個のポイント生成</p></div></div></div><p>
                        </p><pre class="programlisting">SELECT ST_GeneratePoints(geom, 12, 1996)
FROM (
    SELECT ST_Buffer(
        ST_GeomFromText(
        'LINESTRING(50 50,150 150,150 50)'),
        10, 'endcap=round join=round') AS geom
) AS s;</pre><p>
                    </p></td></tr></tbody></table></div></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_GeometricMedian"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_GeometricMedian  — マルチポイントの幾何学的中央値を返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_GeometricMedian</b> (</code> geometry <var class="pdparam">geom</var>, float8 <var class="pdparam">tolerance = NULL</var>, int <var class="pdparam">max_iter = 10000</var>, boolean <var class="pdparam">fail_if_not_converged = false</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp61788032"></a><h2>説明</h2><p>マルチポイントジオメトリの幾何中央値の近似値を、Weiszfeldアルゴリズムを使って計算します。幾何中央値は、入力ポイントとの距離の合計を最小にするポイントです。幾何中央値によって、重心よりもはみ出しにくい中心測定ができます。 </p><p>このアルゴリズムでは、成功した回次の間の距離の変化が、<code class="varname">tolerance</code>パラメータよりも小さくなるまで繰り返します。<code class="varname">max_iterations</code>回を超えた場合には、関数は<code class="varname">fail_if_not_converged</code>を<code class="code">FALSE</code>に指定している (デフォルト)場合を除いて、エラーを生成して終了します。 </p><p><code class="varname">tolerance</code>値が渡されていない場合には、デフォルトの許容値は、入力ジオメトリの範囲を基に計算されます。 </p><p>存在する場合には、入力ポイントのM値は相対的な重みに解釈されます。 </p><p>Availability: 2.3.0</p><p>Enhanced: 2.5.0 ポイントの重みとしてのM値の対応が追加されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports M coordinates.</p></div><div class="refsection"><a name="idp61828480"></a><h2>例</h2><p>
          </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_geometricmedian01.png"><div class="caption"><p>4点のマルチポイント (黄色の点)から得た重心 (青緑色の点)と幾何学的中央値 (赤色の点)との比較。 </p></div></div></div><p>
      </p><pre class="programlisting">WITH test AS (
SELECT 'MULTIPOINT((0 0), (1 1), (2 2), (200 200))'::geometry geom)
SELECT
  ST_AsText(ST_Centroid(geom)) centroid,
  ST_AsText(ST_GeometricMedian(geom)) median
FROM test;
      centroid      |                 median
--------------------+----------------------------------------
 POINT(50.75 50.75) | POINT(1.9761550281255 1.9761550281255)
(1 row)
      </pre></div><div class="refsection"><a name="idp61832576"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Centroid" title="ST_Centroid">ST_Centroid</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_LineMerge"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_LineMerge — MULTILINESTRINGを縫い合わせて形成したラインを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_LineMerge</b>(</code>geometry  <var class="pdparam">amultilinestring</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp61838336"></a><h2>説明</h2><p>MULTILINESTRINGを構成するラインを結合して形成されたLINESTRINGまたはMULTILINESTRINGを返します。ラインは2方向交点の終端で結合します。ラインは3方向以上の交点では結合しません。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>MULTILINESTRING/LINESTRINGでのみ使います。POLYGONまたはGEOMETRYCOLLECTIONをこの関数に渡した場合には、EMPTY GEOMETRYCOLLECTIONが返ります。</p></td></tr></table></div><p>GEOSモジュールで実現しています。</p><p>Availability: 1.1.0</p><div class="warning"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はM値を取り除きます。</p></td></tr></table></div></div><div class="refsection"><a name="idp61841280"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(ST_LineMerge(
'MULTILINESTRING((-29 -27,-30 -29.7,-36 -31,-45 -33),(-45 -33,-46 -32))'
                ));
st_astext
--------------------------------------------------------------------------------------------------
LINESTRING(-29 -27,-30 -29.7,-36 -31,-45 -33,-46 -32)
</pre><p>接触するラインが無くマージができない場合には、元のMULTILINESTRINGが返されます。</p><pre class="programlisting">SELECT ST_AsText(ST_LineMerge(
'MULTILINESTRING((-29 -27,-30 -29.7,-36 -31,-45 -33),(-45.2 -33.2,-46 -32))'
));
st_astext
----------------
MULTILINESTRING((-45.2 -33.2,-46 -32),(-29 -27,-30 -29.7,-36 -31,-45 -33))
</pre><p>Z値処理を示す例。</p><pre class="programlisting">SELECT ST_AsText(ST_LineMerge(
      'MULTILINESTRING((-29 -27 11,-30 -29.7 10,-36 -31 5,-45 -33 6), (-29 -27 12,-30 -29.7 5), (-45 -33 1,-46 -32 11))'
        ));
st_astext
--------------------------------------------------------------------------------------------------
LINESTRING Z (-30 -29.7 5,-29 -27 11,-30 -29.7 10,-36 -31 5,-45 -33 1,-46 -32 11)
</pre></div><div class="refsection"><a name="idp61844352"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Segmentize" title="ST_Segmentize">ST_Segmentize</a>, <a class="xref" href="#ST_LineSubstring" title="ST_LineSubstring">ST_LineSubstring</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_MaximumInscribedCircle"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MaximumInscribedCircle — ジオメトリに完全に含まれる最大の円を計算します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">(geometry, geometry, double precision) <b class="fsfunc">ST_MaximumInscribedCircle</b>(</code>geometry  <var class="pdparam">geom</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp61850496"></a><h2>説明</h2><p>完全にジオメトリ内に含まれる最大の円を探します。円の中心点、中心に最も近いジオメトリ、円の半径からなるレコードを返します。 </p><p>ポリゴン入力の場合、円は外環に内接して、内環を境界として使用します。ラインまたはポイントの入力では、円は入力の凸包に内接して、入力はさらに境界として使用します。</p><p>Availability: 3.1.0 - GEOS 3.9.0以上が必要です。</p></div><div class="refsection"><a name="idp61852544"></a><h2>関連情報</h2><p><a class="xref" href="#ST_MinimumBoundingCircle" title="ST_MinimumBoundingCircle">ST_MinimumBoundingCircle</a></p></div><div class="refsection"><a name="idp61853824"></a><h2>例</h2><pre class="programlisting">SELECT radius, ST_AsText(center) AS center, ST_AsText(nearest) AS nearest
    FROM ST_MaximumInscribedCircle('POLYGON ((50 50, 150 50, 150 150, 50 150, 50 50))')

 radius |     center     |    nearest
--------+----------------+---------------
     50 | POINT(100 100) | POINT(100 50)</pre><div class="informalfigure"><div class="mediaobject"><img src="images/st_maximuminscribedcircle01.png"><div class="caption"><p>三角形ポリゴンの最大の内接円。中心点、最近点、半径が返ります。</p></div></div></div><div class="informalfigure"><div class="mediaobject"><img src="images/st_maximuminscribedcircle02.png"><div class="caption"><p>マルチラインストリングの最大の内接円。中心点、最近点と半径が返ります。</p></div></div></div></div><div class="refsection"><a name="idp61879936"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Collect" title="ST_Collect">ST_Collect</a>, <a class="xref" href="#ST_MinimumBoundingRadius" title="ST_MinimumBoundingRadius">ST_MinimumBoundingRadius</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_MinimumBoundingCircle"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MinimumBoundingCircle — 入力ジオメトリを含む最小の円を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_MinimumBoundingCircle</b>(</code>geometry  <var class="pdparam">geomA</var>, integer  <var class="pdparam">num_segs_per_qt_circ=48</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp61887232"></a><h2>説明</h2><p>入力ジオメトリを含む最小の円を返します。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>円はポリゴンで近似されます。デフォルトでは、4分の1円で48辺です。このポリゴンは円の最小バウンディングボックスの近似であるので、入力ジオメトリのいくつかの点はポリゴンに入らない可能性があります。この近似は辺の数を増やすことによって改善され、辺の数を増やすことで得られる不利益は小さいです。ポリゴン近似が適切でない場合のアプリケーションにおいては、ST_MinimumBoundingRadiusを使います。</p></td></tr></table></div><p>しばしば、MULTI系とジオメトリコレクションで使用します。しかし、集約関数ではありません。ST_Collectと併用して、ジオメトリの集合の最小包含円を得ます。ST_MinimumBoundingCircle(ST_Collect(somepointfield))とします。</p><p>ポリゴンの面積を最小包含円の面積で割った割合は、しばしばRoeckテストとして参照されます。</p><p>GEOSモジュールで実現しています。</p><p>Availability: 1.4.0</p></div><div class="refsection"><a name="idp61890432"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Collect" title="ST_Collect">ST_Collect</a>, <a class="xref" href="#ST_MinimumBoundingRadius" title="ST_MinimumBoundingRadius">ST_MinimumBoundingRadius</a></p></div><div class="refsection"><a name="idp61892096"></a><h2>例</h2><pre class="programlisting">SELECT d.disease_type,
    ST_MinimumBoundingCircle(ST_Collect(d.geom)) As geom
    FROM disease_obs As d
    GROUP BY d.disease_type;
</pre><div class="informalfigure"><div class="mediaobject"><img src="images/st_minimumboundingcircle01.png"><div class="caption"><p>ポイントとラインストリングの最小包含円です。4分の1円の近似に8区分使用しています。</p></div></div></div><pre class="programlisting">SELECT ST_AsText(ST_MinimumBoundingCircle(
        ST_Collect(
            ST_GeomFromText('LINESTRING(55 75,125 150)'),
                ST_Point(20, 80)), 8
                )) As wktmbc;
wktmbc
-----------
POLYGON((135.59714732062 115,134.384753327498 102.690357210921,130.79416296937 90.8537670908995,124.963360620072 79.9451031602111,117.116420743937 70.3835792560632,107.554896839789 62.5366393799277,96.6462329091006 56.70583703063,84.8096427890789 53.115246672502,72.5000000000001 51.9028526793802,60.1903572109213 53.1152466725019,48.3537670908996 56.7058370306299,37.4451031602112 62.5366393799276,27.8835792560632 70.383579256063,20.0366393799278 79.9451031602109,14.20583703063 90.8537670908993,10.615246672502 102.690357210921,9.40285267938019 115,10.6152466725019 127.309642789079,14.2058370306299 139.1462329091,20.0366393799275 150.054896839789,27.883579256063 159.616420743937,
37.4451031602108 167.463360620072,48.3537670908992 173.29416296937,60.190357210921 176.884753327498,
72.4999999999998 178.09714732062,84.8096427890786 176.884753327498,96.6462329091003 173.29416296937,107.554896839789 167.463360620072,
117.116420743937 159.616420743937,124.963360620072 150.054896839789,130.79416296937 139.146232909101,134.384753327498 127.309642789079,135.59714732062 115))
                </pre></div><div class="refsection"><a name="idp61896192"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Collect" title="ST_Collect">ST_Collect</a>, <a class="xref" href="#ST_MinimumBoundingRadius" title="ST_MinimumBoundingRadius">ST_MinimumBoundingRadius</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_MinimumBoundingRadius"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MinimumBoundingRadius — ジオメトリを完全に包含する最小円の中心ポイントと半径を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">(geometry, double precision) <b class="fsfunc">ST_MinimumBoundingRadius</b>(</code>geometry <var class="pdparam">geom</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp61914624"></a><h2>説明</h2><p>ジオメトリを完全に包含する最小円の中心ポイントと半径を返します。</p><p>ジオメトリの集合の最小包含円を得るには<a class="xref" href="#ST_Collect" title="ST_Collect">ST_Collect</a>と併用します。</p><p>Availability: 2.3.0</p></div><div class="refsection"><a name="idp61916928"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Collect" title="ST_Collect">ST_Collect</a>, <a class="xref" href="#ST_MinimumBoundingCircle" title="ST_MinimumBoundingCircle">ST_MinimumBoundingCircle</a></p></div><div class="refsection"><a name="idp61918592"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(center), radius FROM ST_MinimumBoundingRadius('POLYGON((26426 65078,26531 65242,26075 65136,26096 65427,26426 65078))');

                st_astext                 |      radius
------------------------------------------+------------------
 POINT(26284.8418027133 65267.1145090825) | 247.436045591407
</pre></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_OrientedEnvelope"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_OrientedEnvelope — ジオメトリを囲む最小の回転四角形を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_OrientedEnvelope</b>(</code> geometry <var class="pdparam">geom</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp61936896"></a><h2>説明</h2><p>ジオメトリを囲む最小の回転四角形を返します。最小回転四角形が複数個存在することがあるので注意して下さい。入力が退化している場合には、ポイントまたはラインストリングを返すことがあります。 </p><p>Availability: 2.5.0 </p></div><div class="refsection"><a name="idp61938432"></a><h2>関連情報</h2><p>
                <a class="xref" href="#ST_Envelope" title="ST_Envelope">ST_Envelope</a>
                <a class="xref" href="#ST_MinimumBoundingCircle" title="ST_MinimumBoundingCircle">ST_MinimumBoundingCircle</a>
            </p></div><div class="refsection"><a name="idp61940352"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(ST_OrientedEnvelope('MULTIPOINT ((0 0), (-1 -1), (3 2))'));

                st_astext
                ------------------------------------------------
                POLYGON((3 2,2.88 2.16,-1.12 -0.84,-1 -1,3 2))
            </pre><div class="informalfigure"><div class="mediaobject"><img src="images/st_orientedenvelope01.png"><div class="caption"><p>ポイントとラインストリングの回転したエンベロープ。</p></div></div></div><pre class="programlisting">SELECT ST_AsText(ST_OrientedEnvelope(
        ST_Collect(
            ST_GeomFromText('LINESTRING(55 75,125 150)'),
                ST_Point(20, 80))
                )) As wktenv;
wktenv
-----------
POLYGON((19.9999999999997 79.9999999999999,33.0769230769229 60.3846153846152,138.076923076924 130.384615384616,125.000000000001 150.000000000001,19.9999999999997 79.9999999999999))
</pre></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_OffsetCurve"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_OffsetCurve — 与えられた距離と方面に入力ラインをずらしたラインを返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_OffsetCurve</b>(</code>geometry  <var class="pdparam">line</var>, float  <var class="pdparam">signed_distance</var>, text  <var class="pdparam">style_parameters=''</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp61955072"></a><h2>説明</h2><p>与えられた距離と方面に入力ラインをずらしたラインを返します。返されるジオメトリの全てのポイントは、入力ジオメトリより与えられた距離以上には離れません。中心線に対する平行線を計算するのに使用します。 </p><p>距離が正の場合には、入力ラインの左側にずらして、方向が保持されます。負の場合には、右側にずらし、逆方向のラインになります。 </p><p>距離の単位は空間参照系の単位です。 </p><p>入力ジオメトリがジグソーパズルのような形状の場合には、出力がMULTILINESTRINGまたはEMPTYになることがあるので、注意して下さい。 </p><p>任意指定の第3引数では、空白区切りのkey=valueペアの一覧を指定して、次のような操作をすることができます。 </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>'quad_segs=#' : 4分の1円区分数に近づけるために使われる区分の数 (デフォルトは8)。</p></li><li class="listitem"><p>'join=round|mitre|bevel' : 接続スタイル (デフォルトは"round")。'miter'も'mitre'の同義語として受け付けます。</p></li><li class="listitem"><p>'mitre_limit=#.#' : マイターの割合制限 (接続スタイルがマイターである場合のみ影響が出ます)。'miter_limit'も'mitre_limit'の同義語として受け付けます。</p></li></ul></div><p>
                </p><p>GEOSモジュールで実現しています。</p><p>Availability: 2.0</p><p>Enhanced: 2.5 - GEOMETRYCOLLECTIONとULTILINESTRINGへの対応追加</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はZ値を無視します。この関数を3次元ジオメトリ上で使用したとしても、常に2次元の結果となります。</p></td></tr></table></div></div><div class="refsection"><a name="idp61962112"></a><h2>例</h2><p>道路の周りの開いたバッファの算出</p><pre class="programlisting">SELECT ST_Union(
 ST_OffsetCurve(f.geom,  f.width/2, 'quad_segs=4 join=round'),
 ST_OffsetCurve(f.geom, -f.width/2, 'quad_segs=4 join=round')
) as track
FROM someroadstable;

                </pre><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col><col></colgroup><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><div class="informalfigure"><div class="mediaobject"><img src="images/st_offsetcurve01.png"><div class="caption"><p>15, 'quad_segs=4 join=round' 元のラインと15単位ずらしたライン。</p></div></div></div><p>
                </p><pre class="programlisting">SELECT ST_AsText(ST_OffsetCurve(ST_GeomFromText(
'LINESTRING(164 16,144 16,124 16,104 16,84 16,64 16,
    44 16,24 16,20 16,18 16,17 17,
    16 18,16 20,16 40,16 60,16 80,16 100,
    16 120,16 140,16 160,16 180,16 195)'),
    15, 'quad_segs=4 join=round'));
-- 出力 --
LINESTRING(164 1,18 1,12.2597485145237 2.1418070123307,
    7.39339828220179 5.39339828220179,
    5.39339828220179 7.39339828220179,
    2.14180701233067 12.2597485145237,1 18,1 195)
                </pre><p>
                          </p></td><td style="border-bottom: 1px solid ; "><div class="informalfigure"><div class="mediaobject"><img src="images/st_offsetcurve02.png"><div class="caption"><p>-15, 'quad_segs=4 join=round' 元のラインと-15単位ずらしたライン。 </p></div></div></div><p>
                </p><pre class="programlisting">SELECT ST_AsText(ST_OffsetCurve(geom,
    -15, 'quad_segs=4 join=round')) As notsocurvy
    FROM ST_GeomFromText(
'LINESTRING(164 16,144 16,124 16,104 16,84 16,64 16,
    44 16,24 16,20 16,18 16,17 17,
    16 18,16 20,16 40,16 60,16 80,16 100,
    16 120,16 140,16 160,16 180,16 195)') As geom;
-- 曲線になりません --
LINESTRING(31 195,31 31,164 31)
                </pre><p>
                        </p></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; "><div class="informalfigure"><div class="mediaobject"><img src="images/st_offsetcurve05.png"><div class="caption"><p>二重にずらして曲線を得ます。1回目で逆方向にしていて、-30 + 15 = -15としています。</p></div></div></div><p>
                </p><pre class="programlisting">SELECT ST_AsText(ST_OffsetCurve(ST_OffsetCurve(geom,
    -30, 'quad_segs=4 join=round'), -15, 'quad_segs=4 join=round')) As morecurvy
    FROM ST_GeomFromText(
'LINESTRING(164 16,144 16,124 16,104 16,84 16,64 16,
    44 16,24 16,20 16,18 16,17 17,
    16 18,16 20,16 40,16 60,16 80,16 100,
    16 120,16 140,16 160,16 180,16 195)') As geom;
-- 曲線になります --
LINESTRING(164 31,46 31,40.2597485145236 32.1418070123307,
35.3933982822018 35.3933982822018,
32.1418070123307 40.2597485145237,31 46,31 195)
                </pre><p>
                        </p></td><td style="border-bottom: 1px solid ; "><div class="informalfigure"><div class="mediaobject"><img src="images/st_offsetcurve06.png"><div class="caption"><p>二重にずらして曲線を得て、順方向に15ずらして平行線を得ます。元のラインを覆います。</p></div></div></div><p>
                </p><pre class="programlisting">SELECT ST_AsText(ST_Collect(
    ST_OffsetCurve(geom, 15, 'quad_segs=4 join=round'),
    ST_OffsetCurve(ST_OffsetCurve(geom,
    -30, 'quad_segs=4 join=round'), -15, 'quad_segs=4 join=round')
    )
) As parallel_curves
    FROM ST_GeomFromText(
'LINESTRING(164 16,144 16,124 16,104 16,84 16,64 16,
    44 16,24 16,20 16,18 16,17 17,
    16 18,16 20,16 40,16 60,16 80,16 100,
    16 120,16 140,16 160,16 180,16 195)') As geom;
-- 平行曲線 --
MULTILINESTRING((164 1,18 1,12.2597485145237 2.1418070123307,
7.39339828220179 5.39339828220179,5.39339828220179 7.39339828220179,
2.14180701233067 12.2597485145237,1 18,1 195),
(164 31,46 31,40.2597485145236 32.1418070123307,35.3933982822018 35.3933982822018,
32.1418070123307 40.2597485145237,31 46,31 195))
                </pre><p>
                        </p></td></tr><tr><td style="border-right: 1px solid ; "><div class="informalfigure"><div class="mediaobject"><img src="images/st_offsetcurve03.png"><div class="caption"><p>15, 'quad_segs=4 join=bevel' と元のライン</p></div></div></div><p>
                </p><pre class="programlisting">SELECT ST_AsText(ST_OffsetCurve(ST_GeomFromText(
'LINESTRING(164 16,144 16,124 16,104 16,84 16,64 16,
    44 16,24 16,20 16,18 16,17 17,
    16 18,16 20,16 40,16 60,16 80,16 100,
    16 120,16 140,16 160,16 180,16 195)'),
        15, 'quad_segs=4 join=bevel'));
-- 出力 --
LINESTRING(164 1,18 1,7.39339828220179 5.39339828220179,
    5.39339828220179 7.39339828220179,1 18,1 195)
                </pre><p>
                         </p></td><td style=""><div class="informalfigure"><div class="mediaobject"><img src="images/st_offsetcurve04.png"><div class="caption"><p>join=mitre mitre_limit=2.1で、15ずらしたものと-15ずらしたものとを集めたもの。</p></div></div></div><p>
                </p><pre class="programlisting">SELECT ST_AsText(ST_Collect(
    ST_OffsetCurve(geom, 15, 'quad_segs=4 join=mitre mitre_limit=2.2'),
    ST_OffsetCurve(geom, -15, 'quad_segs=4 join=mitre mitre_limit=2.2')
    ) )
    FROM ST_GeomFromText(
'LINESTRING(164 16,144 16,124 16,104 16,84 16,64 16,
    44 16,24 16,20 16,18 16,17 17,
    16 18,16 20,16 40,16 60,16 80,16 100,
    16 120,16 140,16 160,16 180,16 195)') As geom;
-- 出力 --
MULTILINESTRING((164 1,11.7867965644036 1,1 11.7867965644036,1 195),
    (31 195,31 31,164 31))
                </pre><p>
                          </p></td></tr></tbody></table></div></div><div class="refsection"><a name="idp62005376"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Buffer" title="ST_Buffer">ST_Buffer</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_PointOnSurface"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_PointOnSurface — ポリゴン内またはジオメトリ上にあるのが保証されたポイントを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_PointOnSurface</b>(</code>geometry  <var class="pdparam">g1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp62011136"></a><h2>説明</h2><p>サーフェス (POLYGON、MULTIPOLYGON、CURVED POLYGON)内部にあることが保証された<code class="varname">POINT</code>を返します。PostGISでは、この関数はラインジオメトリとポイントジオメトリ上でも動作します。 </p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OGC Simple Features
 Implementation Specification for SQL 1.1.</a> s3.2.14.2 // s3.2.18.2</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 8.1.5, 9.5.6. 仕様では、サーフェスジオメトリのみのST_PointOnSurfaceが定義されています。PostGISは、すべての一般的なジオメトリタイプに対応するよう拡張しています。他のデータベース (Oracle、DB2、ArcSDE)は、サーフェスに対してのみこの機能をサポートしているようです。SQL Server 2008では、すべての一般的なジオメトリタイプに対応しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp62017152"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(ST_PointOnSurface('POINT(0 5)'::geometry));
 st_astext
------------
 POINT(0 5)

SELECT ST_AsText(ST_PointOnSurface('LINESTRING(0 5, 0 10)'::geometry));
 st_astext
------------
 POINT(0 5)

SELECT ST_AsText(ST_PointOnSurface('POLYGON((0 0, 0 5, 5 5, 5 0, 0 0))'::geometry));
   st_astext
----------------
 POINT(2.5 2.5)

SELECT ST_AsEWKT(ST_PointOnSurface(ST_GeomFromEWKT('LINESTRING(0 5 1, 0 0 1, 0 10 2)')));
   st_asewkt
----------------
 POINT(0 0 1)
</pre></div><div class="refsection"><a name="idp62018432"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Centroid" title="ST_Centroid">ST_Centroid</a>, <a class="xref" href="#ST_MaximumInscribedCircle" title="ST_MaximumInscribedCircle">ST_MaximumInscribedCircle</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Polygonize"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Polygonize — ジオメトリ集合のラインから形成されるポリゴンのコレクションを計算します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Polygonize</b>(</code>geometry set <var class="pdparam">geomfield</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_Polygonize</b>(</code>geometry[] <var class="pdparam">geom_array</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp62026752"></a><h2>説明</h2><p>ジオメトリ集合の構成要素であるラインから形成されるポリゴンを含むジオメトリコレクションを計算します。この関数が確実に動作するために、入力ラインは正しいノードを持たなければなりません。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>入力が完全にノードを持っているようにするには、ポリゴン化の前に入力ジオメトリに対して<a class="xref" href="#">???</a>を使います。 </p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ジオメトリコレクションは、サードパーティ製ツールでは、しばしば取り扱いが難しいとされることがあります。ポリゴン化の結果を個々のポリゴンに変換するには<a class="xref" href="#ST_Dump" title="ST_Dump">ST_Dump</a>を使います。</p></td></tr></table></div><p>GEOSモジュールで実現しています。</p><p>Availability: 1.0.0RC1</p></div><div class="refsection"><a name="idp62031104"></a><h2>例: 単一ラインストリングのポリゴン化</h2><pre class="programlisting">SELECT ST_AsEWKT(ST_Polygonize(geom_4269)) As geomtextrep
FROM (SELECT geom_4269 FROM ma.suffolk_edges ORDER BY tlid LIMIT 45) As foo;

geomtextrep
-------------------------------------
 SRID=4269;GEOMETRYCOLLECTION(POLYGON((-71.040878 42.285678,-71.040943 42.2856,-71.04096 42.285752,-71.040878 42.285678)),
 POLYGON((-71.17166 42.353675,-71.172026 42.354044,-71.17239 42.354358,-71.171794 42.354971,-71.170511 42.354855,
 -71.17112 42.354238,-71.17166 42.353675)))
(1 row)

-- ST_Dumpでポリゴン化されたジオメトリを個々のポリゴンにダンプします
SELECT ST_AsEWKT((ST_Dump(foofoo.polycoll)).geom) As geomtextrep
FROM (SELECT ST_Polygonize(geom_4269) As polycoll
    FROM (SELECT geom_4269 FROM ma.suffolk_edges
        ORDER BY tlid LIMIT 45) As foo) As foofoo;

geomtextrep
------------------------
 SRID=4269;POLYGON((-71.040878 42.285678,-71.040943 42.2856,-71.04096 42.285752,
-71.040878 42.285678))
 SRID=4269;POLYGON((-71.17166 42.353675,-71.172026 42.354044,-71.17239 42.354358
,-71.171794 42.354971,-71.170511 42.354855,-71.17112 42.354238,-71.17166 42.353675))
(2 rows)

              </pre></div><div class="refsection"><a name="idp62032384"></a><h2>関連情報</h2><p><a class="xref" href="#">???</a>, <a class="xref" href="#ST_Dump" title="ST_Dump">ST_Dump</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_ReducePrecision"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ReducePrecision — 全ての与えられたグリッド許容値に丸められたポイントからなる妥当なジオメトリを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_ReducePrecision</b>(</code>geometry  <var class="pdparam">g</var>, float8  <var class="pdparam">gridsize</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp62072448"></a><h2>説明</h2><p>全ての与えられたグリッド許容値に丸められたポイントからなる妥当なジオメトリを返します。許容値より下の地物は削除されます。</p><p><a class="xref" href="#ST_SnapToGrid" title="ST_SnapToGrid">ST_SnapToGrid</a>と違い、返されるジオメトリは妥当で、自己交差の環や崩壊した要素を伴いません。</p><p>精度提言は次の場合に使います。 </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>座標精度をデータ精度に合わせる </p></li><li class="listitem"><p>ジオメトリを表現するのに必要な座標の数を減らす </p></li><li class="listitem"><p>低精度書式 (出力桁数が制限されるWKT, GeoJSON, KML等のテキスト書式)への出力ジオメトリの妥当性の確保。 </p></li><li class="listitem"><p>妥当なジオメトリの低精度や制度制限のあるシステム (SDE, Oracle許容値等)へのエクスポート </p></li></ul></div><p>
		</p><p>Availability: 3.1.0 - GEOS 3.9.0以上が必要です。 </p></div><div class="refsection"><a name="idp62077824"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(ST_ReducePrecision('POINT(1.412 19.323)', 0.1));
    st_astext
-----------------
 POINT(1.4 19.3)

SELECT ST_AsText(ST_ReducePrecision('POINT(1.412 19.323)', 1.0));
  st_astext
-------------
 POINT(1 19)

SELECT ST_AsText(ST_ReducePrecision('POINT(1.412 19.323)', 10));
  st_astext
-------------
 POINT(0 20)
</pre><p>精度を落とすことで頂点数を減らすことができます。</p><pre class="programlisting">SELECT ST_AsText(ST_ReducePrecision('LINESTRING (10 10, 19.6 30.1, 20 30, 20.3 30, 40 40)', 1));
  st_astext
-------------
 LINESTRING (10 10, 20 30, 40 40)
</pre><p>妥当性を確保するために必要な場合には、精度を落とす際にポリゴンを分割します。</p><pre class="programlisting">SELECT ST_AsText(ST_ReducePrecision('POLYGON ((10 10, 60 60.1, 70 30, 40 40, 50 10, 10 10))', 10));
  st_astext
-------------
 MULTIPOLYGON (((60 60, 70 30, 40 40, 60 60)), ((40 40, 50 10, 10 10, 40 40)))
</pre></div><div class="refsection"><a name="idp62081024"></a><h2>関連情報</h2><p><a class="xref" href="#ST_SnapToGrid" title="ST_SnapToGrid">ST_SnapToGrid</a>, <a class="xref" href="#ST_Simplify" title="ST_Simplify">ST_Simplify</a>, <a class="xref" href="#ST_SimplifyVW" title="ST_SimplifyVW">ST_SimplifyVW</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_SharedPaths"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SharedPaths — 二つのLINESTRING/MULTILINESTRINGの入力が共有するパスのコレクションを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_SharedPaths</b>(</code>geometry <var class="pdparam">lineal1</var>, geometry <var class="pdparam">lineal2</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp62092672"></a><h2>説明</h2><p>二つの入力ジオメトリが共有するパスのコレクションを返します。順方向に行くものはコレクションの一つ目の要素にあり、逆方向は二つ目の要素にあります。これらのパス自体は一つ目のジオメトリの方向をもとにします。 </p><p>GEOSモジュールで実現しています。</p><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp62094592"></a><h2>例: 共有パスの探索</h2><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col></colgroup><tbody><tr><td style="border-bottom: 1px solid ; "><div class="informalfigure"><div class="mediaobject"><img src="images/st_sharedpaths01.png"><div class="caption"><p>マルチラインストリングとラインストリング</p></div></div></div>
               </td></tr><tr><td style="border-bottom: 1px solid ; "><div class="informalfigure"><div class="mediaobject"><img src="images/st_sharedpaths02.png"><div class="caption"><p>マルチラインストリングとラインストリングとの共有パスと元のジオメトリ。</p></div></div></div><p>
                  </p><pre class="programlisting">SELECT ST_AsText(
  ST_SharedPaths(
    ST_GeomFromText('MULTILINESTRING((26 125,26 200,126 200,126 125,26 125),
       (51 150,101 150,76 175,51 150))'),
    ST_GeomFromText('LINESTRING(151 100,126 156.25,126 125,90 161, 76 175)')
    )
  ) As wkt

                                wkt
-------------------------------------------------------------
GEOMETRYCOLLECTION(MULTILINESTRING((126 156.25,126 125),
 (101 150,90 161),(90 161,76 175)),MULTILINESTRING EMPTY)
              </pre><p>
            </p>
            </td></tr><tr><td style=""><p>
                  </p><pre class="programlisting">-- 同じ例ですがラインストリングの引数の順序を入れ替えています
SELECT ST_AsText(
  ST_SharedPaths(
   ST_GeomFromText('LINESTRING(76 175,90 161,126 125,126 156.25,151 100)'),
   ST_GeomFromText('MULTILINESTRING((26 125,26 200,126 200,126 125,26 125),
       (51 150,101 150,76 175,51 150))')
    )
  ) As wkt

                                wkt
-------------------------------------------------------------
GEOMETRYCOLLECTION(MULTILINESTRING EMPTY,
MULTILINESTRING((76 175,90 161),(90 161,101 150),(126 125,126 156.25)))
              </pre><p>
            </p>
            </td></tr></tbody></table></div></div><div class="refsection"><a name="idp62104704"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Dump" title="ST_Dump">ST_Dump</a>, <a class="xref" href="#ST_GeometryN" title="ST_GeometryN">ST_GeometryN</a>, <a class="xref" href="#ST_NumGeometries" title="ST_NumGeometries">ST_NumGeometries</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Simplify"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Simplify — Douglas-Peukerアルゴリズムを使用して、与えられたジオメトリを簡略化したものを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Simplify</b>(</code>geometry <var class="pdparam">geomA</var>, float <var class="pdparam">tolerance</var>, boolean <var class="pdparam">preserveCollapsed</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp62113408"></a><h2>説明</h2><p>与えられたジオメトリを「簡略化」したものを返します。Douglas-Peukerアルゴリズムを使用します。(MULTI)LINEと(MULTI)POLYGONとで実際に動作をしますが、どのような種類のジオメトリでも安全に呼ぶことができます。簡略化はオブジェクトごとに行われるので、ジオメトリコレクションでこの関数を呼ぶことができます。</p><p>"preserve collapsed"フラグによって、許容範囲より非常に小さいオブジェクトが保持されます。例えば、1メートル長のラインを10メートルの許容範囲で簡略化する場合です。"preserve"フラグを与えると、ラインは消去されません。このフラグは、多数の非常に小さいオブジェクトを持っていて、これらが想定外の隙間を残して地図から消えることを避けるのに使えます。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>返されるジオメトリは単純性 (<a class="xref" href="#ST_IsSimple" title="ST_IsSimple">ST_IsSimple</a>参照)を失うことがあります。</p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>トポロジは保存されているとは限らず、不正なジオメトリを返すことがあります。トポロジを保存するには<a class="xref" href="#ST_SimplifyPreserveTopology" title="ST_SimplifyPreserveTopology">ST_SimplifyPreserveTopology</a>を使います。</p></td></tr></table></div><p>Availability: 1.2.2</p></div><div class="refsection"><a name="idp62117120"></a><h2>例</h2><p>簡略化をやりすぎて三角形になった円、八角形になった円です。 </p><pre class="programlisting">SELECT ST_Npoints(geom) AS np_before,
       ST_NPoints(ST_Simplify(geom,0.1)) AS np01_notbadcircle,
       ST_NPoints(ST_Simplify(geom,0.5)) AS np05_notquitecircle,
       ST_NPoints(ST_Simplify(geom,1)) AS np1_octagon,
       ST_NPoints(ST_Simplify(geom,10)) AS np10_triangle,
       (ST_Simplify(geom,100) is null) AS  np100_geometrygoesaway
  FROM
    (SELECT ST_Buffer('POINT(1 3)', 10,12) As geom) AS foo;

 np_before | np01_notbadcircle | np05_notquitecircle | np1_octagon | np10_triangle | np100_geometrygoesaway
-----------+-------------------+---------------------+-------------+---------------+------------------------
        49 |                33 |                  17 |           9 |             4 | t
      </pre></div><div class="refsection"><a name="idp62118784"></a><h2>関連情報</h2><p><a class="xref" href="#ST_IsSimple" title="ST_IsSimple">ST_IsSimple</a>, <a class="xref" href="#ST_SimplifyPreserveTopology" title="ST_SimplifyPreserveTopology">ST_SimplifyPreserveTopology</a>, Topology <a class="xref" href="#TP_ST_Simplify" title="ST_Simplify">ST_Simplify</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_SimplifyPreserveTopology"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SimplifyPreserveTopology — Douglas-Peukerアルゴリズムを使用して、与えられたジオメトリを簡略化したものを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_SimplifyPreserveTopology</b>(</code>geometry <var class="pdparam">geomA</var>, float <var class="pdparam">tolerance</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp62138624"></a><h2>説明</h2><p>与えられたジオメトリを「簡略化」したものを返します。Douglas-Peukerアルゴリズムを使用します。不正な派生ジオメトリ (特にポリゴン)の生成を回避します。(MULTI)LINEと(MULTI)POLYGONとで実際に動作をしますが、どのような種類のジオメトリでも安全に呼ぶことができます。簡略化はオブジェクトごとに行われるので、ジオメトリコレクションでこの関数を呼ぶことができます。</p><p>GEOSモジュールで実現しています。</p><p>Availability: 1.3.3</p></div><div class="refsection"><a name="idp62140544"></a><h2>例</h2><p>Simplyfyと同じ例ですが、トポロジ保存で簡略化の行きすぎを阻止します。円は最低でも四角形になります。</p><pre class="programlisting">SELECT ST_Npoints(geom) As np_before, ST_NPoints(ST_SimplifyPreserveTopology(geom,0.1)) As np01_notbadcircle, ST_NPoints(ST_SimplifyPreserveTopology(geom,0.5)) As np05_notquitecircle,
ST_NPoints(ST_SimplifyPreserveTopology(geom,1)) As np1_octagon, ST_NPoints(ST_SimplifyPreserveTopology(geom,10)) As np10_square,
ST_NPoints(ST_SimplifyPreserveTopology(geom,100)) As  np100_stillsquare
FROM (SELECT ST_Buffer('POINT(1 3)', 10,12) As geom) As foo;

-- 結果 --
 np_before | np01_notbadcircle | np05_notquitecircle | np1_octagon | np10_square | np100_stillsquare
-----------+-------------------+---------------------+-------------+---------------+-------------------
        49 |                33 |                  17 |           9 |             5 |                 5
                </pre></div><div class="refsection"><a name="idp62142208"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Simplify" title="ST_Simplify">ST_Simplify</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_SimplifyVW"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SimplifyVW — Visvalingam-Whyattアルゴリズムを使用して、入力ジオメトリを簡略化したジオメトリを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_SimplifyVW</b>(</code>geometry <var class="pdparam">geomA</var>, float <var class="pdparam">tolerance</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp62148992"></a><h2>説明</h2><p>Visvalingam-Whyattアルゴリズムを用いて、入力ジオメトリを「簡略化」したジオメトリを返します。(マルチ)ラインと(マルチ)ポリゴンでのみ動作しますが、どの種類のジオメトリでも安全に呼ぶことができます。(MULTI)LINEと(MULTI)POLYGONとで実際に動作をしますが、どのような種類のジオメトリでも安全に呼ぶことができます。簡略化はオブジェクトごとに行われるので、ジオメトリコレクションでこの関数を呼ぶことができます。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>返されるジオメトリは単純性 (<a class="xref" href="#ST_IsSimple" title="ST_IsSimple">ST_IsSimple</a>参照)を失うことがあります。</p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>トポロジは保存されているとは限らず、不正なジオメトリを返すことがあります。トポロジを保存するには<a class="xref" href="#ST_SimplifyPreserveTopology" title="ST_SimplifyPreserveTopology">ST_SimplifyPreserveTopology</a>を使います。</p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数は3次元を扱います。第3次元は結果に影響を与えます。</p></td></tr></table></div><p>Availability: 2.2.0</p></div><div class="refsection"><a name="idp62152832"></a><h2>例</h2><p>ラインストリングを最小範囲のしきい値を30で簡略化しています。</p><pre class="programlisting">select ST_AsText(ST_SimplifyVW(geom,30)) simplified
FROM (SELECT  'LINESTRING(5 2, 3 8, 6 20, 7 25, 10 10)'::geometry geom) As foo;
-result
 simplified
------------------------------
LINESTRING(5 2,7 25,10 10)

                </pre></div><div class="refsection"><a name="idp62154496"></a><h2>関連情報</h2><p><a class="xref" href="#ST_SetEffectiveArea" title="ST_SetEffectiveArea">ST_SetEffectiveArea</a>, <a class="xref" href="#ST_Simplify" title="ST_Simplify">ST_Simplify</a>, <a class="xref" href="#ST_SimplifyPreserveTopology" title="ST_SimplifyPreserveTopology">ST_SimplifyPreserveTopology</a>, Topology <a class="xref" href="#TP_ST_Simplify" title="ST_Simplify">ST_Simplify</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_ChaikinSmoothing"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ChaikinSmoothing —  チャイキンのアルゴリズムを使って、与えられたジオメトリの平滑化されたものを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_ChaikinSmoothing</b>(</code>geometry <var class="pdparam">geom</var>, integer <var class="pdparam">nIterations = 1</var>, boolean <var class="pdparam">preserveEndPoints = false</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp62163456"></a><h2>説明</h2><p>チャイキンのアルゴリズムを使って、与えられたジオメトリの「平滑化された」ものを返します。処理の説明については<a class="ulink" href="http://www.idav.ucdavis.edu/education/CAGDNotes/Chaikins-Algorithm/Chaikins-Algorithm.html" target="_top">Chaikins-Algorithm</a>をご覧下さい。繰り返しごとに頂点の数は倍になります。この関数は新しい頂点を、各ポイントの前後に、ラインの1/4の位置に置き、元のポイントを削除します。ポイント数を減らすには、結果に対して簡略化関数を使います。新しいポイントの、ZとMを含むジオメトリの全ての次元に補間値が付きます。</p><p>第2引数は繰り返し回数で最大5回です。</p><p>第3引数はポリゴンにのみ有効です。ラインストリングでは無視されます。</p><p>この関数は3次元を扱います。第3次元は結果に影響を与えます。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>返却ジオメトリが元のジオメトリより多くのポイントを得ることに注意して下さい。再びポイント数を低減するには、単純化関数を使います (<a class="xref" href="#ST_Simplify" title="ST_Simplify">ST_Simplify</a>と<a class="xref" href="#ST_SimplifyVW" title="ST_SimplifyVW">ST_SimplifyVW</a>参照)。</p></td></tr></table></div><p>Availability: 2.5.0</p></div><div class="refsection"><a name="idp62167936"></a><h2>例</h2><p>トライアングルの平滑化</p><pre class="programlisting">select ST_AsText(ST_ChaikinSmoothing(geom)) smoothed
FROM (SELECT  'POLYGON((0 0, 8 8, 0 16, 0 0))'::geometry geom) As foo;
┌───────────────────────────────────────────┐
│                 smoothed                  │
├───────────────────────────────────────────┤
│ POLYGON((2 2,6 6,6 10,2 14,0 12,0 4,2 2)) │
└───────────────────────────────────────────┘
                </pre></div><div class="refsection"><a name="idp62169600"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Simplify" title="ST_Simplify">ST_Simplify</a>, <a class="xref" href="#ST_SimplifyVW" title="ST_SimplifyVW">ST_SimplifyVW</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_SetEffectiveArea"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SetEffectiveArea — Visvalingam-Whyattアルゴリズムを使って有効範囲となる個々の頂点を置きます。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_SetEffectiveArea</b>(</code>geometry <var class="pdparam">geomA</var>, float <var class="pdparam">threshold = 0</var>, integer <var class="pdparam">set_area = 1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp62177792"></a><h2>説明</h2><p>Visvalingam-Whyattアルゴリズムから有効範囲となる個々の頂点を置きます。有効範囲はジオメトリのM値として格納されます。任意引数である第2引数を使うと、しきい値以上の有効範囲となる頂点だけで構築されるジオメトリを返します。 </p><p>この関数は、しきい値を使うことでサーバサイド簡略化に使えます。もう一つの任意引数はしきい値を0にする際に使用します。この場合、完全なジオメトリを得ますが、クライアントが非常に高速に簡略化するために使うM値として格納している有効範囲を持っています。 </p><p>(MULTI)LINEと(MULTI)POLYGONとで実際に動作をしますが、どのような種類のジオメトリでも安全に呼ぶことができます。簡略化はオブジェクトごとに行われるので、ジオメトリコレクションでこの関数を呼ぶことができます。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>返されるジオメトリは単純性 (<a class="xref" href="#ST_IsSimple" title="ST_IsSimple">ST_IsSimple</a>参照)を失うことがあります。</p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>トポロジは保存されているとは限らず、不正なジオメトリを返すことがあります。トポロジを保存するには<a class="xref" href="#ST_SimplifyPreserveTopology" title="ST_SimplifyPreserveTopology">ST_SimplifyPreserveTopology</a>を使います。</p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>出力ジオメトリは、入力時に持っていたM値の情報の全てを失います。</p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数は3次元を扱います。第3次元は結果に影響を与えます。</p></td></tr></table></div><p>Availability: 2.2.0</p></div><div class="refsection"><a name="idp62182656"></a><h2>例</h2><p>ラインストリングの有効範囲の計算。しきい値を0にしているので、入力ジオメトリの全ての頂点が返ります。 </p><pre class="programlisting">select ST_AsText(ST_SetEffectiveArea(geom)) all_pts, ST_AsText(ST_SetEffectiveArea(geom,30) ) thrshld_30
FROM (SELECT  'LINESTRING(5 2, 3 8, 6 20, 7 25, 10 10)'::geometry geom) As foo;
-- 結果 --
 all_pts | thrshld_30
-----------+-------------------+
LINESTRING M (5 2 3.40282346638529e+38,3 8 29,6 20 1.5,7 25 49.5,10 10 3.40282346638529e+38) | LINESTRING M (5 2 3.40282346638529e+38,7 25 49.5,10 10 3.40282346638529e+38)

                </pre></div><div class="refsection"><a name="idp62184320"></a><h2>関連情報</h2><p><a class="xref" href="#ST_SimplifyVW" title="ST_SimplifyVW">ST_SimplifyVW</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_VoronoiLines"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_VoronoiLines — ジオメトリの頂点からボロノイ図のセルを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_VoronoiLines</b>(</code> <var class="pdparam">g1</var> geometry ,  <var class="pdparam">tolerance</var> float8 ,  <var class="pdparam">extend_to</var> geometry <code>)</code>;</p></div></div><div class="refsection"><a name="idp62193152"></a><h2>説明</h2><p>ST_VoronoiLinesは、与えられたジオメトリの頂点から、2次元<a class="ulink" href="https://ja.wikipedia.org/wiki/%E3%83%9C%E3%83%AD%E3%83%8E%E3%82%A4%E5%9B%B3" target="_top">ボロノイ図</a>を計算します。図の細胞間の境界をMULTILINESTRINGで返します。入力ジオメトリがNULLの場合には、NULLを返します。入力ジオメトリに頂点が一つだけしか無い場合には、空ジオメトリコレクションを返します。extend_toのエンベロープの面積が0の場合には、空ジオメトリコレクションを返します。 </p><p>任意パラメータ: </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>'tolerance' : この距離以内の点は等価とします。0でない許容距離を指定することで、アルゴリズムのロバスト性が改善します。デフォルトは0.0です。</p></li><li class="listitem"><p>'extend_to': ジオメトリが"extend_to"パラメータとして渡された場合には、エンベロープがデフォルトエンベロープより小さい場合を除いて、ボロノイ図は"extend_to"ジオメトリのエンベロープを覆う範囲になります (デフォルトはNULLで、デフォルトのエンベロープは入力ジオメトリのバウンディングボックスから各方向に50%ずつ拡張したものです)。</p></li></ul></div><p>
        </p><p>GEOSモジュールで実現しています。</p><p>Availability: 2.3.0</p></div><div class="refsection"><a name="idp62198144"></a><h2>例</h2><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col></colgroup><tbody><tr><td style=""><div class="informalfigure"><div class="mediaobject"><img src="images/st_voronoi03.png"><div class="caption"><p>許容範囲を30単位としたボロノイ図</p></div></div></div><p>
                    </p><pre class="programlisting">SELECT ST_VoronoiLines(geom, 30) As geom
FROM (SELECT 'MULTIPOINT (50 30, 60 30, 100 100,10 150, 110 120)'::geometry As geom ) As g</pre><p>
</p><pre class="screen">-- ST_AsText 出力
MULTILINESTRING((135.555555555556 270,36.8181818181818 92.2727272727273),(36.8181818181818 92.2727272727273,-110 43.3333333333333),(230 -45.7142857142858,36.8181818181818 92.2727272727273))
</pre><p>
                </p></td></tr></tbody></table></div></div><div class="refsection"><a name="idp62204416"></a><h2>関連情報</h2><p><a class="xref" href="#ST_DelaunayTriangles" title="ST_DelaunayTriangles">ST_DelaunayTriangles</a>, <a class="xref" href="#ST_VoronoiPolygons" title="ST_VoronoiPolygons">ST_VoronoiPolygons</a>, <a class="xref" href="#ST_Collect" title="ST_Collect">ST_Collect</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_VoronoiPolygons"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_VoronoiPolygons — ジオメトリの頂点からボロノイ図のセルを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_VoronoiPolygons</b>(</code> <var class="pdparam">g1</var> geometry ,  <var class="pdparam">tolerance</var> float8 ,  <var class="pdparam">extend_to</var> geometry <code>)</code>;</p></div></div><div class="refsection"><a name="idp62214144"></a><h2>説明</h2><p>ST_VoronoiPolygonsは、与えられたジオメトリの頂点から、2次元<a class="ulink" href="https://ja.wikipedia.org/wiki/%E3%83%9C%E3%83%AD%E3%83%8E%E3%82%A4%E5%9B%B3" target="_top">ボロノイ図</a>を計算します。結果は、入力頂点の範囲より大きいエンベロープを覆うポリゴンのジオメトリコレクションです。入力ジオメトリがNULLの場合には、NULLを返します。入力ジオメトリに頂点が一つだけしか無い場合には、空ジオメトリコレクションを返します。extend_toのエンベロープの面積が0の場合には、空ジオメトリコレクションを返します。 </p><p>任意パラメータ: </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>'tolerance' : この距離以内の点は等価とします。0でない許容距離を指定することで、アルゴリズムのロバスト性が改善します。デフォルトは0.0です。</p></li><li class="listitem"><p>'extend_to': ジオメトリが"extend_to"パラメータとして渡された場合には、エンベロープがデフォルトエンベロープより小さい場合を除いて、ボロノイ図は"extend_to"ジオメトリのエンベロープを覆う範囲になります (デフォルトはNULLで、デフォルトのエンベロープは入力ジオメトリのバウンディングボックスから各方向に50%ずつ拡張したものです)。 </p></li></ul></div><p>
        </p><p>GEOSモジュールで実現しています。</p><p>Availability: 2.3.0</p></div><div class="refsection"><a name="idp62219136"></a><h2>例</h2><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col></colgroup><tbody><tr><td style="border-bottom: 1px solid ; ">
                    <div class="informalfigure"><div class="mediaobject"><img src="images/st_voronoi01.png"><div class="caption"><p>Points overlaid on top of Voronoi diagram</p></div></div></div><p>
                    </p><pre class="programlisting">SELECT
    ST_VoronoiPolygons(geom) As geom
FROM (SELECT 'MULTIPOINT (50 30, 60 30, 100 100,10 150, 110 120)'::geometry As geom ) As g;</pre><p>
</p><pre class="screen">-- ST_AsText 出力 --
GEOMETRYCOLLECTION(POLYGON((-110 43.3333333333333,-110 270,100.5 270,59.3478260869565 132.826086956522,36.8181818181818 92.2727272727273,-110 43.3333333333333)),
POLYGON((55 -90,-110 -90,-110 43.3333333333333,36.8181818181818 92.2727272727273,55 79.2857142857143,55 -90)),
POLYGON((230 47.5,230 -20.7142857142857,55 79.2857142857143,36.8181818181818 92.2727272727273,59.3478260869565 132.826086956522,230 47.5)),POLYGON((230 -20.7142857142857,230 -90,55 -90,55 79.2857142857143,230 -20.7142857142857)),
POLYGON((100.5 270,230 270,230 47.5,59.3478260869565 132.826086956522,100.5 270)))
</pre><p>
                    </p>
                </td></tr><tr><td style="border-bottom: 1px solid ; "><div class="informalfigure"><div class="mediaobject"><img src="images/st_voronoi02.png"><div class="caption"><p>許容範囲を30単位としたボロノイ図</p></div></div></div><p>
                    </p><pre class="programlisting">SELECT ST_VoronoiPolygons(geom, 30) As geom
FROM (SELECT 'MULTIPOINT (50 30, 60 30, 100 100,10 150, 110 120)'::geometry As geom ) As g;</pre><p>
</p><pre class="screen">-- ST_AsText 出力
GEOMETRYCOLLECTION(POLYGON((-110 43.3333333333333,-110 270,100.5 270,59.3478260869565 132.826086956522,36.8181818181818 92.2727272727273,-110 43.3333333333333)),
POLYGON((230 47.5,230 -45.7142857142858,36.8181818181818 92.2727272727273,59.3478260869565 132.826086956522,230 47.5)),POLYGON((230 -45.7142857142858,230 -90,-110 -90,-110 43.3333333333333,36.8181818181818 92.2727272727273,230 -45.7142857142858)),
POLYGON((100.5 270,230 270,230 47.5,59.3478260869565 132.826086956522,100.5 270)))
</pre><p>
                </p></td></tr><tr><td style=""><div class="informalfigure"><div class="mediaobject"><img src="images/st_voronoi03.png"><div class="caption"><p>許容範囲を30単位とした、マルチラインストリングのボロノイ図</p></div></div></div><p>
                    </p><pre class="programlisting">SELECT ST_VoronoiLines(geom, 30) As geom
FROM (SELECT 'MULTIPOINT (50 30, 60 30, 100 100,10 150, 110 120)'::geometry As geom ) As g</pre><p>
</p><pre class="screen">-- ST_AsText 出力
MULTILINESTRING((135.555555555556 270,36.8181818181818 92.2727272727273),(36.8181818181818 92.2727272727273,-110 43.3333333333333),(230 -45.7142857142858,36.8181818181818 92.2727272727273))
</pre><p>
                </p></td></tr></tbody></table></div></div><div class="refsection"><a name="idp62254080"></a><h2>関連情報</h2><p><a class="xref" href="#ST_DelaunayTriangles" title="ST_DelaunayTriangles">ST_DelaunayTriangles</a>, <a class="xref" href="#ST_VoronoiLines" title="ST_VoronoiLines">ST_VoronoiLines</a>, <a class="xref" href="#ST_Collect" title="ST_Collect">ST_Collect</a> </p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Linear_Referencing"></a>8.12. 線型参照</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#ST_LineInterpolatePoint">ST_LineInterpolatePoint</a></span><span class="refpurpose"> — ラインに沿って、割合で示された位置の補間ポイントを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_3DLineInterpolatePoint">ST_3DLineInterpolatePoint</a></span><span class="refpurpose"> — 3次元ラインに沿って、割合で示された位置の補間ポイントを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_LineInterpolatePoints">ST_LineInterpolatePoints</a></span><span class="refpurpose"> — ラインに沿って、割合で示された複数の位置の補間ポイントを返します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_LineLocatePoint">ST_LineLocatePoint</a></span><span class="refpurpose"> — ポイントに最も近いライン上のポイントの位置を割合で返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_LineSubstring">ST_LineSubstring</a></span><span class="refpurpose"> — 二つの割合位置からラインの一部を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_LocateAlong">ST_LocateAlong</a></span><span class="refpurpose"> — M値に一致するジオメトリ上のポイントを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_LocateBetween">ST_LocateBetween</a></span><span class="refpurpose"> — M値の範囲に合致する部分ジオメトリを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_LocateBetweenElevations">ST_LocateBetweenElevations</a></span><span class="refpurpose"> — 標高 (Z値)範囲にある部分ジオメトリを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_InterpolatePoint">ST_InterpolatePoint</a></span><span class="refpurpose"> — ジオメトリのポイントに最も近いポイント上の補間M値を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_AddMeasure">ST_AddMeasure</a></span><span class="refpurpose"> — ラインに沿ったM値を補間します。</span></dt></dl></div><div class="refentry"><a name="ST_LineInterpolatePoint"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_LineInterpolatePoint — ラインに沿って、割合で示された位置の補間ポイントを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_LineInterpolatePoint</b>(</code>geometry  <var class="pdparam">a_linestring</var>, float8  <var class="pdparam">a_fraction</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp62967424"></a><h2>説明</h2><p>ラインに沿って、割合で示された位置の補間ポイントを返します。一つ目の引数はLINESTRINGです。二つ目の引数は0から1の間の浮動小数点数で、ライン長に対するポイントの位置の割合を表現します。Z値とM値が存在する場合には補間計算を行います。 </p><p>ポイントに最も近いライン位置の計算については<a class="xref" href="#ST_LineLocatePoint" title="ST_LineLocatePoint">ST_LineLocatePoint</a>を参照して下さい。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数は2次元のポイントとして計算して、Z値とM値は補間値を計算します。<a class="xref" href="#ST_3DLineInterpolatePoint" title="ST_3DLineInterpolatePoint">ST_3DLineInterpolatePoint</a>は3次元のポイントとして計算して、M値のみ補間値を計算します。</p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>1.1.1から、この関数はM軸やZ軸の内挿点も (存在するなら)計算するようになりました。それより前の版では0.0となります。</p></td></tr></table></div><p>Availability: 0.8.2 Z軸とM軸のサポートが1.1.1で追加されました。</p><p>Changed: 2.1.0 2.0.xまでではST_Line_Interpolate_Pointと呼んでいました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp62973440"></a><h2>例</h2><div class="informalfigure"><div class="mediaobject"><img src="images/st_line_interpolate_point01.png"><div class="caption"><p>ラインストリングの20% (0.20)位置の補完ポイント </p></div></div></div><pre class="programlisting">-- ラインに沿った20%位置

SELECT ST_AsEWKT(
    ST_LineInterpolatePoint(
        'LINESTRING(25 50, 100 125, 150 190)',
        0.2 ));

   st_asewkt
----------------
 POINT(51.5974135047432 76.5974135047432)
</pre><p>3次元ラインの中間点</p><pre class="programlisting">SELECT ST_AsEWKT(
    ST_LineInterpolatePoint('
        LINESTRING(1 2 3, 4 5 6, 6 7 8)',
        0.5 ));

        st_asewkt
--------------------
 POINT(3.5 4.5 5.5)
</pre><p>ライン上のポイントに最も近いポイント</p><pre class="programlisting">SELECT ST_AsText(
    ST_LineInterpolatePoint( line.geom,
        ST_LineLocatePoint( line.geom, 'POINT(4 3)')))
FROM (SELECT ST_GeomFromText('LINESTRING(1 2, 4 5, 6 7)') As geom) AS line;

 st_astext
------------
 POINT(3 4)
</pre></div><div class="refsection"><a name="idp62983040"></a><h2>関連情報</h2><p><a class="xref" href="#ST_LineInterpolatePoints" title="ST_LineInterpolatePoints">ST_LineInterpolatePoints</a>, <a class="xref" href="#ST_3DLineInterpolatePoint" title="ST_3DLineInterpolatePoint">ST_3DLineInterpolatePoint</a>, <a class="xref" href="#ST_LineLocatePoint" title="ST_LineLocatePoint">ST_LineLocatePoint</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_3DLineInterpolatePoint"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_3DLineInterpolatePoint — 3次元ラインに沿って、割合で示された位置の補間ポイントを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_3DLineInterpolatePoint</b>(</code>geometry  <var class="pdparam">a_linestring</var>, float8  <var class="pdparam">a_fraction</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp62990720"></a><h2>説明</h2><p>3次元ラインに沿って、割合で示された位置の補間ポイントを返します。一つ目の引数はLINESTRINGです。二つ目の引数は0から1の間の浮動小数点数で、ライン長に対するポイントの位置の割合を表現します。M値が存在する場合には補間計算を行います。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><a class="xref" href="#ST_LineInterpolatePoint" title="ST_LineInterpolatePoint">ST_LineInterpolatePoint</a> 2次元ポイントの計算とZ値とM値の補間値を計算しますが、この関数は3次元ポイントを計算し、M値だけ補間計算を行います。</p></td></tr></table></div><p>Availability: 3.0.0</p></div><div class="refsection"><a name="idp62993280"></a><h2>例</h2><p>3次元ラインに沿って20%のポイントを返します</p><pre class="programlisting">SELECT ST_AsText(
    ST_3DLineInterpolatePoint('LINESTRING(25 50 70, 100 125 90, 150 190 200)',
        0.20));

   st_asetext
----------------
 POINT Z (59.0675892910822 84.0675892910822 79.0846904776219)
</pre></div><div class="refsection"><a name="idp61520768"></a><h2>関連情報</h2><p><a class="xref" href="#ST_LineInterpolatePoint" title="ST_LineInterpolatePoint">ST_LineInterpolatePoint</a>, <a class="xref" href="#ST_LineInterpolatePoints" title="ST_LineInterpolatePoints">ST_LineInterpolatePoints</a>, <a class="xref" href="#ST_LineLocatePoint" title="ST_LineLocatePoint">ST_LineLocatePoint</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_LineInterpolatePoints"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_LineInterpolatePoints — ラインに沿って、割合で示された複数の位置の補間ポイントを返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_LineInterpolatePoints</b>(</code>geometry  <var class="pdparam">a_linestring</var>, float8  <var class="pdparam">a_fraction</var>, boolean  <var class="pdparam">repeat</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp62999936"></a><h2>説明</h2><p>ラインに沿って、割合で示された位置の、一つ以上の補間ポイントを返します。一つ目の引数はLINESTRINGです。二つ目の引数は0から1の間の浮動小数点数で、ライン長に対するポイント間隔割合を表現します。三つ目の引数がFALSEの場合には、一つのポイントが構築されます (<a class="xref" href="#ST_LineInterpolatePoint" title="ST_LineInterpolatePoint">ST_LineInterpolatePoint</a>と同じです)。 </p><p>結果にポイントが無いかポイントが一つだけの場合には、一つのPOINTを返します。二つ以上のポイントがある場合には、MULTIPOINTを返します。 </p><p>Availability: 2.5.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports M coordinates.</p></div><div class="refsection"><a name="idp63005056"></a><h2>例</h2><div class="informalfigure"><div class="mediaobject"><img src="images/st_line_interpolate_points01.png"><div class="caption"><p>ラインストリングの 20%ごとの補間 </p></div></div></div><pre class="programlisting">-- 2次元ラインに沿った20%ごとのポイントを返します。
SELECT ST_AsText(ST_LineInterpolatePoints('LINESTRING(25 50, 100 125, 150 190)', 0.20))
   st_astext
----------------
 MULTIPOINT(51.5974135047432 76.5974135047432,78.1948270094864 103.194827009486,104.132163186446 130.37181214238,127.066081593223 160.18590607119,150 190)
</pre></div><div class="refsection"><a name="idp63008512"></a><h2>関連情報</h2><p>
				<a class="xref" href="#ST_LineInterpolatePoint" title="ST_LineInterpolatePoint">ST_LineInterpolatePoint</a>
				<a class="xref" href="#ST_LineLocatePoint" title="ST_LineLocatePoint">ST_LineLocatePoint</a>
			</p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_LineLocatePoint"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_LineLocatePoint — ポイントに最も近いライン上のポイントの位置を割合で返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float8 <b class="fsfunc">ST_LineLocatePoint</b>(</code>geometry  <var class="pdparam">a_linestring</var>, geometry  <var class="pdparam">a_point</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp63015936"></a><h2>説明</h2><p>ラインストリング上の、与えたポイントへの最短点を、<a class="link" href="#ST_Length2D" title="ST_Length2D">2次元ラインストリング</a>の総延長に対する割合として0から1の区間で返します。</p><p>返された位置は、ポイント(<a class="xref" href="#ST_LineInterpolatePoint" title="ST_LineInterpolatePoint">ST_LineInterpolatePoint</a>)または、部分ラインストリング(<a class="xref" href="#ST_LineSubstring" title="ST_LineSubstring">ST_LineSubstring</a>)の抽出に使用することができます。</p><p>この関数は、住所番号に近づくのに使えます (訳注: 道路方式の住居表示の場合)。</p><p>Availability: 1.1.0</p><p>Changed: 2.1.0 2.0.xまでではST_Line_Locate_Pointと呼んでいました。</p></div><div class="refsection"><a name="idp63019904"></a><h2>例</h2><pre class="programlisting">-- ストリートに沿った、ストリート番号の点の、粗い探索です。
-- なお、foo全体は住居の重心とストリートのように見えるダミーデータです。
-- ST_DWithInで対象とする通りから大きく外れる住居を除外しています。
--Rough approximation of finding the street number of a point along the street
--Note the whole foo thing is just to generate dummy data that looks
--like house centroids and street
--We use ST_DWithin to exclude
--houses too far away from the street to be considered on the street
SELECT ST_AsText(house_loc) As as_text_house_loc,
        startstreet_num +
                CAST( (endstreet_num - startstreet_num)
                        * ST_LineLocatePoint(street_line, house_loc) As integer) As street_num
FROM
(SELECT ST_GeomFromText('LINESTRING(1 2, 3 4)') As street_line,
        ST_Point(x*1.01,y*1.03) As house_loc, 10 As startstreet_num,
                20 As endstreet_num
FROM generate_series(1,3) x CROSS JOIN generate_series(2,4) As y)
As foo
WHERE ST_DWithin(street_line, house_loc, 0.2);

 as_text_house_loc | street_num
-------------------+------------
 POINT(1.01 2.06)  |         10
 POINT(2.02 3.09)  |         15
 POINT(3.03 4.12)  |         20

 -- ポイントまたは他のジオメトリへのライン上の最短点の探索
 SELECT ST_AsText(ST_LineInterpolatePoint(foo.the_line, ST_LineLocatePoint(foo.the_line, ST_GeomFromText('POINT(4 3)'))))
FROM (SELECT ST_GeomFromText('LINESTRING(1 2, 4 5, 6 7)') As the_line) As foo;
   st_astext
----------------
 POINT(3 4)

</pre></div><div class="refsection"><a name="idp63021440"></a><h2>関連情報</h2><p><a class="xref" href="#">???</a>, <a class="xref" href="#ST_Length2D" title="ST_Length2D">ST_Length2D</a>, <a class="xref" href="#ST_LineInterpolatePoint" title="ST_LineInterpolatePoint">ST_LineInterpolatePoint</a>, <a class="xref" href="#ST_LineSubstring" title="ST_LineSubstring">ST_LineSubstring</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_LineSubstring"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_LineSubstring — 二つの割合位置からラインの一部を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_LineSubstring</b>(</code>geometry  <var class="pdparam">a_linestring</var>, float8  <var class="pdparam">startfraction</var>, float8  <var class="pdparam">endfraction</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp61904000"></a><h2>説明</h2><p>与えられた割合位置を開始点と終了点とした、入力ラインの一部を計算します。一つ目の引数はLINESTRINGでなければなりません。二つ目と三つ目の引数は[0, 1]の範囲内で、開始点と終了点の、ライン長に対する割合の位置です。Z値とM値が存在する場合には、追加された終了点に対して補間計算を行います。 </p><p><code class="varname">startfraction</code>と<code class="varname">endfraction</code>が同じ値である場合には、<a class="xref" href="#ST_LineInterpolatePoint" title="ST_LineInterpolatePoint">ST_LineInterpolatePoint</a>と同じになります。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はLINESTRINGに対してのみ動作します。連続するMULTILINESTRINGで使うには、先に<a class="xref" href="#ST_LineMerge" title="ST_LineMerge">ST_LineMerge</a>で結合させます。</p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>1.1.1リリースからは、この関数はM値とZ値を補間します。それより前のリリースでは、Z値とM値は不定値になります。</p></td></tr></table></div><p>Availability: 1.1.0 Z軸とM軸のサポートが1.1.1で追加されました。</p><p>Changed: 2.1.0 2.0.xではST_Line_Substringと呼ばれていました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp63024896"></a><h2>例</h2><div class="informalfigure"><div class="mediaobject"><img src="images/st_line_substring01.png"><div class="caption"><p>中心の1/3区間 (0.333, 0.666) </p></div></div></div><pre class="programlisting">SELECT ST_AsText(ST_LineSubstring( 'LINESTRING(25 50, 100 125, 150 190)', 0.333, 0.666));

                                                                                   st_astext
------------------------------------------------------------------------------------------------
LINESTRING(69.2846934853974 94.2846934853974,100 125,111.700356260683 140.210463138888)
</pre><p>開始点と終了点とが同じ場合には、結果はPOINTになります。 </p><pre class="programlisting">SELECT ST_AsText(ST_LineSubstring( 'LINESTRING(25 50, 100 125, 150 190)', 0.333, 0.333));

                st_astext
------------------------------------------
 POINT(69.2846934853974 94.2846934853974)
</pre><p>LINESTRINGを長さ100以下の断片に分解するクエリ。FORループと同等のものを生成するために<code class="varname">generate_series()</code>とCROSS JOIN LATERALとを併用しています。 </p><pre class="programlisting">WITH data(id, geom) AS (VALUES
        ( 'A', 'LINESTRING( 0 0, 200 0)'::geometry ),
        ( 'B', 'LINESTRING( 0 100, 350 100)'::geometry ),
        ( 'C', 'LINESTRING( 0 200, 50 200)'::geometry )
    )
SELECT id, i,
       ST_AsText( ST_LineSubstring( geom, startfrac, LEAST( endfrac, 1 )) ) AS geom
FROM (
    SELECT id, geom, ST_Length(geom) len, 100 sublen FROM data
    ) AS d
CROSS JOIN LATERAL (
    SELECT i, (sublen * i) / len AS startfrac,
              (sublen * (i+1)) / len AS endfrac
    FROM generate_series(0, floor( len / sublen )::integer ) AS t(i)
    -- skip last i if line length is exact multiple of sublen
    WHERE (sublen * i) / len &lt;&gt; 1.0
    ) AS d2;

 id | i |            geom
----+---+-----------------------------
 A  | 0 | LINESTRING(0 0,100 0)
 A  | 1 | LINESTRING(100 0,200 0)
 B  | 0 | LINESTRING(0 100,100 100)
 B  | 1 | LINESTRING(100 100,200 100)
 B  | 2 | LINESTRING(200 100,300 100)
 B  | 3 | LINESTRING(300 100,350 100)
 C  | 0 | LINESTRING(0 200,50 200)
</pre></div><div class="refsection"><a name="idp63030784"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Length" title="ST_Length">ST_Length</a>, <a class="xref" href="#ST_LineInterpolatePoint" title="ST_LineInterpolatePoint">ST_LineInterpolatePoint</a>, <a class="xref" href="#ST_LineMerge" title="ST_LineMerge">ST_LineMerge</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_LocateAlong"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_LocateAlong — M値に一致するジオメトリ上のポイントを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_LocateAlong</b>(</code>geometry  <var class="pdparam">geom_with_measure</var>, float8  <var class="pdparam">measure</var>, float8  <var class="pdparam">offset = 0</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp63039488"></a><h2>説明</h2><p>M値を持つジオメトリに沿った、与えられたM値に合致する位置を (POINTOまたはMULTIPOINTで)返します。ポリゴン系要素には対応していません。</p><p><code class="varname">offset</code>が与えられた場合には、結果は、入力ラインの左または右に、指定された距離だけ移動します。正のオフセット値で左に、負の値で右にそれぞれ移動します。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数は、M要素を持つジオメトリでのみ使います。</p></td></tr></table></div><p><span class="emphasis"><em>ISO/IEC 13249-3 SQL/MM 空間標準</em></span>で規定されているため、このような意味になります。</p><p>Availability: 1.1.0 それまではST_Locale_Along_Measureでした。 </p><p>Changed: 2.0.0 以前の版ではST_Locate_Along_Measureと呼ばれていました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports M coordinates.</p></div><div class="refsection"><a name="idp63044608"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(
  ST_LocateAlong(
    'MULTILINESTRINGM((1 2 3, 3 4 2, 9 4 3),(1 2 3, 5 4 5))'::geometry,
    3 ));

            st_astext
----------------------------------
 MULTIPOINT M (1 2 3,9 4 3,1 2 3)
</pre></div><div class="refsection"><a name="idp63046144"></a><h2>関連情報</h2><p><a class="xref" href="#ST_LocateBetween" title="ST_LocateBetween">ST_LocateBetween</a>, <a class="xref" href="#ST_LocateBetweenElevations" title="ST_LocateBetweenElevations">ST_LocateBetweenElevations</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_LocateBetween"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_LocateBetween — M値の範囲に合致する部分ジオメトリを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_LocateBetween</b>(</code>geometry  <var class="pdparam">geom</var>, float8  <var class="pdparam">measure_start</var>, float8  <var class="pdparam">measure_end</var>, float8  <var class="pdparam">offset = 0</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp63059584"></a><h2>説明</h2><p>指定された範囲のM値を持つ入力ジオメトリの部分ジオメトリとなるジオメトリ (コレクション)を全て返します。</p><p><code class="varname">offset</code>が与えられた場合には、結果は、入力ラインの左または右に、指定された距離だけ移動します。正のオフセット値で左に、負の値で右にそれぞれ移動します。</p><p>凸でないPOLYGONを抜き出すと不正なジオメトリを返すことがあります。</p><p><span class="emphasis"><em>ISO/IEC 13249-3 SQL/MM 空間標準</em></span>で規定されているため、このような意味になります。</p><p>Availability: 1.1.0 それより前はST_Locate_Between_Measuresでした。 </p><p>Changed: 2.0.0 以前の版ではST_Locate_Between_Measuresと呼ばれていました。</p><p>Enhanced: 3.0.0 - POLYGON, TIN, TRIANGLEへの対応が追加されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports M coordinates.</p></div><div class="refsection"><a name="idp63064960"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(
  ST_LocateBetween(
       'MULTILINESTRING M ((1 2 3, 3 4 2, 9 4 3),(1 2 3, 5 4 5))':: geometry,
       1.5,
       3 ));

                                                         st_asewkt
------------------------------------------------------------------------
 GEOMETRYCOLLECTION M (LINESTRING M (1 2 3,3 4 2,9 4 3),POINT M (1 2 3))
</pre></div><div class="refsection"><a name="idp63066496"></a><h2>関連情報</h2><p><a class="xref" href="#ST_LocateAlong" title="ST_LocateAlong">ST_LocateAlong</a>, <a class="xref" href="#ST_LocateBetweenElevations" title="ST_LocateBetweenElevations">ST_LocateBetweenElevations</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_LocateBetweenElevations"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_LocateBetweenElevations — 標高 (Z値)範囲にある部分ジオメトリを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_LocateBetweenElevations</b>(</code>geometry  <var class="pdparam">geom</var>, float8  <var class="pdparam">elevation_start</var>, float8  <var class="pdparam">elevation_end</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp63074688"></a><h2>説明</h2><p>標高 (Z値)範囲にある部分ジオメトリとなるジオメトリ (コレクション)を返します。</p><p>凸でないPOLYGONを抜き出すと不正なジオメトリを返すことがあります。</p><p>Availability: 1.4.0</p><p>Enhanced: 3.0.0 - POLYGON, TIN, TRIANGLEへの対応が追加されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp63078528"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(
  ST_LocateBetweenElevations(
    'LINESTRING(1 2 3, 4 5 6)'::geometry,
    2, 4 ));

             st_astext
-----------------------------------
 MULTILINESTRING Z ((1 2 3,2 3 4))

SELECT ST_AsText(
    ST_LocateBetweenElevations(
      'LINESTRING(1 2 6, 4 5 -1, 7 8 9)',
      6, 9)) As ewelev;

                                ewelev
-----------------------------------------------------------------------
 GEOMETRYCOLLECTION Z (POINT Z (1 2 6),LINESTRING Z (6.1 7.1 6,7 8 9))
</pre></div><div class="refsection"><a name="idp63080064"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Dump" title="ST_Dump">ST_Dump</a>, <a class="xref" href="#ST_LocateBetween" title="ST_LocateBetween">ST_LocateBetween</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_InterpolatePoint"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_InterpolatePoint — ジオメトリのポイントに最も近いポイント上の補間M値を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float8 <b class="fsfunc">ST_InterpolatePoint</b>(</code>geometry  <var class="pdparam">line</var>, geometry  <var class="pdparam">point</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp63087232"></a><h2>説明</h2><p>指定されたポイントに最も近いジオメトリにおけるジオメトリの補間M値を返します。</p><p>Availability: 2.0.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp63090304"></a><h2>例</h2><pre class="programlisting">SELECT ST_InterpolatePoint('LINESTRING M (0 0 0, 10 0 20)', 'POINT(5 5)');
 st_interpolatepoint
 ---------------------
         10
        </pre></div><div class="refsection"><a name="idp63091584"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AddMeasure" title="ST_AddMeasure">ST_AddMeasure</a>, <a class="xref" href="#ST_LocateAlong" title="ST_LocateAlong">ST_LocateAlong</a>, <a class="xref" href="#ST_LocateBetween" title="ST_LocateBetween">ST_LocateBetween</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_AddMeasure"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AddMeasure — ラインに沿ったM値を補間します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_AddMeasure</b>(</code>geometry  <var class="pdparam">geom_mline</var>, float8  <var class="pdparam">measure_start</var>, float8  <var class="pdparam">measure_end</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp63100160"></a><h2>説明</h2><p>開始点と終了点の間で線形補間したM値を持つ派生ジオメトリを返します。ジオメトリがM値を持たない場合にはM値が追加されます。ジオメトリがM値を持つ場合には新値に置き換えられます。LINESTRINGとMULTILINESTRINGだけに対応しています。</p><p>Availability: 1.5.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp63103104"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(ST_AddMeasure(
ST_GeomFromEWKT('LINESTRING(1 0, 2 0, 4 0)'),1,4)) As ewelev;
           ewelev
--------------------------------
 LINESTRINGM(1 0 1,2 0 2,4 0 4)

SELECT ST_AsText(ST_AddMeasure(
ST_GeomFromEWKT('LINESTRING(1 0 4, 2 0 4, 4 0 4)'),10,40)) As ewelev;
                 ewelev
----------------------------------------
 LINESTRING(1 0 4 10,2 0 4 20,4 0 4 40)

SELECT ST_AsText(ST_AddMeasure(
ST_GeomFromEWKT('LINESTRINGM(1 0 4, 2 0 4, 4 0 4)'),10,40)) As ewelev;
                 ewelev
----------------------------------------
 LINESTRINGM(1 0 10,2 0 20,4 0 40)

SELECT ST_AsText(ST_AddMeasure(
ST_GeomFromEWKT('MULTILINESTRINGM((1 0 4, 2 0 4, 4 0 4),(1 0 4, 2 0 4, 4 0 4))'),10,70)) As ewelev;
                             ewelev
-----------------------------------------------------------------
 MULTILINESTRINGM((1 0 10,2 0 20,4 0 40),(1 0 40,2 0 50,4 0 70))
</pre></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Long_Transactions_Support"></a>8.13. ロングトランザクション機能</h2></div><div><div class="abstract"><div class="abstract-title">概要</div><p>これらの関数は、ロングトランザクション機能のために、行をロックする機構を実装しています。これらは主に<a class="ulink" href="http://www.opengeospatial.org/standards/wfs" target="_top">Web Feature Service</a>仕様を実装する方のために提供されています。</p></div></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#AddAuth">AddAuth</a></span><span class="refpurpose"> — 現在のトランザクションで使用する認可トークンを追加します。</span></dt><dt><span class="refentrytitle"><a href="#CheckAuth">CheckAuth</a></span><span class="refpurpose"> — 認可トークンを基に行の更新と削除とを禁止/許可するためにテーブル上にトリガを生成します。</span></dt><dt><span class="refentrytitle"><a href="#DisableLongTransactions">DisableLongTransactions</a></span><span class="refpurpose"> — ロングトランザクション機能を無効にします。</span></dt><dt><span class="refentrytitle"><a href="#EnableLongTransactions">EnableLongTransactions</a></span><span class="refpurpose"> — ロングトランザクション機能を有効にします。</span></dt><dt><span class="refentrytitle"><a href="#LockRow">LockRow</a></span><span class="refpurpose"> — テーブル内の行にロック/認可を設定します。</span></dt><dt><span class="refentrytitle"><a href="#UnlockRows">UnlockRows</a></span><span class="refpurpose"> — 認可トークンによって保持されているロックをすべて削除します。 </span></dt></dl></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>正しく動作するロック機構のために<span class="bold"><strong>シリアライザブル</strong></span><a class="ulink" href="https://www.postgresql.jp/document/current/html/transaction-iso.html" target="_top">トランザクション分離レベル</a>を使用する必要があります。</p></td></tr></table></div><div class="refentry"><a name="AddAuth"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>AddAuth — 現在のトランザクションで使用する認可トークンを追加します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">AddAuth</b>(</code>text  <var class="pdparam">auth_token</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp63293440"></a><h2>説明</h2><p>現在のトランザクションで使用する認可トークンを追加します。</p><p>現在のトランザクション識別子と認可トークンを<code class="varname">temp_lock_have_table</code>という一時テーブルに追加します。</p><p>Availability: 1.1.3</p></div><div class="refsection"><a name="idp63295744"></a><h2>例</h2><pre class="programlisting">SELECT LockRow('towns', '353', 'priscilla');
                BEGIN TRANSACTION;
                        SELECT AddAuth('joey');
                        UPDATE towns SET geom = ST_Translate(geom,2,2) WHERE gid = 353;
                COMMIT;


                -- エラー --
                ERROR:  UPDATE where "gid" = '353' requires authorization 'priscilla'
                </pre></div><div class="refsection"><a name="idp63297280"></a><h2>関連情報</h2><p><a class="xref" href="#LockRow" title="LockRow">LockRow</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="CheckAuth"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>CheckAuth — 認可トークンを基に行の更新と削除とを禁止/許可するためにテーブル上にトリガを生成します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">CheckAuth</b>(</code>text  <var class="pdparam">a_schema_name</var>, text  <var class="pdparam">a_table_name</var>, text  <var class="pdparam">a_key_column_name</var><code>)</code>;</p><p><code class="funcdef">integer <b class="fsfunc">CheckAuth</b>(</code>text  <var class="pdparam">a_table_name</var>, text  <var class="pdparam">a_key_column_name</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp63320576"></a><h2>説明</h2><p>認可トークンを基に行の更新と削除とを禁止/許可するためにテーブル上にトリガを生成します。&lt;rowid_col&gt;カラムを使って行を特定します。</p><p>a_schema_nameが渡されない場合には、現在のスキーマのテーブルを探索します。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>このテーブルに認証トリガが既に存在している場合には、エラーになります。</p><p>トランザクション機能が無い場合は、例外が投げられます。</p></td></tr></table></div><p>Availability: 1.1.3</p></div><div class="refsection"><a name="idp63323520"></a><h2>例</h2><pre class="programlisting">SELECT CheckAuth('public', 'towns', 'gid');
                        結果
                        ------
                        0
                        </pre></div><div class="refsection"><a name="idp63325056"></a><h2>関連情報</h2><p><a class="xref" href="#EnableLongTransactions" title="EnableLongTransactions">EnableLongTransactions</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="DisableLongTransactions"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>DisableLongTransactions — ロングトランザクション機能を無効にします。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">DisableLongTransactions</b>(</code><code>)</code>;</p></div></div><div class="refsection"><a name="idp63350528"></a><h2>説明</h2><p>ロングトランザクション機能を無効にします。この関数は、トランザクション機能のメタデータテーブルを削除し、ロックチェックテーブルに付けられているすべてのトリガを削除します。</p><p><code class="varname">authorization_table</code>メタデータテーブル、<code class="varname">authorized_tables</code>ビュー、<code class="varname">checkauthtrigger</code>トリガの全てが削除されます。</p><p>Availability: 1.1.3</p></div><div class="refsection"><a name="idp63353472"></a><h2>例</h2><pre class="programlisting">SELECT DisableLongTransactions();
-- 結果 --
Long transactions support disabled
                  </pre></div><div class="refsection"><a name="idp63355008"></a><h2>関連情報</h2><p><a class="xref" href="#EnableLongTransactions" title="EnableLongTransactions">EnableLongTransactions</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="EnableLongTransactions"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>EnableLongTransactions — ロングトランザクション機能を有効にします。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">EnableLongTransactions</b>(</code><code>)</code>;</p></div></div><div class="refsection"><a name="idp63360000"></a><h2>説明</h2><p>ロングトランザクション機能を有効にします。この関数は、必要なメタデータテーブルを生成します。この関数は、この関数以外の本節に挙げられている関数を使う前に、一度呼ぶ必要があります。二度呼んでも無害です。</p><p><code class="varname">authorization_table</code>メタデータテーブル<code class="varname">authorized_tables</code>ビューが生成されます。</p><p>Availability: 1.1.3</p></div><div class="refsection"><a name="idp63362560"></a><h2>例</h2><pre class="programlisting">SELECT EnableLongTransactions();
-- 結果 --
Long transactions support enabled
                  </pre></div><div class="refsection"><a name="idp63364096"></a><h2>関連情報</h2><p><a class="xref" href="#DisableLongTransactions" title="DisableLongTransactions">DisableLongTransactions</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="LockRow"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>LockRow — テーブル内の行にロック/認可を設定します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">LockRow</b>(</code>text  <var class="pdparam">a_schema_name</var>, text  <var class="pdparam">a_table_name</var>, text  <var class="pdparam">a_row_key</var>, text <var class="pdparam">an_auth_token</var>, timestamp <var class="pdparam">expire_dt</var><code>)</code>;</p><p><code class="funcdef">integer <b class="fsfunc">LockRow</b>(</code>text  <var class="pdparam">a_table_name</var>, text  <var class="pdparam">a_row_key</var>, text <var class="pdparam">an_auth_token</var>, timestamp <var class="pdparam">expire_dt</var><code>)</code>;</p><p><code class="funcdef">integer <b class="fsfunc">LockRow</b>(</code>text  <var class="pdparam">a_table_name</var>, text  <var class="pdparam">a_row_key</var>, text <var class="pdparam">an_auth_token</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp63383424"></a><h2>説明</h2><p>テーブル内の指定した行にロック/認可を設定します。<code class="varname">an_auth_token</code>はテキスト値です。<code class="varname">expire_dt</code>は <span class="emphasis"><em>now() + 1 時間</em></span>をデフォルトとするタイムスタンプです。割り当てが行われたなら1が返り、他の場合 (例: 行が他の認可で既にロックされていた)には0が返ります。</p><p>Availability: 1.1.3</p></div><div class="refsection"><a name="idp63386112"></a><h2>例</h2><pre class="programlisting">SELECT LockRow('public', 'towns', '2', 'joey');
LockRow
-------
1

-- Joeyは既にレコードをロックしていて
-- Priscillaはロックできなかっただけにラックが無かったと
SELECT LockRow('public', 'towns', '2', 'priscilla');
LockRow
-------
0

                </pre></div><div class="refsection"><a name="idp63387648"></a><h2>関連情報</h2><p><a class="xref" href="#UnlockRows" title="UnlockRows">UnlockRows</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="UnlockRows"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>UnlockRows — 認可トークンによって保持されているロックをすべて削除します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">UnlockRows</b>(</code>text  <var class="pdparam">auth_token</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp63393408"></a><h2>説明</h2><p>指定した認可トークンによって保持されているロックをすべて削除します。解放されたロックの数を返します。</p><p>Availability: 1.1.3</p></div><div class="refsection"><a name="idp63394944"></a><h2>例</h2><pre class="programlisting">SELECT LockRow('towns', '353', 'priscilla');
                SELECT LockRow('towns', '2', 'priscilla');
                SELECT UnLockRows('priscilla');
                UnLockRows
                ------------
                2
                </pre></div><div class="refsection"><a name="idp63396480"></a><h2>関連情報</h2><p><a class="xref" href="#LockRow" title="LockRow">LockRow</a></p></div></div></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="PostGIS_FAQ"></a>第9章 PostGIS よくある質問</h1></div></div></div><div class="qandaset"><a name="idp68632320"></a><dl><dt>9.1. <a href="#faq_where_tutorials">PostGISでの作業に関するチュートリアル、ガイド、ワークショップはどこにありますか?</a></dt><dt>9.2. <a href="#legacy_faq">PostGIS 1.5で動作していたアプリケーションやデスクトップツールがPostGIS 2.0では動作しなくなりました。解消するにはどうすればよいでしょうか?</a></dt><dt>9.3. <a href="#legacy_faq_gist">osm2pgsqlを使ってOpenStreetMapデータをロードするときに、failed: ERROR: operator class "gist_geometry_ops" does not exist for access method "gist"というエラーが発生しました。PostGIS 1.5では正しく動作していました。</a></dt><dt>9.4. <a href="#legacy_faq_read_view">PostgreSQL 9.0を使っていますが、OpenJump、Safe FME等のツールでジオメトリの読み取りや表示ができなくなってしまいましたが?</a></dt><dt>9.5. <a href="#pgadmin_shows_no_data_in_geom">pgAdminを使ってジオメトリカラムを表示しようとしたら空っぽでした。何か方法はありませんか?</a></dt><dt>9.6. <a href="#idp68723584">どの種類のジオメトリオブジェクトを格納できますか?</a></dt><dt>9.7. <a href="#idp68726272">たいへん混乱しました。ジオメトリとジオグラフィのどちらを使うべきでしょうか?</a></dt><dt>9.8. <a href="#idp68730496">もっとジオグラフィについて聞きたいです。 たとえば、ジオグラフィカラムにデータを入れて合理的な答えが得られる領域範囲はどれぐらいでしょうか、とか。極、全データが半球上になければならないのでしょうか(SQL Server 2008はそう)、速度等の制限はあるのでしょうか、とか。</a></dt><dt>9.9. <a href="#faq_how_to_define_geometry_table">GISオブジェクトをデータベースに挿入するにはどうしますか?</a></dt><dt>9.10. <a href="#idp68740736">空間クエリを作成するにはどうするのですか?</a></dt><dt>9.11. <a href="#idp68748928">大きなテーブルでの空間クエリの速度向上はどうするのですか?</a></dt><dt>9.12. <a href="#idp68755712">なぜPostgreSQLのR木インデクス機能を持たないのですか?</a></dt><dt>9.13. <a href="#idp68759936">なぜ AddGeometryColumn()関数と他のOpsnGIS関数を使うべきなのですか?</a></dt><dt>9.14. <a href="#idp68776192">半径内にあるオブジェクトを全て検索する最善の方法は何ですか?</a></dt><dt>9.15. <a href="#idp68779648">クエリの一部として投影変換を実現するにはどうしますか?</a></dt><dt>9.16. <a href="#idp68782080">ST_AsEWKTとST_AsTextとを、かなり大きいジオメトリで実行すると、空のフィールドが返りました。どうしたら良いですか?</a></dt><dt>9.17. <a href="#idp68825472">ST_Intersectsを使うと、二つのジオメトリがインタセクトしているのが分かっているのに、インタセクトしていないと言います。どうしたら良いですか?</a></dt><dt>9.18. <a href="#license_faq">PostGISを用いたソフトウェアをリリースしています。PostGISのようにGPLライセンスを使う必要があるのでしょうか?PostGISを使うとコードを全て公開しなければならないのでしょうか?</a></dt><dt>9.19. <a href="#overlay_inconsistent">オーバレイ操作と空間述語の結果が時々矛盾するのはなぜですか ?</a></dt></dl><table border="0" style="width: 100%;"><colgroup><col align="left" width="1%"><col></colgroup><tbody><tr class="question"><td align="left" valign="top"><a name="faq_where_tutorials"></a><a name="idp68632960"></a><p><b>9.1.</b></p></td><td align="left" valign="top"><p>PostGISでの作業に関するチュートリアル、ガイド、ワークショップはどこにありますか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>手順ごとのチュートリアルガイドワークショップ<a class="ulink" href="http://postgis.net/workshops/postgis-intro/" target="_top">Introduction to PostGIS</a>があります。OpenGeo Suiteでの作業の入門編だけでなく梱包されたデータもあります。多分PostGISの最善のチュートリアルです。</p><p>BostonGISにも<a class="ulink" href="http://www.bostongis.com/PrinterFriendly.aspx?content_name=postgis_tut01" target="_top">PostGIS almost idiot's guide on getting started</a>があります。Windowsユーザに、より軸足を置いています。</p></td></tr><tr class="question"><td align="left" valign="top"><a name="legacy_faq"></a><a name="idp68693760"></a><p><b>9.2.</b></p></td><td align="left" valign="top"><p>PostGIS 1.5で動作していたアプリケーションやデスクトップツールがPostGIS 2.0では動作しなくなりました。解消するにはどうすればよいでしょうか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>PostGIS 2.0で、多数の非推奨関数がPostGISコードから削除されました。これは、GeoServer, MapServer, QuantumGIS, OpenJump等のサードバーティツールに加えて、アプリケーションにも影響が出ます。これを解決する方法が二つあります。サードパーティアプリケーションの場合は、これらの問題の多くが解決されている最新版にアップグレードしてみることで対応できます。 ご自身のコードの場合は、削除された関数を使わないようにソースを変更することで対応できます。 削除された関数のほとんどは、ST_Unino, ST_Length等のエイリアスで、ST_を取ったものです。最後の手段として<code class="varname">legacy.sql</code>の全体または<code class="varname">legacy.sql</code>の必要な部分をインストールします。</p><p> <code class="varname">legacy.sql</code>ファイルはpostgis.sqlのインストール先と同じフォルダにあります。postgis.sqlとspatial_ref_sys.sqlをインストールした後、このファイルをインストールすると、削除した200余の関数を復帰させられます。</p></td></tr><tr class="question"><td align="left" valign="top"><a name="legacy_faq_gist"></a><a name="idp68697344"></a><p><b>9.3.</b></p></td><td align="left" valign="top"><p>osm2pgsqlを使ってOpenStreetMapデータをロードするときに、failed: ERROR: operator class "gist_geometry_ops" does not exist for access method "gist"というエラーが発生しました。PostGIS 1.5では正しく動作していました。</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>PostGIS 2では、デフォルトのジオメトリ演算子クラスがgist_geometry_opsからgist_geometry_ops_2dに変更され、gist_geometry_opsは完全に削除されました。PostGIS 2は3次元対応のためN次元空間インデクスを導入しました。古い名前は混乱させるものであり、誤称であると考えました。</p><p>古いアプリケーションには、処理の一部として、テーブルやインデクスを生成する際に、明示的に演算子クラス名を参照しているものがありました。デフォルトの2次元インデクスが欲しい場合には重要ではありません。エラーが内容に管理するために、インデクス生成を次に示す悪い例から良い例に変えて下さい。</p><p>悪い例</p><pre class="programlisting">CREATE INDEX idx_my_table_geom ON my_table USING gist(geom gist_geometry_ops);</pre><p>良い例</p><pre class="programlisting">CREATE INDEX idx_my_table_geom ON my_table USING gist(geom);</pre><p>演算子クラスを指定する必要が出るのは、3次元空間が求められる場合です。次のようにします。</p><pre class="programlisting">CREATE INDEX idx_my_super3d_geom ON my_super3d USING gist(geom gist_geometry_ops_nd);</pre><p>不幸にもgist_geometry_opsがハードコーディングされていて変更不可なコンパイルされたコードを突きつけられているなら、PostGIS 2.0.2以上に同梱されている<code class="filename">legacy_gist.sql</code>を使用して、古いクラスを生成することができます。しかしながら、この方法を使う場合は、後ほどインデクスを削除して、演算子クラスを指定せずに再生成させるべきです。将来再びアップデートする必要がある時に泣いてしまうことを抑制します。</p></td></tr><tr class="question"><td align="left" valign="top"><a name="legacy_faq_read_view"></a><a name="idp68703360"></a><p><b>9.4.</b></p></td><td align="left" valign="top"><p>PostgreSQL 9.0を使っていますが、OpenJump、Safe FME等のツールでジオメトリの読み取りや表示ができなくなってしまいましたが?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>PostgreSQL 9.0以上では、byteaデータのデフォルトのエンコーディングがhexに変更されました。古いJDBCドライバはエスケープ形式を仮定しています。古いJDBCドライバを使ったJavaアプリケーションや古いNpgsqlドライバを使った.Netアプリケーションといった、ST_AsBinaryの古い挙動を期待するアプリケーションが影響を受けます。再び動作させるには二つの方法があります。</p><p>JDBCドライバを最新のPostgreSQL 9.0版にアップグレードします。<a class="ulink" href="http://jdbc.postgresql.org/download.html" target="_top">http://jdbc.postgresql.org/download.html</a>からダウンロードできます。</p><p>.Netアプリケーションについては、Npgsql 2.0.11以上を使います。<a class="ulink" href="http://pgfoundry.org/frs/?group_id=1000140" target="_top">http://pgfoundry.org/frs/?group_id=1000140</a>からダウンロードできます。また、<a class="ulink" href="http://fxjr.blogspot.com/2010/11/npgsql-2011-released.html" target="_top">Francisco Figueiredo's NpgSQL 2.0.11 released blog entry</a>に説明があります。</p><p>PostgreSQLドライバのアップグレードが選択できないなら、デフォルトで古い挙動をするようにします。次のようにします。</p><pre class="programlisting">ALTER DATABASE mypostgisdb SET bytea_output='escape';</pre></td></tr><tr class="question"><td align="left" valign="top"><a name="pgadmin_shows_no_data_in_geom"></a><a name="idp68708608"></a><p><b>9.5.</b></p></td><td align="left" valign="top"><p>pgAdminを使ってジオメトリカラムを表示しようとしたら空っぽでした。何か方法はありませんか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>pgAdminは大きなジオメトリを表示しません。ジオメトリカラムがそうなっていないかを確かめる最善の方法は次の通りです。</p><pre class="programlisting">-- 全てのgeomカラムに値が入っている場合にはレコードが返りません
SELECT somefield FROM mytable WHERE geom IS NULL;</pre><pre class="programlisting">-- ジオメトリがどれぐらい大きいかを調べるには
-- ジオメトリカラムの中でジオメトリごとに、それが持つポイントの数を
-- 尋ねるかたちのクエリを実行します
SELECT MAX(ST_NPoints(geom)) FROM sometable;</pre></td></tr><tr class="question"><td align="left" valign="top"><a name="idp68723584"></a><a name="idp68723840"></a><p><b>9.6.</b></p></td><td align="left" valign="top"><p>どの種類のジオメトリオブジェクトを格納できますか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>ポイント、ラインストリング、ポリゴン、マルチポイント、マルチラインストリング、マルチポリゴン、ジオメトリコレクションです。PostGIS 2.0以上では、基本ジオメトリタイプとしてTINと多面体サーフェスも格納できます。これらはOpen GIS Well Known Text形式(XYZ, XYM, XYZM拡張付き)で指定されます。現在サポートされているのは3つのデータ型です。計測に平面座標系を使う標準OGCジオメトリデータ型があります。また、地理座標系を使い、球面または回転楕円体面上の計算を行うジオグラフィデータ型があります。最新のPostGIS空間型群に追加されたのが、ラスタデータの格納と解析に使われるラスタ型です。ラスタ型単独で「よくある質問」を用意しています。詳細については<a class="xref" href="#RT_FAQ" title="第13章 PostGISラスタ よくある質問">13章<i>PostGISラスタ よくある質問</i></a>と<a class="xref" href="#RT_reference" title="第12章 ラスタ リファレンス">12章<i>ラスタ リファレンス</i></a>をご覧ください。</p></td></tr><tr class="question"><td align="left" valign="top"><a name="idp68726272"></a><a name="idp68726528"></a><p><b>9.7.</b></p></td><td align="left" valign="top"><p>たいへん混乱しました。ジオメトリとジオグラフィのどちらを使うべきでしょうか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>短い答: ジオグラフィは長距離の測定をサポートする新しいデータ型ですが、計算速度は現在のところジオメトリの計算より遅いです。ジオグラフィを使う場合は、平面座標系についてあまり多く学習する必要がありません。行うことが距離や長さの計測に限定され、かつ世界中からのデータを持っている場合は、一般的にジオグラフィが最善です。ジオメトリは古いデータ型で、サポートする関数が多く、サードパーティからの多大なサポートが得られます。計算速度も早く、大きなジオメトリでは10倍違います。空間参照系に慣れているか、<a class="link" href="#spatial_ref_sys" title="4.5. 空間参照系">空間参照系 (SRID)</a>が単一で済むような局所的なデータを扱っているか、あるいは、空間処理を多く行う必要がある場合には、ジオメトリが最善です。ご注意: 簡単に二つの型の相互変換を行ってそれぞれの利点を得ることができます。現在サポートされているもの、サポートされていないものについては<a class="xref" href="#PostGIS_TypeFunctionMatrix" title="15.11. PostGIS関数対応マトリクス">「PostGIS関数対応マトリクス」</a>を参照して下さい。 </p><p> 長い答: <a class="xref" href="#PostGIS_GeographyVSGeometry" title="4.3.3. ジオグラフィ型を使用すべき時">「ジオグラフィ型を使用すべき時」</a>と<a class="link" href="#PostGIS_TypeFunctionMatrix" title="15.11. PostGIS関数対応マトリクス">function type matrix</a>とを参照して下さい。 </p></td></tr><tr class="question"><td align="left" valign="top"><a name="idp68730496"></a><a name="idp68730752"></a><p><b>9.8.</b></p></td><td align="left" valign="top"><p>もっとジオグラフィについて聞きたいです。 たとえば、ジオグラフィカラムにデータを入れて合理的な答えが得られる領域範囲はどれぐらいでしょうか、とか。極、全データが半球上になければならないのでしょうか(SQL Server 2008はそう)、速度等の制限はあるのでしょうか、とか。</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>その質問は相当深く複雑で、このセクションで十分に答えられません。<a class="xref" href="#PostGIS_Geography_AdvancedFAQ" title="4.3.4. ジオグラフィに関する高度なよくある質問">「ジオグラフィに関する高度なよくある質問」</a>を参照して下さい。</p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq_how_to_define_geometry_table"></a><a name="idp68733184"></a><p><b>9.9.</b></p></td><td align="left" valign="top"><p>GISオブジェクトをデータベースに挿入するにはどうしますか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>まず、GISデータを保持するために"geometry"または"geogprahy"カラムを持つテーブルを作成します。ジオグラフィデータ型の格納は、ジオメトリデータ型とは若干異なります。ジオグラフィの格納については<a class="xref" href="#PostGIS_Geography" title="4.3. ジオグラフィデータタイプ">「ジオグラフィデータタイプ」</a>を参照して下さい。 </p><p>ジオメトリについては、psqlでデータベースに接続して、次のSQLを試してみて下さい。</p><pre class="programlisting">CREATE TABLE gtest (id serial primary key, name varchar(20), geom geometry(LINESTRING));</pre><p>ジオメトリカラムの追加に失敗する場合は、もしかしたらPostGISの関数とオブジェクトをデータベースにロードしていないか、2.0より前の版のPostGISなのかも知れません。<a class="xref" href="#PGInstall" title="2.2. ソースからのコンパイルとインストール">「ソースからのコンパイルとインストール」</a>を参照して下さい。</p><p>これで、SQLのINSERTステートメントを使って、ジオメトリをテーブルに挿入することができます。GISオブジェクト自体は、OpenGISコンソーシアムの"well-known text"形式を使っています。</p><pre class="programlisting">INSERT INTO gtest (ID, NAME, GEOM)
VALUES (
  1,
  'First Geometry',
  ST_GeomFromText('LINESTRING(2 3,4 5,6 5,7 8)')
);</pre><p>他のGISオブジェクトの詳細については<a class="link" href="#RefObject" title="4.1. 空間データ モデル">object reference</a>をご覧ください。</p><p>テーブル内にあるGISデータを表示するには、次のようにします。</p><pre class="programlisting">SELECT id, name, ST_AsText(geom) AS geom FROM gtest;</pre><p>返り値は次のようなかんじになります。</p><pre class="programlisting">id | name           | geom
----+----------------+-----------------------------
  1 | First Geometry | LINESTRING(2 3,4 5,6 5,7 8)
(1 row)</pre></td></tr><tr class="question"><td align="left" valign="top"><a name="idp68740736"></a><a name="idp68740992"></a><p><b>9.10.</b></p></td><td align="left" valign="top"><p>空間クエリを作成するにはどうするのですか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>他のデータベースクエリを作るのと同じで、返り値、関数、テストのSQLの組み合わせです。</p><p>空間クエリでは、クエリを作成する際に心を平静に保つための重要な二つの問題があります。 一つは、使用することができる空間インデクスがあるか、です。もう一つは、多数のジオメトリを相手に計算量の多い計算を行っているか、です。</p><p>一般的に、フィーチャーのバウンディングボックスがインタセクト (交差)しているかをテストするインタセクト演算子 (&amp;&amp;)を使います。&amp;&amp;演算子が便利な理由は、速度向上のために空間インデクスが付けられているなら、&amp;&amp;演算子は空間インデクスを使うからです。これによって、クエリの速度はとてもとても速くなります。</p><p>また、検索結果をより狭めるために、Distance(), ST_Intersects(), ST_Contains(), ST_Within() などといった空間関数を使うことでしょう。ほとんどの空間クエリは、インデクスのテストと空間関数のテストを含みます。インデクスのテストで返ってくるタプルを、求める条件に<span class="emphasis"><em>合致するかもしれない</em></span>タプルのみとして、タプルの数を制限します。それから、空間関数で確実な条件のテストを行います。</p><pre class="programlisting">SELECT id, geom
FROM thetable
WHERE
  ST_Contains(geom,'POLYGON((0 0, 0 10, 10 10, 10 0, 0 0))');</pre></td></tr><tr class="question"><td align="left" valign="top"><a name="idp68748928"></a><a name="idp68749184"></a><p><b>9.11.</b></p></td><td align="left" valign="top"><p>大きなテーブルでの空間クエリの速度向上はどうするのですか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>大きなテーブルの速いクエリは、空間データベースの<span class="emphasis"><em>レゾンデートル</em></span> (トランザクションサポートもそうですが)で、良いインデクスは重要です。</p><p><code class="varname">geometry</code>カラムを持つテーブルでの空間インデクスの構築は、"CREATE INDEX"を使って、次のようにします。</p><pre class="programlisting">CREATE INDEX [インデクス名] ON [テーブル名] USING GIST ( [ジオメトリカラム] );</pre><p>"USING GIST"オプションによって、サーバにGiST (Generalized Search Tree)インデクスを作るよう指示が渡ります。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>GiSTインデクスは、不可逆であると仮定します。不可逆インデクスの構築には、代理オブジェクト (空間インデクスの場合はバウンディングボックス)を使います。</p></td></tr></table></div><p>PostgreSQLのクエリプランナがインデクスを作るべきかについて合理的な決定を行うよう、十分な情報を確実に持てるようにすべきです。そのために、ジオメトリテーブル上で"gather statistics"を実行しなければなりません。</p><p>PostgreSQL 8.0.x以上では、<span class="command"><strong>VACUUM ANALYZE</strong></span>コマンドを実行するだけです。</p><p>PostgreSQL 7.4.x以下では、<span class="command"><strong>SELECT UPDATE_GEOMETRY_STATS()</strong></span>を実行します。</p></td></tr><tr class="question"><td align="left" valign="top"><a name="idp68755712"></a><a name="idp68755968"></a><p><b>9.12.</b></p></td><td align="left" valign="top"><p>なぜPostgreSQLのR木インデクス機能を持たないのですか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>PostGISの、かつての版では、PostgreSQLのR木インデクスを使っていましたが、0.6版でPostgreSQLのR木は完全に捨てて、R-Tree-over-GiSTスキームによる空間インデクスを提供しています。</p><p>私たちの試験では、R木とGiSTの検索速度は同程度であることが示されています。PostgreSQLのR木には、GISフィーチャーで使うためには好ましくない二つの制限があります (これらの制限は現在のPostgreSQLネイティブのR木実装についてであって、R木一般の話ではありません)。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>PostgreSQLのR木インデクスは、8K以上のサイズのフィーチャーは扱えません。GiSTインデクスはフィーチャー自体の代わりにバウンディングボックスを用いる「不可逆」トリックを使っているので扱うことができます。</p></li><li class="listitem"><p>PostgreSQLのR木インデクスは「NULLセーフ」ではなく、NULLジオメトリを含むジオメトリカラムではインデクス作成に失敗します。</p></li></ul></div></td></tr><tr class="question"><td align="left" valign="top"><a name="idp68759936"></a><a name="idp68760192"></a><p><b>9.13.</b></p></td><td align="left" valign="top"><p>なぜ <code class="varname">AddGeometryColumn()</code>関数と他のOpsnGIS関数を使うべきなのですか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>OpenGIS関数を使いたくないのでしたら、使う必要はありません。単純にジオメトリカラムをCREATEステートメントで定義する古いやり方で作成して下さい。全てのジオメトリはSRIDが-1になり、OpenGISメタデータテーブルは適切に<span class="emphasis"><em>書き込まれません</em></span>。これによって、ほとんどのPostGISベースのアプリケーションでは失敗します。一般的には<code class="varname">AddGeometryColumn()</code>を用いることをお勧めします。</p><p>MapServerは<code class="varname">geometry_columns</code>メタデータを使うアプリケーションのひとつです。踏み込んでいえば、MpaServerはジオメトリカラムのSRIDを使って、正しい地図投影へのフィーチャーの自動投影変換を行います。</p></td></tr><tr class="question"><td align="left" valign="top"><a name="idp68776192"></a><a name="idp68776448"></a><p><b>9.14.</b></p></td><td align="left" valign="top"><p>半径内にあるオブジェクトを全て検索する最善の方法は何ですか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>データベースを最も効果的に使うには、半径検索とバウンディングボックス検索を組み合わせた半径検索を行うのが最も良いです。バウンディングボックス検索で空間インデクスを使用するので、半径検索が適用されるサブセットへのアクセスが早くなります。</p><p><code class="varname">ST_DWithin(geometry, geometry, distance)</code>関数は、インデクス付きの距離検索を実行する手軽な方法です。この関数は、距離半径を十分に含む大きさの検索矩形を作成して、 インデクス付きの結果サブセットに対して確実な距離検索を行います。</p><p>たとえば、POINT(1000 1000)から100メートル内の全てのオブジェクトを見つけるためには、次のクエリで動作します。</p><pre class="programlisting">SELECT * FROM geotable
WHERE ST_DWithin(geocolumn, 'POINT(1000 1000)', 100.0);</pre></td></tr><tr class="question"><td align="left" valign="top"><a name="idp68779648"></a><a name="idp68779904"></a><p><b>9.15.</b></p></td><td align="left" valign="top"><p>クエリの一部として投影変換を実現するにはどうしますか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>投影変換を実行するには、変換前座標系と変換後座標系の両方がSPATIAL_REF_SYSテーブル上に定義されていて、かつ、変換されるジオメトリはSRIDが設定されている必要があります。それが完了していると、投影変換は変換後SRIDを参照する程度の手間で実行できます。次ではジオメトリをNAD 83経度緯度に変換していて、SRIDが未定義を示す-1 (訳注: PostGIS 2以降は0です)に設定されていないなら動作します。</p><pre class="programlisting">SELECT ST_Transform(geom,4269) FROM geotable;</pre></td></tr><tr class="question"><td align="left" valign="top"><a name="idp68782080"></a><a name="idp68782336"></a><p><b>9.16.</b></p></td><td align="left" valign="top"><p>ST_AsEWKTとST_AsTextとを、かなり大きいジオメトリで実行すると、空のフィールドが返りました。どうしたら良いですか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>pgAdminまたは大きなテキストを表示しないその他のツールを使用しているのかも知れません。 ジオメトリが十分に大きい場合、ツールには空として表示されます。本当にWKTで見たり出力したりしなければならない場合は、PSQLを使用して下さい。</p><pre class="programlisting">-- ジオメトリが本当に存在しない行数の確認
                                SELECT count(gid) FROM geotable WHERE geom IS NULL;</pre></td></tr><tr class="question"><td align="left" valign="top"><a name="idp68825472"></a><a name="idp68825728"></a><p><b>9.17.</b></p></td><td align="left" valign="top"><p>ST_Intersectsを使うと、二つのジオメトリがインタセクトしているのが分かっているのに、インタセクトしていないと言います。どうしたら良いですか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>二つの場合がよくあります。一つは、ジオメトリが不正な場合です。<a class="xref" href="#">???</a>で確認できます。もう一つは、ST_AsTextで数字を切り捨てていて、表示されている分より後にたくさんの小数が付いている場合です。</p></td></tr><tr class="question"><td align="left" valign="top"><a name="license_faq"></a><a name="idp68828160"></a><p><b>9.18.</b></p></td><td align="left" valign="top"><p>PostGISを用いたソフトウェアをリリースしています。PostGISのようにGPLライセンスを使う必要があるのでしょうか?PostGISを使うとコードを全て公開しなければならないのでしょうか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>ほぼ確実に違います。 例として、Linux上で動作するOracleを考えてみます。 LinuxはGPLでOracleは違いますが、Linuxで動作するOracleはGPLで配布しなければならないでしょうか?違います。あなたのソフトウェアはPostgreSQL/PostGISデータベースを好きなだけ使うことができ、ライセンスは好きなようにできます。</p><p>PostGISソースコードに変更を加えて、変更したPostGISを配布したときだけは例外です。この場合、変更したPostGISのコードを共有しなければなりません (PostGIS上で動作するアプリケーションのコードではありません)。この限られた場合でも、ソースコードはバイナリの配布相手にだけ配布します。GPLはソースコードの<span class="emphasis"><em>公開</em></span>までは求めておらず、バイナリを配布した相手との共有を求めています。</p><p>CGALを使った関数とともにPostGISを使ってでも、このことに違いはありません。CGALのライセンスの一つにGPLがありますが、PostGISの全てが既にGPLですので、CGALによってPostGISの元々のライセンスよりも厳しくなることはありません。</p></td></tr><tr class="question"><td align="left" valign="top"><a name="overlay_inconsistent"></a><a name="idp68831360"></a><p><b>9.19.</b></p></td><td align="left" valign="top"><p>オーバレイ操作と空間述語の結果が時々矛盾するのはなぜですか ?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>これは次のように特定のケースとして表せます。 </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>なぜ<code class="varname">ST_Contains( A, ST_Intersection(A, B) )</code>がFALSEになるのですか ?</p></li><li class="listitem"><p>なぜ<code class="varname">ST_Contains( ST_Union(A, B), A ) )</code>がFALSEになるのですか ?</p></li><li class="listitem"><p>なぜ<code class="varname">ST_Union( A, ST_Difference(A, B) )</code>とAが同じにならないのですか ?</p></li><li class="listitem"><p>なぜ<code class="varname">ST_Difference(A, B)</code>が<code class="varname">B</code>とインタセクトしないのでしょうか ?</p></li></ul></div><p>これは、PostGISが有限精度の浮動小数点数を使ってジオメトリを表現し、操作を実行しているためです。このため、実数を使う計算で錯覚を引き起こしますが、錯覚にすぎません、必然的に、不正確の小さい問題が発生するため、異なる操作の結果の間で若干矛盾することになります。 </p><p>さらに、PostGISの操作には、エラー回避コードが含まれていて、そのコードは、堅牢性エラーを防ぐために少量で入力ジオメトリを混乱させることがあります。これらの小さな変更でも、完全な一貫性を持たない結果を算出する原因となりえます。 </p><p>結果の差は、常に、ごく小さいものです。しかし、オーバレイ結果を比較する時に、クエリは正確に矛盾が無いことを前提にすべきではありません。代わりに、幾何的比較で面積や距離の許容値を使用することを検討して下さい。 </p></td></tr></tbody></table></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="Topology"></a>第10章 トポロジ</h1></div></div></div><div class="toc"><div class="toc-title">目次</div><dl class="toc"><dt><span class="sect1"><a href="#Topology_Types">10.1. トポロジ型</a></span></dt><dt><span class="sect1"><a href="#Topology_Domains">10.2. トポロジドメイン</a></span></dt><dt><span class="sect1"><a href="#Topology_ManagementFunctions">10.3. トポロジ管理とTopoGeometry管理</a></span></dt><dt><span class="sect1"><a href="#Topology_StatsManagement">10.4. トポロジ統計管理</a></span></dt><dt><span class="sect1"><a href="#Topology_Constructors">10.5. トポロジコンストラクタ</a></span></dt><dt><span class="sect1"><a href="#Topology_Editing">10.6. トポロジエディタ</a></span></dt><dt><span class="sect1"><a href="#Topology_Accessors">10.7. トポロジアクセサ</a></span></dt><dt><span class="sect1"><a href="#Topology_Processing">10.8. トポロジ処理</a></span></dt><dt><span class="sect1"><a href="#TopoGeometry_Constructors">10.9. TopoGeometryコンストラクタ</a></span></dt><dt><span class="sect1"><a href="#TopoGeometry_Editors">10.10. TopoGeometryエディタ</a></span></dt><dt><span class="sect1"><a href="#TopoGeom_Accessors">10.11. TopoGeometryアクセサ</a></span></dt><dt><span class="sect1"><a href="#TopoGeometry_Outputs">10.12. TopoGeometry出力</a></span></dt><dt><span class="sect1"><a href="#Topology_Relationships">10.13. トポロジ空間関係関数</a></span></dt></dl></div><p>PostGISトポロジ型と関数は、フェイス、エッジ、ノード等のトロポジオブジェクトを管理するために使います。 </p><p>PostGIS Day Paris 2011におけるSandro Santilliさんの講演が、PostGISトポロジの概略説明として良いです。<a class="ulink" href="http://strk.keybit.net/projects/postgis/Paris2011_TopologyWithPostGIS_2_0.pdf" target="_top">Topology with PostGIS 2.0 slide deck</a>にあります。</p><p>Vincent Picavetさんはトポロジとは何か、どのように使われるか、および、対応するFOSS4Gツールに関する良い概略説明を<a class="ulink" href="https://github.com/Oslandia/presentations/blob/master/pgconf_eu_2012/pgconfeu2012_vincent_picavet_postgis_topology.pdf?raw=true" target="_top">PostGIS Topology PGConf EU 2012</a>で出しています。</p><p>トポロジベースのGISデータベースの例として<a class="ulink" href="https://www.census.gov/geo/maps-data/data/tiger.html" target="_top">US Census Topologically Integrated Geographic Encoding and Referencing System (TIGER)</a>があります。PostGISトポロジの試験がしたくて、何らかのデータが必要なら<a class="xref" href="#Topology_Load_Tiger" title="Topology_Load_Tiger">Topology_Load_Tiger</a>をご覧下さい</p><p>PostGISトポロジモジュールは前の版にもありましたが、正式なPostGIS文書の中には入れていませんでした。PostGIS 2.0.0 では、全ての非推奨関数を無くし、知られていた使いやすさの問題を解決し、機能と関数の文書をより良くし、新しい関数を追加し、SQL-MM標準により準拠させるために、大整理を行っています。</p><p>このプロジェクトの詳細情報は<a class="ulink" href="http://trac.osgeo.org/postgis/wiki/UsersWikiPostgisTopology" target="_top">PostGIS Topology Wiki</a>にあります。</p><p>このモジュールに関する全ての関数とテーブルは、<code class="varname">topology</code>スキーマにインストールされます。</p><p>SQL/MM標準で定義される関数はST_プリフィクスを持ち、PostGIS特有の関数はこのプリフィクスを持ちません。</p><p>PostGIS 2.0以降では、トポロジ機能はデフォルトでビルドされます。<a class="xref" href="#postgis_installation" title="第2章 PostGISインストール">2章<i>PostGISインストール</i></a>で説明されている通り、ビルド時のコンフィギュアオプション --without-topology を指定することで、無効にできます。</p><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Topology_Types"></a>10.1. トポロジ型</h2></div><div><div class="abstract"><div class="abstract-title">概要</div><p>本節では、PostGISトポロジでインストールされるPostgreSQLデータ型の一覧を挙げます。独自に関数をデザインする際に特に重要となる、キャストでの挙動を記述していることにご注意ください。 </p></div></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#getfaceedges_returntype">getfaceedges_returntype</a></span><span class="refpurpose"> — 順序番号とエッジ番号で構成される複合型。 </span></dt><dt><span class="refentrytitle"><a href="#topogeometry">TopoGeometry</a></span><span class="refpurpose"> — トポロジとして定義されたジオメトリを表現する型です。</span></dt><dt><span class="refentrytitle"><a href="#validatetopology_returntype">validatetopology_returntype</a></span><span class="refpurpose"> — エラーメッセージとエラーの場所を示すid1とid2からなる複合型です。これは<code class="varname">ValidateTopology</code>が返す型です。</span></dt></dl></div><div class="refentry"><a name="getfaceedges_returntype"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>getfaceedges_returntype — 順序番号とエッジ番号で構成される複合型。 </p></div><div class="refsection"><a name="idp68952832"></a><h2>説明</h2><p>順序番号とエッジ番号で構成される複合型。これは<code class="varname">ST_GetFaceEdges</code>と<code class="varname">GetNodeEdges</code>の返り値の型です。 </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><code class="varname">sequence</code> (整数): トポロジスキーマとSRIDを定義するtopology.topologyテーブルで定義されるトポロジへの参照です。</p></li><li class="listitem"><p><code class="varname">edge</code> (整数): エッジの識別番号です。</p></li></ol></div></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="topogeometry"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>TopoGeometry — トポロジとして定義されたジオメトリを表現する型です。</p></div><div class="refsection"><a name="idp68959104"></a><h2>説明</h2><p>特定のトポロジレイヤ内のトポロジジオメトリを参照する複合型で、特定のタイプと特定のIDを持ちます。TopoGeometryの要素はtopology_id, layer_id, id integer, type integerの各属性です。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><code class="varname">topology_id</code> (整数): トポロジスキーマとSRIDを定義するtopology.topologyテーブルで定義されているトポロジへの参照です。</p></li><li class="listitem"><p><code class="varname">layer_id</code> (整数): TopoGeometryが属するlayersテーブルにおけるlayer_idです。topology_idとlayer_idとの組み合わせで、topology.layersテーブルを一意に参照できます。</p></li><li class="listitem"><p><code class="varname">id</code> (整数): それぞれのトポロジでTopoGeometryを一意にするための順序整数で、自動生成されます。</p></li><li class="listitem"><p><code class="varname">type</code> (1から4の整数でジオメトリタイプを定義): 1:[multi]point, 2:[multi]line, 3:[multi]poly, 4:collectionとなります。</p></li></ol></div></div><div class="refsection"><a name="idp68964992"></a><h2>キャストの挙動</h2><p>本節では、このデータ型で許容される明示的なキャストと自動キャストの一覧を挙げます。</p><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col><col></colgroup><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">キャスト先</td><td style="border-bottom: 1px solid ; ">挙動</td></tr><tr><td style="border-right: 1px solid ; ">geometry</td><td style="">自動</td></tr></tbody></table></div></div><div class="refsection"><a name="idp68970368"></a><h2>関連情報</h2><p><a class="xref" href="#CreateTopoGeom" title="CreateTopoGeom">CreateTopoGeom</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="validatetopology_returntype"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>validatetopology_returntype — エラーメッセージとエラーの場所を示すid1とid2からなる複合型です。これは<code class="varname">ValidateTopology</code>が返す型です。</p></div><div class="refsection"><a name="idp68973696"></a><h2>説明</h2><p>エラーメッセージと二つの整数からなる複合型です。<a class="xref" href="#ValidateTopology" title="ValidateTopology">ValidateTopology</a>関数は、これの集合を返します。評価エラーを示し、id1とid2でエラーを含むトポロジオブジェクトの識別番号を示します。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><code class="varname">error</code> (varchar): エラーのタイプを示します。 </p><p>現在のエラー記述: coincident nodes (訳注: ノード重複), edge crosses node (訳注: エッジとノードのクロス), edge not simple (訳注: 単純でないエッジ), edge end node geometry mis-match (訳注: 終了ノードジオメトリの不整合), edge start node geometry mismatch (訳注: 開始ノードジオメトリの不整合), face overlaps face (訳注: フェイス同士のオーバラップ), face within face (訳注: フェイス間の包含) </p></li><li class="listitem"><p><code class="varname">id1</code> (整数): エラーを持つエッジ/フェイス/ノードの識別番号を示します。</p></li><li class="listitem"><p><code class="varname">id2</code> (整数): 2オブジェクトでのエラーにおける二つ目のエッジ/ノードの識別番号を示します。</p></li></ol></div></div><div class="refsection"><a name="idp68983680"></a><h2>関連情報</h2><p><a class="xref" href="#ValidateTopology" title="ValidateTopology">ValidateTopology</a></p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Topology_Domains"></a>10.2. トポロジドメイン</h2></div><div><div class="abstract"><div class="abstract-title">概要</div><p>本節では、PostGISトポロジでインストールされるPostgreSQLドメインの一覧を挙げます。ドメインは、オブジェクト型のように扱え、関数やテーブルカラムのオブジェクトを返します。ドメインは存在するチェック制約を持つ既存の型である点で、型とは違います。 </p></div></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#topoelement">TopoElement</a></span><span class="refpurpose"> — 二つの整数の配列で、通常TopoGeometry要素を識別するために使われます。</span></dt><dt><span class="refentrytitle"><a href="#topoelementarray">TopoElementArray</a></span><span class="refpurpose"> — TopoElementオブジェクトの配列</span></dt></dl></div><div class="refentry"><a name="topoelement"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>TopoElement — 二つの整数の配列で、通常TopoGeometry要素を識別するために使われます。</p></div><div class="refsection"><a name="idp68988672"></a><h2>説明</h2><p>二つの整数の配列で、単純または階層を持つ<a class="xref" href="#topogeometry" title="TopoGeometry">TopoGeometry</a>の一つのコンポーネントを表現するために使われます。 </p><p>単純なTopoGeometryの場合は、配列の最初の要素がトポロジのプリミティブの識別を表現し、二つ目の要素がタイプ (1:ノード 2:エッジ, 3:フェイス)を表現します。階層的なTopoGeometryの場合は、一つ目の要素が子のTopoGeometryの識別子を表現し、二つ目の要素はレイヤ識別子を表現します。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>階層的なTopoGeometryについては、全ての子のTopoGeometry要素は同じ子レイヤから来ます。子レイヤは、定義されたTopoGeometryのレイヤのtopology.layerレコード内で指定されます。 </p></td></tr></table></div></div><div class="refsection"><a name="idp68991104"></a><h2>例</h2><pre class="programlisting">SELECT te[1] AS id, te[2] AS type FROM
( SELECT ARRAY[1,2]::topology.topoelement AS te ) f;
 id | type
----+------
  1 |    2
                 </pre><pre class="programlisting">SELECT ARRAY[1,2]::topology.topoelement;
  te
-------
 {1,2}
                 </pre><pre class="programlisting">-- 3要素配列をtopoelementに使った際に発生するエラーの例
-- ご注意: topoelementは、必ず2要素を持ちます。次元チェックにひっかかります。
SELECT ARRAY[1,2,3]::topology.topoelement;
ERROR:  value for domain topology.topoelement violates check constraint "dimensions"
                 </pre></div><div class="refsection"><a name="idp68993664"></a><h2>関連情報</h2><p><a class="xref" href="#GetTopoGeomElements" title="GetTopoGeomElements">GetTopoGeomElements</a>, <a class="xref" href="#topoelementarray" title="TopoElementArray">TopoElementArray</a>, <a class="xref" href="#topogeometry" title="TopoGeometry">TopoGeometry</a>, <a class="xref" href="#TopoGeom_addElement" title="TopoGeom_addElement">TopoGeom_addElement</a>, <a class="xref" href="#TopoGeom_remElement" title="TopoGeom_remElement">TopoGeom_remElement</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="topoelementarray"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>TopoElementArray — TopoElementオブジェクトの配列</p></div><div class="refsection"><a name="idp68998272"></a><h2>説明</h2><p>1以上のTopoElementオブジェクトの配列で、通常はTopoGeometryオブジェクトのコンポーネントを分配するために使われます。</p></div><div class="refsection"><a name="idp68999424"></a><h2>例</h2><pre class="programlisting">SELECT '{{1,2},{4,3}}'::topology.topoelementarray As tea;
  tea
-------
{{1,2},{4,3}}

-- より長く書いた等価なもの --
SELECT ARRAY[ARRAY[1,2], ARRAY[4,3]]::topology.topoelementarray As tea;

  tea
-------
{{1,2},{4,3}}

-- トポロジに同梱されている配列集約関数 --
SELECT topology.TopoElementArray_Agg(ARRAY[e,t]) As tea
  FROM generate_series(1,4) As e CROSS JOIN generate_series(1,3) As t;
  tea
--------------------------------------------------------------------------
{{1,1},{1,2},{1,3},{2,1},{2,2},{2,3},{3,1},{3,2},{3,3},{4,1},{4,2},{4,3}}
                 </pre><pre class="programlisting">SELECT '{{1,2,4},{3,4,5}}'::topology.topoelementarray As tea;
ERROR:  value for domain topology.topoelementarray violates check constraint "dimensions"
                 </pre></div><div class="refsection"><a name="idp69001472"></a><h2>関連情報</h2><p><a class="xref" href="#topoelement" title="TopoElement">TopoElement</a>, <a class="xref" href="#GetTopoGeomElementArray" title="GetTopoGeomElementArray">GetTopoGeomElementArray</a>, <a class="xref" href="#TopoElementArray_Agg" title="TopoElementArray_Agg">TopoElementArray_Agg</a> </p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Topology_ManagementFunctions"></a>10.3. トポロジ管理とTopoGeometry管理</h2></div><div><div class="abstract"><div class="abstract-title">概要</div><p>本節では、新しいトポロジスキーマの構築、トポロジの評価、TopoGeometryカラムの管理のためのトポロジ関数の一覧を挙げます。</p></div></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#AddTopoGeometryColumn">AddTopoGeometryColumn</a></span><span class="refpurpose"> — 既存のテーブルにTopoGeometryカラムを追加し、topology.layer内に新しいレイヤとして新しいカラムを登録して、新しい layer_id を返します。</span></dt><dt><span class="refentrytitle"><a href="#DropTopology">DropTopology</a></span><span class="refpurpose"> — 使用上の注意: この関数によって、トポロジスキーマが削除され、topology.topologyテーブルからの参照が削除され、geometry_columnsテーブルから削除対象スキーマ内のテーブルへの参照が削除されます。</span></dt><dt><span class="refentrytitle"><a href="#DropTopoGeometryColumn">DropTopoGeometryColumn</a></span><span class="refpurpose"> — <code class="varname">schema_name</code>で指定されたスキーマ内にある<code class="varname">table_name</code>で指定されたテーブルからTopoGeometryカラムを削除し、topology.layerテーブルにある登録を解除します。</span></dt><dt><span class="refentrytitle"><a href="#Populate_Topology_Layer">Populate_Topology_Layer</a></span><span class="refpurpose"> — テーブルからメタデータを読み、topology.layerテーブルに不足しているものを追加します。</span></dt><dt><span class="refentrytitle"><a href="#TopologySummary">TopologySummary</a></span><span class="refpurpose"> — トポロジ名を取り、トポロジ内のオブジェクトの型に関する概要の全体を提供します。</span></dt><dt><span class="refentrytitle"><a href="#ValidateTopology">ValidateTopology</a></span><span class="refpurpose"> — トポロジの問題についての詳細を示すvalidatetopology_returntypeの集合を返します。</span></dt><dt><span class="refentrytitle"><a href="#ValidateTopologyRelation">ValidateTopologyRelation</a></span><span class="refpurpose"> — 不正なトポロジ関係の行に関する情報を返します。</span></dt><dt><span class="refentrytitle"><a href="#FindTopology">FindTopology</a></span><span class="refpurpose"> — 異なる方法でトポロジ行を返します。</span></dt></dl></div><div class="refentry"><a name="AddTopoGeometryColumn"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>AddTopoGeometryColumn — 既存のテーブルにTopoGeometryカラムを追加し、topology.layer内に新しいレイヤとして新しいカラムを登録して、新しい layer_id を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">AddTopoGeometryColumn</b>(</code>varchar  <var class="pdparam">topology_name</var>, varchar  <var class="pdparam">schema_name</var>, varchar  <var class="pdparam">table_name</var>, varchar  <var class="pdparam">column_name</var>, varchar  <var class="pdparam">feature_type</var><code>)</code>;</p><p><code class="funcdef">integer <b class="fsfunc">AddTopoGeometryColumn</b>(</code>varchar  <var class="pdparam">topology_name</var>, varchar  <var class="pdparam">schema_name</var>, varchar  <var class="pdparam">table_name</var>, varchar  <var class="pdparam">column_name</var>, varchar  <var class="pdparam">feature_type</var>, integer  <var class="pdparam">child_layer</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69021568"></a><h2>説明</h2><p>それぞれのTopoGeometryオブジェクトは、特定のトポロジの特定のレイヤに属します。TopoGeometryオブジェクト生成の前に、トポロジレイヤの生成が必要です。トポロジレイヤは地物テーブルとトポロジとで組織されます。また、タイプと階層の情報を持ちます。レイヤの生成にはAddTopoGeometryColumn()を使います。 </p><p>この関数は、リクエストされたカラムをテーブルに追加し、topology.layerテーブルに、与えられた全ての情報のレコードを追加します。</p><p>[child_layer]を指定しない (またはNULLを指定する)場合、このレイヤは、基本的なTopoGeometry (プリミティブなトポロジ要素で構成)を含みます。指定する場合、このレイヤは階層的なTopoGeometry (child_layerからのTopoGeometryで構成)を持ちます。</p><p>レイヤが生成される (これの識別番号は、AddTopoGeometryColumn関数が返します)と、TopoGeometryオブジェクトをこの中に構築する準備ができます。</p><p>妥当な<code class="varname">feature_type</code>は、POINT, LINE, POLYGON, COLLECTIONです。</p><p>Availability: 1.?</p></div><div class="refsection"><a name="idp69025280"></a><h2>例</h2><pre class="programlisting">-- この例では、topology_nameとshecma_nameが異なる場合には、
-- 異なるスキーマに作ることができましたが、
-- ma_topoスキーマに新しいテーブルを作ったことに注意して下さい。

CREATE SCHEMA ma;
CREATE TABLE ma.parcels(gid serial, parcel_id varchar(20) PRIMARY KEY, address text);
SELECT topology.AddTopoGeometryColumn('ma_topo', 'ma', 'parcels', 'topo', 'POLYGON');</pre><pre class="programlisting">CREATE SCHEMA ri;
CREATE TABLE ri.roads(gid serial PRIMARY KEY, road_name text);
SELECT topology.AddTopoGeometryColumn('ri_topo', 'ri', 'roads', 'topo', 'LINE');
</pre></div><div class="refsection"><a name="idp69027328"></a><h2>関連情報</h2><p><a class="xref" href="#DropTopoGeometryColumn" title="DropTopoGeometryColumn">DropTopoGeometryColumn</a>, <a class="xref" href="#toTopoGeom" title="toTopoGeom">toTopoGeom</a>, <a class="xref" href="#CreateTopology" title="CreateTopology">CreateTopology</a>, <a class="xref" href="#CreateTopoGeom" title="CreateTopoGeom">CreateTopoGeom</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="DropTopology"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>DropTopology — 使用上の注意: この関数によって、トポロジスキーマが削除され、topology.topologyテーブルからの参照が削除され、geometry_columnsテーブルから削除対象スキーマ内のテーブルへの参照が削除されます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">DropTopology</b>(</code>varchar  <var class="pdparam">topology_schema_name</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69046656"></a><h2>説明</h2><p>トポロジスキーマを削除し、topology.topologyテーブルからの参照を削除し、geometry_columnsテーブルから削除対象スキーマ内のテーブルへの参照を削除します。この関数は *十分に注意してご使用下さい*。残しておきたかったデータが破壊される可能性があります。スキーマが存在しない場合、スキーマへの参照に関するエントリの削除だけを行います。</p><p>Availability: 1.?</p></div><div class="refsection"><a name="idp69048448"></a><h2>例</h2><p>ma_topoスキーマをカスケード削除し、topology.topologyにある参照のうち関係するものを全て削除します。</p><pre class="programlisting">SELECT topology.DropTopology('ma_topo');</pre></div><div class="refsection"><a name="idp69050368"></a><h2>関連情報</h2><p><a class="xref" href="#DropTopoGeometryColumn" title="DropTopoGeometryColumn">DropTopoGeometryColumn</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="DropTopoGeometryColumn"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>DropTopoGeometryColumn — <code class="varname">schema_name</code>で指定されたスキーマ内にある<code class="varname">table_name</code>で指定されたテーブルからTopoGeometryカラムを削除し、topology.layerテーブルにある登録を解除します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">DropTopoGeometryColumn</b>(</code>varchar  <var class="pdparam">schema_name</var>, varchar  <var class="pdparam">table_name</var>, varchar  <var class="pdparam">column_name</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69058816"></a><h2>説明</h2><p><code class="varname">schema_name</code>で指定されたスキーマ内にある<code class="varname">table_name</code>で指定されたテーブルからTopoGeometryカラムを削除し、topology.layerテーブルにある登録を解除します。削除の概要報告を返します。ご注意: この関数は、参照整合性チェックをすり抜けるために、まずNULL値に上書きしてから削除します。</p><p>Availability: 1.?</p></div><div class="refsection"><a name="idp69061248"></a><h2>例</h2><pre class="programlisting">SELECT topology.DropTopoGeometryColumn('ma_topo', 'parcel_topo', 'topo');</pre></div><div class="refsection"><a name="idp69062784"></a><h2>関連情報</h2><p><a class="xref" href="#AddTopoGeometryColumn" title="AddTopoGeometryColumn">AddTopoGeometryColumn</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="Populate_Topology_Layer"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Populate_Topology_Layer — テーブルからメタデータを読み、topology.layerテーブルに不足しているものを追加します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">setof record <b class="fsfunc">Populate_Topology_Layer</b>(</code><code>)</code>;</p></div></div><div class="refsection"><a name="idp69072000"></a><h2>説明</h2><p>テーブルの制約を読み、<code class="varname">topology.layer</code>テーブルに不足しているものを追加します。トポロジデータをスキーマに格納した後に、トポロジカタログで抜けているものを訂正するのに使います。</p><p>生成されたもののリストを返します。返されるカラムは <code class="varname">schema_name</code>, <code class="varname">table_name</code>, <code class="varname">feature_column</code>です。</p><p>Availability: 2.3.0</p></div><div class="refsection"><a name="idp69075712"></a><h2>例</h2><pre class="programlisting">SELECT CreateTopology('strk_topo');
CREATE SCHEMA strk;
CREATE TABLE strk.parcels(gid serial, parcel_id varchar(20) PRIMARY KEY, address text);
SELECT topology.AddTopoGeometryColumn('strk_topo', 'strk', 'parcels', 'topo', 'POLYGON');
-- この地物はすでに登録されているので返されるレコードはありません
SELECT *
  FROM topology.Populate_Topology_Layer();

-- 再構築してみます
TRUNCATE TABLE topology.layer;

SELECT *
  FROM topology.Populate_Topology_Layer();

SELECT topology_id,layer_id, schema_name As sn, table_name As tn, feature_column As fc
FROM topology.layer;

                                </pre><pre class="screen">schema_name | table_name | feature_column
-------------+------------+----------------
 strk        | parcels    | topo
(1 row)

 topology_id | layer_id |  sn  |   tn    |  fc
-------------+----------+------+---------+------
           2 |        2 | strk | parcels | topo
(1 row)</pre></div><div class="refsection"><a name="idp69077760"></a><h2>関連情報</h2><p><a class="xref" href="#AddTopoGeometryColumn" title="AddTopoGeometryColumn">AddTopoGeometryColumn</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="TopologySummary"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>TopologySummary — トポロジ名を取り、トポロジ内のオブジェクトの型に関する概要の全体を提供します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">TopologySummary</b>(</code>varchar  <var class="pdparam">topology_schema_name</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69083648"></a><h2>説明</h2><p>トポロジ名を取り、トポロジ内のオブジェクトの型に関する概要の全体を提供します。</p><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp69085568"></a><h2>例</h2><pre class="programlisting">SELECT topology.topologysummary('city_data');
                    topologysummary
--------------------------------------------------------
 Topology city_data (329), SRID 4326, precision: 0
 22 nodes, 24 edges, 10 faces, 29 topogeoms in 5 layers
 Layer 1, type Polygonal (3), 9 topogeoms
  Deploy: features.land_parcels.feature
 Layer 2, type Puntal (1), 8 topogeoms
  Deploy: features.traffic_signs.feature
 Layer 3, type Lineal (2), 8 topogeoms
  Deploy: features.city_streets.feature
 Layer 4, type Polygonal (3), 3 topogeoms
  Hierarchy level 1, child layer 1
  Deploy: features.big_parcels.feature
 Layer 5, type Puntal (1), 1 topogeoms
  Hierarchy level 1, child layer 2
  Deploy: features.big_signs.feature</pre></div><div class="refsection"><a name="idp69087104"></a><h2>関連情報</h2><p><a class="xref" href="#Topology_Load_Tiger" title="Topology_Load_Tiger">Topology_Load_Tiger</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ValidateTopology"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ValidateTopology — トポロジの問題についての詳細を示すvalidatetopology_returntypeの集合を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">setof validatetopology_returntype <b class="fsfunc">ValidateTopology</b>(</code>varchar  <var class="pdparam">toponame</var>, geometry <var class="pdparam">bbox</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69106304"></a><h2>説明</h2><p>トポロジの問題の詳細説明に関する<a class="xref" href="#validatetopology_returntype" title="validatetopology_returntype">validatetopology_returntype</a>オブジェクトを返します。任意に<code class="varname">bbox</code>パラメータで指定された範囲に確認を制限します。 </p><p>ありえるエラーと返されたIDが表現するものの一覧は次の通りです。</p><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col><col><col></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">Error</th><th style="border-right: 1px solid ; border-bottom: 1px solid ; ">id1</th><th style="border-bottom: 1px solid ; ">id2</th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">coincident nodes (訳注: 重複ノード)</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">node_id</td><td style="border-bottom: 1px solid ; ">null</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">edge crosses node (訳注: エッジとノードのクロス)</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">edge_id</td><td style="border-bottom: 1px solid ; ">node_id</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">invalid edge (訳注: 不正なエッジ)</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">edge_id</td><td style="border-bottom: 1px solid ; ">null</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">edge not simple (訳注: 単純でないエッジ)</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">edge_id</td><td style="border-bottom: 1px solid ; ">null</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">edge crosses edge (訳注: エッジとエッジのクロス)</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">edge_id</td><td style="border-bottom: 1px solid ; ">edge_id</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">edge start node geometry mis-match (訳注: 開始ノードジオメトリの不整合)</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">edge_id</td><td style="border-bottom: 1px solid ; ">node_id</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">edge end node geometry mis-match (訳注: 終了ノードジオメトリの不整合)</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">edge_id</td><td style="border-bottom: 1px solid ; ">node_id</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">face without edges (訳注: エッジのないフェイス)</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">face_id</td><td style="border-bottom: 1px solid ; ">null</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">face has no rings (訳注: 環のないフェイス)</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">face_id</td><td style="border-bottom: 1px solid ; ">null</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">face has wrong mbr (訳注: 誤ったバウンディングボックスを持ったフェイス)</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">face_id</td><td style="border-bottom: 1px solid ; ">null</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">hole not in advertised face (訳注: 穴がフェイス内に存在しない)</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">リングを識別する符号付きedge_id</td><td style="border-bottom: 1px solid ; ">null</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">not-isolated node has not-null containing_face (訳注: containing_faceが存在するノードが孤立ノードでない)</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">node_id</td><td style="border-bottom: 1px solid ; ">null</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">isolated node has null containing_face (訳注: この孤立ノードを含んでいるフェイスが無い)</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">node_id</td><td style="border-bottom: 1px solid ; ">null</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">isolated node has wrong containing_face (訳注: この孤立ノードを含んでいるフェイスが不正)</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">node_id</td><td style="border-bottom: 1px solid ; ">null</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">invalid next_right_edge (訳注: 不正なnext_right_edge)</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">edge_id</td><td style="border-bottom: 1px solid ; ">null</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">invalid next_left_edge (訳注: 不正なnext_left_edge)</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">edge_id</td><td style="border-bottom: 1px solid ; ">null</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">mixed face labeling in ring (訳注: リングにラベルが付いた混合フェイス)</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">リングを識別する符号付きedge_id</td><td style="border-bottom: 1px solid ; ">null</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">non-closed ring (訳注: 閉じていないリング)</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">リングを識別する符号付きedge_id</td><td style="border-bottom: 1px solid ; ">null</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">face has multiple shells (訳注: 複数の外殻を持つフェイス)</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">face_id</td><td style="border-bottom: 1px solid ; ">リングを識別する符号付きedge_id</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">face overlaps face (訳注: フェイス同士のオーバラップ)</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">face_id</td><td style="border-bottom: 1px solid ; ">face_id</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">face within face (訳注: フェイス間の包含) </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">内側のface_id</td><td style="border-bottom: 1px solid ; ">外側のface_id</td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">invalid next_left_edge (訳注: 不正なnext_left_edge)</td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">edge_id</td><td style="border-bottom: 1px solid ; ">期待されるnext_left_edge値</td></tr><tr><td style="border-right: 1px solid ; ">invalid next_right_edge (訳注: 不正なnext_right_edge)</td><td style="border-right: 1px solid ; ">edge_id</td><td style="">期待されるnext_right_edge値</td></tr></tbody></table></div><p>Availability: 1.0.0</p><p>Enhanced: 2.0.0では、より効果的なエッジ交差検出が可能になり、以前の版で残っていた偽陽性を解決しています。</p><p>Changed: 2.2.0 エラーの記述と矛盾しないように'edge crosses node'のid1とid2の値が入れ替わっています。</p><p>Changed: 3.2.0 任意パラメータbboxの追加、フェイスラベルとエッジリンクのチェックの追加</p></div><div class="refsection"><a name="idp69149568"></a><h2>例</h2><pre class="programlisting">SELECT * FROM  topology.ValidateTopology('ma_topo');
      error        | id1 | id2
-------------------+-----+-----
face without edges |   1 |
                                </pre></div><div class="refsection"><a name="idp69151104"></a><h2>関連情報</h2><p><a class="xref" href="#validatetopology_returntype" title="validatetopology_returntype">validatetopology_returntype</a>, <a class="xref" href="#Topology_Load_Tiger" title="Topology_Load_Tiger">Topology_Load_Tiger</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ValidateTopologyRelation"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ValidateTopologyRelation — 不正なトポロジ関係の行に関する情報を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">setof record <b class="fsfunc">ValidateTopologyRelation</b>(</code>varchar  <var class="pdparam">toponame</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69157248"></a><h2>説明</h2><p>トポロジの関係テーブルの不正点に関する情報を提供するレコードの集合を返します。 </p><p>Availability: 3.2.0</p></div><div class="refsection"><a name="idp69159424"></a><h2>関連情報</h2><p><a class="xref" href="#ValidateTopology" title="ValidateTopology">ValidateTopology</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="FindTopology"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>FindTopology — 異なる方法でトポロジ行を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">topology <b class="fsfunc">FindTopology</b>(</code>TopoGeometry <var class="pdparam">topogeom</var><code>)</code>;</p><p><code class="funcdef">topology <b class="fsfunc">FindTopology</b>(</code>regclass <var class="pdparam">layerTable</var>, name <var class="pdparam">layerColumn</var><code>)</code>;</p><p><code class="funcdef">topology <b class="fsfunc">FindTopology</b>(</code>name <var class="pdparam">layerSchema</var>, name <var class="pdparam">layerTable</var>, name <var class="pdparam">layerColumn</var><code>)</code>;</p><p><code class="funcdef">topology <b class="fsfunc">FindTopology</b>(</code>text <var class="pdparam">topoName</var><code>)</code>;</p><p><code class="funcdef">topology <b class="fsfunc">FindTopology</b>(</code>int <var class="pdparam">id</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69181056"></a><h2>説明</h2><p>トポロジ識別子またはトポロジ関連オブジェクトの識別しを取り、topology.topologyレコードを返します。</p><p>Availability: 3.2.0</p></div><div class="refsection"><a name="idp69182848"></a><h2>例</h2><pre class="programlisting">SELECT name(findTopology('features.land_parcels', 'feature'));
   name
-----------
 city_data
(1 row)
</pre></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Topology_StatsManagement"></a>10.4. トポロジ統計管理</h2></div><div><div class="abstract"><div class="abstract-title">概要</div><p>本節では、トポロジ構築時のデータベース統計の管理について説明します。 </p></div></div></div></div><p>トポロジに要素を追加すると、そのトリガとして、分割されることになる既存のエッジを探索し、ノードを追加し、新しいラインでノードを作成するエッジを更新するために多数のデータベースクエリが発生します。このため、トポロジテーブル内のデータに関する統計情報が最新の状態になっているなら、統計情報を使うと便利です。 </p><p>PostGISトポロジーの追加や編集の関数は、自動的に統計情報を更新することはありません。トポロジにおいて逐次変更していては、統計情報の更新が過剰になるためです。処理は呼び出し元の義務となっています。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>autovacuumで更新された統計情報は、autovacuumプロセス完了前に始まったトランザクションからは見えないので、更新した統計情報を使うには、実行時間の長いトランザクションではANALYZE自体を実行する必要があります。 </p></td></tr></table></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Topology_Constructors"></a>10.5. トポロジコンストラクタ</h2></div><div><div class="abstract"><div class="abstract-title">概要</div><p>本節では、新しいトポロジを生成するトポロジ関数を挙げます。</p></div></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#CreateTopology">CreateTopology</a></span><span class="refpurpose"> — 新しいトポロジスキーマを生成し、新しいスキーマをtopology.topologyテーブルに登録します。</span></dt><dt><span class="refentrytitle"><a href="#CopyTopology">CopyTopology</a></span><span class="refpurpose"> — トポロジ構造 (ノード、エッジ、フェイス、レイヤ、TopoGeometry)を複写します。</span></dt><dt><span class="refentrytitle"><a href="#ST_InitTopoGeo">ST_InitTopoGeo</a></span><span class="refpurpose"> — 新しいトポロジスキーマを生成し、topology.topologyテーブルに新しいスキーマを登録し、処理の概要を表示します。</span></dt><dt><span class="refentrytitle"><a href="#ST_CreateTopoGeo">ST_CreateTopoGeo</a></span><span class="refpurpose"> — 空のトポロジにジオメトリのコレクションを追加し、成否を示すメッセージを返します。  </span></dt><dt><span class="refentrytitle"><a href="#TopoGeo_AddPoint">TopoGeo_AddPoint</a></span><span class="refpurpose"> — 許容差を使って既存のトポロジにポイントを追加し、可能ならエッジを分割します。  </span></dt><dt><span class="refentrytitle"><a href="#TopoGeo_AddLineString">TopoGeo_AddLineString</a></span><span class="refpurpose"> — 許容差を使って既存のトポロジにラインストリングを追加し、可能ならエッジ/フェイスを分割します。エッジ識別番号を返します。</span></dt><dt><span class="refentrytitle"><a href="#TopoGeo_AddPolygon">TopoGeo_AddPolygon</a></span><span class="refpurpose"> — 許容差を使って既存のトポロジにラインストリングを追加し、可能ならエッジ/フェイスを分割します。エッジ識別番号を返します。</span></dt></dl></div><div class="refentry"><a name="CreateTopology"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>CreateTopology — 新しいトポロジスキーマを生成し、新しいスキーマをtopology.topologyテーブルに登録します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">CreateTopology</b>(</code>varchar  <var class="pdparam">topology_schema_name</var><code>)</code>;</p><p><code class="funcdef">integer <b class="fsfunc">CreateTopology</b>(</code>varchar  <var class="pdparam">topology_schema_name</var>, integer  <var class="pdparam">srid</var><code>)</code>;</p><p><code class="funcdef">integer <b class="fsfunc">CreateTopology</b>(</code>varchar  <var class="pdparam">topology_schema_name</var>, integer  <var class="pdparam">srid</var>, double precision  <var class="pdparam">prec</var><code>)</code>;</p><p><code class="funcdef">integer <b class="fsfunc">CreateTopology</b>(</code>varchar  <var class="pdparam">topology_schema_name</var>, integer  <var class="pdparam">srid</var>, double precision  <var class="pdparam">prec</var>, boolean  <var class="pdparam">hasz</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69232000"></a><h2>説明</h2><p><code class="varname">topology_name</code>で指定したスキーマを生成し、テーブル (<code class="varname">edge_data</code>, <code class="varname">face</code>, <code class="varname">node</code>, <code class="varname">relation</code>)を生成し、topology.topologyテーブルに新しいトポロジを登録します。トポロジテーブルにおけるトポロジのIDを返します。sridは、spatial_ref_sysテーブルで定義されている空間参照系識別番号です。トポロジの名称は一意でなければなりません。許容差は、空間参照系で規定される単位です。<code class="varname">prec</code>で許容差を指定しない場合は 0 とされます。</p><p>SQL/MMの<a class="xref" href="#ST_InitTopoGeo" title="ST_InitTopoGeo">ST_InitTopoGeo</a>に似ていますが、少しだけこちらの方が機能追加されています。<code class="varname">hasz</code>は、指定されていない場合はfalseとされます。</p><p>Availability: 1.?</p></div><div class="refsection"><a name="idp69237120"></a><h2>例</h2><p>本例ではメートル単位マサチューセッツ州平面のエッジ、フェイスとリレーションを保存するための、ma_topoという新しいスキーマを生成します。空間参照系はメートルを単位としているので、許容差は0.5メートルとなります。</p><pre class="programlisting">SELECT topology.CreateTopology('ma_topo',26986, 0.5);</pre><p>ロードアイランド州トポロジをフィート単位州平面で生成</p><pre class="programlisting">SELECT topology.CreateTopology('ri_topo',3438) As topoid;
topoid
------
2</pre></div><div class="refsection"><a name="idp69239936"></a><h2>関連情報</h2><p><a class="xref" href="#spatial_ref_sys" title="4.5. 空間参照系">「空間参照系」</a>, <a class="xref" href="#ST_InitTopoGeo" title="ST_InitTopoGeo">ST_InitTopoGeo</a>, <a class="xref" href="#Topology_Load_Tiger" title="Topology_Load_Tiger">Topology_Load_Tiger</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="CopyTopology"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>CopyTopology — トポロジ構造 (ノード、エッジ、フェイス、レイヤ、TopoGeometry)を複写します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">CopyTopology</b>(</code>varchar  <var class="pdparam">existing_topology_name</var>, varchar  <var class="pdparam">new_name</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69247488"></a><h2>説明</h2><p><code class="varname">new_topology_name</code>で指定した名前のトポロジを生成し、<code class="varname">existing_topology_name</code>から取得されるSRIDと精度にして、ノード、エッジ、フェイス、レイヤ、TopoGeometryを複製します。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>topology.layerの新しい行には、schema_name, table_name, feature_columnの統合された値が入ります。TopoGeometryが定義には存在しても、どのユーザレベルのテーブルにも存在しないためです。 </p></td></tr></table></div><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp69250432"></a><h2>例</h2><p>本例では、ma_topoという名前のトポロジにバックアップをとっています。 </p><pre class="programlisting">SELECT topology.CopyTopology('ma_topo', 'ma_topo_bakup');</pre></div><div class="refsection"><a name="idp69252352"></a><h2>関連情報</h2><p><a class="xref" href="#spatial_ref_sys" title="4.5. 空間参照系">「空間参照系」</a>, <a class="xref" href="#CreateTopology" title="CreateTopology">CreateTopology</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_InitTopoGeo"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_InitTopoGeo — 新しいトポロジスキーマを生成し、topology.topologyテーブルに新しいスキーマを登録し、処理の概要を表示します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_InitTopoGeo</b>(</code>varchar  <var class="pdparam">topology_schema_name</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69278976"></a><h2>説明</h2><p>これはCreateTopologyのSQL-MM互換ですが、CreateTopologyにある空間参照系とtoleranceオプションがありません。また、トポロジIDを返すのではなく、生成に関する記述を出力します。</p><p>Availability: 1.?</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.17</p></div><div class="refsection"><a name="idp69282176"></a><h2>例</h2><pre class="programlisting">SELECT topology.ST_InitTopoGeo('topo_schema_to_create') AS topocreation;
                      astopocreation
------------------------------------------------------------
 Topology-Geometry 'topo_schema_to_create' (id:7) created.
                                </pre></div><div class="refsection"><a name="idp69283712"></a><h2>関連情報</h2><p><a class="xref" href="#CreateTopology" title="CreateTopology">CreateTopology</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_CreateTopoGeo"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_CreateTopoGeo — 空のトポロジにジオメトリのコレクションを追加し、成否を示すメッセージを返します。  </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_CreateTopoGeo</b>(</code>varchar  <var class="pdparam">atopology</var>, geometry  <var class="pdparam">acollection</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69290624"></a><h2>説明</h2><p>空のトポロジにジオメトリのコレクションを追加し、成否を示すメッセージを返します。  </p><p>空トポロジの追加に使えます。</p><p>Availability: 2.0 </p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.18</p></div><div class="refsection"><a name="idp69294336"></a><h2>例</h2><pre class="programlisting">-- トポロジの投入 --
SELECT topology.ST_CreateTopoGeo('ri_topo',
 ST_GeomFromText('MULTILINESTRING((384744 236928,384750 236923,384769 236911,384799 236895,384811 236890,384833 236884,
  384844 236882,384866 236881,384879 236883,384954 236898,385087 236932,385117 236938,
  385167 236938,385203 236941,385224 236946,385233 236950,385241 236956,385254 236971,
  385260 236979,385268 236999,385273 237018,385273 237037,385271 237047,385267 237057,
  385225 237125,385210 237144,385192 237161,385167 237192,385162 237202,385159 237214,
  385159 237227,385162 237241,385166 237256,385196 237324,385209 237345,385234 237375,
  385237 237383,385238 237399,385236 237407,385227 237419,385213 237430,385193 237439,
  385174 237451,385170 237455,385169 237460,385171 237475,385181 237503,385190 237521,
  385200 237533,385206 237538,385213 237541,385221 237542,385235 237540,385242 237541,
  385249 237544,385260 237555,385270 237570,385289 237584,385292 237589,385291 237596,385284 237630))',3438)
  );

      st_createtopogeo
----------------------------
 Topology ri_topo populated


-- テーブルとTopoGeometryの生成--
CREATE TABLE ri.roads(gid serial PRIMARY KEY, road_name text);

SELECT topology.AddTopoGeometryColumn('ri_topo', 'ri', 'roads', 'topo', 'LINE');
                                </pre></div><div class="refsection"><a name="idp69295872"></a><h2>関連情報</h2><p><a class="xref" href="#AddTopoGeometryColumn" title="AddTopoGeometryColumn">AddTopoGeometryColumn</a>, <a class="xref" href="#CreateTopology" title="CreateTopology">CreateTopology</a>, <a class="xref" href="#DropTopology" title="DropTopology">DropTopology</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="TopoGeo_AddPoint"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>TopoGeo_AddPoint — 許容差を使って既存のトポロジにポイントを追加し、可能ならエッジを分割します。  </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">TopoGeo_AddPoint</b>(</code>varchar  <var class="pdparam">atopology</var>, geometry  <var class="pdparam">apoint</var>, float8  <var class="pdparam">tolerance</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69304704"></a><h2>説明</h2><p>既存のトポロジにポイントを追加し、その識別番号を返します。指定されたポイントは、許容差の範囲内で既存のノードまたはエッジにスナップします。既存のエッジはスナップされたポイントで分割されることがあります。 </p><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp69306752"></a><h2>関連情報</h2><p><a class="xref" href="#TopoGeo_AddLineString" title="TopoGeo_AddLineString">TopoGeo_AddLineString</a>, <a class="xref" href="#TopoGeo_AddPolygon" title="TopoGeo_AddPolygon">TopoGeo_AddPolygon</a>, <a class="xref" href="#AddNode" title="AddNode">AddNode</a>, <a class="xref" href="#CreateTopology" title="CreateTopology">CreateTopology</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="TopoGeo_AddLineString"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>TopoGeo_AddLineString — 許容差を使って既存のトポロジにラインストリングを追加し、可能ならエッジ/フェイスを分割します。エッジ識別番号を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">SETOF integer <b class="fsfunc">TopoGeo_AddLineString</b>(</code>varchar  <var class="pdparam">atopology</var>, geometry  <var class="pdparam">aline</var>, float8  <var class="pdparam">tolerance</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69315968"></a><h2>説明</h2><p>既存のトポロジにラインストリングを追加し、これを構成するエッジの識別番号の集合を返します。指定されたラインは、許容差の範囲内で既存のノードまたはエッジにスナップします。既存のエッジとフェイスはラインで分割されることがあります。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数を介してロードされたトポロジの統計情報の更新は呼び出し元次第です。<a class="xref" href="#Topology_StatsManagement" title="10.4. トポロジ統計管理">maintaining statistics during topology editing and population</a>をご覧下さい。 </p></td></tr></table></div><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp69318912"></a><h2>関連情報</h2><p><a class="xref" href="#TopoGeo_AddPoint" title="TopoGeo_AddPoint">TopoGeo_AddPoint</a>, <a class="xref" href="#TopoGeo_AddPolygon" title="TopoGeo_AddPolygon">TopoGeo_AddPolygon</a>, <a class="xref" href="#AddEdge" title="AddEdge">AddEdge</a>, <a class="xref" href="#CreateTopology" title="CreateTopology">CreateTopology</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="TopoGeo_AddPolygon"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>TopoGeo_AddPolygon — 許容差を使って既存のトポロジにラインストリングを追加し、可能ならエッジ/フェイスを分割します。エッジ識別番号を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">SETOF integer <b class="fsfunc">TopoGeo_AddPolygon</b>(</code>varchar  <var class="pdparam">atopology</var>, geometry  <var class="pdparam">apoly</var>, float8  <var class="pdparam">tolerance</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69328128"></a><h2>説明</h2><p>既存のトポロジにポリゴンを追加し、これを構成するフェイスの識別番号の集合を返します。指定されたポリゴンの境界線は、許容差の範囲内で既存のノードまたはエッジにスナップします。既存のエッジとフェイスはポリゴンの境界線で分割されることがあります。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数を介してロードされたトポロジの統計情報の更新は呼び出し元次第です。<a class="xref" href="#Topology_StatsManagement" title="10.4. トポロジ統計管理">maintaining statistics during topology editing and population</a>をご覧下さい。 </p></td></tr></table></div><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp69331072"></a><h2>関連情報</h2><p><a class="xref" href="#TopoGeo_AddPoint" title="TopoGeo_AddPoint">TopoGeo_AddPoint</a>, <a class="xref" href="#TopoGeo_AddLineString" title="TopoGeo_AddLineString">TopoGeo_AddLineString</a>, <a class="xref" href="#AddFace" title="AddFace">AddFace</a>, <a class="xref" href="#CreateTopology" title="CreateTopology">CreateTopology</a> </p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Topology_Editing"></a>10.6. トポロジエディタ</h2></div><div><div class="abstract"><div class="abstract-title">概要</div><p>本節では、エッジ、フェイス、ノードの追加、移動、削除、分割に関する関数を挙げます。本節の関数はすべてISO SQL/MMで定義されています。</p></div></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#ST_AddIsoNode">ST_AddIsoNode</a></span><span class="refpurpose"> — フェイスに孤立ノードを追加し、新しいノードの識別番号を返します。フェイスがNULLの場合でもノードは生成されます。</span></dt><dt><span class="refentrytitle"><a href="#ST_AddIsoEdge">ST_AddIsoEdge</a></span><span class="refpurpose"> — <code class="varname">anode</code>と<code class="varname">anothernode</code>で指定される二つの既存孤立ノードを接続するトポロジに、ジオメトリ<code class="varname">alinestring</code>で定義される孤立エッジを追加し、新しいエッジの識別番号を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_AddEdgeNewFaces">ST_AddEdgeNewFaces</a></span><span class="refpurpose"> — 新しいエッジを追加します。新しいエッジがフェイスを分割する場合には、もとのフェイスを削除して、分割した二つのフェイスに置き換えます。</span></dt><dt><span class="refentrytitle"><a href="#ST_AddEdgeModFace">ST_AddEdgeModFace</a></span><span class="refpurpose"> — 新しいエッジを追加します。新しいエッジがフェイスを分割する場合には、もとのフェイスを編集し、一つのフェイスを追加します。</span></dt><dt><span class="refentrytitle"><a href="#ST_RemEdgeNewFace">ST_RemEdgeNewFace</a></span><span class="refpurpose"> — エッジを削除し、消去対象エッジでフェイスが二つに分割されているなら元の二つのフェイスを削除し、一つの新しいフェイスに置き換えます。 </span></dt><dt><span class="refentrytitle"><a href="#ST_RemEdgeModFace">ST_RemEdgeModFace</a></span><span class="refpurpose"> — エッジを削除し、削除対象エッジでフェイスが二つに分割されているなら、両方の空間をとるため、一つを削除して、もう一つを編集します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_ChangeEdgeGeom">ST_ChangeEdgeGeom</a></span><span class="refpurpose"> — トポロジ構造に影響を与えることなくエッジの形状を変更します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_ModEdgeSplit">ST_ModEdgeSplit</a></span><span class="refpurpose"> — 既存のエッジに沿って新しいノードを生成してエッジを分割します。もとのエッジは変更され、新しいエッジが一つ追加されます。</span></dt><dt><span class="refentrytitle"><a href="#ST_ModEdgeHeal">ST_ModEdgeHeal</a></span><span class="refpurpose"> — 二つのエッジについて、接続しているノードを削除して修復します。1番目のエッジを編集して、2番目のエッジを削除します。削除されたノードの識別番号を返します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_NewEdgeHeal">ST_NewEdgeHeal</a></span><span class="refpurpose"> — 二つのエッジについて、接続しているノードを削除して修復します。両方のエッジを削除し、1番目のエッジと同じ方向のエッジに置き換えます。 </span></dt><dt><span class="refentrytitle"><a href="#ST_MoveIsoNode">ST_MoveIsoNode</a></span><span class="refpurpose"> — トポロジ内の孤立ノードを別の位置に移動させます。新しい<code class="varname">apoint</code>ジオメトリがノードとして存在しているなら、エラーが投げられます。移動に関する説明を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_NewEdgesSplit">ST_NewEdgesSplit</a></span><span class="refpurpose"> — 新しいノードを既存のエッジに沿って作成して、エッジを分割します。もとのエッジは削除され、二つのエッジに置き換えられます。二つの新しいエッジに接続する新しいノードの識別番号を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_RemoveIsoNode">ST_RemoveIsoNode</a></span><span class="refpurpose"> — 孤立ノードを削除し、実行結果が返されます。ノードが孤立していない (エッジの始端または終端である)場合には、例外が投げられます。</span></dt><dt><span class="refentrytitle"><a href="#ST_RemoveIsoEdge">ST_RemoveIsoEdge</a></span><span class="refpurpose"> — 孤立エッジを削除し、実行結果の記述を返します。エッジが孤立していない場合には、例外が投げられます。</span></dt></dl></div><div class="refentry"><a name="ST_AddIsoNode"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AddIsoNode — フェイスに孤立ノードを追加し、新しいノードの識別番号を返します。フェイスがNULLの場合でもノードは生成されます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_AddIsoNode</b>(</code>varchar  <var class="pdparam">atopology</var>, integer  <var class="pdparam">aface</var>, geometry  <var class="pdparam">apoint</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69342208"></a><h2>説明</h2><p><code class="varname">atopology</code>で指定されたトポロジの<code class="varname">aface</code>の識別番号で示された既存のフェイスに対して、<code class="varname">apoint</code>で示された位置に孤立ノードを追加します。</p><p>ポイントジオメトリの空間参照系 (SRID)がトポロジと同じでない場合、<code class="varname">apoint</code>がポイントジオメトリでない場合、ポイントがNULLである場合、または、ポイントが既存のエッジ (境界も含む)とインタセクトする場合には、例外が投げられます。また、ポイントが既にノードとして存在する場合、例外が投げられます。</p><p><code class="varname">aface</code>がNULLでなく、かつ<code class="varname">apoint</code>がフェイス内に無い場合には、例外が投げられます。</p><p>Availability: 1.? </p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X 3.1</p></div><div class="refsection"><a name="idp69348224"></a><h2>例</h2><p></p></div><div class="refsection"><a name="idp69349760"></a><h2>関連情報</h2><p><a class="xref" href="#AddNode" title="AddNode">AddNode</a>, <a class="xref" href="#CreateTopology" title="CreateTopology">CreateTopology</a>, <a class="xref" href="#DropTopology" title="DropTopology">DropTopology</a>, <a class="xref" href="#">???</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_AddIsoEdge"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AddIsoEdge — <code class="varname">anode</code>と<code class="varname">anothernode</code>で指定される二つの既存孤立ノードを接続するトポロジに、ジオメトリ<code class="varname">alinestring</code>で定義される孤立エッジを追加し、新しいエッジの識別番号を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_AddIsoEdge</b>(</code>varchar  <var class="pdparam">atopology</var>, integer  <var class="pdparam">anode</var>, integer  <var class="pdparam">anothernode</var>, geometry  <var class="pdparam">alinestring</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69364864"></a><h2>説明</h2><p><code class="varname">anode</code>と<code class="varname">anothernode</code>で指定される二つの既存孤立ノードを接続するトポロジに、ジオメトリ<code class="varname">alinestring</code>で定義される孤立エッジを追加し、新しいエッジの識別番号を返します。</p><p><code class="varname">alinestring</code>ジオメトリとトポロジとで空間参照系 (SRID)が異なる場合、引数がNULLである場合、ノードが一つ以上のフェイスに含まれている場合には、二つのノードが既存エッジの始端または終端である場合には、例外が投げられます。</p><p><code class="varname">alinestring</code>が<code class="varname">anode</code>と<code class="varname">anothernode</code>に属するフェイス内に無い場合には、例外が投げられます。</p><p><code class="varname">anode</code>と<code class="varname">anothernode</code>が、<code class="varname">alinestring</code>の始端と終端でない場合には、例外が投げられます。</p><p>Availability: 1.? </p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.4</p></div><div class="refsection"><a name="idp69372544"></a><h2>例</h2><p></p></div><div class="refsection"><a name="idp69374080"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AddIsoNode" title="ST_AddIsoNode">ST_AddIsoNode</a>, <a class="xref" href="#ST_IsSimple" title="ST_IsSimple">ST_IsSimple</a>, <a class="xref" href="#">???</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_AddEdgeNewFaces"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AddEdgeNewFaces — 新しいエッジを追加します。新しいエッジがフェイスを分割する場合には、もとのフェイスを削除して、分割した二つのフェイスに置き換えます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_AddEdgeNewFaces</b>(</code>varchar  <var class="pdparam">atopology</var>, integer  <var class="pdparam">anode</var>, integer  <var class="pdparam">anothernode</var>, geometry  <var class="pdparam">acurve</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69383680"></a><h2>説明</h2><p>新しいエッジを追加します。新しいエッジがフェイスを分割する場合には、もとのフェイスを削除して、分割した二つのフェイスに置き換えます。新しいエッジの識別番号を返します。 </p><p>この関数によって、既存の接続されているエッジとリレーションシップが更新されます。 </p><p>引数がNULLの場合、与えられたノードが不明な場合(トポロジスキーマの<code class="varname">node</code>テーブル内に既に存在していなければなりません)、<code class="varname">acurve</code>が<code class="varname">LINESTRING</code>でない場合、<code class="varname">anode</code>と<code class="varname">anothernode</code>が始端、終端でない場合には、例外が投げられます。</p><p><code class="varname">acurve</code>ジオメトリの空間参照系 (SRID) がトポロジと同じでない場合、例外が投げられます。</p><p>Availability: 2.0 </p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.12</p></div><div class="refsection"><a name="idp69390464"></a><h2>例</h2><p></p></div><div class="refsection"><a name="idp69392000"></a><h2>関連情報</h2><p><a class="xref" href="#ST_RemEdgeNewFace" title="ST_RemEdgeNewFace">ST_RemEdgeNewFace</a></p><p><a class="xref" href="#ST_AddEdgeModFace" title="ST_AddEdgeModFace">ST_AddEdgeModFace</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_AddEdgeModFace"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AddEdgeModFace — 新しいエッジを追加します。新しいエッジがフェイスを分割する場合には、もとのフェイスを編集し、一つのフェイスを追加します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_AddEdgeModFace</b>(</code>varchar  <var class="pdparam">atopology</var>, integer  <var class="pdparam">anode</var>, integer  <var class="pdparam">anothernode</var>, geometry  <var class="pdparam">acurve</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69425920"></a><h2>説明</h2><p>新しいエッジを追加します。新しいエッジがフェイスを分割する場合には、もとのフェイスを編集し、一つのフェイスを追加します。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>可能なら、新しいフェイスは新しいエッジの左側に作られます。左側のフェイスがユニバースフェイス (境界がない)でなければならない場合には、可能ではありません。 </p></td></tr></table></div><p>新しく追加されたエッジの識別番号を返します。 </p><p>この関数によって、既存の接続されているエッジとリレーションシップが更新されます。 </p><p>引数がNULLの場合、与えられたノードが不明な場合(トポロジスキーマの<code class="varname">node</code>テーブル内に既に存在していなければなりません)、<code class="varname">acurve</code>が<code class="varname">LINESTRING</code>でない場合、<code class="varname">anode</code>と<code class="varname">anothernode</code>が始端、終端でない場合には、例外が投げられます。</p><p><code class="varname">acurve</code>ジオメトリの空間参照系 (SRID) がトポロジと同じでない場合、例外が投げられます。</p><p>Availability: 2.0 </p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.13</p></div><div class="refsection"><a name="idp69433600"></a><h2>例</h2><p></p></div><div class="refsection"><a name="idp69435136"></a><h2>関連情報</h2><p><a class="xref" href="#ST_RemEdgeModFace" title="ST_RemEdgeModFace">ST_RemEdgeModFace</a></p><p><a class="xref" href="#ST_AddEdgeNewFaces" title="ST_AddEdgeNewFaces">ST_AddEdgeNewFaces</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_RemEdgeNewFace"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_RemEdgeNewFace — エッジを削除し、消去対象エッジでフェイスが二つに分割されているなら元の二つのフェイスを削除し、一つの新しいフェイスに置き換えます。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_RemEdgeNewFace</b>(</code>varchar  <var class="pdparam">atopology</var>, integer  <var class="pdparam">anedge</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69442432"></a><h2>説明</h2><p>エッジを削除し、消去対象エッジでフェイスが二つに分割されているなら元の二つのフェイスを削除し、一つの新しいフェイスに置き換えます。 </p><p>新しく作成されたフェイスの識別番号を返します。新しいフェイスが生成されない場合にはNULLを返します。削除対象エッジがダングルである (訳注: 「ぶらさがる」状態、すなわち一方の端が孤立ノードでなく、かつもう一方が孤立ノード)場合か、孤立している場合か、 ユニバースフェイスとの境界になっている (おそらく反対側のフェイスにユニバースが侵入します)場合には、フェイスは生成されません。 </p><p>この関数によって、既存の接続されているエッジとリレーションシップが更新されます。 </p><p>既存のTopoGeometryの定義に入り込んでいるエッジは削除を拒絶されます。TopoGeometryが二つのフェイスのうちひとつだけで定義されている (かつ他方は定義に使われていない)場合、二つのフェイスの修復は拒絶されます。 </p><p>引数がNULLである場合、与えられたエッジが不明である場合 (トポロジスキーマの<code class="varname">edge</code>テーブル内に既に存在していなければなりません)、トポロジ名が不正である場合、例外が投げられます。 </p><p>Availability: 2.0 </p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.14</p></div><div class="refsection"><a name="idp69447680"></a><h2>例</h2><p></p></div><div class="refsection"><a name="idp69449216"></a><h2>関連情報</h2><p><a class="xref" href="#ST_RemEdgeModFace" title="ST_RemEdgeModFace">ST_RemEdgeModFace</a></p><p><a class="xref" href="#ST_AddEdgeNewFaces" title="ST_AddEdgeNewFaces">ST_AddEdgeNewFaces</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_RemEdgeModFace"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_RemEdgeModFace — エッジを削除し、削除対象エッジでフェイスが二つに分割されているなら、両方の空間をとるため、一つを削除して、もう一つを編集します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_RemEdgeModFace</b>(</code>varchar  <var class="pdparam">atopology</var>, integer  <var class="pdparam">anedge</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69456512"></a><h2>説明</h2><p>エッジを削除し、削除対象エッジでフェイスが二つに分割されているなら、両方の空間をとるため、一つを削除して、もう一つを編集します。ST_AddEdgeModFaceと対称となるよう、右側のフェイスを優先して保持します。削除対象エッジの代わりに残存するフェイスの識別番号を返します。 </p><p>この関数によって、既存の接続されているエッジとリレーションシップが更新されます。 </p><p>既存のTopoGeometryの定義に入り込んでいるエッジは削除を拒絶されます。TopoGeometryが二つのフェイスのうちひとつだけで定義されている (かつ他方は定義に使われていない)場合、二つのフェイスの修復は拒絶されます。 </p><p>引数がNULLである場合、与えられたエッジが不明である場合 (トポロジスキーマの<code class="varname">edge</code>テーブル内に既に存在していなければなりません)、トポロジ名が不正である場合、例外が投げられます。 </p><p>Availability: 2.0 </p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.15</p></div><div class="refsection"><a name="idp69461376"></a><h2>例</h2><p></p></div><div class="refsection"><a name="idp69462912"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AddEdgeModFace" title="ST_AddEdgeModFace">ST_AddEdgeModFace</a></p><p><a class="xref" href="#ST_RemEdgeNewFace" title="ST_RemEdgeNewFace">ST_RemEdgeNewFace</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_ChangeEdgeGeom"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ChangeEdgeGeom — トポロジ構造に影響を与えることなくエッジの形状を変更します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_ChangeEdgeGeom</b>(</code>varchar  <var class="pdparam">atopology</var>, integer  <var class="pdparam">anedge</var>, geometry  <var class="pdparam">acurve</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69471232"></a><h2>説明</h2><p>トポロジ構造に影響を与えることなくエッジの形状を変更します。 </p><p>NULLの引数があった場合、与えられたエッジがtopologyスキーマの<code class="varname">edge</code>テーブルに存在しない場合、<code class="varname">acurve</code>が<code class="varname">LINESTRING</code>でない場合、<code class="varname">anode</code>と<code class="varname">anothernode</code>が<code class="varname">acurve</code>の開始点と終了点でない場合、または、変更によってトポロジが変わる場合には、エラーが投げられます。 </p><p><code class="varname">acurve</code>ジオメトリの空間参照系 (SRID) がトポロジと同じでない場合、例外が投げられます。</p><p>新しい<code class="varname">acurve</code>が単純でない場合には、エラーが投げられます。</p><p>古い位置から新しい位置へのエッジ移動で障害物にあたった場合はエラーが投げられます。 </p><p>Availability: 1.1.0</p><p>Enhanced: 2.0.0版で、トポロジ整合性の強制を追加しました。 </p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.6</p></div><div class="refsection"><a name="idp69479808"></a><h2>例</h2><pre class="programlisting">SELECT topology.ST_ChangeEdgeGeom('ma_topo', 1,
                ST_GeomFromText('LINESTRING(227591.9 893900.4,227622.6 893844.3,227641.6 893816.6, 227704.5 893778.5)', 26986) );
 ----
 Edge 1 changed</pre></div><div class="refsection"><a name="idp69481344"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AddEdgeModFace" title="ST_AddEdgeModFace">ST_AddEdgeModFace</a></p><p><a class="xref" href="#ST_RemEdgeModFace" title="ST_RemEdgeModFace">ST_RemEdgeModFace</a></p><p><a class="xref" href="#ST_ModEdgeSplit" title="ST_ModEdgeSplit">ST_ModEdgeSplit</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_ModEdgeSplit"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ModEdgeSplit — 既存のエッジに沿って新しいノードを生成してエッジを分割します。もとのエッジは変更され、新しいエッジが一つ追加されます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_ModEdgeSplit</b>(</code>varchar  <var class="pdparam">atopology</var>, integer  <var class="pdparam">anedge</var>, geometry  <var class="pdparam">apoint</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69490176"></a><h2>説明</h2><p>既存のエッジに沿って新しいノードを生成してエッジを分割します。もとのエッジは変更され、新しいエッジが一つ追加されます。この関数によって、既存の接続されているエッジとリレーションシップが更新されます。新しく追加されたノードの識別番号が返ります。 </p><p>Availability: 1.? </p><p>Changed: 2.0 - 以前の版では名前を間違えてST_ModEdgesSplitになっていました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.9</p></div><div class="refsection"><a name="idp69493760"></a><h2>例</h2><pre class="programlisting">-- エッジの追加 --
 SELECT topology.AddEdge('ma_topo', ST_GeomFromText('LINESTRING(227592 893910, 227600 893910)', 26986) ) As edgeid;

-- edgeid --
3


-- エッジの分割 --
SELECT topology.ST_ModEdgeSplit('ma_topo',  3, ST_SetSRID(ST_Point(227594,893910),26986)  ) As node_id;
        node_id
-------------------------
7
</pre></div><div class="refsection"><a name="idp69495296"></a><h2>関連情報</h2><p><a class="xref" href="#ST_NewEdgesSplit" title="ST_NewEdgesSplit">ST_NewEdgesSplit</a>, <a class="xref" href="#ST_ModEdgeHeal" title="ST_ModEdgeHeal">ST_ModEdgeHeal</a>, <a class="xref" href="#ST_NewEdgeHeal" title="ST_NewEdgeHeal">ST_NewEdgeHeal</a>, <a class="xref" href="#AddEdge" title="AddEdge">AddEdge</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_ModEdgeHeal"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ModEdgeHeal — 二つのエッジについて、接続しているノードを削除して修復します。1番目のエッジを編集して、2番目のエッジを削除します。削除されたノードの識別番号を返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">int <b class="fsfunc">ST_ModEdgeHeal</b>(</code>varchar  <var class="pdparam">atopology</var>, integer  <var class="pdparam">anedge</var>, integer  <var class="pdparam">anotheredge</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69504384"></a><h2>説明</h2><p>二つのエッジについて、接続しているノードを削除して修復します。1番目のエッジを編集して、2番目のエッジを削除します。削除されたノードの識別番号を返します。この関数によって、既存の接続されているエッジとリレーションシップが更新されます。 </p><p>Availability: 2.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.9</p></div><div class="refsection"><a name="idp69507840"></a><h2>関連情報</h2><p>
				<a class="xref" href="#ST_ModEdgeSplit" title="ST_ModEdgeSplit">ST_ModEdgeSplit</a>
				<a class="xref" href="#ST_NewEdgesSplit" title="ST_NewEdgesSplit">ST_NewEdgesSplit</a>
				</p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_NewEdgeHeal"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_NewEdgeHeal — 二つのエッジについて、接続しているノードを削除して修復します。両方のエッジを削除し、1番目のエッジと同じ方向のエッジに置き換えます。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">int <b class="fsfunc">ST_NewEdgeHeal</b>(</code>varchar  <var class="pdparam">atopology</var>, integer  <var class="pdparam">anedge</var>, integer  <var class="pdparam">anotheredge</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69532672"></a><h2>説明</h2><p>二つのエッジについて、接続しているノードを削除して修復します。両方のエッジを削除し、1番目のエッジと同じ方向のエッジに置き換えます。 修復されたエッジに置き換えられた新しいエッジの識別番号を返します。 この関数によって、既存の接続されているエッジとリレーションシップが更新されます。 </p><p>Availability: 2.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.9</p></div><div class="refsection"><a name="idp69536128"></a><h2>関連情報</h2><p>
				<a class="xref" href="#ST_ModEdgeHeal" title="ST_ModEdgeHeal">ST_ModEdgeHeal</a>
				<a class="xref" href="#ST_ModEdgeSplit" title="ST_ModEdgeSplit">ST_ModEdgeSplit</a>
				<a class="xref" href="#ST_NewEdgesSplit" title="ST_NewEdgesSplit">ST_NewEdgesSplit</a>
				</p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_MoveIsoNode"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MoveIsoNode — トポロジ内の孤立ノードを別の位置に移動させます。新しい<code class="varname">apoint</code>ジオメトリがノードとして存在しているなら、エラーが投げられます。移動に関する説明を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_MoveIsoNode</b>(</code>varchar  <var class="pdparam">atopology</var>, integer  <var class="pdparam">anedge</var>, geometry  <var class="pdparam">apoint</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69545344"></a><h2>説明</h2><p>トポロジ内の孤立ノードを別の位置に移動させます。新しい<code class="varname">apoint</code>ジオメトリがノードとして存在しているなら、エラーが投げられます。</p><p>引数がNULLの場合、<code class="varname">apoint</code>がポイントでない場合、既存のノードが孤立していない (既存のエッジの始端か終端になっている)場合、新しいノード位置が既存のエッジとインタセクトする場合 (終端であっても)、新しい位置が異なるフェイス内にある場合 (3.2.0以降)のいずれかの場合には、例外が投げられます。 </p><p>ポイントジオメトリの空間参照系 (SRID)がトポロジと異なる場合には、例外が投げられます。</p><p>Availability: 2.0.0 </p><p>Enhanced: 3.2.0 ノードが異なるフェイスに移動しないことを保証 </p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.2</p></div><div class="refsection"><a name="idp69550592"></a><h2>例</h2><pre class="programlisting">-- フェイスの無い孤立ノードの追加 --
SELECT topology.ST_AddIsoNode('ma_topo',  NULL, ST_GeomFromText('POINT(227579 893916)', 26986) ) As nodeid;
 nodeid
--------
      7
-- 新しいノードの移動 --
SELECT topology.ST_MoveIsoNode('ma_topo', 7,  ST_GeomFromText('POINT(227579.5 893916.5)', 26986) ) As descrip;
                      descrip
----------------------------------------------------
Isolated Node 7 moved to location 227579.5,893916.5</pre></div><div class="refsection"><a name="idp69552128"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AddIsoNode" title="ST_AddIsoNode">ST_AddIsoNode</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_NewEdgesSplit"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_NewEdgesSplit — 新しいノードを既存のエッジに沿って作成して、エッジを分割します。もとのエッジは削除され、二つのエッジに置き換えられます。二つの新しいエッジに接続する新しいノードの識別番号を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_NewEdgesSplit</b>(</code>varchar  <var class="pdparam">atopology</var>, integer  <var class="pdparam">anedge</var>, geometry  <var class="pdparam">apoint</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69559936"></a><h2>説明</h2><p><code class="varname">anedge</code>で指定される既存のエッジに沿った<code class="varname">apoint</code>の位置に新しいノードを作成して、エッジを分割します。もとのエッジは削除され、二つつのエッジに置き換えられます。二つの新しいエッジに接続する新しいノードの識別番号を返します。この関数によって、既存の接続されているエッジとリレーションシップが更新されます。 </p><p>ポイントジオメトリの空間参照系 (SRID)がトポロジと異なる場合、<code class="varname">apoint</code>がポイントジオメトリでない場合、ポイントがNULLの場合、ポイントが既にノードとして存在する場合、エッジが既存のエッジと一致しない場合、ポイントがエッジ内にない場合、例外が投げられます。</p><p>Availability: 1.? </p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.8</p></div><div class="refsection"><a name="idp69564544"></a><h2>例</h2><pre class="programlisting">-- エッジの追加  --
SELECT topology.AddEdge('ma_topo', ST_GeomFromText('LINESTRING(227575 893917,227592 893900)', 26986) ) As edgeid;
-- 結果 --
edgeid
------
        2
-- 新しいエッジの分割 --
SELECT topology.ST_NewEdgesSplit('ma_topo', 2,  ST_GeomFromText('POINT(227578.5 893913.5)', 26986) ) As newnodeid;
 newnodeid
---------
       6</pre></div><div class="refsection"><a name="idp69566080"></a><h2>関連情報</h2><p>
				<a class="xref" href="#ST_ModEdgeSplit" title="ST_ModEdgeSplit">ST_ModEdgeSplit</a>
				<a class="xref" href="#ST_ModEdgeHeal" title="ST_ModEdgeHeal">ST_ModEdgeHeal</a>
				<a class="xref" href="#ST_NewEdgeHeal" title="ST_NewEdgeHeal">ST_NewEdgeHeal</a>
				<a class="xref" href="#AddEdge" title="AddEdge">AddEdge</a>
				</p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_RemoveIsoNode"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_RemoveIsoNode — 孤立ノードを削除し、実行結果が返されます。ノードが孤立していない (エッジの始端または終端である)場合には、例外が投げられます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_RemoveIsoNode</b>(</code>varchar  <var class="pdparam">atopology</var>, integer  <var class="pdparam">anode</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69590656"></a><h2>説明</h2><p>孤立ノードを削除し、実行結果が返されます。ノードが孤立していない (エッジの始端または終端である)場合には、例外が投げられます。</p><p>Availability: 1.? </p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.3</p></div><div class="refsection"><a name="idp69593856"></a><h2>例</h2><pre class="programlisting">-- フェイスの無い孤立ノードの削除 --
SELECT topology.ST_RemoveIsoNode('ma_topo',  7 ) As result;
         result
-------------------------
 Isolated node 7 removed
</pre></div><div class="refsection"><a name="idp69595392"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AddIsoNode" title="ST_AddIsoNode">ST_AddIsoNode</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_RemoveIsoEdge"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_RemoveIsoEdge — 孤立エッジを削除し、実行結果の記述を返します。エッジが孤立していない場合には、例外が投げられます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_RemoveIsoEdge</b>(</code>varchar  <var class="pdparam">atopology</var>, integer  <var class="pdparam">anedge</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69614464"></a><h2>説明</h2><p>孤立エッジを削除し、実行結果の記述を返します。エッジが孤立していない場合には、例外が投げられます。</p><p>Availability: 1.? </p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.3</p></div><div class="refsection"><a name="idp69617664"></a><h2>例</h2><pre class="programlisting">-- フェイスの無い孤立ノードの削除 --
SELECT topology.ST_RemoveIsoNode('ma_topo',  7 ) As result;
         result
-------------------------
 Isolated node 7 removed
</pre></div><div class="refsection"><a name="idp69619200"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AddIsoNode" title="ST_AddIsoNode">ST_AddIsoNode</a></p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Topology_Accessors"></a>10.7. トポロジアクセサ</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#GetEdgeByPoint">GetEdgeByPoint</a></span><span class="refpurpose"> — 与えられたポイントにインタセクトするエッジの識別番号を探索します。</span></dt><dt><span class="refentrytitle"><a href="#GetFaceByPoint">GetFaceByPoint</a></span><span class="refpurpose"> — 与えたポイントとインタセクトするフェイスを見つけます。</span></dt><dt><span class="refentrytitle"><a href="#GetFaceContainingPoint">GetFaceContainingPoint</a></span><span class="refpurpose"> — ポイントを含むフェイスを見つけます。</span></dt><dt><span class="refentrytitle"><a href="#GetNodeByPoint">GetNodeByPoint</a></span><span class="refpurpose"> — ポイント位置にあるノードの識別番号を探索します。</span></dt><dt><span class="refentrytitle"><a href="#GetTopologyID">GetTopologyID</a></span><span class="refpurpose"> — トポロジ名からtopology.topologyテーブル内にあるトポロジの識別番号を返します。</span></dt><dt><span class="refentrytitle"><a href="#GetTopologySRID">GetTopologySRID</a></span><span class="refpurpose"> — トポロジ名からtopology.topologyテーブル内にあるトポロジのSRIDを返します。</span></dt><dt><span class="refentrytitle"><a href="#GetTopologyName">GetTopologyName</a></span><span class="refpurpose"> — 識別番号からトポロジ (スキーマ)の名前を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_GetFaceEdges">ST_GetFaceEdges</a></span><span class="refpurpose"> — 順序番号を含む、<code class="varname">aface</code>の境界となる、整列したエッジの集合を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_GetFaceGeometry">ST_GetFaceGeometry</a></span><span class="refpurpose"> — 指定されたトポロジの中の、フェイス識別番号で指定されたポリゴンを返します。</span></dt><dt><span class="refentrytitle"><a href="#GetRingEdges">GetRingEdges</a></span><span class="refpurpose"> — 与えられた側を歩いて得られた、正負符号付きエッジ識別番号の集合を、順序通りに返します。 </span></dt><dt><span class="refentrytitle"><a href="#GetNodeEdges">GetNodeEdges</a></span><span class="refpurpose"> — 与えられたノードに付随するエッジの集合を整列して返します。 </span></dt></dl></div><div class="refentry"><a name="GetEdgeByPoint"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>GetEdgeByPoint — 与えられたポイントにインタセクトするエッジの識別番号を探索します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">GetEdgeByPoint</b>(</code>varchar  <var class="pdparam">atopology</var>, geometry  <var class="pdparam">apoint</var>, float8  <var class="pdparam">tol1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69627904"></a><h2>説明</h2><p>与えられたポイントにインタセクトするエッジの識別番号を探索します。</p><p>この関数は、トポロジ、ポイント、許容差を引数にして、整数 (エッジの識別番号)を返します。許容差が0の場合、ポイントはエッジとインタセクトしていなければなりません。</p><p><code class="varname">apoint</code>がエッジとインタセクトしない場合には、0を返します。</p><p>許容差を0より大きくして、ポイント付近のエッジが一つより多い場合には、例外が投げられます。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>許容差が0の場合には、ST_Intersectsを使い、それ以外では、ST_DWinthinを使います。</p></td></tr></table></div><p>GEOSモジュールで実現しています。</p><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp69632000"></a><h2>例</h2><p>本例では<a class="xref" href="#AddEdge" title="AddEdge">AddEdge</a>で作ったエッジを使います。</p><pre class="programlisting">SELECT topology.GetEdgeByPoint('ma_topo',geom, 1) As with1mtol, topology.GetEdgeByPoint('ma_topo',geom,0) As withnotol
FROM ST_GeomFromEWKT('SRID=26986;POINT(227622.6 893843)') As geom;
 with1mtol | withnotol
-----------+-----------
         2 |         0
</pre><pre class="programlisting">SELECT topology.GetEdgeByPoint('ma_topo',geom, 1) As nearnode
FROM ST_GeomFromEWKT('SRID=26986;POINT(227591.9 893900.4)') As geom;

-- エラー発生 --
ERROR:  Two or more edges found</pre></div><div class="refsection"><a name="idp69634816"></a><h2>関連情報</h2><p><a class="xref" href="#AddEdge" title="AddEdge">AddEdge</a>, <a class="xref" href="#GetNodeByPoint" title="GetNodeByPoint">GetNodeByPoint</a>, <a class="xref" href="#GetFaceByPoint" title="GetFaceByPoint">GetFaceByPoint</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="GetFaceByPoint"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>GetFaceByPoint — 与えたポイントとインタセクトするフェイスを見つけます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">GetFaceByPoint</b>(</code>varchar  <var class="pdparam">atopology</var>, geometry  <var class="pdparam">apoint</var>, float8  <var class="pdparam">tol1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69643520"></a><h2>説明</h2><p>ポイントと与えた許容値で参照されるフェイスを見つけます。 </p><p>この関数は、ポイントを中心に持ち半径が許容値となる円とインタセクトするフェイスを効率的に探します。 </p><p>与えられたクエリ位置とインタセクトするフェイスが無い場合には、0を返します (ユニバーサルフェイス)。 </p><p>1以上のフェイスがクエリ位置とインタセクトする場合には例外が投げられます。 </p><p>Availability: 2.0.0</p><p>Enhanced: 3.2.0 より効率的な実装とより明確な短縮、不正なトポロジでの動作停止。</p></div><div class="refsection"><a name="idp69646592"></a><h2>例</h2><pre class="programlisting">SELECT topology.GetFaceByPoint('ma_topo',geom, 10) As with1mtol, topology.GetFaceByPoint('ma_topo',geom,0) As withnotol
        FROM ST_GeomFromEWKT('POINT(234604.6 899382.0)') As geom;

         with1mtol | withnotol
        -----------+-----------
                         1 |         0</pre><pre class="programlisting">SELECT topology.GetFaceByPoint('ma_topo',geom, 1) As nearnode
        FROM ST_GeomFromEWKT('POINT(227591.9 893900.4)') As geom;

-- エラー発生--
ERROR:  Two or more faces found</pre></div><div class="refsection"><a name="idp69648640"></a><h2>関連情報</h2><p><a class="xref" href="#GetFaceContainingPoint" title="GetFaceContainingPoint">GetFaceContainingPoint</a>, <a class="xref" href="#AddFace" title="AddFace">AddFace</a>, <a class="xref" href="#GetNodeByPoint" title="GetNodeByPoint">GetNodeByPoint</a>, <a class="xref" href="#GetEdgeByPoint" title="GetEdgeByPoint">GetEdgeByPoint</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="GetFaceContainingPoint"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>GetFaceContainingPoint — ポイントを含むフェイスを見つけます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">GetFaceContainingPoint</b>(</code>text  <var class="pdparam">atopology</var>, geometry  <var class="pdparam">apoint</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69656704"></a><h2>説明</h2><p>ポイントを含むフェイスのIDを返します。</p><p>ポイントがフェイスの境界に落ちた場合には例外が投げられます。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数は妥当なトポロジが前提であり、エッジリンクとフェイスラベルを使用して動作します。</p></td></tr></table></div><p>Availability: 3.2.0</p></div><div class="refsection"><a name="idp69659392"></a><h2>関連情報</h2><p>
<a class="xref" href="#ST_GetFaceGeometry" title="ST_GetFaceGeometry">ST_GetFaceGeometry</a>
</p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="GetNodeByPoint"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>GetNodeByPoint — ポイント位置にあるノードの識別番号を探索します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">GetNodeByPoint</b>(</code>varchar  <var class="pdparam">atopology</var>, geometry  <var class="pdparam">apoint</var>, float8  <var class="pdparam">tol1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69667456"></a><h2>説明</h2><p>ポイント位置にあるノードの識別番号を探索します。</p><p>トポロジ、POINT、許容値が与えられ、整数 (ノード識別番号)が返ります。tolerance = 0 の場合には、確実にインタセクトするノードを取得し、そうでない場合には、指定した間隔の中からノードを取得します。</p><p><code class="varname">apoint</code>がノードとインタセクトしない場合には、0を返します。</p><p>許容差を0より大きくして、ポイント付近のノードが一つより多い場合には、例外が投げられます。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>許容差が0の場合には、ST_Intersectsを使い、それ以外では、ST_DWinthinを使います。</p></td></tr></table></div><p>GEOSモジュールで実現しています。</p><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp69671552"></a><h2>例</h2><p>本例では<a class="xref" href="#AddEdge" title="AddEdge">AddEdge</a>で作ったエッジを使います。</p><pre class="programlisting">SELECT topology.GetNodeByPoint('ma_topo',geom, 1) As nearnode
 FROM ST_GeomFromEWKT('SRID=26986;POINT(227591.9 893900.4)') As geom;
  nearnode
----------
        2
 </pre><pre class="programlisting">SELECT topology.GetNodeByPoint('ma_topo',geom, 1000) As too_much_tolerance
 FROM ST_GeomFromEWKT('SRID=26986;POINT(227591.9 893900.4)') As geom;

 -- エラー発生 --
 ERROR:  Two or more nodes found
 </pre></div><div class="refsection"><a name="idp69674368"></a><h2>関連情報</h2><p><a class="xref" href="#AddEdge" title="AddEdge">AddEdge</a>, <a class="xref" href="#GetEdgeByPoint" title="GetEdgeByPoint">GetEdgeByPoint</a>, <a class="xref" href="#GetFaceByPoint" title="GetFaceByPoint">GetFaceByPoint</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="GetTopologyID"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>GetTopologyID — トポロジ名からtopology.topologyテーブル内にあるトポロジの識別番号を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">GetTopologyID</b>(</code>varchar <var class="pdparam">toponame</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69681024"></a><h2>説明</h2><p>トポロジ名からtopology.topologyテーブル内にあるトポロジの識別番号を返します。</p><p>Availability: 1.?</p></div><div class="refsection"><a name="idp69682816"></a><h2>例</h2><pre class="programlisting">SELECT topology.GetTopologyID('ma_topo') As topo_id;
 topo_id
---------
       1</pre></div><div class="refsection"><a name="idp69684352"></a><h2>関連情報</h2><p><a class="xref" href="#CreateTopology" title="CreateTopology">CreateTopology</a>, <a class="xref" href="#DropTopology" title="DropTopology">DropTopology</a>, <a class="xref" href="#GetTopologyName" title="GetTopologyName">GetTopologyName</a>, <a class="xref" href="#GetTopologySRID" title="GetTopologySRID">GetTopologySRID</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="GetTopologySRID"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>GetTopologySRID — トポロジ名からtopology.topologyテーブル内にあるトポロジのSRIDを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">GetTopologyID</b>(</code>varchar <var class="pdparam">toponame</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69707776"></a><h2>説明</h2><p>与えられたトポロジ名からtopology.topologyテーブル内のトポロジの空間参照系識別番号を返します。</p><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp69709568"></a><h2>例</h2><pre class="programlisting">SELECT topology.GetTopologySRID('ma_topo') As SRID;
 SRID
-------
  4326</pre></div><div class="refsection"><a name="idp69711104"></a><h2>関連情報</h2><p><a class="xref" href="#CreateTopology" title="CreateTopology">CreateTopology</a>, <a class="xref" href="#DropTopology" title="DropTopology">DropTopology</a>, <a class="xref" href="#GetTopologyName" title="GetTopologyName">GetTopologyName</a>, <a class="xref" href="#GetTopologyID" title="GetTopologyID">GetTopologyID</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="GetTopologyName"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>GetTopologyName — 識別番号からトポロジ (スキーマ)の名前を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">varchar <b class="fsfunc">GetTopologyName</b>(</code>integer <var class="pdparam">topology_id</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69722240"></a><h2>説明</h2><p>識別番号からトポロジ (スキーマ)の名前を返します。</p><p>Availability: 1.?</p></div><div class="refsection"><a name="idp69724032"></a><h2>例</h2><pre class="programlisting">SELECT topology.GetTopologyName(1) As topo_name;
 topo_name
-----------
 ma_topo</pre></div><div class="refsection"><a name="idp69725568"></a><h2>関連情報</h2><p><a class="xref" href="#CreateTopology" title="CreateTopology">CreateTopology</a>, <a class="xref" href="#DropTopology" title="DropTopology">DropTopology</a>, <a class="xref" href="#GetTopologyID" title="GetTopologyID">GetTopologyID</a>, <a class="xref" href="#GetTopologySRID" title="GetTopologySRID">GetTopologySRID</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_GetFaceEdges"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_GetFaceEdges — 順序番号を含む、<code class="varname">aface</code>の境界となる、整列したエッジの集合を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">getfaceedges_returntype <b class="fsfunc">ST_GetFaceEdges</b>(</code>varchar  <var class="pdparam">atopology</var>, integer  <var class="pdparam">aface</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69734016"></a><h2>説明</h2><p>順序番号を含む、<code class="varname">aface</code>の境界となる、整列したエッジの集合を返します。それぞれの出力は、順序番号とエッジ識別番号からなります。順序番号は1から始まります。</p><p>環ごとのエッジの列挙は、識別番号が最も小さいものから始まります。エッジの順序は左手の法則に従います (境界フェイスは各有向辺の左側にあるようにします)。 </p><p>Availability: 2.0 </p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.5</p></div><div class="refsection"><a name="idp69737984"></a><h2>例</h2><pre class="programlisting">-- 1番フェイスの境界を返します。
SELECT (topology.ST_GetFaceEdges('tt', 1)).*;
-- 結果 --
 sequence | edge
----------+------
        1 |   -4
        2 |    5
        3 |    7
        4 |   -6
        5 |    1
        6 |    2
        7 |    3
(7 rows)
</pre><pre class="programlisting">-- 1番フェイスの順序番号、エッジ識別番号とジオメトリを返します。
-- geomとseqが欲しいだけならST_GetFaceGeometryを使います。
SELECT t.seq, t.edge, geom
FROM topology.ST_GetFaceEdges('tt',1) As t(seq,edge)
        INNER JOIN tt.edge AS e ON abs(t.edge) = e.edge_id;
</pre></div><div class="refsection"><a name="idp69740032"></a><h2>関連情報</h2><p><a class="xref" href="#GetRingEdges" title="GetRingEdges">GetRingEdges</a>, <a class="xref" href="#AddFace" title="AddFace">AddFace</a>, <a class="xref" href="#ST_GetFaceGeometry" title="ST_GetFaceGeometry">ST_GetFaceGeometry</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_GetFaceGeometry"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_GetFaceGeometry — 指定されたトポロジの中の、フェイス識別番号で指定されたポリゴンを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_GetFaceGeometry</b>(</code>varchar  <var class="pdparam">atopology</var>, integer  <var class="pdparam">aface</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69747712"></a><h2>説明</h2><p>指定されたトポロジの中の、フェイス識別番号で指定されたポリゴンを返します。フェイスを作るエッジからポリゴンを構築します。</p><p>Availability: 1.? </p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.16</p></div><div class="refsection"><a name="idp69750912"></a><h2>例</h2><pre class="programlisting">-- AddFaceで追加したポリゴンのWKTを返します。
SELECT ST_AsText(topology.ST_GetFaceGeometry('ma_topo', 1)) As facegeomwkt;
-- 結果 --
               facegeomwkt

--------------------------------------------------------------------------------
 POLYGON((234776.9 899563.7,234896.5 899456.7,234914 899436.4,234946.6 899356.9,
234872.5 899328.7,234891 899285.4,234992.5 899145,234890.6 899069,
234755.2 899255.4,234612.7 899379.4,234776.9 899563.7))
</pre></div><div class="refsection"><a name="idp69752448"></a><h2>関連情報</h2><p><a class="xref" href="#AddFace" title="AddFace">AddFace</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="GetRingEdges"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>GetRingEdges — 与えられた側を歩いて得られた、正負符号付きエッジ識別番号の集合を、順序通りに返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">getfaceedges_returntype <b class="fsfunc">GetRingEdges</b>(</code>varchar  <var class="pdparam">atopology</var>, integer  <var class="pdparam">aring</var>, integer  <var class="pdparam">max_edges=null</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69760384"></a><h2>説明</h2><p>与えられた側を歩いて得られた、正負符号付きエッジ識別番号の集合を、順序通りに返します。出力は順序番号と正負符号付きエッジ識別番号からなります。順序番号は1始まりです。 </p><p>正のエッジ識別番号を渡すと、対応するエッジの左側を歩き、エッジを順方向に進みます。負のエッジ識別番号を渡すと、右側を歩き、エッジを逆方向に進みます。 </p><p><code class="varname">max_edges</code>がNULLでな場合には、返されるレコードを超えることはありません。これは、不正なトポロジを扱うときの安全確保のためのパラメータであることを意味します。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はメタデータとリンクするエッジ環を使います。 </p></td></tr></table></div><p>Availability: 2.0.0 </p></div><div class="refsection"><a name="idp69763968"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GetFaceEdges" title="ST_GetFaceEdges">ST_GetFaceEdges</a>, <a class="xref" href="#GetNodeEdges" title="GetNodeEdges">GetNodeEdges</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="GetNodeEdges"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>GetNodeEdges — 与えられたノードに付随するエッジの集合を整列して返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">getfaceedges_returntype <b class="fsfunc">GetNodeEdges</b>(</code>varchar  <var class="pdparam">atopology</var>, integer  <var class="pdparam">anode</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69771264"></a><h2>説明</h2><p>与えられたノードに付随するエッジの集合を整列して返します。 出力は、連続する、正負符号を持つエッジ識別番号からなります。順序番号は1から始まります。 正のエッジは与えられたノードから始まるものです。 負のエッジは与えられたノードで終わるものです。 閉じたエッジは2回現れます (正と負になります)。 並び順は北側から時計回りになります。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数は、並び順を計算していて、メタデータからのデータを使わないので、 連結しているエッジ環を構築するのに使えます。 </p></td></tr></table></div><p>Availability: 2.0 </p></div><div class="refsection"><a name="idp69774080"></a><h2>関連情報</h2><p><a class="xref" href="#getfaceedges_returntype" title="getfaceedges_returntype">getfaceedges_returntype</a>, <a class="xref" href="#GetRingEdges" title="GetRingEdges">GetRingEdges</a>, <a class="xref" href="#ST_Azimuth" title="ST_Azimuth">ST_Azimuth</a> </p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Topology_Processing"></a>10.8. トポロジ処理</h2></div><div><div class="abstract"><div class="abstract-title">概要</div><p>本節では、非標準の手法でのトポロジ処理の関数を挙げます。</p></div></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#TopologyPolygonize">Polygonize</a></span><span class="refpurpose"> — トポロジエッジで定義される全てのフェイスを探索し、追加します。</span></dt><dt><span class="refentrytitle"><a href="#AddNode">AddNode</a></span><span class="refpurpose"> — 指定したトポロジスキーマのノードテーブルにポイントノードを追加し、新しいノードの識別番号を返します。指定したポイントに既にノードがある場合は既存のノード識別番号を返します。</span></dt><dt><span class="refentrytitle"><a href="#AddEdge">AddEdge</a></span><span class="refpurpose"> — 指定したラインストリングジオメトリを使って、ラインストリングエッジをエッジテーブルに追加し、指定したトポロジスキーマの始点終点をポイントノードテーブルに追加し、新しい (または既存の)エッジの識別番号を返します。</span></dt><dt><span class="refentrytitle"><a href="#AddFace">AddFace</a></span><span class="refpurpose"> — フェイスプリミティブをトポロジに登録し、その識別番号を得ます。 </span></dt><dt><span class="refentrytitle"><a href="#TP_ST_Simplify">ST_Simplify</a></span><span class="refpurpose"> — 与えたTopoGeometryを「シンプル化した」ジオメトリを返します。ダグラス-ポーカーのアルゴリズムを使います。</span></dt></dl></div><div class="refentry"><a name="TopologyPolygonize"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Polygonize — トポロジエッジで定義される全てのフェイスを探索し、追加します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">Polygonize</b>(</code>varchar  <var class="pdparam">toponame</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69782784"></a><h2>説明</h2><p>トポロジエッジプリミティブで構築することができる全てのフェイスを登録します。</p><p>対象トポロジは自己インタセクトするエッジが無いと仮定しています。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>既に登録されているフェイスは認識されているので、同じトポロジに対してPolygonizeを複数回呼んでも問題ありません。</p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はエッジテーブルのnext_left_edgeとnext_right_edgeフィールドの読み書きを行いません。 </p></td></tr></table></div><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp69786496"></a><h2>関連情報</h2><p><a class="xref" href="#AddFace" title="AddFace">AddFace</a>, <a class="xref" href="#ST_Polygonize" title="ST_Polygonize">ST_Polygonize</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="AddNode"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>AddNode — 指定したトポロジスキーマのノードテーブルにポイントノードを追加し、新しいノードの識別番号を返します。指定したポイントに既にノードがある場合は既存のノード識別番号を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">AddNode</b>(</code>varchar  <var class="pdparam">toponame</var>, geometry  <var class="pdparam">apoint</var>, boolean  <var class="pdparam">allowEdgeSplitting=false</var>, boolean  <var class="pdparam">computeContainingFace=false</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69795968"></a><h2>説明</h2><p>指定したトポロジスキーマのノードテーブルにポイントノードを追加します。 <a class="xref" href="#AddEdge" title="AddEdge">AddEdge</a>関数は、呼ばれると自動的にエッジの始端と終端のポイントを追加するので、明示的にエッジのノードを追加する必要はあまりありません。 </p><p>ノードとクロスするエッジが発見された場合は、例外が発生するか、エッジが分割されます。<code class="varname">allowEdgeSplitting</code>パラメータの値に依存します。 </p><p><code class="varname">computeContainingFace</code>がtrueの場合には、新しく追加されたノードによって、ノードを含む正しいフェイスが計算されます。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">apoint</code>ジオメトリが既にノードとして存在する場合、ノードは追加されずに、既存ノードの識別番号を返します。</p></td></tr></table></div><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp69800448"></a><h2>例</h2><pre class="programlisting">SELECT topology.AddNode('ma_topo', ST_GeomFromText('POINT(227641.6 893816.5)', 26986) ) As nodeid;
-- 結果 --
nodeid
--------
 4

</pre></div><div class="refsection"><a name="idp69801984"></a><h2>関連情報</h2><p><a class="xref" href="#AddEdge" title="AddEdge">AddEdge</a>, <a class="xref" href="#CreateTopology" title="CreateTopology">CreateTopology</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="AddEdge"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>AddEdge — 指定したラインストリングジオメトリを使って、ラインストリングエッジをエッジテーブルに追加し、指定したトポロジスキーマの始点終点をポイントノードテーブルに追加し、新しい (または既存の)エッジの識別番号を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">AddEdge</b>(</code>varchar  <var class="pdparam">toponame</var>, geometry  <var class="pdparam">aline</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69809152"></a><h2>説明</h2><p>指定したラインストリングジオメトリを使って、指定した<code class="varname">toponame</code>スキーマのノードテーブルにノードを追加し、新しいまたは既存のレコードのエッジ識別番号を返します。ラインストリングエッジをエッジテーブルに追加し、指定したトポロジスキーマの始点終点をポイントノードテーブルに追加し、新規または既存のエッジの識別番号を返します。新しく追加されたエッジは両側にユニバースフェイスを持ち、自分自身にリンクしています。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">aline</code>ジオメトリが既存のエッジとクロスしたり、既存のエッジをオーバラップしたり、既存のエッジを包含したり、既存のエッジに包含されたりする場合には、エラーが投げられ、エッジは追加されません。</p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">aline</code>のジオメトリは<code class="varname">srid</code>がトポロジで指定されたものと同じである必要があり、異なる場合には、不正な空間参照系エラーが投げられます。</p></td></tr></table></div><p>GEOSモジュールで実現しています。</p><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp69813376"></a><h2>例</h2><pre class="programlisting">SELECT topology.AddEdge('ma_topo', ST_GeomFromText('LINESTRING(227575.8 893917.2,227591.9 893900.4)', 26986) ) As edgeid;
-- 結果 --
edgeid
--------
 1

SELECT topology.AddEdge('ma_topo', ST_GeomFromText('LINESTRING(227591.9 893900.4,227622.6 893844.2,227641.6 893816.5,
 227704.5 893778.5)', 26986) ) As edgeid;
-- 結果 --
edgeid
--------
 2

 SELECT topology.AddEdge('ma_topo', ST_GeomFromText('LINESTRING(227591.2 893900, 227591.9 893900.4,
  227704.5 893778.5)', 26986) ) As edgeid;
 -- エラー発生 --
 ERROR:  Edge intersects (not on endpoints) with existing edge 1
</pre></div><div class="refsection"><a name="idp69814912"></a><h2>関連情報</h2><p><a class="xref" href="#TopoGeo_AddLineString" title="TopoGeo_AddLineString">TopoGeo_AddLineString</a>, <a class="xref" href="#CreateTopology" title="CreateTopology">CreateTopology</a>, <a class="xref" href="#spatial_ref_sys" title="4.5. 空間参照系">「空間参照系」</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="AddFace"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>AddFace — フェイスプリミティブをトポロジに登録し、その識別番号を得ます。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">AddFace</b>(</code>varchar  <var class="pdparam">toponame</var>, geometry  <var class="pdparam">apolygon</var>, boolean  <var class="pdparam">force_new=false</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69823744"></a><h2>説明</h2><p>フェイスプリミティブをトポロジに登録し、その識別番号を得ます。  </p><p>新しく追加されたフェイスのために、境界を形成するエッジとフェイスに含まれるエッジはleft_faceとright_faceフィールドに正しい値を持つよう更新されます。フェイスに含まれる孤立ノードも正しいcontaining_faceフィールド値を持つよう更新されます。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はエッジテーブルのnext_left_edgeとnext_right_edgeフィールドの読み書きを行いません。 </p></td></tr></table></div><p>対象トポロジは妥当 (自己インタセクトするエッジが無い)と仮定しています。ポリゴンの境界が既存のエッジでは完全には定義されない場合や、ポリゴンが既存のフェイスにオーバラップする場合には、例外が投げられます。</p><p><code class="varname">apolygon</code>ジオメトリが既にフェイスとして存在している場合には、
<code class="varname">force_new</code>がfalse (デフォルト)の場合は、既存フェイスのフェイス識別番号が返り、<code class="varname">force_new</code>がtrueの場合は、新しい識別番号が </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>既存フェイスの新規登録が実行される時(force_new=true)、そのエッジ内の既存のフェイスへの参照のダングルを解決しません。また、関連テーブルのノードと既存フェイスのレコードのMBR(訳注: 最小境界矩形)フィールドの更新も行いません。これに対応するのは、この関数を呼び出した側です。 </p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">apolygon</code>ジオメトリはトポロジと同じ<code class="varname">srid</code>である必要があり、異なる場合には、不正な空間参照系エラーが投げられます。</p></td></tr></table></div><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp69830016"></a><h2>例</h2><pre class="programlisting">-- 最初に、反復子にgenerate_seriesを使用してエッジを追加
-- (generate_seriesの最大値の関係上、
-- 頂点が10000個未満のポリゴンでのみ動作します)

SELECT topology.AddEdge('ma_topo', ST_MakeLine(ST_PointN(geom,i), ST_PointN(geom, i + 1) )) As edgeid
    FROM (SELECT  ST_NPoints(geom) AS npt, geom
            FROM
                (SELECT ST_Boundary(ST_GeomFromText('POLYGON((234896.5 899456.7,234914 899436.4,234946.6 899356.9,234872.5 899328.7,
                234891 899285.4,234992.5 899145, 234890.6 899069,234755.2 899255.4,
                234612.7 899379.4,234776.9 899563.7,234896.5 899456.7))', 26986) )  As geom
            )  As geoms) As facen CROSS JOIN generate_series(1,10000) As i
         WHERE i &lt; npt;
-- 結果 --
 edgeid
--------
      3
      4
      5
      6
      7
      8
      9
     10
     11
     12
(10 rows)
-- フェイスの追加

SELECT topology.AddFace('ma_topo',
    ST_GeomFromText('POLYGON((234896.5 899456.7,234914 899436.4,234946.6 899356.9,234872.5 899328.7,
    234891 899285.4,234992.5 899145, 234890.6 899069,234755.2 899255.4,
    234612.7 899379.4,234776.9 899563.7,234896.5 899456.7))', 26986) ) As faceid;
-- 結果 --
faceid
--------
 1

</pre></div><div class="refsection"><a name="idp69831552"></a><h2>関連情報</h2><p><a class="xref" href="#AddEdge" title="AddEdge">AddEdge</a>, <a class="xref" href="#CreateTopology" title="CreateTopology">CreateTopology</a>, <a class="xref" href="#spatial_ref_sys" title="4.5. 空間参照系">「空間参照系」</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="TP_ST_Simplify"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Simplify — 与えたTopoGeometryを「シンプル化した」ジオメトリを返します。ダグラス-ポーカーのアルゴリズムを使います。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Simplify</b>(</code>TopoGeometry <var class="pdparam">tg</var>, float8 <var class="pdparam">tolerance</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69855488"></a><h2>説明</h2><p>与えたTopoGeometryを「シンプル化した」ジオメトリを返します。個々の要素エッジに対してダグラス-ポーカーのアルゴリズムを使います。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>返されるジオメトリは単純でなかったり不正であったりする場合があります。</p><p>要素エッジの分割によって単純性/妥当性を維持することがあります。</p></td></tr></table></div><p>GEOSモジュールで実現しています。</p><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp69858304"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Simplify" title="ST_Simplify">ST_Simplify</a> (ジオメトリ), <a class="xref" href="#ST_IsSimple" title="ST_IsSimple">ST_IsSimple</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#ST_ModEdgeSplit" title="ST_ModEdgeSplit">ST_ModEdgeSplit</a></p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="TopoGeometry_Constructors"></a>10.9. TopoGeometryコンストラクタ</h2></div><div><div class="abstract"><div class="abstract-title">概要</div><p>本節では、新しいTopoGeometryを生成するトポロジ関数を挙げます。</p></div></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#CreateTopoGeom">CreateTopoGeom</a></span><span class="refpurpose"> — 新しいTopoGeometryオブジェクトをtopoエレメント配列から生成します - tg_type: 1:[multi]point, 2:[multi]line, 3:[multi]poly, 4:collection</span></dt><dt><span class="refentrytitle"><a href="#toTopoGeom">toTopoGeom</a></span><span class="refpurpose"> — 単純なジオメトリからTopoGeometryを生成します。</span></dt><dt><span class="refentrytitle"><a href="#TopoElementArray_Agg">TopoElementArray_Agg</a></span><span class="refpurpose"> — element_idとタイプの配列 (topoelements)からなる<code class="varname">topoelementarray</code>を返します。</span></dt></dl></div><div class="refentry"><a name="CreateTopoGeom"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>CreateTopoGeom — 新しいTopoGeometryオブジェクトをtopoエレメント配列から生成します - tg_type: 1:[multi]point, 2:[multi]line, 3:[multi]poly, 4:collection</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">topogeometry <b class="fsfunc">CreateTopoGeom</b>(</code>varchar  <var class="pdparam">toponame</var>, integer  <var class="pdparam">tg_type</var>, integer <var class="pdparam">layer_id</var>, topoelementarray <var class="pdparam">tg_objs</var><code>)</code>;</p><p><code class="funcdef">topogeometry <b class="fsfunc">CreateTopoGeom</b>(</code>varchar  <var class="pdparam">toponame</var>, integer  <var class="pdparam">tg_type</var>, integer <var class="pdparam">layer_id</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69886848"></a><h2>説明</h2><p><code class="varname">layer_id</code>で示されたレイヤでTopoGeometryオブジェクトを生成し、<code class="varname">toponame</code>スキーマの関連テーブルに登録します。</p><p><code class="varname">tg_type</code>は次の整数値とします: 1:[multi]point (点), 2:[multi]line (線), 3:[multi]poly (面), 4:collection。<code class="varname">layer_id</code>は、topology.layerテーブル内のレイヤ識別番号です。</p><p>点レイヤはノードの集合から形成され、線レイヤはエッジの集合から形成され、面レイヤはフェイスの集合から形成され、コレクションはノード、エッジ、フェイスの混合から形成されます。</p><p>要素の配列を省略した場合、空のTopoGeometryオブジェクトが生成されます。</p><p>Availability: 1.?</p></div><div class="refsection"><a name="idp69891072"></a><h2>例: 既存エッジからの形成</h2><p>ri_topoスキーマ内 (<code class="varname">ST_CreateTopoGeo</code>の例でロードしてあります)で、ラインタイプ (整数値で2)の、layer_idが2のレイヤ (ri_roads)の最初のエッジからTopoGeometryを生成します。</p><pre class="programlisting">INSERT INTO ri.ri_roads(road_name, topo) VALUES('Unknown', topology.CreateTopoGeom('ri_topo',2,2,'{{1,2}}'::topology.topoelementarray);</pre></div><div class="refsection"><a name="idp69893120"></a><h2>例: 面ジオメトリから最善と推測されるTopoGeometryへの変換</h2><p>フェイスのコレクションから形成されるジオメトリがあるとします。blockgroupsテーブルがあり、それぞれの区画群のTopoGeometryを知りたいとします。データが完全に整列しているなら、次のようにできます。</p><pre class="programlisting">-- TopoGeometryカラムの生成 --
SELECT topology.AddTopoGeometryColumn(
        'topo_boston',
        'boston', 'blockgroups', 'topo', 'POLYGON');

-- addtopgeometrycolumn --
1

-- 全てがエッジに沿っている前提でのカラムのアップデート
UPDATE boston.blockgroups AS bg
        SET topo = topology.CreateTopoGeom('topo_boston'
        ,3,1
        , foo.bfaces)
FROM (SELECT b.gid,  topology.TopoElementArray_Agg(ARRAY[f.face_id,3]) As bfaces
        FROM boston.blockgroups As b
            INNER JOIN topo_boston.face As f ON b.geom &amp;&amp; f.mbr
        WHERE ST_Covers(b.geom, topology.ST_GetFaceGeometry('topo_boston', f.face_id))
            GROUP BY b.gid) As foo
WHERE foo.gid = bg.gid;
</pre><pre class="programlisting">-- 世界が誤差を完璧に許容することは、ほぼありません。
-- 50%がblockgroupの境界の内側に落ちるフェイスを数えます。
UPDATE boston.blockgroups AS bg
        SET topo = topology.CreateTopoGeom('topo_boston'
        ,3,1
        , foo.bfaces)
FROM (SELECT b.gid,  topology.TopoElementArray_Agg(ARRAY[f.face_id,3]) As bfaces
        FROM boston.blockgroups As b
            INNER JOIN topo_boston.face As f ON b.geom &amp;&amp; f.mbr
        WHERE ST_Covers(b.geom, topology.ST_GetFaceGeometry('topo_boston', f.face_id))
        OR
 (  ST_Intersects(b.geom, topology.ST_GetFaceGeometry('topo_boston', f.face_id))
            AND ST_Area(ST_Intersection(b.geom, topology.ST_GetFaceGeometry('topo_boston', f.face_id) ) ) &gt;
                ST_Area(topology.ST_GetFaceGeometry('topo_boston', f.face_id))*0.5
                )
            GROUP BY b.gid) As foo
WHERE foo.gid = bg.gid;

-- TopoGeometryから、フェイスやエッジに沿うような正規化が
-- なされていないジオメトリに戻すには、topoをジオメトリにキャストします。
-- 新しいジオメトリは、Tigerの道路中心線に沿っていて、とても素晴らしいです。
UPDATE boston.blockgroups SET new_geom = topo::geometry;
</pre></div><div class="refsection"><a name="idp69895552"></a><h2>関連情報</h2><p><a class="xref" href="#AddTopoGeometryColumn" title="AddTopoGeometryColumn">AddTopoGeometryColumn</a>, <a class="xref" href="#toTopoGeom" title="toTopoGeom">toTopoGeom</a> <a class="xref" href="#ST_CreateTopoGeo" title="ST_CreateTopoGeo">ST_CreateTopoGeo</a>, <a class="xref" href="#ST_GetFaceGeometry" title="ST_GetFaceGeometry">ST_GetFaceGeometry</a>, <a class="xref" href="#topoelementarray" title="TopoElementArray">TopoElementArray</a>, <a class="xref" href="#TopoElementArray_Agg" title="TopoElementArray_Agg">TopoElementArray_Agg</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="toTopoGeom"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>toTopoGeom — 単純なジオメトリからTopoGeometryを生成します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">topogeometry <b class="fsfunc">toTopoGeom</b>(</code>geometry  <var class="pdparam">geom</var>, varchar  <var class="pdparam">toponame</var>, integer <var class="pdparam">layer_id</var>, float8 <var class="pdparam">tolerance</var><code>)</code>;</p><p><code class="funcdef">topogeometry <b class="fsfunc">toTopoGeom</b>(</code>geometry  <var class="pdparam">geom</var>, topogeometry  <var class="pdparam">topogeom</var>, float8 <var class="pdparam">tolerance</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69943680"></a><h2>説明</h2><p>単純なジオメトリから<a class="xref" href="#topogeometry" title="TopoGeometry">TopoGeometry</a>を生成します。 </p><p>入力ジオメトリを表現するために必要なトポロジプリミティブが、下位にあるトポロジに追加されます。既存のものを分割することもあります。<code class="varname">relation</code>テーブル内のTopoGeometryの出力に紐づきます。 </p><p>既存のTopoGeometryオブジェクトは形状を維持します (<code class="varname">topogeom</code>が与えられている場合には、それが例外となる可能性があります)。 </p><p><code class="varname">tolerance</code>は、与えられた場合には、入力ジオメトリを既存のプリミティブにスナップさせるために使われます。 </p><p>1番目の形式では、新しいTopoGeometryは、与えられたトポロジ (<code class="varname">toponame</code>)の与えられたレイヤ (<code class="varname">layer_id</code>)に作られます。 </p><p>2番目の形式では、変換結果のプリミティブが、既存のTopoGeometry (<code class="varname">topogeom</code>)に追加されます。また、最終の形状にスペースを追加することがあります。新しい形状を完全に持つには、古いものを入れ替えます。<a class="xref" href="#clearTopoGeom" title="clearTopoGeom">clearTopoGeom</a>を参照して下さい。 </p><p>Availability: 2.0</p><p>Enhanced: 2.1.0版では、既存のTopoGeometryを取る形式が追加されました。</p></div><div class="refsection"><a name="idp69950720"></a><h2>例</h2><p>これは完全に全て揃ったワークフローです。</p><pre class="programlisting">-- トポロジのセットアップがまだ終わっていない場合に実行します。
-- 許容値を許可しません。
SELECT topology.CreateTopology('topo_boston_test', 2249);
-- 新しいテーブルの生成
CREATE TABLE nei_topo(gid serial primary key, nei varchar(30));
-- TopoGeometryカラムの追加
SELECT topology.AddTopoGeometryColumn('topo_boston_test', 'public', 'nei_topo', 'topo', 'MULTIPOLYGON') As new_layer_id;
new_layer_id
-----------
1

-- 新しいTopoGeometryカラムの投入に新しいレイヤIDを使います。
-- TopoGeometryを新しいレイヤに許容値0で追加します。
INSERT INTO nei_topo(nei, topo)
SELECT nei,  topology.toTopoGeom(geom, 'topo_boston_test', 1)
FROM neighborhoods
WHERE gid BETWEEN 1 and 15;

-- 何が発生したかの確認
SELECT * FROM
    topology.TopologySummary('topo_boston_test');

-- 結果--
Topology topo_boston_test (5), SRID 2249, precision 0
61 nodes, 87 edges, 35 faces, 15 topogeoms in 1 layers
Layer 1, type Polygonal (3), 15 topogeoms
 Deploy: public.nei_topo.topo</pre><pre class="programlisting">-- 全てのTopoGeometryポリゴンを10メートル縮小
UPDATE nei_topo SET topo = ST_Buffer(clearTopoGeom(topo), -10);

-- 上の操作で何も無いようになった土地の取得
-- GRASSでは"polygon0 layer"と呼ばれているものと思います
SELECT ST_GetFaceGeometry('topo_boston_test', f.face_id)
  FROM topo_boston_test.face f
  WHERE f.face_id 
&gt; 0 -- don't consider the universe face
  AND NOT EXISTS ( -- check that no TopoGeometry references the face
    SELECT * FROM topo_boston_test.relation
    WHERE layer_id = 1 AND element_id = f.face_id
  );
        </pre></div><div class="refsection"><a name="idp69953152"></a><h2>関連情報</h2><p><a class="xref" href="#CreateTopology" title="CreateTopology">CreateTopology</a>, <a class="xref" href="#AddTopoGeometryColumn" title="AddTopoGeometryColumn">AddTopoGeometryColumn</a>, <a class="xref" href="#CreateTopoGeom" title="CreateTopoGeom">CreateTopoGeom</a>, <a class="xref" href="#TopologySummary" title="TopologySummary">TopologySummary</a>, <a class="xref" href="#clearTopoGeom" title="clearTopoGeom">clearTopoGeom</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="TopoElementArray_Agg"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>TopoElementArray_Agg — element_idとタイプの配列 (topoelements)からなる<code class="varname">topoelementarray</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">topoelementarray <b class="fsfunc">TopoElementArray_Agg</b>(</code>topoelement set <var class="pdparam">tefield</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69969280"></a><h2>説明</h2><p><a class="xref" href="#topoelementarray" title="TopoElementArray">TopoElementArray</a>を<a class="xref" href="#topoelement" title="TopoElement">TopoElement</a>の集合から生成するために使います。</p><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp69971712"></a><h2>例</h2><pre class="programlisting">SELECT topology.TopoElementArray_Agg(ARRAY[e,t]) As tea
  FROM generate_series(1,3) As e CROSS JOIN generate_series(1,4) As t;
  tea
--------------------------------------------------------------------------
{{1,1},{1,2},{1,3},{1,4},{2,1},{2,2},{2,3},{2,4},{3,1},{3,2},{3,3},{3,4}}</pre></div><div class="refsection"><a name="idp69972992"></a><h2>関連情報</h2><p><a class="xref" href="#topoelement" title="TopoElement">TopoElement</a>, <a class="xref" href="#topoelementarray" title="TopoElementArray">TopoElementArray</a></p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="TopoGeometry_Editors"></a>10.10. TopoGeometryエディタ</h2></div><div><div class="abstract"><div class="abstract-title">概要</div><p>本節では、既存のTopoGeometryを編集する関数を挙げます。</p></div></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#clearTopoGeom">clearTopoGeom</a></span><span class="refpurpose"> — TopoGeometryの中身を消去します。</span></dt><dt><span class="refentrytitle"><a href="#TopoGeom_addElement">TopoGeom_addElement</a></span><span class="refpurpose"> — TopoGeometryの定義に要素を追加します。</span></dt><dt><span class="refentrytitle"><a href="#TopoGeom_remElement">TopoGeom_remElement</a></span><span class="refpurpose"> — TopoGeometryの定義から要素を削除します。</span></dt><dt><span class="refentrytitle"><a href="#TopoGeom_addTopoGeom">TopoGeom_addTopoGeom</a></span><span class="refpurpose"> — TopoGeometryの要素を他のTopoGeometryの定義に追加します。</span></dt><dt><span class="refentrytitle"><a href="#toTopoGeom_editor_proxy">toTopoGeom</a></span><span class="refpurpose"> — ジオメトリの形状を既存のTopoGeometryに追加します。</span></dt></dl></div><div class="refentry"><a name="clearTopoGeom"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>clearTopoGeom — TopoGeometryの中身を消去します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">topogeometry <b class="fsfunc">clearTopoGeom</b>(</code>topogeometry  <var class="pdparam">topogeom</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69981184"></a><h2>説明</h2><p><a class="xref" href="#topogeometry" title="TopoGeometry">TopoGeometry</a>の中身を消去し、空にします。<a class="xref" href="#toTopoGeom" title="toTopoGeom">toTopoGeom</a>と併用して、既存オブジェクトと上位にある依存オブジェクトの形状の置換に、だいたい便利です。 </p><p>Availability: 2.1</p></div><div class="refsection"><a name="idp69983616"></a><h2>例</h2><pre class="programlisting">-- 全てのTopoGeometryポリゴンを10メートル縮める
UPDATE nei_topo SET topo = ST_Buffer(clearTopoGeom(topo), -10);
                                </pre></div><div class="refsection"><a name="idp69985152"></a><h2>関連情報</h2><p>
<a class="xref" href="#toTopoGeom" title="toTopoGeom">toTopoGeom</a>
        </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="TopoGeom_addElement"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>TopoGeom_addElement — TopoGeometryの定義に要素を追加します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">topogeometry <b class="fsfunc">TopoGeom_addElement</b>(</code>topogeometry  <var class="pdparam">tg</var>, topoelement  <var class="pdparam">el</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69992192"></a><h2>説明</h2><p><a class="xref" href="#topoelement" title="TopoElement">TopoElement</a>をTopoGeometryオブジェクトの定義に追加します。要素がすでに定義の一部になっていても、エラーは発生しません。 </p><p>Availability: 2.3</p></div><div class="refsection"><a name="idp69994240"></a><h2>例</h2><pre class="programlisting">-- 5番エッジをTopoGeometry tgに追加
UPDATE mylayer SET tg = TopoGeom_addElement(tg, '{5,2}');
                                </pre></div><div class="refsection"><a name="idp69995776"></a><h2>関連情報</h2><p><a class="xref" href="#TopoGeom_remElement" title="TopoGeom_remElement">TopoGeom_remElement</a>, <a class="xref" href="#CreateTopoGeom" title="CreateTopoGeom">CreateTopoGeom</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="TopoGeom_remElement"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>TopoGeom_remElement — TopoGeometryの定義から要素を削除します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">topogeometry <b class="fsfunc">TopoGeom_remElement</b>(</code>topogeometry  <var class="pdparam">tg</var>, topoelement  <var class="pdparam">el</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp70003072"></a><h2>説明</h2><p>TopoGeometryオブジェクトの定義から<a class="xref" href="#topoelement" title="TopoElement">TopoElement</a>を削除します。 </p><p>Availability: 2.3</p></div><div class="refsection"><a name="idp70005248"></a><h2>例</h2><pre class="programlisting">-- TopoGeometry tgから43番フェイスを削除します
UPDATE mylayer SET tg = TopoGeom_remElement(tg, '{43,3}');
                                </pre></div><div class="refsection"><a name="idp70006784"></a><h2>関連情報</h2><p><a class="xref" href="#TopoGeom_addElement" title="TopoGeom_addElement">TopoGeom_addElement</a>, <a class="xref" href="#CreateTopoGeom" title="CreateTopoGeom">CreateTopoGeom</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="TopoGeom_addTopoGeom"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>TopoGeom_addTopoGeom — TopoGeometryの要素を他のTopoGeometryの定義に追加します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">topogeometry <b class="fsfunc">TopoGeom_addTopoGeom</b>(</code>topogeometry  <var class="pdparam">tgt</var>, topogeometry  <var class="pdparam">src</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp70014080"></a><h2>説明</h2><p><a class="xref" href="#topogeometry" title="TopoGeometry">TopoGeometry</a>の要素を他のTopoGeometryの定義に追加します。ソースオブジェクト内にすべての要素を保持する必要がある場合には、キャッシュされたタイプ (type属性)をコレクションに変更する可能性があります。 </p><p>二つのTopoGeometryオブジェクトは*同じ*トポロジに対して定義されている必要があります。また、階層的な定義がある場合には、同じ子レイヤの要素で構成されている必要があります。 </p><p>Availability: 3.2</p></div><div class="refsection"><a name="idp70016512"></a><h2>例</h2><pre class="programlisting">-- 「全体的」なTopoGeometry値を、指定したTopoGeometry値の要素全てで構成する値に設定
UPDATE mylayer SET tg_overall = TopoGeom_addTopogeom(
    TopoGeom_addTopoGeom(
        clearTopoGeom(tg_overall),
        tg_specific1
    ),
    tg_specific2
);
                                </pre></div><div class="refsection"><a name="idp70018048"></a><h2>関連情報</h2><p><a class="xref" href="#TopoGeom_addElement" title="TopoGeom_addElement">TopoGeom_addElement</a>, <a class="xref" href="#clearTopoGeom" title="clearTopoGeom">clearTopoGeom</a>, <a class="xref" href="#CreateTopoGeom" title="CreateTopoGeom">CreateTopoGeom</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="toTopoGeom_editor_proxy"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>toTopoGeom — ジオメトリの形状を既存のTopoGeometryに追加します。</p></div><div class="refsection"><a name="idp70025984"></a><h2>説明</h2><p><a class="xref" href="#toTopoGeom" title="toTopoGeom">toTopoGeom</a>を参照して下さい。 </p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="TopoGeom_Accessors"></a>10.11. TopoGeometryアクセサ</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#GetTopoGeomElementArray">GetTopoGeomElementArray</a></span><span class="refpurpose"> — 与えられたTopoGeometry (プリミティブ要素)のトポロジ要素とタイプを含む<code class="varname">topoelementarray</code> (topoelementの配列)を返します。</span></dt><dt><span class="refentrytitle"><a href="#GetTopoGeomElements">GetTopoGeomElements</a></span><span class="refpurpose"> — 与えられたTopoGeometry (プリミティブ要素)の、トポロジのelement_idとelement_typeを含む<code class="varname">topoelement</code>オブジェクトの集合を返します。</span></dt></dl></div><div class="refentry"><a name="GetTopoGeomElementArray"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>GetTopoGeomElementArray — 与えられたTopoGeometry (プリミティブ要素)のトポロジ要素とタイプを含む<code class="varname">topoelementarray</code> (topoelementの配列)を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">topoelementarray <b class="fsfunc">GetTopoGeomElementArray</b>(</code>varchar  <var class="pdparam">toponame</var>, integer  <var class="pdparam">layer_id</var>, integer <var class="pdparam">tg_id</var><code>)</code>;</p></div><div class="funcsynopsis"><p><code class="funcdef">topoelementarray topoelement <b class="fsfunc">GetTopoGeomElementArray</b>(</code>topogeometry  <var class="pdparam">tg</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp70037632"></a><h2>説明</h2><p>トポロジ要素と与えられたTopoGeometry (プリミティブ要素)のタイプを含む<a class="xref" href="#topoelementarray" title="TopoElementArray">TopoElementArray</a>を返します。GetTopoGeomElementsに近いですが、これは、要素群をデータセットでなく配列で返しています。</p><p>tg_idは、topology.layerテーブル内の<code class="varname">layer_id</code>で指定されたレイヤのトポロジにおけるTopoGeometryオブジェクトの識別番号です。</p><p>Availability: 1.?</p></div><div class="refsection"><a name="idp70040576"></a><h2>例</h2><p></p></div><div class="refsection"><a name="idp70042112"></a><h2>関連情報</h2><p><a class="xref" href="#GetTopoGeomElements" title="GetTopoGeomElements">GetTopoGeomElements</a>, <a class="xref" href="#topoelementarray" title="TopoElementArray">TopoElementArray</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="GetTopoGeomElements"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>GetTopoGeomElements — 与えられたTopoGeometry (プリミティブ要素)の、トポロジのelement_idとelement_typeを含む<code class="varname">topoelement</code>オブジェクトの集合を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">setof topoelement <b class="fsfunc">GetTopoGeomElements</b>(</code>varchar  <var class="pdparam">toponame</var>, integer  <var class="pdparam">layer_id</var>, integer <var class="pdparam">tg_id</var><code>)</code>;</p></div><div class="funcsynopsis"><p><code class="funcdef">setof topoelement <b class="fsfunc">GetTopoGeomElements</b>(</code>topogeometry  <var class="pdparam">tg</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp70053120"></a><h2>説明</h2><p><code class="varname">toponame</code>スキーマ内の、与えられたTopoGeometryのelement_idとelement_type (topoelements)の集合を返します。</p><p>tg_idは、topology.layerテーブル内の<code class="varname">layer_id</code>で指定されたレイヤのトポロジにおけるTopoGeometryオブジェクトの識別番号です。</p><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp70056064"></a><h2>例</h2><p></p></div><div class="refsection"><a name="idp70057600"></a><h2>関連情報</h2><p><a class="xref" href="#GetTopoGeomElementArray" title="GetTopoGeomElementArray">GetTopoGeomElementArray</a>, <a class="xref" href="#topoelement" title="TopoElement">TopoElement</a>, <a class="xref" href="#TopoGeom_addElement" title="TopoGeom_addElement">TopoGeom_addElement</a>, <a class="xref" href="#TopoGeom_remElement" title="TopoGeom_remElement">TopoGeom_remElement</a> </p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="TopoGeometry_Outputs"></a>10.12. TopoGeometry出力</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#AsGML">AsGML</a></span><span class="refpurpose"> — TopoGeometryのGML表現を返します。</span></dt><dt><span class="refentrytitle"><a href="#AsTopoJSON">AsTopoJSON</a></span><span class="refpurpose"> — opoGeometryのTopoJSON表現を返します。</span></dt></dl></div><div class="refentry"><a name="AsGML"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>AsGML — TopoGeometryのGML表現を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">AsGML</b>(</code>topogeometry  <var class="pdparam">tg</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">AsGML</b>(</code>topogeometry  <var class="pdparam">tg</var>, text  <var class="pdparam">nsprefix_in</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">AsGML</b>(</code>topogeometry  <var class="pdparam">tg</var>, regclass  <var class="pdparam">visitedTable</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">AsGML</b>(</code>topogeometry  <var class="pdparam">tg</var>, regclass  <var class="pdparam">visitedTable</var>, text  <var class="pdparam">nsprefix</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">AsGML</b>(</code>topogeometry  <var class="pdparam">tg</var>, text  <var class="pdparam">nsprefix_in</var>, integer  <var class="pdparam">precision</var>, integer  <var class="pdparam">options</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">AsGML</b>(</code>topogeometry  <var class="pdparam">tg</var>, text  <var class="pdparam">nsprefix_in</var>, integer  <var class="pdparam">precision</var>, integer  <var class="pdparam">options</var>, regclass  <var class="pdparam">visitedTable</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">AsGML</b>(</code>topogeometry  <var class="pdparam">tg</var>, text  <var class="pdparam">nsprefix_in</var>, integer  <var class="pdparam">precision</var>, integer  <var class="pdparam">options</var>, regclass  <var class="pdparam">visitedTable</var>, text  <var class="pdparam">idprefix</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">AsGML</b>(</code>topogeometry  <var class="pdparam">tg</var>, text  <var class="pdparam">nsprefix_in</var>, integer  <var class="pdparam">precision</var>, integer  <var class="pdparam">options</var>, regclass  <var class="pdparam">visitedTable</var>, text  <var class="pdparam">idprefix</var>, int  <var class="pdparam">gmlversion</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp70107392"></a><h2>説明</h2><p>GML3の書式でTopoGeometryのGML表現を返します。<code class="varname">nsprefix_in</code>が指定されていない場合には、<code class="varname">gml</code>が使われます。非修飾名前空間を得るにはnsprefixに空文字列を渡します。精度 (デフォルトは15)とoptions (デフォルトは1)パラメタは、与えられた場合には、裏で呼んでいるST_AsGMLにそのまま渡します。</p><p><code class="varname">visitedTable</code>パラメタは、与えられた場合には、訪問したノード要素とエッジ要素のトラックを保持するために使われ、重複定義になるところで相互参照 (xlink:xref)を使います。テーブルは 整数カラムである'element_type'と'element_id'とを持つことを期待されます。この関数を呼び出したユーザは、このテーブルへの読み込み権限と書き込み権限とが必要です。効率よくするには、element_typeとelement_idに、この順序でインデクスを定義します。インデクスは一意制約をカラムに追加すると自動的に生成されます。例を示します。 </p><pre class="programlisting">CREATE TABLE visited (
  element_type integer, element_id integer,
  unique(element_type, element_id)
);
</pre><p>
		</p><p><code class="varname">idprefix</code>パラメタは、指定された場合には、Edgeタグ識別子とNodeタグ識別子の前に付きます。</p><p><code class="varname">gmlver</code>パラメタは、指定された場合には、裏で呼んでいるST_AsGMLに渡されます。デフォルトは3です。</p><p>Availability: 2.0.0 </p></div><div class="refsection"><a name="idp70112768"></a><h2>例</h2><p>ここでは<a class="xref" href="#CreateTopoGeom" title="CreateTopoGeom">CreateTopoGeom</a>で生成したTopoGeometryを使用しています。</p><pre class="programlisting">SELECT topology.AsGML(topo) As rdgml
  FROM ri.roads
  WHERE road_name = 'Unknown';

-- rdgml--
&lt;gml:TopoCurve&gt;
    &lt;gml:directedEdge&gt;
        &lt;gml:Edge gml:id="E1"&gt;
            &lt;gml:directedNode orientation="-"&gt;
                &lt;gml:Node gml:id="N1"/&gt;
            &lt;/gml:directedNode&gt;
            &lt;gml:directedNode
&gt;&lt;/gml:directedNode&gt;
            &lt;gml:curveProperty&gt;
                &lt;gml:Curve srsName="urn:ogc:def:crs:EPSG::3438"&gt;
                    &lt;gml:segments&gt;
                        &lt;gml:LineStringSegment&gt;
                            &lt;gml:posList srsDimension="2"
&gt;384744 236928 384750 236923 384769 236911 384799 236895 384811 236890
                            384833 236884 384844 236882 384866 236881 384879 236883 384954 236898 385087 236932 385117 236938
                            385167 236938 385203 236941 385224 236946 385233 236950 385241 236956 385254 236971
                            385260 236979 385268 236999 385273 237018 385273 237037 385271 237047 385267 237057 385225 237125
                            385210 237144 385192 237161 385167 237192 385162 237202 385159 237214 385159 237227 385162 237241
                            385166 237256 385196 237324 385209 237345 385234 237375 385237 237383 385238 237399 385236 237407
                            385227 237419 385213 237430 385193 237439 385174 237451 385170 237455 385169 237460 385171 237475
                            385181 237503 385190 237521 385200 237533 385206 237538 385213 237541 385221 237542 385235 237540 385242 237541
                            385249 237544 385260 237555 385270 237570 385289 237584 385292 237589 385291 237596 385284 237630&lt;/gml:posList&gt;
                        &lt;/gml:LineStringSegment&gt;
                    &lt;/gml:segments&gt;
                &lt;/gml:Curve&gt;
            &lt;/gml:curveProperty&gt;
        &lt;/gml:Edge&gt;
    &lt;/gml:directedEdge&gt;
&lt;/gml:TopoCurve
&gt;
</pre><p>上の例から名前空間を取った例です。</p><pre class="programlisting">SELECT topology.AsGML(topo,'') As rdgml
  FROM ri.roads
  WHERE road_name = 'Unknown';

-- rdgml--
&lt;TopoCurve&gt;
    &lt;directedEdge&gt;
        &lt;Edge id="E1"&gt;
            &lt;directedNode orientation="-"&gt;
                &lt;Node id="N1"/&gt;
            &lt;/directedNode&gt;
            &lt;directedNode
&gt;&lt;/directedNode&gt;
            &lt;curveProperty&gt;
                &lt;Curve srsName="urn:ogc:def:crs:EPSG::3438"&gt;
                    &lt;segments&gt;
                        &lt;LineStringSegment&gt;
                            &lt;posList srsDimension="2"
&gt;384744 236928 384750 236923 384769 236911 384799 236895 384811 236890
                            384833 236884 384844 236882 384866 236881 384879 236883 384954 236898 385087 236932 385117 236938
                            385167 236938 385203 236941 385224 236946 385233 236950 385241 236956 385254 236971
                            385260 236979 385268 236999 385273 237018 385273 237037 385271 237047 385267 237057 385225 237125
                            385210 237144 385192 237161 385167 237192 385162 237202 385159 237214 385159 237227 385162 237241
                            385166 237256 385196 237324 385209 237345 385234 237375 385237 237383 385238 237399 385236 237407
                            385227 237419 385213 237430 385193 237439 385174 237451 385170 237455 385169 237460 385171 237475
                            385181 237503 385190 237521 385200 237533 385206 237538 385213 237541 385221 237542 385235 237540 385242 237541
                            385249 237544 385260 237555 385270 237570 385289 237584 385292 237589 385291 237596 385284 237630&lt;/posList&gt;
                         &lt;/LineStringSegment&gt;
                    &lt;/segments&gt;
                &lt;/Curve&gt;
            &lt;/curveProperty&gt;
        &lt;/Edge&gt;
    &lt;/directedEdge&gt;
&lt;/TopoCurve
&gt;
</pre></div><div class="refsection"><a name="idp70115968"></a><h2>関連情報</h2><p><a class="xref" href="#CreateTopoGeom" title="CreateTopoGeom">CreateTopoGeom</a>, <a class="xref" href="#ST_CreateTopoGeo" title="ST_CreateTopoGeo">ST_CreateTopoGeo</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="AsTopoJSON"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>AsTopoJSON — opoGeometryのTopoJSON表現を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">AsTopoJSON</b>(</code>topogeometry  <var class="pdparam">tg</var>, regclass  <var class="pdparam">edgeMapTable</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp70180480"></a><h2>説明</h2><p>TopoGeometryのTopoJSON表現を返します。<code class="varname">edgeMapTable</code>がNULLでない場合には、エッジ識別番号とアーク添え字のルックアップと格納のマッピングに使われます。これは、最終的な文書内のコンパクトな"arcs"配列ができるようにするためです。 </p><p>このテーブルは、与えられた場合には、"serial"型の"arc_id"カラムと整数型の"edge_id"とを持つことが期待されます。関数はこのテーブルに"edge_id"を問い合わせるので、このカラムにインデクスを追加することが推奨されます。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>TopoJSONでのアークのインデックスは0始まりですが、"edgeMapTable"テーブルでは1始まりです。 </p></td></tr></table></div><p>完全なTopoJSON文書は、この関数が返すスニペットだけでなく、実際のarcsメンバと、いくつかのヘッダを含む必要があります。 <a class="ulink" href="http://github.com/mbostock/topojson-specification/blob/master/README.md" target="_top">TopoJSON specification</a>をご覧ください。 </p><p>Availability: 2.1.0 </p><p>Enhanced: 2.2.1 点入力に対応するようになりました</p></div><div class="refsection"><a name="idp70185344"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsGeoJSON" title="ST_AsGeoJSON">ST_AsGeoJSON</a></p></div><div class="refsection"><a name="idp70186624"></a><h2>例</h2><pre class="programlisting">CREATE TEMP TABLE edgemap(arc_id serial, edge_id int unique);

-- ヘッダ
SELECT '{ "type": "Topology", "transform": { "scale": [1,1], "translate": [0,0] }, "objects": {'

-- オブジェクトn
UNION ALL SELECT '"' || feature_name || '": ' || AsTopoJSON(feature, 'edgemap')
FROM features.big_parcels WHERE feature_name = 'P3P4';

-- アーク
WITH edges AS (
  SELECT m.arc_id, e.geom FROM edgemap m, city_data.edge e
  WHERE e.edge_id = m.edge_id
), points AS (
  SELECT arc_id, (st_dumppoints(geom)).* FROM edges
), compare AS (
  SELECT p2.arc_id,
         CASE WHEN p1.path IS NULL THEN p2.geom
              ELSE ST_Translate(p2.geom, -ST_X(p1.geom), -ST_Y(p1.geom))
         END AS geom
  FROM points p2 LEFT OUTER JOIN points p1
  ON ( p1.arc_id = p2.arc_id AND p2.path[1] = p1.path[1]+1 )
  ORDER BY arc_id, p2.path
), arcsdump AS (
  SELECT arc_id, (regexp_matches( ST_AsGeoJSON(geom), '\[.*\]'))[1] as t
  FROM compare
), arcs AS (
  SELECT arc_id, '[' || array_to_string(array_agg(t), ',') || ']' as a FROM arcsdump
  GROUP BY arc_id
  ORDER BY arc_id
)
SELECT '}, "arcs": [' UNION ALL
SELECT array_to_string(array_agg(a), E',\n') from arcs

-- フッタ
UNION ALL SELECT ']}'::text as t;

-- 結果 --
{ "type": "Topology", "transform": { "scale": [1,1], "translate": [0,0] }, "objects": {
"P3P4": { "type": "MultiPolygon", "arcs": [[[-1]],[[6,5,-5,-4,-3,1]]]}
}, "arcs": [
 [[25,30],[6,0],[0,10],[-14,0],[0,-10],[8,0]],
 [[35,6],[0,8]],
 [[35,6],[12,0]],
 [[47,6],[0,8]],
 [[47,14],[0,8]],
 [[35,22],[12,0]],
 [[35,14],[0,8]]
 ]}
</pre></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Topology_Relationships"></a>10.13. トポロジ空間関係関数</h2></div><div><div class="abstract"><div class="abstract-title">概要</div><p>本節では、TopoGeometryとトポロジプリミティブとの間の関係を見るトポロジ関数の一覧を挙げます。</p></div></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#TG_Equals">Equals</a></span><span class="refpurpose"> — 二つのTopoGeometryが同じトポロジプリミティブで成っている場合にtrueを返します。</span></dt><dt><span class="refentrytitle"><a href="#TG_Intersects">Intersects</a></span><span class="refpurpose"> — 二つのTopoGeometryからのプリミティブの組がインタセクトする場合にtrueを返します。</span></dt></dl></div><div class="refentry"><a name="TG_Equals"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Equals — 二つのTopoGeometryが同じトポロジプリミティブで成っている場合にtrueを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">Equals</b>(</code>topogeometry  <var class="pdparam">tg1</var>, topogeometry  <var class="pdparam">tg2</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp70207744"></a><h2>説明</h2><p>二つTopoGeometryが同じトポロジプリミティブで成っている場合にtrueを返します。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はジオメトリコレクションのTopoGeometryに対応していません。異なるトポロジからなるTopoGeometryとの比較もできません。</p></td></tr></table></div><p>Availability: 1.1.0 </p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp70212224"></a><h2>例</h2><pre class="programlisting"></pre></div><div class="refsection"><a name="idp70213760"></a><h2>関連情報</h2><p><a class="xref" href="#GetTopoGeomElements" title="GetTopoGeomElements">GetTopoGeomElements</a>, <a class="xref" href="#">???</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="TG_Intersects"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Intersects — 二つのTopoGeometryからのプリミティブの組がインタセクトする場合にtrueを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">Intersects</b>(</code>topogeometry  <var class="pdparam">tg1</var>, topogeometry  <var class="pdparam">tg2</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp70221056"></a><h2>説明</h2><p>二つのTopoGeometryからのプリミティブがインタセクトする場合にtrueを返します。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はジオメトリコレクションのTopoGeometryに対応していません。異なるトポロジからなるTopoGeometryとの比較もできません。また、現在のところ、階層TopoGeometry (他のTopoGeometryからなるTopoGeometry)に対応していません。</p></td></tr></table></div><p>Availability: 1.1.0 </p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp70225536"></a><h2>例</h2><pre class="programlisting"></pre></div><div class="refsection"><a name="idp70227072"></a><h2>関連情報</h2><p><a class="xref" href="#">???</a></p></div></div></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="using_raster_dataman"></a>第11章 ラスタデータの管理、クエリ、アプリケーション</h1></div></div></div><div class="toc"><div class="toc-title">目次</div><dl class="toc"><dt><span class="sect1"><a href="#RT_Loading_Rasters">11.1. ラスタのロードと生成</a></span></dt><dd><dl><dt><span class="sect2"><a href="#RT_Raster_Loader">11.1.1. raster2pgsqlを使ってラスタをロードする</a></span></dt><dt><span class="sect2"><a href="#RT_Creating_Rasters">11.1.2. PostGISラスタ関数を用いたラスタの生成</a></span></dt><dt><span class="sect2"><a href="#RT_Cloud_Rasters">11.1.3. 「データベース外」クラウドラスタの使用</a></span></dt></dl></dd><dt><span class="sect1"><a href="#RT_Raster_Catalog">11.2. ラスタカタログ</a></span></dt><dd><dl><dt><span class="sect2"><a href="#RT_Raster_Columns">11.2.1. ラスタカラムカタログ</a></span></dt><dt><span class="sect2"><a href="#RT_Raster_Overviews">11.2.2. ラスタオーバビュー</a></span></dt></dl></dd><dt><span class="sect1"><a href="#RT_Raster_Applications">11.3. PostGISラスタを使ったカスタムアプリケーションの構築</a></span></dt><dd><dl><dt><span class="sect2"><a href="#RT_PHP_Output">11.3.1. ST_AsPNG を他の関数とあわせて使った PHP 出力例</a></span></dt><dt><span class="sect2"><a href="#RT_Net_Output_CS">11.3.2. ST_AsPNGを他の関数とあわせて使ったASP.NET C#出力例</a></span></dt><dt><span class="sect2"><a href="#RT_Java_Console_App">11.3.3. rasterクエリを画像ファイルで出力するJavaコンソールアプリケーション</a></span></dt><dt><span class="sect2"><a href="#RT_PLPython">11.3.4. PLPython を使って SQL を介して画像をダンプする</a></span></dt><dt><span class="sect2"><a href="#RasterOutput_PSQL">11.3.5. PSQLでラスタを出力する</a></span></dt></dl></dd></dl></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="RT_Loading_Rasters"></a>11.1. ラスタのロードと生成</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="#RT_Raster_Loader">11.1.1. raster2pgsqlを使ってラスタをロードする</a></span></dt><dt><span class="sect2"><a href="#RT_Creating_Rasters">11.1.2. PostGISラスタ関数を用いたラスタの生成</a></span></dt><dt><span class="sect2"><a href="#RT_Cloud_Rasters">11.1.3. 「データベース外」クラウドラスタの使用</a></span></dt></dl></div><p><code class="varname">raster2pgsql</code>ラスタローダを使ってPostGISラスタを既存のラスタファイルからロードするのは、最もよく行われます。</p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="RT_Raster_Loader"></a>11.1.1. raster2pgsqlを使ってラスタをロードする</h3></div></div></div><p><code class="varname">raster2pgsql</code>は、GDALがサポートするラスタ書式をPostGISラスタテーブルにロードするのに適切なSQLにするバイナリファイルです。ラスタのオーバビューの生成だけでなく、ラスタファイルのフォルダのロードも可能です。 </p><p>raster2pgsqlは、多くの場合 (別のGDALライブラリをコンパイルしていない場合)、PostGISの一部としてコンパイルされるので、実行ファイルがサポートするラスタタイプは依存ライブラリGDALでコンパイルされたものと同じになります。raster2pgsqlが対応するラスタタイプの一覧を得るには、<code class="varname">-G</code>スイッチを使います。同じGDALライブラリを使っている場合には、<a class="xref" href="#RT_ST_GDALDrivers" title="ST_GDALDrivers">ST_GDALDrivers</a>で示される,、インストールしたPostGISが提供するものと同じです。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>このツールの古い版では、Pythonスクリプトでした。実行ファイルに置き換えられています。Pythonスクリプトが必要な場合は、 <a class="ulink" href="http://trac.osgeo.org/gdal/wiki/frmts_wtkraster.html" target="_top">GDAL PostGIS Raster Driver Usage</a>に、Pythonの例があります。raster2pgsqlのPythonスクリプトは、今後のPostGIS rasterでは動作しないかも知れませんし、サポートされませんので、ご注意ください。 </p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>同じアラインメントを持つラスタの集合から特定の要素のオーバビューを生成する時、オーバビューが同じアラインメントを持たないことがあります。オーバビューが同じアラインメントを持たない例については<a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1764" target="_top">http://trac.osgeo.org/postgis/ticket/1764</a>をご覧下さい。</p></td></tr></table></div><p>使用例: </p><pre class="programlisting">raster2pgsql <code class="varname">raster_options_go_here</code> <code class="varname">raster_file</code> <code class="varname">someschema</code>.<code class="varname">sometable</code> &gt; out.sql</pre><p>
    </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">-?</span></dt><dd><p>ヘルプを表示します。引数を全く指定しない場合にも表示されます。 </p></dd><dt><span class="term">-G</span></dt><dd><p>サポートされているラスタ書式を印字します。 </p></dd><dt><span class="term">(c|a|d|p) 相互に排他的なオプションです</span></dt><dd><p>
              </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">-c</span></dt><dd><p>新しいテーブルを生成し、ラスタを入れます。<span class="emphasis"><em>これがデフォルトモードです</em></span>。 </p></dd><dt><span class="term">-a</span></dt><dd><p>既存のテーブルにラスタを追加します。  </p></dd><dt><span class="term">-d</span></dt><dd><p>テーブルを削除し、新しいテーブルを生成し、ラスタを入れます。 </p></dd><dt><span class="term">-p</span></dt><dd><p>準備モード、テーブルを作るだけです。 </p></dd></dl></div><p>
            </p></dd><dt><span class="term">ラスタ処理: ラスタカタログに適切に登録するための制約の適用</span></dt><dd><p>
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">-C </span></dt><dd><p>SRIDやピクセルサイズ等のラスタ制約を適用して、<code class="varname">raster_columns</code>ビューで適切な登録ができるようにします。 </p></dd><dt><span class="term">-x </span></dt><dd><p>制約の最大範囲を無効にします。-Cフラグが使われている場合のみ適用されます。 </p></dd><dt><span class="term">-r </span></dt><dd><p>正規ブロック制約 (空間的に一意で網羅タイル)を適用します。-Cフラグが使用されている場合のみ適用されます。 </p></dd></dl></div><p>
				</p></dd><dt><span class="term">ラスタ処理: 入力ラスタデータセットの操作に使われる追加的なパラメータ</span></dt><dd><p>
            </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">-s &lt;SRID&gt;</span></dt><dd><p>出力ラスタを指定されたSRIDにします。 指定しないか0を指定した場合、ラスタのメタデータに対して、適切なSRIDを決定するためのチェックを行います。 </p></dd><dt><span class="term">-b BAND</span></dt><dd><p>ラスタから抽出するバンドのインデクス (1始まり)。1より多いバンドを抽出するには、コンマ(,)で区切ります。指定しない場合、全てのバンドが抽出されます。 </p></dd><dt><span class="term">-t TILE_SIZE</span></dt><dd><p>行毎に挿入するラスタを切断します。<code class="varname">TILE_SIZE</code>は、「幅x高さ」で表現しますが、"auto"を指定すると、最初のラスタを使って適切なタイルサイズが計算され、全てのラスタに適用されます。 </p></dd><dt><span class="term">-P</span></dt><dd><p>全てのタイルが同じ幅と高さを持つことを保証するために、右端、下端のタイルに詰め物を施します。 </p></dd><dt><span class="term">-R, --register</span></dt><dd><p>ファイルシステム (データベース外)ラスタとして、ラスタを登録します。</p><p>データベースには、ラスタのメタデータとラスタのファイルパスのみ格納されます (ピクセルは格納されません)。</p></dd><dt><span class="term"><code class="code">-l</code> <code class="varname">OVERVIEW_FACTOR</code></span></dt><dd><p>ラスタのオーバビューを生成します。一つより多い係数を用いる場合は、コンマ (,) で区切ります。オーバビューのテーブル名はo_<code class="varname">overview factor</code>_<code class="varname">table</code>となります。<code class="varname">overview factor</code>にはオーバビュー係数が入り、<code class="varname">table</code>には基底テーブル名が入ります。生成されるオーバビューはデータベースに格納され、-Rは無視されます。生成されたSQLファイルは元データのテーブルとオーバビューテーブルの両方を含むことに注意して下さい。</p></dd><dt><span class="term">-N <code class="varname">NODATA</code></span></dt><dd><p>NODATA値を持たないバンドで使用するNODATA値を設定します。 </p></dd></dl></div><p>
            </p></dd><dt><span class="term">テータベースオブジェクトの操作に使われる追加的なパラメータ</span></dt><dd><p>
              </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">-f COLUMN</span></dt><dd><p>出力先ラスタカラムの名前を指定します。デフォルトは'rast'です。 </p></dd><dt><span class="term">-F</span></dt><dd><p>ファイル名でカラムを追加します。</p></dd><dt><span class="term">-n COLUMN</span></dt><dd><p>ファイル名カラムの名前を指定します。-Fを暗に含みます。</p></dd><dt><span class="term">-q</span></dt><dd><p>PostgreSQL識別子に引用符を付けます。</p></dd><dt><span class="term">-I</span></dt><dd><p>ラスタカラムにGiSTインデクスを生成します。 </p></dd><dt><span class="term">-M</span></dt><dd><p>ラスタテーブルにvacuum analyzeを行います。 </p></dd><dt><span class="term">-k</span></dt><dd><p>バンドごとのNODATA値のチェックを省略します。 </p></dd><dt><span class="term">-T <code class="varname">tablespace</code></span></dt><dd><p>生成されるテーブルのテーブルスペースを指定します。-Xフラグを併用しない場合には、インデクス (主キーを含む)はデフォルトのテーブルスペースを使用することにご注意ください。 </p></dd><dt><span class="term">-X <code class="varname">tablespace</code></span></dt><dd><p>テーブルの新しいインデクスに使うテーブル空間を指定します。主キーに適用され、-Iフラグがある場合においては空間インデクスにも適用されます。 </p></dd><dt><span class="term">-Y</span></dt><dd><p>INSERTステートメントでなくCOPYステートメントを使います。</p></dd></dl></div><p>
            </p></dd><dt><span class="term">-e</span></dt><dd><p>ステートメント毎に実行して、トランザクションを使用しないようにします。</p></dd><dt><span class="term">-E ENDIAN</span></dt><dd><p>生成されるラスタのバイナリ出力のエンディアンを制御します。XDR (訳注: ビッグエンディアン)の場合は0を、NDR (訳注:リトルエンディアン)の場合は1を、それぞれ指定します。デフォルトは1です。現時点ではNDR出力のみサポートします。</p></dd><dt><span class="term">-V <code class="varname">version</code></span></dt><dd><p>出力書式の版を指定します。デフォルトは0です。現時点では0のみサポートします。</p></dd></dl></div><p>ローダを用いて入力ファイルを100x100のタイルで生成して、データベースにアップロードする例は、次の通りです。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">public.demelevation</code>でなく<code class="varname">demelevation</code> というようにスキーマ名を外すことができます。この場合、ラスタテーブルはデータベースまたユーザの指定するデフォルトのスキーマに生成されます。</p></td></tr></table></div><pre class="programlisting">raster2pgsql -s 4326 -I -C -M *.tif -F -t 100x100 public.demelevation 
&gt; elev.sql
psql -d gisdb -f elev.sql</pre><p>変換とアップロードはUNIXのパイプを使うと一回で実行できます。</p><pre class="programlisting">raster2pgsql -s 4326 -I -C -M *.tif -F -t 100x100 public.demelevation | psql -d gisdb</pre><p>マサチューセッツ州平面のメートル単位の空中写真タイルを<code class="varname">aerial</code>という名前のスキーマにロードします。 元の画像と2, 4レベルのオーバビューのテーブルとを生成します。 データ格納にCOPYを使用し (データベースに仲介ファイルなくまっすぐ入ります)、-eでトランザクションを指定しないようにします (待たずにテーブルのデータを見たい場合には良いです)。ラスタを128x128ピクセルのタイルに分解してラスタ制約を適用します。INSERTモードでなくCOPYモードを使用します。-Fで、カラム名をタイル切り出し元ファイルのファイル名にします。</p><pre class="programlisting">raster2pgsql -I -C -e -Y -F -s 26986 -t 128x128  -l 2,4 bostonaerials2008/*.jpg aerials.boston | psql -U postgres -d gisdb -h localhost -p 5432</pre><pre class="programlisting">-- サポートされているラスタタイプの一覧:
raster2pgsql -G</pre><p>-Gコマンドの出力は次のようになります。 </p><pre class="screen">Available GDAL raster formats:
  Virtual Raster
  GeoTIFF
  National Imagery Transmission Format
  Raster Product Format TOC format
  ECRG TOC format
  Erdas Imagine Images (.img)
  CEOS SAR Image
  CEOS Image
  JAXA PALSAR Product Reader (Level 1.1/1.5)
  Ground-based SAR Applications Testbed File Format (.gff)
  ELAS
  Arc/Info Binary Grid
  Arc/Info ASCII Grid
  GRASS ASCII Grid
  SDTS Raster
  DTED Elevation Raster
  Portable Network Graphics
  JPEG JFIF
  In Memory Raster
  Japanese DEM (.mem)
  Graphics Interchange Format (.gif)
  Graphics Interchange Format (.gif)
  Envisat Image Format
  Maptech BSB Nautical Charts
  X11 PixMap Format
  MS Windows Device Independent Bitmap
  SPOT DIMAP
  AirSAR Polarimetric Image
  RadarSat 2 XML Product
  PCIDSK Database File
  PCRaster Raster File
  ILWIS Raster Map
  SGI Image File Format 1.0
  SRTMHGT File Format
  Leveller heightfield
  Terragen heightfield
  USGS Astrogeology ISIS cube (Version 3)
  USGS Astrogeology ISIS cube (Version 2)
  NASA Planetary Data System
  EarthWatch .TIL
  ERMapper .ers Labelled
  NOAA Polar Orbiter Level 1b Data Set
  FIT Image
  GRIdded Binary (.grb)
  Raster Matrix Format
  EUMETSAT Archive native (.nat)
  Idrisi Raster A.1
  Intergraph Raster
  Golden Software ASCII Grid (.grd)
  Golden Software Binary Grid (.grd)
  Golden Software 7 Binary Grid (.grd)
  COSAR Annotated Binary Matrix (TerraSAR-X)
  TerraSAR-X Product
  DRDC COASP SAR Processor Raster
  R Object Data Store
  Portable Pixmap Format (netpbm)
  USGS DOQ (Old Style)
  USGS DOQ (New Style)
  ENVI .hdr Labelled
  ESRI .hdr Labelled
  Generic Binary (.hdr Labelled)
  PCI .aux Labelled
  Vexcel MFF Raster
  Vexcel MFF2 (HKV) Raster
  Fuji BAS Scanner Image
  GSC Geogrid
  EOSAT FAST Format
  VTP .bt (Binary Terrain) 1.3 Format
  Erdas .LAN/.GIS
  Convair PolGASP
  Image Data and Analysis
  NLAPS Data Format
  Erdas Imagine Raw
  DIPEx
  FARSITE v.4 Landscape File (.lcp)
  NOAA Vertical Datum .GTX
  NADCON .los/.las Datum Grid Shift
  NTv2 Datum Grid Shift
  ACE2
  Snow Data Assimilation System
  Swedish Grid RIK (.rik)
  USGS Optional ASCII DEM (and CDED)
  GeoSoft Grid Exchange Format
  Northwood Numeric Grid Format .grd/.tab
  Northwood Classified Grid Format .grc/.tab
  ARC Digitized Raster Graphics
  Standard Raster Product (ASRP/USRP)
  Magellan topo (.blx)
  SAGA GIS Binary Grid (.sdat)
  Kml Super Overlay
  ASCII Gridded XYZ
  HF2/HFZ heightfield raster
  OziExplorer Image File
  USGS LULC Composite Theme Grid
  Arc/Info Export E00 GRID
  ZMap Plus Grid
  NOAA NGS Geoid Height Grids</pre></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="RT_Creating_Rasters"></a>11.1.2. PostGISラスタ関数を用いたラスタの生成</h3></div></div></div><p>データベース内でラスタやラスタテーブルを生成したい場合が多くあります。これを行うための関数が多数あります。一般的な手順は次の通りです。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>新しいラスタ行を保持するためのラスタカラムを持つテーブルを生成します。次を実行します。</p><pre class="programlisting">CREATE TABLE myrasters(rid serial primary key, rast raster);</pre></li><li class="listitem"><p>この目標で助けとなる関数は多数あります。他のラスタの派生でないラスタを生成する場合、<a class="xref" href="#RT_ST_MakeEmptyRaster" title="ST_MakeEmptyRaster">ST_MakeEmptyRaster</a>と<a class="xref" href="#RT_ST_AddBand" title="ST_AddBand">ST_AddBand</a>を順次実行して作業を開始します。</p><p>ジオメトリからラスタを生成することもできます。<a class="xref" href="#RT_ST_AsRaster" title="ST_AsRaster">ST_AsRaster</a>を使います。<a class="xref" href="#RT_ST_Union" title="ST_Union">ST_Union</a>や<a class="xref" href="#RT_ST_MapAlgebraFct2" title="ST_MapAlgebraFct">ST_MapAlgebraFct</a>や、地図解析関数群等といった、他の関数を組み合わせる場合もあります。</p><p>既存テーブルから新しいラスタテーブルを生成するための多数の選択肢があります。たとえば、<a class="xref" href="#RT_ST_Transform" title="ST_Transform">ST_Transform</a>を使って、既存テーブルから異なる投影法のラスタテーブルを生成します。 </p></li><li class="listitem"><p>はじめにテーブルにデータを入れたら、ラスタカラムに空間インデクスを生成したくなるでしょう。次のようにします。</p><pre class="programlisting">CREATE INDEX myrasters_rast_st_convexhull_idx ON myrasters USING gist( ST_ConvexHull(rast) );</pre><p><a class="xref" href="#RT_ST_ConvexHull" title="ST_ConvexHull">ST_ConvexHull</a>を使用していることに注意して下さい。多くのラスタ演算子はラスタの凸包を元にしています。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>2.0より前の PostGIS ラスタは、エンベロープを基本にして、凸包ではありませんでした。空間インデクスを適切に働かせるには、エンベロープを基本にしたインデクスを削除して、凸包を元にしたインデクスに置き換えます。</p></td></tr></table></div></li><li class="listitem"><p><a class="xref" href="#RT_AddRasterConstraints" title="AddRasterConstraints">AddRasterConstraints</a>を用いてラスタ制約を適用します。</p></li></ol></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="RT_Cloud_Rasters"></a>11.1.3. 「データベース外」クラウドラスタの使用</h3></div></div></div><p><code class="varname">raster2pgsql</code>ツールはGDALを使用してラスタデータにアクセスします。また、クラウドの「オブジェクト保存」 (AWS S3やGoogle Cloud Storage等)に<a class="ulink" href="https://gdal.org/user/virtual_file_systems.html#network-based-file-systems" target="_top">リモート格納</a>されたラスタを読む能力という、重要なGDAL機能の利点を享受することができます。 </p><p>クラウドストレージの効率的な仕様には、「クラウド最適化」された書式の使用が必要です。最も知られて幅広く使われているものは、 "<a class="ulink" href="https://gdal.org/drivers/raster/cog.html" target="_top">cloud optimized GeoTIFF</a>"です。JPEGや非タイル化TIFFなどの非クラウド書式を使うと、発揮される能力は非常に貧弱になります。システムがラスタの一部分にアクセスする必要に迫られるたびに全体をダウンロードするためです。 </p><p>まず、ラスタをあなたが選択したクラウドストレージに保存します。保存したら、アクセスに使うURIが得られます。"http"URIか、時々特別なサービスを示すURI ( "s3://bucket/object"等)です。非公開バケットにアクセスするには、接続認証のためのGDALコンフィギュレーションオプションが必要になります。このコマンドはクラウドラスタから<span class="emphasis"><em>読み</em></span>、データベースに<span class="emphasis"><em>書き</em></span>ます。 </p><pre class="programlisting">AWS_ACCESS_KEY_ID=xxxxxxxxxxxxxxxxxxxx \
AWS_SECRET_ACCESS_KEY=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx \
raster2pgsql \
  -s 990000 \
  -t 256x256 \
  -I \
  -R \
  /vsis3/your.bucket.com/your_file.tif \
  your_table \
  | psql your_db</pre><p>テーブルがロードされたら、データベースにリモートラスタらか読むためのアクセス許可を与えます。<a class="xref" href="#postgis_enable_outdb_rasters" title="postgis.enable_outdb_rasters">postgis.enable_outdb_rasters</a>と<a class="xref" href="#postgis_gdal_enabled_drivers" title="postgis.gdal_enabled_drivers">postgis.gdal_enabled_drivers</a>の、二つのアクセス許可を設定します。 </p><pre class="programlisting">SET postgis.enable_outdb_rasters = true;
SET postgis.gdal_enabled_drivers TO 'ENABLE_ALL';
    </pre><p>確実に変更するには、データベースに直接設定します。新しい設定を使うには再接続が必要です。 </p><pre class="programlisting">ALTER DATABASE your_db SET postgis.enable_outdb_rasters = true;
ALTER DATABASE your_db SET postgis.gdal_enabled_drivers TO 'ENABLE_ALL';
    </pre><p>非公開ラスタの場合、クラウドラスタから読み取るアクセスキーを与えなければならない場合があります。<code class="varname">raster2pgsql</code>の書き込みに使用したのと同じキーを、データベース内で<a class="xref" href="#postgis_gdal_vsi_options" title="postgis.gdal_config_options">postgis.gdal_config_options</a>設定と共に使用するように設定できます。<code class="varname">key=value</code>ペアをスペースで区切ることで、複数のオプションを設定できることに注意してください。 </p><pre class="programlisting">SET postgis.gdal_vsi_options = 'AWS_ACCESS_KEY_ID=xxxxxxxxxxxxxxxxxxxx
AWS_SECRET_ACCESS_KEY=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx';</pre><p>データをロードし、パーミッションが設定されると、ラスタテーブルは他のラスタテーブルとおなじように、同じ関数を使って、対話的処理が可能となります。データベースは、ピクセルデータの読み取りが必要なら、クラウドへの接続の全てを扱います。 </p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="RT_Raster_Catalog"></a>11.2. ラスタカタログ</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="#RT_Raster_Columns">11.2.1. ラスタカラムカタログ</a></span></dt><dt><span class="sect2"><a href="#RT_Raster_Overviews">11.2.2. ラスタオーバビュー</a></span></dt></dl></div><p>PostGISが生成する、二つのラスタカタログのビューがあります。両方ともラスタテーブルの制約の中に埋め込まれる情報を用いています。結果として、カタログビューは、テーブル内のラスタデータに制約が働くため、常にラスタデータとの矛盾がありません。 </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><code class="varname">raster_columns</code> ラスタタイプのデータベースにおける全てのラスタテーブルカラムのカタログです。</p></li><li class="listitem"><p><code class="varname">raster_overviews</code> データベース内の、より詳細なテーブルのためのオーバビューを提供するラスタテーブルのカラム全てのカタログです。この種のテーブルは、ロード時に<code class="varname">-l</code>を指定した時に生成されます。</p></li></ol></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="RT_Raster_Columns"></a>11.2.1. ラスタカラムカタログ</h3></div></div></div><p><code class="varname">raster_columns</code>は、ラスタタイプのデータベースにおける全てのラスタテーブルカラムのカタログです。テーブルの制約を使ったビューなので、他のデータベースのバックアップからラスタテーブルをリストアしたとしても、情報は常に矛盾がありません。<code class="varname">raster_columns</code>カタログには次のカラムがあります。</p><p>ローダを使わずにテーブルを生成したり、ロード時に<code class="varname">-C</code> フラグを忘れたりした場合には、事後に<a class="xref" href="#RT_AddRasterConstraints" title="AddRasterConstraints">AddRasterConstraints</a>で制約を強制でき、<code class="varname">raster_columns</code>カタログは、ラスタタイルの共通の情報を登録します。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="varname">r_table_catalog</code> テーブルが存在するデータベースです。これは常に現在のデータベースを読みます。</p></li><li class="listitem"><p><code class="varname">r_table_schema</code> ラスタテーブルが属するデータベーススキーマです。</p></li><li class="listitem"><p><code class="varname">r_table_name</code> ラスタテーブルです。</p></li><li class="listitem"><p><code class="varname">r_raster_column</code> ラスタタイプである<code class="varname">r_table_name</code>テーブルのカラムです。PostGISには、一つのテーブルに複数のラスタカラムを持つことを妨げません。異なるラスタカラムを持つラスタテーブルが、ラスタカラム毎に複数回出現するテーブルを持つことができます。</p></li><li class="listitem"><p><code class="varname">srid</code> ラスタの空間参照系識別番号です。<a class="xref" href="#spatial_ref_sys" title="4.5. 空間参照系">「空間参照系」</a>にあるエントリであるべきです。</p></li><li class="listitem"><p><code class="varname">scale_x</code> 地理空間座標とピクセルの間の拡大縮小係数です。これは、ラスタカラムのすべてのタイルが同じ<code class="varname">scale_x</code>を持ち、制約が適用されている場合のみ出現します。詳細情報については<a class="xref" href="#RT_ST_ScaleX" title="ST_ScaleX">ST_ScaleX</a>を参照してください。</p></li><li class="listitem"><p><code class="varname">scale_y</code> 地理空間座標とピクセルの間の拡大縮小係数です。これは、ラスタカラムのすべてのタイルが同じ<code class="varname">scale_y</code>を持ち、制約が適用されている場合のみ出現します。詳細情報については<a class="xref" href="#RT_ST_ScaleY" title="ST_ScaleY">ST_ScaleY</a>を参照してください。</p></li><li class="listitem"><p><code class="varname">blocksize_x</code> ラスタタイルごとの幅 (横方向のピクセル数)です。詳細情報については<a class="xref" href="#RT_ST_Width" title="ST_Width">ST_Width</a>を参照してください。</p></li><li class="listitem"><p><code class="varname">blocksize_y</code> ラスタタイルごとの高さ (縦方向のピクセル数)です。詳細情報については<a class="xref" href="#RT_ST_Height" title="ST_Height">ST_Height</a>を参照してください。</p></li><li class="listitem"><p><code class="varname">same_alignment</code> 全てのラスタタイルが同じアラインメントを持っているかを示す真偽値です。詳細情報については<a class="xref" href="#RT_ST_SameAlignment" title="ST_SameAlignment">ST_SameAlignment</a>を参照してください。</p></li><li class="listitem"><p><code class="varname">regular_blocking</code> ラスタカラムが空間的に一意かつカバレッジタイルの制約を持つなら、TRUEとなります。その他の場合はFALSEになります。。</p></li><li class="listitem"><p><code class="varname">num_bands</code> ラスタ集合のタイルごとのバンド数。 <a class="xref" href="#RT_ST_NumBands" title="ST_NumBands">ST_NumBands</a></p></li><li class="listitem"><p><code class="varname">pixel_types</code> バンドごとのピクセルタイプを定義する配列です。この配列の要素数はバンド数と同じです。pixel_typesは、<a class="xref" href="#RT_ST_BandPixelType" title="ST_BandPixelType">ST_BandPixelType</a>で定義されるピクセルタイプの一つを取ります。</p></li><li class="listitem"><p><code class="varname">nodata_values</code> バンド毎の<code class="varname">nodata_value</code>を示す倍精度浮動小数点数の配列です。バンド数と同じ配列数となります。これらの値は、バンド毎のほとんどの処理で無視されるべきピクセル値の定義です。これは<a class="xref" href="#RT_ST_BandNoDataValue" title="ST_BandNoDataValue">ST_BandNoDataValue</a>で得られる情報と似ています。</p></li><li class="listitem"><p><code class="varname">out_db</code> ラスタバンドデータがデータベース外で維持されているかを示す真偽値の配列です。この配列の添え字はバンド番号と同じです。</p></li><li class="listitem"><p><code class="varname">extent</code> ラスタ集合における全てのラスタ行の範囲です。集合の範囲を変更するデータを別途ロードする予定である場合、ロード前に<a class="xref" href="#RT_DropRasterConstraints" title="DropRasterConstraints">DropRasterConstraints</a>関数を実行して、ロード後に<a class="xref" href="#RT_AddRasterConstraints" title="AddRasterConstraints">AddRasterConstraints</a>で制約を再適用します。 </p></li><li class="listitem"><p><code class="varname">spatial_index</code> 空間インデクスを持っているかどうかを示す真偽値です。</p></li></ul></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="RT_Raster_Overviews"></a>11.2.2. ラスタオーバビュー</h3></div></div></div><p><code class="varname">raster_overviews</code>は、オーバビューで使われるラスタテーブルカラムに関する情報のカタログで、オーバビューを用いる際に知っておくと便利な情報も持ちます。オーバビューテーブルは<code class="varname">raster_columns</code>と<code class="varname">raster_overviews</code>の両方のカタログに入れられます。オーバビューもラスタの一つであるのは確かですが、より高い解像度テーブルの解像度を落としたカリカチュアになるという特殊な目的を満たすためでもあるからです。ラスタをロードする際に<code class="varname">-l</code>スイッチを使うと、オーバビューが主ラスタテーブルと一緒に生成されます。もしくは、<a class="xref" href="#RT_AddOverviewConstraints" title="AddOverviewConstraints">AddOverviewConstraints</a>を使うと手動で生成できます。</p><p>オーバビューテーブルには、他のラスタテーブルと同じ制約と、オーバビュー特有の制約となる追加情報があります。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">raster_overviews</code>の情報は<code class="varname">raster_columns</code>とは重複しません。<code class="varname">raster_columns</code>にあるオーバビューテーブルに関する情報が必要な場合は、<code class="varname">raster_overviews</code>と<code class="varname">raster_columns</code>とを結合すると、必要な情報の集合を完全に取得することができます。</p></td></tr></table></div><p>オーバビューの主たる理由は次の二つです。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>ズームアウトした際の地図表示を早くするために、元のテーブルの低解像度表現が一般的に使われます。</p></li><li class="listitem"><p>レコード数が少なく、ピクセル毎の適用範囲が広いため、高解像度の元テーブルより計算が一般的に早くなります。計算は高解像度テーブルより精度は落ちますが、大まかな計算には十分でありえます。</p></li></ol></div><p><code class="varname">raster_overviews</code>カタログには、次の情報のカラムがあります。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="varname">o_table_catalog</code> オーバビューテーブルが存在するデータベースです。常に現在のデータベースを読みます。</p></li><li class="listitem"><p><code class="varname">o_table_schema</code> オーバビューラスタテーブルが属するデータベーススキーマです。</p></li><li class="listitem"><p><code class="varname">o_table_name</code> ラスタオーバビューテーブル名です。</p></li><li class="listitem"><p><code class="varname">o_raster_column</code> オーバビューテーブル内のラスタカラムです。</p></li><li class="listitem"><p><code class="varname">r_table_catalog</code> このオーバビューの元となるラスタテーブルのデータベースです。常に現在のデータベースを読みます。</p></li><li class="listitem"><p><code class="varname">r_table_schema</code> このオーバビューの元となるラスタテーブルが属するデータベーススキーマです。</p></li><li class="listitem"><p><code class="varname">r_table_name</code> このオーバビューの元となるラスタテーブルです。</p></li><li class="listitem"><p><code class="varname">r_raster_column</code> このオーバビューの元となるラスタカラムです。</p></li><li class="listitem"><p><code class="varname">overview_factor</code> - オーバビューテーブルのピラミッドレベルです。高い数字ほど解像度が低くなります。raster2pgsqlは、画像のフォルダを渡された場合は、分割して、イメージファイルのオーバビューの計算とロードを行います。レベル1は元ファイルと同じです。レベル2は、元ファイルの4分の1になります。たとえば、5000x5000ピクセルの画像ファイルのフォルダがあるとして、125x125に分ける場合、画像ファイルごとに(5000*5000)/(125*125) = 1600行のレコードを持ち、<code class="varname">o_2</code>テーブル (レベル2)はceiling(1600/Power(2,2)) = 400行、<code class="varname">o_3</code>(レベル3)ではceiling(1600/Power(2,3) ) = 200行のレコードを持ちます。ピクセルがタイルサイズで割り切れない場合、スクラップタイル (完全には値が入っていない)が得られます。raster2pgsqlによって生成される個々のオーバビュータイルは、元となるラスタと同じピクセル数を持ち、個々のピクセルの表現範囲 (オリジナルの Power(2,overview_factor)ピクセル分)が低い解像度になっている点に注意して下さい。</p></li></ul></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="RT_Raster_Applications"></a>11.3. PostGISラスタを使ったカスタムアプリケーションの構築</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="#RT_PHP_Output">11.3.1. ST_AsPNG を他の関数とあわせて使った PHP 出力例</a></span></dt><dt><span class="sect2"><a href="#RT_Net_Output_CS">11.3.2. ST_AsPNGを他の関数とあわせて使ったASP.NET C#出力例</a></span></dt><dt><span class="sect2"><a href="#RT_Java_Console_App">11.3.3. rasterクエリを画像ファイルで出力するJavaコンソールアプリケーション</a></span></dt><dt><span class="sect2"><a href="#RT_PLPython">11.3.4. PLPython を使って SQL を介して画像をダンプする</a></span></dt><dt><span class="sect2"><a href="#RasterOutput_PSQL">11.3.5. PSQLでラスタを出力する</a></span></dt></dl></div><p>PostGISラスタに知られている画像書式でラスタをレンダリングするためのSQL関数があります。このことから多数のレンダリングの選択肢が使えます。たとえば、OpenOffice/LibreOfficeを使ってレンダリングが可能で、<a class="ulink" href="http://www.postgresonline.com/journal/archives/244-Rendering-PostGIS-Raster-graphics-with-LibreOffice-Base-Reports.html" target="_top">Rendering PostGIS Raster graphics with LibreOffice Base Reports</a>にデモンストレーションがあります。さらに、本節で示す通り、多種多様な言語を使用できます。</p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="RT_PHP_Output"></a>11.3.1. ST_AsPNG を他の関数とあわせて使った PHP 出力例</h3></div></div></div><p>本節では、PHPのPostgreSQLドライバと<a class="xref" href="#RT_ST_AsGDALRaster" title="ST_AsGDALRaster">ST_AsGDALRaster</a>等の関数を使って、HTML imgタグに埋め込むことができるPHPリクエストストリームにラスタの1、2、3バンドを出力する方法を示します。</p><p>サンプルクエリでは、 指定したWGS84バウンディングボックスにインタセクトするタイルを取って、 <a class="xref" href="#RT_ST_Union" title="ST_Union">ST_Union</a>でインタセクトしたタイルを結合して全てのバンドを返し、<a class="xref" href="#RT_ST_Transform" title="ST_Transform">ST_Transform</a>でユーザ指定投影法に変換し、<a class="xref" href="#RT_ST_AsPNG" title="ST_AsPNG">ST_AsPNG</a>を使ってPNGで結果を出力するためのラスタ関数群全体をまとめる方法を示します。</p><p>次で示すスクリプトは、</p><pre class="programlisting">http://mywebserver/test_raster.php?srid=2249</pre><p>で、マサチューセッツ州平面 (フィート単位)のラスタ画像を取得するものです。</p><pre class="programlisting">&lt;?php
/** test_raster.phpのコンテンツ **/
$conn_str ='dbname=mydb host=localhost port=5432 user=myuser password=mypwd';
$dbconn = pg_connect($conn_str);
header('Content-Type: image/png');
/** 特定の投影法が要求された場合にはそれを使い、それ以外ではメートル単位マサチューセッツ州平面を使います **/
if (!empty( $_REQUEST['srid'] ) &amp;&amp; is_numeric( $_REQUEST['srid']) ){
                $input_srid = intval($_REQUEST['srid']);
}
else { $input_srid = 26986; }
/** set bytea_outputは、PostgreSQL 9.0以上で必要になるかも知れませんが、8.4では不要です **/
$sql = "set bytea_output='escape';
SELECT ST_AsPNG(ST_Transform(
                        ST_AddBand(ST_Union(rast,1), ARRAY[ST_Union(rast,2),ST_Union(rast,3)])
                                ,$input_srid) ) As new_rast
 FROM aerials.boston
        WHERE
         ST_Intersects(rast, ST_Transform(ST_MakeEnvelope(-71.1217, 42.227, -71.1210, 42.218,4326),26986) )";
$result = pg_query($sql);
$row = pg_fetch_row($result);
pg_free_result($result);
if ($row === false) return;
echo pg_unescape_bytea($row[0]);
?&gt;</pre></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="RT_Net_Output_CS"></a>11.3.2. ST_AsPNGを他の関数とあわせて使ったASP.NET C#出力例</h3></div></div></div><p>本節では、Npgsql PostgreSQL .NETドライバと<a class="xref" href="#RT_ST_AsGDALRaster" title="ST_AsGDALRaster">ST_AsGDALRaster</a>等の関数を使って、HTML imgタグに埋め込むことができるように、ラスタの1、2、3バンドを出力する方法を示します。</p><p>この例ではNpgsql .NET PostgreSQLドライバが必要です。最新版は<a class="ulink" href="http://npgsql.projects.postgresql.org/" target="_top">http://npgsql.projects.postgresql.org/</a>にあります。最新版をダウンロードして、ASP.NET の binフォルダに入れるだけでうまくいきます。</p><p>サンプルクエリでは、 指定したWGS84バウンディングボックスにインタセクトするタイルを取って、 <a class="xref" href="#RT_ST_Union" title="ST_Union">ST_Union</a>でインタセクトしたタイルを結合して全てのバンドを返し、<a class="xref" href="#RT_ST_Transform" title="ST_Transform">ST_Transform</a>でユーザ指定投影法に変換し、<a class="xref" href="#RT_ST_AsPNG" title="ST_AsPNG">ST_AsPNG</a>を使ってPNGで結果を出力するためのラスタ関数群全体をまとめる方法を示します。</p><p>この例はC#で実装している点を除いては<a class="xref" href="#RT_PHP_Output" title="11.3.1. ST_AsPNG を他の関数とあわせて使った PHP 出力例">「ST_AsPNG を他の関数とあわせて使った PHP 出力例」</a>と同じです。</p><p>次で示すスクリプトは、</p><pre class="programlisting">http://mywebserver/TestRaster.ashx?srid=2249</pre><p>で、マサチューセッツ州平面 (フィート単位)のラスタ画像を取得します。</p><pre class="programlisting">-- web.config 接続文字列部 --
&lt;connectionStrings&gt;
    &lt;add name="DSN"
        connectionString="server=localhost;database=mydb;Port=5432;User Id=myuser;password=mypwd"/&gt;
&lt;/connectionStrings
&gt;</pre><pre class="programlisting">// TestRaster.ashxのコード
&lt;%@ WebHandler Language="C#" Class="TestRaster" %&gt;
using System;
using System.Data;
using System.Web;
using Npgsql;

public class TestRaster : IHttpHandler
{
        public void ProcessRequest(HttpContext context)
        {

                context.Response.ContentType = "image/png";
                context.Response.BinaryWrite(GetResults(context));

        }

        public bool IsReusable {
                get { return false; }
        }

        public byte[] GetResults(HttpContext context)
        {
                byte[] result = null;
                NpgsqlCommand command;
                string sql = null;
                int input_srid = 26986;
        try {
                    using (NpgsqlConnection conn = new NpgsqlConnection(System.Configuration.ConfigurationManager.ConnectionStrings["DSN"].ConnectionString)) {
                            conn.Open();

                if (context.Request["srid"] != null)
                {
                    input_srid = Convert.ToInt32(context.Request["srid"]);
                }
                sql = @"SELECT ST_AsPNG(
                            ST_Transform(
                                        ST_AddBand(
                                ST_Union(rast,1), ARRAY[ST_Union(rast,2),ST_Union(rast,3)])
                                                    ,:input_srid) ) As new_rast
                        FROM aerials.boston
                                WHERE
                                    ST_Intersects(rast,
                                    ST_Transform(ST_MakeEnvelope(-71.1217, 42.227, -71.1210, 42.218,4326),26986) )";
                            command = new NpgsqlCommand(sql, conn);
                command.Parameters.Add(new NpgsqlParameter("input_srid", input_srid));


                            result = (byte[]) command.ExecuteScalar();
                conn.Close();
                        }

                }
        catch (Exception ex)
        {
            result = null;
            context.Response.Write(ex.Message.Trim());
        }
                return result;
        }
}</pre></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="RT_Java_Console_App"></a>11.3.3. rasterクエリを画像ファイルで出力するJavaコンソールアプリケーション</h3></div></div></div><p>これは、一つの画像を返すクエリを取り、指定したファイルに出力する、簡単なJavaコンソールアプリケーションです。</p><p>最新のPostgreSQL JDBCドライバは<a class="ulink" href="http://jdbc.postgresql.org/download.html" target="_top">http://jdbc.postgresql.org/download.html</a>からダウンロードできます。 </p><p>あとで示すコードをコンパイルします。コマンドは次の通りです。</p><pre class="programlisting">set env CLASSPATH .:..\postgresql-9.0-801.jdbc4.jar
javac SaveQueryImage.java
jar cfm SaveQueryImage.jar Manifest.txt *.class</pre><p>次のようにコマンドラインから呼び出します。</p><pre class="programlisting">java -jar SaveQueryImage.jar "SELECT ST_AsPNG(ST_AsRaster(ST_Buffer(ST_Point(1,5),10, 'quad_segs=2'),150, 150, '8BUI',100));" "test.png" </pre><pre class="programlisting">-- Manifest.txt --
Class-Path: postgresql-9.0-801.jdbc4.jar
Main-Class: SaveQueryImage</pre><pre class="programlisting">// SaveQueryImage.javaのコード
import java.sql.Connection;
import java.sql.SQLException;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.io.*;

public class SaveQueryImage {
  public static void main(String[] argv) {
      System.out.println("Checking if Driver is registered with DriverManager.");

      try {
        //java.sql.DriverManager.registerDriver (new org.postgresql.Driver());
        Class.forName("org.postgresql.Driver");
      }
      catch (ClassNotFoundException cnfe) {
        System.out.println("Couldn't find the driver!");
        cnfe.printStackTrace();
        System.exit(1);
      }

      Connection conn = null;

      try {
        conn = DriverManager.getConnection("jdbc:postgresql://localhost:5432/mydb","myuser", "mypwd");
        conn.setAutoCommit(false);

        PreparedStatement sGetImg = conn.prepareStatement(argv[0]);

        ResultSet rs = sGetImg.executeQuery();

                FileOutputStream fout;
                try
                {
                        rs.next();
                        /** Output to file name requested by user **/
                        fout = new FileOutputStream(new File(argv[1]) );
                        fout.write(rs.getBytes(1));
                        fout.close();
                }
                catch(Exception e)
                {
                        System.out.println("Can't create file");
                        e.printStackTrace();
                }

        rs.close();
                sGetImg.close();
        conn.close();
      }
      catch (SQLException se) {
        System.out.println("Couldn't connect: print out a stack trace and exit.");
        se.printStackTrace();
        System.exit(1);
      }
  }
}</pre></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="RT_PLPython"></a>11.3.4. PLPython を使って SQL を介して画像をダンプする</h3></div></div></div><p>これは、サーバディレクトリ内でレコードごとにファイルを生成するPythonストアド関数です。plpythonが必要です。plpythonuとplpython3uの両方が正しく動作します。</p><pre class="programlisting">CREATE OR REPLACE FUNCTION write_file (param_bytes bytea, param_filepath text)
RETURNS text
AS $$
f = open(param_filepath, 'wb+')
f.write(param_bytes)
return param_filepath
$$ LANGUAGE plpythonu;</pre><pre class="programlisting">-- 5つの画像をPostgreSQLサーバに可変サイズで描きます。
-- PostgreSQLデーモンのアカウントにフォルダへの書き込み権限が必要ですので
-- ご注意ください。
-- 生成されたファイル名をエコーバックします。
 SELECT write_file(ST_AsPNG(
        ST_AsRaster(ST_Buffer(ST_Point(1,5),j*5, 'quad_segs=2'),150*j, 150*j, '8BUI',100)),
         'C:/temp/slices'|| j || '.png')
         FROM generate_series(1,5) As j;

     write_file
---------------------
 C:/temp/slices1.png
 C:/temp/slices2.png
 C:/temp/slices3.png
 C:/temp/slices4.png
 C:/temp/slices5.png
</pre></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="RasterOutput_PSQL"></a>11.3.5. PSQLでラスタを出力する</h3></div></div></div><p>PSQLから組み込み機能を用いてバイナリを出力するのは簡単ではありません。ここで紹介する方法は、レガシーなラージオブジェクトをサポートするPostgreSQL上に乗っかる、ちょっとしたハックです。まずは、psqlを起動して、データベースに接続します。 </p><p>この方法はPythonの場合と違い、ローカル機にファイルが生成されます</p><pre class="screen">SELECT oid, lowrite(lo_open(oid, 131072), png) As num_bytes
 FROM
 ( VALUES (lo_create(0),
   ST_AsPNG( (SELECT rast FROM aerials.boston WHERE rid=1) )
  ) ) As v(oid,png);
-- 次のような出力が得られます --
   oid   | num_bytes
---------+-----------
 2630819 |     74860

-- 続いて、oidを書き留めて、'C:/temp/aerial_smap.png'を
-- ローカルのコンピュータ上のファイルパスに置き換えたうえで、
-- 次を実行します。
 \lo_export 2630819 'C:/temp/aerial_samp.png'

-- db上のラージオブジェクトストレージからファイルを削除します
SELECT lo_unlink(2630819);
                        </pre></div></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="RT_reference"></a>第12章 ラスタ リファレンス</h1></div></div></div><div class="toc"><div class="toc-title">目次</div><dl class="toc"><dt><span class="sect1"><a href="#Raster_Types">12.1. ラスタサポートデータ型</a></span></dt><dt><span class="sect1"><a href="#Raster_Management_Functions">12.2. ラスタ管理</a></span></dt><dt><span class="sect1"><a href="#Raster_Constructors">12.3. ラスタコンストラクタ</a></span></dt><dt><span class="sect1"><a href="#Raster_Accessors">12.4. ラスタアクセサ</a></span></dt><dt><span class="sect1"><a href="#RasterBand_Accessors">12.5. ラスタバンドアクセサ</a></span></dt><dt><span class="sect1"><a href="#Raster_Pixel_Accessors">12.6. ラスタピクセルアクセサとセッター</a></span></dt><dt><span class="sect1"><a href="#Raster_Editors">12.7. ラスタエディタ</a></span></dt><dt><span class="sect1"><a href="#RasterBand_Editors">12.8. ラスタバンドエディタ</a></span></dt><dt><span class="sect1"><a href="#RasterBand_Stats">12.9. ラスタバンド統計情報と解析</a></span></dt><dt><span class="sect1"><a href="#Raster_Inputs">12.10. ラスタ入力</a></span></dt><dt><span class="sect1"><a href="#Raster_Outputs">12.11. 出力</a></span></dt><dt><span class="sect1"><a href="#Raster_Processing_MapAlgebra">12.12. ラスタ処理: 地図代数</a></span></dt><dt><span class="sect1"><a href="#Raster_Processing_MapAlgebra_Callbacks">12.13. 組み込み地図代数コールバック関数</a></span></dt><dt><span class="sect1"><a href="#Raster_Processing_DEM">12.14. ラスタ処理: DEM (標高)</a></span></dt><dt><span class="sect1"><a href="#Raster_Processing_Geometry">12.15. ラスタ処理: ラスタからジオメトリ</a></span></dt><dt><span class="sect1"><a href="#RT_Operators">12.16. ラスタ演算子</a></span></dt><dt><span class="sect1"><a href="#Raster_Relationships">12.17. ラスタとラスタバンドの空間関係関数</a></span></dt><dt><span class="sect1"><a href="#Raster_Tips">12.18. ラスタに関する技法</a></span></dt><dd><dl><dt><span class="sect2"><a href="#outdb">12.18.1. データベース外ラスタ</a></span></dt></dl></dd></dl></div><p>ここで挙げる関数は、PostGISラスタにとって必要と思われるもので、現在PostGISラスタで有効なものです。他に、一般的なユーザが利用しない、ラスタオブジェクトに対して求められるサポート関数があります。</p><p><code class="varname">raster</code>は、ラスタデータの格納と分析のための新しいPostGIS型です。 </p><p>ラスタファイルからラスタをロードするには<a class="xref" href="#RT_Loading_Rasters" title="11.1. ラスタのロードと生成">「ラスタのロードと生成」</a>を参照して下さい。</p><p>このリファレンスにおける例ではダミーラスタのラスタテーブルを使っています。ラスタは次のようなコードで形成しています。 </p><pre class="programlisting">CREATE TABLE dummy_rast(rid integer, rast raster);
INSERT INTO dummy_rast(rid, rast)
VALUES (1,
('01' -- little endian - リトルエンディアン (uint8 ndr)
||
'0000' -- version - 版 (uint16 0)
||
'0000' -- nBands - バンド数 (uint16 0)
||
'0000000000000040' -- scaleX - X方向セルサイズ (float64 2)
||
'0000000000000840' -- scaleY - Y方向セルサイズ (float64 3)
||
'000000000000E03F' -- ipX - 左上隅X値 (float64 0.5)
||
'000000000000E03F' -- ipY - 左上隅Y値 (float64 0.5)
||
'0000000000000000' -- skewX - スキューX (float64 0)
||
'0000000000000000' -- skewY - スキューY (float64 0)
||
'00000000' -- SRID (int32 0)
||
'0A00' -- width - 横セル数 (uint16 10)
||
'1400' -- height - 縦セル数 (uint16 20)
)::raster
),
-- Raster: 5 x 5 pixels, 3 bands, PT_8BUI pixel type, NODATA = 0
(2,  ('01000003009A9999999999A93F9A9999999999A9BF000000E02B274A' ||
'41000000007719564100000000000000000000000000000000FFFFFFFF050005000400FDFEFDFEFEFDFEFEFDF9FAFEF' ||
'EFCF9FBFDFEFEFDFCFAFEFEFE04004E627AADD16076B4F9FE6370A9F5FE59637AB0E54F58617087040046566487A1506CA2E3FA5A6CAFFBFE4D566DA4CB3E454C5665')::raster);</pre><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Raster_Types"></a>12.1. ラスタサポートデータ型</h2></div><div><div class="abstract"><div class="abstract-title">概要</div><p>本節では、ラスタ機能をサポートするために作られたPostgreSQLデータ型の一覧を挙げます。</p></div></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#geomval">geomval</a></span><span class="refpurpose"> — geom (ジオメトリオブジェクトを保持)とval (ラスタバンドからのピクセル値を倍精度浮動小数点数で保持)の2フィールドからなるデータ型。</span></dt><dt><span class="refentrytitle"><a href="#addbandarg">addbandarg</a></span><span class="refpurpose"> — ST_AddBandの入力に使われる複合型で、新しいバンドの属性と初期値からなります。</span></dt><dt><span class="refentrytitle"><a href="#rastbandarg">rastbandarg</a></span><span class="refpurpose"> — ラスタとそのバンドインデクスを表現する必要がある時に使われる複合型。</span></dt><dt><span class="refentrytitle"><a href="#raster">raster</a></span><span class="refpurpose"> — ラスタ空間データ型。</span></dt><dt><span class="refentrytitle"><a href="#reclassarg">reclassarg</a></span><span class="refpurpose"> — ST_Reclass関数への入力として使用する複合型です。再分類の挙動を定義します。</span></dt><dt><span class="refentrytitle"><a href="#summarystats">summarystats</a></span><span class="refpurpose"> — ST_SummaryStats関数とST_SummaryStatsAgg関数の出力として使う複合型です。</span></dt><dt><span class="refentrytitle"><a href="#unionarg">unionarg</a></span><span class="refpurpose"> — ST_Union関数の入力に使う複合型です。処理するバンドと結合処理の挙動を定義します。</span></dt></dl></div><div class="refentry"><a name="geomval"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>geomval — geom (ジオメトリオブジェクトを保持)とval (ラスタバンドからのピクセル値を倍精度浮動小数点数で保持)の2フィールドからなるデータ型。</p></div><div class="refsection"><a name="idp71877760"></a><h2>説明</h2><p>geomvalは.geomフィールドで参照されるジオメトリオブジェクトと、特定の地理位置におけるラスタバンドのピクセル値を表現する浮動小数点数のvalからなる複合型です。ポリゴンにラスタバンドを展開するための出力型として、ST_DumpAsPolygonとラスタのインタセクション関連関数群に使われます。</p></div><div class="refsection"><a name="idp71878912"></a><h2>関連情報</h2><p><a class="xref" href="#PostGIS_Geometry_DumpFunctions" title="15.6. PostGISジオメトリ/ジオグラフィ/ラスタのダンプ関数">「PostGISジオメトリ/ジオグラフィ/ラスタのダンプ関数」</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="addbandarg"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>addbandarg — ST_AddBandの入力に使われる複合型で、新しいバンドの属性と初期値からなります。</p></div><div class="refsection"><a name="idp71898368"></a><h2>説明</h2><p>ST_AddBandの入力に使われる複合型で、新しいバンドの属性と初期値からなります。 </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><em class="parameter"><code>index </code></em> <span class="type">integer</span> </span></dt><dd><p>ラスタのバンド群のうち新しいバンドが追加される位置を示す1始まりの値。NULLの場合には、新しいバンドはラスタバンド群の末尾に追加されます。 </p></dd><dt><span class="term"><em class="parameter"><code>pixeltype </code></em> <span class="type">text</span> </span></dt><dd><p>新しいバンドのピクセルタイプ。定義されたピクセルタイプは<a class="xref" href="#RT_ST_BandPixelType" title="ST_BandPixelType">ST_BandPixelType</a>に記述されています。 </p></dd><dt><span class="term"><em class="parameter"><code>initialvalue </code></em> <span class="type">double precision</span> </span></dt><dd><p>新しいバンドに設定する初期値。 </p></dd><dt><span class="term"><em class="parameter"><code>nodataval </code></em> <span class="type">double precision</span> </span></dt><dd><p>新しいバンドのNODATA値。NULLの場合には、新しいバンドにNODATA値を設定しません。 </p></dd></dl></div><p>

                </p></div><div class="refsection"><a name="idp71909504"></a><h2>関連情報</h2><p>
                    <a class="xref" href="#RT_ST_AddBand" title="ST_AddBand">ST_AddBand</a>
                </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="rastbandarg"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>rastbandarg — ラスタとそのバンドインデクスを表現する必要がある時に使われる複合型。</p></div><div class="refsection"><a name="idp71912704"></a><h2>説明</h2><p>ラスタとそのバンドインデクスを表現する必要がある時に使われる複合型。 </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><em class="parameter"><code>rast </code></em> <span class="type">raster</span> </span></dt><dd><p>問題にするラスタ。 </p></dd><dt><span class="term"><em class="parameter"><code>nband </code></em> <span class="type">integer</span> </span></dt><dd><p>ラスタのバンドを示す1始まりの値。 </p></dd></dl></div><p>

                </p></div><div class="refsection"><a name="idp71918848"></a><h2>関連情報</h2><p>
                    <a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>
                </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="raster"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>raster — ラスタ空間データ型。</p></div><div class="refsection"><a name="idp71922048"></a><h2>説明</h2><p>rasterは、JPEG, TIFF, PNG, デジタル標高モデルといったラスタデータを表現する空間データ型です。ラスタはそれぞれ1以上のバンドを持ち、バンドはそれぞれにピクセル値の集合を持ちます。ラスタには地理参照を与えることができます。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>PostGISをGDALサポート付きでコンパイルする必要があります。 現在、ラスタは暗黙にジオメトリ型に変換することができますが、ラスタの<a class="xref" href="#RT_ST_ConvexHull" title="ST_ConvexHull">ST_ConvexHull</a>を返します。この自動キャストは近いうちに削除するかも知れないので、この関数に頼らないようにして下さい。</p></td></tr></table></div></div><div class="refsection"><a name="idp71924352"></a><h2>キャストの挙動</h2><p>本節では、このデータ型で許容される明示的なキャストと自動キャストの一覧を挙げます。</p><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col><col></colgroup><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">キャスト先</td><td style="border-bottom: 1px solid ; ">挙動</td></tr><tr><td style="border-right: 1px solid ; ">geometry</td><td style="">自動</td></tr></tbody></table></div></div><div class="refsection"><a name="idp71929472"></a><h2>関連情報</h2><p><a class="xref" href="#RT_reference" title="第12章 ラスタ リファレンス">12章<i>ラスタ リファレンス</i></a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="reclassarg"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>reclassarg — ST_Reclass関数への入力として使用する複合型です。再分類の挙動を定義します。</p></div><div class="refsection"><a name="idp71932416"></a><h2>説明</h2><p>ST_Reclass関数への入力として使用する複合型です。再分類の挙動を定義します。</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><em class="parameter"><code>nband </code></em><span class="type">integer</span></span></dt><dd><p>再分類対象バンドの番号。</p></dd><dt><span class="term"><em class="parameter"><code>reclassexpr </code></em><span class="type">text</span></span></dt><dd><p>コンマ区切りの範囲表現。古い値から新しい値にマップする方法を定義します。 '('は「これより大きい」、')'は「これより小さい」、'['は「これ以上」、']'は「これ以下」、をそれぞれ示します。</p><pre class="programlisting">1. [a-b] = a &lt;= x &lt;= b

2. (a-b] = a &lt; x &lt;= b

3. [a-b) = a &lt;= x &lt; b

4. (a-b) = a &lt; x &lt; b</pre><p>'('標記はオプションです。'a-b'は'(a-b)'と同じ意味になります。</p></dd><dt><span class="term"><em class="parameter"><code>pixeltype </code></em><span class="type">text</span></span></dt><dd><p><a class="xref" href="#RT_ST_BandPixelType" title="ST_BandPixelType">ST_BandPixelType</a>の記述にあるピクセルタイプの一つ。</p></dd><dt><span class="term"><em class="parameter"><code>nodataval </code></em><span class="type">double precision</span></span></dt><dd><p>NODATAとして扱う値。透過が可能な画像出力では、この値は空白になります。</p></dd></dl></div></div><div class="refsection"><a name="idp71942528"></a><h2>例: 2番バンドを8BUIで255をNODATAに再分類</h2><pre class="programlisting">SELECT ROW(2, '0-100:1-10, 101-500:11-150,501 - 10000: 151-254', '8BUI', 255)::reclassarg;</pre></div><div class="refsection"><a name="idp71943808"></a><h2>例: 1番バンドを1BBでNODATAを定義しないで再分類</h2><pre class="programlisting">SELECT ROW(1, '0-100]:0, (100-255:1', '1BB', NULL)::reclassarg;</pre></div><div class="refsection"><a name="idp71945088"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Reclass" title="ST_Reclass">ST_Reclass</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="summarystats"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>summarystats — ST_SummaryStats関数とST_SummaryStatsAgg関数の出力として使う複合型です。</p></div><div class="refsection"><a name="idp71948032"></a><h2>説明</h2><p><a class="xref" href="#RT_ST_SummaryStats" title="ST_SummaryStats">ST_SummaryStats</a>関数と<a class="xref" href="#RT_ST_SummaryStatsAgg" title="ST_SummaryStatsAgg">ST_SummaryStatsAgg</a>関数の出力として使う複合型です。 </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><em class="parameter"><code>count </code></em> <span class="type">integer</span> </span></dt><dd><p>統計情報で使ったピクセルの数。 </p></dd><dt><span class="term"><em class="parameter"><code>sum </code></em> <span class="type">double precision</span> </span></dt><dd><p>統計情報で使ったピクセルの値の合計。 </p></dd><dt><span class="term"><em class="parameter"><code>mean </code></em> <span class="type">double precision</span> </span></dt><dd><p>統計情報で使ったピクセルの値の平均。 </p></dd><dt><span class="term"><em class="parameter"><code>stddev </code></em> <span class="type">double precision</span> </span></dt><dd><p>統計情報で使ったピクセルの値の標準偏差。 </p></dd><dt><span class="term"><em class="parameter"><code>min </code></em> <span class="type">double precision</span> </span></dt><dd><p>統計情報で使ったピクセルの値の最小値。 </p></dd><dt><span class="term"><em class="parameter"><code>max </code></em> <span class="type">double precision</span> </span></dt><dd><p>統計情報で使ったピクセルの値の最大値。 </p></dd></dl></div><p>

                </p></div><div class="refsection"><a name="idp71976320"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_SummaryStats" title="ST_SummaryStats">ST_SummaryStats</a>, <a class="xref" href="#RT_ST_SummaryStatsAgg" title="ST_SummaryStatsAgg">ST_SummaryStatsAgg</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="unionarg"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>unionarg — ST_Union関数の入力に使う複合型です。処理するバンドと結合処理の挙動を定義します。</p></div><div class="refsection"><a name="idp71983872"></a><h2>説明</h2><p>ST_Union関数の入力に使う複合型です。処理するバンドと結合処理の挙動を定義します。 </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><em class="parameter"><code>nband </code></em> <span class="type">integer</span> </span></dt><dd><p>処理する入力ラスタごとのバンドを示す1始まりの値です。 </p></dd><dt><span class="term"><em class="parameter"><code>uniontype </code></em> <span class="type">text</span> </span></dt><dd><p>結合処理の種別。<a class="xref" href="#RT_ST_Union" title="ST_Union">ST_Union</a>に記述がある、定義された種別のうち一つを取ります。 </p></dd></dl></div><p>

                </p></div><div class="refsection"><a name="idp71994496"></a><h2>関連情報</h2><p>
                    <a class="xref" href="#RT_ST_Union" title="ST_Union">ST_Union</a>
                </p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Raster_Management_Functions"></a>12.2. ラスタ管理</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#RT_AddRasterConstraints">AddRasterConstraints</a></span><span class="refpurpose"> — ロードされたラスタテーブルの特定のカラムにラスタ制約を追加します。制約には空間参照系、スケール、ブロックサイズ、アラインメント、バンド数、バンド型、ラスタカラムが規則正しいブロックかどうかを示すフラグがあります。テーブルは制約が推論されるためのデータがロードされなければなりません。制約の設定が完了するとtrueを返し、問題があると通知を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_DropRasterConstraints">DropRasterConstraints</a></span><span class="refpurpose"> — ラスタテーブルカラムを参照するPostGISラスタ制約を削除します。データの再読み込みやラスタカラムデータの更新の際に使えます。</span></dt><dt><span class="refentrytitle"><a href="#RT_AddOverviewConstraints">AddOverviewConstraints</a></span><span class="refpurpose"> — ラスタカラムに対して、他のオーバビューであることをタグ付けします。</span></dt><dt><span class="refentrytitle"><a href="#RT_DropOverviewConstraints">DropOverviewConstraints</a></span><span class="refpurpose"> — ラスタカラムに対して他のオーバビューであることをタグ付けしているのを解除します。</span></dt><dt><span class="refentrytitle"><a href="#RT_PostGIS_GDAL_Version">PostGIS_GDAL_Version</a></span><span class="refpurpose"> — PostGISで使っているGDALライブラリの版を報告します。</span></dt><dt><span class="refentrytitle"><a href="#RT_PostGIS_Raster_Lib_Build_Date">PostGIS_Raster_Lib_Build_Date</a></span><span class="refpurpose"> — 完全なラスタライブラリをビルドした日付を報告します。</span></dt><dt><span class="refentrytitle"><a href="#RT_PostGIS_Raster_Lib_Version">PostGIS_Raster_Lib_Version</a></span><span class="refpurpose"> — 完全なラスタの版とビルドコンフィギュレーション情報を報告します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_GDALDrivers">ST_GDALDrivers</a></span><span class="refpurpose"> — 使用しているGDALライブラリが対応するラスタ書式の一覧を返します。この一覧でcan_write=TrueとなっているものだけがST_AsGDALRasterで使えます。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Contour">ST_Contour</a></span><span class="refpurpose"> — 与えられたラスタバンドから等高線ベクタを生成します。GDAL等高線生成アルゴリズムを使います。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_InterpolateRaster">ST_InterpolateRaster</a></span><span class="refpurpose"> — X値とY値を使用してグリッド上のポイントを配置し、ポイントのZ値をサーフェス標高として配置し、3次元ポイントの入力セットに基づいてグリッドサーフェスを補間します。 </span></dt><dt><span class="refentrytitle"><a href="#RT_UpdateRasterSRID">UpdateRasterSRID</a></span><span class="refpurpose"> — ユーザが指定したカラムとテーブルにあるラスタの全てについてSRIDを変更します。 </span></dt><dt><span class="refentrytitle"><a href="#RT_CreateOverview">ST_CreateOverview</a></span><span class="refpurpose"> — 与えられたラスタカバレッジから解像度を落としたものを生成します。 </span></dt></dl></div><div class="refentry"><a name="RT_AddRasterConstraints"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>AddRasterConstraints — ロードされたラスタテーブルの特定のカラムにラスタ制約を追加します。制約には空間参照系、スケール、ブロックサイズ、アラインメント、バンド数、バンド型、ラスタカラムが規則正しいブロックかどうかを示すフラグがあります。テーブルは制約が推論されるためのデータがロードされなければなりません。制約の設定が完了するとtrueを返し、問題があると通知を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">AddRasterConstraints</b>(</code>name  <var class="pdparam">rasttable</var>, name  <var class="pdparam">rastcolumn</var>, boolean  <var class="pdparam">srid=true</var>, boolean  <var class="pdparam">scale_x=true</var>, boolean  <var class="pdparam">scale_y=true</var>, boolean  <var class="pdparam">blocksize_x=true</var>, boolean  <var class="pdparam">blocksize_y=true</var>, boolean  <var class="pdparam">same_alignment=true</var>, boolean  <var class="pdparam">regular_blocking=false</var>, boolean  <var class="pdparam">num_bands=true</var> , boolean  <var class="pdparam">pixel_types=true</var> , boolean  <var class="pdparam">nodata_values=true</var> , boolean  <var class="pdparam">out_db=true</var> , boolean  <var class="pdparam">extent=true</var> <code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">AddRasterConstraints</b>(</code>name  <var class="pdparam">rasttable</var>, name  <var class="pdparam">rastcolumn</var>, text[]  <var class="pdparam">VARIADIC constraints</var><code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">AddRasterConstraints</b>(</code>name  <var class="pdparam">rastschema</var>, name  <var class="pdparam">rasttable</var>, name  <var class="pdparam">rastcolumn</var>, text[]  <var class="pdparam">VARIADIC constraints</var><code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">AddRasterConstraints</b>(</code>name  <var class="pdparam">rastschema</var>, name  <var class="pdparam">rasttable</var>, name  <var class="pdparam">rastcolumn</var>, boolean  <var class="pdparam">srid=true</var>, boolean  <var class="pdparam">scale_x=true</var>, boolean  <var class="pdparam">scale_y=true</var>, boolean  <var class="pdparam">blocksize_x=true</var>, boolean  <var class="pdparam">blocksize_y=true</var>, boolean  <var class="pdparam">same_alignment=true</var>, boolean  <var class="pdparam">regular_blocking=false</var>, boolean  <var class="pdparam">num_bands=true</var>, boolean  <var class="pdparam">pixel_types=true</var>, boolean  <var class="pdparam">nodata_values=true</var> , boolean  <var class="pdparam">out_db=true</var> , boolean  <var class="pdparam">extent=true</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp72044800"></a><h2>説明</h2><p>ラスタカラム上に、ラスタカタログ<code class="varname">raster_columns</code>で情報を表示するために使われる制約を生成します。<code class="varname">rastschema</code>は、テーブルがあるテーブルスキーマの名前です。<code class="varname">srid</code>はSPATIAL_REF_SYSテーブル内のエントリを参照する整数でなければなりません。</p><p><code class="varname">raster2pgsql</code>はこの関数を使ってラスタテーブルを登録します。</p><p>渡すのに妥当な制約名は次の通りです。詳細情報については<a class="xref" href="#RT_Raster_Columns" title="11.2.1. ラスタカラムカタログ">「ラスタカラムカタログ」</a>を参照して下さい。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="varname">blocksize</code> ブロックのXとY両方のサイズを指定します</p></li><li class="listitem"><p><code class="varname">blocksize_x</code> Xタイル(タイル毎のピクセル幅)を設定します</p></li><li class="listitem"><p><code class="varname">blocksize_y</code> Yタイル(タイル毎のピクセル幅)を設定します</p></li><li class="listitem"><p><code class="varname">extent</code> テーブル全体の範囲を計算し、全てのラスタがこの範囲内にある制約を適用します</p></li><li class="listitem"><p><code class="varname">num_bands</code> バンド数</p></li><li class="listitem"><p><code class="varname">pixel_types</code> バンドごとにピクセルタイプを読み、全てのバンドが同じピクセルタイプであることを確認します。</p></li><li class="listitem"><p><code class="varname">regular_blocking</code> 空間的に一意 (二つのラスタが空間的に同じにならない)であり、カバレッジタイル (ラスタがカバレッジに整列する)制約であるようにします。</p></li><li class="listitem"><p><code class="varname">same_alignment</code> 同じアラインメントを持つようにします。任意の2タイルについて比較するとtrueを返すという意味です。<a class="xref" href="#RT_ST_SameAlignment" title="ST_SameAlignment">ST_SameAlignment</a>を参照して下さい。</p></li><li class="listitem"><p><code class="varname">srid</code> 全て同じSRIDを持っていることを確認するためのものです。</p></li><li class="listitem"><p>その他 -- 上の関数への入力で一覧が挙げられています。</p></li></ul></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はテーブル内に存在するデータから制約を推論します。動作させるには、まずラスタカラムを生成し、その後にデータをロードする必要があります。 </p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>制約を適用した後にデータをさらにロードする必要がある場合には、データ範囲が変わるならDropRasterConstraintsを使います。 </p></td></tr></table></div><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp72079488"></a><h2>例: カラムに対して全てのありえる制約をデータに基づいて適用する</h2><pre class="programlisting">CREATE TABLE myrasters(rid SERIAL primary key, rast raster);
INSERT INTO myrasters(rast)
SELECT ST_AddBand(ST_MakeEmptyRaster(1000, 1000, 0.3, -0.3, 2, 2, 0, 0,4326), 1, '8BSI'::text, -129, NULL);

SELECT AddRasterConstraints('myrasters'::name, 'rast'::name);


-- raster_columnsビューに正しく登録されたか確認 --
SELECT srid, scale_x, scale_y, blocksize_x, blocksize_y, num_bands, pixel_types, nodata_values
    FROM raster_columns
    WHERE r_table_name = 'myrasters';

 srid | scale_x | scale_y | blocksize_x | blocksize_y | num_bands | pixel_types| nodata_values
------+---------+---------+-------------+-------------+-----------+-------------+---------------
 4326 |       2 |       2 |        1000 |        1000 |         1 | {8BSI}      | {0}
        </pre></div><div class="refsection"><a name="idp71118208"></a><h2>例: 単一の制約を適用する</h2><pre class="programlisting">CREATE TABLE public.myrasters2(rid SERIAL primary key, rast raster);
INSERT INTO myrasters2(rast)
SELECT ST_AddBand(ST_MakeEmptyRaster(1000, 1000, 0.3, -0.3, 2, 2, 0, 0,4326), 1, '8BSI'::text, -129, NULL);

SELECT AddRasterConstraints('public'::name, 'myrasters2'::name, 'rast'::name,'regular_blocking', 'blocksize');
-- 通知が出ます --
NOTICE:  Adding regular blocking constraint
NOTICE:  Adding blocksize-X constraint
NOTICE:  Adding blocksize-Y constraint</pre></div><div class="refsection"><a name="idp71119488"></a><h2>関連情報</h2><p><a class="xref" href="#RT_Raster_Columns" title="11.2.1. ラスタカラムカタログ">「ラスタカラムカタログ」</a>, <a class="xref" href="#RT_ST_AddBand" title="ST_AddBand">ST_AddBand</a>, <a class="xref" href="#RT_ST_MakeEmptyRaster" title="ST_MakeEmptyRaster">ST_MakeEmptyRaster</a>, <a class="xref" href="#RT_DropRasterConstraints" title="DropRasterConstraints">DropRasterConstraints</a>, <a class="xref" href="#RT_ST_BandPixelType" title="ST_BandPixelType">ST_BandPixelType</a>, <a class="xref" href="#RT_ST_SRID" title="ST_SRID">ST_SRID</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_DropRasterConstraints"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>DropRasterConstraints — ラスタテーブルカラムを参照するPostGISラスタ制約を削除します。データの再読み込みやラスタカラムデータの更新の際に使えます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">DropRasterConstraints</b>(</code>name  <var class="pdparam">rasttable</var>, name  <var class="pdparam">rastcolumn</var>, boolean  <var class="pdparam">srid</var>, boolean  <var class="pdparam">scale_x</var>, boolean  <var class="pdparam">scale_y</var>, boolean  <var class="pdparam">blocksize_x</var>, boolean  <var class="pdparam">blocksize_y</var>, boolean  <var class="pdparam">same_alignment</var>, boolean  <var class="pdparam">regular_blocking</var>, boolean  <var class="pdparam">num_bands=true</var>, boolean  <var class="pdparam">pixel_types=true</var>, boolean  <var class="pdparam">nodata_values=true</var>, boolean  <var class="pdparam">out_db=true</var> , boolean  <var class="pdparam">extent=true</var><code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">DropRasterConstraints</b>(</code>name  <var class="pdparam">rastschema</var>, name  <var class="pdparam">rasttable</var>, name  <var class="pdparam">rastcolumn</var>, boolean  <var class="pdparam">srid=true</var>, boolean  <var class="pdparam">scale_x=true</var>, boolean  <var class="pdparam">scale_y=true</var>, boolean  <var class="pdparam">blocksize_x=true</var>, boolean  <var class="pdparam">blocksize_y=true</var>, boolean  <var class="pdparam">same_alignment=true</var>, boolean  <var class="pdparam">regular_blocking=false</var>, boolean  <var class="pdparam">num_bands=true</var>, boolean  <var class="pdparam">pixel_types=true</var>, boolean  <var class="pdparam">nodata_values=true</var>, boolean  <var class="pdparam">out_db=true</var> , boolean  <var class="pdparam">extent=true</var><code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">DropRasterConstraints</b>(</code>name  <var class="pdparam">rastschema</var>, name  <var class="pdparam">rasttable</var>, name  <var class="pdparam">rastcolumn</var>, text[]  <var class="pdparam">constraints</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72114816"></a><h2>説明</h2><p><a class="xref" href="#RT_AddRasterConstraints" title="AddRasterConstraints">AddRasterConstraints</a>で追加された、ラスタテーブルカラムを参照するPostGISラスタ制約を削除します。データの追加ロードやラスタカラムデータの更新で使えます。ラスタテーブルまたはラスタカラムのridを取得したい場合には使う必要がありません。 </p><p>ラスタテーブルを削除するには、次の標準的なSQLを使います。 </p><pre class="programlisting">DROP TABLE mytable</pre><p>ラスタカラムを削除してテーブルの残りのカラムを置いておくには、次の標準的なSQLを使います。 </p><pre class="programlisting">ALTER TABLE mytable DROP COLUMN rast</pre><p>カラムまたはテーブルが削除されると、テーブルは<code class="varname">raster_columns</code>カタログから見えなくなります。しかしながら、制約だけが削除されたので、ラスタカラムはなお<code class="varname">raster_columns</code>カタログに残ります。ただし、カラム名とテーブルからの内部に関する他の情報は存在しません。</p><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp72119296"></a><h2>例</h2><pre class="programlisting">SELECT DropRasterConstraints ('myrasters','rast');\n
-- 結果出力 --
t

-- raster_columnsで変更を確認します --
SELECT srid, scale_x, scale_y, blocksize_x, blocksize_y, num_bands, pixel_types, nodata_values
    FROM raster_columns
    WHERE r_table_name = 'myrasters';

 srid | scale_x | scale_y | blocksize_x | blocksize_y | num_bands | pixel_types| nodata_values
------+---------+---------+-------------+-------------+-----------+-------------+---------------
    0 |         |         |             |             |           |             |
        </pre></div><div class="refsection"><a name="idp72120576"></a><h2>関連情報</h2><p><a class="xref" href="#RT_AddRasterConstraints" title="AddRasterConstraints">AddRasterConstraints</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_AddOverviewConstraints"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>AddOverviewConstraints — ラスタカラムに対して、他のオーバビューであることをタグ付けします。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">AddOverviewConstraints</b>(</code>name  <var class="pdparam">ovschema</var>, name  <var class="pdparam">ovtable</var>, name  <var class="pdparam">ovcolumn</var>, name  <var class="pdparam">refschema</var>, name  <var class="pdparam">reftable</var>, name  <var class="pdparam">refcolumn</var>, int  <var class="pdparam">ovfactor</var><code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">AddOverviewConstraints</b>(</code>name  <var class="pdparam">ovtable</var>, name  <var class="pdparam">ovcolumn</var>, name  <var class="pdparam">reftable</var>, name  <var class="pdparam">refcolumn</var>, int  <var class="pdparam">ovfactor</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72138752"></a><h2>説明</h2><p><code class="varname">raster_overviews</code>ラスタカタログ内の情報を表示するために使われるラスタカラムに制約を追加します。 </p><p><code class="varname">ovfactor</code>引数は、オーバビューカラムの縮尺乗数を示します。縮尺乗数は大きいほど低い解像度になります。 </p><p><code class="varname">ovschema</code>と<code class="varname">refschema</code>が省略されると、<code class="varname">search_path</code>を走査して発見した最初のテーブルを使います。 </p><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp72142720"></a><h2>例</h2><pre class="programlisting">CREATE TABLE res1 AS SELECT
ST_AddBand(
  ST_MakeEmptyRaster(1000, 1000, 0, 0, 2),
  1, '8BSI'::text, -129, NULL
) r1;

CREATE TABLE res2 AS SELECT
ST_AddBand(
  ST_MakeEmptyRaster(500, 500, 0, 0, 4),
  1, '8BSI'::text, -129, NULL
) r2;

SELECT AddOverviewConstraints('res2', 'r2', 'res1', 'r1', 2);

-- raster_overviewsビューに正しく登録されたか確認します --
SELECT o_table_name ot, o_raster_column oc,
       r_table_name rt, r_raster_column rc,
       overview_factor f
FROM raster_overviews WHERE o_table_name = 'res2';
  ot  | oc |  rt  | rc | f
------+----+------+----+---
 res2 | r2 | res1 | r1 | 2
(1 row)
        </pre></div><div class="refsection"><a name="idp72144000"></a><h2>関連情報</h2><p><a class="xref" href="#RT_Raster_Overviews" title="11.2.2. ラスタオーバビュー">「ラスタオーバビュー」</a>, <a class="xref" href="#RT_DropOverviewConstraints" title="DropOverviewConstraints">DropOverviewConstraints</a>, <a class="xref" href="#RT_CreateOverview" title="ST_CreateOverview">ST_CreateOverview</a>, <a class="xref" href="#RT_AddRasterConstraints" title="AddRasterConstraints">AddRasterConstraints</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_DropOverviewConstraints"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>DropOverviewConstraints — ラスタカラムに対して他のオーバビューであることをタグ付けしているのを解除します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">DropOverviewConstraints</b>(</code>name  <var class="pdparam">ovschema</var>, name  <var class="pdparam">ovtable</var>, name  <var class="pdparam">ovcolumn</var><code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">DropOverviewConstraints</b>(</code>name  <var class="pdparam">ovtable</var>, name  <var class="pdparam">ovcolumn</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72180992"></a><h2>説明</h2><p>ラスタカラムから、<code class="varname">raster_overviews</code>ラスタカタログ内にある、他のラスタのオーバビューであるこをと示すために使われる制約を削除します。 </p><p><code class="varname">ovschema</code>が省略されると、<code class="varname">search_path</code>を走査して発見した最初のテーブルを使います。 </p><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp72183936"></a><h2>関連情報</h2><p><a class="xref" href="#RT_Raster_Overviews" title="11.2.2. ラスタオーバビュー">「ラスタオーバビュー」</a>, <a class="xref" href="#RT_AddOverviewConstraints" title="AddOverviewConstraints">AddOverviewConstraints</a>, <a class="xref" href="#RT_DropRasterConstraints" title="DropRasterConstraints">DropRasterConstraints</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_PostGIS_GDAL_Version"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>PostGIS_GDAL_Version — PostGISで使っているGDALライブラリの版を報告します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">PostGIS_GDAL_Version</b>(</code><code>)</code>;</p></div></div><div class="refsection"><a name="idp72189824"></a><h2>説明</h2><p>PostGISで使っているGDALライブラリの版を報告します。GDALがデータファイルを発見できるかについてもチェックして、報告します。</p></div><div class="refsection"><a name="idp72190976"></a><h2>例</h2><pre class="programlisting">SELECT PostGIS_GDAL_Version();
       postgis_gdal_version
-----------------------------------
 GDAL 1.11dev, released 2013/04/13
                </pre></div><div class="refsection"><a name="idp72192256"></a><h2>関連情報</h2><p>
                    <a class="xref" href="#postgis_gdal_datapath" title="postgis.gdal_datapath">postgis.gdal_datapath</a>
                </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_PostGIS_Raster_Lib_Build_Date"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>PostGIS_Raster_Lib_Build_Date — 完全なラスタライブラリをビルドした日付を報告します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">PostGIS_Raster_Lib_Build_Date</b>(</code><code>)</code>;</p></div></div><div class="refsection"><a name="idp72197504"></a><h2>説明</h2><p>ラスタをビルドした日付を報告します。</p></div><div class="refsection"><a name="idp72198656"></a><h2>例</h2><pre class="programlisting">SELECT PostGIS_Raster_Lib_Build_Date();
postgis_raster_lib_build_date
-----------------------------
2010-04-28 21:15:10
</pre></div><div class="refsection"><a name="idp72200064"></a><h2>関連情報</h2><p> <a class="xref" href="#RT_PostGIS_Raster_Lib_Version" title="PostGIS_Raster_Lib_Version">PostGIS_Raster_Lib_Version</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_PostGIS_Raster_Lib_Version"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>PostGIS_Raster_Lib_Version — 完全なラスタの版とビルドコンフィギュレーション情報を報告します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">PostGIS_Raster_Lib_Version</b>(</code><code>)</code>;</p></div></div><div class="refsection"><a name="idp69837696"></a><h2>説明</h2><p>完全なラスタの版とビルドコンフィギュレーション情報を報告します。</p></div><div class="refsection"><a name="idp69838848"></a><h2>例</h2><pre class="programlisting">SELECT PostGIS_Raster_Lib_Version();
postgis_raster_lib_version
-----------------------------
 2.0.0
</pre></div><div class="refsection"><a name="idp69840128"></a><h2>関連情報</h2><p> <a class="xref" href="#">???</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_GDALDrivers"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_GDALDrivers — 使用しているGDALライブラリが対応するラスタ書式の一覧を返します。この一覧でcan_write=TrueとなっているものだけがST_AsGDALRasterで使えます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">setof record <b class="fsfunc">ST_GDALDrivers</b>(</code>integer  <var class="pdparam">OUT idx</var>, text  <var class="pdparam">OUT short_name</var>, text  <var class="pdparam">OUT long_name</var>, text  <var class="pdparam">OUT can_read</var>, text  <var class="pdparam">OUT can_write</var>, text  <var class="pdparam">OUT create_options</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72222720"></a><h2>説明</h2><p>使用しているGDALライブラリが対応するラスタ書式のshort_name, long_nameと作成オプションの一覧を返します。short_nameは、<a class="xref" href="#RT_ST_AsGDALRaster" title="ST_AsGDALRaster">ST_AsGDALRaster</a>の<code class="varname">format</code>パラメタに使います。オプションはGDALライブラリのコンパイルに使ったドライバに依存します。<code class="varname">create_options</code>は、XML形式のCretionOptionList/Optionの集合で、ドライバごとの生成オプションごとに、名前を持ち、追加情報の<code class="varname">type</code>, <code class="varname">description</code>と<code class="varname">VALUE</code>の集合を持ちます。 </p><p>Changed: 2.5.0 - can_readカラムとcan_writeカラムを追加</p><p>Changed: 2.0.6, 2.1.3 - GUC (訳注: Grand Unified Configurationの略で、動的に変更できるPostgreSQLパラメータ)または環境変数gdal_enabled_driversが設定されていないデフォルトではドライバが全て無効になりました。</p><p>Availability: 2.0.0 - GDAL 1.6.0以上が必要です。 </p></div><div class="refsection"><a name="idp72227456"></a><h2>例: ドライバ一覧</h2><pre class="programlisting">SET postgis.gdal_enabled_drivers = 'ENABLE_ALL';
SELECT short_name, long_name, can_write
FROM st_gdaldrivers()
ORDER BY short_name;

   short_name    |                          long_name                          | can_write
-----------------+-------------------------------------------------------------+-----------
 AAIGrid         | Arc/Info ASCII Grid                                         | t
 ACE2            | ACE2                                                        | f
 ADRG            | ARC Digitized Raster Graphics                               | f
 AIG             | Arc/Info Binary Grid                                        | f
 AirSAR          | AirSAR Polarimetric Image                                   | f
 ARG             | Azavea Raster Grid format                                   | t
 BAG             | Bathymetry Attributed Grid                                  | f
 BIGGIF          | Graphics Interchange Format (.gif)                          | f
 BLX             | Magellan topo (.blx)                                        | t
 BMP             | MS Windows Device Independent Bitmap                        | f
 BSB             | Maptech BSB Nautical Charts                                 | f
 PAux            | PCI .aux Labelled                                           | f
 PCIDSK          | PCIDSK Database File                                        | f
 PCRaster        | PCRaster Raster File                                        | f
 PDF             | Geospatial PDF                                              | f
 PDS             | NASA Planetary Data System                                  | f
 PDS4            | NASA Planetary Data System 4                                | t
 PLMOSAIC        | Planet Labs Mosaics API                                     | f
 PLSCENES        | Planet Labs Scenes API                                      | f
 PNG             | Portable Network Graphics                                   | t
 PNM             | Portable Pixmap Format (netpbm)                             | f
 PRF             | Racurs PHOTOMOD PRF                                         | f
 R               | R Object Data Store                                         | t
 Rasterlite      | Rasterlite                                                  | t
 RDA             | DigitalGlobe Raster Data Access driver                      | f
 RIK             | Swedish Grid RIK (.rik)                                     | f
 RMF             | Raster Matrix Format                                        | f
 ROI_PAC         | ROI_PAC raster                                              | f
 RPFTOC          | Raster Product Format TOC format                            | f
 RRASTER         | R Raster                                                    | f
 RS2             | RadarSat 2 XML Product                                      | f
 RST             | Idrisi Raster A.1                                           | t
 SAFE            | Sentinel-1 SAR SAFE Product                                 | f
 SAGA            | SAGA GIS Binary Grid (.sdat, .sg-grd-z)                     | t
 SAR_CEOS        | CEOS SAR Image                                              | f
 SDTS            | SDTS Raster                                                 | f
 SENTINEL2       | Sentinel 2                                                  | f
 SGI             | SGI Image File Format 1.0                                   | f
 SNODAS          | Snow Data Assimilation System                               | f
 SRP             | Standard Raster Product (ASRP/USRP)                         | f
 SRTMHGT         | SRTMHGT File Format                                         | t
 Terragen        | Terragen heightfield                                        | f
 TIL             | EarthWatch .TIL                                             | f
 TSX             | TerraSAR-X Product                                          | f
 USGSDEM         | USGS Optional ASCII DEM (and CDED)                          | t
 VICAR           | MIPL VICAR file                                             | f
 VRT             | Virtual Raster                                              | t
 WCS             | OGC Web Coverage Service                                    | f
 WMS             | OGC Web Map Service                                         | t
 WMTS            | OGC Web Map Tile Service                                    | t
 XPM             | X11 PixMap Format                                           | t
 XYZ             | ASCII Gridded XYZ                                           | t
 ZMap            | ZMap Plus Grid                                              | t
</pre></div><div class="refsection"><a name="idp72228736"></a><h2>例: ドライバ毎のオプション一覧</h2><pre class="programlisting">-- JPEGのXMLカラムから生成オプションをテーブルとして出力します --
-- この生成オプションはST_AsGDALRasterのオプション引数で使えます --
SELECT (xpath('@name', g.opt))[1]::text As oname,
       (xpath('@type', g.opt))[1]::text As otype,
       (xpath('@description', g.opt))[1]::text As descrip
FROM (SELECT unnest(xpath('/CreationOptionList/Option', create_options::xml)) As opt
FROM  st_gdaldrivers()
WHERE short_name = 'JPEG') As g;

       oname        |  otype  |      descrip
--------------------+---------+-------------------------------------------------
 PROGRESSIVE        | boolean | whether to generate a progressive JPEG
 QUALITY            | int     | good=100, bad=0, default=75
 WORLDFILE          | boolean | whether to geneate a worldfile
 INTERNAL_MASK      | boolean | whether to generate a validity mask
 COMMENT            | string  | Comment
 SOURCE_ICC_PROFILE | string  | ICC profile encoded in Base64
 EXIF_THUMBNAIL     | boolean | whether to generate an EXIF thumbnail(overview).
                                By default its max dimension will be 128
 THUMBNAIL_WIDTH    | int     | Forced thumbnail width
 THUMBNAIL_HEIGHT   | int     | Forced thumbnail height
(9 rows)
</pre><pre class="programlisting">-- GeoTIFFの生成オプションを生のXMLで出力します --
SELECT create_options
FROM st_gdaldrivers()
WHERE short_name = 'GTiff';

&lt;CreationOptionList&gt;
    &lt;Option name="COMPRESS" type="string-select"&gt;
        &lt;Value
&gt;NONE&lt;/Value&gt;
        &lt;Value
&gt;LZW&lt;/Value&gt;
        &lt;Value
&gt;PACKBITS&lt;/Value&gt;
        &lt;Value
&gt;JPEG&lt;/Value&gt;
        &lt;Value
&gt;CCITTRLE&lt;/Value&gt;
        &lt;Value
&gt;CCITTFAX3&lt;/Value&gt;
        &lt;Value
&gt;CCITTFAX4&lt;/Value&gt;
        &lt;Value
&gt;DEFLATE&lt;/Value&gt;
    &lt;/Option&gt;
    &lt;Option name="PREDICTOR" type="int" description="Predictor Type"/&gt;
    &lt;Option name="JPEG_QUALITY" type="int" description="JPEG quality 1-100" default="75"/&gt;
    &lt;Option name="ZLEVEL" type="int" description="DEFLATE compression level 1-9" default="6"/&gt;
    &lt;Option name="NBITS" type="int" description="BITS for sub-byte files (1-7), sub-uint16 (9-15), sub-uint32 (17-31)"/&gt;
    &lt;Option name="INTERLEAVE" type="string-select" default="PIXEL"&gt;
        &lt;Value
&gt;BAND&lt;/Value&gt;
        &lt;Value
&gt;PIXEL&lt;/Value&gt;
    &lt;/Option&gt;
    &lt;Option name="TILED" type="boolean" description="Switch to tiled format"/&gt;
    &lt;Option name="TFW" type="boolean" description="Write out world file"/&gt;
    &lt;Option name="RPB" type="boolean" description="Write out .RPB (RPC) file"/&gt;
    &lt;Option name="BLOCKXSIZE" type="int" description="Tile Width"/&gt;
    &lt;Option name="BLOCKYSIZE" type="int" description="Tile/Strip Height"/&gt;
    &lt;Option name="PHOTOMETRIC" type="string-select"&gt;
        &lt;Value
&gt;MINISBLACK&lt;/Value&gt;
        &lt;Value
&gt;MINISWHITE&lt;/Value&gt;
        &lt;Value
&gt;PALETTE&lt;/Value&gt;
        &lt;Value
&gt;RGB&lt;/Value&gt;
        &lt;Value
&gt;CMYK&lt;/Value&gt;
        &lt;Value
&gt;YCBCR&lt;/Value&gt;
        &lt;Value
&gt;CIELAB&lt;/Value&gt;
        &lt;Value
&gt;ICCLAB&lt;/Value&gt;
        &lt;Value
&gt;ITULAB&lt;/Value&gt;
    &lt;/Option&gt;
    &lt;Option name="SPARSE_OK" type="boolean" description="Can newly created files have missing blocks?" default="FALSE"/&gt;
    &lt;Option name="ALPHA" type="boolean" description="Mark first extrasample as being alpha"/&gt;
    &lt;Option name="PROFILE" type="string-select" default="GDALGeoTIFF"&gt;
        &lt;Value
&gt;GDALGeoTIFF&lt;/Value&gt;
        &lt;Value
&gt;GeoTIFF&lt;/Value&gt;
        &lt;Value
&gt;BASELINE&lt;/Value&gt;
    &lt;/Option&gt;
    &lt;Option name="PIXELTYPE" type="string-select"&gt;
        &lt;Value
&gt;DEFAULT&lt;/Value&gt;
        &lt;Value
&gt;SIGNEDBYTE&lt;/Value&gt;
    &lt;/Option&gt;
    &lt;Option name="BIGTIFF" type="string-select" description="Force creation of BigTIFF file"&gt;
        &lt;Value
&gt;YES&lt;/Value&gt;
        &lt;Value
&gt;NO&lt;/Value&gt;
        &lt;Value
&gt;IF_NEEDED&lt;/Value&gt;
        &lt;Value
&gt;IF_SAFER&lt;/Value&gt;
    &lt;/Option&gt;
    &lt;Option name="ENDIANNESS" type="string-select" default="NATIVE" description="Force endianness of created file. For DEBUG purpose mostly"&gt;
        &lt;Value
&gt;NATIVE&lt;/Value&gt;
        &lt;Value
&gt;INVERTED&lt;/Value&gt;
        &lt;Value
&gt;LITTLE&lt;/Value&gt;
        &lt;Value
&gt;BIG&lt;/Value&gt;
    &lt;/Option&gt;
    &lt;Option name="COPY_SRC_OVERVIEWS" type="boolean" default="NO" description="Force copy of overviews of source dataset (CreateCopy())"/&gt;
&lt;/CreationOptionList
&gt;

-- GeoTIFF生成オプションのXMLをテーブルとして出力します --
-- Output the create options XML column for GTiff as a table  --
SELECT (xpath('@name', g.opt))[1]::text As oname,
       (xpath('@type', g.opt))[1]::text As otype,
       (xpath('@description', g.opt))[1]::text As descrip,
       array_to_string(xpath('Value/text()', g.opt),', ') As vals
FROM (SELECT unnest(xpath('/CreationOptionList/Option', create_options::xml)) As opt
FROM  st_gdaldrivers()
WHERE short_name = 'GTiff') As g;

       oname        |     otype     |                               descrip                                |                                   vals
--------------------+---------------+----------------------------------------------------------------------+---------------------------------------------------------------------------
 COMPRESS           | string-select |                                                                      | NONE, LZW, PACKBITS, JPEG, CCITTRLE, CCITTFAX3, CCITTFAX4, DEFLATE
 PREDICTOR          | int           | Predictor Type                                                       |
 JPEG_QUALITY       | int           | JPEG quality 1-100                                                   |
 ZLEVEL             | int           | DEFLATE compression level 1-9                                        |
 NBITS              | int           | BITS for sub-byte files (1-7), sub-uint16 (9-15), sub-uint32 (17-31) |
 INTERLEAVE         | string-select |                                                                      | BAND, PIXEL
 TILED              | boolean       | Switch to tiled format                                               |
 TFW                | boolean       | Write out world file                                                 |
 RPB                | boolean       | Write out .RPB (RPC) file                                            |
 BLOCKXSIZE         | int           | Tile Width                                                           |
 BLOCKYSIZE         | int           | Tile/Strip Height                                                    |
 PHOTOMETRIC        | string-select |                                                                      | MINISBLACK, MINISWHITE, PALETTE, RGB, CMYK, YCBCR, CIELAB, ICCLAB, ITULAB
 SPARSE_OK          | boolean       | Can newly created files have missing blocks?                         |
 ALPHA              | boolean       | Mark first extrasample as being alpha                                |
 PROFILE            | string-select |                                                                      | GDALGeoTIFF, GeoTIFF, BASELINE
 PIXELTYPE          | string-select |                                                                      | DEFAULT, SIGNEDBYTE
 BIGTIFF            | string-select | Force creation of BigTIFF file                                       | YES, NO, IF_NEEDED, IF_SAFER
 ENDIANNESS         | string-select | Force endianness of created file. For DEBUG purpose mostly           | NATIVE, INVERTED, LITTLE, BIG
 COPY_SRC_OVERVIEWS | boolean       | Force copy of overviews of source dataset (CreateCopy())             |
(19 rows)
</pre></div><div class="refsection"><a name="idp72230400"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_AsGDALRaster" title="ST_AsGDALRaster">ST_AsGDALRaster</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#postgis_gdal_enabled_drivers" title="postgis.gdal_enabled_drivers">postgis.gdal_enabled_drivers</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Contour"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Contour — 与えられたラスタバンドから等高線ベクタを生成します。<a class="ulink" href="https://gdal.org/api/gdal_alg.html?highlight=contour#_CPPv421GDALContourGenerateEx15GDALRasterBandHPv12CSLConstList16GDALProgressFuncPv" target="_top">GDAL等高線生成アルゴリズム</a>を使います。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">setof record <b class="fsfunc">ST_Contour</b>(</code>raster <var class="pdparam">rast</var>, integer <var class="pdparam">bandnumber</var>, double precision <var class="pdparam">level_interval</var>, double precision <var class="pdparam">level_base</var>, double precision[] <var class="pdparam">fixed_levels</var>, boolean <var class="pdparam">polygonize</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72262400"></a><h2>説明</h2><p>与えられたラスタバンドから等高線ベクタを生成します。<a class="ulink" href="https://gdal.org/api/gdal_alg.html?highlight=contour#_CPPv421GDALContourGenerateEx15GDALRasterBandHPv12CSLConstList16GDALProgressFuncPv" target="_top">GDAL等高線生成アルゴリズム</a>を使います。</p><p><code class="varname">fixed_levels</code>パラメータが空でない配列である時、<code class="varname">level_interval</code>と<code class="varname">level_base</code>とは無視されます。 </p><p><code class="varname">polygonize</code>パラメータは現在のところ効果がありません。<a class="link" href="#ST_Polygonize" title="ST_Polygonize">ST_Polygonize</a>関数を使って等高線をポリゴンに変換しています。 </p><p>返り値は次に示す属性を持つ行の集合です。 </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">geom</span></dt><dd><p>等高線のジオメトリ</p></dd><dt><span class="term">id</span></dt><dd><p>GDALが等高線に与える一意の識別子。</p></dd><dt><span class="term">value</span></dt><dd><p>ラインが表現するラスタ値。標高DEM入力の場合、出力等高線の標高となります。</p></dd></dl></div><p>Availability: 3.2.0</p></div><div class="refsection"><a name="idp72271232"></a><h2>例</h2><pre class="programlisting">WITH c AS (
SELECT (ST_Contour(rast, 1, fixed_levels =
&gt; ARRAY[100.0, 200.0, 300.0])).*
FROM dem_grid WHERE rid = 1
)
SELECT st_astext(geom), id, value
FROM c;</pre></div><div class="refsection"><a name="idp72272512"></a><h2>関連情報</h2><p>
        <a class="xref" href="#RT_ST_InterpolateRaster" title="ST_InterpolateRaster">ST_InterpolateRaster</a>
        </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_InterpolateRaster"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_InterpolateRaster — X値とY値を使用してグリッド上のポイントを配置し、ポイントのZ値をサーフェス標高として配置し、3次元ポイントの入力セットに基づいてグリッドサーフェスを補間します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_InterpolateRaster</b>(</code>geometry <var class="pdparam">input_points</var>, text <var class="pdparam">algorithm_options</var>, raster <var class="pdparam">template</var>, integer <var class="pdparam">template_band_num=1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72281216"></a><h2>説明</h2><p>X値とY値を使用してグリッド上のポイントを配置し、ポイントのZ値をサーフェス標高として配置し、3次元ポイントの入力セットに基づいてグリッドサーフェスを補間します。逆距離、逆距離最近傍、移動平均、最近傍、線形補間の五つの補間アルゴリズムが使用できます。アルゴリズムとそれらのパラメータに関する詳細情報については<a class="ulink" href="https://gdal.org/programs/gdal_grid.html#interpolation-algorithms" target="_top">gdal_grid documentation</a>を参照して下さい。どのように補間計算が行われているかの詳細情報については<a class="ulink" href="https://gdal.org/tutorials/gdal_grid_tut.html" target="_top">GDAL grid tutorial</a>をご覧下さい。 </p><p>入力パラメータは次の通りです。 </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">input_points</span></dt><dd><p>補間を駆動するポイント。Z値を持つジオメトリなら全て受け付けられ、全ての入力ポイントが使用されます。</p></dd><dt><span class="term">algorithm_options</span></dt><dd><p>アルゴリズムとそのオプションを定義する文字列で、<a class="ulink" href="https://gdal.org/programs/gdal_grid.html#interpolation-algorithms" target="_top">gdal_grid</a>で使われる書式で記述します。たとえば、逆距離補間 </p></dd><dt><span class="term">template</span></dt><dd><p>出力ラスタのジオメトリを駆動するためのラスタテンプレート。幅、高さ、ピクセルｙサイズ、空間範囲、ピクセルタイプがこのテンプレートから読み込まれます。 </p></dd><dt><span class="term">template_band_num</span></dt><dd><p>デフォルトではテンプレートラスタの最初のバンドが出力ラスタの駆動に使われますが、このパラメータで調整できます。 </p></dd></dl></div><p>Availability: 3.2.0</p></div><div class="refsection"><a name="idp72289664"></a><h2>例</h2><pre class="programlisting">SELECT ST_InterpolateRaster(
    'MULTIPOINT(10.5 9.5 1000, 11.5 8.5 1000, 10.5 8.5 500, 11.5 9.5 500)'::geometry,
    'invdist:smoothing:2.0',
    ST_AddBand(ST_MakeEmptyRaster(200, 400, 10, 10, 0.01, -0.005, 0, 0), '16BSI')
)</pre></div><div class="refsection"><a name="idp72290944"></a><h2>関連情報</h2><p>
            <a class="xref" href="#RT_ST_Contour" title="ST_Contour">ST_Contour</a>
            </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_UpdateRasterSRID"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>UpdateRasterSRID — ユーザが指定したカラムとテーブルにあるラスタの全てについてSRIDを変更します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">UpdateRasterSRID</b>(</code>name  <var class="pdparam">schema_name</var>, name  <var class="pdparam">table_name</var>, name  <var class="pdparam">column_name</var>, integer  <var class="pdparam">new_srid</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">UpdateRasterSRID</b>(</code>name  <var class="pdparam">table_name</var>, name  <var class="pdparam">column_name</var>, integer  <var class="pdparam">new_srid</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72304384"></a><h2>説明</h2><p>ユーザが指定したカラムとテーブルにあるラスタの全てについてSRIDを変更します。この関数は全ての適切なカラム制約 (extent, alignment, SRID)を削除してから、指定したカラムのラスタのSRIDを変更します。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はラスタのデータ (バンドピクセル値)を触りません。ラスタのメタデータのみ変更します。 </p></td></tr></table></div><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp72306688"></a><h2>関連情報</h2><p>
          <a class="xref" href="#UpdateGeometrySRID" title="UpdateGeometrySRID">UpdateGeometrySRID</a>
        </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_CreateOverview"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_CreateOverview — 与えられたラスタカバレッジから解像度を落としたものを生成します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">regclass <b class="fsfunc">ST_CreateOverview</b>(</code>regclass  <var class="pdparam">tab</var>, name  <var class="pdparam">col</var>, int  <var class="pdparam">factor</var>, text  <var class="pdparam">algo='NearestNeighbor'</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72315904"></a><h2>説明</h2><p>元のテーブルからリサンプリングを施したタイルのオーバビューテーブルを生成します。出力タイルは入力タイルと同じサイズで、同じ空間範囲を持ち、入力タイルより低い解像度 (ピクセル数は縦横ともに元のタイルの1/<code class="varname">factor</code>倍になります)を持ちます。 </p><p>オーバビューテーブルは<code class="varname">raster_overviews</code>カタログに出現し、ラスタ制約を持ちます。 </p><p>アルゴリズム指定オプションは'NearestNeighbor', 'Bilinear', 'Cubic', 'CubicSpline', 'Lanczos'です。詳細については<a class="ulink" href="http://www.gdal.org/gdalwarp.html" target="_top">GDAL Warp resampling methods</a>をご覧ください。</p><p>Availability: 2.2.0</p></div><div class="refsection"><a name="idp72319488"></a><h2>例</h2><p>高品質ですが遅い生成書式での出力</p><pre class="programlisting">SELECT ST_CreateOverview('mydata.mytable'::regclass, 'rast', 2, 'Lanczos');</pre><p>デフォルトの最近傍補間を使った早い処理による出力</p><pre class="programlisting">SELECT ST_CreateOverview('mydata.mytable'::regclass, 'rast', 2);</pre></div><div class="refsection"><a name="idp72342400"></a><h2>関連情報</h2><p><a class="xref" href="#RT_Retile" title="ST_Retile">ST_Retile</a>, <a class="xref" href="#RT_AddOverviewConstraints" title="AddOverviewConstraints">AddOverviewConstraints</a>, <a class="xref" href="#RT_AddRasterConstraints" title="AddRasterConstraints">AddRasterConstraints</a>, <a class="xref" href="#RT_Raster_Overviews" title="11.2.2. ラスタオーバビュー">「ラスタオーバビュー」</a> </p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Raster_Constructors"></a>12.3. ラスタコンストラクタ</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#RT_ST_AddBand">ST_AddBand</a></span><span class="refpurpose"> — 与えられたタイプで、与えられた初期値にした新しいバンドを、与えられたインデクス位置に追加したラスタを返します。インデクス位置を指定していない場合には、バンドは末尾に追加されます。 </span></dt><dt><span class="refentrytitle"><a href="#RT_ST_AsRaster">ST_AsRaster</a></span><span class="refpurpose"> — PostGISジオメトリをPostGISラスタに変換します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Band">ST_Band</a></span><span class="refpurpose"> — 既存のラスタの、一つ以上のバンドを新しいラスタとして返します。既存のラスタから新しいラスタを構築する際に使えます。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_MakeEmptyCoverage">ST_MakeEmptyCoverage</a></span><span class="refpurpose"> — 空のラスタタイルのグリッドでジオリファレンスを施されている領域を生成します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_MakeEmptyRaster">ST_MakeEmptyRaster</a></span><span class="refpurpose"> — 与えられたピクセル範囲 (width &amp; height)、左上のX,Y、ピクセルサイズ、回転 (scalex, scaley, skewx, skewy)と空間参照系 (srid)が指定された空ラスタ (バンドを持たないラスタ)を返します。ラスタが渡されると、新しいラスタは渡されたラスタと同じサイズ、アラインメント、SRIDになります。SRIDが指定されていない場合には、空間参照系は不明 (0)とされます。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Tile">ST_Tile</a></span><span class="refpurpose"> — 求められた出力ラスタのピクセル数に基づいて入力ラスタを分割した結果のラスタ集合を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_Retile">ST_Retile</a></span><span class="refpurpose"> — 任意のタイル化されたラスタカバレッジから構成されたタイルの集合を返します。 </span></dt><dt><span class="refentrytitle"><a href="#RT_ST_FromGDALRaster">ST_FromGDALRaster</a></span><span class="refpurpose"> — 対応するGDALラスタファイルからラスタを返します。</span></dt></dl></div><div class="refentry"><a name="RT_ST_AddBand"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AddBand — 与えられたタイプで、与えられた初期値にした新しいバンドを、与えられたインデクス位置に追加したラスタを返します。インデクス位置を指定していない場合には、バンドは末尾に追加されます。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">(1) raster <b class="fsfunc">ST_AddBand</b>(</code>raster  <var class="pdparam">rast</var>, addbandarg[]  <var class="pdparam">addbandargset</var><code>)</code>;</p><p><code class="funcdef">(2) raster <b class="fsfunc">ST_AddBand</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">index</var>, text  <var class="pdparam">pixeltype</var>, double precision  <var class="pdparam">initialvalue=0</var>, double precision  <var class="pdparam">nodataval=NULL</var><code>)</code>;</p><p><code class="funcdef">(3) raster <b class="fsfunc">ST_AddBand</b>(</code>raster  <var class="pdparam">rast</var>, text  <var class="pdparam">pixeltype</var>, double precision  <var class="pdparam">initialvalue=0</var>, double precision  <var class="pdparam">nodataval=NULL</var><code>)</code>;</p><p><code class="funcdef">(4) raster <b class="fsfunc">ST_AddBand</b>(</code>raster  <var class="pdparam">torast</var>, raster  <var class="pdparam">fromrast</var>, integer  <var class="pdparam">fromband=1</var>, integer  <var class="pdparam">torastindex=at_end</var><code>)</code>;</p><p><code class="funcdef">(5) raster <b class="fsfunc">ST_AddBand</b>(</code>raster  <var class="pdparam">torast</var>, raster[]  <var class="pdparam">fromrasts</var>, integer  <var class="pdparam">fromband=1</var>, integer  <var class="pdparam">torastindex=at_end</var><code>)</code>;</p><p><code class="funcdef">(6) raster <b class="fsfunc">ST_AddBand</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">index</var>, text  <var class="pdparam">outdbfile</var>, integer[]  <var class="pdparam">outdbindex</var>, double precision  <var class="pdparam">nodataval=NULL</var><code>)</code>;</p><p><code class="funcdef">(7) raster <b class="fsfunc">ST_AddBand</b>(</code>raster  <var class="pdparam">rast</var>, text  <var class="pdparam">outdbfile</var>, integer[]  <var class="pdparam">outdbindex</var>, integer  <var class="pdparam">index=at_end</var>, double precision  <var class="pdparam">nodataval=NULL</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72399616"></a><h2>説明</h2><p>与えられたタイプで、与えられた初期値にし、与えられたNODATA値を付した新しいバンドを追加したラスタを返します。インデクス位置を指定していない場合には、バンドは末尾に追加されます。<code class="varname">fromband</code>が指定されない場合には、1番バンドと仮定します。ピクセルタイプは<a class="xref" href="#RT_ST_BandPixelType" title="ST_BandPixelType">ST_BandPixelType</a>で指定されているピクセルタイプの文字列表現です。既存のインデクスが指定された場合には、以降のバンドは全て1以上足されたインデクスになります。初期値としてピクセルタイプの最大値を超えた値が指定された場合には、初期値にピクセルタイプの許容最大値が指定されます。 </p><p><a class="xref" href="#addbandarg" title="addbandarg">addbandarg</a>の配列を取る版 (一つ目の版)では、指定したaddbandargのインデクス値は、addbandargで示されるバンドがラスタに追加される時のラスタとの相対値です。下の複数バンドの例を参照してください。 </p><p>ラスタの配列を取る版 (五つ目の版)では、<code class="varname">torast</code>がNULLなら、配列内のラスタごとの<code class="varname">fromband</code>のバンドが新しいラスタに集約されます。 </p><p><code class="varname">outdbfile</code>を取る版 (六つ目と七つ目の版)では、値はラスタファイルへのフルパスを含まなければなりません。また、ファイルはPostgreSQLサーバプロセスがアクセス可能でなければなりません。 </p><p>Enhanced: 2.1.0 addbandarg対応が追加されました。</p><p>Enhanced: 2.1.0 out-dbバンドが追加されました。</p></div><div class="refsection"><a name="idp72404992"></a><h2>例: 単一バンド</h2><pre class="programlisting">-- 8ビット符号無し整数で初期値200のバンドを追加します
UPDATE dummy_rast
    SET rast = ST_AddBand(rast,'8BUI'::text,200)
WHERE rid = 1;
                </pre><pre class="programlisting">-- 100x100単位で左上を0,0とした空のラスタを生成し、
-- 2個のバンドを追加します (1番バンドは0/1の真偽値、2番バンドは0-15を許容)
-- addbandargsを使用しています。
INSERT INTO dummy_rast(rid,rast)
    VALUES(10, ST_AddBand(ST_MakeEmptyRaster(100, 100, 0, 0, 1, -1, 0, 0, 0),
    ARRAY[
        ROW(1, '1BB'::text, 0, NULL),
        ROW(2, '4BUI'::text, 0, NULL)
            ]::addbandarg[]
     )
    );

-- 全て正しく実行できたかを確認するためにラスタバンドのメタデータを出力--
SELECT  (bmd).*
FROM (SELECT ST_BandMetaData(rast,generate_series(1,2)) As bmd
    FROM dummy_rast WHERE rid = 10) AS foo;
 -- 結果 --
 pixeltype | nodatavalue | isoutdb | path
-----------+----------------+-------------+---------+------
 1BB       |             | f       |
 4BUI      |             | f       |


-- ラスタのメタデータの出力 --
SELECT  (rmd).width, (rmd).height, (rmd).numbands
FROM (SELECT ST_MetaData(rast) As rmd
    FROM dummy_rast WHERE rid = 10) AS foo;
-- 結果--
 upperleftx | upperlefty | width | height | scalex | scaley | skewx | skewy | srid | numbands
------------+------------+-------+--------+------------+------------+-------+-------+------+----------
          0 |          0 |   100 |    100 |      1 |     -1 |     0 |     0 |   0 |        2
                </pre></div><div class="refsection"><a name="idp72406784"></a><h2>例: 複数の新規バンド</h2><pre class="programlisting">SELECT
    *
FROM ST_BandMetadata(
    ST_AddBand(
        ST_MakeEmptyRaster(10, 10, 0, 0, 1, -1, 0, 0, 0),
        ARRAY[
            ROW(NULL, '8BUI', 255, 0),
            ROW(NULL, '16BUI', 1, 2),
            ROW(2, '32BUI', 100, 12),
            ROW(2, '32BF', 3.14, -1)
        ]::addbandarg[]
    ),
    ARRAY[]::integer[]
);

 bandnum | pixeltype | nodatavalue | isoutdb | path
---------+-----------+-------------+---------+------
       1 | 8BUI      |           0 | f       |
       2 | 32BF      |          -1 | f       |
       3 | 32BUI     |          12 | f       |
       4 | 16BUI     |           2 | f       |
                </pre><pre class="programlisting">-- 複数のラスタのようなテーブルの1番バンドを集計して単一ラスタに入れます。
-- test_typeと同じ数のバンドを持つ、マウスの数と同じ行 (新しいラスタ)になります。
-- ご注意: ORDER BY test_typeは、PostgreSQL 9.0以上でのみ対応します。
-- 8.4以下では副問い合わせ内の並び順になります (保証もされません)。
-- 結果ラスタはtest_typeのアルファベット順でtest_typeごとのバンドを持ちます
-- マウス好きの方へ: この例ではマウスは傷つきませんでした
SELECT
    mouse,
    ST_AddBand(NULL, array_agg(rast ORDER BY test_type), 1) As rast
FROM mice_studies
GROUP BY mouse;
                </pre></div><div class="refsection"><a name="idp72408576"></a><h2>例: データベース外のバンド</h2><pre class="programlisting">SELECT
    *
FROM ST_BandMetadata(
    ST_AddBand(
        ST_MakeEmptyRaster(10, 10, 0, 0, 1, -1, 0, 0, 0),
        '/home/raster/mytestraster.tif'::text, NULL::int[]
    ),
    ARRAY[]::integer[]
);

 bandnum | pixeltype | nodatavalue | isoutdb | path
---------+-----------+-------------+---------+------
       1 | 8BUI      |             | t       | /home/raster/mytestraster.tif
       2 | 8BUI      |             | t       | /home/raster/mytestraster.tif
       3 | 8BUI      |             | t       | /home/raster/mytestraster.tif
                </pre></div><div class="refsection"><a name="idp72409856"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_BandMetaData" title="ST_BandMetaData">ST_BandMetaData</a>, <a class="xref" href="#RT_ST_BandPixelType" title="ST_BandPixelType">ST_BandPixelType</a>, <a class="xref" href="#RT_ST_MakeEmptyRaster" title="ST_MakeEmptyRaster">ST_MakeEmptyRaster</a>, <a class="xref" href="#RT_ST_MetaData" title="ST_MetaData">ST_MetaData</a>, <a class="xref" href="#RT_ST_NumBands" title="ST_NumBands">ST_NumBands</a>, <a class="xref" href="#RT_ST_Reclass" title="ST_Reclass">ST_Reclass</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_AsRaster"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsRaster — PostGISジオメトリをPostGISラスタに変換します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_AsRaster</b>(</code>geometry  <var class="pdparam">geom</var>, raster  <var class="pdparam">ref</var>, text  <var class="pdparam">pixeltype</var>, double precision  <var class="pdparam">value=1</var>, double precision  <var class="pdparam">nodataval=0</var>, boolean  <var class="pdparam">touched=false</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_AsRaster</b>(</code>geometry  <var class="pdparam">geom</var>, raster  <var class="pdparam">ref</var>, text[]  <var class="pdparam">pixeltype=ARRAY['8BUI']</var>, double precision[]  <var class="pdparam">value=ARRAY[1]</var>, double precision[]  <var class="pdparam">nodataval=ARRAY[0]</var>, boolean  <var class="pdparam">touched=false</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_AsRaster</b>(</code>geometry  <var class="pdparam">geom</var>, double precision  <var class="pdparam">scalex</var>, double precision  <var class="pdparam">scaley</var>, double precision  <var class="pdparam">gridx</var>, double precision  <var class="pdparam">gridy</var>, text  <var class="pdparam">pixeltype</var>, double precision  <var class="pdparam">value=1</var>, double precision  <var class="pdparam">nodataval=0</var>, double precision  <var class="pdparam">skewx=0</var>, double precision  <var class="pdparam">skewy=0</var>, boolean  <var class="pdparam">touched=false</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_AsRaster</b>(</code>geometry  <var class="pdparam">geom</var>, double precision  <var class="pdparam">scalex</var>, double precision  <var class="pdparam">scaley</var>, double precision  <var class="pdparam">gridx=NULL</var>, double precision  <var class="pdparam">gridy=NULL</var>, text[]  <var class="pdparam">pixeltype=ARRAY['8BUI']</var>, double precision[]  <var class="pdparam">value=ARRAY[1]</var>, double precision[]  <var class="pdparam">nodataval=ARRAY[0]</var>, double precision  <var class="pdparam">skewx=0</var>, double precision  <var class="pdparam">skewy=0</var>, boolean  <var class="pdparam">touched=false</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_AsRaster</b>(</code>geometry  <var class="pdparam">geom</var>, double precision  <var class="pdparam">scalex</var>, double precision  <var class="pdparam">scaley</var>, text  <var class="pdparam">pixeltype</var>, double precision  <var class="pdparam">value=1</var>, double precision  <var class="pdparam">nodataval=0</var>, double precision  <var class="pdparam">upperleftx=NULL</var>, double precision  <var class="pdparam">upperlefty=NULL</var>, double precision  <var class="pdparam">skewx=0</var>, double precision  <var class="pdparam">skewy=0</var>, boolean  <var class="pdparam">touched=false</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_AsRaster</b>(</code>geometry  <var class="pdparam">geom</var>, double precision  <var class="pdparam">scalex</var>, double precision  <var class="pdparam">scaley</var>, text[]  <var class="pdparam">pixeltype</var>, double precision[]  <var class="pdparam">value=ARRAY[1]</var>, double precision[]  <var class="pdparam">nodataval=ARRAY[0]</var>, double precision  <var class="pdparam">upperleftx=NULL</var>, double precision  <var class="pdparam">upperlefty=NULL</var>, double precision  <var class="pdparam">skewx=0</var>, double precision  <var class="pdparam">skewy=0</var>, boolean  <var class="pdparam">touched=false</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_AsRaster</b>(</code>geometry  <var class="pdparam">geom</var>, integer  <var class="pdparam">width</var>, integer  <var class="pdparam">height</var>, double precision  <var class="pdparam">gridx</var>, double precision  <var class="pdparam">gridy</var>, text  <var class="pdparam">pixeltype</var>, double precision  <var class="pdparam">value=1</var>, double precision  <var class="pdparam">nodataval=0</var>, double precision  <var class="pdparam">skewx=0</var>, double precision  <var class="pdparam">skewy=0</var>, boolean  <var class="pdparam">touched=false</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_AsRaster</b>(</code>geometry  <var class="pdparam">geom</var>, integer  <var class="pdparam">width</var>, integer  <var class="pdparam">height</var>, double precision  <var class="pdparam">gridx=NULL</var>, double precision  <var class="pdparam">gridy=NULL</var>, text[]  <var class="pdparam">pixeltype=ARRAY['8BUI']</var>, double precision[]  <var class="pdparam">value=ARRAY[1]</var>, double precision[]  <var class="pdparam">nodataval=ARRAY[0]</var>, double precision  <var class="pdparam">skewx=0</var>, double precision  <var class="pdparam">skewy=0</var>, boolean  <var class="pdparam">touched=false</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_AsRaster</b>(</code>geometry  <var class="pdparam">geom</var>, integer  <var class="pdparam">width</var>, integer  <var class="pdparam">height</var>, text  <var class="pdparam">pixeltype</var>, double precision  <var class="pdparam">value=1</var>, double precision  <var class="pdparam">nodataval=0</var>, double precision  <var class="pdparam">upperleftx=NULL</var>, double precision  <var class="pdparam">upperlefty=NULL</var>, double precision  <var class="pdparam">skewx=0</var>, double precision  <var class="pdparam">skewy=0</var>, boolean  <var class="pdparam">touched=false</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_AsRaster</b>(</code>geometry  <var class="pdparam">geom</var>, integer  <var class="pdparam">width</var>, integer  <var class="pdparam">height</var>, text[]  <var class="pdparam">pixeltype</var>, double precision[]  <var class="pdparam">value=ARRAY[1]</var>, double precision[]  <var class="pdparam">nodataval=ARRAY[0]</var>, double precision  <var class="pdparam">upperleftx=NULL</var>, double precision  <var class="pdparam">upperlefty=NULL</var>, double precision  <var class="pdparam">skewx=0</var>, double precision  <var class="pdparam">skewy=0</var>, boolean  <var class="pdparam">touched=false</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72577920"></a><h2>説明</h2><p>PostGISジオメトリをPostGISラスタに変換します。多数の形式がありますが、結果ラスタのアラインメントとピクセルサイズを設定する三つの考えられる類型に分かれます。</p><p>一つ目の群は、最初の2形式です。 アラインメント (<code class="varname">scalex</code>, <code class="varname">scaley</code>, <code class="varname">gridx</code>, <code class="varname">gridy</code>)、ピクセルタイプ、NODATA値が提供される参照ラスタと同じとなるラスタを生成します。一般的にこの参照ラスタは、ジオメトリを含むテーブルを参照ラスタを含むテーブルに結合して渡します。</p><p>二つ目の群は、4形式あります。ピクセルサイズ (<code class="varname">scalex</code> &amp; <code class="varname">scaley</code>と<code class="varname">skewx</code> &amp; <code class="varname">skewy</code>)の引数を渡してラスタのピクセル範囲を設定します。結果ラスタの<code class="varname">width</code> &amp; <code class="varname">height</code>はジオメトリの範囲にあわせて調整されます。ほとんどの場合、PostgreSQLが正しい形式を選択するために、<code class="varname">scalex</code> &amp; <code class="varname">scaley</code>の整数引数を倍精度浮動小数点数にキャストしなければなりません。</p><p>三つ目の群は、4形式あります。ラスタのピクセル範囲 (<code class="varname">width</code> &amp; <code class="varname">height</code>)を渡してラスタのピクセル範囲を固定するものです。結果ラスタのピクセルサイズ(<code class="varname">scalex</code> &amp; <code class="varname">scaley</code>と<code class="varname">skewx</code> &amp; <code class="varname">skewy</code>)の引数はジオメトリの範囲にあわせて調整されます。</p><p>二つ目の群と三つ目の群の群内前半2形式は、アラインメントグリッド (<code class="varname">gridx</code> &amp; <code class="varname">gridy</code>)の適切な隅でアラインメントを特定します。群内後半2形式は左上隅 (<code class="varname">upperleftx</code> &amp; <code class="varname">upperlefty</code>)を取ります。</p><p>これらの群のそれぞれによって、1バンドまたは複数バンドのラスタを生成することができます。複数バンドのラスタを生成するには、ピクセルタイプ配列 (<code class="varname">pixeltype[]</code>)、初期値配列 (<code class="varname">value</code>)、NODATA値配列 (<code class="varname">nodataval</code>)を渡す必要があります。ピクセルタイプが渡されていない場合には、デフォルトは8BUIになり、初期値については1、NODATA値については0になります。</p><p>出力ラスタは元のジオメトリと同じ空間参照系になります。参照ラスタを使う形式は例外で、結果ラスタは参照ラスタと同じSRIDになります。</p><p>任意引数<code class="varname">touched</code>は、デフォルトではFALSEになります。GDALのALL_TOUCHEDラスタ化オプションに相当し、ラインまたはポリゴンに接触するピクセルが描画されます。ライン上にあるか中心点がポリゴン内部にあるピクセルが描画されるだけではありません。</p><p>これは特にジオメトリをデータベースから<a class="xref" href="#RT_ST_AsPNG" title="ST_AsPNG">ST_AsPNG</a>や<a class="xref" href="#RT_ST_AsGDALRaster" title="ST_AsGDALRaster">ST_AsGDALRaster</a>系の関数を併用して直接JPEGやPNGに描画する際に使えます。</p><p>Availability: 2.0.0 - GDAL 1.6.0以上が必要です。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>曲線、TIN、多面体サーフェスのような複雑なジオメトリタイプのレンダリングは、まだできませんが、GDALができることは実現できます。</p></td></tr></table></div></div><div class="refsection"><a name="idp72610304"></a><h2>例: ジオメトリをPNGファイルとして出力</h2><div class="informalfigure"><div class="mediaobject"><img src="images/st_asraster01.png"><div class="caption"><p>黒い円</p></div></div></div><pre class="programlisting">-- 150x150ピクセルを占める黒い円を出力します --
SELECT ST_AsPNG(ST_AsRaster(ST_Buffer(ST_Point(1,5),10),150, 150));</pre><div class="informalfigure"><div class="mediaobject"><img src="images/st_asraster02.png"><div class="caption"><p>PostGISだけで描画したバッファの例</p></div></div></div><pre class="programlisting">-- RGBバンド (118,154,118) - 鴨の羽色 にマップします --
SELECT ST_AsPNG(
    ST_AsRaster(
        ST_Buffer(
            ST_GeomFromText('LINESTRING(50 50,150 150,150 50)'), 10,'join=bevel'),
            200,200,ARRAY['8BUI', '8BUI', '8BUI'], ARRAY[118,154,118], ARRAY[0,0,0]));</pre></div><div class="refsection"><a name="idp72629248"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_BandPixelType" title="ST_BandPixelType">ST_BandPixelType</a>, <a class="xref" href="#ST_Buffer" title="ST_Buffer">ST_Buffer</a>, <a class="xref" href="#RT_ST_GDALDrivers" title="ST_GDALDrivers">ST_GDALDrivers</a>, <a class="xref" href="#RT_ST_AsGDALRaster" title="ST_AsGDALRaster">ST_AsGDALRaster</a>, <a class="xref" href="#RT_ST_AsPNG" title="ST_AsPNG">ST_AsPNG</a>, <a class="xref" href="#RT_ST_AsJPEG" title="ST_AsJPEG">ST_AsJPEG</a>, <a class="xref" href="#RT_ST_SRID" title="ST_SRID">ST_SRID</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Band"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Band — 既存のラスタの、一つ以上のバンドを新しいラスタとして返します。既存のラスタから新しいラスタを構築する際に使えます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_Band</b>(</code>raster  <var class="pdparam">rast</var>, integer[]  <var class="pdparam">nbands = ARRAY[1]</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Band</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Band</b>(</code>raster  <var class="pdparam">rast</var>, text  <var class="pdparam">nbands</var>, character  <var class="pdparam">delimiter=,</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72646016"></a><h2>説明</h2><p>既存のラスタの、一つ以上のバンドを新しいラスタとして返します。既存ラスタから新しいラスタを構築したり、ラスタの選択したバンドのみを出力したり、バンドの並びを改める際に使えます。バンドが指定されない場合や指定したバンドがラスタに存在しない場合には、全てのバンドを返します。バンド削除等の様々な関数を補助する関数として使われています。 </p><div class="warning"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="code">nbands</code>を文字列とする版では、デフォルトのデリミタは<code class="code">,</code>です。<code class="code">'1,2,3'</code>と指定できます。異なるデリミタを使いたい場合には、<code class="code">ST_Band(rast, '1@2@3', '@')</code>とします。複数バンドを指定する際に、<code class="code">ST_Band(rast, '{1,2,3}'::int[]);</code>というような、配列を使うことを強くお勧めします。<code class="code">text</code>によるバンド一覧を取る形式は、PostGISの将来の版で削除するかも知れません。</p></td></tr></table></div><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp72654336"></a><h2>例</h2><pre class="programlisting">-- 二つの新しいラスタを生成します
--   1 - ダミーラスタの1番バンド
--   2 - ダミーラスタの3番バンドを生成して2BUIで再分類
SELECT ST_NumBands(rast1) As numb1, ST_BandPixelType(rast1) As pix1,
 ST_NumBands(rast2) As numb2,  ST_BandPixelType(rast2) As pix2
FROM (
    SELECT ST_Band(rast) As rast1, ST_Reclass(ST_Band(rast,3), '100-200):1, [200-254:2', '2BUI') As rast2
        FROM dummy_rast
        WHERE rid = 2) As foo;

 numb1 | pix1 | numb2 | pix2
-------+------+-------+------
     1 | 8BUI |     1 | 2BUI
                    </pre><pre class="programlisting">-- 配列へのキャストを使って2番と3番バンドを返します
SELECT ST_NumBands(ST_Band(rast, '{2,3}'::int[])) As num_bands
    FROM dummy_rast WHERE rid=2;

num_bands
----------
2

-- バンドの指定に配列を使って2番と3番バンドを返します
SELECT ST_NumBands(ST_Band(rast, ARRAY[2,3])) As num_bands
    FROM dummy_rast
WHERE rid=2;
                    </pre><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col><col><col></colgroup><tbody><tr><td style="border-right: 1px solid ; "><div class="informalfigure"><div class="mediaobject"><img src="images/st_band01.png"><div class="caption"><p>元画像 (rastカラム)</p></div></div></div>
         </td><td style="border-right: 1px solid ; "><div class="informalfigure"><div class="mediaobject"><img src="images/st_band02.png"><div class="caption"><p>dupe_band</p></div></div></div>
         </td><td style=""><div class="informalfigure"><div class="mediaobject"><img src="images/st_band03.png"><div class="caption"><p>sing_band</p></div></div></div>
         </td></tr></tbody></table></div><pre class="programlisting">-- 元画像の2番バンド、1番バンド、1番バンドでバンドを成すラスタと
-- 3番バンドだけのラスタの生成
SELECT rast, ST_Band(rast, ARRAY[2,1,1]) As dupe_band,
    ST_Band(rast, 3) As sing_band
FROM samples.than_chunked
WHERE rid=35;
                    </pre></div><div class="refsection"><a name="idp72665984"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_AddBand" title="ST_AddBand">ST_AddBand</a>, <a class="xref" href="#RT_ST_NumBands" title="ST_NumBands">ST_NumBands</a>, <a class="xref" href="#RT_ST_Reclass" title="ST_Reclass">ST_Reclass</a>, <a class="xref" href="#RT_reference" title="第12章 ラスタ リファレンス">12章<i>ラスタ リファレンス</i></a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_MakeEmptyCoverage"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MakeEmptyCoverage — 空のラスタタイルのグリッドでジオリファレンスを施されている領域を生成します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_MakeEmptyCoverage</b>(</code>integer  <var class="pdparam">tilewidth</var>, integer  <var class="pdparam">tileheight</var>, integer  <var class="pdparam">width</var>, integer  <var class="pdparam">height</var>, double precision  <var class="pdparam">upperleftx</var>, double precision  <var class="pdparam">upperlefty</var>, double precision  <var class="pdparam">scalex</var>, double precision  <var class="pdparam">scaley</var>, double precision  <var class="pdparam">skewx</var>, double precision  <var class="pdparam">skewy</var>, integer  <var class="pdparam">srid=unknown</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72683392"></a><h2>説明</h2><p><a class="xref" href="#RT_ST_MakeEmptyRaster" title="ST_MakeEmptyRaster">ST_MakeEmptyRaster</a>でラスタ集合を生成します。グリッドの次元は<code class="varname">width</code>と<code class="varname">height</code>です。タイルの次元は<code class="varname">tilewidth</code>と<code class="varname">tileheight</code>です。領域は左上隅(<code class="varname">upperleftx</code>, <code class="varname">upperlefty</code>)から右下隅 (<code class="varname">upperleftx</code> + <code class="varname">width</code> * <code class="varname">scalex</code>, <code class="varname">upperlefty</code> + <code class="varname">height</code> * <code class="varname">scaley</code>)で形成されます。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ラスタのscaleyは一般的に負数で、scalexは一般的に正数です。右下隅は、左上隅より、yは小さな値、xは大きな値になります。</p></td></tr></table></div><p>Availability: 2.4.0 </p></div><div class="refsection"><a name="idp72690304"></a><h2>基本的な例</h2><p>WGS84で左上が(22, 27)で右下が(55, 53)となる範囲の4x4グリッドの16タイルを生成します。</p><pre class="programlisting">SELECT (ST_MetaData(tile)).* FROM ST_MakeEmptyCoverage(1, 1, 4, 4, 22, 33, (55 - 22)/(4)::float, (33 - 77)/(4)::float, 0., 0., 4326) tile;

 upperleftx | upperlefty | width | height | scalex | scaley | skewx | skewy | srid | numbands
-------------------------------------------------------------------------------------
         22 |         33 |     1 |      1 |   8.25 |    -11 |     0 |     0 | 4326 |        0
      30.25 |         33 |     1 |      1 |   8.25 |    -11 |     0 |     0 | 4326 |        0
       38.5 |         33 |     1 |      1 |   8.25 |    -11 |     0 |     0 | 4326 |        0
      46.75 |         33 |     1 |      1 |   8.25 |    -11 |     0 |     0 | 4326 |        0
         22 |         22 |     1 |      1 |   8.25 |    -11 |     0 |     0 | 4326 |        0
      30.25 |         22 |     1 |      1 |   8.25 |    -11 |     0 |     0 | 4326 |        0
       38.5 |         22 |     1 |      1 |   8.25 |    -11 |     0 |     0 | 4326 |        0
      46.75 |         22 |     1 |      1 |   8.25 |    -11 |     0 |     0 | 4326 |        0
         22 |         11 |     1 |      1 |   8.25 |    -11 |     0 |     0 | 4326 |        0
      30.25 |         11 |     1 |      1 |   8.25 |    -11 |     0 |     0 | 4326 |        0
       38.5 |         11 |     1 |      1 |   8.25 |    -11 |     0 |     0 | 4326 |        0
      46.75 |         11 |     1 |      1 |   8.25 |    -11 |     0 |     0 | 4326 |        0
         22 |          0 |     1 |      1 |   8.25 |    -11 |     0 |     0 | 4326 |        0
      30.25 |          0 |     1 |      1 |   8.25 |    -11 |     0 |     0 | 4326 |        0
       38.5 |          0 |     1 |      1 |   8.25 |    -11 |     0 |     0 | 4326 |        0
      46.75 |          0 |     1 |      1 |   8.25 |    -11 |     0 |     0 | 4326 |        0</pre></div><div class="refsection"><a name="idp72691968"></a><h2>関連情報</h2><p>
                      <a class="xref" href="#RT_ST_MakeEmptyRaster" title="ST_MakeEmptyRaster">ST_MakeEmptyRaster</a>
                    </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_MakeEmptyRaster"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MakeEmptyRaster — 与えられたピクセル範囲 (width &amp; height)、左上のX,Y、ピクセルサイズ、回転 (scalex, scaley, skewx, skewy)と空間参照系 (srid)が指定された空ラスタ (バンドを持たないラスタ)を返します。ラスタが渡されると、新しいラスタは渡されたラスタと同じサイズ、アラインメント、SRIDになります。SRIDが指定されていない場合には、空間参照系は不明 (0)とされます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_MakeEmptyRaster</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_MakeEmptyRaster</b>(</code>integer  <var class="pdparam">width</var>, integer  <var class="pdparam">height</var>, float8  <var class="pdparam">upperleftx</var>, float8  <var class="pdparam">upperlefty</var>, float8  <var class="pdparam">scalex</var>, float8  <var class="pdparam">scaley</var>, float8  <var class="pdparam">skewx</var>, float8  <var class="pdparam">skewy</var>, integer  <var class="pdparam">srid=unknown</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_MakeEmptyRaster</b>(</code>integer  <var class="pdparam">width</var>, integer  <var class="pdparam">height</var>, float8  <var class="pdparam">upperleftx</var>, float8  <var class="pdparam">upperlefty</var>, float8  <var class="pdparam">pixelsize</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72714752"></a><h2>説明</h2><p>与えられたピクセル範囲 (width &amp; height)を持ち、かつ、左上隅のX (upperleftx)とY (upperlefty)、ピクセルサイズと回転 (scalex, scaley, skewx, skewy)、空間参照系 (srid)によって空間 (またはワールド)座標上で地理参照された空ラスタ (バンドを持たないラスタ)を返します。</p><p>最後の形式では、ピクセルサイズを一つの引数 (pixelsize)で指定しています。scalexはこの引数に、scaleyは引数の正負逆の数に、それぞれ設定され、skewxとskewyは0に設定されます。 </p><p>既存のラスタを渡すと、同じメタデータ設定 (バンド以外)を持つ新しいラスタが返ります。 </p><p>SRIDが設定されていない場合には、デフォルトは0です。空ラスタを生成した後に、バンドの追加や編集を行うことになります。<a class="xref" href="#RT_ST_AddBand" title="ST_AddBand">ST_AddBand</a>でバンドを定義し、<a class="xref" href="#RT_ST_SetValue" title="ST_SetValue">ST_SetValue</a>で初期ピクセル値を設定します。</p></div><div class="refsection"><a name="idp72717952"></a><h2>例</h2><pre class="programlisting">INSERT INTO dummy_rast(rid,rast)
VALUES(3, ST_MakeEmptyRaster( 100, 100, 0.0005, 0.0005, 1, 1, 0, 0, 4326) );

-- 既存のラスタをテンプレートに用いて新しいラスタを生成
INSERT INTO dummy_rast(rid,rast)
SELECT 4, ST_MakeEmptyRaster(rast)
FROM dummy_rast WHERE rid = 3;

-- 既存ラスタと生成したラスタのメタデータを出力
SELECT rid, (md).*
FROM (SELECT rid, ST_MetaData(rast) As md
    FROM dummy_rast
    WHERE rid IN(3,4)) As foo;

-- 出力 --
 rid | upperleftx | upperlefty | width | height | scalex | scaley | skewx | skewy | srid | numbands
-----+------------+------------+-------+--------+------------+------------+-------+-------+------+----------
   3 |     0.0005 |     0.0005 |   100 |    100 |          1 |          1 |    0  |     0 | 4326 |        0
   4 |     0.0005 |     0.0005 |   100 |    100 |          1 |          1 |    0  |     0 | 4326 |        0
                </pre></div><div class="refsection"><a name="idp72723328"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_AddBand" title="ST_AddBand">ST_AddBand</a>, <a class="xref" href="#RT_ST_MetaData" title="ST_MetaData">ST_MetaData</a>, <a class="xref" href="#RT_ST_ScaleX" title="ST_ScaleX">ST_ScaleX</a>, <a class="xref" href="#RT_ST_ScaleY" title="ST_ScaleY">ST_ScaleY</a>, <a class="xref" href="#RT_ST_SetValue" title="ST_SetValue">ST_SetValue</a>, <a class="xref" href="#RT_ST_SkewX" title="ST_SkewX">ST_SkewX</a>, , <a class="xref" href="#RT_ST_SkewY" title="ST_SkewY">ST_SkewY</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Tile"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Tile — 求められた出力ラスタのピクセル数に基づいて入力ラスタを分割した結果のラスタ集合を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">setof raster <b class="fsfunc">ST_Tile</b>(</code>raster  <var class="pdparam">rast</var>, int[]  <var class="pdparam">nband</var>, integer  <var class="pdparam">width</var>, integer  <var class="pdparam">height</var>, boolean  <var class="pdparam">padwithnodata=FALSE</var>, double precision  <var class="pdparam">nodataval=NULL</var><code>)</code>;</p><p><code class="funcdef">setof raster <b class="fsfunc">ST_Tile</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, integer  <var class="pdparam">width</var>, integer  <var class="pdparam">height</var>, boolean  <var class="pdparam">padwithnodata=FALSE</var>, double precision  <var class="pdparam">nodataval=NULL</var><code>)</code>;</p><p><code class="funcdef">setof raster <b class="fsfunc">ST_Tile</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">width</var>, integer  <var class="pdparam">height</var>, boolean  <var class="pdparam">padwithnodata=FALSE</var>, double precision  <var class="pdparam">nodataval=NULL</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72767232"></a><h2>説明</h2><p>求められた出力ラスタのピクセル数に基づいて入力ラスタを分割した結果のラスタ集合を返します。 </p><p><code class="varname">padwithnodata</code>がFALSEである場合には、ラスタの右端と下端のタイルは、他のタイルと異なるピクセル範囲を持つことがあります。<code class="varname">padwithnodata</code>がTRUEの場合には、全てのタイルは同じピクセル範囲を持ち、端のタイルにNODATA値が詰められます。ラスタバンドにNODATA値が指定されていない場合には、<code class="varname">nodataval</code>で指定することができます。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>入力ラスタの指定したバンドがデータベース外ラスタの場合には、出力ラスタ内の対応するバンドもデータベース外になります。 </p></td></tr></table></div><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp72770944"></a><h2>例</h2><pre class="programlisting">WITH foo AS (
    SELECT ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(3, 3, 0, 0, 1, -1, 0, 0, 0), 1, '8BUI', 1, 0), 2, '8BUI', 10, 0) AS rast UNION ALL
    SELECT ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(3, 3, 3, 0, 1, -1, 0, 0, 0), 1, '8BUI', 2, 0), 2, '8BUI', 20, 0) AS rast UNION ALL
    SELECT ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(3, 3, 6, 0, 1, -1, 0, 0, 0), 1, '8BUI', 3, 0), 2, '8BUI', 30, 0) AS rast UNION ALL

    SELECT ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(3, 3, 0, -3, 1, -1, 0, 0, 0), 1, '8BUI', 4, 0), 2, '8BUI', 40, 0) AS rast UNION ALL
    SELECT ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(3, 3, 3, -3, 1, -1, 0, 0, 0), 1, '8BUI', 5, 0), 2, '8BUI', 50, 0) AS rast UNION ALL
    SELECT ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(3, 3, 6, -3, 1, -1, 0, 0, 0), 1, '8BUI', 6, 0), 2, '8BUI', 60, 0) AS rast UNION ALL

    SELECT ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(3, 3, 0, -6, 1, -1, 0, 0, 0), 1, '8BUI', 7, 0), 2, '8BUI', 70, 0) AS rast UNION ALL
    SELECT ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(3, 3, 3, -6, 1, -1, 0, 0, 0), 1, '8BUI', 8, 0), 2, '8BUI', 80, 0) AS rast UNION ALL
    SELECT ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(3, 3, 6, -6, 1, -1, 0, 0, 0), 1, '8BUI', 9, 0), 2, '8BUI', 90, 0) AS rast
), bar AS (
    SELECT ST_Union(rast) AS rast FROM foo
), baz AS (
    SELECT ST_Tile(rast, 3, 3, TRUE) AS rast FROM bar
)
SELECT
    ST_DumpValues(rast)
FROM baz;

              st_dumpvalues
------------------------------------------
 (1,"{{1,1,1},{1,1,1},{1,1,1}}")
 (2,"{{10,10,10},{10,10,10},{10,10,10}}")
 (1,"{{2,2,2},{2,2,2},{2,2,2}}")
 (2,"{{20,20,20},{20,20,20},{20,20,20}}")
 (1,"{{3,3,3},{3,3,3},{3,3,3}}")
 (2,"{{30,30,30},{30,30,30},{30,30,30}}")
 (1,"{{4,4,4},{4,4,4},{4,4,4}}")
 (2,"{{40,40,40},{40,40,40},{40,40,40}}")
 (1,"{{5,5,5},{5,5,5},{5,5,5}}")
 (2,"{{50,50,50},{50,50,50},{50,50,50}}")
 (1,"{{6,6,6},{6,6,6},{6,6,6}}")
 (2,"{{60,60,60},{60,60,60},{60,60,60}}")
 (1,"{{7,7,7},{7,7,7},{7,7,7}}")
 (2,"{{70,70,70},{70,70,70},{70,70,70}}")
 (1,"{{8,8,8},{8,8,8},{8,8,8}}")
 (2,"{{80,80,80},{80,80,80},{80,80,80}}")
 (1,"{{9,9,9},{9,9,9},{9,9,9}}")
 (2,"{{90,90,90},{90,90,90},{90,90,90}}")
(18 rows)
                </pre><pre class="programlisting">WITH foo AS (
    SELECT ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(3, 3, 0, 0, 1, -1, 0, 0, 0), 1, '8BUI', 1, 0), 2, '8BUI', 10, 0) AS rast UNION ALL
    SELECT ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(3, 3, 3, 0, 1, -1, 0, 0, 0), 1, '8BUI', 2, 0), 2, '8BUI', 20, 0) AS rast UNION ALL
    SELECT ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(3, 3, 6, 0, 1, -1, 0, 0, 0), 1, '8BUI', 3, 0), 2, '8BUI', 30, 0) AS rast UNION ALL

    SELECT ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(3, 3, 0, -3, 1, -1, 0, 0, 0), 1, '8BUI', 4, 0), 2, '8BUI', 40, 0) AS rast UNION ALL
    SELECT ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(3, 3, 3, -3, 1, -1, 0, 0, 0), 1, '8BUI', 5, 0), 2, '8BUI', 50, 0) AS rast UNION ALL
    SELECT ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(3, 3, 6, -3, 1, -1, 0, 0, 0), 1, '8BUI', 6, 0), 2, '8BUI', 60, 0) AS rast UNION ALL

    SELECT ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(3, 3, 0, -6, 1, -1, 0, 0, 0), 1, '8BUI', 7, 0), 2, '8BUI', 70, 0) AS rast UNION ALL
    SELECT ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(3, 3, 3, -6, 1, -1, 0, 0, 0), 1, '8BUI', 8, 0), 2, '8BUI', 80, 0) AS rast UNION ALL
    SELECT ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(3, 3, 6, -6, 1, -1, 0, 0, 0), 1, '8BUI', 9, 0), 2, '8BUI', 90, 0) AS rast
), bar AS (
    SELECT ST_Union(rast) AS rast FROM foo
), baz AS (
    SELECT ST_Tile(rast, 3, 3, 2) AS rast FROM bar
)
SELECT
    ST_DumpValues(rast)
FROM baz;

              st_dumpvalues
------------------------------------------
 (1,"{{10,10,10},{10,10,10},{10,10,10}}")
 (1,"{{20,20,20},{20,20,20},{20,20,20}}")
 (1,"{{30,30,30},{30,30,30},{30,30,30}}")
 (1,"{{40,40,40},{40,40,40},{40,40,40}}")
 (1,"{{50,50,50},{50,50,50},{50,50,50}}")
 (1,"{{60,60,60},{60,60,60},{60,60,60}}")
 (1,"{{70,70,70},{70,70,70},{70,70,70}}")
 (1,"{{80,80,80},{80,80,80},{80,80,80}}")
 (1,"{{90,90,90},{90,90,90},{90,90,90}}")
(9 rows)
                </pre></div><div class="refsection"><a name="idp72772736"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Union" title="ST_Union">ST_Union</a>, <a class="xref" href="#RT_Retile" title="ST_Retile">ST_Retile</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_Retile"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Retile — 任意のタイル化されたラスタカバレッジから構成されたタイルの集合を返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">SETOF raster <b class="fsfunc">ST_Retile</b>(</code>regclass  <var class="pdparam">tab</var>, name  <var class="pdparam">col</var>, geometry  <var class="pdparam">ext</var>, float8  <var class="pdparam">sfx</var>, float8  <var class="pdparam">sfy</var>, int  <var class="pdparam">tw</var>, int  <var class="pdparam">th</var>, text  <var class="pdparam">algo='NearestNeighbor'</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72811008"></a><h2>説明</h2><p>指定された縮尺 (<code class="varname">sfx</code>, <code class="varname">sfy</code>)と最大サイズ (<code class="varname">tw</code>, <code class="varname">th</code>)を持ち、指定された範囲 (<code class="varname">ext</code>)を包含し、指定されたラスタカバレッジ (<code class="varname">tab</code>, <code class="varname">col</code>)からのデータを持つタイルの集合を返します。 </p><p>アルゴリズム指定オプションは'NearestNeighbor', 'Bilinear', 'Cubic', 'CubicSpline', 'Lanczos'です。詳細については<a class="ulink" href="http://www.gdal.org/gdalwarp.html" target="_top">GDAL Warp resampling methods</a>をご覧ください。</p><p>Availability: 2.2.0</p></div><div class="refsection"><a name="idp72816256"></a><h2>関連情報</h2><p>
          <a class="xref" href="#RT_CreateOverview" title="ST_CreateOverview">ST_CreateOverview</a>
        </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_FromGDALRaster"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_FromGDALRaster — 対応するGDALラスタファイルからラスタを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_FromGDALRaster</b>(</code>bytea  <var class="pdparam">gdaldata</var>, integer  <var class="pdparam">srid=NULL</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72823424"></a><h2>説明</h2><p>対応するGDALラスタファイルからラスタを返します。<code class="varname">gdaldata</code>はbytea型で、GDALラスタファイルの中身です。 </p><p><code class="varname">srid</code>がNULLの場合には、この関数は、GDALラスタから自動的にSRIDを設定しようとします。<code class="varname">srid</code>が与えられている場合には、与えられた値が自動的に設定したSRIDを上書きします。 </p><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp72826496"></a><h2>例</h2><pre class="programlisting">WITH foo AS (
    SELECT ST_AsPNG(ST_AddBand(ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(2, 2, 0, 0, 0.1, -0.1, 0, 0, 4326), 1, '8BUI', 1, 0), 2, '8BUI', 2, 0), 3, '8BUI', 3, 0)) AS png
),
bar AS (
    SELECT 1 AS rid, ST_FromGDALRaster(png) AS rast FROM foo
    UNION ALL
    SELECT 2 AS rid, ST_FromGDALRaster(png, 3310) AS rast FROM foo
)
SELECT
    rid,
    ST_Metadata(rast) AS metadata,
    ST_SummaryStats(rast, 1) AS stats1,
    ST_SummaryStats(rast, 2) AS stats2,
    ST_SummaryStats(rast, 3) AS stats3
FROM bar
ORDER BY rid;

 rid |         metadata          |    stats1     |    stats2     |     stats3
-----+---------------------------+---------------+---------------+----------------
   1 | (0,0,2,2,1,-1,0,0,0,3)    | (4,4,1,0,1,1) | (4,8,2,0,2,2) | (4,12,3,0,3,3)
   2 | (0,0,2,2,1,-1,0,0,3310,3) | (4,4,1,0,1,1) | (4,8,2,0,2,2) | (4,12,3,0,3,3)
(2 rows)
                </pre></div><div class="refsection"><a name="idp72827776"></a><h2>関連情報</h2><p>
                    <a class="xref" href="#RT_ST_AsGDALRaster" title="ST_AsGDALRaster">ST_AsGDALRaster</a>
                </p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Raster_Accessors"></a>12.4. ラスタアクセサ</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#RT_ST_GeoReference">ST_GeoReference</a></span><span class="refpurpose"> — GDAL書式または一般的にワールドファイルでみられるESRI書式の地理参照メタデータを返します。デフォルトはGDALです。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Height">ST_Height</a></span><span class="refpurpose"> — ラスタの高さをピクセル単位で返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_IsEmpty">ST_IsEmpty</a></span><span class="refpurpose"> — ラスタが空 (幅が0で高さが0)の場合にはTRUEを返します。他の場合には、FALSEを返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_MemSize">ST_MemSize</a></span><span class="refpurpose"> — ラスタが取る領域の合計をバイト単位で返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_MetaData">ST_MetaData</a></span><span class="refpurpose"> — ピクセル数、回転 (スキュー)、左上隅位置等のラスタオブジェクトに関する基本的なメタデータを返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_NumBands">ST_NumBands</a></span><span class="refpurpose"> — ラスタオブジェクトのバンド数を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_PixelHeight">ST_PixelHeight</a></span><span class="refpurpose"> — 空間参照系の地理的な単位でのピクセルの高さを返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_PixelWidth">ST_PixelWidth</a></span><span class="refpurpose"> — 空間参照系の地理的な単位でのピクセルの幅を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_ScaleX">ST_ScaleX</a></span><span class="refpurpose"> — 空間参照系の地理的な単位でのピクセル幅のX成分を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_ScaleY">ST_ScaleY</a></span><span class="refpurpose"> — 空間参照系の地理的な単位でのピクセル幅のY成分を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_RasterToWorldCoord">ST_RasterToWorldCoord</a></span><span class="refpurpose"> — ラスタの指定した列と行における左上隅の地理座標X値とY値 (経度と緯度)を返します。列と行の番号は1始まりです。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_RasterToWorldCoordX">ST_RasterToWorldCoordX</a></span><span class="refpurpose"> — ラスタの指定した列と行における左上隅の地理座標のX値を返します。列と行の番号は1始まりです。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_RasterToWorldCoordY">ST_RasterToWorldCoordY</a></span><span class="refpurpose"> — ラスタの指定した列と行における左上隅の地理座標のY値を返します。列と行の番号は1始まりです。 </span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Rotation">ST_Rotation</a></span><span class="refpurpose"> — ラスタの回転をラジアンで返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_SkewX">ST_SkewX</a></span><span class="refpurpose"> — 空間参照のXスキュー (回転パラメータ)を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_SkewY">ST_SkewY</a></span><span class="refpurpose"> — 空間参照のYスキュー (回転パラメータ)を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_SRID">ST_SRID</a></span><span class="refpurpose"> — ラスタのspatial_ref_sysテーブルで定義されている空間参照系識別番号を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Summary">ST_Summary</a></span><span class="refpurpose"> — ラスタの中身の概要が文字列で返されます。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_UpperLeftX">ST_UpperLeftX</a></span><span class="refpurpose"> — 適用されている空間参照系でのラスタの左上隅のX座標値を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_UpperLeftY">ST_UpperLeftY</a></span><span class="refpurpose"> — 適用されている空間参照系でのラスタの左上隅のY座標値を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Width">ST_Width</a></span><span class="refpurpose"> — ラスタの幅をピクセル単位で返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_WorldToRasterCoord">ST_WorldToRasterCoord</a></span><span class="refpurpose"> — ラスタの空間参照系による地理座標のX値とY値 (経度と緯度)またはポイントジオメトリに対応するピクセルの左上隅を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_WorldToRasterCoordX">ST_WorldToRasterCoordX</a></span><span class="refpurpose"> — ラスタの空間参照系に基づくポイントジオメトリ (pt)またはX,Y座標値 (xw,yw)に対応するラスタの列を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_WorldToRasterCoordY">ST_WorldToRasterCoordY</a></span><span class="refpurpose"> — ラスタの空間参照系に基づくポイントジオメトリ (pt)またはX,Y座標値 (xw,yw)に対応するラスタの行を返します。</span></dt></dl></div><div class="refentry"><a name="RT_ST_GeoReference"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_GeoReference — GDAL書式または一般的にワールドファイルでみられるESRI書式の地理参照メタデータを返します。デフォルトはGDALです。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_GeoReference</b>(</code>raster  <var class="pdparam">rast</var>, text  <var class="pdparam">format=GDAL</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72835840"></a><h2>説明</h2><p>GDAL書式または一般的に<a class="ulink" href="http://en.wikipedia.org/wiki/World_file" target="_top">world file</a> (英語版WikiPedia)でみられるESRI書式の地理参照メタデータを返します。書式を指定したいない場合のデフォルトはGDALです。書式は'GDAL'または'ESRI'の文字列です。 </p><p>書式の表現の違いは次の通りです。</p><p><code class="varname">GDAL</code>: </p><pre class="programlisting">scalex
skewy
skewx
scaley
upperleftx
upperlefty</pre><p><code class="varname">ESRI</code>: </p><pre class="programlisting">scalex
skewy
skewx
scaley
upperleftx + scalex*0.5
upperlefty + scaley*0.5</pre></div><div class="refsection"><a name="idp72839936"></a><h2>例</h2><pre class="programlisting">SELECT ST_GeoReference(rast, 'ESRI') As esri_ref, ST_GeoReference(rast, 'GDAL') As gdal_ref
 FROM dummy_rast WHERE rid=1;

   esri_ref   |   gdal_ref
--------------+--------------
 2.0000000000 | 2.0000000000
 0.0000000000 : 0.0000000000
 0.0000000000 : 0.0000000000
 3.0000000000 : 3.0000000000
 1.5000000000 : 0.5000000000
 2.0000000000 : 0.5000000000
                </pre></div><div class="refsection"><a name="idp72841216"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_SetGeoReference" title="ST_SetGeoReference">ST_SetGeoReference</a>, <a class="xref" href="#RT_ST_ScaleX" title="ST_ScaleX">ST_ScaleX</a>, <a class="xref" href="#RT_ST_ScaleY" title="ST_ScaleY">ST_ScaleY</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Height"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Height — ラスタの高さをピクセル単位で返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_Height</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72847744"></a><h2>説明</h2><p>ラスタの高さをピクセル単位で返します。</p></div><div class="refsection"><a name="idp72848896"></a><h2>例</h2><pre class="programlisting">SELECT rid, ST_Height(rast) As rastheight
FROM dummy_rast;

 rid | rastheight
-----+------------
   1 |         20
   2 |          5
                </pre></div><div class="refsection"><a name="idp72850176"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Width" title="ST_Width">ST_Width</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_IsEmpty"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_IsEmpty — ラスタが空 (幅が0で高さが0)の場合にはTRUEを返します。他の場合には、FALSEを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_IsEmpty</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72856064"></a><h2>説明</h2><p>ラスタが空 (幅が0で高さが0)の場合にはTRUEを返します。他の場合には、FALSEを返します。</p><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp72857728"></a><h2>例</h2><pre class="programlisting">SELECT ST_IsEmpty(ST_MakeEmptyRaster(100, 100, 0, 0, 0, 0, 0, 0))
st_isempty |
-----------+
f          |


SELECT ST_IsEmpty(ST_MakeEmptyRaster(0, 0, 0, 0, 0, 0, 0, 0))
st_isempty |
-----------+
t          |

                </pre></div><div class="refsection"><a name="idp72859264"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_HasNoBand" title="ST_HasNoBand">ST_HasNoBand</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_MemSize"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MemSize — ラスタが取る領域の合計をバイト単位で返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_MemSize</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72865024"></a><h2>説明</h2><p>ラスタが取る領域の合計をバイト単位で返します。 </p><p>この関数はPostgreSQLビルトイン関数pg_clumn_size, pg_size_pretty, pg_relation_size, pg_total_relation_sizeへのすばらしい賛辞です。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>テーブルのバイト単位のサイズを得るpg_relation_sizeはST_MemSizeよりも小さい値を返すことがあります。pg_relation_sizeはTOASTテーブルの寄与分を追加せず、大きなジオメトリはTOASTテーブルに格納されるためです。pg_column_sizeは圧縮後のサイズを返すので、小さくなることがあります。</p><p>pg_total_relation_size - テーブル、TOASTテーブル、インデクスを含みます。</p></td></tr></table></div><p>Availability: 2.2.0</p></div><div class="refsection"><a name="idp72867968"></a><h2>例</h2><pre class="programlisting">SELECT ST_MemSize(ST_AsRaster(ST_Buffer(ST_Point(1,5),10,1000),150, 150, '8BUI')) As rast_mem;

        rast_mem
        --------
        22568
    </pre></div><div class="refsection"><a name="idp72869504"></a><h2>関連情報</h2><p></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_MetaData"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MetaData — ピクセル数、回転 (スキュー)、左上隅位置等のラスタオブジェクトに関する基本的なメタデータを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">record <b class="fsfunc">ST_MetaData</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72875008"></a><h2>説明</h2><p>ピクセルサイズ、回転 (skew)、左上隅位置等のラスタオブジェクトに関する基本的なメタデータを返します。返されるカラムはupperleftx | upperlefty | width | height | scalex | scaley | skewx | skewy | srid | numbandsです。</p></div><div class="refsection"><a name="idp72876160"></a><h2>例</h2><pre class="programlisting">SELECT rid, (foo.md).*
 FROM (SELECT rid, ST_MetaData(rast) As md
FROM dummy_rast) As foo;

 rid | upperleftx | upperlefty | width | height | scalex | scaley | skewx | skewy | srid | numbands
 ----+------------+------------+-------+--------+--------+-----------+-------+-------+------+-------
   1 |        0.5 |        0.5 |    10 |     20 |      2 |      3 |     0 |     0 |    0 |        0
   2 | 3427927.75 |    5793244 |     5 |      5 |   0.05 |  -0.05 |     0 |     0 |    0 |        3
                </pre></div><div class="refsection"><a name="idp72877696"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_BandMetaData" title="ST_BandMetaData">ST_BandMetaData</a>, <a class="xref" href="#RT_ST_NumBands" title="ST_NumBands">ST_NumBands</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_NumBands"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_NumBands — ラスタオブジェクトのバンド数を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_NumBands</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72883840"></a><h2>説明</h2><p>ラスタオブジェクトのバンド数を返します。</p></div><div class="refsection"><a name="idp72884992"></a><h2>例</h2><pre class="programlisting">SELECT rid, ST_NumBands(rast) As numbands
FROM dummy_rast;

rid | numbands
----+----------
  1 |        0
  2 |        3
                </pre></div><div class="refsection"><a name="idp72886528"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Value" title="ST_Value">ST_Value</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_PixelHeight"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_PixelHeight — 空間参照系の地理的な単位でのピクセルの高さを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">double precision <b class="fsfunc">ST_PixelHeight</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72904576"></a><h2>説明</h2><p>空間参照系の地理的な単位でのピクセルの高さを返します。スキューが無い一般的な状況では、ピクセル高は地理座標とラスタピクセルのスケール率です。</p><p>関係について図示したものは<a class="xref" href="#RT_ST_PixelWidth" title="ST_PixelWidth">ST_PixelWidth</a>を参照して下さい。 </p></div><div class="refsection"><a name="idp72906496"></a><h2>例: スキューの無いラスタ</h2><pre class="programlisting">SELECT ST_Height(rast) As rastheight, ST_PixelHeight(rast) As pixheight,
 ST_ScaleX(rast) As scalex, ST_ScaleY(rast) As scaley, ST_SkewX(rast) As skewx,
        ST_SkewY(rast) As skewy
FROM dummy_rast;

 rastheight | pixheight | scalex | scaley | skewx | skewy
------------+-----------+--------+--------+-------+----------
         20 |         3 |      2 |      3 |     0 |        0
          5 |      0.05 |   0.05 |  -0.05 |     0 |        0
            </pre></div><div class="refsection"><a name="idp72907776"></a><h2>例: スキューが0でないラスタ</h2><pre class="programlisting">SELECT ST_Height(rast) As rastheight, ST_PixelHeight(rast) As pixheight,
 ST_ScaleX(rast) As scalex, ST_ScaleY(rast) As scaley, ST_SkewX(rast) As skewx,
        ST_SkewY(rast) As skewy
FROM (SELECT ST_SetSKew(rast,0.5,0.5) As rast
        FROM dummy_rast) As skewed;

rastheight |     pixheight     | scalex | scaley | skewx | skewy
-----------+-------------------+--------+--------+-------+----------
        20 |  3.04138126514911 |      2 |      3 |   0.5 |      0.5
         5 | 0.502493781056044 |   0.05 |  -0.05 |   0.5 |      0.5
            </pre></div><div class="refsection"><a name="idp72909312"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_PixelWidth" title="ST_PixelWidth">ST_PixelWidth</a>, <a class="xref" href="#RT_ST_ScaleX" title="ST_ScaleX">ST_ScaleX</a>, <a class="xref" href="#RT_ST_ScaleY" title="ST_ScaleY">ST_ScaleY</a>, <a class="xref" href="#RT_ST_SkewX" title="ST_SkewX">ST_SkewX</a>, <a class="xref" href="#RT_ST_SkewY" title="ST_SkewY">ST_SkewY</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_PixelWidth"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_PixelWidth — 空間参照系の地理的な単位でのピクセルの幅を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">double precision <b class="fsfunc">ST_PixelWidth</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72916736"></a><h2>説明</h2><p>空間参照系の地理的な単位でのピクセルの幅を返します。スキューが無い一般的な状況では、ピクセル幅は地理座標とラスタピクセルのスケール率です。</p><p>関係について次の図に示します。</p><p>
            </p><div class="informalfigure"><div class="mediaobject"><img src="images/raster_xscale_yscale_xskew_yskew.png"><div class="caption"><p>ピクセル幅: i方向のピクセルサイズ</p><p>ピクセル高: j方向のピクセルサイズ</p></div></div></div><p>
            </p></div><div class="refsection"><a name="idp72921088"></a><h2>例: スキューの無いラスタ</h2><pre class="programlisting">SELECT ST_Width(rast) As rastwidth, ST_PixelWidth(rast) As pixwidth,
    ST_ScaleX(rast) As scalex, ST_ScaleY(rast) As scaley, ST_SkewX(rast) As skewx,
    ST_SkewY(rast) As skewy
    FROM dummy_rast;

    rastwidth | pixwidth | scalex | scaley | skewx | skewy
    -----------+----------+--------+--------+-------+----------
    10 |        2 |      2 |      3 |     0 |        0
     5 |     0.05 |   0.05 |  -0.05 |     0 |        0
        </pre></div><div class="refsection"><a name="idp72922368"></a><h2>例: スキューが0でないラスタ</h2><pre class="programlisting">SELECT ST_Width(rast) As rastwidth, ST_PixelWidth(rast) As pixwidth,
    ST_ScaleX(rast) As scalex, ST_ScaleY(rast) As scaley, ST_SkewX(rast) As skewx,
    ST_SkewY(rast) As skewy
    FROM (SELECT ST_SetSkew(rast,0.5,0.5) As rast
    FROM dummy_rast) As skewed;

    rastwidth |     pixwidth      | scalex | scaley | skewx | skewy
    -----------+-------------------+--------+--------+-------+----------
    10 |  2.06155281280883 |      2 |      3 |   0.5 |      0.5
     5 | 0.502493781056044 |   0.05 |  -0.05 |   0.5 |      0.5
        </pre></div><div class="refsection"><a name="idp72923904"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_PixelHeight" title="ST_PixelHeight">ST_PixelHeight</a>, <a class="xref" href="#RT_ST_ScaleX" title="ST_ScaleX">ST_ScaleX</a>, <a class="xref" href="#RT_ST_ScaleY" title="ST_ScaleY">ST_ScaleY</a>, <a class="xref" href="#RT_ST_SkewX" title="ST_SkewX">ST_SkewX</a>, <a class="xref" href="#RT_ST_SkewY" title="ST_SkewY">ST_SkewY</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_ScaleX"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ScaleX — 空間参照系の地理的な単位でのピクセル幅のX成分を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float8 <b class="fsfunc">ST_ScaleX</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72935296"></a><h2>説明</h2><p>空間参照系の地理的な単位でのピクセル幅のX成分を返します。詳細については<a class="ulink" href="http://en.wikipedia.org/wiki/World_file" target="_top">World File</a> (英語版WikiPedia)をご覧ください。</p><p>Changed: 2.0.0. WKTRaster版ではST_PixelSizeXと呼ばれていました。</p></div><div class="refsection"><a name="idp72949632"></a><h2>例</h2><pre class="programlisting">SELECT rid, ST_ScaleX(rast) As rastpixwidth
FROM dummy_rast;

 rid | rastpixwidth
-----+--------------
   1 |            2
   2 |         0.05
                </pre></div><div class="refsection"><a name="idp72951168"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Width" title="ST_Width">ST_Width</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_ScaleY"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ScaleY — 空間参照系の地理的な単位でのピクセル幅のY成分を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float8 <b class="fsfunc">ST_ScaleY</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72956928"></a><h2>説明</h2><p>空間参照系の地理的な単位でのピクセル幅のY成分を返します。詳細については<a class="ulink" href="http://en.wikipedia.org/wiki/World_file" target="_top">World File</a> (英語版WikiPedia)をご覧ください。</p><p>Changed: 2.0.0. WKTRaster版ではST_PixelSizeYと呼ばれていました。</p></div><div class="refsection"><a name="idp72958976"></a><h2>例</h2><pre class="programlisting">SELECT rid, ST_ScaleY(rast) As rastpixheight
FROM dummy_rast;

 rid | rastpixheight
-----+---------------
   1 |             3
   2 |         -0.05
                </pre></div><div class="refsection"><a name="idp72960512"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Height" title="ST_Height">ST_Height</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_RasterToWorldCoord"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_RasterToWorldCoord — ラスタの指定した列と行における左上隅の地理座標X値とY値 (経度と緯度)を返します。列と行の番号は1始まりです。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">record <b class="fsfunc">ST_RasterToWorldCoord</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">xcolumn</var>, integer  <var class="pdparam">yrow</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72968320"></a><h2>説明</h2><p>ラスタの指定した列と行における左上隅の地理座標X値とY値 (経度と緯度)を返します。X値とY値の単位は、地理参照されたラスタの地理単位です。列と行の数字は1始まりですが、引数に0、負数またはラスタのピクセル範囲を超える値が渡されている場合には、ラスタのグリッドがラスタ範囲外に適用できると仮定して、範囲外の座標を返します。 </p><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp72969856"></a><h2>例</h2><pre class="programlisting">-- スキューの無いラスタ
SELECT
    rid,
    (ST_RasterToWorldCoord(rast,1, 1)).*,
    (ST_RasterToWorldCoord(rast,2, 2)).*
FROM dummy_rast

 rid | longitude  | latitude | longitude |  latitude
-----+------------+----------+-----------+------------
   1 |        0.5 |      0.5 |       2.5 |        3.5
   2 | 3427927.75 |  5793244 | 3427927.8 | 5793243.95
                </pre><pre class="programlisting">-- スキューの有るラスタ
SELECT
    rid,
    (ST_RasterToWorldCoord(rast, 1, 1)).*,
    (ST_RasterToWorldCoord(rast, 2, 3)).*
FROM (
    SELECT
        rid,
        ST_SetSkew(rast, 100.5, 0) As rast
    FROM dummy_rast
) As foo

 rid | longitude  | latitude | longitude | latitude
-----+------------+----------+-----------+-----------
   1 |        0.5 |      0.5 |     203.5 |       6.5
   2 | 3427927.75 |  5793244 | 3428128.8 | 5793243.9
                </pre></div><div class="refsection"><a name="idp72971904"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_RasterToWorldCoordX" title="ST_RasterToWorldCoordX">ST_RasterToWorldCoordX</a>, <a class="xref" href="#RT_ST_RasterToWorldCoordY" title="ST_RasterToWorldCoordY">ST_RasterToWorldCoordY</a>, <a class="xref" href="#RT_ST_SetSkew" title="ST_SetSkew">ST_SetSkew</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_RasterToWorldCoordX"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_RasterToWorldCoordX — ラスタの指定した列と行における左上隅の地理座標のX値を返します。列と行の番号は1始まりです。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float8 <b class="fsfunc">ST_RasterToWorldCoordX</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">xcolumn</var><code>)</code>;</p><p><code class="funcdef">float8 <b class="fsfunc">ST_RasterToWorldCoordX</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">xcolumn</var>, integer  <var class="pdparam">yrow</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72983808"></a><h2>説明</h2><p>ラスタの指定した列と行における左上隅の地理座標のX値を地理参照したラスタの地理単位で返します。列と行の番号は1始まりです。負数またはラスタの列数を超える値を渡した場合には、スキューとピクセルサイズが選択したラスタと同じであるという仮定のもとで、ラスタファイルから左または右にはずれた座標値を返します。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>スキューの無いラスタでは、X列を与えれば十分です。スキューのあるラスタの場合には、地理参照のとれた座標はST_ScaleXとST_SkewXおよび行と列の関数となります。スキューのあるラスタでX列のみ与えた場合にはエラーが発生します。</p></td></tr></table></div><p>Changed: 2.1.0 以前の版ではST_Raster2WorldCoordXと呼ばれていました。</p></div><div class="refsection"><a name="idp72985856"></a><h2>例</h2><pre class="programlisting">-- スキューの無いラスタでは列を与えれば十分です
SELECT rid, ST_RasterToWorldCoordX(rast,1) As x1coord,
    ST_RasterToWorldCoordX(rast,2) As x2coord,
    ST_ScaleX(rast) As pixelx
FROM dummy_rast;

 rid |  x1coord   |  x2coord  | pixelx
-----+------------+-----------+--------
   1 |        0.5 |       2.5 |      2
   2 | 3427927.75 | 3427927.8 |   0.05
                </pre><pre class="programlisting">-- 面白半分にスキューさせてみましょう
SELECT rid, ST_RasterToWorldCoordX(rast, 1, 1) As x1coord,
    ST_RasterToWorldCoordX(rast, 2, 3) As x2coord,
    ST_ScaleX(rast) As pixelx
FROM (SELECT rid, ST_SetSkew(rast, 100.5, 0) As rast FROM dummy_rast) As foo;

 rid |  x1coord   |  x2coord  | pixelx
-----+------------+-----------+--------
   1 |        0.5 |     203.5 |      2
   2 | 3427927.75 | 3428128.8 |   0.05
                </pre></div><div class="refsection"><a name="idp72987904"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_ScaleX" title="ST_ScaleX">ST_ScaleX</a>, <a class="xref" href="#RT_ST_RasterToWorldCoordY" title="ST_RasterToWorldCoordY">ST_RasterToWorldCoordY</a>, <a class="xref" href="#RT_ST_SetSkew" title="ST_SetSkew">ST_SetSkew</a>, <a class="xref" href="#RT_ST_SkewX" title="ST_SkewX">ST_SkewX</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_RasterToWorldCoordY"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_RasterToWorldCoordY — ラスタの指定した列と行における左上隅の地理座標のY値を返します。列と行の番号は1始まりです。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float8 <b class="fsfunc">ST_RasterToWorldCoordY</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">yrow</var><code>)</code>;</p><p><code class="funcdef">float8 <b class="fsfunc">ST_RasterToWorldCoordY</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">xcolumn</var>, integer  <var class="pdparam">yrow</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp73000064"></a><h2>説明</h2><p>ラスタの指定した列と行における左上隅の地理座標のY値を地理参照したラスタの地理単位で返します。列と行の番号は1始まりです。負数またはラスタの列数や行数を超える値を渡した場合には、スキューとピクセルサイズが選択したラスタと同じであるという仮定のもとで、ラスタファイルから左または右にはずれた座標値を返します。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>スキューの無いラスタでは、Y行を与えれば十分です。スキューのあるラスタの場合には、地理参照のとれた座標はST_ScaleYとST_SkewYおよび行と列の関数となります。スキューのあるラスタでY行のみ与えた場合にはエラーが発生します</p></td></tr></table></div><p>Changed: 2.1.0 以前の版ではST_Raster2WorldCoordYと呼ばれていました。</p></div><div class="refsection"><a name="idp73002112"></a><h2>例</h2><pre class="programlisting">-- スキューの無いラスタでは列を与えれば十分です
SELECT rid, ST_RasterToWorldCoordY(rast,1) As y1coord,
    ST_RasterToWorldCoordY(rast,3) As y2coord,
    ST_ScaleY(rast) As pixely
FROM dummy_rast;

 rid | y1coord |  y2coord  | pixely
-----+---------+-----------+--------
   1 |     0.5 |       6.5 |      3
   2 | 5793244 | 5793243.9 |  -0.05
                </pre><pre class="programlisting">-- 面白半分に回転させてみましょう
SELECT rid, ST_RasterToWorldCoordY(rast,1,1) As y1coord,
    ST_RasterToWorldCoordY(rast,2,3) As y2coord,
    ST_ScaleY(rast) As pixely
FROM (SELECT rid, ST_SetSkew(rast,0,100.5) As rast FROM dummy_rast) As foo;

 rid | y1coord |  y2coord  | pixely
-----+---------+-----------+--------
   1 |     0.5 |       107 |      3
   2 | 5793244 | 5793344.4 |  -0.05
                </pre></div><div class="refsection"><a name="idp73004160"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_ScaleY" title="ST_ScaleY">ST_ScaleY</a>, <a class="xref" href="#RT_ST_RasterToWorldCoordX" title="ST_RasterToWorldCoordX">ST_RasterToWorldCoordX</a>, <a class="xref" href="#RT_ST_SetSkew" title="ST_SetSkew">ST_SetSkew</a>, <a class="xref" href="#RT_ST_SkewY" title="ST_SkewY">ST_SkewY</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Rotation"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Rotation — ラスタの回転をラジアンで返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float8 <b class="fsfunc">ST_Rotation</b>(</code>raster <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp71884672"></a><h2>説明</h2><p>ラスタの回転をラジアンで返します。ラスタが回転を持っていない場合には、NaNが返されます。詳細については<a class="ulink" href="http://en.wikipedia.org/wiki/World_file" target="_top">World File</a> (英語版WikiPedia)を参照して下さい。</p></div><div class="refsection"><a name="idp71886336"></a><h2>例</h2><pre class="programlisting">SELECT rid, ST_Rotation(ST_SetScale(ST_SetSkew(rast, sqrt(2)), sqrt(2))) as rot FROM dummy_rast;

 rid |        rot
-----+-------------------
   1 | 0.785398163397448
   2 | 0.785398163397448
                </pre></div><div class="refsection"><a name="idp71887872"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_SetRotation" title="ST_SetRotation">ST_SetRotation</a>, <a class="xref" href="#RT_ST_SetScale" title="ST_SetScale">ST_SetScale</a>, <a class="xref" href="#RT_ST_SetSkew" title="ST_SetSkew">ST_SetSkew</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_SkewX"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SkewX — 空間参照のXスキュー (回転パラメータ)を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float8 <b class="fsfunc">ST_SkewX</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp71894400"></a><h2>説明</h2><p>空間参照のXスキュー (回転パラメータ)を返します。詳細については<a class="ulink" href="http://en.wikipedia.org/wiki/World_file" target="_top">World File</a> (英語版WikiPedia)を参照して下さい。</p></div><div class="refsection"><a name="idp73014272"></a><h2>例</h2><pre class="programlisting">SELECT rid, ST_SkewX(rast) As skewx, ST_SkewY(rast) As skewy,
    ST_GeoReference(rast) as georef
FROM dummy_rast;

 rid | skewx | skewy |       georef
-----+-------+-------+--------------------
   1 |     0 |     0 | 2.0000000000
                     : 0.0000000000
                     : 0.0000000000
                     : 3.0000000000
                     : 0.5000000000
                     : 0.5000000000
                     :
   2 |     0 |     0 | 0.0500000000
                     : 0.0000000000
                     : 0.0000000000
                     : -0.0500000000
                     : 3427927.7500000000
                     : 5793244.0000000000
                </pre></div><div class="refsection"><a name="idp73015808"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_GeoReference" title="ST_GeoReference">ST_GeoReference</a>, <a class="xref" href="#RT_ST_SkewY" title="ST_SkewY">ST_SkewY</a>, <a class="xref" href="#RT_ST_SetSkew" title="ST_SetSkew">ST_SetSkew</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_SkewY"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SkewY — 空間参照のYスキュー (回転パラメータ)を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float8 <b class="fsfunc">ST_SkewY</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp73022336"></a><h2>説明</h2><p>空間参照のYスキュー (回転パラメータ)を返します。詳細については<a class="ulink" href="http://en.wikipedia.org/wiki/World_file" target="_top">World File</a> (英語版WikiPedia)を参照して下さい。</p></div><div class="refsection"><a name="idp73024000"></a><h2>例</h2><pre class="programlisting">SELECT rid, ST_SkewX(rast) As skewx, ST_SkewY(rast) As skewy,
    ST_GeoReference(rast) as georef
FROM dummy_rast;

 rid | skewx | skewy |       georef
-----+-------+-------+--------------------
   1 |     0 |     0 | 2.0000000000
                     : 0.0000000000
                     : 0.0000000000
                     : 3.0000000000
                     : 0.5000000000
                     : 0.5000000000
                     :
   2 |     0 |     0 | 0.0500000000
                     : 0.0000000000
                     : 0.0000000000
                     : -0.0500000000
                     : 3427927.7500000000
                     : 5793244.0000000000
                </pre></div><div class="refsection"><a name="idp73025536"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_GeoReference" title="ST_GeoReference">ST_GeoReference</a>, <a class="xref" href="#RT_ST_SkewX" title="ST_SkewX">ST_SkewX</a>, <a class="xref" href="#RT_ST_SetSkew" title="ST_SetSkew">ST_SetSkew</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_SRID"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SRID — ラスタのspatial_ref_sysテーブルで定義されている空間参照系識別番号を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_SRID</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp73044352"></a><h2>説明</h2><p>ラスタのspatial_ref_sysテーブルで定義されている空間参照系識別番号を返します。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>空間参照を持たないラスタ/ジオメトリのSRIDは、以前は-1でしたがPostGIS 2.0以上では0になります。</p></td></tr></table></div></div><div class="refsection"><a name="idp73046016"></a><h2>例</h2><pre class="programlisting">SELECT ST_SRID(rast) As srid
FROM dummy_rast WHERE rid=1;

srid
----------------
0
                </pre></div><div class="refsection"><a name="idp73047552"></a><h2>関連情報</h2><p><a class="xref" href="#spatial_ref_sys" title="4.5. 空間参照系">「空間参照系」</a>, <a class="xref" href="#">???</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Summary"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Summary — ラスタの中身の概要が文字列で返されます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_Summary</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp73053696"></a><h2>説明</h2><p>ラスタの中身の概要が文字列で返されます。</p><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp73055232"></a><h2>例</h2><pre class="programlisting">SELECT ST_Summary(
    ST_AddBand(
        ST_AddBand(
            ST_AddBand(
                ST_MakeEmptyRaster(10, 10, 0, 0, 1, -1, 0, 0, 0)
                , 1, '8BUI', 1, 0
            )
            , 2, '32BF', 0, -9999
        )
        , 3, '16BSI', 0, NULL
    )
);

                            st_summary
------------------------------------------------------------------
 Raster of 10x10 pixels has 3 bands and extent of BOX(0 -10,10 0)+
     band 1 of pixtype 8BUI is in-db with NODATA value of 0      +
     band 2 of pixtype 32BF is in-db with NODATA value of -9999  +
     band 3 of pixtype 16BSI is in-db with no NODATA value
(1 row)
                </pre></div><div class="refsection"><a name="idp73056512"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_MetaData" title="ST_MetaData">ST_MetaData</a>, <a class="xref" href="#RT_ST_BandMetaData" title="ST_BandMetaData">ST_BandMetaData</a>, <a class="xref" href="#ST_Summary" title="ST_Summary">ST_Summary</a> <a class="xref" href="#">???</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_UpperLeftX"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_UpperLeftX — 適用されている空間参照系でのラスタの左上隅のX座標値を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float8 <b class="fsfunc">ST_UpperLeftX</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp73063552"></a><h2>説明</h2><p>適用されている空間参照系でのラスタの左上隅のX座標値を返します。</p></div><div class="refsection"><a name="idp73064704"></a><h2>例</h2><pre class="programlisting">SELECt rid, ST_UpperLeftX(rast) As ulx
FROM dummy_rast;

 rid |    ulx
-----+------------
   1 |        0.5
   2 | 3427927.75
                </pre></div><div class="refsection"><a name="idp73065984"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_UpperLeftY" title="ST_UpperLeftY">ST_UpperLeftY</a>, <a class="xref" href="#RT_ST_GeoReference" title="ST_GeoReference">ST_GeoReference</a>, <a class="xref" href="#RT_Box3D" title="Box3D">Box3D</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_UpperLeftY"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_UpperLeftY — 適用されている空間参照系でのラスタの左上隅のY座標値を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float8 <b class="fsfunc">ST_UpperLeftY</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp73084800"></a><h2>説明</h2><p>適用されている空間参照系でのラスタの左上隅のY座標値を返します。</p></div><div class="refsection"><a name="idp73085952"></a><h2>例</h2><pre class="programlisting">SELECT rid, ST_UpperLeftY(rast) As uly
FROM dummy_rast;

 rid |   uly
-----+---------
   1 |     0.5
   2 | 5793244
                </pre></div><div class="refsection"><a name="idp73087232"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_UpperLeftX" title="ST_UpperLeftX">ST_UpperLeftX</a>, <a class="xref" href="#RT_ST_GeoReference" title="ST_GeoReference">ST_GeoReference</a>, <a class="xref" href="#RT_Box3D" title="Box3D">Box3D</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Width"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Width — ラスタの幅をピクセル単位で返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_Width</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp73093760"></a><h2>説明</h2><p>ラスタの幅をピクセル単位で返します。</p></div><div class="refsection"><a name="idp73094912"></a><h2>例</h2><pre class="programlisting">SELECT ST_Width(rast) As rastwidth
FROM dummy_rast WHERE rid=1;

rastwidth
----------------
10
                </pre></div><div class="refsection"><a name="idp73096448"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Height" title="ST_Height">ST_Height</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_WorldToRasterCoord"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_WorldToRasterCoord — ラスタの空間参照系による地理座標のX値とY値 (経度と緯度)またはポイントジオメトリに対応するピクセルの左上隅を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">record <b class="fsfunc">ST_WorldToRasterCoord</b>(</code>raster  <var class="pdparam">rast</var>, geometry  <var class="pdparam">pt</var><code>)</code>;</p><p><code class="funcdef">record <b class="fsfunc">ST_WorldToRasterCoord</b>(</code>raster  <var class="pdparam">rast</var>, double precision  <var class="pdparam">longitude</var>, double precision  <var class="pdparam">latitude</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp73107456"></a><h2>説明</h2><p>地理座標のX値とY値 (経度と緯度)またはポイントジオメトリに対応するピクセルの左上隅を返します。X値、Y値やポイントジオメトリがラスタの範囲外であるかないかにかかわらず動作します。地理座標のX値とY値はラスタの空間参照系で表現しなければなりません。 </p><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp73108992"></a><h2>例</h2><pre class="programlisting">SELECT
    rid,
    (ST_WorldToRasterCoord(rast,3427927.8,20.5)).*,
    (ST_WorldToRasterCoord(rast,ST_GeomFromText('POINT(3427927.8 20.5)',ST_SRID(rast)))).*
FROM dummy_rast;

 rid | columnx |   rowy    | columnx |   rowy
-----+---------+-----------+---------+-----------
   1 | 1713964 |         7 | 1713964 |         7
   2 |       2 | 115864471 |       2 | 115864471
                </pre></div><div class="refsection"><a name="idp73110528"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_WorldToRasterCoordX" title="ST_WorldToRasterCoordX">ST_WorldToRasterCoordX</a>, <a class="xref" href="#RT_ST_WorldToRasterCoordY" title="ST_WorldToRasterCoordY">ST_WorldToRasterCoordY</a>, <a class="xref" href="#RT_ST_RasterToWorldCoordX" title="ST_RasterToWorldCoordX">ST_RasterToWorldCoordX</a>, <a class="xref" href="#RT_ST_RasterToWorldCoordY" title="ST_RasterToWorldCoordY">ST_RasterToWorldCoordY</a>, <a class="xref" href="#RT_ST_SRID" title="ST_SRID">ST_SRID</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_WorldToRasterCoordX"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_WorldToRasterCoordX — ラスタの空間参照系に基づくポイントジオメトリ (pt)またはX,Y座標値 (xw,yw)に対応するラスタの列を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_WorldToRasterCoordX</b>(</code>raster  <var class="pdparam">rast</var>, geometry  <var class="pdparam">pt</var><code>)</code>;</p><p><code class="funcdef">integer <b class="fsfunc">ST_WorldToRasterCoordX</b>(</code>raster  <var class="pdparam">rast</var>, double precision  <var class="pdparam">xw</var><code>)</code>;</p><p><code class="funcdef">integer <b class="fsfunc">ST_WorldToRasterCoordX</b>(</code>raster  <var class="pdparam">rast</var>, double precision  <var class="pdparam">xw</var>, double precision  <var class="pdparam">yw</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp73126400"></a><h2>説明</h2><p>ラスタの空間参照系に基づくポイントジオメトリ (pt)またはX,Y座標値 (xw,yw)に対応するラスタの列を返します。ラスタがスキューされている場合には、ポイントかxwとywの両方かが必要です。ラスタがスキューされていない場合には、xwを指定すれば十分です。ワールド座標系はラスタの空間参照系です。</p><p>Changed: 2.1.0 以前の版ではST_World2RasterCoordXと呼ばれていました。</p></div><div class="refsection"><a name="idp73127936"></a><h2>例</h2><pre class="programlisting">SELECT rid, ST_WorldToRasterCoordX(rast,3427927.8) As xcoord,
        ST_WorldToRasterCoordX(rast,3427927.8,20.5) As xcoord_xwyw,
        ST_WorldToRasterCoordX(rast,ST_GeomFromText('POINT(3427927.8 20.5)',ST_SRID(rast))) As ptxcoord
FROM dummy_rast;

 rid | xcoord  |  xcoord_xwyw   | ptxcoord
-----+---------+---------+----------
   1 | 1713964 | 1713964 |  1713964
   2 |       1 |       1 |        1
                </pre></div><div class="refsection"><a name="idp73129472"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_RasterToWorldCoordX" title="ST_RasterToWorldCoordX">ST_RasterToWorldCoordX</a>, <a class="xref" href="#RT_ST_RasterToWorldCoordY" title="ST_RasterToWorldCoordY">ST_RasterToWorldCoordY</a>, <a class="xref" href="#RT_ST_SRID" title="ST_SRID">ST_SRID</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_WorldToRasterCoordY"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_WorldToRasterCoordY — ラスタの空間参照系に基づくポイントジオメトリ (pt)またはX,Y座標値 (xw,yw)に対応するラスタの行を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_WorldToRasterCoordY</b>(</code>raster  <var class="pdparam">rast</var>, geometry  <var class="pdparam">pt</var><code>)</code>;</p><p><code class="funcdef">integer <b class="fsfunc">ST_WorldToRasterCoordY</b>(</code>raster  <var class="pdparam">rast</var>, double precision  <var class="pdparam">xw</var><code>)</code>;</p><p><code class="funcdef">integer <b class="fsfunc">ST_WorldToRasterCoordY</b>(</code>raster  <var class="pdparam">rast</var>, double precision  <var class="pdparam">xw</var>, double precision  <var class="pdparam">yw</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp73144576"></a><h2>説明</h2><p>ラスタの空間参照系に基づくポイントジオメトリ (pt)またはX,Y座標値 (xw,yw)に対応するラスタの行を返します。ラスタがスキューされている場合には、ポイントかxwとywの両方かが必要です。ラスタがスキューされていない場合には、ywを指定すれば十分です。ワールド座標系はラスタの空間参照系です。</p><p>Changed: 2.1.0 以前の版ではST_World2RasterCoordYと呼ばれていました。</p></div><div class="refsection"><a name="idp73146112"></a><h2>例</h2><pre class="programlisting">SELECT rid, ST_WorldToRasterCoordY(rast,20.5) As ycoord,
        ST_WorldToRasterCoordY(rast,3427927.8,20.5) As ycoord_xwyw,
        ST_WorldToRasterCoordY(rast,ST_GeomFromText('POINT(3427927.8 20.5)',ST_SRID(rast))) As ptycoord
FROM dummy_rast;

 rid |  ycoord   | ycoord_xwyw | ptycoord
-----+-----------+-------------+-----------
   1 |         7 |           7 |         7
   2 | 115864471 |   115864471 | 115864471
                </pre></div><div class="refsection"><a name="idp73147648"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_RasterToWorldCoordX" title="ST_RasterToWorldCoordX">ST_RasterToWorldCoordX</a>, <a class="xref" href="#RT_ST_RasterToWorldCoordY" title="ST_RasterToWorldCoordY">ST_RasterToWorldCoordY</a>, <a class="xref" href="#RT_ST_SRID" title="ST_SRID">ST_SRID</a></p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="RasterBand_Accessors"></a>12.5. ラスタバンドアクセサ</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#RT_ST_BandMetaData">ST_BandMetaData</a></span><span class="refpurpose"> — 指定したラスタバンドの基本的なメタデータを返します。バンド番号を指定しない場合には、1番と仮定します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_BandNoDataValue">ST_BandNoDataValue</a></span><span class="refpurpose"> — 指定されたバンドについてデータが無いことを表現する値を返します。バンド番号を指定しない場合には、1番と仮定します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_BandIsNoData">ST_BandIsNoData</a></span><span class="refpurpose"> — 指定したバンドがNODATA値だけで満たされている場合には、TRUEを返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_BandPath">ST_BandPath</a></span><span class="refpurpose"> — ファイルシステムに格納されているバンドのシステムファイルパスを返します。バンド番号が指定されていない場合には、1番と仮定します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_BandFileSize">ST_BandFileSize</a></span><span class="refpurpose"> — ファイルシステムに格納されているバンドのファイルサイズを返します。バンド番号が指定されていない場合には、1番と仮定します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_BandFileTimestamp">ST_BandFileTimestamp</a></span><span class="refpurpose"> — ファイルシステムに格納されているバンドのファイルタイムスタンプ返します。バンド番号が指定されていない場合には、1番と仮定します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_BandPixelType">ST_BandPixelType</a></span><span class="refpurpose"> — 指定したバンドのピクセルタイプを返します。バンド番号が指定されていない場合には、1番と仮定します。</span></dt><dt><span class="refentrytitle"><a href="#ST_MinPossibleValue">ST_MinPossibleValue</a></span><span class="refpurpose"> — このピクセルタイプが格納できる最小値を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_HasNoBand">ST_HasNoBand</a></span><span class="refpurpose"> — 指定したバンド番号のバンドが無い場合には、TRUEを返します。バンド番号を指定していない場合には、1番と仮定します。</span></dt></dl></div><div class="refentry"><a name="RT_ST_BandMetaData"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_BandMetaData — 指定したラスタバンドの基本的なメタデータを返します。バンド番号を指定しない場合には、1番と仮定します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">(1) record <b class="fsfunc">ST_BandMetaData</b>(</code>raster <var class="pdparam">rast</var>, integer <var class="pdparam">band=1</var><code>)</code>;</p><p><code class="funcdef">(2) record <b class="fsfunc">ST_BandMetaData</b>(</code>raster <var class="pdparam">rast</var>, integer[] <var class="pdparam">band</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72155520"></a><h2>説明</h2><p>指定したラスタバンドの基本的なメタデータを返します。返されるカラムは pixeltype, nodatavalue, isoutdb, path, outdbbandnum, filesize, filetimestamp です。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ラスタがバンドを持たない場合にはエラーが投げられます。 </p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>バンドにNODATA値が無い場合には、nodatavalueはNULLになります。 </p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>isoutdbがFALSEの場合には、path, outdbbandnum, filedizeおよびfiletimestampはNULLです。outdbのアクセスが禁止されているなら、filesizeとfiletimestampがNULLになります。 </p></td></tr></table></div><p>Enhanced: 2.5.0 outdbラスタに<span class="emphasis"><em>outdbbandnum</em></span>, <span class="emphasis"><em>filesize</em></span>と<span class="emphasis"><em>filetimestamp</em></span>を取り入れました。</p></div><div class="refsection"><a name="idp72160512"></a><h2>例: 一つ目の形式</h2><pre class="programlisting">SELECT
    rid,
    (foo.md).*
FROM (
    SELECT
        rid,
        ST_BandMetaData(rast, 1) AS md
    FROM dummy_rast
    WHERE rid=2
) As foo;

 rid | pixeltype | nodatavalue | isoutdb | path | outdbbandnum
-----+-----------+---- --------+---------+------+--------------
   2 | 8BUI      |           0 | f       |      |
                </pre></div><div class="refsection"><a name="idp72161792"></a><h2>例: 二つ目の形式</h2><pre class="programlisting">WITH foo AS (
    SELECT
        ST_AddBand(NULL::raster, '/home/pele/devel/geo/postgis-git/raster/test/regress/loader/Projected.tif', NULL::int[]) AS rast
)
SELECT
    *
FROM ST_BandMetadata(
    (SELECT rast FROM foo),
    ARRAY[1,3,2]::int[]
);

 bandnum | pixeltype | nodatavalue | isoutdb |                                      path                                      | outdbbandnum  | filesize | filetimestamp |
---------+-----------+-------------+---------+--------------------------------------------------------------------------------+---------------+----------+---------------+-
       1 | 8BUI      |             | t       | /home/pele/devel/geo/postgis-git/raster/test/regress/loader/Projected.tif      |            1  |    12345 |    1521807257 |
       3 | 8BUI      |             | t       | /home/pele/devel/geo/postgis-git/raster/test/regress/loader/Projected.tif      |            3  |    12345 |    1521807257 |
       2 | 8BUI      |             | t       | /home/pele/devel/geo/postgis-git/raster/test/regress/loader/Projected.tif      |            2  |    12345 |    1521807257 |
                </pre></div><div class="refsection"><a name="idp72163328"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_MetaData" title="ST_MetaData">ST_MetaData</a>, <a class="xref" href="#RT_ST_BandPixelType" title="ST_BandPixelType">ST_BandPixelType</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_BandNoDataValue"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_BandNoDataValue — 指定されたバンドについてデータが無いことを表現する値を返します。バンド番号を指定しない場合には、1番と仮定します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">double precision <b class="fsfunc">ST_BandNoDataValue</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">bandnum=1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp73153664"></a><h2>説明</h2><p>指定されたバンドについてデータが無いことを表現する値を返します。</p></div><div class="refsection"><a name="idp73154816"></a><h2>例</h2><pre class="programlisting">SELECT ST_BandNoDataValue(rast,1) As bnval1,
    ST_BandNoDataValue(rast,2) As bnval2, ST_BandNoDataValue(rast,3) As bnval3
FROM dummy_rast
WHERE rid = 2;

 bnval1 | bnval2 | bnval3
--------+--------+--------
      0 |      0 |      0
                </pre></div><div class="refsection"><a name="idp73156096"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_NumBands" title="ST_NumBands">ST_NumBands</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_BandIsNoData"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_BandIsNoData — 指定したバンドがNODATA値だけで満たされている場合には、TRUEを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_BandIsNoData</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">band</var>, boolean  <var class="pdparam">forceChecking=true</var><code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">ST_BandIsNoData</b>(</code>raster  <var class="pdparam">rast</var>, boolean  <var class="pdparam">forceChecking=true</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp73171456"></a><h2>説明</h2><p>指定したバンドがNODATA値だけで満たされている場合には、TRUEを返します。バンド番号を指定しない場合には、1番と仮定します。最後の引数がTRUEの場合には、全バンドについてピクセル毎に調べます。他の場合には、isnodataフラグの値を返すだけです。この引数を指定しない場合のデフォルト値はFALSEです。</p><p>Availability: 2.0.0</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>フラグが汚れている (最後の引数をTRUEにした場合としない場合とで結果が違う)場合には、ST_SetBandIsNodata関数、または最後の引数をTRUEにしたST_BandNodataValue関数を使って、フラグにTRUEを設定するためにラスタを更新するべきです。<a class="xref" href="#RT_ST_SetBandIsNoData" title="ST_SetBandIsNoData">ST_SetBandIsNoData</a>を参照して下さい。</p></td></tr></table></div></div><div class="refsection"><a name="idp73174144"></a><h2>例</h2><pre class="programlisting">-- 一つのラスタカラムを持つダミーテーブルの生成
create table dummy_rast (rid integer, rast raster);

-- 2バンドでバンドごとに1ピクセルを持つラスタを追加します。
-- 一つ目のバンドにはnodatavalueとピクセル値をともに3とし、
-- 二つ目のバンドにはnodatavalue=13とピクセル値=4とします。
insert into dummy_rast values(1,
(
'01' -- little endian - リトルエンディアン (uint8 ndr)
||
'0000' -- version - 版 (uint16 0)
||
'0200' -- nBands - バンド数 (uint16 0)
||
'17263529ED684A3F' -- scaleX - X方向セルサイズ (float64 0.000805965234044584)
||
'F9253529ED684ABF' -- scaleY - Y方向セルサイズ (float64 -0.00080596523404458)
||
'1C9F33CE69E352C0' -- ipX - 左上隅X値 (float64 -75.5533328537098)
||
'718F0E9A27A44840' -- ipY - 左上隅Y値 (float64 49.2824585505576)
||
'ED50EB853EC32B3F' -- skewX - スキューX (float64 0.000211812383858707)
||
'7550EB853EC32B3F' -- skewY - スキューY (float64 0.000211812383858704)
||
'E6100000' -- SRID (int32 4326)
||
'0100' -- width - 横セル数 (uint16 1)
||
'0100' -- height - 縦セル数 (uint16 1)
||
'6' -- hasnodatavalueとisnodataの値をtrueにする。
||
'2' -- 1番バンドのタイプ (4BUI)
||
'03' -- NODATA値==3
||
'03' -- 0列0行ピクセルの値==3 (NODATA値と同じ)
||
'0' -- hasnodatavalueをFALSEにする。
||
'5' -- 2番バンドのタイプ (16BSI)
||
'0D00' -- NODATA値==13
||
'0400' -- 0列0行ピクセルの値==4
)::raster
);

select st_bandisnodata(rast, 1) from dummy_rast where rid = 1; -- Expected true
select st_bandisnodata(rast, 2) from dummy_rast where rid = 1; -- Expected false
            </pre></div><div class="refsection"><a name="idp73175424"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_BandNoDataValue" title="ST_BandNoDataValue">ST_BandNoDataValue</a>, <a class="xref" href="#RT_ST_NumBands" title="ST_NumBands">ST_NumBands</a>, <a class="xref" href="#RT_ST_SetBandNoDataValue" title="ST_SetBandNoDataValue">ST_SetBandNoDataValue</a>, <a class="xref" href="#RT_ST_SetBandIsNoData" title="ST_SetBandIsNoData">ST_SetBandIsNoData</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_BandPath"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_BandPath — ファイルシステムに格納されているバンドのシステムファイルパスを返します。バンド番号が指定されていない場合には、1番と仮定します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_BandPath</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">bandnum=1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp73208064"></a><h2>説明</h2><p>バンドへのシステムファイルパスを返します。データベース内に格納されているバンドでこの関数を呼んだ場合にはエラーが投げられます。</p></div><div class="refsection"><a name="idp73209216"></a><h2>例</h2><pre class="programlisting">
                    </pre></div><div class="refsection"><a name="idp73210624"></a><h2>関連情報</h2><p></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_BandFileSize"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_BandFileSize — ファイルシステムに格納されているバンドのファイルサイズを返します。バンド番号が指定されていない場合には、1番と仮定します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">bigint <b class="fsfunc">ST_BandFileSize</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">bandnum=1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp73217280"></a><h2>説明</h2><p>ファイルシステムに格納されているバンドのファイルサイズを返します。データベース内バンドを与えるか、データベース外バンドにアクセスできない場合にはエラーが投げられます。</p><p>この関数は一般的にST_BandPath()とST_BandFileTimestamp()とを併用して、データベース外ラスタのファイル名が、この関数から見えるものとサーバから見えるものと同じかどうかを判断することができます。</p><p>Availability: 2.5.0</p></div><div class="refsection"><a name="idp73219200"></a><h2>例</h2><pre class="programlisting">SELECT ST_BandFileSize(rast,1) FROM dummy_rast WHERE rid = 1;

 st_bandfilesize
-----------------
          240574
                </pre></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_BandFileTimestamp"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_BandFileTimestamp — ファイルシステムに格納されているバンドのファイルタイムスタンプ返します。バンド番号が指定されていない場合には、1番と仮定します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">bigint <b class="fsfunc">ST_BandFileTimestamp</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">bandnum=1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp73226112"></a><h2>説明</h2><p>ファイルシステムに保存されているバンドのファイルタイムスタンプを返します (UTC 1970年1月1日 0時0分0秒からの秒数)。データベース内バンドの場合またはデータベース外ラスタへのアクセスが無効な場合にはエラーが投げられます。</p><p>この関数は通常、ST_BandPath() および ST_BandFileSize() と組み合わせて使用されるため、クライアントは、outdb ラスタのファイル名がサーバーによって見られるものと同じであるかどうかを判断できます。</p><p>Availability: 2.5.0</p></div><div class="refsection"><a name="idp73228032"></a><h2>例</h2><pre class="programlisting">SELECT ST_BandFileTimestamp(rast,1) FROM dummy_rast WHERE rid = 1;

 st_bandfiletimestamp
----------------------
           1521807257
                </pre></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_BandPixelType"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_BandPixelType — 指定したバンドのピクセルタイプを返します。バンド番号が指定されていない場合には、1番と仮定します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_BandPixelType</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">bandnum=1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp73234944"></a><h2>説明</h2><p>与えられたバンドのセルに格納されるデータの型とサイズを示す名前を返します。</p><p>ピクセルタイプは11通りあります。対応しているピクセルタイプは次の通りです。 </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>1BB - 1ビット真偽値</p></li><li class="listitem"><p>2BUI - 2ビット符号なし整数</p></li><li class="listitem"><p>4BUI - 4ビット符号なし整数 </p></li><li class="listitem"><p>8BSI - 8ビット整数 </p></li><li class="listitem"><p>8BUI - 8ビット符号なし整数</p></li><li class="listitem"><p>16BSI - 16ビット整数</p></li><li class="listitem"><p>16BUI - 16ビット符号なし整数</p></li><li class="listitem"><p>32BSI - 32ビット整数</p></li><li class="listitem"><p>32BUI - 32ビット符号なし整数</p></li><li class="listitem"><p>32BF - 32ビット浮動小数点数</p></li><li class="listitem"><p>64BF - 64ビット浮動小数点数</p></li></ul></div><p>
                </p></div><div class="refsection"><a name="idp73245312"></a><h2>例</h2><pre class="programlisting">SELECT ST_BandPixelType(rast,1) As btype1,
    ST_BandPixelType(rast,2) As btype2, ST_BandPixelType(rast,3) As btype3
FROM dummy_rast
WHERE rid = 2;

 btype1 | btype2 | btype3
--------+--------+--------
 8BUI   | 8BUI   | 8BUI
                </pre></div><div class="refsection"><a name="idp73246592"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_NumBands" title="ST_NumBands">ST_NumBands</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_MinPossibleValue"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MinPossibleValue — このピクセルタイプが格納できる最小値を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_MinPossibleValue</b>(</code>text  <var class="pdparam">pixeltype</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp73252352"></a><h2>説明</h2><p>このピクセルタイプが格納できる最小値を返します。</p></div><div class="refsection"><a name="idp73253504"></a><h2>例</h2><pre class="programlisting">SELECT ST_MinPossibleValue('16BSI');

 st_minpossiblevalue
---------------------
              -32768


SELECT ST_MinPossibleValue('8BUI');

 st_minpossiblevalue
---------------------
                   0
                </pre></div><div class="refsection"><a name="idp73254784"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_BandPixelType" title="ST_BandPixelType">ST_BandPixelType</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_HasNoBand"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_HasNoBand — 指定したバンド番号のバンドが無い場合には、TRUEを返します。バンド番号を指定していない場合には、1番と仮定します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_HasNoBand</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">bandnum=1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp73261568"></a><h2>説明</h2><p>指定したバンド番号のバンドが無い場合には、TRUEを返します。バンド番号を指定していない場合には、1番と仮定します。</p><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp73263104"></a><h2>例</h2><pre class="programlisting">SELECT rid, ST_HasNoBand(rast) As hb1, ST_HasNoBand(rast,2) as hb2,
ST_HasNoBand(rast,4) as hb4, ST_NumBands(rast) As numbands
FROM dummy_rast;

rid | hb1 | hb2 | hb4 | numbands
-----+-----+-----+-----+----------
1 | t   | t   | t   |        0
2 | f   | f   | t   |        3
            </pre></div><div class="refsection"><a name="idp73264384"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_NumBands" title="ST_NumBands">ST_NumBands</a></p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Raster_Pixel_Accessors"></a>12.6. ラスタピクセルアクセサとセッター</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#RT_ST_PixelAsPolygon">ST_PixelAsPolygon</a></span><span class="refpurpose"> — 指定した行と列のピクセルの境界となるジオメトリを返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_PixelAsPolygons">ST_PixelAsPolygons</a></span><span class="refpurpose"> — 全てのピクセルについて境界となるジオメトリを、ピクセルごとのピクセル値とラスタ座標系のXとYとを付けて返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_PixelAsPoint">ST_PixelAsPoint</a></span><span class="refpurpose"> — ピクセルの左上隅のポイントジオメトリを返します。 </span></dt><dt><span class="refentrytitle"><a href="#RT_ST_PixelAsPoints">ST_PixelAsPoints</a></span><span class="refpurpose"> — 全てのピクセルについてポイントジオメトリを、ピクセルごとのピクセル値とラスタ座標系のXとYとを付けて返します。ポイントジオメトリの座標はピクセルの左上隅です。 </span></dt><dt><span class="refentrytitle"><a href="#RT_ST_PixelAsCentroid">ST_PixelAsCentroid</a></span><span class="refpurpose"> — ピクセルで表現される面の重心 (ポイントジオメトリ)を返します。 </span></dt><dt><span class="refentrytitle"><a href="#RT_ST_PixelAsCentroids">ST_PixelAsCentroids</a></span><span class="refpurpose"> — 全てのピクセルについて重心 (ポイントジオメト)リを、ピクセルごとのピクセル値とラスタ座標系のXとYとを付けて返します。ポイントジオメトリの座標はピクセルで表現される面の重心です。 </span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Value">ST_Value</a></span><span class="refpurpose"> — 指定したバンドにおけるcolumnx, rowyで指定したピクセルまたは指定したジオメトリポイントに対応するピクセルの値を返します。 バンド番号は1始まりで、指定しない場合には、1番と仮定します。<code class="varname">exclude_nodata_value</code>がFALSEに設定された場合には、NODATAピクセルを含む全てのピクセルがインタセクトするかが考慮され、値を返します。<code class="varname">exclude_nodata_value</code>を渡さない場合には、ラスタのメタデータから読みます。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_NearestValue">ST_NearestValue</a></span><span class="refpurpose"> — 与えられたバンドの、columnxとrowyで指定されるか、またはラスタと同じ空間参照系で表現されたポイントで指定されたピクセルに最も近い<code class="varname">NODATA</code>でない値を返します。 </span></dt><dt><span class="refentrytitle"><a href="#RT_ST_SetZ">ST_SetZ</a></span><span class="refpurpose"> — 入力ジオメトリと同じX/y座標値と、指定されたリサンプリングアルゴリズムを使ってラスタから複写されたZ値とを持つジオメトリを返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_SetM">ST_SetM</a></span><span class="refpurpose"> — 入力ジオメトリと同じX/y座標値と、指定されたリサンプリングアルゴリズムを使ってラスタから複写されたZ値とを持つジオメトリを返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Neighborhood">ST_Neighborhood</a></span><span class="refpurpose"> — 与えられたバンドのcolumnX, columnYか、ラスタと同じ空間参照系のジオメトリポイントで指定されたピクセルの周囲にある、<code class="varname">NODATA</code>でない2次元倍精度浮動小数点数配列を返します。 </span></dt><dt><span class="refentrytitle"><a href="#RT_ST_SetValue">ST_SetValue</a></span><span class="refpurpose"> — 与えられたバンドのcolumnX, columnYか、ラスタと同じ空間参照系のジオメトリポイントで指定されたピクセルの値または指定したジオメトリとインタセクトするピクセル群の値を設定することから得られる、変更されたラスタを返します。バンド番号は1始まりで、指定しない場合には、1番と仮定します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_SetValues">ST_SetValues</a></span><span class="refpurpose"> — 与えられたバンドに複数の値を設定して、変更されたラスタを返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_DumpValues">ST_DumpValues</a></span><span class="refpurpose"> — 指定したバンドの値を2次元で得ます。 </span></dt><dt><span class="refentrytitle"><a href="#RT_ST_PixelOfValue">ST_PixelOfValue</a></span><span class="refpurpose"> — 検索値と同じ値を持つピクセルのcolumnx, rowyピクセル座標を得ます。 </span></dt></dl></div><div class="refentry"><a name="RT_ST_PixelAsPolygon"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_PixelAsPolygon — 指定した行と列のピクセルの境界となるジオメトリを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_PixelAsPolygon</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">columnx</var>, integer  <var class="pdparam">rowy</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp73273088"></a><h2>説明</h2><p>指定した行と列のピクセルの境界となるジオメトリを返します。</p><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp73274624"></a><h2>例</h2><pre class="programlisting">-- ラスタピクセルのポリゴンを得ます
SELECT i,j, ST_AsText(ST_PixelAsPolygon(foo.rast, i,j)) As b1pgeom
FROM dummy_rast As foo
    CROSS JOIN generate_series(1,2) As i
    CROSS JOIN generate_series(1,1) As j
WHERE rid=2;

 i | j |                                                    b1pgeom
---+---+-----------------------------------------------------------------------------
 1 | 1 | POLYGON((3427927.75 5793244,3427927.8 5793244,3427927.8 5793243.95,...
 2 | 1 | POLYGON((3427927.8 5793244,3427927.85 5793244,3427927.85 5793243.95, ..
  </pre></div><div class="refsection"><a name="idp73275904"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_DumpAsPolygons" title="ST_DumpAsPolygons">ST_DumpAsPolygons</a>, <a class="xref" href="#RT_ST_PixelAsPolygons" title="ST_PixelAsPolygons">ST_PixelAsPolygons</a>, <a class="xref" href="#RT_ST_PixelAsPoint" title="ST_PixelAsPoint">ST_PixelAsPoint</a>, <a class="xref" href="#RT_ST_PixelAsPoints" title="ST_PixelAsPoints">ST_PixelAsPoints</a>, <a class="xref" href="#RT_ST_PixelAsCentroid" title="ST_PixelAsCentroid">ST_PixelAsCentroid</a>, <a class="xref" href="#RT_ST_PixelAsCentroids" title="ST_PixelAsCentroids">ST_PixelAsCentroids</a>, <a class="xref" href="#RT_ST_Intersection" title="ST_Intersection">ST_Intersection</a>, <a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_PixelAsPolygons"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_PixelAsPolygons — 全てのピクセルについて境界となるジオメトリを、ピクセルごとのピクセル値とラスタ座標系のXとYとを付けて返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">setof record <b class="fsfunc">ST_PixelAsPolygons</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">band=1</var>, boolean  <var class="pdparam">exclude_nodata_value=TRUE</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp71382144"></a><h2>説明</h2><p>全てのピクセルについて境界となるジオメトリを、ピクセルごとのピクセル値 (倍精度浮動小数点数)とラスタ座標系のXとY (ともに整数)とを付けて返します。</p><p>返されるレコードの書式は、<a class="xref" href="#geometry" title="geometry">geometry</a>型の<em class="parameter"><code>geom</code></em>、倍精度浮動小数点数の<em class="parameter"><code>val</code></em>、整数の<em class="parameter"><code>x</code></em>、整数の<em class="parameter"><code>y</code></em>です。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><em class="parameter"><code>exclude_nodata_value</code></em>がTRUEの時、値がNODATAでないこれらのピクセルだけをポイントとして返します。 </p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_PixelAsPolygonsは、ピクセルごとに一つのポリゴンジオメトリを返します。ST_DumpAsPolygonsとは、 一つのジオメトリが同じ値となる一つ以上のピクセルを表現する点で違います。 </p></td></tr></table></div><p>Availability: 2.0.0</p><p>Enhanced: 2.1.0 任意引数exclude_nodata_valueが追加されました。</p><p>Changed: 2.1.1 exclude_nodata_valueの挙動を変更しました。</p></div><div class="refsection"><a name="idp73285632"></a><h2>例</h2><pre class="programlisting">-- ラスタピクセルのポリゴンを得ます
SELECT (gv).x, (gv).y, (gv).val, ST_AsText((gv).geom) geom
FROM (SELECT ST_PixelAsPolygons(
                 ST_SetValue(ST_SetValue(ST_AddBand(ST_MakeEmptyRaster(2, 2, 0, 0, 0.001, -0.001, 0.001, 0.001, 4269),
                                                    '8BUI'::text, 1, 0),
                                         2, 2, 10),
                             1, 1, NULL)
) gv
) foo;

 x | y | val |                geom
---+---+-----------------------------------------------------------------------------
 1 | 1 |     | POLYGON((0 0,0.001 0.001,0.002 0,0.001 -0.001,0 0))
 1 | 2 |   1 | POLYGON((0.001 -0.001,0.002 0,0.003 -0.001,0.002 -0.002,0.001 -0.001))
 2 | 1 |   1 | POLYGON((0.001 0.001,0.002 0.002,0.003 0.001,0.002 0,0.001 0.001))
 2 | 2 |  10 | POLYGON((0.002 0,0.003 0.001,0.004 0,0.003 -0.001,0.002 0))
  </pre></div><div class="refsection"><a name="idp73286912"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_DumpAsPolygons" title="ST_DumpAsPolygons">ST_DumpAsPolygons</a>, <a class="xref" href="#RT_ST_PixelAsPolygon" title="ST_PixelAsPolygon">ST_PixelAsPolygon</a>, <a class="xref" href="#RT_ST_PixelAsPoint" title="ST_PixelAsPoint">ST_PixelAsPoint</a>, <a class="xref" href="#RT_ST_PixelAsPoints" title="ST_PixelAsPoints">ST_PixelAsPoints</a>, <a class="xref" href="#RT_ST_PixelAsCentroid" title="ST_PixelAsCentroid">ST_PixelAsCentroid</a>, <a class="xref" href="#RT_ST_PixelAsCentroids" title="ST_PixelAsCentroids">ST_PixelAsCentroids</a>, <a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_PixelAsPoint"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_PixelAsPoint — ピクセルの左上隅のポイントジオメトリを返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_PixelAsPoint</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">columnx</var>, integer  <var class="pdparam">rowy</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp71642368"></a><h2>説明</h2><p>ピクセルの左上隅のポイントジオメトリを返します。</p><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp71643904"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(ST_PixelAsPoint(rast, 1, 1)) FROM dummy_rast WHERE rid = 1;

   st_astext
----------------
 POINT(0.5 0.5)
                </pre></div><div class="refsection"><a name="idp71645184"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_DumpAsPolygons" title="ST_DumpAsPolygons">ST_DumpAsPolygons</a>, <a class="xref" href="#RT_ST_PixelAsPolygon" title="ST_PixelAsPolygon">ST_PixelAsPolygon</a>, <a class="xref" href="#RT_ST_PixelAsPolygons" title="ST_PixelAsPolygons">ST_PixelAsPolygons</a>, <a class="xref" href="#RT_ST_PixelAsPoints" title="ST_PixelAsPoints">ST_PixelAsPoints</a>, <a class="xref" href="#RT_ST_PixelAsCentroid" title="ST_PixelAsCentroid">ST_PixelAsCentroid</a>, <a class="xref" href="#RT_ST_PixelAsCentroids" title="ST_PixelAsCentroids">ST_PixelAsCentroids</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_PixelAsPoints"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_PixelAsPoints — 全てのピクセルについてポイントジオメトリを、ピクセルごとのピクセル値とラスタ座標系のXとYとを付けて返します。ポイントジオメトリの座標はピクセルの左上隅です。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">setof record <b class="fsfunc">ST_PixelAsPoints</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">band=1</var>, boolean  <var class="pdparam">exclude_nodata_value=TRUE</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp71655296"></a><h2>説明</h2><p>全てのピクセルについてポイントジオメトリを、ピクセルごとのピクセル値とラスタ座標系のXとYとを付けて返します。ポイントジオメトリの座標はピクセルの左上隅です。 </p><p>返されるレコードの書式は、<a class="xref" href="#geometry" title="geometry">geometry</a>型の<em class="parameter"><code>geom</code></em>、倍精度浮動小数点数の<em class="parameter"><code>val</code></em>、整数の<em class="parameter"><code>x</code></em>、整数の<em class="parameter"><code>y</code></em>です。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><em class="parameter"><code>exclude_nodata_value</code></em>がTRUEの時、値がNODATAでないこれらのピクセルだけをポイントとして返します。 </p></td></tr></table></div><p>Availability: 2.1.0</p><p>Changed: 2.1.1 exclude_nodata_valueの挙動を変更しました。</p></div><div class="refsection"><a name="idp73299584"></a><h2>例</h2><pre class="programlisting">SELECT x, y, val, ST_AsText(geom) FROM (SELECT (ST_PixelAsPoints(rast, 1)).* FROM dummy_rast WHERE rid = 2) foo;

 x | y | val |          st_astext
---+---+-----+------------------------------
 1 | 1 | 253 | POINT(3427927.75 5793244)
 2 | 1 | 254 | POINT(3427927.8 5793244)
 3 | 1 | 253 | POINT(3427927.85 5793244)
 4 | 1 | 254 | POINT(3427927.9 5793244)
 5 | 1 | 254 | POINT(3427927.95 5793244)
 1 | 2 | 253 | POINT(3427927.75 5793243.95)
 2 | 2 | 254 | POINT(3427927.8 5793243.95)
 3 | 2 | 254 | POINT(3427927.85 5793243.95)
 4 | 2 | 253 | POINT(3427927.9 5793243.95)
 5 | 2 | 249 | POINT(3427927.95 5793243.95)
 1 | 3 | 250 | POINT(3427927.75 5793243.9)
 2 | 3 | 254 | POINT(3427927.8 5793243.9)
 3 | 3 | 254 | POINT(3427927.85 5793243.9)
 4 | 3 | 252 | POINT(3427927.9 5793243.9)
 5 | 3 | 249 | POINT(3427927.95 5793243.9)
 1 | 4 | 251 | POINT(3427927.75 5793243.85)
 2 | 4 | 253 | POINT(3427927.8 5793243.85)
 3 | 4 | 254 | POINT(3427927.85 5793243.85)
 4 | 4 | 254 | POINT(3427927.9 5793243.85)
 5 | 4 | 253 | POINT(3427927.95 5793243.85)
 1 | 5 | 252 | POINT(3427927.75 5793243.8)
 2 | 5 | 250 | POINT(3427927.8 5793243.8)
 3 | 5 | 254 | POINT(3427927.85 5793243.8)
 4 | 5 | 254 | POINT(3427927.9 5793243.8)
 5 | 5 | 254 | POINT(3427927.95 5793243.8)
                </pre></div><div class="refsection"><a name="idp73300864"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_DumpAsPolygons" title="ST_DumpAsPolygons">ST_DumpAsPolygons</a>, <a class="xref" href="#RT_ST_PixelAsPolygon" title="ST_PixelAsPolygon">ST_PixelAsPolygon</a>, <a class="xref" href="#RT_ST_PixelAsPolygons" title="ST_PixelAsPolygons">ST_PixelAsPolygons</a>, <a class="xref" href="#RT_ST_PixelAsPoint" title="ST_PixelAsPoint">ST_PixelAsPoint</a>, <a class="xref" href="#RT_ST_PixelAsCentroid" title="ST_PixelAsCentroid">ST_PixelAsCentroid</a>, <a class="xref" href="#RT_ST_PixelAsCentroids" title="ST_PixelAsCentroids">ST_PixelAsCentroids</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_PixelAsCentroid"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_PixelAsCentroid — ピクセルで表現される面の重心 (ポイントジオメトリ)を返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_PixelAsCentroid</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">x</var>, integer  <var class="pdparam">y</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp73323008"></a><h2>説明</h2><p>ピクセルで表現される面の重心 (ポイントジオメトリ)を返します。</p><p>Enhanced: 2.1.0 C言語で記述されました</p><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp73324928"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(ST_PixelAsCentroid(rast, 1, 1)) FROM dummy_rast WHERE rid = 1;

  st_astext
--------------
 POINT(1.5 2)
                </pre></div><div class="refsection"><a name="idp73326208"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_DumpAsPolygons" title="ST_DumpAsPolygons">ST_DumpAsPolygons</a>, <a class="xref" href="#RT_ST_PixelAsPolygon" title="ST_PixelAsPolygon">ST_PixelAsPolygon</a>, <a class="xref" href="#RT_ST_PixelAsPolygons" title="ST_PixelAsPolygons">ST_PixelAsPolygons</a>, <a class="xref" href="#RT_ST_PixelAsPoint" title="ST_PixelAsPoint">ST_PixelAsPoint</a>, <a class="xref" href="#RT_ST_PixelAsPoints" title="ST_PixelAsPoints">ST_PixelAsPoints</a>, <a class="xref" href="#RT_ST_PixelAsCentroids" title="ST_PixelAsCentroids">ST_PixelAsCentroids</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_PixelAsCentroids"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_PixelAsCentroids — 全てのピクセルについて重心 (ポイントジオメト)リを、ピクセルごとのピクセル値とラスタ座標系のXとYとを付けて返します。ポイントジオメトリの座標はピクセルで表現される面の重心です。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">setof record <b class="fsfunc">ST_PixelAsCentroids</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">band=1</var>, boolean  <var class="pdparam">exclude_nodata_value=TRUE</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp73336320"></a><h2>説明</h2><p>全てのピクセルについて重心 (ポイントジオメト)リを、ピクセルごとのピクセル値とラスタ座標系のXとYとを付けて返します。ポイントジオメトリの座標はピクセルで表現される面の重心です。 </p><p>返されるレコードの書式は、<a class="xref" href="#geometry" title="geometry">geometry</a>型の<em class="parameter"><code>geom</code></em>、倍精度浮動小数点数の<em class="parameter"><code>val</code></em>、整数の<em class="parameter"><code>x</code></em>、整数の<em class="parameter"><code>y</code></em>です。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><em class="parameter"><code>exclude_nodata_value</code></em>がTRUEの時、値がNODATAでないこれらのピクセルだけをポイントとして返します。 </p></td></tr></table></div><p>Enhanced: 2.1.0 C言語で記述されました</p><p>Changed: 2.1.1 exclude_nodata_valueの挙動を変更しました。</p><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp73342592"></a><h2>例</h2><pre class="programlisting">-- LATERAL句を使うにはPostgreSQL 9.3以上が必要です
SELECT x, y, val, ST_AsText(geom)
    FROM (SELECT dp.* FROM dummy_rast, LATERAL ST_PixelAsCentroids(rast, 1) AS dp WHERE rid = 2) foo;
 x | y | val |           st_astext
---+---+-----+--------------------------------
 1 | 1 | 253 | POINT(3427927.775 5793243.975)
 2 | 1 | 254 | POINT(3427927.825 5793243.975)
 3 | 1 | 253 | POINT(3427927.875 5793243.975)
 4 | 1 | 254 | POINT(3427927.925 5793243.975)
 5 | 1 | 254 | POINT(3427927.975 5793243.975)
 1 | 2 | 253 | POINT(3427927.775 5793243.925)
 2 | 2 | 254 | POINT(3427927.825 5793243.925)
 3 | 2 | 254 | POINT(3427927.875 5793243.925)
 4 | 2 | 253 | POINT(3427927.925 5793243.925)
 5 | 2 | 249 | POINT(3427927.975 5793243.925)
 1 | 3 | 250 | POINT(3427927.775 5793243.875)
 2 | 3 | 254 | POINT(3427927.825 5793243.875)
 3 | 3 | 254 | POINT(3427927.875 5793243.875)
 4 | 3 | 252 | POINT(3427927.925 5793243.875)
 5 | 3 | 249 | POINT(3427927.975 5793243.875)
 1 | 4 | 251 | POINT(3427927.775 5793243.825)
 2 | 4 | 253 | POINT(3427927.825 5793243.825)
 3 | 4 | 254 | POINT(3427927.875 5793243.825)
 4 | 4 | 254 | POINT(3427927.925 5793243.825)
 5 | 4 | 253 | POINT(3427927.975 5793243.825)
 1 | 5 | 252 | POINT(3427927.775 5793243.775)
 2 | 5 | 250 | POINT(3427927.825 5793243.775)
 3 | 5 | 254 | POINT(3427927.875 5793243.775)
 4 | 5 | 254 | POINT(3427927.925 5793243.775)
 5 | 5 | 254 | POINT(3427927.975 5793243.775)
                </pre></div><div class="refsection"><a name="idp73343872"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_DumpAsPolygons" title="ST_DumpAsPolygons">ST_DumpAsPolygons</a>, <a class="xref" href="#RT_ST_PixelAsPolygon" title="ST_PixelAsPolygon">ST_PixelAsPolygon</a>, <a class="xref" href="#RT_ST_PixelAsPolygons" title="ST_PixelAsPolygons">ST_PixelAsPolygons</a>, <a class="xref" href="#RT_ST_PixelAsPoint" title="ST_PixelAsPoint">ST_PixelAsPoint</a>, <a class="xref" href="#RT_ST_PixelAsPoints" title="ST_PixelAsPoints">ST_PixelAsPoints</a>, <a class="xref" href="#RT_ST_PixelAsCentroid" title="ST_PixelAsCentroid">ST_PixelAsCentroid</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Value"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Value — 指定したバンドにおけるcolumnx, rowyで指定したピクセルまたは指定したジオメトリポイントに対応するピクセルの値を返します。 バンド番号は1始まりで、指定しない場合には、1番と仮定します。<code class="varname">exclude_nodata_value</code>がFALSEに設定された場合には、NODATAピクセルを含む全てのピクセルがインタセクトするかが考慮され、値を返します。<code class="varname">exclude_nodata_value</code>を渡さない場合には、ラスタのメタデータから読みます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">double precision <b class="fsfunc">ST_Value</b>(</code>raster  <var class="pdparam">rast</var>, geometry  <var class="pdparam">pt</var>, boolean  <var class="pdparam">exclude_nodata_value=true</var><code>)</code>;</p><p><code class="funcdef">double precision <b class="fsfunc">ST_Value</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">band</var>, geometry  <var class="pdparam">pt</var>, boolean  <var class="pdparam">exclude_nodata_value=true</var>, text  <var class="pdparam">resample='nearest'</var><code>)</code>;</p><p><code class="funcdef">double precision <b class="fsfunc">ST_Value</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">x</var>, integer  <var class="pdparam">y</var>, boolean  <var class="pdparam">exclude_nodata_value=true</var><code>)</code>;</p><p><code class="funcdef">double precision <b class="fsfunc">ST_Value</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">band</var>, integer  <var class="pdparam">x</var>, integer  <var class="pdparam">y</var>, boolean  <var class="pdparam">exclude_nodata_value=true</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72250624"></a><h2>説明</h2><p>与えたバンドの、与えた列番号、行番号のピクセル、または与えたジオメトリのポイントにおける値を返します。バンド番号は1始まりで、指定しない場合には、1番と仮定します。</p><p><code class="varname">exclude_nodata_value</code>がTRUEの場合には、<code class="varname">nodata</code>値でないピクセルだけを考慮します。<code class="varname">exclude_nodata_value</code>がFALSEの場合には、全てのピクセルが考慮されます。</p><p><code class="varname">resample</code>パラメータの取ることができる値は、デフォルトである最近傍探索リサンプリングを行う"nearest"、バイリニア補間 (<a class="ulink" href="https://en.wikipedia.org/wiki/Bilinear_interpolation" target="_top">WikiPedia 英語版</a>)を行う"bilinear"です。ピクセル中心間の値を見積もるためのものです。</p><p>Enhanced: 3.2.0 任意引数resampleが追加されました。</p><p>Enhanced: 2.0.0 任意引数exclude_nodata_valueが追加されました。</p></div><div class="refsection"><a name="idp73361152"></a><h2>例</h2><pre class="programlisting">-- PostGISジオメトリポイントを指定してラスタの値を得ます
-- ジオメトリのSRIDはラスタと同じにします
SELECT rid, ST_Value(rast, foo.pt_geom) As b1pval, ST_Value(rast, 2, foo.pt_geom) As b2pval
FROM dummy_rast CROSS JOIN (SELECT ST_SetSRID(ST_Point(3427927.77, 5793243.76), 0) As pt_geom) As foo
WHERE rid=2;

 rid | b1pval | b2pval
-----+--------+--------
   2 |    252 |     79


-- 実際のテーブルを使った一般的な架空の例
SELECT rid, ST_Value(rast, 3, sometable.geom) As b3pval
FROM sometable
WHERE ST_Intersects(rast,sometable.geom);
                </pre><pre class="programlisting">SELECT rid, ST_Value(rast, 1, 1, 1) As b1pval,
    ST_Value(rast, 2, 1, 1) As b2pval, ST_Value(rast, 3, 1, 1) As b3pval
FROM dummy_rast
WHERE rid=2;

 rid | b1pval | b2pval | b3pval
-----+--------+--------+--------
   2 |    253 |     78 |     70
                </pre><pre class="programlisting">-- 1番、2番、3番バンドの全ての値を得ます
SELECT x, y, ST_Value(rast, 1, x, y) As b1val,
    ST_Value(rast, 2, x, y) As b2val, ST_Value(rast, 3, x, y) As b3val
FROM dummy_rast CROSS JOIN
generate_series(1, 1000) As x CROSS JOIN generate_series(1, 1000) As y
WHERE rid =  2 AND x &lt;= ST_Width(rast) AND y &lt;= ST_Height(rast);

 x | y | b1val | b2val | b3val
---+---+-------+-------+-------
 1 | 1 |   253 |    78 |    70
 1 | 2 |   253 |    96 |    80
 1 | 3 |   250 |    99 |    90
 1 | 4 |   251 |    89 |    77
 1 | 5 |   252 |    79 |    62
 2 | 1 |   254 |    98 |    86
 2 | 2 |   254 |   118 |   108
 :
 :
                </pre><pre class="programlisting">-- 上の例と同じに、1番、2番、3番バンドの全ての値を得ますが、
-- ピクセル毎の左上隅のポイントを返します
SELECT ST_AsText(ST_SetSRID(
    ST_Point(ST_UpperLeftX(rast) + ST_ScaleX(rast)*x,
        ST_UpperLeftY(rast) + ST_ScaleY(rast)*y),
        ST_SRID(rast))) As uplpt
    , ST_Value(rast, 1, x, y) As b1val,
    ST_Value(rast, 2, x, y) As b2val, ST_Value(rast, 3, x, y) As b3val
FROM dummy_rast CROSS JOIN
generate_series(1,1000) As x CROSS JOIN generate_series(1,1000) As y
WHERE rid =  2 AND x &lt;= ST_Width(rast) AND y &lt;= ST_Height(rast);

            uplpt            | b1val | b2val | b3val
-----------------------------+-------+-------+-------
 POINT(3427929.25 5793245.5) |   253 |    78 |    70
 POINT(3427929.25 5793247)   |   253 |    96 |    80
 POINT(3427929.25 5793248.5) |   250 |    99 |    90
:
                </pre><pre class="programlisting">-- 指定した範囲内の値を持ち、指定したポリゴンにインタセクトするピクセルの
-- 全てを結合することによって形成されるポリゴンを得ます
SELECT ST_AsText(ST_Union(pixpolyg)) As shadow
FROM (SELECT ST_Translate(ST_MakeEnvelope(
        ST_UpperLeftX(rast), ST_UpperLeftY(rast),
            ST_UpperLeftX(rast) + ST_ScaleX(rast),
            ST_UpperLeftY(rast) + ST_ScaleY(rast), 0
            ), ST_ScaleX(rast)*x, ST_ScaleY(rast)*y
        ) As pixpolyg, ST_Value(rast, 2, x, y) As b2val
    FROM dummy_rast CROSS JOIN
generate_series(1,1000) As x CROSS JOIN generate_series(1,1000) As y
WHERE rid =  2
    AND x &lt;= ST_Width(rast) AND y &lt;= ST_Height(rast)) As foo
WHERE
    ST_Intersects(
        pixpolyg,
        ST_GeomFromText('POLYGON((3427928 5793244,3427927.75 5793243.75,3427928 5793243.75,3427928 5793244))',0)
        ) AND b2val != 254;


        shadow
------------------------------------------------------------------------------------
 MULTIPOLYGON(((3427928 5793243.9,3427928 5793243.85,3427927.95 5793243.85,3427927.95 5793243.9,
 3427927.95 5793243.95,3427928 5793243.95,3427928.05 5793243.95,3427928.05 5793243.9,3427928 5793243.9)),((3427927.95 5793243.9,3427927.95 579324
3.85,3427927.9 5793243.85,3427927.85 5793243.85,3427927.85 5793243.9,3427927.9 5793243.9,3427927.9 5793243.95,
3427927.95 5793243.95,3427927.95 5793243.9)),((3427927.85 5793243.75,3427927.85 5793243.7,3427927.8 5793243.7,3427927.8 5793243.75
,3427927.8 5793243.8,3427927.8 5793243.85,3427927.85 5793243.85,3427927.85 5793243.8,3427927.85 5793243.75)),
((3427928.05 5793243.75,3427928.05 5793243.7,3427928 5793243.7,3427927.95 5793243.7,3427927.95 5793243.75,3427927.95 5793243.8,3427
927.95 5793243.85,3427928 5793243.85,3427928 5793243.8,3427928.05 5793243.8,
3427928.05 5793243.75)),((3427927.95 5793243.75,3427927.95 5793243.7,3427927.9 5793243.7,3427927.85 5793243.7,
3427927.85 5793243.75,3427927.85 5793243.8,3427927.85 5793243.85,3427927.9 5793243.85,
3427927.95 5793243.85,3427927.95 5793243.8,3427927.95 5793243.75)))
                </pre><pre class="programlisting">-- 大きなラスタタイルの全てのピクセルをチェックは長時間かかります。
-- generate_seriesの任意引数stepを使用してサンプリングすることで、
-- 精度を大きく落としますが、劇的な速度改善が可能です。
-- 次の例では、前の例と同じことをしていますが、
-- 4 (2x2)ピクセルごとに1度チェックを行い、4ピクセルの値として置いています。

SELECT ST_AsText(ST_Union(pixpolyg)) As shadow
FROM (SELECT ST_Translate(ST_MakeEnvelope(
        ST_UpperLeftX(rast), ST_UpperLeftY(rast),
            ST_UpperLeftX(rast) + ST_ScaleX(rast)*2,
            ST_UpperLeftY(rast) + ST_ScaleY(rast)*2, 0
            ), ST_ScaleX(rast)*x, ST_ScaleY(rast)*y
        ) As pixpolyg, ST_Value(rast, 2, x, y) As b2val
    FROM dummy_rast CROSS JOIN
generate_series(1,1000,2) As x CROSS JOIN generate_series(1,1000,2) As y
WHERE rid =  2
    AND x &lt;= ST_Width(rast)  AND y &lt;= ST_Height(rast)  ) As foo
WHERE
    ST_Intersects(
        pixpolyg,
        ST_GeomFromText('POLYGON((3427928 5793244,3427927.75 5793243.75,3427928 5793243.75,3427928 5793244))',0)
        ) AND b2val != 254;

        shadow
------------------------------------------------------------------------------------
 MULTIPOLYGON(((3427927.9 5793243.85,3427927.8 5793243.85,3427927.8 5793243.95,
 3427927.9 5793243.95,3427928 5793243.95,3427928.1 5793243.95,3427928.1 5793243.85,3427928 5793243.85,3427927.9 5793243.85)),
 ((3427927.9 5793243.65,3427927.8 5793243.65,3427927.8 5793243.75,3427927.8 5793243.85,3427927.9 5793243.85,
 3427928 5793243.85,3427928 5793243.75,3427928.1 5793243.75,3427928.1 5793243.65,3427928 5793243.65,3427927.9 5793243.65)))
                </pre></div><div class="refsection"><a name="idp73364992"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_SetValue" title="ST_SetValue">ST_SetValue</a>, <a class="xref" href="#RT_ST_DumpAsPolygons" title="ST_DumpAsPolygons">ST_DumpAsPolygons</a>, <a class="xref" href="#RT_ST_NumBands" title="ST_NumBands">ST_NumBands</a>, <a class="xref" href="#RT_ST_PixelAsPolygon" title="ST_PixelAsPolygon">ST_PixelAsPolygon</a>, <a class="xref" href="#RT_ST_ScaleX" title="ST_ScaleX">ST_ScaleX</a>, <a class="xref" href="#RT_ST_ScaleY" title="ST_ScaleY">ST_ScaleY</a>, <a class="xref" href="#RT_ST_UpperLeftX" title="ST_UpperLeftX">ST_UpperLeftX</a>, <a class="xref" href="#RT_ST_UpperLeftY" title="ST_UpperLeftY">ST_UpperLeftY</a>, <a class="xref" href="#RT_ST_SRID" title="ST_SRID">ST_SRID</a>, <a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a>, <a class="xref" href="#ST_Point" title="ST_Point">ST_Point</a>, <a class="xref" href="#ST_MakeEnvelope" title="ST_MakeEnvelope">ST_MakeEnvelope</a>, <a class="xref" href="#">???</a>, <a class="xref" href="#">???</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_NearestValue"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_NearestValue — 与えられたバンドの、columnxとrowyで指定されるか、またはラスタと同じ空間参照系で表現されたポイントで指定されたピクセルに最も近い<code class="varname">NODATA</code>でない値を返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">double precision <b class="fsfunc">ST_NearestValue</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">bandnum</var>, geometry  <var class="pdparam">pt</var>, boolean  <var class="pdparam">exclude_nodata_value=true</var><code>)</code>;</p><p><code class="funcdef">double precision <b class="fsfunc">ST_NearestValue</b>(</code>raster  <var class="pdparam">rast</var>, geometry  <var class="pdparam">pt</var>, boolean  <var class="pdparam">exclude_nodata_value=true</var><code>)</code>;</p><p><code class="funcdef">double precision <b class="fsfunc">ST_NearestValue</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">bandnum</var>, integer  <var class="pdparam">columnx</var>, integer  <var class="pdparam">rowy</var>, boolean  <var class="pdparam">exclude_nodata_value=true</var><code>)</code>;</p><p><code class="funcdef">double precision <b class="fsfunc">ST_NearestValue</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">columnx</var>, integer  <var class="pdparam">rowy</var>, boolean  <var class="pdparam">exclude_nodata_value=true</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp73407872"></a><h2>説明</h2><p>与えられたバンドの、columnxとrowyで指定されるか、またはラスタと同じ空間参照系で表現されたポイントで指定されたピクセルに最も近い<code class="varname">NODATA</code>でない値を返します。columnx, rowyピクセルまたは指定したジオメトリポイントのピクセルが<code class="varname">NODATA</code>である場合には、この関数は、columnx, rowyピクセルかジオメトリポイントのピクセルから最も近い<code class="varname">NODATA</code>.でないピクセルを探索します。 </p><p>バンド番号は1始まりで、<code class="varname">bandnum</code>が指定されていない場合には、1番と仮定します。<code class="varname">exclude_nodata_value</code>がFALSEに設定された場合には、<code class="varname">NODATA</code>ピクセルを含む全てのピクセルがインタセクトするかが考慮され、値を返します。<code class="varname">exclude_nodata_value</code>を渡さない場合には、ラスタのメタデータから読みます。 </p><p>Availability: 2.1.0</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_NearestValueはST_Valueと交換可能です。 </p></td></tr></table></div></div><div class="refsection"><a name="idp73413376"></a><h2>例</h2><pre class="programlisting">-- 2,2ピクセルは値を持っています
SELECT
    ST_Value(rast, 2, 2) AS value,
    ST_NearestValue(rast, 2, 2) AS nearestvalue
FROM (
    SELECT
        ST_SetValue(
            ST_SetValue(
                ST_SetValue(
                    ST_SetValue(
                        ST_SetValue(
                            ST_AddBand(
                                ST_MakeEmptyRaster(5, 5, -2, 2, 1, -1, 0, 0, 0),
                                '8BUI'::text, 1, 0
                            ),
                            1, 1, 0.
                        ),
                        2, 3, 0.
                    ),
                    3, 5, 0.
                ),
                4, 2, 0.
            ),
            5, 4, 0.
        ) AS rast
) AS foo

 value | nearestvalue
-------+--------------
     1 |            1
                </pre><pre class="programlisting">-- 2,3ピクセルはNODATAです
SELECT
    ST_Value(rast, 2, 3) AS value,
    ST_NearestValue(rast, 2, 3) AS nearestvalue
FROM (
    SELECT
        ST_SetValue(
            ST_SetValue(
                ST_SetValue(
                    ST_SetValue(
                        ST_SetValue(
                            ST_AddBand(
                                ST_MakeEmptyRaster(5, 5, -2, 2, 1, -1, 0, 0, 0),
                                '8BUI'::text, 1, 0
                            ),
                            1, 1, 0.
                        ),
                        2, 3, 0.
                    ),
                    3, 5, 0.
                ),
                4, 2, 0.
            ),
            5, 4, 0.
        ) AS rast
) AS foo

 value | nearestvalue
-------+--------------
       |            1
                </pre></div><div class="refsection"><a name="idp73415168"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Neighborhood" title="ST_Neighborhood">ST_Neighborhood</a>, <a class="xref" href="#RT_ST_Value" title="ST_Value">ST_Value</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_SetZ"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SetZ — 入力ジオメトリと同じX/y座標値と、指定されたリサンプリングアルゴリズムを使ってラスタから複写されたZ値とを持つジオメトリを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_SetZ</b>(</code>raster  <var class="pdparam">rast</var>, geometry  <var class="pdparam">geom</var>, text  <var class="pdparam">resample=nearest</var>, integer  <var class="pdparam">band=1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp73424768"></a><h2>説明</h2><p>入力ジオメトリと同じX/Y座標値と、指定されたリサンプリングアルゴリズムを使ってラスタから複写されたZ値とを持つジオメトリを返します。</p><p><code class="varname">resample</code>パラメータの取ることができる値は、デフォルトである最近傍探索リサンプリングを行う"nearest"、バイリニア補間 (<a class="ulink" href="https://en.wikipedia.org/wiki/Bilinear_interpolation" target="_top">WikiPedia 英語版</a>)を行う"bilinear"です。近隣セルも考慮に入れた値を計算するためのものです。</p><p>Availability: 3.2.0</p></div><div class="refsection"><a name="idp73427456"></a><h2>例</h2><pre class="programlisting">--
-- 値を持つ2x2ラスタ
--
-- 10 50
-- 40 20
--
WITH test_raster AS (
SELECT
ST_SetValues(
  ST_AddBand(
    ST_MakeEmptyRaster(width =
&gt; 2, height =
&gt; 2,
      upperleftx =
&gt; 0, upperlefty =
&gt; 2,
      scalex =
&gt; 1.0, scaley =
&gt; -1.0,
      skewx =
&gt; 0, skewy =
&gt; 0, srid =
&gt; 4326),
    index =
&gt; 1, pixeltype =
&gt; '16BSI',
    initialvalue =
&gt; 0,
    nodataval =
&gt; -999),
  1,1,1,
  newvalueset =
&gt;ARRAY[ARRAY[10.0::float8, 50.0::float8], ARRAY[40.0::float8, 20.0::float8]]) AS rast
)
SELECT
ST_AsText(
  ST_SetZ(
    rast,
    band =
&gt; 1,
    geom =
&gt; 'SRID=4326;LINESTRING(1.0 1.9, 1.0 0.2)'::geometry,
    resample =
&gt; 'bilinear'
))
FROM test_raster

            st_astext
----------------------------------
 LINESTRING Z (1 1.9 38,1 0.2 27)</pre></div><div class="refsection"><a name="idp73428736"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Value" title="ST_Value">ST_Value</a>, <a class="xref" href="#RT_ST_SetM" title="ST_SetM">ST_SetM</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_SetM"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SetM — 入力ジオメトリと同じX/y座標値と、指定されたリサンプリングアルゴリズムを使ってラスタから複写されたZ値とを持つジオメトリを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_SetM</b>(</code>raster  <var class="pdparam">rast</var>, geometry  <var class="pdparam">geom</var>, text  <var class="pdparam">resample=nearest</var>, integer  <var class="pdparam">band=1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp73438336"></a><h2>説明</h2><p>入力ジオメトリと同じX/Y座標値と、指定されたリサンプリングアルゴリズムを使ってラスタから複写されたZ値とを持つジオメトリを返します。</p><p><code class="varname">resample</code>パラメータの取ることができる値は、デフォルトである最近傍探索リサンプリングを行う"nearest"、バイリニア補間 (<a class="ulink" href="https://en.wikipedia.org/wiki/Bilinear_interpolation" target="_top">WikiPedia 英語版</a>)を行う"bilinear"です。近隣セルも考慮に入れた値を計算するためのものです。</p><p>Availability: 3.2.0</p></div><div class="refsection"><a name="idp73441024"></a><h2>例</h2><pre class="programlisting">--
-- 値を持つ2x2ラスタ
--
-- 10 50
-- 40 20
--
WITH test_raster AS (
SELECT
ST_SetValues(
  ST_AddBand(
    ST_MakeEmptyRaster(width =
&gt; 2, height =
&gt; 2,
      upperleftx =
&gt; 0, upperlefty =
&gt; 2,
      scalex =
&gt; 1.0, scaley =
&gt; -1.0,
      skewx =
&gt; 0, skewy =
&gt; 0, srid =
&gt; 4326),
    index =
&gt; 1, pixeltype =
&gt; '16BSI',
    initialvalue =
&gt; 0,
    nodataval =
&gt; -999),
  1,1,1,
  newvalueset =
&gt;ARRAY[ARRAY[10.0::float8, 50.0::float8], ARRAY[40.0::float8, 20.0::float8]]) AS rast
)
SELECT
ST_AsText(
  ST_SetM(
    rast,
    band =
&gt; 1,
    geom =
&gt; 'SRID=4326;LINESTRING(1.0 1.9, 1.0 0.2)'::geometry,
    resample =
&gt; 'bilinear'
))
FROM test_raster

            st_astext
----------------------------------
 LINESTRING M (1 1.9 38,1 0.2 27)</pre></div><div class="refsection"><a name="idp73442304"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Value" title="ST_Value">ST_Value</a>, <a class="xref" href="#RT_ST_SetZ" title="ST_SetZ">ST_SetZ</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Neighborhood"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Neighborhood — 与えられたバンドのcolumnX, columnYか、ラスタと同じ空間参照系のジオメトリポイントで指定されたピクセルの周囲にある、<code class="varname">NODATA</code>でない2次元倍精度浮動小数点数配列を返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">double precision[][] <b class="fsfunc">ST_Neighborhood</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">bandnum</var>, integer  <var class="pdparam">columnX</var>, integer  <var class="pdparam">rowY</var>, integer  <var class="pdparam">distanceX</var>, integer  <var class="pdparam">distanceY</var>, boolean  <var class="pdparam">exclude_nodata_value=true</var><code>)</code>;</p><p><code class="funcdef">double precision[][] <b class="fsfunc">ST_Neighborhood</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">columnX</var>, integer  <var class="pdparam">rowY</var>, integer  <var class="pdparam">distanceX</var>, integer  <var class="pdparam">distanceY</var>, boolean  <var class="pdparam">exclude_nodata_value=true</var><code>)</code>;</p><p><code class="funcdef">double precision[][] <b class="fsfunc">ST_Neighborhood</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">bandnum</var>, geometry  <var class="pdparam">pt</var>, integer  <var class="pdparam">distanceX</var>, integer  <var class="pdparam">distanceY</var>, boolean  <var class="pdparam">exclude_nodata_value=true</var><code>)</code>;</p><p><code class="funcdef">double precision[][] <b class="fsfunc">ST_Neighborhood</b>(</code>raster  <var class="pdparam">rast</var>, geometry  <var class="pdparam">pt</var>, integer  <var class="pdparam">distanceX</var>, integer  <var class="pdparam">distanceY</var>, boolean  <var class="pdparam">exclude_nodata_value=true</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp73480576"></a><h2>説明</h2><p>与えられたバンドのcolumnX, columnYか、ラスタと同じ空間参照系のジオメトリポイントで指定されたピクセルの周囲にある、<code class="varname">NODATA</code>でない2次元倍精度浮動小数点数配列を返します。<code class="varname">distanceX</code>と<code class="varname">distanceY</code>引数は、たとえば、対象ピクセルからX軸に沿って3ピクセルとしてY軸に沿って2ピクセルというふうに、指定したピクセルの周囲のピクセル数を、それぞれX方向とY方向に定義します。2次元配列の中心の値はcolumnX, columnYまたはジオメトリポイントで指定したピクセルの値です。 </p><p>バンド番号は1始まりで、<code class="varname">bandnum</code>が指定されていない場合には、1番と仮定します。<code class="varname">exclude_nodata_value</code>がFALSEに設定された場合には、<code class="varname">NODATA</code>ピクセルを含む全てのピクセルがインタセクトするかが考慮され、値を返します。<code class="varname">exclude_nodata_value</code>を渡さない場合には、ラスタのメタデータから読みます。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>返される2次元配列の各軸の要素数は2 * (<code class="varname">distanceX</code>|<code class="varname">distanceY</code>) + 1です。<code class="varname">distanceX</code>と<code class="varname">distanceY</code>を1にすると、3x3の配列が返ります。 </p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>2次元配列の出力はST_Min4ma, ST_Sum4ma, ST_Mean4maといったあらゆるラスタ処理関数に渡すことができます。 </p></td></tr></table></div><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp73488256"></a><h2>例</h2><pre class="programlisting">-- 2x2ピクセルは値を持っています
SELECT
    ST_Neighborhood(rast, 2, 2, 1, 1)
FROM (
    SELECT
        ST_SetValues(
            ST_AddBand(
                ST_MakeEmptyRaster(5, 5, -2, 2, 1, -1, 0, 0, 0),
                '8BUI'::text, 1, 0
            ),
            1, 1, 1, ARRAY[
                [0, 1, 1, 1, 1],
                [1, 1, 1, 0, 1],
                [1, 0, 1, 1, 1],
                [1, 1, 1, 1, 0],
                [1, 1, 0, 1, 1]
            ]::double precision[],
            1
        ) AS rast
) AS foo

         st_neighborhood
---------------------------------
{{NULL,1,1},{1,1,1},{1,NULL,1}}
                </pre><pre class="programlisting">-- 2,3ピクセルはNODATAです
SELECT
    ST_Neighborhood(rast, 2, 3, 1, 1)
FROM (
    SELECT
        ST_SetValues(
            ST_AddBand(
                ST_MakeEmptyRaster(5, 5, -2, 2, 1, -1, 0, 0, 0),
                '8BUI'::text, 1, 0
            ),
            1, 1, 1, ARRAY[
                [0, 1, 1, 1, 1],
                [1, 1, 1, 0, 1],
                [1, 0, 1, 1, 1],
                [1, 1, 1, 1, 0],
                [1, 1, 0, 1, 1]
            ]::double precision[],
            1
        ) AS rast
) AS foo

       st_neighborhood
------------------------------
 {{1,1,1},{1,NULL,1},{1,1,1}}
                </pre><pre class="programlisting">-- 3x3ピクセルは値を持っています
-- exclude_nodata_value = FALSE
SELECT
    ST_Neighborhood(rast, 3, 3, 1, 1, false)
FROM ST_SetValues(
            ST_AddBand(
                ST_MakeEmptyRaster(5, 5, -2, 2, 1, -1, 0, 0, 0),
                '8BUI'::text, 1, 0
            ),
            1, 1, 1, ARRAY[
                [0, 1, 1, 1, 1],
                [1, 1, 1, 0, 1],
                [1, 0, 1, 1, 1],
                [1, 1, 1, 1, 0],
                [1, 1, 0, 1, 1]
            ]::double precision[],
            1
        ) AS rast

      st_neighborhood
---------------------------
{{1,1,0},{0,1,1},{1,1,1}}
                </pre></div><div class="refsection"><a name="idp73490560"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_NearestValue" title="ST_NearestValue">ST_NearestValue</a>, <a class="xref" href="#RT_ST_Min4ma" title="ST_Min4ma">ST_Min4ma</a>, <a class="xref" href="#RT_ST_Max4ma" title="ST_Max4ma">ST_Max4ma</a>, <a class="xref" href="#RT_ST_Sum4ma" title="ST_Sum4ma">ST_Sum4ma</a>, <a class="xref" href="#RT_ST_Mean4ma" title="ST_Mean4ma">ST_Mean4ma</a>, <a class="xref" href="#RT_ST_Range4ma" title="ST_Range4ma">ST_Range4ma</a>, <a class="xref" href="#RT_ST_Distinct4ma" title="ST_Distinct4ma">ST_Distinct4ma</a>, <a class="xref" href="#RT_ST_StdDev4ma" title="ST_StdDev4ma">ST_StdDev4ma</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_SetValue"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SetValue — 与えられたバンドのcolumnX, columnYか、ラスタと同じ空間参照系のジオメトリポイントで指定されたピクセルの値または指定したジオメトリとインタセクトするピクセル群の値を設定することから得られる、変更されたラスタを返します。バンド番号は1始まりで、指定しない場合には、1番と仮定します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_SetValue</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">bandnum</var>, geometry  <var class="pdparam">geom</var>, double precision  <var class="pdparam">newvalue</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_SetValue</b>(</code>raster  <var class="pdparam">rast</var>, geometry  <var class="pdparam">geom</var>, double precision  <var class="pdparam">newvalue</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_SetValue</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">bandnum</var>, integer  <var class="pdparam">columnx</var>, integer  <var class="pdparam">rowy</var>, double precision  <var class="pdparam">newvalue</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_SetValue</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">columnx</var>, integer  <var class="pdparam">rowy</var>, double precision  <var class="pdparam">newvalue</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp73534336"></a><h2>説明</h2><p>指定されたバンドの、与えられたラスタの行と列またはジオメトリで指定したピクセルの値を新しい値に設定することで得られる、変更したラスタを返します。バンドが指定されいていない場合には、1番と仮定します。 </p><p>Enhanced: 2.1.0 ST_SetValueでジオメトリを用いる形式が、ポイントだけでなくあらゆるジオメトリタイプに対応するようになりました。ジオメトリを用いる形式はST_SetValuesのgeomval[]を用いる形式をラップしたものです。</p></div><div class="refsection"><a name="idp73535872"></a><h2>例</h2><pre class="programlisting">-- ジオメトリの例
SELECT (foo.geomval).val, ST_AsText(ST_Union((foo.geomval).geom))
FROM (SELECT ST_DumpAsPolygons(
        ST_SetValue(rast,1,
                ST_Point(3427927.75, 5793243.95),
                50)
            ) As geomval
FROM dummy_rast
where rid = 2) As foo
WHERE (foo.geomval).val &lt; 250
GROUP BY (foo.geomval).val;

 val |                                                     st_astext
-----+-------------------------------------------------------------------
  50 | POLYGON((3427927.75 5793244,3427927.75 5793243.95,3427927.8 579324 ...
 249 | POLYGON((3427927.95 5793243.95,3427927.95 5793243.85,3427928 57932 ...

                </pre><pre class="programlisting">-- 変更したラスタの格納 --
    UPDATE dummy_rast SET rast = ST_SetValue(rast,1, ST_Point(3427927.75, 5793243.95),100)
        WHERE rid = 2   ;

                </pre></div><div class="refsection"><a name="idp73537664"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Value" title="ST_Value">ST_Value</a>, <a class="xref" href="#RT_ST_DumpAsPolygons" title="ST_DumpAsPolygons">ST_DumpAsPolygons</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_SetValues"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SetValues — 与えられたバンドに複数の値を設定して、変更されたラスタを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_SetValues</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, integer  <var class="pdparam">columnx</var>, integer  <var class="pdparam">rowy</var>, double precision[][]  <var class="pdparam">newvalueset</var>, boolean[][]  <var class="pdparam">noset=NULL</var>, boolean  <var class="pdparam">keepnodata=FALSE</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_SetValues</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, integer  <var class="pdparam">columnx</var>, integer  <var class="pdparam">rowy</var>, double precision[][]  <var class="pdparam">newvalueset</var>, double precision  <var class="pdparam">nosetvalue</var>, boolean  <var class="pdparam">keepnodata=FALSE</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_SetValues</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, integer  <var class="pdparam">columnx</var>, integer  <var class="pdparam">rowy</var>, integer  <var class="pdparam">width</var>, integer  <var class="pdparam">height</var>, double precision  <var class="pdparam">newvalue</var>, boolean  <var class="pdparam">keepnodata=FALSE</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_SetValues</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">columnx</var>, integer  <var class="pdparam">rowy</var>, integer  <var class="pdparam">width</var>, integer  <var class="pdparam">height</var>, double precision  <var class="pdparam">newvalue</var>, boolean  <var class="pdparam">keepnodata=FALSE</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_SetValues</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, geomval[]  <var class="pdparam">geomvalset</var>, boolean  <var class="pdparam">keepnodata=FALSE</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp73585280"></a><h2>説明</h2><p>指定したバンドの指定したピクセルに新しい値を設定した結果として変更されたラスタを返します。<code class="varname">columnx</code>と<code class="varname">rowy</code>は1始まりです。 </p><p><code class="varname">keepnodata</code>がTRUEの場合には、NODATA値を持つピクセルは<code class="varname">newvalueset</code>に一致する値に設定しません。 </p><p>一つ目の形式では、設定するピクセルを<code class="varname">columnx</code>, <code class="varname">rowy</code>のピクセル座標で決定し、 範囲を<code class="varname">newvalueset</code>配列で決定します。<code class="varname">noset</code>によって、ピクセルを<code class="varname">newvalueset</code>内にある値で、一部を設定されないようにすることができます (PostgreSQLは不調和配列、ジャグ配列を許さないため)。一つ目の形式の例をご覧ください。 </p><p>二つ目の形式では、一つ目の形式と似ていますが、倍精度浮動小数点数のスカラ値である<code class="varname">nosetvalue</code>を<code class="varname">noset</code>配列の代わりに使う点が違います。<code class="varname">nosetvalue</code>の値になる<code class="varname">newvalueset</code>内の要素の設定は行いません。二つ目の形式の例をご覧下さい。 </p><p>三つ目の形式では、設定するピクセルを<code class="varname">columnx</code>, <code class="varname">rowy</code>のピクセル座標と<code class="varname">width</code>, <code class="varname">height</code>.で決定します。三つ目の形式の例をご覧ください。 </p><p>四つ目の形式では、<code class="varname">rast</code>の1番バンドのピクセルを設定すると仮定する点を除いては、三つ目の形式と同じです。 </p><p>五つ目の形式では、設定するピクセルを<a class="xref" href="#geomval" title="geomval">geomval</a>の配列で決定します。配列内の全てのジオメトリのタイプがPOINTまたはMULTIPOINTである場合には、ポイントごとの経度と緯度がピクセルの設定に直接使うためのショートカットに使われます。他の場合には、ジオメトリはラスタに変換され一つずつ渡されます。五つ目の形式の例をご覧下さい。 </p><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp73596544"></a><h2>例: 一つ目の形式</h2><pre class="programlisting">/*
ST_SetValues()によって次のように書き換わります

+ - + - + - +          + - + - + - +
| 1 | 1 | 1 |          | 1 | 1 | 1 |
+ - + - + - +          + - + - + - +
| 1 | 1 | 1 |    =
&gt;    | 1 | 9 | 9 |
+ - + - + - +          + - + - + - +
| 1 | 1 | 1 |          | 1 | 9 | 9 |
+ - + - + - +          + - + - + - +
*/
SELECT
    (poly).x,
    (poly).y,
    (poly).val
FROM (
SELECT
    ST_PixelAsPolygons(
        ST_SetValues(
            ST_AddBand(
                ST_MakeEmptyRaster(3, 3, 0, 0, 1, -1, 0, 0, 0),
                1, '8BUI', 1, 0
            ),
            1, 2, 2, ARRAY[[9, 9], [9, 9]]::double precision[][]
        )
    ) AS poly
) foo
ORDER BY 1, 2;

 x | y | val
---+---+-----
 1 | 1 |   1
 1 | 2 |   1
 1 | 3 |   1
 2 | 1 |   1
 2 | 2 |   9
 2 | 3 |   9
 3 | 1 |   1
 3 | 2 |   9
 3 | 3 |   9
                </pre><pre class="programlisting">/*
ST_SetValues()によって次のように書き換わります

+ - + - + - +          + - + - + - +
| 1 | 1 | 1 |          | 9 | 9 | 9 |
+ - + - + - +          + - + - + - +
| 1 | 1 | 1 |    =
&gt;    | 9 |   | 9 |
+ - + - + - +          + - + - + - +
| 1 | 1 | 1 |          | 9 | 9 | 9 |
+ - + - + - +          + - + - + - +
*/
SELECT
    (poly).x,
    (poly).y,
    (poly).val
FROM (
SELECT
    ST_PixelAsPolygons(
        ST_SetValues(
            ST_AddBand(
                ST_MakeEmptyRaster(3, 3, 0, 0, 1, -1, 0, 0, 0),
                1, '8BUI', 1, 0
            ),
            1, 1, 1, ARRAY[[9, 9, 9], [9, NULL, 9], [9, 9, 9]]::double precision[][]
        )
    ) AS poly
) foo
ORDER BY 1, 2;

 x | y | val
---+---+-----
 1 | 1 |   9
 1 | 2 |   9
 1 | 3 |   9
 2 | 1 |   9
 2 | 2 |
 2 | 3 |   9
 3 | 1 |   9
 3 | 2 |   9
 3 | 3 |   9
                </pre><pre class="programlisting">/*
ST_SetValues()によって次のように書き換わります

+ - + - + - +          + - + - + - +
| 1 | 1 | 1 |          | 9 | 9 | 9 |
+ - + - + - +          + - + - + - +
| 1 | 1 | 1 |    =
&gt;    | 1 |   | 9 |
+ - + - + - +          + - + - + - +
| 1 | 1 | 1 |          | 9 | 9 | 9 |
+ - + - + - +          + - + - + - +
*/
SELECT
    (poly).x,
    (poly).y,
    (poly).val
FROM (
SELECT
    ST_PixelAsPolygons(
        ST_SetValues(
            ST_AddBand(
                ST_MakeEmptyRaster(3, 3, 0, 0, 1, -1, 0, 0, 0),
                1, '8BUI', 1, 0
            ),
            1, 1, 1,
                ARRAY[[9, 9, 9], [9, NULL, 9], [9, 9, 9]]::double precision[][],
                ARRAY[[false], [true]]::boolean[][]
        )
    ) AS poly
) foo
ORDER BY 1, 2;

 x | y | val
---+---+-----
 1 | 1 |   9
 1 | 2 |   1
 1 | 3 |   9
 2 | 1 |   9
 2 | 2 |
 2 | 3 |   9
 3 | 1 |   9
 3 | 2 |   9
 3 | 3 |   9
                </pre><pre class="programlisting">/*
ST_SetValues()によって次のように書き換わります

+ - + - + - +          + - + - + - +
|   | 1 | 1 |          |   | 9 | 9 |
+ - + - + - +          + - + - + - +
| 1 | 1 | 1 |    =
&gt;    | 1 |   | 9 |
+ - + - + - +          + - + - + - +
| 1 | 1 | 1 |          | 9 | 9 | 9 |
+ - + - + - +          + - + - + - +
*/
SELECT
    (poly).x,
    (poly).y,
    (poly).val
FROM (
SELECT
    ST_PixelAsPolygons(
        ST_SetValues(
            ST_SetValue(
                ST_AddBand(
                    ST_MakeEmptyRaster(3, 3, 0, 0, 1, -1, 0, 0, 0),
                    1, '8BUI', 1, 0
                ),
                1, 1, 1, NULL
            ),
            1, 1, 1,
                ARRAY[[9, 9, 9], [9, NULL, 9], [9, 9, 9]]::double precision[][],
                ARRAY[[false], [true]]::boolean[][],
                TRUE
        )
    ) AS poly
) foo
ORDER BY 1, 2;

 x | y | val
---+---+-----
 1 | 1 |
 1 | 2 |   1
 1 | 3 |   9
 2 | 1 |   9
 2 | 2 |
 2 | 3 |   9
 3 | 1 |   9
 3 | 2 |   9
 3 | 3 |   9
                </pre></div><div class="refsection"><a name="idp73599360"></a><h2>例: 二つ目の形式</h2><pre class="programlisting">/*
ST_SetValues()によって次のように書き換わります

+ - + - + - +          + - + - + - +
| 1 | 1 | 1 |          | 1 | 1 | 1 |
+ - + - + - +          + - + - + - +
| 1 | 1 | 1 |    =
&gt;    | 1 | 9 | 9 |
+ - + - + - +          + - + - + - +
| 1 | 1 | 1 |          | 1 | 9 | 9 |
+ - + - + - +          + - + - + - +
*/
SELECT
    (poly).x,
    (poly).y,
    (poly).val
FROM (
SELECT
    ST_PixelAsPolygons(
        ST_SetValues(
            ST_AddBand(
                ST_MakeEmptyRaster(3, 3, 0, 0, 1, -1, 0, 0, 0),
                1, '8BUI', 1, 0
            ),
            1, 1, 1, ARRAY[[-1, -1, -1], [-1, 9, 9], [-1, 9, 9]]::double precision[][], -1
        )
    ) AS poly
) foo
ORDER BY 1, 2;

 x | y | val
---+---+-----
 1 | 1 |   1
 1 | 2 |   1
 1 | 3 |   1
 2 | 1 |   1
 2 | 2 |   9
 2 | 3 |   9
 3 | 1 |   1
 3 | 2 |   9
 3 | 3 |   9
                </pre><pre class="programlisting">/*
この例は上の例と似ていますが、nosetvalueを-1でなくNULLにしています。

ST_SetValues()によって次のように書き換わります

+ - + - + - +          + - + - + - +
| 1 | 1 | 1 |          | 1 | 1 | 1 |
+ - + - + - +          + - + - + - +
| 1 | 1 | 1 |    =
&gt;    | 1 | 9 | 9 |
+ - + - + - +          + - + - + - +
| 1 | 1 | 1 |          | 1 | 9 | 9 |
+ - + - + - +          + - + - + - +
*/
SELECT
    (poly).x,
    (poly).y,
    (poly).val
FROM (
SELECT
    ST_PixelAsPolygons(
        ST_SetValues(
            ST_AddBand(
                ST_MakeEmptyRaster(3, 3, 0, 0, 1, -1, 0, 0, 0),
                1, '8BUI', 1, 0
            ),
            1, 1, 1, ARRAY[[NULL, NULL, NULL], [NULL, 9, 9], [NULL, 9, 9]]::double precision[][], NULL::double precision
        )
    ) AS poly
) foo
ORDER BY 1, 2;

 x | y | val
---+---+-----
 1 | 1 |   1
 1 | 2 |   1
 1 | 3 |   1
 2 | 1 |   1
 2 | 2 |   9
 2 | 3 |   9
 3 | 1 |   1
 3 | 2 |   9
 3 | 3 |   9
                </pre></div><div class="refsection"><a name="idp73601152"></a><h2>例: 三つ目の形式</h2><pre class="programlisting">/*
ST_SetValues()によって次のように書き換わります

+ - + - + - +          + - + - + - +
| 1 | 1 | 1 |          | 1 | 1 | 1 |
+ - + - + - +          + - + - + - +
| 1 | 1 | 1 |    =
&gt;    | 1 | 9 | 9 |
+ - + - + - +          + - + - + - +
| 1 | 1 | 1 |          | 1 | 9 | 9 |
+ - + - + - +          + - + - + - +
*/
SELECT
    (poly).x,
    (poly).y,
    (poly).val
FROM (
SELECT
    ST_PixelAsPolygons(
        ST_SetValues(
            ST_AddBand(
                ST_MakeEmptyRaster(3, 3, 0, 0, 1, -1, 0, 0, 0),
                1, '8BUI', 1, 0
            ),
            1, 2, 2, 2, 2, 9
        )
    ) AS poly
) foo
ORDER BY 1, 2;

 x | y | val
---+---+-----
 1 | 1 |   1
 1 | 2 |   1
 1 | 3 |   1
 2 | 1 |   1
 2 | 2 |   9
 2 | 3 |   9
 3 | 1 |   1
 3 | 2 |   9
 3 | 3 |   9
                </pre><pre class="programlisting">/*
ST_SetValues()によって次のように書き換わります

+ - + - + - +          + - + - + - +
| 1 | 1 | 1 |          | 1 | 1 | 1 |
+ - + - + - +          + - + - + - +
| 1 |   | 1 |    =
&gt;    | 1 |   | 9 |
+ - + - + - +          + - + - + - +
| 1 | 1 | 1 |          | 1 | 9 | 9 |
+ - + - + - +          + - + - + - +
*/
SELECT
    (poly).x,
    (poly).y,
    (poly).val
FROM (
SELECT
    ST_PixelAsPolygons(
        ST_SetValues(
            ST_SetValue(
                ST_AddBand(
                    ST_MakeEmptyRaster(3, 3, 0, 0, 1, -1, 0, 0, 0),
                    1, '8BUI', 1, 0
                ),
                1, 2, 2, NULL
            ),
            1, 2, 2, 2, 2, 9, TRUE
        )
    ) AS poly
) foo
ORDER BY 1, 2;

 x | y | val
---+---+-----
 1 | 1 |   1
 1 | 2 |   1
 1 | 3 |   1
 2 | 1 |   1
 2 | 2 |
 2 | 3 |   9
 3 | 1 |   1
 3 | 2 |   9
 3 | 3 |   9
                </pre></div><div class="refsection"><a name="idp73602944"></a><h2>例: 五つ目の形式</h2><pre class="programlisting">WITH foo AS (
    SELECT 1 AS rid, ST_AddBand(ST_MakeEmptyRaster(5, 5, 0, 0, 1, -1, 0, 0, 0), 1, '8BUI', 0, 0) AS rast
), bar AS (
    SELECT 1 AS gid, 'SRID=0;POINT(2.5 -2.5)'::geometry geom UNION ALL
    SELECT 2 AS gid, 'SRID=0;POLYGON((1 -1, 4 -1, 4 -4, 1 -4, 1 -1))'::geometry geom UNION ALL
    SELECT 3 AS gid, 'SRID=0;POLYGON((0 0, 5 0, 5 -1, 1 -1, 1 -4, 0 -4, 0 0))'::geometry geom UNION ALL
    SELECT 4 AS gid, 'SRID=0;MULTIPOINT(0 0, 4 4, 4 -4)'::geometry
)
SELECT
    rid, gid, ST_DumpValues(ST_SetValue(rast, 1, geom, gid))
FROM foo t1
CROSS JOIN bar t2
ORDER BY rid, gid;

 rid | gid |                                                                st_dumpvalues
-----+-----+---------------------------------------------------------------------------------------------------------------------------------------------
   1 |   1 | (1,"{{NULL,NULL,NULL,NULL,NULL},{NULL,NULL,NULL,NULL,NULL},{NULL,NULL,1,NULL,NULL},{NULL,NULL,NULL,NULL,NULL},{NULL,NULL,NULL,NULL,NULL}}")
   1 |   2 | (1,"{{NULL,NULL,NULL,NULL,NULL},{NULL,2,2,2,NULL},{NULL,2,2,2,NULL},{NULL,2,2,2,NULL},{NULL,NULL,NULL,NULL,NULL}}")
   1 |   3 | (1,"{{3,3,3,3,3},{3,NULL,NULL,NULL,NULL},{3,NULL,NULL,NULL,NULL},{3,NULL,NULL,NULL,NULL},{NULL,NULL,NULL,NULL,NULL}}")
   1 |   4 | (1,"{{4,NULL,NULL,NULL,NULL},{NULL,NULL,NULL,NULL,NULL},{NULL,NULL,NULL,NULL,NULL},{NULL,NULL,NULL,NULL,NULL},{NULL,NULL,NULL,NULL,4}}")
(4 rows)
                </pre><p>配列内における後のgeomvalsで前のgeomvalsを上書きできることを示しています。</p><pre class="programlisting">WITH foo AS (
    SELECT 1 AS rid, ST_AddBand(ST_MakeEmptyRaster(5, 5, 0, 0, 1, -1, 0, 0, 0), 1, '8BUI', 0, 0) AS rast
), bar AS (
    SELECT 1 AS gid, 'SRID=0;POINT(2.5 -2.5)'::geometry geom UNION ALL
    SELECT 2 AS gid, 'SRID=0;POLYGON((1 -1, 4 -1, 4 -4, 1 -4, 1 -1))'::geometry geom UNION ALL
    SELECT 3 AS gid, 'SRID=0;POLYGON((0 0, 5 0, 5 -1, 1 -1, 1 -4, 0 -4, 0 0))'::geometry geom UNION ALL
    SELECT 4 AS gid, 'SRID=0;MULTIPOINT(0 0, 4 4, 4 -4)'::geometry
)
SELECT
    t1.rid, t2.gid, t3.gid, ST_DumpValues(ST_SetValues(rast, 1, ARRAY[ROW(t2.geom, t2.gid), ROW(t3.geom, t3.gid)]::geomval[]))
FROM foo t1
CROSS JOIN bar t2
CROSS JOIN bar t3
WHERE t2.gid = 1
    AND t3.gid = 2
ORDER BY t1.rid, t2.gid, t3.gid;

 rid | gid | gid |                                                    st_dumpvalues
-----+-----+-----+---------------------------------------------------------------------------------------------------------------------
   1 |   1 |   2 | (1,"{{NULL,NULL,NULL,NULL,NULL},{NULL,2,2,2,NULL},{NULL,2,2,2,NULL},{NULL,2,2,2,NULL},{NULL,NULL,NULL,NULL,NULL}}")
(1 row)
                </pre><p>この例は前の例の逆です。</p><pre class="programlisting">WITH foo AS (
    SELECT 1 AS rid, ST_AddBand(ST_MakeEmptyRaster(5, 5, 0, 0, 1, -1, 0, 0, 0), 1, '8BUI', 0, 0) AS rast
), bar AS (
    SELECT 1 AS gid, 'SRID=0;POINT(2.5 -2.5)'::geometry geom UNION ALL
    SELECT 2 AS gid, 'SRID=0;POLYGON((1 -1, 4 -1, 4 -4, 1 -4, 1 -1))'::geometry geom UNION ALL
    SELECT 3 AS gid, 'SRID=0;POLYGON((0 0, 5 0, 5 -1, 1 -1, 1 -4, 0 -4, 0 0))'::geometry geom UNION ALL
    SELECT 4 AS gid, 'SRID=0;MULTIPOINT(0 0, 4 4, 4 -4)'::geometry
)
SELECT
    t1.rid, t2.gid, t3.gid, ST_DumpValues(ST_SetValues(rast, 1, ARRAY[ROW(t2.geom, t2.gid), ROW(t3.geom, t3.gid)]::geomval[]))
FROM foo t1
CROSS JOIN bar t2
CROSS JOIN bar t3
WHERE t2.gid = 2
    AND t3.gid = 1
ORDER BY t1.rid, t2.gid, t3.gid;

 rid | gid | gid |                                                    st_dumpvalues
-----+-----+-----+---------------------------------------------------------------------------------------------------------------------
   1 |   2 |   1 | (1,"{{NULL,NULL,NULL,NULL,NULL},{NULL,2,2,2,NULL},{NULL,2,1,2,NULL},{NULL,2,2,2,NULL},{NULL,NULL,NULL,NULL,NULL}}")
(1 row)
                </pre></div><div class="refsection"><a name="idp73606016"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Value" title="ST_Value">ST_Value</a>, <a class="xref" href="#RT_ST_SetValue" title="ST_SetValue">ST_SetValue</a>, <a class="xref" href="#RT_ST_PixelAsPolygons" title="ST_PixelAsPolygons">ST_PixelAsPolygons</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_DumpValues"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_DumpValues — 指定したバンドの値を2次元で得ます。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">setof record <b class="fsfunc">ST_DumpValues</b>(</code> raster  <var class="pdparam">rast</var> ,  integer[]  <var class="pdparam">nband=NULL</var> ,  boolean  <var class="pdparam">exclude_nodata_value=true</var> <code>)</code>;</p><p><code class="funcdef">double precision[][] <b class="fsfunc">ST_DumpValues</b>(</code> raster  <var class="pdparam">rast</var> ,  integer  <var class="pdparam">nband</var> ,  boolean  <var class="pdparam">exclude_nodata_value=true</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp73640960"></a><h2>説明</h2><p>指定したバンドの値を2次元で得ます (一つ目の添え字で行、二つ目の添え字で列に、それぞれ対応します)。<code class="varname">nband</code>がNULLまたは指定されていない場合には、全てのラスタバンドが処理されます。 </p><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp73642880"></a><h2>例</h2><pre class="programlisting">WITH foo AS (
    SELECT ST_AddBand(ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(3, 3, 0, 0, 1, -1, 0, 0, 0), 1, '8BUI'::text, 1, 0), 2, '32BF'::text, 3, -9999), 3, '16BSI', 0, 0) AS rast
)
SELECT
    (ST_DumpValues(rast)).*
FROM foo;

 nband |                       valarray
-------+------------------------------------------------------
     1 | {{1,1,1},{1,1,1},{1,1,1}}
     2 | {{3,3,3},{3,3,3},{3,3,3}}
     3 | {{NULL,NULL,NULL},{NULL,NULL,NULL},{NULL,NULL,NULL}}
(3 rows)
                </pre><pre class="programlisting">WITH foo AS (
    SELECT ST_AddBand(ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(3, 3, 0, 0, 1, -1, 0, 0, 0), 1, '8BUI'::text, 1, 0), 2, '32BF'::text, 3, -9999), 3, '16BSI', 0, 0) AS rast
)
SELECT
    (ST_DumpValues(rast, ARRAY[3, 1])).*
FROM foo;

 nband |                       valarray
-------+------------------------------------------------------
     3 | {{NULL,NULL,NULL},{NULL,NULL,NULL},{NULL,NULL,NULL}}
     1 | {{1,1,1},{1,1,1},{1,1,1}}
(2 rows)
                </pre><pre class="programlisting">WITH foo AS (
    SELECT ST_SetValue(ST_AddBand(ST_MakeEmptyRaster(3, 3, 0, 0, 1, -1, 0, 0, 0), 1, '8BUI', 1, 0), 1, 2, 5) AS rast
)
SELECT
    (ST_DumpValues(rast, 1))[2][1]
FROM foo;

 st_dumpvalues
---------------
             5
(1 row)
                </pre></div><div class="refsection"><a name="idp73645184"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Value" title="ST_Value">ST_Value</a>, <a class="xref" href="#RT_ST_SetValue" title="ST_SetValue">ST_SetValue</a>, <a class="xref" href="#RT_ST_SetValues" title="ST_SetValues">ST_SetValues</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_PixelOfValue"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_PixelOfValue — 検索値と同じ値を持つピクセルのcolumnx, rowyピクセル座標を得ます。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">setof record <b class="fsfunc">ST_PixelOfValue</b>(</code> raster  <var class="pdparam">rast</var> ,  integer  <var class="pdparam">nband</var> ,  double precision[]  <var class="pdparam">search</var> ,  boolean  <var class="pdparam">exclude_nodata_value=true</var> <code>)</code>;</p><p><code class="funcdef">setof record <b class="fsfunc">ST_PixelOfValue</b>(</code> raster  <var class="pdparam">rast</var> ,  double precision[]  <var class="pdparam">search</var> ,  boolean  <var class="pdparam">exclude_nodata_value=true</var> <code>)</code>;</p><p><code class="funcdef">setof record <b class="fsfunc">ST_PixelOfValue</b>(</code> raster  <var class="pdparam">rast</var> ,  integer  <var class="pdparam">nband</var> ,  double precision  <var class="pdparam">search</var> ,  boolean  <var class="pdparam">exclude_nodata_value=true</var> <code>)</code>;</p><p><code class="funcdef">setof record <b class="fsfunc">ST_PixelOfValue</b>(</code> raster  <var class="pdparam">rast</var> ,  double precision  <var class="pdparam">search</var> ,  boolean  <var class="pdparam">exclude_nodata_value=true</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp73688576"></a><h2>説明</h2><p>検索値と同じ値を持つピクセルのcolumnx, rowyピクセル座標を得ます。バンドを指定しない場合には、1番と仮定します。 </p><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp73690112"></a><h2>例</h2><pre class="programlisting">SELECT
    (pixels).*
FROM (
    SELECT
        ST_PixelOfValue(
            ST_SetValue(
                ST_SetValue(
                    ST_SetValue(
                        ST_SetValue(
                            ST_SetValue(
                                ST_AddBand(
                                    ST_MakeEmptyRaster(5, 5, -2, 2, 1, -1, 0, 0, 0),
                                    '8BUI'::text, 1, 0
                                ),
                                1, 1, 0
                            ),
                            2, 3, 0
                        ),
                        3, 5, 0
                    ),
                    4, 2, 0
                ),
                5, 4, 255
            )
        , 1, ARRAY[1, 255]) AS pixels
) AS foo

 val | x | y
-----+---+---
   1 | 1 | 2
   1 | 1 | 3
   1 | 1 | 4
   1 | 1 | 5
   1 | 2 | 1
   1 | 2 | 2
   1 | 2 | 4
   1 | 2 | 5
   1 | 3 | 1
   1 | 3 | 2
   1 | 3 | 3
   1 | 3 | 4
   1 | 4 | 1
   1 | 4 | 3
   1 | 4 | 4
   1 | 4 | 5
   1 | 5 | 1
   1 | 5 | 2
   1 | 5 | 3
 255 | 5 | 4
   1 | 5 | 5
                </pre></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Raster_Editors"></a>12.7. ラスタエディタ</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#RT_ST_SetGeoReference">ST_SetGeoReference</a></span><span class="refpurpose"> — 地理参照6パラメタを一度に設定します。数値は空白で区切ります。GDALまたはESRI書式の入力を受け付けます。デフォルトはGDALです。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_SetRotation">ST_SetRotation</a></span><span class="refpurpose"> — ラスタの回転をラジアン単位で設定します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_SetScale">ST_SetScale</a></span><span class="refpurpose"> — ピクセルサイズのX値とY値を空間参照系の単位で設定します。数値は単位/ピクセルの幅または高さです。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_SetSkew">ST_SetSkew</a></span><span class="refpurpose"> — 地理参照のスキュー (回転パラメタ)のX値とY値を設定します。一つだけ渡した場合には、X値とY値は同じ値に設定されます。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_SetSRID">ST_SetSRID</a></span><span class="refpurpose"> — スタのSRIDをspatial_ref_sysに定義されている特定の整数値に設定します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_SetUpperLeft">ST_SetUpperLeft</a></span><span class="refpurpose"> — ラスタの左上隅の投影座標系のX値とY値を設定します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Resample">ST_Resample</a></span><span class="refpurpose"> — 指定したリサンプリングアルゴリズム、新しいピクセル範囲、グリッドの隅、定義するか他のラスタから借りてきた地理参照属性を使ってリサンプリングを行います。 </span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Rescale">ST_Rescale</a></span><span class="refpurpose"> — スケール (ピクセルサイズ)だけを調整するリサンプリングを行います。新しいピクセル値のリサンプリングアルゴリズムとして最近傍補間 ('NearestNeighbor' (米式綴り方))、双線形補間 ('Bilinear')、3次補間 ('Cubic')、3次スプライン補間 ('CubicSpline')、ランチョス補間 ('Lanczos')を用います。デフォルトは最近傍補間です。 </span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Reskew">ST_Reskew</a></span><span class="refpurpose"> — キュー (回転パラメタ)だけを調整するリサンプリングを行います。新しいピクセル値のリサンプリングアルゴリズムとして最近傍補間 ('NearestNeighbor' (米式綴り方))、双線形補間 ('Bilinear')、3次補間 ('Cubic')、3次スプライン補間 ('CubicSpline')、ランチョス補間 ('Lanczos')を用います。デフォルトは最近傍補間です。 </span></dt><dt><span class="refentrytitle"><a href="#RT_ST_SnapToGrid">ST_SnapToGrid</a></span><span class="refpurpose"> — グリッドにスナップすることでラスタをリサンプリングします。新しいピクセル値のリサンプリングアルゴリズムとして最近傍補間 ('NearestNeighbor' (米式綴り方))、双線形補間 ('Bilinear')、3次補間 ('Cubic')、3次スプライン補間 ('CubicSpline')、ランチョス補間('Lanczos')を用います。デフォルトは最近傍補間です。 </span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Resize">ST_Resize</a></span><span class="refpurpose"> — ラスタを新しい幅、高さにサイズ再設定を行います。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Transform">ST_Transform</a></span><span class="refpurpose"> — ラスタを既知の空間参照系から他の既知の空間参照系に、指定したリサンプリングアルゴリズムで投影変換します。新しいピクセル値のリサンプリングアルゴリズムとして最近傍補間 ('NearestNeighbor' (米式綴り方))、双線形補間 ('Bilinear')、3次補間 ('Cubic')、3次スプライン補間 ('CubicSpline')、ランチョス補間 ('Lanczos')を用います。デフォルトは最近傍補間です。</span></dt></dl></div><div class="refentry"><a name="RT_ST_SetGeoReference"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SetGeoReference — 地理参照6パラメタを一度に設定します。数値は空白で区切ります。GDALまたはESRI書式の入力を受け付けます。デフォルトはGDALです。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_SetGeoReference</b>(</code>raster  <var class="pdparam">rast</var>, text  <var class="pdparam">georefcoords</var>, text  <var class="pdparam">format=GDAL</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_SetGeoReference</b>(</code>raster  <var class="pdparam">rast</var>, double precision  <var class="pdparam">upperleftx</var>, double precision  <var class="pdparam">upperlefty</var>, double precision  <var class="pdparam">scalex</var>, double precision  <var class="pdparam">scaley</var>, double precision  <var class="pdparam">skewx</var>, double precision  <var class="pdparam">skewy</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp73707264"></a><h2>説明</h2><p>地理参照6パラメタを一度に設定します。'GDAL'または'ESRI'書式の入力を受け付けます。デフォルトはGDALです。6パラメタが与えられない場合には、NULLを返します。</p><p>書式の表現の違いは次の通りです。</p><p><code class="varname">GDAL</code>: </p><pre class="programlisting">scalex skewy skewx scaley upperleftx upperlefty</pre><p><code class="varname">ESRI</code>: </p><pre class="programlisting">scalex skewy skewx scaley upperleftx + scalex*0.5 upperlefty + scaley*0.5</pre><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ラスタがデータベース外のバンドを持っている場合には、地理参照の変更によって、バンドの外部保存されているデータに正しくアクセスできなくなることがあります。 </p></td></tr></table></div><p>Enhanced: 2.1.0 ST_SetGeoReference(raster, double precision, ...)形式を追加しました。</p></div><div class="refsection"><a name="idp73712000"></a><h2>例</h2><pre class="programlisting">WITH foo AS (
    SELECT ST_MakeEmptyRaster(5, 5, 0, 0, 1, -1, 0, 0, 0) AS rast
)
SELECT
    0 AS rid, (ST_Metadata(rast)).*
FROM foo
UNION ALL
SELECT
    1, (ST_Metadata(ST_SetGeoReference(rast, '10 0 0 -10 0.1 0.1', 'GDAL'))).*
FROM foo
UNION ALL
SELECT
    2, (ST_Metadata(ST_SetGeoReference(rast, '10 0 0 -10 5.1 -4.9', 'ESRI'))).*
FROM foo
UNION ALL
SELECT
    3, (ST_Metadata(ST_SetGeoReference(rast, 1, 1, 10, -10, 0.001, 0.001))).*
FROM foo

 rid |     upperleftx     |     upperlefty     | width | height | scalex | scaley | skewx | skewy | srid | numbands
-----+--------------------+--------------------+-------+--------+--------+--------+-------+-------+------+----------
   0 |                  0 |                  0 |     5 |      5 |      1 |     -1 |     0 |     0 |    0 |        0
   1 |                0.1 |                0.1 |     5 |      5 |     10 |    -10 |     0 |     0 |    0 |        0
   2 | 0.0999999999999996 | 0.0999999999999996 |     5 |      5 |     10 |    -10 |     0 |     0 |    0 |        0
   3 |                  1 |                  1 |     5 |      5 |     10 |    -10 | 0.001 | 0.001 |    0 |        0
                </pre></div><div class="refsection"><a name="idp73713280"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_GeoReference" title="ST_GeoReference">ST_GeoReference</a>, <a class="xref" href="#RT_ST_ScaleX" title="ST_ScaleX">ST_ScaleX</a>, <a class="xref" href="#RT_ST_ScaleY" title="ST_ScaleY">ST_ScaleY</a>, <a class="xref" href="#RT_ST_UpperLeftX" title="ST_UpperLeftX">ST_UpperLeftX</a>, <a class="xref" href="#RT_ST_UpperLeftY" title="ST_UpperLeftY">ST_UpperLeftY</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_SetRotation"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SetRotation — ラスタの回転をラジアン単位で設定します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_SetRotation</b>(</code>raster <var class="pdparam">rast</var>, float8 <var class="pdparam">rotation</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp73721600"></a><h2>説明</h2><p>ラスタを回転させます。回転はラジアン単位です。詳細については<a class="ulink" href="http://en.wikipedia.org/wiki/World_file" target="_top">World File</a> (英語版WikiPedia)をご覧下さい。</p></div><div class="refsection"><a name="idp73723264"></a><h2>例</h2><pre class="programlisting">SELECT
  ST_ScaleX(rast1), ST_ScaleY(rast1), ST_SkewX(rast1), ST_SkewY(rast1),
  ST_ScaleX(rast2), ST_ScaleY(rast2), ST_SkewX(rast2), ST_SkewY(rast2)
FROM (
  SELECT ST_SetRotation(rast, 15) AS rast1, rast as rast2 FROM dummy_rast
) AS foo;
      st_scalex      |      st_scaley      |      st_skewx      |      st_skewy      | st_scalex | st_scaley | st_skewx | st_skewy
---------------------+---------------------+--------------------+--------------------+-----------+-----------+----------+----------
   -1.51937582571764 |   -2.27906373857646 |   1.95086352047135 |   1.30057568031423 |         2 |         3 |        0 |        0
 -0.0379843956429411 | -0.0379843956429411 | 0.0325143920078558 | 0.0325143920078558 |      0.05 |     -0.05 |        0 |        0
                </pre></div><div class="refsection"><a name="idp73724800"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Rotation" title="ST_Rotation">ST_Rotation</a>, <a class="xref" href="#RT_ST_ScaleX" title="ST_ScaleX">ST_ScaleX</a>, <a class="xref" href="#RT_ST_ScaleY" title="ST_ScaleY">ST_ScaleY</a>, <a class="xref" href="#RT_ST_SkewX" title="ST_SkewX">ST_SkewX</a>, <a class="xref" href="#RT_ST_SkewY" title="ST_SkewY">ST_SkewY</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_SetScale"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SetScale — ピクセルサイズのX値とY値を空間参照系の単位で設定します。数値は単位/ピクセルの幅または高さです。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_SetScale</b>(</code>raster  <var class="pdparam">rast</var>, float8  <var class="pdparam">xy</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_SetScale</b>(</code>raster  <var class="pdparam">rast</var>, float8  <var class="pdparam">x</var>, float8  <var class="pdparam">y</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp73737344"></a><h2>説明</h2><p>ピクセルサイズのX値とY値を空間参照系の単位で設定します。数値は単位/ピクセルの幅または高さです。一つだけ渡した場合には、X値とY値は同じ値に設定されます。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_SetScaleはラスタの範囲をあわせるためのリサンプリングをしない点で<a class="xref" href="#RT_ST_Rescale" title="ST_Rescale">ST_Rescale</a>と異なります。根本的に誤った設定を行ったのを訂正するためにラスタのメタデータ (地理参照)を変更するだけです。ST_Rescaleは、入力ラスタの地理範囲に合わせて計算された幅、高さを持つラスタを返します。ST_SetScaleはラスタの幅も高さも変更しません。</p></td></tr></table></div><p>Changed: 2.0.0 WKTRaster版では、ST_SetPixelSizeと呼ばれていました。2.0.0で変更されました。</p></div><div class="refsection"><a name="idp73739776"></a><h2>例</h2><pre class="programlisting">UPDATE dummy_rast
    SET rast = ST_SetScale(rast, 1.5)
WHERE rid = 2;

SELECT ST_ScaleX(rast) As pixx, ST_ScaleY(rast) As pixy, Box3D(rast) As newbox
FROM dummy_rast
WHERE rid = 2;

 pixx | pixy |                    newbox
------+------+----------------------------------------------
  1.5 |  1.5 | BOX(3427927.75 5793244 0, 3427935.25 5793251.5 0)
                </pre><pre class="programlisting">UPDATE dummy_rast
    SET rast = ST_SetScale(rast, 1.5, 0.55)
WHERE rid = 2;

SELECT ST_ScaleX(rast) As pixx, ST_ScaleY(rast) As pixy, Box3D(rast) As newbox
FROM dummy_rast
WHERE rid = 2;

 pixx | pixy |                   newbox
------+------+--------------------------------------------
  1.5 | 0.55 | BOX(3427927.75 5793244 0,3427935.25 5793247 0)
                </pre></div><div class="refsection"><a name="idp73741568"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_ScaleX" title="ST_ScaleX">ST_ScaleX</a>, <a class="xref" href="#RT_ST_ScaleY" title="ST_ScaleY">ST_ScaleY</a>, <a class="xref" href="#RT_Box3D" title="Box3D">Box3D</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_SetSkew"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SetSkew — 地理参照のスキュー (回転パラメタ)のX値とY値を設定します。一つだけ渡した場合には、X値とY値は同じ値に設定されます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_SetSkew</b>(</code>raster  <var class="pdparam">rast</var>, float8  <var class="pdparam">skewxy</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_SetSkew</b>(</code>raster  <var class="pdparam">rast</var>, float8  <var class="pdparam">skewx</var>, float8  <var class="pdparam">skewy</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp73753344"></a><h2>説明</h2><p>地理参照のスキュー (回転パラメタ)のX値とY値を設定します。一つだけ渡した場合には、X値とY値は同じ値に設定されます。詳細については<a class="ulink" href="http://en.wikipedia.org/wiki/World_file" target="_top">World File</a> (英語版WikiPedia)をご覧下さい。</p></div><div class="refsection"><a name="idp73755008"></a><h2>例</h2><pre class="programlisting">-- 例1
UPDATE dummy_rast SET rast = ST_SetSkew(rast,1,2) WHERE rid = 1;
SELECT rid, ST_SkewX(rast) As skewx, ST_SkewY(rast) As skewy,
    ST_GeoReference(rast) as georef
FROM dummy_rast WHERE rid = 1;

rid | skewx | skewy |    georef
----+-------+-------+--------------
  1 |     1 |     2 | 2.0000000000
                    : 2.0000000000
                    : 1.0000000000
                    : 3.0000000000
                    : 0.5000000000
                    : 0.5000000000

                </pre><pre class="programlisting">-- 例2 同じ値に設定
UPDATE dummy_rast SET rast = ST_SetSkew(rast,0) WHERE rid = 1;
SELECT rid, ST_SkewX(rast) As skewx, ST_SkewY(rast) As skewy,
    ST_GeoReference(rast) as georef
FROM dummy_rast WHERE rid = 1;

 rid | skewx | skewy |    georef
-----+-------+-------+--------------
   1 |     0 |     0 | 2.0000000000
                     : 0.0000000000
                     : 0.0000000000
                     : 3.0000000000
                     : 0.5000000000
                     : 0.5000000000
                </pre></div><div class="refsection"><a name="idp73757056"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_GeoReference" title="ST_GeoReference">ST_GeoReference</a>, <a class="xref" href="#RT_ST_SetGeoReference" title="ST_SetGeoReference">ST_SetGeoReference</a>, <a class="xref" href="#RT_ST_SkewX" title="ST_SkewX">ST_SkewX</a>, <a class="xref" href="#RT_ST_SkewY" title="ST_SkewY">ST_SkewY</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_SetSRID"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SetSRID — スタのSRIDをspatial_ref_sysに定義されている特定の整数値に設定します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_SetSRID</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">srid</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp73764992"></a><h2>説明</h2><p>ラスタのSRIDを特定の整数値に設定します。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ラスタの投影変換は行いません。単にメタデータを空間参照系の定義されている値に設定するだけです。後で投影変換を行う場合に使います。 </p></td></tr></table></div></div><div class="refsection"><a name="idp73766912"></a><h2>関連情報</h2><p><a class="xref" href="#spatial_ref_sys" title="4.5. 空間参照系">「空間参照系」</a>, <a class="xref" href="#RT_ST_SRID" title="ST_SRID">ST_SRID</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_SetUpperLeft"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SetUpperLeft — ラスタの左上隅の投影座標系のX値とY値を設定します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_SetUpperLeft</b>(</code>raster  <var class="pdparam">rast</var>, double precision  <var class="pdparam">x</var>, double precision  <var class="pdparam">y</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp73775104"></a><h2>説明</h2><p>ラスタの左上隅の投影座標系のX値とY値を設定します。</p></div><div class="refsection"><a name="idp73776256"></a><h2>例</h2><pre class="programlisting">SELECT ST_SetUpperLeft(rast,-71.01,42.37)
FROM dummy_rast
WHERE rid = 2;
                    </pre></div><div class="refsection"><a name="idp73777536"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_UpperLeftX" title="ST_UpperLeftX">ST_UpperLeftX</a>, <a class="xref" href="#RT_ST_UpperLeftY" title="ST_UpperLeftY">ST_UpperLeftY</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Resample"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Resample — 指定したリサンプリングアルゴリズム、新しいピクセル範囲、グリッドの隅、定義するか他のラスタから借りてきた地理参照属性を使ってリサンプリングを行います。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_Resample</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">width</var>, integer  <var class="pdparam">height</var>, double precision  <var class="pdparam">gridx=NULL</var>, double precision  <var class="pdparam">gridy=NULL</var>, double precision  <var class="pdparam">skewx=0</var>, double precision  <var class="pdparam">skewy=0</var>, text  <var class="pdparam">algorithm=NearestNeighbor</var>, double precision  <var class="pdparam">maxerr=0.125</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Resample</b>(</code>raster  <var class="pdparam">rast</var>, double precision  <var class="pdparam">scalex=0</var>, double precision  <var class="pdparam">scaley=0</var>, double precision  <var class="pdparam">gridx=NULL</var>, double precision  <var class="pdparam">gridy=NULL</var>, double precision  <var class="pdparam">skewx=0</var>, double precision  <var class="pdparam">skewy=0</var>, text  <var class="pdparam">algorithm=NearestNeighbor</var>, double precision  <var class="pdparam">maxerr=0.125</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Resample</b>(</code>raster  <var class="pdparam">rast</var>, raster  <var class="pdparam">ref</var>, text  <var class="pdparam">algorithm=NearestNeighbor</var>, double precision  <var class="pdparam">maxerr=0.125</var>, boolean  <var class="pdparam">usescale=true</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Resample</b>(</code>raster  <var class="pdparam">rast</var>, raster  <var class="pdparam">ref</var>, boolean  <var class="pdparam">usescale</var>, text  <var class="pdparam">algorithm=NearestNeighbor</var>, double precision  <var class="pdparam">maxerr=0.125</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp73833600"></a><h2>説明</h2><p>指定したリサンプリングアルゴリズム、新しいピクセル範囲 (width &amp; height)、グリッド隅 (gridx &amp; gridy)、定義するか他のラスタから借りてきた地理参照属性 (scalex, scaley, skewx, skewy)を使ってリサンプリングを行います。参照ラスタを使用する場合には、二つのラスタは同じSRIDでなければなりません。 </p><p>新しいピクセル値は、リサンプリングアルゴリズムとして最近傍補間 ('NearestNeighbor' (米式綴り方))、双線形補間 ('Bilinear')、3次補間 ('Cubic')、3次スプライン補間 ('CubicSpline')、ランチョス補間 ('Lanczos')を用います。デフォルトは最も早いですが最も悪い内挿を行う最近傍補間です。 </p><p><code class="varname">maxerr</code>が指定されていない場合には0.125とします。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>詳細については <a class="ulink" href="http://www.gdal.org/gdalwarp.html" target="_top">GDAL Warp resampling methods</a>をご覧下さい。 </p></td></tr></table></div><p>Availability: 2.0.0 GDAL 1.6.1以上が必要です。</p><p>Changed: 2.1.0 srid引数を削除しました。参照ラスタを使う形式では、もはや参照ラスタのSRIDを適用しません。ラスタの投影変換にはST_Transform()を使います。SRIDなしで動作します。</p></div><div class="refsection"><a name="idp73866496"></a><h2>例</h2><pre class="programlisting">SELECT
    ST_Width(orig) AS orig_width,
    ST_Width(reduce_100) AS new_width
FROM (
    SELECT
        rast AS orig,
        ST_Resample(rast,100,100) AS reduce_100
    FROM aerials.boston
    WHERE ST_Intersects(rast,
        ST_Transform(
            ST_MakeEnvelope(-71.128, 42.2392,-71.1277, 42.2397, 4326),26986)
    )
    LIMIT 1
) AS foo;

 orig_width | new_width
------------+-------------
        200 |         100
                </pre></div><div class="refsection"><a name="idp73867776"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Rescale" title="ST_Rescale">ST_Rescale</a>, <a class="xref" href="#RT_ST_Resize" title="ST_Resize">ST_Resize</a>, <a class="xref" href="#RT_ST_Transform" title="ST_Transform">ST_Transform</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Rescale"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Rescale — スケール (ピクセルサイズ)だけを調整するリサンプリングを行います。新しいピクセル値のリサンプリングアルゴリズムとして最近傍補間 ('NearestNeighbor' (米式綴り方))、双線形補間 ('Bilinear')、3次補間 ('Cubic')、3次スプライン補間 ('CubicSpline')、ランチョス補間 ('Lanczos')を用います。デフォルトは最近傍補間です。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_Rescale</b>(</code>raster  <var class="pdparam">rast</var>, double precision  <var class="pdparam">scalexy</var>, text  <var class="pdparam">algorithm=NearestNeighbor</var>, double precision  <var class="pdparam">maxerr=0.125</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Rescale</b>(</code>raster  <var class="pdparam">rast</var>, double precision  <var class="pdparam">scalex</var>, double precision  <var class="pdparam">scaley</var>, text  <var class="pdparam">algorithm=NearestNeighbor</var>, double precision  <var class="pdparam">maxerr=0.125</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp73884288"></a><h2>説明</h2><p>スケール (ピクセルサイズ)だけを調整するリサンプリングを行います。新しいピクセル値のリサンプリングアルゴリズムとして最近傍補間 ('NearestNeighbor' (米式綴り方))、双線形補間 ('Bilinear')、3次補間 ('Cubic')、3次スプライン補間 ('CubicSpline')、ランチョス補間 ('Lanczos')を用います。デフォルトは最も早いですが最も悪い内挿を行う最近傍補間です。</p><p><code class="varname">scalex</code>と<code class="varname">scaley</code>で、新しいピクセルサイズを定義します。ラスタを正しい方向にするには、scaleyは負数でなければならないことがしばしばあります。</p><p>新しいscalexまたはscaleyがラスタのwidthまたはheightの除数でない時、結果ラスタの範囲は元のラスタの範囲を含むために拡大されます。<a class="xref" href="#RT_ST_Resize" title="ST_Resize">ST_Resize</a>をご覧ください。</p><p><code class="varname">maxerr</code>は、リサンプリングアルゴリズムで変換を行う際に近似を行うかどうかを決めるしきい値です (ピクセル単位)。<code class="varname">maxerr</code>を設定しない場合には、デフォルトの0.125が使用され、この値はGDALのgdalwarpユーティリティで使われる値と同じです。0に設定した場合には、近似は行われません。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>詳細については <a class="ulink" href="http://www.gdal.org/gdalwarp.html" target="_top">GDAL Warp resampling methods</a>をご覧下さい。 </p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_Recalcは、ST_SetScaleはラスタ範囲に合わせるためのリサンプリングをしない点で、<a class="xref" href="#RT_ST_SetScale" title="ST_SetScale">ST_SetScale</a>と異なります。ST_SetScaleは根本的に誤った設定を行ったのを訂正するためにラスタのメタデータ (地理参照)を変更するだけです。ST_Rescaleは、入力ラスタの地理範囲に合わせて計算された幅、高さを持つラスタを返します。ST_SetScaleはラスタの幅も高さも変更しません。</p></td></tr></table></div><p>Availability: 2.0.0 GDAL 1.6.1以上が必要です。</p><p>Changed: 2.1.0 SRIDなしのラスタで動作するようになりました。</p></div><div class="refsection"><a name="idp73890944"></a><h2>例</h2><p>ラスタのピクセルサイズを0.001度から0.0015度にスケール再設定を行う例です。</p><pre class="programlisting">-- 元のラスタのピクセルサイズ
SELECT ST_PixelWidth(ST_AddBand(ST_MakeEmptyRaster(100, 100, 0, 0, 0.001, -0.001, 0, 0, 4269), '8BUI'::text, 1, 0)) width

   width
----------
0.001

-- スケール再設定したラスタのピクセルサイズ
SELECT ST_PixelWidth(ST_Rescale(ST_AddBand(ST_MakeEmptyRaster(100, 100, 0, 0, 0.001, -0.001, 0, 0, 4269), '8BUI'::text, 1, 0), 0.0015)) width

   width
----------
0.0015
</pre></div><div class="refsection"><a name="idp73892608"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Resize" title="ST_Resize">ST_Resize</a>, <a class="xref" href="#RT_ST_Resample" title="ST_Resample">ST_Resample</a>, <a class="xref" href="#RT_ST_SetScale" title="ST_SetScale">ST_SetScale</a>, <a class="xref" href="#RT_ST_ScaleX" title="ST_ScaleX">ST_ScaleX</a>, <a class="xref" href="#RT_ST_ScaleY" title="ST_ScaleY">ST_ScaleY</a>, <a class="xref" href="#RT_ST_Transform" title="ST_Transform">ST_Transform</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Reskew"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Reskew — キュー (回転パラメタ)だけを調整するリサンプリングを行います。新しいピクセル値のリサンプリングアルゴリズムとして最近傍補間 ('NearestNeighbor' (米式綴り方))、双線形補間 ('Bilinear')、3次補間 ('Cubic')、3次スプライン補間 ('CubicSpline')、ランチョス補間 ('Lanczos')を用います。デフォルトは最近傍補間です。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_Reskew</b>(</code>raster  <var class="pdparam">rast</var>, double precision  <var class="pdparam">skewxy</var>, text  <var class="pdparam">algorithm=NearestNeighbor</var>, double precision  <var class="pdparam">maxerr=0.125</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Reskew</b>(</code>raster  <var class="pdparam">rast</var>, double precision  <var class="pdparam">skewx</var>, double precision  <var class="pdparam">skewy</var>, text  <var class="pdparam">algorithm=NearestNeighbor</var>, double precision  <var class="pdparam">maxerr=0.125</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp73918464"></a><h2>説明</h2><p>スキュー (回転パラメタ)だけを調整するリサンプリングを行います。新しいピクセル値のリサンプリングアルゴリズムとして最近傍補間 ('NearestNeighbor' (米式綴り方))、双線形補間 ('Bilinear')、3次補間 ('Cubic')、3次スプライン補間 ('CubicSpline')、ランチョス補間 ('Lanczos')を用います。デフォルトは最も早いですが最も悪い内挿を行う最近傍補間です。</p><p><code class="varname">skewx</code>と<code class="varname">skewy</code>によって新しいスキューが定義されます。</p><p>新しいラスタの範囲は元のラスタの範囲を含みます。</p><p><code class="varname">maxerr</code>が指定されていない場合には0.125とします。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>詳細については <a class="ulink" href="http://www.gdal.org/gdalwarp.html" target="_top">GDAL Warp resampling methods</a>をご覧下さい。 </p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_Reskewは、ST_SetSkewがラスタの範囲をあわせるためのリサンプリングをしない点で<a class="xref" href="#RT_ST_SetSkew" title="ST_SetSkew">ST_SetSkew</a>と異なります。根本的に誤った設定を行ったのを訂正するためにラスタのメタデータ (地理参照)を変更するだけです。ST_Reskewは、入力ラスタの地理範囲に合わせて計算された幅、高さを持つラスタを返します。ST_SetSkewはラスタの幅も高さも変更しません。</p></td></tr></table></div><p>Availability: 2.0.0 GDAL 1.6.1以上が必要です。</p><p>Changed: 2.1.0 SRIDなしのラスタで動作するようになりました。</p></div><div class="refsection"><a name="idp73924352"></a><h2>例</h2><p>スキューを0.0から0.0015に再設定する簡単な例です。</p><pre class="programlisting">-- 回転前の元のラスタ
SELECT ST_Rotation(ST_AddBand(ST_MakeEmptyRaster(100, 100, 0, 0, 0.001, -0.001, 0, 0, 4269), '8BUI'::text, 1, 0));

-- 結果
0

-- ST_Reskewを施したラスタの回転
SELECT ST_Rotation(ST_Reskew(ST_AddBand(ST_MakeEmptyRaster(100, 100, 0, 0, 0.001, -0.001, 0, 0, 4269), '8BUI'::text, 1, 0), 0.0015));

-- 結果
-0.982793723247329</pre></div><div class="refsection"><a name="idp73926016"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Resample" title="ST_Resample">ST_Resample</a>, <a class="xref" href="#RT_ST_Rescale" title="ST_Rescale">ST_Rescale</a>, <a class="xref" href="#RT_ST_SetSkew" title="ST_SetSkew">ST_SetSkew</a>, <a class="xref" href="#RT_ST_SetRotation" title="ST_SetRotation">ST_SetRotation</a>, <a class="xref" href="#RT_ST_SkewX" title="ST_SkewX">ST_SkewX</a>, <a class="xref" href="#RT_ST_SkewY" title="ST_SkewY">ST_SkewY</a>, <a class="xref" href="#RT_ST_Transform" title="ST_Transform">ST_Transform</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_SnapToGrid"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SnapToGrid — グリッドにスナップすることでラスタをリサンプリングします。新しいピクセル値のリサンプリングアルゴリズムとして最近傍補間 ('NearestNeighbor' (米式綴り方))、双線形補間 ('Bilinear')、3次補間 ('Cubic')、3次スプライン補間 ('CubicSpline')、ランチョス補間('Lanczos')を用います。デフォルトは最近傍補間です。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_SnapToGrid</b>(</code>raster  <var class="pdparam">rast</var>, double precision  <var class="pdparam">gridx</var>, double precision  <var class="pdparam">gridy</var>, text  <var class="pdparam">algorithm=NearestNeighbor</var>, double precision  <var class="pdparam">maxerr=0.125</var>, double precision  <var class="pdparam">scalex=DEFAULT 0</var>, double precision  <var class="pdparam">scaley=DEFAULT 0</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_SnapToGrid</b>(</code>raster  <var class="pdparam">rast</var>, double precision  <var class="pdparam">gridx</var>, double precision  <var class="pdparam">gridy</var>, double precision  <var class="pdparam">scalex</var>, double precision  <var class="pdparam">scaley</var>, text  <var class="pdparam">algorithm=NearestNeighbor</var>, double precision  <var class="pdparam">maxerr=0.125</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_SnapToGrid</b>(</code>raster  <var class="pdparam">rast</var>, double precision  <var class="pdparam">gridx</var>, double precision  <var class="pdparam">gridy</var>, double precision  <var class="pdparam">scalexy</var>, text  <var class="pdparam">algorithm=NearestNeighbor</var>, double precision  <var class="pdparam">maxerr=0.125</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp73969152"></a><h2>説明</h2><p>任意のピクセル隅 (gridx &amp; gridy)と、任意引数としてピクセルサイズ (scalex &amp; scaley)によって定義されるグリッドにスナップすることでラスタをリサンプリングします。新しいピクセル値のリサンプリングアルゴリズムとして最近傍補間 ('NearestNeighbor' (米式綴り方))、双線形補間 ('Bilinear')、3次補間 ('Cubic')、3次スプライン補間 ('CubicSpline')、ランチョス補間 ('Lanczos')を用います。デフォルトは最も早いですが最も悪い内挿を行う最近傍補間です。</p><p><code class="varname">gridx</code>と<code class="varname">gridy</code>は、新しいグリッドの任意のピクセル隅を定義します。これは新しいラスタの左上隅に必ずなるものではありません。新しいラスタ範囲の内部または境界である必要はありません。</p><p>任意引数として、新しいグリッドのピクセルサイズを<code class="varname">scalex</code>と<code class="varname">scaley</code>で指定することができます。</p><p>新しいラスタの範囲は元のラスタの範囲を含みます。</p><p><code class="varname">maxerr</code>が指定されていない場合には0.125とします。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>詳細については <a class="ulink" href="http://www.gdal.org/gdalwarp.html" target="_top">GDAL Warp resampling methods</a>をご覧下さい。 </p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>グリッドパラメタより多くの制御が必要な場合には、<a class="xref" href="#RT_ST_Resample" title="ST_Resample">ST_Resample</a>を使います。</p></td></tr></table></div><p>Availability: 2.0.0 GDAL 1.6.1以上が必要です。</p><p>Changed: 2.1.0 SRIDなしのラスタで動作するようになりました。</p></div><div class="refsection"><a name="idp73976192"></a><h2>例</h2><p>ラスタをわずかに異なるグリッドにスナップさせる簡単な例です。</p><pre class="programlisting">-- 元のラスタの左上隅のX値

SELECT ST_UpperLeftX(ST_AddBand(ST_MakeEmptyRaster(10, 10, 0, 0, 0.001, -0.001, 0, 0, 4269), '8BUI'::text, 1, 0));
-- 結果
0

-- スナップしたラスタの左上隅のX値
SELECT ST_UpperLeftX(ST_SnapToGrid(ST_AddBand(ST_MakeEmptyRaster(10, 10, 0, 0, 0.001, -0.001, 0, 0, 4269), '8BUI'::text, 1, 0), 0.0002, 0.0002));

-- 結果
-0.0008</pre></div><div class="refsection"><a name="idp73977856"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Resample" title="ST_Resample">ST_Resample</a>, <a class="xref" href="#RT_ST_Rescale" title="ST_Rescale">ST_Rescale</a>, <a class="xref" href="#RT_ST_UpperLeftX" title="ST_UpperLeftX">ST_UpperLeftX</a>, <a class="xref" href="#RT_ST_UpperLeftY" title="ST_UpperLeftY">ST_UpperLeftY</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Resize"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Resize — ラスタを新しい幅、高さにサイズ再設定を行います。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_Resize</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">width</var>, integer  <var class="pdparam">height</var>, text  <var class="pdparam">algorithm=NearestNeighbor</var>, double precision  <var class="pdparam">maxerr=0.125</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Resize</b>(</code>raster  <var class="pdparam">rast</var>, double precision  <var class="pdparam">percentwidth</var>, double precision  <var class="pdparam">percentheight</var>, text  <var class="pdparam">algorithm=NearestNeighbor</var>, double precision  <var class="pdparam">maxerr=0.125</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Resize</b>(</code>raster  <var class="pdparam">rast</var>, text  <var class="pdparam">width</var>, text  <var class="pdparam">height</var>, text  <var class="pdparam">algorithm=NearestNeighbor</var>, double precision  <var class="pdparam">maxerr=0.125</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp74022656"></a><h2>説明</h2><p>ラスタを新しい幅、高さにサイズ再設定を行います。新しい幅、高さはピクセル数で確実に指定するか、ラスタの幅、高さの比率で指定します。新しいラスタの範囲は元のラスタの範囲と同じです。 </p><p>新しいピクセル値のリサンプリングアルゴリズムとして最近傍補間 ('NearestNeighbor' (米式綴り方))、双線形補間 ('Bilinear')、3次補間 ('Cubic')、3次スプライン補間 ('CubicSpline')、ランチョス補間 ('Lanczos')を用います。デフォルトは最も早いですが最も悪い内挿を行う最近傍補間です。 </p><p>一つ目の形式では、出力ラスタの実際の幅、高さを予定しています。 </p><p>二つ目の形式では、0から1の間の値で、入力ラスタの幅、高さに対する比率を指定しています。 </p><p>三つ目の形式では、出力ラスタの実際の幅、高さを取るか、文字列による入力ラスタの幅、高さに対する百分率 ("20%")を取ります。 </p><p>Availability: 2.1.0 GDAL 1.6.1以上が必要です。</p></div><div class="refsection"><a name="idp74025728"></a><h2>例</h2><pre class="programlisting">WITH foo AS(
SELECT
    1 AS rid,
    ST_Resize(
        ST_AddBand(
            ST_MakeEmptyRaster(1000, 1000, 0, 0, 1, -1, 0, 0, 0)
            , 1, '8BUI', 255, 0
        )
    , '50%', '500') AS rast
UNION ALL
SELECT
    2 AS rid,
    ST_Resize(
        ST_AddBand(
            ST_MakeEmptyRaster(1000, 1000, 0, 0, 1, -1, 0, 0, 0)
            , 1, '8BUI', 255, 0
        )
    , 500, 100) AS rast
UNION ALL
SELECT
    3 AS rid,
    ST_Resize(
        ST_AddBand(
            ST_MakeEmptyRaster(1000, 1000, 0, 0, 1, -1, 0, 0, 0)
            , 1, '8BUI', 255, 0
        )
    , 0.25, 0.9) AS rast
), bar AS (
    SELECT rid, ST_Metadata(rast) AS meta, rast FROM foo
)
SELECT rid, (meta).* FROM bar

 rid | upperleftx | upperlefty | width | height | scalex | scaley | skewx | skewy | srid | numbands
-----+------------+------------+-------+--------+--------+--------+-------+-------+------+----------
   1 |          0 |          0 |   500 |    500 |      1 |     -1 |     0 |     0 |    0 |        1
   2 |          0 |          0 |   500 |    100 |      1 |     -1 |     0 |     0 |    0 |        1
   3 |          0 |          0 |   250 |    900 |      1 |     -1 |     0 |     0 |    0 |        1
(3 rows)
                </pre></div><div class="refsection"><a name="idp74027008"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Resample" title="ST_Resample">ST_Resample</a>, <a class="xref" href="#RT_ST_Rescale" title="ST_Rescale">ST_Rescale</a>, <a class="xref" href="#RT_ST_Reskew" title="ST_Reskew">ST_Reskew</a>, <a class="xref" href="#RT_ST_SnapToGrid" title="ST_SnapToGrid">ST_SnapToGrid</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Transform"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Transform — ラスタを既知の空間参照系から他の既知の空間参照系に、指定したリサンプリングアルゴリズムで投影変換します。新しいピクセル値のリサンプリングアルゴリズムとして最近傍補間 ('NearestNeighbor' (米式綴り方))、双線形補間 ('Bilinear')、3次補間 ('Cubic')、3次スプライン補間 ('CubicSpline')、ランチョス補間 ('Lanczos')を用います。デフォルトは最近傍補間です。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_Transform</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">srid</var>, text  <var class="pdparam">algorithm=NearestNeighbor</var>, double precision  <var class="pdparam">maxerr=0.125</var>, double precision  <var class="pdparam">scalex</var>, double precision  <var class="pdparam">scaley</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Transform</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">srid</var>, double precision  <var class="pdparam">scalex</var>, double precision  <var class="pdparam">scaley</var>, text  <var class="pdparam">algorithm=NearestNeighbor</var>, double precision  <var class="pdparam">maxerr=0.125</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Transform</b>(</code>raster  <var class="pdparam">rast</var>, raster  <var class="pdparam">alignto</var>, text  <var class="pdparam">algorithm=NearestNeighbor</var>, double precision  <var class="pdparam">maxerr=0.125</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp74060928"></a><h2>説明</h2><p>ラスタを既知の空間参照系から他の既知の空間参照系に、指定したリサンプリングアルゴリズムで投影変換します。algorithmが指定されていない場合には'NearestNeighbor'とし、maxerrorが指定されていない場合には0.125とします。</p><p>アルゴリズム指定オプションは'NearestNeighbor', 'Bilinear', 'Cubic', 'CubicSpline', 'Lanczos'です。詳細については<a class="ulink" href="http://www.gdal.org/gdalwarp.html" target="_top">GDAL Warp resampling methods</a>をご覧ください。</p><p>ST_TransformはしばしばST_SetSRIDと混同されます。ST_Transformは、ある空間参照系から別の空間参照系に変更する際に、実際にラスタの座標を変更します (かつピクセル値のリサンプリングを行います)が、ST_SetSRIDは単にラスタの空間参照系識別子を変更するだけです。 </p><p>三つ目の形式は、他の形式と違い、<code class="varname">alignto</code>として参照ラスタが求められます。投影変換したラスタは参照ラスタの空間参照系 (SRID)に投影変換して、参照ラスタと同じアラインメントを持つようにします (ST_SameAlignmentがTRUEになるようにします)。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>変換機能が思ったように働かない場合には、環境変数PROJSOをPostGISが使用する投影変換ライブラリの.soまたは.dllに指定する必要があるかも知れません。ファイル名の指定だけ必要です。Windowsでの例として、コントロールパネル-&gt;システム-&gt;システムの詳細設定-&gt;環境変数で、<code class="varname">PROJSO</code>という名前のシステム変数を追加して、<code class="varname">libproj.dll</code> (Proj 4.6.1を使用している場合)を設定します。変更後はPostgreSQLサービス/デーモンを再起動します。 </p></td></tr></table></div><div class="warning"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>タイルのカバレッジを変換する時には、ほとんどの場合で、「例: 三つ目の形式」で示す通り、同じアラインメントになり、かつタイル内に隙間がなくなるようにするために、参照ラスタを使用したくなります。 </p></td></tr></table></div><p>Availability: 2.0.0 GDAL 1.6.1以上が必要です。</p><p>Enhanced: 2.1.0 ST_Tranfrorm(rast, alignto)の形式を追加しました。</p></div><div class="refsection"><a name="idp74067200"></a><h2>例</h2><pre class="programlisting">SELECT ST_Width(mass_stm) As w_before, ST_Width(wgs_84) As w_after,
  ST_Height(mass_stm) As h_before, ST_Height(wgs_84) As h_after
    FROM
    ( SELECT rast As mass_stm, ST_Transform(rast,4326) As wgs_84
  ,  ST_Transform(rast,4326, 'Bilinear') AS wgs_84_bilin
        FROM aerials.o_2_boston
            WHERE ST_Intersects(rast,
                ST_Transform(ST_MakeEnvelope(-71.128, 42.2392,-71.1277, 42.2397, 4326),26986) )
        LIMIT 1) As foo;

 w_before | w_after | h_before | h_after
----------+---------+----------+---------
      200 |     228 |      200 |     170
                    </pre><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col><col><col></colgroup><tbody><tr><td style="border-right: 1px solid ; "><div class="informalfigure"><div class="mediaobject"><img src="images/rt_st_transform01.png"><div class="caption"><p>元のラスタはメートル単位のマサチューセッツ州平面 (mass_stm)</p></div></div></div>
         </td><td style="border-right: 1px solid ; "><div class="informalfigure"><div class="mediaobject"><img src="images/rt_st_transform02.png"><div class="caption"><p>WGS84経度緯度に変換した後 (wgs_84)</p></div></div></div>
         </td><td style=""><div class="informalfigure"><div class="mediaobject"><img src="images/rt_st_transform03.png"><div class="caption"><p>最近傍補間の代わりに双線形補間を使ってWGS84経度緯度に変換した後 (wgs_84_bilin)</p></div></div></div>
         </td></tr></tbody></table></div></div><div class="refsection"><a name="idp74090112"></a><h2>例: 三つ目の形式</h2><p>次に示す例は、ST_Transform(raster, srid)とST_Transform(raster, alignto)との違いを示しています。</p><pre class="programlisting">WITH foo AS (
    SELECT 0 AS rid, ST_AddBand(ST_MakeEmptyRaster(2, 2, -500000, 600000, 100, -100, 0, 0, 2163), 1, '16BUI', 1, 0) AS rast UNION ALL
    SELECT 1, ST_AddBand(ST_MakeEmptyRaster(2, 2, -499800, 600000, 100, -100, 0, 0, 2163), 1, '16BUI', 2, 0) AS rast UNION ALL
    SELECT 2, ST_AddBand(ST_MakeEmptyRaster(2, 2, -499600, 600000, 100, -100, 0, 0, 2163), 1, '16BUI', 3, 0) AS rast UNION ALL

    SELECT 3, ST_AddBand(ST_MakeEmptyRaster(2, 2, -500000, 599800, 100, -100, 0, 0, 2163), 1, '16BUI', 10, 0) AS rast UNION ALL
    SELECT 4, ST_AddBand(ST_MakeEmptyRaster(2, 2, -499800, 599800, 100, -100, 0, 0, 2163), 1, '16BUI', 20, 0) AS rast UNION ALL
    SELECT 5, ST_AddBand(ST_MakeEmptyRaster(2, 2, -499600, 599800, 100, -100, 0, 0, 2163), 1, '16BUI', 30, 0) AS rast UNION ALL

    SELECT 6, ST_AddBand(ST_MakeEmptyRaster(2, 2, -500000, 599600, 100, -100, 0, 0, 2163), 1, '16BUI', 100, 0) AS rast UNION ALL
    SELECT 7, ST_AddBand(ST_MakeEmptyRaster(2, 2, -499800, 599600, 100, -100, 0, 0, 2163), 1, '16BUI', 200, 0) AS rast UNION ALL
    SELECT 8, ST_AddBand(ST_MakeEmptyRaster(2, 2, -499600, 599600, 100, -100, 0, 0, 2163), 1, '16BUI', 300, 0) AS rast
), bar AS (
    SELECT
        ST_Transform(rast, 4269) AS alignto
    FROM foo
    LIMIT 1
), baz AS (
    SELECT
        rid,
        rast,
        ST_Transform(rast, 4269) AS not_aligned,
        ST_Transform(rast, alignto) AS aligned
    FROM foo
    CROSS JOIN bar
)
SELECT
    ST_SameAlignment(rast) AS rast,
    ST_SameAlignment(not_aligned) AS not_aligned,
    ST_SameAlignment(aligned) AS aligned
FROM baz

 rast | not_aligned | aligned
------+-------------+---------
 t    | f           | t
                </pre><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col><col></colgroup><tbody><tr><td style="border-right: 1px solid ; "><div class="informalfigure"><div class="mediaobject"><img src="images/rt_st_transform04.png"><div class="caption"><p>アラインメントなし</p></div></div></div><p>
                          </p></td><td style=""><div class="informalfigure"><div class="mediaobject"><img src="images/rt_st_transform05.png"><div class="caption"><p>アラインメントあり</p></div></div></div><p>
                        </p></td></tr></tbody></table></div></div><div class="refsection"><a name="idp74098688"></a><h2>関連情報</h2><p><a class="xref" href="#">???</a>, <a class="xref" href="#RT_ST_SetSRID" title="ST_SetSRID">ST_SetSRID</a></p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="RasterBand_Editors"></a>12.8. ラスタバンドエディタ</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#RT_ST_SetBandNoDataValue">ST_SetBandNoDataValue</a></span><span class="refpurpose"> — 指定したバンドにNODATAを表現する値を設定します。バンドを指定しない場合には、1番と仮定します。NODATA値を持たないようにするには、nodatavalueにNULLを指定します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_SetBandIsNoData">ST_SetBandIsNoData</a></span><span class="refpurpose"> — バンドのisnodataフラグをTRUEにします。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_SetBandPath">ST_SetBandPath</a></span><span class="refpurpose"> — データベース外バンドの外部パスとバンド番号を更新します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_SetBandIndex">ST_SetBandIndex</a></span><span class="refpurpose"> — データベース外バンドの外部バンド番号の更新</span></dt></dl></div><div class="refentry"><a name="RT_ST_SetBandNoDataValue"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SetBandNoDataValue — 指定したバンドにNODATAを表現する値を設定します。バンドを指定しない場合には、1番と仮定します。NODATA値を持たないようにするには、nodatavalueにNULLを指定します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_SetBandNoDataValue</b>(</code>raster  <var class="pdparam">rast</var>, double precision  <var class="pdparam">nodatavalue</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_SetBandNoDataValue</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">band</var>, double precision  <var class="pdparam">nodatavalue</var>, boolean  <var class="pdparam">forcechecking=false</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp74116224"></a><h2>説明</h2><p>指定したバンドにNODATAを表現する値を設定します。バンドを指定しない場合には、1番と仮定します。この関数は<a class="xref" href="#RT_ST_Polygon" title="ST_Polygon">ST_Polygon</a>, <a class="xref" href="#RT_ST_DumpAsPolygons" title="ST_DumpAsPolygons">ST_DumpAsPolygons</a>, ST_PixelAs系関数群からの結果に影響を与えます。</p></div><div class="refsection"><a name="idp74118144"></a><h2>例</h2><pre class="programlisting">-- 1番バンドのNODATA値を変更します
UPDATE dummy_rast
    SET rast = ST_SetBandNoDataValue(rast,1, 254)
WHERE rid = 2;

-- 1番、2番、3番のNODATA値を変更します
UPDATE dummy_rast
    SET rast =
        ST_SetBandNoDataValue(
            ST_SetBandNoDataValue(
                ST_SetBandNoDataValue(
                    rast,1, 254)
                ,2,99),
                3,108)
        WHERE rid = 2;

-- NODATA値の設定を解除して、処理関数が全てのピクセルを考慮するようにします
UPDATE dummy_rast
    SET rast = ST_SetBandNoDataValue(rast,1, NULL)
WHERE rid = 2;
                    </pre></div><div class="refsection"><a name="idp74119424"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_BandNoDataValue" title="ST_BandNoDataValue">ST_BandNoDataValue</a>, <a class="xref" href="#RT_ST_NumBands" title="ST_NumBands">ST_NumBands</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_SetBandIsNoData"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SetBandIsNoData — バンドのisnodataフラグをTRUEにします。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_SetBandIsNoData</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">band=1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp74139008"></a><h2>説明</h2><p>バンドのisnodataフラグをTRUEにします。バンドを指定しない場合には、1番と仮定します。isnodataフラグが汚れている場合にのみ呼ぶべきものです。<a class="xref" href="#RT_ST_BandIsNoData" title="ST_BandIsNoData">ST_BandIsNoData</a>の、最後の引数にTRUEを設定した場合の結果と指定しない場合の結果とで異なっている時です。</p><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp74141056"></a><h2>例</h2><pre class="programlisting">-- ラスタカラムを一つ持つダミーテーブルを生成します
create table dummy_rast (rid integer, rast raster);

-- 2バンドでバンドごとに1ピクセルを持つラスタを追加します
-- 一つ目のバンドにはnodatavalueとピクセル値をともに3とし、
-- 二つ目のバンドにはnodatavalue=13とピクセル値=4とします。
insert into dummy_rast values(1,
(
'01' -- little endian - リトルエンディアン (uint8 ndr)
||
'0000' -- version - 版 (uint16 0)
||
'0200' -- nBands - バンド数 (uint16 0)
||
'17263529ED684A3F' -- scaleX - X方向セルサイズ (float64 0.000805965234044584)
||
'F9253529ED684ABF' -- scaleY - Y方向セルサイズ (float64 -0.00080596523404458)
||
'1C9F33CE69E352C0' -- ipX - 左上隅X値 (float64 -75.5533328537098)
||
'718F0E9A27A44840' -- ipY - 左上隅Y値 (float64 49.2824585505576)
||
'ED50EB853EC32B3F' -- skewX - スキューX (float64 0.000211812383858707)
||
'7550EB853EC32B3F' -- skewY - スキューY (float64 0.000211812383858704)
||
'E6100000' -- SRID (int32 4326)
||
'0100' -- width - 横セル数 (uint16 1)
||
'0100' -- height - 縦セル数 (uint16 1)
||
'4' -- hasnodatavalueをTRUEにし、isnodata値を (TRUEにするべきところ)FALSEにする
||
'2' -- 1番バンドのタイプ (4BUI)
||
'03' -- NODATA値==3
||
'03' -- 0列0行ピクセルの値==3 (NODATA値と同じ)
||
'0' -- hasnodatavalueをFALSEにする。
||
'5' -- 2番バンドのタイプ (16BSI)
||
'0D00' -- NODATA値==13
||
'0400' -- 0列0行ピクセルの値==4
)::raster
);

select st_bandisnodata(rast, 1) from dummy_rast where rid = 1; -- FALSEを期待
select st_bandisnodata(rast, 1, TRUE) from dummy_rast where rid = 1; -- TRUEを期待

-- isnodataフラグが汚れているのでTRUEに設定します
update dummy_rast set rast = st_setbandisnodata(rast, 1) where rid = 1;


select st_bandisnodata(rast, 1) from dummy_rast where rid = 1; -- TRUEを期待

                    </pre></div><div class="refsection"><a name="idp74142336"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_BandNoDataValue" title="ST_BandNoDataValue">ST_BandNoDataValue</a>, <a class="xref" href="#RT_ST_NumBands" title="ST_NumBands">ST_NumBands</a>, <a class="xref" href="#RT_ST_SetBandNoDataValue" title="ST_SetBandNoDataValue">ST_SetBandNoDataValue</a>, <a class="xref" href="#RT_ST_BandIsNoData" title="ST_BandIsNoData">ST_BandIsNoData</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_SetBandPath"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SetBandPath — データベース外バンドの外部パスとバンド番号を更新します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_SetBandPath</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">band</var>, text  <var class="pdparam">outdbpath</var>, integer  <var class="pdparam">outdbindex</var>, boolean  <var class="pdparam">force=false</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp74182144"></a><h2>説明</h2><p>データベース外バンドの外部パスと外部バンド番号を更新します。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">force</code>がTRUEの場合には、外部ラスタファイルとPostGISラスタとの互換性 (例：アラインメント、ピクセル対応)確認のためのテストを行いません。このモードは、外部ラスタファイルが存在するファイルシステムの変更を目的としています。 </p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>内部的には、このメソッドは、存在するパス情報を更新する替わりに、PostGISラスタの<code class="varname">band</code>で指定したバンドを新しいバンドに置き換えます。 </p></td></tr></table></div><p>Availability: 2.5.0</p></div><div class="refsection"><a name="idp74185984"></a><h2>例</h2><pre class="programlisting">WITH foo AS (
    SELECT
        ST_AddBand(NULL::raster, '/home/pele/devel/geo/postgis-git/raster/test/regress/loader/Projected.tif', NULL::int[]) AS rast
)
SELECT
    1 AS query,
    *
FROM ST_BandMetadata(
    (SELECT rast FROM foo),
    ARRAY[1,3,2]::int[]
)
UNION ALL
SELECT
    2,
    *
FROM ST_BandMetadata(
    (
        SELECT
            <span class="strong"><strong>ST_SetBandPath(
                rast,
                2,
                '/home/pele/devel/geo/postgis-git/raster/test/regress/loader/Projected2.tif',
                1
            )</strong></span> AS rast
        FROM foo
    ),
    ARRAY[1,3,2]::int[]
)
ORDER BY 1, 2;

 query | bandnum | pixeltype | nodatavalue | isoutdb |                                      path                                       | outdbbandnum
-------+---------+-----------+-------------+---------+---------------------------------------------------------------------------------+--------------
     1 |       1 | 8BUI      |             | t       | /home/pele/devel/geo/postgis-git/raster/test/regress/loader/Projected.tif       |            1
     1 |       2 | 8BUI      |             | t       | /home/pele/devel/geo/postgis-git/raster/test/regress/loader/Projected.tif       |            2
     1 |       3 | 8BUI      |             | t       | /home/pele/devel/geo/postgis-git/raster/test/regress/loader/Projected.tif       |            3
     2 |       1 | 8BUI      |             | t       | /home/pele/devel/geo/postgis-git/raster/test/regress/loader/Projected.tif       |            1
<span class="strong"><strong>     2 |       2 | 8BUI      |             | t       | /home/pele/devel/geo/postgis-git/raster/test/regress/loader/Projected2.tif      |            1</strong></span>
     2 |       3 | 8BUI      |             | t       | /home/pele/devel/geo/postgis-git/raster/test/regress/loader/Projected.tif       |            3
                </pre></div><div class="refsection"><a name="idp74188288"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_BandMetaData" title="ST_BandMetaData">ST_BandMetaData</a>, <a class="xref" href="#RT_ST_SetBandIndex" title="ST_SetBandIndex">ST_SetBandIndex</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_SetBandIndex"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SetBandIndex — データベース外バンドの外部バンド番号の更新</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_SetBandIndex</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">band</var>, integer  <var class="pdparam">outdbindex</var>, boolean  <var class="pdparam">force=false</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp74197760"></a><h2>説明</h2><p>データベース外バンドの外部バンド番号を更新します。データベース外バンドと関連する外部ラスタファイルには触れません。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">force</code>がTRUEの場合には、外部ラスタファイルとPostGISラスタとの互換性 (例：アラインメント、ピクセル対応)確認のためのテストを行いません。このモードは、バンドが外部ラスタファイル内で移動する場所を対象としています。 </p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>内部的には、このメソッドは、存在するパス情報を更新する替わりに、PostGISラスタの<code class="varname">band</code>で指定したバンドを新しいバンドに置き換えます。 </p></td></tr></table></div><p>Availability: 2.5.0</p></div><div class="refsection"><a name="idp74201600"></a><h2>例</h2><pre class="programlisting">WITH foo AS (
    SELECT
        ST_AddBand(NULL::raster, '/home/pele/devel/geo/postgis-git/raster/test/regress/loader/Projected.tif', NULL::int[]) AS rast
)
SELECT
    1 AS query,
    *
FROM ST_BandMetadata(
    (SELECT rast FROM foo),
    ARRAY[1,3,2]::int[]
)
UNION ALL
SELECT
    2,
    *
FROM ST_BandMetadata(
    (
        SELECT
            <span class="strong"><strong>ST_SetBandIndex(
                rast,
                2,
                1
            )</strong></span> AS rast
        FROM foo
    ),
    ARRAY[1,3,2]::int[]
)
ORDER BY 1, 2;

 query | bandnum | pixeltype | nodatavalue | isoutdb |                                      path                                       | outdbbandnum
-------+---------+-----------+-------------+---------+---------------------------------------------------------------------------------+--------------
     1 |       1 | 8BUI      |             | t       | /home/pele/devel/geo/postgis-git/raster/test/regress/loader/Projected.tif       |            1
     1 |       2 | 8BUI      |             | t       | /home/pele/devel/geo/postgis-git/raster/test/regress/loader/Projected.tif       |            2
     1 |       3 | 8BUI      |             | t       | /home/pele/devel/geo/postgis-git/raster/test/regress/loader/Projected.tif       |            3
     2 |       1 | 8BUI      |             | t       | /home/pele/devel/geo/postgis-git/raster/test/regress/loader/Projected.tif       |            1
<span class="strong"><strong>     2 |       2 | 8BUI      |             | t       | /home/pele/devel/geo/postgis-git/raster/test/regress/loader/Projected.tif       |            1</strong></span>
     2 |       3 | 8BUI      |             | t       | /home/pele/devel/geo/postgis-git/raster/test/regress/loader/Projected.tif       |            3
                </pre></div><div class="refsection"><a name="idp74203904"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_BandMetaData" title="ST_BandMetaData">ST_BandMetaData</a>, <a class="xref" href="#RT_ST_SetBandPath" title="ST_SetBandPath">ST_SetBandPath</a> </p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="RasterBand_Stats"></a>12.9. ラスタバンド統計情報と解析</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#RT_ST_Count">ST_Count</a></span><span class="refpurpose"> — ラスタまたはラスタカバレッジの指定したバンドのピクセル数を返します。バンドを指定しない場合には、1番と仮定します。exclude_nodata_valueをTRUEに設定している場合には、NODATA値と等しくないピクセルのみを数えます。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_CountAgg">ST_CountAgg</a></span><span class="refpurpose"> — 集約関数です。ラスタ集合の与えられたバンドのピクセル数を返します。バンドが指定されていない場合には、1番と仮定します。exclude_nodata_valueをTRUEに設定している場合には、NODATA値と等しくないピクセルのみを数えます。 </span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Histogram">ST_Histogram</a></span><span class="refpurpose"> — ラスタまたはラスタカバレッジのビン範囲で分割したデータ分布をまとめるヒストグラムの集合を返します。ビン数を指定しない場合には自動計算されます。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Quantile">ST_Quantile</a></span><span class="refpurpose"> — ラスタまたはラスタテーブルカバレッジのサンプルまたは母集団の分位数を計算します。値がラスタの25%,50%,75%にあるかを調べることができます。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_SummaryStats">ST_SummaryStats</a></span><span class="refpurpose"> — ラスタまたはラスタカバレッジの指定したバンドについて、ピクセル数、合計値、平均値、標準偏差、最小値、最大値からなる統計情報の概要を返します。バンドを指定しない場合には、1番と仮定します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_SummaryStatsAgg">ST_SummaryStatsAgg</a></span><span class="refpurpose"> — 集約関数です。ラスタ集合の指定したバンドについて、ピクセル数、合計値、平均値、標準偏差、最小値、最大値からなる統計情報の概要を返します。バンドを指定しない場合には、1番と仮定します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_ValueCount">ST_ValueCount</a></span><span class="refpurpose"> — ラスタ　(またはラスタカバレッジ)の指定されたバンドで、指定した値を持つピクセルを対象として、ピクセルバンド値とピクセル数からなるレコードの集合を返します。バンドを指定しない場合には、1番と仮定します。デフォルトではNODATA値のピクセルは数えられず、ピクセルの他の値は出力され、ピクセルバンド値は最も近い整数に丸められます。</span></dt></dl></div><div class="refentry"><a name="RT_ST_Count"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Count — ラスタまたはラスタカバレッジの指定したバンドのピクセル数を返します。バンドを指定しない場合には、1番と仮定します。exclude_nodata_valueをTRUEに設定している場合には、NODATA値と等しくないピクセルのみを数えます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">bigint <b class="fsfunc">ST_Count</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband=1</var>, boolean  <var class="pdparam">exclude_nodata_value=true</var><code>)</code>;</p><p><code class="funcdef">bigint <b class="fsfunc">ST_Count</b>(</code>raster  <var class="pdparam">rast</var>, boolean  <var class="pdparam">exclude_nodata_value</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp74216576"></a><h2>説明</h2><p>ラスタまたはラスタカバレッジの指定したバンドのピクセル数を返します。<code class="varname">nband</code>でバンドを指定しない場合には、1番と仮定します。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">exclude_nodata_value</code>をTRUEに設定している場合には、<code class="varname">nodata</code>値と等しくないピクセルのみ数えます。<code class="varname">exclude_nodata_value</code>をFALSEに設定している場合には、全てのピクセルを数えます。</p></td></tr></table></div><p>Changed: 3.1.0 - ST_Count(rastertable, rastercolumn, ...) の形式は削除されました。代わりに<a class="xref" href="#RT_ST_CountAgg" title="ST_CountAgg">ST_CountAgg</a>を使用します。</p><p>Availability: 2.0.0 </p></div><div class="refsection"><a name="idp74220800"></a><h2>例</h2><pre class="programlisting">-- 249でないピクセルの数え上げと、全てのピクセルの数え上げを行います --
SELECT rid, ST_Count(ST_SetBandNoDataValue(rast,249)) As exclude_nodata,
        ST_Count(ST_SetBandNoDataValue(rast,249),false) As include_nodata
    FROM dummy_rast WHERE rid=2;

rid | exclude_nodata | include_nodata
-----+----------------+----------------
   2 |             23 |             25
                </pre></div><div class="refsection"><a name="idp74222336"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_CountAgg" title="ST_CountAgg">ST_CountAgg</a>, <a class="xref" href="#RT_ST_SummaryStats" title="ST_SummaryStats">ST_SummaryStats</a>, <a class="xref" href="#RT_ST_SetBandNoDataValue" title="ST_SetBandNoDataValue">ST_SetBandNoDataValue</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_CountAgg"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_CountAgg — 集約関数です。ラスタ集合の与えられたバンドのピクセル数を返します。バンドが指定されていない場合には、1番と仮定します。exclude_nodata_valueをTRUEに設定している場合には、NODATA値と等しくないピクセルのみを数えます。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">bigint <b class="fsfunc">ST_CountAgg</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, boolean  <var class="pdparam">exclude_nodata_value</var>, double precision  <var class="pdparam">sample_percent</var><code>)</code>;</p><p><code class="funcdef">bigint <b class="fsfunc">ST_CountAgg</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, boolean  <var class="pdparam">exclude_nodata_value</var><code>)</code>;</p><p><code class="funcdef">bigint <b class="fsfunc">ST_CountAgg</b>(</code>raster  <var class="pdparam">rast</var>, boolean  <var class="pdparam">exclude_nodata_value</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp74239488"></a><h2>説明</h2><p>ラスタ集合の与えられたバンドのピクセル数を返します。<code class="varname">nband</code>でバンドを指定しない場合には、1番と仮定します。</p><p><code class="varname">exclude_nodata_value</code>をTRUEに設定している場合には、<code class="varname">NODATA</code>値と等しくないピクセルのみを数えます。<code class="varname">exclude_nodata_value</code>をFALSEに設定している場合には、全てのピクセルを数えます。 </p><p>デフォルトでは、全てのピクセルを見ます。より早い応答を得るには、<code class="varname">sample_percent</code>値を0から1の間で設定します。</p><p>Availability: 2.2.0 </p></div><div class="refsection"><a name="idp74243584"></a><h2>例</h2><pre class="programlisting">WITH foo AS (
    SELECT
        rast.rast
    FROM (
        SELECT ST_SetValue(
            ST_SetValue(
                ST_SetValue(
                    ST_AddBand(
                        ST_MakeEmptyRaster(10, 10, 10, 10, 2, 2, 0, 0,0)
                        , 1, '64BF', 0, 0
                    )
                    , 1, 1, 1, -10
                )
                , 1, 5, 4, 0
            )
            , 1, 5, 5, 3.14159
        ) AS rast
    ) AS rast
    FULL JOIN (
        SELECT generate_series(1, 10) AS id
    ) AS id
        ON 1 = 1
)
SELECT
    ST_CountAgg(rast, 1, TRUE)
FROM foo;

 st_countagg
-------------
          20
(1 row)
                </pre></div><div class="refsection"><a name="idp74244864"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Count" title="ST_Count">ST_Count</a>, <a class="xref" href="#RT_ST_SummaryStats" title="ST_SummaryStats">ST_SummaryStats</a>, <a class="xref" href="#RT_ST_SetBandNoDataValue" title="ST_SetBandNoDataValue">ST_SetBandNoDataValue</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Histogram"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Histogram — ラスタまたはラスタカバレッジのビン範囲で分割したデータ分布をまとめるヒストグラムの集合を返します。ビン数を指定しない場合には自動計算されます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">SETOF record <b class="fsfunc">ST_Histogram</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband=1</var>, boolean  <var class="pdparam">exclude_nodata_value=true</var>, integer  <var class="pdparam">bins=autocomputed</var>, double precision[]  <var class="pdparam">width=NULL</var>, boolean  <var class="pdparam">right=false</var><code>)</code>;</p><p><code class="funcdef">SETOF record <b class="fsfunc">ST_Histogram</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, integer  <var class="pdparam">bins</var>, double precision[]  <var class="pdparam">width=NULL</var>, boolean  <var class="pdparam">right=false</var><code>)</code>;</p><p><code class="funcdef">SETOF record <b class="fsfunc">ST_Histogram</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, boolean  <var class="pdparam">exclude_nodata_value</var>, integer  <var class="pdparam">bins</var>, boolean  <var class="pdparam">right</var><code>)</code>;</p><p><code class="funcdef">SETOF record <b class="fsfunc">ST_Histogram</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, integer  <var class="pdparam">bins</var>, boolean  <var class="pdparam">right</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp74291712"></a><h2>説明</h2><p>最小値、最大値、合計数、全体から見た割合からなるレコードの集合を返します。<code class="varname">nband</code>でバンドを指定しない場合には、1番と仮定します。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>デフォルトでは、<code class="varname">nodata</code>と同じピクセル値は考慮に入れません。<code class="varname">exclude_nodata_value</code>をFALSEに設定すると全てのピクセルを数えます。</p></td></tr></table></div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><em class="parameter"><code>width </code></em><span class="type">double precision[]</span></span></dt><dd><p>カテゴリ/ビン毎の幅を示す配列です。ビン数の指定がwidth要素数を超える場合には、widthを繰り返します。 </p><p>例: ビン9個、widthが[a, b, c]では、[a, b, c, a, b, c, a, b, c]が出力されます。</p></dd><dt><span class="term"><em class="parameter"><code>bins </code></em><span class="type">integer</span></span></dt><dd><p>取り出し数 -- 関数から戻そうとするレコード数です。指定しない場合には、自動計算されます。</p></dd><dt><span class="term"><em class="parameter"><code>right </code></em><span class="type">boolean</span></span></dt><dd><p>ヒストグラムを右から計算します (デフォルトは左からです)。値の評価の優先順位が、X軸について[a, b)から(a, b]に変わります。</p></dd></dl></div><p>Changed: 3.1.0 ST_Histogram(table_name, column_name) の形式は削除されました。 </p><p>Availability: 2.0.0 </p></div><div class="refsection"><a name="idp74301440"></a><h2>例: 単一ラスタタイル - ビン数を自動計算とした、1番、2番、3番バンドのヒストグラムの計算</h2><pre class="programlisting">SELECT band, (stats).*
FROM (SELECT rid, band, ST_Histogram(rast, band) As stats
    FROM dummy_rast CROSS JOIN generate_series(1,3) As band
     WHERE rid=2) As foo;

 band |  min  |  max  | count | percent
------+-------+-------+-------+---------
    1 |   249 |   250 |     2 |    0.08
    1 |   250 |   251 |     2 |    0.08
    1 |   251 |   252 |     1 |    0.04
    1 |   252 |   253 |     2 |    0.08
    1 |   253 |   254 |    18 |    0.72
    2 |    78 | 113.2 |    11 |    0.44
    2 | 113.2 | 148.4 |     4 |    0.16
    2 | 148.4 | 183.6 |     4 |    0.16
    2 | 183.6 | 218.8 |     1 |    0.04
    2 | 218.8 |   254 |     5 |     0.2
    3 |    62 | 100.4 |    11 |    0.44
    3 | 100.4 | 138.8 |     5 |     0.2
    3 | 138.8 | 177.2 |     4 |    0.16
    3 | 177.2 | 215.6 |     1 |    0.04
    3 | 215.6 |   254 |     4 |    0.16</pre></div><div class="refsection"><a name="idp74302848"></a><h2>例: ビン数を6で固定して2番バンドだけを計算</h2><pre class="programlisting">SELECT (stats).*
FROM (SELECT rid, ST_Histogram(rast, 2,6) As stats
    FROM dummy_rast
     WHERE rid=2) As foo;

    min     |    max     | count | percent
------------+------------+-------+---------
         78 | 107.333333 |     9 |    0.36
 107.333333 | 136.666667 |     6 |    0.24
 136.666667 |        166 |     0 |       0
        166 | 195.333333 |     4 |    0.16
 195.333333 | 224.666667 |     1 |    0.04
 224.666667 |        254 |     5 |     0.2
(6 rows)

-- 前と同じですが、ビン毎のピクセル値の範囲を明示的に制御しています
SELECT (stats).*
FROM (SELECT rid, ST_Histogram(rast, 2,6,ARRAY[0.5,1,4,100,5]) As stats
    FROM dummy_rast
     WHERE rid=2) As foo;

  min  |  max  | count | percent
-------+-------+-------+----------
    78 |  78.5 |     1 |     0.08
  78.5 |  79.5 |     1 |     0.04
  79.5 |  83.5 |     0 |        0
  83.5 | 183.5 |    17 |   0.0068
 183.5 | 188.5 |     0 |        0
 188.5 |   254 |     6 | 0.003664
(6 rows)</pre></div><div class="refsection"><a name="idp74304128"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Count" title="ST_Count">ST_Count</a>, <a class="xref" href="#RT_ST_SummaryStats" title="ST_SummaryStats">ST_SummaryStats</a>, <a class="xref" href="#RT_ST_SummaryStatsAgg" title="ST_SummaryStatsAgg">ST_SummaryStatsAgg</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Quantile"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Quantile — ラスタまたはラスタテーブルカバレッジのサンプルまたは母集団の分位数を計算します。値がラスタの25%,50%,75%にあるかを調べることができます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">SETOF record <b class="fsfunc">ST_Quantile</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband=1</var>, boolean  <var class="pdparam">exclude_nodata_value=true</var>, double precision[]  <var class="pdparam">quantiles=NULL</var><code>)</code>;</p><p><code class="funcdef">SETOF record <b class="fsfunc">ST_Quantile</b>(</code>raster  <var class="pdparam">rast</var>, double precision[]  <var class="pdparam">quantiles</var><code>)</code>;</p><p><code class="funcdef">SETOF record <b class="fsfunc">ST_Quantile</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, double precision[]  <var class="pdparam">quantiles</var><code>)</code>;</p><p><code class="funcdef">double precision <b class="fsfunc">ST_Quantile</b>(</code>raster  <var class="pdparam">rast</var>, double precision  <var class="pdparam">quantile</var><code>)</code>;</p><p><code class="funcdef">double precision <b class="fsfunc">ST_Quantile</b>(</code>raster  <var class="pdparam">rast</var>, boolean  <var class="pdparam">exclude_nodata_value</var>, double precision  <var class="pdparam">quantile=NULL</var><code>)</code>;</p><p><code class="funcdef">double precision <b class="fsfunc">ST_Quantile</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, double precision  <var class="pdparam">quantile</var><code>)</code>;</p><p><code class="funcdef">double precision <b class="fsfunc">ST_Quantile</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, boolean  <var class="pdparam">exclude_nodata_value</var>, double precision  <var class="pdparam">quantile</var><code>)</code>;</p><p><code class="funcdef">double precision <b class="fsfunc">ST_Quantile</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, double precision  <var class="pdparam">quantile</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp74379776"></a><h2>説明</h2><p>ラスタまたはラスタテーブルカバレッジのサンプルまたは母集団の分位数を計算します。値がラスタの25%,50%,75%にあるかを調べることができます。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">exclude_nodata_value</code>をFALSEに設定している場合には、NODATA値となるピクセルも数えます。</p></td></tr></table></div><p>Changed: 3.1.0 ST_Quantile(table_name, column_name) の形式は削除されました。 </p><p>Availability: 2.0.0 </p></div><div class="refsection"><a name="idp74382464"></a><h2>例</h2><pre class="programlisting">UPDATE dummy_rast SET rast = ST_SetBandNoDataValue(rast,249) WHERE rid=2;
-- 1番バンドの値が249でないピクセルのみ考慮に入れた分位数を計算する例です

SELECT (pvq).*
FROM (SELECT ST_Quantile(rast, ARRAY[0.25,0.75]) As pvq
    FROM dummy_rast WHERE rid=2) As foo
    ORDER BY (pvq).quantile;

 quantile | value
----------+-------
     0.25 |   253
     0.75 |   254

SELECT ST_Quantile(rast, 0.75) As value
    FROM dummy_rast WHERE rid=2;

value
------
  254
</pre><pre class="programlisting">-- 実際の例です。2番バンドでジオメトリとインタセクトする部分の
-- 全てのピクセルの分位数を計算します。
SELECT rid, (ST_Quantile(rast,2)).* As pvc
    FROM o_4_boston
        WHERE ST_Intersects(rast,
            ST_GeomFromText('POLYGON((224486 892151,224486 892200,224706 892200,224706 892151,224486 892151))',26986)
            )
ORDER BY value, quantile,rid
;


 rid | quantile | value
-----+----------+-------
   1 |        0 |     0
   2 |        0 |     0
  14 |        0 |     1
  15 |        0 |     2
  14 |     0.25 |    37
   1 |     0.25 |    42
  15 |     0.25 |    47
   2 |     0.25 |    50
  14 |      0.5 |    56
   1 |      0.5 |    64
  15 |      0.5 |    66
   2 |      0.5 |    77
  14 |     0.75 |    81
  15 |     0.75 |    87
   1 |     0.75 |    94
   2 |     0.75 |   106
  14 |        1 |   199
   1 |        1 |   244
   2 |        1 |   255
  15 |        1 |   255
</pre></div><div class="refsection"><a name="idp74384256"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Count" title="ST_Count">ST_Count</a>, <a class="xref" href="#RT_ST_SummaryStats" title="ST_SummaryStats">ST_SummaryStats</a>, <a class="xref" href="#RT_ST_SummaryStatsAgg" title="ST_SummaryStatsAgg">ST_SummaryStatsAgg</a>, <a class="xref" href="#RT_ST_SetBandNoDataValue" title="ST_SetBandNoDataValue">ST_SetBandNoDataValue</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_SummaryStats"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SummaryStats — ラスタまたはラスタカバレッジの指定したバンドについて、ピクセル数、合計値、平均値、標準偏差、最小値、最大値からなる統計情報の概要を返します。バンドを指定しない場合には、1番と仮定します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">summarystats <b class="fsfunc">ST_SummaryStats</b>(</code>raster  <var class="pdparam">rast</var>, boolean  <var class="pdparam">exclude_nodata_value</var><code>)</code>;</p><p><code class="funcdef">summarystats <b class="fsfunc">ST_SummaryStats</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, boolean  <var class="pdparam">exclude_nodata_value</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp74396544"></a><h2>説明</h2><p>ラスタまたはラスタカバレッジの指定したバンドについて、ピクセル数、合計値、平均値、標準偏差、最小値、最大値からなる<a class="xref" href="#summarystats" title="summarystats">summarystats</a>による統計情報の概要を返します。<code class="varname">nband</code>でバンドを指定しない場合には、1番と仮定します。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>デフォルトでは、<code class="varname">nodata</code>と同じピクセル値は考慮に入れません。<code class="varname">exclude_nodata_value</code>をFALSEに設定すると全てのピクセルを数えます。</p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>デフォルトでは、全てのピクセルを見ます。より早い応答を得るには、<code class="varname">sample_percent</code>値を1未満で設定します。</p></td></tr></table></div><p>Changed: 3.1.0 ST_SummaryStats(rastertable, rastercolumn, ...) の形式は削除されました。代わりに<a class="xref" href="#RT_ST_SummaryStatsAgg" title="ST_SummaryStatsAgg">ST_SummaryStatsAgg</a>を使用します。 </p><p>Availability: 2.0.0 </p></div><div class="refsection"><a name="idp74401792"></a><h2>例: 単一ラスタタイル</h2><pre class="programlisting">SELECT rid, band, (stats).*
FROM (SELECT rid, band, ST_SummaryStats(rast, band) As stats
    FROM dummy_rast CROSS JOIN generate_series(1,3) As band
     WHERE rid=2) As foo;

 rid | band | count | sum  |    mean    |  stddev   | min | max
-----+------+-------+------+------------+-----------+-----+-----
   2 |    1 |    23 | 5821 | 253.086957 |  1.248061 | 250 | 254
   2 |    2 |    25 | 3682 |     147.28 | 59.862188 |  78 | 254
   2 |    3 |    25 | 3290 |      131.6 | 61.647384 |  62 | 254
                </pre></div><div class="refsection"><a name="idp74403072"></a><h2>例: 対象とする建物とインタセクトするピクセルの概要</h2><p>この例は、ボストンの建物の全て (約102,000件)と空中写真タイル (150x150ピクセルで約134,000タイル)とで、Windows 64ビット上のPostGISで計算したところ、574ミリ秒かかりました。</p><pre class="programlisting">WITH
-- 対象地物
   feat AS (SELECT gid As building_id, geom_26986 As geom FROM buildings AS b
    WHERE gid IN(100, 103,150)
   ),
-- ラスタタイルの2番バンドを建物の境界で切り取って
-- その範囲の統計情報を得ます
   b_stats AS
    (SELECT  building_id, (stats).*
FROM (SELECT building_id, ST_SummaryStats(ST_Clip(rast,2,geom)) As stats
    FROM aerials.boston
        INNER JOIN feat
    ON ST_Intersects(feat.geom,rast)
 ) As foo
 )
-- 最後に統計情報の概要を得ます
SELECT building_id, SUM(count) As num_pixels
  , MIN(min) As min_pval
  ,  MAX(max) As max_pval
  , SUM(mean*count)/SUM(count) As avg_pval
    FROM b_stats
 WHERE count 
&gt; 0
    GROUP BY building_id
    ORDER BY building_id;
 building_id | num_pixels | min_pval | max_pval |     avg_pval
-------------+------------+----------+----------+------------------
         100 |       1090 |        1 |      255 | 61.0697247706422
         103 |        655 |        7 |      182 | 70.5038167938931
         150 |        895 |        2 |      252 | 185.642458100559</pre></div><div class="refsection"><a name="idp74404736"></a><h2>例:ラスタカバレッジ</h2><pre class="programlisting">-- バンドごとの統計情報 --
SELECT band, (stats).*
FROM (SELECT band, ST_SummaryStats('o_4_boston','rast', band) As stats
    FROM generate_series(1,3) As band) As foo;

 band |  count  |  sum   |       mean       |      stddev      | min | max
------+---------+--------+------------------+------------------+-----+-----
    1 | 8450000 | 725799 | 82.7064349112426 | 45.6800222638537 |   0 | 255
    2 | 8450000 | 700487 | 81.4197705325444 | 44.2161184161765 |   0 | 255
    3 | 8450000 | 575943 |  74.682739408284 | 44.2143885481407 |   0 | 255

-- テーブルの場合 -- サンプリング率を100%より低くすると早くなります
-- 25%に設定して、速く答を得ています
SELECT band, (stats).*
FROM (SELECT band, ST_SummaryStats('o_4_boston','rast', band,true,0.25) As stats
    FROM generate_series(1,3) As band) As foo;

 band |  count  |  sum   |       mean       |      stddev      | min | max
------+---------+--------+------------------+------------------+-----+-----
    1 | 2112500 | 180686 | 82.6890480473373 | 45.6961043857248 |   0 | 255
    2 | 2112500 | 174571 |  81.448503668639 | 44.2252623171821 |   0 | 255
    3 | 2112500 | 144364 | 74.6765884023669 | 44.2014869384578 |   0 | 255
                </pre></div><div class="refsection"><a name="idp74406016"></a><h2>関連情報</h2><p><a class="xref" href="#summarystats" title="summarystats">summarystats</a>, <a class="xref" href="#RT_ST_SummaryStatsAgg" title="ST_SummaryStatsAgg">ST_SummaryStatsAgg</a>, <a class="xref" href="#RT_ST_Count" title="ST_Count">ST_Count</a>, <a class="xref" href="#RT_ST_Clip" title="ST_Clip">ST_Clip</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_SummaryStatsAgg"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SummaryStatsAgg — 集約関数です。ラスタ集合の指定したバンドについて、ピクセル数、合計値、平均値、標準偏差、最小値、最大値からなる統計情報の概要を返します。バンドを指定しない場合には、1番と仮定します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">summarystats <b class="fsfunc">ST_SummaryStatsAgg</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, boolean  <var class="pdparam">exclude_nodata_value</var>, double precision  <var class="pdparam">sample_percent</var><code>)</code>;</p><p><code class="funcdef">summarystats <b class="fsfunc">ST_SummaryStatsAgg</b>(</code>raster  <var class="pdparam">rast</var>, boolean  <var class="pdparam">exclude_nodata_value</var>, double precision  <var class="pdparam">sample_percent</var><code>)</code>;</p><p><code class="funcdef">summarystats <b class="fsfunc">ST_SummaryStatsAgg</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, boolean  <var class="pdparam">exclude_nodata_value</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp74424576"></a><h2>説明</h2><p>ラスタまたはラスタカバレッジの指定したバンドについて、ピクセル数、合計値、平均値、標準偏差、最小値、最大値からなる<a class="xref" href="#summarystats" title="summarystats">summarystats</a>による統計情報の概要を返します。<code class="varname">nband</code>でバンドを指定しない場合には、1番と仮定します。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>デフォルトでは、<code class="varname">NODATA</code>と同じピクセル値は考慮に入れません。<code class="varname">exclude_nodata_value</code>をFALSEに設定すると全てのピクセルを数えます。</p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>デフォルトでは全てのピクセルを見ます。よりい早い応答を得るには、<code class="varname">sample_percent</code>を0から1の間で設定します。</p></td></tr></table></div><p>Availability: 2.2.0 </p></div><div class="refsection"><a name="idp74429056"></a><h2>例</h2><pre class="programlisting">WITH foo AS (
    SELECT
        rast.rast
    FROM (
        SELECT ST_SetValue(
            ST_SetValue(
                ST_SetValue(
                    ST_AddBand(
                        ST_MakeEmptyRaster(10, 10, 10, 10, 2, 2, 0, 0,0)
                        , 1, '64BF', 0, 0
                    )
                    , 1, 1, 1, -10
                )
                , 1, 5, 4, 0
            )
            , 1, 5, 5, 3.14159
        ) AS rast
    ) AS rast
    FULL JOIN (
        SELECT generate_series(1, 10) AS id
    ) AS id
        ON 1 = 1
)
SELECT
    (stats).count,
    round((stats).sum::numeric, 3),
    round((stats).mean::numeric, 3),
    round((stats).stddev::numeric, 3),
    round((stats).min::numeric, 3),
    round((stats).max::numeric, 3)
FROM (
    SELECT
        ST_SummaryStatsAgg(rast, 1, TRUE, 1) AS stats
    FROM foo
) bar;

 count |  round  | round  | round |  round  | round
-------+---------+--------+-------+---------+-------
    20 | -68.584 | -3.429 | 6.571 | -10.000 | 3.142
(1 row)
                </pre></div><div class="refsection"><a name="idp74430336"></a><h2>関連情報</h2><p><a class="xref" href="#summarystats" title="summarystats">summarystats</a>, <a class="xref" href="#RT_ST_SummaryStats" title="ST_SummaryStats">ST_SummaryStats</a>, <a class="xref" href="#RT_ST_Count" title="ST_Count">ST_Count</a>, <a class="xref" href="#RT_ST_Clip" title="ST_Clip">ST_Clip</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_ValueCount"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ValueCount — ラスタ　(またはラスタカバレッジ)の指定されたバンドで、指定した値を持つピクセルを対象として、ピクセルバンド値とピクセル数からなるレコードの集合を返します。バンドを指定しない場合には、1番と仮定します。デフォルトではNODATA値のピクセルは数えられず、ピクセルの他の値は出力され、ピクセルバンド値は最も近い整数に丸められます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">SETOF record <b class="fsfunc">ST_ValueCount</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband=1</var>, boolean  <var class="pdparam">exclude_nodata_value=true</var>, double precision[]  <var class="pdparam">searchvalues=NULL</var>, double precision  <var class="pdparam">roundto=0</var>, double precision  <var class="pdparam">OUT value</var>, integer  <var class="pdparam">OUT count</var><code>)</code>;</p><p><code class="funcdef">SETOF record <b class="fsfunc">ST_ValueCount</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, double precision[]  <var class="pdparam">searchvalues</var>, double precision  <var class="pdparam">roundto=0</var>, double precision  <var class="pdparam">OUT value</var>, integer  <var class="pdparam">OUT count</var><code>)</code>;</p><p><code class="funcdef">SETOF record <b class="fsfunc">ST_ValueCount</b>(</code>raster  <var class="pdparam">rast</var>, double precision[]  <var class="pdparam">searchvalues</var>, double precision  <var class="pdparam">roundto=0</var>, double precision  <var class="pdparam">OUT value</var>, integer  <var class="pdparam">OUT count</var><code>)</code>;</p><p><code class="funcdef">bigint <b class="fsfunc">ST_ValueCount</b>(</code>raster  <var class="pdparam">rast</var>, double precision  <var class="pdparam">searchvalue</var>, double precision  <var class="pdparam">roundto=0</var><code>)</code>;</p><p><code class="funcdef">bigint <b class="fsfunc">ST_ValueCount</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, boolean  <var class="pdparam">exclude_nodata_value</var>, double precision  <var class="pdparam">searchvalue</var>, double precision  <var class="pdparam">roundto=0</var><code>)</code>;</p><p><code class="funcdef">bigint <b class="fsfunc">ST_ValueCount</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, double precision  <var class="pdparam">searchvalue</var>, double precision  <var class="pdparam">roundto=0</var><code>)</code>;</p><p><code class="funcdef">SETOF record <b class="fsfunc">ST_ValueCount</b>(</code>text  <var class="pdparam">rastertable</var>, text  <var class="pdparam">rastercolumn</var>, integer  <var class="pdparam">nband=1</var>, boolean  <var class="pdparam">exclude_nodata_value=true</var>, double precision[]  <var class="pdparam">searchvalues=NULL</var>, double precision  <var class="pdparam">roundto=0</var>, double precision  <var class="pdparam">OUT value</var>, integer  <var class="pdparam">OUT count</var><code>)</code>;</p><p><code class="funcdef">SETOF record <b class="fsfunc">ST_ValueCount</b>(</code>text  <var class="pdparam">rastertable</var>, text  <var class="pdparam">rastercolumn</var>, double precision[]  <var class="pdparam">searchvalues</var>, double precision  <var class="pdparam">roundto=0</var>, double precision  <var class="pdparam">OUT value</var>, integer  <var class="pdparam">OUT count</var><code>)</code>;</p><p><code class="funcdef">SETOF record <b class="fsfunc">ST_ValueCount</b>(</code>text  <var class="pdparam">rastertable</var>, text  <var class="pdparam">rastercolumn</var>, integer  <var class="pdparam">nband</var>, double precision[]  <var class="pdparam">searchvalues</var>, double precision  <var class="pdparam">roundto=0</var>, double precision  <var class="pdparam">OUT value</var>, integer  <var class="pdparam">OUT count</var><code>)</code>;</p><p><code class="funcdef">bigint<b class="fsfunc">ST_ValueCount</b>(</code>text  <var class="pdparam">rastertable</var>, text  <var class="pdparam">rastercolumn</var>, integer  <var class="pdparam">nband</var>, boolean  <var class="pdparam">exclude_nodata_value</var>, double precision  <var class="pdparam">searchvalue</var>, double precision  <var class="pdparam">roundto=0</var><code>)</code>;</p><p><code class="funcdef">bigint <b class="fsfunc">ST_ValueCount</b>(</code>text  <var class="pdparam">rastertable</var>, text  <var class="pdparam">rastercolumn</var>, double precision  <var class="pdparam">searchvalue</var>, double precision  <var class="pdparam">roundto=0</var><code>)</code>;</p><p><code class="funcdef">bigint <b class="fsfunc">ST_ValueCount</b>(</code>text  <var class="pdparam">rastertable</var>, text  <var class="pdparam">rastercolumn</var>, integer  <var class="pdparam">nband</var>, double precision  <var class="pdparam">searchvalue</var>, double precision  <var class="pdparam">roundto=0</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp74531200"></a><h2>説明</h2><p>ラスタタイルまたはラスタカバレッジの指定したバンドにおけるピクセルバンド値とピクセル数にあたる、<code class="varname">value</code>と<code class="varname">count</code>からなるレコードの集合を返します。 </p><p><code class="varname">nband</code>でバンドを指定しない場合には、1番と仮定します。<code class="varname">searchvalues</code>が指定されていない場合には、ラスタまたはラスタカバレッジで発見した全てのピクセル値が返ります。searchvalueを一つ指定した場合には、指定したピクセルバンド値を持つピクセルの数を示すレコードでなく、整数を返します。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">exclude_nodata_value</code>をFALSEに設定している場合には、NODATA値となるピクセルも数えます。</p></td></tr></table></div><p>Availability: 2.0.0 </p></div><div class="refsection"><a name="idp74535296"></a><h2>例</h2><pre class="programlisting">UPDATE dummy_rast SET rast = ST_SetBandNoDataValue(rast,249) WHERE rid=2;
-- この例では、1番バンドの、値が249でないピクセルに限って数えます

SELECT (pvc).*
FROM (SELECT ST_ValueCount(rast) As pvc
    FROM dummy_rast WHERE rid=2) As foo
    ORDER BY (pvc).value;

 value | count
-------+-------
   250 |     2
   251 |     1
   252 |     2
   253 |     6
   254 |    12

-- この例では、1番バンドの、249を含む全てのピクセルを数えます
SELECT (pvc).*
FROM (SELECT ST_ValueCount(rast,1,false) As pvc
    FROM dummy_rast WHERE rid=2) As foo
    ORDER BY (pvc).value;

 value | count
-------+-------
   249 |     2
   250 |     2
   251 |     1
   252 |     2
   253 |     6
   254 |    12

-- この例では、2番バンドの、NODATA値でない値を持つピクセルに限って数えます
SELECT (pvc).*
FROM (SELECT ST_ValueCount(rast,2) As pvc
    FROM dummy_rast WHERE rid=2) As foo
    ORDER BY (pvc).value;
 value | count
-------+-------
    78 |     1
    79 |     1
    88 |     1
    89 |     1
    96 |     1
    97 |     1
    98 |     1
    99 |     2
   112 |     2
:

                </pre><pre class="programlisting">-- 現実の例です。空中写真ラスタタイルの2番バンドで、
-- ジオメトリとインタセクトするピクセル数を数え、
-- 500を超えるピクセル数があるピクセルバンド値のみ返します。
SELECT (pvc).value, SUM((pvc).count) As total
FROM (SELECT ST_ValueCount(rast,2) As pvc
    FROM o_4_boston
        WHERE ST_Intersects(rast,
            ST_GeomFromText('POLYGON((224486 892151,224486 892200,224706 892200,224706 892151,224486 892151))',26986)
             )
        ) As foo
    GROUP BY (pvc).value
    HAVING SUM((pvc).count) 
&gt; 500
    ORDER BY (pvc).value;

 value | total
-------+-----
    51 | 502
    54 | 521
</pre><pre class="programlisting">-- 指定したジオメトリとインタセクトするタイルの
-- 値が100のピクセルをラスタタイルごとに数えて返します
SELECT rid, ST_ValueCount(rast,2,100) As count
    FROM o_4_boston
        WHERE ST_Intersects(rast,
            ST_GeomFromText('POLYGON((224486 892151,224486 892200,224706 892200,224706 892151,224486 892151))',26986)
             ) ;

 rid | count
-----+-------
   1 |    56
   2 |    95
  14 |    37
  15 |    64
</pre></div><div class="refsection"><a name="idp74537600"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Count" title="ST_Count">ST_Count</a>, <a class="xref" href="#RT_ST_SetBandNoDataValue" title="ST_SetBandNoDataValue">ST_SetBandNoDataValue</a></p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Raster_Inputs"></a>12.10. ラスタ入力</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#RT_ST_RastFromWKB">ST_RastFromWKB</a></span><span class="refpurpose"> — Well-Known Binary (WKB)ラスタからラスタ値を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_RastFromHexWKB">ST_RastFromHexWKB</a></span><span class="refpurpose"> — Well-Knownバイナリ (WKB)ラスタの16進数表現からラスタを返します。</span></dt></dl></div><div class="refentry"><a name="RT_ST_RastFromWKB"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_RastFromWKB — Well-Known Binary (WKB)ラスタからラスタ値を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_RastFromWKB</b>(</code>bytea  <var class="pdparam">wkb</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp74544640"></a><h2>説明</h2><p>Well-Known Binary (WKB)ラスタが与えられると、ラスタを返します。 </p><p>Availability: 2.5.0</p></div><div class="refsection"><a name="idp74546176"></a><h2>例</h2><pre class="programlisting">SELECT (ST_Metadata(
    ST_RastFromWKB(
        '\001\000\000\000\000\000\000\000\000\000\000\000@\000\000\000\000\000\000\010@\000\000\000\000\000\000\340?\000\000\000\000\000\000\340?\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\012\000\000\000\012\000\024\000'::bytea
    )
)).* AS metadata;

 upperleftx | upperlefty | width | height | scalex | scaley | skewx | skewy | srid | numbands
------------+------------+-------+--------+--------+--------+-------+-------+------+----------
        0.5 |        0.5 |    10 |     20 |      2 |      3 |     0 |     0 |   10 |        0
                </pre></div><div class="refsection"><a name="idp74547456"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_MetaData" title="ST_MetaData">ST_MetaData</a>, <a class="xref" href="#RT_ST_RastFromHexWKB" title="ST_RastFromHexWKB">ST_RastFromHexWKB</a>, <a class="xref" href="#RT_ST_AsBinary" title="ST_AsBinary/ST_AsWKB">ST_AsBinary/ST_AsWKB</a>, <a class="xref" href="#RT_ST_AsHexWKB" title="ST_AsHexWKB">ST_AsHexWKB</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_RastFromHexWKB"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_RastFromHexWKB — Well-Knownバイナリ (WKB)ラスタの16進数表現からラスタを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_RastFromHexWKB</b>(</code>text  <var class="pdparam">wkb</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp74554496"></a><h2>説明</h2><p>Well-Known Binary (WKB)ラスタが16進数表現で与えられると、ラスタを返します。 </p><p>Availability: 2.5.0</p></div><div class="refsection"><a name="idp74556032"></a><h2>例</h2><pre class="programlisting">SELECT (ST_Metadata(
    ST_RastFromHexWKB(
        '010000000000000000000000400000000000000840000000000000E03F000000000000E03F000000000000000000000000000000000A0000000A001400'
    )
)).* AS metadata;

 upperleftx | upperlefty | width | height | scalex | scaley | skewx | skewy | srid | numbands
------------+------------+-------+--------+--------+--------+-------+-------+------+----------
        0.5 |        0.5 |    10 |     20 |      2 |      3 |     0 |     0 |   10 |        0
                </pre></div><div class="refsection"><a name="idp74557312"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_MetaData" title="ST_MetaData">ST_MetaData</a>, <a class="xref" href="#RT_ST_RastFromWKB" title="ST_RastFromWKB">ST_RastFromWKB</a>, <a class="xref" href="#RT_ST_AsBinary" title="ST_AsBinary/ST_AsWKB">ST_AsBinary/ST_AsWKB</a>, <a class="xref" href="#RT_ST_AsHexWKB" title="ST_AsHexWKB">ST_AsHexWKB</a> </p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Raster_Outputs"></a>12.11. 出力</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#RT_ST_AsBinary">ST_AsBinary/ST_AsWKB</a></span><span class="refpurpose"> — ラスタのWell-Known Binary (WKB)表現を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_AsHexWKB">ST_AsHexWKB</a></span><span class="refpurpose"> — Well-Known Binary (WKB)ラスタを16進数表現で返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_AsGDALRaster">ST_AsGDALRaster</a></span><span class="refpurpose"> — 指定されたGDALラスタ書式でラスタタイルを返します。ラスタ書式はコンパイルしたライブラリが対応するものです。ライブラリが対応する書式の一覧を得るにはST_GDALRasters()を使います。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_AsJPEG">ST_AsJPEG</a></span><span class="refpurpose"> — ラスタの選択されたバンドを、単一のJoint Photographic Exports Group (JPEG)画像としてバイト配列で返します。バンドを指定せず、1バンドか3より多いバンドがある場合には、1番バンドを使用します。3バンドのみ指定した場合には、3バンドを使用し、RGBに対応付けます。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_AsPNG">ST_AsPNG</a></span><span class="refpurpose"> — ラスタの選択されたバンドを、単一のportable network graphics (PNG)画像としてバイト配列で返します。バンドを指定せず、1バンドか3バンドか4バンドある場合には、全てのバンドを使用します。バンドを指定せず、2バンドか4より多いバンドがある場合には、1番バンドを使用します。対象バンドはRGBまたはRGBAに対応付けられます。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_AsTIFF">ST_AsTIFF</a></span><span class="refpurpose"> — ラスタの選択されたバンドを、単一のTIFF画像 (バイト配列)として返します。バンドを指定しないか指定したバンドがラスタ内に無い場合には、全てのバンドの使用を試みます。</span></dt></dl></div><div class="refentry"><a name="RT_ST_AsBinary"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsBinary/ST_AsWKB — ラスタのWell-Known Binary (WKB)表現を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">bytea <b class="fsfunc">ST_AsBinary</b>(</code>raster  <var class="pdparam">rast</var>, boolean  <var class="pdparam">outasin=FALSE</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsWKB</b>(</code>raster  <var class="pdparam">rast</var>, boolean  <var class="pdparam">outasin=FALSE</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp74569728"></a><h2>説明</h2><p>ラスタのバイナリ表現を返します。<code class="varname">outasin</code>がTRUEの場合には、データベース外のバンドがデータベース内のバンドとして扱われます。表現の詳細については、PostGISソースフォルダにあるraster/doc/RFC2-WellKnownBinaryFormatをご覧下さい。 </p><p>データを文字列表現に変換せずにデータベース外に引き出すためのバイナリカーソルに使えます。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>デフォルトでは、WKB出力には、データベース外のバンドの外部ファイルパスを含みます。クライアントがデータベース外にあるラスタファイルにアクセスできない場合には、<code class="varname">outasin</code>をTRUEに設定します。</p></td></tr></table></div><p>Enhanced: 2.1.0 <code class="varname">outasin</code>の追加</p><p>Enhanced: 2.5.0 <code class="varname">ST_AsWKB</code>の追加</p></div><div class="refsection"><a name="idp74574336"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsBinary(rast) As rastbin FROM dummy_rast WHERE rid=1;

                     rastbin
---------------------------------------------------------------------------------
\001\000\000\000\000\000\000\000\000\000\000\000@\000\000\000\000\000\000\010@\000\000\000\000\000\000\340?\000\000\000\000\000\000\340?\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\012\000\000\000\012\000\024\000
                </pre></div><div class="refsection"><a name="idp74575616"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_RastFromWKB" title="ST_RastFromWKB">ST_RastFromWKB</a>, <a class="xref" href="#RT_ST_AsHexWKB" title="ST_AsHexWKB">ST_AsHexWKB</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_AsHexWKB"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsHexWKB — Well-Known Binary (WKB)ラスタを16進数表現で返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">bytea <b class="fsfunc">ST_AsHexWKB</b>(</code>raster  <var class="pdparam">rast</var>, boolean  <var class="pdparam">outasin=FALSE</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp74583040"></a><h2>説明</h2><p>ラスタのバイナリの16進数表現を返します。<code class="varname">outasin</code>がTRUEの場合には、データベース外のバンドがデータベース内のバンドとして扱われます。表現の詳細については、PostGISソースフォルダにあるraster/doc/RFC2-WellKnownBinaryFormatをご覧下さい。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>デフォルトでは、WKB出力には、データベース外のバンドの外部ファイルパスを含みます。クライアントがデータベース外バンドを持っているラスタファイルにアクセスできない場合には、<code class="varname">outasin</code>をTRUEに設定します。</p></td></tr></table></div><p>Availability: 2.5.0 </p></div><div class="refsection"><a name="idp74586112"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsHexWKB(rast) As rastbin FROM dummy_rast WHERE rid=1;

                                                        st_ashexwkb
----------------------------------------------------------------------------------------------------------------------------
 010000000000000000000000400000000000000840000000000000E03F000000000000E03F000000000000000000000000000000000A0000000A001400
                </pre></div><div class="refsection"><a name="idp74587392"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_RastFromHexWKB" title="ST_RastFromHexWKB">ST_RastFromHexWKB</a>, <a class="xref" href="#RT_ST_AsBinary" title="ST_AsBinary/ST_AsWKB">ST_AsBinary/ST_AsWKB</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_AsGDALRaster"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsGDALRaster — 指定されたGDALラスタ書式でラスタタイルを返します。ラスタ書式はコンパイルしたライブラリが対応するものです。ライブラリが対応する書式の一覧を得るにはST_GDALRasters()を使います。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">bytea <b class="fsfunc">ST_AsGDALRaster</b>(</code>raster  <var class="pdparam">rast</var>, text  <var class="pdparam">format</var>, text[]  <var class="pdparam">options=NULL</var>, integer  <var class="pdparam">srid=sameassource</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp74609280"></a><h2>説明</h2><p>指定された書式でラスタタイルを返します。引数は次の通りです。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="varname">format</code> 出力書式です。libgdalライブラリでコンパイルしたドライバに依存します。一般的には'JPEG', 'GTIff', 'PNG'が有効になっています。ライブラリが対応する形式の一覧を得るには<a class="xref" href="#RT_ST_GDALDrivers" title="ST_GDALDrivers">ST_GDALDrivers</a>を使います。 </p></li><li class="listitem"><p><code class="varname">options</code> GDALオプションの文字列配列です。妥当なオプションは書式に依存します。詳細については<a class="ulink" href="http://www.gdal.org/frmt_various.html" target="_top">GDAL Raster format options</a>をご覧下さい。 </p></li><li class="listitem"><p><code class="varname">srs</code> 画像に埋め込むproj4textまたはsrtext (spatial_ref_sysから)です。 </p></li></ul></div><p>Availability: 2.0.0 - GDAL 1.6.0以上が必要です。 </p></div><div class="refsection"><a name="idp74615296"></a><h2>複数タイルを単一ラスタとするJPEG出力例</h2><pre class="programlisting">SELECT ST_AsGDALRaster(ST_Union(rast), 'JPEG', ARRAY['QUALITY=50']) As rastjpg
FROM dummy_rast
WHERE rast &amp;&amp; ST_MakeEnvelope(10, 10, 11, 11);</pre></div><div class="refsection"><a name="idp74616576"></a><h2>PostgreSQLラージオブジェクト対応を使ったラスタの出力</h2><p>ラスタを他の書式に出力する方法の一つとして、<a class="ulink" href="https://www.postgresql.org/docs/current/static/lo-funcs.html" target="_top">PostgreSQL large object export functions</a>の使用があります。前の例の繰り返しですが、出力も行います。サーバ側のlo関数を使うため、データベースへのスーパーユーザ権限が必要となることに注意して下さい。また、サーバネットワーク上のパスに出力します。ローカルに出力するには、psqlで、サーバのファイルシステムでなくローカルのファイルシステムに出力する等価のlo_関数を使います。</p><pre class="programlisting">DROP TABLE IF EXISTS tmp_out ;

CREATE TABLE tmp_out AS
SELECT lo_from_bytea(0,
       ST_AsGDALRaster(ST_Union(rast), 'JPEG', ARRAY['QUALITY=50'])
        ) AS loid
  FROM dummy_rast
WHERE rast &amp;&amp; ST_MakeEnvelope(10, 10, 11, 11);

SELECT lo_export(loid, '/tmp/dummy.jpg')
   FROM tmp_out;

SELECT lo_unlink(loid)
  FROM tmp_out;</pre></div><div class="refsection"><a name="idp74618624"></a><h2>GTIFF出力の例</h2><pre class="programlisting">SELECT ST_AsGDALRaster(rast, 'GTiff') As rastjpg
FROM dummy_rast WHERE rid=2;

-- GeoTIFFをJPEG、90%品質で圧縮して出力します
SELECT ST_AsGDALRaster(rast, 'GTiff',
  ARRAY['COMPRESS=JPEG', 'JPEG_QUALITY=90'],
  4269) As rasttiff
FROM dummy_rast WHERE rid=2;
                </pre></div><div class="refsection"><a name="idp74620160"></a><h2>関連情報</h2><p><a class="xref" href="#RT_Raster_Applications" title="11.3. PostGISラスタを使ったカスタムアプリケーションの構築">「PostGISラスタを使ったカスタムアプリケーションの構築」</a>, <a class="xref" href="#RT_ST_GDALDrivers" title="ST_GDALDrivers">ST_GDALDrivers</a>, <a class="xref" href="#RT_ST_SRID" title="ST_SRID">ST_SRID</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_AsJPEG"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsJPEG — ラスタの選択されたバンドを、単一のJoint Photographic Exports Group (JPEG)画像としてバイト配列で返します。バンドを指定せず、1バンドか3より多いバンドがある場合には、1番バンドを使用します。3バンドのみ指定した場合には、3バンドを使用し、RGBに対応付けます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">bytea <b class="fsfunc">ST_AsJPEG</b>(</code>raster  <var class="pdparam">rast</var>, text[]  <var class="pdparam">options=NULL</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsJPEG</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, integer  <var class="pdparam">quality</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsJPEG</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, text[]  <var class="pdparam">options=NULL</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsJPEG</b>(</code>raster  <var class="pdparam">rast</var>, integer[]  <var class="pdparam">nbands</var>, text[]  <var class="pdparam">options=NULL</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsJPEG</b>(</code>raster  <var class="pdparam">rast</var>, integer[]  <var class="pdparam">nbands</var>, integer  <var class="pdparam">quality</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp74661376"></a><h2>説明</h2><p>ラスタの選択されたバンドを、単一のJoint Photographic Exports Group (JPEG)画像として返します。 より一般でないラスタタイプで出力する必要がある場合には、<a class="xref" href="#RT_ST_AsGDALRaster" title="ST_AsGDALRaster">ST_AsGDALRaster</a>を使います。バンドを指定せず、1バンドか3より多いバンドがある場合には、1番バンドを使用します。3バンドのみ指定した場合には、3バンドを使用します。この関数には多数の任意引数が付くさまざまな形式があります。引数については次の通りです。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="varname">nband</code> 単一バンド出力のためのものです。 </p></li><li class="listitem"><p><code class="varname">nbands</code> 出力バンドの配列 (JPEGでは3要素が最大です)で、バンドの並び順はRGBです。たとえばARRAY[3,2,1]は、3番バンドを赤、2番バンドを緑、1番バンドを青にそれぞれ対応させます。 </p></li><li class="listitem"><p><code class="varname">quality</code> 0から100の数値です。高いほどしっかりした画像になります。 </p></li><li class="listitem"><p><code class="varname">options</code> JPEGのために定義するGDALオプションの文字列配列です (<a class="xref" href="#RT_ST_GDALDrivers" title="ST_GDALDrivers">ST_GDALDrivers</a>のcreate_optionsを見てください)。JPEGの妥当なパラメタは <code class="varname">PROGRESSIVE</code>の'ON'または'OFF'と、<code class="varname">QUALITY</code>の0から100までの数 (デフォルトは75)です。詳細については <a class="ulink" href="http://www.gdal.org/frmt_various.html" target="_top">GDAL Raster format options</a>をご覧下さい。 </p></li></ul></div><p>Availability: 2.0.0 - GDAL 1.6.0以上が必要です。 </p></div><div class="refsection"><a name="idp74669568"></a><h2>例: 出力</h2><pre class="programlisting">-- 前から3バンドを75%品質で出力
SELECT ST_AsJPEG(rast) As rastjpg
    FROM dummy_rast WHERE rid=2;

-- 1番バンドのみ90%品質で出力
SELECT ST_AsJPEG(rast,1,90) As rastjpg
    FROM dummy_rast WHERE rid=2;

-- 前から3バンドを、2番を赤、1番を緑、3番を青とし、プログレッシブ、90%品質で出力します
SELECT ST_AsJPEG(rast,ARRAY[2,1,3],ARRAY['QUALITY=90','PROGRESSIVE=ON']) As rastjpg
    FROM dummy_rast WHERE rid=2;</pre></div><div class="refsection"><a name="idp74671104"></a><h2>関連情報</h2><p><a class="xref" href="#RT_Raster_Applications" title="11.3. PostGISラスタを使ったカスタムアプリケーションの構築">「PostGISラスタを使ったカスタムアプリケーションの構築」</a>, <a class="xref" href="#RT_ST_GDALDrivers" title="ST_GDALDrivers">ST_GDALDrivers</a>, <a class="xref" href="#RT_ST_AsGDALRaster" title="ST_AsGDALRaster">ST_AsGDALRaster</a>, <a class="xref" href="#RT_ST_AsPNG" title="ST_AsPNG">ST_AsPNG</a>, <a class="xref" href="#RT_ST_AsTIFF" title="ST_AsTIFF">ST_AsTIFF</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_AsPNG"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsPNG — ラスタの選択されたバンドを、単一のportable network graphics (PNG)画像としてバイト配列で返します。バンドを指定せず、1バンドか3バンドか4バンドある場合には、全てのバンドを使用します。バンドを指定せず、2バンドか4より多いバンドがある場合には、1番バンドを使用します。対象バンドはRGBまたはRGBAに対応付けられます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">bytea <b class="fsfunc">ST_AsPNG</b>(</code>raster  <var class="pdparam">rast</var>, text[]  <var class="pdparam">options=NULL</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsPNG</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, integer  <var class="pdparam">compression</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsPNG</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, text[]  <var class="pdparam">options=NULL</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsPNG</b>(</code>raster  <var class="pdparam">rast</var>, integer[]  <var class="pdparam">nbands</var>, integer  <var class="pdparam">compression</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsPNG</b>(</code>raster  <var class="pdparam">rast</var>, integer[]  <var class="pdparam">nbands</var>, text[]  <var class="pdparam">options=NULL</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp74696832"></a><h2>説明</h2><p>ラスタの選択されたバンドを、単一のportable network graphics (PNG)画像として返します。より一般でないラスタタイプで出力する必要がある場合には、<a class="xref" href="#RT_ST_AsGDALRaster" title="ST_AsGDALRaster">ST_AsGDALRaster</a>を使います。バンドを指定しない場合には、前から3バンドを出力します。この関数には多数の任意引数が付くさまざまな形式があります。<code class="varname">srid</code>が指定されない場合には、sridはラスタが使用しているSRIDを指定します。引数の一覧は次の通りです。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="varname">nband</code> 単一バンド出力のためのものです。 </p></li><li class="listitem"><p><code class="varname">nbands</code> 出力バンドの配列 (PNGでは4要素が最大です)で、バンドの並び順はRGBAです。たとえばARRAY[3,2,1]は、3番バンドを赤、2番バンドを緑、1番バンドを青にそれぞれ対応させます。 </p></li><li class="listitem"><p><code class="varname">compression</code> 1から9の数を指定します。大きいほど圧縮効率が上がります。 </p></li><li class="listitem"><p><code class="varname">options</code> PNGのために定義するGDALオプションの文字列配列です (<a class="xref" href="#RT_ST_GDALDrivers" title="ST_GDALDrivers">ST_GDALDrivers</a>のcreate_optionsを見てください)。PNGの妥当なパラメタはZLEVEL (圧縮に費やす時間の合計で、デフォルトは6)です。ARRAY['ZLEVEL=9']というようにします。この関数が二つの出力を行う必要があるため、ワールドファイルはPNGでは許されません。詳細については<a class="ulink" href="http://www.gdal.org/frmt_various.html" target="_top">GDAL Raster format options</a>をご覧下さい。 </p></li></ul></div><p>Availability: 2.0.0 - GDAL 1.6.0以上が必要です。 </p></div><div class="refsection"><a name="idp74704640"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsPNG(rast) As rastpng
FROM dummy_rast WHERE rid=2;

-- 前から3バンドを出力し、3番を赤、1番を緑、2番を青に対応付けます
SELECT ST_AsPNG(rast, ARRAY[3,1,2]) As rastpng
FROM dummy_rast WHERE rid=2;
                </pre></div><div class="refsection"><a name="idp74706176"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_AsGDALRaster" title="ST_AsGDALRaster">ST_AsGDALRaster</a>, <a class="xref" href="#RT_ST_ColorMap" title="ST_ColorMap">ST_ColorMap</a>, <a class="xref" href="#RT_ST_GDALDrivers" title="ST_GDALDrivers">ST_GDALDrivers</a>, <a class="xref" href="#RT_Raster_Applications" title="11.3. PostGISラスタを使ったカスタムアプリケーションの構築">「PostGISラスタを使ったカスタムアプリケーションの構築」</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_AsTIFF"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsTIFF — ラスタの選択されたバンドを、単一のTIFF画像 (バイト配列)として返します。バンドを指定しないか指定したバンドがラスタ内に無い場合には、全てのバンドの使用を試みます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">bytea <b class="fsfunc">ST_AsTIFF</b>(</code>raster  <var class="pdparam">rast</var>, text[]  <var class="pdparam">options=''</var>, integer  <var class="pdparam">srid=sameassource</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsTIFF</b>(</code>raster  <var class="pdparam">rast</var>, text  <var class="pdparam">compression=''</var>, integer  <var class="pdparam">srid=sameassource</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsTIFF</b>(</code>raster  <var class="pdparam">rast</var>, integer[]  <var class="pdparam">nbands</var>, text  <var class="pdparam">compression=''</var>, integer  <var class="pdparam">srid=sameassource</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsTIFF</b>(</code>raster  <var class="pdparam">rast</var>, integer[]  <var class="pdparam">nbands</var>, text[]  <var class="pdparam">options</var>, integer  <var class="pdparam">srid=sameassource</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp74730496"></a><h2>説明</h2><p>ラスタの選択されたバンドを、単一のTagged Image File Format (TIFF)画像として返します。バンドを指定しない場合には、全てのバンドの使用を試みます。この関数は<a class="xref" href="#RT_ST_AsGDALRaster" title="ST_AsGDALRaster">ST_AsGDALRaster</a>のラッパです。より一般でないラスタタイプで出力する必要がある場合には、<a class="xref" href="#RT_ST_AsGDALRaster" title="ST_AsGDALRaster">ST_AsGDALRaster</a>を使います。この関数には多数の任意引数が付くさまざまな形式があります。空間参照系 (SRS)の文字列表現が指定されていない場合には、ラスタの空間参照系を使います。引数については次の通りです。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="varname">nbands</code> 出力バンドの配列 (PNGでは3要素が最大です)で、バンドの並び順はRGBです。たとえばARRAY[3,2,1]は、3番バンドを赤、2番バンドを緑、1番バンドを青にそれぞれ対応させます。 </p></li><li class="listitem"><p><code class="varname">compression</code> 圧縮式 -- JPEG90 (または他のパーセント値), LZW, JPEG, DEFLATE9のいずれかです。 </p></li><li class="listitem"><p><code class="varname">options</code> GTiffを定義するGDALオプションの文字列配列です (<a class="xref" href="#RT_ST_GDALDrivers" title="ST_GDALDrivers">ST_GDALDrivers</a>のGTiff用のcreate_optionsを見てください)。詳細については<a class="ulink" href="http://www.gdal.org/frmt_various.html" target="_top">GDAL Raster format options</a>をご覧下さい。 </p></li><li class="listitem"><p><code class="varname">srid</code> ラスタのspatial_ref_sysのSRIDです。地理参照情報を登録するために使われます。 </p></li></ul></div><p>Availability: 2.0.0 - GDAL 1.6.0以上が必要です。 </p></div><div class="refsection"><a name="idp74738304"></a><h2>例: JPEG90%品質圧縮の使用</h2><pre class="programlisting">SELECT ST_AsTIFF(rast, 'JPEG90') As rasttiff
FROM dummy_rast WHERE rid=2;
                </pre></div><div class="refsection"><a name="idp74739840"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_GDALDrivers" title="ST_GDALDrivers">ST_GDALDrivers</a>, <a class="xref" href="#RT_ST_AsGDALRaster" title="ST_AsGDALRaster">ST_AsGDALRaster</a>, <a class="xref" href="#RT_ST_SRID" title="ST_SRID">ST_SRID</a></p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Raster_Processing_MapAlgebra"></a>12.12. ラスタ処理: 地図代数</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#RT_ST_Clip">ST_Clip</a></span><span class="refpurpose"> — 入力ジオメトリで切り取ったラスタを返します。バンドが指定されていない場合には、全てのバンドが返されます。<code class="varname">crop</code>が指定されていない場合には、TRUEと仮定され、出力ラスタをクロップします。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_ColorMap">ST_ColorMap</a></span><span class="refpurpose"> — 元のラスタと指定したバンドから4個までの8BUIバンド (grayscale, RGB, RGBA)からなる新しいラスタを生成します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Grayscale">ST_Grayscale</a></span><span class="refpurpose"> — 元のラスタと指定したバンドを赤、緑、青バンドとして一つの8BUIバンドを持つラスタを生成します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Intersection">ST_Intersection</a></span><span class="refpurpose"> — 二つのラスタの共有部分またはベクタ化したラスタとジオメトリとのインタセクトした部分を表現する、ラスタまたはジオメトリとピクセル値の組の集合を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_MapAlgebra">ST_MapAlgebra (コールバック関数版)</a></span><span class="refpurpose"> — コールバック関数版 - 一つ以上の入力ラスタ、バンドインデクスと一つのユーザ定義コールバック関数から、一つのバンドからなるラスタを返します。 </span></dt><dt><span class="refentrytitle"><a href="#RT_ST_MapAlgebra_expr">ST_MapAlgebra (数式版)</a></span><span class="refpurpose"> — 数式版 - 一つか二つの入力ラスタ、バンド番号、一つ以上のユーザ定義SQL式から一つのバンドを持つラスタを返します。 </span></dt><dt><span class="refentrytitle"><a href="#RT_ST_MapAlgebraExpr">ST_MapAlgebraExpr</a></span><span class="refpurpose"> — 1バンド版: 入力バンドに対する妥当なPostgreSQL代数演算で形成された、指定したピクセルタイプとなる1バンドラスタを生成します。バンドを指定しない場合には、1番を仮定します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_MapAlgebraExpr2">ST_MapAlgebraExpr</a></span><span class="refpurpose"> — 2バンド版: 二つの入力バンドに対する妥当なPostgreSQL代数演算で形成された、指定したピクセルタイプとなる1バンドラスタを生成します。バンドを指定しない場合には、どちらも1番と仮定します。結果ラスタは、一つ目のラスタのアラインメント (スケール、スキュー、ピクセル角位置)にあわされます。範囲は"extenttype"引数で定義されます。取りうる"extenttype"の値はINTERSECTION, UNION, FIRST, SECONDです。 </span></dt><dt><span class="refentrytitle"><a href="#RT_ST_MapAlgebraFct">ST_MapAlgebraFct</a></span><span class="refpurpose"> — 1バンド版 - 入力バンドに対する妥当なPostgreSQL関数で形成された、指定したピクセルタイプとなる1バンドラスタを生成します。バンドを指定しない場合には、1番と仮定します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_MapAlgebraFct2">ST_MapAlgebraFct</a></span><span class="refpurpose"> — 2バンド版 - 二つの入力バンドに対する妥当なPostgreSQL関数で形成された、指定したピクセルタイプとなる1バンドラスタを生成します。バンドを指定しない場合には、1番と仮定します。"extenttype"のデフォルトはINTERSECTIONです。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a></span><span class="refpurpose"> — 1バンド版: ユーザ定義PostgreSQL関数を使用する最近傍地図代数関数です。入力ラスタバンドの近傍の値を与えたPL/pgSQLユーザ定義関数の結果からなるラスタを返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Reclass">ST_Reclass</a></span><span class="refpurpose"> — 元のラスタから再分類したバンドタイプからなるラスタを生成します。nbandは変更するバンドです。nbandが指定されていない場合には、1と仮定します。他の全てのバンドは変更せずに返します。可視画像の書式としてより単純な描画を行うために、16BUIバンドを8BUIバンドに変換する、等のために使います。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Union">ST_Union</a></span><span class="refpurpose"> — ラスタタイルの集合を結合して1以上のバンドからなる単一ラスタを返します。</span></dt></dl></div><div class="refentry"><a name="RT_ST_Clip"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Clip — 入力ジオメトリで切り取ったラスタを返します。バンドが指定されていない場合には、全てのバンドが返されます。<code class="varname">crop</code>が指定されていない場合には、TRUEと仮定され、出力ラスタをクロップします。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_Clip</b>(</code>raster  <var class="pdparam">rast</var>, integer[]  <var class="pdparam">nband</var>, geometry  <var class="pdparam">geom</var>, double precision[]  <var class="pdparam">nodataval=NULL</var>, boolean  <var class="pdparam">crop=TRUE</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Clip</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, geometry  <var class="pdparam">geom</var>, double precision  <var class="pdparam">nodataval</var>, boolean  <var class="pdparam">crop=TRUE</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Clip</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, geometry  <var class="pdparam">geom</var>, boolean  <var class="pdparam">crop</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Clip</b>(</code>raster  <var class="pdparam">rast</var>, geometry  <var class="pdparam">geom</var>, double precision[]  <var class="pdparam">nodataval=NULL</var>, boolean  <var class="pdparam">crop=TRUE</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Clip</b>(</code>raster  <var class="pdparam">rast</var>, geometry  <var class="pdparam">geom</var>, double precision  <var class="pdparam">nodataval</var>, boolean  <var class="pdparam">crop=TRUE</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Clip</b>(</code>raster  <var class="pdparam">rast</var>, geometry  <var class="pdparam">geom</var>, boolean  <var class="pdparam">crop</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp74795136"></a><h2>説明</h2><p>入力ジオメトリ<code class="varname">geom</code>で切り取ったラスタを返します。バンドが指定されていない場合には、全てのバンドが処理されます。 </p><p>ST_Clipが返すラスタは、バンド毎に一つずつ必ず切り取った領域に適用するNODATA値を持ちます。NODATA値が渡されず、入力ラスタがNODATA値を持たない場合には、結果ラスタのNODATA値はST_MinPossibleValue(ST_BandPixelType(rast, band))に設定されます。配列におけるNODATA値の要素数がバンド数より小さい場合には、配列の最後の要素が残りのバンドに適用されます。NODATA値の要素数がバンド数より多い場合には、超過分は無視されます。全てのNODATA値配列を受け付ける形式では、バンド毎に適用される単一値も受け付けます。 </p><p><code class="varname">crop</code>が指定されていない場合には、TRUEと仮定され、出力ラスタを <code class="varname">geom</code>範囲と<code class="varname">rast</code>範囲とのインタセクトした範囲にクロップします。cropがFALSEに設定されている場合には、新しいラスタは<code class="varname">rast</code>と同じ範囲になります。 </p><p>Availability: 2.0.0 </p><p>Enhanced: 2.1.0 C言語で記述されました</p><p>MassGISサイト<a class="ulink" href="http://www.mass.gov/mgis/colororthos2008.htm" target="_top">MassGIS Aerial Orthos</a>にあるマサチューセッツ空中写真データを使った例です。座標はメートル単位のマサチューセッツ州平面です。 </p></div><div class="refsection"><a name="idp74800512"></a><h2>例: 1バンドの切り取り</h2><pre class="programlisting">-- 空中写真タイルの1番バンドを中心から20メートルのバッファで切り取ります
SELECT ST_Clip(rast, 1,
        ST_Buffer(ST_Centroid(ST_Envelope(rast)),20)
    ) from aerials.boston
WHERE rid = 4;
                    </pre><pre class="programlisting">--ラスタの最終的なピクセル範囲についてのクロップの効果のデモンストレーション
-- crop=trueでは、どのように最終的な範囲がジオメトリに切り取られるかをみます
SELECT ST_XMax(ST_Envelope(ST_Clip(rast, 1, clipper, true))) As xmax_w_trim,
    ST_XMax(clipper) As xmax_clipper,
    ST_XMax(ST_Envelope(ST_Clip(rast, 1, clipper, false))) As xmax_wo_trim,
    ST_XMax(ST_Envelope(rast)) As xmax_rast_orig
FROM (SELECT rast, ST_Buffer(ST_Centroid(ST_Envelope(rast)),6) As clipper
    FROM aerials.boston
WHERE rid = 6) As foo;

   xmax_w_trim    |   xmax_clipper   |   xmax_wo_trim   |  xmax_rast_orig
------------------+------------------+------------------+------------------
 230657.436173996 | 230657.436173996 | 230666.436173996 | 230666.436173996
                    </pre><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col><col></colgroup><tbody><tr><td style="border-right: 1px solid ; ">
                                        <p>
                                            </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_clip01.png"><div class="caption"><p>切り取り前の完全なラスタタイル</p></div></div></div><p>
                                        </p>
                                    </td><td style="">
                                        <p>
                                            </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_clip02.png"><div class="caption"><p>切り取り後</p></div></div></div><p>
                                        </p>
                                    </td></tr></tbody></table></div></div><div class="refsection"><a name="idp74810368"></a><h2>例: クロップがなく他のバンドは切り取らず1バンドを切り取る</h2><pre class="programlisting">-- 前の例と同じですが、
-- ST_AddBandは全てのバンドが同じピクセル範囲を持っている必要があるので
-- ST_AddBandを使えるようにするためcropをFALSEに設定しなければなりません
SELECT ST_AddBand(ST_Clip(rast, 1,
        ST_Buffer(ST_Centroid(ST_Envelope(rast)),20),false
    ), ARRAY[ST_Band(rast,2),ST_Band(rast,3)] ) from aerials.boston
WHERE rid = 6;
                    </pre><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col><col></colgroup><tbody><tr><td style="border-right: 1px solid ; ">
                                        <p>
                                            </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_clip04.png"><div class="caption"><p>切り取り前の完全なラスタタイル</p></div></div></div><p>
                                        </p>
                                    </td><td style="">
                                        <p>
                                            </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_clip05.png"><div class="caption"><p>切り取り後 - シュールですね</p></div></div></div><p>
                                        </p>
                                    </td></tr></tbody></table></div></div><div class="refsection"><a name="idp74819712"></a><h2>例: 全バンドの切り取り</h2><pre class="programlisting">-- 空中写真タイルの全バンドを20メートルバッファで切り取ります
-- 違いは、全バンドの切り取りのため
-- 切り取り対象のバンドを指定しないことだけです
SELECT ST_Clip(rast,
      ST_Buffer(ST_Centroid(ST_Envelope(rast)), 20),
      false
    ) from aerials.boston
WHERE rid = 4;
                    </pre><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col><col></colgroup><tbody><tr><td style="border-right: 1px solid ; ">
                                        <p>
                                            </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_clip01.png"><div class="caption"><p>切り取り前の完全なラスタタイル</p></div></div></div><p>
                                        </p>
                                    </td><td style="">
                                        <p>
                                            </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_clip03.png"><div class="caption"><p>切り取り後</p></div></div></div><p>
                                        </p>
                                    </td></tr></tbody></table></div></div><div class="refsection"><a name="idp74829312"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_AddBand" title="ST_AddBand">ST_AddBand</a>, <a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>, <a class="xref" href="#RT_ST_Intersection" title="ST_Intersection">ST_Intersection</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_ColorMap"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ColorMap — 元のラスタと指定したバンドから4個までの8BUIバンド (grayscale, RGB, RGBA)からなる新しいラスタを生成します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_ColorMap</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband=1</var>, text  <var class="pdparam">colormap=grayscale</var>, text  <var class="pdparam">method=INTERPOLATE</var><code>)</code>;</p></div><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_ColorMap</b>(</code>raster  <var class="pdparam">rast</var>, text  <var class="pdparam">colormap</var>, text  <var class="pdparam">method=INTERPOLATE</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp74848128"></a><h2>説明</h2><p><code class="varname">rast</code>の<code class="varname">nband</code>で示されるバンドに<code class="varname">colormap</code>を適用し、4個までの8BUIバンドからなる新しいラスタを返します。新しいラスタの8BUIバンドの数は<code class="varname">colormap</code>で定義された色要素の数で決まります。 </p><p><code class="varname">nband</code>が指定されていない場合には、1番と仮定します。</p><p><code class="varname">colormap</code>は事前定義された色マップまたは値を定義する行の集合と色要素のキーワードです。 </p><p>妥当な事前定義された<code class="varname">colormap</code>キーワードは次の通りです。 </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="varname">grayscale</code>または<code class="varname">greyscale</code> 1個の8BUIバンドからなるラスタで、グレーの陰影です。 </p></li><li class="listitem"><p><code class="varname">pseudocolor</code> 4個の8BUIバンド (RGBA)からなるラスタで、青から緑、赤に移るものです。 </p></li><li class="listitem"><p><code class="varname">fire</code> 4個の8BUIバンド (RGBA)からなるラスタで、黒から赤、淡黄色に移るものです。 </p></li><li class="listitem"><p><code class="varname">bluered</code>  4個の8BUIバンド (RGBA)からなるラスタで、青からペールホワイト、赤に移るものです。 </p></li></ul></div><p>カスタムカラーマップを指定するためにエントリ (1行1エントリ)の集合を<code class="varname">colormap</code>に渡すことができます。それぞれのエントリは一般的に、ピクセル値、ピクセル値と対応する赤、緑、青、アルファ要素(0から255の間の色要素)からなる5個の値を持ちます。ピクセル値の替わりに百分率値を使うことができ、0%がラスタバンドでの最小値、100%が最大値になります。値はコンマ('.')、タブ、コロン(':')、空白で区切られます。NODATA値に対しては、ピクセル値を<span class="emphasis"><em>nv</em></span>, <span class="emphasis"><em>null</em></span>, <span class="emphasis"><em>nodata</em></span>のいずれかに設定できます。例を次に示します。 </p><pre class="programlisting">5 0 0 0 255
4 100:50 55 255
1 150,100 150 255
0% 255 255 255 255
nv 0 0 0 0
                    </pre><p><code class="varname">colormap</code>の構文は、GDALツールの<a class="ulink" href="http://www.gdal.org/gdaldem.html#gdaldem_color_relief" target="_top">gdaldem</a>の起伏モードに似ています。 </p><p><code class="varname">method</code>の妥当なキーワードは次の通りです。 </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="varname">INTERPOLATE</code> 与えられたピクセル値の間での滑らかな色合成のための線形補間に使います。 </p></li><li class="listitem"><p><code class="varname">EXACT</code> カラーマップで見つかったピクセル値だけを厳格に一致させます。カラーマップエントリに一致しないピクセルに対しては0 0 0 0 (RGBA)が設定されます。 </p></li><li class="listitem"><p><code class="varname">NEAREST</code> ピクセル値に最も近い値にあうカラーマップエントリを使います。 </p></li></ul></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>カラーマップの偉大な参考情報は<a class="ulink" href="http://www.colorbrewer2.org" target="_top">ColorBrewer</a>にあります。 </p></td></tr></table></div><div class="warning"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>新しいラスタの結果バンドにはNODATA値が入りません。NODATA値が必要な場合には、 <a class="xref" href="#RT_ST_SetBandNoDataValue" title="ST_SetBandNoDataValue">ST_SetBandNoDataValue</a>を使ってNODATA値をセットします。 </p></td></tr></table></div><p>Availability: 2.1.0 </p></div><div class="refsection"><a name="idp74876416"></a><h2>例</h2><p>これは試行のためのがらくたテーブルです。</p><pre class="programlisting">-- 試験ラスタテーブルの作成 --
DROP TABLE IF EXISTS funky_shapes;
CREATE TABLE funky_shapes(rast raster);

INSERT INTO funky_shapes(rast)
WITH ref AS (
    SELECT ST_MakeEmptyRaster( 200, 200, 0, 200, 1, -1, 0, 0) AS rast
)
SELECT
    ST_Union(rast)
FROM (
    SELECT
        ST_AsRaster(
            ST_Rotate(
                ST_Buffer(
                    ST_GeomFromText('LINESTRING(0 2,50 50,150 150,125 50)'),
                    i*2
                ),
                pi() * i * 0.125, ST_Point(50,50)
            ),
            ref.rast, '8BUI'::text, i * 5
        ) AS rast
    FROM ref
    CROSS JOIN generate_series(1, 10, 3) AS i
) AS shapes;
                    </pre><pre class="programlisting">SELECT
    ST_NumBands(rast) As n_orig,
    ST_NumBands(ST_ColorMap(rast,1, 'greyscale')) As ngrey,
    ST_NumBands(ST_ColorMap(rast,1, 'pseudocolor')) As npseudo,
    ST_NumBands(ST_ColorMap(rast,1, 'fire')) As nfire,
    ST_NumBands(ST_ColorMap(rast,1, 'bluered')) As nbluered,
    ST_NumBands(ST_ColorMap(rast,1, '
100% 255   0   0
 80% 160   0   0
 50% 130   0   0
 30%  30   0   0
 20%  60   0   0
  0%   0   0   0
  nv 255 255 255
    ')) As nred
FROM funky_shapes;
                    </pre><pre class="screen">n_orig | ngrey | npseudo | nfire | nbluered | nred
--------+-------+---------+-------+----------+------
      1 |     1 |       4 |     4 |        4 |    3
                    </pre></div><div class="refsection"><a name="idp74879104"></a><h2>例: ST_AsPNGを使用して異なるカラーマップを比較する</h2><pre class="programlisting">SELECT
    ST_AsPNG(rast) As orig_png,
    ST_AsPNG(ST_ColorMap(rast,1,'greyscale')) As grey_png,
    ST_AsPNG(ST_ColorMap(rast,1, 'pseudocolor')) As pseudo_png,
    ST_AsPNG(ST_ColorMap(rast,1, 'nfire')) As fire_png,
    ST_AsPNG(ST_ColorMap(rast,1, 'bluered')) As bluered_png,
    ST_AsPNG(ST_ColorMap(rast,1, '
100% 255   0   0
 80% 160   0   0
 50% 130   0   0
 30%  30   0   0
 20%  60   0   0
  0%   0   0   0
  nv 255 255 255
    ')) As red_png
FROM funky_shapes;
                    </pre><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col><col><col></colgroup><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
                                        <p>
                                            </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_colormap_orig.png"><div class="caption"><p>orig_png</p></div></div></div><p>
                                        </p>
                                    </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
                                        <p>
                                            </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_colormap_grey.png"><div class="caption"><p>grey_png</p></div></div></div><p>
                                        </p>
                                    </td><td style="border-bottom: 1px solid ; ">
                                        <p>
                                            </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_colormap_pseudo.png"><div class="caption"><p>pseudo_png</p></div></div></div><p>
                                        </p>
                                    </td></tr><tr><td style="border-right: 1px solid ; ">
                                        <p>
                                            </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_colormap_fire.png"><div class="caption"><p>fire_png</p></div></div></div><p>
                                        </p>
                                    </td><td style="border-right: 1px solid ; ">
                                        <p>
                                            </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_colormap_bluered.png"><div class="caption"><p>bluered_png</p></div></div></div><p>
                                        </p>
                                    </td><td style="">
                                        <p>
                                            </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_colormap_red.png"><div class="caption"><p>red_png</p></div></div></div><p>
                                        </p>
                                    </td></tr></tbody></table></div></div><div class="refsection"><a name="idp74905728"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_AsPNG" title="ST_AsPNG">ST_AsPNG</a>, <a class="xref" href="#RT_ST_AsRaster" title="ST_AsRaster">ST_AsRaster</a> <a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>, <a class="xref" href="#RT_ST_Grayscale" title="ST_Grayscale">ST_Grayscale</a> <a class="xref" href="#RT_ST_NumBands" title="ST_NumBands">ST_NumBands</a>, <a class="xref" href="#RT_ST_Reclass" title="ST_Reclass">ST_Reclass</a>, <a class="xref" href="#RT_ST_SetBandNoDataValue" title="ST_SetBandNoDataValue">ST_SetBandNoDataValue</a>, <a class="xref" href="#RT_ST_Union" title="ST_Union">ST_Union</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Grayscale"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Grayscale — 元のラスタと指定したバンドを赤、緑、青バンドとして一つの8BUIバンドを持つラスタを生成します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">(1) raster <b class="fsfunc">ST_Grayscale</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">redband=1</var>, integer  <var class="pdparam">greenband=2</var>, integer  <var class="pdparam">blueband=3</var>, text  <var class="pdparam">extenttype=INTERSECTION</var><code>)</code>;</p></div><div class="funcsynopsis"><p><code class="funcdef">(2) raster <b class="fsfunc">ST_Grayscale</b>(</code>rastbandarg[]  <var class="pdparam">rastbandargset</var>, text  <var class="pdparam">extenttype=INTERSECTION</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp74922496"></a><h2>説明</h2><p>三つの入力バンド (一つ以上のラスタ)を与えられ、一つの8BUIバンドを持つラスタを生成します。タイプが8BUIでない入力バンドは全て<a class="xref" href="#RT_ST_Reclass" title="ST_Reclass">ST_Reclass</a>で再分類されます。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数は<code class="varname">grayscale</code>キーワードを与えた場合の<a class="xref" href="#RT_ST_ColorMap" title="ST_ColorMap">ST_ColorMap</a>とは違います。ST_ColorMapでは一つのバンドを扱いますが、この関数ではRGBの3バンドを期待します。この関数は 0.2989 * 赤 + 0.5870 * 緑 + 0.1140 * 青 という式を適用してRGBをグレースケールにしています。 </p></td></tr></table></div><p>Availability: 2.5.0 </p></div><div class="refsection"><a name="idp74925952"></a><h2>例: 一つ目の形式</h2><pre class="programlisting">SET postgis.gdal_enabled_drivers = 'ENABLE_ALL';
SET postgis.enable_outdb_rasters = True;

WITH apple AS (
    SELECT ST_AddBand(
        ST_MakeEmptyRaster(350, 246, 0, 0, 1, -1, 0, 0, 0),
        '/tmp/apple.png'::text,
        NULL::int[]
    ) AS rast
)
SELECT
    ST_AsPNG(rast) AS original_png,
    ST_AsPNG(ST_Grayscale(rast)) AS grayscale_png
FROM apple;
                    </pre><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col><col></colgroup><tbody><tr><td style="border-right: 1px solid ; ">
                                        <p>
                                            </p><div class="informalfigure"><div class="mediaobject"><img src="images/apple.png"><div class="caption"><p>original_png</p></div></div></div><p>
                                        </p>
                                    </td><td style="">
                                        <p>
                                            </p><div class="informalfigure"><div class="mediaobject"><img src="images/apple_st_grayscale.png"><div class="caption"><p>grayscale_png</p></div></div></div><p>
                                        </p>
                                    </td></tr></tbody></table></div></div><div class="refsection"><a name="idp74935296"></a><h2>例: 二つ目の形式</h2><pre class="programlisting">SET postgis.gdal_enabled_drivers = 'ENABLE_ALL';
SET postgis.enable_outdb_rasters = True;

WITH apple AS (
    SELECT ST_AddBand(
        ST_MakeEmptyRaster(350, 246, 0, 0, 1, -1, 0, 0, 0),
        '/tmp/apple.png'::text,
        NULL::int[]
    ) AS rast
)
SELECT
    ST_AsPNG(rast) AS original_png,
    ST_AsPNG(ST_Grayscale(
        ARRAY[
            ROW(rast, 1)::rastbandarg, -- red
            ROW(rast, 2)::rastbandarg, -- green
            ROW(rast, 3)::rastbandarg, -- blue
        ]::rastbandarg[]
    )) AS grayscale_png
FROM apple;
                    </pre></div><div class="refsection"><a name="idp74936576"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_AsPNG" title="ST_AsPNG">ST_AsPNG</a>, <a class="xref" href="#RT_ST_Reclass" title="ST_Reclass">ST_Reclass</a>, <a class="xref" href="#RT_ST_ColorMap" title="ST_ColorMap">ST_ColorMap</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Intersection"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Intersection — 二つのラスタの共有部分またはベクタ化したラスタとジオメトリとのインタセクトした部分を表現する、ラスタまたはジオメトリとピクセル値の組の集合を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">setof geomval <b class="fsfunc">ST_Intersection</b>(</code>geometry  <var class="pdparam">geom</var>, raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">band_num=1</var><code>)</code>;</p><p><code class="funcdef">setof geomval <b class="fsfunc">ST_Intersection</b>(</code>raster  <var class="pdparam">rast</var>, geometry  <var class="pdparam">geom</var><code>)</code>;</p><p><code class="funcdef">setof geomval <b class="fsfunc">ST_Intersection</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">band</var>, geometry  <var class="pdparam">geomin</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Intersection</b>(</code>raster  <var class="pdparam">rast1</var>, raster  <var class="pdparam">rast2</var>, double precision[]  <var class="pdparam">nodataval</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Intersection</b>(</code>raster  <var class="pdparam">rast1</var>, raster  <var class="pdparam">rast2</var>, text  <var class="pdparam">returnband</var>, double precision[]  <var class="pdparam">nodataval</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Intersection</b>(</code>raster  <var class="pdparam">rast1</var>, integer  <var class="pdparam">band1</var>, raster  <var class="pdparam">rast2</var>, integer  <var class="pdparam">band2</var>, double precision[]  <var class="pdparam">nodataval</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Intersection</b>(</code>raster  <var class="pdparam">rast1</var>, integer  <var class="pdparam">band1</var>, raster  <var class="pdparam">rast2</var>, integer  <var class="pdparam">band2</var>, text  <var class="pdparam">returnband</var>, double precision[]  <var class="pdparam">nodataval</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp74976384"></a><h2>説明</h2><p>二つのラスタの共有部分またはベクタ化したラスタとジオメトリとのインタセクトした部分を表現する、ラスタまたはジオメトリとピクセル値の組の集合を返します。 </p><p>前半の三つの形式は、geomvalの集合を返すもので、ベクタ空間で動作します。ラスタは初めにgeomval行の集合にベクトル化されます (<a class="xref" href="#RT_ST_DumpAsPolygons" title="ST_DumpAsPolygons">ST_DumpAsPolygons</a>を使用)。これらの行はPostGIS関数の<a class="xref" href="#">???</a>(geometry, geometry)を使ってジオメトリとインタセクトさせます。NODATA値の領域とだけインタセクトするジオメトリについては空ジオメトリを返します。通常はWHERE節で<a class="xref" href="#RT_ST_Intersects" title="ST_Intersects">ST_Intersects</a>を使って結果から確実に排除します。 </p><p>丸括弧でくくって式の末尾に'.geom'や'.val'をつけることにより、geomvalの結果集合のジオメトリや値の部分にアクセスすることができます。たとえば(ST_Intersection(rast, geom)).geom等とします。 </p><p>他の形式は、ラスタを引数に取り、ラスタを返します。ST_MapAlgebraExprの二つのラスタを取る形式を使って、インタセクトしている部分を取得します。 </p><p>結果ラスタの範囲は、二つのラスタの範囲についてインタセクトしている部分です。結果ラスタは、<code class="varname">returnband</code>引数として渡されたものにあわせられた'BAND1','BAND2','BOTH'バンドを含みます。どのバンドでもNODATA値の領域は、結果ラスタの全てのバンドのNODATA値領域に現れます。言い換えると、あらゆるNODATA値ピクセルとインタセクトしているピクセルは、結果ラスタではNODATA値ピクセルになります。 </p><p>インタセクトしなかった領域にNODATA値を入れるために、ST_Intersectionからの結果ラスタは、NODATA値を持たなければなりません。結果ラスタのどのバンドにも、一つか二つのNODATA値を持つ<code class="varname">nodataval[]</code>配列を与えることでNODATA値を定義したり置き換えたりできます。この配列は、引数で与えた'BAND1','BAND2','BOTH'バンドに依存します。 配列の一つ目の値は、一つ目のバンドのNODATA値を入れ替えるものです。二つ目の値は二つ目のバンドのNODATA値を入れ替えるものです。入力バンドの一つがNODATA値を持っておらず、かつ配列を渡さなかった場合には、ST_MinPossibleValue関数を使ってNODATA値が選ばれます。NODATA値の配列を受け付ける形式の全てが、単一値を受け付けます。単一値は結果ラスタのそれぞれのバンドに適用されます。 </p><p>全ての形式で、バンド番号を指定していない場合には、1番と仮定します。ラスタとジオメトリを引数にとり、ラスタを得たい場合には、<a class="xref" href="#RT_ST_Clip" title="ST_Clip">ST_Clip</a>を参照して下さい。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>NODATA値に遭遇した時の、結果範囲や返された物に関して、より多くの制御を行いたい場合には、<a class="xref" href="#RT_ST_MapAlgebraExpr2" title="ST_MapAlgebraExpr">ST_MapAlgebraExpr</a>の二つのラスタを取る形式を使います。 </p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ラスタバンドとジオメトリとがインタセクトする部分を計算するには、<a class="xref" href="#RT_ST_Clip" title="ST_Clip">ST_Clip</a>を使います。ST_Clipは複数のバンドで動作し、ラスタ化されたジオメトリに従ったバンドを返すことはしません。 </p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_Intersectionは、<a class="xref" href="#RT_ST_Intersects" title="ST_Intersects">ST_Intersects</a>と組み合わせて、ラスタカラムとジオメトリカラムのインデックスを使うべきです。 </p></td></tr></table></div><p>Enhanced: 2.0.0 - ラスタ空間のインタセクションが導入されました。2.0.0より前の版では、ベクタ空間でのインタセクションの計算のみに対応していました。 </p></div><div class="refsection"><a name="idp74986112"></a><h2>例: ジオメトリとラスタ -- ジオメトリと値を得る</h2><pre class="programlisting">SELECT
    foo.rid,
    foo.gid,
    ST_AsText((foo.geomval).geom) As geomwkt,
    (foo.geomval).val
FROM (
    SELECT
        A.rid,
        g.gid,
        ST_Intersection(A.rast, g.geom) As geomval
    FROM dummy_rast AS A
    CROSS JOIN (
        VALUES
            (1, ST_Point(3427928, 5793243.85) ),
            (2, ST_GeomFromText('LINESTRING(3427927.85 5793243.75,3427927.8 5793243.75,3427927.8 5793243.8)')),
            (3, ST_GeomFromText('LINESTRING(1 2, 3 4)'))
    ) As g(gid,geom)
    WHERE A.rid = 2
) As foo;

 rid | gid |      geomwkt                                               | val
-----+-----+---------------------------------------------------------------------------------------------
   2 |   1 | POINT(3427928 5793243.85)                                  | 249
   2 |   1 | POINT(3427928 5793243.85)                                  | 253
   2 |   2 | POINT(3427927.85 5793243.75)                               | 254
   2 |   2 | POINT(3427927.8 5793243.8)                                 | 251
   2 |   2 | POINT(3427927.8 5793243.8)                                 | 253
   2 |   2 | LINESTRING(3427927.8 5793243.75,3427927.8 5793243.8)   | 252
   2 |   2 | MULTILINESTRING((3427927.8 5793243.8,3427927.8 5793243.75),...) | 250
   2 |   3 | GEOMETRYCOLLECTION EMPTY
                    </pre></div><div class="refsection"><a name="idp74987392"></a><h2>関連情報</h2><p><a class="xref" href="#geomval" title="geomval">geomval</a>, <a class="xref" href="#RT_ST_Intersects" title="ST_Intersects">ST_Intersects</a>, <a class="xref" href="#RT_ST_MapAlgebraExpr2" title="ST_MapAlgebraExpr">ST_MapAlgebraExpr</a>, <a class="xref" href="#RT_ST_Clip" title="ST_Clip">ST_Clip</a>, <a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_MapAlgebra"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MapAlgebra (コールバック関数版) — コールバック関数版 - 一つ以上の入力ラスタ、バンドインデクスと一つのユーザ定義コールバック関数から、一つのバンドからなるラスタを返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebra</b>(</code>rastbandarg[]  <var class="pdparam">rastbandargset</var>, regprocedure  <var class="pdparam">callbackfunc</var>, text  <var class="pdparam">pixeltype=NULL</var>, text  <var class="pdparam">extenttype=INTERSECTION</var>, raster  <var class="pdparam">customextent=NULL</var>, integer  <var class="pdparam">distancex=0</var>, integer  <var class="pdparam">distancey=0</var>, text[]  <var class="pdparam">VARIADIC userargs=NULL</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebra</b>(</code>raster  <var class="pdparam">rast</var>, integer[]  <var class="pdparam">nband</var>, regprocedure  <var class="pdparam">callbackfunc</var>, text  <var class="pdparam">pixeltype=NULL</var>, text  <var class="pdparam">extenttype=FIRST</var>, raster  <var class="pdparam">customextent=NULL</var>, integer  <var class="pdparam">distancex=0</var>, integer  <var class="pdparam">distancey=0</var>, text[]  <var class="pdparam">VARIADIC userargs=NULL</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebra</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, regprocedure  <var class="pdparam">callbackfunc</var>, text  <var class="pdparam">pixeltype=NULL</var>, text  <var class="pdparam">extenttype=FIRST</var>, raster  <var class="pdparam">customextent=NULL</var>, integer  <var class="pdparam">distancex=0</var>, integer  <var class="pdparam">distancey=0</var>, text[]  <var class="pdparam">VARIADIC userargs=NULL</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebra</b>(</code>raster  <var class="pdparam">rast1</var>, integer  <var class="pdparam">nband1</var>, raster  <var class="pdparam">rast2</var>, integer  <var class="pdparam">nband2</var>, regprocedure  <var class="pdparam">callbackfunc</var>, text  <var class="pdparam">pixeltype=NULL</var>, text  <var class="pdparam">extenttype=INTERSECTION</var>, raster  <var class="pdparam">customextent=NULL</var>, integer  <var class="pdparam">distancex=0</var>, integer  <var class="pdparam">distancey=0</var>, text[]  <var class="pdparam">VARIADIC userargs=NULL</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebra</b>(</code>raster <var class="pdparam">rast</var>, integer <var class="pdparam">nband</var>, regprocedure  <var class="pdparam">callbackfunc</var>, float8[]  <var class="pdparam">mask</var>, boolean  <var class="pdparam">weighted</var>, text  <var class="pdparam">pixeltype=NULL</var>, text  <var class="pdparam">extenttype=INTERSECTION</var>, raster  <var class="pdparam">customextent=NULL</var>, text[]  <var class="pdparam">VARIADIC userargs=NULL</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp75073664"></a><h2>説明</h2><p>一つ以上の入力ラスタ、バンドインデクスと一つのユーザ定義コールバック関数から、一つのバンドからなるラスタを返します。 </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">rast,rast1,rast2, rastbandargset</span></dt><dd><p>地図代数処理が行われるラスタです。</p><p><code class="varname">rastbandargset</code>によって、多数のラスタと多数のバンドにおいて地図代数処理が使用できます。一つ目の形式の例を見て下さい。 </p></dd><dt><span class="term">nband, nband1, nband2</span></dt><dd><p>処理を行うラスタのバンド番号です。nbandはバンドを示す整数スカラまたは整数配列です。2ラスタ/2バンドの場合では、nband1はrast1のバンド、nband2はrast2のバンドです。 </p></dd><dt><span class="term">callbackfunc</span></dt><dd><p><code class="varname">callbackfunc</code>引数は、SQLまたはPL/pgSQL関数の名前とシグニチャでなければならず、regprocedureにキャストしなければなりません。PL/pgSQL関数の例は次の通りです。</p><pre class="programlisting">
REATE OR REPLACE FUNCTION sample_callbackfunc(value double precision[][][], position integer[][], VARIADIC userargs text[])
    RETURNS double precision
    AS $$
    BEGIN
        RETURN 0;
    END;
    $$ LANGUAGE 'plpgsql' IMMUTABLE;
                                    </pre><p> <code class="varname">callbackfunc</code>は、三つの引数を持たなければなりません。すなわち、3次元倍精度浮動小数点数配列、2次元整数配列、VARIADICの1次元文字列配列です。一つ目の引数<code class="varname">value</code>は、全ての入力ラスタからの値 (倍精度浮動小数点数)の配列です。3次元 (1始まり)は、ラスタ番号、行、列です。二つ目の引数<code class="varname">position</code>は、出力ラスタと入力ラスタからのピクセル位置の集合です。一つ目の次元の添え字 (0はじまりです)はラスタ番号です。一つ目の次元の添え字が0の場合に指される位置は、出力ラスタのピクセル位置です。二つ目の次元はXとYからなる二つの要素を持ちます。三つ目の引数<code class="varname">userargs</code>はユーザ定義関数特有の引数としてそのまま渡されます。 </p><p><span class="type">regprocedure</span>引数をSQL関数に渡すには、完全な関数シグネチャが求められます。<span class="type">regprocedure</span>へのキャストが必要です。上のPL/pgSQL関数を引数として渡すには、引数のSQLは次のようにします。</p><pre class="programlisting">
'sample_callbackfunc(double precision[], integer[], text[])'::regprocedure
                                    </pre><p> 引数は関数名と引数の型を含み、関数名と引数を引用符で括り、かつ<span class="type">regprocedure</span>にキャストする点に注意が必要です。 </p></dd><dt><span class="term">mask</span></dt><dd><p>N次元の数値配列 (行列)で、地図代数コールバック関数に渡すセルを決めるためのフィルタに使われます。0は近隣セル値をNODATAとして扱うべきであることを示し、1はデータとして扱うべきであることをそれぞれ意味します。weightがTRUEに指定されいる場合には、この配列の値は、近隣セルのピクセル値に対して掛け算を行うための数になります。 </p></dd><dt><span class="term">weighted</span></dt><dd><p>マスク値に重みづけを施す (元の値に対して乗算を行う)か、施さない (マスク処理だけを行う)かを示す真偽値です。 </p></dd><dt><span class="term">pixeltype</span></dt><dd><p><code class="varname">pixeltype</code>を渡した場合には、新しいラスタの一つのバンドが、そのピクセルタイプになります。pixeltypeにNULLを渡したり指定しなかった場合には、新しいラスタのピクセルタイプは、一つ目のラスタ (extenttypeがINTERSECTION, UNION, FIRST, CUSTOMの場合)か、適切なラスタ (extenttypeがSECOND, LASTの場合)の指定したバンドと同じピクセルタイプになります。疑問を感じたら常に<code class="varname">pixeltype</code>を渡します。 </p><p>出力ラスタのピクセルタイプは、必ず<a class="xref" href="#RT_ST_BandPixelType" title="ST_BandPixelType">ST_BandPixelType</a>に挙げられたものの一つになるか、省略されるか、NULLに設定されます。 </p></dd><dt><span class="term">extenttype</span></dt><dd><p>INTERSECTION (デフォルト), UNION, FIRST (一つのラスタを取る形式でのデフォルト), SECOND, LAST, CUSTOMのいずれかになります。 </p></dd><dt><span class="term">customextent</span></dt><dd><p><code class="varname">extentype</code>がCUSTOMである場合には、ラスタは<code class="varname">customextent</code>で提供されます。一つ目の形式の例4をご覧下さい。 </p></dd><dt><span class="term">distancex</span></dt><dd><p>参照セルからのピクセル単位の距離です。結果として得られる行列の幅は<code class="code">2*distancex + 1</code>となります。指定しない場合には、参照セルだけが対象となります (0の距離の近隣ピクセル)。 </p></dd><dt><span class="term">distancey</span></dt><dd><p>参照セルからのピクセル単位の距離です。結果として得られる行列の高さは<code class="code">2*distancey + 1</code>となります。指定しない場合には、参照セルが対象となります (0の距離の近隣ピクセル)。 </p></dd><dt><span class="term">userargs</span></dt><dd><p><code class="varname">callbackfunc</code>の三つ目の引数は<span class="type">variadic text</span>配列です。全ての文字列引数は指定された<code class="varname">callbackfunc</code>にそのまま渡され、<code class="varname">userargs</code>引数に含まれます。 </p></dd></dl></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>VARIADICキーワードに関する詳細情報については、PostgreSQL文書と<a class="ulink" href="http://www.postgresql.org/docs/current/static/xfunc-sql.html" target="_top">Query Language (SQL) Functions</a> (訳注: 日本語版は「<a class="ulink" href="http://www.postgresql.jp/document/current/html/xfunc-sql.html" target="_top">問い合わせ言語 （SQL）関数</a>」です)の"SQL Functions with Variable Numbers of Arguments" (訳注: 日本語版は「可変長引数を取るSQL関数」)節を参照して下さい。 </p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">callbackfunc</code>への<span class="type">text[]</span>引数は、あらゆる引数を処理のためにユーザ関数に渡すかどうかの選択にかかわらず求められます。 </p></td></tr></table></div><p>一つ目の形式では、多数のラスタやバンドで地図代数演算が使えるようになるための<code class="varname">rastbandarg</code>配列を受け付けます。一つ目の形式の例をご覧下さい。 </p><p>二つ目と三つ目の形式では、一つのラスタにおける一つ以上のバンドについて演算を行います。二つ目の形式と三つ目の形式の例をご覧下さい。 </p><p>四つ目の形式では、二つのラスタにおいて、それぞれ一つずつのバンドについて演算を行います。四つ目の形式の例をご覧下さい。 </p><p>Availability: 2.2.0: マスクが追加されました。</p><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp75139840"></a><h2>例: 一つ目の形式</h2><p>一つのラスタ、一つのバンド</p><pre class="programlisting">WITH foo AS (
    SELECT 1 AS rid, ST_AddBand(ST_MakeEmptyRaster(2, 2, 0, 0, 1, -1, 0, 0, 0), 1, '16BUI', 1, 0) AS rast
)
SELECT
    ST_MapAlgebra(
        ARRAY[ROW(rast, 1)]::rastbandarg[],
        'sample_callbackfunc(double precision[], int[], text[])'::regprocedure
    ) AS rast
FROM foo
                    </pre><p>一つのラスタ、複数のバンド</p><pre class="programlisting">WITH foo AS (
    SELECT 1 AS rid, ST_AddBand(ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(2, 2, 0, 0, 1, -1, 0, 0, 0), 1, '16BUI', 1, 0), 2, '8BUI', 10, 0), 3, '32BUI', 100, 0) AS rast
)
SELECT
    ST_MapAlgebra(
        ARRAY[ROW(rast, 3), ROW(rast, 1), ROW(rast, 3), ROW(rast, 2)]::rastbandarg[],
        'sample_callbackfunc(double precision[], int[], text[])'::regprocedure
    ) AS rast
FROM foo
                    </pre><p>複数のラスタ、複数のバンド</p><pre class="programlisting">WITH foo AS (
    SELECT 1 AS rid, ST_AddBand(ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(2, 2, 0, 0, 1, -1, 0, 0, 0), 1, '16BUI', 1, 0), 2, '8BUI', 10, 0), 3, '32BUI', 100, 0) AS rast UNION ALL
    SELECT 2 AS rid, ST_AddBand(ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(2, 2, 0, 1, 1, -1, 0, 0, 0), 1, '16BUI', 2, 0), 2, '8BUI', 20, 0), 3, '32BUI', 300, 0) AS rast
)
SELECT
    ST_MapAlgebra(
        ARRAY[ROW(t1.rast, 3), ROW(t2.rast, 1), ROW(t2.rast, 3), ROW(t1.rast, 2)]::rastbandarg[],
        'sample_callbackfunc(double precision[], int[], text[])'::regprocedure
    ) AS rast
FROM foo t1
CROSS JOIN foo t2
WHERE t1.rid = 1
    AND t2.rid = 2
                    </pre><p>近隣ピクセルを併用したカバレッジのタイルの完全な例です。クエリはPostgreSQL 9.1以上でのみ動作します。</p><pre class="programlisting">WITH foo AS (
    SELECT 0 AS rid, ST_AddBand(ST_MakeEmptyRaster(2, 2, 0, 0, 1, -1, 0, 0, 0), 1, '16BUI', 1, 0) AS rast UNION ALL
    SELECT 1, ST_AddBand(ST_MakeEmptyRaster(2, 2, 2, 0, 1, -1, 0, 0, 0), 1, '16BUI', 2, 0) AS rast UNION ALL
    SELECT 2, ST_AddBand(ST_MakeEmptyRaster(2, 2, 4, 0, 1, -1, 0, 0, 0), 1, '16BUI', 3, 0) AS rast UNION ALL

    SELECT 3, ST_AddBand(ST_MakeEmptyRaster(2, 2, 0, -2, 1, -1, 0, 0, 0), 1, '16BUI', 10, 0) AS rast UNION ALL
    SELECT 4, ST_AddBand(ST_MakeEmptyRaster(2, 2, 2, -2, 1, -1, 0, 0, 0), 1, '16BUI', 20, 0) AS rast UNION ALL
    SELECT 5, ST_AddBand(ST_MakeEmptyRaster(2, 2, 4, -2, 1, -1, 0, 0, 0), 1, '16BUI', 30, 0) AS rast UNION ALL

    SELECT 6, ST_AddBand(ST_MakeEmptyRaster(2, 2, 0, -4, 1, -1, 0, 0, 0), 1, '16BUI', 100, 0) AS rast UNION ALL
    SELECT 7, ST_AddBand(ST_MakeEmptyRaster(2, 2, 2, -4, 1, -1, 0, 0, 0), 1, '16BUI', 200, 0) AS rast UNION ALL
    SELECT 8, ST_AddBand(ST_MakeEmptyRaster(2, 2, 4, -4, 1, -1, 0, 0, 0), 1, '16BUI', 300, 0) AS rast
)
SELECT
    t1.rid,
    ST_MapAlgebra(
        ARRAY[ROW(ST_Union(t2.rast), 1)]::rastbandarg[],
        'sample_callbackfunc(double precision[], int[], text[])'::regprocedure,
        '32BUI',
        'CUSTOM', t1.rast,
        1, 1
    ) AS rast
FROM foo t1
CROSS JOIN foo t2
WHERE t1.rid = 4
    AND t2.rid BETWEEN 0 AND 8
    AND ST_Intersects(t1.rast, t2.rast)
GROUP BY t1.rid, t1.rast
                    </pre><p>前の例である近隣ピクセルを併用したカバレッジのタイルに似ていますがPostgreSQL 9.0で動作します。</p><pre class="programlisting">WITH src AS (
    SELECT 0 AS rid, ST_AddBand(ST_MakeEmptyRaster(2, 2, 0, 0, 1, -1, 0, 0, 0), 1, '16BUI', 1, 0) AS rast UNION ALL
    SELECT 1, ST_AddBand(ST_MakeEmptyRaster(2, 2, 2, 0, 1, -1, 0, 0, 0), 1, '16BUI', 2, 0) AS rast UNION ALL
    SELECT 2, ST_AddBand(ST_MakeEmptyRaster(2, 2, 4, 0, 1, -1, 0, 0, 0), 1, '16BUI', 3, 0) AS rast UNION ALL

    SELECT 3, ST_AddBand(ST_MakeEmptyRaster(2, 2, 0, -2, 1, -1, 0, 0, 0), 1, '16BUI', 10, 0) AS rast UNION ALL
    SELECT 4, ST_AddBand(ST_MakeEmptyRaster(2, 2, 2, -2, 1, -1, 0, 0, 0), 1, '16BUI', 20, 0) AS rast UNION ALL
    SELECT 5, ST_AddBand(ST_MakeEmptyRaster(2, 2, 4, -2, 1, -1, 0, 0, 0), 1, '16BUI', 30, 0) AS rast UNION ALL

    SELECT 6, ST_AddBand(ST_MakeEmptyRaster(2, 2, 0, -4, 1, -1, 0, 0, 0), 1, '16BUI', 100, 0) AS rast UNION ALL
    SELECT 7, ST_AddBand(ST_MakeEmptyRaster(2, 2, 2, -4, 1, -1, 0, 0, 0), 1, '16BUI', 200, 0) AS rast UNION ALL
    SELECT 8, ST_AddBand(ST_MakeEmptyRaster(2, 2, 4, -4, 1, -1, 0, 0, 0), 1, '16BUI', 300, 0) AS rast
)
WITH foo AS (
    SELECT
        t1.rid,
        ST_Union(t2.rast) AS rast
    FROM src t1
    JOIN src t2
        ON ST_Intersects(t1.rast, t2.rast)
        AND t2.rid BETWEEN 0 AND 8
    WHERE t1.rid = 4
    GROUP BY t1.rid
), bar AS (
    SELECT
        t1.rid,
        ST_MapAlgebra(
            ARRAY[ROW(t2.rast, 1)]::rastbandarg[],
            'raster_nmapalgebra_test(double precision[], int[], text[])'::regprocedure,
            '32BUI',
            'CUSTOM', t1.rast,
            1, 1
        ) AS rast
    FROM src t1
    JOIN foo t2
        ON t1.rid = t2.rid
)
SELECT
    rid,
    (ST_Metadata(rast)),
    (ST_BandMetadata(rast, 1)),
    ST_Value(rast, 1, 1, 1)
FROM bar;
                    </pre></div><div class="refsection"><a name="idp75145088"></a><h2>例: 二つ目の形式と三つ目の形式</h2><p>一つのラスタ、複数のバンド</p><pre class="programlisting">WITH foo AS (
    SELECT 1 AS rid, ST_AddBand(ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(2, 2, 0, 0, 1, -1, 0, 0, 0), 1, '16BUI', 1, 0), 2, '8BUI', 10, 0), 3, '32BUI', 100, 0) AS rast
)
SELECT
    ST_MapAlgebra(
        rast, ARRAY[3, 1, 3, 2]::integer[],
        'sample_callbackfunc(double precision[], int[], text[])'::regprocedure
    ) AS rast
FROM foo
                    </pre><p>一つのラスタ、一つのバンド</p><pre class="programlisting">WITH foo AS (
    SELECT 1 AS rid, ST_AddBand(ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(2, 2, 0, 0, 1, -1, 0, 0, 0), 1, '16BUI', 1, 0), 2, '8BUI', 10, 0), 3, '32BUI', 100, 0) AS rast
)
SELECT
    ST_MapAlgebra(
        rast, 2,
        'sample_callbackfunc(double precision[], int[], text[])'::regprocedure
    ) AS rast
FROM foo
                    </pre></div><div class="refsection"><a name="idp75147648"></a><h2>例: 四つ目の形式</h2><p>二つのラスタ、二つのバンド</p><pre class="programlisting">WITH foo AS (
    SELECT 1 AS rid, ST_AddBand(ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(2, 2, 0, 0, 1, -1, 0, 0, 0), 1, '16BUI', 1, 0), 2, '8BUI', 10, 0), 3, '32BUI', 100, 0) AS rast UNION ALL
    SELECT 2 AS rid, ST_AddBand(ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(2, 2, 0, 1, 1, -1, 0, 0, 0), 1, '16BUI', 2, 0), 2, '8BUI', 20, 0), 3, '32BUI', 300, 0) AS rast
)
SELECT
    ST_MapAlgebra(
        t1.rast, 2,
        t2.rast, 1,
        'sample_callbackfunc(double precision[], int[], text[])'::regprocedure
    ) AS rast
FROM foo t1
CROSS JOIN foo t2
WHERE t1.rid = 1
    AND t2.rid = 2
                    </pre></div><div class="refsection"><a name="idp75149312"></a><h2>例: マスクの使用</h2><pre class="programlisting">WITH foo AS (SELECT
   ST_SetBandNoDataValue(
ST_SetValue(ST_SetValue(ST_AsRaster(
        ST_Buffer(
            ST_GeomFromText('LINESTRING(50 50,100 90,100 50)'), 5,'join=bevel'),
            200,200,ARRAY['8BUI'], ARRAY[100], ARRAY[0]), ST_Buffer('POINT(70 70)'::geometry,10,'quad_segs=1') ,50),
  'LINESTRING(20 20, 100 100, 150 98)'::geometry,1),0)  AS rast )
SELECT 'original' AS title, rast
FROM foo
UNION ALL
SELECT 'no mask mean value' AS title, ST_MapAlgebra(rast,1,'ST_mean4ma(double precision[], int[], text[])'::regprocedure) AS rast
FROM foo
UNION ALL
SELECT 'mask only consider neighbors, exclude center' AS title, ST_MapAlgebra(rast,1,'ST_mean4ma(double precision[], int[], text[])'::regprocedure,
    '{{1,1,1}, {1,0,1}, {1,1,1}}'::double precision[], false) As rast
FROM foo

UNION ALL
SELECT 'mask weighted only consider neighbors, exclude center multi otehr pixel values by 2' AS title, ST_MapAlgebra(rast,1,'ST_mean4ma(double precision[], int[], text[])'::regprocedure,
    '{{2,2,2}, {2,0,2}, {2,2,2}}'::double precision[], true) As rast
FROM foo;
                    </pre><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col><col></colgroup><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
                                        <p>
                                            </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_mapalgebramask01.png"><div class="caption"><p>original</p></div></div></div><p>
                                        </p>
                                    </td><td style="border-bottom: 1px solid ; ">
                                        <p>
                                            </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_mapalgebramask02.png"><div class="caption"><p>no mask mean value (マスクなし平均値) (マスク配列に全て1があるのと同じ)</p></div></div></div><p>
                                        </p>
                                    </td></tr><tr><td style="border-right: 1px solid ; ">
                                        <p>
                                            </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_mapalgebramask03.png"><div class="caption"><p>mask only consider neighbors, exclude center (近隣セルのみ注目し、中心セルを除くマスク)</p></div></div></div><p>
                                        </p>
                                    </td><td style="">
                                        <p>
                                            </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_mapalgebramask04.png"><div class="caption"><p>mask weighted only consider neighbors, exclude center multi other pixel values by 2 (近隣のみ考慮に入れて中心を除き、2を掛けるウェイトマスク)</p></div></div></div><p>
                                        </p>
                                    </td></tr></tbody></table></div></div><div class="refsection"><a name="idp75181824"></a><h2>関連情報</h2><p><a class="xref" href="#rastbandarg" title="rastbandarg">rastbandarg</a>, <a class="xref" href="#RT_ST_Union" title="ST_Union">ST_Union</a>, <a class="xref" href="#RT_ST_MapAlgebra_expr" title="ST_MapAlgebra (数式版)">ST_MapAlgebra (数式版)</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_MapAlgebra_expr"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MapAlgebra (数式版) — 数式版 - 一つか二つの入力ラスタ、バンド番号、一つ以上のユーザ定義SQL式から一つのバンドを持つラスタを返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebra</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, text  <var class="pdparam">pixeltype</var>, text  <var class="pdparam">expression</var>, double precision  <var class="pdparam">nodataval=NULL</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebra</b>(</code>raster  <var class="pdparam">rast</var>, text  <var class="pdparam">pixeltype</var>, text  <var class="pdparam">expression</var>, double precision  <var class="pdparam">nodataval=NULL</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebra</b>(</code>raster  <var class="pdparam">rast1</var>, integer  <var class="pdparam">nband1</var>, raster  <var class="pdparam">rast2</var>, integer  <var class="pdparam">nband2</var>, text  <var class="pdparam">expression</var>, text  <var class="pdparam">pixeltype=NULL</var>, text  <var class="pdparam">extenttype=INTERSECTION</var>, text  <var class="pdparam">nodata1expr=NULL</var>, text  <var class="pdparam">nodata2expr=NULL</var>, double precision  <var class="pdparam">nodatanodataval=NULL</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebra</b>(</code>raster  <var class="pdparam">rast1</var>, raster  <var class="pdparam">rast2</var>, text  <var class="pdparam">expression</var>, text  <var class="pdparam">pixeltype=NULL</var>, text  <var class="pdparam">extenttype=INTERSECTION</var>, text  <var class="pdparam">nodata1expr=NULL</var>, text  <var class="pdparam">nodata2expr=NULL</var>, double precision  <var class="pdparam">nodatanodataval=NULL</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp75232384"></a><h2>説明</h2><p>数式版 - 一つか二つの入力ラスタ、バンド番号、一つ以上のユーザ定義SQL式から一つのバンドを持つラスタを返します。 </p><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp75233920"></a><h2>説明: 一つ目の形式と二つ目の形式 (一つのラスタ)</h2><p><code class="varname">expression</code>で定義された妥当なPostgreSQL代数演算を入力ラスタ (<code class="varname">rast</code>)に適用して、一つのバンドを持つラスタを生成します。<code class="varname">nband</code>が指定されない場合には、1番バンドと仮定します。新しいラスタは、元のラスタと同じ地理参照、幅、高さになりますが、バンドは一つだけとなります。 </p><p><code class="varname">pixeltype</code>が渡された場合には、新しいラスタのバンドは、そのピクセルタイプになります。pixeltypeにNULLが渡された場合には、新しいラスタは入力<code class="varname">rast</code>のバンドのピクセルタイプと同じになります。 </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="varname">expression</code>のキーワードは次の通りです。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><code class="varname">[rast]</code> - 演算対象ピクセルの値</p></li><li class="listitem"><p><code class="varname">[rast.val]</code> - 演算対象ピクセルの値</p></li><li class="listitem"><p><code class="varname">[rast.x]</code> - 演算対象ピクセルの列 (1始まり)</p></li><li class="listitem"><p><code class="varname">[rast.y]</code> - 演算対象ピクセルの行 (1始まり)</p></li></ol></div></li></ul></div></div><div class="refsection"><a name="idp75243136"></a><h2>説明: 三つ目と四つ目の形式 (二つのラスタ)</h2><p><code class="varname">expression</code>で定義された妥当な二つのバンドへのPostgreSQL代数演算を入力ラスタ (rast1, rast2)に適用して、一つのバンドを持つラスタを生成します。nband1, nband2が指定されない場合には、1番バンドと仮定します。新しいラスタは、一つ目のラスタと同じアラインメント (スケール、スキュー、ピクセル隅)を持ちます。新しいラスタは、<code class="varname">extenttype</code>引数で定義される範囲になります。 </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">expression</span></dt><dd><p>二つのラスタとPostgreSQL定義済み関数/演算子を含むPostgreSQL代数式です。関数と演算子は、二つのピクセルがインタセクトするピクセルの値を定めます。たとえば(([rast1] + [rast2])/2.0)::integerといったふうになります。 </p></dd><dt><span class="term">pixeltype</span></dt><dd><p>出力ラスタのピクセルタイプです。必ず<a class="xref" href="#RT_ST_BandPixelType" title="ST_BandPixelType">ST_BandPixelType</a>に挙げられたものの一つになるか、省略されるか、NULLに設定されます。引数として渡されないかNULLが渡された場合には、一つ目のラスタのピクセルタイプになります。 </p></dd><dt><span class="term">extenttype</span></dt><dd><p>新しいラスタの範囲を制御します。 </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><code class="varname">INTERSECTION</code> - 新しいラスタの範囲は二つのラスタのインタセクトした領域です。これがデフォルトです。 </p></li><li class="listitem"><p><code class="varname">UNION</code> - 新しいラスタの範囲は二つのラスタの結合です。 </p></li><li class="listitem"><p><code class="varname">FIRST</code> - 新しいラスタの範囲は一つ目のラスタと同じです。 </p></li><li class="listitem"><p><code class="varname">SECOND</code> - 新しいラスタの範囲は二つ目のラスタと同じです。 </p></li></ol></div></dd><dt><span class="term">nodata1expr</span></dt><dd><p><code class="varname">rast1</code>がNODATA値で、特にrast2ピクセルに値がある時に、<code class="varname">rast2</code>だけを返すか返すべき値を定義する定数を含む代数式です。 </p></dd><dt><span class="term">nodata2expr</span></dt><dd><p><code class="varname">rast2</code>がNODATA値で、特にrast2ピクセルに値がある時に、<code class="varname">rast1</code>だけを返すか返すべき値を定義する定数を含む代数式です。 </p></dd><dt><span class="term">nodatanodataval</span></dt><dd><p>rast1とrast2のピクセルの両方がNOADTA値になる場合に返すべき定数です。 </p></dd></dl></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>有効な<code class="varname">expression</code>, <code class="varname">nodata1expr</code>, <code class="varname">nodata2expr</code>のキーワードは次の通りです。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><code class="varname">[rast1]</code> - <code class="varname">rast1</code>の演算対象ピクセルの値</p></li><li class="listitem"><p><code class="varname">[rast1.val]</code> - <code class="varname">rast1</code>の演算対象ピクセルの値</p></li><li class="listitem"><p><code class="varname">[rast1.x]</code> - <code class="varname">rast1</code>の演算対象ピクセルの列 (1始まり)</p></li><li class="listitem"><p><code class="varname">[rast1.y]</code> - <code class="varname">rast1</code>の演算対象ピクセルの行 (1始まり)</p></li><li class="listitem"><p><code class="varname">[rast2]</code> - <code class="varname">rast2</code>の演算対象ピクセルの値</p></li><li class="listitem"><p><code class="varname">[rast2.val]</code> - <code class="varname">rast2</code>の演算対象ピクセルの値</p></li><li class="listitem"><p><code class="varname">[rast2.x]</code> - <code class="varname">rast2</code>の演算対象ピクセルの列 (1始まり)</p></li><li class="listitem"><p><code class="varname">[rast2.y]</code> - <code class="varname">rast2</code>の演算対象ピクセルの行 (1始まり)</p></li></ol></div></li></ul></div></div><div class="refsection"><a name="idp75275008"></a><h2>例: 一つ目の形式と二つ目の形式</h2><pre class="programlisting">WITH foo AS (
    SELECT ST_AddBand(ST_MakeEmptyRaster(10, 10, 0, 0, 1, 1, 0, 0, 0), '32BF'::text, 1, -1) AS rast
)
SELECT
    ST_MapAlgebra(rast, 1, NULL, 'ceil([rast]*[rast.x]/[rast.y]+[rast.val])')
FROM foo;
                    </pre></div><div class="refsection"><a name="idp75276288"></a><h2>例: 三つ目の形式と四つ目の形式</h2><pre class="programlisting">WITH foo AS (
    SELECT 1 AS rid, ST_AddBand(ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(2, 2, 0, 0, 1, -1, 0, 0, 0), 1, '16BUI', 1, 0), 2, '8BUI', 10, 0), 3, '32BUI'::text, 100, 0) AS rast UNION ALL
    SELECT 2 AS rid, ST_AddBand(ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(2, 2, 0, 1, 1, -1, 0, 0, 0), 1, '16BUI', 2, 0), 2, '8BUI', 20, 0), 3, '32BUI'::text, 300, 0) AS rast
)
SELECT
    ST_MapAlgebra(
        t1.rast, 2,
        t2.rast, 1,
        '([rast2] + [rast1.val]) / 2'
    ) AS rast
FROM foo t1
CROSS JOIN foo t2
WHERE t1.rid = 1
    AND t2.rid = 2;
                    </pre></div><div class="refsection"><a name="idp75277568"></a><h2>関連情報</h2><p><a class="xref" href="#rastbandarg" title="rastbandarg">rastbandarg</a>, <a class="xref" href="#RT_ST_Union" title="ST_Union">ST_Union</a>, <a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_MapAlgebraExpr"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MapAlgebraExpr — 1バンド版: 入力バンドに対する妥当なPostgreSQL代数演算で形成された、指定したピクセルタイプとなる1バンドラスタを生成します。バンドを指定しない場合には、1番を仮定します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebraExpr</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">band</var>, text  <var class="pdparam">pixeltype</var>, text  <var class="pdparam">expression</var>, double precision  <var class="pdparam">nodataval=NULL</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebraExpr</b>(</code>raster  <var class="pdparam">rast</var>, text  <var class="pdparam">pixeltype</var>, text  <var class="pdparam">expression</var>, double precision  <var class="pdparam">nodataval=NULL</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp75293824"></a><h2>説明</h2><div class="warning"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><a class="xref" href="#RT_ST_MapAlgebraExpr" title="ST_MapAlgebraExpr">ST_MapAlgebraExpr</a> は2.1.0で非推奨になりました。代わりに<a class="xref" href="#RT_ST_MapAlgebra_expr" title="ST_MapAlgebra (数式版)">ST_MapAlgebra (数式版)</a> を使います。 </p></td></tr></table></div><p>入力ラスタ (<code class="varname">rast</code>)に対して<code class="varname">expression</code>で定義される妥当なPostgreSQL代数演算で形成されるラスタを返します。生成されるラスタは指定したピクセルタイプとなる1バンドラスタです。<code class="varname">band</code>を指定しない場合には、1番と仮定します。新しいラスタは、元のラスタと同じ地理参照、幅、高さを持ちますが、一つのバンドしか持ちません。 </p><p><code class="varname">pixeltype</code>が渡された場合には、新しいラスタのバンドは、そのピクセルタイプになります。pixeltypeにNULLが渡された場合には、新しいラスタは入力<code class="varname">rast</code>のバンドのピクセルタイプと同じになります。 </p><p>数式の中では、<code class="varname">[rast]</code>で元のバンドのピクセル値を、<code class="varname">[rast.x]</code>で1始まりの列番号、<code class="varname">[rast.y]</code>で1始まりの行番号を、それぞれ参照することができます。 </p><p>Availability: 2.0.0 </p></div><div class="refsection"><a name="idp75300480"></a><h2>例</h2><p>元のラスタから1バンドラスタを生成します。元のラスタバンドの値について2で割った余りが入ります。</p><pre class="programlisting">ALTER TABLE dummy_rast ADD COLUMN map_rast raster;
UPDATE dummy_rast SET map_rast = ST_MapAlgebraExpr(rast,NULL,'mod([rast]::numeric,2)') WHERE rid = 2;

SELECT
    ST_Value(rast,1,i,j) As origval,
    ST_Value(map_rast, 1, i, j) As mapval
FROM dummy_rast
CROSS JOIN generate_series(1, 3) AS i
CROSS JOIN generate_series(1,3) AS j
WHERE rid = 2;

 origval | mapval
---------+--------
     253 |      1
     254 |      0
     253 |      1
     253 |      1
     254 |      0
     254 |      0
     250 |      0
     254 |      0
     254 |      0
                    </pre><p>ピクセルタイプが2BUIの1バンドラスタを生成します。元のラスタに対して再分類を行った値が入り、NODATA値を0に設定します。</p><pre class="programlisting">ALTER TABLE dummy_rast ADD COLUMN map_rast2 raster;
UPDATE dummy_rast SET
    map_rast2 = ST_MapAlgebraExpr(rast,'2BUI'::text,'CASE WHEN [rast] BETWEEN 100 and 250 THEN 1 WHEN [rast] = 252 THEN 2 WHEN [rast] BETWEEN 253 and 254 THEN 3 ELSE 0 END'::text, '0')
WHERE rid = 2;

SELECT DISTINCT
    ST_Value(rast,1,i,j) As origval,
    ST_Value(map_rast2, 1, i, j) As mapval
FROM dummy_rast
CROSS JOIN generate_series(1, 5) AS i
CROSS JOIN generate_series(1,5) AS j
WHERE rid = 2;

 origval | mapval
---------+--------
     249 |      1
     250 |      1
     251 |
     252 |      2
     253 |      3
     254 |      3

SELECT
    ST_BandPixelType(map_rast2) As b1pixtyp
FROM dummy_rast
WHERE rid = 2;

 b1pixtyp
----------
 2BUI
                    </pre><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col><col></colgroup><tbody><tr><td style="border-right: 1px solid ; ">
                                        <p>
                                            </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_mapalgebraexpr01.png"><div class="caption"><p>元のラスタ (rast_viewカラム)</p></div></div></div><p>
                                        </p>
                                    </td><td style="">
                                        <p>
                                            </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_mapalgebraexpr02.png"><div class="caption"><p>rast_view_ma</p></div></div></div><p>
                                        </p>
                                    </td></tr></tbody></table></div><p>新しいバンドを三つ持つラスタを生成します。元のバンドを三つ持つラスタと同じピクセルタイプです。1番バンドは地図代数関数によって変更され、残りの二つのバンドは値が代わりません。</p><pre class="programlisting">SELECT
    ST_AddBand(
        ST_AddBand(
            ST_AddBand(
                ST_MakeEmptyRaster(rast_view),
                ST_MapAlgebraExpr(rast_view,1,NULL,'tan([rast])*[rast]')
            ),
            ST_Band(rast_view,2)
        ),
        ST_Band(rast_view, 3)
    )  As rast_view_ma
FROM wind
WHERE rid=167;
                    </pre></div><div class="refsection"><a name="idp75312000"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_MapAlgebraExpr2" title="ST_MapAlgebraExpr">ST_MapAlgebraExpr</a>, <a class="xref" href="#RT_ST_MapAlgebraFct" title="ST_MapAlgebraFct">ST_MapAlgebraFct</a>, <a class="xref" href="#RT_ST_BandPixelType" title="ST_BandPixelType">ST_BandPixelType</a>, <a class="xref" href="#RT_ST_GeoReference" title="ST_GeoReference">ST_GeoReference</a>, <a class="xref" href="#RT_ST_Value" title="ST_Value">ST_Value</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_MapAlgebraExpr2"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MapAlgebraExpr — 2バンド版: 二つの入力バンドに対する妥当なPostgreSQL代数演算で形成された、指定したピクセルタイプとなる1バンドラスタを生成します。バンドを指定しない場合には、どちらも1番と仮定します。結果ラスタは、一つ目のラスタのアラインメント (スケール、スキュー、ピクセル角位置)にあわされます。範囲は"extenttype"引数で定義されます。取りうる"extenttype"の値はINTERSECTION, UNION, FIRST, SECONDです。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebraExpr</b>(</code>raster  <var class="pdparam">rast1</var>, raster  <var class="pdparam">rast2</var>, text  <var class="pdparam">expression</var>, text  <var class="pdparam">pixeltype=same_as_rast1_band</var>, text  <var class="pdparam">extenttype=INTERSECTION</var>, text  <var class="pdparam">nodata1expr=NULL</var>, text  <var class="pdparam">nodata2expr=NULL</var>, double precision  <var class="pdparam">nodatanodataval=NULL</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebraExpr</b>(</code>raster  <var class="pdparam">rast1</var>, integer  <var class="pdparam">band1</var>, raster  <var class="pdparam">rast2</var>, integer  <var class="pdparam">band2</var>, text  <var class="pdparam">expression</var>, text  <var class="pdparam">pixeltype=same_as_rast1_band</var>, text  <var class="pdparam">extenttype=INTERSECTION</var>, text  <var class="pdparam">nodata1expr=NULL</var>, text  <var class="pdparam">nodata2expr=NULL</var>, double precision  <var class="pdparam">nodatanodataval=NULL</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp75339264"></a><h2>説明</h2><div class="warning"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><a class="xref" href="#RT_ST_MapAlgebraExpr2" title="ST_MapAlgebraExpr">ST_MapAlgebraExpr</a> は2.1.0で非推奨になりました。代わりに<a class="xref" href="#RT_ST_MapAlgebra_expr" title="ST_MapAlgebra (数式版)">ST_MapAlgebra (数式版)</a> を使います。 </p></td></tr></table></div><p><code class="varname">expression</code>で定義された妥当な二つのバンドへのPostgreSQL代数演算を入力ラスタ (rast1, rast2)に適用して、一つのバンドを持つラスタを生成します。nband1, nband2が指定されない場合には、1番バンドと仮定します。新しいラスタは、一つ目のラスタと同じアラインメント (スケール、スキュー、ピクセル隅)を持ちます。新しいラスタは、<code class="varname">extenttype</code>引数で定義される範囲になります。 </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">expression</span></dt><dd><p>二つのラスタとPostgreSQL定義済み関数/演算子を含むPostgreSQL代数式です。関数と演算子は、二つのピクセルがインタセクトするピクセルの値を定めます。たとえば(([rast1] + [rast2])/2.0)::integerといったふうになります。 </p></dd><dt><span class="term">pixeltype</span></dt><dd><p>出力ラスタのピクセルタイプです。必ず<a class="xref" href="#RT_ST_BandPixelType" title="ST_BandPixelType">ST_BandPixelType</a>に挙げられたものの一つになるか、省略されるか、NULLに設定されます。引数として渡されないかNULLが渡された場合には、一つ目のラスタのピクセルタイプになります。 </p></dd><dt><span class="term">extenttype</span></dt><dd><p>新しいラスタの範囲を制御します。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><code class="varname">INTERSECTION</code> - 新しいラスタの範囲は二つのラスタのインタセクトした領域です。これがデフォルトです。 </p></li><li class="listitem"><p><code class="varname">UNION</code> - 新しいラスタの範囲は二つのラスタの結合です。 </p></li><li class="listitem"><p><code class="varname">FIRST</code> - 新しいラスタの範囲は一つ目のラスタと同じです。 </p></li><li class="listitem"><p><code class="varname">SECOND</code> - 新しいラスタの範囲は二つ目のラスタと同じです。 </p></li></ol></div></dd><dt><span class="term">nodata1expr</span></dt><dd><p><code class="varname">rast1</code>がNODATA値で、特にrast2ピクセルに値がある時に、<code class="varname">rast2</code>だけを返すか返すべき値を定義する定数を含む代数式です。 </p></dd><dt><span class="term">nodata2expr</span></dt><dd><p><code class="varname">rast2</code>がNODATA値で、特にrast2ピクセルに値がある時に、<code class="varname">rast1</code>だけを返すか返すべき値を定義する定数を含む代数式です。 </p></dd><dt><span class="term">nodatanodataval</span></dt><dd><p>rast1とrast2のピクセルの両方がNOADTA値になる場合に返すべき定数です。 </p></dd></dl></div><p><code class="varname">pixeltype</code>が渡された場合には、新しいラスタは、指定されたピクセルタイプのバンドを持ちます。pixeltypeとしてNULLが渡されたりピクセルタイプを指定しない場合には、新しいラスタは<code class="varname">rast1</code>と同じピクセルタイプになります。 </p><p>数式の中で使える語は、元バンドのピクセル値を参照する <code class="varname">[rast1.val]</code>, <code class="varname">[rast2.val]</code>、1始まりの列/行インデクスを参照する<code class="varname">[rast1.x]</code>, <code class="varname">[rast1.y]</code>などです。 </p><p>Availability: 2.0.0 </p></div><div class="refsection"><a name="idp75378176"></a><h2>例: 2バンドの共有と結合</h2><p>元のラスタから1バンドラスタを生成します。元のラスタバンドの値について2で割った余りが入ります。</p><pre class="programlisting">-- ラスタの集合の生成 --
DROP TABLE IF EXISTS fun_shapes;
CREATE TABLE fun_shapes(rid serial PRIMARY KEY, fun_name text, rast raster);

-- 空間参照系をメートル単位のマサチューセッツ平面として、ボストンのまわりの形状を挿入 --\
INSERT INTO fun_shapes(fun_name, rast)
VALUES ('ref', ST_AsRaster(ST_MakeEnvelope(235229, 899970, 237229, 901930,26986),200,200,'8BUI',0,0));

INSERT INTO fun_shapes(fun_name,rast)
WITH ref(rast) AS (SELECT rast FROM fun_shapes WHERE fun_name = 'ref' )
SELECT 'area' AS fun_name, ST_AsRaster(ST_Buffer(ST_SetSRID(ST_Point(236229, 900930),26986), 1000),
            ref.rast,'8BUI', 10, 0) As rast
FROM ref
UNION ALL
SELECT 'rand bubbles',
            ST_AsRaster(
            (SELECT ST_Collect(geom)
    FROM (SELECT ST_Buffer(ST_SetSRID(ST_Point(236229 + i*random()*100, 900930 + j*random()*100),26986), random()*20) As geom
            FROM generate_series(1,10) As i, generate_series(1,10) As j
            ) As foo ), ref.rast,'8BUI', 200, 0)
FROM ref;

-- 共有と結合の生成 --
SELECT  ST_MapAlgebraExpr(
        area.rast, bub.rast, '[rast2.val]', '8BUI', 'INTERSECTION', '[rast2.val]', '[rast1.val]') As interrast,
        ST_MapAlgebraExpr(
            area.rast, bub.rast, '[rast2.val]', '8BUI', 'UNION', '[rast2.val]', '[rast1.val]') As unionrast
FROM
  (SELECT rast FROM fun_shapes WHERE
 fun_name = 'area') As area
CROSS JOIN  (SELECT rast
FROM fun_shapes WHERE
 fun_name = 'rand bubbles') As bub
                    </pre><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col><col></colgroup><tbody><tr><td style="border-right: 1px solid ; ">
                                        <p>
                                            </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_mapalgebraexpr2_01.png"><div class="caption"><p>インタセクションの場合</p></div></div></div><p>
                                        </p>
                                    </td><td style="">
                                        <p>
                                            </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_mapalgebraexpr2_02.png"><div class="caption"><p>結合の場合</p></div></div></div><p>
                                        </p>
                                    </td></tr></tbody></table></div></div><div class="refsection"><a name="idp75387904"></a><h2>例: 別個のバンドとしてキャンバス上にラスタをオーバレイする</h2><pre class="programlisting">-- ST_AsPNGを使って1バンドで灰色に見える画像を作成します --
WITH mygeoms 
    AS ( SELECT 2 As bnum, ST_Buffer(ST_Point(1,5),10) As geom
            UNION ALL
            SELECT 3 AS bnum, 
                ST_Buffer(ST_GeomFromText('LINESTRING(50 50,150 150,150 50)'), 10,'join=bevel') As geom
            UNION ALL
            SELECT 1 As bnum, 
                ST_Buffer(ST_GeomFromText('LINESTRING(60 50,150 150,150 50)'), 5,'join=bevel') As geom
            ),
   -- ジオメトリと1対1に対応するキャンバスを定義
   canvas
    AS (SELECT ST_AddBand(ST_MakeEmptyRaster(200, 
        200, 
        ST_XMin(e)::integer, ST_YMax(e)::integer, 1, -1, 0, 0) , '8BUI'::text,0) As rast
        FROM (SELECT ST_Extent(geom) As e,
                    Max(ST_SRID(geom)) As srid 
                    from mygeoms 
                    ) As foo
            ),
   rbands AS (SELECT ARRAY(SELECT ST_MapAlgebraExpr(canvas.rast, ST_AsRaster(m.geom, canvas.rast, '8BUI', 100),
                 '[rast2.val]', '8BUI', 'FIRST', '[rast2.val]', '[rast1.val]') As rast
                FROM mygeoms AS m CROSS JOIN canvas
                ORDER BY m.bnum) As rasts
                )
          SELECT rasts[1] As rast1 , rasts[2] As rast2, rasts[3] As rast3, ST_AddBand(
                    ST_AddBand(rasts[1],rasts[2]), rasts[3]) As final_rast
            FROM rbands;
                    </pre><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col><col></colgroup><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; ">
                                        <p>
                                            </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_mapalgebraexpr2_04.png"><div class="caption"><p>rast1</p></div></div></div><p>
                                        </p>
                                    </td><td style="border-bottom: 1px solid ; ">
                                        <p>
                                            </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_mapalgebraexpr2_05.png"><div class="caption"><p>rast2</p></div></div></div><p>
                                        </p>
                                    </td></tr><tr><td style="border-right: 1px solid ; ">
                                        <p>
                                            </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_mapalgebraexpr2_06.png"><div class="caption"><p>rast3</p></div></div></div><p>
                                        </p>
                                    </td><td style="">
                                        <p>
                                            </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_mapalgebraexpr2_07.png"><div class="caption"><p>final_rast</p></div></div></div><p>
                                        </p>
                                    </td></tr></tbody></table></div></div><div class="refsection"><a name="idp75403776"></a><h2>例: 選択した区画の2メートル幅境界線を空中写真にオーバレイする</h2><pre class="programlisting">-- 前二つの切り取ったバンドと
-- 3番バンドにジオメトリをオーバレイしたバンドからなる
-- 3バンドのラスタを生成します
-- このクエリはWindows 64ビット版のPostGISで3.6秒かかりました
WITH pr AS
-- 演算の順序の注意: 全てのラスタを必要なピクセル範囲に切り抜いています
(SELECT ST_Clip(rast,ST_Expand(geom,50) ) As rast, g.geom
    FROM aerials.o_2_boston AS r INNER JOIN
-- 対象の区画を結合して、後でインタセクトできる単一ジオメトリを形成します。
        (SELECT ST_Union(ST_Transform(geom,26986)) AS geom
          FROM landparcels WHERE pid IN('0303890000', '0303900000')) As g
        ON ST_Intersects(rast::geometry, ST_Expand(g.geom,50))
),
-- ラスタの破片を結合します
-- ラスタのST_Unionは非常に遅いですがラスタを小さくすれば速度が上がります
-- 先に切り出しておいてから結合しているのはこのためです
prunion AS
(SELECT ST_AddBand(NULL, ARRAY[ST_Union(rast,1),ST_Union(rast,2),ST_Union(rast,3)] ) As clipped,geom
FROM pr
GROUP BY geom)
-- ラスタの破片を結合し、区画境界線のオーバレイも持った
-- 最終のラスタを返します
-- 最初の二つのバンドと3番バンド+ジオメトリの地図代数関数とを追加します
SELECT ST_AddBand(ST_Band(clipped,ARRAY[1,2])
    , ST_MapAlgebraExpr(ST_Band(clipped,3), ST_AsRaster(ST_Buffer(ST_Boundary(geom),2),clipped, '8BUI',250),
     '[rast2.val]', '8BUI', 'FIRST', '[rast2.val]', '[rast1.val]') ) As rast
FROM prunion;
                    </pre><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col></colgroup><tbody><tr><td style="">
                                        <p>
                                            </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_mapalgebraexpr2_08.png"><div class="caption"><p>青線が対象区画の境界です</p></div></div></div><p>
                                        </p>
                                    </td></tr></tbody></table></div></div><div class="refsection"><a name="idp75409920"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_MapAlgebraExpr" title="ST_MapAlgebraExpr">ST_MapAlgebraExpr</a>, <a class="xref" href="#RT_ST_AddBand" title="ST_AddBand">ST_AddBand</a>, <a class="xref" href="#RT_ST_AsPNG" title="ST_AsPNG">ST_AsPNG</a>, <a class="xref" href="#RT_ST_AsRaster" title="ST_AsRaster">ST_AsRaster</a>, <a class="xref" href="#RT_ST_MapAlgebraFct" title="ST_MapAlgebraFct">ST_MapAlgebraFct</a>, <a class="xref" href="#RT_ST_BandPixelType" title="ST_BandPixelType">ST_BandPixelType</a>, <a class="xref" href="#RT_ST_GeoReference" title="ST_GeoReference">ST_GeoReference</a>, <a class="xref" href="#RT_ST_Value" title="ST_Value">ST_Value</a>, <a class="xref" href="#RT_ST_Union" title="ST_Union">ST_Union</a>, <a class="xref" href="#">???</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_MapAlgebraFct"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MapAlgebraFct — 1バンド版 - 入力バンドに対する妥当なPostgreSQL関数で形成された、指定したピクセルタイプとなる1バンドラスタを生成します。バンドを指定しない場合には、1番と仮定します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebraFct</b>(</code>raster <var class="pdparam">rast</var>, regprocedure <var class="pdparam">onerasteruserfunc</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebraFct</b>(</code>raster <var class="pdparam">rast</var>, regprocedure <var class="pdparam">onerasteruserfunc</var>, text[] <var class="pdparam">VARIADIC args</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebraFct</b>(</code>raster <var class="pdparam">rast</var>, text <var class="pdparam">pixeltype</var>, regprocedure <var class="pdparam">onerasteruserfunc</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebraFct</b>(</code>raster <var class="pdparam">rast</var>, text <var class="pdparam">pixeltype</var>, regprocedure <var class="pdparam">onerasteruserfunc</var>, text[] <var class="pdparam">VARIADIC args</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebraFct</b>(</code>raster <var class="pdparam">rast</var>, integer <var class="pdparam">band</var>, regprocedure <var class="pdparam">onerasteruserfunc</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebraFct</b>(</code>raster <var class="pdparam">rast</var>, integer <var class="pdparam">band</var>, regprocedure <var class="pdparam">onerasteruserfunc</var>, text[] <var class="pdparam">VARIADIC args</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebraFct</b>(</code>raster <var class="pdparam">rast</var>, integer <var class="pdparam">band</var>, text <var class="pdparam">pixeltype</var>, regprocedure <var class="pdparam">onerasteruserfunc</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebraFct</b>(</code>raster <var class="pdparam">rast</var>, integer <var class="pdparam">band</var>, text <var class="pdparam">pixeltype</var>, regprocedure <var class="pdparam">onerasteruserfunc</var>, text[] <var class="pdparam">VARIADIC args</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp75454976"></a><h2>説明</h2><div class="warning"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><a class="xref" href="#RT_ST_MapAlgebraFct" title="ST_MapAlgebraFct">ST_MapAlgebraFct</a> は2.1.0で非推奨になりました。代わりに<a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>を使います。 </p></td></tr></table></div><p>入力ラスタ (<code class="varname">rast</code>)に対して<code class="varname">onerasteruserfunc</code>で指定される妥当なPostgreSQL関数で形成されたラスタを返します。生成されるラスタは指定したピクセルタイプとなる1バンドラスタです。<code class="varname">band</code>を指定しない場合には、1番と仮定します。新しいラスタは、元のラスタと同じ地理参照、幅、高さを持ちますが、一つのバンドしか持ちません。</p><p><code class="varname">pixeltype</code>が渡された場合には、新しいラスタのバンドは、そのピクセルタイプになります。pixeltypeにNULLが渡された場合には、新しいラスタは入力<code class="varname">rast</code>のバンドのピクセルタイプと同じになります。</p><p><code class="varname">onerasteruserfunc</code>引数は SQL関数またはPL/pgSQL関数のシグネチャで、regprocedureにキャストします。大変単純で本当に使えないPL/pgSQL関数の例を挙げます。</p><pre class="programlisting">CREATE OR REPLACE FUNCTION simple_function(pixel FLOAT, pos INTEGER[], VARIADIC args TEXT[])
    RETURNS FLOAT
    AS $$ BEGIN
        RETURN 0.0;
    END; $$
    LANGUAGE 'plpgsql' IMMUTABLE;</pre><p> <code class="varname">userfunction</code>は、2または3の引数を受け付けます。すなわち、float8値、任意の整数配列、VARIADIC文字列配列です。第1引数はラスタセルごとの値です (ラスタのデータ型に関係なく)。第2引数は現在の処理セルの位置で、'{x,y}'であらわされます。第3引数は、<a class="xref" href="#RT_ST_MapAlgebraFct" title="ST_MapAlgebraFct">ST_MapAlgebraFct</a>へのパラメータの残っているもの全てが<code class="varname">userfunction</code>に渡されることを示します </p><p><span class="type">regprodedure</span>引数をSQL関数に渡す際は完全な関数シグネチャと<span class="type">regprocedure</span>型へのキャストが求められます。 上のPL/pgSQL関数を引数に取るには、引数のSQLは次のようにします。</p><pre class="programlisting">'simple_function(float,integer[],text[])'::regprocedure</pre><p> 引数は関数名と引数の型を含み、関数名と引数を引用符で括り、かつ<span class="type">regprocedure</span>にキャストする点に注意が必要です。 </p><p><code class="varname">userfunction</code>の第3引数は<span class="type">variadic text</span>配列です。どの<a class="xref" href="#RT_ST_MapAlgebraFct" title="ST_MapAlgebraFct">ST_MapAlgebraFct</a>にもついてくる全ての文字列引数は、指定された<code class="varname">userfunction</code>に、そのまま渡されて、<code class="varname">args</code>引数内に入ります。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>VARIADICキーワードに関する詳細情報については、PostgreSQL文書と<a class="ulink" href="http://www.postgresql.org/docs/current/static/xfunc-sql.html" target="_top">Query Language (SQL) Functions</a> (訳注: 日本語版は「<a class="ulink" href="http://www.postgresql.jp/document/current/html/xfunc-sql.html" target="_top">問い合わせ言語 （SQL）関数</a>」です)の"SQL Functions with Variable Numbers of Arguments" (訳注: 日本語版は「可変長引数を取るSQL関数」)節を参照して下さい。</p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">userfunction</code>への<span class="type">text[]</span>引数は、あらゆる引数を処理のためにユーザ関数に渡すかどうかの選択にかかわらず求められます。</p></td></tr></table></div><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp75481984"></a><h2>例</h2><p>元のラスタから1バンドラスタを生成します。元のラスタバンドの値について2で割った余りが入ります。</p><pre class="programlisting">ALTER TABLE dummy_rast ADD COLUMN map_rast raster;
CREATE FUNCTION mod_fct(pixel float, pos integer[], variadic args text[])
RETURNS float
AS $$
BEGIN
    RETURN pixel::integer % 2;
END;
$$
LANGUAGE 'plpgsql' IMMUTABLE;

UPDATE dummy_rast SET map_rast = ST_MapAlgebraFct(rast,NULL,'mod_fct(float,integer[],text[])'::regprocedure) WHERE rid = 2;

SELECT ST_Value(rast,1,i,j) As origval, ST_Value(map_rast, 1, i, j) As mapval
FROM dummy_rast CROSS JOIN generate_series(1, 3) AS i CROSS JOIN generate_series(1,3) AS j
WHERE rid = 2;

 origval | mapval
---------+--------
     253 |      1
     254 |      0
     253 |      1
     253 |      1
     254 |      0
     254 |      0
     250 |      0
     254 |      0
     254 |      0
                    </pre><p>ピクセルタイプが2BUIの1バンドラスタを生成します。元のラスタに対して再分類を行った値が入り、NODATA値をユーザ関数に渡される引数の値 (0)に設定します。</p><pre class="programlisting">ALTER TABLE dummy_rast ADD COLUMN map_rast2 raster;
CREATE FUNCTION classify_fct(pixel float, pos integer[], variadic args text[])
RETURNS float
AS
$$
DECLARE
    nodata float := 0;
BEGIN
    IF NOT args[1] IS NULL THEN
        nodata := args[1];
    END IF;
    IF pixel &lt; 251 THEN
        RETURN 1;
    ELSIF pixel = 252 THEN
        RETURN 2;
    ELSIF pixel &gt; 252 THEN
        RETURN 3;
    ELSE
        RETURN nodata;
    END IF;
END;
$$
LANGUAGE 'plpgsql';
UPDATE dummy_rast SET map_rast2 = ST_MapAlgebraFct(rast,'2BUI','classify_fct(float,integer[],text[])'::regprocedure, '0') WHERE rid = 2;

SELECT DISTINCT ST_Value(rast,1,i,j) As origval, ST_Value(map_rast2, 1, i, j) As mapval
FROM dummy_rast CROSS JOIN generate_series(1, 5) AS i CROSS JOIN generate_series(1,5) AS j
WHERE rid = 2;

 origval | mapval
---------+--------
     249 |      1
     250 |      1
     251 |
     252 |      2
     253 |      3
     254 |      3

SELECT ST_BandPixelType(map_rast2) As b1pixtyp
FROM dummy_rast WHERE rid = 2;

 b1pixtyp
----------
 2BUI
                    </pre><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col><col></colgroup><tbody><tr><td style="border-right: 1px solid ; "><div class="informalfigure"><div class="mediaobject"><img src="images/st_mapalgebraexpr01.png"><div class="caption"><p>元のラスタ (rast_viewカラム)</p></div></div></div></td><td style=""><div class="informalfigure"><div class="mediaobject"><img src="images/st_mapalgebraexpr02.png"><div class="caption"><p>rast_view_ma</p></div></div></div></td></tr></tbody></table></div><p>新しいバンドを三つ持つラスタを生成します。元のバンドを三つ持つラスタと同じピクセルタイプです。1番バンドは地図代数関数によって変更され、残りの二つのバンドは値が代わりません。</p><pre class="programlisting">CREATE FUNCTION rast_plus_tan(pixel float, pos integer[], variadic args text[])
RETURNS float
AS
$$
BEGIN
    RETURN tan(pixel) * pixel;
END;
$$
LANGUAGE 'plpgsql';

SELECT ST_AddBand(
    ST_AddBand(
        ST_AddBand(
            ST_MakeEmptyRaster(rast_view),
            ST_MapAlgebraFct(rast_view,1,NULL,'rast_plus_tan(float,integer[],text[])'::regprocedure)
        ),
        ST_Band(rast_view,2)
    ),
    ST_Band(rast_view, 3) As rast_view_ma
)
FROM wind
WHERE rid=167;
                    </pre></div><div class="refsection"><a name="idp75491968"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_MapAlgebraExpr" title="ST_MapAlgebraExpr">ST_MapAlgebraExpr</a>, <a class="xref" href="#RT_ST_BandPixelType" title="ST_BandPixelType">ST_BandPixelType</a>, <a class="xref" href="#RT_ST_GeoReference" title="ST_GeoReference">ST_GeoReference</a>, <a class="xref" href="#RT_ST_SetValue" title="ST_SetValue">ST_SetValue</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_MapAlgebraFct2"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MapAlgebraFct — 2バンド版 - 二つの入力バンドに対する妥当なPostgreSQL関数で形成された、指定したピクセルタイプとなる1バンドラスタを生成します。バンドを指定しない場合には、1番と仮定します。"extenttype"のデフォルトはINTERSECTIONです。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebraFct</b>(</code>raster <var class="pdparam">rast1</var>, raster <var class="pdparam">rast2</var>, regprocedure <var class="pdparam">tworastuserfunc</var>, text <var class="pdparam">pixeltype=same_as_rast1</var>, text <var class="pdparam">extenttype=INTERSECTION</var>, text[] <var class="pdparam">VARIADIC userargs</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebraFct</b>(</code>raster <var class="pdparam">rast1</var>, integer <var class="pdparam">band1</var>, raster <var class="pdparam">rast2</var>, integer <var class="pdparam">band2</var>, regprocedure <var class="pdparam">tworastuserfunc</var>, text <var class="pdparam">pixeltype=same_as_rast1</var>, text <var class="pdparam">extenttype=INTERSECTION</var>, text[] <var class="pdparam">VARIADIC userargs</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp75530368"></a><h2>説明</h2><div class="warning"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><a class="xref" href="#RT_ST_MapAlgebraFct2" title="ST_MapAlgebraFct">ST_MapAlgebraFct</a> は2.1.0で非推奨になりました。代わりに<a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>を使います。 </p></td></tr></table></div><p>二つの入力ラスタ (<code class="varname">rast1</code>, <code class="varname">rast2</code>)に対して<code class="varname">tworastuserfunc</code>で指定される妥当なPostgreSQL関数で形成されるラスタを返します。<code class="varname">band1</code>または<code class="varname">band2</code>が指定されていない場合には、1番と仮定します。新しいラスタは、元のラスタと同じ地理参照、幅、高さを持ちますが、一つのバンドしか持ちません。 </p><p><code class="varname">pixeltype</code>が渡された場合には、新しいラスタはそのピクセルタイプのバンドを持ちます。pixelteypeとしてNULLが渡されたりピクセルタイプを指定しない場合には、新しいラスタは<code class="varname">rast1</code>の入力バンドと同じピクセルタイプになります。 </p><p><code class="varname">tworastuserfunc</code>引数はSQL関数またはPL/pgSQL関数のシグネチャで、regprocedureにキャストします。大変単純で本当に使えないPL/pgSQL関数の例を挙げます。</p><pre class="programlisting">CREATE OR REPLACE FUNCTION simple_function_for_two_rasters(pixel1 FLOAT, pixel2 FLOAT, pos INTEGER[], VARIADIC args TEXT[])
    RETURNS FLOAT
    AS $$ BEGIN
        RETURN 0.0;
    END; $$
    LANGUAGE 'plpgsql' IMMUTABLE;</pre><p> <code class="varname">tworastuserfunc</code>は、3または4の引数を受け付けます。すなわち、倍精度浮動小数点数、倍精度浮動小数点数、任意の整数配列、VARIADIC文字列配列です。第1引数は<code class="varname">rast1</code>のラスタセルごとの値です (ラスタのデータ型に関係なく)。第2引数は<code class="varname">rast2</code>のラスタセルごとの値です。第3引数は現在の処理セルの位置で、'{x,y}'であらわされます。第4引数は、<a class="xref" href="#RT_ST_MapAlgebraFct2" title="ST_MapAlgebraFct">ST_MapAlgebraFct</a>へのパラメータの残っているもの全てが<code class="varname">tworastuserfunc</code>に渡されることを示します。 </p><p><span class="type">regprodedure</span>引数をSQL関数に渡す際は完全な関数シグネチャと<span class="type">regprocedure</span>型へのキャストが求められます。上のPL/pgSQL関数を引数に取るには、引数のSQLは次のようにします。</p><pre class="programlisting">'simple_function(double precision, double precision, integer[], text[])'::regprocedure</pre><p> 引数は関数名と引数の型を含み、関数名と引数を引用符で括り、かつ<span class="type">regprocedure</span>にキャストする点に注意が必要です。 </p><p><code class="varname">tworastuserfunc</code>引数は <span class="type">variadic text</span>配列です。どの<a class="xref" href="#RT_ST_MapAlgebraFct2" title="ST_MapAlgebraFct">ST_MapAlgebraFct</a>にもついてくる全ての文字列引数は、指定された<code class="varname">tworastuserfunc</code>に、そのまま渡されて、<code class="varname">userargs</code>引数内に入ります。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>VARIADICキーワードに関する詳細情報については、PostgreSQL文書と<a class="ulink" href="http://www.postgresql.org/docs/current/static/xfunc-sql.html" target="_top">Query Language (SQL) Functions</a> (訳注: 日本語版は「<a class="ulink" href="http://www.postgresql.jp/document/current/html/xfunc-sql.html" target="_top">問い合わせ言語 （SQL）関数</a>」です)の"SQL Functions with Variable Numbers of Arguments" (訳注: 日本語版は「可変長引数を取るSQL関数」)節を参照して下さい。</p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">tworastuserfunc</code>への<span class="type">text[]</span>引数は、あらゆる引数を処理のためにユーザ関数に渡すかどうかの選択にかかわらず求められます。</p></td></tr></table></div><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp75546624"></a><h2>例: 別個のバンドとしてキャンバス上にラスタをオーバレイする</h2><pre class="programlisting">-- ユーザ関数の定義 --
CREATE OR REPLACE FUNCTION raster_mapalgebra_union(
    rast1 double precision,
    rast2 double precision,
    pos integer[],
    VARIADIC userargs text[]
)
    RETURNS double precision
    AS $$
    DECLARE
    BEGIN
        CASE
            WHEN rast1 IS NOT NULL AND rast2 IS NOT NULL THEN
                RETURN ((rast1 + rast2)/2.);
            WHEN rast1 IS NULL AND rast2 IS NULL THEN
                RETURN NULL;
            WHEN rast1 IS NULL THEN
                RETURN rast2;
            ELSE
                RETURN rast1;
        END CASE;

        RETURN NULL;
    END;
    $$ LANGUAGE 'plpgsql' IMMUTABLE COST 1000;

-- ラスタの試験テーブルの用意
DROP TABLE IF EXISTS map_shapes;
CREATE TABLE map_shapes(rid serial PRIMARY KEY, rast raster, bnum integer, descrip text);
INSERT INTO map_shapes(rast,bnum, descrip)
WITH mygeoms
    AS ( SELECT 2 As bnum, ST_Buffer(ST_Point(90,90),30) As geom, 'circle' As descrip
            UNION ALL
            SELECT 3 AS bnum,
                ST_Buffer(ST_GeomFromText('LINESTRING(50 50,150 150,150 50)'), 15) As geom, 'big road' As descrip
            UNION ALL
            SELECT 1 As bnum,
                ST_Translate(ST_Buffer(ST_GeomFromText('LINESTRING(60 50,150 150,150 50)'), 8,'join=bevel'), 10,-6) As geom, 'small road' As descrip
            ),
   -- ジオメトリと1対1に対応するキャンバスを定義
   canvas
    AS ( SELECT ST_AddBand(ST_MakeEmptyRaster(250,
        250,
        ST_XMin(e)::integer, ST_YMax(e)::integer, 1, -1, 0, 0 ) , '8BUI'::text,0) As rast
        FROM (SELECT ST_Extent(geom) As e,
                    Max(ST_SRID(geom)) As srid
                    from mygeoms
                    ) As foo
            )
-- キャンバスとアラインメントの合ったラスタを返します
SELECT ST_AsRaster(m.geom, canvas.rast, '8BUI', 240) As rast, bnum, descrip
                FROM mygeoms AS m CROSS JOIN canvas
UNION ALL
SELECT canvas.rast, 4, 'canvas'
FROM canvas;

-- 1バンド版の地図代数関数を実行し、あとでST_AddBandで集めます
INSERT INTO map_shapes(rast,bnum,descrip)
SELECT ST_AddBand(ST_AddBand(rasts[1], rasts[2]),rasts[3]), 4, 'map bands overlay fct union (canvas)'
    FROM (SELECT ARRAY(SELECT ST_MapAlgebraFct(m1.rast, m2.rast,
            'raster_mapalgebra_union(double precision, double precision, integer[], text[])'::regprocedure, '8BUI', 'FIRST')
                FROM map_shapes As m1 CROSS JOIN map_shapes As m2
    WHERE m1.descrip = 'canvas' AND m2.descrip &lt;&gt; 'canvas' ORDER BY m2.bnum) As rasts) As foo;
                    </pre><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col></colgroup><tbody><tr><td style="">
                                        <p>
                                            </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_mapalgebrafct2_01.png"><div class="caption"><p>バンドオーバレイ (キャンバス)の図 (赤:小さい道 緑:円、青:大きな道)</p></div></div></div><p>
                                        </p>
                                    </td></tr></tbody></table></div></div><div class="refsection"><a name="idp75593472"></a><h2>追加引数を取るユーザ定義関数</h2><pre class="programlisting">CREATE OR REPLACE FUNCTION raster_mapalgebra_userargs(
    rast1 double precision,
    rast2 double precision,
    pos integer[],
    VARIADIC userargs text[]
)
    RETURNS double precision
    AS $$
    DECLARE
    BEGIN
        CASE
            WHEN rast1 IS NOT NULL AND rast2 IS NOT NULL THEN
                RETURN least(userargs[1]::integer,(rast1 + rast2)/2.);
            WHEN rast1 IS NULL AND rast2 IS NULL THEN
                RETURN userargs[2]::integer;
            WHEN rast1 IS NULL THEN
                RETURN greatest(rast2,random()*userargs[3]::integer)::integer;
            ELSE
                RETURN greatest(rast1, random()*userargs[4]::integer)::integer;
        END CASE;

        RETURN NULL;
    END;
    $$ LANGUAGE 'plpgsql' VOLATILE COST 1000;

SELECT ST_MapAlgebraFct(m1.rast, 1, m1.rast, 3,
            'raster_mapalgebra_userargs(double precision, double precision, integer[], text[])'::regprocedure,
                '8BUI', 'INTERSECT', '100','200','200','0')
                FROM map_shapes As m1
    WHERE m1.descrip = 'map bands overlay fct union (canvas)';
                    </pre><p>
                        </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_mapalgebrafct2_02.png"><div class="caption"><p>追加引数を持つユーザ定義関数と同じラスタからの異なるバンド</p></div></div></div><p>
                    </p></div><div class="refsection"><a name="idp75597312"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_MapAlgebraExpr2" title="ST_MapAlgebraExpr">ST_MapAlgebraExpr</a>, <a class="xref" href="#RT_ST_BandPixelType" title="ST_BandPixelType">ST_BandPixelType</a>, <a class="xref" href="#RT_ST_GeoReference" title="ST_GeoReference">ST_GeoReference</a>, <a class="xref" href="#RT_ST_SetValue" title="ST_SetValue">ST_SetValue</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_MapAlgebraFctNgb"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MapAlgebraFctNgb — 1バンド版: ユーザ定義PostgreSQL関数を使用する最近傍地図代数関数です。入力ラスタバンドの近傍の値を与えたPL/pgSQLユーザ定義関数の結果からなるラスタを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebraFctNgb</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">band</var>, text  <var class="pdparam">pixeltype</var>, integer  <var class="pdparam">ngbwidth</var>, integer  <var class="pdparam">ngbheight</var>, regprocedure  <var class="pdparam">onerastngbuserfunc</var>, text  <var class="pdparam">nodatamode</var>, text[]  <var class="pdparam">VARIADIC args</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp75611520"></a><h2>説明</h2><div class="warning"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a> は2.1.0で非推奨になりました。代わりに<a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>を使います。 </p></td></tr></table></div><p>(1バンド版) 入力ラスタバンドの近傍の値を与えたPL/pgSQLユーザ定義関数の結果からなるラスタを返します。ユーザ定義関数は近傍のピクセル値を数の配列として取り、ピクセル毎に、ユーザ定義関数からの結果を返し、現在の対象ピクセルのピクセル値を関数の返り値に置き換えます。 </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">rast</span></dt><dd><p>ユーザ定義関数が評価されるラスタです。</p></dd><dt><span class="term">band</span></dt><dd><p>評価されるラスタのバンド番号です。デフォルトは1です。</p></dd><dt><span class="term">pixeltype</span></dt><dd><p>出力ラスタのピクセルタイプです。<a class="xref" href="#RT_ST_BandPixelType" title="ST_BandPixelType">ST_BandPixelType</a>の一覧にあるものか、指定しないか、NULLを指定します。指定しないかNULLを指定した場合には、<code class="varname">rast</code>のピクセルタイプがデフォルトになります。結果ピクセル値がピクセルタイプが許容する範囲を超える場合には、切り詰められます。</p></dd><dt><span class="term">ngbwidth</span></dt><dd><p>セル単位の近傍の幅です。</p></dd><dt><span class="term">ngbheight</span></dt><dd><p>セル単位の近傍の高さです。</p></dd><dt><span class="term">onerastngbuserfunc</span></dt><dd><p>ラスタの単一バンドの近傍ピクセルに適用されるPL/pgSQLユーザ定義関数です。一つ目の要素は、近傍ピクセルの四角形を表現する数値の2次元配列です。</p></dd><dt><span class="term">nodatamode</span></dt><dd><p>NODATAまたはNULLとなる近傍ピクセルにおける関数に渡す値を定義します。</p><p>'ignore': 近傍で遭遇したNODATA値全てが計算から除外されます。ユーザ定義関数に必ず送られ、ユーザ定義関数が対処方法を決定します。</p><p>'NULL': 近傍で遭遇したNODATA値全てが結果をNULLとします。この場合はユーザ定義関数が呼び出されません。</p><p>'value': 近傍で遭遇したNODATA値全てが参照ピクセル (近傍の中心にあるピクセル)の値に置き換えられます。この値がNODATAになった場合には、'NULL'と同じ挙動を取ります (影響のある近傍について)。</p></dd><dt><span class="term">args</span></dt><dd><p>ユーザ定義関数に渡される引数です。</p></dd></dl></div><p>Availability: 2.0.0 </p></div><div class="refsection"><a name="idp75639552"></a><h2>例</h2><p>単一タイルとしてロードされたカトリーナのラスタを使った例です。<a class="ulink" href="http://trac.osgeo.org/gdal/wiki/frmts_wtkraster.html" target="_top">http://trac.osgeo.org/gdal/wiki/frmts_wtkraster.html</a>に説明があります。また、<a class="xref" href="#RT_ST_Rescale" title="ST_Rescale">ST_Rescale</a>の例で準備を行っています。 </p><pre class="programlisting">--
-- 近傍の値の全てに関する平均を計算する、単純なユーザ定義の「コールバック」関数
--
CREATE OR REPLACE FUNCTION rast_avg(matrix float[][], nodatamode text, variadic args text[])
    RETURNS float AS
    $$
    DECLARE
        _matrix float[][];
        x1 integer;
        x2 integer;
        y1 integer;
        y2 integer;
        sum float;
    BEGIN
        _matrix := matrix;
        sum := 0;
        FOR x in array_lower(matrix, 1)..array_upper(matrix, 1) LOOP
            FOR y in array_lower(matrix, 2)..array_upper(matrix, 2) LOOP
                sum := sum + _matrix[x][y];
            END LOOP;
        END LOOP;
        RETURN (sum*1.0/(array_upper(matrix,1)*array_upper(matrix,2) ))::integer ;
    END;
    $$
LANGUAGE 'plpgsql' IMMUTABLE COST 1000;

-- ラスタに対してX,Y軸でそれぞれ2ピクセル内の平均を計算するようにしています --
SELECT ST_MapAlgebraFctNgb(rast, 1,  '8BUI', 4,4,
        'rast_avg(float[][], text, text[])'::regprocedure, 'NULL', NULL) As nn_with_border
    FROM katrinas_rescaled
    limit 1;
                    </pre><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col><col></colgroup><tbody><tr><td style="border-right: 1px solid ; ">
                                        <p>
                                            </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_mapalgebrafctngb01.png"><div class="caption"><p>ラスタの1番バンド</p></div></div></div><p>
                                        </p>
                                    </td><td style="">
                                        <p>
                                            </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_mapalgebrafctngb02.png"><div class="caption"><p>ピクセル毎に4x4ピクセル内のピクセル平均を計算したラスタ</p></div></div></div><p>
                                        </p>
                                    </td></tr></tbody></table></div></div><div class="refsection"><a name="idp75650432"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_MapAlgebraFct" title="ST_MapAlgebraFct">ST_MapAlgebraFct</a>, <a class="xref" href="#RT_ST_MapAlgebraExpr" title="ST_MapAlgebraExpr">ST_MapAlgebraExpr</a>, <a class="xref" href="#RT_ST_Rescale" title="ST_Rescale">ST_Rescale</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Reclass"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Reclass — 元のラスタから再分類したバンドタイプからなるラスタを生成します。nbandは変更するバンドです。nbandが指定されていない場合には、1と仮定します。他の全てのバンドは変更せずに返します。可視画像の書式としてより単純な描画を行うために、16BUIバンドを8BUIバンドに変換する、等のために使います。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_Reclass</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, text  <var class="pdparam">reclassexpr</var>, text  <var class="pdparam">pixeltype</var>, double precision  <var class="pdparam">nodataval=NULL</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Reclass</b>(</code>raster  <var class="pdparam">rast</var>, reclassarg[]  <var class="pdparam">VARIADIC reclassargset</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Reclass</b>(</code>raster  <var class="pdparam">rast</var>, text  <var class="pdparam">reclassexpr</var>, text  <var class="pdparam">pixeltype</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp75668736"></a><h2>説明</h2><p>入力ラスタ (<code class="varname">rast</code>)に<code class="varname">reclassexpr</code>で定義する妥当なPostgreSQL代数演算子を適用して新しいラスタを生成します。<code class="varname">band</code>が指定されていない場合には、1番と仮定します。新しいラスタは、元のラスタと同じ地理参照、幅、高さを持ちます。指示されていないバンドは変更せずに返ります。妥当な再分類の数式の説明については<a class="xref" href="#reclassarg" title="reclassarg">reclassarg</a>を参照して下さい。</p><p>新しいラスタのバンドは<code class="varname">pixeltype</code>で指定するピクセルタイプになります。<code class="varname">reclassargset</code>を渡した場合は、個々のreclassargが生成されるバンド毎の挙動を定義します。</p><p>Availability: 2.0.0 </p></div><div class="refsection"><a name="idp75672960"></a><h2>基本的な例</h2><p>元ラスタから新しいラスタを生成しますが、2番バンドを8BUIから4BUIに変換して、101-254をNODATA値にします。</p><pre class="programlisting">ALTER TABLE dummy_rast ADD COLUMN reclass_rast raster;
UPDATE dummy_rast SET reclass_rast = ST_Reclass(rast,2,'0-87:1-10, 88-100:11-15, 101-254:0-0', '4BUI',0) WHERE rid = 2;

SELECT i as col, j as row, ST_Value(rast,2,i,j) As origval,
    ST_Value(reclass_rast, 2, i, j) As reclassval,
    ST_Value(reclass_rast, 2, i, j, false) As reclassval_include_nodata
FROM dummy_rast CROSS JOIN generate_series(1, 3) AS i CROSS JOIN generate_series(1,3) AS j
WHERE rid = 2;

 col | row | origval | reclassval | reclassval_include_nodata
-----+-----+---------+------------+---------------------------
   1 |   1 |      78 |          9 |                         9
   2 |   1 |      98 |         14 |                        14
   3 |   1 |     122 |            |                         0
   1 |   2 |      96 |         14 |                        14
   2 |   2 |     118 |            |                         0
   3 |   2 |     180 |            |                         0
   1 |   3 |      99 |         15 |                        15
   2 |   3 |     112 |            |                         0
   3 |   3 |     169 |            |                         0
                    </pre></div><div class="refsection"><a name="idp75674624"></a><h2>例: 複数の再分類を使った高度な例</h2><p>元ラスタから新しいラスタを生成しますが、1番、2番、3番バンドを1BB, 4BUI, 4BUIにそれぞれ変換して再分類します。再分類の識別番号 (理論的には元ラスタと同数のバンド)を入力するために取るVARIADIC reclassarg引数を使っています。 </p><pre class="programlisting">UPDATE dummy_rast SET reclass_rast =
    ST_Reclass(rast,
        ROW(2,'0-87]:1-10, (87-100]:11-15, (101-254]:0-0', '4BUI',NULL)::reclassarg,
        ROW(1,'0-253]:1, 254:0', '1BB', NULL)::reclassarg,
        ROW(3,'0-70]:1, (70-86:2, [86-150):3, [150-255:4', '4BUI', NULL)::reclassarg
        ) WHERE rid = 2;

SELECT i as col, j as row,ST_Value(rast,1,i,j) As ov1,  ST_Value(reclass_rast, 1, i, j) As rv1,
    ST_Value(rast,2,i,j) As ov2, ST_Value(reclass_rast, 2, i, j) As rv2,
    ST_Value(rast,3,i,j) As ov3, ST_Value(reclass_rast, 3, i, j) As rv3
FROM dummy_rast CROSS JOIN generate_series(1, 3) AS i CROSS JOIN generate_series(1,3) AS j
WHERE rid = 2;

col | row | ov1 | rv1 | ov2 | rv2 | ov3 | rv3
----+-----+-----+-----+-----+-----+-----+-----
  1 |   1 | 253 |   1 |  78 |   9 |  70 |   1
  2 |   1 | 254 |   0 |  98 |  14 |  86 |   3
  3 |   1 | 253 |   1 | 122 |   0 | 100 |   3
  1 |   2 | 253 |   1 |  96 |  14 |  80 |   2
  2 |   2 | 254 |   0 | 118 |   0 | 108 |   3
  3 |   2 | 254 |   0 | 180 |   0 | 162 |   4
  1 |   3 | 250 |   1 |  99 |  15 |  90 |   3
  2 |   3 | 254 |   0 | 112 |   0 | 108 |   3
  3 |   3 | 254 |   0 | 169 |   0 | 175 |   4
                    </pre></div><div class="refsection"><a name="idp75676288"></a><h2>例: 単一バンドで32BFのラスタをの可視ラスタへの高度な対応付け</h2><p>32BFバンドを一つ持つだけのラスタから三つのバンド (8BUI, 8BUI, 8BUI可視ラスタ)を生成します。 </p><pre class="programlisting">ALTER TABLE wind ADD COLUMN rast_view raster;
UPDATE wind
    set rast_view = ST_AddBand( NULL,
        ARRAY[
    ST_Reclass(rast, 1,'0.1-10]:1-10,9-10]:11,(11-33:0'::text, '8BUI'::text,0),
    ST_Reclass(rast,1, '11-33):0-255,[0-32:0,(34-1000:0'::text, '8BUI'::text,0),
    ST_Reclass(rast,1,'0-32]:0,(32-100:100-255'::text, '8BUI'::text,0)
    ]
    );
                    </pre></div><div class="refsection"><a name="idp75690240"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_AddBand" title="ST_AddBand">ST_AddBand</a>, <a class="xref" href="#RT_ST_Band" title="ST_Band">ST_Band</a>, <a class="xref" href="#RT_ST_BandPixelType" title="ST_BandPixelType">ST_BandPixelType</a>, <a class="xref" href="#RT_ST_MakeEmptyRaster" title="ST_MakeEmptyRaster">ST_MakeEmptyRaster</a>, <a class="xref" href="#reclassarg" title="reclassarg">reclassarg</a>, <a class="xref" href="#RT_ST_Value" title="ST_Value">ST_Value</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Union"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Union — ラスタタイルの集合を結合して1以上のバンドからなる単一ラスタを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_Union</b>(</code>setof raster  <var class="pdparam">rast</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Union</b>(</code>setof raster  <var class="pdparam">rast</var>, unionarg[]  <var class="pdparam">unionargset</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Union</b>(</code>setof raster <var class="pdparam">rast</var>, integer <var class="pdparam">nband</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Union</b>(</code>setof raster <var class="pdparam">rast</var>, text <var class="pdparam">uniontype</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Union</b>(</code>setof raster <var class="pdparam">rast</var>, integer <var class="pdparam">nband</var>, text <var class="pdparam">uniontype</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp75711872"></a><h2>説明</h2><p>ラスタタイルの集合を結合して少なくとも一つのバンドからなる単一ラスタを返します。結果ラスタの範囲は集合全体の範囲です。インタセクトする場合には、結果値は、LAST (デフォルト), FIRST, MIN, MAX, COUNT, SUM, MEAN, RANGEのいずれかとなる<code class="varname">uniontype</code>で定義されます。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ラスタを結合するには、全てが同じアラインメントを持たなくてはなりません。<a class="xref" href="#RT_ST_SameAlignment" title="ST_SameAlignment">ST_SameAlignment</a>と<a class="xref" href="#RT_ST_NotSameAlignmentReason" title="ST_NotSameAlignmentReason">ST_NotSameAlignmentReason</a>で詳細情報や助けとなる情報が得られます。アラインメント問題を修正する一つの方法として、<a class="xref" href="#RT_ST_Resample" title="ST_Resample">ST_Resample</a>を使い、アラインメントの同じ参照ラスタを使います。</p></td></tr></table></div><p>Availability: 2.0.0 </p><p>Enhanced: 2.1.0 速度が改善されました (完全にC言語で記述しました)</p><p>Availability: 2.1.0 ST_Union(rast, unionarg)の形式が導入されました。</p><p>Enhanced: 2.1.0 ST_Union(rast) (一つ目の形式)で、全ての入力ラスタの全てのバンドを結合するようになりました。以前の版のPostGISでは、一つ目のバンドと仮定していました。</p><p>Enhanced: 2.1.0 ST_Union(rast, uniontype) (四つ目の形式)で、全ての入力ラスタの全てのバンドを結合するようになりました。</p></div><div class="refsection"><a name="idp75717248"></a><h2>例: 塊になっているラスタタイルの単一バンドへの再構成</h2><pre class="programlisting">-- ファイルシステムタイルの1番バンドから新しい単一バンドを生成します
SELECT filename, ST_Union(rast,1) As file_rast
FROM sometable WHERE filename IN('dem01', 'dem02') GROUP BY filename;
                    </pre></div><div class="refsection"><a name="idp75718528"></a><h2>例: タイルのジオメトリとインタセクトするタイルを結合した複数バンドのラスタ</h2><pre class="programlisting">-- ラインとインタセクトするタイルを結合した複数バンドラスタを生成します
-- ご注意: 2.0では、単一バンドのラスタを帰すだけです
--   これはunionargで
--   ARRAY[ROW(1, 'LAST'), ROW(2, 'LAST'), ROW(3, 'LAST')]::unionarg[]
--   を指定するのと同じです。
SELECT ST_Union(rast)
FROM aerials.boston
WHERE ST_Intersects(rast,  ST_GeomFromText('LINESTRING(230486 887771, 230500 88772)',26986) );
                    </pre></div><div class="refsection"><a name="idp75719808"></a><h2>例: タイルのジオメトリとインタセクトするタイルを結合した複数バンドのラスタ</h2><p>バンドの部分集合が欲しいだけの場合や、バンドの並び順を変更したい場合には、より長い書き方にします。</p><pre class="programlisting">-- ラインとインタセクトするタイルを結合した複数バンドラスタを生成します
SELECT ST_Union(rast,ARRAY[ROW(2, 'LAST'), ROW(1, 'LAST'), ROW(3, 'LAST')]::unionarg[])
FROM aerials.boston
WHERE ST_Intersects(rast,  ST_GeomFromText('LINESTRING(230486 887771, 230500 88772)',26986) );
                    </pre></div><div class="refsection"><a name="idp75721728"></a><h2>関連情報</h2><p><a class="xref" href="#unionarg" title="unionarg">unionarg</a>, <a class="xref" href="#RT_ST_Envelope" title="ST_Envelope">ST_Envelope</a>, <a class="xref" href="#RT_ST_ConvexHull" title="ST_ConvexHull">ST_ConvexHull</a>, <a class="xref" href="#RT_ST_Clip" title="ST_Clip">ST_Clip</a>, <a class="xref" href="#">???</a> </p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Raster_Processing_MapAlgebra_Callbacks"></a>12.13. 組み込み地図代数コールバック関数</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#RT_ST_Distinct4ma">ST_Distinct4ma</a></span><span class="refpurpose"> — 近隣のピクセル値のうち一意となるものを数えるラスタ処理関数です。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_InvDistWeight4ma">ST_InvDistWeight4ma</a></span><span class="refpurpose"> — 近隣のピクセル値の内挿補間を行うラスタ処理関数です。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Max4ma">ST_Max4ma</a></span><span class="refpurpose"> — 近隣のピクセル値の最大値を計算するラスタ処理関数です。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Mean4ma">ST_Mean4ma</a></span><span class="refpurpose"> — 近隣のピクセル値の平均値を計算するラスタ処理関数です。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Min4ma">ST_Min4ma</a></span><span class="refpurpose"> — 近隣のピクセル値の最小値を計算するラスタ処理関数です。 </span></dt><dt><span class="refentrytitle"><a href="#RT_ST_MinDist4ma">ST_MinDist4ma</a></span><span class="refpurpose"> — 対象ピクセルと値を持つ近隣ピクセルとの最短距離をピクセル単位で返すラスタ処理関数です。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Range4ma">ST_Range4ma</a></span><span class="refpurpose"> — 近隣のピクセル値の範囲を計算するラスタ処理関数です。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_StdDev4ma">ST_StdDev4ma</a></span><span class="refpurpose"> — 近隣のピクセル値の標準偏差を計算するラスタ処理関数です。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Sum4ma">ST_Sum4ma</a></span><span class="refpurpose"> — 近隣のピクセル値の合計を計算するラスタ処理関数です。</span></dt></dl></div><div class="refentry"><a name="RT_ST_Distinct4ma"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Distinct4ma — 近隣のピクセル値のうち一意となるものを数えるラスタ処理関数です。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float8 <b class="fsfunc">ST_Distinct4ma</b>(</code>float8[][] <var class="pdparam">matrix</var>, text <var class="pdparam">nodatamode</var>, text[] <var class="pdparam">VARIADIC args</var><code>)</code>;</p><p><code class="funcdef">double precision <b class="fsfunc">ST_Distinct4ma</b>(</code>double precision[][][] <var class="pdparam">value</var>, integer[][]  <var class="pdparam">pos</var>, text[] <var class="pdparam">VARIADIC userargs</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp75740672"></a><h2>説明</h2><p>近隣のピクセル値のうち一意となるものを数えます。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>一つ目の形式は、<a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a>へのコールバック引数として使用する専用コールバック関数です。</p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>二つ目の形式は、<a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>へのコールバック引数として使用する専用コールバック関数です。 </p></td></tr></table></div><div class="warning"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>一つ目の形式は、<a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a>が2.1.0で非推奨となったので、使用しないようになります。 </p></td></tr></table></div><p>Availability: 2.0.0</p><p>Enhanced: 2.1.0 二つ目の形式の追加</p></div><div class="refsection"><a name="idp75746048"></a><h2>例</h2><pre class="programlisting">SELECT
    rid,
    st_value(
        st_mapalgebrafctngb(rast, 1, NULL, 1, 1, 'st_distinct4ma(float[][],text,text[])'::regprocedure, 'ignore', NULL), 2, 2
    )
FROM dummy_rast
WHERE rid = 2;
 rid | st_value
-----+----------
   2 |        3
(1 row)
                </pre></div><div class="refsection"><a name="idp75747328"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a>, <a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>, <a class="xref" href="#RT_ST_Min4ma" title="ST_Min4ma">ST_Min4ma</a>, <a class="xref" href="#RT_ST_Max4ma" title="ST_Max4ma">ST_Max4ma</a>, <a class="xref" href="#RT_ST_Sum4ma" title="ST_Sum4ma">ST_Sum4ma</a>, <a class="xref" href="#RT_ST_Mean4ma" title="ST_Mean4ma">ST_Mean4ma</a>, <a class="xref" href="#RT_ST_Distinct4ma" title="ST_Distinct4ma">ST_Distinct4ma</a>, <a class="xref" href="#RT_ST_StdDev4ma" title="ST_StdDev4ma">ST_StdDev4ma</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_InvDistWeight4ma"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_InvDistWeight4ma — 近隣のピクセル値の内挿補間を行うラスタ処理関数です。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">double precision <b class="fsfunc">ST_InvDistWeight4ma</b>(</code>double precision[][][] <var class="pdparam">value</var>, integer[][] <var class="pdparam">pos</var>, text[] <var class="pdparam">VARIADIC userargs</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp75757952"></a><h2>説明</h2><p>近隣のピクセル値の逆距離加重法 (IDW=Inverse Distance Weighted method)による内挿補間を行います。</p><p><code class="varname">userargsに</code>渡される、二つの任意引数があります。一つ目は、逆距離加重法の式に与える0から1の間を取る冪数 (下の式の変数k)です。指定しない場合には、デフォルトは1とします。二つ目は、対象ピクセルの値が近隣セルからの補間値に含まれている場合にのみ適用される重み率です。指定せず、かつ対象ピクセルが値を持っている場合には、そのピクセルの持つ値が返されます。 </p><p>基本的な逆距離加重法の方程式は次の通りです。 </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_invdistweight4ma_equation.png"><div class="caption"><p>k = 冪数で、0から1の浮動小数点数を取ります。 </p></div></div></div><p>
                </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数は<a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>へのコールバック引数として使用する専用コールバック関数です。</p></td></tr></table></div><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp75764224"></a><h2>例</h2><pre class="programlisting">-- 例が必要
                </pre></div><div class="refsection"><a name="idp75765504"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>, <a class="xref" href="#RT_ST_MinDist4ma" title="ST_MinDist4ma">ST_MinDist4ma</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Max4ma"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Max4ma — 近隣のピクセル値の最大値を計算するラスタ処理関数です。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float8 <b class="fsfunc">ST_Max4ma</b>(</code>float8[][] <var class="pdparam">matrix</var>, text <var class="pdparam">nodatamode</var>, text[] <var class="pdparam">VARIADIC args</var><code>)</code>;</p><p><code class="funcdef">double precision <b class="fsfunc">ST_Max4ma</b>(</code>double precision[][][] <var class="pdparam">value</var>, integer[][]  <var class="pdparam">pos</var>, text[] <var class="pdparam">VARIADIC userargs</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp75782144"></a><h2>説明</h2><p>近隣のピクセル値の最大値を計算します。</p><p>二つ目の形式では、userargsに渡す値でNODATAピクセルに代入する値を指定できます。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>一つ目の形式は、<a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a>へのコールバック引数として使用する専用コールバック関数です。</p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>二つ目の形式は、<a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>へのコールバック引数として使用する専用コールバック関数です。 </p></td></tr></table></div><div class="warning"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>一つ目の形式は、<a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a>が2.1.0で非推奨となったので、使用しないようになります。 </p></td></tr></table></div><p>Availability: 2.0.0</p><p>Enhanced: 2.1.0 二つ目の形式の追加</p></div><div class="refsection"><a name="idp75787904"></a><h2>例</h2><pre class="programlisting">SELECT
    rid,
    st_value(
        st_mapalgebrafctngb(rast, 1, NULL, 1, 1, 'st_max4ma(float[][],text,text[])'::regprocedure, 'ignore', NULL), 2, 2
    )
FROM dummy_rast
WHERE rid = 2;
 rid | st_value
-----+----------
   2 |      254
(1 row)
                </pre></div><div class="refsection"><a name="idp75789184"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a>, <a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>, <a class="xref" href="#RT_ST_Min4ma" title="ST_Min4ma">ST_Min4ma</a>, <a class="xref" href="#RT_ST_Sum4ma" title="ST_Sum4ma">ST_Sum4ma</a>, <a class="xref" href="#RT_ST_Mean4ma" title="ST_Mean4ma">ST_Mean4ma</a>, <a class="xref" href="#RT_ST_Range4ma" title="ST_Range4ma">ST_Range4ma</a>, <a class="xref" href="#RT_ST_Distinct4ma" title="ST_Distinct4ma">ST_Distinct4ma</a>, <a class="xref" href="#RT_ST_StdDev4ma" title="ST_StdDev4ma">ST_StdDev4ma</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Mean4ma"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Mean4ma — 近隣のピクセル値の平均値を計算するラスタ処理関数です。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float8 <b class="fsfunc">ST_Mean4ma</b>(</code>float8[][] <var class="pdparam">matrix</var>, text <var class="pdparam">nodatamode</var>, text[] <var class="pdparam">VARIADIC args</var><code>)</code>;</p><p><code class="funcdef">double precision <b class="fsfunc">ST_Mean4ma</b>(</code>double precision[][][] <var class="pdparam">value</var>, integer[][]  <var class="pdparam">pos</var>, text[] <var class="pdparam">VARIADIC userargs</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp75804032"></a><h2>説明</h2><p>近隣のピクセル値の平均値を計算します。</p><p>二つ目の形式では、userargsに渡す値でNODATAピクセルに代入する値を指定できます。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>一つ目の形式は、<a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a>へのコールバック引数として使用する専用コールバック関数です。</p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>二つ目の形式は、<a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>へのコールバック引数として使用する専用コールバック関数です。 </p></td></tr></table></div><div class="warning"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>一つ目の形式は、<a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a>が2.1.0で非推奨となったので、使用しないようになります。 </p></td></tr></table></div><p>Availability: 2.0.0</p><p>Enhanced: 2.1.0 二つ目の形式の追加</p></div><div class="refsection"><a name="idp75809792"></a><h2>例: 一つ目の形式</h2><pre class="programlisting">SELECT
    rid,
    st_value(
        st_mapalgebrafctngb(rast, 1, '32BF', 1, 1, 'st_mean4ma(float[][],text,text[])'::regprocedure, 'ignore', NULL), 2, 2
    )
FROM dummy_rast
WHERE rid = 2;
 rid |     st_value
-----+------------------
   2 | 253.222229003906
(1 row)
                </pre></div><div class="refsection"><a name="idp75811072"></a><h2>例: 二つ目の形式</h2><pre class="programlisting">SELECT
    rid,
    st_value(
              ST_MapAlgebra(rast, 1, 'st_mean4ma(double precision[][][], integer[][], text[])'::regprocedure,'32BF', 'FIRST', NULL, 1, 1)
       ,  2, 2)
  FROM dummy_rast
   WHERE rid = 2;
 rid |     st_value
-----+------------------
   2 | 253.222229003906
(1 row)</pre></div><div class="refsection"><a name="idp75816448"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a>, <a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>, <a class="xref" href="#RT_ST_Min4ma" title="ST_Min4ma">ST_Min4ma</a>, <a class="xref" href="#RT_ST_Max4ma" title="ST_Max4ma">ST_Max4ma</a>, <a class="xref" href="#RT_ST_Sum4ma" title="ST_Sum4ma">ST_Sum4ma</a>, <a class="xref" href="#RT_ST_Range4ma" title="ST_Range4ma">ST_Range4ma</a>, <a class="xref" href="#RT_ST_StdDev4ma" title="ST_StdDev4ma">ST_StdDev4ma</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Min4ma"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Min4ma — 近隣のピクセル値の最小値を計算するラスタ処理関数です。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float8 <b class="fsfunc">ST_Min4ma</b>(</code>float8[][] <var class="pdparam">matrix</var>, text  <var class="pdparam">nodatamode</var>, text[] <var class="pdparam">VARIADIC args</var><code>)</code>;</p><p><code class="funcdef">double precision <b class="fsfunc">ST_Min4ma</b>(</code>double precision[][][] <var class="pdparam">value</var>, integer[][]  <var class="pdparam">pos</var>, text[] <var class="pdparam">VARIADIC userargs</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp75843200"></a><h2>説明</h2><p>近隣のピクセル値の最小値を計算します。 </p><p>二つ目の形式では、userargsに渡す値でNODATAピクセルに代入する値を指定できます。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>一つ目の形式は、<a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a>へのコールバック引数として使用する専用コールバック関数です。 </p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>二つ目の形式は、<a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>へのコールバック引数として使用する専用コールバック関数です。 </p></td></tr></table></div><div class="warning"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>一つ目の形式は、<a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a>が2.1.0で非推奨となったので、使用しないようになります。 </p></td></tr></table></div><p>Availability: 2.0.0</p><p>Enhanced: 2.1.0 二つ目の形式の追加</p></div><div class="refsection"><a name="idp75848960"></a><h2>例</h2><pre class="programlisting">SELECT
    rid,
    st_value(
        st_mapalgebrafctngb(rast, 1, NULL, 1, 1, 'st_min4ma(float[][],text,text[])'::regprocedure, 'ignore', NULL), 2, 2
    )
FROM dummy_rast
WHERE rid = 2;
 rid | st_value
-----+----------
   2 |      250
(1 row)
                </pre></div><div class="refsection"><a name="idp75850240"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a>, <a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>, <a class="xref" href="#RT_ST_Max4ma" title="ST_Max4ma">ST_Max4ma</a>, <a class="xref" href="#RT_ST_Sum4ma" title="ST_Sum4ma">ST_Sum4ma</a>, <a class="xref" href="#RT_ST_Mean4ma" title="ST_Mean4ma">ST_Mean4ma</a>, <a class="xref" href="#RT_ST_Range4ma" title="ST_Range4ma">ST_Range4ma</a>, <a class="xref" href="#RT_ST_Distinct4ma" title="ST_Distinct4ma">ST_Distinct4ma</a>, <a class="xref" href="#RT_ST_StdDev4ma" title="ST_StdDev4ma">ST_StdDev4ma</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_MinDist4ma"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MinDist4ma — 対象ピクセルと値を持つ近隣ピクセルとの最短距離をピクセル単位で返すラスタ処理関数です。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">double precision <b class="fsfunc">ST_MinDist4ma</b>(</code>double precision[][][] <var class="pdparam">value</var>, integer[][] <var class="pdparam">pos</var>, text[] <var class="pdparam">VARIADIC userargs</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp75873152"></a><h2>説明</h2><p>対象ピクセルと値を持つ近隣ピクセルとの最短距離をピクセル単位で返します。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数の意図は、<a class="xref" href="#RT_ST_InvDistWeight4ma" title="ST_InvDistWeight4ma">ST_InvDistWeight4ma</a>から対象ピクセルの内挿補間された値の有用性を判断することを補助するのに有益なデータポイントを提供することです。この関数は近隣セルの密度が小さい時に特に使えます。 </p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数は<a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>へのコールバック引数として使用する専用コールバック関数です。</p></td></tr></table></div><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp75876992"></a><h2>例</h2><pre class="programlisting">-- 例が必要
                </pre></div><div class="refsection"><a name="idp75878272"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>, <a class="xref" href="#RT_ST_InvDistWeight4ma" title="ST_InvDistWeight4ma">ST_InvDistWeight4ma</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Range4ma"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Range4ma — 近隣のピクセル値の範囲を計算するラスタ処理関数です。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float8 <b class="fsfunc">ST_Range4ma</b>(</code>float8[][] <var class="pdparam">matrix</var>, text <var class="pdparam">nodatamode</var>, text[] <var class="pdparam">VARIADIC args</var><code>)</code>;</p><p><code class="funcdef">double precision <b class="fsfunc">ST_Range4ma</b>(</code>double precision[][][] <var class="pdparam">value</var>, integer[][]  <var class="pdparam">pos</var>, text[] <var class="pdparam">VARIADIC userargs</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp75890816"></a><h2>説明</h2><p>近隣のピクセル値の範囲を計算します。</p><p>二つ目の形式では、userargsに渡す値でNODATAピクセルに代入する値を指定できます。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>一つ目の形式は、<a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a>へのコールバック引数として使用する専用コールバック関数です。</p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>二つ目の形式は、<a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>へのコールバック引数として使用する専用コールバック関数です。 </p></td></tr></table></div><div class="warning"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>一つ目の形式は、<a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a>が2.1.0で非推奨となったので、使用しないようになります。 </p></td></tr></table></div><p>Availability: 2.0.0</p><p>Enhanced: 2.1.0 二つ目の形式の追加</p></div><div class="refsection"><a name="idp75896576"></a><h2>例</h2><pre class="programlisting">SELECT
    rid,
    st_value(
        st_mapalgebrafctngb(rast, 1, NULL, 1, 1, 'st_range4ma(float[][],text,text[])'::regprocedure, 'ignore', NULL), 2, 2
    )
FROM dummy_rast
WHERE rid = 2;
 rid | st_value
-----+----------
   2 |        4
(1 row)
                </pre></div><div class="refsection"><a name="idp75897856"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a>, <a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>, <a class="xref" href="#RT_ST_Min4ma" title="ST_Min4ma">ST_Min4ma</a>, <a class="xref" href="#RT_ST_Max4ma" title="ST_Max4ma">ST_Max4ma</a>, <a class="xref" href="#RT_ST_Sum4ma" title="ST_Sum4ma">ST_Sum4ma</a>, <a class="xref" href="#RT_ST_Mean4ma" title="ST_Mean4ma">ST_Mean4ma</a>, <a class="xref" href="#RT_ST_Distinct4ma" title="ST_Distinct4ma">ST_Distinct4ma</a>, <a class="xref" href="#RT_ST_StdDev4ma" title="ST_StdDev4ma">ST_StdDev4ma</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_StdDev4ma"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_StdDev4ma — 近隣のピクセル値の標準偏差を計算するラスタ処理関数です。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float8 <b class="fsfunc">ST_StdDev4ma</b>(</code>float8[][] <var class="pdparam">matrix</var>, text  <var class="pdparam">nodatamode</var>, text[] <var class="pdparam">VARIADIC args</var><code>)</code>;</p><p><code class="funcdef">double precision <b class="fsfunc">ST_StdDev4ma</b>(</code>double precision[][][] <var class="pdparam">value</var>, integer[][]  <var class="pdparam">pos</var>, text[] <var class="pdparam">VARIADIC userargs</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp75933184"></a><h2>説明</h2><p>近隣のピクセル値の標準偏差を計算します。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>一つ目の形式は、<a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a>へのコールバック引数として使用する専用コールバック関数です。</p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>二つ目の形式は、<a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>へのコールバック引数として使用する専用コールバック関数です。 </p></td></tr></table></div><div class="warning"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>一つ目の形式は、<a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a>が2.1.0で非推奨となったので、使用しないようになります。 </p></td></tr></table></div><p>Availability: 2.0.0</p><p>Enhanced: 2.1.0 二つ目の形式の追加</p></div><div class="refsection"><a name="idp75942656"></a><h2>例</h2><pre class="programlisting">SELECT
    rid,
    st_value(
        st_mapalgebrafctngb(rast, 1, '32BF', 1, 1, 'st_stddev4ma(float[][],text,text[])'::regprocedure, 'ignore', NULL), 2, 2
    )
FROM dummy_rast
WHERE rid = 2;
 rid |     st_value
-----+------------------
   2 | 1.30170822143555
(1 row)
                </pre></div><div class="refsection"><a name="idp75943936"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a>, <a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>, <a class="xref" href="#RT_ST_Min4ma" title="ST_Min4ma">ST_Min4ma</a>, <a class="xref" href="#RT_ST_Max4ma" title="ST_Max4ma">ST_Max4ma</a>, <a class="xref" href="#RT_ST_Sum4ma" title="ST_Sum4ma">ST_Sum4ma</a>, <a class="xref" href="#RT_ST_Mean4ma" title="ST_Mean4ma">ST_Mean4ma</a>, <a class="xref" href="#RT_ST_Distinct4ma" title="ST_Distinct4ma">ST_Distinct4ma</a>, <a class="xref" href="#RT_ST_StdDev4ma" title="ST_StdDev4ma">ST_StdDev4ma</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Sum4ma"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Sum4ma — 近隣のピクセル値の合計を計算するラスタ処理関数です。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float8 <b class="fsfunc">ST_Sum4ma</b>(</code>float8[][] <var class="pdparam">matrix</var>, text <var class="pdparam">nodatamode</var>, text[] <var class="pdparam">VARIADIC args</var><code>)</code>;</p><p><code class="funcdef">double precision <b class="fsfunc">ST_Sum4ma</b>(</code>double precision[][][] <var class="pdparam">value</var>, integer[][]  <var class="pdparam">pos</var>, text[] <var class="pdparam">VARIADIC userargs</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp75958784"></a><h2>説明</h2><p>近隣のピクセル値の合計を計算します。</p><p>二つ目の形式では、userargsに渡す値でNODATAピクセルに代入する値を指定できます。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>一つ目の形式は、<a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a>へのコールバック引数として使用する専用コールバック関数です。</p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>二つ目の形式は、<a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>へのコールバック引数として使用する専用コールバック関数です。 </p></td></tr></table></div><div class="warning"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>一つ目の形式は、<a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a>が2.1.0で非推奨となったので、使用しないようになります。 </p></td></tr></table></div><p>Availability: 2.0.0</p><p>Enhanced: 2.1.0 二つ目の形式の追加</p></div><div class="refsection"><a name="idp75976832"></a><h2>例</h2><pre class="programlisting">SELECT
    rid,
    st_value(
        st_mapalgebrafctngb(rast, 1, '32BF', 1, 1, 'st_sum4ma(float[][],text,text[])'::regprocedure, 'ignore', NULL), 2, 2
    )
FROM dummy_rast
WHERE rid = 2;
 rid | st_value
-----+----------
   2 |     2279
(1 row)
                </pre></div><div class="refsection"><a name="idp75978112"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a>, <a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>, <a class="xref" href="#RT_ST_Min4ma" title="ST_Min4ma">ST_Min4ma</a>, <a class="xref" href="#RT_ST_Max4ma" title="ST_Max4ma">ST_Max4ma</a>, <a class="xref" href="#RT_ST_Mean4ma" title="ST_Mean4ma">ST_Mean4ma</a>, <a class="xref" href="#RT_ST_Range4ma" title="ST_Range4ma">ST_Range4ma</a>, <a class="xref" href="#RT_ST_Distinct4ma" title="ST_Distinct4ma">ST_Distinct4ma</a>, <a class="xref" href="#RT_ST_StdDev4ma" title="ST_StdDev4ma">ST_StdDev4ma</a> </p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Raster_Processing_DEM"></a>12.14. ラスタ処理: DEM (標高)</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#RT_ST_Aspect">ST_Aspect</a></span><span class="refpurpose"> — 標高ラスタバンドの傾斜方向 (デフォルトの単位は度)を返します。地形解析に使えます。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_HillShade">ST_HillShade</a></span><span class="refpurpose"> — 与えられた方位、高度、明度、スケールの入力を使って標高ラスタバンドの仮想照明を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Roughness">ST_Roughness</a></span><span class="refpurpose"> — DEMの「粗度」を計算したラスタを返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Slope">ST_Slope</a></span><span class="refpurpose"> — 標高ラスタバンドの傾斜角 (デフォルトでは度単位)を返します。地形解析に使えます。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_TPI">ST_TPI</a></span><span class="refpurpose"> — 地形的位置指数を計算したラスタを返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_TRI">ST_TRI</a></span><span class="refpurpose"> — 起伏指標を計算したラスタを返します。</span></dt></dl></div><div class="refentry"><a name="RT_ST_Aspect"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Aspect — 標高ラスタバンドの傾斜方向 (デフォルトの単位は度)を返します。地形解析に使えます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_Aspect</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">band=1</var>, text  <var class="pdparam">pixeltype=32BF</var>, text  <var class="pdparam">units=DEGREES</var>, boolean  <var class="pdparam">interpolate_nodata=FALSE</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Aspect</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">band</var>, raster  <var class="pdparam">customextent</var>, text  <var class="pdparam">pixeltype=32BF</var>, text  <var class="pdparam">units=DEGREES</var>, boolean  <var class="pdparam">interpolate_nodata=FALSE</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp76000256"></a><h2>説明</h2><p>標高ラスタバンドの傾斜方向 (デフォルトの単位は度)を返します。地図代数を利用して、傾斜方向方程式を隣接ピクセルに適用します。</p><p><code class="varname">units</code>は、傾斜方向の単位を示します。取りえる値はRADIANS, DEGREES (デフォルト)です。 </p><p><code class="varname">units</code>がRADIANSの時、値は0から2πラジアンの間で、北から時計回りに計ります。 </p><p><code class="varname">units</code>がDEGREESの時、値は0から360度の間で、北から時計回りに計ります。 </p><p>ピクセルの傾斜角が0の場合には、傾斜方向は-1とします。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>傾斜角、傾斜方および陰影起伏に関する詳細情報については、<a class="ulink" href="http://webhelp.esri.com/arcgisdesktop/9.3/index.cfm?TopicName=How%20Hillshade%20works" target="_top">ESRI - How hillshade works</a>および<a class="ulink" href="http://e2b.erdas.com/fieldguide/wwhelp/wwhimpl/common/html/wwhelp.htm?context=FieldGuide&amp;file=Aspect_Images.html" target="_top">ERDAS Field Guide - Aspect Images</a>を参照して下さい。 </p></td></tr></table></div><p>Availability: 2.0.0 </p><p>Enhanced: 2.1.0 ST_MapAlgebra()を使用するようにし、<code class="varname">interpolate_nodata</code>任意引数を追加しました。</p><p>Changed: 2.1.0 以前の版では、返り値はラジアン単位でした。現在は、デフォルトでは度で返します。</p></div><div class="refsection"><a name="idp76007296"></a><h2>例: 一つ目の形式</h2><pre class="programlisting">WITH foo AS (
    SELECT ST_SetValues(
        ST_AddBand(ST_MakeEmptyRaster(5, 5, 0, 0, 1, -1, 0, 0, 0), 1, '32BF', 0, -9999),
        1, 1, 1, ARRAY[
            [1, 1, 1, 1, 1],
            [1, 2, 2, 2, 1],
            [1, 2, 3, 2, 1],
            [1, 2, 2, 2, 1],
            [1, 1, 1, 1, 1]
        ]::double precision[][]
    ) AS rast
)
SELECT
    ST_DumpValues(ST_Aspect(rast, 1, '32BF'))
FROM foo

                                                                                                    st_dumpvalues

------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
----------------------------------
 (1,"{{315,341.565063476562,0,18.4349479675293,45},{288.434936523438,315,0,45,71.5650482177734},{270,270,-1,90,90},{251.565048217773,225,180,135,108.434951782227},{225,198.43495178
2227,180,161.565048217773,135}}")
(1 row)
                    </pre></div><div class="refsection"><a name="idp76008576"></a><h2>例: 二つ目の形式</h2><p>カバレッジのタイルの完全な例です。このクエリはPostgreSQL 9.1以上でのみ動作します。</p><pre class="programlisting">WITH foo AS (
    SELECT ST_Tile(
        ST_SetValues(
            ST_AddBand(
                ST_MakeEmptyRaster(6, 6, 0, 0, 1, -1, 0, 0, 0),
                1, '32BF', 0, -9999
            ),
            1, 1, 1, ARRAY[
                [1, 1, 1, 1, 1, 1],
                [1, 1, 1, 1, 2, 1],
                [1, 2, 2, 3, 3, 1],
                [1, 1, 3, 2, 1, 1],
                [1, 2, 2, 1, 2, 1],
                [1, 1, 1, 1, 1, 1]
            ]::double precision[]
        ),
        2, 2
    ) AS rast
)
SELECT
    t1.rast,
    ST_Aspect(ST_Union(t2.rast), 1, t1.rast)
FROM foo t1
CROSS JOIN foo t2
WHERE ST_Intersects(t1.rast, t2.rast)
GROUP BY t1.rast;
                    </pre></div><div class="refsection"><a name="idp76010368"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>, <a class="xref" href="#RT_ST_TRI" title="ST_TRI">ST_TRI</a>, <a class="xref" href="#RT_ST_TPI" title="ST_TPI">ST_TPI</a>, <a class="xref" href="#RT_ST_Roughness" title="ST_Roughness">ST_Roughness</a>, <a class="xref" href="#RT_ST_HillShade" title="ST_HillShade">ST_HillShade</a>, <a class="xref" href="#RT_ST_Slope" title="ST_Slope">ST_Slope</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_HillShade"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_HillShade — 与えられた方位、高度、明度、スケールの入力を使って標高ラスタバンドの仮想照明を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_HillShade</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">band=1</var>, text  <var class="pdparam">pixeltype=32BF</var>, double precision  <var class="pdparam">azimuth=315</var>, double precision  <var class="pdparam">altitude=45</var>, double precision  <var class="pdparam">max_bright=255</var>, double precision  <var class="pdparam">scale=1.0</var>, boolean  <var class="pdparam">interpolate_nodata=FALSE</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_HillShade</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">band</var>, raster  <var class="pdparam">customextent</var>, text  <var class="pdparam">pixeltype=32BF</var>, double precision  <var class="pdparam">azimuth=315</var>, double precision  <var class="pdparam">altitude=45</var>, double precision  <var class="pdparam">max_bright=255</var>, double precision  <var class="pdparam">scale=1.0</var>, boolean  <var class="pdparam">interpolate_nodata=FALSE</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp76041472"></a><h2>説明</h2><p>与えられた方位、高度、明度、スケールの入力を使って標高ラスタバンドの仮想照明を返します。地図代数を使って、陰影図方程式を隣接ピクセルに適用します。返されるピクセル値は0と255の間です。</p><p><code class="varname">azimuth</code>は0から360度の間の値で、北から時計回りに計ります。 </p><p><code class="varname">altitude</code>は0から90度の間で、0が水平、90が鉛直上向きです。 </p><p><code class="varname">max_bright</code>は0から255までの間で、0は明度なしで、255が最大明度です。 </p><p><code class="varname">scale</code>は鉛直単位と水平単位との比です。フィート:経度緯度ではscale=370400となり、メートル:経度緯度ではscale=111120となります。 </p><p><code class="varname">interpolate_nodata</code>がTRUEの場合には、入力ラスタのNODATAピクセルの値は陰影図を計算する前に<a class="xref" href="#RT_ST_InvDistWeight4ma" title="ST_InvDistWeight4ma">ST_InvDistWeight4ma</a>を使って内挿を行います。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>陰影図に関する詳細情報については <a class="ulink" href="http://webhelp.esri.com/arcgisdesktop/9.3/index.cfm?TopicName=How%20Hillshade%20works" target="_top">How hillshade works</a>をご覧下さい。 </p></td></tr></table></div><p>Availability: 2.0.0 </p><p>Enhanced: 2.1.0 ST_MapAlgebra()を使用するようにし、<code class="varname">interpolate_nodata</code>任意引数を追加しました。</p><p>Changed: 2.1.0 以前の版ではazimuthとaltitudeはラジアン単位で表現しました。現在はazimuthとaltitudeは度単位で表現します。</p></div><div class="refsection"><a name="idp74160896"></a><h2>例: 一つ目の形式</h2><pre class="programlisting">WITH foo AS (
    SELECT ST_SetValues(
        ST_AddBand(ST_MakeEmptyRaster(5, 5, 0, 0, 1, -1, 0, 0, 0), 1, '32BF', 0, -9999),
        1, 1, 1, ARRAY[
            [1, 1, 1, 1, 1],
            [1, 2, 2, 2, 1],
            [1, 2, 3, 2, 1],
            [1, 2, 2, 2, 1],
            [1, 1, 1, 1, 1]
        ]::double precision[][]
    ) AS rast
)
SELECT
    ST_DumpValues(ST_Hillshade(rast, 1, '32BF'))
FROM foo

                                                                                                                       st_dumpvalues

------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-----------------------------------------------------------------------
 (1,"{{NULL,NULL,NULL,NULL,NULL},{NULL,251.32763671875,220.749786376953,147.224319458008,NULL},{NULL,220.749786376953,180.312225341797,67.7497863769531,NULL},{NULL,147.224319458008
,67.7497863769531,43.1210060119629,NULL},{NULL,NULL,NULL,NULL,NULL}}")
(1 row)
                    </pre></div><div class="refsection"><a name="idp74162176"></a><h2>例: 二つ目の形式</h2><p>カバレッジのタイルの完全な例です。このクエリはPostgreSQL 9.1以上でのみ動作します。</p><pre class="programlisting">WITH foo AS (
    SELECT ST_Tile(
        ST_SetValues(
            ST_AddBand(
                ST_MakeEmptyRaster(6, 6, 0, 0, 1, -1, 0, 0, 0),
                1, '32BF', 0, -9999
            ),
            1, 1, 1, ARRAY[
                [1, 1, 1, 1, 1, 1],
                [1, 1, 1, 1, 2, 1],
                [1, 2, 2, 3, 3, 1],
                [1, 1, 3, 2, 1, 1],
                [1, 2, 2, 1, 2, 1],
                [1, 1, 1, 1, 1, 1]
            ]::double precision[]
        ),
        2, 2
    ) AS rast
)
SELECT
    t1.rast,
    ST_Hillshade(ST_Union(t2.rast), 1, t1.rast)
FROM foo t1
CROSS JOIN foo t2
WHERE ST_Intersects(t1.rast, t2.rast)
GROUP BY t1.rast;
                    </pre></div><div class="refsection"><a name="idp74163968"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>, <a class="xref" href="#RT_ST_TRI" title="ST_TRI">ST_TRI</a>, <a class="xref" href="#RT_ST_TPI" title="ST_TPI">ST_TPI</a>, <a class="xref" href="#RT_ST_Roughness" title="ST_Roughness">ST_Roughness</a>, <a class="xref" href="#RT_ST_Aspect" title="ST_Aspect">ST_Aspect</a>, <a class="xref" href="#RT_ST_Slope" title="ST_Slope">ST_Slope</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Roughness"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Roughness — DEMの「粗度」を計算したラスタを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_Roughness</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, raster  <var class="pdparam">customextent</var>, text  <var class="pdparam">pixeltype="32BF"</var> , boolean  <var class="pdparam"> interpolate_nodata=FALSE </var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp76068864"></a><h2>説明</h2><p>指定された領域の最大値から最小値を減じることでDEMの「粗度」を計算したラスタを返します。</p><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp76070400"></a><h2>例</h2><pre class="programlisting">-- 例が必要
                    </pre></div><div class="refsection"><a name="idp76071680"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>, <a class="xref" href="#RT_ST_TRI" title="ST_TRI">ST_TRI</a>, <a class="xref" href="#RT_ST_TPI" title="ST_TPI">ST_TPI</a>, <a class="xref" href="#RT_ST_Slope" title="ST_Slope">ST_Slope</a>, <a class="xref" href="#RT_ST_HillShade" title="ST_HillShade">ST_HillShade</a>, <a class="xref" href="#RT_ST_Aspect" title="ST_Aspect">ST_Aspect</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Slope"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Slope — 標高ラスタバンドの傾斜角 (デフォルトでは度単位)を返します。地形解析に使えます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_Slope</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband=1</var>, text  <var class="pdparam">pixeltype=32BF</var>, text  <var class="pdparam">units=DEGREES</var>, double precision  <var class="pdparam">scale=1.0</var>, boolean  <var class="pdparam">interpolate_nodata=FALSE</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Slope</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, raster  <var class="pdparam">customextent</var>, text  <var class="pdparam">pixeltype=32BF</var>, text  <var class="pdparam">units=DEGREES</var>, double precision  <var class="pdparam">scale=1.0</var>, boolean  <var class="pdparam">interpolate_nodata=FALSE</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp76086016"></a><h2>説明</h2><p>標高ラスタバンドの傾斜角 (デフォルトでは度単位)を返します。地図代数を使って、傾斜角方程式を隣接ピクセルに適用します。</p><p><code class="varname">units</code>は傾斜角の単位を示します。取りえる値はRADIANS, DEGREES (デフォルト), PERCENTです。 </p><p><code class="varname">scale</code>は鉛直単位と水平単位との比です。フィート:経度緯度ではscale=370400となり、メートル:経度緯度ではscale=111120となります。 </p><p><code class="varname">interpolate_nodata</code>がTRUEの場合には、入力ラスタのNODATAピクセルの値は表面傾斜角を計算する前に<a class="xref" href="#RT_ST_InvDistWeight4ma" title="ST_InvDistWeight4ma">ST_InvDistWeight4ma</a>を使って内挿を行います。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>傾斜角、傾斜方および陰影起伏に関する詳細情報については、<a class="ulink" href="http://webhelp.esri.com/arcgisdesktop/9.3/index.cfm?TopicName=How%20Hillshade%20works" target="_top">ESRI - How hillshade works</a>および<a class="ulink" href="http://e2b.erdas.com/fieldguide/wwhelp/wwhimpl/common/html/wwhelp.htm?context=FieldGuide&amp;file=Slope_Images.html" target="_top">ERDAS Field Guide - Slope Images</a>を参照して下さい。 </p></td></tr></table></div><p>Availability: 2.0.0 </p><p>Enhanced: 2.1.0 ST_MapAlgebra()を使用するようにし、<code class="varname">units</code>, <code class="varname">scale</code>, <code class="varname">interpolate_nodata</code>任意引数を追加しました。</p><p>Changed: 2.1.0 以前の版では、返り値はラジアン単位でした。現在は、デフォルトでは度で返します。</p></div><div class="refsection"><a name="idp76093696"></a><h2>例: 一つ目の形式</h2><pre class="programlisting">WITH foo AS (
    SELECT ST_SetValues(
        ST_AddBand(ST_MakeEmptyRaster(5, 5, 0, 0, 1, -1, 0, 0, 0), 1, '32BF', 0, -9999),
        1, 1, 1, ARRAY[
            [1, 1, 1, 1, 1],
            [1, 2, 2, 2, 1],
            [1, 2, 3, 2, 1],
            [1, 2, 2, 2, 1],
            [1, 1, 1, 1, 1]
        ]::double precision[][]
    ) AS rast
)
SELECT
    ST_DumpValues(ST_Slope(rast, 1, '32BF'))
FROM foo

                            st_dumpvalues

------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------
 (1,"{{10.0249881744385,21.5681285858154,26.5650520324707,21.5681285858154,10.0249881744385},{21.5681285858154,35.2643890380859,36.8698959350586,35.2643890380859,21.5681285858154},
{26.5650520324707,36.8698959350586,0,36.8698959350586,26.5650520324707},{21.5681285858154,35.2643890380859,36.8698959350586,35.2643890380859,21.5681285858154},{10.0249881744385,21.
5681285858154,26.5650520324707,21.5681285858154,10.0249881744385}}")
(1 row)
                    </pre></div><div class="refsection"><a name="idp76094976"></a><h2>例: 二つ目の形式</h2><p>カバレッジのタイルの完全な例です。このクエリはPostgreSQL 9.1以上でのみ動作します。</p><pre class="programlisting">WITH foo AS (
    SELECT ST_Tile(
        ST_SetValues(
            ST_AddBand(
                ST_MakeEmptyRaster(6, 6, 0, 0, 1, -1, 0, 0, 0),
                1, '32BF', 0, -9999
            ),
            1, 1, 1, ARRAY[
                [1, 1, 1, 1, 1, 1],
                [1, 1, 1, 1, 2, 1],
                [1, 2, 2, 3, 3, 1],
                [1, 1, 3, 2, 1, 1],
                [1, 2, 2, 1, 2, 1],
                [1, 1, 1, 1, 1, 1]
            ]::double precision[]
        ),
        2, 2
    ) AS rast
)
SELECT
    t1.rast,
    ST_Slope(ST_Union(t2.rast), 1, t1.rast)
FROM foo t1
CROSS JOIN foo t2
WHERE ST_Intersects(t1.rast, t2.rast)
GROUP BY t1.rast;
                    </pre></div><div class="refsection"><a name="idp76096768"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>, <a class="xref" href="#RT_ST_TRI" title="ST_TRI">ST_TRI</a>, <a class="xref" href="#RT_ST_TPI" title="ST_TPI">ST_TPI</a>, <a class="xref" href="#RT_ST_Roughness" title="ST_Roughness">ST_Roughness</a>, <a class="xref" href="#RT_ST_HillShade" title="ST_HillShade">ST_HillShade</a>, <a class="xref" href="#RT_ST_Aspect" title="ST_Aspect">ST_Aspect</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_TPI"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_TPI — 地形的位置指数を計算したラスタを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_TPI</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, raster  <var class="pdparam">customextent</var>, text  <var class="pdparam">pixeltype="32BF"</var> , boolean  <var class="pdparam"> interpolate_nodata=FALSE </var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp76121472"></a><h2>説明</h2><p>地形的位置指数 (TPI=Topographic Position Index)を計算します。地形的位置指数は、半径1における近傍平均値から中心セルの値を引いたものです。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数は、近傍平均値半径が1についてのみ対応しています。</p></td></tr></table></div><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp76123776"></a><h2>例</h2><pre class="programlisting">-- 例が必要
                    </pre></div><div class="refsection"><a name="idp76125056"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>, <a class="xref" href="#RT_ST_TRI" title="ST_TRI">ST_TRI</a>, <a class="xref" href="#RT_ST_Roughness" title="ST_Roughness">ST_Roughness</a>, <a class="xref" href="#RT_ST_Slope" title="ST_Slope">ST_Slope</a>, <a class="xref" href="#RT_ST_HillShade" title="ST_HillShade">ST_HillShade</a>, <a class="xref" href="#RT_ST_Aspect" title="ST_Aspect">ST_Aspect</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_TRI"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_TRI — 起伏指標を計算したラスタを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_TRI</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, raster  <var class="pdparam">customextent</var>, text  <var class="pdparam">pixeltype="32BF"</var> , boolean  <var class="pdparam"> interpolate_nodata=FALSE </var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp76137472"></a><h2>説明</h2><p>起伏指標 (TRI=Terrain Ruggedness Index)は、中心ピクセルと隣接ピクセルを、差の絶対値の平均を取って比較することで計算されます。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数は、近傍平均値半径が1についてのみ対応しています。</p></td></tr></table></div><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp76139776"></a><h2>例</h2><pre class="programlisting">-- 例が必要
                    </pre></div><div class="refsection"><a name="idp76141056"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>, <a class="xref" href="#RT_ST_Roughness" title="ST_Roughness">ST_Roughness</a>, <a class="xref" href="#RT_ST_TPI" title="ST_TPI">ST_TPI</a>, <a class="xref" href="#RT_ST_Slope" title="ST_Slope">ST_Slope</a>, <a class="xref" href="#RT_ST_HillShade" title="ST_HillShade">ST_HillShade</a>, <a class="xref" href="#RT_ST_Aspect" title="ST_Aspect">ST_Aspect</a> </p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Raster_Processing_Geometry"></a>12.15. ラスタ処理: ラスタからジオメトリ</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#RT_Box3D">Box3D</a></span><span class="refpurpose"> — ラスタを囲むボックスのbox3d表現を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_ConvexHull">ST_ConvexHull</a></span><span class="refpurpose"> — BandNoDataValueと等しいピクセル値を含むラスタの凸包ジオメトリを返します。一般的な形状でスキューのないラスタでは、ST_Envelopeと同じ結果になります。不規則な形状をしているか回転しているラスタでのみ使います。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_DumpAsPolygons">ST_DumpAsPolygons</a></span><span class="refpurpose"> — 指定されたラスタバンドからgeomval (geom,val)行の集合を返します。バンドを指定しない場合のデフォルトは1です。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Envelope">ST_Envelope</a></span><span class="refpurpose"> — ラスタの範囲のポリゴン表現を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_MinConvexHull">ST_MinConvexHull</a></span><span class="refpurpose"> — NODATA値を除いたラスタの凸包ジオメトリを返します。 </span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Polygon">ST_Polygon</a></span><span class="refpurpose"> — NODATA値でないピクセル値を持つピクセルの結合で形成されるマルチポリゴンジオメトリを返します。バンドを指定しない場合のデフォルトは1です。</span></dt></dl></div><div class="refentry"><a name="RT_Box3D"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Box3D — ラスタを囲むボックスのbox3d表現を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">box3d <b class="fsfunc">Box3D</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp76150016"></a><h2>説明</h2><p>ラスタの範囲を表現するボックスを返します。</p><p>ポリゴンは、バウンディングボックス ((<code class="varname">MINX</code>, <code class="varname">MINY</code>), (<code class="varname">MAXX</code>, <code class="varname">MAXY</code>))の4隅のポイントにより定義されます。 </p><p>Changed: 2.0.0 以前の版では、box3dでなくbox2dを使っていました。box2dは非推奨型となり、box3dに変更しました。</p></div><div class="refsection"><a name="idp76153472"></a><h2>例</h2><pre class="programlisting">SELECT
    rid,
    Box3D(rast) AS rastbox
FROM dummy_rast;

rid |        rastbox
----+-------------------------------------------------
1   | BOX3D(0.5 0.5 0,20.5 60.5 0)
2   | BOX3D(3427927.75 5793243.5 0,3427928 5793244 0)
                    </pre></div><div class="refsection"><a name="idp76154752"></a><h2>関連情報</h2><p>
                        <a class="xref" href="#RT_ST_Envelope" title="ST_Envelope">ST_Envelope</a>
                    </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_ConvexHull"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ConvexHull — BandNoDataValueと等しいピクセル値を含むラスタの凸包ジオメトリを返します。一般的な形状でスキューのないラスタでは、ST_Envelopeと同じ結果になります。不規則な形状をしているか回転しているラスタでのみ使います。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_ConvexHull</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp76160768"></a><h2>説明</h2><p>NoDataValue値のピクセルを含むラスタの凸包ジオメトリを返します。一般的な形状でスキューのないラスタでは、ST_Envelopeと同じ結果になります。不規則な形状をしているかスキューのあるラスタでのみ使います。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_Envelopeは、座標値の小数部を切り捨て、ラスタのまわりに小さなバッファを追加します。小数部の切り捨てを行わないST_ConvexHullの答と若干異なります。</p></td></tr></table></div></div><div class="refsection"><a name="idp76162560"></a><h2>例</h2><p>これの図については<a class="ulink" href="http://trac.osgeo.org/postgis/wiki/WKTRaster/SpecificationWorking01" target="_top">PostGIS Raster Specification</a>を参照して下さい。</p><pre class="programlisting">-- ST_EnvelopeとST_ConvexHullはだいたい同じです
SELECT ST_AsText(ST_ConvexHull(rast)) As convhull,
    ST_AsText(ST_Envelope(rast)) As env
FROM dummy_rast WHERE rid=1;

                        convhull                        |                env
--------------------------------------------------------+------------------------------------
 POLYGON((0.5 0.5,20.5 0.5,20.5 60.5,0.5 60.5,0.5 0.5)) | POLYGON((0 0,20 0,20 60,0 60,0 0))
                </pre><pre class="programlisting">-- ラスタをスキューします
-- 凸包とエンベロープがどのくらい異なるかをみます
SELECT ST_AsText(ST_ConvexHull(rast)) As convhull,
    ST_AsText(ST_Envelope(rast)) As env
FROM (SELECT ST_SetRotation(rast, 0.1, 0.1) As rast
    FROM dummy_rast WHERE rid=1) As foo;

                        convhull                        |                env
--------------------------------------------------------+------------------------------------
 POLYGON((0.5 0.5,20.5 1.5,22.5 61.5,2.5 60.5,0.5 0.5)) | POLYGON((0 0,22 0,22 61,0 61,0 0))
                    </pre></div><div class="refsection"><a name="idp76165504"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Envelope" title="ST_Envelope">ST_Envelope</a>, <a class="xref" href="#RT_ST_MinConvexHull" title="ST_MinConvexHull">ST_MinConvexHull</a>, <a class="xref" href="#ST_ConvexHull" title="ST_ConvexHull">ST_ConvexHull</a>, <a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_DumpAsPolygons"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_DumpAsPolygons — 指定されたラスタバンドからgeomval (geom,val)行の集合を返します。バンドを指定しない場合のデフォルトは1です。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">setof geomval <b class="fsfunc">ST_DumpAsPolygons</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">band_num=1</var>, boolean  <var class="pdparam">exclude_nodata_value=TRUE</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp76174848"></a><h2>説明</h2><p>集合を返す関数 (SRF=set-returning function)です。geomval行の集合を返します。geomvalはジオメトリ (geom)とピクセルバンド値 (val)からなります。それぞれのポリゴンは、指定したバンドの、valで示される値と同じピクセル値を持っている全てのピクセルの結合です。</p><p>ST_DumpAsPolygonはラスタのポリゴン化に使えます。新しい行を生成するのでGROUP BYの逆です。たとえば、単一ラスタを複数のPOLYGON/MULTIPOLYGONに展開できます。</p><p>Availability: GDAL 1.7以上が必要です。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>バンドにNODATA値が設定されている場合には、exclude_nodata_value=falseが設定されている場合を除いて、NODATA値を持つピクセルは返りません。</p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ラスタ内の与えられた値を持つピクセルの数にのみ注意する場合には<a class="xref" href="#RT_ST_ValueCount" title="ST_ValueCount">ST_ValueCount</a>を使う方が速いです。</p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これは、ピクセル値にかかわらずピクセルごとに一つのジオメトリを返すST_PixelAsPolygonsと違います。 </p></td></tr></table></div></div><div class="refsection"><a name="idp76178944"></a><h2>例</h2><pre class="programlisting">-- PostgreSQL 9.3以上では、次のような文法になります
SELECT val, ST_AsText(geom) As geomwkt
FROM (
SELECT dp.*
FROM dummy_rast, LATERAL ST_DumpAsPolygons(rast) AS dp
WHERE rid = 2
) As foo
WHERE val BETWEEN 249 and 251
ORDER BY val;

 val |                                                       geomwkt
-----+--------------------------------------------------------------------------
 249 | POLYGON((3427927.95 5793243.95,3427927.95 5793243.85,3427928 5793243.85,
        3427928 5793243.95,3427927.95 5793243.95))
 250 | POLYGON((3427927.75 5793243.9,3427927.75 5793243.85,3427927.8 5793243.85,
        3427927.8 5793243.9,3427927.75 5793243.9))
 250 | POLYGON((3427927.8 5793243.8,3427927.8 5793243.75,3427927.85 5793243.75,
        3427927.85 5793243.8, 3427927.8 5793243.8))
 251 | POLYGON((3427927.75 5793243.85,3427927.75 5793243.8,3427927.8 5793243.8,
        3427927.8 5793243.85,3427927.75 5793243.85))
                    </pre></div><div class="refsection"><a name="idp76184320"></a><h2>関連情報</h2><p><a class="xref" href="#geomval" title="geomval">geomval</a>, <a class="xref" href="#RT_ST_Value" title="ST_Value">ST_Value</a>, <a class="xref" href="#RT_ST_Polygon" title="ST_Polygon">ST_Polygon</a>, <a class="xref" href="#RT_ST_ValueCount" title="ST_ValueCount">ST_ValueCount</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Envelope"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Envelope — ラスタの範囲のポリゴン表現を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Envelope</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp76203648"></a><h2>説明</h2><p>SRIDで定義されている空間参照系上でのラスタの範囲のポリゴン表現を返します。ポリゴンで表現されるfloat8の最小バウンディングボックスです。 </p><p>ポリゴンはバウンディングボックスの隅のポイント、すなわち ((<code class="varname">MINX</code>, <code class="varname">MINY</code>), (<code class="varname">MINX</code>, <code class="varname">MAXY</code>), (<code class="varname">MAXX</code>, <code class="varname">MAXY</code>), (<code class="varname">MAXX</code>, <code class="varname">MINY</code>), (<code class="varname">MINX</code>, <code class="varname">MINY</code>))です。 </p></div><div class="refsection"><a name="idp76209024"></a><h2>例</h2><pre class="programlisting">SELECT rid, ST_AsText(ST_Envelope(rast)) As envgeomwkt
FROM dummy_rast;

 rid |                                         envgeomwkt
-----+--------------------------------------------------------------------
   1 | POLYGON((0 0,20 0,20 60,0 60,0 0))
   2 | POLYGON((3427927 5793243,3427928 5793243,
        3427928 5793244,3427927 5793244, 3427927 5793243))
                    </pre></div><div class="refsection"><a name="idp76210304"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Envelope" title="ST_Envelope">ST_Envelope</a>, <a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a>, <a class="xref" href="#RT_ST_SRID" title="ST_SRID">ST_SRID</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_MinConvexHull"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MinConvexHull — NODATA値を除いたラスタの凸包ジオメトリを返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_MinConvexHull</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband=NULL</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp76218112"></a><h2>説明</h2><p>NODATA値を除いたラスタの凸包ジオメトリを返します。<code class="varname">nband</code>がNULLの場合には、ラスタの全てのバンドが考慮されます。 </p><p>Availability: 2.1.0 </p></div><div class="refsection"><a name="idp76220032"></a><h2>例</h2><pre class="programlisting">WITH foo AS (
    SELECT
        ST_SetValues(
            ST_SetValues(
                ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(9, 9, 0, 0, 1, -1, 0, 0, 0), 1, '8BUI', 0, 0), 2, '8BUI', 1, 0),
                1, 1, 1,
                ARRAY[
                    [0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 1, 0, 0, 0, 0, 1],
                    [0, 0, 0, 1, 1, 0, 0, 0, 0],
                    [0, 0, 0, 1, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0, 0, 0, 0]
                ]::double precision[][]
            ),
            2, 1, 1,
            ARRAY[
                [0, 0, 0, 0, 0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0, 0, 0, 0, 0],
                [1, 0, 0, 0, 0, 1, 0, 0, 0],
                [0, 0, 0, 0, 1, 1, 0, 0, 0],
                [0, 0, 0, 0, 0, 1, 0, 0, 0],
                [0, 0, 0, 0, 0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0, 0, 0, 0, 0],
                [0, 0, 1, 0, 0, 0, 0, 0, 0]
            ]::double precision[][]
        ) AS rast
)
SELECT
    ST_AsText(ST_ConvexHull(rast)) AS hull,
    ST_AsText(ST_MinConvexHull(rast)) AS mhull,
    ST_AsText(ST_MinConvexHull(rast, 1)) AS mhull_1,
    ST_AsText(ST_MinConvexHull(rast, 2)) AS mhull_2
FROM foo

               hull               |                mhull                |               mhull_1               |               mhull_2
----------------------------------+-------------------------------------+-------------------------------------+-------------------------------------
 POLYGON((0 0,9 0,9 -9,0 -9,0 0)) | POLYGON((0 -3,9 -3,9 -9,0 -9,0 -3)) | POLYGON((3 -3,9 -3,9 -6,3 -6,3 -3)) | POLYGON((0 -3,6 -3,6 -9,0 -9,0 -3))
                    </pre></div><div class="refsection"><a name="idp76221312"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Envelope" title="ST_Envelope">ST_Envelope</a>, <a class="xref" href="#RT_ST_ConvexHull" title="ST_ConvexHull">ST_ConvexHull</a>, <a class="xref" href="#ST_ConvexHull" title="ST_ConvexHull">ST_ConvexHull</a>, <a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Polygon"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Polygon — NODATA値でないピクセル値を持つピクセルの結合で形成されるマルチポリゴンジオメトリを返します。バンドを指定しない場合のデフォルトは1です。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Polygon</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">band_num=1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp76237696"></a><h2>説明</h2><p>Availability: 0.1.6 GDAL 1.7以上が必要です。</p><p>Enhanced: 2.1.0 速度を改善し (完全にC言語で記述しました)、確実に妥当なマルチポリゴンを返すようにしました。</p><p>Changed: 2.1.0 以前の版では、時々ポリゴンを返しましたが、常にマルチポリゴンを返すように変更しました。</p></div><div class="refsection"><a name="idp76239616"></a><h2>例</h2><pre class="programlisting">-- デフォルトではNODATA値は0になるか設定されていないので
--  ST_Polygon()は四角形のポリゴンを返します
SELECT ST_AsText(ST_Polygon(rast)) As geomwkt
FROM dummy_rast
WHERE rid = 2;

geomwkt
--------------------------------------------
MULTIPOLYGON(((3427927.75 5793244,3427928 5793244,3427928 5793243.75,3427927.75 5793243.75,3427927.75 5793244)))


-- 1番目のバンドのNODATA値を変更します
UPDATE dummy_rast SET rast = ST_SetBandNoDataValue(rast,1,254)
WHERE rid = 2;
SELECt rid, ST_BandNoDataValue(rast)
from dummy_rast where rid = 2;

-- ST_Polygonはピクセル値254を除外してマルチポリゴンを返します
SELECT ST_AsText(ST_Polygon(rast)) As geomwkt
FROM dummy_rast
WHERE rid = 2;

geomwkt
---------------------------------------------------------
MULTIPOLYGON(((3427927.9 5793243.95,3427927.85 5793243.95,3427927.85 5793244,3427927.9 5793244,3427927.9 5793243.95)),((3427928 5793243.85,3427928 5793243.8,3427927.95 5793243.8,3427927.95 5793243.85,3427927.9 5793243.85,3427927.9 5793243.9,3427927.9 5793243.95,3427927.95 5793243.95,3427928 5793243.95,3427928 5793243.85)),((3427927.8 5793243.75,3427927.75 5793243.75,3427927.75 5793243.8,3427927.75 5793243.85,3427927.75 5793243.9,3427927.75 5793244,3427927.8 5793244,3427927.8 5793243.9,3427927.8 5793243.85,3427927.85 5793243.85,3427927.85 5793243.8,3427927.85 5793243.75,3427927.8 5793243.75)))

-- 異なるNODATA値が1回だけ欲しい場合には、次のようにします

SELECT ST_AsText(
    ST_Polygon(
        ST_SetBandNoDataValue(rast,1,252)
        )
    ) As geomwkt
FROM dummy_rast
WHERE rid =2;

geomwkt
---------------------------------
MULTIPOLYGON(((3427928 5793243.85,3427928 5793243.8,3427928 5793243.75,3427927.85 5793243.75,3427927.8 5793243.75,3427927.8 5793243.8,3427927.75 5793243.8,3427927.75 5793243.85,3427927.75 5793243.9,3427927.75 5793244,3427927.8 5793244,3427927.85 5793244,3427927.9 5793244,3427928 5793244,3427928 5793243.95,3427928 5793243.85),(3427927.9 5793243.9,3427927.9 5793243.85,3427927.95 5793243.85,3427927.95 5793243.9,3427927.9 5793243.9)))
                    </pre></div><div class="refsection"><a name="idp76240896"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Value" title="ST_Value">ST_Value</a>, <a class="xref" href="#RT_ST_DumpAsPolygons" title="ST_DumpAsPolygons">ST_DumpAsPolygons</a> </p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="RT_Operators"></a>12.16. ラスタ演算子</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#RT_Raster_Intersect">&amp;&amp;</a></span><span class="refpurpose"> — AのバウンディングボックスがBのバウンディングボックスとインタセクトする場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_Raster_OverLeft">&amp;&lt;</a></span><span class="refpurpose"> — AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの左にある場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_Raster_OverRight">&amp;&gt;</a></span><span class="refpurpose"> — AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの右にある場合に <code class="varname">TRUE</code> を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_Raster_EQ">=</a></span><span class="refpurpose"> — AのバウンディングボックスがBのバウンディングボックスと同じ場合に<code class="varname">TRUE</code>を返します。倍精度浮動小数点数のバウンディングボックスを使います。</span></dt><dt><span class="refentrytitle"><a href="#RT_Raster_Contained">@</a></span><span class="refpurpose"> — AのバウンディングボックスがBのバウンディングボックスに含まれる場合に<code class="varname">TRUE</code>を返します。倍精度浮動小数点数のバウンディングボックスを使います。</span></dt><dt><span class="refentrytitle"><a href="#RT_Raster_Same">~=</a></span><span class="refpurpose"> — AのバウンディングボックスがBのバウンディングボックスと同じ場合にTRUEを返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_Raster_Contains">~</a></span><span class="refpurpose"> — AのバウンディングボックスがBのバウンディングボックスを含む場合に<code class="varname">TRUE</code>を返します。倍精度浮動小数点数のバウンディングボックスを使います。</span></dt></dl></div><div class="refentry"><a name="RT_Raster_Intersect"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>&amp;&amp; — AのバウンディングボックスがBのバウンディングボックスとインタセクトする場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">&amp;&amp;</b>(</code> raster  <var class="pdparam">A</var> ,  raster  <var class="pdparam">B</var> <code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">&amp;&amp;</b>(</code> raster  <var class="pdparam">A</var> ,  geometry  <var class="pdparam">B</var> <code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">&amp;&amp;</b>(</code> geometry  <var class="pdparam">B</var> ,  raster  <var class="pdparam">A</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp76257664"></a><h2>説明</h2><p><code class="varname">&amp;&amp;</code>演算子は、AのバウンディングボックスがBのバウンディングボックスにインタセクトする場合に <code class="varname">TRUE</code>を返します。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これのオペランドは、ラスタで使用できるインデクスを使用します。</p></td></tr></table></div><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp76260352"></a><h2>例</h2><pre class="programlisting">SELECT A.rid As a_rid, B.rid As b_rid, A.rast &amp;&amp; B.rast As intersect
 FROM dummy_rast AS A CROSS JOIN dummy_rast AS B LIMIT 3;

 a_rid | b_rid | intersect
-------+-------+---------
     2 |     2 | t
     2 |     3 | f
     2 |     1 | f
</pre></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_Raster_OverLeft"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>&amp;&lt; — AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの左にある場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">&amp;&lt;</b>(</code> raster  <var class="pdparam">A</var> ,  raster  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp76268032"></a><h2>説明</h2><p><code class="varname">&amp;&lt;</code>演算子は、AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの左にある場合に<code class="varname">TRUE</code>を返します。条件についてより詳細に言うと、BのバウンディングボックスをオーバラップするかBのバウンディングボックスの右に*ない*場合です。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これのオペランドは、ラスタで使用できるインデクスを使用します。</p></td></tr></table></div></div><div class="refsection"><a name="idp76270336"></a><h2>例</h2><pre class="programlisting">SELECT A.rid As a_rid, B.rid As b_rid, A.rast &amp;&lt; B.rast As overleft
 FROM dummy_rast AS A CROSS JOIN dummy_rast AS B;

a_rid | b_rid | overleft
------+-------+----------
    2 |     2 | t
    2 |     3 | f
    2 |     1 | f
    3 |     2 | t
    3 |     3 | t
    3 |     1 | f
    1 |     2 | t
    1 |     3 | t
    1 |     1 | t
</pre></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_Raster_OverRight"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>&amp;&gt; — AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの右にある場合に <code class="varname">TRUE</code> を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">&amp;&gt;</b>(</code> raster  <var class="pdparam">A</var> ,  raster  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp76278016"></a><h2>説明</h2><p><code class="varname">&amp;&gt;</code>演算子は、AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの右にある場合に<code class="varname">TRUE</code>を返します。条件についてより詳細に言うと、BのバウンディングボックスをオーバラップするかBのバウンディングボックスの左に*ない*場合です。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これのオペランドは、ジオメトリで使用できるインデクスを使用します。</p></td></tr></table></div></div><div class="refsection"><a name="idp76284416"></a><h2>例</h2><pre class="programlisting">SELECT A.rid As a_rid, B.rid As b_rid, A.rast &amp;&gt; B.rast As overright
 FROM dummy_rast AS A CROSS JOIN dummy_rast AS B;

 a_rid | b_rid | overright
-------+-------+----------
     2 |     2 | t
     2 |     3 | t
     2 |     1 | t
     3 |     2 | f
     3 |     3 | t
     3 |     1 | f
     1 |     2 | f
     1 |     3 | t
     1 |     1 | t
</pre></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_Raster_EQ"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>= — AのバウンディングボックスがBのバウンディングボックスと同じ場合に<code class="varname">TRUE</code>を返します。倍精度浮動小数点数のバウンディングボックスを使います。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">=</b>(</code> raster  <var class="pdparam">A</var> ,  raster  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp76292096"></a><h2>説明</h2><p><code class="varname">=</code>演算子は、AのバウンディングボックスがBのバウンディングボックスと同じ場合にTRUEを返します。PostgreSQLは内部でラスタの順序決定や比較 (GROUP BY節やORDER BY節など)を行うためにラスタ用として定義している=, &lt;, &gt;演算子を使用します。</p><div class="caution"><table border="0" summary="Caution"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注意]" src="images/caution.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これのオペランドは、ラスタで利用できるインデクスを使いません。代わりに<a class="xref" href="#RT_Raster_Same" title="~=">~=</a>を使います。この演算子はラスタカラムのGROUP BYに使うのがほとんどです。</p></td></tr></table></div><p>Availability: 2.1.0 </p></div><div class="refsection"><a name="idp76294784"></a><h2>関連情報</h2><p><a class="xref" href="#RT_Raster_Same" title="~=">~=</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_Raster_Contained"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>@ — AのバウンディングボックスがBのバウンディングボックスに含まれる場合に<code class="varname">TRUE</code>を返します。倍精度浮動小数点数のバウンディングボックスを使います。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">@</b>(</code> raster  <var class="pdparam">A</var> ,  raster  <var class="pdparam">B</var> <code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">@</b>(</code> geometry  <var class="pdparam">A</var> ,  raster  <var class="pdparam">B</var> <code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">@</b>(</code> raster  <var class="pdparam">B</var> ,  geometry  <var class="pdparam">A</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp76309888"></a><h2>説明</h2><p><code class="varname">@</code>は、ラスタまたはジオメトリであるAのバウンディングボックスが、ラスタまたはジオメトリであるBのバウンディングボックスに含まれる場合に<code class="varname">TRUE</code>を返します。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これのオペランドは、ラスタのインデクスを使用します。 </p></td></tr></table></div><p>Availability: 2.0.0 raster @ raster, raster @ geometry が導入されました。</p><p>Availability: 2.0.5 geometry @ raster が導入されました。 </p></div><div class="refsection"><a name="idp76312960"></a><h2>関連情報</h2><p><a class="xref" href="#RT_Raster_Contains" title="~">~</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_Raster_Same"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>~= — AのバウンディングボックスがBのバウンディングボックスと同じ場合にTRUEを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">~=</b>(</code> raster  <var class="pdparam">A</var> ,  raster  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp76320256"></a><h2>説明</h2><p><code class="varname">~=</code>演算子は、AのバウンディングボックスがBのバウンディングボックスと同じ場合に<code class="varname">TRUE</code>を返します。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これのオペランドは、ラスタで使用できるインデクスを使用します。</p></td></tr></table></div><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp76322944"></a><h2>例</h2><p>大変便利な利用局面として、単一バンドを持つラスタ集合が二つあって、これらは同じデータなのに異なる主題を表現する場合で、これらを取って複数バンドのラスタを生成する局面です。</p><pre class="programlisting">SELECT ST_AddBand(prec.rast, alt.rast) As new_rast
    FROM prec INNER JOIN alt ON (prec.rast ~= alt.rast);
        </pre></div><div class="refsection"><a name="idp76324736"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_AddBand" title="ST_AddBand">ST_AddBand</a>, <a class="xref" href="#RT_Raster_EQ" title="=">=</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_Raster_Contains"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>~ — AのバウンディングボックスがBのバウンディングボックスを含む場合に<code class="varname">TRUE</code>を返します。倍精度浮動小数点数のバウンディングボックスを使います。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">~</b>(</code> raster  <var class="pdparam">A</var> ,  raster  <var class="pdparam">B</var> <code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">~</b>(</code> geometry  <var class="pdparam">A</var> ,  raster  <var class="pdparam">B</var> <code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">~</b>(</code> raster  <var class="pdparam">B</var> ,  geometry  <var class="pdparam">A</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp76352512"></a><h2>説明</h2><p><code class="varname">~</code>演算子は、ラスタまたはジオメトリであるAのバウンディングボックスがラスタまたはジオメトリであるBのバウンディングボックスを含む場合に<code class="varname">TRUE</code>を返します。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これのオペランドは、ラスタのインデクスを使用します。 </p></td></tr></table></div><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp76355200"></a><h2>関連情報</h2><p><a class="xref" href="#RT_Raster_Contained" title="@">@</a></p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Raster_Relationships"></a>12.17. ラスタとラスタバンドの空間関係関数</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#RT_ST_Contains">ST_Contains</a></span><span class="refpurpose"> — rastAの外にrastBの点が無く、rastAの内部にrastBの内部の点が一つ以上ある場合にTRUEを返します。 </span></dt><dt><span class="refentrytitle"><a href="#RT_ST_ContainsProperly">ST_ContainsProperly</a></span><span class="refpurpose"> — rastBがrastAの内部でインタセクトし、かつrastAの境界とも外部ともインタセクトしない場合にTRUEを返します。 </span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Covers">ST_Covers</a></span><span class="refpurpose"> — rastBがrastAの外部に点を持たない場合にTRUEを返します。 </span></dt><dt><span class="refentrytitle"><a href="#RT_ST_CoveredBy">ST_CoveredBy</a></span><span class="refpurpose"> — rastAがrastBの外部に点を持たない場合にTRUEを返します。 </span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Disjoint">ST_Disjoint</a></span><span class="refpurpose"> — rastAがrastBとインタセクトしない場合にTRUEを返します。 </span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Intersects">ST_Intersects</a></span><span class="refpurpose"> — rastAがrastBとインタセクトする場合にTRUEを返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Overlaps">ST_Overlaps</a></span><span class="refpurpose"> — rastAとrastBがインタセクトして、かつ一方がもう一方に完全には包含されない場合にはTRUEを返します。 </span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Touches">ST_Touches</a></span><span class="refpurpose"> — rastAとrastBが少なくとも一つの共通の点を持ち、かつ二つのラスタの内部同士がインタセクトしない場合にTRUEを返します。 </span></dt><dt><span class="refentrytitle"><a href="#RT_ST_SameAlignment">ST_SameAlignment</a></span><span class="refpurpose"> — ラスタが同じスキュー、スケール、空間参照系、オフセットを持つ (ピクセルが分割されることなく同じグリッドに置かれている)場合にTRUEを返し、そうでない場合は問題を詳述する通知とともにFALSEを返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_NotSameAlignmentReason">ST_NotSameAlignmentReason</a></span><span class="refpurpose"> — ラスタが同じアラインメントを持つかどうか、また、持たない場合にはその理由を示す文字列を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Within">ST_Within</a></span><span class="refpurpose"> — rastAがrastBの外部に点を持たず、rastAの内部の少なくとも一つの点がrastBの内部にある場合にTRUEを返します。 </span></dt><dt><span class="refentrytitle"><a href="#RT_ST_DWithin">ST_DWithin</a></span><span class="refpurpose"> — rastAとrastBが指定した距離内にある場合にTRUEを返します。 </span></dt><dt><span class="refentrytitle"><a href="#RT_ST_DFullyWithin">ST_DFullyWithin</a></span><span class="refpurpose"> — rastAとrastBが指定した距離内に完全に収まる場合にTRUEを返します。 </span></dt></dl></div><div class="refentry"><a name="RT_ST_Contains"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Contains — rastAの外にrastBの点が無く、rastAの内部にrastBの内部の点が一つ以上ある場合にTRUEを返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_Contains</b>(</code> raster  <var class="pdparam">rastA</var> ,  integer  <var class="pdparam">nbandA</var> ,  raster  <var class="pdparam">rastB</var> ,  integer  <var class="pdparam">nbandB</var> <code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">ST_Contains</b>(</code> raster  <var class="pdparam">rastA</var> ,  raster  <var class="pdparam">rastB</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp76369664"></a><h2>説明</h2><p>rastAの外にrastBの点が無く、rastAの内部にrastBの内部の点が一つ以上ある場合に限って、rastAはrastBを包含しています。バンド番号が指定されていないかNULLに指定されている場合には、ラスタの凸包のみを考慮してテストします。バンド番号が指定されている場合には、値を持つ (NODATAでない)ピクセルについてテストします。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はラスタで利用できるインデクスを使用します。 </p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ラスタとジオメトリの空間関係をテストするには、ST_Contains(ST_Polygon(raster), geometry)またはST_Contains(geometry, ST_Polygon(raster))というふうに、ラスタにST_Polygonを使います。 </p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_Contains()はST_Within()の逆です。ST_Contains(rastA, rastB)はST_Within(rastB, rastA)を示します。 </p></td></tr></table></div><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp76373504"></a><h2>例</h2><pre class="programlisting">-- バンド番号指定
SELECT r1.rid, r2.rid, ST_Contains(r1.rast, 1, r2.rast, 1) FROM dummy_rast r1 CROSS JOIN dummy_rast r2 WHERE r1.rid = 1;

NOTICE:  The first raster provided has no bands
 rid | rid | st_contains
-----+-----+-------------
   1 |   1 |
   1 |   2 | f
            </pre><pre class="programlisting">-- バンド番号不指定
SELECT r1.rid, r2.rid, ST_Contains(r1.rast, r2.rast) FROM dummy_rast r1 CROSS JOIN dummy_rast r2 WHERE r1.rid = 1;
 rid | rid | st_contains
-----+-----+-------------
   1 |   1 | t
   1 |   2 | f
            </pre></div><div class="refsection"><a name="idp76375296"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Intersects" title="ST_Intersects">ST_Intersects</a>, <a class="xref" href="#RT_ST_Within" title="ST_Within">ST_Within</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_ContainsProperly"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ContainsProperly — rastBがrastAの内部でインタセクトし、かつrastAの境界とも外部ともインタセクトしない場合にTRUEを返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_ContainsProperly</b>(</code> raster  <var class="pdparam">rastA</var> ,  integer  <var class="pdparam">nbandA</var> ,  raster  <var class="pdparam">rastB</var> ,  integer  <var class="pdparam">nbandB</var> <code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">ST_ContainsProperly</b>(</code> raster  <var class="pdparam">rastA</var> ,  raster  <var class="pdparam">rastB</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp76389376"></a><h2>説明</h2><p>rastBがrastAの内部でインタセクトし、かつrastAの境界とも外部ともインタセクトしない場合には、rastAはrastBに対してContainsProperly (確実に包含している)です。バンド番号が指定されていないかNULLに指定されている場合には、ラスタの凸包のみを考慮してテストします。バンド番号が指定されている場合には、値を持つ (NODATAでない)ピクセルについてテストします。 </p><p>rastAは自身にはContainsProperlyではありませんが、Containsです。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はラスタで利用できるインデクスを使用します。 </p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ラスタとジオメトリの空間関係をテストするには、ST_ContainsProperly(ST_Polygon(raster), geometry)またはST_ContainsProperly(geometry, ST_Polygon(raster))というふうに、ラスタにST_Polygonを使います。 </p></td></tr></table></div><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp76392832"></a><h2>例</h2><pre class="programlisting">SELECT r1.rid, r2.rid, ST_ContainsProperly(r1.rast, 1, r2.rast, 1) FROM dummy_rast r1 CROSS JOIN dummy_rast r2 WHERE r1.rid = 2;

 rid | rid | st_containsproperly
-----+-----+---------------------
   2 |   1 | f
   2 |   2 | f
            </pre></div><div class="refsection"><a name="idp76394112"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Intersects" title="ST_Intersects">ST_Intersects</a>, <a class="xref" href="#RT_ST_Contains" title="ST_Contains">ST_Contains</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Covers"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Covers — rastBがrastAの外部に点を持たない場合にTRUEを返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_Covers</b>(</code> raster  <var class="pdparam">rastA</var> ,  integer  <var class="pdparam">nbandA</var> ,  raster  <var class="pdparam">rastB</var> ,  integer  <var class="pdparam">nbandB</var> <code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">ST_Covers</b>(</code> raster  <var class="pdparam">rastA</var> ,  raster  <var class="pdparam">rastB</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp76412288"></a><h2>説明</h2><p>rastAの外部にrastBの点が無い場合には、rastAはrastBに対してCoversです。バンド番号が指定されていないかNULLに指定されている場合には、ラスタの凸包のみを考慮してテストします。バンド番号が指定されている場合には、値を持つ (NODATAでない)ピクセルについてテストします。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はラスタで利用できるインデクスを使用します。 </p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ラスタとジオメトリの空間関係をテストするには、ST_Covers(ST_Polygon(raster), geometry)またはST_Covers(geometry, ST_Polygon(raster))というふうに、ラスタにST_Polygonを使います。 </p></td></tr></table></div><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp76415360"></a><h2>例</h2><pre class="programlisting">SELECT r1.rid, r2.rid, ST_Covers(r1.rast, 1, r2.rast, 1) FROM dummy_rast r1 CROSS JOIN dummy_rast r2 WHERE r1.rid = 2;

 rid | rid | st_covers
-----+-----+-----------
   2 |   1 | f
   2 |   2 | t
            </pre></div><div class="refsection"><a name="idp76416640"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Intersects" title="ST_Intersects">ST_Intersects</a>, <a class="xref" href="#RT_ST_CoveredBy" title="ST_CoveredBy">ST_CoveredBy</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_CoveredBy"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_CoveredBy — rastAがrastBの外部に点を持たない場合にTRUEを返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_CoveredBy</b>(</code> raster  <var class="pdparam">rastA</var> ,  integer  <var class="pdparam">nbandA</var> ,  raster  <var class="pdparam">rastB</var> ,  integer  <var class="pdparam">nbandB</var> <code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">ST_CoveredBy</b>(</code> raster  <var class="pdparam">rastA</var> ,  raster  <var class="pdparam">rastB</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp76434816"></a><h2>説明</h2><p>rastAがrastBの外部に点を持たない場合には、rastAはrastBに対してCoveredByです。バンド番号が指定されていないかNULLに指定されている場合には、ラスタの凸包のみを考慮してテストします。バンド番号が指定されている場合には、値を持つ (NODATAでない)ピクセルについてテストします。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はラスタで利用できるインデクスを使用します。 </p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ラスタとジオメトリの空間関係をテストするには、ST_CoveredBy(ST_Polygon(raster), geometry)またはST_CoveredBy(geometry, ST_Polygon(raster))というふうに、ラスタにST_Polygonを使います。 </p></td></tr></table></div><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp76437888"></a><h2>例</h2><pre class="programlisting">SELECT r1.rid, r2.rid, ST_CoveredBy(r1.rast, 1, r2.rast, 1) FROM dummy_rast r1 CROSS JOIN dummy_rast r2 WHERE r1.rid = 2;

 rid | rid | st_coveredby
-----+-----+--------------
   2 |   1 | f
   2 |   2 | t
            </pre></div><div class="refsection"><a name="idp76439168"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Intersects" title="ST_Intersects">ST_Intersects</a>, <a class="xref" href="#RT_ST_Covers" title="ST_Covers">ST_Covers</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Disjoint"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Disjoint — rastAがrastBとインタセクトしない場合にTRUEを返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_Disjoint</b>(</code> raster  <var class="pdparam">rastA</var> ,  integer  <var class="pdparam">nbandA</var> ,  raster  <var class="pdparam">rastB</var> ,  integer  <var class="pdparam">nbandB</var> <code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">ST_Disjoint</b>(</code> raster  <var class="pdparam">rastA</var> ,  raster  <var class="pdparam">rastB</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp76486016"></a><h2>説明</h2><p>rastAがrastBとインタセクトしない場合には、rastAとrastBはDisjointです。バンド番号が指定されていないかNULLに指定されている場合には、ラスタの凸包のみを考慮してテストします。バンド番号が指定されている場合には、値を持つ (NODATAでない)ピクセルについてテストします。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はインデクスを*使いません*。 </p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ラスタとジオメトリの空間関係をテストするには、ST_Disjoint(ST_Polygon(raster), geometry)というふうに、ラスタにST_Polygonを使います。 </p></td></tr></table></div><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp76489088"></a><h2>例</h2><pre class="programlisting">-- rid=1のラスタはバンドを持っていないので、
-- 警告が出て、ST_DisjointでNULL値が出ます
SELECT r1.rid, r2.rid, ST_Disjoint(r1.rast, 1, r2.rast, 1) FROM dummy_rast r1 CROSS JOIN dummy_rast r2 WHERE r1.rid = 2;

NOTICE:  The second raster provided has no bands
 rid | rid | st_disjoint
-----+-----+-------------
   2 |   1 |
   2 |   2 | f
            </pre><pre class="programlisting">-- 今度はバンド番号を指定しません
SELECT r1.rid, r2.rid, ST_Disjoint(r1.rast, r2.rast) FROM dummy_rast r1 CROSS JOIN dummy_rast r2 WHERE r1.rid = 2;

 rid | rid | st_disjoint
-----+-----+-------------
   2 |   1 | t
   2 |   2 | f
            </pre></div><div class="refsection"><a name="idp76490880"></a><h2>関連情報</h2><p>
                <a class="xref" href="#RT_ST_Intersects" title="ST_Intersects">ST_Intersects</a>
            </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Intersects"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Intersects — rastAがrastBとインタセクトする場合にTRUEを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_Intersects</b>(</code> raster  <var class="pdparam">rastA</var> ,  integer  <var class="pdparam">nbandA</var> ,  raster  <var class="pdparam">rastB</var> ,  integer  <var class="pdparam">nbandB</var> <code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">ST_Intersects</b>(</code> raster  <var class="pdparam">rastA</var> ,  raster  <var class="pdparam">rastB</var> <code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">ST_Intersects</b>(</code> raster  <var class="pdparam">rast</var> ,  integer  <var class="pdparam">nband</var> ,  geometry  <var class="pdparam">geommin</var> <code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">ST_Intersects</b>(</code> raster  <var class="pdparam">rast</var> ,  geometry  <var class="pdparam">geommin</var> ,  integer  <var class="pdparam">nband=NULL</var> <code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">ST_Intersects</b>(</code> geometry  <var class="pdparam">geommin</var> ,  raster  <var class="pdparam">rast</var> ,  integer  <var class="pdparam">nband=NULL</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp76519936"></a><h2>説明</h2><p>rastAがrastBとインタセクトする場合にTRUEを返します。バンド番号が指定されていないかNULLに指定されている場合には、ラスタの凸包のみを考慮してテストします。バンド番号が指定されている場合には、値を持つ (NODATAでない)ピクセルについてテストします。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はラスタで利用できるインデクスを使用します。 </p></td></tr></table></div><p>Enhanced: 2.0.0 ラスタ/ラスタのインタセクト対応が導入されました。 </p><div class="warning"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Changed: 2.1.0 ST_Intersects(raster, geometry)形式の挙動が ST_Intersects(geometry, raster)とあうように変更されました。 </p></td></tr></table></div></div><div class="refsection"><a name="idp76523008"></a><h2>例</h2><pre class="programlisting">-- 同じラスタの別のバンド
SELECT ST_Intersects(rast, 2, rast, 3) FROM dummy_rast WHERE rid = 2;

 st_intersects
---------------
 t
            </pre></div><div class="refsection"><a name="idp76524288"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Intersection" title="ST_Intersection">ST_Intersection</a>, <a class="xref" href="#RT_ST_Disjoint" title="ST_Disjoint">ST_Disjoint</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Overlaps"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Overlaps — rastAとrastBがインタセクトして、かつ一方がもう一方に完全には包含されない場合にはTRUEを返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_Overlaps</b>(</code> raster  <var class="pdparam">rastA</var> ,  integer  <var class="pdparam">nbandA</var> ,  raster  <var class="pdparam">rastB</var> ,  integer  <var class="pdparam">nbandB</var> <code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">ST_Overlaps</b>(</code> raster  <var class="pdparam">rastA</var> ,  raster  <var class="pdparam">rastB</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp76538368"></a><h2>説明</h2><p>rastAがrastBをオーバラップする場合にTRUEを返します。rastAとrastBがインタセクトして、かつ一方がもう一方に完全には包含されない場合にはいう意味です。バンド番号が指定されていないかNULLに指定されている場合には、ラスタの凸包のみを考慮してテストします。バンド番号が指定されている場合には、値を持つ (NODATAでない)ピクセルについてテストします。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はラスタで利用できるインデクスを使用します。 </p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ラスタとジオメトリの空間関係をテストするには、ST_Overlaps(ST_Polygon(raster), geometry)というふうに、ラスタにST_Polygonを使います。 </p></td></tr></table></div><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp76553728"></a><h2>例</h2><pre class="programlisting">-- 同じラスタの別のバンドの比較
SELECT ST_Overlaps(rast, 1, rast, 2) FROM dummy_rast WHERE rid = 2;

 st_overlaps
-------------
 f
            </pre></div><div class="refsection"><a name="idp76555008"></a><h2>関連情報</h2><p>
                <a class="xref" href="#RT_ST_Intersects" title="ST_Intersects">ST_Intersects</a>
            </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Touches"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Touches — rastAとrastBが少なくとも一つの共通の点を持ち、かつ二つのラスタの内部同士がインタセクトしない場合にTRUEを返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_Touches</b>(</code> raster  <var class="pdparam">rastA</var> ,  integer  <var class="pdparam">nbandA</var> ,  raster  <var class="pdparam">rastB</var> ,  integer  <var class="pdparam">nbandB</var> <code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">ST_Touches</b>(</code> raster  <var class="pdparam">rastA</var> ,  raster  <var class="pdparam">rastB</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp76568832"></a><h2>説明</h2><p>rastAがrastBに接触する場合にTRUEを返します。rastAとrastBが少なくとも一つの共通の点を持ち、かつ二つのラスタの内部同士がインタセクトしないという意味です。バンド番号が指定されていないかNULLに指定されている場合には、ラスタの凸包のみを考慮してテストします。バンド番号が指定されている場合には、値を持つ (NODATAでない)ピクセルについてテストします。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はラスタで利用できるインデクスを使用します。 </p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ラスタとジオメトリの空間関係をテストするには、ST_Touches(ST_Polygon(raster), geometry)というふうに、ラスタにST_Polygonを使います。 </p></td></tr></table></div><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp76571904"></a><h2>例</h2><pre class="programlisting">SELECT r1.rid, r2.rid, ST_Touches(r1.rast, 1, r2.rast, 1) FROM dummy_rast r1 CROSS JOIN dummy_rast r2 WHERE r1.rid = 2;

 rid | rid | st_touches
-----+-----+------------
   2 |   1 | f
   2 |   2 | f
            </pre></div><div class="refsection"><a name="idp76573184"></a><h2>関連情報</h2><p>
                <a class="xref" href="#RT_ST_Intersects" title="ST_Intersects">ST_Intersects</a>
            </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_SameAlignment"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SameAlignment — ラスタが同じスキュー、スケール、空間参照系、オフセットを持つ (ピクセルが分割されることなく同じグリッドに置かれている)場合にTRUEを返し、そうでない場合は問題を詳述する通知とともにFALSEを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_SameAlignment</b>(</code> raster  <var class="pdparam">rastA</var> ,  raster  <var class="pdparam">rastB</var> <code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">ST_SameAlignment</b>(</code> double precision  <var class="pdparam">ulx1</var> ,  double precision  <var class="pdparam">uly1</var> ,  double precision  <var class="pdparam">scalex1</var> ,  double precision  <var class="pdparam">scaley1</var> ,  double precision  <var class="pdparam">skewx1</var> ,  double precision  <var class="pdparam">skewy1</var> ,  double precision  <var class="pdparam">ulx2</var> ,  double precision  <var class="pdparam">uly2</var> ,  double precision  <var class="pdparam">scalex2</var> ,  double precision  <var class="pdparam">scaley2</var> ,  double precision  <var class="pdparam">skewx2</var> ,  double precision  <var class="pdparam">skewy2</var> <code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">ST_SameAlignment</b>(</code> raster set  <var class="pdparam">rastfield</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp76599680"></a><h2>説明</h2><p>非集計版 (一つ目と二つ目の形式): 二つのラスタ (直接与えたラスタでも左上隅、スケール、スキュー、SRIDを使って作ったものでも)が同じスキュー、スケール、空間参照系、を持ち、少なくとも4隅の一つがもう一方のラスタのグリッド隅に落ちる場合にTRUEを返します。そうでない場合には、問題に言及した警告を出します。 </p><p>集約関数版 (三つ目の形式): ラスタ集合から、全てのラスタが同じアラインメントを持つ場合にTRUEを返します。ST_SameAlignment()関数はPostgreSQLの用語で言うところの「集約」関数です。SUM()やAVG()といった複数のデータ行での操作を意味します。 </p><p>Availability: 2.0.0</p><p>Enhanced: 2.1.0 集約関数版の追加</p></div><div class="refsection"><a name="idp76601984"></a><h2>例: ラスタ</h2><pre class="programlisting">SELECT ST_SameAlignment(
    ST_MakeEmptyRaster(1, 1, 0, 0, 1, 1, 0, 0),
    ST_MakeEmptyRaster(1, 1, 0, 0, 1, 1, 0, 0)
) as sm;

sm
----
t
</pre><pre class="programlisting">SELECT ST_SameAlignment(A.rast,b.rast)
 FROM dummy_rast AS A CROSS JOIN dummy_rast AS B;

 NOTICE:  The two rasters provided have different SRIDs
NOTICE:  The two rasters provided have different SRIDs
 st_samealignment
------------------
 t
 f
 f
 f
</pre></div><div class="refsection"><a name="idp76603776"></a><h2>関連情報</h2><p><a class="xref" href="#RT_Loading_Rasters" title="11.1. ラスタのロードと生成">「ラスタのロードと生成」</a>, <a class="xref" href="#RT_ST_NotSameAlignmentReason" title="ST_NotSameAlignmentReason">ST_NotSameAlignmentReason</a>, <a class="xref" href="#RT_ST_MakeEmptyRaster" title="ST_MakeEmptyRaster">ST_MakeEmptyRaster</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_NotSameAlignmentReason"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_NotSameAlignmentReason — ラスタが同じアラインメントを持つかどうか、また、持たない場合にはその理由を示す文字列を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_NotSameAlignmentReason</b>(</code>raster <var class="pdparam">rastA</var>, raster <var class="pdparam">rastB</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp76611200"></a><h2>説明</h2><p>ラスタが同じアラインメントを持つかどうか、また、持たない場合にはその理由を示す文字列を返します。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ラスタが同じアラインメントを持たない理由が複数ある場合には、一つだけ （最初のテストで失敗した)理由を返します。 </p></td></tr></table></div><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp76613504"></a><h2>例</h2><pre class="programlisting">SELECT
    ST_SameAlignment(
        ST_MakeEmptyRaster(1, 1, 0, 0, 1, 1, 0, 0),
        ST_MakeEmptyRaster(1, 1, 0, 0, 1.1, 1.1, 0, 0)
    ),
    ST_NotSameAlignmentReason(
        ST_MakeEmptyRaster(1, 1, 0, 0, 1, 1, 0, 0),
        ST_MakeEmptyRaster(1, 1, 0, 0, 1.1, 1.1, 0, 0)
    )
;

 st_samealignment |            st_notsamealignmentreason
------------------+-------------------------------------------------
 f                | The rasters have different scales on the X axis
(1 row)
                </pre></div><div class="refsection"><a name="idp76614784"></a><h2>関連情報</h2><p><a class="xref" href="#RT_Loading_Rasters" title="11.1. ラスタのロードと生成">「ラスタのロードと生成」</a>, <a class="xref" href="#RT_ST_SameAlignment" title="ST_SameAlignment">ST_SameAlignment</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Within"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Within — rastAがrastBの外部に点を持たず、rastAの内部の少なくとも一つの点がrastBの内部にある場合にTRUEを返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_Within</b>(</code> raster  <var class="pdparam">rastA</var> ,  integer  <var class="pdparam">nbandA</var> ,  raster  <var class="pdparam">rastB</var> ,  integer  <var class="pdparam">nbandB</var> <code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">ST_Within</b>(</code> raster  <var class="pdparam">rastA</var> ,  raster  <var class="pdparam">rastB</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp76632960"></a><h2>説明</h2><p>rastAがrastBの外部に点を持たず、rastAの内部の少なくとも一つの点がrastBの内部にある場合にrastAはrastBに対してWithinです。バンド番号が指定されていないかNULLに指定されている場合には、ラスタの凸包のみを考慮してテストします。バンド番号が指定されている場合には、値を持つ (NODATAでない)ピクセルについてテストします。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これのオペランドは、ラスタで使用できるインデクスを使用します。 </p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ラスタとジオメトリの空間関係をテストするには、ST_Within(ST_Polygon(raster), geometry)またはST_Within(geometry, ST_Polygon(raster))というふうに、ラスタにST_Polygonを使います。 </p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_Within()はST_Contains()の逆です。ST_Within(rastA, rastB)はST_Contains(rastB, rastA)を示します。 </p></td></tr></table></div><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp76636800"></a><h2>例</h2><pre class="programlisting">SELECT r1.rid, r2.rid, ST_Within(r1.rast, 1, r2.rast, 1) FROM dummy_rast r1 CROSS JOIN dummy_rast r2 WHERE r1.rid = 2;

 rid | rid | st_within
-----+-----+-----------
   2 |   1 | f
   2 |   2 | t
            </pre></div><div class="refsection"><a name="idp76638080"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Intersects" title="ST_Intersects">ST_Intersects</a>, <a class="xref" href="#RT_ST_Contains" title="ST_Contains">ST_Contains</a>, <a class="xref" href="#RT_ST_DWithin" title="ST_DWithin">ST_DWithin</a>, <a class="xref" href="#RT_ST_DFullyWithin" title="ST_DFullyWithin">ST_DFullyWithin</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_DWithin"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_DWithin — rastAとrastBが指定した距離内にある場合にTRUEを返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_DWithin</b>(</code> raster  <var class="pdparam">rastA</var> ,  integer  <var class="pdparam">nbandA</var> ,  raster  <var class="pdparam">rastB</var> ,  integer  <var class="pdparam">nbandB</var> ,  double precision  <var class="pdparam">distance_of_srid</var> <code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">ST_DWithin</b>(</code> raster  <var class="pdparam">rastA</var> ,  raster  <var class="pdparam">rastB</var> ,  double precision  <var class="pdparam">distance_of_srid</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp76655488"></a><h2>説明</h2><p>rastAとrastBが指定した距離内にある場合にTRUEを返します。バンド番号が指定されていないかNULLに指定されている場合には、ラスタの凸包のみを考慮してテストします。バンド番号が指定されている場合には、値を持つ (NODATAでない)ピクセルについてテストします。 </p><p>distanceはラスタの空間参照系で定義される単位です。この関数が意味あるものにするには、元のラスタが両方とも同じ空間参照系である、つまり同じSRIDを持たなければなりません。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これのオペランドは、ラスタで使用できるインデクスを使用します。 </p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ラスタとジオメトリの空間関係をテストするには、ST_DWithin(ST_Polygon(raster), geometry)というふうに、ラスタにST_Polygonを使います。 </p></td></tr></table></div><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp76658944"></a><h2>例</h2><pre class="programlisting">SELECT r1.rid, r2.rid, ST_DWithin(r1.rast, 1, r2.rast, 1, 3.14) FROM dummy_rast r1 CROSS JOIN dummy_rast r2 WHERE r1.rid = 2;

 rid | rid | st_dwithin
-----+-----+------------
   2 |   1 | f
   2 |   2 | t
            </pre></div><div class="refsection"><a name="idp76664320"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Within" title="ST_Within">ST_Within</a>, <a class="xref" href="#RT_ST_DFullyWithin" title="ST_DFullyWithin">ST_DFullyWithin</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_DFullyWithin"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_DFullyWithin — rastAとrastBが指定した距離内に完全に収まる場合にTRUEを返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_DFullyWithin</b>(</code> raster  <var class="pdparam">rastA</var> ,  integer  <var class="pdparam">nbandA</var> ,  raster  <var class="pdparam">rastB</var> ,  integer  <var class="pdparam">nbandB</var> ,  double precision  <var class="pdparam">distance_of_srid</var> <code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">ST_DFullyWithin</b>(</code> raster  <var class="pdparam">rastA</var> ,  raster  <var class="pdparam">rastB</var> ,  double precision  <var class="pdparam">distance_of_srid</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp76680960"></a><h2>説明</h2><p>rastAとrastBが指定した距離内に完全に収まる場合にTRUEを返します。バンド番号が指定されていないかNULLに指定されている場合には、ラスタの凸包のみを考慮してテストします。バンド番号が指定されている場合には、値を持つ (NODATAでない)ピクセルについてテストします。 </p><p>distanceはラスタの空間参照系で定義される単位です。この関数が意味あるものにするには、元のラスタが両方とも同じ空間参照系である、つまり同じSRIDを持たなければなりません。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これのオペランドは、ラスタで使用できるインデクスを使用します。 </p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ラスタとジオメトリの空間関係をテストするには、ST_DFullyWithin(ST_Polygon(raster), geometry)というふうに、ラスタにST_Polygonを使います。 </p></td></tr></table></div><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp76708992"></a><h2>例</h2><pre class="programlisting">SELECT r1.rid, r2.rid, ST_DFullyWithin(r1.rast, 1, r2.rast, 1, 3.14) FROM dummy_rast r1 CROSS JOIN dummy_rast r2 WHERE r1.rid = 2;

 rid | rid | st_dfullywithin
-----+-----+-----------------
   2 |   1 | f
   2 |   2 | t
            </pre></div><div class="refsection"><a name="idp76710272"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Within" title="ST_Within">ST_Within</a>, <a class="xref" href="#RT_ST_DWithin" title="ST_DWithin">ST_DWithin</a> </p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Raster_Tips"></a>12.18. ラスタに関する技法</h2></div><div><div class="abstract"><div class="abstract-title">概要</div><p>本節では、PostGISラスタに関連する様々な落とし穴や技法について説明します。</p></div></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="#outdb">12.18.1. データベース外ラスタ</a></span></dt></dl></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="outdb"></a>12.18.1. データベース外ラスタ</h3></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect3"><a href="#gdal_readdir">12.18.1.1. 多数のファイルを持つディレクトリ</a></span></dt><dt><span class="sect3"><a href="#max_open_files">12.18.1.2. 開くことができるファイルの最大数</a></span></dt></dl></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="gdal_readdir"></a>12.18.1.1. 多数のファイルを持つディレクトリ</h4></div></div></div><p>GDALはファイルを開く時に、そのファイルのディレクトリを熱心にスキャンして、他のファイルのカタログを構築します。このディレクトリに多数のファイル (千とか万とか)あるとします。一つのファイルを開くと動作が非常に遅くなります (特にNFSのようなネットワークドライブの場合)。 </p><p>この振る舞いを制御するために、GDALには<a class="ulink" href="https://trac.osgeo.org/gdal/wiki/ConfigOptions#GDAL_DISABLE_READDIR_ON_OPEN" target="_top">GDAL_DISABLE_READDIR_ON_OPEN</a>という環境変数があります。<code class="varname">GDAL_DISABLE_READDIR_ON_OPEN</code>を<code class="varname">TRUE</code>に設定すると、ディレクトリのスキャンを無効にします。 </p><p>Ubuntuでは (Ubuntu用PostgreSQLのパッケージを使っていると仮定します)、<code class="varname">GDAL_DISABLE_READDIR_ON_OPEN</code>が<span class="emphasis"><em>/etc/postgresql/POSTGRESQL_VERSION/CLUSTER_NAME/environment</em></span>内で設定できます (POSTGRESQL_VERSIONは9.6等のPostgreSQLのバージョンで、CLUSTER_NAMEはmaindb等のクラスタ名です)。PostGIS環境変数もここで同じく設定できます。 </p><pre class="programlisting"># postmasterプロセスの環境変数
# このファイルはpostgresql.confと同じ文法で、次のように書きます。
#  VARIABLE = simple_value
#  VARIABLE2 = 'any value!'
# 例えば、英数文字と'-', '_', '.' (のシングルクォート内)以外の文字を含む値を囲む必要があります。
# シェルコマンドは評価されません。
POSTGIS_GDAL_ENABLED_DRIVERS = 'ENABLE_ALL'

POSTGIS_ENABLE_OUTDB_RASTERS = 1

<span class="strong"><strong>GDAL_DISABLE_READDIR_ON_OPEN = 'TRUE'</strong></span>
                    </pre><p>
                </p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="max_open_files"></a>12.18.1.2. 開くことができるファイルの最大数</h4></div></div></div><p>LinuxとPostgreSQLが許している、開くことができるファイルの最大数は、通常は増加していません (通常、プロセスあたり1024ファイルです)。システムは人間のユーザが使用するという仮定に立っているからです。データベース外ラスタは、一つの妥当なクエリで簡単に制限超過させることができます (例えば、10年分のラスタからなるデータセットで、個々のラスタは日別最低気温、最大気温を持っていて、データセット内の最大値と最小値を得たい場合などです)。 </p><p>最も簡単な変更方法は、PostgreSQL設定<a class="ulink" href="https://www.postgresql.org/docs/current/static/runtime-config-resource.html#GUC-MAX-FILES-PER-PROCESS" target="_top">max_files_per_process</a>です。デフォルトとして1000が設定されていますが、データベース外ラスタとしては非常に低い値です。安全な開始値は65536でしょう。ただし、実際には、これはデータベースとデータベースに対して実行されるクエリに依存します。サーバ開始時のみ、かつPostgreSQLコンフィギュレーションファイル (例: Ubuntu環境では<span class="emphasis"><em>/etc/postgresql/POSTGRESQL_VERSION/CLUSTER_NAME/postgresql.conf</em></span>)内のみで設定できます。 </p><pre class="programlisting">...
# - カーネルリソースの使用状況 -

<span class="strong"><strong>max_files_per_process = 65536</strong></span>           # min 25
                                        # (change requires restart)
...
                    </pre><p>
                </p><p>主な変更はLinuxカーネルのファイルを開く制限です。次の通り、二つに分かれます。 </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>システム全体で開くことができるファイルの最大数</p></li><li class="listitem"><p>プロセスごとに開くことができるファイルの最大数</p></li></ul></div><p>
                </p><div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a name="max_open_files_per_system"></a>12.18.1.2.1. システム全体で開くことができるファイルの最大数</h5></div></div></div><p>次の例で、システム全体の、現在の開くことができるファイルの最大値を調べることができます。 </p><pre class="programlisting">$ sysctl -a | grep fs.file-max
fs.file-max = 131072
                    </pre><p>返された値が十分には大きくない場合には、次に示す例に従って、<span class="emphasis"><em>/etc/sysctl.d/</em></span>にファイルを追加します。 </p><pre class="programlisting">$ echo "fs.file-max = 6145324" 
&gt;
&gt; /etc/sysctl.d/fs.conf

$ cat /etc/sysctl.d/fs.conf
fs.file-max = 6145324

$ sysctl -p --system
* Applying /etc/sysctl.d/fs.conf ...
fs.file-max = 2097152
* Applying /etc/sysctl.conf ...

$ sysctl -a | grep fs.file-max
fs.file-max = 6145324
                    </pre></div><div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a name="max_open_files_per_process"></a>12.18.1.2.2. プロセスごとの開けるファイルの最大数</h5></div></div></div><p>PostgreSQLのサーバプロセスごとに開けるファイルの最大数を増やす必要があります。 </p><p>現在のPostgreSQLサービスのプロセスは開くことができるファイルの最大数を使っていて、次の例のようになっています (PostgreSQLが実行されていることを確認して下さい)。 </p><pre class="programlisting">$ ps aux | grep postgres
postgres 31713  0.0  0.4 179012 17564 pts/0    S    Dec26   0:03 /home/dustymugs/devel/postgresql/sandbox/10/usr/local/bin/postgres -D /home/dustymugs/devel/postgresql/sandbox/10/pgdata
postgres 31716  0.0  0.8 179776 33632 ?        Ss   Dec26   0:01 postgres: checkpointer process
postgres 31717  0.0  0.2 179144  9416 ?        Ss   Dec26   0:05 postgres: writer process
postgres 31718  0.0  0.2 179012  8708 ?        Ss   Dec26   0:06 postgres: wal writer process
postgres 31719  0.0  0.1 179568  7252 ?        Ss   Dec26   0:03 postgres: autovacuum launcher process
postgres 31720  0.0  0.1  34228  4124 ?        Ss   Dec26   0:09 postgres: stats collector process
postgres 31721  0.0  0.1 179308  6052 ?        Ss   Dec26   0:00 postgres: bgworker: logical replication launcher

$ cat /proc/31718/limits
Limit                     Soft Limit           Hard Limit           Units
Max cpu time              unlimited            unlimited            seconds
Max file size             unlimited            unlimited            bytes
Max data size             unlimited            unlimited            bytes
Max stack size            8388608              unlimited            bytes
Max core file size        0                    unlimited            bytes
Max resident set          unlimited            unlimited            bytes
Max processes             15738                15738                processes
<span class="strong"><strong>Max open files            1024                 4096                 files</strong></span>
Max locked memory         65536                65536                bytes
Max address space         unlimited            unlimited            bytes
Max file locks            unlimited            unlimited            locks
Max pending signals       15738                15738                signals
Max msgqueue size         819200               819200               bytes
Max nice priority         0                    0
Max realtime priority     0                    0
Max realtime timeout      unlimited            unlimited            us
                    </pre><p>上の例では、プロセスに対する開くことができるファイルの制限が31718になっています。どのプロセスがどうするかは問題ではありません。関心を持っている応答は<span class="emphasis"><em>Max open files</em></span>です。 </p><p><span class="emphasis"><em>Max open files</em></span>の<span class="emphasis"><em>Soft Limit</em></span>と<span class="emphasis"><em>Hard Limit</em></span>をPostgreSQLの設定で指定した<code class="varname">max_files_per_process</code>よりも多くなるようにしたいと思っています。この例では、<code class="varname">max_files_per_process</code>を65536にしています。 </p><p>Ubuntu (かつ、Ubuntu用PostgreSQLパッケージを使用しているものとします)では、<span class="emphasis"><em>Soft Limit</em></span>と<span class="emphasis"><em>Hard Limit</em></span>の変更については、<span class="strong"><strong>/etc/init.d/postgresql</strong></span> (SysV)または<span class="strong"><strong>/lib/systemd/system/postgresql*.service</strong></span> (systemd)を編集するのが簡単な方法です。 </p><p>まず、SysV Ubuntuを扱います。<span class="strong"><strong>ulimit -H -n 262144</strong></span>と<span class="strong"><strong>ulimit -n 131072</strong></span>を<span class="strong"><strong>/etc/init.d/postgresql</strong></span>に追加します。 </p><pre class="programlisting">...
case "$1" in
    start|stop|restart|reload)
        if [ "$1" = "start" ]; then
            create_socket_directory
        fi
    if [ -z "`pg_lsclusters -h`" ]; then
        log_warning_msg 'No PostgreSQL clusters exist; see "man pg_createcluster"'
        exit 0
    fi
<span class="strong"><strong>
    ulimit -H -n 262144
    ulimit -n 131072
</strong></span>
    for v in $versions; do
        $1 $v || EXIT=$?
    done
    exit ${EXIT:-0}
        ;;
    status)
...
</pre><p>Ubuntuのsystemdを扱います。<span class="strong"><strong>LimitNOFILE=131072</strong></span>を<span class="strong"><strong>/lib/systemd/system/postgresql*.service</strong></span>の各ファイルの<span class="strong"><strong>[Service]</strong></span>セクション内に記述します。 </p><pre class="programlisting">...
[Service]
<span class="strong"><strong>
LimitNOFILE=131072
</strong></span>
...

[Install]
WantedBy=multi-user.target
...
</pre><p>必要なシステムの変更を行った後、デーモンのリロードを必ず行ってください。 </p><pre class="programlisting">systemctl daemon-reload
</pre></div></div></div></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="RT_FAQ"></a>第13章 PostGISラスタ よくある質問</h1></div></div></div><div class="qandaset"><a name="idp81491840"></a><dl><dt>13.1. <a href="#idp81492096">PostGISラスタプロジェクトに関するより多くの情報はどこにありますか?</a></dt><dt>13.2. <a href="#idp81535360">この素晴らしいものを始めるための書籍やチュートリアルはありますか?</a></dt><dt>13.3. <a href="#idp81540224">PostGISデータベースにラスタ機能をインストールするにはどうすればよいでしょうか?</a></dt><dt>13.4. <a href="#idp81547136">ラスタデータをPostGISにロードするにはどうすればよいでしょうか?</a></dt><dt>13.5. <a href="#idp81549824">ロード可能なラスタファイルの種類は何ですか?</a></dt><dt>13.6. <a href="#idp81553152">PostGISラスタデータを他のラスタ形式に出力できますか?</a></dt><dt>13.7. <a href="#idp81576320">GDALバイナリはPostGISラスタ機能付きでコンパイルされていますか?</a></dt><dt>13.8. <a href="#idp81579904">PostGISラスタデータを見るのに使うことができるツールは何ですか?</a></dt><dt>13.9. <a href="#idp81583232">MapServerの地図にPostGISラスタレイヤを追加するにはどうすればいいですか?</a></dt><dt>13.10. <a href="#idp81588352">現在ラスタデータで使用できる関数は何ですか?</a></dt><dt>13.11. <a href="#qa_raster_function_not_unique">「ERROR: function st_intersects(raster, unknown) is not unique or st_union(geometry,text) is not unique.」というエラーが出ました。解消するにはどうすればいいでしょうか?</a></dt><dt>13.12. <a href="#idp81599360">PostGISラスタとOracle GeoRaster (SDO_GEORATGER)およびSDO_RASTERとどの位違うのでしょうか?</a></dt><dt>13.13. <a href="#qa_raster_fails_encoding_conversion">raster2pgsqlにより巨大なファイルのロードがString of N bytes is too long for encoding conversionと言われて失敗しますがどうすればよいでしょうか?</a></dt><dt>13.14. <a href="#faq_security_change_1">ST_FromGDALRasterを使うとERROR: RASTER_fromGDALRaster: Could not open bytea with GDAL. Check that the bytea is of a GDAL supported format.というエラーが出ます。また、ST_AsPNGや他の入力関数を使おうとするとERROR: rt_raster_to_gdal: Could not load the output GDAL driverというエラーが出ます。</a></dt></dl><table border="0" style="width: 100%;"><colgroup><col align="left" width="1%"><col></colgroup><tbody><tr class="question"><td align="left" valign="top"><a name="idp81492096"></a><a name="idp81492352"></a><p><b>13.1.</b></p></td><td align="left" valign="top"><p>PostGISラスタプロジェクトに関するより多くの情報はどこにありますか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p><a class="ulink" href="http://trac.osgeo.org/postgis/wiki/WKTRaster" target="_top">PostGIS Raster home page</a>をご覧下さい。</p></td></tr><tr class="question"><td align="left" valign="top"><a name="idp81535360"></a><a name="idp81535616"></a><p><b>13.2.</b></p></td><td align="left" valign="top"><p>この素晴らしいものを始めるための書籍やチュートリアルはありますか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>網羅的な初心者用チュートリアルは<a class="ulink" href="http://trac.osgeo.org/postgis/wiki/WKTRasterTutorial01" target="_top">Intersecting vector buffers with large raster coverage using PostGIS Raster</a>にあります。PostGISラスタに関するJorgeさんの一連のブログに、ラスタデータのロード方法、Oracle GeoRasterのタスクとのクロス比較があります。<a class="ulink" href="http://gis4free.wordpress.com/category/postgis-raster/" target="_top">Jorge's PostGIS Raster / Oracle GeoRaster Series</a>をご覧ください。 <a class="ulink" href="https://www.manning.com/books/postgis-in-action-second-edition" target="_top">PostGIS in Action - Raster chapter. Also covered in second edition.</a>では、章全体(35ページ超)がPostGISラスタにささげられていて、フリーのコードとデータのダウンロードもできます。 Manningからハードコピー本または電子書籍版を<a class="ulink" href="http://www.postgis.us/page_buy_book" target="_top">Buy PostGIS in Action</a>から購入することができます。また、Amazon等書籍販売サイトで購入することも可能です。全てのハードコピー本は電子書籍版の無償ダウンロードのクーポンが付きます。 </p><p>PostGISラスタのユーザからのレビューが<a class="ulink" href="http://fuzzytolerance.info/blog/2010/10/26/2010-10-26-postgis-raster-ftw/" target="_top">PostGIS raster applied to land classification urban forestry</a>にあります。</p></td></tr><tr class="question"><td align="left" valign="top"><a name="idp81540224"></a><a name="idp81540480"></a><p><b>13.3.</b></p></td><td align="left" valign="top"><p>PostGISデータベースにラスタ機能をインストールするにはどうすればよいでしょうか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>PostGISラスタはPostGISのコードベースの一部であり、一般的にPostGISバイナリ配布では有効です。PostGIS 3.0からは、PostGISラスタは別のエクステンションとなっていて、データベースで有効にするには`CREATE EXTENSION postgis_raster;`を実行する必要があります。PostGISをコンパイルする場合にはGDALを合わせてコンパイルする必要があり、そうでないならpostgis_rasterエクステンションはビルドされません。</p><p>ラスタ機能を持つPostGISの一般的なディストリビューションについては<a class="ulink" href="http://postgis.net/install/" target="_top">Download PostGIS binaries</a>を参照して下さい。</p></td></tr><tr class="question"><td align="left" valign="top"><a name="idp81547136"></a><a name="idp81547392"></a><p><b>13.4.</b></p></td><td align="left" valign="top"><p>ラスタデータをPostGISにロードするにはどうすればよいでしょうか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>PostGIS最新版には、ラスタローダ<code class="varname">raster2pgsql</code>があります。多種のラスタのロードが可能で、低解像度のオーバビューを作成することが可能な実行可能ファイルで、他のソフトウェアを要しません。詳細情報については<a class="xref" href="#RT_Raster_Loader" title="11.1.1. raster2pgsqlを使ってラスタをロードする">「raster2pgsqlを使ってラスタをロードする」</a>を参照して下さい。</p></td></tr><tr class="question"><td align="left" valign="top"><a name="idp81549824"></a><a name="idp81550080"></a><p><b>13.5.</b></p></td><td align="left" valign="top"><p>ロード可能なラスタファイルの種類は何ですか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>GDALライブラリがサポートするもの全てです。GDALがサポートする形式については<a class="ulink" href="http://www.gdal.org/formats_list.html" target="_top">GDAL File Formats</a>にあります。</p><p>インストールで、一部の形式に対応していない可能性があります。インストールしたGDALがサポートする形式を確認するには、次を実行してください。</p><pre class="programlisting">raster2pgsql -G</pre></td></tr><tr class="question"><td align="left" valign="top"><a name="idp81553152"></a><a name="idp81553408"></a><p><b>13.6.</b></p></td><td align="left" valign="top"><p>PostGISラスタデータを他のラスタ形式に出力できますか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>はい</p><p>PostGISラスタには<a class="xref" href="#RT_ST_AsGDALRaster" title="ST_AsGDALRaster">ST_AsGDALRaster</a>関数があり、GDALによってSQLを使ってあらゆるラスタ書式に出力することができます。書式リストはSQL関数<a class="xref" href="#RT_ST_GDALDrivers" title="ST_GDALDrivers">ST_GDALDrivers</a>を使うことで見ることができます。</p><p>PostGISラスタを他の書式にエクスポートするのに、GDALコマンドラインツールも使うことができます。GDALはPostGISラスタのドライバを持っています。ただし、PostgreSQL対応でコンパイルするよう指定した場合に限ります。 </p><p>PostGISラスタ型に不規則なブロックのラスタを格納できますが、GDALドライバは現在のところ不規則なブロックのラスタには対応していません。</p><p>ソースからコンパイルする場合、ドライバを有効にするには、コンフィギュアに</p><pre class="programlisting">--with-pg=path/to/pg_config</pre><p>を入れる必要があります。まざまなプラットフォーム上でGDALをビルドする際の各種情報については、<a class="ulink" href="http://trac.osgeo.org/gdal/wiki/BuildHints" target="_top">GDAL Build Hints</a>を参照して下さい。 </p><p>GDALをPostGISラスタドライバ付きでコンパイルしているなら、次のコマンドを実行すると、リストにPostGIS Rasterが現れます。 </p><pre class="programlisting">gdalinfo --formats</pre><p>GDALからラスタに関する要約を得るには、gdalinfoを使います。 </p><pre class="programlisting">gdalinfo  "PG:host=localhost port=5432 dbname='mygisdb' user='postgres' password='whatever' schema='someschema' table=sometable"</pre><p>
		 </p><p>他のラスタ書式へデータを出力するには、gdal_translateを使います。下で示すものは、テーブルからのデータ全体を10%のサイズのPNGファイルにして出力します。</p><p>ピクセルバンドタイプについて、出力書式がサポートしない場合は、変換が機能しないことがあります。たとえば、浮動小数点数と32ビット符号なし整数は、JPGや他の書式に簡単には変換しません。</p><p>次に単純な変換の例を示します。</p><pre class="programlisting">gdal_translate -of PNG -outsize 10% 10% "PG:host=localhost port=5432 dbname='mygisdb' user='postgres' password='whatever' schema='someschema' table=sometable" C:\somefile.png</pre><p>また、ドライバ接続文字列内でwhere=...を使って、SQLのWHERE節を使うことができます。次に例を示します。</p><pre class="programlisting">gdal_translate -of PNG -outsize 10% 10% "PG:host=localhost port=5432 dbname='mygisdb' user='postgres' password='whatever' schema='someschema' table=sometable where='filename=\'abcd.sid\''" " C:\somefile.png</pre><pre class="programlisting">gdal_translate -of PNG -outsize 10% 10% "PG:host=localhost port=5432 dbname='mygisdb' user='postgres' password='whatever' schema='someschema' table=sometable where='ST_Intersects(rast, ST_SetSRID(ST_Point(-71.032,42.3793),4326) )' " C:\intersectregion.png</pre><p>より多くの例、構文については<a class="ulink" href="https://gdal.org/drivers/raster/postgisraster.html" target="_top">Reading Raster Data of PostGIS Raster section</a>を参照してください。</p></td></tr><tr class="question"><td align="left" valign="top"><a name="idp81576320"></a><a name="idp81576576"></a><p><b>13.7.</b></p></td><td align="left" valign="top"><p>GDALバイナリはPostGISラスタ機能付きでコンパイルされていますか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>はい<a class="ulink" href="https://gdal.org/download.html#binaries" target="_top">GDAL Binaries</a>のページをご覧下さい。PostgreSQL対応でコンパイルされているものはPostGISラスタを持っています。GDALツールも一般的に<a class="ulink" href="https://qgis.org" target="_top">QGIS</a>の一部として含まれています。</p><p>Windows用の最新のナイトリビルドを得るには、Visual StudioでビルドしたTamas Szekeresナイトリビルドを見てみて下さい。GDALの開発途中版とPythonバインディングとMapServer実行ファイルとPostGISラスタドライバが組み込まれています。 SDKバッチファイルをクリックして、そこからコマンドを実行します。 <a class="ulink" href="www.gisinternals.com" target="_top">http://www.gisinternals.com</a>にあります。Visual Studioプロジェクトファイルもあります。</p></td></tr><tr class="question"><td align="left" valign="top"><a name="idp81579904"></a><a name="idp81580160"></a><p><b>13.8.</b></p></td><td align="left" valign="top"><p>PostGISラスタデータを見るのに使うことができるツールは何ですか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>ラスタデータの表示に、GDALとコンパイルした<a class="ulink" href="https://mapserver.org/" target="_top">MapServer</a>が使えます。QGISは、PostGISラスタのドライバがインストールされているなら、PostGISラスタの表示に対応します。</p><p>理論上、GDALを使用してデータをレンダリングするツールはPostGISラスタに対応できるか、ごく小さな労力で対応できます。Windowsの場合も、ご自身でコンパイルする面倒を望まないなら、Tamasさんのバイナリ<a class="ulink" href="www.gisinternals.com" target="_top">http://www.gisinternals.com</a>が良い選択です。</p></td></tr><tr class="question"><td align="left" valign="top"><a name="idp81583232"></a><a name="idp81583488"></a><p><b>13.9.</b></p></td><td align="left" valign="top"><p>MapServerの地図にPostGISラスタレイヤを追加するにはどうすればいいですか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>まずGDAL 1.7以上をPostGISラスタ機能付きでコンパイルします。多数の問題が1.8で解消していて、GDAL 3以上が望ましいです。また、より多くのPostGISラスタの問題は開発中の版で解消しています。</p><p>他のラスタでできることと同じことができます。MapServerラスタレイヤで使うことができる様々な処理機能の一覧を得るには<a class="ulink" href="http://mapserver.org/input/raster.html" target="_top">MapServer Raster processing options</a>を参照して下さい。</p><p>PostGISラスタデータを特に興味深くするのは、それぞれのタイルが様々な標準的なデータベースカラムを持ち得るので、データソースで分割することができる点です。</p><p>次に示す例は、PostGISラスタレイヤをMapServer内で定義する方法です。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>mode=2 では、タイル化されたラスタが求められるもので、PostGIS 2.0とGDAL 1.8ドライバで追加されています。これはGDAL 1.7ドライバにはありません。</p></td></tr></table></div><pre class="programlisting">-- 標準的なラスタの設定を付けてラスタを表示する
LAYER
        NAME coolwktraster
        TYPE raster
        STATUS ON
        DATA "PG:host=localhost port=5432 dbname='somedb' user='someuser' password='whatever'
                schema='someschema' table='cooltable' mode='2'"
        PROCESSING "NODATA=0"
        PROCESSING "SCALE=AUTO"
        #... 他の標準的なラスタ処理関数はここに入ります
        #... クラスは必須ではないですが1バンドデータに使えます
        CLASS
                NAME "boring"
                EXPRESSION ([pixel] &lt; 20)
                COLOR 250 250 250
        END
        CLASS
                NAME "mildly interesting"
                EXPRESSION ([pixel] &gt; 20 AND [pixel] &lt; 1000)
                COLOR 255 0 0
        END
        CLASS
                NAME "very interesting"
                EXPRESSION ([pixel] &gt;= 1000)
                COLOR 0 255 0
        END
END
        </pre><pre class="programlisting">-- 標準的なラスタの設定と、WHERE節をつけてラスタを表示する
LAYER
        NAME soil_survey2009
        TYPE raster
        STATUS ON
        DATA "PG:host=localhost port=5432 dbname='somedb' user='someuser' password='whatever'
                schema='someschema' table='cooltable' where='survey_year=2009' mode='2'"
        PROCESSING "NODATA=0"
        #... other standard raster processing functions here
        #... classes are optional but useful for 1 band data
END
        </pre></td></tr><tr class="question"><td align="left" valign="top"><a name="idp81588352"></a><a name="idp81588608"></a><p><b>13.10.</b></p></td><td align="left" valign="top"><p>現在ラスタデータで使用できる関数は何ですか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p><a class="xref" href="#RT_reference" title="第12章 ラスタ リファレンス">12章<i>ラスタ リファレンス</i></a>のリストを参照して下さい。これよりも多くの関数がありますが、開発途中です。</p><p>将来的に期待できる関数の詳細情報については<a class="ulink" href="http://trac.osgeo.org/postgis/wiki/WKTRaster/PlanningAndFunding" target="_top">PostGIS Raster roadmap page</a>をご覧下さい。</p></td></tr><tr class="question"><td align="left" valign="top"><a name="qa_raster_function_not_unique"></a><a name="idp81595904"></a><p><b>13.11.</b></p></td><td align="left" valign="top"><p>「ERROR: function st_intersects(raster, unknown) is not unique or st_union(geometry,text) is not unique.」というエラーが出ました。解消するにはどうすればいいでしょうか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>引数のひとつがジオメトリでなくジオメトリの文字列表現である場合、一意でない関数エラーが発生します。この場合、PostgreSQLは文字列表現を未知の型とします。そうするとst_intersects(raster, geometry)かst_intersects(raster,raster)かのどちらかになります。理論上両方の関数ともにリクエストに沿うことになるので、一意でないことになります。これを回避するには、GEOMETRY型にキャストして下さい。</p><p>たとえば次のようになっているとします。</p><pre class="programlisting">SELECT rast
 FROM my_raster
   WHERE ST_Intersects(rast, 'SRID=4326;POINT(-10 10)');</pre><p>次の通りにコードを変更すれば文字列表現をジオメトリにキャストします。</p><pre class="programlisting">SELECT rast
 FROM my_raster
   WHERE ST_Intersects(rast, 'SRID=4326;POINT(-10 10)'::geometry);</pre></td></tr><tr class="question"><td align="left" valign="top"><a name="idp81599360"></a><a name="idp81599616"></a><p><b>13.12.</b></p></td><td align="left" valign="top"><p>PostGISラスタとOracle GeoRaster (SDO_GEORATGER)およびSDO_RASTERとどの位違うのでしょうか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>この話題に関するより広範囲な議論については、Jorge Arévaloさんの<a class="ulink" href="http://gis4free.wordpress.com/2010/07/19/oracle-georaster-part-i/" target="_top">Oracle GeoRaster and PostGIS Raster: First impressions </a>をご覧ください。</p><p>ラスタごとのジオリファレンスがレイヤごとのジオリファレンスより優れいていることの主たるものは次の通りです。</p><p>* カバレッジが必ずしも長方形でなくてよいこと (この長方形はしばしば広範囲におよぶラスタカバレッジになります。この文書内にある可能なラスタの配置をご覧ください)</p><p>* オーバラップするラスタ (ベクタからラスタへの変換で欠損無く実装できる点で重要) </p><p>これらの配置はOracleでも可能ですが、多数のSDO_RASTERテーブルと関連付けられる複数のSDO_GEORASTERオブジェクトを格納することになります。複雑なカバレッジになると、データベース上の数百のテーブルにおよぶこともあります。PostGISラスタを使うと、似たようなラスタ配置を一つのテーブルで行うことができます。</p><p>PostGISがユーザに隙間やオーバラップの無い長方形ベクタカバレッジ (完全な長方形トポロジのレイヤ)を強制するのに少し似ています。これは、いくつかのアプリケーションにおいては非常に実際的ですが、実際に行うと、ほとんどのカバレッジにとって、現実的でなく望ましくもないことが分かりました。ベクタ構造には、不連続かつ非長方形のカバレッジを格納する柔軟性が必要です。ラスタ構造が同様に利益を受けることについて、私たちは大きな利点であると考えます。 </p></td></tr><tr class="question"><td align="left" valign="top"><a name="qa_raster_fails_encoding_conversion"></a><a name="idp81604096"></a><p><b>13.13.</b></p></td><td align="left" valign="top"><p>raster2pgsqlにより巨大なファイルのロードがString of N bytes is too long for encoding conversionと言われて失敗しますがどうすればよいでしょうか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>raster2pgsqlは、ロード用ファイルを生成するときにデータベース接続を行いません。データベースに明示的にデータベースの文字エンコーディングと異なるものを設定している場合には、巨大な (30MB以上)ラスタファイルをロードするときに、<code class="code">bytes is too long for encoding conversion</code>になることがあります。</p><p>これは、一般的には、たとえばデータベースがUTF-8であるのに、Windowsアプリケーションに対応するために、クライアントの文字エンコーディングが<code class="code">WIN1252</code>に設定されている場合に発生します。</p><p>これを回避策するには、ロードする間、クライアントの文字エンコーディングをデータベースと同じにします。明示的な文字エンコーディング設定をスクリプトに入れることで実現できます。たとえば、Windows上では次のようにします。 </p><pre class="programlisting">set PGCLIENTENCODING=UTF8</pre><p>Unix/Linuxの場合には、次のようにします。 </p><pre class="programlisting">export PGCLIENTENCODING=UTF8</pre><p>Goryさんがこの問題の詳細を<a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2209" target="_top">http://trac.osgeo.org/postgis/ticket/2209</a>に記述しています。</p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq_security_change_1"></a><a name="idp81638528"></a><p><b>13.14.</b></p></td><td align="left" valign="top"><p>ST_FromGDALRasterを使うと<code class="code">ERROR: RASTER_fromGDALRaster: Could not open bytea with GDAL. Check that the bytea is of a GDAL supported format.</code>というエラーが出ます。また、ST_AsPNGや他の入力関数を使おうとすると<code class="code">ERROR: rt_raster_to_gdal: Could not load the output GDAL driver</code>というエラーが出ます。</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>PostGIS 2.1.3と2.0.5では、セキュリティ変更が行われ、全てのGDALドライバとデータベース外ラスタは、デフォルトでは使えなくなりました。リリースノートは<a class="ulink" href="http://postgis.net/2014/05/19/postgis-2.0.6_and_2.1.3" target="_top">PostGIS 2.0.6, 2.1.3 security release</a>にあります。特定のドライバまたは全てのドライバを再有効化する方法と、データベース外ラスタ機能を再有効化する方法については、<a class="xref" href="#install_short_version" title="2.1. 簡略版">「簡略版」</a>をご覧下さい。</p></td></tr></tbody></table></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="Extras"></a>第14章 PostGIS追加機能</h1></div></div></div><div class="toc"><div class="toc-title">目次</div><dl class="toc"><dt><span class="sect1"><a href="#Address_Standardizer">14.1. 住所標準化</a></span></dt><dd><dl><dt><span class="sect2"><a href="#Address_Standardizer_Basics">14.1.1. パーサの動作</a></span></dt><dt><span class="sect2"><a href="#Address_Standardizer_Types">14.1.2. 住所標準化の型</a></span></dt><dt><span class="sect2"><a href="#Address_Standardizer_Tables">14.1.3. 住所標準化テーブル</a></span></dt><dt><span class="sect2"><a href="#Address_Standardizer_Functions">14.1.4. 住所標準化関数</a></span></dt></dl></dd><dt><span class="sect1"><a href="#Tiger_Geocoder">14.2. Tigerジオコーダ</a></span></dt></dl></div><p>本章では、PostGISのソースアーカイブファイルとソースレポジトリの中にあるextrasフォルダに存在する機能について説明します。PostGISのバイナリリリースに常にパッケージ化されているわけではありませんが、通常は、そのままで実行可能なPL/pgSQLベースもしくは標準的なシェルスクリプトです。</p><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Address_Standardizer"></a>14.1. 住所標準化</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="#Address_Standardizer_Basics">14.1.1. パーサの動作</a></span></dt><dt><span class="sect2"><a href="#Address_Standardizer_Types">14.1.2. 住所標準化の型</a></span></dt><dt><span class="sect2"><a href="#Address_Standardizer_Tables">14.1.3. 住所標準化テーブル</a></span></dt><dt><span class="sect2"><a href="#Address_Standardizer_Functions">14.1.4. 住所標準化関数</a></span></dt></dl></div><p>これは、<a class="ulink" href="http://www.pagcgeo.org/docs/html/pagc-11.html" target="_top">PAGC standardizer</a>から分かれたものです (オリジナルのコードは<a class="ulink" href="http://sourceforge.net/p/pagc/code/360/tree/branches/sew-refactor/postgresql" target="_top">PAGC PostgreSQL Address Standardizer</a>にあります)。 </p><p>住所標準化は単一行の住所のパーサで、入力に住所を取り、テーブルに保存された規則と、補助テーブルlex (lexicon, 語彙)およびgaz (gazetteer, 地名集)とを基に正規化します。</p><p>コードは、<code class="code">address_standardizer</code>という名前の、1つのPostgreSQLエクステンションとしてビルドされます。<code class="code">CREATE EXTENSION address_standardizer;</code>でインストールできます。address_standardizerエクステンションとともに、<code class="code">address_standardizer_data_us</code>というサンプルデータのエクステンションがビルドされます。これには、アメリカのgaz, lexとrulesテーブルデータがあります。このエクステンションは<code class="code">CREATE EXTENSION address_standardizer_data_us;</code>でインストールできます。</p><p>このエクステンションのコードはPostGISの<code class="filename">extensions/address_standardizer</code>内にあり、現在は自己充足しています。</p><p>インストール手順については、<a class="xref" href="#installing_pagc_address_standardizer" title="2.3. PAGC住所標準化ツールのインストールと使用">「PAGC住所標準化ツールのインストールと使用」</a>を参照してください。</p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="Address_Standardizer_Basics"></a>14.1.1. パーサの動作</h3></div></div></div><p>パーサは右から左に見ます。最初に郵便番号、州/県、市のMACRO (訳注: マクロ)要素を見ます。その後、番地または交差点もしくはランドマークを扱う場合には、MICRO (訳注: マイクロ)要素を見ます。現在は、国別コードや国名を見ませんが、将来的には導入できると思います。</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">国別コード</span></dt><dd><p>USまたはCAを仮定します。郵便番号か州/県で米国かカナダを分けますが、判別できない場合は米国とします。</p></dd><dt><span class="term">郵便番号</span></dt><dd><p>Perl互換の正規表現を使用して認識します。正規表現は現在はparseaddress-api.cにあり、必要な際の変更は比較的簡単です。</p></dd><dt><span class="term">州/県</span></dt><dd><p>Perl互換の正規表現を使用して認識します。正規表現は現在はparseaddress-api.cにありますが、将来的には、メンテナンスを簡単にするためにインクルードファイルに移動するかも知れません。</p></dd></dl></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="Address_Standardizer_Types"></a>14.1.2. 住所標準化の型</h3></div><div><div class="abstract"><div class="abstract-title">概要</div><p>本節では住所標準化でインストールされたPostgreSQLデータ型の一覧を挙げます。独自関数をデザインする時に特に重要となるキャストの振る舞いを記述しています。 </p></div></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#stdaddr">stdaddr</a></span><span class="refpurpose"> — 住所の要素からなる複合型です。<code class="varname">standardize_address</code>関数が返す型です。</span></dt></dl></div><div class="refentry"><a name="stdaddr"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>stdaddr — 住所の要素からなる複合型です。<code class="varname">standardize_address</code>関数が返す型です。</p></div><div class="refsection"><a name="idp81761152"></a><h2>説明</h2><p>住所の要素からなる複合型です。<code class="varname">standardize_address</code>関数が返す型です。要素の記述のいくつかは<a class="ulink" href="http://www.pagcgeo.org/docs/html/pagc-12.html#ss12.1" target="_top">PAGC Postal Attributes</a>から借りています。</p><p>トークン番号は、<a class="xref" href="#rulestab" title="規則テーブル">規則テーブル</a>内の出力参照番号を示します。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method needs address_standardizer extension.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">building</span></dt><dd><p>文字列 (トークン番号<code class="code">0</code>): 建物番号や建物名を参照します。解析されていない建物識別子と型です。一般的に、ほとんどの住所では空白です。</p></dd><dt><span class="term">house_num</span></dt><dd><p>文字列 (トークン番号<code class="code">1</code>): ストリートの番号です。<code class="code">75 State Street</code>では<span class="emphasis"><em>75</em></span>にあたります。</p></dd><dt><span class="term">predir</span></dt><dd><p>文字列 (トークン番号<code class="code">2</code>): North, South, East, Westといった、ストリート名の方角前置語です。</p></dd><dt><span class="term">qual</span></dt><dd><p>文字列 (トークン番号 <code class="code">3</code>): ストリート名の修飾前置語です。<code class="code">3715 OLD HIGHWAY 99</code>では<span class="emphasis"><em>OLD</em></span>にあたります。</p></dd><dt><span class="term">pretype</span></dt><dd><p>文字列 (トークン番号 <code class="code">4</code>): STREET PREFIX TYPE (ストリート名の前置詞の種別)</p></dd><dt><span class="term">name</span></dt><dd><p>文字列 (トークン番号 <code class="code">5</code>): ストリート名</p></dd><dt><span class="term">suftype</span></dt><dd><p>文字列 (トークン番号 <code class="code">6</code>): St, Ave, Cir等の、後置詞の種別。ストリート名に続いて記述されるものです。<code class="code">75 State Street</code>では<span class="emphasis"><em>STREET</em></span>が該当します。</p></dd><dt><span class="term">sufdir</span></dt><dd><p>文字列 (トークン番号 <code class="code">7</code>): ストリート名に続くNorth, South, East, Westといった、ストリート名の方角前置語です。<code class="code">3715 TENTH AVENUE WEST</code>では<span class="emphasis"><em>WEST</em></span>が該当します。</p></dd><dt><span class="term">ruralroute</span></dt><dd><p>文字列 (トークン番号 <code class="code">8</code>): RURAL ROUTE (地方集配路線)。<code class="code">RR 7</code>では<span class="emphasis"><em>7</em></span>が該当します。</p></dd><dt><span class="term">extra</span></dt><dd><p>文字列: 階番号のような追加的情報です。</p></dd><dt><span class="term">city</span></dt><dd><p>文字列 (トークン番号 <code class="code">10</code>): 市名です。Boston等が該当します。</p></dd><dt><span class="term">state</span></dt><dd><p>文字列 (トークン番号 <code class="code">11</code>): 州名です。<code class="code">MASSACHUSETTS</code>が該当します。</p></dd><dt><span class="term">country</span></dt><dd><p>文字列 (トークン番号 <code class="code">12</code>): 国名です。<code class="code">USA</code>が該当します。</p></dd><dt><span class="term">postcode</span></dt><dd><p>文字列 (トークン番号 <code class="code">13</code>): 郵便番号 (POSTAL CODE, ZIP CODE)です。<code class="code">02109</code>等です。</p></dd><dt><span class="term">box</span></dt><dd><p>文字列 (トークン番号 <code class="code">14</code>と<code class="code">15</code>): 私書箱番号です。<code class="code">02109</code>等です。</p></dd><dt><span class="term">unit</span></dt><dd><p>文字列 (トークン番号 <code class="code">17</code>): 部屋番号です。<code class="code">APT 3B</code>の<span class="emphasis"><em>3B</em></span>が該当します。</p></dd></dl></div></div></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="Address_Standardizer_Tables"></a>14.1.3. 住所標準化テーブル</h3></div><div><div class="abstract"><div class="abstract-title">概要</div><p>本節では、住所標準化が住所の正規化に使うPostgreSQLテーブルの書式を挙げます。これらのテーブルはここで参照している名前と同じである必要はありません。例または独自ジオコーダのために、国ごとに異なるlex (lexicon, 語彙)、gaz (gazetteer, 地名集)およびrulesテーブルを持つことができます。これらのテーブルの名前は、住所標準化関数に渡されます。 </p><p>同梱されている<code class="varname">address_standardizer_data_us</code>エクステンションには、米国の住所標準化のためのデータがあります。</p></div></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#rulestab">規則テーブル</a></span><span class="refpurpose"> — 規則テーブルには、住所入力順列トークンから標準化した出力順列への対応付けに関する規則の集合が入ります。それぞれの規則は、入力トークン、-1 (終端)、出力トークン、-1、規則の種類を示す数字、規則の階級、からなります。</span></dt><dt><span class="refentrytitle"><a href="#lextab">lexテーブル</a></span><span class="refpurpose"> — lexテーブルは英数字の入力をクラス分けして (a) 入力トークン (「入力トークン」 参照)と (b)  標準化表現 とに関連付けます。</span></dt><dt><span class="refentrytitle"><a href="#gaztab">gaz table</a></span><span class="refpurpose"> — gazテーブルは、地名を標準化し、入力と、(a)入力トークン (「入力トークン」を参照して下さい)および (b) 標準化された表現とを関連付けるために使われます。</span></dt></dl></div><div class="refentry"><a name="rulestab"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>規則テーブル — 規則テーブルには、住所入力順列トークンから標準化した出力順列への対応付けに関する規則の集合が入ります。それぞれの規則は、入力トークン、-1 (終端)、出力トークン、-1、規則の種類を示す数字、規則の階級、からなります。</p></div><div class="refsection"><a name="idp81806208"></a><h2>説明</h2><p>規則テーブルには、少なくとも次に示すカラムが必要です。それ以外にカラムを追加してもかまいません。 </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">id</span></dt><dd><p>テーブルの主キー。</p></dd><dt><span class="term">rule</span></dt><dd><p>規則を示す文字列フィールド。 <a class="ulink" href="http://www.pagcgeo.org/docs/html/pagc-12.html#--r-rec--" target="_top">PAGC Address Standardizer Rule records</a>に詳細情報があります。</p><p>ruleには、入力トークンを表現する非負の整数、終端を示す-1、郵便属性を表現する非負の整数、終端を示す-1、規則種別を表現する整数、規則の階級を示す整数からなる集合が入ります。規則は0 (最低)から17 (最高)まであります。</p><p>たとえば、<code class="code">2 0 2 22 3 -1 5 5 6 7 3 -1 2 6</code>は、<span class="emphasis"><em>TYPE NUMBER TYPE DIRECT QUALIF</em></span>なる入力トークン順列が、<span class="emphasis"><em>STREET STREET SUFTYP SUFDIR QUALIF</em></span>なる出力トークン順列に対応付けされ、規則はARC_Cで、階級は6となります。 </p><p>対応する出力トークンは<a class="xref" href="#stdaddr" title="stdaddr">stdaddr</a>に挙げています。</p></dd></dl></div></div><div class="refsection"><a name="rule_input_tokens"></a><h2>入力トークン</h2><p>個々の規則は、入力トークン順列、終端を示す<code class="code">-1</code>の順です。<a class="ulink" href="http://www.pagcgeo.org/docs/html/pagc-12.html#ss12.2" target="_top">PAGC Input Tokens</a>から引用した正当な入力トークンは次の通りです。</p><p><span class="bold"><strong>書式ベースの入力トークン</strong></span></p><div class="variablelist"><dl class="variablelist"><dt><span class="term">AMPERS</span></dt><dd><p>(13) アンパサンド (&amp;)は、"and"という語を短縮するために、よく使われます</p></dd><dt><span class="term">DASH</span></dt><dd><p>(9) 区切り記号。</p></dd><dt><span class="term">DOUBLE</span></dt><dd><p>(21) 二つの文字の順列。しばしば識別子に用いられます。</p></dd><dt><span class="term">FRACT</span></dt><dd><p>(25) ときどき"civic nunber"または"unit number" (訳注: 各戸に付けられる番号)で使われます。</p></dd><dt><span class="term">MIXED</span></dt><dd><p>(23) 英数文字列。識別子に用います。</p></dd><dt><span class="term">NUMBER</span></dt><dd><p>(0) 数字からなる文字列。</p></dd><dt><span class="term">ORD</span></dt><dd><p>(15) "First"や"1st"といったものを表現する文字列。しばしばストリート名の中で使われています。</p></dd><dt><span class="term">ORD</span></dt><dd><p>(18) 一つの文字</p></dd><dt><span class="term">WORD</span></dt><dd><p>(1) 任意長を持つ文字列です。一つの文字はSINGLEおよびWORDの両方になりえます。</p></dd></dl></div><p><span class="bold"><strong>機能ベースの入力トークン</strong></span></p><div class="variablelist"><dl class="variablelist"><dt><span class="term">BOXH</span></dt><dd><p>(14) 私書箱を示すために使われる語です。たとえば <span class="emphasis"><em>Box</em></span>または<span class="emphasis"><em>PO Box</em></span>です。</p></dd><dt><span class="term">BUILDH</span></dt><dd><p>(19) 建物またはその複合体を示すための語で、通常は前置語になります。たとえば<span class="emphasis"><em>Tower 7A</em></span>では<span class="emphasis"><em>Tower</em></span>が該当します。</p></dd><dt><span class="term">BUILDT</span></dt><dd><p>(24) 建物またはその複合体を示すために使われる語または略語で、通常は後置語になります。たとえば<span class="emphasis"><em>Shopping Centre</em></span>です。</p></dd><dt><span class="term">DIRECT</span></dt><dd><p>(22) 方位を示す語です。たとえば <span class="emphasis"><em>North</em></span>です。</p></dd><dt><span class="term">MILE</span></dt><dd><p>(20) 距離標の住所を示す語です。</p></dd><dt><span class="term">ROAD</span></dt><dd><p>(6) 高速道路と道路を示す語または略語です。たとえば<span class="emphasis"><em>Interstate 5</em></span>の<span class="emphasis"><em>Interstate</em></span>です。</p></dd><dt><span class="term">RR</span></dt><dd><p>(8) 地方集配路線を示す語または略語です。たとえば<span class="emphasis"><em>RR</em></span>です。</p></dd><dt><span class="term">TYPE</span></dt><dd><p>(2) ストリート種別を示す語または略語です。たとえば<span class="emphasis"><em>ST</em></span>や<span class="emphasis"><em>AVE</em></span>です。</p></dd><dt><span class="term">UNITH</span></dt><dd><p>(16) 内部の部分住所を示す語または略語です。たとえば<span class="emphasis"><em>APT</em></span>や<span class="emphasis"><em>UNIT</em></span>です。</p></dd></dl></div><p><span class="bold"><strong>郵便型入力トークン</strong></span></p><div class="variablelist"><dl class="variablelist"><dt><span class="term">QUINT</span></dt><dd><p>(28) 5桁の番号。ZIPコードです。</p></dd><dt><span class="term">QUAD</span></dt><dd><p>(29) 4桁の番号。ZIP4です。</p></dd><dt><span class="term">PCH</span></dt><dd><p>(27) 英数3文字の順列です。カナダの郵便番号の先頭3文字であるFSAを示します。</p></dd><dt><span class="term">PCT</span></dt><dd><p>(26) 英数3文字の順列です。カナダの郵便番号の末尾3文字です。</p></dd></dl></div><p><span class="bold"><strong>ストップワード</strong></span></p><p>STOPWORD (訳注: 処理対象外とする語)はWORDと結合します。規則で、複数のWORDとSTOPWORDの列は、単一のWORDトークンで表現されます。</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">STOPWORD</span></dt><dd><p>(7) 重要性が低い語で、パース時に省かれます。たとえば<span class="emphasis"><em>THE</em></span>が該当します。</p></dd></dl></div></div><div class="refsection"><a name="idp81865216"></a><h2>出力トークン</h2><p>1番目の-1 (終端)の後に、出力トークンが続き、その後に<code class="code">-1</code>が続きます。対応する出力トークンの番号は、<a class="xref" href="#stdaddr" title="stdaddr">stdaddr</a>に挙げています。許されるものは、規則の種類に依存します。それぞれの規則種別で有効なトークンは<a class="xref" href="#rule_types_rank" title="規則種別と階級">「規則種別と階級」</a>に挙げています。</p></div><div class="refsection"><a name="rule_types_rank"></a><h2>規則種別と階級</h2><p>規則の最後の部分は規則種別で、次に挙げるものの一つが示すものです。この後には階級が続きます。規則は0 (最低) から17 (最高)までに階級付けされます。</p><p><span class="bold"><strong>MACRO_C</strong></span></p><p>(トークン番号 = "<span class="bold"><strong>0</strong></span>") <span class="emphasis"><em>PLACE STATE ZIP</em></span>のようなMACRO節をパースするための規則のクラス。</p><p><span class="bold"><strong>MACRO_C出力トークン</strong></span> (<a class="ulink" href="http://www.pagcgeo.org/docs/html/pagc-12.html#--r-typ--" target="_top">http://www.pagcgeo.org/docs/html/pagc-12.html#--r-typ--</a>からの引用)</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">CITY</span></dt><dd><p>(トークン番号 "10") たとえば"Albany" (訳注: ニューヨーク州の州都)等。</p></dd><dt><span class="term">STATE</span></dt><dd><p>(トークン番号 "11") たとえば"NY" (訳注: ニューヨーク州)等。</p></dd><dt><span class="term">NATION</span></dt><dd><p>(トークン番号 "12") ほとんどの参照ファイル内で使われない属性です。たとえば"USA"等。</p></dd><dt><span class="term">POSTAL</span></dt><dd><p>(トークン番号 "13") (SADS elements "ZIP CODE" , "PLUS 4" ). 米国Zip (郵便番号)とカナダ郵便番号の両方で使われます。</p></dd></dl></div><p><span class="bold"><strong>MICRO_C</strong></span></p><p>(トークン番号 = "<span class="bold"><strong>1</strong></span>") 完全なMICRO節 (House, street, sufdir, predir, pretyp, suftype, qualif等)をパースするための規則のクラス (ARC_CとCIVIC_Cの和)。建物フェーズでは使われません。</p><p><span class="bold"><strong>MICRO_C 出力トークン</strong></span> (<a class="ulink" href="http://www.pagcgeo.org/docs/html/pagc-12.html#--r-typ--" target="_top">http://www.pagcgeo.org/docs/html/pagc-12.html#--r-typ--</a>からの引用)</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">HOUSE</span></dt><dd><p>文字列 (トークン番号<code class="code">1</code>): ストリートの番号です。<code class="code">75 State Street</code>では<span class="emphasis"><em>75</em></span>にあたります。</p></dd><dt><span class="term">predir</span></dt><dd><p>文字列 (トークン番号<code class="code">2</code>): North, South, East, Westといった、ストリート名の方角前置語です。</p></dd><dt><span class="term">qual</span></dt><dd><p>文字列 (トークン番号 <code class="code">3</code>): ストリート名の修飾前置語です。<code class="code">3715 OLD HIGHWAY 99</code>では<span class="emphasis"><em>OLD</em></span>にあたります。</p></dd><dt><span class="term">pretype</span></dt><dd><p>文字列 (トークン番号 <code class="code">4</code>): STREET PREFIX TYPE (ストリート名の前置詞の種別)</p></dd><dt><span class="term">street</span></dt><dd><p>文字列 (トークン番号 <code class="code">5</code>): ストリート名</p></dd><dt><span class="term">suftype</span></dt><dd><p>文字列 (トークン番号 <code class="code">6</code>): St, Ave, Cir等の、後置詞の種別。ストリート名に続いて記述されるものです。<code class="code">75 State Street</code>では<span class="emphasis"><em>STREET</em></span>が該当します。</p></dd><dt><span class="term">sufdir</span></dt><dd><p>文字列 (トークン番号 <code class="code">7</code>): ストリート名に続くNorth, South, East, Westといった、ストリート名の方角前置語です。<code class="code">3715 TENTH AVENUE WEST</code>では<span class="emphasis"><em>WEST</em></span>が該当します。</p></dd></dl></div><p><span class="bold"><strong>ARC_C</strong></span></p><p>(トークン番号 = "<span class="bold"><strong>2</strong></span>") HOUSE属性を除いたMICRO節をパースするための規則のクラス。MICRO_CからHOUSEトークンを除いた出力トークン集合と同じです。</p><p><span class="bold"><strong>CIVIC_C</strong></span></p><p>(トークン番号 = "<span class="bold"><strong>3</strong></span>") HOUSE属性をパースするための規則のクラス。</p><p><span class="bold"><strong>EXTRA_C</strong></span></p><p>(トークン番号 = "<span class="bold"><strong>4</strong></span>") EXTRA属性 (ジオコーディングから除かれる属性)をパースするための規則のクラス。</p><p><span class="bold"><strong>EXTRA_C 出力トークン</strong></span> (<a class="ulink" href="http://www.pagcgeo.org/docs/html/pagc-12.html#--r-typ--" target="_top">http://www.pagcgeo.org/docs/html/pagc-12.html#--r-typ--</a>からの引用)</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">BLDNG</span></dt><dd><p>(トークン番号 <code class="code">0</code>): パースされていない建物識別子と種別。</p></dd><dt><span class="term">BOXH</span></dt><dd><p>(トークン番号 <code class="code">14</code>): <code class="code">BOX 3B</code>内の<span class="bold"><strong>BOX</strong></span>にあたります。</p></dd><dt><span class="term">BOXT</span></dt><dd><p>(トークン番号 <code class="code">15</code>): <code class="code">BOX 3B</code>内の<span class="bold"><strong>3B</strong></span>にあたります。</p></dd><dt><span class="term">RR</span></dt><dd><p>(トークン番号 <code class="code">8</code>): <code class="code">RR 7</code>内の<span class="bold"><strong>RR</strong></span>にあたります。</p></dd><dt><span class="term">UNITH</span></dt><dd><p>(トークン番号 <code class="code">16</code>): <code class="code">APT 3B</code>内の<span class="bold"><strong>APT</strong></span>にあたります。</p></dd><dt><span class="term">UNITT</span></dt><dd><p>(トークン番号<code class="code">17</code>): <code class="code">APT 3B</code>内の<span class="bold"><strong>3B</strong></span>にあたります。</p></dd><dt><span class="term">UNKNWN</span></dt><dd><p>(トークン番号<code class="code">9</code>): その他分類対象外の出力。</p></dd></dl></div></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="lextab"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>lexテーブル — lexテーブルは英数字の入力をクラス分けして (a) 入力トークン (<a class="xref" href="#rule_input_tokens" title="入力トークン">「入力トークン」</a> 参照)と (b)  標準化表現 とに関連付けます。</p></div><div class="refsection"><a name="idp80185984"></a><h2>説明</h2><p>lex (lexiconの略語)テーブルは、英数入力を分類し、入力を (a) <a class="xref" href="#rule_input_tokens" title="入力トークン">「入力トークン」</a>および (b) 標準化された表現、に関連付けます。</p><p>lexは少なくとも次のカラムを持ちます。追加できます。</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">id</span></dt><dd><p>テーブルの主キー。</p></dd><dt><span class="term">seq</span></dt><dd><p>整数: 定義番号？</p></dd><dt><span class="term">word</span></dt><dd><p>文字列: 入力単語</p></dd><dt><span class="term">stdword</span></dt><dd><p>文字列: 正規化した置き換え語</p></dd><dt><span class="term">token</span></dt><dd><p>整数: その語の種別。このコンテキストで使われる場合のみ置き換えられます。<a class="ulink" href="http://www.pagcgeo.org/docs/html/pagc-12.html#--i-tok--" target="_top">PAGC Tokens</a>を参照して下さい。</p></dd></dl></div></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="gaztab"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>gaz table — gazテーブルは、地名を標準化し、入力と、(a)入力トークン (<a class="xref" href="#rule_input_tokens" title="入力トークン">「入力トークン」</a>を参照して下さい)および (b) 標準化された表現とを関連付けるために使われます。</p></div><div class="refsection"><a name="idp80198016"></a><h2>説明</h2><p>gaz (gazeteerの略語)テーブルは、地名を分類し、入力を (a) <a class="xref" href="#rule_input_tokens" title="入力トークン">「入力トークン」</a>および (b) 標準化された表現、に関連付けます。例えば、アメリカにいる場合には、これらを州名と関連する略語でロードします。</p><p>gazテーブルは少なくとも次のカラムを持ちます。独自の目的のために追加することができます。</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">id</span></dt><dd><p>テーブルの主キー。</p></dd><dt><span class="term">seq</span></dt><dd><p>整数: 定義番号？ - 語のインスタンスに使われる識別子</p></dd><dt><span class="term">word</span></dt><dd><p>文字列: 入力単語</p></dd><dt><span class="term">stdword</span></dt><dd><p>文字列: 正規化した置き換え語</p></dd><dt><span class="term">token</span></dt><dd><p>整数: その語の種別。このコンテキストで使われる場合のみ置き換えられます。<a class="ulink" href="http://www.pagcgeo.org/docs/html/pagc-12.html#--i-tok--" target="_top">PAGC Tokens</a>を参照して下さい。</p></dd></dl></div></div></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="Address_Standardizer_Functions"></a>14.1.4. 住所標準化関数</h3></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#parse_address">parse_address</a></span><span class="refpurpose"> — 1行の住所を取り、分割します。</span></dt><dt><span class="refentrytitle"><a href="#standardize_address">standardize_address</a></span><span class="refpurpose"> — lexテーブル、gazテーブルおよび規則テーブルを使って、入力住所をstdaddr形式で返します。</span></dt></dl></div><div class="refentry"><a name="parse_address"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>parse_address — 1行の住所を取り、分割します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">record <b class="fsfunc">parse_address</b>(</code>text  <var class="pdparam">address</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp81933568"></a><h2>説明</h2><p>一つの住所を入力に取り、<span class="emphasis"><em>num</em></span>、<span class="emphasis"><em>street</em></span>、<span class="emphasis"><em>street2</em></span>、<span class="emphasis"><em>address1</em></span>、<span class="emphasis"><em>city</em></span>、<span class="emphasis"><em>state</em></span>、<span class="emphasis"><em>zip</em></span>、<span class="emphasis"><em>zipplus</em></span>、<span class="emphasis"><em>country</em></span>からなるレコードを一つ返します。</p><p>初出: 2.2.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method needs address_standardizer extension.</p></div><div class="refsection"><a name="idp81940224"></a><h2>例</h2><p>単一の住所</p><pre class="programlisting">SELECT num, street, city, zip, zipplus
        FROM parse_address('1 Devonshire Place, Boston, MA 02109-1234') AS a;</pre><pre class="screen">num |      street      |  city  |  zip  | zipplus
-----+------------------+--------+-------+---------
 1   | Devonshire Place | Boston | 02109 | 1234                </pre><p>住所テーブル</p><pre class="programlisting">-- 基本テーブル
CREATE TABLE places(addid serial PRIMARY KEY, address text);

INSERT INTO places(address)
VALUES ('529 Main Street, Boston MA, 02129'),
 ('77 Massachusetts Avenue, Cambridge, MA 02139'),
 ('25 Wizard of Oz, Walaford, KS 99912323'),
 ('26 Capen Street, Medford, MA'),
 ('124 Mount Auburn St, Cambridge, Massachusetts 02138'),
 ('950 Main Street, Worcester, MA 01610');

 -- 住所のパース
 -- 全てのフィールドで使う場合には (a).* が使えます
SELECT addid, (a).num, (a).street, (a).city, (a).state, (a).zip, (a).zipplus
FROM (SELECT addid, parse_address(address) As a
 FROM places) AS p;</pre><pre class="screen">addid | num |        street        |   city    | state |  zip  | zipplus
-------+-----+----------------------+-----------+-------+-------+---------
     1 | 529 | Main Street          | Boston    | MA    | 02129 |
     2 | 77  | Massachusetts Avenue | Cambridge | MA    | 02139 |
     3 | 25  | Wizard of Oz         | Walaford  | KS    | 99912 | 323
     4 | 26  | Capen Street         | Medford   | MA    |       |
     5 | 124 | Mount Auburn St      | Cambridge | MA    | 02138 |
     6 | 950 | Main Street          | Worcester | MA    | 01610 |
(6 rows)</pre></div><div class="refsection"><a name="idp81944192"></a><h2>関連情報</h2><p></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="standardize_address"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>standardize_address — lexテーブル、gazテーブルおよび規則テーブルを使って、入力住所をstdaddr形式で返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">stdaddr <b class="fsfunc">standardize_address</b>(</code>text  <var class="pdparam">lextab</var>, text  <var class="pdparam">gaztab</var>, text  <var class="pdparam">rultab</var>, text  <var class="pdparam">address</var><code>)</code>;</p><p><code class="funcdef">stdaddr <b class="fsfunc">standardize_address</b>(</code>text  <var class="pdparam">lextab</var>, text  <var class="pdparam">gaztab</var>, text  <var class="pdparam">rultab</var>, text  <var class="pdparam">micro</var>, text  <var class="pdparam">macro</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp81959040"></a><h2>説明</h2><p>指定された<a class="xref" href="#lextab" title="lexテーブル">lexテーブル</a>、<a class="xref" href="#gaztab" title="gaz table">gaz table</a>および<a class="xref" href="#rulestab" title="規則テーブル">規則テーブル</a>のテーブルを使って、入力住所を<a class="xref" href="#stdaddr" title="stdaddr">stdaddr</a>形式で返します。</p><p>1番目の形式: 単一行で住所を取る形式です。</p><p>2番目の形式: 住所を二つの部分から取ります。<code class="varname">micro</code>は<code class="code">house_num street</code>等のような、標準的な宛先書式の1行目です。<code class="varname">macro</code>は、<code class="code">city, state postal_code country</code>等のような、標準的な宛先書式の2行目です。</p><p>初出: 2.2.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method needs address_standardizer extension.</p></div><div class="refsection"><a name="idp81966336"></a><h2>例</h2><p>address_standardizer_data_usエクステンションを使います。</p><pre class="programlisting">CREATE EXTENSION address_standardizer_data_us; -- only needs to be done once</pre><p>一つ目の版: 単一行住所。米国でない住所では十分に働きません。</p><pre class="programlisting">SELECT house_num, name, suftype, city, country, state, unit  FROM standardize_address('us_lex',
                           'us_gaz', 'us_rules', 'One Devonshire Place, PH 301, Boston, MA 02109');</pre><pre class="screen">house_num |    name    | suftype |  city  | country |     state     |      unit
----------+------------+---------+--------+---------+---------------+-----------------
1         | DEVONSHIRE | PLACE   | BOSTON | USA     | MASSACHUSETTS | # PENTHOUSE 301</pre><p>Tigerジオコーダに同梱されているテーブルを使います。この例は<code class="varname">postgis_tiger_geocoder</code>をインストールしている場合のみ動作します。</p><pre class="programlisting">SELECT *  FROM standardize_address('tiger.pagc_lex',
         'tiger.pagc_gaz', 'tiger.pagc_rules', 'One Devonshire Place, PH 301, Boston, MA 02109-1234');</pre><p>読みやすくするために、hstoreエクステンションを使ってダウンぷします。必要なら CREATE EXTENSION hstore; を実行します。</p><pre class="programlisting">SELECT (each(hstore(p))).*
 FROM standardize_address('tiger.pagc_lex', 'tiger.pagc_gaz',
   'tiger.pagc_rules', 'One Devonshire Place, PH 301, Boston, MA 02109') As p;</pre><pre class="screen">key     |      value
------------+-----------------
 box        |
 city       | BOSTON
 name       | DEVONSHIRE
 qual       |
 unit       | # PENTHOUSE 301
 extra      |
 state      | MA
 predir     |
 sufdir     |
 country    | USA
 pretype    |
 suftype    | PL
 building   |
 postcode   | 02109
 house_num  | 1
 ruralroute |
(16 rows)
                        </pre><p>二つ目の形式: 二つの部分からなる住所</p><pre class="programlisting">SELECT (each(hstore(p))).*
 FROM standardize_address('tiger.pagc_lex', 'tiger.pagc_gaz',
   'tiger.pagc_rules', 'One Devonshire Place, PH 301', 'Boston, MA 02109, US') As p;</pre><pre class="screen">key     |      value
------------+-----------------
 box        |
 city       | BOSTON
 name       | DEVONSHIRE
 qual       |
 unit       | # PENTHOUSE 301
 extra      |
 state      | MA
 predir     |
 sufdir     |
 country    | USA
 pretype    |
 suftype    | PL
 building   |
 postcode   | 02109
 house_num  | 1
 ruralroute |
(16 rows)</pre></div><div class="refsection"><a name="idp81973760"></a><h2>関連情報</h2><p><a class="xref" href="#stdaddr" title="stdaddr">stdaddr</a>, <a class="xref" href="#rulestab" title="規則テーブル">規則テーブル</a>, <a class="xref" href="#lextab" title="lexテーブル">lexテーブル</a>, <a class="xref" href="#gaztab" title="gaz table">gaz table</a>, <a class="xref" href="#Pagc_Normalize_Address" title="Pagc_Normalize_Address文字列のストリート住所を与えると、道路後置辞、前置辞、標準タイプ、番地、ストリート名等を複数フィールドに分解して持つnorm_addy複合型を返します。この関数は、tiger_geocoder同梱のルックアップテーブルだけを使います (Tigerデータは不要です)。住所標準化エクステンションが必要です。">Pagc_Normalize_Address文字列のストリート住所を与えると、道路後置辞、前置辞、標準タイプ、番地、ストリート名等を複数フィールドに分解して持つ<code class="varname">norm_addy</code>複合型を返します。この関数は、tiger_geocoder同梱のルックアップテーブルだけを使います (Tigerデータは不要です)。住所標準化エクステンションが必要です。</a></p></div></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Tiger_Geocoder"></a>14.2. Tigerジオコーダ</h2></div><div><div class="abstract"><div class="abstract-title">概要</div><p>米国国勢調査局が公開している<a class="ulink" href="http://www.census.gov/geo/www/tiger/" target="_top">TIGER (Topologically Integrated Geographic Encoding and Referencing system ) / Line and Master Address database export</a>で動作するよう書かれた、PL/pgSQLベースのジオコーダです。 </p><p>データローダ機能、住所正規化、住所ジオコーダおよび逆ジオコーダ、の四つの要素があります。 </p><p>米国のための設計ですが、概念および機能の多くは適用可能で、他国の住所と道路ネットワークで動作するように適合させることができます (訳注: 日本の地名については未知です)。</p><p>Tiger関連の関数、道路型前置辞・道路型後置辞・州といった再利用可能な参照データ、データロード管理のための様々な制御テーブル、全てのロードされたテーブルが継承するスケルトンテーブル、を収容するための<code class="varname">tiger</code>というスキーマが、スクリプトによって作成されます。</p><p><code class="varname">tiger_data</code>という、もう一つのスキーマが作られます。ここに、ローダが米国国勢調査サイトからダウンロードしてデータベースにロードした州ごとの全ての国勢調査データが収容されます。現在のモデルでは、州ごとのテーブルは、<code class="varname">ma_addr</code>や<code class="varname">ma_edges</code>といったように名前の先頭に州コードを付けていて、州データのみに強制する制約が付いています。これらのテーブルは<code class="varname">tiger schema</code>にある<code class="varname">addr</code>, <code class="varname">faces</code>, <code class="varname">edges</code>等から継承されています。 </p><p>全てのジオコード関数は基底テーブルを参照するだけです。そのため、<code class="varname">tiger_data</code>データスキーマやそのデータを他のスキーマに分割できないという条件はありません。例えば、州ごとに異なるスキーマにしても、<code class="varname">tiger</code>内のテーブルから継承されているなら使用可能です。</p><p>お手持ちのデータベース内のエクステンションを有効にし、使用するデータをロードする方法については、<a class="xref" href="#install_tiger_geocoder_extension" title="2.4.1. TigerジオコーダをPostGISデータベースで有効にする: エクステンションを使用">「TigerジオコーダをPostGISデータベースで有効にする: エクステンションを使用」</a>を参照して下さい。</p><p> </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Tigerジオコーダ (tiger_2010)を使っている場合には、extras/tiger内にあるupgrade_geocoder.bat / .sh を使ってアップグレードすることができます。<code class="varname">tiger_2010</code>と<code class="varname">tiger_2011以上</code>での大きな変更点は、<code class="varname">county</code>テーブルと<code class="varname">state</code>テーブルが、stateごとに出現することがなくなっています。tiger_2010からのデータを持っていて、tiger_2015に置き換えたい場合には、<a class="xref" href="#upgrade_tiger_geocoder" title="2.4.5. Tigerジオコーダのアップグレード">「Tigerジオコーダのアップグレード」</a>を参照して下さい。 </p></td></tr></table></div><p>

              </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>PostGIS 2.2.0での新規機能は、Tiger 2015データに対応したことと、住所標準化がPostGISの一部に取り入れられたことです。</p><p>PostGIS 2.1.0での新規機能は、PostgreSQL 9.1以上では、TigerジオコーダをPostgreSQLエクステンションモデルでインストールすることができるようになったことです。詳細については<a class="xref" href="#install_tiger_geocoder_extension" title="2.4.1. TigerジオコーダをPostGISデータベースで有効にする: エクステンションを使用">「TigerジオコーダをPostGISデータベースで有効にする: エクステンションを使用」</a>を参照して下さい。</p></td></tr></table></div><p>
              </p><p>PostGISが用意している<a class="xref" href="#Normalize_Address" title="Normalize_Address">Normalize_Address</a>の代替として<a class="xref" href="#Pagc_Normalize_Address" title="Pagc_Normalize_Address文字列のストリート住所を与えると、道路後置辞、前置辞、標準タイプ、番地、ストリート名等を複数フィールドに分解して持つnorm_addy複合型を返します。この関数は、tiger_geocoder同梱のルックアップテーブルだけを使います (Tigerデータは不要です)。住所標準化エクステンションが必要です。">Pagc_Normalize_Address文字列のストリート住所を与えると、道路後置辞、前置辞、標準タイプ、番地、ストリート名等を複数フィールドに分解して持つ<code class="varname">norm_addy</code>複合型を返します。この関数は、tiger_geocoder同梱のルックアップテーブルだけを使います (Tigerデータは不要です)。住所標準化エクステンションが必要です。</a>関数があります。コンパイルとインストールの方法については、<a class="xref" href="#installing_pagc_address_standardizer" title="2.3. PAGC住所標準化ツールのインストールと使用">「PAGC住所標準化ツールのインストールと使用」</a>を参照して下さい。</p><p>設計:</p><p>このプロジェクトの目標は、任意の米国住所文字列を処理し、正規化したTiger国勢調査データを使ってポイントジオメトリを生成し、与えられた住所の位置や、位置のもっともらしさを反映した評価値を算出する、十分に実用的なジオコーダを構築することです。なお、評価値は高いほど悪い結果とします。</p><p>PostGIS 2.0.0で導入された<code class="varname">reverse_geocode</code>は、GPS位置のストリート住所と交差点を得るのに便利です。</p><p>ジオコーダは、PostGISに慣れている方ならだれでもインストールと使用が容易な程度に単純であるべきで、PostGISがサポートする全てのプラットフォームで簡便にインストール、使用ができるべきです。</p><p>書式や綴りの誤りがあっても確実に機能するための十分なロバスト性があるべきです。</p><p>将来のデータ更新が使えるか、最小のプログラムの変更で他のデータが使えるための十分な拡張性もあるべきです。</p><p>
                </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>関数が確実に動作するために、<code class="varname">tiger</code>スキーマは、データベース検索パスに追加されていなければなりません。</p></td></tr></table></div><p>
            </p></div></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#Drop_Indexes_Generate_Script">Drop_Indexes_Generate_Script</a></span><span class="refpurpose"> — tigerスキーマとユーザが指定したスキーマ上の、全ての主キーでなく、かつユニークでないインデックスを削除します。スキーマを指定しない場合のデフォルトスキーマは、<code class="varname">tiger_data</code>です。</span></dt><dt><span class="refentrytitle"><a href="#Drop_Nation_Tables_Generate_Script">Drop_Nation_Tables_Generate_Script</a></span><span class="refpurpose"> — 指定したスキーマ内のテーブルのうち、<code class="varname">county_all</code>, <code class="varname">state_all</code>または、<code class="varname">county</code> or <code class="varname">state</code>を削除するスクリプトを生成します。</span></dt><dt><span class="refentrytitle"><a href="#Drop_State_Tables_Generate_Script">Drop_State_Tables_Generate_Script</a></span><span class="refpurpose"> — 指定したスキーマ内の、名前が州コードから始まるテーブルを全て削除するスクリプトを生成します。スキーマが指定されていない場合のデフォルトスキーマは<code class="varname">tiger_data</code>です。</span></dt><dt><span class="refentrytitle"><a href="#Geocode">Geocode</a></span><span class="refpurpose"> — 住所を文字列 (もしくは他の正規化された住所)として取り、可能性のある位置の集合を返します。返される集合の要素は、NAD 83経度緯度のポイントジオメトリ、正規化された住所と評価値を持ちます。評価値は低いほど可能性が高いことを示しています。結果は評価値の低い順に並べ替えられます。オプションにmax_result (最大結果数、デフォルトは10)とrestrict_region (制限領域、デフォルトはNULL)を渡すことができます。</span></dt><dt><span class="refentrytitle"><a href="#Geocode_Intersection">Geocode_Intersection</a></span><span class="refpurpose"> — インタセクトする二つのストリート、州コード、市名、郵便番号を引数に取り、最初の交差点の可能性のある位置の集合を出力します。geomoutにNAD83経度緯度のポイント、<code class="varname">normalized_address</code>にそれぞれの位置、ratingに評価値がそれぞれ入ります。評価値が低いほど合致度が高くなります。結果は評価値の低い順にソートされます。最大結果数を渡すことができ、デフォルトは10です。Tigerデータ (エッジ、フェイス、住所)と、PostgreSQLあいまい文字列合致 (soundex, levenshtein)を使います。</span></dt><dt><span class="refentrytitle"><a href="#Get_Geocode_Setting">Get_Geocode_Setting</a></span><span class="refpurpose"> — tiger.geocode_settingsテーブルに格納されている設定のうち指定したものの値を返します。</span></dt><dt><span class="refentrytitle"><a href="#Get_Tract">Get_Tract</a></span><span class="refpurpose"> — ジオメトリで指定した位置の米国国勢調査統計区またはtractテーブルのフィールドを返します。デフォルトでは、統計区の短縮名を返します。</span></dt><dt><span class="refentrytitle"><a href="#Install_Missing_Indexes">Install_Missing_Indexes</a></span><span class="refpurpose"> — ジオコーダで結合や検索条件に使われ、インデックスが付いていなキーカラムを持つ全てのテーブルを探し、インデックスを追加します。</span></dt><dt><span class="refentrytitle"><a href="#Loader_Generate_Census_Script">Loader_Generate_Census_Script</a></span><span class="refpurpose"> — 指定した州について、tract (統計区)、bg (block group, 細分区グループ)、tabblock (ブロック)をダウンロードし、<code class="varname">tiger_data</code>に格納するための、指定したプラットフォーム用のシェルスクリプトを生成します。行ごとに州ごとのスクリプトが返されます。</span></dt><dt><span class="refentrytitle"><a href="#Loader_Generate_Script">Loader_Generate_Script</a></span><span class="refpurpose"> — 指定したプラットフォーム用の、指定した州のTigerデータをダウンロードし、格納準備を行い、<code class="varname">tiger_data</code>スキーマに格納するシェルスクリプトを生成します。行ごとに州ごとのスクリプトが返ります。最新版ではTiger 2010のデータ構造変更に対応していて、国勢統計区、細分区グループ、細分区 (tabblocks)テーブルをダウンロードすることができます。</span></dt><dt><span class="refentrytitle"><a href="#Loader_Generate_Nation_Script">Loader_Generate_Nation_Script</a></span><span class="refpurpose"> — 指定したプラットフォーム用の、国と州のルックアップテーブルをロードするシェルスクリプトを生成します。</span></dt><dt><span class="refentrytitle"><a href="#Missing_Indexes_Generate_Script">Missing_Indexes_Generate_Script</a></span><span class="refpurpose"> — ジオコーダで結合に使われるキーカラムを持ち、インデックスが付いていないキーカラムを持つすべてのテーブルを検索し、インデックスを追加するSQLデータ定義言語を出力します。</span></dt><dt><span class="refentrytitle"><a href="#Normalize_Address">Normalize_Address</a></span><span class="refpurpose"> — 文字列で住所が与えられると、道路後置辞、前置辞、正規化された種別、番地、ストリート名等をフィールドに分けて持つ<code class="varname">norm_addy</code>複合型を返します。tiger_geocoderに同梱されているルックアップデータで動作します (Tigerデータ自体は不要です)。</span></dt><dt><span class="refentrytitle"><a href="#Pagc_Normalize_Address">Pagc_Normalize_Address文字列のストリート住所を与えると、道路後置辞、前置辞、標準タイプ、番地、ストリート名等を複数フィールドに分解して持つ<code class="varname">norm_addy</code>複合型を返します。この関数は、tiger_geocoder同梱のルックアップテーブルだけを使います (Tigerデータは不要です)。住所標準化エクステンションが必要です。</a></span><span class="refpurpose"> — 文字列のストリート住所を与えると、道路後置辞、前置辞、標準タイプ、番地、ストリート名等を複数フィールドに分解して持つ<code class="varname">norm_addy</code>複合型を返します。この関数は、tiger_geocoder同梱のルックアップテーブルだけを使います (Tigerデータは不要です)。住所標準化エクステンションが必要です。</span></dt><dt><span class="refentrytitle"><a href="#Pprint_Addy">Pprint_Addy</a></span><span class="refpurpose"> — <code class="varname">norm_addy</code>複合型オブジェクトを与えると、印刷表現を返します。通常はnormalize_addressと併用します。</span></dt><dt><span class="refentrytitle"><a href="#Reverse_Geocode">Reverse_Geocode</a></span><span class="refpurpose"> — 登録されている空間参照系に基づくポイントジオメトリを引数に取り、理論的に可能性のある住所の配列と交差するストリートの配列を一つのレコードで返します。include_strnum_range = trueの場合には、交差するストリートに番地範囲を追加します。</span></dt><dt><span class="refentrytitle"><a href="#Topology_Load_Tiger">Topology_Load_Tiger</a></span><span class="refpurpose"> — Tigerデータの定義領域をPostGISトポロジにロードして、Tigerデータをトポロジの空間参照系に投影変換し、トポロジの許容精度にスナップします。</span></dt><dt><span class="refentrytitle"><a href="#Set_Geocode_Setting">Set_Geocode_Setting</a></span><span class="refpurpose"> — ジオコーダ関数の振る舞いに影響を与える設定を行います。</span></dt></dl></div><p>PostGIS用の二つのオープンソースジオコーダがあります。これらはTigerジオコーダと違い、他国のジオコーディングに対応している利点があります。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="ulink" href="http://wiki.openstreetmap.org/wiki/Nominatim" target="_top">Nominatim</a>は、OpenStreetMapの地名集データを使います。データのロードにはosm2pgsqlが必要です。PostgreSQL 8.4以上とPostGIS 1.5以上が必要です。Webサービスのインタフェースとして作られていて、Webサービスと呼ばれるような設計に見えます。Tigerジオコーダと同じように、ジオコーダと逆ジオコーダの要素を持ちます。文書からでは、Tigerジオコーダのような純粋なSQLインタフェースを持っているのか、多くの処理がWebインタフェースに実装されているのか、は明確ではありません。</p></li><li class="listitem"><p><a class="ulink" href="http://www.gisgraphy.com/" target="_top">GIS Graphy</a>も、PostGISを使用したもので、NominatimのようにOpenStreetMap (OSM)データを使用します。OSMデータのロードを行うローダとNominatimのように米国だけでなくジオコーディングを行う能力があります。Nominatimとよく似ていて、Webサービスとして動作し、Java 1.5、サーブレットアプリケーション、Apache Solrに依存しています。GisGraphyは、複数プラットフォームで動作し、他の機能の中には逆ジオコーダがあります。</p></li></ul></div><div class="refentry"><a name="Drop_Indexes_Generate_Script"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Drop_Indexes_Generate_Script — tigerスキーマとユーザが指定したスキーマ上の、全ての主キーでなく、かつユニークでないインデックスを削除します。スキーマを指定しない場合のデフォルトスキーマは、<code class="varname">tiger_data</code>です。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">Drop_Indexes_Generate_Script</b>(</code>text  <var class="pdparam">param_schema=tiger_data</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp82352128"></a><h2>説明</h2><p>tigerスキーマとユーザが指定したスキーマ上の、全ての主キーでなく、かつユニークでないインデックスを削除します。スキーマを指定しない場合のデフォルトスキーマは、<code class="varname">tiger_data</code>です。</p><p>PostgreSQLのクエリプランナを混乱させる可能性があり、不要なディスク容量を取る、インデックスの膨張を最小化するために使います。ジオコーダで使われるインデックスを追加する関数<a class="xref" href="#Install_Missing_Indexes" title="Install_Missing_Indexes">Install_Missing_Indexes</a>を併用します。</p><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp82354816"></a><h2>例</h2><pre class="programlisting">SELECT drop_indexes_generate_script() As actionsql;
actionsql
---------------------------------------------------------
DROP INDEX tiger.idx_tiger_countysub_lookup_lower_name;
DROP INDEX tiger.idx_tiger_edges_countyfp;
DROP INDEX tiger.idx_tiger_faces_countyfp;
DROP INDEX tiger.tiger_place_the_geom_gist;
DROP INDEX tiger.tiger_edges_the_geom_gist;
DROP INDEX tiger.tiger_state_the_geom_gist;
DROP INDEX tiger.idx_tiger_addr_least_address;
DROP INDEX tiger.idx_tiger_addr_tlid;
DROP INDEX tiger.idx_tiger_addr_zip;
DROP INDEX tiger.idx_tiger_county_countyfp;
DROP INDEX tiger.idx_tiger_county_lookup_lower_name;
DROP INDEX tiger.idx_tiger_county_lookup_snd_name;
DROP INDEX tiger.idx_tiger_county_lower_name;
DROP INDEX tiger.idx_tiger_county_snd_name;
DROP INDEX tiger.idx_tiger_county_the_geom_gist;
DROP INDEX tiger.idx_tiger_countysub_lookup_snd_name;
DROP INDEX tiger.idx_tiger_cousub_countyfp;
DROP INDEX tiger.idx_tiger_cousub_cousubfp;
DROP INDEX tiger.idx_tiger_cousub_lower_name;
DROP INDEX tiger.idx_tiger_cousub_snd_name;
DROP INDEX tiger.idx_tiger_cousub_the_geom_gist;
DROP INDEX tiger_data.idx_tiger_data_ma_addr_least_address;
DROP INDEX tiger_data.idx_tiger_data_ma_addr_tlid;
DROP INDEX tiger_data.idx_tiger_data_ma_addr_zip;
DROP INDEX tiger_data.idx_tiger_data_ma_county_countyfp;
DROP INDEX tiger_data.idx_tiger_data_ma_county_lookup_lower_name;
DROP INDEX tiger_data.idx_tiger_data_ma_county_lookup_snd_name;
DROP INDEX tiger_data.idx_tiger_data_ma_county_lower_name;
DROP INDEX tiger_data.idx_tiger_data_ma_county_snd_name;
:
:
</pre></div><div class="refsection"><a name="idp82356352"></a><h2>関連情報</h2><p><a class="xref" href="#Install_Missing_Indexes" title="Install_Missing_Indexes">Install_Missing_Indexes</a>, <a class="xref" href="#Missing_Indexes_Generate_Script" title="Missing_Indexes_Generate_Script">Missing_Indexes_Generate_Script</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="Drop_Nation_Tables_Generate_Script"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Drop_Nation_Tables_Generate_Script — 指定したスキーマ内のテーブルのうち、<code class="varname">county_all</code>, <code class="varname">state_all</code>または、<code class="varname">county</code> or <code class="varname">state</code>を削除するスクリプトを生成します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">Drop_Nation_Tables_Generate_Script</b>(</code>text  <var class="pdparam">param_schema=tiger_data</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp82364160"></a><h2>説明</h2><p>指定したスキーマ内のテーブルのうち、名前が<code class="varname">county_all</code>、<code class="varname">state_all</code>、<code class="varname">(州コード)_county</code>、<code class="varname">(州コード)_state</code>で始まるテーブルを全て削除するスクリプトを生成します。 <code class="varname">tiger_2010</code>データから<code class="varname">tiger_2011</code>データに更新する際に必要です。</p><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp82368000"></a><h2>例</h2><pre class="programlisting">SELECT drop_nation_tables_generate_script();
DROP TABLE tiger_data.county_all;
DROP TABLE tiger_data.county_all_lookup;
DROP TABLE tiger_data.state_all;
DROP TABLE tiger_data.ma_county;
DROP TABLE tiger_data.ma_state;</pre></div><div class="refsection"><a name="idp82369536"></a><h2>関連情報</h2><p><a class="xref" href="#Loader_Generate_Nation_Script" title="Loader_Generate_Nation_Script">Loader_Generate_Nation_Script</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="Drop_State_Tables_Generate_Script"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Drop_State_Tables_Generate_Script — 指定したスキーマ内の、名前が州コードから始まるテーブルを全て削除するスクリプトを生成します。スキーマが指定されていない場合のデフォルトスキーマは<code class="varname">tiger_data</code>です。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">Drop_State_Tables_Generate_Script</b>(</code>text  <var class="pdparam">param_state</var>, text  <var class="pdparam">param_schema=tiger_data</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp82376832"></a><h2>説明</h2><p>指定したスキーマ内の、名前が州コードから始まるテーブルを全て削除するスクリプトを生成します。スキーマが指定されていない場合のデフォルトスキーマは<code class="varname">tiger_data</code>です。ある州の以前のデータのロードがうまくいかずに再ロードする際に使います。</p><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp82378880"></a><h2>例</h2><pre class="programlisting">SELECT drop_state_tables_generate_script('PA');
DROP TABLE tiger_data.pa_addr;
DROP TABLE tiger_data.pa_county;
DROP TABLE tiger_data.pa_county_lookup;
DROP TABLE tiger_data.pa_cousub;
DROP TABLE tiger_data.pa_edges;
DROP TABLE tiger_data.pa_faces;
DROP TABLE tiger_data.pa_featnames;
DROP TABLE tiger_data.pa_place;
DROP TABLE tiger_data.pa_state;
DROP TABLE tiger_data.pa_zip_lookup_base;
DROP TABLE tiger_data.pa_zip_state;
DROP TABLE tiger_data.pa_zip_state_loc;
        </pre></div><div class="refsection"><a name="idp82380416"></a><h2>関連情報</h2><p><a class="xref" href="#Loader_Generate_Script" title="Loader_Generate_Script">Loader_Generate_Script</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="Geocode"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Geocode — 住所を文字列 (もしくは他の正規化された住所)として取り、可能性のある位置の集合を返します。返される集合の要素は、NAD 83経度緯度のポイントジオメトリ、正規化された住所と評価値を持ちます。評価値は低いほど可能性が高いことを示しています。結果は評価値の低い順に並べ替えられます。オプションにmax_result (最大結果数、デフォルトは10)とrestrict_region (制限領域、デフォルトはNULL)を渡すことができます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">setof record <b class="fsfunc">geocode</b>(</code>varchar  <var class="pdparam">address</var>, integer  <var class="pdparam">max_results=10</var>, geometry  <var class="pdparam">restrict_region=NULL</var>, norm_addy  <var class="pdparam">OUT addy</var>, geometry  <var class="pdparam">OUT geomout</var>, integer  <var class="pdparam">OUT rating</var><code>)</code>;</p><p><code class="funcdef">setof record <b class="fsfunc">geocode</b>(</code>norm_addy  <var class="pdparam">in_addy</var>, integer  <var class="pdparam">max_results=10</var>, geometry  <var class="pdparam">restrict_region=NULL</var>, norm_addy  <var class="pdparam">OUT addy</var>, geometry  <var class="pdparam">OUT geomout</var>, integer  <var class="pdparam">OUT rating</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp82399104"></a><h2>説明</h2><p>文字列住所 (または正規化された住所)を引数に取り、NAD 83経度緯度のポイントジオメトリ (geomout)、個々の<code class="varname">normalized_address</code> (addy)、評価値 (rating)からなる、可能性のある位置の集合を出力します。評価値が低いほど合致度が高くなります。Tigerデータ (エッジ、フェイス、住所)、PostgreSQLあいまい文字列合致 (soundex,levenshtein)を使い、Tigerデータのエッジに沿った住所の補間のためにPostGIS線補間関数を使用っています。評価値が高いほどジオコードの正確度が低くなります。ジオコードされたポイントは、ストリート住所を中心線から左/右に移動しますが、デフォルトでは10メートルです。</p><p>Enhanced: 2.0.0 Tiger 2010構造のデータに対応しました。実行速度とジオコーディング精度を改善し、ストリート住所の位置を中心線から側線に移動するための改訂を行いました。また、良い結果の数を指定したり、最も良い結果だけを返すようにするのに使う新しいパラメータ<code class="varname">max_results</code>を導入しました。</p></div><div class="refsection"><a name="idp82401408"></a><h2>例: 基本</h2><p>下の例は、3.0GHzの単一プロセッサと2GBのメモリを持つWindows 7機で、PostgreSQL 9.1rc1/PostGIS 2.0を走らせて、MA, MN, CA, RI の各州のTigerデータをロードしたものです。</p><p>完全一致は速いです (61ミリ秒)</p><pre class="programlisting">SELECT g.rating, ST_X(g.geomout) As lon, ST_Y(g.geomout) As lat,
    (addy).address As stno, (addy).streetname As street,
    (addy).streettypeabbrev As styp, (addy).location As city, (addy).stateabbrev As st,(addy).zip
    FROM geocode('75 State Street, Boston MA 02109', 1) As g;
 rating |        lon        |      lat       | stno | street | styp |  city  | st |  zip
--------+-------------------+----------------+------+--------+------+--------+----+-------
      0 | -71.0557505845646 | 42.35897920691 |   75 | State  | St   | Boston | MA | 02109
</pre><p>郵便番号を渡さない場合でも推測可能です (122-150ミリ秒かかりました)</p><pre class="programlisting">SELECT g.rating, ST_AsText(ST_SnapToGrid(g.geomout,0.00001)) As wktlonlat,
    (addy).address As stno, (addy).streetname As street,
    (addy).streettypeabbrev As styp, (addy).location As city, (addy).stateabbrev As st,(addy).zip
    FROM geocode('226 Hanover Street, Boston, MA',1) As g;
 rating |         wktlonlat         | stno | street  | styp |  city  | st |  zip
--------+---------------------------+------+---------+------+--------+----+-------
      1 | POINT(-71.05528 42.36316) |  226 | Hanover | St   | Boston | MA | 02113
</pre><p>綴りの誤りを処理して、一つ以上の可能性のある答を評価値付きで提供すると遅くなります (500ミリ秒)。</p><pre class="programlisting">SELECT g.rating, ST_AsText(ST_SnapToGrid(g.geomout,0.00001)) As wktlonlat,
    (addy).address As stno, (addy).streetname As street,
    (addy).streettypeabbrev As styp, (addy).location As city, (addy).stateabbrev As st,(addy).zip
    FROM geocode('31 - 37 Stewart Street, Boston, MA 02116',1) As g;
 rating |         wktlonlat         | stno | street | styp |  city  | st |  zip
--------+---------------------------+------+--------+------+--------+----+-------
     70 | POINT(-71.06466 42.35114) |   31 | Stuart | St   | Boston | MA | 02116
    </pre><p>複数住所のジオコードバッチ処理を行います。<code class="varname">max_results=1</code>とすると最も簡単です。まだジオコードを行っていない (評価値が無い)もののみ処理します。</p><pre class="programlisting">CREATE TABLE addresses_to_geocode(addid serial PRIMARY KEY, address text,
        lon numeric, lat numeric, new_address text, rating integer);

INSERT INTO addresses_to_geocode(address)
VALUES ('529 Main Street, Boston MA, 02129'),
 ('77 Massachusetts Avenue, Cambridge, MA 02139'),
 ('25 Wizard of Oz, Walaford, KS 99912323'),
 ('26 Capen Street, Medford, MA'),
 ('124 Mount Auburn St, Cambridge, Massachusetts 02138'),
 ('950 Main Street, Worcester, MA 01610');

-- 全体のジオコードでは、必ず最後に一度コミットが行われます。
-- 多数の住所があって、一度に全てを更新したくない場合として、
-- 最初の三つのアドレスだけ更新します。
-- (323-704ミリ秒 - キャッシュと共有メモリがあるので、最初のジオコーディングは必ず遅くなります)
-- この例では、間違った住所の逆ジオコーディングをしなよう、
-- LEFT JOINで再結合して、合致しないものには-1の評価値を設定しています。
UPDATE addresses_to_geocode
  SET  (rating, new_address, lon, lat)
    = ( COALESCE(g.rating,-1), pprint_addy(g.addy),
       ST_X(g.geomout)::numeric(8,5), ST_Y(g.geomout)::numeric(8,5) )
FROM (SELECT addid, address
    FROM addresses_to_geocode
    WHERE rating IS NULL ORDER BY addid LIMIT 3) As a
    LEFT JOIN LATERAL geocode(a.address,1) As g ON true
WHERE a.addid = addresses_to_geocode.addid;

結果
-----
Query returned successfully: 3 rows affected, 480 ms execution time.

SELECT * FROM addresses_to_geocode WHERE rating is not null;

 addid |                   address                    |    lon    |   lat    |                new_address                | rating
-------+----------------------------------------------+-----------+----------+-------------------------------------------+--------
     1 | 529 Main Street, Boston MA, 02129            | -71.07177 | 42.38357 | 529 Main St, Boston, MA 02129             |      0
     2 | 77 Massachusetts Avenue, Cambridge, MA 02139 | -71.09396 | 42.35961 | 77 Massachusetts Ave, Cambridge, MA 02139 |      0
     3 | 25 Wizard of Oz, Walaford, KS 99912323       | -97.92913 | 38.12717 | Willowbrook, KS 67502                     |    108
(3 rows)</pre></div><div class="refsection"><a name="idp82406656"></a><h2>例: ジオメトリフィルタの使用</h2><pre class="programlisting">SELECT g.rating, ST_AsText(ST_SnapToGrid(g.geomout,0.00001)) As wktlonlat,
    (addy).address As stno, (addy).streetname As street,
    (addy).streettypeabbrev As styp,
    (addy).location As city, (addy).stateabbrev As st,(addy).zip
  FROM geocode('100 Federal Street, MA',
        3,
        (SELECT ST_Union(the_geom)
            FROM place WHERE statefp = '25' AND name = 'Lynn')::geometry
        ) As g;

 rating |         wktlonlat         | stno | street  | styp | city | st |  zip
--------+---------------------------+------+---------+------+------+----+-------
      7 | POINT(-70.96796 42.4659)  |  100 | Federal | St   | Lynn | MA | 01905
     16 | POINT(-70.96786 42.46853) | NULL | Federal | St   | Lynn | MA | 01905
(2 rows)

Time: 622.939 ms
          </pre></div><div class="refsection"><a name="idp82408192"></a><h2>関連情報</h2><p><a class="xref" href="#Normalize_Address" title="Normalize_Address">Normalize_Address</a>, <a class="xref" href="#Pprint_Addy" title="Pprint_Addy">Pprint_Addy</a>, <a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a>, <a class="xref" href="#ST_SnapToGrid" title="ST_SnapToGrid">ST_SnapToGrid</a>, <a class="xref" href="#ST_X" title="ST_X">ST_X</a>, <a class="xref" href="#ST_Y" title="ST_Y">ST_Y</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="Geocode_Intersection"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Geocode_Intersection — インタセクトする二つのストリート、州コード、市名、郵便番号を引数に取り、最初の交差点の可能性のある位置の集合を出力します。geomoutにNAD83経度緯度のポイント、<code class="varname">normalized_address</code>にそれぞれの位置、ratingに評価値がそれぞれ入ります。評価値が低いほど合致度が高くなります。結果は評価値の低い順にソートされます。最大結果数を渡すことができ、デフォルトは10です。Tigerデータ (エッジ、フェイス、住所)と、PostgreSQLあいまい文字列合致 (soundex, levenshtein)を使います。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">setof record <b class="fsfunc">geocode_intersection</b>(</code>text  <var class="pdparam"> roadway1</var>, text  <var class="pdparam"> roadway2</var>, text  <var class="pdparam"> in_state</var>, text  <var class="pdparam"> in_city</var>, text  <var class="pdparam"> in_zip</var>, integer  <var class="pdparam">max_results=10</var>, norm_addy  <var class="pdparam">OUT addy</var>, geometry  <var class="pdparam">OUT geomout</var>, integer  <var class="pdparam">OUT rating</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp82424832"></a><h2>説明</h2><p>インタセクトする二つのストリート、州コード、市名、郵便番号を引数に取り、最初の交差点の可能性のある位置の集合を出力します。集合の要素は、NAD83経度緯度のポイント、正規化された住所、評価値を持ちます。評価値が低いほど合致度が高くなります。結果は評価値の低い順にソートされます。最大結果数を渡すことができ、デフォルトは10です。<code class="varname">normalized_address</code> (addy)、NAD83経度緯度のポイントとしてgeomout、評価値としてratingを返します。評価値が低いほど合致度が高くなります。結果は評価値の低い順にソートされます。Tigerデータ (エッジ、フェイス、住所)と、PostgreSQLあいまい文字列合致 (soundex, levenshtein)を使います。 </p><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp82430848"></a><h2>例: 基本</h2><p>下の例では、3.0GHz単一プロセッサで2GBメモリのWindows 7機上でPostgreSQL 9.0/PostGIS 1.5を走らせ、マサチューセッツ州のTigerデータをロードしています。この場合は、少し遅いです (3000ミリ秒)。</p><p>Windows 2003 64ビット 8GBでPostGIS 2.0、PostgreSQL 64ビット版を動かし、Tiger 2011データがロードされている場合もテストしています (41ミリ秒)。</p><pre class="programlisting">SELECT pprint_addy(addy), st_astext(geomout),rating
            FROM geocode_intersection( 'Haverford St','Germania St', 'MA', 'Boston', '02130',1);
           pprint_addy            |         st_astext          | rating
----------------------------------+----------------------------+--------
98 Haverford St, Boston, MA 02130 | POINT(-71.101375 42.31376) |      0
</pre><p>郵便番号をジオコーダに渡さない場合でも動作し、Windows 2003 64ビットで741ミリ秒でした(Windows 7機で3500ミリ秒)。</p><pre class="programlisting">SELECT pprint_addy(addy), st_astext(geomout),rating
                FROM geocode_intersection('Weld', 'School', 'MA', 'Boston');
          pprint_addy          |        st_astext         | rating
-------------------------------+--------------------------+--------
 98 Weld Ave, Boston, MA 02119 | POINT(-71.099 42.314234) |      3
 99 Weld Ave, Boston, MA 02119 | POINT(-71.099 42.314234) |      3
</pre></div><div class="refsection"><a name="idp82434048"></a><h2>関連情報</h2><p><a class="xref" href="#Geocode" title="Geocode">Geocode</a>, <a class="xref" href="#Pprint_Addy" title="Pprint_Addy">Pprint_Addy</a>, <a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="Get_Geocode_Setting"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Get_Geocode_Setting — tiger.geocode_settingsテーブルに格納されている設定のうち指定したものの値を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">Get_Geocode_Setting</b>(</code>text  <var class="pdparam"> setting_name</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp82440576"></a><h2>説明</h2><p>tiger.geocode_settingsテーブルに格納されている設定のうち指定したものの値を返します。設定によって、関数のデバッグの制御が可能です。今後の予定では、評価値の制御ができるようにします。現在の設定は次の通りです。</p><pre class="screen">name              | setting |  unit   | category  |                                                             short_desc
--------------------------------+---------+---------+-----------+------------------------------------------------------------------------------------------------------------------------------
 debug_geocode_address          | false   | boolean | debug     | trueの場合には、geocode_addressが呼ばれた時に、クエリ等のデバッグ情報をNOTICEログに出力します
 debug_geocode_intersection     | false   | boolean | debug     | trueの場合には、geocode_intersectionが呼ばれた時に、クエリ等のデバッグ情報をNOTICEログに出力します
 debug_normalize_address        | false   | boolean | debug     | trueの場合には、normalize_addressが呼ばれた時に、クエリや中間表現等のデバッグ情報をNOTICEログに出力します
 debug_reverse_geocode          | false   | boolean | debug     | trueの場合には、reverse_geocodeが呼ばれた時に、クエリや中間表現等のデバッグ情報をNOTICEログに出力します
 reverse_geocode_numbered_roads | 0       | integer | rating    | 州道名と郡道名について、0-どの名前でもよい、1-道路番号優先、2-州/郡名優先
 use_pagc_address_parser        | false   | boolean | normalize | trueの場合には、address_standardizer (pagc_normalize_address経由)を使おうと試みます。    </pre><p>Changed: 2.2.0 : デフォルト設定をgeocode_settingsに保存するようにしました。ユーザが設定したものだけがgeocode_settings内にあります。</p><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp82443008"></a><h2>デバッグ設定を返す例</h2><pre class="programlisting">SELECT get_geocode_setting('debug_geocode_address) As result;
result
---------
false
        </pre></div><div class="refsection"><a name="idp82444544"></a><h2>関連情報</h2><p><a class="xref" href="#Set_Geocode_Setting" title="Set_Geocode_Setting">Set_Geocode_Setting</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="Get_Tract"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Get_Tract — ジオメトリで指定した位置の米国国勢調査統計区またはtractテーブルのフィールドを返します。デフォルトでは、統計区の短縮名を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">get_tract</b>(</code>geometry  <var class="pdparam"> loc_geom</var>, text  <var class="pdparam"> output_field=name</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp82451456"></a><h2>説明</h2><p>ジオメトリを与えると、ジオメトリの位置の米国国勢調査統計区を返します。空間参照系を指定しない場合には、NAD83経度緯度と仮定します。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数は、センサス<code class="varname">tract</code>を使用しますが、これはデフォルトではロードされません。すでに州テーブルをロード済みなら、<a class="xref" href="#Loader_Generate_Census_Script" title="Loader_Generate_Census_Script">Loader_Generate_Census_Script</a>スクリプトを使って、tractを、bgおよびtabblockと共にロードできます。</p><p>まだ州データをロードしていおらず、これらの追加テーブルを求めるなら、次を実行します。</p><pre class="programlisting">UPDATE tiger.loader_lookuptables SET load = true WHERE load = false AND lookup_name IN('tract', 'bg', 'tabblock');</pre><p>then they will be included by the <a class="xref" href="#Loader_Generate_Script" title="Loader_Generate_Script">Loader_Generate_Script</a>.</p></td></tr></table></div><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp82456320"></a><h2>例: 基本</h2><pre class="programlisting">SELECT get_tract(ST_Point(-71.101375, 42.31376) ) As tract_name;
tract_name
---------
1203.01
        </pre><pre class="programlisting">-- Tigerの地理識別子を返します
SELECT get_tract(ST_Point(-71.101375, 42.31376), 'tract_id' ) As tract_id;
tract_id
---------
25025120301</pre></div><div class="refsection"><a name="idp82458368"></a><h2>関連情報</h2><p><a class="xref" href="#Geocode" title="Geocode">Geocode</a>
&gt;</p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="Install_Missing_Indexes"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Install_Missing_Indexes — ジオコーダで結合や検索条件に使われ、インデックスが付いていなキーカラムを持つ全てのテーブルを探し、インデックスを追加します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">Install_Missing_Indexes</b>(</code><code>)</code>;</p></div></div><div class="refsection"><a name="idp82463488"></a><h2>説明</h2><p>ジオコーダで結合や検索条件に使われ、インデックスが付いていなキーカラムを持つ、<code class="varname">tiger</code>スキーマと<code class="varname">tiger_data</code>スキーマ内の全てのテーブルを探し、これらのテーブルにインデックスを追加するためのSQLデータ定義言語を出力し、実行します。これは、クエリの動作速度を上げるのに必要であるのにロード処理で失われたインデックスを追加するのを助ける関数です。インデックス追加スクリプトの生成と実行を行う<a class="xref" href="#Missing_Indexes_Generate_Script" title="Missing_Indexes_Generate_Script">Missing_Indexes_Generate_Script</a>の仲間です。この関数は<code class="filename">update_geocode.sql</code>更新スクリプトの一部として呼ばれます。</p><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp82466816"></a><h2>例</h2><pre class="programlisting">SELECT install_missing_indexes();
         install_missing_indexes
-------------------------
 t
        </pre></div><div class="refsection"><a name="idp82468352"></a><h2>関連情報</h2><p><a class="xref" href="#Loader_Generate_Script" title="Loader_Generate_Script">Loader_Generate_Script</a>, <a class="xref" href="#Missing_Indexes_Generate_Script" title="Missing_Indexes_Generate_Script">Missing_Indexes_Generate_Script</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="Loader_Generate_Census_Script"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Loader_Generate_Census_Script — 指定した州について、tract (統計区)、bg (block group, 細分区グループ)、tabblock (ブロック)をダウンロードし、<code class="varname">tiger_data</code>に格納するための、指定したプラットフォーム用のシェルスクリプトを生成します。行ごとに州ごとのスクリプトが返されます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">setof text <b class="fsfunc">loader_generate_census_script</b>(</code>text[] <var class="pdparam">param_states</var>, text <var class="pdparam">os</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp82475904"></a><h2>説明</h2><p>指定した州について、<code class="varname">tract</code> (統計区)、<code class="varname">bg</code> (block group, 細分区グループ)、<code class="varname">tabblock</code> (ブロック)をダウンロードし、<code class="varname">tiger_data</code>に格納するための、指定したプラットフォーム用のシェルスクリプトを生成します。行ごとに州ごとのスクリプトが返されます。</p><p>ダウンロードには、Linuxではunzip (Windowsのデフォルトは7-zip)とwgetとを使います。データの格納には<a class="xref" href="#shp2pgsql_usage" title="4.7.2. シェープファイルローダを使う">「シェープファイルローダを使う」</a>を使います。最小単位は州全体です。生成されるスクリプトは、格納準備中の一時フォルダ内にあるファイルのみ処理します。</p><p>プロセスの制御や異なるOSのシェルの書式の制御のために、次の制御テーブルを使います。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><code class="varname">loader_variables</code> 国勢調査ダウンロードサイト、年度、データと準備スキーマといった種々の変数の軌跡を保持します。</p></li><li class="listitem"><p><code class="varname">loader_platform</code> 種々のプラットフォームのプロファイルと種々の実行ファイルを置いてある位置です。windowsとLinux/unixを備えています。追加も可能です。</p></li><li class="listitem"><p>レコードごとにテーブルの種類 (州、国)、レコード処理の有無、ロード方法を定義しています。データインポート方法、データ格納準備、カラム追加、カラム削除、インデックス、制約がそれぞれで定義されています。個々のテーブルは、名前の先頭に州コードを持ち、tigerスキーマのテーブルから継承されています。たとえば、<code class="varname">tiger.faces</code>から継承された<code class="varname">tiger_data.ma_faces</code>する、といったことが行われます。</p></li></ol></div><p>Availability: 2.0.0 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><a class="xref" href="#Loader_Generate_Script" title="Loader_Generate_Script">Loader_Generate_Script</a> は、このロジックを含んでいますが、PostGIS 2.0.0 alpha 5より前にTigerジオコーダをインストールしてLoader_Generate_Scriptを実行した場合には、これを実行する必要があります。</p></td></tr></table></div></div><div class="refsection"><a name="idp82485248"></a><h2>例</h2><p>Windowsシェルスクリプト書式での選択した州のデータをロードするスクリプトの生成。</p><pre class="programlisting">SELECT loader_generate_census_script(ARRAY['MA'], 'windows');
-- 結果 --
set STATEDIR="\gisdata\www2.census.gov\geo\pvs\tiger2010st\25_Massachusetts"
set TMPDIR=\gisdata\temp\
set UNZIPTOOL="C:\Program Files\7-Zip\7z.exe"
set WGETTOOL="C:\wget\wget.exe"
set PGBIN=C:\projects\pg\pg91win\bin\
set PGPORT=5432
set PGHOST=localhost
set PGUSER=postgres
set PGPASSWORD=yourpasswordhere
set PGDATABASE=tiger_postgis20
set PSQL="%PGBIN%psql"
set SHP2PGSQL="%PGBIN%shp2pgsql"
cd \gisdata

%WGETTOOL% http://www2.census.gov/geo/pvs/tiger2010st/25_Massachusetts/25/ --no-parent --relative --accept=*bg10.zip,*tract10.zip,*tabblock10.zip --mirror --reject=html
del %TMPDIR%\*.* /Q
%PSQL% -c "DROP SCHEMA tiger_staging CASCADE;"
%PSQL% -c "CREATE SCHEMA tiger_staging;"
cd %STATEDIR%
for /r %%z in (*.zip) do %UNZIPTOOL% e %%z  -o%TMPDIR%
cd %TMPDIR%
%PSQL% -c "CREATE TABLE tiger_data.MA_tract(CONSTRAINT pk_MA_tract PRIMARY KEY (tract_id) ) INHERITS(tiger.tract); "
%SHP2PGSQL% -c -s 4269 -g the_geom   -W "latin1" tl_2010_25_tract10.dbf tiger_staging.ma_tract10 | %PSQL%
%PSQL% -c "ALTER TABLE tiger_staging.MA_tract10 RENAME geoid10 TO tract_id;  SELECT loader_load_staged_data(lower('MA_tract10'), lower('MA_tract')); "
%PSQL% -c "CREATE INDEX tiger_data_MA_tract_the_geom_gist ON tiger_data.MA_tract USING gist(the_geom);"
%PSQL% -c "VACUUM ANALYZE tiger_data.MA_tract;"
%PSQL% -c "ALTER TABLE tiger_data.MA_tract ADD CONSTRAINT chk_statefp CHECK (statefp = '25');"
: </pre><p>shスクリプトの生成</p><pre class="programlisting">STATEDIR="/gisdata/www2.census.gov/geo/pvs/tiger2010st/25_Massachusetts"
TMPDIR="/gisdata/temp/"
UNZIPTOOL=unzip
WGETTOOL="/usr/bin/wget"
export PGBIN=/usr/pgsql-9.0/bin
export PGPORT=5432
export PGHOST=localhost
export PGUSER=postgres
export PGPASSWORD=yourpasswordhere
export PGDATABASE=geocoder
PSQL=${PGBIN}/psql
SHP2PGSQL=${PGBIN}/shp2pgsql
cd /gisdata

wget http://www2.census.gov/geo/pvs/tiger2010st/25_Massachusetts/25/ --no-parent --relative --accept=*bg10.zip,*tract10.zip,*tabblock10.zip --mirror --reject=html
rm -f ${TMPDIR}/*.*
${PSQL} -c "DROP SCHEMA tiger_staging CASCADE;"
${PSQL} -c "CREATE SCHEMA tiger_staging;"
cd $STATEDIR
for z in *.zip; do $UNZIPTOOL -o -d $TMPDIR $z; done
:
: </pre></div><div class="refsection"><a name="idp82488064"></a><h2>関連情報</h2><p><a class="xref" href="#Loader_Generate_Script" title="Loader_Generate_Script">Loader_Generate_Script</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="Loader_Generate_Script"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Loader_Generate_Script — 指定したプラットフォーム用の、指定した州のTigerデータをダウンロードし、格納準備を行い、<code class="varname">tiger_data</code>スキーマに格納するシェルスクリプトを生成します。行ごとに州ごとのスクリプトが返ります。最新版ではTiger 2010のデータ構造変更に対応していて、国勢統計区、細分区グループ、細分区 (tabblocks)テーブルをダウンロードすることができます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">setof text <b class="fsfunc">loader_generate_script</b>(</code>text[] <var class="pdparam">param_states</var>, text <var class="pdparam">os</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp82495232"></a><h2>説明</h2><p>指定したプラットフォーム用の、指定した州のTigerデータをダウンロードし、格納準備を行い、<code class="varname">tiger_data</code>スキーマに格納するシェルスクリプトを生成します。行ごとに州ごとのスクリプトが返ります。</p><p>ダウンロードには、Linuxではunzip (Windowsのデフォルトは7-zip)とwgetとを使います。データの格納には<a class="xref" href="#shp2pgsql_usage" title="4.7.2. シェープファイルローダを使う">「シェープファイルローダを使う」</a>を使います。ダウンロードの最小単位は州全体ですが、ファイルを手動でダウンロードすることで上書きできます。生成されるスクリプトは、格納準備中の一時フォルダ内にあるファイルのみ処理します。</p><p>プロセスの制御や異なるOSのシェルの書式の制御のために、次の制御テーブルを使います。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><code class="varname">loader_variables</code> 国勢調査ダウンロードサイト、年度、データと準備スキーマといった種々の変数の軌跡を保持します。</p></li><li class="listitem"><p><code class="varname">loader_platform</code> 種々のプラットフォームのプロファイルと種々の実行ファイルを置いてある位置です。windowsとLinux/unixを備えています。追加も可能です。</p></li><li class="listitem"><p>レコードごとにテーブルの種類 (州、国)、レコード処理の有無、ロード方法を定義しています。データインポート方法、データ格納準備、カラム追加、カラム削除、インデックス、制約がそれぞれで定義されています。個々のテーブルは、名前の先頭に州コードを持ち、tigerスキーマのテーブルから継承されています。たとえば、<code class="varname">tiger.faces</code>から継承された<code class="varname">tiger_data.ma_faces</code>する、といったことが行われます。</p></li></ol></div><p>Availability: 2.0.0 Tiger 2010構造のデータに対応しました。国勢統計区 (tract)、細分区グループ ("block groups", bg)、細分区 (tabblocks)テーブルをダウンロードします。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>pgAdmin IIIを使用している場合には、pgAdmin IIIのデフォルトでは長い文字列が切られることに注意して下さい。<span class="emphasis"><em>ファイル -&gt; オプション -&gt; クエリーツール -&gt; Query Editor - &gt; 欄あたりの最大文字数</em></span>を50000文字以上に変更します。</p></td></tr></table></div></div><div class="refsection"><a name="idp82503552"></a><h2>例</h2><p>gistestというデータベースがあり、<code class="filename">/gisdata/data_load.sh</code>がシェルスクリプトのパスとするなら、次のようになります。</p><pre class="programlisting">psql -U postgres -h localhost -d gistest -A -t \
 -c "SELECT Loader_Generate_Script(ARRAY['MA'], 'gistest')" 
&gt; /gisdata/data_load.sh;
</pre><p>Windowsシェルスクリプト書式で二つの州のデータをロードするスクリプトを生成します。</p><pre class="programlisting">SELECT loader_generate_script(ARRAY['MA','RI'], 'windows') AS result;
-- 結果 --
set TMPDIR=\gisdata\temp\
set UNZIPTOOL="C:\Program Files\7-Zip\7z.exe"
set WGETTOOL="C:\wget\wget.exe"
set PGBIN=C:\Program Files\PostgreSQL\9.4\bin\
set PGPORT=5432
set PGHOST=localhost
set PGUSER=postgres
set PGPASSWORD=yourpasswordhere
set PGDATABASE=geocoder
set PSQL="%PGBIN%psql"
set SHP2PGSQL="%PGBIN%shp2pgsql"
cd \gisdata

cd \gisdata
%WGETTOOL% ftp://ftp2.census.gov/geo/tiger/TIGER2015/PLACE/tl_*_25_* --no-parent --relative --recursive --level=2 --accept=zip --mirror --reject=html
cd \gisdata/ftp2.census.gov/geo/tiger/TIGER2015/PLACE
:
:</pre><p>shスクリプトの生成</p><pre class="programlisting">SELECT loader_generate_script(ARRAY['MA','RI'], 'sh') AS result;
-- 結果 --
TMPDIR="/gisdata/temp/"
UNZIPTOOL=unzip
WGETTOOL="/usr/bin/wget"
export PGBIN=/usr/lib/postgresql/9.4/bin
-- psqlで使用する変数: https://www.postgresql.org/docs/current/static/libpq-envars.html
export PGPORT=5432
export PGHOST=localhost
export PGUSER=postgres
export PGPASSWORD=yourpasswordhere
export PGDATABASE=geocoder
PSQL=${PGBIN}/psql
SHP2PGSQL=${PGBIN}/shp2pgsql
cd /gisdata

cd /gisdata
wget ftp://ftp2.census.gov/geo/tiger/TIGER2015/PLACE/tl_*_25_* --no-parent --relative --recursive --level=2 --accept=zip --mirror --reject=html
cd /gisdata/ftp2.census.gov/geo/tiger/TIGER2015/PLACE
rm -f ${TMPDIR}/*.*
:
:</pre></div><div class="refsection"><a name="idp82507776"></a><h2>関連情報</h2><p><a class="xref" href="#install_tiger_geocoder_extension" title="2.4.1. TigerジオコーダをPostGISデータベースで有効にする: エクステンションを使用">「TigerジオコーダをPostGISデータベースで有効にする: エクステンションを使用」</a>, <a class="xref" href="#Loader_Generate_Nation_Script" title="Loader_Generate_Nation_Script">Loader_Generate_Nation_Script</a>, <a class="xref" href="#Drop_State_Tables_Generate_Script" title="Drop_State_Tables_Generate_Script">Drop_State_Tables_Generate_Script</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="Loader_Generate_Nation_Script"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Loader_Generate_Nation_Script — 指定したプラットフォーム用の、国と州のルックアップテーブルをロードするシェルスクリプトを生成します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">loader_generate_nation_script</b>(</code>text <var class="pdparam">os</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp82518400"></a><h2>説明</h2><p><code class="varname">tiger_data</code>スキーマに<code class="varname">county_all</code>, <code class="varname">county_all_lookup</code>, <code class="varname">state_all</code>テーブルをロードする、指定したプラットフォーム用のシェルスクリプトを生成します。それぞれ<code class="varname">tiger</code>スキーマの<code class="varname">county</code>, <code class="varname">county_lookup</code>, <code class="varname">state</code>から継承されます。</p><p>ダウンロードには、Linuxではunzip (Windowsのデフォルトは7-zip)とwgetとを使います。データの格納には<a class="xref" href="#shp2pgsql_usage" title="4.7.2. シェープファイルローダを使う">「シェープファイルローダを使う」</a>を使います。 </p><p>プロセスの制御や異なるOSのシェルの書式の制御のために、制御テーブル<code class="varname">tiger.loader_platform</code>, <code class="varname">tiger.loader_variables</code>,  <code class="varname">tiger.loader_lookuptables</code>を使います。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><code class="varname">loader_variables</code> 国勢調査ダウンロードサイト、年度、データと準備スキーマといった種々の変数の軌跡を保持します。</p></li><li class="listitem"><p><code class="varname">loader_platform</code>には、種々のプラットフォームのプロファイルや実行可能ファイルの置いてある位置を持ちます。windowsとLinux/unixを備えています。追加も可能です。</p></li><li class="listitem"><p>レコードごとにテーブルの種類 (州、国)、レコード処理の有無、ロード方法を定義しています。データインポート方法、データ格納準備、カラム追加、カラム削除、インデックス、制約がそれぞれで定義されています。個々のテーブルは、名前の先頭に州コードを持ち、tigerスキーマのテーブルから継承されています。たとえば、<code class="varname">tiger.faces</code>から継承された<code class="varname">tiger_data.ma_faces</code>する、といったことが行われます。</p></li></ol></div><p>Enhanced: 2.4.1 ZCTA5 (Zip Code 5 Tabulation Area)ロード手順は修正され、有効になった時に、ZCTA5データは、国スクリプトのロードの一部として、zcta5_allという名前の単一テーブルにロードされます。</p><p>Availability: 2.1.0 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>国スクリプトのロードにZCTA5 (Zip Code 5 Tabulation Area)を取り込みたい場合には、次のようにします。</p><pre class="programlisting">UPDATE tiger.loader_lookuptables SET load = true WHERE table_name = 'zcta510';</pre></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">tiger_2010</code>を実行していて、新しいTigerデータで州を再読み込みを行いたくなった場合には、このスクリプトを実行する前に、最初に、<a class="xref" href="#Drop_Nation_Tables_Generate_Script" title="Drop_Nation_Tables_Generate_Script">Drop_Nation_Tables_Generate_Script</a>によって、テーブル削除スクリプトを生成、実行する必要があります。</p></td></tr></table></div></div><div class="refsection"><a name="idp82552448"></a><h2>例</h2><p>国データをWindowsにロードするスクリプトを生成します。</p><pre class="programlisting">SELECT loader_generate_nation_script('windows'); </pre><p>国データをLinux/Unixシステムにロードするスクリプトを生成します。</p><pre class="programlisting">SELECT loader_generate_nation_script('sh'); </pre></div><div class="refsection"><a name="idp82555264"></a><h2>関連情報</h2><p><a class="xref" href="#Loader_Generate_Script" title="Loader_Generate_Script">Loader_Generate_Script</a>, <a class="xref" href="#Drop_Nation_Tables_Generate_Script" title="Drop_Nation_Tables_Generate_Script">Drop_Nation_Tables_Generate_Script</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="Missing_Indexes_Generate_Script"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Missing_Indexes_Generate_Script — ジオコーダで結合に使われるキーカラムを持ち、インデックスが付いていないキーカラムを持つすべてのテーブルを検索し、インデックスを追加するSQLデータ定義言語を出力します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">Missing_Indexes_Generate_Script</b>(</code><code>)</code>;</p></div></div><div class="refsection"><a name="idp82560640"></a><h2>説明</h2><p><code class="varname">tiger</code>スキーマと<code class="varname">tiger_data</code>スキーマ内のジオコーダで結合に使われ、インデックスが付いていないキーカラムを持つ全てのテーブルを検索し、インデックスを付けるSQLデータ定義言語を出力します。これは、クエリの動作速度を上げるのに必要であるのにロード処理で失われたインデックスを追加するのを助ける関数です。ジオコーダが改善されますが、使用される新しいインデックスを受け入れるために、この関数は更新されます。この関数の出力が無い場合がありますが、これは、全てのテーブルにインデックスが付いていると考えられます。</p><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp82562816"></a><h2>例</h2><pre class="programlisting">SELECT missing_indexes_generate_script();
-- 出力: 多数の修正がロードスクリプトで行われる前のデータベースで実行しました ---
CREATE INDEX idx_tiger_county_countyfp ON tiger.county USING btree(countyfp);
CREATE INDEX idx_tiger_cousub_countyfp ON tiger.cousub USING btree(countyfp);
CREATE INDEX idx_tiger_edges_tfidr ON tiger.edges USING btree(tfidr);
CREATE INDEX idx_tiger_edges_tfidl ON tiger.edges USING btree(tfidl);
CREATE INDEX idx_tiger_zip_lookup_all_zip ON tiger.zip_lookup_all USING btree(zip);
CREATE INDEX idx_tiger_data_ma_county_countyfp ON tiger_data.ma_county USING btree(countyfp);
CREATE INDEX idx_tiger_data_ma_cousub_countyfp ON tiger_data.ma_cousub USING btree(countyfp);
CREATE INDEX idx_tiger_data_ma_edges_countyfp ON tiger_data.ma_edges USING btree(countyfp);
CREATE INDEX idx_tiger_data_ma_faces_countyfp ON tiger_data.ma_faces USING btree(countyfp);
        </pre></div><div class="refsection"><a name="idp82564352"></a><h2>関連情報</h2><p><a class="xref" href="#Loader_Generate_Script" title="Loader_Generate_Script">Loader_Generate_Script</a>, <a class="xref" href="#Install_Missing_Indexes" title="Install_Missing_Indexes">Install_Missing_Indexes</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="Normalize_Address"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Normalize_Address — 文字列で住所が与えられると、道路後置辞、前置辞、正規化された種別、番地、ストリート名等をフィールドに分けて持つ<code class="varname">norm_addy</code>複合型を返します。tiger_geocoderに同梱されているルックアップデータで動作します (Tigerデータ自体は不要です)。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">norm_addy <b class="fsfunc">normalize_address</b>(</code>varchar  <var class="pdparam">in_address</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp82570880"></a><h2>説明</h2><p>文字列で住所が与えられると、道路後置辞、前置辞、正規化された種別、番地、ストリート名等をフィールドに分けて持つ<code class="varname">norm_addy</code>複合型を返します。全ての住所を正規化した郵便形式にするジオコーディング処理の第一段階です。ジオコーダに同梱されるもの以外で必要な者はありません。</p><p>tiger_geocoderによって前もってロードされ、<code class="varname">tiger</code>スキーマに格納される、様々な方角/州/後置辞のルックアップテーブルを使います。よって、Tigerデータをダウンロードしたり、追加データをする必要はありません。<code class="varname">tiger</code>スキーマ内のルックアップテーブルに略語や別名の追加が必要になることがあります。</p><p><code class="varname">tiger</code>スキーマ内に、入力アドレスを正規化するための、多様な制御ルックアップテーブルを使います。</p><p>この関数が返す<code class="varname">norm_addy</code>型オブジェクトのフィールドは、次に示す順序です。()はジオコーダの必須フィールド、[]は任意フィールドです。</p><p>(address) [predirAbbrev] (streetName) [streetTypeAbbrev] [postdirAbbrev] [internal] [location] [stateAbbrev] [zip] [parsed] [zip4] [address_alphanumeric]</p><p>Enhanced: 2.4.0 norm_addyオブジェクトにzip4とaddress_alphanumericが追加されました。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><code class="varname">address</code> 整数: 番地</p></li><li class="listitem"><p><code class="varname">predirAbbrev</code> varchar型: N, S, E, W等といった道路の方向前置辞。<code class="varname">direction_lookup</code>テーブルに制御されます。</p></li><li class="listitem"><p><code class="varname">streetName</code> varchar型</p></li><li class="listitem"><p><code class="varname">streetTypeAbbrev</code> varchar型 ストリート種別の短縮名: St, Ave, Cir等。<code class="varname">street_type_lookup</code>テーブルに制御されます。</p></li><li class="listitem"><p><code class="varname">postdirAbbrev</code> varchar型 N, S, E, W等の道路名の方向後置辞。<code class="varname">direction_lookup</code>テーブルに制御されます。</p></li><li class="listitem"><p><code class="varname">internal</code> varchar型 部屋番号といった内部住所。</p></li><li class="listitem"><p><code class="varname">location</code> varchar型 通常は市名や県名です。</p></li><li class="listitem"><p><code class="varname">stateAbbrev</code> varchar型 MA, NY, MI等のような米国の州名の2文字表示です。<code class="varname">state_lookup</code>テーブルに制御されます。</p></li><li class="listitem"><p><code class="varname">zip</code> varchar型 02109等の5桁の数字です。</p></li><li class="listitem"><p><code class="varname">parsed</code> 真偽型 - 住所が正規化処理で整形されたかを示します。normalize_addressは、住所を返す前にこれをTRUEにします。</p></li><li class="listitem"><p><code class="varname">zip4</code> 9桁のZIPコードの最後4桁です。Availability: PostGIS 2.4.0.</p></li><li class="listitem"><p><code class="varname">address_alphanumeric</code> 17Rのように英字が入る場合の完全なストリート番号。これのパースには<a class="xref" href="#Pagc_Normalize_Address" title="Pagc_Normalize_Address文字列のストリート住所を与えると、道路後置辞、前置辞、標準タイプ、番地、ストリート名等を複数フィールドに分解して持つnorm_addy複合型を返します。この関数は、tiger_geocoder同梱のルックアップテーブルだけを使います (Tigerデータは不要です)。住所標準化エクステンションが必要です。">Pagc_Normalize_Address文字列のストリート住所を与えると、道路後置辞、前置辞、標準タイプ、番地、ストリート名等を複数フィールドに分解して持つ<code class="varname">norm_addy</code>複合型を返します。この関数は、tiger_geocoder同梱のルックアップテーブルだけを使います (Tigerデータは不要です)。住所標準化エクステンションが必要です。</a>関数を使う方が良いです。Availability: PostGIS 2.4.0.</p></li></ol></div></div><div class="refsection"><a name="idp82590976"></a><h2>例</h2><p>フィールドを選択して出力します。きれいな文字列を求める場合には、<a class="xref" href="#Pprint_Addy" title="Pprint_Addy">Pprint_Addy</a>を使います。</p><pre class="programlisting">SELECT address As orig, (g.na).streetname, (g.na).streettypeabbrev
 FROM (SELECT address, normalize_address(address) As na
        FROM addresses_to_geocode) As g;

                        orig                         |  streetname   | streettypeabbrev
-----------------------------------------------------+---------------+------------------
 28 Capen Street, Medford, MA                        | Capen         | St
 124 Mount Auburn St, Cambridge, Massachusetts 02138 | Mount Auburn  | St
 950 Main Street, Worcester, MA 01610                | Main          | St
 529 Main Street, Boston MA, 02129                   | Main          | St
 77 Massachusetts Avenue, Cambridge, MA 02139        | Massachusetts | Ave
 25 Wizard of Oz, Walaford, KS 99912323              | Wizard of Oz  |
        </pre></div><div class="refsection"><a name="idp82593280"></a><h2>関連情報</h2><p><a class="xref" href="#Geocode" title="Geocode">Geocode</a>, <a class="xref" href="#Pprint_Addy" title="Pprint_Addy">Pprint_Addy</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="Pagc_Normalize_Address"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Pagc_Normalize_Address文字列のストリート住所を与えると、道路後置辞、前置辞、標準タイプ、番地、ストリート名等を複数フィールドに分解して持つ<code class="varname">norm_addy</code>複合型を返します。この関数は、tiger_geocoder同梱のルックアップテーブルだけを使います (Tigerデータは不要です)。住所標準化エクステンションが必要です。 — 文字列のストリート住所を与えると、道路後置辞、前置辞、標準タイプ、番地、ストリート名等を複数フィールドに分解して持つ<code class="varname">norm_addy</code>複合型を返します。この関数は、tiger_geocoder同梱のルックアップテーブルだけを使います (Tigerデータは不要です)。住所標準化エクステンションが必要です。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">norm_addy <b class="fsfunc">pagc_normalize_address</b>(</code>varchar  <var class="pdparam">in_address</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp82600192"></a><h2>説明</h2><p>文字列で住所が与えられると、道路後置辞、前置辞、正規化された種別、番地、ストリート名等をフィールドに分けて持つ<code class="varname">norm_addy</code>複合型を返します。全ての住所を正規化した郵便形式にするジオコーディング処理の第一段階です。ジオコーダに同梱されるもの以外で必要な者はありません。</p><p>この関数は、Tigerジオコーダとともにロードされ、<code class="varname">tiger</code>スキーマに置かれる、種々のpagc_+ルックアップテーブルだけを使うので、Tigerデータや他のデータをダウンロードする必要はありません。略語や別名を<code class="varname">tiger</code>スキーマのルックアップテーブルに追加しなければならない場合もあります。</p><p><code class="varname">tiger</code>スキーマ内に、入力アドレスを正規化するための、多様な制御ルックアップテーブルを使います。</p><p>この関数が返す<code class="varname">norm_addy</code>型オブジェクトのフィールドは、次に示す順序です。()はジオコーダの必須フィールド、[]は任意フィールドです。</p><p>処理と書式について<a class="xref" href="#Normalize_Address" title="Normalize_Address">Normalize_Address</a>と若干の違いがあります。</p><p>Availability: 2.1.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method needs address_standardizer extension.</p><p>(address) [predirAbbrev] (streetName) [streetTypeAbbrev] [postdirAbbrev] [internal] [location] [stateAbbrev] [zip]</p><p>住所標準化エクステンションのstandardaddrは、他国の住所への対応 (countryも含む)があるため、norm_addyより若干フィールドが多くなります。standardaddrの、norm_addyと等価なフィールドは次の通りです。</p><p>house_num,predir, name, suftype, sufdir, unit, city, state, postcode</p><p>Enhanced: 2.4.0 norm_addyオブジェクトにzip4とaddress_alphanumericが追加されました。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><code class="varname">address</code> 整数: 番地</p></li><li class="listitem"><p><code class="varname">predirAbbrev</code> varchar型: N, S, E, W等といった道路の方向前置辞。<code class="varname">direction_lookup</code>テーブルに制御されます。</p></li><li class="listitem"><p><code class="varname">streetName</code> varchar型</p></li><li class="listitem"><p><code class="varname">streetTypeAbbrev</code> varchar型 ストリート種別の短縮名: St, Ave, Cir等。<code class="varname">street_type_lookup</code>テーブルに制御されます。</p></li><li class="listitem"><p><code class="varname">postdirAbbrev</code> varchar型 N, S, E, W等の道路名の方向後置辞。<code class="varname">direction_lookup</code>テーブルに制御されます。</p></li><li class="listitem"><p><code class="varname">internal</code> varchar型 部屋番号といった内部住所。</p></li><li class="listitem"><p><code class="varname">location</code> varchar型 通常は市名や県名です。</p></li><li class="listitem"><p><code class="varname">stateAbbrev</code> varchar型 MA, NY, MI等のような米国の州名の2文字表示です。<code class="varname">state_lookup</code>テーブルに制御されます。</p></li><li class="listitem"><p><code class="varname">zip</code> varchar型 02109等の5桁の数字です。</p></li><li class="listitem"><p><code class="varname">parsed</code> 真偽型 - 住所が正規化処理で整形されたかを示します。normalize_addressは、住所を返す前にこれをTRUEにします。</p></li><li class="listitem"><p><code class="varname">zip4</code> 9桁のZIPコードの最後4桁です。Availability: PostGIS 2.4.0.</p></li><li class="listitem"><p><code class="varname">address_alphanumeric</code> 17Rのように英字が入る場合の完全なストリート番号。これのパースには<a class="xref" href="#Pagc_Normalize_Address" title="Pagc_Normalize_Address文字列のストリート住所を与えると、道路後置辞、前置辞、標準タイプ、番地、ストリート名等を複数フィールドに分解して持つnorm_addy複合型を返します。この関数は、tiger_geocoder同梱のルックアップテーブルだけを使います (Tigerデータは不要です)。住所標準化エクステンションが必要です。">Pagc_Normalize_Address文字列のストリート住所を与えると、道路後置辞、前置辞、標準タイプ、番地、ストリート名等を複数フィールドに分解して持つ<code class="varname">norm_addy</code>複合型を返します。この関数は、tiger_geocoder同梱のルックアップテーブルだけを使います (Tigerデータは不要です)。住所標準化エクステンションが必要です。</a>関数を使う方が良いです。Availability: PostGIS 2.4.0.</p></li></ol></div></div><div class="refsection"><a name="idp82623488"></a><h2>例</h2><p>単一呼び出しの例を示します。</p><pre class="programlisting">SELECT addy.*
FROM pagc_normalize_address('9000 E ROO ST STE 999, Springfield, CO') AS addy;


 address | predirabbrev | streetname | streettypeabbrev | postdirabbrev | internal  |  location   | stateabbrev | zip | parsed
---------+--------------+------------+------------------+---------------+-----------+-------------+-------------+-----+--------
    9000 | E            | ROO        | ST               |               | SUITE 999 | SPRINGFIELD | CO          |     | t</pre><p>バッチ呼び出しの例です。現在は、postgis_tiger_geocoderはaddress_standardizerを使用しているため、速度の問題があります。うまくいけば、今後解決されることでしょう。
normaddyへのジオコーディングのバッチ処理で速度が必要な場合には、住所標準化エクステンションのstandaridze_address関数を直接呼ぶことで回避できます。<a class="xref" href="#Geocode" title="Geocode">Geocode</a>で生成されたデータを使う<a class="xref" href="#Normalize_Address" title="Normalize_Address">Normalize_Address</a>で行っていることと似ています。例を次に示します。</p><pre class="programlisting">WITH g AS (SELECT address, ROW((sa).house_num, (sa).predir, (sa).name
  , (sa).suftype, (sa).sufdir, (sa).unit , (sa).city, (sa).state, (sa).postcode, true)::norm_addy As na
 FROM (SELECT address, standardize_address('tiger.pagc_lex'
       , 'tiger.pagc_gaz'
       , 'tiger.pagc_rules', address) As sa
        FROM addresses_to_geocode) As g)
SELECT address As orig, (g.na).streetname, (g.na).streettypeabbrev
 FROM  g;

 orig                                                |  streetname   | streettypeabbrev
-----------------------------------------------------+---------------+------------------
 529 Main Street, Boston MA, 02129                   | MAIN          | ST
 77 Massachusetts Avenue, Cambridge, MA 02139        | MASSACHUSETTS | AVE
 25 Wizard of Oz, Walaford, KS 99912323              | WIZARD OF     |
 26 Capen Street, Medford, MA                        | CAPEN         | ST
 124 Mount Auburn St, Cambridge, Massachusetts 02138 | MOUNT AUBURN  | ST
 950 Main Street, Worcester, MA 01610                | MAIN          | ST</pre></div><div class="refsection"><a name="idp82627072"></a><h2>関連情報</h2><p><a class="xref" href="#Normalize_Address" title="Normalize_Address">Normalize_Address</a>, <a class="xref" href="#Geocode" title="Geocode">Geocode</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="Pprint_Addy"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Pprint_Addy — <code class="varname">norm_addy</code>複合型オブジェクトを与えると、印刷表現を返します。通常はnormalize_addressと併用します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">varchar <b class="fsfunc">pprint_addy</b>(</code>norm_addy  <var class="pdparam">in_addy</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp82633600"></a><h2>説明</h2><p><code class="varname">norm_addy</code>複合型オブジェクトを与えると、印刷表現を返します。Tigerジオコーダ同梱のデータ以外は不要です。</p><p>通常は<a class="xref" href="#Normalize_Address" title="Normalize_Address">Normalize_Address</a>と併用します。</p></div><div class="refsection"><a name="idp82635776"></a><h2>例</h2><p>単一住所の印刷表現</p><pre class="programlisting">SELECT pprint_addy(normalize_address('202 East Fremont Street, Las Vegas, Nevada 89101')) As pretty_address;
            pretty_address
---------------------------------------
 202 E Fremont St, Las Vegas, NV 89101
        </pre><p>住所テーブルの印刷表現</p><pre class="programlisting">SELECT address As orig, pprint_addy(normalize_address(address)) As pretty_address
        FROM addresses_to_geocode;

                        orig                         |              pretty_address
-----------------------------------------------------+-------------------------------------------
 529 Main Street, Boston MA, 02129                   | 529 Main St, Boston MA, 02129
 77 Massachusetts Avenue, Cambridge, MA 02139        | 77 Massachusetts Ave, Cambridge, MA 02139
 28 Capen Street, Medford, MA                        | 28 Capen St, Medford, MA
 124 Mount Auburn St, Cambridge, Massachusetts 02138 | 124 Mount Auburn St, Cambridge, MA 02138
 950 Main Street, Worcester, MA 01610                | 950 Main St, Worcester, MA 01610</pre></div><div class="refsection"><a name="idp82638592"></a><h2>関連情報</h2><p><a class="xref" href="#Normalize_Address" title="Normalize_Address">Normalize_Address</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="Reverse_Geocode"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Reverse_Geocode — 登録されている空間参照系に基づくポイントジオメトリを引数に取り、理論的に可能性のある住所の配列と交差するストリートの配列を一つのレコードで返します。include_strnum_range = trueの場合には、交差するストリートに番地範囲を追加します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">record <b class="fsfunc">Reverse_Geocode</b>(</code>geometry  <var class="pdparam">pt</var>, boolean  <var class="pdparam">include_strnum_range=false</var>, geometry[]  <var class="pdparam">OUT intpt</var>, norm_addy[]  <var class="pdparam">OUT addy</var>, varchar[]  <var class="pdparam">OUT street</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp82660864"></a><h2>説明</h2><p>登録されている空間参照系に基づくポイントジオメトリを引数に取り、理論的に可能性のある住所の配列と交差するストリートの配列を一つのレコードで返します。include_strnum_range = trueの場合には、交差するストリートに番地範囲を追加します。include_strnum_rangeは、していない場合のデフォルトはFALSEです。住所は、ポイントから近い順の道路でソートされるので、最初の要素が最も正解に近くなります。</p><p>実際の住所ではなく理論的な住所と書いているのには理由があります。Tigerデータは本当の住所ではなく、番地の範囲を持っています。そのため、理論的な住所は番地範囲に基づいて補間したものです。補間する場合には、たとえば、26 Court Sq.が存在しないにもかかわらず、26 Court St. と 26 Court Sq.が返る、といったことがあります。これは、ポイントが二つのストリートの角にあるのが原因で、両方のストリートに沿って補間を行うためです。住所はストリートに沿って等間隔になっていると仮定しています。非常に多くの番地範囲を取ってしまっている自治体の建物があり、他の建物がストリートの終わりにかたまっているため、ストリートの方向が悪いです。</p><p>ご注意: この関数はTigerデータに依存しています。指定した点を含む領域のデータが無い場合には、NULLで満たされた一つのレコードが返されます。</p><p>返されるレコードの要素は次の通りです。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><code class="varname">intpt</code> ポイント配列: 入力ポイントに最も近いストリートの中心線のポイントです。住所と同じだけポイントがあります。</p></li><li class="listitem"><p><code class="varname">addy</code> norm_addy (正規化された住所)の配列: 入力ポイントに合わせた、可能性のある住所の配列です。最初の要素が最も可能性が高いものです。一般的に、一つだけになるべきですが、ポイントが二つか三つのストリートの角にあったり、ポイントが道路上のどこかにあって側線から離れている場合には、数出現します。</p></li><li class="listitem"><p><code class="varname">street</code> varchar型の配列: 交差するストリート (ストリートがインタセクトする場合)または一つのストリート (指定したポイントが乗るストリートである場合)です。</p></li></ol></div><p>Enhanced: 2.4.1 ZCTA5データセットを追加でロードする場合には、reverse_geocode関数は、特定の州データがロードされていなくても、州とZIPを解決することができます。ZTCA5データのロードに関する詳細については<a class="xref" href="#Loader_Generate_Nation_Script" title="Loader_Generate_Nation_Script">Loader_Generate_Nation_Script</a>を参照して下さい。</p><p>Availability: 2.0.0 </p></div><div class="refsection"><a name="idp82668032"></a><h2>例</h2><p>二つの近いストリートの角となる点の例です。MIT (Massachusetts Ave, Cambridge, MA 02139 )に近い位置です。ストリートは三つはないですが、PostgreSQLは配列の範囲からはみ出してもNULLを返すので安全です。番地範囲を含んでいます。</p><pre class="programlisting">SELECT pprint_addy(r.addy[1]) As st1, pprint_addy(r.addy[2]) As st2, pprint_addy(r.addy[3]) As st3,
            array_to_string(r.street, ',') As cross_streets
        FROM reverse_geocode(ST_GeomFromText('POINT(-71.093902 42.359446)',4269),true) As r;

 結果t
 ------
      st1                                  | st2 | st3 |               cross_streets
-------------------------------------------+-----+-----+----------------------------------------------
 67 Massachusetts Ave, Cambridge, MA 02139 |     |     | 67 - 127 Massachusetts Ave,32 - 88 Vassar St</pre><p>交差するストリートの番地範囲を含めないことを選択しました。また、二つの異なる住所が分かるよう、二つのストリートの角に本当に近い位置を指定しました。</p><pre class="programlisting">SELECT pprint_addy(r.addy[1]) As st1, pprint_addy(r.addy[2]) As st2,
pprint_addy(r.addy[3]) As st3, array_to_string(r.street, ',') As cross_str
FROM reverse_geocode(ST_GeomFromText('POINT(-71.06941 42.34225)',4269)) As r;

結果
--------
               st1               |               st2               | st3 | cross_str
---------------------------------+---------------------------------+-----+------------------------
 5 Bradford St, Boston, MA 02118 | 49 Waltham St, Boston, MA 02118 |     | Waltham St
</pre><p><a class="xref" href="#Geocode" title="Geocode">Geocode</a>からジオコーディングの例を再利用しています。主要な住所と、せいぜい二つの交差するストリートを求めているだけです。</p><pre class="programlisting">SELECT actual_addr, lon, lat, pprint_addy((rg).addy[1]) As int_addr1,
    (rg).street[1] As cross1, (rg).street[2] As cross2
FROM (SELECT address As actual_addr, lon, lat,
    reverse_geocode( ST_SetSRID(ST_Point(lon,lat),4326) ) As rg
    FROM addresses_to_geocode WHERE rating 
&gt; -1) As foo;

                     actual_addr                     |    lon    |   lat    |                 int_addr1                 |     cross1      |   cross2
-----------------------------------------------------+-----------+----------+-------------------------------------------+-----------------+------------
 529 Main Street, Boston MA, 02129                   | -71.07181 | 42.38359 | 527 Main St, Boston, MA 02129             | Medford St      |
 77 Massachusetts Avenue, Cambridge, MA 02139        | -71.09428 | 42.35988 | 77 Massachusetts Ave, Cambridge, MA 02139 | Vassar St       |
 26 Capen Street, Medford, MA                        | -71.12377 | 42.41101 | 9 Edison Ave, Medford, MA 02155           | Capen St        | Tesla Ave
 124 Mount Auburn St, Cambridge, Massachusetts 02138 | -71.12304 | 42.37328 | 3 University Rd, Cambridge, MA 02138      | Mount Auburn St |
 950 Main Street, Worcester, MA 01610                | -71.82368 | 42.24956 | 3 Maywood St, Worcester, MA 01603         | Main St         | Maywood Pl
</pre></div><div class="refsection"><a name="idp82692480"></a><h2>関連情報</h2><p><a class="xref" href="#Pprint_Addy" title="Pprint_Addy">Pprint_Addy</a>, <a class="xref" href="#Geocode" title="Geocode">Geocode</a>, <a class="xref" href="#Loader_Generate_Nation_Script" title="Loader_Generate_Nation_Script">Loader_Generate_Nation_Script</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="Topology_Load_Tiger"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Topology_Load_Tiger — Tigerデータの定義領域をPostGISトポロジにロードして、Tigerデータをトポロジの空間参照系に投影変換し、トポロジの許容精度にスナップします。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">Topology_Load_Tiger</b>(</code>varchar  <var class="pdparam">topo_name</var>, varchar  <var class="pdparam">region_type</var>, varchar  <var class="pdparam">region_id</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp82713344"></a><h2>説明</h2><p>Tigerデータの定義領域をPostGISトポロジにロードします。フェイス、ノード、エッジは対象トポロジの空間参照系に投影変換され、点は対象トポロジの許容精度にスナップされます。生成されたフェイス、ノード、エッジは、元のTigerデータのフェイス、ノード、エッジの識別値を維持するので、将来、データセットをより簡単にTigerデータに一致させることができます。処理の詳細に関する要約を返します。</p><p>これはデータの区域改訂に使えますが、ストリートの中心線に沿って新たに形成されるポリゴンと重ならないポリゴンとが必要です。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はPostGISトポロジモジュールとTigerデータに依存しています。詳細情報については、<a class="xref" href="#Topology" title="第10章 トポロジ">10章<i>トポロジ</i></a>と<a class="xref" href="#installation_configuration" title="2.2.3. ビルドコンフィギュレーション">「ビルドコンフィギュレーション」</a>を参照して下さい。対象領域を含むデータを持っていない場合には、トポロジは作られません。トポロジ関数を使ってトポロジが生成されない場合も失敗します。</p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ほとんどのトポロジ評価エラーは許容範囲の問題です。エッジの投影変換の後にポイントが準備できなかったり、エッジからずれる場合にあたります。トポロジ評価に失敗する状況を改善するには、精度を下げます。</p></td></tr></table></div><p>必須引数:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><code class="varname">topo_name</code> データを納めるPostGISトポロジの名前</p></li><li class="listitem"><p><code class="varname">region_type</code> 境界種別。現在は<code class="varname">place</code> と<code class="varname">county</code>とだけに対応しています。今後増やす予定です。これは境界を定義するために見るテーブルです。<code class="varname">tiger.place</code>や<code class="varname">tiger.county</code>等があたります。</p></li><li class="listitem"><p><code class="varname">region_id</code> TIGERではgeoidと呼ばれるものです。テーブルで領域の一意の識別子です。placeでは<code class="varname">tiger.place</code>テーブルの<code class="varname">plcidfp</code>カラムで、郡では<code class="varname">tiger.country</code>テーブルの<code class="varname">cntyidfp</code>カラムで保持します。 </p></li></ol></div><p>Availability: 2.0.0 </p></div><div class="refsection"><a name="idp82724608"></a><h2>例: マサチューセッツ州ボストン市のトポロジ</h2><p>マサチューセッツ州ボストンのトポロジをマサチューセッツ州フィート平面 (2249)、許容範囲0.25フィートで生成し、ボストンのTigerデータのフェイス、エッジ、ノードをロードします。</p><pre class="programlisting">SELECT topology.CreateTopology('topo_boston', 2249, 0.25);
createtopology
--------------
   15
-- Windows 7 デスクトップ PostgreSQL 9.1 (5州のTigerデータを格納)で 60,902ミリ秒 (約1分)
SELECT tiger.topology_load_tiger('topo_boston', 'place', '2507000');
-- topology_loader_tiger --
29722 edges holding in temporary. 11108 faces added. 1875 edges of faces added.  20576 nodes added.
19962 nodes contained in a face.  0 edge start end corrected.  31597 edges added.

-- 41ミリ秒 --
SELECT topology.TopologySummary('topo_boston');
 -- topologysummary--
Topology topo_boston (15), SRID 2249, precision 0.25
20576 nodes, 31597 edges, 11109 faces, 0 topogeoms in 0 layers

-- 評価に28,797ミリ秒 エラーなしでよかった --
SELECT * FROM
    topology.ValidateTopology('topo_boston');

       error       |   id1    |    id2
-------------------+----------+-----------
      </pre></div><div class="refsection"><a name="idp82726272"></a><h2>例: マサチューセッツ州サフォーク郡のトポロジ</h2><p>マサチューセッツ州サフォークのトポロジを、マサチューセッツ州メートル平面 (26986)、許容範囲0.25メートルで生成し、サフォークのTigerデータのフェイス、エッジ、ノードをロードします。</p><pre class="programlisting">SELECT topology.CreateTopology('topo_suffolk', 26986, 0.25);
-- Windows 7 32ビット Tigerデータ5州 で 56,275秒 (約1分)かかりました
-- ボストンのロードのあとウォームアップされたに違いありません
SELECT tiger.topology_load_tiger('topo_suffolk', 'county', '25025');
-- topology_loader_tiger --
 36003 edges holding in temporary. 13518 faces added. 2172 edges of faces added.
 24761 nodes added.  24075 nodes contained in a face.  0 edge start end corrected.  38175 edges added.
-- 31ミリ秒 --
SELECT topology.TopologySummary('topo_suffolk');
 -- topologysummary--
 Topology topo_suffolk (14), SRID 26986, precision 0.25
24761 nodes, 38175 edges, 13519 faces, 0 topogeoms in 0 layers

-- 評価に 33,606ミリ秒 --
SELECT * FROM
    topology.ValidateTopology('topo_suffolk');

       error       |   id1    |    id2
-------------------+----------+-----------
 coincident nodes  | 81045651 |  81064553
 edge crosses node | 81045651 |  85737793
 edge crosses node | 81045651 |  85742215
 edge crosses node | 81045651 | 620628939
 edge crosses node | 81064553 |  85697815
 edge crosses node | 81064553 |  85728168
 edge crosses node | 81064553 |  85733413
      </pre></div><div class="refsection"><a name="idp82727936"></a><h2>関連情報</h2><p><a class="xref" href="#CreateTopology" title="CreateTopology">CreateTopology</a>, <a class="xref" href="#CreateTopoGeom" title="CreateTopoGeom">CreateTopoGeom</a>, <a class="xref" href="#TopologySummary" title="TopologySummary">TopologySummary</a>, <a class="xref" href="#ValidateTopology" title="ValidateTopology">ValidateTopology</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="Set_Geocode_Setting"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Set_Geocode_Setting — ジオコーダ関数の振る舞いに影響を与える設定を行います。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">Set_Geocode_Setting</b>(</code>text  <var class="pdparam"> setting_name</var>, text  <var class="pdparam"> setting_value</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp82735872"></a><h2>説明</h2><p><code class="varname">tiger.geocode_settings</code>テーブルに格納されている設定の値を設定します。設定によって、関数のデバッグの切り替えができます。今後、評価値の制御を設定から行えるようにする予定です。現在の設定リストは<a class="xref" href="#Get_Geocode_Setting" title="Get_Geocode_Setting">Get_Geocode_Setting</a>にあります。</p><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp82738048"></a><h2>デバッグ設定を返す例</h2><p>この関数がTRUEを返す場合に<a class="xref" href="#Geocode" title="Geocode">Geocode</a>を実行すると、時刻とクエリがNOTICEログに出力されます。</p><pre class="programlisting">SELECT set_geocode_setting('debug_geocode_address', 'true') As result;
result
---------
true</pre></div><div class="refsection"><a name="idp82740352"></a><h2>関連情報</h2><p><a class="xref" href="#Get_Geocode_Setting" title="Get_Geocode_Setting">Get_Geocode_Setting</a></p></div></div></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="PostGIS_Special_Functions_Index"></a>第15章 PostGIS関数索引</h1></div></div></div><div class="toc"><div class="toc-title">目次</div><dl class="toc"><dt><span class="sect1"><a href="#PostGIS_Aggregate_Functions">15.1. PostGIS集約関数</a></span></dt><dt><span class="sect1"><a href="#PostGIS_Window_Functions">15.2. PostGISウィンドウ関数</a></span></dt><dt><span class="sect1"><a href="#PostGIS_SQLMM_Functions">15.3. PostGIS SQL-MM準拠関数</a></span></dt><dt><span class="sect1"><a href="#PostGIS_GeographyFunctions">15.4. PostGISジオグラフィ対応関数</a></span></dt><dt><span class="sect1"><a href="#PostGIS_RasterFunctions">15.5. PostGISラスタ機能関数</a></span></dt><dt><span class="sect1"><a href="#PostGIS_Geometry_DumpFunctions">15.6. PostGISジオメトリ/ジオグラフィ/ラスタのダンプ関数</a></span></dt><dt><span class="sect1"><a href="#PostGIS_BoxFunctions">15.7. PostGISボックス関数</a></span></dt><dt><span class="sect1"><a href="#PostGIS_3D_Functions">15.8. 3次元対応PostGIS関数</a></span></dt><dt><span class="sect1"><a href="#PostGIS_Curved_GeometryFunctions">15.9. PostGIS曲線ジオメトリ対応関数</a></span></dt><dt><span class="sect1"><a href="#PostGIS_PS_GeometryFunctions">15.10. PostGIS多面体サーフェス対応関数</a></span></dt><dt><span class="sect1"><a href="#PostGIS_TypeFunctionMatrix">15.11. PostGIS関数対応マトリクス</a></span></dt><dt><span class="sect1"><a href="#NewFunctions">15.12. 新規作成/機能強化/変更されたPostGIS関数</a></span></dt><dd><dl><dt><span class="sect2"><a href="#NewFunctions_3_2">15.12.1. PostGIS 3.2で新規作成/機能強化された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_3_1">15.12.2. PostGIS 3.1で新規作成/機能強化された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_3_0">15.12.3. PostGIS 3.0で新規作成/機能強化された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_2_5">15.12.4. PostGIS 2.5で新規作成/機能強化された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_2_4">15.12.5. PostGIS 2.4で新規作成/機能強化された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_2_3">15.12.6. PostGIS 2.3で新規作成/機能強化された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_2_2">15.12.7. PostGIS 2.2で新規作成/機能強化された関数</a></span></dt><dt><span class="sect2"><a href="#ChangedFunctions_2_2">15.12.8. PostGIS 2.2で大幅に変更された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_2_1">15.12.9. PostGIS 2.1で新規作成/機能強化された関数</a></span></dt><dt><span class="sect2"><a href="#ChangedFunctions_2_1">15.12.10. PostGIS 2.1で大幅に変更された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_2_0">15.12.11. PostGIS 2.0で新規作成/機能強化/変更された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_2_0_Changed">15.12.12. PostGIS 2.0で変更された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_1_5">15.12.13. PostGIS 1.5で新規作成/機能強化/変更された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_1_4">15.12.14. PostGIS 1.4で新規作成/機能強化/変更された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_1_3">15.12.15. PostGIS 1.3で新規作成された関数</a></span></dt></dl></dd></dl></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="PostGIS_Aggregate_Functions"></a>15.1. PostGIS集約関数</h2></div></div></div><p>次に示す関数は、PostGISが提供する空間集約関数です。sumやaverageといった他のSQL集約関数のように使います。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#ST_AsFlatGeobuf" title="ST_AsFlatGeobuf">ST_AsFlatGeobuf</a> - 行の集合のFlatGeobuf表現を返します。</li><li class="listitem"><a class="link" href="#ST_AsGeobuf" title="ST_AsGeobuf">ST_AsGeobuf</a> - 行集合のGeobuf表現を返します。</li><li class="listitem"><a class="link" href="#ST_AsMVT" title="ST_AsMVT">ST_AsMVT</a> - 行集合のMapbox Vector Tile表現を返す集約関数です。</li><li class="listitem"><a class="link" href="#ST_Collect" title="ST_Collect">ST_Collect</a> - ジオメトリの集合からジオメトリコレクションまたはマルチ系ジオメトリを生成します。</li><li class="listitem"><a class="link" href="#ST_MakeLine" title="ST_MakeLine">ST_MakeLine</a> - POINT、MULTIPOINT、LINESTRINGからLINESTRINGを生成します。</li><li class="listitem"><a class="link" href="#ST_Polygonize" title="ST_Polygonize">ST_Polygonize</a> - ジオメトリ集合のラインから形成されるポリゴンのコレクションを計算します。</li><li class="listitem"><a class="link" href="#RT_ST_SameAlignment" title="ST_SameAlignment">ST_SameAlignment</a> - ラスタが同じスキュー、スケール、空間参照系、オフセットを持つ (ピクセルが分割されることなく同じグリッドに置かれている)場合にTRUEを返し、そうでない場合は問題を詳述する通知とともにFALSEを返します。</li><li class="listitem"><a class="link" href="#TopoElementArray_Agg" title="TopoElementArray_Agg">TopoElementArray_Agg</a> - element_idとタイプの配列 (topoelements)からなるtopoelementarrayを返します。</li></ul></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="PostGIS_Window_Functions"></a>15.2. PostGISウィンドウ関数</h2></div></div></div><p>次に示す関数は、PostGISが提供する空間ウィンドウ関数です。row_numer(), lead(), lag()等のような他のSQLウィンドウ関数のように使います。全ての関数で、SQLのOVER()句が必要です。</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="PostGIS_SQLMM_Functions"></a>15.3. PostGIS SQL-MM準拠関数</h2></div></div></div><p>次に示す関数は、SQL/MM 3標準に準拠したPostGIS関数です。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>SQL-MMでは、全てのジオメトリコンストラクタのデフォルトSRIDを0としています。PostGISは-1としています (訳注: 2.0.0以降は0です)。</p></td></tr></table></div><p>The functions given below are PostGIS functions that conform to the SQL/MM 3 standard</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#ST_3DDistance" title="ST_3DDistance">ST_3DDistance</a> - 投影座標系の単位で、二つのジオメトリ間の3次元デカルト距離の最小値を返します (空間参照系に基づきます)。
   
     
   
  This method implements the SQL/MM specification. SQL-MM ?</li><li class="listitem"><a class="link" href="#ST_AddEdgeModFace" title="ST_AddEdgeModFace">ST_AddEdgeModFace</a> - 新しいエッジを追加します。新しいエッジがフェイスを分割する場合には、もとのフェイスを編集し、一つのフェイスを追加します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.13</li><li class="listitem"><a class="link" href="#ST_AddEdgeNewFaces" title="ST_AddEdgeNewFaces">ST_AddEdgeNewFaces</a> - 新しいエッジを追加します。新しいエッジがフェイスを分割する場合には、もとのフェイスを削除して、分割した二つのフェイスに置き換えます。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.12</li><li class="listitem"><a class="link" href="#ST_AddIsoEdge" title="ST_AddIsoEdge">ST_AddIsoEdge</a> - anodeとanothernodeで指定される二つの既存孤立ノードを接続するトポロジに、ジオメトリalinestringで定義される孤立エッジを追加し、新しいエッジの識別番号を返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.4</li><li class="listitem"><a class="link" href="#ST_AddIsoNode" title="ST_AddIsoNode">ST_AddIsoNode</a> - フェイスに孤立ノードを追加し、新しいノードの識別番号を返します。フェイスがNULLの場合でもノードは生成されます。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X 3.1</li><li class="listitem"><a class="link" href="#ST_Area" title="ST_Area">ST_Area</a> - ポリゴンジオメトリの面積を返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 8.1.2, 9.5.3</li><li class="listitem"><a class="link" href="#ST_AsBinary" title="ST_AsBinary">ST_AsBinary</a> - ジオメトリ/ジオグラフィの、SRIDメタデータを持たないOGC/ISO Well-Knownバイナリ (WKB)表現を返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 5.1.37</li><li class="listitem"><a class="link" href="#ST_AsText" title="ST_AsText">ST_AsText</a> - ジオメトリ/ジオグラフィのSRIDメタデータのないWell-Known Text (WKT)表現を返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 5.1.25</li><li class="listitem"><a class="link" href="#ST_Boundary" title="ST_Boundary">ST_Boundary</a> - ジオメトリの境界を返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 5.1.14</li><li class="listitem"><a class="link" href="#ST_Buffer" title="ST_Buffer">ST_Buffer</a> - あるジオメトリからの距離が指定された距離以下となる点全ての集合となるジオメトリを返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 5.1.17</li><li class="listitem"><a class="link" href="#ST_Centroid" title="ST_Centroid">ST_Centroid</a> - ジオメトリの幾何学的重心を返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 8.1.4, 9.5.5</li><li class="listitem"><a class="link" href="#ST_ChangeEdgeGeom" title="ST_ChangeEdgeGeom">ST_ChangeEdgeGeom</a> - トポロジ構造に影響を与えることなくエッジの形状を変更します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.6</li><li class="listitem"><a class="link" href="#ST_ConvexHull" title="ST_ConvexHull">ST_ConvexHull</a> - ジオメトリの凸包を計算します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 5.1.16</li><li class="listitem"><a class="link" href="#ST_CoordDim" title="ST_CoordDim">ST_CoordDim</a> - ジオメトリの座標次元を返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 5.1.3</li><li class="listitem"><a class="link" href="#ST_CreateTopoGeo" title="ST_CreateTopoGeo">ST_CreateTopoGeo</a> - 空のトポロジにジオメトリのコレクションを追加し、成否を示すメッセージを返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.18</li><li class="listitem"><a class="link" href="#ST_CurveToLine" title="ST_CurveToLine">ST_CurveToLine</a> - 曲線を含むジオメトリを線ジオメトリに変換します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 7.1.7</li><li class="listitem"><a class="link" href="#ST_Dimension" title="ST_Dimension">ST_Dimension</a> - ジオメトリのトポロジ次元を返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 5.1.2</li><li class="listitem"><a class="link" href="#ST_Distance" title="ST_Distance">ST_Distance</a> - 二つのジオメトリ値またはジオグラフィ値間の距離を返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 5.1.23</li><li class="listitem"><a class="link" href="#ST_EndPoint" title="ST_EndPoint">ST_EndPoint</a> - LINESTRINGまたはCIRCULARLINESTRINGの終端のポイントを返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 7.1.4</li><li class="listitem"><a class="link" href="#ST_Envelope" title="ST_Envelope">ST_Envelope</a> - ジオメトリのバウンディングボックスを表現するジオメトリを返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 5.1.15</li><li class="listitem"><a class="link" href="#ST_ExteriorRing" title="ST_ExteriorRing">ST_ExteriorRing</a> - ポリゴンの外環を表現するラインストリングを返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 8.2.3, 8.3.3</li><li class="listitem"><a class="link" href="#ST_GeometryN" title="ST_GeometryN">ST_GeometryN</a> - ジオメトリコレクションの要素を返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 9.1.5</li><li class="listitem"><a class="link" href="#ST_GeometryType" title="ST_GeometryType">ST_GeometryType</a> - ジオメトリのSQL-MM型を文字列で返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 5.1.4</li><li class="listitem"><a class="link" href="#ST_GetFaceEdges" title="ST_GetFaceEdges">ST_GetFaceEdges</a> - 順序番号を含む、afaceの境界となる、整列したエッジの集合を返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.5</li><li class="listitem"><a class="link" href="#ST_GetFaceGeometry" title="ST_GetFaceGeometry">ST_GetFaceGeometry</a> - 指定されたトポロジの中の、フェイス識別番号で指定されたポリゴンを返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.16</li><li class="listitem"><a class="link" href="#ST_InitTopoGeo" title="ST_InitTopoGeo">ST_InitTopoGeo</a> - 新しいトポロジスキーマを生成し、topology.topologyテーブルに新しいスキーマを登録し、処理の概要を表示します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.17</li><li class="listitem"><a class="link" href="#ST_InteriorRingN" title="ST_InteriorRingN">ST_InteriorRingN</a> - ポリゴンのN番目の内環 (穴)を返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 8.2.6, 8.3.5</li><li class="listitem"><a class="link" href="#ST_IsClosed" title="ST_IsClosed">ST_IsClosed</a> - ラインストリングの始点と終点が一致しているかをテストします。多面体サーフェスについては閉じているか (立体であるか)をテストします。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 7.1.5, 9.3.3</li><li class="listitem"><a class="link" href="#ST_IsEmpty" title="ST_IsEmpty">ST_IsEmpty</a> - ジオメトリが空かをテストします。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 5.1.7</li><li class="listitem"><a class="link" href="#ST_IsRing" title="ST_IsRing">ST_IsRing</a> - ラインストリングが閉じていてかつ単純であるかをテストします。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 7.1.6</li><li class="listitem"><a class="link" href="#ST_IsSimple" title="ST_IsSimple">ST_IsSimple</a> - ジオメトリが自己インタセクトまたは自己接触となるポイントが無いかをテストします。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 5.1.8</li><li class="listitem"><a class="link" href="#ST_Length" title="ST_Length">ST_Length</a> - 線系ジオメトリの2次元長を返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 7.1.2, 9.3.4</li><li class="listitem"><a class="link" href="#ST_M" title="ST_M">ST_M</a> - ポイントのM値を返します。
   
     
   
  This method implements the SQL/MM specification.</li><li class="listitem"><a class="link" href="#ST_ModEdgeHeal" title="ST_ModEdgeHeal">ST_ModEdgeHeal</a> - 二つのエッジについて、接続しているノードを削除して修復します。1番目のエッジを編集して、2番目のエッジを削除します。削除されたノードの識別番号を返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.9</li><li class="listitem"><a class="link" href="#ST_ModEdgeSplit" title="ST_ModEdgeSplit">ST_ModEdgeSplit</a> - 既存のエッジに沿って新しいノードを生成してエッジを分割します。もとのエッジは変更され、新しいエッジが一つ追加されます。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.9</li><li class="listitem"><a class="link" href="#ST_MoveIsoNode" title="ST_MoveIsoNode">ST_MoveIsoNode</a> - トポロジ内の孤立ノードを別の位置に移動させます。新しいapointジオメトリがノードとして存在しているなら、エラーが投げられます。移動に関する説明を返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.2</li><li class="listitem"><a class="link" href="#ST_NewEdgeHeal" title="ST_NewEdgeHeal">ST_NewEdgeHeal</a> - 二つのエッジについて、接続しているノードを削除して修復します。両方のエッジを削除し、1番目のエッジと同じ方向のエッジに置き換えます。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.9</li><li class="listitem"><a class="link" href="#ST_NewEdgesSplit" title="ST_NewEdgesSplit">ST_NewEdgesSplit</a> - 新しいノードを既存のエッジに沿って作成して、エッジを分割します。もとのエッジは削除され、二つのエッジに置き換えられます。二つの新しいエッジに接続する新しいノードの識別番号を返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.8</li><li class="listitem"><a class="link" href="#ST_NumGeometries" title="ST_NumGeometries">ST_NumGeometries</a> - ジオメトリコレクションの要素数を返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 9.1.4</li><li class="listitem"><a class="link" href="#ST_NumInteriorRings" title="ST_NumInteriorRings">ST_NumInteriorRings</a> - ポリゴンの内環 (穴)の数を返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 8.2.5</li><li class="listitem"><a class="link" href="#ST_NumPatches" title="ST_NumPatches">ST_NumPatches</a> - 多面体サーフェスのフェイス数を返します。多面体でないジオメトリの場合にはNULLを返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: ?</li><li class="listitem"><a class="link" href="#ST_NumPoints" title="ST_NumPoints">ST_NumPoints</a> - ラインストリングまたは曲線ストリングのポイント数を返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 7.2.4</li><li class="listitem"><a class="link" href="#ST_PatchN" title="ST_PatchN">ST_PatchN</a> - 多面体サーフェスのN番目のジオメトリ (フェイス)を返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: ?</li><li class="listitem"><a class="link" href="#ST_Perimeter" title="ST_Perimeter">ST_Perimeter</a> - ポリゴンジオメトリまたはジオグラフィの境界の長さを返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 8.1.3, 9.5.4</li><li class="listitem"><a class="link" href="#ST_Point" title="ST_Point">ST_Point</a> - 与えられた座標値からポイントを生成します。ST_MakePointの別名です。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 6.1.2</li><li class="listitem"><a class="link" href="#ST_PointN" title="ST_PointN">ST_PointN</a> - ジオメトリの最初のラインストリングまたは曲線ストリングのN番目のポイントを返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 7.2.5, 7.3.5</li><li class="listitem"><a class="link" href="#ST_PointOnSurface" title="ST_PointOnSurface">ST_PointOnSurface</a> - ポリゴン内またはジオメトリ上にあるのが保証されたポイントを返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 8.1.5, 9.5.6. 仕様では、サーフェスジオメトリのみのST_PointOnSurfaceが定義されています。PostGISは、すべての一般的なジオメトリタイプに対応するよう拡張しています。他のデータベース (Oracle、DB2、ArcSDE)は、サーフェスに対してのみこの機能をサポートしているようです。SQL Server 2008では、すべての一般的なジオメトリタイプに対応しています。</li><li class="listitem"><a class="link" href="#ST_Polygon" title="ST_Polygon">ST_Polygon</a> - ラインストリングから指定したSRIDを持つポリゴンを生成します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 8.3.2</li><li class="listitem"><a class="link" href="#ST_RemEdgeModFace" title="ST_RemEdgeModFace">ST_RemEdgeModFace</a> - エッジを削除し、削除対象エッジでフェイスが二つに分割されているなら、両方の空間をとるため、一つを削除して、もう一つを編集します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.15</li><li class="listitem"><a class="link" href="#ST_RemEdgeNewFace" title="ST_RemEdgeNewFace">ST_RemEdgeNewFace</a> - エッジを削除し、消去対象エッジでフェイスが二つに分割されているなら元の二つのフェイスを削除し、一つの新しいフェイスに置き換えます。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.14</li><li class="listitem"><a class="link" href="#ST_RemoveIsoEdge" title="ST_RemoveIsoEdge">ST_RemoveIsoEdge</a> - 孤立エッジを削除し、実行結果の記述を返します。エッジが孤立していない場合には、例外が投げられます。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.3</li><li class="listitem"><a class="link" href="#ST_RemoveIsoNode" title="ST_RemoveIsoNode">ST_RemoveIsoNode</a> - 孤立ノードを削除し、実行結果が返されます。ノードが孤立していない (エッジの始端または終端である)場合には、例外が投げられます。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.3</li><li class="listitem"><a class="link" href="#ST_StartPoint" title="ST_StartPoint">ST_StartPoint</a> - ラインストリングの始点を返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 7.1.3</li><li class="listitem"><a class="link" href="#ST_X" title="ST_X">ST_X</a> - ポイントのX値を返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 6.1.3</li><li class="listitem"><a class="link" href="#ST_Y" title="ST_Y">ST_Y</a> - ポイントのY値を返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 6.1.4</li><li class="listitem"><a class="link" href="#ST_Z" title="ST_Z">ST_Z</a> - ポイントのZ値を返します。
   
     
   
  This method implements the SQL/MM specification.</li></ul></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="PostGIS_GeographyFunctions"></a>15.4. PostGISジオグラフィ対応関数</h2></div></div></div><p>次に示す関数と演算子は、<a class="link" href="#PostGIS_Geography" title="4.3. ジオグラフィデータタイプ">ジオグラフィ</a>データ型を入力または出力に取るPostGIS関数/演算子です。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>(T)の付いた関数はネイティブなジオグラフィ関数ではなく、実行時にST_Transformを使ってジオメトリとの変換を行います。結果として、日付変更線や極を超えたり、ひとつのUTMゾーンではカバーできない巨大なジオメトリを使用する場合に、予期しない挙動になることがあります。基本的な変換としては、UTMが望ましいですが、ランベルト正積方位図法(北/南)、最悪のシナリオでメルカトルに頼ります。</p></td></tr></table></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#ST_Area" title="ST_Area">ST_Area</a> - ポリゴンジオメトリの面積を返します。</li><li class="listitem"><a class="link" href="#ST_AsBinary" title="ST_AsBinary">ST_AsBinary</a> - ジオメトリ/ジオグラフィの、SRIDメタデータを持たないOGC/ISO Well-Knownバイナリ (WKB)表現を返します。</li><li class="listitem"><a class="link" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a> - ジオメトリのSRIDメタデータが付いたWell-Known Text (WKT)表現を返します。</li><li class="listitem"><a class="link" href="#ST_AsGML" title="ST_AsGML">ST_AsGML</a> - GML第2版または第3版としてジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_AsGeoJSON" title="ST_AsGeoJSON">ST_AsGeoJSON</a> - ジオメトリをGeoJSON要素として返します。</li><li class="listitem"><a class="link" href="#ST_AsKML" title="ST_AsKML">ST_AsKML</a> - KML要素としてジオメトリを返します。いくつかの形式があります。デフォルトはversion=2, maxdecimaldigits=15です。</li><li class="listitem"><a class="link" href="#ST_AsSVG" title="ST_AsSVG">ST_AsSVG</a> - ジオメトリからSVGパスデータを返します。</li><li class="listitem"><a class="link" href="#ST_AsText" title="ST_AsText">ST_AsText</a> - ジオメトリ/ジオグラフィのSRIDメタデータのないWell-Known Text (WKT)表現を返します。</li><li class="listitem"><a class="link" href="#ST_Azimuth" title="ST_Azimuth">ST_Azimuth</a> - 北を基準とした2点間の線の方位角を返します。</li><li class="listitem"><a class="link" href="#ST_Buffer" title="ST_Buffer">ST_Buffer</a> - あるジオメトリからの距離が指定された距離以下となる点全ての集合となるジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_Centroid" title="ST_Centroid">ST_Centroid</a> - ジオメトリの幾何学的重心を返します。</li><li class="listitem"><a class="link" href="#ST_Distance" title="ST_Distance">ST_Distance</a> - 二つのジオメトリ値またはジオグラフィ値間の距離を返します。</li><li class="listitem"><a class="link" href="#ST_Geometry_EQ" title="=">=</a> - ジオメトリ/ジオグラフィ Aの座標と座標の並び順がジオメトリ/ジオグラフィ Bと同じ場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#ST_Length" title="ST_Length">ST_Length</a> - 線系ジオメトリの2次元長を返します。</li><li class="listitem"><a class="link" href="#ST_Perimeter" title="ST_Perimeter">ST_Perimeter</a> - ポリゴンジオメトリまたはジオグラフィの境界の長さを返します。</li><li class="listitem"><a class="link" href="#ST_Project" title="ST_Project">ST_Project</a> - 始点から距離と方位で算出されたポイントを返します。</li><li class="listitem"><a class="link" href="#ST_Segmentize" title="ST_Segmentize">ST_Segmentize</a> - 与えた距離を超える線分を持たないよう変更したジオメトリ/ジオグラフィを返します。</li><li class="listitem"><a class="link" href="#ST_Summary" title="ST_Summary">ST_Summary</a> - ジオメトリの中身の概要を文字列で返します。</li><li class="listitem"><a class="link" href="#geometry_distance_knn" title="&lt;-&gt;">&lt;-&gt;</a> - AとBの2次元距離を返します。</li><li class="listitem"><a class="link" href="#geometry_overlaps" title="&amp;&amp;">&amp;&amp;</a> - Aの2次元バウンディングボックスがBの2次元バウンディングボックスとインタセクトする場合にTRUEを返します。</li></ul></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="PostGIS_RasterFunctions"></a>15.5. PostGISラスタ機能関数</h2></div></div></div><p>次に示す関数と演算子は、<a class="xref" href="#raster" title="raster">raster</a>データ型を入力または出力に取るPostGIS関数/演算子です。アルファベット順に示します。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#RT_Box3D" title="Box3D">Box3D</a> - ラスタを囲むボックスのbox3d表現を返します。</li><li class="listitem"><a class="link" href="#RT_Raster_Contained" title="@">@</a> - AのバウンディングボックスがBのバウンディングボックスに含まれる場合にTRUEを返します。倍精度浮動小数点数のバウンディングボックスを使います。</li><li class="listitem"><a class="link" href="#RT_Raster_Contains" title="~">~</a> - AのバウンディングボックスがBのバウンディングボックスを含む場合にTRUEを返します。倍精度浮動小数点数のバウンディングボックスを使います。</li><li class="listitem"><a class="link" href="#RT_Raster_EQ" title="=">=</a> - AのバウンディングボックスがBのバウンディングボックスと同じ場合にTRUEを返します。倍精度浮動小数点数のバウンディングボックスを使います。</li><li class="listitem"><a class="link" href="#RT_Raster_Intersect" title="&amp;&amp;">&amp;&amp;</a> - AのバウンディングボックスがBのバウンディングボックスとインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#RT_Raster_OverLeft" title="&amp;&lt;">&amp;&lt;</a> - AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの左にある場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#RT_Raster_OverRight" title="&amp;&gt;">&amp;&gt;</a> - AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの右にある場合に TRUE を返します。</li><li class="listitem"><a class="link" href="#RT_Raster_Same" title="~=">~=</a> - AのバウンディングボックスがBのバウンディングボックスと同じ場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#RT_Retile" title="ST_Retile">ST_Retile</a> - 任意のタイル化されたラスタカバレッジから構成されたタイルの集合を返します。</li><li class="listitem"><a class="link" href="#RT_ST_AddBand" title="ST_AddBand">ST_AddBand</a> - 与えられたタイプで、与えられた初期値にした新しいバンドを、与えられたインデクス位置に追加したラスタを返します。インデクス位置を指定していない場合には、バンドは末尾に追加されます。</li><li class="listitem"><a class="link" href="#RT_ST_AsBinary" title="ST_AsBinary/ST_AsWKB">ST_AsBinary/ST_AsWKB</a> - ラスタのWell-Known Binary (WKB)表現を返します。</li><li class="listitem"><a class="link" href="#RT_ST_AsGDALRaster" title="ST_AsGDALRaster">ST_AsGDALRaster</a> - 指定されたGDALラスタ書式でラスタタイルを返します。ラスタ書式はコンパイルしたライブラリが対応するものです。ライブラリが対応する書式の一覧を得るにはST_GDALRasters()を使います。</li><li class="listitem"><a class="link" href="#RT_ST_AsHexWKB" title="ST_AsHexWKB">ST_AsHexWKB</a> - Well-Known Binary (WKB)ラスタを16進数表現で返します。</li><li class="listitem"><a class="link" href="#RT_ST_AsJPEG" title="ST_AsJPEG">ST_AsJPEG</a> - ラスタの選択されたバンドを、単一のJoint Photographic Exports Group (JPEG)画像としてバイト配列で返します。バンドを指定せず、1バンドか3より多いバンドがある場合には、1番バンドを使用します。3バンドのみ指定した場合には、3バンドを使用し、RGBに対応付けます。</li><li class="listitem"><a class="link" href="#RT_ST_AsPNG" title="ST_AsPNG">ST_AsPNG</a> - ラスタの選択されたバンドを、単一のportable network graphics (PNG)画像としてバイト配列で返します。バンドを指定せず、1バンドか3バンドか4バンドある場合には、全てのバンドを使用します。バンドを指定せず、2バンドか4より多いバンドがある場合には、1番バンドを使用します。対象バンドはRGBまたはRGBAに対応付けられます。</li><li class="listitem"><a class="link" href="#RT_ST_AsRaster" title="ST_AsRaster">ST_AsRaster</a> - PostGISジオメトリをPostGISラスタに変換します。</li><li class="listitem"><a class="link" href="#RT_ST_AsTIFF" title="ST_AsTIFF">ST_AsTIFF</a> - ラスタの選択されたバンドを、単一のTIFF画像 (バイト配列)として返します。バンドを指定しないか指定したバンドがラスタ内に無い場合には、全てのバンドの使用を試みます。</li><li class="listitem"><a class="link" href="#RT_ST_Aspect" title="ST_Aspect">ST_Aspect</a> - 標高ラスタバンドの傾斜方向 (デフォルトの単位は度)を返します。地形解析に使えます。</li><li class="listitem"><a class="link" href="#RT_ST_Band" title="ST_Band">ST_Band</a> - 既存のラスタの、一つ以上のバンドを新しいラスタとして返します。既存のラスタから新しいラスタを構築する際に使えます。</li><li class="listitem"><a class="link" href="#RT_ST_BandFileSize" title="ST_BandFileSize">ST_BandFileSize</a> - ファイルシステムに格納されているバンドのファイルサイズを返します。バンド番号が指定されていない場合には、1番と仮定します。</li><li class="listitem"><a class="link" href="#RT_ST_BandFileTimestamp" title="ST_BandFileTimestamp">ST_BandFileTimestamp</a> - ファイルシステムに格納されているバンドのファイルタイムスタンプ返します。バンド番号が指定されていない場合には、1番と仮定します。</li><li class="listitem"><a class="link" href="#RT_ST_BandIsNoData" title="ST_BandIsNoData">ST_BandIsNoData</a> - 指定したバンドがNODATA値だけで満たされている場合には、TRUEを返します。</li><li class="listitem"><a class="link" href="#RT_ST_BandMetaData" title="ST_BandMetaData">ST_BandMetaData</a> - 指定したラスタバンドの基本的なメタデータを返します。バンド番号を指定しない場合には、1番と仮定します。</li><li class="listitem"><a class="link" href="#RT_ST_BandNoDataValue" title="ST_BandNoDataValue">ST_BandNoDataValue</a> - 指定されたバンドについてデータが無いことを表現する値を返します。バンド番号を指定しない場合には、1番と仮定します。</li><li class="listitem"><a class="link" href="#RT_ST_BandPath" title="ST_BandPath">ST_BandPath</a> - ファイルシステムに格納されているバンドのシステムファイルパスを返します。バンド番号が指定されていない場合には、1番と仮定します。</li><li class="listitem"><a class="link" href="#RT_ST_BandPixelType" title="ST_BandPixelType">ST_BandPixelType</a> - 指定したバンドのピクセルタイプを返します。バンド番号が指定されていない場合には、1番と仮定します。</li><li class="listitem"><a class="link" href="#RT_ST_Clip" title="ST_Clip">ST_Clip</a> - 入力ジオメトリで切り取ったラスタを返します。バンドが指定されていない場合には、全てのバンドが返されます。cropが指定されていない場合には、TRUEと仮定され、出力ラスタをクロップします。</li><li class="listitem"><a class="link" href="#RT_ST_ColorMap" title="ST_ColorMap">ST_ColorMap</a> - 元のラスタと指定したバンドから4個までの8BUIバンド (grayscale, RGB, RGBA)からなる新しいラスタを生成します。</li><li class="listitem"><a class="link" href="#RT_ST_Contains" title="ST_Contains">ST_Contains</a> - rastAの外にrastBの点が無く、rastAの内部にrastBの内部の点が一つ以上ある場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#RT_ST_ContainsProperly" title="ST_ContainsProperly">ST_ContainsProperly</a> - rastBがrastAの内部でインタセクトし、かつrastAの境界とも外部ともインタセクトしない場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#RT_ST_Contour" title="ST_Contour">ST_Contour</a> - 与えられたラスタバンドから等高線ベクタを生成します。GDAL等高線生成アルゴリズムを使います。</li><li class="listitem"><a class="link" href="#RT_ST_ConvexHull" title="ST_ConvexHull">ST_ConvexHull</a> - BandNoDataValueと等しいピクセル値を含むラスタの凸包ジオメトリを返します。一般的な形状でスキューのないラスタでは、ST_Envelopeと同じ結果になります。不規則な形状をしているか回転しているラスタでのみ使います。</li><li class="listitem"><a class="link" href="#RT_ST_Count" title="ST_Count">ST_Count</a> - ラスタまたはラスタカバレッジの指定したバンドのピクセル数を返します。バンドを指定しない場合には、1番と仮定します。exclude_nodata_valueをTRUEに設定している場合には、NODATA値と等しくないピクセルのみを数えます。</li><li class="listitem"><a class="link" href="#RT_ST_CountAgg" title="ST_CountAgg">ST_CountAgg</a> - 集約関数です。ラスタ集合の与えられたバンドのピクセル数を返します。バンドが指定されていない場合には、1番と仮定します。exclude_nodata_valueをTRUEに設定している場合には、NODATA値と等しくないピクセルのみを数えます。</li><li class="listitem"><a class="link" href="#RT_ST_CoveredBy" title="ST_CoveredBy">ST_CoveredBy</a> - rastAがrastBの外部に点を持たない場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#RT_ST_Covers" title="ST_Covers">ST_Covers</a> - rastBがrastAの外部に点を持たない場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#RT_ST_DFullyWithin" title="ST_DFullyWithin">ST_DFullyWithin</a> - rastAとrastBが指定した距離内に完全に収まる場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#RT_ST_DWithin" title="ST_DWithin">ST_DWithin</a> - rastAとrastBが指定した距離内にある場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#RT_ST_Disjoint" title="ST_Disjoint">ST_Disjoint</a> - rastAがrastBとインタセクトしない場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#RT_ST_DumpAsPolygons" title="ST_DumpAsPolygons">ST_DumpAsPolygons</a> - 指定されたラスタバンドからgeomval (geom,val)行の集合を返します。バンドを指定しない場合のデフォルトは1です。</li><li class="listitem"><a class="link" href="#RT_ST_DumpValues" title="ST_DumpValues">ST_DumpValues</a> - 指定したバンドの値を2次元で得ます。</li><li class="listitem"><a class="link" href="#RT_ST_Envelope" title="ST_Envelope">ST_Envelope</a> - ラスタの範囲のポリゴン表現を返します。</li><li class="listitem"><a class="link" href="#RT_ST_FromGDALRaster" title="ST_FromGDALRaster">ST_FromGDALRaster</a> - 対応するGDALラスタファイルからラスタを返します。</li><li class="listitem"><a class="link" href="#RT_ST_GeoReference" title="ST_GeoReference">ST_GeoReference</a> - GDAL書式または一般的にワールドファイルでみられるESRI書式の地理参照メタデータを返します。デフォルトはGDALです。</li><li class="listitem"><a class="link" href="#RT_ST_Grayscale" title="ST_Grayscale">ST_Grayscale</a> - 元のラスタと指定したバンドを赤、緑、青バンドとして一つの8BUIバンドを持つラスタを生成します。</li><li class="listitem"><a class="link" href="#RT_ST_HasNoBand" title="ST_HasNoBand">ST_HasNoBand</a> - 指定したバンド番号のバンドが無い場合には、TRUEを返します。バンド番号を指定していない場合には、1番と仮定します。</li><li class="listitem"><a class="link" href="#RT_ST_Height" title="ST_Height">ST_Height</a> - ラスタの高さをピクセル単位で返します。</li><li class="listitem"><a class="link" href="#RT_ST_HillShade" title="ST_HillShade">ST_HillShade</a> - 与えられた方位、高度、明度、スケールの入力を使って標高ラスタバンドの仮想照明を返します。</li><li class="listitem"><a class="link" href="#RT_ST_Histogram" title="ST_Histogram">ST_Histogram</a> - ラスタまたはラスタカバレッジのビン範囲で分割したデータ分布をまとめるヒストグラムの集合を返します。ビン数を指定しない場合には自動計算されます。</li><li class="listitem"><a class="link" href="#RT_ST_InterpolateRaster" title="ST_InterpolateRaster">ST_InterpolateRaster</a> - X値とY値を使用してグリッド上のポイントを配置し、ポイントのZ値をサーフェス標高として配置し、3次元ポイントの入力セットに基づいてグリッドサーフェスを補間します。</li><li class="listitem"><a class="link" href="#RT_ST_Intersection" title="ST_Intersection">ST_Intersection</a> - 二つのラスタの共有部分またはベクタ化したラスタとジオメトリとのインタセクトした部分を表現する、ラスタまたはジオメトリとピクセル値の組の集合を返します。</li><li class="listitem"><a class="link" href="#RT_ST_Intersects" title="ST_Intersects">ST_Intersects</a> - rastAがrastBとインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#RT_ST_IsEmpty" title="ST_IsEmpty">ST_IsEmpty</a> - ラスタが空 (幅が0で高さが0)の場合にはTRUEを返します。他の場合には、FALSEを返します。</li><li class="listitem"><a class="link" href="#RT_ST_MakeEmptyCoverage" title="ST_MakeEmptyCoverage">ST_MakeEmptyCoverage</a> - 空のラスタタイルのグリッドでジオリファレンスを施されている領域を生成します。</li><li class="listitem"><a class="link" href="#RT_ST_MakeEmptyRaster" title="ST_MakeEmptyRaster">ST_MakeEmptyRaster</a> - 与えられたピクセル範囲 (width &amp; height)、左上のX,Y、ピクセルサイズ、回転 (scalex, scaley, skewx, skewy)と空間参照系 (srid)が指定された空ラスタ (バンドを持たないラスタ)を返します。ラスタが渡されると、新しいラスタは渡されたラスタと同じサイズ、アラインメント、SRIDになります。SRIDが指定されていない場合には、空間参照系は不明 (0)とされます。</li><li class="listitem"><a class="link" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a> - コールバック関数版 - 一つ以上の入力ラスタ、バンドインデクスと一つのユーザ定義コールバック関数から、一つのバンドからなるラスタを返します。</li><li class="listitem"><a class="link" href="#RT_ST_MapAlgebraExpr" title="ST_MapAlgebraExpr">ST_MapAlgebraExpr</a> - 1バンド版: 入力バンドに対する妥当なPostgreSQL代数演算で形成された、指定したピクセルタイプとなる1バンドラスタを生成します。バンドを指定しない場合には、1番を仮定します。</li><li class="listitem"><a class="link" href="#RT_ST_MapAlgebraExpr2" title="ST_MapAlgebraExpr">ST_MapAlgebraExpr</a> - 2バンド版: 二つの入力バンドに対する妥当なPostgreSQL代数演算で形成された、指定したピクセルタイプとなる1バンドラスタを生成します。バンドを指定しない場合には、どちらも1番と仮定します。結果ラスタは、一つ目のラスタのアラインメント (スケール、スキュー、ピクセル角位置)にあわされます。範囲は"extenttype"引数で定義されます。取りうる"extenttype"の値はINTERSECTION, UNION, FIRST, SECONDです。</li><li class="listitem"><a class="link" href="#RT_ST_MapAlgebraFct" title="ST_MapAlgebraFct">ST_MapAlgebraFct</a> - 1バンド版 - 入力バンドに対する妥当なPostgreSQL関数で形成された、指定したピクセルタイプとなる1バンドラスタを生成します。バンドを指定しない場合には、1番と仮定します。</li><li class="listitem"><a class="link" href="#RT_ST_MapAlgebraFct2" title="ST_MapAlgebraFct">ST_MapAlgebraFct</a> - 2バンド版 - 二つの入力バンドに対する妥当なPostgreSQL関数で形成された、指定したピクセルタイプとなる1バンドラスタを生成します。バンドを指定しない場合には、1番と仮定します。"extenttype"のデフォルトはINTERSECTIONです。</li><li class="listitem"><a class="link" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a> - 1バンド版: ユーザ定義PostgreSQL関数を使用する最近傍地図代数関数です。入力ラスタバンドの近傍の値を与えたPL/pgSQLユーザ定義関数の結果からなるラスタを返します。</li><li class="listitem"><a class="link" href="#RT_ST_MapAlgebra_expr" title="ST_MapAlgebra (数式版)">ST_MapAlgebra (数式版)</a> - 数式版 - 一つか二つの入力ラスタ、バンド番号、一つ以上のユーザ定義SQL式から一つのバンドを持つラスタを返します。</li><li class="listitem"><a class="link" href="#RT_ST_MemSize" title="ST_MemSize">ST_MemSize</a> - ラスタが取る領域の合計をバイト単位で返します。</li><li class="listitem"><a class="link" href="#RT_ST_MetaData" title="ST_MetaData">ST_MetaData</a> - ピクセル数、回転 (スキュー)、左上隅位置等のラスタオブジェクトに関する基本的なメタデータを返します。</li><li class="listitem"><a class="link" href="#RT_ST_MinConvexHull" title="ST_MinConvexHull">ST_MinConvexHull</a> - NODATA値を除いたラスタの凸包ジオメトリを返します。</li><li class="listitem"><a class="link" href="#RT_ST_NearestValue" title="ST_NearestValue">ST_NearestValue</a> - 与えられたバンドの、columnxとrowyで指定されるか、またはラスタと同じ空間参照系で表現されたポイントで指定されたピクセルに最も近いNODATAでない値を返します。</li><li class="listitem"><a class="link" href="#RT_ST_Neighborhood" title="ST_Neighborhood">ST_Neighborhood</a> - 与えられたバンドのcolumnX, columnYか、ラスタと同じ空間参照系のジオメトリポイントで指定されたピクセルの周囲にある、NODATAでない2次元倍精度浮動小数点数配列を返します。</li><li class="listitem"><a class="link" href="#RT_ST_NotSameAlignmentReason" title="ST_NotSameAlignmentReason">ST_NotSameAlignmentReason</a> - ラスタが同じアラインメントを持つかどうか、また、持たない場合にはその理由を示す文字列を返します。</li><li class="listitem"><a class="link" href="#RT_ST_NumBands" title="ST_NumBands">ST_NumBands</a> - ラスタオブジェクトのバンド数を返します。</li><li class="listitem"><a class="link" href="#RT_ST_Overlaps" title="ST_Overlaps">ST_Overlaps</a> - rastAとrastBがインタセクトして、かつ一方がもう一方に完全には包含されない場合にはTRUEを返します。</li><li class="listitem"><a class="link" href="#RT_ST_PixelAsCentroid" title="ST_PixelAsCentroid">ST_PixelAsCentroid</a> - ピクセルで表現される面の重心 (ポイントジオメトリ)を返します。</li><li class="listitem"><a class="link" href="#RT_ST_PixelAsCentroids" title="ST_PixelAsCentroids">ST_PixelAsCentroids</a> - 全てのピクセルについて重心 (ポイントジオメト)リを、ピクセルごとのピクセル値とラスタ座標系のXとYとを付けて返します。ポイントジオメトリの座標はピクセルで表現される面の重心です。</li><li class="listitem"><a class="link" href="#RT_ST_PixelAsPoint" title="ST_PixelAsPoint">ST_PixelAsPoint</a> - ピクセルの左上隅のポイントジオメトリを返します。</li><li class="listitem"><a class="link" href="#RT_ST_PixelAsPoints" title="ST_PixelAsPoints">ST_PixelAsPoints</a> - 全てのピクセルについてポイントジオメトリを、ピクセルごとのピクセル値とラスタ座標系のXとYとを付けて返します。ポイントジオメトリの座標はピクセルの左上隅です。</li><li class="listitem"><a class="link" href="#RT_ST_PixelAsPolygon" title="ST_PixelAsPolygon">ST_PixelAsPolygon</a> - 指定した行と列のピクセルの境界となるジオメトリを返します。</li><li class="listitem"><a class="link" href="#RT_ST_PixelAsPolygons" title="ST_PixelAsPolygons">ST_PixelAsPolygons</a> - 全てのピクセルについて境界となるジオメトリを、ピクセルごとのピクセル値とラスタ座標系のXとYとを付けて返します。</li><li class="listitem"><a class="link" href="#RT_ST_PixelHeight" title="ST_PixelHeight">ST_PixelHeight</a> - 空間参照系の地理的な単位でのピクセルの高さを返します。</li><li class="listitem"><a class="link" href="#RT_ST_PixelOfValue" title="ST_PixelOfValue">ST_PixelOfValue</a> - 検索値と同じ値を持つピクセルのcolumnx, rowyピクセル座標を得ます。</li><li class="listitem"><a class="link" href="#RT_ST_PixelWidth" title="ST_PixelWidth">ST_PixelWidth</a> - 空間参照系の地理的な単位でのピクセルの幅を返します。</li><li class="listitem"><a class="link" href="#RT_ST_Polygon" title="ST_Polygon">ST_Polygon</a> - NODATA値でないピクセル値を持つピクセルの結合で形成されるマルチポリゴンジオメトリを返します。バンドを指定しない場合のデフォルトは1です。</li><li class="listitem"><a class="link" href="#RT_ST_Quantile" title="ST_Quantile">ST_Quantile</a> - ラスタまたはラスタテーブルカバレッジのサンプルまたは母集団の分位数を計算します。値がラスタの25%,50%,75%にあるかを調べることができます。</li><li class="listitem"><a class="link" href="#RT_ST_RastFromHexWKB" title="ST_RastFromHexWKB">ST_RastFromHexWKB</a> - Well-Knownバイナリ (WKB)ラスタの16進数表現からラスタを返します。</li><li class="listitem"><a class="link" href="#RT_ST_RastFromWKB" title="ST_RastFromWKB">ST_RastFromWKB</a> - Well-Known Binary (WKB)ラスタからラスタ値を返します。</li><li class="listitem"><a class="link" href="#RT_ST_RasterToWorldCoord" title="ST_RasterToWorldCoord">ST_RasterToWorldCoord</a> - ラスタの指定した列と行における左上隅の地理座標X値とY値 (経度と緯度)を返します。列と行の番号は1始まりです。</li><li class="listitem"><a class="link" href="#RT_ST_RasterToWorldCoordX" title="ST_RasterToWorldCoordX">ST_RasterToWorldCoordX</a> - ラスタの指定した列と行における左上隅の地理座標のX値を返します。列と行の番号は1始まりです。</li><li class="listitem"><a class="link" href="#RT_ST_RasterToWorldCoordY" title="ST_RasterToWorldCoordY">ST_RasterToWorldCoordY</a> - ラスタの指定した列と行における左上隅の地理座標のY値を返します。列と行の番号は1始まりです。</li><li class="listitem"><a class="link" href="#RT_ST_Reclass" title="ST_Reclass">ST_Reclass</a> - 元のラスタから再分類したバンドタイプからなるラスタを生成します。nbandは変更するバンドです。nbandが指定されていない場合には、1と仮定します。他の全てのバンドは変更せずに返します。可視画像の書式としてより単純な描画を行うために、16BUIバンドを8BUIバンドに変換する、等のために使います。</li><li class="listitem"><a class="link" href="#RT_ST_Resample" title="ST_Resample">ST_Resample</a> - 指定したリサンプリングアルゴリズム、新しいピクセル範囲、グリッドの隅、定義するか他のラスタから借りてきた地理参照属性を使ってリサンプリングを行います。</li><li class="listitem"><a class="link" href="#RT_ST_Rescale" title="ST_Rescale">ST_Rescale</a> - スケール (ピクセルサイズ)だけを調整するリサンプリングを行います。新しいピクセル値のリサンプリングアルゴリズムとして最近傍補間 ('NearestNeighbor' (米式綴り方))、双線形補間 ('Bilinear')、3次補間 ('Cubic')、3次スプライン補間 ('CubicSpline')、ランチョス補間 ('Lanczos')を用います。デフォルトは最近傍補間です。</li><li class="listitem"><a class="link" href="#RT_ST_Resize" title="ST_Resize">ST_Resize</a> - ラスタを新しい幅、高さにサイズ再設定を行います。</li><li class="listitem"><a class="link" href="#RT_ST_Reskew" title="ST_Reskew">ST_Reskew</a> - キュー (回転パラメタ)だけを調整するリサンプリングを行います。新しいピクセル値のリサンプリングアルゴリズムとして最近傍補間 ('NearestNeighbor' (米式綴り方))、双線形補間 ('Bilinear')、3次補間 ('Cubic')、3次スプライン補間 ('CubicSpline')、ランチョス補間 ('Lanczos')を用います。デフォルトは最近傍補間です。</li><li class="listitem"><a class="link" href="#RT_ST_Rotation" title="ST_Rotation">ST_Rotation</a> - ラスタの回転をラジアンで返します。</li><li class="listitem"><a class="link" href="#RT_ST_Roughness" title="ST_Roughness">ST_Roughness</a> - DEMの「粗度」を計算したラスタを返します。</li><li class="listitem"><a class="link" href="#RT_ST_SRID" title="ST_SRID">ST_SRID</a> - ラスタのspatial_ref_sysテーブルで定義されている空間参照系識別番号を返します。</li><li class="listitem"><a class="link" href="#RT_ST_SameAlignment" title="ST_SameAlignment">ST_SameAlignment</a> - ラスタが同じスキュー、スケール、空間参照系、オフセットを持つ (ピクセルが分割されることなく同じグリッドに置かれている)場合にTRUEを返し、そうでない場合は問題を詳述する通知とともにFALSEを返します。</li><li class="listitem"><a class="link" href="#RT_ST_ScaleX" title="ST_ScaleX">ST_ScaleX</a> - 空間参照系の地理的な単位でのピクセル幅のX成分を返します。</li><li class="listitem"><a class="link" href="#RT_ST_ScaleY" title="ST_ScaleY">ST_ScaleY</a> - 空間参照系の地理的な単位でのピクセル幅のY成分を返します。</li><li class="listitem"><a class="link" href="#RT_ST_SetBandIndex" title="ST_SetBandIndex">ST_SetBandIndex</a> - データベース外バンドの外部バンド番号の更新</li><li class="listitem"><a class="link" href="#RT_ST_SetBandIsNoData" title="ST_SetBandIsNoData">ST_SetBandIsNoData</a> - バンドのisnodataフラグをTRUEにします。</li><li class="listitem"><a class="link" href="#RT_ST_SetBandNoDataValue" title="ST_SetBandNoDataValue">ST_SetBandNoDataValue</a> - 指定したバンドにNODATAを表現する値を設定します。バンドを指定しない場合には、1番と仮定します。NODATA値を持たないようにするには、nodatavalueにNULLを指定します。</li><li class="listitem"><a class="link" href="#RT_ST_SetBandPath" title="ST_SetBandPath">ST_SetBandPath</a> - データベース外バンドの外部パスとバンド番号を更新します。</li><li class="listitem"><a class="link" href="#RT_ST_SetGeoReference" title="ST_SetGeoReference">ST_SetGeoReference</a> - 地理参照6パラメタを一度に設定します。数値は空白で区切ります。GDALまたはESRI書式の入力を受け付けます。デフォルトはGDALです。</li><li class="listitem"><a class="link" href="#RT_ST_SetM" title="ST_SetM">ST_SetM</a> - 入力ジオメトリと同じX/y座標値と、指定されたリサンプリングアルゴリズムを使ってラスタから複写されたZ値とを持つジオメトリを返します。</li><li class="listitem"><a class="link" href="#RT_ST_SetRotation" title="ST_SetRotation">ST_SetRotation</a> - ラスタの回転をラジアン単位で設定します。</li><li class="listitem"><a class="link" href="#RT_ST_SetSRID" title="ST_SetSRID">ST_SetSRID</a> - スタのSRIDをspatial_ref_sysに定義されている特定の整数値に設定します。</li><li class="listitem"><a class="link" href="#RT_ST_SetScale" title="ST_SetScale">ST_SetScale</a> - ピクセルサイズのX値とY値を空間参照系の単位で設定します。数値は単位/ピクセルの幅または高さです。</li><li class="listitem"><a class="link" href="#RT_ST_SetSkew" title="ST_SetSkew">ST_SetSkew</a> - 地理参照のスキュー (回転パラメタ)のX値とY値を設定します。一つだけ渡した場合には、X値とY値は同じ値に設定されます。</li><li class="listitem"><a class="link" href="#RT_ST_SetUpperLeft" title="ST_SetUpperLeft">ST_SetUpperLeft</a> - ラスタの左上隅の投影座標系のX値とY値を設定します。</li><li class="listitem"><a class="link" href="#RT_ST_SetValue" title="ST_SetValue">ST_SetValue</a> - 与えられたバンドのcolumnX, columnYか、ラスタと同じ空間参照系のジオメトリポイントで指定されたピクセルの値または指定したジオメトリとインタセクトするピクセル群の値を設定することから得られる、変更されたラスタを返します。バンド番号は1始まりで、指定しない場合には、1番と仮定します。</li><li class="listitem"><a class="link" href="#RT_ST_SetValues" title="ST_SetValues">ST_SetValues</a> - 与えられたバンドに複数の値を設定して、変更されたラスタを返します。</li><li class="listitem"><a class="link" href="#RT_ST_SetZ" title="ST_SetZ">ST_SetZ</a> - 入力ジオメトリと同じX/y座標値と、指定されたリサンプリングアルゴリズムを使ってラスタから複写されたZ値とを持つジオメトリを返します。</li><li class="listitem"><a class="link" href="#RT_ST_SkewX" title="ST_SkewX">ST_SkewX</a> - 空間参照のXスキュー (回転パラメータ)を返します。</li><li class="listitem"><a class="link" href="#RT_ST_SkewY" title="ST_SkewY">ST_SkewY</a> - 空間参照のYスキュー (回転パラメータ)を返します。</li><li class="listitem"><a class="link" href="#RT_ST_Slope" title="ST_Slope">ST_Slope</a> - 標高ラスタバンドの傾斜角 (デフォルトでは度単位)を返します。地形解析に使えます。</li><li class="listitem"><a class="link" href="#RT_ST_SnapToGrid" title="ST_SnapToGrid">ST_SnapToGrid</a> - グリッドにスナップすることでラスタをリサンプリングします。新しいピクセル値のリサンプリングアルゴリズムとして最近傍補間 ('NearestNeighbor' (米式綴り方))、双線形補間 ('Bilinear')、3次補間 ('Cubic')、3次スプライン補間 ('CubicSpline')、ランチョス補間('Lanczos')を用います。デフォルトは最近傍補間です。</li><li class="listitem"><a class="link" href="#RT_ST_Summary" title="ST_Summary">ST_Summary</a> - ラスタの中身の概要が文字列で返されます。</li><li class="listitem"><a class="link" href="#RT_ST_SummaryStats" title="ST_SummaryStats">ST_SummaryStats</a> - ラスタまたはラスタカバレッジの指定したバンドについて、ピクセル数、合計値、平均値、標準偏差、最小値、最大値からなる統計情報の概要を返します。バンドを指定しない場合には、1番と仮定します。</li><li class="listitem"><a class="link" href="#RT_ST_SummaryStatsAgg" title="ST_SummaryStatsAgg">ST_SummaryStatsAgg</a> - 集約関数です。ラスタ集合の指定したバンドについて、ピクセル数、合計値、平均値、標準偏差、最小値、最大値からなる統計情報の概要を返します。バンドを指定しない場合には、1番と仮定します。</li><li class="listitem"><a class="link" href="#RT_ST_TPI" title="ST_TPI">ST_TPI</a> - 地形的位置指数を計算したラスタを返します。</li><li class="listitem"><a class="link" href="#RT_ST_TRI" title="ST_TRI">ST_TRI</a> - 起伏指標を計算したラスタを返します。</li><li class="listitem"><a class="link" href="#RT_ST_Tile" title="ST_Tile">ST_Tile</a> - 求められた出力ラスタのピクセル数に基づいて入力ラスタを分割した結果のラスタ集合を返します。</li><li class="listitem"><a class="link" href="#RT_ST_Touches" title="ST_Touches">ST_Touches</a> - rastAとrastBが少なくとも一つの共通の点を持ち、かつ二つのラスタの内部同士がインタセクトしない場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#RT_ST_Transform" title="ST_Transform">ST_Transform</a> - ラスタを既知の空間参照系から他の既知の空間参照系に、指定したリサンプリングアルゴリズムで投影変換します。新しいピクセル値のリサンプリングアルゴリズムとして最近傍補間 ('NearestNeighbor' (米式綴り方))、双線形補間 ('Bilinear')、3次補間 ('Cubic')、3次スプライン補間 ('CubicSpline')、ランチョス補間 ('Lanczos')を用います。デフォルトは最近傍補間です。</li><li class="listitem"><a class="link" href="#RT_ST_Union" title="ST_Union">ST_Union</a> - ラスタタイルの集合を結合して1以上のバンドからなる単一ラスタを返します。</li><li class="listitem"><a class="link" href="#RT_ST_UpperLeftX" title="ST_UpperLeftX">ST_UpperLeftX</a> - 適用されている空間参照系でのラスタの左上隅のX座標値を返します。</li><li class="listitem"><a class="link" href="#RT_ST_UpperLeftY" title="ST_UpperLeftY">ST_UpperLeftY</a> - 適用されている空間参照系でのラスタの左上隅のY座標値を返します。</li><li class="listitem"><a class="link" href="#RT_ST_Value" title="ST_Value">ST_Value</a> - 指定したバンドにおけるcolumnx, rowyで指定したピクセルまたは指定したジオメトリポイントに対応するピクセルの値を返します。 バンド番号は1始まりで、指定しない場合には、1番と仮定します。exclude_nodata_valueがFALSEに設定された場合には、NODATAピクセルを含む全てのピクセルがインタセクトするかが考慮され、値を返します。exclude_nodata_valueを渡さない場合には、ラスタのメタデータから読みます。</li><li class="listitem"><a class="link" href="#RT_ST_ValueCount" title="ST_ValueCount">ST_ValueCount</a> - ラスタ　(またはラスタカバレッジ)の指定されたバンドで、指定した値を持つピクセルを対象として、ピクセルバンド値とピクセル数からなるレコードの集合を返します。バンドを指定しない場合には、1番と仮定します。デフォルトではNODATA値のピクセルは数えられず、ピクセルの他の値は出力され、ピクセルバンド値は最も近い整数に丸められます。</li><li class="listitem"><a class="link" href="#RT_ST_Width" title="ST_Width">ST_Width</a> - ラスタの幅をピクセル単位で返します。</li><li class="listitem"><a class="link" href="#RT_ST_Within" title="ST_Within">ST_Within</a> - rastAがrastBの外部に点を持たず、rastAの内部の少なくとも一つの点がrastBの内部にある場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#RT_ST_WorldToRasterCoord" title="ST_WorldToRasterCoord">ST_WorldToRasterCoord</a> - ラスタの空間参照系による地理座標のX値とY値 (経度と緯度)またはポイントジオメトリに対応するピクセルの左上隅を返します。</li><li class="listitem"><a class="link" href="#RT_ST_WorldToRasterCoordX" title="ST_WorldToRasterCoordX">ST_WorldToRasterCoordX</a> - ラスタの空間参照系に基づくポイントジオメトリ (pt)またはX,Y座標値 (xw,yw)に対応するラスタの列を返します。</li><li class="listitem"><a class="link" href="#RT_ST_WorldToRasterCoordY" title="ST_WorldToRasterCoordY">ST_WorldToRasterCoordY</a> - ラスタの空間参照系に基づくポイントジオメトリ (pt)またはX,Y座標値 (xw,yw)に対応するラスタの行を返します。</li><li class="listitem"><a class="link" href="#RT_UpdateRasterSRID" title="UpdateRasterSRID">UpdateRasterSRID</a> - ユーザが指定したカラムとテーブルにあるラスタの全てについてSRIDを変更します。</li></ul></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="PostGIS_Geometry_DumpFunctions"></a>15.6. PostGISジオメトリ/ジオグラフィ/ラスタのダンプ関数</h2></div></div></div><p>次に示す関数は、<a class="link" href="#geometry_dump" title="geometry_dump">geometry_dump</a>または<a class="link" href="#geomval" title="geomval">geomval</a>データ型の集合または単一データを入力または出力に取るPostGIS関数です。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#RT_ST_DumpAsPolygons" title="ST_DumpAsPolygons">ST_DumpAsPolygons</a> - 指定されたラスタバンドからgeomval (geom,val)行の集合を返します。バンドを指定しない場合のデフォルトは1です。</li><li class="listitem"><a class="link" href="#RT_ST_Intersection" title="ST_Intersection">ST_Intersection</a> - 二つのラスタの共有部分またはベクタ化したラスタとジオメトリとのインタセクトした部分を表現する、ラスタまたはジオメトリとピクセル値の組の集合を返します。</li><li class="listitem"><a class="link" href="#ST_Dump" title="ST_Dump">ST_Dump</a> - ジオメトリの要素ごとのgeometry_dump行の集合を返します。</li><li class="listitem"><a class="link" href="#ST_DumpPoints" title="ST_DumpPoints">ST_DumpPoints</a> - ジオメトリの座標のgeometry_dump行の集合を返します。</li><li class="listitem"><a class="link" href="#ST_DumpRings" title="ST_DumpRings">ST_DumpRings</a> - ポリゴンのリングごとのgeometry_dump行の集合を返します。</li><li class="listitem"><a class="link" href="#ST_DumpSegments" title="ST_DumpSegments">ST_DumpSegments</a> - ジオメトリの辺のgeometry_dump行の集合を返します。</li></ul></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="PostGIS_BoxFunctions"></a>15.7. PostGISボックス関数</h2></div></div></div><p>次に示す関数は、PostGIS空間型のbox系の型を入力または出力に取るPostGIS関数です。ボックス系には<a class="link" href="#box2d_type" title="box2d">box2d</a>と<a class="link" href="#box3d_type" title="box3d">box3d</a>があります。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#RT_Box3D" title="Box3D">Box3D</a> - ラスタを囲むボックスのbox3d表現を返します。</li><li class="listitem"><a class="link" href="#ST_AsMVTGeom" title="ST_AsMVTGeom">ST_AsMVTGeom</a> - ジオメトリをMapbox Vector Tileの座標空間に変換します。</li><li class="listitem"><a class="link" href="#ST_AsTWKB" title="ST_AsTWKB">ST_AsTWKB</a> - TWKB (Tiny Well-Known Binary)としてジオメトリを出力します。</li><li class="listitem"><a class="link" href="#ValidateTopology" title="ValidateTopology">ValidateTopology</a> - トポロジの問題についての詳細を示すvalidatetopology_returntypeの集合を返します。</li><li class="listitem"><a class="link" href="#contains_box2df_box2df" title="~(box2df,box2df)">~(box2df,box2df)</a> - 二つの単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)の一方がもう一方を包含する場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#contains_box2df_geometry" title="~(box2df,geometry)">~(box2df,geometry)</a> - 単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)をジオメトリの (キャッシュされている)2次元バウンディングボックスが包含する場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#contains_geometry_box2df" title="~(geometry,box2df)">~(geometry,box2df)</a> - ジオメトリの (キャッシュされている)2次元バウンディングボックスが単精度浮動小数点数によるn次元バウンディングボックス (GIDX)を包含する場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#is_contained_box2df_box2df" title="@(box2df,box2df)">@(box2df,box2df)</a> - 二つの単精度浮動小数点数によるn次元バウンディングボックス (GIDX)の一方がもう一方を包含する場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#is_contained_box2df_geometry" title="@(box2df,geometry)">@(box2df,geometry)</a> - 単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)がジオメトリの2次元バウンディングボックスに包含される場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#is_contained_geometry_box2df" title="@(geometry,box2df)">@(geometry,box2df)</a> - ジオメトリの2次元バウンディングボックスが単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)に包含される場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#overlaps_box2df_box2df" title="&amp;&amp;(box2df,box2df)">&amp;&amp;(box2df,box2df)</a> - 二つの単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)が相互にインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#overlaps_box2df_geometry" title="&amp;&amp;(box2df,geometry)">&amp;&amp;(box2df,geometry)</a> - 単精度浮動小数点数による2次元バウンディングボックスがジオメトリの (キャッシュされている)2次元バウンディングボックスとインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#overlaps_geometry_box2df" title="&amp;&amp;(geometry,box2df)">&amp;&amp;(geometry,box2df)</a> - ジオメトリの (キャッシュされている)2次元バウンディングボックスが単精度浮動小数点数による2次元バウンディングボックスとインタセクトする場合にTRUEを返します。</li></ul></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="PostGIS_3D_Functions"></a>15.8. 3次元対応PostGIS関数</h2></div></div></div><p>次に示す関数は、Zインデクスを放り出さないPostGIS関数です。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#AddGeometryColumn" title="AddGeometryColumn">AddGeometryColumn</a> - ジオメトリカラムを既存のテーブルに追加します。</li><li class="listitem"><a class="link" href="#DropGeometryColumn" title="DropGeometryColumn">DropGeometryColumn</a> - ジオメトリカラムを空間テーブルから除去します。</li><li class="listitem"><a class="link" href="#GeometryType" title="GeometryType">GeometryType</a> - ジオメトリの型を文字列で返します。</li><li class="listitem"><a class="link" href="#ST_3DArea" title="ST_3DArea">ST_3DArea</a> - 3次元の面ジオメトリの面積を計算します。立体の場合は0を返します。</li><li class="listitem"><a class="link" href="#ST_3DClosestPoint" title="ST_3DClosestPoint">ST_3DClosestPoint</a> - g1上の、g2に最も近い3次元ポイントを返します。これは3次元の最短ラインの始点です。</li><li class="listitem"><a class="link" href="#ST_3DDifference" title="ST_3DDifference">ST_3DDifference</a> - 3次元の差分を計算します。</li><li class="listitem"><a class="link" href="#ST_3DDistance" title="ST_3DDistance">ST_3DDistance</a> - 投影座標系の単位で、二つのジオメトリ間の3次元デカルト距離の最小値を返します (空間参照系に基づきます)。</li><li class="listitem"><a class="link" href="#ST_3DIntersection" title="ST_3DIntersection">ST_3DIntersection</a> - 3次元のインタセクトした (共有する)部分を計算します。</li><li class="listitem"><a class="link" href="#ST_3DLength" title="ST_3DLength">ST_3DLength</a> - 線ジオメトリの3次元長を返します。</li><li class="listitem"><a class="link" href="#ST_3DLongestLine" title="ST_3DLongestLine">ST_3DLongestLine</a> - 二つのジオメトリ間の3次元最長ラインを返します。</li><li class="listitem"><a class="link" href="#ST_3DMaxDistance" title="ST_3DMaxDistance">ST_3DMaxDistance</a> - 二つのジオメトリ間の3次元最大デカルト距離 (空間参照系に基づく)を空間参照系の単位で返します。</li><li class="listitem"><a class="link" href="#ST_3DPerimeter" title="ST_3DPerimeter">ST_3DPerimeter</a> - ポリゴンジオメトリの3次元周長を返します。</li><li class="listitem"><a class="link" href="#ST_3DShortestLine" title="ST_3DShortestLine">ST_3DShortestLine</a> - 二つのジオメトリの3次元の最短ラインを返します。</li><li class="listitem"><a class="link" href="#ST_3DUnion" title="ST_3DUnion">ST_3DUnion</a> - 3次元の結合を計算します。</li><li class="listitem"><a class="link" href="#ST_AddMeasure" title="ST_AddMeasure">ST_AddMeasure</a> - ラインに沿ったM値を補間します。</li><li class="listitem"><a class="link" href="#ST_AddPoint" title="ST_AddPoint">ST_AddPoint</a> - ラインストリングにポイントを追加します。</li><li class="listitem"><a class="link" href="#ST_ApproximateMedialAxis" title="ST_ApproximateMedialAxis">ST_ApproximateMedialAxis</a> - 面ジオメトリの近似的な中心軸を計算します。</li><li class="listitem"><a class="link" href="#ST_AsBinary" title="ST_AsBinary">ST_AsBinary</a> - ジオメトリ/ジオグラフィの、SRIDメタデータを持たないOGC/ISO Well-Knownバイナリ (WKB)表現を返します。</li><li class="listitem"><a class="link" href="#ST_AsEWKB" title="ST_AsEWKB">ST_AsEWKB</a> - ジオメトリの、SRIDメタデータを持つExtended Well-Knownバイナリ (EWKB)表現を返します。</li><li class="listitem"><a class="link" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a> - ジオメトリのSRIDメタデータが付いたWell-Known Text (WKT)表現を返します。</li><li class="listitem"><a class="link" href="#ST_AsGML" title="ST_AsGML">ST_AsGML</a> - GML第2版または第3版としてジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_AsGeoJSON" title="ST_AsGeoJSON">ST_AsGeoJSON</a> - ジオメトリをGeoJSON要素として返します。</li><li class="listitem"><a class="link" href="#ST_AsHEXEWKB" title="ST_AsHEXEWKB">ST_AsHEXEWKB</a> - ジオメトリのHEXEWKB表現を (文字列として)返します。リトルエンディアン (NDR)またはビッグエンディアン (XDR)のどちらかのエンコーディングを使います。</li><li class="listitem"><a class="link" href="#ST_AsKML" title="ST_AsKML">ST_AsKML</a> - KML要素としてジオメトリを返します。いくつかの形式があります。デフォルトはversion=2, maxdecimaldigits=15です。</li><li class="listitem"><a class="link" href="#ST_AsX3D" title="ST_AsX3D">ST_AsX3D</a> - ジオメトリをX3Dノード要素書式　(ISO-IEC-19776-1.2-X3DEncodings-XML)で返します。</li><li class="listitem"><a class="link" href="#ST_Boundary" title="ST_Boundary">ST_Boundary</a> - ジオメトリの境界を返します。</li><li class="listitem"><a class="link" href="#ST_BoundingDiagonal" title="ST_BoundingDiagonal">ST_BoundingDiagonal</a> - ジオメトリのバウンディングボックスの対角線を返します。</li><li class="listitem"><a class="link" href="#ST_Collect" title="ST_Collect">ST_Collect</a> - ジオメトリの集合からジオメトリコレクションまたはマルチ系ジオメトリを生成します。</li><li class="listitem"><a class="link" href="#ST_ConstrainedDelaunayTriangles" title="ST_ConstrainedDelaunayTriangles">ST_ConstrainedDelaunayTriangles</a> - 入力ジオメトリの周りの制約付きドロネー三角形を返します。</li><li class="listitem"><a class="link" href="#ST_ConvexHull" title="ST_ConvexHull">ST_ConvexHull</a> - ジオメトリの凸包を計算します。</li><li class="listitem"><a class="link" href="#ST_CoordDim" title="ST_CoordDim">ST_CoordDim</a> - ジオメトリの座標次元を返します。</li><li class="listitem"><a class="link" href="#ST_CurveToLine" title="ST_CurveToLine">ST_CurveToLine</a> - 曲線を含むジオメトリを線ジオメトリに変換します。</li><li class="listitem"><a class="link" href="#ST_DelaunayTriangles" title="ST_DelaunayTriangles">ST_DelaunayTriangles</a> - ジオメトリの頂点のドローネ三角形を返します。</li><li class="listitem"><a class="link" href="#ST_Dump" title="ST_Dump">ST_Dump</a> - ジオメトリの要素ごとのgeometry_dump行の集合を返します。</li><li class="listitem"><a class="link" href="#ST_DumpPoints" title="ST_DumpPoints">ST_DumpPoints</a> - ジオメトリの座標のgeometry_dump行の集合を返します。</li><li class="listitem"><a class="link" href="#ST_DumpRings" title="ST_DumpRings">ST_DumpRings</a> - ポリゴンのリングごとのgeometry_dump行の集合を返します。</li><li class="listitem"><a class="link" href="#ST_DumpSegments" title="ST_DumpSegments">ST_DumpSegments</a> - ジオメトリの辺のgeometry_dump行の集合を返します。</li><li class="listitem"><a class="link" href="#ST_EndPoint" title="ST_EndPoint">ST_EndPoint</a> - LINESTRINGまたはCIRCULARLINESTRINGの終端のポイントを返します。</li><li class="listitem"><a class="link" href="#ST_ExteriorRing" title="ST_ExteriorRing">ST_ExteriorRing</a> - ポリゴンの外環を表現するラインストリングを返します。</li><li class="listitem"><a class="link" href="#ST_Extrude" title="ST_Extrude">ST_Extrude</a> - 関連するボリュームにサーフェスを押し出します。</li><li class="listitem"><a class="link" href="#ST_FlipCoordinates" title="ST_FlipCoordinates">ST_FlipCoordinates</a> - X値とY値を入れ替えたジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_Force2D" title="ST_Force2D">ST_Force2D</a> - ジオメトリを2次元モードに強制します。</li><li class="listitem"><a class="link" href="#ST_ForceCurve" title="ST_ForceCurve">ST_ForceCurve</a> - 該当する場合は、ジオメトリを曲線タイプに変換します。</li><li class="listitem"><a class="link" href="#ST_ForceLHR" title="ST_ForceLHR">ST_ForceLHR</a> - LHR (Left Hand Rule)方向に強制します。</li><li class="listitem"><a class="link" href="#ST_ForcePolygonCCW" title="ST_ForcePolygonCCW">ST_ForcePolygonCCW</a> - 全ての外環を反時計回りに、全ての内環を時計回りに、それぞれ強制します。</li><li class="listitem"><a class="link" href="#ST_ForcePolygonCW" title="ST_ForcePolygonCW">ST_ForcePolygonCW</a> - 全ての外環を時計回りに、全ての内環を反時計回りに、それぞれ強制します。</li><li class="listitem"><a class="link" href="#ST_ForceRHR" title="ST_ForceRHR">ST_ForceRHR</a> - ポリゴンの頂点の方向を右回りに強制します。</li><li class="listitem"><a class="link" href="#ST_ForceSFS" title="ST_ForceSFS">ST_ForceSFS</a> - SFS 1.1ジオメトリタイプのみ使うようジオメトリに強制します。</li><li class="listitem"><a class="link" href="#ST_Force_3D" title="ST_Force3D">ST_Force_3D</a> - ジオメトリをXYZモードに強制します。これはST_Force3DZの別名です。</li><li class="listitem"><a class="link" href="#ST_Force_3DZ" title="ST_Force3DZ">ST_Force_3DZ</a> - ジオメトリをXYZモードに強制します。</li><li class="listitem"><a class="link" href="#ST_Force_4D" title="ST_Force4D">ST_Force_4D</a> - ジオメトリをXYZMモードに強制します。</li><li class="listitem"><a class="link" href="#ST_Force_Collection" title="ST_ForceCollection">ST_Force_Collection</a> - ジオメトリをジオメトリコレクションに変換します。</li><li class="listitem"><a class="link" href="#ST_GeometricMedian" title="ST_GeometricMedian">ST_GeometricMedian</a> - マルチポイントの幾何学的中央値を返します。</li><li class="listitem"><a class="link" href="#ST_GeometryN" title="ST_GeometryN">ST_GeometryN</a> - ジオメトリコレクションの要素を返します。</li><li class="listitem"><a class="link" href="#ST_GeometryType" title="ST_GeometryType">ST_GeometryType</a> - ジオメトリのSQL-MM型を文字列で返します。</li><li class="listitem"><a class="link" href="#ST_HasArc" title="ST_HasArc">ST_HasArc</a> - ジオメトリに円弧が含まれているかどうかテストします。</li><li class="listitem"><a class="link" href="#ST_InteriorRingN" title="ST_InteriorRingN">ST_InteriorRingN</a> - ポリゴンのN番目の内環 (穴)を返します。</li><li class="listitem"><a class="link" href="#ST_InterpolatePoint" title="ST_InterpolatePoint">ST_InterpolatePoint</a> - ジオメトリのポイントに最も近いポイント上の補間M値を返します。</li><li class="listitem"><a class="link" href="#ST_IsClosed" title="ST_IsClosed">ST_IsClosed</a> - ラインストリングの始点と終点が一致しているかをテストします。多面体サーフェスについては閉じているか (立体であるか)をテストします。</li><li class="listitem"><a class="link" href="#ST_IsCollection" title="ST_IsCollection">ST_IsCollection</a> - ジオメトリのタイプがジオメトリコレクションかをテストします。</li><li class="listitem"><a class="link" href="#ST_IsPlanar" title="ST_IsPlanar">ST_IsPlanar</a> - サーフェスが平面であるかないかをチェックします。</li><li class="listitem"><a class="link" href="#ST_IsPolygonCCW" title="ST_IsPolygonCCW">ST_IsPolygonCCW</a> - ポリゴンが反時計回りの外環を持っていて、時計回りの内環を持っているかをテストします。</li><li class="listitem"><a class="link" href="#ST_IsPolygonCW" title="ST_IsPolygonCW">ST_IsPolygonCW</a> - ポリゴンが時計回りの外環を持っていて、反時計回りの内環を持っているかをテストします。</li><li class="listitem"><a class="link" href="#ST_IsSimple" title="ST_IsSimple">ST_IsSimple</a> - ジオメトリが自己インタセクトまたは自己接触となるポイントが無いかをテストします。</li><li class="listitem"><a class="link" href="#ST_IsSolid" title="ST_IsSolid">ST_IsSolid</a> - ジオメトリが立体であるかどうかをテストします。妥当性チェックは行いません。</li><li class="listitem"><a class="link" href="#ST_Length_Spheroid" title="ST_LengthSpheroid">ST_Length_Spheroid</a> - 回転楕円体面上の経度緯度のジオメトリの2次元または3次元の長さ/周長を返します。</li><li class="listitem"><a class="link" href="#ST_LineFromMultiPoint" title="ST_LineFromMultiPoint">ST_LineFromMultiPoint</a> - マルチポイントジオメトリからラインストリングを生成します。</li><li class="listitem"><a class="link" href="#ST_LineInterpolatePoint" title="ST_LineInterpolatePoint">ST_LineInterpolatePoint</a> - ラインに沿って、割合で示された位置の補間ポイントを返します。</li><li class="listitem"><a class="link" href="#ST_LineInterpolatePoints" title="ST_LineInterpolatePoints">ST_LineInterpolatePoints</a> - ラインに沿って、割合で示された複数の位置の補間ポイントを返します。</li><li class="listitem"><a class="link" href="#ST_LineSubstring" title="ST_LineSubstring">ST_LineSubstring</a> - 二つの割合位置からラインの一部を返します。</li><li class="listitem"><a class="link" href="#ST_LineToCurve" title="ST_LineToCurve">ST_LineToCurve</a> - 曲線を含むジオメトリを線ジオメトリに変換します。</li><li class="listitem"><a class="link" href="#ST_LocateBetweenElevations" title="ST_LocateBetweenElevations">ST_LocateBetweenElevations</a> - 標高 (Z値)範囲にある部分ジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_M" title="ST_M">ST_M</a> - ポイントのM値を返します。</li><li class="listitem"><a class="link" href="#ST_MakeLine" title="ST_MakeLine">ST_MakeLine</a> - POINT、MULTIPOINT、LINESTRINGからLINESTRINGを生成します。</li><li class="listitem"><a class="link" href="#ST_MakePoint" title="ST_MakePoint">ST_MakePoint</a> - 2次元、3次元 (XYZ)、4次元のポイントを生成します。</li><li class="listitem"><a class="link" href="#ST_MakePolygon" title="ST_MakePolygon">ST_MakePolygon</a> - 外殻と穴のリストからポリゴンを生成します。</li><li class="listitem"><a class="link" href="#ST_MakeSolid" title="ST_MakeSolid">ST_MakeSolid</a> - ジオメトリを立体にキャストします。チェックはしません。妥当な立体を得るには、入力ジオメトリは閉じた多面体サーフェスか閉じたTINでなければなりません。</li><li class="listitem"><a class="link" href="#ST_MemSize" title="ST_MemSize">ST_MemSize</a> - ジオメトリが取るメモリ空間の合計を返します。</li><li class="listitem"><a class="link" href="#ST_NDims" title="ST_NDims">ST_NDims</a> - じゅいおめとりの座標次元を返します。</li><li class="listitem"><a class="link" href="#ST_NPoints" title="ST_NPoints">ST_NPoints</a> - ジオメトリのポイント (頂点)の数を返します。</li><li class="listitem"><a class="link" href="#ST_NRings" title="ST_NRings">ST_NRings</a> - ポリゴンジオメトリのリング数を返します。</li><li class="listitem"><a class="link" href="#ST_NumGeometries" title="ST_NumGeometries">ST_NumGeometries</a> - ジオメトリコレクションの要素数を返します。</li><li class="listitem"><a class="link" href="#ST_NumPatches" title="ST_NumPatches">ST_NumPatches</a> - 多面体サーフェスのフェイス数を返します。多面体でないジオメトリの場合にはNULLを返します。</li><li class="listitem"><a class="link" href="#ST_Orientation" title="ST_Orientation">ST_Orientation</a> - サーフェスの方向を判定します。</li><li class="listitem"><a class="link" href="#ST_PatchN" title="ST_PatchN">ST_PatchN</a> - 多面体サーフェスのN番目のジオメトリ (フェイス)を返します。</li><li class="listitem"><a class="link" href="#ST_PointN" title="ST_PointN">ST_PointN</a> - ジオメトリの最初のラインストリングまたは曲線ストリングのN番目のポイントを返します。</li><li class="listitem"><a class="link" href="#ST_PointOnSurface" title="ST_PointOnSurface">ST_PointOnSurface</a> - ポリゴン内またはジオメトリ上にあるのが保証されたポイントを返します。</li><li class="listitem"><a class="link" href="#ST_Points" title="ST_Points">ST_Points</a> - ジオメトリの座標を含むMULTIPOINTを返します。</li><li class="listitem"><a class="link" href="#ST_Polygon" title="ST_Polygon">ST_Polygon</a> - ラインストリングから指定したSRIDを持つポリゴンを生成します。</li><li class="listitem"><a class="link" href="#ST_RemovePoint" title="ST_RemovePoint">ST_RemovePoint</a> - ラインストリングからポイントを削除します。</li><li class="listitem"><a class="link" href="#ST_RemoveRepeatedPoints" title="ST_RemoveRepeatedPoints">ST_RemoveRepeatedPoints</a> - 入力ジオメトリから重複ポイントを除いたものを返します。</li><li class="listitem"><a class="link" href="#ST_Reverse" title="ST_Reverse">ST_Reverse</a> - 頂点の順序を逆にしたジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_Scroll" title="ST_Scroll">ST_Scroll</a> - 閉じたLINESTRINGの開始点を変更する</li><li class="listitem"><a class="link" href="#ST_SetPoint" title="ST_SetPoint">ST_SetPoint</a> - ラインストリングのポイントを与えられたポイントに置き換えます。</li><li class="listitem"><a class="link" href="#ST_Shift_Longitude" title="ST_ShiftLongitude">ST_Shift_Longitude</a> - 経度座標値を-180度から180度の範囲と0度から360度の範囲との二つの範囲を行き来するようシフトします。</li><li class="listitem"><a class="link" href="#ST_SnapToGrid" title="ST_SnapToGrid">ST_SnapToGrid</a> - 入力ジオメトリの全ての点を規則的なグリッドにスナップします。</li><li class="listitem"><a class="link" href="#ST_StartPoint" title="ST_StartPoint">ST_StartPoint</a> - ラインストリングの始点を返します。</li><li class="listitem"><a class="link" href="#ST_StraightSkeleton" title="ST_StraightSkeleton">ST_StraightSkeleton</a> - ジオメトリからストレートスケルトンを計算します。</li><li class="listitem"><a class="link" href="#ST_SwapOrdinates" title="ST_SwapOrdinates">ST_SwapOrdinates</a> - 与えられたジオメトリにおいて与えられた座標の値を入れ替えたジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_Tesselate" title="ST_Tesselate">ST_Tesselate</a> - ポリゴンまたは多面体サーフェスのテッセレーションを計算し、TINまたはTINコレクションを返します。</li><li class="listitem"><a class="link" href="#ST_Volume" title="ST_Volume">ST_Volume</a> - 3次元立体の体積を計算します。面ジオメトリは (閉じていても)0を返します。</li><li class="listitem"><a class="link" href="#ST_WrapX" title="ST_WrapX">ST_WrapX</a> - ジオメトリをX値で回り込ませます。</li><li class="listitem"><a class="link" href="#ST_X" title="ST_X">ST_X</a> - ポイントのX値を返します。</li><li class="listitem"><a class="link" href="#ST_Y" title="ST_Y">ST_Y</a> - ポイントのY値を返します。</li><li class="listitem"><a class="link" href="#ST_Z" title="ST_Z">ST_Z</a> - ポイントのZ値を返します。</li><li class="listitem"><a class="link" href="#ST_Zmflag" title="ST_Zmflag">ST_Zmflag</a> - ジオメトリのZM座標次元を示す符号を返します。</li><li class="listitem"><a class="link" href="#TG_Equals" title="Equals">TG_Equals</a> - 二つのTopoGeometryが同じトポロジプリミティブで成っている場合にtrueを返します。</li><li class="listitem"><a class="link" href="#TG_Intersects" title="Intersects">TG_Intersects</a> - 二つのTopoGeometryからのプリミティブの組がインタセクトする場合にtrueを返します。</li><li class="listitem"><a class="link" href="#UpdateGeometrySRID" title="UpdateGeometrySRID">UpdateGeometrySRID</a> - ジオメトリカラム内の全ての地物のSRIDを更新し、テーブルのメタデータを更新します。</li><li class="listitem"><a class="link" href="#geometry_overlaps_nd" title="&amp;&amp;&amp;">geometry_overlaps_nd</a> - Aのn次元バウンディングボックスがBのn次元バウンディングボックスとインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#overlaps_nd_geometry_gidx" title="&amp;&amp;&amp;(geometry,gidx)">overlaps_nd_geometry_gidx</a> - ジオメトリの (キャッシュされている)n次元バウンディングボックスが単精度浮動小数点数によるn次元バウンディングボックス (GIDX)とインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#overlaps_nd_gidx_geometry" title="&amp;&amp;&amp;(gidx,geometry)">overlaps_nd_gidx_geometry</a> - 単精度浮動小数点数によるn次元バウンディングボックス (GIDX)がジオメトリの (キャッシュされている)n次元バウンディングボックスとインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#overlaps_nd_gidx_gidx" title="&amp;&amp;&amp;(gidx,gidx)">overlaps_nd_gidx_gidx</a> - 二つの単精度浮動小数点数によるn次元バウンディングボックス (GIDX)が相互にインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#postgis_sfcgal_version" title="postgis_sfcgal_version">postgis_sfcgal_version</a> - 使用しているSFCGALの版を返します</li></ul></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="PostGIS_Curved_GeometryFunctions"></a>15.9. PostGIS曲線ジオメトリ対応関数</h2></div></div></div><p>次に示す関数は、CIRCULARSTRING, CURVEDPOLYGON等の曲線ジオメトリ型が使えるPostGIS関数です。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#AddGeometryColumn" title="AddGeometryColumn">AddGeometryColumn</a> - ジオメトリカラムを既存のテーブルに追加します。</li><li class="listitem"><a class="link" href="#DropGeometryColumn" title="DropGeometryColumn">DropGeometryColumn</a> - ジオメトリカラムを空間テーブルから除去します。</li><li class="listitem"><a class="link" href="#GeometryType" title="GeometryType">GeometryType</a> - ジオメトリの型を文字列で返します。</li><li class="listitem"><a class="link" href="#ST_AsBinary" title="ST_AsBinary">ST_AsBinary</a> - ジオメトリ/ジオグラフィの、SRIDメタデータを持たないOGC/ISO Well-Knownバイナリ (WKB)表現を返します。</li><li class="listitem"><a class="link" href="#ST_AsEWKB" title="ST_AsEWKB">ST_AsEWKB</a> - ジオメトリの、SRIDメタデータを持つExtended Well-Knownバイナリ (EWKB)表現を返します。</li><li class="listitem"><a class="link" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a> - ジオメトリのSRIDメタデータが付いたWell-Known Text (WKT)表現を返します。</li><li class="listitem"><a class="link" href="#ST_AsHEXEWKB" title="ST_AsHEXEWKB">ST_AsHEXEWKB</a> - ジオメトリのHEXEWKB表現を (文字列として)返します。リトルエンディアン (NDR)またはビッグエンディアン (XDR)のどちらかのエンコーディングを使います。</li><li class="listitem"><a class="link" href="#ST_AsText" title="ST_AsText">ST_AsText</a> - ジオメトリ/ジオグラフィのSRIDメタデータのないWell-Known Text (WKT)表現を返します。</li><li class="listitem"><a class="link" href="#ST_Collect" title="ST_Collect">ST_Collect</a> - ジオメトリの集合からジオメトリコレクションまたはマルチ系ジオメトリを生成します。</li><li class="listitem"><a class="link" href="#ST_CoordDim" title="ST_CoordDim">ST_CoordDim</a> - ジオメトリの座標次元を返します。</li><li class="listitem"><a class="link" href="#ST_CurveToLine" title="ST_CurveToLine">ST_CurveToLine</a> - 曲線を含むジオメトリを線ジオメトリに変換します。</li><li class="listitem"><a class="link" href="#ST_Distance" title="ST_Distance">ST_Distance</a> - 二つのジオメトリ値またはジオグラフィ値間の距離を返します。</li><li class="listitem"><a class="link" href="#ST_Dump" title="ST_Dump">ST_Dump</a> - ジオメトリの要素ごとのgeometry_dump行の集合を返します。</li><li class="listitem"><a class="link" href="#ST_DumpPoints" title="ST_DumpPoints">ST_DumpPoints</a> - ジオメトリの座標のgeometry_dump行の集合を返します。</li><li class="listitem"><a class="link" href="#ST_EndPoint" title="ST_EndPoint">ST_EndPoint</a> - LINESTRINGまたはCIRCULARLINESTRINGの終端のポイントを返します。</li><li class="listitem"><a class="link" href="#ST_FlipCoordinates" title="ST_FlipCoordinates">ST_FlipCoordinates</a> - X値とY値を入れ替えたジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_Force2D" title="ST_Force2D">ST_Force2D</a> - ジオメトリを2次元モードに強制します。</li><li class="listitem"><a class="link" href="#ST_ForceCurve" title="ST_ForceCurve">ST_ForceCurve</a> - 該当する場合は、ジオメトリを曲線タイプに変換します。</li><li class="listitem"><a class="link" href="#ST_ForceSFS" title="ST_ForceSFS">ST_ForceSFS</a> - SFS 1.1ジオメトリタイプのみ使うようジオメトリに強制します。</li><li class="listitem"><a class="link" href="#ST_Force_3D" title="ST_Force3D">ST_Force3D</a> - ジオメトリをXYZモードに強制します。これはST_Force3DZの別名です。</li><li class="listitem"><a class="link" href="#ST_Force_3DM" title="ST_Force3DM">ST_Force3DM</a> - ジオメトリをXYMモードに強制します。</li><li class="listitem"><a class="link" href="#ST_Force_3DZ" title="ST_Force3DZ">ST_Force3DZ</a> - ジオメトリをXYZモードに強制します。</li><li class="listitem"><a class="link" href="#ST_Force_4D" title="ST_Force4D">ST_Force4D</a> - ジオメトリをXYZMモードに強制します。</li><li class="listitem"><a class="link" href="#ST_Force_Collection" title="ST_ForceCollection">ST_ForceCollection</a> - ジオメトリをジオメトリコレクションに変換します。</li><li class="listitem"><a class="link" href="#ST_GeoHash" title="ST_GeoHash">ST_GeoHash</a> - ジオメトリのGeoHash表現を返します。</li><li class="listitem"><a class="link" href="#ST_GeometryN" title="ST_GeometryN">ST_GeometryN</a> - ジオメトリコレクションの要素を返します。</li><li class="listitem"><a class="link" href="#ST_Geometry_EQ" title="=">=</a> - ジオメトリ/ジオグラフィ Aの座標と座標の並び順がジオメトリ/ジオグラフィ Bと同じ場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#ST_Geometry_Overbelow" title="&amp;&lt;|">&amp;&lt;|</a> - AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの下にある場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#ST_HasArc" title="ST_HasArc">ST_HasArc</a> - ジオメトリに円弧が含まれているかどうかテストします。</li><li class="listitem"><a class="link" href="#ST_IsClosed" title="ST_IsClosed">ST_IsClosed</a> - ラインストリングの始点と終点が一致しているかをテストします。多面体サーフェスについては閉じているか (立体であるか)をテストします。</li><li class="listitem"><a class="link" href="#ST_IsCollection" title="ST_IsCollection">ST_IsCollection</a> - ジオメトリのタイプがジオメトリコレクションかをテストします。</li><li class="listitem"><a class="link" href="#ST_IsEmpty" title="ST_IsEmpty">ST_IsEmpty</a> - ジオメトリが空かをテストします。</li><li class="listitem"><a class="link" href="#ST_LineToCurve" title="ST_LineToCurve">ST_LineToCurve</a> - 曲線を含むジオメトリを線ジオメトリに変換します。</li><li class="listitem"><a class="link" href="#ST_MemSize" title="ST_MemSize">ST_MemSize</a> - ジオメトリが取るメモリ空間の合計を返します。</li><li class="listitem"><a class="link" href="#ST_NPoints" title="ST_NPoints">ST_NPoints</a> - ジオメトリのポイント (頂点)の数を返します。</li><li class="listitem"><a class="link" href="#ST_NRings" title="ST_NRings">ST_NRings</a> - ポリゴンジオメトリのリング数を返します。</li><li class="listitem"><a class="link" href="#ST_PointN" title="ST_PointN">ST_PointN</a> - ジオメトリの最初のラインストリングまたは曲線ストリングのN番目のポイントを返します。</li><li class="listitem"><a class="link" href="#ST_Points" title="ST_Points">ST_Points</a> - ジオメトリの座標を含むMULTIPOINTを返します。</li><li class="listitem"><a class="link" href="#ST_StartPoint" title="ST_StartPoint">ST_StartPoint</a> - ラインストリングの始点を返します。</li><li class="listitem"><a class="link" href="#ST_Summary" title="ST_Summary">ST_Summary</a> - ジオメトリの中身の概要を文字列で返します。</li><li class="listitem"><a class="link" href="#ST_SwapOrdinates" title="ST_SwapOrdinates">ST_SwapOrdinates</a> - 与えられたジオメトリにおいて与えられた座標の値を入れ替えたジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_Zmflag" title="ST_Zmflag">ST_Zmflag</a> - ジオメトリのZM座標次元を示す符号を返します。</li><li class="listitem"><a class="link" href="#UpdateGeometrySRID" title="UpdateGeometrySRID">UpdateGeometrySRID</a> - ジオメトリカラム内の全ての地物のSRIDを更新し、テーブルのメタデータを更新します。</li><li class="listitem"><a class="link" href="#contains_box2df_box2df" title="~(box2df,box2df)">~(box2df,box2df)</a> - 二つの単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)の一方がもう一方を包含する場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#contains_box2df_geometry" title="~(box2df,geometry)">~(box2df,geometry)</a> - 単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)をジオメトリの (キャッシュされている)2次元バウンディングボックスが包含する場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#contains_geometry_box2df" title="~(geometry,box2df)">~(geometry,box2df)</a> - ジオメトリの (キャッシュされている)2次元バウンディングボックスが単精度浮動小数点数によるn次元バウンディングボックス (GIDX)を包含する場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#geometry_overlaps" title="&amp;&amp;">&amp;&amp;</a> - Aの2次元バウンディングボックスがBの2次元バウンディングボックスとインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#geometry_overlaps_nd" title="&amp;&amp;&amp;">&amp;&amp;&amp;</a> - Aのn次元バウンディングボックスがBのn次元バウンディングボックスとインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#is_contained_box2df_box2df" title="@(box2df,box2df)">@(box2df,box2df)</a> - 二つの単精度浮動小数点数によるn次元バウンディングボックス (GIDX)の一方がもう一方を包含する場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#is_contained_box2df_geometry" title="@(box2df,geometry)">@(box2df,geometry)</a> - 単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)がジオメトリの2次元バウンディングボックスに包含される場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#is_contained_geometry_box2df" title="@(geometry,box2df)">@(geometry,box2df)</a> - ジオメトリの2次元バウンディングボックスが単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)に包含される場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#overlaps_box2df_box2df" title="&amp;&amp;(box2df,box2df)">&amp;&amp;(box2df,box2df)</a> - 二つの単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)が相互にインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#overlaps_box2df_geometry" title="&amp;&amp;(box2df,geometry)">&amp;&amp;(box2df,geometry)</a> - 単精度浮動小数点数による2次元バウンディングボックスがジオメトリの (キャッシュされている)2次元バウンディングボックスとインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#overlaps_geometry_box2df" title="&amp;&amp;(geometry,box2df)">&amp;&amp;(geometry,box2df)</a> - ジオメトリの (キャッシュされている)2次元バウンディングボックスが単精度浮動小数点数による2次元バウンディングボックスとインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#overlaps_nd_geometry_gidx" title="&amp;&amp;&amp;(geometry,gidx)">&amp;&amp;&amp;(geometry,gidx)</a> - ジオメトリの (キャッシュされている)n次元バウンディングボックスが単精度浮動小数点数によるn次元バウンディングボックス (GIDX)とインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#overlaps_nd_gidx_geometry" title="&amp;&amp;&amp;(gidx,geometry)">&amp;&amp;&amp;(gidx,geometry)</a> - 単精度浮動小数点数によるn次元バウンディングボックス (GIDX)がジオメトリの (キャッシュされている)n次元バウンディングボックスとインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#overlaps_nd_gidx_gidx" title="&amp;&amp;&amp;(gidx,gidx)">&amp;&amp;&amp;(gidx,gidx)</a> - 二つの単精度浮動小数点数によるn次元バウンディングボックス (GIDX)が相互にインタセクトする場合にTRUEを返します。</li></ul></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="PostGIS_PS_GeometryFunctions"></a>15.10. PostGIS多面体サーフェス対応関数</h2></div></div></div><p>次に示す関数は、POLYHEDRALSURFACE, POLYHEDRALSURFACEMジオメトリが使えるPostGIS関数です。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#GeometryType" title="GeometryType">GeometryType</a> - ジオメトリの型を文字列で返します。</li><li class="listitem"><a class="link" href="#ST_3DArea" title="ST_3DArea">ST_3DArea</a> - 3次元の面ジオメトリの面積を計算します。立体の場合は0を返します。</li><li class="listitem"><a class="link" href="#ST_3DClosestPoint" title="ST_3DClosestPoint">ST_3DClosestPoint</a> - g1上の、g2に最も近い3次元ポイントを返します。これは3次元の最短ラインの始点です。</li><li class="listitem"><a class="link" href="#ST_3DDifference" title="ST_3DDifference">ST_3DDifference</a> - 3次元の差分を計算します。</li><li class="listitem"><a class="link" href="#ST_3DDistance" title="ST_3DDistance">ST_3DDistance</a> - 投影座標系の単位で、二つのジオメトリ間の3次元デカルト距離の最小値を返します (空間参照系に基づきます)。</li><li class="listitem"><a class="link" href="#ST_3DIntersection" title="ST_3DIntersection">ST_3DIntersection</a> - 3次元のインタセクトした (共有する)部分を計算します。</li><li class="listitem"><a class="link" href="#ST_3DLongestLine" title="ST_3DLongestLine">ST_3DLongestLine</a> - 二つのジオメトリ間の3次元最長ラインを返します。</li><li class="listitem"><a class="link" href="#ST_3DMaxDistance" title="ST_3DMaxDistance">ST_3DMaxDistance</a> - 二つのジオメトリ間の3次元最大デカルト距離 (空間参照系に基づく)を空間参照系の単位で返します。</li><li class="listitem"><a class="link" href="#ST_3DShortestLine" title="ST_3DShortestLine">ST_3DShortestLine</a> - 二つのジオメトリの3次元の最短ラインを返します。</li><li class="listitem"><a class="link" href="#ST_3DUnion" title="ST_3DUnion">ST_3DUnion</a> - 3次元の結合を計算します。</li><li class="listitem"><a class="link" href="#ST_ApproximateMedialAxis" title="ST_ApproximateMedialAxis">ST_ApproximateMedialAxis</a> - 面ジオメトリの近似的な中心軸を計算します。</li><li class="listitem"><a class="link" href="#ST_Area" title="ST_Area">ST_Area</a> - ポリゴンジオメトリの面積を返します。</li><li class="listitem"><a class="link" href="#ST_AsBinary" title="ST_AsBinary">ST_AsBinary</a> - ジオメトリ/ジオグラフィの、SRIDメタデータを持たないOGC/ISO Well-Knownバイナリ (WKB)表現を返します。</li><li class="listitem"><a class="link" href="#ST_AsEWKB" title="ST_AsEWKB">ST_AsEWKB</a> - ジオメトリの、SRIDメタデータを持つExtended Well-Knownバイナリ (EWKB)表現を返します。</li><li class="listitem"><a class="link" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a> - ジオメトリのSRIDメタデータが付いたWell-Known Text (WKT)表現を返します。</li><li class="listitem"><a class="link" href="#ST_AsGML" title="ST_AsGML">ST_AsGML</a> - GML第2版または第3版としてジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_AsX3D" title="ST_AsX3D">ST_AsX3D</a> - ジオメトリをX3Dノード要素書式　(ISO-IEC-19776-1.2-X3DEncodings-XML)で返します。</li><li class="listitem"><a class="link" href="#ST_CoordDim" title="ST_CoordDim">ST_CoordDim</a> - ジオメトリの座標次元を返します。</li><li class="listitem"><a class="link" href="#ST_Dimension" title="ST_Dimension">ST_Dimension</a> - ジオメトリのトポロジ次元を返します。</li><li class="listitem"><a class="link" href="#ST_Dump" title="ST_Dump">ST_Dump</a> - ジオメトリの要素ごとのgeometry_dump行の集合を返します。</li><li class="listitem"><a class="link" href="#ST_DumpPoints" title="ST_DumpPoints">ST_DumpPoints</a> - ジオメトリの座標のgeometry_dump行の集合を返します。</li><li class="listitem"><a class="link" href="#ST_Extrude" title="ST_Extrude">ST_Extrude</a> - 関連するボリュームにサーフェスを押し出します。</li><li class="listitem"><a class="link" href="#ST_FlipCoordinates" title="ST_FlipCoordinates">ST_FlipCoordinates</a> - X値とY値を入れ替えたジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_Force2D" title="ST_Force2D">ST_Force2D</a> - ジオメトリを2次元モードに強制します。</li><li class="listitem"><a class="link" href="#ST_ForceLHR" title="ST_ForceLHR">ST_ForceLHR</a> - LHR (Left Hand Rule)方向に強制します。</li><li class="listitem"><a class="link" href="#ST_ForceRHR" title="ST_ForceRHR">ST_ForceRHR</a> - ポリゴンの頂点の方向を右回りに強制します。</li><li class="listitem"><a class="link" href="#ST_ForceSFS" title="ST_ForceSFS">ST_ForceSFS</a> - SFS 1.1ジオメトリタイプのみ使うようジオメトリに強制します。</li><li class="listitem"><a class="link" href="#ST_Force_3D" title="ST_Force3D">ST_Force3D</a> - ジオメトリをXYZモードに強制します。これはST_Force3DZの別名です。</li><li class="listitem"><a class="link" href="#ST_Force_3DZ" title="ST_Force3DZ">ST_Force3DZ</a> - ジオメトリをXYZモードに強制します。</li><li class="listitem"><a class="link" href="#ST_Force_Collection" title="ST_ForceCollection">ST_ForceCollection</a> - ジオメトリをジオメトリコレクションに変換します。</li><li class="listitem"><a class="link" href="#ST_GeometryN" title="ST_GeometryN">ST_GeometryN</a> - ジオメトリコレクションの要素を返します。</li><li class="listitem"><a class="link" href="#ST_GeometryType" title="ST_GeometryType">ST_GeometryType</a> - ジオメトリのSQL-MM型を文字列で返します。</li><li class="listitem"><a class="link" href="#ST_Geometry_EQ" title="=">=</a> - ジオメトリ/ジオグラフィ Aの座標と座標の並び順がジオメトリ/ジオグラフィ Bと同じ場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#ST_Geometry_Overbelow" title="&amp;&lt;|">&amp;&lt;|</a> - AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの下にある場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#ST_Geometry_Same" title="~=">~=</a> - AのバウンディングボックスがBのバウンディングボックスと同じ場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#ST_IsClosed" title="ST_IsClosed">ST_IsClosed</a> - ラインストリングの始点と終点が一致しているかをテストします。多面体サーフェスについては閉じているか (立体であるか)をテストします。</li><li class="listitem"><a class="link" href="#ST_IsPlanar" title="ST_IsPlanar">ST_IsPlanar</a> - サーフェスが平面であるかないかをチェックします。</li><li class="listitem"><a class="link" href="#ST_IsSolid" title="ST_IsSolid">ST_IsSolid</a> - ジオメトリが立体であるかどうかをテストします。妥当性チェックは行いません。</li><li class="listitem"><a class="link" href="#ST_MakeSolid" title="ST_MakeSolid">ST_MakeSolid</a> - ジオメトリを立体にキャストします。チェックはしません。妥当な立体を得るには、入力ジオメトリは閉じた多面体サーフェスか閉じたTINでなければなりません。</li><li class="listitem"><a class="link" href="#ST_MemSize" title="ST_MemSize">ST_MemSize</a> - ジオメトリが取るメモリ空間の合計を返します。</li><li class="listitem"><a class="link" href="#ST_NPoints" title="ST_NPoints">ST_NPoints</a> - ジオメトリのポイント (頂点)の数を返します。</li><li class="listitem"><a class="link" href="#ST_NumGeometries" title="ST_NumGeometries">ST_NumGeometries</a> - ジオメトリコレクションの要素数を返します。</li><li class="listitem"><a class="link" href="#ST_NumPatches" title="ST_NumPatches">ST_NumPatches</a> - 多面体サーフェスのフェイス数を返します。多面体でないジオメトリの場合にはNULLを返します。</li><li class="listitem"><a class="link" href="#ST_PatchN" title="ST_PatchN">ST_PatchN</a> - 多面体サーフェスのN番目のジオメトリ (フェイス)を返します。</li><li class="listitem"><a class="link" href="#ST_RemoveRepeatedPoints" title="ST_RemoveRepeatedPoints">ST_RemoveRepeatedPoints</a> - 入力ジオメトリから重複ポイントを除いたものを返します。</li><li class="listitem"><a class="link" href="#ST_Reverse" title="ST_Reverse">ST_Reverse</a> - 頂点の順序を逆にしたジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_Shift_Longitude" title="ST_ShiftLongitude">ST_ShiftLongitude</a> - 経度座標値を-180度から180度の範囲と0度から360度の範囲との二つの範囲を行き来するようシフトします。</li><li class="listitem"><a class="link" href="#ST_StraightSkeleton" title="ST_StraightSkeleton">ST_StraightSkeleton</a> - ジオメトリからストレートスケルトンを計算します。</li><li class="listitem"><a class="link" href="#ST_Summary" title="ST_Summary">ST_Summary</a> - ジオメトリの中身の概要を文字列で返します。</li><li class="listitem"><a class="link" href="#ST_SwapOrdinates" title="ST_SwapOrdinates">ST_SwapOrdinates</a> - 与えられたジオメトリにおいて与えられた座標の値を入れ替えたジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_Tesselate" title="ST_Tesselate">ST_Tesselate</a> - ポリゴンまたは多面体サーフェスのテッセレーションを計算し、TINまたはTINコレクションを返します。</li><li class="listitem"><a class="link" href="#ST_Volume" title="ST_Volume">ST_Volume</a> - 3次元立体の体積を計算します。面ジオメトリは (閉じていても)0を返します。</li><li class="listitem"><a class="link" href="#contains_box2df_box2df" title="~(box2df,box2df)">~(box2df,box2df)</a> - 二つの単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)の一方がもう一方を包含する場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#contains_box2df_geometry" title="~(box2df,geometry)">~(box2df,geometry)</a> - 単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)をジオメトリの (キャッシュされている)2次元バウンディングボックスが包含する場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#contains_geometry_box2df" title="~(geometry,box2df)">~(geometry,box2df)</a> - ジオメトリの (キャッシュされている)2次元バウンディングボックスが単精度浮動小数点数によるn次元バウンディングボックス (GIDX)を包含する場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#geometry_overlaps" title="&amp;&amp;">&amp;&amp;</a> - Aの2次元バウンディングボックスがBの2次元バウンディングボックスとインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#geometry_overlaps_nd" title="&amp;&amp;&amp;">&amp;&amp;&amp;</a> - Aのn次元バウンディングボックスがBのn次元バウンディングボックスとインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#is_contained_box2df_box2df" title="@(box2df,box2df)">@(box2df,box2df)</a> - 二つの単精度浮動小数点数によるn次元バウンディングボックス (GIDX)の一方がもう一方を包含する場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#is_contained_box2df_geometry" title="@(box2df,geometry)">@(box2df,geometry)</a> - 単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)がジオメトリの2次元バウンディングボックスに包含される場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#is_contained_geometry_box2df" title="@(geometry,box2df)">@(geometry,box2df)</a> - ジオメトリの2次元バウンディングボックスが単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)に包含される場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#overlaps_box2df_box2df" title="&amp;&amp;(box2df,box2df)">&amp;&amp;(box2df,box2df)</a> - 二つの単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)が相互にインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#overlaps_box2df_geometry" title="&amp;&amp;(box2df,geometry)">&amp;&amp;(box2df,geometry)</a> - 単精度浮動小数点数による2次元バウンディングボックスがジオメトリの (キャッシュされている)2次元バウンディングボックスとインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#overlaps_geometry_box2df" title="&amp;&amp;(geometry,box2df)">&amp;&amp;(geometry,box2df)</a> - ジオメトリの (キャッシュされている)2次元バウンディングボックスが単精度浮動小数点数による2次元バウンディングボックスとインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#overlaps_nd_geometry_gidx" title="&amp;&amp;&amp;(geometry,gidx)">&amp;&amp;&amp;(geometry,gidx)</a> - ジオメトリの (キャッシュされている)n次元バウンディングボックスが単精度浮動小数点数によるn次元バウンディングボックス (GIDX)とインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#overlaps_nd_gidx_geometry" title="&amp;&amp;&amp;(gidx,geometry)">&amp;&amp;&amp;(gidx,geometry)</a> - 単精度浮動小数点数によるn次元バウンディングボックス (GIDX)がジオメトリの (キャッシュされている)n次元バウンディングボックスとインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#overlaps_nd_gidx_gidx" title="&amp;&amp;&amp;(gidx,gidx)">&amp;&amp;&amp;(gidx,gidx)</a> - 二つの単精度浮動小数点数によるn次元バウンディングボックス (GIDX)が相互にインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#postgis_sfcgal_version" title="postgis_sfcgal_version">postgis_sfcgal_version</a> - 使用しているSFCGALの版を返します</li></ul></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="PostGIS_TypeFunctionMatrix"></a>15.11. PostGIS関数対応マトリクス</h2></div></div></div><p>次に示す表は、アルファベット順に並べたPostGIS空間関数と、動作する空間タイプの種類、対応しようとしているOGC/SQL準拠を示しています。</p><p>
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span> は、ネイティブで、その型と派生型とに対応しています。</li><li class="listitem"><span class="inlinemediaobject"><img src="images/matrix_transform.png"></span> は、動作しますが、ジオメトリにキャストして「最善のSRID」に投影変換したうえでジオグラフィに戻す、組み込み変換キャストを使います。大きな面積の領域や、極にある領域については、予期しない結果になることがありますし、浮動小数点数のごみを蓄積することがあります。</li><li class="listitem"><span class="inlinemediaobject"><img src="images/matrix_autocast.png"></span> は、直接的な対応でなくbox3dへの変換といった他からの自動キャストで動作します。</li><li class="listitem"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span> は、PostGISをSFCGAL対応でコンパイルした場合にのみ利用可能な関数です。</li><li class="listitem"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_enhanced.png"></span> は、PostGISをSFCGAL対応でコンパイルした場合には、SFCGALが提供し、その他の場合には、GEOSまたは組み込み関数で対応します。</li><li class="listitem">geom - 基本的な2次元ジオメトリ (x,y)に対応しています。</li><li class="listitem">geog - 基本的な2次元ジオグラフィ (x,y)に対応しています。</li><li class="listitem">2.5D - 3次元/4次元 (ZまたはM座標を持つ)空間内の基本的な2次元ジオメトリに対応しています。</li><li class="listitem">PS - 多面体サーフェス (Polyhedral Surface)に対応しています。</li><li class="listitem">T - 三角形と不規則三角網 (TIN)に対応しています。</li></ul></div><p>
    </p><p>
      </p><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col align="left" class="function"><col align="center" class="geometry"><col align="center" class="geography"><col align="center" class="25D"><col align="center" class="Curves"><col align="center" class="SQLMM"><col align="center" class="PS"><col align="center" class="T"></colgroup><thead><tr><th style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">関数</th><th style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center">geom</th><th style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center">geog</th><th style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center">2.5D</th><th style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center">Curves</th><th style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center">SQL MM</th><th style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center">PS</th><th style="border-bottom: 1px solid ; " align="center">T</th></tr></thead><tbody><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#GeometryType" title="GeometryType">GeometryType</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_3DArea" title="ST_3DArea">ST_3DArea</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td style="border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_3DClosestPoint" title="ST_3DClosestPoint">ST_3DClosestPoint</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_3DDifference" title="ST_3DDifference">ST_3DDifference</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td style="border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_3DDistance" title="ST_3DDistance">ST_3DDistance</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_3DIntersection" title="ST_3DIntersection">ST_3DIntersection</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td style="border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_3DLength" title="ST_3DLength">ST_3DLength</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_3DLineInterpolatePoint" title="ST_3DLineInterpolatePoint">ST_3DLineInterpolatePoint</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_3DLongestLine" title="ST_3DLongestLine">ST_3DLongestLine</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_3DMaxDistance" title="ST_3DMaxDistance">ST_3DMaxDistance</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_3DPerimeter" title="ST_3DPerimeter">ST_3DPerimeter</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_3DShortestLine" title="ST_3DShortestLine">ST_3DShortestLine</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_3DUnion" title="ST_3DUnion">ST_3DUnion</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td style="border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_AddMeasure" title="ST_AddMeasure">ST_AddMeasure</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_AddPoint" title="ST_AddPoint">ST_AddPoint</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_Angle" title="ST_Angle">ST_Angle</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_ApproximateMedialAxis" title="ST_ApproximateMedialAxis">ST_ApproximateMedialAxis</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td style="border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_Area" title="ST_Area">ST_Area</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_Azimuth" title="ST_Azimuth">ST_Azimuth</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_Boundary" title="ST_Boundary">ST_Boundary</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_BoundingDiagonal" title="ST_BoundingDiagonal">ST_BoundingDiagonal</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_Buffer" title="ST_Buffer">ST_Buffer</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_BuildArea" title="ST_BuildArea">ST_BuildArea</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_Centroid" title="ST_Centroid">ST_Centroid</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_ChaikinSmoothing" title="ST_ChaikinSmoothing">ST_ChaikinSmoothing</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_ClosestPoint" title="ST_ClosestPoint">ST_ClosestPoint</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_Collect" title="ST_Collect">ST_Collect</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_CollectionExtract" title="ST_CollectionExtract">ST_CollectionExtract</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_CollectionHomogenize" title="ST_CollectionHomogenize">ST_CollectionHomogenize</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_ConcaveHull" title="ST_ConcaveHull">ST_ConcaveHull</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_ConstrainedDelaunayTriangles" title="ST_ConstrainedDelaunayTriangles">ST_ConstrainedDelaunayTriangles</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_ConvexHull" title="ST_ConvexHull">ST_ConvexHull</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_CoordDim" title="ST_CoordDim">ST_CoordDim</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_CurveToLine" title="ST_CurveToLine">ST_CurveToLine</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_DelaunayTriangles" title="ST_DelaunayTriangles">ST_DelaunayTriangles</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_Dimension" title="ST_Dimension">ST_Dimension</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_Distance" title="ST_Distance">ST_Distance</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_DistanceSphere" title="ST_DistanceSphere">ST_DistanceSphere</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_Distance_Spheroid" title="ST_DistanceSpheroid">ST_DistanceSpheroid</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_Dump" title="ST_Dump">ST_Dump</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_DumpPoints" title="ST_DumpPoints">ST_DumpPoints</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_DumpRings" title="ST_DumpRings">ST_DumpRings</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_DumpSegments" title="ST_DumpSegments">ST_DumpSegments</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_EndPoint" title="ST_EndPoint">ST_EndPoint</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_Envelope" title="ST_Envelope">ST_Envelope</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_ExteriorRing" title="ST_ExteriorRing">ST_ExteriorRing</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_Extrude" title="ST_Extrude">ST_Extrude</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td style="border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_FilterByM" title="ST_FilterByM">ST_FilterByM</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_FlipCoordinates" title="ST_FlipCoordinates">ST_FlipCoordinates</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_Force2D" title="ST_Force2D">ST_Force2D</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_ForceCurve" title="ST_ForceCurve">ST_ForceCurve</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_ForceLHR" title="ST_ForceLHR">ST_ForceLHR</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td style="border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_ForcePolygonCCW" title="ST_ForcePolygonCCW">ST_ForcePolygonCCW </a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_ForcePolygonCW" title="ST_ForcePolygonCW">ST_ForcePolygonCW </a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_ForceRHR" title="ST_ForceRHR">ST_ForceRHR</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_ForceSFS" title="ST_ForceSFS">ST_ForceSFS</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_Force_3D" title="ST_Force3D">ST_Force3D</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_Force_3DM" title="ST_Force3DM">ST_Force3DM</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_Force_3DZ" title="ST_Force3DZ">ST_Force3DZ</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_Force_4D" title="ST_Force4D">ST_Force4D</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_Force_Collection" title="ST_ForceCollection">ST_ForceCollection</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_FrechetDistance" title="ST_FrechetDistance">ST_FrechetDistance</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_GeneratePoints" title="ST_GeneratePoints">ST_GeneratePoints</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_GeometricMedian" title="ST_GeometricMedian">ST_GeometricMedian </a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_GeometryN" title="ST_GeometryN">ST_GeometryN</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_GeometryType" title="ST_GeometryType">ST_GeometryType</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_HasArc" title="ST_HasArc">ST_HasArc</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_HausdorffDistance" title="ST_HausdorffDistance">ST_HausdorffDistance</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_Hexagon" title="ST_Hexagon">ST_Hexagon</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_HexagonGrid" title="ST_HexagonGrid">ST_HexagonGrid</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_InteriorRingN" title="ST_InteriorRingN">ST_InteriorRingN</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_InterpolatePoint" title="ST_InterpolatePoint">ST_InterpolatePoint</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_IsClosed" title="ST_IsClosed">ST_IsClosed</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_IsCollection" title="ST_IsCollection">ST_IsCollection</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_IsEmpty" title="ST_IsEmpty">ST_IsEmpty</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_IsPlanar" title="ST_IsPlanar">ST_IsPlanar</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td style="border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_IsPolygonCCW" title="ST_IsPolygonCCW">ST_IsPolygonCCW </a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_IsPolygonCW" title="ST_IsPolygonCW">ST_IsPolygonCW </a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_IsRing" title="ST_IsRing">ST_IsRing</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_IsSimple" title="ST_IsSimple">ST_IsSimple</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_IsSolid" title="ST_IsSolid">ST_IsSolid</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td style="border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_Length" title="ST_Length">ST_Length</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_enhanced.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_Length2D" title="ST_Length2D">ST_Length2D</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_Length_Spheroid" title="ST_LengthSpheroid">ST_LengthSpheroid</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_LineFromMultiPoint" title="ST_LineFromMultiPoint">ST_LineFromMultiPoint</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_LineInterpolatePoint" title="ST_LineInterpolatePoint">ST_LineInterpolatePoint</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_LineInterpolatePoints" title="ST_LineInterpolatePoints">ST_LineInterpolatePoints</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_LineLocatePoint" title="ST_LineLocatePoint">ST_LineLocatePoint</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_LineMerge" title="ST_LineMerge">ST_LineMerge</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_LineSubstring" title="ST_LineSubstring">ST_LineSubstring</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_LineToCurve" title="ST_LineToCurve">ST_LineToCurve</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_LocateAlong" title="ST_LocateAlong">ST_LocateAlong</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_LocateBetween" title="ST_LocateBetween">ST_LocateBetween</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_LocateBetweenElevations" title="ST_LocateBetweenElevations">ST_LocateBetweenElevations</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_LongestLine" title="ST_LongestLine">ST_LongestLine</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_M" title="ST_M">ST_M</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_MakeEnvelope" title="ST_MakeEnvelope">ST_MakeEnvelope</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_MakeLine" title="ST_MakeLine">ST_MakeLine</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_MakePoint" title="ST_MakePoint">ST_MakePoint</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_MakePointM" title="ST_MakePointM">ST_MakePointM</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_MakePolygon" title="ST_MakePolygon">ST_MakePolygon</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_MakeSolid" title="ST_MakeSolid">ST_MakeSolid</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td style="border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_MaxDistance" title="ST_MaxDistance">ST_MaxDistance</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_MaximumInscribedCircle" title="ST_MaximumInscribedCircle">ST_MaximumInscribedCircle</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_MemSize" title="ST_MemSize">ST_MemSize</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_MinimumBoundingCircle" title="ST_MinimumBoundingCircle">ST_MinimumBoundingCircle</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_MinimumBoundingRadius" title="ST_MinimumBoundingRadius">ST_MinimumBoundingRadius</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_MinimumClearance" title="ST_MinimumClearance">ST_MinimumClearance</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_MinimumClearanceLine" title="ST_MinimumClearanceLine">ST_MinimumClearanceLine</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_MinkowskiSum" title="ST_MinkowskiSum">ST_MinkowskiSum</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_Multi" title="ST_Multi">ST_Multi</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_NDims" title="ST_NDims">ST_NDims</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_NPoints" title="ST_NPoints">ST_NPoints</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_NRings" title="ST_NRings">ST_NRings</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_Normalize" title="ST_Normalize">ST_Normalize</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_NumGeometries" title="ST_NumGeometries">ST_NumGeometries</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_NumInteriorRing" title="ST_NumInteriorRing">ST_NumInteriorRing</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_NumInteriorRings" title="ST_NumInteriorRings">ST_NumInteriorRings</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_NumPatches" title="ST_NumPatches">ST_NumPatches</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_NumPoints" title="ST_NumPoints">ST_NumPoints</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_OffsetCurve" title="ST_OffsetCurve">ST_OffsetCurve</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_Orientation" title="ST_Orientation">ST_Orientation</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_OrientedEnvelope" title="ST_OrientedEnvelope">ST_OrientedEnvelope</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_PatchN" title="ST_PatchN">ST_PatchN</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_Perimeter" title="ST_Perimeter">ST_Perimeter</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_Perimeter2D" title="ST_Perimeter2D">ST_Perimeter2D</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_Point" title="ST_Point">ST_Point</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_PointM" title="ST_PointM">ST_PointM</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_PointN" title="ST_PointN">ST_PointN</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_PointOnSurface" title="ST_PointOnSurface">ST_PointOnSurface</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_PointZ" title="ST_PointZ">ST_PointZ</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_PointZM" title="ST_PointZM">ST_PointZM</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_Points" title="ST_Points">ST_Points</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_Polygon" title="ST_Polygon">ST_Polygon</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_Polygonize" title="ST_Polygonize">ST_Polygonize</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_Project" title="ST_Project">ST_Project</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_QuantizeCoordinates" title="ST_QuantizeCoordinates">ST_QuantizeCoordinates </a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_ReducePrecision" title="ST_ReducePrecision">ST_ReducePrecision</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_RemovePoint" title="ST_RemovePoint">ST_RemovePoint</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_RemoveRepeatedPoints" title="ST_RemoveRepeatedPoints">ST_RemoveRepeatedPoints</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_Reverse" title="ST_Reverse">ST_Reverse</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_Scroll" title="ST_Scroll">ST_Scroll</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_Segmentize" title="ST_Segmentize">ST_Segmentize</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_SetEffectiveArea" title="ST_SetEffectiveArea">ST_SetEffectiveArea</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_SetPoint" title="ST_SetPoint">ST_SetPoint</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_SharedPaths" title="ST_SharedPaths">ST_SharedPaths</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_Shift_Longitude" title="ST_ShiftLongitude">ST_ShiftLongitude</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_ShortestLine" title="ST_ShortestLine">ST_ShortestLine</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_Simplify" title="ST_Simplify">ST_Simplify</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_SimplifyPreserveTopology" title="ST_SimplifyPreserveTopology">ST_SimplifyPreserveTopology</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_SimplifyVW" title="ST_SimplifyVW">ST_SimplifyVW</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_Snap" title="ST_Snap">ST_Snap</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_SnapToGrid" title="ST_SnapToGrid">ST_SnapToGrid</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_Square" title="ST_Square">ST_Square</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_SquareGrid" title="ST_SquareGrid">ST_SquareGrid</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_StartPoint" title="ST_StartPoint">ST_StartPoint</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_StraightSkeleton" title="ST_StraightSkeleton">ST_StraightSkeleton</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td style="border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_Summary" title="ST_Summary">ST_Summary</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_SwapOrdinates" title="ST_SwapOrdinates">ST_SwapOrdinates</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_Tesselate" title="ST_Tesselate">ST_Tesselate</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td style="border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_TileEnvelope" title="ST_TileEnvelope">ST_TileEnvelope</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_Volume" title="ST_Volume">ST_Volume</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td style="border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_VoronoiLines" title="ST_VoronoiLines">ST_VoronoiLines</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_VoronoiPolygons" title="ST_VoronoiPolygons">ST_VoronoiPolygons</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_WrapX" title="ST_WrapX">ST_WrapX</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_X" title="ST_X">ST_X</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_Y" title="ST_Y">ST_Y</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_Z" title="ST_Z">ST_Z</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#ST_Zmflag" title="ST_Zmflag">ST_Zmflag</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#postgis_backend" title="postgis.backend">postgis.backend</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#postgis_enable_outdb_rasters" title="postgis.enable_outdb_rasters">postgis.enable_outdb_rasters</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#postgis_gdal_datapath" title="postgis.gdal_datapath">postgis.gdal_datapath</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#postgis_gdal_enabled_drivers" title="postgis.gdal_enabled_drivers">postgis.gdal_enabled_drivers</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="left">
                <a class="link" href="#postgis_gdal_vsi_options" title="postgis.gdal_config_options">postgis.gdal_config_options</a>
              </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; border-bottom: 1px solid ; " align="center"> </td><td style="border-bottom: 1px solid ; " align="center"> </td></tr><tr><td style="border-right: 1px solid ; " align="left">
                <a class="link" href="#postgis_sfcgal_version" title="postgis_sfcgal_version">postgis_sfcgal_version</a>
              </td><td style="border-right: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td style="border-right: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; " align="center"> </td><td style="border-right: 1px solid ; " align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td style="" align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td></tr></tbody></table></div><p>
    </p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="NewFunctions"></a>15.12. 新規作成/機能強化/変更されたPostGIS関数</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="#NewFunctions_3_2">15.12.1. PostGIS 3.2で新規作成/機能強化された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_3_1">15.12.2. PostGIS 3.1で新規作成/機能強化された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_3_0">15.12.3. PostGIS 3.0で新規作成/機能強化された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_2_5">15.12.4. PostGIS 2.5で新規作成/機能強化された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_2_4">15.12.5. PostGIS 2.4で新規作成/機能強化された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_2_3">15.12.6. PostGIS 2.3で新規作成/機能強化された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_2_2">15.12.7. PostGIS 2.2で新規作成/機能強化された関数</a></span></dt><dt><span class="sect2"><a href="#ChangedFunctions_2_2">15.12.8. PostGIS 2.2で大幅に変更された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_2_1">15.12.9. PostGIS 2.1で新規作成/機能強化された関数</a></span></dt><dt><span class="sect2"><a href="#ChangedFunctions_2_1">15.12.10. PostGIS 2.1で大幅に変更された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_2_0">15.12.11. PostGIS 2.0で新規作成/機能強化/変更された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_2_0_Changed">15.12.12. PostGIS 2.0で変更された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_1_5">15.12.13. PostGIS 1.5で新規作成/機能強化/変更された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_1_4">15.12.14. PostGIS 1.4で新規作成/機能強化/変更された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_1_3">15.12.15. PostGIS 1.3で新規作成された関数</a></span></dt></dl></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="NewFunctions_3_2"></a>15.12.1. PostGIS 3.2で新規作成/機能強化された関数</h3></div></div></div><p>次に示す関数は、新規作成または機能強化されたPostGIS関数です。</p><p>PostGIS 3.2で新規作成された関数</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#FindTopology" title="FindTopology">FindTopology</a> - Availability: 3.2.0 異なる方法でトポロジ行を返します。</li><li class="listitem"><a class="link" href="#GetFaceContainingPoint" title="GetFaceContainingPoint">GetFaceContainingPoint</a> - Availability: 3.2.0 ポイントを含むフェイスを見つけます。</li><li class="listitem"><a class="link" href="#ST_AsFlatGeobuf" title="ST_AsFlatGeobuf">ST_AsFlatGeobuf</a> - Availability: 3.2.0 行の集合のFlatGeobuf表現を返します。</li><li class="listitem"><a class="link" href="#RT_ST_Contour" title="ST_Contour">ST_Contour</a> - Availability: 3.2.0 与えられたラスタバンドから等高線ベクタを生成します。GDAL等高線生成アルゴリズムを使います。</li><li class="listitem"><a class="link" href="#ST_DumpSegments" title="ST_DumpSegments">ST_DumpSegments</a> - Availability: 3.2.0 ジオメトリの辺のgeometry_dump行の集合を返します。</li><li class="listitem"><a class="link" href="#RT_ST_InterpolateRaster" title="ST_InterpolateRaster">ST_InterpolateRaster</a> - Availability: 3.2.0 X値とY値を使用してグリッド上のポイントを配置し、ポイントのZ値をサーフェス標高として配置し、3次元ポイントの入力セットに基づいてグリッドサーフェスを補間します。</li><li class="listitem"><a class="link" href="#ST_Scroll" title="ST_Scroll">ST_Scroll</a> - Availability: 3.2.0 閉じたLINESTRINGの開始点を変更する</li><li class="listitem"><a class="link" href="#RT_ST_SetM" title="ST_SetM">ST_SetM</a> - Availability: 3.2.0 入力ジオメトリと同じX/y座標値と、指定されたリサンプリングアルゴリズムを使ってラスタから複写されたZ値とを持つジオメトリを返します。</li><li class="listitem"><a class="link" href="#RT_ST_SetZ" title="ST_SetZ">ST_SetZ</a> - Availability: 3.2.0 入力ジオメトリと同じX/y座標値と、指定されたリサンプリングアルゴリズムを使ってラスタから複写されたZ値とを持つジオメトリを返します。</li><li class="listitem"><a class="link" href="#TopoGeom_addTopoGeom" title="TopoGeom_addTopoGeom">TopoGeom_addTopoGeom</a> - Availability: 3.2 TopoGeometryの要素を他のTopoGeometryの定義に追加します。</li><li class="listitem"><a class="link" href="#ValidateTopologyRelation" title="ValidateTopologyRelation">ValidateTopologyRelation</a> - Availability: 3.2.0 不正なトポロジ関係の行に関する情報を返します。</li><li class="listitem"><a class="link" href="#postgis_gdal_vsi_options" title="postgis.gdal_config_options">postgis.gdal_config_options</a> - Availability: 3.2.0 データベース外ラスタを操作する時に使用するオプションを設定するためのコンフィギュレーション。</li></ul></div><p>PostGIS 3.2で機能強化された関数</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#GetFaceByPoint" title="GetFaceByPoint">GetFaceByPoint</a> - Enhanced: 3.2.0 より効率的な実装とより明確な短縮、不正なトポロジでの動作停止。 与えたポイントとインタセクトするフェイスを見つけます。</li><li class="listitem"><a class="link" href="#ST_MoveIsoNode" title="ST_MoveIsoNode">ST_MoveIsoNode</a> - Enhanced: 3.2.0 ノードが異なるフェイスに移動しないことを保証  トポロジ内の孤立ノードを別の位置に移動させます。新しいapointジオメトリがノードとして存在しているなら、エラーが投げられます。移動に関する説明を返します。</li><li class="listitem"><a class="link" href="#ST_RemovePoint" title="ST_RemovePoint">ST_RemovePoint</a> - Enhanced: 3.2.0 ラインストリングからポイントを削除します。</li><li class="listitem"><a class="link" href="#ST_RemoveRepeatedPoints" title="ST_RemoveRepeatedPoints">ST_RemoveRepeatedPoints</a> - Enhanced: 3.2.0 入力ジオメトリから重複ポイントを除いたものを返します。</li><li class="listitem"><a class="link" href="#ST_StartPoint" title="ST_StartPoint">ST_StartPoint</a> - Enhanced: 3.2.0 全てのジオメトリのポイントを返すようになりました。これより前では入力がLINESTRINGでない場合にNULLを返しました。 ラインストリングの始点を返します。</li><li class="listitem"><a class="link" href="#RT_ST_Value" title="ST_Value">ST_Value</a> - Enhanced: 3.2.0 任意引数resampleが追加されました。 指定したバンドにおけるcolumnx, rowyで指定したピクセルまたは指定したジオメトリポイントに対応するピクセルの値を返します。 バンド番号は1始まりで、指定しない場合には、1番と仮定します。exclude_nodata_valueがFALSEに設定された場合には、NODATAピクセルを含む全てのピクセルがインタセクトするかが考慮され、値を返します。exclude_nodata_valueを渡さない場合には、ラスタのメタデータから読みます。</li></ul></div><p>PostGIS 3.2で変更された関数</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#ST_Boundary" title="ST_Boundary">ST_Boundary</a> - Changed: 3.2.0 TINへの対応、GEOSを使わないよう変更、曲線を直線化しないよう変更 ジオメトリの境界を返します。</li><li class="listitem"><a class="link" href="#ValidateTopology" title="ValidateTopology">ValidateTopology</a> - Changed: 3.2.0 任意パラメータbboxの追加、フェイスラベルとエッジリンクのチェックの追加 トポロジの問題についての詳細を示すvalidatetopology_returntypeの集合を返します。</li></ul></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="NewFunctions_3_1"></a>15.12.2. PostGIS 3.1で新規作成/機能強化された関数</h3></div></div></div><p>次に示す関数は、新規作成または機能強化されたPostGIS関数です。</p><p>PostGIS 3.1で新規作成された関数</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#ST_Hexagon" title="ST_Hexagon">ST_Hexagon</a> - Availability: 3.1.0 与えられたエッジサイズと六角形グリッド空間内のセル座標を使って単一の六角形を返します。</li><li class="listitem"><a class="link" href="#ST_HexagonGrid" title="ST_HexagonGrid">ST_HexagonGrid</a> - Availability: 3.1.0 引数ジオメトリの境界を完全にカバーする六角形とセルインデックスを返します。</li><li class="listitem"><a class="link" href="#ST_MaximumInscribedCircle" title="ST_MaximumInscribedCircle">ST_MaximumInscribedCircle</a> - Availability: 3.1.0 - GEOS 3.9.0以上が必要です。 ジオメトリに完全に含まれる最大の円を計算します。</li><li class="listitem"><a class="link" href="#ST_ReducePrecision" title="ST_ReducePrecision">ST_ReducePrecision</a> - Availability: 3.1.0 - GEOS 3.9.0以上が必要です。  全ての与えられたグリッド許容値に丸められたポイントからなる妥当なジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_Square" title="ST_Square">ST_Square</a> - Availability: 3.1.0 与えられたエッジサイズと六角形グリッド空間内のセル座標を使って単一の正方形を返します。</li><li class="listitem"><a class="link" href="#ST_SquareGrid" title="ST_SquareGrid">ST_SquareGrid</a> - Availability: 3.1.0 引数ジオメトリの境界を完全にカバーするグリッド正方形とセルインデックスを返します。</li></ul></div><p>PostGIS 3.1で機能強化された関数</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a> - Enhanced: 3.1.0 精度パラメータ (任意)に対応しました ジオメトリのSRIDメタデータが付いたWell-Known Text (WKT)表現を返します。</li><li class="listitem"><a class="link" href="#ST_TileEnvelope" title="ST_TileEnvelope">ST_TileEnvelope</a> - Enhanced: 3.1.0 marginパラメータが追加されました。 Webメルカトル (SRID:3857)上で XYZタイルを使った矩形ポリゴンを生成します。</li></ul></div><p>PostGIS 3.1で変更された関数</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#RT_ST_Count" title="ST_Count">ST_Count</a> - Changed: 3.1.0 - ST_Count(rastertable, rastercolumn, ...) の形式は削除されました。代わりにを使用します。 ラスタまたはラスタカバレッジの指定したバンドのピクセル数を返します。バンドを指定しない場合には、1番と仮定します。exclude_nodata_valueをTRUEに設定している場合には、NODATA値と等しくないピクセルのみを数えます。</li><li class="listitem"><a class="link" href="#ST_Force_3D" title="ST_Force3D">ST_Force3D</a> - Changed: 3.1.0. 0でないZ値を指定できるようになりました。 ジオメトリをXYZモードに強制します。これはST_Force3DZの別名です。</li><li class="listitem"><a class="link" href="#ST_Force_3DM" title="ST_Force3DM">ST_Force3DM</a> - Changed: 3.1.0. 0でないM値を指定できるようになりました。 ジオメトリをXYMモードに強制します。</li><li class="listitem"><a class="link" href="#ST_Force_3DZ" title="ST_Force3DZ">ST_Force3DZ</a> - Changed: 3.1.0. 0でないZ値を指定できるようになりました。 ジオメトリをXYZモードに強制します。</li><li class="listitem"><a class="link" href="#ST_Force_4D" title="ST_Force4D">ST_Force4D</a> - Changed: 3.1.0. 0でないZ値とM値を指定できるようになりました。 ジオメトリをXYZMモードに強制します。</li><li class="listitem"><a class="link" href="#RT_ST_Histogram" title="ST_Histogram">ST_Histogram</a> - Changed: 3.1.0 ST_Histogram(table_name, column_name) の形式は削除されました。  ラスタまたはラスタカバレッジのビン範囲で分割したデータ分布をまとめるヒストグラムの集合を返します。ビン数を指定しない場合には自動計算されます。</li><li class="listitem"><a class="link" href="#RT_ST_Quantile" title="ST_Quantile">ST_Quantile</a> - Changed: 3.1.0 ST_Quantile(table_name, column_name) の形式は削除されました。  ラスタまたはラスタテーブルカバレッジのサンプルまたは母集団の分位数を計算します。値がラスタの25%,50%,75%にあるかを調べることができます。</li><li class="listitem"><a class="link" href="#RT_ST_SummaryStats" title="ST_SummaryStats">ST_SummaryStats</a> - Changed: 3.1.0 ST_SummaryStats(rastertable, rastercolumn, ...) の形式は削除されました。代わりにを使用します。  ラスタまたはラスタカバレッジの指定したバンドについて、ピクセル数、合計値、平均値、標準偏差、最小値、最大値からなる統計情報の概要を返します。バンドを指定しない場合には、1番と仮定します。</li></ul></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="NewFunctions_3_0"></a>15.12.3. PostGIS 3.0で新規作成/機能強化された関数</h3></div></div></div><p>次に示す関数は、新規作成または機能強化されたPostGIS関数です。</p><p>PostGIS 3.0で新規作成された関数</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#ST_3DLineInterpolatePoint" title="ST_3DLineInterpolatePoint">ST_3DLineInterpolatePoint</a> - Availability: 3.0.0 3次元ラインに沿って、割合で示された位置の補間ポイントを返します。</li><li class="listitem"><a class="link" href="#ST_ConstrainedDelaunayTriangles" title="ST_ConstrainedDelaunayTriangles">ST_ConstrainedDelaunayTriangles</a> - Availability: 3.0.0 入力ジオメトリの周りの制約付きドロネー三角形を返します。</li><li class="listitem"><a class="link" href="#ST_TileEnvelope" title="ST_TileEnvelope">ST_TileEnvelope</a> - Availability: 3.0.0 Webメルカトル (SRID:3857)上で XYZタイルを使った矩形ポリゴンを生成します。</li></ul></div><p>PostGIS 3.0で機能強化された関数</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#ST_AsMVT" title="ST_AsMVT">ST_AsMVT</a> - Enhanced: 3.0 - 地物IDへの対応を追加。 行集合のMapbox Vector Tile表現を返す集約関数です。</li><li class="listitem"><a class="link" href="#ST_CurveToLine" title="ST_CurveToLine">ST_CurveToLine</a> - Enhanced: 3.0.0 線形化した弧ごとの最小線分数を実装しました。トポロジ的な崩壊を防ぐためです。 曲線を含むジオメトリを線ジオメトリに変換します。</li><li class="listitem"><a class="link" href="#ST_GeneratePoints" title="ST_GeneratePoints">ST_GeneratePoints</a> - Enhanced: 3.0.0 seedパラメータの追加 ポリゴン内やマルチポリゴン内にランダムなポイントを生成します。</li><li class="listitem"><a class="link" href="#ST_LocateBetween" title="ST_LocateBetween">ST_LocateBetween</a> - Enhanced: 3.0.0 - POLYGON, TIN, TRIANGLEへの対応が追加されました。 M値の範囲に合致する部分ジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_LocateBetweenElevations" title="ST_LocateBetweenElevations">ST_LocateBetweenElevations</a> - Enhanced: 3.0.0 - POLYGON, TIN, TRIANGLEへの対応が追加されました。 標高 (Z値)範囲にある部分ジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_Segmentize" title="ST_Segmentize">ST_Segmentize</a> - Enhanced: 3.0.0 ジオグラフィの分割において、現在は、同じ長さに分割しています。 与えた距離を超える線分を持たないよう変更したジオメトリ/ジオグラフィを返します。</li></ul></div><p>PostGIS 3.0で変更された関数</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#ST_3DDistance" title="ST_3DDistance">ST_3DDistance</a> - Changed: 3.0.0 - SFCGAL版は削除されました 投影座標系の単位で、二つのジオメトリ間の3次元デカルト距離の最小値を返します (空間参照系に基づきます)。</li><li class="listitem"><a class="link" href="#ST_Area" title="ST_Area">ST_Area</a> - Changed: 3.0.0 - SFCGALに依存しなくなりました。 ポリゴンジオメトリの面積を返します。</li><li class="listitem"><a class="link" href="#ST_AsGeoJSON" title="ST_AsGeoJSON">ST_AsGeoJSON</a> - Changed: 3.0.0 レコードの入力に対応しました ジオメトリをGeoJSON要素として返します。</li><li class="listitem"><a class="link" href="#ST_AsGeoJSON" title="ST_AsGeoJSON">ST_AsGeoJSON</a> - Changed: 3.0.0 EPSG:4326以外の場合のSRID出力 ジオメトリをGeoJSON要素として返します。</li><li class="listitem"><a class="link" href="#ST_Distance" title="ST_Distance">ST_Distance</a> - Changed: 3.0.0 - SFCGALに依存しなくなりました。 二つのジオメトリ値またはジオグラフィ値間の距離を返します。</li></ul></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="NewFunctions_2_5"></a>15.12.4. PostGIS 2.5で新規作成/機能強化された関数</h3></div></div></div><p>次に示す関数は、新規作成または機能強化されたPostGIS関数です。</p><p>PostGIS 2.5で新規作成された関数</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#ST_Angle" title="ST_Angle">ST_Angle</a> - Availability: 2.5.0 3点もしくは4点、または2線で定義される二つのベクタ間の角度を返します。</li><li class="listitem"><a class="link" href="#RT_ST_AsHexWKB" title="ST_AsHexWKB">ST_AsHexWKB</a> - Availability: 2.5.0  Well-Known Binary (WKB)ラスタを16進数表現で返します。</li><li class="listitem"><a class="link" href="#RT_ST_BandFileSize" title="ST_BandFileSize">ST_BandFileSize</a> - Availability: 2.5.0 ファイルシステムに格納されているバンドのファイルサイズを返します。バンド番号が指定されていない場合には、1番と仮定します。</li><li class="listitem"><a class="link" href="#RT_ST_BandFileTimestamp" title="ST_BandFileTimestamp">ST_BandFileTimestamp</a> - Availability: 2.5.0 ファイルシステムに格納されているバンドのファイルタイムスタンプ返します。バンド番号が指定されていない場合には、1番と仮定します。</li><li class="listitem"><a class="link" href="#ST_ChaikinSmoothing" title="ST_ChaikinSmoothing">ST_ChaikinSmoothing</a> - Availability: 2.5.0 チャイキンのアルゴリズムを使って、与えられたジオメトリの平滑化されたものを返します。</li><li class="listitem"><a class="link" href="#ST_FilterByM" title="ST_FilterByM">ST_FilterByM</a> - Availability: 2.5.0 M値に基づいて頂点を削除します。</li><li class="listitem"><a class="link" href="#RT_ST_Grayscale" title="ST_Grayscale">ST_Grayscale</a> - Availability: 2.5.0  元のラスタと指定したバンドを赤、緑、青バンドとして一つの8BUIバンドを持つラスタを生成します。</li><li class="listitem"><a class="link" href="#ST_LineInterpolatePoints" title="ST_LineInterpolatePoints">ST_LineInterpolatePoints</a> - Availability: 2.5.0 ラインに沿って、割合で示された複数の位置の補間ポイントを返します。</li><li class="listitem"><a class="link" href="#ST_OrientedEnvelope" title="ST_OrientedEnvelope">ST_OrientedEnvelope</a> - Availability: 2.5.0  ジオメトリを囲む最小の回転四角形を返します。</li><li class="listitem"><a class="link" href="#ST_QuantizeCoordinates" title="ST_QuantizeCoordinates">ST_QuantizeCoordinates </a> - Availability: 2.5.0 座標値の最下位ビットを0にします。</li><li class="listitem"><a class="link" href="#RT_ST_RastFromHexWKB" title="ST_RastFromHexWKB">ST_RastFromHexWKB</a> - Availability: 2.5.0 Well-Knownバイナリ (WKB)ラスタの16進数表現からラスタを返します。</li><li class="listitem"><a class="link" href="#RT_ST_RastFromWKB" title="ST_RastFromWKB">ST_RastFromWKB</a> - Availability: 2.5.0 Well-Known Binary (WKB)ラスタからラスタ値を返します。</li><li class="listitem"><a class="link" href="#RT_ST_SetBandIndex" title="ST_SetBandIndex">ST_SetBandIndex</a> - Availability: 2.5.0 データベース外バンドの外部バンド番号の更新</li><li class="listitem"><a class="link" href="#RT_ST_SetBandPath" title="ST_SetBandPath">ST_SetBandPath</a> - Availability: 2.5.0 データベース外バンドの外部パスとバンド番号を更新します。</li></ul></div><p>PostGIS 2.5で機能強化された関数</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#RT_ST_AsBinary" title="ST_AsBinary/ST_AsWKB">ST_AsBinary/ST_AsWKB</a> - Enhanced: 2.5.0 ST_AsWKBの追加 ラスタのWell-Known Binary (WKB)表現を返します。</li><li class="listitem"><a class="link" href="#ST_AsMVT" title="ST_AsMVT">ST_AsMVT</a> - Enhanced: 2.5.0 - パラレルクエリへの対応の追加。 行集合のMapbox Vector Tile表現を返す集約関数です。</li><li class="listitem"><a class="link" href="#ST_AsText" title="ST_AsText">ST_AsText</a> - Enhanced: 2.5 - 精度の任意引数が導入されました。 ジオメトリ/ジオグラフィのSRIDメタデータのないWell-Known Text (WKT)表現を返します。</li><li class="listitem"><a class="link" href="#RT_ST_BandMetaData" title="ST_BandMetaData">ST_BandMetaData</a> - Enhanced: 2.5.0 outdbラスタにoutdbbandnum, filesizeとfiletimestampを取り入れました。 指定したラスタバンドの基本的なメタデータを返します。バンド番号を指定しない場合には、1番と仮定します。</li><li class="listitem"><a class="link" href="#ST_Buffer" title="ST_Buffer">ST_Buffer</a> - Enhanced: 2.5.0 - ST_Bufferのジオメトリ対応版が強化され、バッファを施す側をside=both|left|rightで指定できるようになりました。 あるジオメトリからの距離が指定された距離以下となる点全ての集合となるジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_GeometricMedian" title="ST_GeometricMedian">ST_GeometricMedian </a> - Enhanced: 2.5.0 ポイントの重みとしてのM値の対応が追加されました。 マルチポイントの幾何学的中央値を返します。</li><li class="listitem"><a class="link" href="#ST_OffsetCurve" title="ST_OffsetCurve">ST_OffsetCurve</a> - Enhanced: 2.5 - GEOMETRYCOLLECTIONとULTILINESTRINGへの対応追加 与えられた距離と方面に入力ラインをずらしたラインを返します。</li></ul></div><p>PostGIS 2.5で変更された関数</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#RT_ST_GDALDrivers" title="ST_GDALDrivers">ST_GDALDrivers</a> - Changed: 2.5.0 - can_readカラムとcan_writeカラムを追加 使用しているGDALライブラリが対応するラスタ書式の一覧を返します。この一覧でcan_write=TrueとなっているものだけがST_AsGDALRasterで使えます。</li></ul></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="NewFunctions_2_4"></a>15.12.5. PostGIS 2.4で新規作成/機能強化された関数</h3></div></div></div><p>次に示す関数は、新規作成または機能強化されたPostGIS関数です。</p><p>PostGIS 2.4で新規作成された関数</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#ST_AsGeobuf" title="ST_AsGeobuf">ST_AsGeobuf</a> - Availability: 2.4.0 行集合のGeobuf表現を返します。</li><li class="listitem"><a class="link" href="#ST_AsMVT" title="ST_AsMVT">ST_AsMVT</a> - Availability: 2.4.0 行集合のMapbox Vector Tile表現を返す集約関数です。</li><li class="listitem"><a class="link" href="#ST_AsMVTGeom" title="ST_AsMVTGeom">ST_AsMVTGeom</a> - Availability: 2.4.0 ジオメトリをMapbox Vector Tileの座標空間に変換します。</li><li class="listitem"><a class="link" href="#ST_Centroid" title="ST_Centroid">ST_Centroid</a> - Availability: 2.4.0 ジオグラフィが導入されました。 ジオメトリの幾何学的重心を返します。</li><li class="listitem"><a class="link" href="#ST_ForcePolygonCCW" title="ST_ForcePolygonCCW">ST_ForcePolygonCCW </a> - Availability: 2.4.0 全ての外環を反時計回りに、全ての内環を時計回りに、それぞれ強制します。</li><li class="listitem"><a class="link" href="#ST_ForcePolygonCW" title="ST_ForcePolygonCW">ST_ForcePolygonCW </a> - Availability: 2.4.0 全ての外環を時計回りに、全ての内環を反時計回りに、それぞれ強制します。</li><li class="listitem"><a class="link" href="#ST_FrechetDistance" title="ST_FrechetDistance">ST_FrechetDistance</a> - Availability: 2.4.0 - GEOS 3.7.0以上が必要です。 二つのジオメトリのフレシェ距離を返します。</li><li class="listitem"><a class="link" href="#ST_IsPolygonCCW" title="ST_IsPolygonCCW">ST_IsPolygonCCW </a> - Availability: 2.4.0 ポリゴンが反時計回りの外環を持っていて、時計回りの内環を持っているかをテストします。</li><li class="listitem"><a class="link" href="#ST_IsPolygonCW" title="ST_IsPolygonCW">ST_IsPolygonCW </a> - Availability: 2.4.0 ポリゴンが時計回りの外環を持っていて、反時計回りの内環を持っているかをテストします。</li><li class="listitem"><a class="link" href="#RT_ST_MakeEmptyCoverage" title="ST_MakeEmptyCoverage">ST_MakeEmptyCoverage</a> - Availability: 2.4.0  空のラスタタイルのグリッドでジオリファレンスを施されている領域を生成します。</li></ul></div><p>PostGIS 2.4で機能強化された関数</p><p>全てのPostGIS集約関数はパラレル安全のラベル付けが施されます。これにより、並列処理を使用できるクエリプランで使うことができるようになります。</p><p>PostGIS 2.4.1のpostgis_tiger_geocoderはTiger 2017データをロードするように設定されています。必要に応じて、zip code 5-digit tabulation (zcta)を<a class="xref" href="#Loader_Generate_Nation_Script" title="Loader_Generate_Nation_Script">Loader_Generate_Nation_Script</a>の一部としてロードすることができます。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#Loader_Generate_Nation_Script" title="Loader_Generate_Nation_Script">Loader_Generate_Nation_Script</a> - Enhanced: 2.4.1 ZCTA5 (Zip Code 5 Tabulation Area)ロード手順は修正され、有効になった時に、ZCTA5データは、国スクリプトのロードの一部として、zcta5_allという名前の単一テーブルにロードされます。 指定したプラットフォーム用の、国と州のルックアップテーブルをロードするシェルスクリプトを生成します。</li><li class="listitem"><a class="link" href="#Normalize_Address" title="Normalize_Address">Normalize_Address</a> - Enhanced: 2.4.0 norm_addyオブジェクトにzip4とaddress_alphanumericが追加されました。 文字列で住所が与えられると、道路後置辞、前置辞、正規化された種別、番地、ストリート名等をフィールドに分けて持つnorm_addy複合型を返します。tiger_geocoderに同梱されているルックアップデータで動作します (Tigerデータ自体は不要です)。</li><li class="listitem"><a class="link" href="#Pagc_Normalize_Address" title="Pagc_Normalize_Address文字列のストリート住所を与えると、道路後置辞、前置辞、標準タイプ、番地、ストリート名等を複数フィールドに分解して持つnorm_addy複合型を返します。この関数は、tiger_geocoder同梱のルックアップテーブルだけを使います (Tigerデータは不要です)。住所標準化エクステンションが必要です。">Pagc_Normalize_Address文字列のストリート住所を与えると、道路後置辞、前置辞、標準タイプ、番地、ストリート名等を複数フィールドに分解して持つnorm_addy複合型を返します。この関数は、tiger_geocoder同梱のルックアップテーブルだけを使います (Tigerデータは不要です)。住所標準化エクステンションが必要です。</a> - Enhanced: 2.4.0 norm_addyオブジェクトにzip4とaddress_alphanumericが追加されました。 文字列のストリート住所を与えると、道路後置辞、前置辞、標準タイプ、番地、ストリート名等を複数フィールドに分解して持つnorm_addy複合型を返します。この関数は、tiger_geocoder同梱のルックアップテーブルだけを使います (Tigerデータは不要です)。住所標準化エクステンションが必要です。</li><li class="listitem"><a class="link" href="#Reverse_Geocode" title="Reverse_Geocode">Reverse_Geocode</a> - Enhanced: 2.4.1 ZCTA5データセットを追加でロードする場合には、reverse_geocode関数は、特定の州データがロードされていなくても、州とZIPを解決することができます。ZTCA5データのロードに関する詳細についてはを参照して下さい。 登録されている空間参照系に基づくポイントジオメトリを引数に取り、理論的に可能性のある住所の配列と交差するストリートの配列を一つのレコードで返します。include_strnum_range = trueの場合には、交差するストリートに番地範囲を追加します。</li><li class="listitem"><a class="link" href="#ST_AsTWKB" title="ST_AsTWKB">ST_AsTWKB</a> - Enhanced: 2.4.0 メモリと速度の改善。 TWKB (Tiny Well-Known Binary)としてジオメトリを出力します。</li><li class="listitem"><a class="link" href="#ST_CurveToLine" title="ST_CurveToLine">ST_CurveToLine</a> - Enhanced: 2.4.0 最大距離差による許容範囲と最大角度による許容範囲に対応し、対称出力に対応しました。 曲線を含むジオメトリを線ジオメトリに変換します。</li><li class="listitem"><a class="link" href="#ST_Project" title="ST_Project">ST_Project</a> - Enhanced: 2.4.0 負の距離と非正規化方位を許容するようになりました 始点から距離と方位で算出されたポイントを返します。</li><li class="listitem"><a class="link" href="#ST_Reverse" title="ST_Reverse">ST_Reverse</a> - Enhanced: 2.4.0 曲線対応が導入されました。 頂点の順序を逆にしたジオメトリを返します。</li></ul></div><p>PostGIS 2.4で変更された関数</p><p>全てのPostGIS集約関数はパラレル安全のラベル付けが施されます。これにより集約関数の削除と再作成が強制的に行われます。この際、ユーザ定義のビューまたはSQL関数がPostGIS集約関数に依っている場合に失敗することがあります。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#ST_Geometry_EQ" title="=">=</a> - Changed: 2.4.0, 以前の版では、ジオメトリ自体の等価性でなくバウンディングボックスが等価かどうかを見ていました。バウンディングボックスが等価かどうかを知る必要がある場合には、替わりにを使います。 ジオメトリ/ジオグラフィ Aの座標と座標の並び順がジオメトリ/ジオグラフィ Bと同じ場合にTRUEを返します。</li></ul></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="NewFunctions_2_3"></a>15.12.6. PostGIS 2.3で新規作成/機能強化された関数</h3></div></div></div><p>次に示す関数は、新規作成または機能強化されたPostGIS関数です。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>PostGIS 2.3.0: PostgreSQL 9.6以上で、並列クエリに対応します。</p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>PostGIS 2.3.0:データベースのリストアにおける問題を低減するために、PostGISエクステンションの全ての関数に対してスキーマ修飾を可能にしました。</p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>PostGIS 2.3.0: PostgreSQL 9.4以上で、BRINインデックスに対応します。<a class="xref" href="#brin_indexes" title="4.9.2. BRINインデックス">「BRINインデックス」</a>を参照して下さい。</p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>PostGIS 2.3.0: Tigerジオコーダは、TIGER 2016データで動作するように更新されました。</p></td></tr></table></div><p>PostGIS 2.3で新規作成された関数</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#overlaps_nd_geometry_gidx" title="&amp;&amp;&amp;(geometry,gidx)">&amp;&amp;&amp;(geometry,gidx)</a> - Availability: 2.3.0 BRIN (Block Range INdexes)が導入されました。PostgreSQL 9.5以上が必要です。 ジオメトリの (キャッシュされている)n次元バウンディングボックスが単精度浮動小数点数によるn次元バウンディングボックス (GIDX)とインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#overlaps_nd_gidx_geometry" title="&amp;&amp;&amp;(gidx,geometry)">&amp;&amp;&amp;(gidx,geometry)</a> - Availability: 2.3.0 BRIN (Block Range INdexes)が導入されました。PostgreSQL 9.5以上が必要です。 単精度浮動小数点数によるn次元バウンディングボックス (GIDX)がジオメトリの (キャッシュされている)n次元バウンディングボックスとインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#overlaps_nd_gidx_gidx" title="&amp;&amp;&amp;(gidx,gidx)">&amp;&amp;&amp;(gidx,gidx)</a> - Availability: 2.3.0 BRIN (Block Range INdexes)が導入されました。PostgreSQL 9.5以上が必要です。 二つの単精度浮動小数点数によるn次元バウンディングボックス (GIDX)が相互にインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#overlaps_box2df_box2df" title="&amp;&amp;(box2df,box2df)">&amp;&amp;(box2df,box2df)</a> - Availability: 2.3.0 BRIN (Block Range INdexes)が導入されました。PostgreSQL 9.5以上が必要です。 二つの単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)が相互にインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#overlaps_box2df_geometry" title="&amp;&amp;(box2df,geometry)">&amp;&amp;(box2df,geometry)</a> - Availability: 2.3.0 BRIN (Block Range INdexes)が導入されました。PostgreSQL 9.5以上が必要です。 単精度浮動小数点数による2次元バウンディングボックスがジオメトリの (キャッシュされている)2次元バウンディングボックスとインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#overlaps_geometry_box2df" title="&amp;&amp;(geometry,box2df)">&amp;&amp;(geometry,box2df)</a> - Availability: 2.3.0 BRIN (Block Range INdexes)が導入されました。PostgreSQL 9.5以上が必要です。 ジオメトリの (キャッシュされている)2次元バウンディングボックスが単精度浮動小数点数による2次元バウンディングボックスとインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#is_contained_box2df_box2df" title="@(box2df,box2df)">@(box2df,box2df)</a> - Availability: 2.3.0 BRIN (Block Range INdexes)が導入されました。PostgreSQL 9.5以上が必要です。 二つの単精度浮動小数点数によるn次元バウンディングボックス (GIDX)の一方がもう一方を包含する場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#is_contained_box2df_geometry" title="@(box2df,geometry)">@(box2df,geometry)</a> - Availability: 2.3.0 BRIN (Block Range INdexes)が導入されました。PostgreSQL 9.5以上が必要です。 単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)がジオメトリの2次元バウンディングボックスに包含される場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#is_contained_geometry_box2df" title="@(geometry,box2df)">@(geometry,box2df)</a> - Availability: 2.3.0 BRIN (Block Range INdexes)が導入されました。PostgreSQL 9.5以上が必要です。 ジオメトリの2次元バウンディングボックスが単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)に包含される場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#Populate_Topology_Layer" title="Populate_Topology_Layer">Populate_Topology_Layer</a> - Availability: 2.3.0 テーブルからメタデータを読み、topology.layerテーブルに不足しているものを追加します。</li><li class="listitem"><a class="link" href="#ST_GeneratePoints" title="ST_GeneratePoints">ST_GeneratePoints</a> - Availability: 2.3.0 ポリゴン内やマルチポリゴン内にランダムなポイントを生成します。</li><li class="listitem"><a class="link" href="#ST_GeometricMedian" title="ST_GeometricMedian">ST_GeometricMedian </a> - Availability: 2.3.0 マルチポイントの幾何学的中央値を返します。</li><li class="listitem"><a class="link" href="#ST_MakeLine" title="ST_MakeLine">ST_MakeLine</a> - Availability: 2.3.0 - MULTIPOINT入力要素への対応が導入されました POINT、MULTIPOINT、LINESTRINGからLINESTRINGを生成します。</li><li class="listitem"><a class="link" href="#ST_MinimumBoundingRadius" title="ST_MinimumBoundingRadius">ST_MinimumBoundingRadius</a> - Availability: 2.3.0 ジオメトリを完全に包含する最小円の中心ポイントと半径を返します。</li><li class="listitem"><a class="link" href="#ST_MinimumClearance" title="ST_MinimumClearance">ST_MinimumClearance</a> - Availability: 2.3.0 ジオメトリのクリアランスの最小値を返します。この値はジオメトリのロバスト性を示すものです。</li><li class="listitem"><a class="link" href="#ST_MinimumClearanceLine" title="ST_MinimumClearanceLine">ST_MinimumClearanceLine</a> - Availability: 2.3.0 - GEOS 3.6.0以上が必要です。 ジオメトリの最小クリアランスを示す、2点のラインストリングを返します。</li><li class="listitem"><a class="link" href="#ST_Normalize" title="ST_Normalize">ST_Normalize</a> - Availability: 2.3.0 標準的な形式に変えたジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_Points" title="ST_Points">ST_Points</a> - Availability: 2.3.0 ジオメトリの座標を含むMULTIPOINTを返します。</li><li class="listitem"><a class="link" href="#ST_VoronoiLines" title="ST_VoronoiLines">ST_VoronoiLines</a> - Availability: 2.3.0 ジオメトリの頂点からボロノイ図のセルを返します。</li><li class="listitem"><a class="link" href="#ST_VoronoiPolygons" title="ST_VoronoiPolygons">ST_VoronoiPolygons</a> - Availability: 2.3.0 ジオメトリの頂点からボロノイ図のセルを返します。</li><li class="listitem"><a class="link" href="#ST_WrapX" title="ST_WrapX">ST_WrapX</a> - Availability: 2.3.0 GEOSが必要です。 ジオメトリをX値で回り込ませます。</li><li class="listitem"><a class="link" href="#TopoGeom_addElement" title="TopoGeom_addElement">TopoGeom_addElement</a> - Availability: 2.3 TopoGeometryの定義に要素を追加します。</li><li class="listitem"><a class="link" href="#TopoGeom_remElement" title="TopoGeom_remElement">TopoGeom_remElement</a> - Availability: 2.3 TopoGeometryの定義から要素を削除します。</li><li class="listitem"><a class="link" href="#contains_box2df_box2df" title="~(box2df,box2df)">~(box2df,box2df)</a> - Availability: 2.3.0 BRIN (Block Range INdexes)が導入されました。PostgreSQL 9.5以上が必要です。 二つの単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)の一方がもう一方を包含する場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#contains_box2df_geometry" title="~(box2df,geometry)">~(box2df,geometry)</a> - Availability: 2.3.0 BRIN (Block Range INdexes)が導入されました。PostgreSQL 9.5以上が必要です。 単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)をジオメトリの (キャッシュされている)2次元バウンディングボックスが包含する場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#contains_geometry_box2df" title="~(geometry,box2df)">~(geometry,box2df)</a> - Availability: 2.3.0 BRIN (Block Range INdexes)が導入されました。PostgreSQL 9.5以上が必要です。 ジオメトリの (キャッシュされている)2次元バウンディングボックスが単精度浮動小数点数によるn次元バウンディングボックス (GIDX)を包含する場合にTRUEを返します。</li></ul></div><p>PostGIS 2.3で機能強化された関数</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#ST_Segmentize" title="ST_Segmentize">ST_Segmentize</a> - Enhanced: 2.3.0 ジオグラフィの分割において、現在は、同じ長さに分割しています。</li></ul></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="NewFunctions_2_2"></a>15.12.7. PostGIS 2.2で新規作成/機能強化された関数</h3></div></div></div><p>次に示す関数は、追加または機能強化されたPostGIS関数です。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>postgis_sfcgalは、現在はエクステンションとしてインストールできます。CREATE EXTENSION postgis_sfcgal;とします。</p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>PostGIS 2.2.0:Tigerジオコーダは、TIGER 2015データで動作するように更新されました。</p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>住所正規化のための address_standardizer, address_standardizer_data_us エクステンションの詳細情報については<a class="xref" href="#Address_Standardizer" title="14.1. 住所標準化">「住所標準化」</a>を参照して下さい。</p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>トポロジの多くの関数は、性能向上のためにC関数で再記述されました。</p></td></tr></table></div><p>PostGIS 2.2で新規作成された関数</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#ST_3DDifference" title="ST_3DDifference">ST_3DDifference</a> - Availability: 2.2.0 3次元の差分を計算します。</li><li class="listitem"><a class="link" href="#ST_3DUnion" title="ST_3DUnion">ST_3DUnion</a> - Availability: 2.2.0 3次元の結合を計算します。</li><li class="listitem"><a class="link" href="#ST_ApproximateMedialAxis" title="ST_ApproximateMedialAxis">ST_ApproximateMedialAxis</a> - Availability: 2.2.0 面ジオメトリの近似的な中心軸を計算します。</li><li class="listitem"><a class="link" href="#ST_AsEncodedPolyline" title="ST_AsEncodedPolyline">ST_AsEncodedPolyline</a> - Availability: 2.2.0 ラインストリングジオメトリから符号化したポリラインを返します。</li><li class="listitem"><a class="link" href="#ST_AsTWKB" title="ST_AsTWKB">ST_AsTWKB</a> - Availability: 2.2.0 TWKB (Tiny Well-Known Binary)としてジオメトリを出力します。</li><li class="listitem"><a class="link" href="#ST_BoundingDiagonal" title="ST_BoundingDiagonal">ST_BoundingDiagonal</a> - Availability: 2.2.0 ジオメトリのバウンディングボックスの対角線を返します。</li><li class="listitem"><a class="link" href="#RT_ST_CountAgg" title="ST_CountAgg">ST_CountAgg</a> - Availability: 2.2.0  集約関数です。ラスタ集合の与えられたバンドのピクセル数を返します。バンドが指定されていない場合には、1番と仮定します。exclude_nodata_valueをTRUEに設定している場合には、NODATA値と等しくないピクセルのみを数えます。</li><li class="listitem"><a class="link" href="#RT_CreateOverview" title="ST_CreateOverview">ST_CreateOverview</a> - Availability: 2.2.0 与えられたラスタカバレッジから解像度を落としたものを生成します。</li><li class="listitem"><a class="link" href="#ST_ForceCurve" title="ST_ForceCurve">ST_ForceCurve</a> - Availability: 2.2.0 該当する場合は、ジオメトリを曲線タイプに変換します。</li><li class="listitem"><a class="link" href="#ST_IsPlanar" title="ST_IsPlanar">ST_IsPlanar</a> - Availability: 2.2.0: これは2.1.0のマニュアルに記述されていましたが、2.1版では偶然に外れてしまいました。 サーフェスが平面であるかないかをチェックします。</li><li class="listitem"><a class="link" href="#ST_IsSolid" title="ST_IsSolid">ST_IsSolid</a> - Availability: 2.2.0 ジオメトリが立体であるかどうかをテストします。妥当性チェックは行いません。</li><li class="listitem"><a class="link" href="#ST_MakeSolid" title="ST_MakeSolid">ST_MakeSolid</a> - Availability: 2.2.0 ジオメトリを立体にキャストします。チェックはしません。妥当な立体を得るには、入力ジオメトリは閉じた多面体サーフェスか閉じたTINでなければなりません。</li><li class="listitem"><a class="link" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a> - Availability: 2.2.0: マスクが追加されました。 コールバック関数版 - 一つ以上の入力ラスタ、バンドインデクスと一つのユーザ定義コールバック関数から、一つのバンドからなるラスタを返します。</li><li class="listitem"><a class="link" href="#RT_ST_MemSize" title="ST_MemSize">ST_MemSize</a> - Availability: 2.2.0 ラスタが取る領域の合計をバイト単位で返します。</li><li class="listitem"><a class="link" href="#ST_RemoveRepeatedPoints" title="ST_RemoveRepeatedPoints">ST_RemoveRepeatedPoints</a> - Availability: 2.2.0 入力ジオメトリから重複ポイントを除いたものを返します。</li><li class="listitem"><a class="link" href="#RT_Retile" title="ST_Retile">ST_Retile</a> - Availability: 2.2.0 任意のタイル化されたラスタカバレッジから構成されたタイルの集合を返します。</li><li class="listitem"><a class="link" href="#ST_SetEffectiveArea" title="ST_SetEffectiveArea">ST_SetEffectiveArea</a> - Availability: 2.2.0 Visvalingam-Whyattアルゴリズムを使って有効範囲となる個々の頂点を置きます。</li><li class="listitem"><a class="link" href="#ST_SimplifyVW" title="ST_SimplifyVW">ST_SimplifyVW</a> - Availability: 2.2.0 Visvalingam-Whyattアルゴリズムを使用して、入力ジオメトリを簡略化したジオメトリを返します。</li><li class="listitem"><a class="link" href="#RT_ST_SummaryStatsAgg" title="ST_SummaryStatsAgg">ST_SummaryStatsAgg</a> - Availability: 2.2.0  集約関数です。ラスタ集合の指定したバンドについて、ピクセル数、合計値、平均値、標準偏差、最小値、最大値からなる統計情報の概要を返します。バンドを指定しない場合には、1番と仮定します。</li><li class="listitem"><a class="link" href="#ST_SwapOrdinates" title="ST_SwapOrdinates">ST_SwapOrdinates</a> - Availability: 2.2.0 与えられたジオメトリにおいて与えられた座標の値を入れ替えたジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_Volume" title="ST_Volume">ST_Volume</a> - Availability: 2.2.0 3次元立体の体積を計算します。面ジオメトリは (閉じていても)0を返します。</li><li class="listitem"><a class="link" href="#postgis_enable_outdb_rasters" title="postgis.enable_outdb_rasters">postgis.enable_outdb_rasters</a> - Availability: 2.2.0 データベース外ラスタのバンドにアクセスできるようにする、真偽型のコンフィギュレーションオプション。</li><li class="listitem"><a class="link" href="#postgis_gdal_datapath" title="postgis.gdal_datapath">postgis.gdal_datapath</a> - Availability: 2.2.0 GDALのGDAL_DATAオプションの値を設定するためのコンフィギュレーションオプションです。設定しない場合には、GDAL_DATA環境変数が使われます。</li><li class="listitem"><a class="link" href="#postgis_gdal_enabled_drivers" title="postgis.gdal_enabled_drivers">postgis.gdal_enabled_drivers</a> - Availability: 2.2.0 PostGIS環境でGDALドライバを有効にするコンフィギュレーションオプションです。GDALコンフィギュレーション変数GDAL_SKIPに影響を与えます。</li></ul></div><p>PostGIS 2.2で機能強化された関数</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#AsTopoJSON" title="AsTopoJSON">AsTopoJSON</a> - Enhanced: 2.2.1 点入力に対応するようになりました</li><li class="listitem"><a class="link" href="#ST_Area" title="ST_Area">ST_Area</a> - Enhanced: 2.2.0 - 精度とロバスト性の向上のためにGeographicLibを使って回転楕円体面上での計測を行うようにしています。この新機能を使うには、Proj 4.9.0以上が必要です。</li><li class="listitem"><a class="link" href="#ST_AsX3D" title="ST_AsX3D">ST_AsX3D</a> - Enhanced: 2.2.0: GeoCoordinatesと軸 (x/y, 経度/緯度)の反転に対応しました。詳細はoptionsを見て下さい。</li><li class="listitem"><a class="link" href="#ST_Azimuth" title="ST_Azimuth">ST_Azimuth</a> - Enhanced: 2.2.0 精度とロバスト性向上のために回転楕円体面上の計測をGeographicLibで行うようにしました。この新機能を使うには、Proj 4.9.0以上が必要です。</li><li class="listitem"><a class="link" href="#ST_Distance" title="ST_Distance">ST_Distance</a> - Enhanced: 2.2.0 - 精度とロバスト性の向上のためにGeographicLibを使って回転楕円体面上での計測を行うようにしています。この新機能を使うには、Proj 4.9.0以上が必要です。</li><li class="listitem"><a class="link" href="#ST_Summary" title="ST_Summary">ST_Summary</a> - Enhanced: 2.2.0 TINと曲線の対応が追加されました。</li><li class="listitem"><a class="link" href="#geometry_distance_knn" title="&lt;-&gt;">&lt;-&gt;</a> - Enhanced: 2.2.0 ジオメトリとジオグラフィとのKNN (k近傍法)の動作が本当のものになりました。ジオグラフィのKNNは回転楕円体面上でなく球面上の計算となることに注意して下さい。PostgreSQL 9.4以下では、ジオグラフィに対応していますが、バウンディングボックスの重心に対応するだけです。</li></ul></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="ChangedFunctions_2_2"></a>15.12.8. PostGIS 2.2で大幅に変更された関数</h3></div></div></div><p>次に示す関数は、PostGIS 2.2で、たぶん大幅に変更されたものです。これらを使用している場合には、既存のコードを確認する必要があるかも知れません。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#Get_Geocode_Setting" title="Get_Geocode_Setting">Get_Geocode_Setting</a> - Changed: 2.2.0 : デフォルト設定をgeocode_settingsに保存するようにしました。ユーザが設定したものだけがgeocode_settings内にあります。</li><li class="listitem"><a class="link" href="#ST_3DClosestPoint" title="ST_3DClosestPoint">ST_3DClosestPoint</a> - Changed: 2.2.0 - 二つの2次元ジオメトリが入力である場合には、2次元ポイントが返ります (古い挙動では、存在しないZの値について0を仮定していました)。2次元と3次元の場合には、もはや、存在しないZの値について0を仮定しません。</li><li class="listitem"><a class="link" href="#ST_3DDistance" title="ST_3DDistance">ST_3DDistance</a> - Changed: 2.2.0 - 2次元と3次元の場合には、もはや、存在しないZの値について0を仮定しません。</li><li class="listitem"><a class="link" href="#ST_3DLongestLine" title="ST_3DLongestLine">ST_3DLongestLine</a> - Changed: 2.2.0 - 二つの2次元ジオメトリが入力である場合には、2次元ポイントが返ります (古い挙動では、存在しないZの値について0を仮定していました)。2次元と3次元の場合には、もはや、存在しないZの値について0を仮定しません。</li><li class="listitem"><a class="link" href="#ST_3DMaxDistance" title="ST_3DMaxDistance">ST_3DMaxDistance</a> - Changed: 2.2.0 - 2次元と3次元の場合には、もはや、存在しないZの値について0を仮定しません。</li><li class="listitem"><a class="link" href="#ST_3DShortestLine" title="ST_3DShortestLine">ST_3DShortestLine</a> - Changed: 2.2.0 - 二つの2次元ジオメトリが入力である場合には、2次元ポイントが返ります (古い挙動では、存在しないZの値について0を仮定していました)。2次元と3次元の場合には、もはや、存在しないZの値について0を仮定しません。</li><li class="listitem"><a class="link" href="#ST_DistanceSphere" title="ST_DistanceSphere">ST_DistanceSphere</a> - Changed: 2.2.0 前の版ではこの関数はST_Distance_Sphereと呼ばれていました。</li><li class="listitem"><a class="link" href="#ST_Distance_Spheroid" title="ST_DistanceSpheroid">ST_DistanceSpheroid</a> - Changed: 2.2.0 前の版ではこの関数はST_Distance_Sphereと呼ばれていました。</li><li class="listitem"><a class="link" href="#ST_Length_Spheroid" title="ST_LengthSpheroid">ST_LengthSpheroid</a> - Changed: 2.2.0 これより前の版では、これはST_Length_Spheroidと呼ばれ、ST_3DLength_Spheroidという別名を持っていました。</li><li class="listitem"><a class="link" href="#ST_MemSize" title="ST_MemSize">ST_MemSize</a> - Changed: 2.2.0 命名規則に従うためにST_MemSizeに変更しました。</li><li class="listitem"><a class="link" href="#ValidateTopology" title="ValidateTopology">ValidateTopology</a> - Changed: 2.2.0 エラーの記述と矛盾しないように'edge crosses node'のid1とid2の値が入れ替わっています。</li><li class="listitem"><a class="link" href="#geometry_distance_knn" title="&lt;-&gt;">&lt;-&gt;</a> - Changed: 2.2.0 PostgreSQL 9.5では、古いハイブリッド書式は遅くなりる可能性があります。そのため、PostGIS 2.2以上かつPostgreSQL 9.5以上においてのみ動作させる場合には、そのやり方をり除きたくなるでしょう。</li></ul></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="NewFunctions_2_1"></a>15.12.9. PostGIS 2.1で新規作成/機能強化された関数</h3></div></div></div><p>次に示す関数は、追加または機能強化されたPostGIS関数です。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>トポロジの効率が改善されています。詳細情報については<a class="xref" href="#Topology" title="第10章 トポロジ">10章<i>トポロジ</i></a>を参照して下さい。</p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>バグ訂正 (特にバンド外ラスタ)、多くの新しい関数 (しばしばユーザが共通のタスクを果たすために記述するコードを短くできます)、ラスタ機能における大規模の速度改善があります。詳細情報については<a class="xref" href="#RT_reference" title="第12章 ラスタ リファレンス">12章<i>ラスタ リファレンス</i></a>を参照して下さい。</p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>PostGIS 2.1.0: Tigerジオコーダは、TIGER 2012データで動作するように更新されました。また、デバッグと格付け設定変更のために<code class="varname">geocode_settings</code>が追加され、ローダのロード量を抑制して、現在はロードするべきテーブルをダウンロードするだけになりました。PostGIS 2.1.1: Tigerジオコーダは、TIGER 2013データで動作するように更新されました。詳細情報については、<a class="xref" href="#Tiger_Geocoder" title="14.2. Tigerジオコーダ">「Tigerジオコーダ」</a>を参照して下さい。</p></td></tr></table></div><p>PostGIS 2.1で新規作成された関数</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#RT_Raster_EQ" title="=">=</a> - Availability: 2.1.0  AのバウンディングボックスがBのバウンディングボックスと同じ場合にTRUEを返します。倍精度浮動小数点数のバウンディングボックスを使います。</li><li class="listitem"><a class="link" href="#AsTopoJSON" title="AsTopoJSON">AsTopoJSON</a> - Availability: 2.1.0  opoGeometryのTopoJSON表現を返します。</li><li class="listitem"><a class="link" href="#Drop_Nation_Tables_Generate_Script" title="Drop_Nation_Tables_Generate_Script">Drop_Nation_Tables_Generate_Script</a> - Availability: 2.1.0 指定したスキーマ内のテーブルのうち、county_all, state_allまたは、county or stateを削除するスクリプトを生成します。</li><li class="listitem"><a class="link" href="#Get_Geocode_Setting" title="Get_Geocode_Setting">Get_Geocode_Setting</a> - Availability: 2.1.0 tiger.geocode_settingsテーブルに格納されている設定のうち指定したものの値を返します。</li><li class="listitem"><a class="link" href="#Loader_Generate_Nation_Script" title="Loader_Generate_Nation_Script">Loader_Generate_Nation_Script</a> - Availability: 2.1.0  指定したプラットフォーム用の、国と州のルックアップテーブルをロードするシェルスクリプトを生成します。</li><li class="listitem"><a class="link" href="#Pagc_Normalize_Address" title="Pagc_Normalize_Address文字列のストリート住所を与えると、道路後置辞、前置辞、標準タイプ、番地、ストリート名等を複数フィールドに分解して持つnorm_addy複合型を返します。この関数は、tiger_geocoder同梱のルックアップテーブルだけを使います (Tigerデータは不要です)。住所標準化エクステンションが必要です。">Pagc_Normalize_Address文字列のストリート住所を与えると、道路後置辞、前置辞、標準タイプ、番地、ストリート名等を複数フィールドに分解して持つnorm_addy複合型を返します。この関数は、tiger_geocoder同梱のルックアップテーブルだけを使います (Tigerデータは不要です)。住所標準化エクステンションが必要です。</a> - Availability: 2.1.0 文字列のストリート住所を与えると、道路後置辞、前置辞、標準タイプ、番地、ストリート名等を複数フィールドに分解して持つnorm_addy複合型を返します。この関数は、tiger_geocoder同梱のルックアップテーブルだけを使います (Tigerデータは不要です)。住所標準化エクステンションが必要です。</li><li class="listitem"><a class="link" href="#ST_3DArea" title="ST_3DArea">ST_3DArea</a> - Availability: 2.1.0 3次元の面ジオメトリの面積を計算します。立体の場合は0を返します。</li><li class="listitem"><a class="link" href="#ST_3DIntersection" title="ST_3DIntersection">ST_3DIntersection</a> - Availability: 2.1.0 3次元のインタセクトした (共有する)部分を計算します。</li><li class="listitem"><a class="link" href="#RT_ST_ColorMap" title="ST_ColorMap">ST_ColorMap</a> - Availability: 2.1.0  元のラスタと指定したバンドから4個までの8BUIバンド (grayscale, RGB, RGBA)からなる新しいラスタを生成します。</li><li class="listitem"><a class="link" href="#RT_ST_Contains" title="ST_Contains">ST_Contains</a> - Availability: 2.1.0 rastAの外にrastBの点が無く、rastAの内部にrastBの内部の点が一つ以上ある場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#RT_ST_ContainsProperly" title="ST_ContainsProperly">ST_ContainsProperly</a> - Availability: 2.1.0 rastBがrastAの内部でインタセクトし、かつrastAの境界とも外部ともインタセクトしない場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#RT_ST_CoveredBy" title="ST_CoveredBy">ST_CoveredBy</a> - Availability: 2.1.0 rastAがrastBの外部に点を持たない場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#RT_ST_Covers" title="ST_Covers">ST_Covers</a> - Availability: 2.1.0 rastBがrastAの外部に点を持たない場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#RT_ST_DFullyWithin" title="ST_DFullyWithin">ST_DFullyWithin</a> - Availability: 2.1.0 rastAとrastBが指定した距離内に完全に収まる場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#RT_ST_DWithin" title="ST_DWithin">ST_DWithin</a> - Availability: 2.1.0 rastAとrastBが指定した距離内にある場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#ST_DelaunayTriangles" title="ST_DelaunayTriangles">ST_DelaunayTriangles</a> - Availability: 2.1.0 ジオメトリの頂点のドローネ三角形を返します。</li><li class="listitem"><a class="link" href="#RT_ST_Disjoint" title="ST_Disjoint">ST_Disjoint</a> - Availability: 2.1.0 rastAがrastBとインタセクトしない場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#RT_ST_DumpValues" title="ST_DumpValues">ST_DumpValues</a> - Availability: 2.1.0 指定したバンドの値を2次元で得ます。</li><li class="listitem"><a class="link" href="#ST_Extrude" title="ST_Extrude">ST_Extrude</a> - Availability: 2.1.0 関連するボリュームにサーフェスを押し出します。</li><li class="listitem"><a class="link" href="#ST_ForceLHR" title="ST_ForceLHR">ST_ForceLHR</a> - Availability: 2.1.0 LHR (Left Hand Rule)方向に強制します。</li><li class="listitem"><a class="link" href="#RT_ST_FromGDALRaster" title="ST_FromGDALRaster">ST_FromGDALRaster</a> - Availability: 2.1.0 対応するGDALラスタファイルからラスタを返します。</li><li class="listitem"><a class="link" href="#RT_ST_InvDistWeight4ma" title="ST_InvDistWeight4ma">ST_InvDistWeight4ma</a> - Availability: 2.1.0 近隣のピクセル値の内挿補間を行うラスタ処理関数です。</li><li class="listitem"><a class="link" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a> - Availability: 2.1.0 コールバック関数版 - 一つ以上の入力ラスタ、バンドインデクスと一つのユーザ定義コールバック関数から、一つのバンドからなるラスタを返します。</li><li class="listitem"><a class="link" href="#RT_ST_MapAlgebra_expr" title="ST_MapAlgebra (数式版)">ST_MapAlgebra (数式版)</a> - Availability: 2.1.0 数式版 - 一つか二つの入力ラスタ、バンド番号、一つ以上のユーザ定義SQL式から一つのバンドを持つラスタを返します。</li><li class="listitem"><a class="link" href="#RT_ST_MinConvexHull" title="ST_MinConvexHull">ST_MinConvexHull</a> - Availability: 2.1.0  NODATA値を除いたラスタの凸包ジオメトリを返します。</li><li class="listitem"><a class="link" href="#RT_ST_MinDist4ma" title="ST_MinDist4ma">ST_MinDist4ma</a> - Availability: 2.1.0 対象ピクセルと値を持つ近隣ピクセルとの最短距離をピクセル単位で返すラスタ処理関数です。</li><li class="listitem"><a class="link" href="#ST_MinkowskiSum" title="ST_MinkowskiSum">ST_MinkowskiSum</a> - Availability: 2.1.0 ミンコフスキー和を求めます。</li><li class="listitem"><a class="link" href="#RT_ST_NearestValue" title="ST_NearestValue">ST_NearestValue</a> - Availability: 2.1.0 与えられたバンドの、columnxとrowyで指定されるか、またはラスタと同じ空間参照系で表現されたポイントで指定されたピクセルに最も近いNODATAでない値を返します。</li><li class="listitem"><a class="link" href="#RT_ST_Neighborhood" title="ST_Neighborhood">ST_Neighborhood</a> - Availability: 2.1.0 与えられたバンドのcolumnX, columnYか、ラスタと同じ空間参照系のジオメトリポイントで指定されたピクセルの周囲にある、NODATAでない2次元倍精度浮動小数点数配列を返します。</li><li class="listitem"><a class="link" href="#RT_ST_NotSameAlignmentReason" title="ST_NotSameAlignmentReason">ST_NotSameAlignmentReason</a> - Availability: 2.1.0 ラスタが同じアラインメントを持つかどうか、また、持たない場合にはその理由を示す文字列を返します。</li><li class="listitem"><a class="link" href="#ST_Orientation" title="ST_Orientation">ST_Orientation</a> - Availability: 2.1.0 サーフェスの方向を判定します。</li><li class="listitem"><a class="link" href="#RT_ST_Overlaps" title="ST_Overlaps">ST_Overlaps</a> - Availability: 2.1.0 rastAとrastBがインタセクトして、かつ一方がもう一方に完全には包含されない場合にはTRUEを返します。</li><li class="listitem"><a class="link" href="#RT_ST_PixelAsCentroid" title="ST_PixelAsCentroid">ST_PixelAsCentroid</a> - Availability: 2.1.0 ピクセルで表現される面の重心 (ポイントジオメトリ)を返します。</li><li class="listitem"><a class="link" href="#RT_ST_PixelAsCentroids" title="ST_PixelAsCentroids">ST_PixelAsCentroids</a> - Availability: 2.1.0 全てのピクセルについて重心 (ポイントジオメト)リを、ピクセルごとのピクセル値とラスタ座標系のXとYとを付けて返します。ポイントジオメトリの座標はピクセルで表現される面の重心です。</li><li class="listitem"><a class="link" href="#RT_ST_PixelAsPoint" title="ST_PixelAsPoint">ST_PixelAsPoint</a> - Availability: 2.1.0 ピクセルの左上隅のポイントジオメトリを返します。</li><li class="listitem"><a class="link" href="#RT_ST_PixelAsPoints" title="ST_PixelAsPoints">ST_PixelAsPoints</a> - Availability: 2.1.0 全てのピクセルについてポイントジオメトリを、ピクセルごとのピクセル値とラスタ座標系のXとYとを付けて返します。ポイントジオメトリの座標はピクセルの左上隅です。</li><li class="listitem"><a class="link" href="#RT_ST_PixelOfValue" title="ST_PixelOfValue">ST_PixelOfValue</a> - Availability: 2.1.0 検索値と同じ値を持つピクセルのcolumnx, rowyピクセル座標を得ます。</li><li class="listitem"><a class="link" href="#RT_ST_RasterToWorldCoord" title="ST_RasterToWorldCoord">ST_RasterToWorldCoord</a> - Availability: 2.1.0 ラスタの指定した列と行における左上隅の地理座標X値とY値 (経度と緯度)を返します。列と行の番号は1始まりです。</li><li class="listitem"><a class="link" href="#RT_ST_Resize" title="ST_Resize">ST_Resize</a> - Availability: 2.1.0 GDAL 1.6.1以上が必要です。 ラスタを新しい幅、高さにサイズ再設定を行います。</li><li class="listitem"><a class="link" href="#RT_ST_Roughness" title="ST_Roughness">ST_Roughness</a> - Availability: 2.1.0 DEMの「粗度」を計算したラスタを返します。</li><li class="listitem"><a class="link" href="#RT_ST_SetValues" title="ST_SetValues">ST_SetValues</a> - Availability: 2.1.0 与えられたバンドに複数の値を設定して、変更されたラスタを返します。</li><li class="listitem"><a class="link" href="#TP_ST_Simplify" title="ST_Simplify">ST_Simplify</a> - Availability: 2.1.0 与えたTopoGeometryを「シンプル化した」ジオメトリを返します。ダグラス-ポーカーのアルゴリズムを使います。</li><li class="listitem"><a class="link" href="#ST_StraightSkeleton" title="ST_StraightSkeleton">ST_StraightSkeleton</a> - Availability: 2.1.0 ジオメトリからストレートスケルトンを計算します。</li><li class="listitem"><a class="link" href="#RT_ST_Summary" title="ST_Summary">ST_Summary</a> - Availability: 2.1.0 ラスタの中身の概要が文字列で返されます。</li><li class="listitem"><a class="link" href="#RT_ST_TPI" title="ST_TPI">ST_TPI</a> - Availability: 2.1.0 地形的位置指数を計算したラスタを返します。</li><li class="listitem"><a class="link" href="#RT_ST_TRI" title="ST_TRI">ST_TRI</a> - Availability: 2.1.0 起伏指標を計算したラスタを返します。</li><li class="listitem"><a class="link" href="#ST_Tesselate" title="ST_Tesselate">ST_Tesselate</a> - Availability: 2.1.0 ポリゴンまたは多面体サーフェスのテッセレーションを計算し、TINまたはTINコレクションを返します。</li><li class="listitem"><a class="link" href="#RT_ST_Tile" title="ST_Tile">ST_Tile</a> - Availability: 2.1.0 求められた出力ラスタのピクセル数に基づいて入力ラスタを分割した結果のラスタ集合を返します。</li><li class="listitem"><a class="link" href="#RT_ST_Touches" title="ST_Touches">ST_Touches</a> - Availability: 2.1.0 rastAとrastBが少なくとも一つの共通の点を持ち、かつ二つのラスタの内部同士がインタセクトしない場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#RT_ST_Union" title="ST_Union">ST_Union</a> - Availability: 2.1.0 ST_Union(rast, unionarg)の形式が導入されました。 ラスタタイルの集合を結合して1以上のバンドからなる単一ラスタを返します。</li><li class="listitem"><a class="link" href="#RT_ST_Within" title="ST_Within">ST_Within</a> - Availability: 2.1.0 rastAがrastBの外部に点を持たず、rastAの内部の少なくとも一つの点がrastBの内部にある場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#RT_ST_WorldToRasterCoord" title="ST_WorldToRasterCoord">ST_WorldToRasterCoord</a> - Availability: 2.1.0 ラスタの空間参照系による地理座標のX値とY値 (経度と緯度)またはポイントジオメトリに対応するピクセルの左上隅を返します。</li><li class="listitem"><a class="link" href="#Set_Geocode_Setting" title="Set_Geocode_Setting">Set_Geocode_Setting</a> - Availability: 2.1.0 ジオコーダ関数の振る舞いに影響を与える設定を行います。</li><li class="listitem"><a class="link" href="#RT_UpdateRasterSRID" title="UpdateRasterSRID">UpdateRasterSRID</a> - Availability: 2.1.0 ユーザが指定したカラムとテーブルにあるラスタの全てについてSRIDを変更します。</li><li class="listitem"><a class="link" href="#clearTopoGeom" title="clearTopoGeom">clearTopoGeom</a> - Availability: 2.1 TopoGeometryの中身を消去します。</li><li class="listitem"><a class="link" href="#postgis_backend" title="postgis.backend">postgis.backend</a> - Availability: 2.1.0 GEOSとSFCGALで重複する関数を提供するバックエンドです。GEOSまたはSFCGALを選択します。デフォルトはGEOSです。</li><li class="listitem"><a class="link" href="#postgis_sfcgal_version" title="postgis_sfcgal_version">postgis_sfcgal_version</a> - Availability: 2.1.0 使用しているSFCGALの版を返します</li></ul></div><p>PostGIS 2.1で機能強化された関数</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#RT_ST_AddBand" title="ST_AddBand">ST_AddBand</a> - Enhanced: 2.1.0 addbandarg対応が追加されました。</li><li class="listitem"><a class="link" href="#RT_ST_AddBand" title="ST_AddBand">ST_AddBand</a> - Enhanced: 2.1.0 out-dbバンドが追加されました。</li><li class="listitem"><a class="link" href="#RT_ST_AsBinary" title="ST_AsBinary/ST_AsWKB">ST_AsBinary/ST_AsWKB</a> - Enhanced: 2.1.0 outasinの追加</li><li class="listitem"><a class="link" href="#RT_ST_Aspect" title="ST_Aspect">ST_Aspect</a> - Enhanced: 2.1.0 ST_MapAlgebra()を使用するようにし、interpolate_nodata任意引数を追加しました。</li><li class="listitem"><a class="link" href="#RT_ST_Clip" title="ST_Clip">ST_Clip</a> - Enhanced: 2.1.0 C言語で記述されました</li><li class="listitem"><a class="link" href="#RT_ST_Distinct4ma" title="ST_Distinct4ma">ST_Distinct4ma</a> - Enhanced: 2.1.0 二つ目の形式の追加</li><li class="listitem"><a class="link" href="#RT_ST_HillShade" title="ST_HillShade">ST_HillShade</a> - Enhanced: 2.1.0 ST_MapAlgebra()を使用するようにし、interpolate_nodata任意引数を追加しました。</li><li class="listitem"><a class="link" href="#RT_ST_Max4ma" title="ST_Max4ma">ST_Max4ma</a> - Enhanced: 2.1.0 二つ目の形式の追加</li><li class="listitem"><a class="link" href="#RT_ST_Mean4ma" title="ST_Mean4ma">ST_Mean4ma</a> - Enhanced: 2.1.0 二つ目の形式の追加</li><li class="listitem"><a class="link" href="#RT_ST_Min4ma" title="ST_Min4ma">ST_Min4ma</a> - Enhanced: 2.1.0 二つ目の形式の追加</li><li class="listitem"><a class="link" href="#RT_ST_PixelAsCentroid" title="ST_PixelAsCentroid">ST_PixelAsCentroid</a> - Enhanced: 2.1.0 C言語で記述されました</li><li class="listitem"><a class="link" href="#RT_ST_PixelAsCentroids" title="ST_PixelAsCentroids">ST_PixelAsCentroids</a> - Enhanced: 2.1.0 C言語で記述されました</li><li class="listitem"><a class="link" href="#RT_ST_PixelAsPolygons" title="ST_PixelAsPolygons">ST_PixelAsPolygons</a> - Enhanced: 2.1.0 任意引数exclude_nodata_valueが追加されました。</li><li class="listitem"><a class="link" href="#RT_ST_Polygon" title="ST_Polygon">ST_Polygon</a> - Enhanced: 2.1.0 速度を改善し (完全にC言語で記述しました)、確実に妥当なマルチポリゴンを返すようにしました。</li><li class="listitem"><a class="link" href="#RT_ST_Range4ma" title="ST_Range4ma">ST_Range4ma</a> - Enhanced: 2.1.0 二つ目の形式の追加</li><li class="listitem"><a class="link" href="#RT_ST_SameAlignment" title="ST_SameAlignment">ST_SameAlignment</a> - Enhanced: 2.1.0 集約関数版の追加</li><li class="listitem"><a class="link" href="#RT_ST_SetGeoReference" title="ST_SetGeoReference">ST_SetGeoReference</a> - Enhanced: 2.1.0 ST_SetGeoReference(raster, double precision, ...)形式を追加しました。</li><li class="listitem"><a class="link" href="#RT_ST_SetValue" title="ST_SetValue">ST_SetValue</a> - Enhanced: 2.1.0 ST_SetValueでジオメトリを用いる形式が、ポイントだけでなくあらゆるジオメトリタイプに対応するようになりました。ジオメトリを用いる形式はST_SetValuesのgeomval[]を用いる形式をラップしたものです。</li><li class="listitem"><a class="link" href="#RT_ST_Slope" title="ST_Slope">ST_Slope</a> - Enhanced: 2.1.0 ST_MapAlgebra()を使用するようにし、units, scale, interpolate_nodata任意引数を追加しました。</li><li class="listitem"><a class="link" href="#RT_ST_StdDev4ma" title="ST_StdDev4ma">ST_StdDev4ma</a> - Enhanced: 2.1.0 二つ目の形式の追加</li><li class="listitem"><a class="link" href="#RT_ST_Sum4ma" title="ST_Sum4ma">ST_Sum4ma</a> - Enhanced: 2.1.0 二つ目の形式の追加</li><li class="listitem"><a class="link" href="#RT_ST_Transform" title="ST_Transform">ST_Transform</a> - Enhanced: 2.1.0 ST_Tranfrorm(rast, alignto)の形式を追加しました。</li><li class="listitem"><a class="link" href="#RT_ST_Union" title="ST_Union">ST_Union</a> - Enhanced: 2.1.0 速度が改善されました (完全にC言語で記述しました)</li><li class="listitem"><a class="link" href="#RT_ST_Union" title="ST_Union">ST_Union</a> - Enhanced: 2.1.0 ST_Union(rast) (一つ目の形式)で、全ての入力ラスタの全てのバンドを結合するようになりました。以前の版のPostGISでは、一つ目のバンドと仮定していました。</li><li class="listitem"><a class="link" href="#RT_ST_Union" title="ST_Union">ST_Union</a> - Enhanced: 2.1.0 ST_Union(rast, uniontype) (四つ目の形式)で、全ての入力ラスタの全てのバンドを結合するようになりました。</li><li class="listitem"><a class="link" href="#ST_AsGML" title="ST_AsGML">ST_AsGML</a> - Enhanced: 2.1.0 GML 3用にidが導入されました。</li><li class="listitem"><a class="link" href="#ST_Boundary" title="ST_Boundary">ST_Boundary</a> - Enhanced: 2.1.0で三角対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_Distance" title="ST_Distance">ST_Distance</a> - Enhanced: 2.1.0 ジオグラフィでの速度が改善されました。詳細はMaking Geography fasterをご覧ください。</li><li class="listitem"><a class="link" href="#ST_Distance" title="ST_Distance">ST_Distance</a> - Enhanced: 2.1.0 - 曲線ジオメトリ対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_DumpPoints" title="ST_DumpPoints">ST_DumpPoints</a> - Enhanced: 2.1.0 速度向上しました。C言語で実装しなおしました。</li><li class="listitem"><a class="link" href="#ST_Segmentize" title="ST_Segmentize">ST_Segmentize</a> - Enhanced: 2.1.0 ジオグラフィ対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_Summary" title="ST_Summary">ST_Summary</a> - Enhanced: 2.1.0 空間参照系を持つかを示すSフラグが追加されました。</li><li class="listitem"><a class="link" href="#toTopoGeom" title="toTopoGeom">toTopoGeom</a> - Enhanced: 2.1.0版では、既存のTopoGeometryを取る形式が追加されました。</li></ul></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="ChangedFunctions_2_1"></a>15.12.10. PostGIS 2.1で大幅に変更された関数</h3></div></div></div><p>次に示す関数は、PostGIS 2.1で、たぶん大幅に変更されたものです。これらを使用している場合には、既存のコードを確認する必要があるかも知れません。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#RT_ST_Aspect" title="ST_Aspect">ST_Aspect</a> - Changed: 2.1.0 以前の版では、返り値はラジアン単位でした。現在は、デフォルトでは度で返します。</li><li class="listitem"><a class="link" href="#RT_ST_HillShade" title="ST_HillShade">ST_HillShade</a> - Changed: 2.1.0 以前の版ではazimuthとaltitudeはラジアン単位で表現しました。現在はazimuthとaltitudeは度単位で表現します。</li><li class="listitem"><a class="link" href="#RT_ST_Intersects" title="ST_Intersects">ST_Intersects</a> - Changed: 2.1.0 ST_Intersects(raster, geometry)形式の挙動が ST_Intersects(geometry, raster)とあうように変更されました。 </li><li class="listitem"><a class="link" href="#RT_ST_PixelAsCentroids" title="ST_PixelAsCentroids">ST_PixelAsCentroids</a> - Changed: 2.1.1 exclude_nodata_valueの挙動を変更しました。</li><li class="listitem"><a class="link" href="#RT_ST_PixelAsPoints" title="ST_PixelAsPoints">ST_PixelAsPoints</a> - Changed: 2.1.1 exclude_nodata_valueの挙動を変更しました。</li><li class="listitem"><a class="link" href="#RT_ST_PixelAsPolygons" title="ST_PixelAsPolygons">ST_PixelAsPolygons</a> - Changed: 2.1.1 exclude_nodata_valueの挙動を変更しました。</li><li class="listitem"><a class="link" href="#RT_ST_Polygon" title="ST_Polygon">ST_Polygon</a> - Changed: 2.1.0 以前の版では、時々ポリゴンを返しましたが、常にマルチポリゴンを返すように変更しました。</li><li class="listitem"><a class="link" href="#RT_ST_RasterToWorldCoordX" title="ST_RasterToWorldCoordX">ST_RasterToWorldCoordX</a> - Changed: 2.1.0 以前の版ではST_Raster2WorldCoordXと呼ばれていました。</li><li class="listitem"><a class="link" href="#RT_ST_RasterToWorldCoordY" title="ST_RasterToWorldCoordY">ST_RasterToWorldCoordY</a> - Changed: 2.1.0 以前の版ではST_Raster2WorldCoordYと呼ばれていました。</li><li class="listitem"><a class="link" href="#RT_ST_Resample" title="ST_Resample">ST_Resample</a> - Changed: 2.1.0 srid引数を削除しました。参照ラスタを使う形式では、もはや参照ラスタのSRIDを適用しません。ラスタの投影変換にはST_Transform()を使います。SRIDなしで動作します。</li><li class="listitem"><a class="link" href="#RT_ST_Rescale" title="ST_Rescale">ST_Rescale</a> - Changed: 2.1.0 SRIDなしのラスタで動作するようになりました。</li><li class="listitem"><a class="link" href="#RT_ST_Reskew" title="ST_Reskew">ST_Reskew</a> - Changed: 2.1.0 SRIDなしのラスタで動作するようになりました。</li><li class="listitem"><a class="link" href="#RT_ST_Slope" title="ST_Slope">ST_Slope</a> - Changed: 2.1.0 以前の版では、返り値はラジアン単位でした。現在は、デフォルトでは度で返します。</li><li class="listitem"><a class="link" href="#RT_ST_SnapToGrid" title="ST_SnapToGrid">ST_SnapToGrid</a> - Changed: 2.1.0 SRIDなしのラスタで動作するようになりました。</li><li class="listitem"><a class="link" href="#RT_ST_WorldToRasterCoordX" title="ST_WorldToRasterCoordX">ST_WorldToRasterCoordX</a> - Changed: 2.1.0 以前の版ではST_World2RasterCoordXと呼ばれていました。</li><li class="listitem"><a class="link" href="#RT_ST_WorldToRasterCoordY" title="ST_WorldToRasterCoordY">ST_WorldToRasterCoordY</a> - Changed: 2.1.0 以前の版ではST_World2RasterCoordYと呼ばれていました。</li><li class="listitem"><a class="link" href="#ST_Force2D" title="ST_Force2D">ST_Force2D</a> - Changed: 2.1.0 2.0.xの間はST_Force_2Dと呼ばれていました。</li><li class="listitem"><a class="link" href="#ST_Force_3D" title="ST_Force3D">ST_Force3D</a> - Changed: 2.1.0 2.0.xの間はST_Force_3Dと呼ばれていました。</li><li class="listitem"><a class="link" href="#ST_Force_3DM" title="ST_Force3DM">ST_Force3DM</a> - Changed: 2.1.0 2.0.xの間はST_Force_3DMと呼ばれていました。</li><li class="listitem"><a class="link" href="#ST_Force_3DZ" title="ST_Force3DZ">ST_Force3DZ</a> - Changed: 2.1.0 2.0.xの間はST_Force_3DZと呼ばれていました。</li><li class="listitem"><a class="link" href="#ST_Force_4D" title="ST_Force4D">ST_Force4D</a> - Changed: 2.1.0 2.0.xの間はST_Force_4Dと呼ばれていました。</li><li class="listitem"><a class="link" href="#ST_Force_Collection" title="ST_ForceCollection">ST_ForceCollection</a> - Changed: 2.1.0 2.0.xの間はST_Force_Collectionと呼ばれていました。</li><li class="listitem"><a class="link" href="#ST_LineInterpolatePoint" title="ST_LineInterpolatePoint">ST_LineInterpolatePoint</a> - Changed: 2.1.0 2.0.xまでではST_Line_Interpolate_Pointと呼んでいました。</li><li class="listitem"><a class="link" href="#ST_LineLocatePoint" title="ST_LineLocatePoint">ST_LineLocatePoint</a> - Changed: 2.1.0 2.0.xまでではST_Line_Locate_Pointと呼んでいました。</li><li class="listitem"><a class="link" href="#ST_LineSubstring" title="ST_LineSubstring">ST_LineSubstring</a> - Changed: 2.1.0 2.0.xではST_Line_Substringと呼ばれていました。</li><li class="listitem"><a class="link" href="#ST_Segmentize" title="ST_Segmentize">ST_Segmentize</a> - Changed: 2.1.0 ジオグラフィ対応導入の結果として、SELECT ST_Segmentize('LINESTRING(1 2, 3 4)',0.5);では、あいまいな関数呼び出しエラーとなります。確実にタイプを指定したオブジェクトを持たせる必要があります。たとえば、ジオメトリ/ジオグラフィカラムであったり、ST_GeomFromText, ST_GeogFromTextを使ったり、SELECT ST_Segmentize('LINESTRING(1 2, 3 4)'::geometry,0.5);としたりします。</li></ul></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="NewFunctions_2_0"></a>15.12.11. PostGIS 2.0で新規作成/機能強化/変更された関数</h3></div></div></div><p>次に示す関数は、2.0リリースで新規作成/機能強化/大幅な変更 (<a class="xref" href="#NewFunctions_2_0_Changed" title="15.12.12. PostGIS 2.0で変更された関数">「PostGIS 2.0で変更された関数」</a>)がなされたPostGIS関数です。</p><p>新ジオメトリタイプ: TINと多面体サーフェスが2.0で導入されました。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>トポロジ機能の大幅な改良がありました。詳細情報については<a class="xref" href="#Topology" title="第10章 トポロジ">10章<i>トポロジ</i></a>を参照して下さい。</p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>PostGIS 2.0では、ラスタ型とラスタ機能がPostGISに統合されました。ここに一覧を出すには、新しいラスタ関数はあまりに多く、全ての関数が新しいので、有効なラスタ関数の詳細については<a class="xref" href="#RT_reference" title="第12章 ラスタ リファレンス">12章<i>ラスタ リファレンス</i></a>を参照して下さい。2.0より前では、raster_columnsとraster_overviewsは実際のテーブルでした。2.0リリースでビューに変更されました。<code class="varname">ST_AddRasterColumn</code>等の関数は削除され、<a class="xref" href="#RT_AddRasterConstraints" title="AddRasterConstraints">AddRasterConstraints</a>, <a class="xref" href="#RT_DropRasterConstraints" title="DropRasterConstraints">DropRasterConstraints</a>に置き換えられました。結果として、ラスタテーブルを生成するアプリケーションは変更が必要になるかも知れなくなりました。</p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Tigerジオコーダは、TIGER 2010センサスデータで動作するように更新され、PostGISの中核文書に入れられました。また、逆ジオコーダ関数が新規作成されました。詳細情報については<a class="xref" href="#Tiger_Geocoder" title="14.2. Tigerジオコーダ">「Tigerジオコーダ」</a>を参照して下さい。</p></td></tr></table></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#RT_Raster_Intersect" title="&amp;&amp;">&amp;&amp;</a> - Availability: 2.0.0 AのバウンディングボックスがBのバウンディングボックスとインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#geometry_overlaps_nd" title="&amp;&amp;&amp;">&amp;&amp;&amp;</a> - Availability: 2.0.0 Aのn次元バウンディングボックスがBのn次元バウンディングボックスとインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#geometry_distance_box" title="&lt;#&gt;">&lt;#&gt;</a> - Availability: 2.0.0 PostgreSQL 9.1以上でのみ有効です。 AのバウンディングボックスとBのバウンディングボックスの2次元距離を返します。</li><li class="listitem"><a class="link" href="#geometry_distance_knn" title="&lt;-&gt;">&lt;-&gt;</a> - Availability: 2.0.0 弱いKNNによって、実際の距離の代わりにジオメトリの重心による近傍が得られます。ポイントは確実な結果を得て、他のタイプは全て不確実な結果を得ます。PostgreSQL 9.1以上で有効です。 AとBの2次元距離を返します。</li><li class="listitem"><a class="link" href="#geometry_distance_box_nd" title="&lt;&lt;#&gt;&gt;">&lt;&lt;#&gt;&gt;</a> - Availability: 2.0.0 KNNはPostgreSQL 9.1以上でのみ有効です。 AのバウンディングボックスとBのバウンディングボックスのn次元距離を返します。</li><li class="listitem"><a class="link" href="#geometry_distance_centroid_nd" title="&lt;&lt;-&gt;&gt;">&lt;&lt;-&gt;&gt;</a> - Availability: 2.0.0 KNNはPostgreSQL 9.1以上でのみ有効です。 AのバウンディングボックスとBのバウンディングボックスのn次元距離を返します。</li><li class="listitem"><a class="link" href="#RT_Raster_Contained" title="@">@</a> - Availability: 2.0.0 raster @ raster, raster @ geometry が導入されました。 AのバウンディングボックスがBのバウンディングボックスに含まれる場合にTRUEを返します。倍精度浮動小数点数のバウンディングボックスを使います。</li><li class="listitem"><a class="link" href="#RT_Raster_Contained" title="@">@</a> - Availability: 2.0.5 geometry @ raster が導入されました。  AのバウンディングボックスがBのバウンディングボックスに含まれる場合にTRUEを返します。倍精度浮動小数点数のバウンディングボックスを使います。</li><li class="listitem"><a class="link" href="#AddEdge" title="AddEdge">AddEdge</a> - Availability: 2.0.0 指定したラインストリングジオメトリを使って、ラインストリングエッジをエッジテーブルに追加し、指定したトポロジスキーマの始点終点をポイントノードテーブルに追加し、新しい (または既存の)エッジの識別番号を返します。</li><li class="listitem"><a class="link" href="#AddFace" title="AddFace">AddFace</a> - Availability: 2.0.0 フェイスプリミティブをトポロジに登録し、その識別番号を得ます。</li><li class="listitem"><a class="link" href="#AddNode" title="AddNode">AddNode</a> - Availability: 2.0.0 指定したトポロジスキーマのノードテーブルにポイントノードを追加し、新しいノードの識別番号を返します。指定したポイントに既にノードがある場合は既存のノード識別番号を返します。</li><li class="listitem"><a class="link" href="#RT_AddOverviewConstraints" title="AddOverviewConstraints">AddOverviewConstraints</a> - Availability: 2.0.0 ラスタカラムに対して、他のオーバビューであることをタグ付けします。</li><li class="listitem"><a class="link" href="#RT_AddRasterConstraints" title="AddRasterConstraints">AddRasterConstraints</a> - Availability: 2.0.0 ロードされたラスタテーブルの特定のカラムにラスタ制約を追加します。制約には空間参照系、スケール、ブロックサイズ、アラインメント、バンド数、バンド型、ラスタカラムが規則正しいブロックかどうかを示すフラグがあります。テーブルは制約が推論されるためのデータがロードされなければなりません。制約の設定が完了するとtrueを返し、問題があると通知を返します。</li><li class="listitem"><a class="link" href="#AsGML" title="AsGML">AsGML</a> - Availability: 2.0.0  TopoGeometryのGML表現を返します。</li><li class="listitem"><a class="link" href="#CopyTopology" title="CopyTopology">CopyTopology</a> - Availability: 2.0.0 トポロジ構造 (ノード、エッジ、フェイス、レイヤ、TopoGeometry)を複写します。</li><li class="listitem"><a class="link" href="#RT_DropOverviewConstraints" title="DropOverviewConstraints">DropOverviewConstraints</a> - Availability: 2.0.0 ラスタカラムに対して他のオーバビューであることをタグ付けしているのを解除します。</li><li class="listitem"><a class="link" href="#RT_DropRasterConstraints" title="DropRasterConstraints">DropRasterConstraints</a> - Availability: 2.0.0 ラスタテーブルカラムを参照するPostGISラスタ制約を削除します。データの再読み込みやラスタカラムデータの更新の際に使えます。</li><li class="listitem"><a class="link" href="#Drop_Indexes_Generate_Script" title="Drop_Indexes_Generate_Script">Drop_Indexes_Generate_Script</a> - Availability: 2.0.0 tigerスキーマとユーザが指定したスキーマ上の、全ての主キーでなく、かつユニークでないインデックスを削除します。スキーマを指定しない場合のデフォルトスキーマは、tiger_dataです。</li><li class="listitem"><a class="link" href="#Drop_State_Tables_Generate_Script" title="Drop_State_Tables_Generate_Script">Drop_State_Tables_Generate_Script</a> - Availability: 2.0.0 指定したスキーマ内の、名前が州コードから始まるテーブルを全て削除するスクリプトを生成します。スキーマが指定されていない場合のデフォルトスキーマはtiger_dataです。</li><li class="listitem"><a class="link" href="#Geocode_Intersection" title="Geocode_Intersection">Geocode_Intersection</a> - Availability: 2.0.0 インタセクトする二つのストリート、州コード、市名、郵便番号を引数に取り、最初の交差点の可能性のある位置の集合を出力します。geomoutにNAD83経度緯度のポイント、normalized_addressにそれぞれの位置、ratingに評価値がそれぞれ入ります。評価値が低いほど合致度が高くなります。結果は評価値の低い順にソートされます。最大結果数を渡すことができ、デフォルトは10です。Tigerデータ (エッジ、フェイス、住所)と、PostgreSQLあいまい文字列合致 (soundex, levenshtein)を使います。</li><li class="listitem"><a class="link" href="#GetEdgeByPoint" title="GetEdgeByPoint">GetEdgeByPoint</a> - Availability: 2.0.0 与えられたポイントにインタセクトするエッジの識別番号を探索します。</li><li class="listitem"><a class="link" href="#GetFaceByPoint" title="GetFaceByPoint">GetFaceByPoint</a> - Availability: 2.0.0 与えたポイントとインタセクトするフェイスを見つけます。</li><li class="listitem"><a class="link" href="#GetNodeByPoint" title="GetNodeByPoint">GetNodeByPoint</a> - Availability: 2.0.0 ポイント位置にあるノードの識別番号を探索します。</li><li class="listitem"><a class="link" href="#GetNodeEdges" title="GetNodeEdges">GetNodeEdges</a> - Availability: 2.0  与えられたノードに付随するエッジの集合を整列して返します。</li><li class="listitem"><a class="link" href="#GetRingEdges" title="GetRingEdges">GetRingEdges</a> - Availability: 2.0.0  与えられた側を歩いて得られた、正負符号付きエッジ識別番号の集合を、順序通りに返します。</li><li class="listitem"><a class="link" href="#GetTopoGeomElements" title="GetTopoGeomElements">GetTopoGeomElements</a> - Availability: 2.0.0 与えられたTopoGeometry (プリミティブ要素)の、トポロジのelement_idとelement_typeを含むtopoelementオブジェクトの集合を返します。</li><li class="listitem"><a class="link" href="#GetTopologySRID" title="GetTopologySRID">GetTopologySRID</a> - Availability: 2.0.0 トポロジ名からtopology.topologyテーブル内にあるトポロジのSRIDを返します。</li><li class="listitem"><a class="link" href="#Get_Tract" title="Get_Tract">Get_Tract</a> - Availability: 2.0.0 ジオメトリで指定した位置の米国国勢調査統計区またはtractテーブルのフィールドを返します。デフォルトでは、統計区の短縮名を返します。</li><li class="listitem"><a class="link" href="#Install_Missing_Indexes" title="Install_Missing_Indexes">Install_Missing_Indexes</a> - Availability: 2.0.0 ジオコーダで結合や検索条件に使われ、インデックスが付いていなキーカラムを持つ全てのテーブルを探し、インデックスを追加します。</li><li class="listitem"><a class="link" href="#Loader_Generate_Census_Script" title="Loader_Generate_Census_Script">Loader_Generate_Census_Script</a> - Availability: 2.0.0  指定した州について、tract (統計区)、bg (block group, 細分区グループ)、tabblock (ブロック)をダウンロードし、tiger_dataに格納するための、指定したプラットフォーム用のシェルスクリプトを生成します。行ごとに州ごとのスクリプトが返されます。</li><li class="listitem"><a class="link" href="#Loader_Generate_Script" title="Loader_Generate_Script">Loader_Generate_Script</a> - Availability: 2.0.0 Tiger 2010構造のデータに対応しました。国勢統計区 (tract)、細分区グループ ("block groups", bg)、細分区 (tabblocks)テーブルをダウンロードします。 指定したプラットフォーム用の、指定した州のTigerデータをダウンロードし、格納準備を行い、tiger_dataスキーマに格納するシェルスクリプトを生成します。行ごとに州ごとのスクリプトが返ります。最新版ではTiger 2010のデータ構造変更に対応していて、国勢統計区、細分区グループ、細分区 (tabblocks)テーブルをダウンロードすることができます。</li><li class="listitem"><a class="link" href="#Missing_Indexes_Generate_Script" title="Missing_Indexes_Generate_Script">Missing_Indexes_Generate_Script</a> - Availability: 2.0.0 ジオコーダで結合に使われるキーカラムを持ち、インデックスが付いていないキーカラムを持つすべてのテーブルを検索し、インデックスを追加するSQLデータ定義言語を出力します。</li><li class="listitem"><a class="link" href="#TopologyPolygonize" title="Polygonize">Polygonize</a> - Availability: 2.0.0 トポロジエッジで定義される全てのフェイスを探索し、追加します。</li><li class="listitem"><a class="link" href="#Reverse_Geocode" title="Reverse_Geocode">Reverse_Geocode</a> - Availability: 2.0.0  登録されている空間参照系に基づくポイントジオメトリを引数に取り、理論的に可能性のある住所の配列と交差するストリートの配列を一つのレコードで返します。include_strnum_range = trueの場合には、交差するストリートに番地範囲を追加します。</li><li class="listitem"><a class="link" href="#ST_3DClosestPoint" title="ST_3DClosestPoint">ST_3DClosestPoint</a> - Availability: 2.0.0 g1上の、g2に最も近い3次元ポイントを返します。これは3次元の最短ラインの始点です。</li><li class="listitem"><a class="link" href="#ST_3DDistance" title="ST_3DDistance">ST_3DDistance</a> - Availability: 2.0.0 投影座標系の単位で、二つのジオメトリ間の3次元デカルト距離の最小値を返します (空間参照系に基づきます)。</li><li class="listitem"><a class="link" href="#ST_3DLongestLine" title="ST_3DLongestLine">ST_3DLongestLine</a> - Availability: 2.0.0 二つのジオメトリ間の3次元最長ラインを返します。</li><li class="listitem"><a class="link" href="#ST_3DMaxDistance" title="ST_3DMaxDistance">ST_3DMaxDistance</a> - Availability: 2.0.0 二つのジオメトリ間の3次元最大デカルト距離 (空間参照系に基づく)を空間参照系の単位で返します。</li><li class="listitem"><a class="link" href="#ST_3DShortestLine" title="ST_3DShortestLine">ST_3DShortestLine</a> - Availability: 2.0.0 二つのジオメトリの3次元の最短ラインを返します。</li><li class="listitem"><a class="link" href="#ST_AddEdgeModFace" title="ST_AddEdgeModFace">ST_AddEdgeModFace</a> - Availability: 2.0  新しいエッジを追加します。新しいエッジがフェイスを分割する場合には、もとのフェイスを編集し、一つのフェイスを追加します。</li><li class="listitem"><a class="link" href="#ST_AddEdgeNewFaces" title="ST_AddEdgeNewFaces">ST_AddEdgeNewFaces</a> - Availability: 2.0  新しいエッジを追加します。新しいエッジがフェイスを分割する場合には、もとのフェイスを削除して、分割した二つのフェイスに置き換えます。</li><li class="listitem"><a class="link" href="#RT_ST_AsGDALRaster" title="ST_AsGDALRaster">ST_AsGDALRaster</a> - Availability: 2.0.0 - GDAL 1.6.0以上が必要です。  指定されたGDALラスタ書式でラスタタイルを返します。ラスタ書式はコンパイルしたライブラリが対応するものです。ライブラリが対応する書式の一覧を得るにはST_GDALRasters()を使います。</li><li class="listitem"><a class="link" href="#RT_ST_AsJPEG" title="ST_AsJPEG">ST_AsJPEG</a> - Availability: 2.0.0 - GDAL 1.6.0以上が必要です。  ラスタの選択されたバンドを、単一のJoint Photographic Exports Group (JPEG)画像としてバイト配列で返します。バンドを指定せず、1バンドか3より多いバンドがある場合には、1番バンドを使用します。3バンドのみ指定した場合には、3バンドを使用し、RGBに対応付けます。</li><li class="listitem"><a class="link" href="#ST_AsLatLonText" title="ST_AsLatLonText">ST_AsLatLonText</a> - Availability: 2.0 与えられたポイントの度・分・秒表現を返します。</li><li class="listitem"><a class="link" href="#RT_ST_AsPNG" title="ST_AsPNG">ST_AsPNG</a> - Availability: 2.0.0 - GDAL 1.6.0以上が必要です。  ラスタの選択されたバンドを、単一のportable network graphics (PNG)画像としてバイト配列で返します。バンドを指定せず、1バンドか3バンドか4バンドある場合には、全てのバンドを使用します。バンドを指定せず、2バンドか4より多いバンドがある場合には、1番バンドを使用します。対象バンドはRGBまたはRGBAに対応付けられます。</li><li class="listitem"><a class="link" href="#RT_ST_AsRaster" title="ST_AsRaster">ST_AsRaster</a> - Availability: 2.0.0 - GDAL 1.6.0以上が必要です。  PostGISジオメトリをPostGISラスタに変換します。</li><li class="listitem"><a class="link" href="#RT_ST_AsTIFF" title="ST_AsTIFF">ST_AsTIFF</a> - Availability: 2.0.0 - GDAL 1.6.0以上が必要です。  ラスタの選択されたバンドを、単一のTIFF画像 (バイト配列)として返します。バンドを指定しないか指定したバンドがラスタ内に無い場合には、全てのバンドの使用を試みます。</li><li class="listitem"><a class="link" href="#ST_AsX3D" title="ST_AsX3D">ST_AsX3D</a> - Availability: 2.0.0: ISO-IEC-19776-1.2-X3DEncodings-XML ジオメトリをX3Dノード要素書式　(ISO-IEC-19776-1.2-X3DEncodings-XML)で返します。</li><li class="listitem"><a class="link" href="#RT_ST_Aspect" title="ST_Aspect">ST_Aspect</a> - Availability: 2.0.0  標高ラスタバンドの傾斜方向 (デフォルトの単位は度)を返します。地形解析に使えます。</li><li class="listitem"><a class="link" href="#RT_ST_Band" title="ST_Band">ST_Band</a> - Availability: 2.0.0 既存のラスタの、一つ以上のバンドを新しいラスタとして返します。既存のラスタから新しいラスタを構築する際に使えます。</li><li class="listitem"><a class="link" href="#RT_ST_BandIsNoData" title="ST_BandIsNoData">ST_BandIsNoData</a> - Availability: 2.0.0 指定したバンドがNODATA値だけで満たされている場合には、TRUEを返します。</li><li class="listitem"><a class="link" href="#RT_ST_Clip" title="ST_Clip">ST_Clip</a> - Availability: 2.0.0  入力ジオメトリで切り取ったラスタを返します。バンドが指定されていない場合には、全てのバンドが返されます。cropが指定されていない場合には、TRUEと仮定され、出力ラスタをクロップします。</li><li class="listitem"><a class="link" href="#ST_CollectionHomogenize" title="ST_CollectionHomogenize">ST_CollectionHomogenize</a> - Availability: 2.0.0 ジオメトリコレクションを与えると、最も単純な表現を返します。</li><li class="listitem"><a class="link" href="#ST_ConcaveHull" title="ST_ConcaveHull">ST_ConcaveHull</a> - Availability: 2.0.0 全ての入力ジオメトリの頂点を囲むことができる凹多角形のジオメトリを計算します。</li><li class="listitem"><a class="link" href="#RT_ST_Count" title="ST_Count">ST_Count</a> - Availability: 2.0.0  ラスタまたはラスタカバレッジの指定したバンドのピクセル数を返します。バンドを指定しない場合には、1番と仮定します。exclude_nodata_valueをTRUEに設定している場合には、NODATA値と等しくないピクセルのみを数えます。</li><li class="listitem"><a class="link" href="#ST_CreateTopoGeo" title="ST_CreateTopoGeo">ST_CreateTopoGeo</a> - Availability: 2.0  空のトポロジにジオメトリのコレクションを追加し、成否を示すメッセージを返します。</li><li class="listitem"><a class="link" href="#RT_ST_Distinct4ma" title="ST_Distinct4ma">ST_Distinct4ma</a> - Availability: 2.0.0 近隣のピクセル値のうち一意となるものを数えるラスタ処理関数です。</li><li class="listitem"><a class="link" href="#ST_FlipCoordinates" title="ST_FlipCoordinates">ST_FlipCoordinates</a> - Availability: 2.0.0 X値とY値を入れ替えたジオメトリを返します。</li><li class="listitem"><a class="link" href="#RT_ST_GDALDrivers" title="ST_GDALDrivers">ST_GDALDrivers</a> - Availability: 2.0.0 - GDAL 1.6.0以上が必要です。  使用しているGDALライブラリが対応するラスタ書式の一覧を返します。この一覧でcan_write=TrueとなっているものだけがST_AsGDALRasterで使えます。</li><li class="listitem"><a class="link" href="#ST_GetFaceEdges" title="ST_GetFaceEdges">ST_GetFaceEdges</a> - Availability: 2.0  順序番号を含む、afaceの境界となる、整列したエッジの集合を返します。</li><li class="listitem"><a class="link" href="#RT_ST_HasNoBand" title="ST_HasNoBand">ST_HasNoBand</a> - Availability: 2.0.0 指定したバンド番号のバンドが無い場合には、TRUEを返します。バンド番号を指定していない場合には、1番と仮定します。</li><li class="listitem"><a class="link" href="#RT_ST_HillShade" title="ST_HillShade">ST_HillShade</a> - Availability: 2.0.0  与えられた方位、高度、明度、スケールの入力を使って標高ラスタバンドの仮想照明を返します。</li><li class="listitem"><a class="link" href="#RT_ST_Histogram" title="ST_Histogram">ST_Histogram</a> - Availability: 2.0.0  ラスタまたはラスタカバレッジのビン範囲で分割したデータ分布をまとめるヒストグラムの集合を返します。ビン数を指定しない場合には自動計算されます。</li><li class="listitem"><a class="link" href="#ST_InterpolatePoint" title="ST_InterpolatePoint">ST_InterpolatePoint</a> - Availability: 2.0.0 ジオメトリのポイントに最も近いポイント上の補間M値を返します。</li><li class="listitem"><a class="link" href="#RT_ST_IsEmpty" title="ST_IsEmpty">ST_IsEmpty</a> - Availability: 2.0.0 ラスタが空 (幅が0で高さが0)の場合にはTRUEを返します。他の場合には、FALSEを返します。</li><li class="listitem"><a class="link" href="#ST_MakeLine" title="ST_MakeLine">ST_MakeLine</a> - Availability: 2.0.0 - LINESTRING入力要素への対応が導入されました POINT、MULTIPOINT、LINESTRINGからLINESTRINGを生成します。</li><li class="listitem"><a class="link" href="#RT_ST_MapAlgebraExpr" title="ST_MapAlgebraExpr">ST_MapAlgebraExpr</a> - Availability: 2.0.0  1バンド版: 入力バンドに対する妥当なPostgreSQL代数演算で形成された、指定したピクセルタイプとなる1バンドラスタを生成します。バンドを指定しない場合には、1番を仮定します。</li><li class="listitem"><a class="link" href="#RT_ST_MapAlgebraExpr2" title="ST_MapAlgebraExpr">ST_MapAlgebraExpr</a> - Availability: 2.0.0  2バンド版: 二つの入力バンドに対する妥当なPostgreSQL代数演算で形成された、指定したピクセルタイプとなる1バンドラスタを生成します。バンドを指定しない場合には、どちらも1番と仮定します。結果ラスタは、一つ目のラスタのアラインメント (スケール、スキュー、ピクセル角位置)にあわされます。範囲は"extenttype"引数で定義されます。取りうる"extenttype"の値はINTERSECTION, UNION, FIRST, SECONDです。</li><li class="listitem"><a class="link" href="#RT_ST_MapAlgebraFct" title="ST_MapAlgebraFct">ST_MapAlgebraFct</a> - Availability: 2.0.0 1バンド版 - 入力バンドに対する妥当なPostgreSQL関数で形成された、指定したピクセルタイプとなる1バンドラスタを生成します。バンドを指定しない場合には、1番と仮定します。</li><li class="listitem"><a class="link" href="#RT_ST_MapAlgebraFct2" title="ST_MapAlgebraFct">ST_MapAlgebraFct</a> - Availability: 2.0.0 2バンド版 - 二つの入力バンドに対する妥当なPostgreSQL関数で形成された、指定したピクセルタイプとなる1バンドラスタを生成します。バンドを指定しない場合には、1番と仮定します。"extenttype"のデフォルトはINTERSECTIONです。</li><li class="listitem"><a class="link" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a> - Availability: 2.0.0  1バンド版: ユーザ定義PostgreSQL関数を使用する最近傍地図代数関数です。入力ラスタバンドの近傍の値を与えたPL/pgSQLユーザ定義関数の結果からなるラスタを返します。</li><li class="listitem"><a class="link" href="#RT_ST_Max4ma" title="ST_Max4ma">ST_Max4ma</a> - Availability: 2.0.0 近隣のピクセル値の最大値を計算するラスタ処理関数です。</li><li class="listitem"><a class="link" href="#RT_ST_Mean4ma" title="ST_Mean4ma">ST_Mean4ma</a> - Availability: 2.0.0 近隣のピクセル値の平均値を計算するラスタ処理関数です。</li><li class="listitem"><a class="link" href="#RT_ST_Min4ma" title="ST_Min4ma">ST_Min4ma</a> - Availability: 2.0.0 近隣のピクセル値の最小値を計算するラスタ処理関数です。</li><li class="listitem"><a class="link" href="#ST_ModEdgeHeal" title="ST_ModEdgeHeal">ST_ModEdgeHeal</a> - Availability: 2.0 二つのエッジについて、接続しているノードを削除して修復します。1番目のエッジを編集して、2番目のエッジを削除します。削除されたノードの識別番号を返します。</li><li class="listitem"><a class="link" href="#ST_MoveIsoNode" title="ST_MoveIsoNode">ST_MoveIsoNode</a> - Availability: 2.0.0  トポロジ内の孤立ノードを別の位置に移動させます。新しいapointジオメトリがノードとして存在しているなら、エラーが投げられます。移動に関する説明を返します。</li><li class="listitem"><a class="link" href="#ST_NewEdgeHeal" title="ST_NewEdgeHeal">ST_NewEdgeHeal</a> - Availability: 2.0 二つのエッジについて、接続しているノードを削除して修復します。両方のエッジを削除し、1番目のエッジと同じ方向のエッジに置き換えます。</li><li class="listitem"><a class="link" href="#ST_NumPatches" title="ST_NumPatches">ST_NumPatches</a> - Availability: 2.0.0 多面体サーフェスのフェイス数を返します。多面体でないジオメトリの場合にはNULLを返します。</li><li class="listitem"><a class="link" href="#ST_OffsetCurve" title="ST_OffsetCurve">ST_OffsetCurve</a> - Availability: 2.0 与えられた距離と方面に入力ラインをずらしたラインを返します。</li><li class="listitem"><a class="link" href="#ST_PatchN" title="ST_PatchN">ST_PatchN</a> - Availability: 2.0.0 多面体サーフェスのN番目のジオメトリ (フェイス)を返します。</li><li class="listitem"><a class="link" href="#ST_Perimeter" title="ST_Perimeter">ST_Perimeter</a> - Availability: 2.0.0 ジオグラフィ対応が導入されました。 ポリゴンジオメトリまたはジオグラフィの境界の長さを返します。</li><li class="listitem"><a class="link" href="#RT_ST_PixelAsPolygon" title="ST_PixelAsPolygon">ST_PixelAsPolygon</a> - Availability: 2.0.0 指定した行と列のピクセルの境界となるジオメトリを返します。</li><li class="listitem"><a class="link" href="#RT_ST_PixelAsPolygons" title="ST_PixelAsPolygons">ST_PixelAsPolygons</a> - Availability: 2.0.0 全てのピクセルについて境界となるジオメトリを、ピクセルごとのピクセル値とラスタ座標系のXとYとを付けて返します。</li><li class="listitem"><a class="link" href="#ST_Project" title="ST_Project">ST_Project</a> - Availability: 2.0.0 始点から距離と方位で算出されたポイントを返します。</li><li class="listitem"><a class="link" href="#RT_ST_Quantile" title="ST_Quantile">ST_Quantile</a> - Availability: 2.0.0  ラスタまたはラスタテーブルカバレッジのサンプルまたは母集団の分位数を計算します。値がラスタの25%,50%,75%にあるかを調べることができます。</li><li class="listitem"><a class="link" href="#RT_ST_Range4ma" title="ST_Range4ma">ST_Range4ma</a> - Availability: 2.0.0 近隣のピクセル値の範囲を計算するラスタ処理関数です。</li><li class="listitem"><a class="link" href="#RT_ST_Reclass" title="ST_Reclass">ST_Reclass</a> - Availability: 2.0.0  元のラスタから再分類したバンドタイプからなるラスタを生成します。nbandは変更するバンドです。nbandが指定されていない場合には、1と仮定します。他の全てのバンドは変更せずに返します。可視画像の書式としてより単純な描画を行うために、16BUIバンドを8BUIバンドに変換する、等のために使います。</li><li class="listitem"><a class="link" href="#ST_RemEdgeModFace" title="ST_RemEdgeModFace">ST_RemEdgeModFace</a> - Availability: 2.0  エッジを削除し、削除対象エッジでフェイスが二つに分割されているなら、両方の空間をとるため、一つを削除して、もう一つを編集します。</li><li class="listitem"><a class="link" href="#ST_RemEdgeNewFace" title="ST_RemEdgeNewFace">ST_RemEdgeNewFace</a> - Availability: 2.0  エッジを削除し、消去対象エッジでフェイスが二つに分割されているなら元の二つのフェイスを削除し、一つの新しいフェイスに置き換えます。</li><li class="listitem"><a class="link" href="#RT_ST_Resample" title="ST_Resample">ST_Resample</a> - Availability: 2.0.0 GDAL 1.6.1以上が必要です。 指定したリサンプリングアルゴリズム、新しいピクセル範囲、グリッドの隅、定義するか他のラスタから借りてきた地理参照属性を使ってリサンプリングを行います。</li><li class="listitem"><a class="link" href="#RT_ST_Rescale" title="ST_Rescale">ST_Rescale</a> - Availability: 2.0.0 GDAL 1.6.1以上が必要です。 スケール (ピクセルサイズ)だけを調整するリサンプリングを行います。新しいピクセル値のリサンプリングアルゴリズムとして最近傍補間 ('NearestNeighbor' (米式綴り方))、双線形補間 ('Bilinear')、3次補間 ('Cubic')、3次スプライン補間 ('CubicSpline')、ランチョス補間 ('Lanczos')を用います。デフォルトは最近傍補間です。</li><li class="listitem"><a class="link" href="#RT_ST_Reskew" title="ST_Reskew">ST_Reskew</a> - Availability: 2.0.0 GDAL 1.6.1以上が必要です。 キュー (回転パラメタ)だけを調整するリサンプリングを行います。新しいピクセル値のリサンプリングアルゴリズムとして最近傍補間 ('NearestNeighbor' (米式綴り方))、双線形補間 ('Bilinear')、3次補間 ('Cubic')、3次スプライン補間 ('CubicSpline')、ランチョス補間 ('Lanczos')を用います。デフォルトは最近傍補間です。</li><li class="listitem"><a class="link" href="#RT_ST_SameAlignment" title="ST_SameAlignment">ST_SameAlignment</a> - Availability: 2.0.0 ラスタが同じスキュー、スケール、空間参照系、オフセットを持つ (ピクセルが分割されることなく同じグリッドに置かれている)場合にTRUEを返し、そうでない場合は問題を詳述する通知とともにFALSEを返します。</li><li class="listitem"><a class="link" href="#RT_ST_SetBandIsNoData" title="ST_SetBandIsNoData">ST_SetBandIsNoData</a> - Availability: 2.0.0 バンドのisnodataフラグをTRUEにします。</li><li class="listitem"><a class="link" href="#ST_SharedPaths" title="ST_SharedPaths">ST_SharedPaths</a> - Availability: 2.0.0 二つのLINESTRING/MULTILINESTRINGの入力が共有するパスのコレクションを返します。</li><li class="listitem"><a class="link" href="#RT_ST_Slope" title="ST_Slope">ST_Slope</a> - Availability: 2.0.0  標高ラスタバンドの傾斜角 (デフォルトでは度単位)を返します。地形解析に使えます。</li><li class="listitem"><a class="link" href="#ST_Snap" title="ST_Snap">ST_Snap</a> - Availability: 2.0.0 入力ジオメトリの辺と頂点を参照ジオメトリの頂点にスナップします。</li><li class="listitem"><a class="link" href="#RT_ST_SnapToGrid" title="ST_SnapToGrid">ST_SnapToGrid</a> - Availability: 2.0.0 GDAL 1.6.1以上が必要です。 グリッドにスナップすることでラスタをリサンプリングします。新しいピクセル値のリサンプリングアルゴリズムとして最近傍補間 ('NearestNeighbor' (米式綴り方))、双線形補間 ('Bilinear')、3次補間 ('Cubic')、3次スプライン補間 ('CubicSpline')、ランチョス補間('Lanczos')を用います。デフォルトは最近傍補間です。</li><li class="listitem"><a class="link" href="#RT_ST_StdDev4ma" title="ST_StdDev4ma">ST_StdDev4ma</a> - Availability: 2.0.0 近隣のピクセル値の標準偏差を計算するラスタ処理関数です。</li><li class="listitem"><a class="link" href="#RT_ST_Sum4ma" title="ST_Sum4ma">ST_Sum4ma</a> - Availability: 2.0.0 近隣のピクセル値の合計を計算するラスタ処理関数です。</li><li class="listitem"><a class="link" href="#RT_ST_SummaryStats" title="ST_SummaryStats">ST_SummaryStats</a> - Availability: 2.0.0  ラスタまたはラスタカバレッジの指定したバンドについて、ピクセル数、合計値、平均値、標準偏差、最小値、最大値からなる統計情報の概要を返します。バンドを指定しない場合には、1番と仮定します。</li><li class="listitem"><a class="link" href="#RT_ST_Transform" title="ST_Transform">ST_Transform</a> - Availability: 2.0.0 GDAL 1.6.1以上が必要です。 ラスタを既知の空間参照系から他の既知の空間参照系に、指定したリサンプリングアルゴリズムで投影変換します。新しいピクセル値のリサンプリングアルゴリズムとして最近傍補間 ('NearestNeighbor' (米式綴り方))、双線形補間 ('Bilinear')、3次補間 ('Cubic')、3次スプライン補間 ('CubicSpline')、ランチョス補間 ('Lanczos')を用います。デフォルトは最近傍補間です。</li><li class="listitem"><a class="link" href="#RT_ST_Union" title="ST_Union">ST_Union</a> - Availability: 2.0.0  ラスタタイルの集合を結合して1以上のバンドからなる単一ラスタを返します。</li><li class="listitem"><a class="link" href="#RT_ST_ValueCount" title="ST_ValueCount">ST_ValueCount</a> - Availability: 2.0.0  ラスタ　(またはラスタカバレッジ)の指定されたバンドで、指定した値を持つピクセルを対象として、ピクセルバンド値とピクセル数からなるレコードの集合を返します。バンドを指定しない場合には、1番と仮定します。デフォルトではNODATA値のピクセルは数えられず、ピクセルの他の値は出力され、ピクセルバンド値は最も近い整数に丸められます。</li><li class="listitem"><a class="link" href="#TopoElementArray_Agg" title="TopoElementArray_Agg">TopoElementArray_Agg</a> - Availability: 2.0.0 element_idとタイプの配列 (topoelements)からなるtopoelementarrayを返します。</li><li class="listitem"><a class="link" href="#TopoGeo_AddLineString" title="TopoGeo_AddLineString">TopoGeo_AddLineString</a> - Availability: 2.0.0 許容差を使って既存のトポロジにラインストリングを追加し、可能ならエッジ/フェイスを分割します。エッジ識別番号を返します。</li><li class="listitem"><a class="link" href="#TopoGeo_AddPoint" title="TopoGeo_AddPoint">TopoGeo_AddPoint</a> - Availability: 2.0.0 許容差を使って既存のトポロジにポイントを追加し、可能ならエッジを分割します。</li><li class="listitem"><a class="link" href="#TopoGeo_AddPolygon" title="TopoGeo_AddPolygon">TopoGeo_AddPolygon</a> - Availability: 2.0.0 許容差を使って既存のトポロジにラインストリングを追加し、可能ならエッジ/フェイスを分割します。エッジ識別番号を返します。</li><li class="listitem"><a class="link" href="#TopologySummary" title="TopologySummary">TopologySummary</a> - Availability: 2.0.0 トポロジ名を取り、トポロジ内のオブジェクトの型に関する概要の全体を提供します。</li><li class="listitem"><a class="link" href="#Topology_Load_Tiger" title="Topology_Load_Tiger">Topology_Load_Tiger</a> - Availability: 2.0.0  Tigerデータの定義領域をPostGISトポロジにロードして、Tigerデータをトポロジの空間参照系に投影変換し、トポロジの許容精度にスナップします。</li><li class="listitem"><a class="link" href="#toTopoGeom" title="toTopoGeom">toTopoGeom</a> - Availability: 2.0 単純なジオメトリからTopoGeometryを生成します。</li><li class="listitem"><a class="link" href="#RT_Raster_Contains" title="~">~</a> - Availability: 2.0.0 AのバウンディングボックスがBのバウンディングボックスを含む場合にTRUEを返します。倍精度浮動小数点数のバウンディングボックスを使います。</li><li class="listitem"><a class="link" href="#RT_Raster_Same" title="~=">~=</a> - Availability: 2.0.0 AのバウンディングボックスがBのバウンディングボックスと同じ場合にTRUEを返します。</li></ul></div><p>PostGIS 2.0で機能強化された関数</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#AddGeometryColumn" title="AddGeometryColumn">AddGeometryColumn</a> - Enhanced: 2.0.0 use_typmod引数が導入されました。デフォルトでは制約を基にしたものでなくtypmodジオメトリカラムが生成されます。</li><li class="listitem"><a class="link" href="#Geocode" title="Geocode">Geocode</a> - Enhanced: 2.0.0 Tiger 2010構造のデータに対応しました。実行速度とジオコーディング精度を改善し、ストリート住所の位置を中心線から側線に移動するための改訂を行いました。また、良い結果の数を指定したり、最も良い結果だけを返すようにするのに使う新しいパラメータmax_resultsを導入しました。</li><li class="listitem"><a class="link" href="#GeometryType" title="GeometryType">GeometryType</a> - Enhanced: 2.0.0 多面体サーフェス対応、三角対応、TIN対応が導入されました。</li><li class="listitem"><a class="link" href="#Populate_Geometry_Columns" title="Populate_Geometry_Columns">Populate_Geometry_Columns</a> - Enhanced: 2.0.0 use_typmod任意引数が導入されました。カラムが型修飾子で生成されるか制約チェックで作られるかの制御ができます。</li><li class="listitem"><a class="link" href="#RT_ST_Intersection" title="ST_Intersection">ST_Intersection</a> - Enhanced: 2.0.0 - ラスタ空間のインタセクションが導入されました。2.0.0より前の版では、ベクタ空間でのインタセクションの計算のみに対応していました。 </li><li class="listitem"><a class="link" href="#RT_ST_Intersects" title="ST_Intersects">ST_Intersects</a> - Enhanced: 2.0.0 ラスタ/ラスタのインタセクト対応が導入されました。 </li><li class="listitem"><a class="link" href="#RT_ST_Value" title="ST_Value">ST_Value</a> - Enhanced: 2.0.0 任意引数exclude_nodata_valueが追加されました。</li><li class="listitem"><a class="link" href="#ST_Area" title="ST_Area">ST_Area</a> - Enhanced: 2.0.0 - 2次元多面体サーフェス対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_AsBinary" title="ST_AsBinary">ST_AsBinary</a> - Enhanced: 2.0.0 多面体サーフェス対応、三角対応、TIN対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_AsBinary" title="ST_AsBinary">ST_AsBinary</a> - Enhanced: 2.0.0 高次元が導入されました。</li><li class="listitem"><a class="link" href="#ST_AsBinary" title="ST_AsBinary">ST_AsBinary</a> - Enhanced: 2.0.0 ジオグラフィでのエンディアン指定が導入されました。</li><li class="listitem"><a class="link" href="#ST_AsEWKB" title="ST_AsEWKB">ST_AsEWKB</a> - Enhanced: 2.0.0 多面体サーフェス対応、三角対応、TIN対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a> - Enhanced: 2.0.0 ジオグラフィ対応、多面体サーフェス対応、三角形対応、TIN対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_AsGML" title="ST_AsGML">ST_AsGML</a> - Enhanced: 2.0.0 プレフィクスが導入されました。 GML 3用であるoptionsの4は、曲線のかわりにラインストリングを使えるようにするためのものです。GML 3の多面体サーフェスとTINが導入されました。optionsの32はボックスを出力するために導入されました。</li><li class="listitem"><a class="link" href="#ST_AsKML" title="ST_AsKML">ST_AsKML</a> - Enhanced: 2.0.0 - プレフィクス名前空間を追加しました。デフォルトではプリフィクス無しです。</li><li class="listitem"><a class="link" href="#ST_Azimuth" title="ST_Azimuth">ST_Azimuth</a> - Enhanced: 2.0.0 ジオグラフィ対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_ChangeEdgeGeom" title="ST_ChangeEdgeGeom">ST_ChangeEdgeGeom</a> - Enhanced: 2.0.0版で、トポロジ整合性の強制を追加しました。 </li><li class="listitem"><a class="link" href="#ST_Dimension" title="ST_Dimension">ST_Dimension</a> - Enhanced: 2.0.0 多面体サーフェス対応とTIN対応が導入されました。空ジオメトリを与えた場合に例外を投げなくなりました。</li><li class="listitem"><a class="link" href="#ST_Dump" title="ST_Dump">ST_Dump</a> - Enhanced: 2.0.0 多面体サーフェス対応、三角対応、TIN対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_DumpPoints" title="ST_DumpPoints">ST_DumpPoints</a> - Enhanced: 2.0.0 多面体サーフェス対応、三角対応、TIN対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_Force2D" title="ST_Force2D">ST_Force2D</a> - Enhanced: 2.0.0 多面体サーフェス対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_ForceRHR" title="ST_ForceRHR">ST_ForceRHR</a> - Enhanced: 2.0.0 多面体サーフェス対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_Force_3D" title="ST_Force3D">ST_Force3D</a> - Enhanced: 2.0.0 多面体サーフェス対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_Force_3DZ" title="ST_Force3DZ">ST_Force3DZ</a> - Enhanced: 2.0.0 多面体サーフェス対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_Force_Collection" title="ST_ForceCollection">ST_ForceCollection</a> - Enhanced: 2.0.0 多面体サーフェス対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_GeometryN" title="ST_GeometryN">ST_GeometryN</a> - Enhanced: 2.0.0 多面体サーフェス対応、三角対応、TIN対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_GeometryType" title="ST_GeometryType">ST_GeometryType</a> - Enhanced: 2.0.0 多面体サーフェス対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_IsClosed" title="ST_IsClosed">ST_IsClosed</a> - Enhanced: 2.0.0 多面体サーフェス対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_MakeEnvelope" title="ST_MakeEnvelope">ST_MakeEnvelope</a> - Enhanced: 2.0 SRID指定なしでエンベロープを指定できるようになりました。</li><li class="listitem"><a class="link" href="#ST_NPoints" title="ST_NPoints">ST_NPoints</a> - Enhanced: 2.0.0 多面体サーフェス対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_NumGeometries" title="ST_NumGeometries">ST_NumGeometries</a> - Enhanced: 2.0.0 多面体サーフェス対応、三角対応、TIN対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_Shift_Longitude" title="ST_ShiftLongitude">ST_ShiftLongitude</a> - Enhanced: 2.0.0 多面体サーフェス対応とTIN対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_Summary" title="ST_Summary">ST_Summary</a> - Enhanced: 2.0.0でジオグラフィ対応が追加されました。</li><li class="listitem"><a class="link" href="#ValidateTopology" title="ValidateTopology">ValidateTopology</a> - Enhanced: 2.0.0では、より効果的なエッジ交差検出が可能になり、以前の版で残っていた偽陽性を解決しています。</li><li class="listitem"><a class="link" href="#geometry_overlaps" title="&amp;&amp;">&amp;&amp;</a> - Enhanced: 2.0.0 多面体サーフェス対応が導入されました。</li></ul></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="NewFunctions_2_0_Changed"></a>15.12.12. PostGIS 2.0で変更された関数</h3></div></div></div><p>次に示す関数は、PostGIS2.0で変更されたもので、アプリケーションの変更が必要になる場合があります。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ほとんどの非推奨関数は削除されました。これらは、1.2から文書には出ていないか、絶対に文書化されない内部関数です。文書に無い関数を使用している場合には、非推奨関数になっているか、非推奨になろうとしているか、内部関数の可能性があります。これらは避けるべきです。非推奨関数を使っているアプリケーションやツールの対応に関する詳細情報については<a class="xref" href="#legacy_faq" title="9.2.">問： 9.2</a>をご覧下さい。</p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ジオメトリのバウンディングボックスはfloat4から倍精度浮動小数点数 (float8)に変わりました。バウンディングボックス演算子を使う場合とバウンディングボックスからジオメトリへのキャストに影響が出ます。たとえば、ST_SetSRID(abbox)は、しばしば、以前の版ではビューポートクエリの答をわずかに変更する可能性がありますが、PostGIS 2.0以上では、それとは異なる、より精度の良い答えを返します。</p></td></tr></table></div><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>hasnodata引数は、同じ意味ですがより目的がはっきり分かるexclude_nodata_valueに置き換えられました。</p></td></tr></table></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#AddGeometryColumn" title="AddGeometryColumn">AddGeometryColumn</a> - Changed: 2.0.0 geometry_columnsがシステムカタログを読むビューになったため、geometry_columnsを更新しないようになりました。デフォルトでは制約を生成せず、PostgreSQLの型修飾子を使います。この関数によるWGS 84のPOINTカラムの構築とALTER TABLE some_table ADD COLUMN geom geometry(Point,4326);とは等価です。 </li><li class="listitem"><a class="link" href="#AddGeometryColumn" title="AddGeometryColumn">AddGeometryColumn</a> - Changed: 2.0.0 制約を使う必要がある場合には、use_typmodをFALSEにします。</li><li class="listitem"><a class="link" href="#AddGeometryColumn" title="AddGeometryColumn">AddGeometryColumn</a> - Changed: 2.0.0 ビューについては、geometry_columnsへの手動登録はできなくなりました。しかし、typmodテーブルジオメトリに対して構築されていて、かつラッパ関数が無いビューは、親テーブルカラムのtypmodの挙動を継承するので、正しく登録されます。他のジオメトリを出力するジオメトリ関数を使うビューについては、ビューのジオメトリカラムが正しく登録されるようにするため、typmodジオメトリへのキャストが必要です。を参照して下さい。 </li><li class="listitem"><a class="link" href="#DropGeometryColumn" title="DropGeometryColumn">DropGeometryColumn</a> - Changed: 2.0.0 この関数は後方互換のためのものです。geometry_columnsは現在はシステムカタログに対するビューですので、他のテーブルのカラムと同じようにALTER TABLEを使った削除が可能です。</li><li class="listitem"><a class="link" href="#DropGeometryTable" title="DropGeometryTable">DropGeometryTable</a> - Changed: 2.0.0で この関数は後方互換のためのものです。geometry_columnsは現在はシステムカタログに対するビューですので、他のテーブルのカラムと同じようにDROP TABLEを使った削除が可能です。</li><li class="listitem"><a class="link" href="#Populate_Geometry_Columns" title="Populate_Geometry_Columns">Populate_Geometry_Columns</a> - Changed: 2.0.0 デフォルトでは、ジオメトリタイプの制限について、制約を確認する代わりに型修飾子を使います。新しいuse_typmodをFALSEに設定して使うことで、制約確認を使用することができます。</li><li class="listitem"><a class="link" href="#RT_Box3D" title="Box3D">Box3D</a> - Changed: 2.0.0 以前の版では、box3dでなくbox2dを使っていました。box2dは非推奨型となり、box3dに変更しました。</li><li class="listitem"><a class="link" href="#RT_ST_GDALDrivers" title="ST_GDALDrivers">ST_GDALDrivers</a> - Changed: 2.0.6, 2.1.3 - GUC (訳注: Grand Unified Configurationの略で、動的に変更できるPostgreSQLパラメータ)または環境変数gdal_enabled_driversが設定されていないデフォルトではドライバが全て無効になりました。</li><li class="listitem"><a class="link" href="#RT_ST_ScaleX" title="ST_ScaleX">ST_ScaleX</a> - Changed: 2.0.0. WKTRaster版ではST_PixelSizeXと呼ばれていました。</li><li class="listitem"><a class="link" href="#RT_ST_ScaleY" title="ST_ScaleY">ST_ScaleY</a> - Changed: 2.0.0. WKTRaster版ではST_PixelSizeYと呼ばれていました。</li><li class="listitem"><a class="link" href="#RT_ST_SetScale" title="ST_SetScale">ST_SetScale</a> - Changed: 2.0.0 WKTRaster版では、ST_SetPixelSizeと呼ばれていました。2.0.0で変更されました。</li><li class="listitem"><a class="link" href="#ST_3DLength" title="ST_3DLength">ST_3DLength</a> - Changed: 2.0.0 以前の版ではST_Length3Dと呼ばれていました。</li><li class="listitem"><a class="link" href="#ST_3DPerimeter" title="ST_3DPerimeter">ST_3DPerimeter</a> - Changed: 2.0.0 以前の版ではST_Perimeter3Dと呼ばれていました。</li><li class="listitem"><a class="link" href="#ST_AsBinary" title="ST_AsBinary">ST_AsBinary</a> - Changed: 2.0.0 この関数への入力は不明な型にすることができなくなり、必ずジオメトリでなければなりません。ST_AsBinary('POINT(1 2)')といった構築ではもはや妥当ではなく、n st_asbinary(unknown) is not unique errorが得られます。このようなコードはST_AsBinary('POINT(1 2)'::geometry);に変更する必要があります。これが不可能な場合にはlegacy.sqlをインストールして下さい。</li><li class="listitem"><a class="link" href="#ST_AsGML" title="ST_AsGML">ST_AsGML</a> - Changed: 2.0.0 デフォルトの名前付き引数を使います。</li><li class="listitem"><a class="link" href="#ST_AsGeoJSON" title="ST_AsGeoJSON">ST_AsGeoJSON</a> - Changed: 2.0.0 デフォルト引数と名前付き引数に対応しました。</li><li class="listitem"><a class="link" href="#ST_AsKML" title="ST_AsKML">ST_AsKML</a> - Changed: 2.0.0 - デフォルト引数と名前付き引数に対応しました。</li><li class="listitem"><a class="link" href="#ST_AsSVG" title="ST_AsSVG">ST_AsSVG</a> - Changed: 2.0.0 - デフォルト引数と名前付き引数に対応しました。</li><li class="listitem"><a class="link" href="#ST_EndPoint" title="ST_EndPoint">ST_EndPoint</a> - Changed: 2.0.0 一つのジオメトリマルチラインストリングで動作しなくなりました。PostGIS の古いバージョンでは、この関数は一つのマルチラインストリングで動作し、終端ポイントを返します。2.0.0では、他のマルチラインストリングと同様にNULLを返します。古い動作は文書化されていない機能でしたが、データをLINESTRINGとして格納していると思われるユーザーは、2.0.0 でNULLが返されることを経験するかも知れません。</li><li class="listitem"><a class="link" href="#ST_GeometryN" title="ST_GeometryN">ST_GeometryN</a> - Changed: 2.0.0 以前の版では非マルチのジオメトリではNULLが返りました。ST_GeometryN(..,1)の場合にはジオメトリを返すよう変更されました。</li><li class="listitem"><a class="link" href="#ST_IsEmpty" title="ST_IsEmpty">ST_IsEmpty</a> - Changed: 2.0.0 以前の版のPostGISではST_GeomFromText('GEOMETRYCOLLECTION(EMPTY)')を許しました。PostGIS 2.0.0では、SQL/MM標準により準拠させるため、これは不正となります。</li><li class="listitem"><a class="link" href="#ST_Length" title="ST_Length">ST_Length</a> - Changed: 2.0.0 大幅な変更 -- 以前の版ではジオグラフィのPOLYGONやMULTIPOLYGONへの適用によってPOLYGONやMULTIPOLYGONの周囲長を返しました。2.0.0版ではジオメトリの挙動に従うため0を返すように変更しました。ポリゴンの周囲長を求める場合は、ST_Perimeterを使います。</li><li class="listitem"><a class="link" href="#ST_LocateAlong" title="ST_LocateAlong">ST_LocateAlong</a> - Changed: 2.0.0 以前の版ではST_Locate_Along_Measureと呼ばれていました。</li><li class="listitem"><a class="link" href="#ST_LocateBetween" title="ST_LocateBetween">ST_LocateBetween</a> - Changed: 2.0.0 以前の版ではST_Locate_Between_Measuresと呼ばれていました。</li><li class="listitem"><a class="link" href="#ST_ModEdgeSplit" title="ST_ModEdgeSplit">ST_ModEdgeSplit</a> - Changed: 2.0 - 以前の版では名前を間違えてST_ModEdgesSplitになっていました。</li><li class="listitem"><a class="link" href="#ST_NumGeometries" title="ST_NumGeometries">ST_NumGeometries</a> - Changed: 2.0.0 前の版では、ジオメトリがコレクション/マルチ系でない場合にはNULLを返しました。2.0.0以上では、POLYGON, LINESTRING, POINTといった単一ジオメトリについては1を返します。</li><li class="listitem"><a class="link" href="#ST_NumInteriorRings" title="ST_NumInteriorRings">ST_NumInteriorRings</a> - Changed: 2.0.0 - 以前の版では、MULTIPOLYGONを渡して最初のPOLYGONの内環の数を返すことができました。</li><li class="listitem"><a class="link" href="#ST_PointN" title="ST_PointN">ST_PointN</a> - Changed: 2.0.0 単一ジオメトリのMULTILINESTRINGで動作しなくなりました。単一のラインストリングからなるMULTILINESTRINGについては幸運にも動いていて、最初のポイントを返していました。2.0.0では他のMULTILINESTRINGと同様にNULLを返すようになりました。</li><li class="listitem"><a class="link" href="#ST_StartPoint" title="ST_StartPoint">ST_StartPoint</a> - Changed: 2.0.0 一つのMULTILINESTRINGで動作しなくなりました。PostGIS の古いバージョンでは、この関数は、一つのラインストリングからなるMULTILINESTRINGについては幸運にも動いていて、始端ポイントを返していました。2.0.0では他のMULTILINESTRINGと同様にNULLを返すようになりました。古い動作は文書化されていない機能でしたが、データをLINESTRINGとして格納していると思われるユーザーは、2.0.0 でNULLが返されることを経験するかも知れません。</li></ul></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="NewFunctions_1_5"></a>15.12.13. PostGIS 1.5で新規作成/機能強化/変更された関数</h3></div></div></div><p>次に示す関数は、新規作成または機能強化されたPostGIS関数です。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#ST_AddMeasure" title="ST_AddMeasure">ST_AddMeasure</a> - Availability: 1.5.0 ラインに沿ったM値を補間します。</li><li class="listitem"><a class="link" href="#ST_AsBinary" title="ST_AsBinary">ST_AsBinary</a> - Availability: 1.5.0 ジオグラフィが導入されました。 ジオメトリ/ジオグラフィの、SRIDメタデータを持たないOGC/ISO Well-Knownバイナリ (WKB)表現を返します。</li><li class="listitem"><a class="link" href="#ST_AsGML" title="ST_AsGML">ST_AsGML</a> - Availability: 1.5.0 ジオグラフィが導入されました。 GML第2版または第3版としてジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_AsGeoJSON" title="ST_AsGeoJSON">ST_AsGeoJSON</a> - Availability: 1.5.0 ジオグラフィが導入されました。 ジオメトリをGeoJSON要素として返します。</li><li class="listitem"><a class="link" href="#ST_AsText" title="ST_AsText">ST_AsText</a> - Availability: 1.5 - ジオグラフィ対応が導入されました。 ジオメトリ/ジオグラフィのSRIDメタデータのないWell-Known Text (WKT)表現を返します。</li><li class="listitem"><a class="link" href="#ST_Buffer" title="ST_Buffer">ST_Buffer</a> - Availability: 1.5 - ST_Bufferが強化され、様々な終端と継ぎ目に対応するようになりました。たとえば、道路ラインストリングを道路ポリゴンに変換する際に終端を丸でなく平面や四角で処理したい場合などに使えます。ジオグラフィ用の薄いラッパが追加されました。  あるジオメトリからの距離が指定された距離以下となる点全ての集合となるジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_ClosestPoint" title="ST_ClosestPoint">ST_ClosestPoint</a> - Availability: 1.5.0 g1上の、g2に最も近い2次元ポイントを返します。これは最短ラインの始点です。</li><li class="listitem"><a class="link" href="#ST_CollectionExtract" title="ST_CollectionExtract">ST_CollectionExtract</a> - Availability: 1.5.0 ジオメトリコレクションを与えると、指定されたタイプの要素だけからなるマルチジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_Distance" title="ST_Distance">ST_Distance</a> - Availability: 1.5.0 1.5でジオグラフィ対応が導入されました。大きいジオメトリや頂点の多いジオメトリについての速度が改善しました。 二つのジオメトリ値またはジオグラフィ値間の距離を返します。</li><li class="listitem"><a class="link" href="#ST_DistanceSphere" title="ST_DistanceSphere">ST_DistanceSphere</a> - Availability: 1.5 - ポイント以外のジオメトリが導入されました。以前の版ではポイントでのみ動作しました。 球面の地球モデルを使って、二つの経度/緯度ジオメトリの最小距離をメートル単位で返します。</li><li class="listitem"><a class="link" href="#ST_Distance_Spheroid" title="ST_DistanceSpheroid">ST_DistanceSpheroid</a> - Availability: 1.5 - ポイント以外のジオメトリが導入されました。以前の版ではポイントでのみ動作しました。 回転楕円体面の地球モデルを使って、二つの経度/緯度ジオメトリの最小距離を返します。</li><li class="listitem"><a class="link" href="#ST_DumpPoints" title="ST_DumpPoints">ST_DumpPoints</a> - Availability: 1.5.0 ジオメトリの座標のgeometry_dump行の集合を返します。</li><li class="listitem"><a class="link" href="#ST_Envelope" title="ST_Envelope">ST_Envelope</a> - Availability: 1.5.0 挙動が変更され出力がfloat4からfloat8になりました。 ジオメトリのバウンディングボックスを表現するジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_Geometry_Same" title="~=">~=</a> - Availability: 1.5.0 挙動が変更されました AのバウンディングボックスがBのバウンディングボックスと同じ場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#ST_HausdorffDistance" title="ST_HausdorffDistance">ST_HausdorffDistance</a> - Availability: 1.5.0 二つのジオメトリ間のハウスドルフ距離を返します。</li><li class="listitem"><a class="link" href="#ST_Length" title="ST_Length">ST_Length</a> - Availability: 1.5.0 ジオグラフィt対応が導入されました。 線系ジオメトリの2次元長を返します。</li><li class="listitem"><a class="link" href="#ST_LongestLine" title="ST_LongestLine">ST_LongestLine</a> - Availability: 1.5.0 二つのジオメトリ間の2次元最長ラインを返します。</li><li class="listitem"><a class="link" href="#ST_MakeEnvelope" title="ST_MakeEnvelope">ST_MakeEnvelope</a> - Availability: 1.5 座標値の最小値と最大値から矩形ポリゴンを生成します。</li><li class="listitem"><a class="link" href="#ST_MaxDistance" title="ST_MaxDistance">ST_MaxDistance</a> - Availability: 1.5.0 二つのジオメトリ間の2次元最長距離を空間参照系の単位で返します</li><li class="listitem"><a class="link" href="#ST_ShortestLine" title="ST_ShortestLine">ST_ShortestLine</a> - Availability: 1.5.0 二つのジオメトリの3次元の最短ラインを返します。</li><li class="listitem"><a class="link" href="#geometry_overlaps" title="&amp;&amp;">&amp;&amp;</a> - Availability: 1.5.0 ジオグラフィ対応が導入されました。 Aの2次元バウンディングボックスがBの2次元バウンディングボックスとインタセクトする場合にTRUEを返します。</li></ul></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="NewFunctions_1_4"></a>15.12.14. PostGIS 1.4で新規作成/機能強化/変更された関数</h3></div></div></div><p>次に示す関数は、新規作成または機能強化されたPostGIS関数です。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#Populate_Geometry_Columns" title="Populate_Geometry_Columns">Populate_Geometry_Columns</a> - ジオメトリカラムが型修飾子で定義されるか、適切な空間制約を持つようにします。 Availability: 1.4.0</li><li class="listitem"><a class="link" href="#ST_AsSVG" title="ST_AsSVG">ST_AsSVG</a> - ジオメトリからSVGパスデータを返します。 
		  Availability: 1.2.2. Availability: 1.4.0 PostGIS 1.4.0でhttp://www.w3.org/TR/SVG/paths.html#PathDataBNFに従うため、絶対パスにLコマンドが入りました。
		</li><li class="listitem"><a class="link" href="#ST_Collect" title="ST_Collect">ST_Collect</a> - ジオメトリの集合からジオメトリコレクションまたはマルチ系ジオメトリを生成します。 Availability: 1.4.0 - ST_Collect(geometry)が導入されました。ST_Collectがより多くのジオメトリをより早く扱えるよう強化されました。</li><li class="listitem"><a class="link" href="#ST_GeoHash" title="ST_GeoHash">ST_GeoHash</a> - ジオメトリのGeoHash表現を返します。 Availability: 1.4.0</li><li class="listitem"><a class="link" href="#ST_LocateBetweenElevations" title="ST_LocateBetweenElevations">ST_LocateBetweenElevations</a> - 標高 (Z値)範囲にある部分ジオメトリを返します。 Availability: 1.4.0</li><li class="listitem"><a class="link" href="#ST_MakeLine" title="ST_MakeLine">ST_MakeLine</a> - POINT、MULTIPOINT、LINESTRINGからLINESTRINGを生成します。 Availability: 1.4.0 - ST_MakeLine(geomarray)が導入されました。ST_MakeLine集約関数はより多くのポイントをより早く扱うための強化が施されています。</li><li class="listitem"><a class="link" href="#ST_MinimumBoundingCircle" title="ST_MinimumBoundingCircle">ST_MinimumBoundingCircle</a> - 入力ジオメトリを含む最小の円を返します。 Availability: 1.4.0</li></ul></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="NewFunctions_1_3"></a>15.12.15. PostGIS 1.3で新規作成された関数</h3></div></div></div><p>次に示す関数は、新規作成されたPostGIS関数です。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#ST_AsGML" title="ST_AsGML">ST_AsGML</a> - GML第2版または第3版としてジオメトリを返します。 Availability: 1.3.2</li><li class="listitem"><a class="link" href="#ST_AsGeoJSON" title="ST_AsGeoJSON">ST_AsGeoJSON</a> - ジオメトリをGeoJSON要素として返します。 Availability: 1.3.4</li><li class="listitem"><a class="link" href="#ST_CurveToLine" title="ST_CurveToLine">ST_CurveToLine</a> - 曲線を含むジオメトリを線ジオメトリに変換します。 Availability: 1.3.0</li><li class="listitem"><a class="link" href="#ST_LineToCurve" title="ST_LineToCurve">ST_LineToCurve</a> - 曲線を含むジオメトリを線ジオメトリに変換します。 Availability: 1.3.0</li><li class="listitem"><a class="link" href="#ST_SimplifyPreserveTopology" title="ST_SimplifyPreserveTopology">ST_SimplifyPreserveTopology</a> - Douglas-Peukerアルゴリズムを使用して、与えられたジオメトリを簡略化したものを返します。 Availability: 1.3.3</li></ul></div></div></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="idp88933504"></a>第16章 問題を報告する</h1></div></div></div><div class="toc"><div class="toc-title">目次</div><dl class="toc"><dt><span class="sect1"><a href="#idp88934144">16.1. ソフトウェアのバグを報告する</a></span></dt><dt><span class="sect1"><a href="#idp88971392">16.2. 文書の問題を報告する</a></span></dt></dl></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp88934144"></a>16.1. ソフトウェアのバグを報告する</h2></div></div></div><p>効率的なバグの報告はPostGISの開発を助ける本質的な方法です。最も効率的なバグ報告は、PostGIS開発者がそれを再現できるようにすることで、それの引き金となったスクリプトと検出された環境に沿った全ての情報を含んでいるのが理想です。<code class="code">SELECT postgis_full_version()</code>[PostGIS]と<code class="code">SELECT version()</code>[PostgreSQL]とを実行することで十分に良い情報を得ることができます。</p><p>最新版を使っていない場合には<a class="ulink" href="https://git.osgeo.org/gitea/postgis/postgis/raw/branch/master/NEWS" target="_top">release changelog</a>をまず見て、既にバグフィクスされていないかを探すのは価値のあることです。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/" target="_top">PostGIS bug tracker</a>を使うと、レポートが捨てられず、それの対応プロセスが通知されることを保証します。新しいバグを報告する前にデータベースに問い合わせて、既知のバグかどうかを見て下さい。既知のものでしたら、それに関して持っているあらゆる新しい情報を追加して下さい。</p><p>新しいレポートを記入する前にSimon Tathamさんの<a class="ulink" href="http://www.chiark.greenend.org.uk/~sgtatham/bugs.html" target="_top">How to Report Bugs Effectively</a>に関するページを読むと良いでしょう。</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp88971392"></a>16.2. 文書の問題を報告する</h2></div></div></div><p>文書は、ソフトウェアの機能と挙動を正確に反映するべきものです。正確でない場合は、ソフトウェアのバグがあるか、または文書に誤り若しくは不十分な箇所があることが考えられます。</p><p>文書の問題も<a class="ulink" href="http://trac.osgeo.org/postgis" target="_top">PostGIS bug tracker</a>に報告することができます。</p><p>訂正が小さいものなら、バグトラッカの新しい問題の中に、文書内の位置を特定して記述して下さい。</p><p>変更が大きい場合は、Subversion パッチが確実に好まれます。Unix上で次の4ステップの処理を行います (既に<a class="ulink" href="http://subversion.apache.org/" target="_top">Subversion</a>をインストールしていると仮定します)。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>PostGISのgitリポジトリを複製します。UNIXでは次のように入力します。</p><p><span class="command"><strong>git clone https://git.osgeo.org/gitea/postgis/postgis.git</strong></span></p><p>これでpostgisディレクトリに格納されます</p></li><li class="listitem"><p>お使いのテキストエディタで文書に変更を加えます。Unixでは、たとえば次のようにします。</p><p><span class="command"><strong>vim doc/postgis.xml</strong></span></p><p>文書はHTMLでなくDocBook XMLで書かれていますので、慣れていないなら、残りの文書の例にならって下さい。</p></li><li class="listitem"><p>文書のマスタコピーからパッチファイルを作成します。Unixでは次のように入力します。</p><p><span class="command"><strong>git diff doc/postgis.xml &gt; doc.patch</strong></span></p></li><li class="listitem"><p>バグトラッカ内の新しい問題にパッチが取り付けられます。</p></li></ol></div></div></div><div class="appendix"><div class="titlepage"><div><div><h1 class="title"><a name="release_notes"></a>付録A 付録</h1></div><div><h3 class="subtitle"><i>リリースノート</i></h3></div></div></div><div class="toc"><div class="toc-title">目次</div><dl class="toc"><dt><span class="sect1"><a href="#idp88998016">A.1. PostGIS 3.2.0 (Olivier Courtin版)</a></span></dt><dt><span class="sect1"><a href="#idp89075328">A.2. PostGIS 3.2.0beta2</a></span></dt><dt><span class="sect1"><a href="#idp89082112">A.3. リリース 3.2.0beta2</a></span></dt><dt><span class="sect1"><a href="#idp89087872">A.4. リリース 3.2.0beta1</a></span></dt><dt><span class="sect1"><a href="#idp89093632">A.5. リリース 3.2.0alpha1</a></span></dt><dt><span class="sect1"><a href="#idp89120768">A.6. リリース 3.1.0beta1</a></span></dt><dt><span class="sect1"><a href="#idp89126144">A.7. リリース 3.1.0alpha3</a></span></dt><dt><span class="sect1"><a href="#idp89144448">A.8. リリース 3.1.0alpha2</a></span></dt><dt><span class="sect1"><a href="#idp89155968">A.9. リリース 3.1.0alpha1</a></span></dt><dt><span class="sect1"><a href="#idp89167744">A.10. リリース 3.0.0</a></span></dt><dt><span class="sect1"><a href="#idp89198720">A.11. リリース 3.0.0rc2</a></span></dt><dt><span class="sect1"><a href="#idp89202944">A.12. リリース 3.0.0rc1</a></span></dt><dt><span class="sect1"><a href="#idp89206784">A.13. リリース 3.0.0beta1</a></span></dt><dt><span class="sect1"><a href="#idp89230976">A.14. リリース 3.0.0alpha4</a></span></dt><dt><span class="sect1"><a href="#idp89240448">A.15. リリース 3.0.0alpha3</a></span></dt><dt><span class="sect1"><a href="#idp89248640">A.16. リリース 3.0.0alpha2</a></span></dt><dt><span class="sect1"><a href="#idp89252480">A.17. リリース 3.0.0alpha1</a></span></dt><dt><span class="sect1"><a href="#idp89276416">A.18. リリース 2.5.0</a></span></dt><dt><span class="sect1"><a href="#idp89298176">A.19. リリース 2.4.5</a></span></dt><dt><span class="sect1"><a href="#idp89309440">A.20. リリース 2.4.4</a></span></dt><dt><span class="sect1"><a href="#idp89318016">A.21. リリース 2.4.3</a></span></dt><dt><span class="sect1"><a href="#idp89323008">A.22. リリース 2.4.2</a></span></dt><dt><span class="sect1"><a href="#idp89330688">A.23. リリース 2.4.1</a></span></dt><dt><span class="sect1"><a href="#idp89338880">A.24. リリース 2.4.0</a></span></dt><dt><span class="sect1"><a href="#idp89356544">A.25. リリース 2.3.3</a></span></dt><dt><span class="sect1"><a href="#idp89411968">A.26. リリース 2.3.2</a></span></dt><dt><span class="sect1"><a href="#idp89416192">A.27. リリース 2.3.1</a></span></dt><dt><span class="sect1"><a href="#idp89422592">A.28. リリース 2.3.0</a></span></dt><dt><span class="sect1"><a href="#idp89441280">A.29. リリース 2.2.2</a></span></dt><dt><span class="sect1"><a href="#idp89460480">A.30. リリース 2.2.1</a></span></dt><dt><span class="sect1"><a href="#idp89471616">A.31. リリース 2.2.0</a></span></dt><dt><span class="sect1"><a href="#idp89550080">A.32. リリース 2.1.8</a></span></dt><dt><span class="sect1"><a href="#idp89555456">A.33. リリース 2.1.7</a></span></dt><dt><span class="sect1"><a href="#idp89571200">A.34. リリース 2.1.6</a></span></dt><dt><span class="sect1"><a href="#idp89579776">A.35. リリース 2.1.5</a></span></dt><dt><span class="sect1"><a href="#idp89590016">A.36. リリース 2.1.4</a></span></dt><dt><span class="sect1"><a href="#idp89634304">A.37. リリース 2.1.3</a></span></dt><dt><span class="sect1"><a href="#idp89641216">A.38. リリース 2.1.2</a></span></dt><dt><span class="sect1"><a href="#idp89682432">A.39. リリース 2.1.1</a></span></dt><dt><span class="sect1"><a href="#idp89696640">A.40. リリース 2.1.0</a></span></dt><dt><span class="sect1"><a href="#idp89836032">A.41. リリース 2.0.5</a></span></dt><dt><span class="sect1"><a href="#idp89850496">A.42. リリース 2.0.4</a></span></dt><dt><span class="sect1"><a href="#idp89895936">A.43. リリース 2.0.3</a></span></dt><dt><span class="sect1"><a href="#idp89912448">A.44. リリース 2.0.2</a></span></dt><dt><span class="sect1"><a href="#idp89975808">A.45. リリース 2.0.1</a></span></dt><dt><span class="sect1"><a href="#idp90023808">A.46. リリース 2.0.0</a></span></dt><dt><span class="sect1"><a href="#idp90087680">A.47. リリース 1.5.4</a></span></dt><dt><span class="sect1"><a href="#idp90110976">A.48. リリース 1.5.3</a></span></dt><dt><span class="sect1"><a href="#idp90127232">A.49. リリース 1.5.2</a></span></dt><dt><span class="sect1"><a href="#idp90143872">A.50. リリース 1.5.1</a></span></dt><dt><span class="sect1"><a href="#idp90153344">A.51. リリース 1.5.0</a></span></dt><dt><span class="sect1"><a href="#idp90175232">A.52. リリース 1.4.0</a></span></dt><dt><span class="sect1"><a href="#idp90195584">A.53. リリース 1.3.6</a></span></dt><dt><span class="sect1"><a href="#idp90213504">A.54. リリース 1.3.5</a></span></dt><dt><span class="sect1"><a href="#idp90215040">A.55. リリース 1.3.4</a></span></dt><dt><span class="sect1"><a href="#idp90216960">A.56. リリース 1.3.3</a></span></dt><dt><span class="sect1"><a href="#idp90218496">A.57. リリース 1.3.2</a></span></dt><dt><span class="sect1"><a href="#idp90220032">A.58. リリース 1.3.1</a></span></dt><dt><span class="sect1"><a href="#idp90221568">A.59. リリース 1.3.0</a></span></dt><dt><span class="sect1"><a href="#idp90229120">A.60. リリース 1.2.1</a></span></dt><dt><span class="sect1"><a href="#idp89037440">A.61. リリース 1.2.0</a></span></dt><dt><span class="sect1"><a href="#idp90232576">A.62. リリース 1.1.6</a></span></dt><dt><span class="sect1"><a href="#idp90242944">A.63. リリース 1.1.5</a></span></dt><dt><span class="sect1"><a href="#idp90253056">A.64. リリース 1.1.4</a></span></dt><dt><span class="sect1"><a href="#idp90268032">A.65. リリース 1.1.3</a></span></dt><dt><span class="sect1"><a href="#idp90283520">A.66. リリース 1.1.2</a></span></dt><dt><span class="sect1"><a href="#idp90300032">A.67. リリース 1.1.1</a></span></dt><dt><span class="sect1"><a href="#idp90311936">A.68. リリース 1.1.0</a></span></dt><dt><span class="sect1"><a href="#idp90353792">A.69. リリース 1.0.6</a></span></dt><dt><span class="sect1"><a href="#idp90364160">A.70. リリース 1.0.5</a></span></dt><dt><span class="sect1"><a href="#idp90376576">A.71. リリース 1.0.4</a></span></dt><dt><span class="sect1"><a href="#rel_1.0.3_upgrading">A.72. リリース 1.0.3</a></span></dt><dt><span class="sect1"><a href="#idp90419072">A.73. リリース 1.0.2</a></span></dt><dt><span class="sect1"><a href="#idp90426880">A.74. リリース 1.0.1</a></span></dt><dt><span class="sect1"><a href="#idp90440704">A.75. リリース 1.0.0</a></span></dt><dt><span class="sect1"><a href="#idp90450048">A.76. リリース 1.0.0RC6</a></span></dt><dt><span class="sect1"><a href="#idp90457600">A.77. リリース 1.0.0RC5</a></span></dt><dt><span class="sect1"><a href="#idp90464640">A.78. リリース 1.0.0RC4</a></span></dt><dt><span class="sect1"><a href="#idp90477056">A.79. リリース 1.0.0RC3</a></span></dt><dt><span class="sect1"><a href="#idp90489600">A.80. リリース 1.0.0RC2</a></span></dt><dt><span class="sect1"><a href="#idp89258496">A.81. リリース 1.0.0RC1</a></span></dt></dl></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp88998016"></a>A.1. PostGIS 3.2.0 (Olivier Courtin版)</h2></div></div></div><p>2021/12/18</p><p>このバージョンでは、PostgreSQL 9.6以上、GEOS 3.6以上、Proj 4.9以上が必要です。追加機能にはGEOS 3.9以上 (ST_MakeValidの強化には GEOS 3.10以上)、Proj 6.1以上、PostgreSQL 14以上が必要です。</p><p>新しいPostgreSQL 14の高速インデックス構築で能率が低下するクエリがあるため、現実世界のクエリの本当の影響を見るユーザ試験が増えるまで、デフォルトでは機能を無効化することにしました。</p><pre class="programlisting">ALTER OPERATOR FAMILY gist_geometry_ops_2d USING gist
            ADD FUNCTION 11 (geometry)
            geometry_gist_sortsupport_2d (internal);
        </pre><p>変更を戻すには次のようにします。</p><pre class="programlisting">ALTER OPERATOR FAMILY gist_geometry_ops_2d using gist
        DROP FUNCTION 11 (geometry);</pre><p>そして、GiSTインデックスの再構築を行います。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89001600"></a>大幅な変更</h3></div></div></div><p>5008, Empty geometries are not reported as being within Infinite distance by ST_DWithinで、空ジオメトリに対しては無限遠にあると正しく報告されない (Sandro Santilliさん)</p><p>4824, `--without-wagyu`ビルドオプションを削除しました。WagyuはMVT対応のビルドでは必須になっているためです。</p><p>4933, topology.GetFaceByPointは、不正なエッジリンクを持つトポロジでは動作しなくなります。</p><p>4981, ST_StartPointが全てのジオメトリに対応しました。ラインストリング以外でNULLを返すことがなくなりました。</p><p>4149, ST_AsMVTGeomは、対象範囲に近い縮尺で元のジオメトリの詳細データを以前より多く保存するようになりました。以前の単純化の振る舞いが必要な場合には、事前にST_Simplifyを実行します。 (Darafei Praliaskouskiさん)</p><p>- Proj 4.9以上が必要です。</p><p>5000, 集約関数ST_AsMVTでのウィンドウ対応を、実際の利用場面が無く、でたらめな入力で異常終了するため、中止 (Paul Ramseyさん)</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89005056"></a>性能強化</h3></div></div></div><p>4997, FlatGeobuf書式による入出力 (Björn Harrtellさん)</p><p>4575, トポロジのメタテーブルに対してGRANT SELECT ... TO PUBLICを実行 (Sandro Santilliさん)</p><p>2592, CreateTopologyにおいてSRID &gt; 0でトポロジを定義できないようになりました (Sandro Santilliさん)</p><p>3232, 孤立ノードを異なるフェイスに移動できないようにしました (Sandro Santilliさん)</p><p>- トポロジ編集時にコレクションのTopoGeometryを考慮するようになりました (Sandro Santilliさん)</p><p>3248, TopoGeometryで使われている孤立エッジを削除できないようにしました (Sandro Santilli)</p><p>3231, TopoGeometryで使われている孤立ノードを削除できないようにしました (Sandro Santilli)</p><p>3239, 接続しているノードがTopoGeometryの定義に使われているエッジの修復をできないようにしました (Sandro Santilliさん)</p><p>4950, ValidateTopologyでノード用のcontaining_faceチェックの速度向上 (Sandro Santilliさん)</p><p>4945, ValidateTopologyで複数の外殻を持つフェイスのチェック (Sandro Santilliさん)</p><p>4944, ValidateTopologyで側面位置矛盾のチェック (Sandro Santilliさん)</p><p>3042, ValidateTopologyでエッジ接続のチェック (Sandro Santilliさん)</p><p>3276, ValidateTopologyでフェイスのMBRのチェック (Sandro Santilliさん)</p><p>4936, ValidateTopologyをバウンディングボックスで制限できるようにしました (Sandro Santilliさん)</p><p>4933, 巨大フェイス支配下のトポロジ構築の速度向上 (Sandro Santilliさん)</p><p>3233, ValidateTopologyがノードのcontaining_faceをチェックするようになりました (Sandro Santilliさん)</p><p>4830, ValidateTopologyが、エッジが両側のフェイスに囲まれているかをチェックするようになりました (Sandro Santilliさん)</p><p>4827, WKT入力でNaN座標値を許すようになりました (Paul Ramsey)</p><p>- ST_Value()がリサンプリングパラメータを受け付けるようになり、バイリニアのオプションを追加しました。 (Paul Ramseyさん)</p><p>3778, #4401, ST_BoundaryがTINで動作し、曲線を線形化しなくなりました (Aliaksandr Kalenikさん)</p><p>4881, #4884, 方向を保持するために、relationテーブル内の線のTopoGeometryに対応するedge_idの符号を格納 (Sandro Santilliさん)</p><p>4628, シェープファイルのロード時にANALYZEを無効にするオプションを追加 (Stefan Corneliu Petreaさん)</p><p>4924, 大きなマルチポイントでの動作がO(N^2) からO(NlogN)に早くなったST_RemoveRepeatedPoints (Aliaksandr Kalenikさん, Darafei Praliaskouskiさん)</p><p>4925, ポイントを見落とさないようST_DumpPointsを修正 (Aliaksandr Kalenikさん)</p><p>- 検索速度向上のためST_SRID(topogeometry)を無効にしました (Sandro Santilliさん)</p><p>2175, 同じ閉じた線をトポロジに追加する時に追加ノードを生成しないようにしました (Sandro Santilliさん)</p><p>4974, address_standardizer_data_usのパスを更新しました (AivenのJan Katinsさん, Regina Obeさん)</p><p>4975, PostGISアップグレードで一時テーブルを使わないように変更しました (AvienのJan Katinsさん)</p><p>4981, ST_StartPointがどのジオメトリもサポートするようになりました (Aliaksandr Kalenikさん)</p><p>4799, spatial_ref_sysにあるSRSをGeoJSONに取り込めるようになりました。</p><p>4986, PostgreSQL 14のGiSTインデックスが、ヒルベルトソートで早くなりました。 (Han Wangさん, Aliaksandr Kalenikさん, Darafei Praliaskouskiさん, Giuseppe Broccoloさん)</p><p>4949, 座標軸の交換の有無を渡すためにproj_normalize_for_visualizationを使います (Paul Ramseyさん)</p><p>- GH648, ST_PixelAsCentroids, ST_PixelAsCentroidをC関数の上に再実装 (Sergei Shoulbakovさん)</p><p>- GH647, ST_AsMVTGeomは現在より早いクリッピングを使っています (Aliaksandr Kalenikさん)</p><p>5018, pgsql2shpのWITH CTE節への基本的な対応 (Regina Obeさん)</p><p>5019, address_standardizer: pcre2対応の追加 (Paul Ramseyさん)</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89031936"></a>新機能</h3></div></div></div><p>4923, topology.ValidateTopologyRelation (Sandro Santilliさん)</p><p>4933, topology.GetFaceContainingPoint (Sandro Santilliさん)</p><p>2175, ST_Scroll (Sandro Santilliさん)</p><p>4841, トポロジ行を早く取得するFindTopology (Sandro Santilliさん)</p><p>4869, レイヤ行を早く取得するFindLayer (Sandro Santilli)</p><p>4851, TopoGeom_addTopoGeom関数(Sandro Santilliさん)</p><p>ST_MakeValid(geometry, options)ではGEOS 3.10にある妥当性構築アルゴリズムの代替が可能になりました (Paul Ramseyさん)</p><p>GDALの多数のアルゴリズム (inverse weighted distance, average等)の一つを使ってサンプルポイント間でラスタセル内に値を入れる ST_InterpolateRaster() (Paul Ramseyさん)</p><p>GDALのアルゴリズムを使ってラスタ値からとうこうせんを生成するST_Contour() (Paul Ramseyさん)</p><p>ST_SetZ()/ST_SetM()でラスタから読み込んだデータを使ってジオメトリのZ値、M値を埋めるようになりました (Paul Ramseyさん)</p><p>新しいGUC postgis.gdal_vsi_options。これによって、VSIネットワークサービス上でのデータベース外ラスタが認証キー等を使ったアクセスが可能になりました。</p><p>入力ジオメトリの辺の集合を返すST_DumpSegments (Aliaksandr Kalenikさん)</p><p>4859, ST_Point, ST_PointZ, ST_PointM, ST_PointZMのSRIDパラメータを持つコンストラクタ (Paul Ramseyさん)</p><p>4808, ST_ClusterKMeansはmax_radius引数に対応しました。クラスタ数が不明だがクラスタのサイズが分かっている場合に使います。(Darafei Praliaskouskiさん)</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp89075328"></a>A.2. PostGIS 3.2.0beta2</h2></div></div></div><p>2021/12/04</p><p>このバージョンでは、PostgreSQL 9.6以上、GEOS 3.6以上、Proj 4.9以上が必要です。追加機能にはGEOS 3.9以上 (ST_MakeValidの強化には GEOS 3.10以上)、Proj 6.1以上、PostgreSQL 14以上が必要です。</p><p>新しいPostgreSQL 14の高速インデックス構築で能率が低下するクエリがあるため、現実世界のクエリの本当の影響を見るユーザ試験が増えるまで、デフォルトでは機能を無効化することにしました。</p><pre class="programlisting">ALTER OPERATOR FAMILY gist_geometry_ops_2d USING gist
        ADD FUNCTION 11 (geometry)
        geometry_gist_sortsupport_2d (internal);
    </pre><p>変更を戻すには次のようにします。</p><pre class="programlisting">ALTER OPERATOR FAMILY gist_geometry_ops_2d using gist
     DROP FUNCTION 11 (geometry);</pre><p>そして、GiSTインデックスの再構築を行います。</p><p>PostGIS 3.2.0beta2 リリース以降の変更点は次の通りです。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89079296"></a>大幅な変更/修正</h3></div></div></div><p>5028, 混合ジオメトリ入力でST_AsFlatGeoBufが異常終了する (Björn Harrtellさん)</p><p>5029, ST_AsFlatGeobufのインデックス付き出力での破損 (Björn Harrtellさん)</p><p>5014, ST_TableFromFlatGeobufで異常終了する (Björn Harrtellさん)</p><p>ST_TableFromFlatGeobufをST_FromFlatGeobufToTableに名称変更 (Björn Harrtellさん)</p><p>PostgreSQL 14の高速インデックス構築はデフォルトで無効化しました。 (Paul Ramseyさん)</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp89082112"></a>A.3. リリース 3.2.0beta2</h2></div></div></div><p>リリース日: 2021/11/26</p><p>このバージョンでは、PostgreSQL 9.6以上、GEOS 3.6以上、Proj 4.9以上が必要です。追加機能にはGEOS 3.9以上 (ST_MakeValidの強化には GEOS 3.10以上)、Proj 6.1以上、PostgreSQL 14以上が必要です。PostGIS 3.2.0beta1 からの変更点は次の通りです。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89083520"></a>大幅な変更/修正</h3></div></div></div><p>5016, ローダ (shp2pgsq): LDFLAGSを見るようになりました (Greg Troxelさん)</p><p>5005, ジオメトリカラムが最初の列でない時にテーブルでST_AsFlatGeoBufが異常終了する (Björn Harrtellさん)</p><p>5017, topology.ValidateTopologyで"shell_check"テーブルが既に存在するエラーが常に出る (Sandro Santilliさん)</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89085440"></a>性能強化</h3></div></div></div><p>5018, pgsql2shpのWITH CTE節への基本的な対応 (Regina Obeさん)</p><p>5019, address_standardizer: pcre2対応の追加 (Paul Ramseyさん)</p><p>GH647, ST_AsMVTGeomは現在より早いクリッピングを使っています (Aliaksandr Kalenikさん)</p><p>GH648, ST_PixelAsCentroids, ST_PixelAsCentroidをC関数の上に再実装 (Sergei Shoulbakovさん)</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp89087872"></a>A.4. リリース 3.2.0beta1</h2></div></div></div><p>リリース日: 2021/10/23</p><p>このバージョンでは、PostgreSQL 9.6以上、GEOS 3.6以上、Proj 4.9以上が必要です。追加機能にはGEOS 3.9以上 (ST_MakeValidの強化には GEOS 3.10以上)、Proj 6.1以上、PostgreSQL 14以上が必要です。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89089280"></a>誤り修正と大幅な変更</h3></div></div></div><p>5012, GEOS 3.10.0に対するレグレッションテストのクリーニング (Regina Obeさん, Paul Ramseyさん)</p><p>5000, 集約関数ST_AsMVTでのウィンドウ対応を、実際の利用場面が無く、でたらめな入力で異常終了するため、中止 (Paul Ramseyさん)</p><p>4994, shp2pgsqlが時々INSERTステートメントを入れそこなう (Sandro Santilliさん)</p><p>4990, getfacecontainingpointがi386では失敗する (Sandro Santilliさん)</p><p>5008, EMPTYオペランドを与えたST_DWithinが常にFALSEを返す (Sandro Santilliさん)</p><p>5002, liblwgeomがデフォルトで警告表示フラグを付けてビルドするようにすべき (Sandro Santilliさん)</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89092352"></a>性能強化</h3></div></div></div><p>4997, FlatGeobuf書式による入出力 (Björn Harrtellさん)</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp89093632"></a>A.5. リリース 3.2.0alpha1</h2></div></div></div><p>リリース日: 2021/09/10</p><p>このバージョンでは、PostgreSQL 9.6以上、GEOS 3.6以上、Proj 4.9以上が必要です。追加機能にはGEOS 3.9以上 (より機能を多くするには GEOS 3.10以上)、Proj 6.1以上、PostgreSQL 14以上が必要です。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89095040"></a>大幅な変更</h3></div></div></div><p>#4824, `--without-wagyu`ビルドオプションを削除しました。WagyuはMVT対応のビルドでは必須になっているためです。</p><p>#4933, topology.GetFaceByPointは、不正なエッジリンクを持つトポロジでは動作しなくなります。</p><p>#4981, ST_StartPointが全てのジオメトリに対応しました。ラインストリング以外でNULLを返すことがなくなりました。</p><p>#4149, ST_AsMVTGeomは、対象範囲に近い縮尺で元のジオメトリの詳細データを以前より多く保存するようになりました。以前の単純化の振る舞いが必要な場合には、事前にST_Simplifyを実行します。 (Darafei Praliaskouskiさん)</p><p>Proj 4.9以上が必要です。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89097728"></a>性能強化</h3></div></div></div><p>#2592, CreateTopologyにおいてSRID &gt; 0でトポロジを定義できないようになりました (Sandro Santilliさん)</p><p>#3232, 孤立ノードを異なるフェイスに移動できないようにしました (Sandro Santilliさん)</p><p>トポロジ編集時にコレクションのTopoGeometryを考慮するようになりました (Sandro Santilliさん)</p><p>#3248, TopoGeometryで使われている孤立エッジを削除できないようにしました (Sandro Santilli)</p><p>#3231, TopoGeometryで使われている孤立ノードを削除できないようにしました (Sandro Santilli)</p><p>#3239, 接続しているノードがTopoGeometryの定義に使われているエッジの修復をできないようにしました (Sandro Santilliさん)</p><p>#4950, ValidateTopologyでノード用のcontaining_faceチェックの速度向上 (Sandro Santilliさん)</p><p>#4945, ValidateTopologyで複数の外殻を持つフェイスのチェック (Sandro Santilliさん)</p><p>#4944, ValidateTopologyで側面位置矛盾のチェック (Sandro Santilliさん)</p><p>#3042, ValidateTopologyでエッジ接続のチェック (Sandro Santilliさん)</p><p>#3276, ValidateTopologyでフェイスのMBRのチェック (Sandro Santilliさん)</p><p>#4936, ValidateTopologyをバウンディングボックスで制限できるようにしました (Sandro Santilliさん)</p><p>#4933, 巨大フェイス支配下のトポロジ構築の速度向上 (Sandro Santilliさん)</p><p>#3233, ValidateTopologyがノードのcontaining_faceをチェックするようになりました (Sandro Santilliさん)</p><p>#4830, ValidateTopologyが、エッジが両側のフェイスに囲まれているかをチェックするようになりました (Sandro Santilliさん)</p><p>#4827, WKT入力でNaN座標値を許すようになりました (Paul Ramsey)</p><p>ST_Value()がリサンプリングパラメータを受け付けるようになり、バイリニアのオプションを追加しました。 (Paul Ramseyさん)</p><p>#3778, #4401, ST_BoundaryがTINで動作し、曲線を線形化しなくなりました (Aliaksandr Kalenikさん)</p><p>#4881, #4884, 方向を保持するために、relationテーブル内の線のTopoGeometryに対応するedge_idの符号を格納 (Sandro Santilliさん)</p><p>#4628, シェープファイルのロード時にANALYZEを無効にするオプションを追加 (Stefan Corneliu Petreaさん)</p><p>#4924, 大きなマルチポイントでの動作がO(N^2) からO(NlogN)に早くなったST_RemoveRepeatedPoints (Aliaksandr Kalenikさん, Darafei Praliaskouskiさん)</p><p>#4925, ポイントを見落とさないようST_DumpPointsを修正 (Aliaksandr Kalenikさん)</p><p>検索速度向上のためST_SRID(topogeometry)を無効にしました (Sandro Santilliさん)</p><p>#2175, 同じ閉じた線をトポロジに追加する時に追加ノードを生成しないようにしました (Sandro Santilliさん)</p><p>#4974, address_standardizer_data_usのパスを更新しました (AivenのJan Katinsさん, Regina Obeさん)</p><p>#4975, PostGISアップグレードで一時テーブルを使わないように変更しました (AvienのJan Katinsさん)</p><p>#4981, ST_StartPointがどのジオメトリもサポートするようになりました (Aliaksandr Kalenikさん)</p><p>#4799, spatial_ref_sysにあるSRSをGeoJSONに取り込めるようになりました。</p><p>#4986, PostgreSQL 14のGiSTインデックスが、ヒルベルトソートで早くなりました。 (Han Wangさん, Aliaksandr Kalenikさん, Darafei Praliaskouskiさん, Giuseppe Broccoloさん)</p><p>#4949, 座標軸の交換の有無を渡すためにproj_normalize_for_visualizationを使います (Paul Ramseyさん)</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89110144"></a>新機能</h3></div></div></div><p>#4923, topology.ValidateTopologyRelation (Sandro Santilliさん)</p><p>#4933, topology.GetFaceContainingPoint (Sandro Santilliさん)</p><p>#2175, ST_Scroll (Sandro Santilliさん)</p><p>#4841, トポロジ行を早く取得するFindTopology (Sandro Santilliさん)</p><p>#4869, レイヤ行を早く取得するFindLayer (Sandro Santilli)</p><p>#4851, TopoGeom_addTopoGeom関数(Sandro Santilliさん)</p><p>ST_MakeValid(geometry, options)ではGEOS 3.10にある妥当性構築アルゴリズムの代替が可能になりました (Paul Ramseyさん)</p><p>GDALの多数のアルゴリズム (inverse weighted distance, average等)の一つを使ってサンプルポイント間でラスタセル内に値を入れる ST_InterpolateRaster() (Paul Ramseyさん)</p><p>GDALのアルゴリズムを使ってラスタ値からとうこうせんを生成するST_Contour() (Paul Ramseyさん)</p><p>ST_SetZ()/ST_SetM()でラスタから読み込んだデータを使ってジオメトリのZ値、M値を埋めるようになりました (Paul Ramseyさん)</p><p>新しいGUC postgis.gdal_vsi_options。これによって、VSIネットワークサービス上でのデータベース外ラスタが認証キー等を使ったアクセスが可能になりました。</p><p>入力ジオメトリの辺の集合を返すST_DumpSegments (Aliaksandr Kalenikさん)</p><p>#4859, ST_Point, ST_PointZ, ST_PointM, ST_PointZMのSRIDパラメータを持つコンストラクタ (Paul Ramseyさん)</p><p>#4808, ST_ClusterKMeansはmax_radius引数に対応しました。クラスタ数が不明だがクラスタのサイズが分かっている場合に使います。(Darafei Praliaskouskiさん)</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp89120768"></a>A.6. リリース 3.1.0beta1</h2></div></div></div><p>リリース日: 2020/12/09</p><p>3.1.0alpha2からの変更のみ挙げています。本バージョンではPostgreSQL 9.6-13とGEOS 
&gt;= 3.6+が必要です。Proj6+, PostgreSQL 12+, GEOS 3.9.0devを使用する場合に追加機能と機能強化が有効になります。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89122176"></a>大幅な変更</h3></div></div></div><p>4214, 非推奨関数 ST_Count(tablename,...), ST_ApproxCount(tablename, ...) ST_SummaryStats(tablename, ..), ST_Histogram(tablename, ...), ST_ApproxHistogram(tablename, ...), ST_Quantile(tablename, ...), ST_ApproxQuantile(tablename, ...)を削除。(Darafei Praliaskouskiさん)</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89123328"></a>性能強化</h3></div></div></div><p>4801, ST_ClusterKMeansがPOINT[Z]Mジオメトリの重みに対応しました (Darafei Praliaskouskiさん)</p><p>4804, ST_ReducePrecision (GEOS 3.9+)で妥当な精度の低下が可能になりました (Paul Ramseyさん)</p><p>4805, _ST_SortableHashは、PostgreSQLの並列ソートの能率に関する問題の回避法が出ています。テーブルが巨大な場合には、ORDER BY geomでなくORDER BY _ST_SortableHash(geom) を使います。</p><p>4625, 統計的相関が計算されるようになりました。BRINインデックスで使えるようにするにはANALYZEを実行します。 (Darafei Praliaskouskiさん)</p><p>ST_GeomFromGML()内におけるurn:ogc:def:crs:EPSGのaxis order問題を修正 (Even Roualtさん)</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp89126144"></a>A.7. リリース 3.1.0alpha3</h2></div></div></div><p>リリース日: 2020/11/19</p><p>3.1.0alpha2からの変更のみ挙げています。本バージョンではPostgreSQL 9.6-13とGEOS 
&gt;= 3.6+が必要です。Proj6+, PostgreSQL 12+, GEOS 3.9.0devを使用する場合に追加機能と機能強化が有効になります。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89127552"></a>大幅な変更</h3></div></div></div><p>4737, protobuf-cの必須バージョンを1.1.0に突然ながら変更 (Raúl Marínさん) 必須バージョンに合っていないか明示的に無効 (--without-protobuf)にした場合にコンフィギュアが失敗します。</p><p>4258, postgis_sfcgalのPostGISから独自ライブラリファイルへの分離 (Regina Obe)</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89129088"></a>新機能</h3></div></div></div><p>4698, ST_AsEWKTへのprecisionパラメータの追加 (Raúl Marínさん)</p><p>ST_Union, ST_UnaryUnion, ST_Difference, ST_Intersection, ST_SymDifference, ST_Subdivideへの任意パラメータgridSizeの追加、GEOS 3.9が必要 (Sandro Santilliさん)</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89130624"></a>性能強化</h3></div></div></div><p>4789, 多数の穴を持つ面TopoGeometryをTopoJSONで出力する際の速度向上 (Sandro Santilli)</p><p>4758, トポロジのノード作成のロバスト性の向上 (Sandro Santilliさん)</p><p>ST_Subdivideを割り込み可能にしました (Sandro Santilliさん)</p><p>4660, 浮動小数点数/座標値の印字を変更 (Raúl Marínさん) - 最短表現を使用します (十分に往復保証される条件付きです) - 絶対値で1e-8未満となる値に指数表記を使用します。以前は絶対値で1e-12未満は0と出力し、それより大きい場合は固定小数点形式です。 - 絶対値で1e+15を超える値に指数表記を使用します (同じ振る舞い)。 - 精度パラメータは指数表記に影響を与えます (以前は[5-8]に固定)。 - 全ての出力関数は求められる精度を尊重します (制限がありません)。 - デフォルトの精度は同じです (GeoJSONは9で、その他は15)。</p><p>4729, WKT/KML: 浮動小数点数を直接文字列バッファに書き込むよう変更 (Raúl Marínさん)</p><p>4533, BOX型で標準の座標印字システムを使用するよう変更 (Raúl Marínさん)</p><p>4686, 可能な時にジオグラフィの伸張を避けるよう変更 (Raúl Marínさん) ジオメトリがバウンディングボックスとST_BoundingDiagonalとの関係で完全に内側にあるか完全に外側にある場合に、ANALYZE, _ST_PointOutside, postgis_geobbox, ST_CombineBbox(box2d, geometry), ST_ClipByBox2Dに影響が出ます。</p><p>4741, インデックスを使う必要がある場合にはST_PointInsideCircleは使わず、ST_DWithinを代わりに使ってください。文書を調整 (Darafei Praliaskouski)</p><p>4737, ST_AsMVTの、特に並列処理を含むクエリで、能率改善とメモリ使用削減 (Raúl Marínさん)</p><p>4746, シリアル化プロセスで小さな最適化 (Raúl Marínさん)</p><p>4719, ST_Intersection(geometry,raster)でSRID不一致とスキーマ修飾の不一致で早期に失敗させるよう変更。 (Regina Obeさん)</p><p>4784, ST_CollectionExtract(geometry)に、最大次元の要素を抽出するデフォルトの振る舞いを追加。 (Paul Ramseyさん)</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89140096"></a>誤り訂正</h3></div></div></div><p>4691, 空ジオメトリでGiSTインデックスを生成する際にセグメンテーション違反が出るのを修正 (Raúl Marínさん)</p><p>悪いWKB入力 (Oracleタイプ)と不正なWKBのユニットテストの処理を修正。不正なWKBの処理ではメモリリークを除きました。 (Paul Ramsey)</p><p>4740, geography_distance_treeでの値の丸めをgeography_distance上での実行と同じに変更 (Raúl Marínさん, Paul Ramsey, Regina Obeさん)</p><p>4739, postgis_oidを使う全ての関数について内部キャッシュの初期化を確実に実行するよう更新 (Raúl Marín)</p><p>4767, #4768, #4771, #4772, 不正なWKBのパース時のSEGFAULTが出るのを修正 (Raúl Marínさん)</p><p>4769, st_addbandでSEGFAULTが出るのを修正 (Raúl Marínさん)</p><p>4790, 同一の頂点を持つ場合のST_3dintersects計算を修正 (Nicklas Avénさん)</p><p>4742, TigerジオコーダのアップグレードでTigerを2018年版に戻る (Regina Obeさん)</p><p>3372, TopoElementArrayがNULLになれない - ドメイン制約の変更 (Regina Obeさん)</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp89144448"></a>A.8. リリース 3.1.0alpha2</h2></div></div></div><p>リリース日: 2020/07/18</p><p>3.1.0alpha1からの変更のみ挙げています。本バージョンではPostgreSQL 9.6-13とGEOS 
&gt;= 3.6+が必要です。Proj6+, PostgreSQL 12+, GEOS 3.9.0devを使用する場合に追加機能と機能強化が有効になります。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89145856"></a>新機能</h3></div></div></div><p>4656, 暗黙的にGeoJSONを食べさせるためのgeojson_text::geometryのキャスト (Raúl Marínさん)</p><p>4687, GEOS MaximumInscribedCircleの公開 (Paul Ramseyさん)</p><p>4710, ST_ClusterKMeansが3次元ジオメトリで動作するよう変更 (Darafei Praliaskouskiさん)</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89147904"></a>性能強化</h3></div></div></div><p>4675, topology.GetRingEdgesがCでの実装に変更 (Sandro Santilliさん)</p><p>4681, ST_GetFaceGeometry: 破損情報の表示 (Sandro Santilliさん)</p><p>4651, ST_Simplify: 全く削除されないなら複製しないよう変更 (Raúl Marínさん)</p><p>4657,トーストからの復帰を可能な限り避ける (Paul Ramseyさん)</p><p>4490, 関数のコストの微調整 (Raúl Marínさん)</p><p>4672, getSRSbySRIDとgetSRIDbySRSのキャッシュ (Raúl Marínさん)</p><p>4676, トーストされたジオメトリをヘッダだけを読むために伸張を回避しました (Raúl Marínさん) PostgreSQLポイント型へのキャストの最適化 (Raúl Marínさん)</p><p>4620, 内部のwagyuを0.5.0に更新 (Raúl Marínさん)</p><p>4623, varlena型を返す関数の最適化 (Raúl Marínさん)</p><p>4677, 異なるキャッシュタイプ間でのgserializedオブジェクトの共有 (Raúl Marínさん)</p><p>MSVCコンパイラによるコンパイルの修正と一切合切の標準化 (Loïc Bartolettiさん)</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89153152"></a>誤り訂正 </h3></div></div></div><p>4652, ST_GeomFromGMLの複数のメモリ関係の誤りを訂正 (Raúl Marínさん)</p><p>4661, デフォルト以外のスキーマでのspatial_ref_sysへのアクセスの修正 (Raúl Marínさん)</p><p>4670, ST_AddPoint: 正位置が要求される時の誤りを修正 (Raúl Marínさん)</p><p>4699, ST_Union(raster, otherarg)へのNULL入力時に異常終了 (Jaime Casanovaさん, 2ndQuadrant)</p><p>4716, configureスクリプト内のpkg-configの複数の問題を修正 (Raúl Marínさん)</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp89155968"></a>A.9. リリース 3.1.0alpha1</h2></div></div></div><p>リリース日: 2020/02/01</p><p>このバージョンにはPostgreSQL 9.6+-13 と GEOS 
&gt;= 3.6+ が必要です。 Proj6+, PostgreSQL 12+, GEOS 3.8.0 で追加機能と機能強化が有効になります。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89157376"></a>大幅な変更</h3></div></div></div><p>バージョン出力をsvn番号からgitハッシュに変更 (Sandro Santilliさん, Raúl Marínさん)</p><p>4577, PostgreSQL 9.5対応を削除 (Raúl Marínさん)</p><p>4579, postgis_proc_set_search_path.plを削除 (Raúl Marínさん)</p><p>4601, ST_TileEnvelopeのシグネチャを変更。</p><p>3057, ST_Force3D, ST_Force3DZ, ST_Force3DM, ST_Force4Dのシグネチャを変更。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89160192"></a>新機能</h3></div></div></div><p>4601, ST_TileEnvelopeへのマージン引数の追加 (Yuri Astrakhanさん)</p><p>2972, pgsql2shpに消音モード (-q)を追加 (Kristian Thyさん)</p><p>4617, configureに`--without-phony-revision`スイッチの追加 (Raúl Marínさん)</p><p>3057, Force3D*とForce4Dの任意パラメータ (Kristian Thyさん)</p><p>4624, 平面のタイルを生成するために集合を返す関数ST_HexagonGridとST_SquareGrid (Paul Ramseyさん)</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89162880"></a>性能強化</h3></div></div></div><p>4539, libmのインクルードを統一しました (Raúl Marínさん)</p><p>4569, 不明なSRIDを持つジオメトリのSRIDのtypmodを持つカラムへの挿入を可能にしました (Paul Ramseyさん)</p><p>4149, ST_Simplify(geom, 0)がO(N)になりました。ST_Affine (ST_Translate, ST_TransScale, ST_Rotate)を静的化されました。ST_SnapToGridが最適化されました。(Darafei Praliaskouskiさん)</p><p>4574, リンク時最適化が有効になりました (Darafei Praliaskouskiさん)</p><p>4578, BRIN関数にparallelismとcostプロパティを追加 (Raúl Marínさん)</p><p>4473, yacc警告を消す (Raúl Marínさん)</p><p>4589, "--enable-debug"なしでビルドする際にCのassertを無効化 (Raúl Marínさん)</p><p>4543, 倍精度浮動小数点数の出力にRyuアルゴリズムの導入 (Raúl Marínさん)</p><p>4626, libxml2のpkg-configに対応 (Bas Couwenbergさん)</p><p>4615, GeoJSON出力の速度向上 (Raúl Marínさん)</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp89167744"></a>A.10. リリース 3.0.0</h2></div></div></div><p>リリース日: 2019/10/20</p><p>このバージョンでは PostgreSQL 9.5から12までの間、GEOS 3.6以上がそれぞれ必要です。Proj6+、PostgreSQL 12、GEOS 3.8.0を使っている場合には追加機能と機能強化が有効になります。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89169152"></a>新機能</h3></div></div></div><p>2902, postgis_geos_noop (Sandro Santilliさん)</p><p>4128, ST_AsMVTの地物IDへの対応 (Stepan Kuzminさん)</p><p>4230, SP-GiSTとGiSTのN次元ボックスのoverlaps, contains, within, equalsへの対応 (Université Libre de Bruxelles (ULB)のEsteban ZimányiさんとArthur Lesuisseさん, Darafei Praliaskouskiさん)</p><p>4171, ST_3DLineInterpolatePoint (Julien Cabiecesさん, Vincent Moraさん)</p><p>4311, MVTポリゴンの評価にWAGYUを導入しました。利用するにはC++11コンパイラが必要で、CXXFLAGS (CFLAGSでなく)を使います。この選択肢を無効にして2.5からの挙動を維持するには`--without-wagyu`を追加します (Raúl Marínさん)</p><p>1833, ST_AsGeoJSON(row)での完全なGeoJSON地物の生成 (Joe Conwayさん)</p><p>3687, 暗黙的なGeoJSON生成のためのJSON (ジオメトリ)とJSONB(ジオメトリ)のキャスト (Paul Ramseyさん)</p><p>4198, SFCGAL関数のST_ConstrainedDelaunayTrianglesの追加 (Darafei Praliaskouskiさん)</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89173120"></a>大幅な変更</h3></div></div></div><p>4267, GEOSの最小バージョンを3.6に変更 (Regina Obeさん, Darafei Praliaskouskiさん)</p><p>3888, ラスタ機能を別のエクステンションに分離 (Sandro Santilliさん)</p><p>3807, エクステンションのライブラリファイルにマイナーバージョンは含まれなくなりました。古い振る舞いが必要な場合にはコンフィギュレーション時に--with-library-minor-versionオプションを指定します。(Regina Obeさん)</p><p>4230, 現在ではN次元ボックスの演算子 (overlaps, contains, within, equals)は、どちらのオペランドに存在しない次元を確認していません。アップグレード後にN次元インデックスのREINDEXを実行して下さい (Darafei Praliaskouskiさん)</p><p>4229, PostgreSQL 9.5未満への対応を終了しました (Darafei Praliaskouskiさん)</p><p>4260, liblwgeomヘッダファイルがインストールされなくなりました。あなたのプロジェクトでヘッダファイルに依存している場合には、librttopoを代わりに使用して下さい (Darafei Praliaskouskiさん)</p><p>4258, ST_Area, ST_Distance, ST_Intersection, ST_Difference, ST_Union, ST_Intersects, ST_3DIntersects, ST_3DDistanceのSFCGAL対応を削除し、postgis.backendスイッチを削除しました (Darafei Praliaskouski)</p><p>4267, Proj 6の非推奨APIを有効にして使用しています (Darafei Praliaskouskiさん, Raúl Marínさん)</p><p>4267, SFCGALの最小バージョンを1.3.1に変更 (Darafei Praliaskouskiさん)</p><p>4331, ST_3DMakeBoxは現在は非常に小さいボックスを返していた場合にエラーを返すように変更 (Regina Obeさん)</p><p>4342, ST_AsGeoJSONとST_AsKMLのバージョンを付ける形式を削除しました (Paul Ramseyさん)</p><p>4356, ST_Accumを削除しました。array_aggを代わりに使います (Darafei Praliaskouskiさん)</p><p>4414, address_standardizerライブラリにバージョン番号が入るよう変更 (Raúl Marín)</p><p>4334, 名前を変えた関数パラメータに関係するアップグレードの問題を修正 (Raúl Marínさん)</p><p>4442, raster2pgsqlはNODATAタイルを飛ばす。何らかの理由でデータベースに保存する場合には-kオプションを使います。 (Darafei Praliaskouski)</p><p>4433, 32ビットのハッシュの修正 (インデックスの再インデックスが必要) (Raúl Marín)</p><p>3883, ソートではヒルベルト曲線と省略比較を使用しています。B木インデックスを使っている場合にはREINDEXの実行が必要です (Darafei Praliaskouskiさん)</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89180416"></a>性能強化</h3></div></div></div><p>4341, ST_Intersects等で補助するインデックスを提供するためのメカニズムに、PostgreSQL 12以上の「補助関数」APIを使用してSQLインラインを置き換えました。</p><p>4330, 出力が中間プロセスにパイプで流されている時にpostgis_restoreがメモリ不足になる問題 (Hugh Ranalliさん)</p><p>4322, Proj 6+ APIへの対応、より精度の高い測地系変換、およびWKT投影への対応</p><p>4153, ST_Segmentizeは現在は線分を比例して分割します (Darafei Praliaskouski)</p><p>4162, ST_DWithinの文書にテーブルへのジオメトリと半径との格納されている場合の例を記述しました。 (Darafei Praliaskouskiさん, GitHubユーザBoscopさん)</p><p>4161, #4294, ST_AsMVTGeom: 解像度より小さいジオメトリのショートカット (Raúl Marínさん)</p><p>4176, ST_IntersectsがGEOMETRYCOLLECTIONに対応するよう変更 (Darafei Praliaskouskiさん)</p><p>4181, ST_AsMVTGeom: 評価によるタイプの変更を回避します (Raúl Marínさん)</p><p>4183, ST_AsMVTGeom: 単純化後に不正なジオメトリを削除します (Raúl Marínさん)</p><p>4196, postgis_extensions_upgrade()がパッケージ化されていないエクステンションのパッケージ化を行うように変更 (Sandro Santilliさん)</p><p>4215, ST_DumpAsPolygonsでの浮動小数点数の比較を使用 (Darafei Praliaskouskiさん)</p><p>4155, ST_LocateBetweenとST_LocateBetweenElevationsでのGEOMETRYCOLLECTION, POLYGON, TIN, TRIANGLEへの対応 (Darafei Praliaskouskiさん)</p><p>2767, AddRasterConstraintの任意パラメータの文書 (Sunveer Singhさん)</p><p>4244, BOX2D_outでのアラインメントされていないメモリを回避 (Raúl Marínさん)</p><p>4139, 次元混合のN次元インデックスが正しい木を構築できるよう変更 (Darafei Praliaskouskiさん, Arthur Lesuisseさん, Andrew Gierthさん, Raúl Marínさん)</p><p>4262, ST_LineToCurveのMULTISURFACEに適合している旨の記述 (Steven Ottensさん)</p><p>4276, ST_AsGeoJSONの文書の更新 (Darafei Praliaskouskiさん)</p><p>4292, ST_AsMVT: JSONのパースで小数点付き数値を倍精度浮動小数点数とする (Raúl Marínさん)</p><p>4300, ST_AsMVTGeom: 常に最も単純なジオメトリを返す (Raúl Marínさん)</p><p>4301, ST_Subdivide: 境界と一致しかける座標値で無限ループが発生するのを修正 (Darafei Praliaskouskiさん)</p><p>4289, ST_AsMVTGeom: クリップ前に座標空間の変換を行うように変更 (Raúl Marínさん)</p><p>4272, 統計情報計算不能時のNOTICEメッセージの改善 (Raúl Marínさん)</p><p>4313, #4307, PostgreSQL 12互換性 (Laurenz Albeさん, Raúl Marínさん)</p><p>4299, #4304, ST_GeneratePointsは現在はVOLATILE属性が付いていて、seedパラメータが追加されているものはIMMUTABLE属性が付いています (Mike Tavesさん)</p><p>4278, ST_3DDistanceとST_3DIntersectsは現在は立体としてのTINと立体としてのPOLYHEDRALSURFACEに対応しています (Darafei Praliaskouskiさん)</p><p>4348, ST_AsMVTGeom (GEOS): 常に検証を行うようにしました (Raúl Marínさん)</p><p>4295, ST_Overlaps, ST_Contains, ST_ContainsProperly, ST_Covers, ST_CoveredBy, ST_Crosses, ST_Touches, ST_Disjoint, ST_Relate, ST_EqualsでGEOMETRYCOLLECTIONを使用可能に (Esteban Zimányiさん)</p><p>4340, ST_Union集約関数はジオメトリ1GB以上でも処理できるようになっています (Darafei Praliaskouskiさん)</p><p>4378, TIN入力をGEOSバックエンドの関数に渡すようにしました (Darafei Praliaskouskiさん)</p><p>4368, LWGEOM構造体の余分なパディングが最小になるようメンバの並び替え (Raúl Marínさん)</p><p>4141, トポロジエクステンション内の行数処理にuint64を使用するよう変更 (Raúl Marínさん)</p><p>4412, NODATA=NaNのラスタの入力に対応しました (Darafei Praliaskouskiさん)</p><p>4413, raster2pgsql -t auto で、ラスタタイルサイズはGeoTIFFブロックサイズに従います (Darafei Praliaskouskiさん)</p><p>4422, Python 3の準備のためPython 2コードの訂正 (Christian Claussさん)</p><p>4352, PostgreSQL 12以上でCREATE OR REPLACE AGGREGATEを使用するよう変更 (Raúl Marín)</p><p>4394, ジオメトリの等価系演算子をFULL OUTER JOINで利用できるよう変更 (Darafei Praliaskouskiさん)</p><p>4441, GiSTをマルチカラムインデックスに対してペナルティが有効になるように、かつシングルカラムインデックスでより速くなるようにしました (Darafei Praliaskouskiさん)</p><p>4403, shp2pgsqlのコピーモード (-D)での座標値変換機能への対応 (Regina Obeさん)</p><p>4410, SRID不一致のエラーメッセージを従来より説明になるよう変更 (Darafei Praliaskouskiさん)</p><p>4399, 全ての出力関数でTINとTRIANGLEに対応 (Darafei Praliaskouskiさん)</p><p>3719, 線形化で弧あたりの線分最小数設定の強制 (Dan Bastonさん / City of Helsinki, Raúl Marínさん)</p><p>4277, RFC7946により、ST_GeomFromGeoJSONはデフォルトでSRID=4326を設定するようにし、また、4326以外から出力する場合にはST_AsGeoJSONは出力JSONにSRIDを設定するようにしています。 (Darafei Praliaskouskiさん)</p><p>3979, 往復関数postgis_sfcgal_noop() (Lucas C. Villa Realさん)</p><p>4328, 2次元TIN用のST_3DIntersects (Darafei Praliaskouskiさん)</p><p>4509, Tiger 2019のジオコーダの更新 (Regina Obeさん)</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp89198720"></a>A.11. リリース 3.0.0rc2</h2></div></div></div><p>リリース日: 2019/10/13</p><p>PostgreSQL+JITでコンパイルする場合にはLLVM 6以上が必要です。</p><p>このリリースに対応しているPostgreSQLのバージョンはPostgreSQL 9.5からPostgreSQL 12、GEOS 3.6以上です。Proj6以上とPostgreSQL 12を使うと追加機能が有効になります。GEOS 3.8以上を使うと性能が良くなります。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89200512"></a>主なハイライト</h3></div></div></div><p>4534, lwcurvepoly_from_wkb_stateのリークを修正 (Raúl Marínさん)</p><p>4536, lwcollection_from_wkb_stateのリークを修正 (Raúl Marínさん)</p><p>4537, WKTコレクションのパーサのリークを修正 (Raúl Marínさん)</p><p>4535, WKB: バッファオーバーフローを回避 (Raúl Marínさん)</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp89202944"></a>A.12. リリース 3.0.0rc1</h2></div></div></div><p>リリース日: 2019/10/08</p><p>PostgreSQL+JITでコンパイルする場合にはLLVM 6以上が必要です。</p><p>このリリースに対応しているPostgreSQLのバージョンはPostgreSQL 9.5からPostgreSQL 12、GEOS 3.6以上です。Proj6以上とPostgreSQL 12を使うと追加機能が有効になります。GEOS 3.8以上を使うと性能が良くなります。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89204736"></a>主なハイライト</h3></div></div></div><p>4519, getSRIDbySRSがクラッシュするのを訂正 (Raúl Marínさん)</p><p>4520,C++ライブラリを検出しているときに清浄な環境で行うように変更 (Raúl Marínさん)</p><p>集約関数ST_Union()のシグネチャを再格納して、不要な集約関数のシグネチャを削除しました。また、能率/サイズの機能強化をやり直し、ST_Union()で配列型を使用しないようにし、できれば、配列サイズの制限を避けるようにしました。 (Paul Ramseyさん)</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp89206784"></a>A.13. リリース 3.0.0beta1</h2></div></div></div><p>リリース日: 2019/09/28</p><p>PostgreSQL+JITでコンパイルする場合にはLLVM 6以上が必要です。</p><p>このリリースに対応しているPostgreSQLのバージョンはPostgreSQL 9.5からPostgreSQL 12、GEOS 3.6以上です。Proj6以上とPostgreSQL 12を使うと追加機能が有効になります。GEOS 3.8以上を使うと性能が良くなります。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89208576"></a>主なハイライト</h3></div></div></div><p>4492, ST_Simplifyが第3パラメータの値を無視するのを訂正 (Raúl Marínさん)</p><p>4494, ST_Simplify出力に古くなったbboxが含まれるのを修正 (Raúl Marínさん)</p><p>4493, ST_RemoveRepeatedPoints出力に古くなったbboxが含まれるのを修正 (Raúl Marínさん)</p><p>4495, ST_SnapToGrid出力に古くなったbboxが含まれるのを修正 (Raúl Marínさん)</p><p>4496, ST_Simplify(TRIANGLE)で要求があるなら小さい面を保存するように変更 (Raúl Marínさん)</p><p>4501, スーパーユーザでなくてもpostgis_tiger_geocoderをインストールできるようにする (Regina Obeさん)</p><p>4503, デカルトbboxの計算の速度向上 (Raúl Marínさん)</p><p>4504, shp2pgsql -Dがスキーマ修飾テーブルで動作しない (Regina Obeさん)</p><p>4505, GEOSとジオメトリとの相互変換の速度向上 (Dan Bastonさん)</p><p>4507, GEOS 3.8+のGEOSMakeValidとGEOSBuildAreaの使用 (Dan Bastonさん)</p><p>4491, ST_RemoveRepeatedPointsの速度向上 (Raúl Marínさん)</p><p>4509, Tiger 2019のジオコーダの更新 (Regina Obeさん)</p><p>4338, センサスのブロックレベルデータ (tabblock テーブル)がロードできない (Regina Obeさん)</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp89230976"></a>A.14. リリース 3.0.0alpha4</h2></div></div></div><p>リリース日: 2019/08/11</p><p>PostgreSQL+JITでコンパイルする場合にはLLVM 6以上が必要です。</p><p>このリリースに対応しているPostgreSQLのバージョンはPostgreSQL 9.5からPostgreSQL 12、GEOS 3.6以上です。Proj6以上とPostgreSQL 12を使用している場合には、追加機能が有効になります。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89232768"></a>主なハイライト</h3></div></div></div><p>4433, 32ビットのハッシュの修正 (インデックスの再インデックスが必要) (Raúl Marín)</p><p>4445, geometry_leの誤り修正 (Raúl Marínさん)</p><p>4451, gserialized_max_header_sizeの計算の訂正 (Raúl Marínさん)</p><p>4450, ST_GeometryTypeの速度向上 (Raúl Marínさん)</p><p>4452, ST_TileEnvelope()の追加 (Paul Ramseyさん)</p><p>4403, shp2pgsqlのコピーモード (-D)での座標値変換機能への対応 (Regina Obeさん)</p><p>4417, spatial_ref_sysの新しいエントリでの更新 (Paul Ramseyさん)</p><p>4449, ST_X, ST_Y, ST_Z, ST_Mの速度向上 (Raúl Marínさん)</p><p>4454, _ST_OrderingEqualsの速度向上 (Raúl Marínさん)</p><p>4453, ST_IsEmptyの速度向上 (Raúl Marínさん)</p><p>4271, pg_upgrade後にpostgis_extensions_upgrade()も更新するように変更 (Raúl Marínさん)</p><p>4466, _postgis_gserialized_statsの未定義のふるまいを訂正 (Raúl Marínさん)</p><p>4209, pgsql2shpでのNULLジオメトリ値の取り扱い (Paul Ramseyさん)</p><p>4419, mvt/geobufの有効化/無効化のためのprotobuf版の使用 (Paul Ramsey)</p><p>4437, シェープローダ/ダンパでのPOINT EMPTYの取り扱い (Paul Ramseyさん)</p><p>4456, Rasbery Pi 32ビットのテスト用のJenkinsボットの追加 (Bruce Rindahlさん,Regina Obeさん)</p><p>4420, address_standardizerエクステンションの更新パスが存在しない (Regina Obeさん)</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp89240448"></a>A.15. リリース 3.0.0alpha3</h2></div></div></div><p>リリース日: 2019/07/01</p><p>PostgreSQL+JITでコンパイルする場合にはLLVM 6以上が必要です。</p><p>このリリースに対応しているPostgreSQLのバージョンはPostgreSQL 9.5からPostgreSQL 12、GEOS 3.6以上です。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89242240"></a>主なハイライト</h3></div></div></div><p>4414, address_standardizerライブラリにバージョン番号が入るよう変更 (Raúl Marín)</p><p>4352, PostgreSQL 12以上でCREATE OR REPLACE AGGREGATEを使用するよう変更 (Raúl Marín)</p><p>4334, パラメータ名変更に関連するアップグレードの問題を修正 (Raúl Marín)</p><p>4388, AddRasterConstraints: 制約を生成する時にNULLを無視するように変更 (Raúl Marín)</p><p>4327, getenvの結果をpfreeに与えるのを回避 (Raúl Marín)</p><p>4406, ジオハッシュの復号時に不正な文字があるとエラーを投げるように変更 (Raúl Marínさん)</p><p>4429, PROJ6を使うとリソースにリークが発生する問題の回避 (Raúl Marín)</p><p>4372, PROJ6 速度向上 (Raúl Marín)</p><p>3437, ポイントを引数にとるST_Intersectsの速度向上 (Raúl Marín)</p><p>4438, 拡張フラグ領域に対応するためシリアル化を変更 (Paul Ramseyさん)</p><p>4443, WagyuのコンフィギュレーションでCPPFLAGSを削除するよう修正 (Raúl Marínさん)</p><p>4440, FDWの型の検索に失敗する (Paul Ramseyさん)</p><p>4442, raster2pgsqlはNODATAタイルを飛ばす。何らかの理由でデータベースに保存する場合には-kオプションを使います。 (Darafei Praliaskouski)</p><p>4441, GiSTをマルチカラムインデックスに対してペナルティが有効になるように、かつシングルカラムインデックスでより速くなるようにしました (Darafei Praliaskouskiさん)</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp89248640"></a>A.16. リリース 3.0.0alpha2</h2></div></div></div><p>リリース日: 2019/06/02</p><p>PostgreSQL+JITでコンパイルする場合にはLLVM 6以上が必要です。</p><p>このリリースに対応しているPostgreSQLのバージョンはPostgreSQL 9.5からPostgreSQL 12、GEOS 3.6以上です。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89250432"></a>主なハイライト</h3></div></div></div><p>#4404, 補助関数の選択性問題の修正 (Paul Ramseyさん)</p><p>#4311, Wagyuをポリゴンの評価に関する既定の選択肢にしました。この際、C++11コンパイラが必要で、CXXFLAGSを使います (CFLAGSではない)。MVT対応でビルドする場合に有効になるだけです。`--without-wagyu`で無効にして、2.5の動作を維持できます。 (Raul Marinさん)</p><p>#4198, SFCGAL関数ST_ConstrainedDelaunayTrianglesの追加 (Darafei Praliaskouskiさん)</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp89252480"></a>A.17. リリース 3.0.0alpha1</h2></div></div></div><p>リリース日: 2019/05/26</p><p>PostgreSQL+JITでコンパイルする場合にはLLVM 6以上が必要です。</p><p>このリリースに対応しているPostgreSQLのバージョンはPostgreSQL 9.5からPostgreSQL 12、GEOS 3.6以上です。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89254272"></a>新機能</h3></div></div></div><p>Proj6以上を実行している場合には追加機能が有効になります</p><p>詳細はソースツリーに含まれるNEWSファイルをご覧下さい。</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp89276416"></a>A.18. リリース 2.5.0</h2></div></div></div><p>発売日: 2018/09/23</p><p>PostgreSQL+JITでコンパイルする場合にはLLVM 6以上が必要です。</p><p>このリリースに対応しているPostgreSQLのバージョンはPostgreSQL 9.5からPostgreSQL 12 (開発中)、GEOS 3.5以上です。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89278208"></a>新機能</h3></div></div></div><p>#1847, PostgreSQL 11以上のSP-GiSTの2次元と3次元の対応 (Esteban ZimányiさんとArthur Lesuisseさん (以上Université Libre de Bruxelles (ULB)から)、Darafei Praliaskouskiさん)</p><p>#4056, ST_FilterByM (Nicklas Avénさん)</p><p>#4050, ST_ChaikinSmoothing (Nicklas Avénさん)</p><p>#3989, ST_Buffer single sided option (Stephen Knoxさん)</p><p>#3876, ST_Angle function (Rémi Curaさん)</p><p>#3564, ST_LineInterpolatePoints (Dan Bastonさん)</p><p>#3896, PostGIS_Extensions_Upgrade() (Regina Obeさん)</p><p>#3913, パッケージに含まれていないものからのエクステンション生成時のアップグレード (Sandro Santilliさん)</p><p>#2256, _postgis_index_extent() for extent from index (Paul Ramseyさん)</p><p>#3176, Add ST_OrientedEnvelope (Dan Bastonさん)</p><p>#4029, Add ST_QuantizeCoordinates (Dan Bastonさん)</p><p>#4063, ST_Scaleの仮想原点任意引数 (Paul Ramseyさん)</p><p>#4082, ST_BandFileSizeとST_BandFileTimestampの追加とST_BandMetadataの拡張 (Even Rouaultさん)</p><p>#2597, Add ST_Grayscale (Bborie Parkさん)</p><p>#4007, Add ST_SetBandPath (Bborie Parkさん)</p><p>#4008, Add ST_SetBandIndex (Bborie Parkさん)</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89285376"></a>大幅な変更</h3></div></div></div><p>複数の古いバージョンからのアップデートスクリプトは現在は、全て単一のアップグレードスクリプトからのシンボリックリンクになりました (Sandro Santilliさん)</p><p>#3944, EPSG第9.2版へのアップデート (Even Rouaultさん)</p><p>#3927, ST_AsMVTのパラレル実装</p><p>#3925, MVT生成前のジオメトリの簡略化で地図のグリッドセルサイズを使うようにしました</p><p>#3899, 空ジオメトリおよび同じ接頭辞のジオメトリについてのB木のソートの並び順は、現在は、定義されています (Darafei Praliaskouskiさん)</p><p>#3864, POINTジオメトリのソートの効率改善 (Darafei Praliaskouskiさん)</p><p>#3900, GCC警告の修正、make -jが動作します (Darafei Praliaskouskiさん) - TopoGeo_addLinestringの堅牢性の改善 (Sandro Santilliさん) #1855, #1946, #3718, #3838</p><p>#3234, 空ポイントをトポロジのノードとして追加するのを禁止しました (Sandro Santilliさん)</p><p>#1014, ジオメトリがハッシュ可能になり、共通テーブル式のシグネチャに直接使えるようになりました (Paul Ramseyさん)</p><p>#3097, ST_Split()でMULTILINESTRINGで刃ができるようにしました (Paul Ramseyさん)</p><p>#3942, JSON-C 0.13以上でプライベートのヘッダを取り込まないように変更 (Björn Esserさん)</p><p>#3954, ST_GeometricMedianがポイントの重みに対応しました (Darafei Praliaskouskiさん)</p><p>#3965, #3971, #3977, #4071 ST_ClusterKMeansの再記述: 初期化改善、収束の高速化、K=2でも高速化 (Darafei Praliaskouskiさん)</p><p>#3982, ST_AsEncodedPolylineがLINESTRING EMPTYとMULTIPOINT EMPTYに対応しました (Darafei Praliaskouskiさん)</p><p>#3986, ST_AsTextに桁数を制限するための第2引数が導入されました (Marc Ducobuさん, Darafei Praliaskouskiさん)</p><p>#4020, BOX3Dからジオメトリへのキャストで、正しくつながった多面体サーフェイスが返るようになりました (Matthias Bayさん)</p><p>#2508, ST_OffsetCurveがジオメトリコレクションで動作するようになりました (Darafei Praliaskouskiさん)</p><p>#4006, ST_GeomFromGeoJSONの入力としてjsonとjsonbに対応するようになりました (Paul Ramseyさん, Regina Obeさん)</p><p>#4038, ST_Subdivideでジオメトリ分割のためのピボット選択で入力頂点を再利用するようにしました (Darafei Praliaskouskiさん)</p><p>#4025, #4032 ST_ClosestPointOfApproach, ST_DistanceCPAおよびST_CPAWithinの精度の問題の修正 (Paul Ramseyさん, Darafei Praliaskouskiさん)</p><p>#4076, トポロジ実装でのGEOS使用頻度の低減 (Björn Harrtellさん)</p><p>#4080, ST_BandMetaDataに外部ラスタのバンドを追加 - ラスタの挙動に関する情報 (例: データベース外ラスタの能率、最大の開けるファイル数)提供として「ラスタに関する技法」節を文書に追加</p><p>#4084: BOX3Dの前後に対する間違ったコード内コメントを訂正 (Matthias Bayさん)</p><p>#4060, #4094, PostgreSQL JIT対応 (Raúl Marínさん, Laurenz Albeさん)</p><p>#3960, ST_Centroidがlwgeom_centroidを使用するよう変更 (Darafei Praliaskouskiさん)</p><p>#4027, lwgeom_geosの重複コードの削除 (Darafei Praliaskouskiさん, Daniel Bastonさん)</p><p>#4115, パラレルの計画で不正なプロパティ値を持つMVTを生成する誤りを修正 (Raúl Marínさん)。</p><p>#4120, ST_AsMVTGeom: タイル座標系を使ったクリップ (Raúl Marínさん)。</p><p>#4132, ラスタのST_IntersectionがTopologyExceptionが投げられることなく動作するよう変更 (Vinícius A.B. Schmidtさん, Darafei Praliaskouskiさん)</p><p>#4177, #4180 PostgreSQL 12の開発ブランチへの対応 (Laurenz Albeさん, Raúl Marínさん)</p><p>#4156, ST_ChaikinSmoothing: デフォルトでポリゴンの始点終点も平滑化するようにしました (Darafei Praliaskouskiさん)</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp89298176"></a>A.19. リリース 2.4.5</h2></div></div></div><p>リリース日: 2018/09/12</p><p>誤り訂正と性能改善のリリースです。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89299584"></a>誤り訂正</h3></div></div></div><p>#4031, ST_CurveToLineに渡される大きなMaxError許容値を生き残るようにしました (Sandro Santilliさん)</p><p>#4058, 大きい半径の小さい弧の線形化での無限ループを修正 (Sandro Santilliさん)</p><p>#4071, NULL/EMPTYを入力に与えたST_ClusterKMeansが異常終了する問題を修正 (Darafei Praliaskouskiさん)</p><p>#4079, ST_AsMVTGeomの出力をのポリゴンを確実に時計回りになるよう変更 (Paul Ramseyさん)</p><p>#4070, GEOS中断時に標準のエラーコードを使うよう変更 (Paul Ramseyさん)</p><p>#3980, 処理完了までの入力の解放が遅い(lucasvrさん)</p><p>#4090, PostgreSQL 11への対応 (Paul Ramseyさん, Raúl Marínさん)</p><p>#4077, 特定の空ジオメトリの場合にシリアル化が失敗する (Paul Ramsey)</p><p>#3997, lwgeom_medianの誤り修正とゼロ除算の回避 (Raúl Marínさん)</p><p>#4093, qsortのコールバックからの結果に一貫性が無い (yugrさん)</p><p>#4081, ジオグラフィ版DWithin()の特定ケースでの問題 (Paul Ramseyさん)</p><p>#4105, ソースツリーのパラレルビルド (Bas Couwenbergさん)</p><p>#4163, MVT: 先頭のジオメトリがNULLの時に発生するリソースリークの修正 (Raúl Marínさん)</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp89309440"></a>A.20. リリース 2.4.4</h2></div></div></div><p>リリース日: 2018/04/08</p><p>誤り訂正と性能改善のリリースです。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89310848"></a>誤り訂正</h3></div></div></div><p>#3055, [ラスタ] バンドの無いラスタでST_Clip()を実行するとサーバが異常終了する (Regina Obeさん)</p><p>#3942, geojson: json-c &gt;= 0.13でプライベートのヘッダを取り込まないようにしました (Björn Esserさん)</p><p>#3952, 並列モードでST_Transformが失敗する (Paul Ramseyさん)</p><p>#3978, 2.1以前からのアップグレード時にKNNを訂正するようにしました (Sandro Santilliさん)</p><p>#4003, lwpoly_construct_circle: 0で割る問題を回避 (Raúl Marín Rodríguezさん)</p><p>#4004, B木インデックス構築時のメモリ枯渇を回避 (Edmund Hornerさん)</p><p>#4016, Proj 5.0.0対応 (Raúl Marín Rodríguezさん)</p><p>#4017, lwgeomの字句解析器でメモリ破損 (Peter Eさん)</p><p>#4020, BOX3Dからジオメトリへのキャストで、正しくつながった多面体サーフェイスが返るようになりました (Matthias Bayさん)</p><p>#4025, #4032 時間的に「ほとんどオーバラップしている」範囲に対する不正な答 (Paul Ramseyさん, Darafei Praliaskouskiさん)</p><p>#4052, いくつかのジオグラフィ関数のスキーマ修飾 (Regina Obeさん)</p><p>#4055, ST_ClusterIntersectingの返り値からSRIDが落ちている (Daniel Bastonさん)</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89316096"></a>性能強化</h3></div></div></div><p>#3946, PostgreSQL 11へのコンパイルの対応 (Paul Ramseyさん)</p><p>#3992, pkg-config検出のためにpkg.m4のPKG_PROG_PKG_CONFIGマクロを使用するようにしました (Bas Couwenbergさん)</p><p>#4044, アップグレードのPostgreSQL 11 への対応 (Regina Obeさん)</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp89318016"></a>A.21. リリース 2.4.3</h2></div></div></div><p>リリース日: 2018/01/17</p><p>誤り訂正と性能改善のリリースです。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89319424"></a>誤り訂正と機能強化</h3></div></div></div><p>#3713, '\'文字を出力することがあるエンコーディングへの対応</p><p>#3827, コンフィギュアのデフォルトを、多くの人にとっては偽陰性の原因となる、テストの中断をしないように設定 (Regina Obeさん)、#3988での標準準拠のために改訂 (Greg Troxelさん)</p><p>#3930, 32ビットプラットフォームでの円の最小バウンディングの問題</p><p>#3965, ST_ClusterKMeansで初期化時にいくつかのクラスタが失われる (Darafei Praliaskouskiさん)</p><p>#3956, BRINのopclassオブジェクトのアップデートが確実でない (Sandro Santilliさん)</p><p>#3982, ST_AsEncodedPolylineがLINESTRING EMPTYとMULTIPOINT EMPTYに対応しました (Darafei Praliaskouskiさん)</p><p>#3975, ST_Transformがスキーマ修飾なしでspatial_ref_sysのクエリを実行する。レストア時に発生。 (Paul Ramseyさん)</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp89323008"></a>A.22. リリース 2.4.2</h2></div></div></div><p>リリース日: 2017/11/15</p><p>誤り訂正と性能改善のリリースです。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89328512"></a>誤り訂正と機能強化</h3></div></div></div><p>#3917, zcta5のロードを修正</p><p>#3667, ジオグラフィ版のST_Segmentizeの誤り修正</p><p>#3926, 2.2.6と2.3.4のアップグレード行程が失われていたのを追加 (Muhammad Usamaさん)</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp89330688"></a>A.23. リリース 2.4.1</h2></div></div></div><p>リリース日: 2017/10/18</p><p>誤り訂正と性能改善のリリースです。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89332096"></a>誤り訂正と機能強化</h3></div></div></div><p>#3864, B木演算子のメモリリークを修正</p><p>#3869, goldリンカを用いたビルドの修正</p><p>#3845, 小さなM値を素直に扱う問題</p><p>#3871, ジオメトリ比較関数の性能調整</p><p>#3879, 弧によっては0で割る</p><p>#3878, ヘッダのsignumの一文定義</p><p>#3880, TYPMOD_GET_SRIDに未定義の振る舞い</p><p>#3875, ビットシフト演算子の振る舞いが不定なのを修正</p><p>#3864,B木ジオメトリソートの性能改善</p><p>#3874, lw_dist2d_pt_arcに0で割る箇所</p><p>#3882, 入力が負数の時にzigzagの振る舞いが不定</p><p>#3891, pointarray_to_encoded_polylineに未定義の振る舞い</p><p>#3895, 不正なWKB入力についてエラーが投げられる</p><p>#3886, ジオメトリの細分でまれにボックスが無くなる問題を修正</p><p>#3907, 全ての可能性のあるGBOX文字列出力にとって十分なメモリの確保 (Raúl Marín Rodríguezさん)</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp89338880"></a>A.24. リリース 2.4.0</h2></div></div></div><p>リリース日: 2017/09/30</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89339904"></a>新機能</h3></div></div></div><p>#3822, postgis_full_version()が、スクリプトのビルドに使ったPostgreSQLの版の表示と確認を行うようになりました (Sandro Santilliさん)</p><p>#2411, ST_Reverseの曲線への対応 (Sandro Santilliさん)</p><p>#2951, ジオグラフィのST_Centroid (Danny Götteさん)</p><p>#3788, postgis_restore.plがディレクトリ形式 (-Fd)で動作するようになりました (Roger Crew)</p><p>#3772, 方向に依存しないST_CurveToLine出力 (Sandro Santilliさん / KKGeo)</p><p>#2464, MaxError許容値を持つST_CurveToLine (Sandro Santilliさん / KKGeo)</p><p>#3599, ST_AsGeobufを介したGeobuf出力対応 (Björn Harrtellさん)</p><p>#3661, ST_AsMVTを介したMapboxベクタタイル出力対応 (Björn Harrtellさん / CartoDB)</p><p>#3689, 方向のチェックと強制を行う関数の追加 (Dan Bastonさん)</p><p>#3753, 2次元とN次元のポイントのGiSTペナルティの速度改善 (Darafei Praliaskouskiさん, Andrey Borodinさん)</p><p>#3677, ST_FrechetDistance (Shinichi Sugiyamaさん)</p><p>ほとんどの集約関数 (ラスタとジオメトリ)、および全てのSTABLE / IMMUTABLEラベルの付いた (ラスタとジオメトリ)関数にパラレル安全のラベル付けが施されました</p><p>#2249, ラスタのST_MakeEmptyCoverage (David Zwarg, ainomieliさん)</p><p>#3709, ST_Projectで符号付き距離が可能になりました (Darafei Praliaskouskiさん)</p><p>#524, ジオグラフィのポリゴン上のポリゴン、ライン上のライン、ライン上のポイントに対するCoversの対応 (Danny Götte)</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89346560"></a>機能強化と訂正</h3></div></div></div><p>文書への多くの補正やいくつかの翻訳が完成しました。中核文書の多くの修正を行ったAndreas Schildさん。PostGIS日本語翻訳チームが最初の翻訳完成に達しました。</p><p>PostgreSQL 10対応</p><p>PostgreSQL 11への予備的な対応</p><p>#3645, シェープファイルのロードで論理的に削除されたレコードを避けるようにしました</p><p>#3747, Tigerジオコーダのnorm_addy複合型へのzip4とaddress_alphanumericの属性追加</p><p>#3748, 住所標準化のルックアップテーブルを更新してpagc_normalize_addressの略語を改善</p><p>#3647, GEOSNodeを使ってST_Nodeのノード化処理の改善 (Wouter Geraedtsさん)</p><p>#3684, EPSG第9版へのアップデート (Even Rouaultさん)</p><p>#3830, 住所標準化のinitialization from incompatible pointer typeの訂正 (9.6以上)</p><p>#3662, Make shp2pgsqlデバッグ情報を標準エラー出力に送ることでデバッグモードで動作するようにしました</p><p>#3405, lwgeom_to_pointsでのメモリリークの訂正</p><p>#3832, shp2pgsqlでint8のワイド整数に対応しました</p><p>#3841, 決定性ソートをジオグラフィのB木内で空ジオメトリに対応できるようにしました</p><p>#3844, Make =演算子を厳密な等価性テストにし、&lt; &gt;を荒い「空間ソート」にしました。</p><p>#3855, ST_AsTWKBのメモリと実行速度の改善</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89353472"></a>大幅な変更</h3></div></div></div><p>PostgreSQL 9.2への対応終了</p><p>#3810, GEOS 3.4.0以上をコンパイルに必要となりました</p><p>ほとんどの集約関数がパラレル安全のラベル付けが施されました。ほとんどの集約関数が削除と再作成されます。PostGIS集約関数を使っているビューがある場合には、アップグレード前に削除し、アップグレード後に再作成する必要があります。</p><p>#3578, ST_NumInteriorRings(POLYGON EMPTY)でNULLでなく0を返すようにしました</p><p>ST_DumpPointsをCで再実装したPostGIS 2.1.0以降不要となっていた_ST_DumpPointsを削除</p><p>B木インデックス演算子&lt; = &gt;を変更し、ソートでより良い空間局所性を提供しGROUP BYで期待される振る舞いとなるよう変更しました。ジオメトリまたはジオグラフィのB木インデックスが存在している場合には、REINDEXを実行して下さい。B木インデックスが偶然作られてGiSTインデックスに置き換える必要があるかを確認してください。オーダーの比較でボックスの左右で見る古いコードに依存する場合には、&lt;&lt; &gt;&gt;演算子を使うよう更新して下さい。</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp89356544"></a>A.25. リリース 2.3.3</h2></div></div></div><p>リリース日: 2017/07/01</p><p>誤り訂正と性能改善のリリースです。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89407104"></a>誤り訂正と機能強化</h3></div></div></div><p>#3777, GROUP BYが空ジオメトリを含むと不規則になる</p><p>#3711, 2.5次元のエッジをトポロジに追加すると方位エラーが発生する</p><p>#3726, dblatexからのPDFマニュアルでprogramlistingの引用部を良い感じに描画するようになりました (Mike Toewsさん)</p><p>#3738, ラスタ: raster2pgsqlで-Y無しで-sを使うとSRIDを設定するのではなく変換を行う</p><p>#3744, ST_Subdivideで逆方向のジオメトリの一部が無くなる (Darafei Praliaskouski Komzpaさん)</p><p>#3750, @と~演算子がスキーマ修飾を施したジオメトリ関数とラスタ関数が動かない場合がある。レストア問題が原因。 (Axiom Data ScienceのShane StClairさん)</p><p>#3682, pgsql2shpの結果で真偽値のフィールド内がおかしい</p><p>#3701, pgsql2shpの2重引用符問題から脱出</p><p>#3704, 空のジオメトリでST_AsX3Dが異常終了する</p><p>#3730, ST_Clipがバンドを計算できなかった時のエラーレベルをErrorからNoticeに変更</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp89411968"></a>A.26. リリース 2.3.2</h2></div></div></div><p>リリース日: 2017/01/31</p><p>誤り訂正と性能改善のリリースです。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89413376"></a>誤り訂正と機能強化</h3></div></div></div><p>#3418, PostgreSQL 9.5以上でのKNNの再確認が、誤った順序でタプルを返すインデックスのため、失敗する</p><p>#3675, 関係関数でインデックスが使われない場合がある</p><p>#3680, PostGIS更新スクリプトで、ビューにGRANTを実行していなかった</p><p>#3683, PostgreSQL 9.5未満から9.4より後へのpg_upgradeの後PostGISが更新できない</p><p>#3688, ST_AsLatLonText: 分の丸めがおかしい</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp89416192"></a>A.27. リリース 2.3.1</h2></div></div></div><p>リリース日: 2016/11/28</p><p>誤り訂正と性能改善のリリースです。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89417600"></a>誤り訂正と機能強化</h3></div></div></div><p>#1973, st_concavehull()が空ジオメトリコレクションを返すことがある gdeさんが訂正</p><p>#3501, ラスタへの最大範囲制約を追加する際に大きなテーブルでは配列サイズが範囲を超える</p><p>#3643, 最新のOSX XCodeでPostGISがビルドできない</p><p>#3644, 割り込みでデッドロックが発生する</p><p>#3650, ST_Extent, ST_3DExtentとST_Mem系の集約関数にパラレル安全のラベル付けを施し、パラレル化できるようになりました</p><p>#3652, Collection(MultiCurve())での異常終了</p><p>#3656, 2.2版以下からの集約関数の更新の訂正</p><p>#3659, CREATE EXTENSIONの後にGUCを定義すると間違ったメモリコンテキストを使い異常終了する (manaeemさん)</p><p>#3665, BRINインデックスでのインデックス崩壊とメモリリークに対するJulien Rouhaudさん (Dalibo)からのパッチ</p><p>#3667, ジオグラフィを引数に取るST_Segmentizeの誤りに対するHugo Mercierさん (Oslandia)からのパッチ</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp89422592"></a>A.28. リリース 2.3.0</h2></div></div></div><p>リリース日: 2016/09/26</p><p>新機能リリースです。新しい関数、効率改善、PostGIS 2.2.3からの関連する誤りの訂正、その他の素敵なことがあります。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89424000"></a>重大/大幅な変更</h3></div></div></div><p>#3466, box3dからジオメトリへのキャストが3次元ジオメトリを返すようになりました (Julien Rouhaud of Daliboさん)</p><p>#3396, ST_EstimatedExtentでエラーでなく警告が投げられる (Regina Obeさん)</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89425536"></a>新機能</h3></div></div></div><p>postgis_restore.plでユーザ定義のTOCへの対応を追加 (Christoph Moench-Tegederさん)</p><p>ST_PointNとST_SetPointについて負数のインデックスに対応 (Rémi Curaさん)</p><p>ジオグラフィを引数に取るST_Bufferへのパラメータ追加 (Thomas Bonfortさん)</p><p>TopoGeom_addElement, TopoGeom_remElement (Sandro Santilliさん)</p><p>populate_topology_layer (Sandro Santilliさん)</p><p>#454, ST_WrapXとlwgeom_wrapx (Sandro Santilliさん)</p><p>#1758, ST_Normalize (Sandro Santilliさん)</p><p>#2236, shp2pgsql -dについて"DROP TABLE IF EXISTS"を出すようにしました</p><p>#2259, ST_VoronoiPolygonsとST_VoronoiLines (Dan Bastonさん)</p><p>#2841と#2996, ST_MinimumBoundingRadiusと新規追加のST_MinimumBoundingCircleとをにヴェルツェルのアルゴリズムを使用して実装 (Dan Bastonさん)</p><p>#2991, ST_TransformについてPROJ.4文字列を使えるようにしました (Mike Toewsさん)</p><p>#3059, ST_Expandについて座標軸ごとのパラメータ受け渡しを可能にしました (Dan Bastonさん)</p><p>#3339, ST_GeneratePoints (Paul Ramseyさん)</p><p>#3362, ST_ClusterDBSCAN (Dan Bastonさん)</p><p>#3364, ST_GeometricMedian (Dan Bastonさん)</p><p>#3391, ST_EstimatedExtentで派生テーブルへの対応を追加 (Alessandro Pasottiさん)</p><p>#3424, ST_MinimumClearance (Dan Bastonさん)</p><p>#3428, ST_Points (Dan Bastonさん)</p><p>#3465, ST_ClusterKMeans (Paul Ramseyさん)</p><p>#3469, MULTIPOINTを引数に取るST_MakeLine (Paul Normanさん)</p><p>#3549, PostgreSQL 9.6のパラレルクエリモードにできる限り対応 (Paul Ramseyさん, Regina Obeさん)</p><p>#3557, ジオメトリ関数に対してクエリ統計情報に基づくコストを設定 (Paul Norman)</p><p>#3591, BRINインデックスへの対応を追加。PostgreSQL 9.4以上が必要です。 (2nd QuadrantのGiuseppe Broccoloさん, Julien RouhaudさんとDiagloのRonan Dunklauさん)</p><p>#3496, エクステンションによってインストールされたPostGISを再配置できないようにし、関数内ではスキーマ修飾の呼び出しを行うようにしました (Regina Obeさん) これはエクステンションでの#3494, #3486, #3076を最終的に解決するものでした</p><p>#3547, Tigerジオコーダを更新し、TIGER 2016に対応するようになり、httpとftpの両方に対応するようになりました。</p><p>#3613, 等しい長さの線分を使う分割 (OslandiaのHugo Mercierさん)</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89436416"></a>誤り訂正</h3></div></div></div><p>PostGIS 2.2.3からの全ての関連した誤りの訂正</p><p>#2841, ST_MinimumBoundingCircleが元の地物を覆い切らない</p><p>#3604, pgcommon/Makefile.inによるCFLAGS指定が不正で、liblwgeom.hが誤ったものになる (Greg Troxel)</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89438464"></a>性能強化</h3></div></div></div><p>#75, PIP簡略版の強化 (Dan Bastonさん)</p><p>#3383, インデックス演算中に小さいジオメトリをデシリアライズするのを避けるようにしました (Dan Bastonさん)</p><p>#3400, PIPルーティンの若干の最適化 (Dan Bastonさん)</p><p>トポロジへのラインの追加を割り込み可能にしました (Sandro Santilliさん)</p><p>Mike Toewsさんからの文書更新</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp89441280"></a>A.29. リリース 2.2.2</h2></div></div></div><p>リリース日: 2016/03/22</p><p>誤り訂正と性能改善のリリースです。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89442688"></a>新機能</h3></div></div></div><p>#3463, フェイス崩壊によるエッジの変更で異常終了するのを訂正</p><p>#3422, 標準の倍精度システム (arm64, ppc64el, s390c, powerpc, ...)におけるST_Splitのロバスト性の改善</p><p>#3427, spatial_ref_sysをEPSG 8.8版に更新</p><p>#3433, マルチポイントを引数に取るST_ClusterIntersectingが正しくない</p><p>#3435, ST_AsX3Dで凹ジオメトリのレンダリングの訂正</p><p>#3436, ptarray_clone_deepでメモリの扱いに間違いがある</p><p>#3437, マルチポイントを引数に取るST_Intersectsが正しくない</p><p>#3461, ST_GeomFromKMLでinnerBoundaryIsがあり、かつouterBoundaryIsが無い場合にPostGISが異常終了する</p><p>#3429, いくつかのプラットフォームで2.1から2.3へのアップデートの際に無限ループやハングが発生する</p><p>#3460, アップグレード後にST_ClusterWithinで'Tolerance not defined'エラーが発生する</p><p>#3490, ラスタデータとマテリアライズドビューのリストア問題。postgis_proc_set_search_path.sqlとrtpostgis_proc_set_search_path.sqlのスクリプトを使います。http://postgis.net/docs/manual-2.2/RT_FAQ.html#faq_raster_data_not_restoreを参照してください。</p><p>#3426, POINT EMPTYのテストが愉快なアーキテクチャでは失敗する</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp89460480"></a>A.30. リリース 2.2.1</h2></div></div></div><p>リリース日: 2016/01/06</p><p>誤り訂正と性能改善のリリースです。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89461888"></a>新機能</h3></div></div></div><p># 2232, SVGの丸め誤差蓄積の回避</p><p>#3321, トポロジのロードにおけるパフォーマンス不具合の訂正</p><p>#3329, TopoGeo_addPointにおけるロバスト性の不具合の訂正</p><p>#3349, postgis_topologyスクリプトのインストールパスの訂正</p><p>#3351, ST_RemoveIsoEdge (とlwt_RemIsoEdge)で終端ノードが孤立するようにしました</p><p>#3355, ジオグラフィ型を引数に取るST_Segmentizeがジオメトリボックスを持つ </p><p>#3359, toTopoGeomでTopoGeometry定義から低いIDのプリミティブの欠損を訂正</p><p>#3360, _raster_constraint_info_scaleへの不正な入力書式</p><p>#3375, コレクション (ポイント)に対する繰り返したポイント除去で異常終了する</p><p>#3378, 複数トポロジが存在する階層的なTopoGeometryの処理の訂正</p><p>#3380, #3402, トポロジのロードでラインが時々削除される</p><p>#3388, #3410, ST_Removepointsで終点がなくなるのを訂正</p><p>#3389, lwgeom_to_geojsonでのバッファオーバフロー</p><p>#3390, Alpine Linux 3.2でのビルドで、postgisとpostgis_topologyエクステンションのコンパイル時にエラーが発生する</p><p>#3393, ST_AreaがNaNを返すポリゴンがある</p><p>#3401, 32ビットシステムでのST_Splitの堅牢性の改善</p><p>#3404, ST_ClusterWithinでバックエンドが異常終了する</p><p>#3407, 複数のTopoGeometryオブジェクトを定義するフェイスまたはエッジを分割する時に異常終了するのを訂正</p><p>#3411, クラスタリング関数が空間インデックスを使っていない</p><p>#3412, TopoGeo_addLinestringでスナップ段階の堅牢性の改善</p><p>#3415, OSX 10.9でpkgsrcを使ったビルドの訂正</p><p>lwt_ChangeEdgeGeom [liblwgeom]のメモリリークの訂正</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp89471616"></a>A.31. リリース 2.2.0</h2></div></div></div><p>リリース日: 2015/10/07</p><p>新機能リリースです。新しい関数、効率改善、その他の素敵なことがあります。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89473024"></a>新機能</h3></div></div></div><p>トポロジAPIがliblwgeom内になりました (Sandro Santilliさん / Regione Toscanaさん - SITA)</p><p>liblwgeomの新しいlwgeom_unaryunion</p><p>liblwgeomの新しいlwgeom_linemerge</p><p>liblwgeomの新しいlwgeom_is_simple</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/3169" target="_top">#3169</a>, SFCGAL 1.1に対応: ST_3DDifference, ST_3DUnion, ST_Volume, ST_MakeSolid, ST_IsSolid追加 (Vincent Moraさん / Oslandia)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/3169" target="_top">#3169</a>, ST_ApproximateMedialAxis (Sandro Santilliさん)</p><p>ST_CPAWithin (Sandro Santilliさん / Boundless)</p><p>CPAの意味を持つ|=|演算子の追加とPostgreSQL 9.5以上のKNN対応 (Sandro Santilliさん / Boundless)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/3131" target="_top">#3131</a>, ジオグラフィ型のKNN対応 (Paul Ramseyさん / CartoDB)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/3023" target="_top">#3023</a>, ST_ClusterIntersecting / ST_ClusterWithin (Dan Bastonさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2703" target="_top">#2703</a>, 全てのジオメトリタイプで確かなKNNの結果が出るようにしました、別名「KNN再確認」 (Paul Ramseyさん / CartoDB)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1137" target="_top">#1137</a>, ST_RemoveRepeatedPointsに許容誤差値を与えることが可能になりました (Paul Ramseyさん / CartoDB)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/3062" target="_top">#3062</a>, Allow passing M factor to ST_ScaleにM値に対する乗数を渡せるようになりました (Sandro Santilliさん / Boundless)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/3139" target="_top">#3139</a>, ST_BoundingDiagonal (Sandro Santilliさん / Boundless)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/3129" target="_top">#3129</a>, ST_IsValidTrajectory (Sandro Santilliさん / Boundless)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/3128" target="_top">#3128</a>, ST_ClosestPointOfApproach (Sandro Santilliさん / Boundless)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/3152" target="_top">#3152</a>, ST_DistanceCPA (Sandro Santilliさん / Boundless)</p><p>インデックスキーの型の正準な出力</p><p>ST_SwapOrdinates (Sandro Santilliさん / Boundless)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2918" target="_top">#2918</a>, 測地線についてGeographicLib関数を使うようにしました (Mike Toewsさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/3074" target="_top">#3074</a>, 大きなジオメトリを分解するST_Subdivide (Paul Ramseyさん / CartoDB)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/3040" target="_top">#3040</a>, 重心に基づくKNN GiSTインデックス  (&lt;&lt;-&gt;&gt;) n次元距離演算子 (Sandro Santilliさん / Boundless)</p><p>liblwgeomの相互運用性API (Sandro Santilliさん / CartoDB)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2939" target="_top">#2939</a>, ST_ClipByBox2D (Sandro Santilliさん / CartoDB)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2247" target="_top">#2247</a>, ST_Retile, ST_CreateOverview: データベース内ラスタのオーバビューの生成 (Sandro Santilliさん / Vizzuality)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/899" target="_top">#899</a>, shp2pgsqlの属性名マッピングを行う-mスイッチ (Regina Obeさん / Sandro Santilliさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1678" target="_top">#1678</a>, GDALコンフィギュレーション変数GDAL_DATAを指定するGUC postgis.gdal_datapathを追加</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2843" target="_top">#2843</a>, ラスタ入力での投影変換に対応 (Sandro Santilliさん / Vizzuality)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2349" target="_top">#2349</a>, Support for encoded_polyline入出力の対応 (Kashif Rasulさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2159" target="_top">#2159</a>, postgis_full_version()からのlibjsonの版の報告</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2770" target="_top">#2770</a>, ST_MemSize(raster)</p><p>postgis_noop(raster)追加</p><p>ST_TPI(), ST_TRI(), ST_Roughness()の存在しない形式を追加</p><p>GDALコンフィギュレーション変数GDAL_SKIPを指定するGUC postgis.gdal_enabled_driversの追加</p><p>データベース外バンドへのアクセスを有効にするGUC postgis.enable_outdb_rastersを追加</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2387" target="_top">#2387</a>, PostGISの一部としてのaddress_standardizerエクステンション (Stephen Woodbridgeさん / imaptools.com, Walter Sinclairさん, Regina Obeさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2816" target="_top">#2816</a>, address_standardizerの参考となるlexテーブル, gazテーブル, 規則テーブルを提供するaddress_standardizer_data_usエクステンション (Stephen Woodbridgeさん / imaptools.com, Walter Sinclairさん, Regina Obeさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2341" target="_top">#2341</a>, ST_MapAlgebraの新しいマスクパラメータ</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2397" target="_top">#2397</a>, シェープファイルローダのエンコーディングの自動読み取り</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2430" target="_top">#2430</a>, ST_ForceCurve</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2565" target="_top">#2565</a>, ST_SummaryStatsAgg()</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2567" target="_top">#2567</a>, ST_CountAgg()</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2632" target="_top">#2632</a>, ST_AsGML()が曲線地物に対応するようになりました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2652" target="_top">#2652</a>, run_test.plに--upgrade-pathスイッチを追加</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2754" target="_top">#2754</a>, エクステンションとしてのSFCGALラッパー</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2227" target="_top">#2227</a>, Visvalingam-Whyattアルゴリズムによる簡略化ST_SimplifyVW, ST_SetEffectiveArea (Nicklas Avénさん)</p><p>TWKBエンコード関数とデコード関数 ST_AsTWKB, ST_GeomFromTWKB (Paul Ramseyさん / Nicklas Avénさん / CartoDB)</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89513600"></a>性能強化</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/3223" target="_top">#3223</a>, ST_Equalsへの簡略版memcmpの追加 (Daniel Bastonさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/3227" target="_top">#3227</a>, Tiger 2015センサス対応のためのTigerジオコーダのアップグレード</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2278" target="_top">#2278</a>, マイナーリリース間のliblwgeomの互換性確保</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/897" target="_top">#897</a>, ST_AsX3DがGeoCodinates要素に対応し、"GD" "WE"とx/y軸反転とに対応しました (optionsに2, 3を使用)</p><p>ST_Split: マルチライン、マルチポイント、(マルチ)ポリゴンの境界によるライン分割を可能にしました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/3070" target="_top">#3070</a>, ジオメトリタイプ制約の簡略化</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2839" target="_top">#2839</a>, 関数インデックスへの選択度見積りの実装、ラスタテーブルでの空間クエリの速度向上。 (Sandro Santilliさん / Vizzuality)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2361" target="_top">#2361</a>, raster_columnsビューへのspatial_indexカラムの追加</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2390" target="_top">#2390</a>, pgsql2shpのテストスイート</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2527" target="_top">#2527</a>, raster2pgsqlへの、バンドのNODATAの有無のチェックを行わない-kフラグの追加</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2616" target="_top">#2616</a>, トポロジの構築とエクスポートでのテキストへのキャストを低減</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2717" target="_top">#2717</a>, 複合曲線がstartpoint, endpoint, pointn, numpointsに対応しました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2747" target="_top">#2747</a>, GDAL 2.0対応への追加</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2754" target="_top">#2754</a>, SFCGALがCREATE EXTENSIONでインストールできるようになりました (Vincent Moraさん @ Oslandia)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2828" target="_top">#2828</a>, ST_Envelope(raster)をSQLからCに変更</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2829" target="_top">#2829</a>, ジオメトリが完全にラスタを含みかつNODATAが指定されていない場合のST_Clip(raster)の短縮動作</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2906" target="_top">#2906</a>, TigerジオコーダのTiger 2014データ処理のための更新</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/3048" target="_top">#3048</a>, ジオメトリ簡略化の速度向上 (J.Santanaさん @ CartoDB)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/3092" target="_top">#3092</a>, 多数のテーブルがある場合にgeometry_columnsが遅い</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp89550080"></a>A.32. リリース 2.1.8</h2></div></div></div><p>リリース日: 2015/07/07</p><p>重大な誤り訂正のリリースです。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89551488"></a>誤り訂正</h3></div></div></div><p>#3159, ST_Affineでbboxキャッシュを強制しないようにしました</p><p>#3018, ジオグラフィに対するGROUP BYで時々重複行が返される</p><p>#3048, shp2pgsql - 特定のシステムロケールセットで数字の書式が不正になる</p><p>#3094, 不正な形式のGeoJSON入力でバックエンドが異常終了する</p><p>#3104, st_asgmlででたらめな文字をIDフィールドに入ってしまう</p><p>#3155, make uninstallでliblwgeom.hを消すようにしました</p><p>#3177, ネストされた空を引数に取る場合にgserialized_is_emptyが処理できない</p><p>ST_LineLocatePointの異常終了の訂正</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp89555456"></a>A.33. リリース 2.1.7</h2></div></div></div><p>リリース日: 2015/03/30</p><p>重大な誤り訂正のリリースです。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89556864"></a>誤り訂正</h3></div></div></div><p>#3086, ST_DumpValues()に不正なバンド番号を渡すとバックエンドが異常終了する</p><p>#3088, liblwgeom.hでstrcasestrを(再)定義しないようにしました</p><p>#3094, 不正な形式のGeoJSON入力でバックエンドが異常終了する</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp89571200"></a>A.34. リリース 2.1.6</h2></div></div></div><p>リリース日: 2015/03/20</p><p>誤り訂正と性能改善のリリースです。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89572608"></a>性能強化</h3></div></div></div><p>#3000, エッジ分割修復で確実にインデックスを使うようにしました</p><p>#3048, ジオメトリ簡略化の速度向上 (J.Santanaさん @ CartoDB)</p><p>#3050, ジオメトリ型の読み取りの高速化 (J.Santana @ CartoDB)</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89574528"></a>誤り訂正</h3></div></div></div><p>#2941, ジオグラフィカラムに4326以外のSRIDが入るようになりました</p><p>#3069, 小さいオブジェクトがボックスを伴うことで不適切に膨らむ</p><p>#3068, 制約されていない次元でpostgis_typmod_dimsがNULLを返すようにしました</p><p>#3061, JSON, GML, GML ST_GeomFrom*関数で重複ポイントが可能になりました</p><p>#3058, N次元GiSTのpicksplitメソッドを最適な平面で分割するよう訂正</p><p>#3052, PostgreSQL 9.1より後で有効な&lt;-&gt;, &lt;#&gt;演算子を作成</p><p>#3045, &amp;&amp;&amp;演算子での次元の混乱を訂正</p><p>#3016, 壊れたトポロジのレイヤの削除が可能になりました</p><p>#3015, TopologySummaryで例外を避けるようにしました</p><p>#3020, データベース外のST_AddBandで高さの値であるべきところを幅の値にする誤り</p><p>#3031, 空のジオメトリ (ポイント)テーブルをダンプしたものをレストアできるようになりました</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp89579776"></a>A.35. リリース 2.1.5</h2></div></div></div><p>リリース日: 2014/12/18</p><p>誤り訂正と性能改善のリリースです。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89581184"></a>性能強化</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2933" target="_top">#2933</a>, 巨大なマルチジオメトリオブジェクトの構築の速度向上</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89582976"></a>誤り訂正</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2947" target="_top">#2947</a>, lwgeom_make_validが1要素のコレクションを入力に取る場合に発生するメモリリークを訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2949" target="_top">#2949</a>, lwgeom_mindistance2dが曲線を入力に取る場合に発生するメモリリークを訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2931" target="_top">#2931</a>, BOX表現が大文字小文字の区別をする</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2942" target="_top">#2942</a>, PostgreSQL 9.5対応</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2953" target="_top">#2953</a>, Z値/M値が極端な時に2次元の統計情報が生成されない</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/3009" target="_top">#3009</a>, ジオグラフィにキャストすると基になるタプルに影響を与えることがある</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp89590016"></a>A.36. リリース 2.1.4</h2></div></div></div><p>リリース日: 2014/09/10</p><p>誤り訂正と性能改善のリリースです。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89591424"></a>性能強化</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2745" target="_top">#2745</a>, ポイントに対するST_Simplifyの速度向上</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2747" target="_top">#2747</a>, GDAL 2.0に対応</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2749" target="_top">#2749</a>, rtpostgis_upgrade_20_21.sqlをACIDになるようにしました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2811" target="_top">#2811</a>, シェープファイル/ラスタをロードする時にインデックス名を指定しないようにしました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2829" target="_top">#2829</a>, ジオメトリが完全にラスタを含みかつNODATAが指定されていない場合のST_Clip(raster)の短縮動作</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2895" target="_top">#2895</a>, クエリプランを良くするためにST_ConvexHull(raster)のコストを300に増加</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89610624"></a>誤り訂正</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2605" target="_top">#2605</a>, armel: _ST_Covers()が穴の中のポイントでTRUEを返す</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2911" target="_top">#2911</a>, スケールが1/-1でオフセットが0/0のラスタのST_Rescale/ST_Resample/ST_Resizeの出力を訂正。</p><p>ST_Union(raster)が異常終了するのを訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2704" target="_top">#2704</a>, gml:pos配列でST_GeomFromGML()が正しく動作しない (Even Roualtさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2708" target="_top">#2708</a>, スキーマを指定していないとupdategeometrysridがsridのチェックを更新しない。Marc Jansenさんからのパッチ</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2720" target="_top">#2720</a>, lwpoly_add_ringはreallocの後に最大環数を更新するべき</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2759" target="_top">#2759</a>, 複数行のSQLコメントを埋め込んだオブジェクトコメントの処理でpostgis_restore.plを訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2774" target="_top">#2774</a>, ptarray_calculate_gbox_geodeticで未定義の振る舞いを訂正</p><p>ST_MakeValidの潜在的なメモリフォールトの訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2784" target="_top">#2784</a>, --with-sfcgalへの偽の引数の処理の訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2772" target="_top">#2772</a>, RASTER_getBandPath (ST_BandPath)内の早すぎるメモリ解放</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2755" target="_top">#2755</a>, SFCGALの全ての版に対する回帰テストを訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2775" target="_top">#2775</a>, lwline_from_lwmpointでメモリリークが発生する</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2802" target="_top">#2802</a>, ST_MapAlgebraが正当なコールバック関数の返り値か確認するようにしました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2803" target="_top">#2803</a>, ST_MapAlgebraがuserargを使わないSTRICTのコールバック関数を処理するようになりました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2834" target="_top">#2834</a>, ST_Estimated_Extentと大文字小文字の混じったテーブル名 (回帰テストでの問題)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2845" target="_top">#2845</a>, ST_AddPointから悪いジオメトリが発生する</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2870" target="_top">#2870</a>, ジオグラフィカラムへのバイナリ挿入なのにジオメトリが挿入される</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2872" target="_top">#2872</a>, make install による文書構築(Greg Troxellさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2819" target="_top">#2819</a>, Centos5 / Solariでisfiniteを見つけるか置き換えるようにしました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2899" target="_top">#2899</a>, geocodeでlimit 1を指定した時に最善の答えが返らない (Tigerジオコーダ)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2903" target="_top">#2903</a>, FreeBSDでコンパイルできない</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2927" target="_top">#2927</a> reverse_geocode (Tigerジオコーダ)が方角プレフィクスを埋めないし、ST_Line_Locate_Pointが呼ばれる</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp89634304"></a>A.37. リリース 2.1.3</h2></div></div></div><p>リリース日: 2014/05/13</p><p>誤り訂正とセキュリティ対策のリリースです。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89635712"></a>重要な変更</h3></div></div></div><p>この版から、オフラインでのラスタへのアクセスとGDALドライバの利用はデフォルトでは無効になりました。 </p><p>環境変数POSTGIS_GDAL_ENABLED_DRIVERSで特定のGDALドライバを有効にできます。デフォルトでは全てのGDALドライバは無効になっています。 </p><p>環境変数POSTGIS_ENABLE_OUTDB_RASTERSでデータベース外ラスタバンドを有効にできます。デフォルトでは、データベース外ラスタバンドは無効です。 </p><p>これらの環境変数はPostgreSQLプロセスに設定しなければなりません。また、クラスタ全体の振る舞いを決定するものです。 </p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89638016"></a>誤り訂正</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2697" target="_top">#2697</a>, 不正なGeoJSONポリゴン入力でサーバプロセスが異常終了する</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2700" target="_top">#2700</a>, NULL行を持つ高次元データセットのダンプの訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2706" target="_top">#2706</a>, ST_DumpPointsに空ジオメトリを与えるとサーバが異常終了する</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp89641216"></a>A.38. リリース 2.1.2</h2></div></div></div><p>リリース日: 2014/03/31</p><p>この版は誤り訂正版です。2.1.1版以降に送られた問題の処理が行われました。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89642624"></a>誤り訂正</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2666" target="_top">#2666</a>, コンフィギュア時にSQLプリプロセッサが発見できないとエラーになる</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2534" target="_top">#2534</a>, st_distanceが大きなジオグラフィでは正しくない結果を返す</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2539" target="_top">#2539</a>, json-c/json.hが存在し、以前のjson/json.hのように使用可能であるかの確認</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2543" target="_top">#2543</a>, 単純なクエリからの不正なJOIN選択度エラー</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2546" target="_top">#2546</a>, 文字列座標値を持つGeoJSONのパースが不正 </p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2547" target="_top">#2547</a>, 階層的なTopoGeometryに対するST_Simplify(TopoGeometry)の訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2552" target="_top">#2552</a>, ST_AsPNG, ST_AsTIFF, ST_AsJPEGのNULLラスタ処理の訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2555" target="_top">#2555</a>, ST_Reclassのrange引数のパースの問題の訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2556" target="_top">#2556</a>, ジオグラフィのST_Intersectsの結果が行挿入順序によって異なる</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2580" target="_top">#2580</a>, 同じデータベースに2回PostGISをインストールさせないようにしました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2589" target="_top">#2589</a>, 必須でないvoidポインタの使用の削除</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2607" target="_top">#2607</a>, 1プロセスで1024以上のデータベース外ファイルを開くことができない</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2610" target="_top">#2610</a>, フェイス分割アルゴリズムでエッジインデックスの使用を確実にしました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2615" target="_top">#2615</a>, EstimatedExtent (その下にある統計情報に由来)がおかしいbboxを集める</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2619" target="_top">#2619</a>, GeoJSONで環の配列が空の場合に異常終了する</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2634" target="_top">#2634</a>, 球面距離のコードの回帰テスト</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2638" target="_top">#2638</a>, M値を持つジオグラフィの距離が時々おかしい</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2648" target="_top">#2648</a>, <a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2653" target="_top">#2653</a>, ”topology”がsearch_pathに無い時のトポロジ関数の訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2654" target="_top">#2654</a>, トポロジでの非推奨呼び出しの削除</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2655" target="_top">#2655</a>, トポロジの権限を持たないユーザがpostgis_full_version()を呼ぶ時の問題</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2674" target="_top">#2674</a>, 欠損した=演算子と演算子クラスhash_raster_opsの訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2675" target="_top">#2675</a>, <a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2534" target="_top">#2534</a>, <a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2636" target="_top">#2636</a>, <a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2634" target="_top">#2634</a>, <a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2638" target="_top">#2638</a>, 木構造の最適化でのジオグラフィの距離の問題</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89680000"></a>性能強化</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2494" target="_top">#2494</a>, GiSTインデックスでmemcopyを避けるようにしました (hayamizさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2560" target="_top">#2560</a>, ソフトアップグレード: 変更されていない集約関数の削除/置換を避けるようにしました</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp89682432"></a>A.39. リリース 2.1.1</h2></div></div></div><p>リリース日: 2013/11/06</p><p>この版は誤り訂正版です。2.1.0版以降に送られた問題の処理が行われました。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89683840"></a>重要な変更</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2514" target="_top">#2514</a>, ラスタライセンスをGPL v3以上からv2以上に変更し、PostGISエクステンションをGPL v2で配布できるようにしました。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89685376"></a>誤り訂正</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2396" target="_top">#2396</a>, 回帰テストをよりエンディアン不明なテストにしました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2434" target="_top">#2434</a>, 珍しい状況でのST_Intersection(geog,geog)の回帰テストの訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2454" target="_top">#2454</a>, exclude_nodata_valueパラメータに沿うST_PixelAsXXX関数の振る舞いの訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2489" target="_top">#2489</a>, 2.0からのアップグレードで古い関数のシグネチャが残されているのを訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2525" target="_top">#2525</a>, 入れ子のコレクションのSRIDの処理の訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2449" target="_top">#2449</a>, インデックス構築の潜在的な永久ループの訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2493" target="_top">#2493</a>, 空ラスタを渡した時のST_DumpValuesの挙動の訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2502" target="_top">#2502</a>, postgis_topology_scripts_installed()のインストールスキーマの訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2504" target="_top">#2504</a>, pgsql2shpの正しくない呼び出しでセグメンテーション違反が発生するのを訂正 </p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2512" target="_top">#2512</a>, raster_columnsとraster_overviewsの外部テーブルと体現ビューへの対応</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89694080"></a>性能強化</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2478" target="_top">#2478</a>, Tiger 2013への対応</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2463" target="_top">#2463</a>, 弧ジオメトリの精密な距離計算への対応</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp89696640"></a>A.40. リリース 2.1.0</h2></div></div></div><p>リリース日: 2013/08/17</p><p>マイナーリリースです。2.0.3以降に送られた誤り訂正、性能向上、機能向上を行いました。2.0以上からアップグレードする場合には、ソフトアップグレードだけが必要です。1.5以前からアップグレードする場合には、ハードアップグレードが必要です。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89698048"></a>重大/大幅な変更</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1653" target="_top">#1653</a>, ST_Resample(raster)からSRIDパラメータを削除し、参照ラスタを使う形式でラスタのSRIDの参照を適用しなくしました。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1962" target="_top">#1962</a> ST_Segmentize - ジオグラフィ対応の紹介での結果として、<code class="code">SELECT ST_Segmentize('LINESTRING(1 2, 3 4)',0.5);</code>で関数の曖昧エラーが出る</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2026" target="_top">#2026</a>, ST_Union(raster)が全てのラスタの全てのバンドを結合するようになりました。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2089" target="_top">#2089</a>, liblwgeom: lwgeom_set_handlersがlwgeom_init_allocatorsに取って代わりました。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2150" target="_top">#2150</a>, regular_blockingは制約ではなくなりました。raster_columns内の同名のカラムは、patially_unique制約とcoverage_tile制約の存在を確認しています。</p><p>ST_Intersects(raster, geometry)をST_Intersects(geometry, raster)と同じに振る舞うようにしました。</p><p>ポイント形式のST_SetValue(raster)が入力ポリゴンとラスタのSRIDを確認していなかった。</p><p>ST_Hillshadeのazimuthとaltitudeパラメータをラジアンから度に変更。</p><p>ST_SlopeとST_Aspectが返すピクセル値をラジアンから度に変更。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2104" target="_top">#2104</a>, ST_World2RasterCoord, ST_World2RasterCoordX, ST_World2RasterCoordYをST_WorldToRasterCoord, ST_WorldToRasterCoordX, ST_WorldToRasterCoordYにそれぞれ関数名変更。ST_Raster2WorldCoord, ST_Raster2WorldCoordX, ST_Raster2WorldCoordYをST_RasterToWorldCoord, ST_RasterToWorldCoordX, ST_RasterToWorldCoordYにそれぞれ関数名変更。</p><p>ST_Estimated_ExtentをST_EstimatedExtentに関数名変更</p><p>ST_Line_Interpolate_PointをST_LineInterpolatePointに関数名変更</p><p>ST_Line_SubstringをST_LineSubstringに関数名変更</p><p>ST_Line_Locate_PointをST_LineLocatePointに関数名変更</p><p>ST_Force_XXX をST_ForceXXXに関数名変更</p><p>ST_MapAlgebraFctNgbとST_MapAlgebraFctの1ラスタ形式と2ラスタ形式。代わりにST_MapAlgebraを使います。</p><p>ST_MapAlgebraExprの1ラスタ形式と2ラスタ形式。代わりに数式形式のST_MapAlgebraを使います。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89708416"></a>新機能</h3></div></div></div><p>- 新しい関数の完全なリストは http://postgis.net/docs/manual-2.1/PostGIS_Special_Functions_Index.html#NewFunctions_2_1 を参照</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/310" target="_top">#310</a>, ST_DumpPointsのC言語関数への変換 (Nathan Wagnerさん)と速度向上</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/739" target="_top">#739</a>, UpdateRasterSRID()</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/945" target="_top">#945</a>, JOIN選択度、N次元選択度計算、ユーザがアクセス可能な選択度およびテスト用統計情報取得関数の改善 (Paul Ramseyさん / OpenGeo)</p><p>toTopoGeom with TopoGeometry sink (Sandro Santilliさん / Vizzuality)</p><p>clearTopoGeom (Sandro Santilliさん / Vizzuality)</p><p>ST_Segmentize(geography) (Paul Ramseyさん / OpenGeo)</p><p>ST_DelaunayTriangles (Sandro Santilliさん / Vizzuality)</p><p>ST_NearestValue, ST_Neighborhood (Bborie Parkさん / UC Davis)</p><p>ST_PixelAsPoint, ST_PixelAsPoints (Bborie Parkさん / UC Davis)</p><p>ST_PixelAsCentroid, ST_PixelAsCentroids (Bborie Parkさん / UC Davis)</p><p>ST_Raster2WorldCoord, ST_World2RasterCoord (Bborie Parkさん / UC Davis)</p><p>ラスタ/ラスタ空間関係関数 (ST_Contains, ST_ContainsProperly, ST_Covers, ST_CoveredBy, ST_Disjoint, ST_Overlaps, ST_Touches, ST_Within, ST_DWithin, ST_DFullyWithin)の追加 (Bborie Parkさん / UC Davis)</p><p>ST_SetValues()でのバンド内の多数のピクセル値を入れる形式の追加 (Bborie Parkさん / UC Davis)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1293" target="_top">#1293</a>, 幅/高さに基づくラスタのサイズ再設定を行うST_Resize(raster)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1627" target="_top">#1627</a>, PostgreSQLエクステンションとしてのtiger_geocoderパッケージ</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1643" target="_top">#1643</a>, <a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2076" target="_top">#2076</a>, Tiger 2011と2012のロードに対応したTigerジオコーダのアップグレード (Regina Obeさん / Paragon Corporation) Funded by Hunter Systems Groupの資金提供</p><p>ST_MakeValidがジオメトリコレクションに対応しました (Sandro Santilliさん / Vizzuality)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1709" target="_top">#1709</a>, ST_NotSameAlignmentReason(raster, raster)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1818" target="_top">#1818</a>, ST_GeomFromGeoHashと仲間 (Jason Smithさん (darkpanda))</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1856" target="_top">#1856</a>, Tigerジオコーダ: 逆ジオコーディングの評価で道路番号が好ましい場合に設定できるようになりました</p><p>ST_PixelOfValue (Bborie Parkさん / UC Davis)</p><p>PostgreSQLの幾何データ型 (point/path/polygon)との相互キャスト</p><p>1つのバンドにジオメトリ集合と該当値を使って1回の呼び出しで多数のピクセル値を入れるためにST_SetValues()にgeomval配列の形式を追加 (Bborie Parkさん / UC Davis)</p><p>ラスタをタイルに分解するST_Tile(raster) (Bborie Parkさん / UC Davis)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1895" target="_top">#1895</a>, 新しいR木のノード分割アルゴリズム (Alex Korotkovさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2011" target="_top">#2011</a>, ラスタを配列で出力するST_DumpValues (Bborie Parkさん / UC Davis)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2018" target="_top">#2018</a>, ST_DistanceがCircularString, CurvePolygon, MultiCurve, MultiSurface, CompoundCurveに対応しました </p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2030" target="_top">#2030</a>, 任意数のラスタ (と任意数のバンド)のST_MapAlgebra (Bborie Parkさん / UC Davis)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2193" target="_top">#2193</a>, PAGCパーサをTiger住所正規化の置き換えとして使用可能にしました (Steve Woodbridgeさん, Regina Obeさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2210" target="_top">#2210</a>, ST_MinConvexHull(raster)</p><p>liblwgeom内のlwgeom_from_geojson (Sandro Santilliさん / Vizzuality)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1687" target="_top">#1687</a>, TopoGeometryのためのST_Simplify (Sandro Santilliさん / Vizzuality)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2228" target="_top">#2228</a>, TopoGeometryのためのTopoJSON出力 (Sandro Santilliさん / Vizzuality)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2123" target="_top">#2123</a>, ST_FromGDALRaster</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/613" target="_top">#613</a>, 文字列パラメータの代わりに数値パラメータを与えるST_SetGeoReference</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2276" target="_top">#2276</a>, データベース外バンド用のST_AddBand(raster)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2280" target="_top">#2280</a>, ST_Summary(raster)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2163" target="_top">#2163</a>, ラスタ用のST_TPI (Nathaniel Clayさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2164" target="_top">#2164</a>, ラスタ用のST_TRI (Nathaniel Clayさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2302" target="_top">#2302</a>, ラスタ用のST_Roughness (Nathaniel Clayさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2290" target="_top">#2290</a>, RGBAバンドを生成するST_ColorMap(raster)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2254" target="_top">#2254</a>, SFCGALバックエンドへの対応。 (バックエンド選択はpostgis.backend変数で行います) GEOSとSFCGALの両方で有効な関数はST_Intersects, ST_3DIntersects, ST_Intersection, ST_Area, ST_Distance, ST_3DDistanceです。SFCGALのみ有効な関数はST_3DIntersection, ST_Tesselate, ST_3DArea, ST_Extrude, ST_ForceLHR ST_Orientation, ST_Minkowski, ST_StraightSkeleton postgis_sfcgal_versionです。PostGISへの新規追加関数はST_ForceSFS (Olivier CourtinさんとHugo Mercier / Oslandia)です</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89765376"></a>性能強化</h3></div></div></div><p>新関数と関数改善の詳細については、<a class="xref" href="#NewFunctions_2_1" title="15.12.9. PostGIS 2.1で新規作成/機能強化された関数">「PostGIS 2.1で新規作成/機能強化された関数」</a>を参照して下さい。</p><p>ラスタ版ST_UnionとST_Clipの高速化と多くの関数の追加操作</p><p>ジオメトリ/ジオグラフィでのプランナの選択度の向上と多数の関数</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/823" target="_top">#823</a>, Tigerジオコーダ: loader_generate_scriptのダウンロード部分の貪欲さを低減</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/826" target="_top">#826</a>, raster2pgsqlの詰め物タイルはデフォルトでなくなりました。-Pフラグで詰め物タイルにできます</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1363" target="_top">#1363</a>, ST_AddBand(raster, ...)配列版のC言語による再記述</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1364" target="_top">#1364</a>, ST_Union(raster, ...)集約関数のC言語による再記述</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1655" target="_top">#1655</a>, ST_Slopeのパラメータの追加的なデフォルト値</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1661" target="_top">#1661</a>, 集約関数形式のST_SameAlignmentを追加</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1719" target="_top">#1719</a>, ST_MakeValidのポイントとジオメトリコレクション入力への対応の追加</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1780" target="_top">#1780</a>, ST_GeoHashのジオグラフィ対応の追加</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1796" target="_top">#1796</a>, ジオグラフィの距離計算の非常に大きな効率改善</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1802" target="_top">#1802</a>, 関数の割り込み可能性について改善。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1823" target="_top">#1823</a>, ST_AsGMLへのGML 3出力用の識別子カラム (GML 3.2.1から必須)を使用するためのパラメータの追加</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1856" target="_top">#1856</a>, Tigerジオコーダ: 逆ジオコーディングの評価で道路番号が好ましい場合に設定できるようになりました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1938" target="_top">#1938</a>, 1回の呼び出しで複数の新しいバンドを追加するようST_AddBandを基本からリファクタリング</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1978" target="_top">#1978</a>, 閉じた円弧 (円)の距離計算で悪い答が出る</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1989" target="_top">#1989</a>, 入力ジオメトリをクリップされるべきラスタとの交差だけに処理するようにしました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2021" target="_top">#2021</a>, ST_Union(raster, ...)集約関数に複数バンド対応を追加</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2006" target="_top">#2006</a>, 極や日付線をまたぐST_Area(geography)への対応の改善</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2065" target="_top">#2065</a>, ST_Clip(raster, ...)がC言語の関数になりました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2069" target="_top">#2069</a>, ST_Tile(raster)にタイルの詰め物に関するパラメータ追加</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2078" target="_top">#2078</a>, ST_Slope, ST_AspectとST_HillShadeにカバレッジのタイルの処理を解決するための形式を追加</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2097" target="_top">#2097</a>, ST_Union(raster)のuniontypeオプションにRANGEを追加</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2105" target="_top">#2105</a>, 出力を参照ラスタに整列させるためのST_Transform(raster)の形式を追加</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2119" target="_top">#2119</a>, Rasters passed to ST_Resample(), ST_Rescale(), ST_Reskew()とST_SnapToGrid()に渡すラスタはSRIDを必須としなくなりました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2141" target="_top">#2141</a>, 制約がラスタカラムに追加できない場合の出力がより詳細になりました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2143" target="_top">#2143</a>, ラスタのblocksize制約で複数値を許容するようになりました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2148" target="_top">#2148</a>, ラスタのcoverage_tile制約の追加</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2149" target="_top">#2149</a>, ラスタのspatially_unique制約の追加</p><p>TopologySummary出力に登録されていないレイヤとレイヤから欠落しているTopoGeometryオブジェクトの個数が含まれるようになりました</p><p>ST_HillShade(), ST_Aspect()とST_Slope()に、実行前に行うNODATAピクセルの補間のための新しいパラメータを追加。</p><p>ポイント版ST_SetValue(raster)は現在はgeomval版 ST_SetValues(rast)をラップするようになっています。</p><p>中核APIとローダでラスタバンドのisnodataフラグへの確実な対応</p><p>ST_AspectとST_HillShadeのパラメータのデフォルト値の追加</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2178" target="_top">#2178</a>, ST_Summaryは[S]フラグでSRIDの有無が分かるようになりました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2202" target="_top">#2202</a>, libjson-cの任意化 (コンフィギュアスイッチ--without-json)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2213" target="_top">#2213</a>, libjson-c 0.10以上への新規対応</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2231" target="_top">#2231</a>, raster2pgsqlがファイル名カラムのカラム名を-nで指定できるようになりました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2200" target="_top">#2200</a>, ST_Union(raster, uniontype)で全ての入力ラスタの全てのバンドを結合するようになりました。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2264" target="_top">#2264</a>, postgis_restore.plがカスタムスキーマでPostGISを使っているデータベースへの再格納に対応しました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2244" target="_top">#2244</a>, ラスタにデータベース外バンドがある場合にジオリファレンスが変わったときに警告が出る</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2222" target="_top">#2222</a>, ST_AsBinaryに、データベース外バンドをデータベース内バンドのように返すべきかを決めるフラグOutAsInパラメータの追加</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89801472"></a>訂正</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1839" target="_top">#1839</a>, raster2pgsqlでGeoTIFFのサブデータセットの処理</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1840" target="_top">#1840</a>, raster2pgsqlでタイル数を計算する時機のロジックを訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1870" target="_top">#1870</a>, ラスタのST_Intersectsの文書と実際の振る舞いとをあわせました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1872" target="_top">#1872</a>, ST_ApproxSummarystatsでゼロで割らないようにしました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1875" target="_top">#1875</a>, パラメータのcountが0で他が全てNULLの時にST_SummaryStatsがNULLを返す</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1932" target="_top">#1932</a>, raster2pgsqlでインデックスのテーブル空間についての書式を訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1936" target="_top">#1936</a>, ST_GeomFromGMLにCurvePolygonを与えると異常終了する</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1939" target="_top">#1939</a>, 独自データ型: summarystats, histogram, quantile, valuecountを削除</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1951" target="_top">#1951</a>, 距離が0のラインストリングで異常終了するのを削除</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1957" target="_top">#1957</a>, 1点のラインストリングを与えるとST_DistanceがNULLを返す</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1976" target="_top">#1976</a>, ジオグラフィの環内ポイントのコードを信頼性向上のため見直し</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1981" target="_top">#1981</a>, gcc 4.6以上で警告の原因となる未使用変数の削除</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1996" target="_top">#1996</a>, GeoJSON出力でPOINT EMPTYに対応</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2062" target="_top">#2062</a>, 距離計算の効率改善</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2057" target="_top">#2057</a>, raster2psqlからlibpqへのリンクの問題を訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2077" target="_top">#2077</a>, ST_Hillshade()が正しくない値を返すのを訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2019" target="_top">#2019</a>, ST_FlipCoordinatesがバウンダリボックスを更新しない</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2100" target="_top">#2100</a>, ST_AsRasterが指定したピクセル型によってはラスタを返さないことがある</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2126" target="_top">#2126</a>, ST_ConvexHull()からの空のラスタの処理を改善</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2165" target="_top">#2165</a>, ST_NumPointsの回帰テストがCircularStringだと失敗する</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2168" target="_top">#2168</a>, ST_Distanceが交換可能にならないときがある</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2182" target="_top">#2182</a>, データベース外ラスタで、SRIDなしでST_Resizeを実行する際の問題訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2188" target="_top">#2188</a>, GDALデータセットからデータをｈ区政する時に問題となる関数パラメータ値のオーバフローの訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2198" target="_top">#2198</a>, ST_Tile()内でデータベース外ラスタのバンドを生成する時に正しくない寸法を使うのを訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2201" target="_top">#2201</a>, 境界上のST_GeoHashが間違っている</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2203" target="_top">#2203</a>, GDAL Warp APIに渡す時の、未知のSRIDを持つラストとデフォルトのgeotransformを処理する方法を変更</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2215" target="_top">#2215</a>, 暗黙のインデックスの名前の衝突のためラスタ除外制約
Fixed raster exclusion constraint for conflicting name of implicit index</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2251" target="_top">#2251</a>, デフォルトのgeotransform行列でラスタを再スケーリングすると次元がおかしくなるのを訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2133" target="_top">#2133</a>, ST_MapAlgebraの数式版における効率性回帰テストの訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2257" target="_top">#2257</a>, 空ジオメトリでテストする時にGBOX変数が初期化されない</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2271" target="_top">#2271</a>, ラスタの並列ビルドの阻止</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2282" target="_top">#2282</a>, デバッグモードで未定義関数nd_stats_to_grid()を呼ぶのを訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2307" target="_top">#2307</a>, ST_MakeValidが不正なジオメトリを出力する</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2309" target="_top">#2309</a>, SRS情報取得時の紛らわしいINFOメッセージを削除</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2336" target="_top">#2336</a>, wgetを使って全てのファイルを得るのにFIPS 20 (KS)がワイルドカード展開を行う</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2348" target="_top">#2348</a>, 2.0から2.1へのラスタのアップグレードパスの提供</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2351" target="_top">#2351</a>, ジオグラフィ間のst_distanceが間違っている</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2359" target="_top">#2359</a>, オーバビュー制約の追加時のスキーマ名の処理の訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2371" target="_top">#2371</a>, サポートするGEOSの版のマイナー以下の桁が違う</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2383" target="_top">#2383</a>, 警告メッセージから安全でない \" の使用を削除</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2384" target="_top">#2384</a>, ST_Neighborhoodの変数型が不正</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89834496"></a>既知の問題</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2111" target="_top">#2111</a>, ラスタバンドはデータベース外ラスタの最初の256バンドだけ参照可能</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp89836032"></a>A.41. リリース 2.0.5</h2></div></div></div><p>リリース日: 2014/03/31</p><p>この版は誤り訂正版です。2.0.4版以降に送られた問題の処理が行われました。PostGIS 2.0以上を使っている場合にはソフトアップデートが必要です。PostGIS 1.5以前を使っている場合には、ハードアップグレードが必要です。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89837440"></a>誤り訂正</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2494" target="_top">#2494</a>, GiSTインデックスでのmemcpyを回避</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2502" target="_top">#2502</a>, postgis_topology_scripts_installed()のインストールスキーマの訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2504" target="_top">#2504</a>, pgsql2shpの正しくない呼び出しでセグメンテーション違反が発生するのを訂正 </p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2528" target="_top">#2528</a>, ST_Split / lwline_split_by_lineでのメモリリークを訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2532" target="_top">#2532</a>, ラスタ/ジオメトリの交換演算子の追加</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2533" target="_top">#2533</a>, 重複シグネチャの削除</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2552" target="_top">#2552</a>, ST_AsPNG, ST_AsTIFF, ST_AsJPEGのNULLラスタ処理の訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2555" target="_top">#2555</a>, ST_Reclassのrange引数のパースの問題の訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2589" target="_top">#2589</a>, 必須でないvoidポインタの使用の削除</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2607" target="_top">#2607</a>, 処理時に1024以上のデータベース外ファイルが開けない</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2610" target="_top">#2610</a>, フェイス分割アルゴリズムでエッジインデックスの使用を確実にしました </p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2619" target="_top">#2619</a>, GeoJSONポリゴンで空の環があると異常終了する</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2638" target="_top">#2638</a>, M値を持つジオグラフィの距離が時々おかしい</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89848704"></a>重要な変更</h3></div></div></div><p>#<a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2514" target="_top">#2514</a>, PostGIS ExtensionをGPLv2で配布できるようにラスタのラインセンスをGPL v3+からv2+に変更</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp89850496"></a>A.42. リリース 2.0.4</h2></div></div></div><p>リリース日: 2013/09/06</p><p>この版は誤り訂正版です。2.0.3版以降に送られた問題の処理が行われました。PostGIS 2.0以上を使っている場合にはソフトアップデートが必要です。PostGIS 1.5以前を使っている場合には、ハードアップグレードが必要です。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89851904"></a>誤り訂正</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2110" target="_top">#2110</a>, EMPTYと原点上のポイントとの等価演算</p><p>TopoGeo_addPointで精度距離でのポイントの追加が可能になりました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1968" target="_top">#1968</a>,toTopoGeomからエッジがなくなって返るのを訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2165" target="_top">#2165</a>, ST_NumPointsの回帰テストがCircularStringだと失敗する</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2168" target="_top">#2168</a>, ST_Distanceが交換可能にならないときがある</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2186" target="_top">#2186</a>, GUIのプログレスバーの更新が頻繁に過ぎる</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2201" target="_top">#2201</a>, 境界上のST_GeoHashが間違っている</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2257" target="_top">#2257</a>, 空ジオメトリでテストする時にGBOX変数が初期化されない</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2271" target="_top">#2271</a>, ラスタの並列ビルドの阻止</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2267" target="_top">#2267</a>, テーブルの解析からサーバが異常終了する</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2277" target="_top">#2277</a>, 潜在的なセグメンテーション違反を削除</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2307" target="_top">#2307</a>, ST_MakeValidが不正なジオメトリを出力する</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2351" target="_top">#2351</a>, ジオグラフィ間のst_distanceが間違っている</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2359" target="_top">#2359</a>, overview制約のスキーマの処理が不正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2371" target="_top">#2371</a>, サポートするGEOSの版のマイナー以下の桁が違う</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2372" target="_top">#2372</a>, KMLの座標に空白を入れたらパースできない</p><p>システム全体でインストールされるliblwgeomでビルドするよう訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2383" target="_top">#2383</a>, 警告メッセージ内の安全でない \' の使用を訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2410" target="_top">#2410</a>, 頂点が同一線上にある曲線の分割の訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2412" target="_top">#2412</a>, ST_LineToCurveが4頂点未満のラインに対応</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2415" target="_top">#2415</a>, ST_MultiがCOMPOUNDCURVEとCURVEPOLYGONに対応</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2420" target="_top">#2420</a>, ST_LineToCurve: 閉じた円の定義に少なくとも8エッジが必要</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2423" target="_top">#2423</a>, ST_LineToCurve: 同じ角度を形成する全てのアークが必要</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2424" target="_top">#2424</a>, ST_CurveToLine: MULTICURVEのCOMPOUNDCURVEに対応</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2427" target="_top">#2427</a>, ST_CurveToLineでの曲線の1番目のポイントの維持を確実にするようにしました</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89892736"></a>性能強化</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2269" target="_top">#2269</a>, ANALYZEでジオメトリ全体のTOASTを解除する無駄を排除</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89894272"></a>既知の問題</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2111" target="_top">#2111</a>, ラスタバンドはデータベース外ラスタの最初の256バンドだけ参照可能</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp89895936"></a>A.43. リリース 2.0.3</h2></div></div></div><p>リリース日: 2013/03/01</p><p>この版は誤り訂正版です。2.0.2版以降に送られた問題の処理が行われました。PostGIS 2.0以上を使っている場合にはソフトアップデートが必要です。PostGIS 1.5以前を使っている場合には、ハードアップグレードが必要です。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89897344"></a>誤り訂正</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2126" target="_top">#2126</a>, ST_ConvexHull()からの空のラスタの処理を改善</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2134" target="_top">#2134</a>, GDAL関数に渡す前のSRS処理を確実にしました</p><p>liblwgeomの様々なメモリリークを訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2173" target="_top">#2173</a>, ラインを頂点で分割する際の堅牢性の訂正とトポロジ構築への波及(<a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2172" target="_top">#2172</a>)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2174" target="_top">#2174</a>, 間違った関数lwpoly_free()の使用法の訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2176" target="_top">#2176</a>, ST_ChangeEdgeGeomの堅牢性問題の訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2184" target="_top">#2184</a>, Z値を持つトポロジの複写を正しくしました </p><p>postgis_restore.plでダンプでジオメトリカラム名の混合する場合への対応</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2188" target="_top">#2188</a>, GDALデータセットからデータをｈ区政する時に問題となる関数パラメータ値のオーバフローの訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2216" target="_top">#2216</a>, マルチポリゴンのGeoJSON (穴のあるもの)のパーシングで多数のメモリエラー</p><p>GeoJSONパーサのメモリリークの訂正</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89910400"></a>性能強化</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2141" target="_top">#2141</a>, 制約がラスタカラムに追加できない場合の出力がより詳細になりました</p><p>ST_ChangeEdgeGeomの速度向上</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp89912448"></a>A.44. リリース 2.0.2</h2></div></div></div><p>リリース日: 2012/12/03</p><p>この版は誤り訂正版です。2.0.1版以降に送られた問題の処理が行われました。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89913856"></a>誤り訂正</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1287" target="_top">#1287</a>, "gist_geometry_ops"の削除によって、この場合のクライアントのlegacy_gist.sqlのパッケージが壊れた</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1391" target="_top">#1391</a>, 1.5版からのアップデートでエラーが発生する</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1828" target="_top">#1828</a>, ST_DWithinで選択度見積もりが貧弱</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1838" target="_top">#1838</a>, Tigerのラインデータのインポートでエラー</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1869" target="_top">#1869</a>, ST_AsBinaryがlegacy_minor/legacy.sqlスクリプトに一意に追加されない</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1885" target="_top">#1885</a>, Tiger2010のcensus_loader.sqlでtabblockテーブルのフィールド欠損</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1891" target="_top">#1891</a>, liblwgeomのビルドでLDFLAGS環境変数を使うようにしました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1900" target="_top">#1900</a>, ビッグエンディアン機でのpgsql2shpの訂正 </p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1932" target="_top">#1932</a>, raster2pgsqlでインデックスのテーブル空間設定が不正な書式になるのを訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1936" target="_top">#1936</a>, ST_GeomFromGMLにCurvePolygonを与えると異常終了する</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1955" target="_top">#1955</a>, 二重接続されたエッジのST_ModEdgeHealとST_NewEdgeHeal</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1957" target="_top">#1957</a>, 1点のラインストリングを与えるとST_DistanceがNULLを返す</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1976" target="_top">#1976</a>, ジオグラフィの環内ポイントのコードを信頼性向上のため見直し</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1978" target="_top">#1978</a>, 閉じた円弧 (円)の長さの計算が間違っている</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1981" target="_top">#1981</a>, gcc 4.6以上で発見された、使われないけれども宣言されている変数の削除</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1987" target="_top">#1987</a>, ST_Simplifyの挙動を1.5.x版に戻しました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1989" target="_top">#1989</a>, 入力ジオメトリをクリップされるべきラスタとの交差だけに処理するようにしました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1991" target="_top">#1991</a>, PostgreSQL 9.2上でのジオコーディングが本当に遅い</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1996" target="_top">#1996</a>, GeoJSON出力でPOINT EMPTYに対応</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1998" target="_top">#1998</a>, 両方の終端を共有するエッジをつなげるST_{Mod,New}EdgeHealの訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2001" target="_top">#2001</a>, ST_CurveToLineで、ジオメトリが実際に弧を含んでいない場合に効果が無い</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2015" target="_top">#2015</a>, ST_IsEmpty('POLYGON(EMPTY)')がFALSEを返す</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2019" target="_top">#2019</a>, ST_FlipCoordinatesがバウンダリボックスを更新しない</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2025" target="_top">#2025</a>, TopoGeo_AddLineStringでサイドの位置が衝突するのを訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2026" target="_top">#2026</a>, 距離計算の効率改善</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2033" target="_top">#2033</a>, 2.5次元トポロジへの分割ポイント追加の訂正 </p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2051" target="_top">#2051</a>, ST_AsGeoJSON出力での精度過剰の訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2052" target="_top">#2052</a>, lwgeom_to_geojsonでのバッファオーバフローの訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2056" target="_top">#2056</a>, ST_SetValue()でのラスタとジオメトリのSRIDチェックの欠落を訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2057" target="_top">#2057</a>, raster2psqlからlibpqへのリンクの問題を訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2060" target="_top">#2060</a>, GetTopoGeomElementArrayで「次元」チェック違反になるのを訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2072" target="_top">#2072</a>, ST_Intersects(raster)がデータベース外バンドで動作することを予防する旧式のチェックの削除</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2077" target="_top">#2077</a>, ST_Hillshade(raster)が正しくない答えを出すのを訂正 </p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2092" target="_top">#2092</a>, libxml2.8以上でのST_GeomFromKML,ST_GeomFromGMLの名前空間の問題</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2099" target="_top">#2099</a>, ST_OffsetCurveでの例外発生時に二度メモリ開放をしているのを訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2100" target="_top">#2100</a>, ST_AsRaster()が指定したピクセルタイプでラスタを返さないことがある</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2108" target="_top">#2108</a>, ST_Line_Interpolate_Pointが常にポイントを返すのを確実にしました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2109" target="_top">#2109</a>, ST_Centroidが常にポイントを返すのを確実にしました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2117" target="_top">#2117</a>, ST_PointOnSurfaceが常にポイントを返すのを確実にしました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2129" target="_top">#2129</a>, 入力がコレクションの場合のST_Homogenizeで出力のSRIDを訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2130" target="_top">#2130</a>, マルチポリゴンのGeoJson読み込みでメモリエラーが出るのを訂正</p><p>Maven jarのURLを更新</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89971840"></a>性能強化</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1581" target="_top">#1581</a>, ST_Clip(raster, ...)は、現在では、引数のラスタにNODATAが無い場合に、バンドのNODATAを強制しません</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1928" target="_top">#1928</a>, Accept array properties in GML input 入力GMLのマルチ系ジオメトリでの配列を受け付けるようにしました (Kashif RasulさんとShoaib Burqさん / SpacialDB)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2082" target="_top">#2082</a>, トポロジのエッジテーブルの始端ノードと終端ノードにインデックスを追加</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2087" target="_top">#2087</a>, 再帰的共通テーブル式の使用でtopology.GetRingEdgesの速度向上</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp89975808"></a>A.45. リリース 2.0.1</h2></div></div></div><p>リリース日: 2012/06/22</p><p>この版は誤り訂正版です。2.0.0版以降に送られた問題の処理が行われました。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89977216"></a>誤り訂正</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1264" target="_top">#1264</a>, st_dwithin(geog, geog, 0)の訂正。 </p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1468" target="_top">#1468</a> shp2pgsql-guiのテーブル、カラム、スキーマの入力テキストボックスがずれる</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1694" target="_top">#1694</a>, clangでのビルドの訂正 (vinceさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1708" target="_top">#1708</a>, PostGIS 2.0より前のバックアップの再格納の改善。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1714" target="_top">#1714</a>, トポロジでの広い許容範囲の処理の堅牢性向上</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1755" target="_top">#1755</a>, ST_GeographyFromTextの高次元への対応。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1759" target="_top">#1759</a>, ラスタが有効なデータベースで投影変換されたシェープファイルのロード。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1761" target="_top">#1761</a>, raster2pgsqlでのNetCDF, HDF4およびHDF5のサブデータセットの処理。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1763" target="_top">#1763</a>, topology.toTopoGeomで独自のsearch_pathを使っている。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1766" target="_top">#1766</a>, ST_RemEdge*が周辺のTopoGeometryオブジェクトを破壊しないようにしました。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1774" target="_top">#1774</a>, エッジ塩ｍ、餌取を不正なものに設定した時のエラーを明確にしました。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1775" target="_top">#1775</a>, 2頂点を対象とするST_ChangeEdgeGeomの衝突検出。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1776" target="_top">#1776</a>, ST_SymDifference(empty, geom)がgeomを返すよう訂正。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1779" target="_top">#1779</a>, SQLコメントファイルをインストールするようにしました。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1782" target="_top">#1782</a>, ラスタでの空間参照系文字列の処理の訂正。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1789" target="_top">#1789</a>, ValidateTopologyで、エッジとノードのクロスを虚偽報告する問題を訂正。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1790" target="_top">#1790</a>, toTopoGeomの重複するプリミティブの処理の訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1791" target="_top">#1791</a>, 非常に近いが重ならない2ポイントを引数に取るST_Azimuthの訂正。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1797" target="_top">#1797</a>, (ValidateTopology(xxx)).*構文の呼び出しに関する訂正。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1805" target="_top">#1805</a>, put back the 900913 SRID登録を戻しました。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1813" target="_top">#1813</a>, メタデータテーブル内の読むことができるリレーションだけを表示するよう変更。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1819" target="_top">#1819</a>, ST_World2RasterCoordとST_Raster2WorldCoord の浮動小数点数の問題の訂正。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1820" target="_top">#1820</a> PostgreSQL 9.2beta1でのコンパイル。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1822" target="_top">#1822</a>, PostgreSQL 9.2beta1でのトポロジのロード。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1825" target="_top">#1825</a>, 準備されたジオメトリキャッシュの抽出について訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1829" target="_top">#1829</a>, GeoJSONパーサで初期化されていない値の読み込みの訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1834" target="_top">#1834</a>, ユーザ定義の空間参照系をバックアップするためだけのPostGISエクステンションの改訂</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1839" target="_top">#1839</a>, raster2pgsqlでGeoTIFFのサブデータセットの処理</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1840" target="_top">#1840</a>, raster2pgsqlでタイル数を計算する時機のロジックを訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1851" target="_top">#1851</a>, EPSG:3844の空間参照系パラメータの訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1857" target="_top">#1857</a>, ST_AddEdge*Face*での終点不整合の検出失敗を訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1865" target="_top">#1865</a>, postgis_restore.plで、先頭にダッシュ(訳注: "--")が付く行が欠損する。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1867" target="_top">#1867</a>, topogeo_add*に不正なトポロジ名を渡した際の例外</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1872" target="_top">#1872</a>, ST_ApproxSummarystatsでゼロで割らないようにしました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1873" target="_top">#1873</a>, ptarray_locate_pointを、線上にある場合にZ/M補間値を返すよう訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1875" target="_top">#1875</a>, パラメータのcountが0で他が全てNULLの時にST_SummaryStatsがNULLを返す </p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1881" target="_top">#1881</a>, shp2pgsql-gui -- 時々、フィールドの編集をきっかけに行が削除される</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1883" target="_top">#1883</a>, ジオコーダのインストールで、create_census_base_tables()を実行し要素すると失敗する (Brian Panullaさん)</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90007936"></a>性能強化</h3></div></div></div><p>トポロジ編集関数からの例外メッセージをより詳細にしました。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1786" target="_top">#1786</a>, ビルドの依存関係を改善。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1806" target="_top">#1806</a>, ST_BuildArea, ST_MakeValidおよびST_GetFaceGeometryの速度向上。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1812" target="_top">#1812</a>, より安定的なテストのためにLIBLWGEOMにlwgeom_normalizeを追加。</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp90023808"></a>A.46. リリース 2.0.0</h2></div></div></div><p>リリース日: 2012/04/03</p><p>メジャーリリースです。ハードアップグレードが必要です。完全なダンプの再読み込みと、古い関数を使用している場合には特別な準備が必要です。アップグレードの詳細は<a class="xref" href="#hard_upgrade" title="3.4.2. ハードアップグレード">「ハードアップグレード」</a>をご覧ください。本版の詳細情報や変更/追加された関数については<a class="xref" href="#NewFunctions_2_0" title="15.12.11. PostGIS 2.0で新規作成/機能強化/変更された関数">「PostGIS 2.0で新規作成/機能強化/変更された関数」</a>をご覧ください。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90025984"></a>テスター - 影のヒーロー</h3></div></div></div><p>PostGISコミュニティ内の、このリリースの新しい機能をテストしてくれる勇敢なメンバー多数にお世話になっています。この方々なしにメジャーリリースは成功しえません。</p><p>勇敢で、非常に詳細かつ徹底したバグレポートを出し、詳細に分析をしてくれた方々を次に示します。</p><table border="0" summary="Simple list" class="simplelist"><tr><td>Andrea Periさん - トポロジの多数のテスト、正確性の確認</td></tr><tr><td>Andreas Forø Tollefsenさん - ラスタのテスト</td></tr><tr><td>Chris Englishさん - トポロジのローダ機能のストレステスト</td></tr><tr><td>Salvatore Larosaさん - トポロジのロバスト性のテスト</td></tr><tr><td>Brian Hamlinさん - ベンチマーク (コアに組み込む前の試験ブランチも)、Tigerとトポロジを含む多数の要素の全体的なテスト、多種の仮想サーバ上でのテスト。</td></tr><tr><td>Mike Peaseさん - Tigerジオコーダのテスト - 問題の非常に詳細な報告</td></tr><tr><td>Tom van Tilburgさん - ラスタのテスト</td></tr></table></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90034816"></a>重大/大幅な変更</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/722" target="_top">#722</a>, <a class="ulink" href="http://trac.osgeo.org/postgis/ticket/302" target="_top">#302</a>, 多数の非推奨関数の削除 (250関数以上) (Regina Obeさん, Paul Ramseyさん)</p><p>不定SRIDを-1から0に変更 (Paul Ramseyさん)</p><p>-- (1.2で非推奨になっている) buffer, length, intersectsといったSTの付いていない別名で残っている関数の削除と内部関数の名前変更。 </p><p>-- 非推奨関数を使っている場合には、アプリケーションを変更するか、変更しないで得た結果に耐えるかして下さい。文書が無い関数は、サポートから外れる関数か内部関数です。古いテーブルの制約は、非推奨関数を使っています。再格納した際にpopulate_geometry_columns()でテーブルの制約の再構築を行います。非推奨関数にイオｚンするアプリケーションやツールを持っている場合には、<a class="xref" href="#legacy_faq" title="9.2.">問： 9.2</a>をご覧ください。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/944" target="_top">#944</a> geometry_columnsは現在はテーブルでなくビューです (Paul Ramseyさん, Regina Obeさん)。テーブルだった時は古い方法で制約 (SRID, タイプ, 次元)を読み、型修飾子で生成されたジオメトリカラムについては生のカラム定義を読みます。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1081" target="_top">#1081</a>, <a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1082" target="_top">#1082</a>, <a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1084" target="_top">#1084</a>, <a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1088" target="_top">#1088</a> - 管理関数が型修飾子ジオメトリカラムの生成関数に対応し、現在は型修飾子による生成がデフォルトです (Regina Obeさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1083" target="_top">#1083</a> probe_geometry_columns(), rename_geometry_table_constraints(), fix_geometry_columns()を削除 - geometry_columnビューでは廃止されています (Regina Obeさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/817" target="_top">#817</a> 古い3D関数をST_3Dに名前変更 (Nicklas Avénさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/548%E3%81%8C" target="_top">#548</a> (sorta), ST_NumGeometries,ST_GeometryNが単一ジオメトリに対してNULLでなく1 (またはジオメトリ)を返す (Sandro Santilliさん, Maxime van Noppenさん)</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90056192"></a>新機能</h3></div></div></div><p><a class="ulink" href="http://blog.opengeo.org/2011/09/28/indexed-nearest-neighbour-search-in-postgis/" target="_top">KNN GiSTインデクスに基づく重心 (&lt;-&gt;)とボックス (&lt;#&gt;)の距離演算子 (Paul Ramseyさん / 資金提供 Vizzuality)</a></p><p>TINと多面体サーフェスの対応と多数の3次元対応関数の強化 (Olivier Courtinさん / Oslandia)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/wiki/WKTRaster/PlanningAndFunding" target="_top">ラスター機能の統合と文書化</a>(Pierre Racineさん, Jorge Arévaloさん, Mateusz Loskotさん, Sandro Santilliさん, David Zwargさん, Regina Obeさん, Bborie Parkさん)  (企業の開発者と資金提供: University Laval, Deimos Space, CadCorp, Michigan Tech Research Institute, Azavea, Paragon Corporation, UC Davis Center for Vectorborne Diseases)</p><p>空間インデックスを3次元を意識したものに変更 - 作業中 (Paul Ramseyさん, Mark Cave-Aylandさん)</p><p>トポロジ機能の改善 (関数の追加)、文書化、テスト  (Sandro Santilliさん / Faunalia for RT-SIGTA), Andrea Periさん, Regina Obeさん, Jose Carlos Martinez Llari</p><p>3次元関係関数と3次元計測関数 (Nicklas Avénさん)</p><p>ST_3DDistance, ST_3DClosestPoint, ST_3DIntersects, ST_3DShortestLine等多数</p><p>N次元空間インデックス (Paul Ramseyさん / OpenGeo)</p><p>ST_Split (Sandro Santilliさん / Faunalia for RT-SIGTA)</p><p>ST_IsValidDetail (Sandro Santilliさん / Faunalia for RT-SIGTA)</p><p>ST_MakeValid (Sandro Santilliさん / Faunalia for RT-SIGTA)</p><p>ST_RemoveRepeatedPoints (Sandro Santilliさん / Faunalia for RT-SIGTA)</p><p>ST_GeometryNとST_NumGeometriesの非コレクションへの対応 (Sandro Santilliさん)</p><p>ST_IsCollection (Sandro Santilliさん, Maxime van Noppenさん)</p><p>ST_SharedPaths (Sandro Santilliさん / Faunalia for RT-SIGTA)</p><p>ST_Snap (Sandro Santilliさん)</p><p>ST_RelateMatch (Sandro Santilliさん / Faunalia for RT-SIGTA)</p><p>ST_ConcaveHull (Regina Obe and Leo Hsuさん / Paragon Corporation)</p><p>ST_UnaryUnion (Sandro Santilliさん / Faunalia for RT-SIGTA)</p><p>ST_AsX3D (Regina Obeさん / Arrival 3D funding)</p><p>ST_OffsetCurve (Sandro Santilliさん, Rafal Magdaさん)</p><p><a class="ulink" href="http://blog.opengeo.org/2011/11/21/st_geomfromgeojson/" target="_top">ST_GeomFromGeoJSON (Kashif Rasulさん, Paul Ramseyさん / Vizzuality funding)</a></p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90067456"></a>性能強化</h3></div></div></div><p>シェープファイルローダについて、無償配布の世界規模のシェープファイルの一部でみられる、切り詰められたマルチバイト値を許容するようにしました (Sandro Santilliさん)</p><p>shp2pgsqlの多数の誤り訂正と強化、ローダの回帰テストの増強、インポート時のジオメトリとジオグラフィの両方の投影変換 (Jeff Adamsさん / Azaveaさん, Mark Cave-Aylandさん)</p><p>pgsql2shpの事前に定義されたリストからの変換  (Loic Dacharyさん / Mark Cave-Aylandさん)</p><p>Shp-pgsql GUIローダ - 複数ファイルを一度にロードするできるようにしました (Mark Leslieさん)</p><p>Extras - Tigerジオコーダの、古いTigerの書式から新しいTigerのシェープとファイル構造の書式へのアップグレード (Stephen Frostさん)</p><p>Extras - Tigerジオコーダについて、TIGER 2010データ対応、逆ジオコーダ関数の追加、多数の誤り訂正、精度強化、最大結果数の制限、速度改善、ルーティンのロード の改訂(Regina Obeさん, Leo Hsuさん / Paragon Corporation / Hunter Systems Groupからの資金提供)</p><p>文書全体の校正と修正 (Kasif Rasulさん)</p><p>PostGIS JDBCクラスの整理、Mavenビルドの改訂 (Maria Arias de Reynaさん, Sandro Santilliさん)</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90071296"></a>誤り訂正</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1335" target="_top">#1335</a> ST_AddPointがLinuxでは不正な結果を返す (Even Rouaultさん)</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90072832"></a>リリースの特別クレジット</h3></div></div></div><p>PostGIS 2.0の公開にあたって経済支援を行ってくれた<a class="ulink" href="http://blog.opengeo.org/2012/02/01/it-goes-up-to-2-0/" target="_top">米国国務省人道情報ユニット (HIU)</a>および<a class="ulink" href="http://blog.cartodb.com/post/17318840209/postgis-core-committer-sandro-santilli-joins-cartodb" target="_top">Vizzuality</a>に感謝します。</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp90087680"></a>A.47. リリース 1.5.4</h2></div></div></div><p>リリース日: 2012/05/07</p><p>この版は誤り訂正版です。1.5.3版以降に送られた問題の処理が行われました。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90089088"></a>誤り訂正</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/547" target="_top">#547</a>, ST_Containsのメモリの問題 (Sandro Santilliさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/621" target="_top">#621</a>, ジオグラフィのインタセクトする部分の探索の問題 (Paul Ramseyさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/627" target="_top">#627</a>, 不正なジオメトリでPostGIS/PostgreSQLのプロセスが落ちる (Paul Ramseyさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/810" target="_top">#810</a>, 面積計算の精度向上 (Paul Ramseyさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/852" target="_top">#852</a>, 空間述語のロバスト性の改良 (Sandro Santilliさん, Nicklas Avénさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/877" target="_top">#877</a>, ST_Estimated_Extentが空のテーブルに対してNULLを返す (Sandro Santilliさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1028" target="_top">#1028</a>, ST_AsSVGが失敗するとPostgreSQLサーバプロセス全体を落とす (Paul Ramsey)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1056" target="_top">#1056</a>, 弧と円のバウンダリボックスを訂正 (Paul Ramseyさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1121" target="_top">#1121</a>, populate_geometry_columnsが非推奨関数を使っている (Regin Obeさん, Paul Ramseyさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1135" target="_top">#1135</a>, テストスィートの予見可能性を改善 (Andreas 'ads' Scherbaumさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1146" target="_top">#1146</a>, 画像生成機能の異常終了 (bronaughさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1170" target="_top">#1170</a>, 北極のインタセクションが失敗する (Paul Ramsey)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1179" target="_top">#1179</a>, 悪い値を与えるとST_AsTextが異常終了する (kjurka)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1184" target="_top">#1184</a>, honour DESTDIR in documentation Makefile (Bryce L Nordgren)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1227" target="_top">#1227</a>, 不正なGMLでサーバが異常終了する </p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1252" target="_top">#1252</a>, WKTでSRIDが出現する (Paul Ramseyさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1264" target="_top">#1264</a>, st_dwithin(g, g, 0)が動作しない (Paul Ramseyさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1344" target="_top">#1344</a>, 不正なジオメトリを持つテーブルのエクスポートを許す (Sandro Santilliさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1389" target="_top">#1389</a>, SRID 31300と31370のproj4textが間違っている (Paul Ramseyさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1406" target="_top">#1406</a>, shp2pgsqlでジオグラフィをロードすると異常終了する (Sandro Santilliさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1595" target="_top">#1595</a>, ST_Line_SubStringのSRIDが冗長になるのを訂正 (Sandro Santilliさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1596" target="_top">#1596</a>, UpdateGeometrySRID内のSRIDのチェック (Mike Toewsさん, Sandro Santilliさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1602" target="_top">#1602</a>, ST_PolygonizeをZ値を保持するよう訂正 (Sandro Santilliさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1697" target="_top">#1697</a>, GiSTインデックス内で空エントリがあると異常終了する問題を訂正 (Paul Ramseyさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1772" target="_top">#1772</a>, 崩壊した入力を与えた際のST_Line_Locate_Pointを訂正 (Sandro Santilliさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1799" target="_top">#1799</a>, ST_Segmentizeをmax_length=0から防ぐ (Sandro Santilliさん)</p><p>900913のパラメータの順序の変更　(Paul Ramseyさん)</p><p>"gmake"でのビルドに対応 (Greg Troxelさん)</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp90110976"></a>A.48. リリース 1.5.3</h2></div></div></div><p>リリース日: 2011/06/25</p><p>この版は誤り訂正版です。1.5.2版以降に送られた問題の処理が行われました。PostGIS 1.3以上を実行している場合には、ソフトアップグレードで十分です。そうでない場合には、ハードアップグレードが推奨されます。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90112384"></a>誤り訂正</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1056" target="_top">#1056</a>, アークジオメトリからの正しいバウンダリボックスの作成とインデックスの誤り訂正 (Paul Ramseyさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1007" target="_top">#1007</a>, ST_IsValidが異常終了する問題を訂正、GEOS 3.3.0以上か3.2.3以上が必要 (Sandro Santilliさん、報告はBirgit Laggnerさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/940" target="_top">#940</a>, PostgreSQL 9.1 beta 1への対応 (Regina Obeさん、Paul Ramseyさん、パッチはstlさんが提出)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/845" target="_top">#845</a>, ST_Intersectsの精度の誤り (Sandro Santilliさん、Nicklas Avénさん) cdestigterさんの報告</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/884" target="_top">#884</a>, ST_Within, ST_Intersectsの結果が不安定 (Chris Hodgsonさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/779" target="_top">#779</a>, shp2pgsqlの-Sオプションがポイントでは失敗しているように見える (Jeff Adamsさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/666" target="_top">#666</a>, ST_DumpPointsがNULLセーフでない (Regina Obeさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/631" target="_top">#631</a>, NZの投影を更新してグリッド変換に対応 (jpalmerさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/630" target="_top">#630</a>, ST_Collect内の配列の奇妙なNULL対処 (Chris Hodgsonさん) David Bitnerさん報告</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/624" target="_top">#624</a>, ST_GeogFromTextのメモリリーク (ryangさん, Paul Ramseyさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/609" target="_top">#609</a>, マニュアル5.2節のJavaクライアントのソースが間違っている (simocさん、Regina Obeさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/604" target="_top">#604</a>, shp2pgsqlの利用法表示の添削 (Mike Toewsさん、Paul Ramseyさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/573" target="_top">#573</a> ラインストリングのグループでST_Unionが失敗する、PostGISでなくGEOS 3.3.0の誤り</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/457" target="_top">#457</a> ST_CollectionExtractが所望のタイプでないものを返す (Nicklas Avénさん、Paul Ramseyさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/441" target="_top">#441</a> ST_AsGeoJsonでジオメトリコレクションのバウンダリボックスがおかしい (Olivier Courtinさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/411" target="_top">#411</a> 不正なジオメトリのバックアップできない (Sando Santilliさん) Regione Toscanaさんの報告</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/409" target="_top">#409</a> ST_AsSVGが劣化している (Olivier Courtinさん) Sdikiyの報告</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/373" target="_top">#373</a> マニュアルのハードアップグレードで文法誤り (Paul Ramseyさん) psvenssoさんの報告</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp90127232"></a>A.49. リリース 1.5.2</h2></div></div></div><p>リリース日: 2010/09/27</p><p>この版は誤り訂正版です。1.5.1版以降に送られた問題の処理が行われました。PostGIS 1.3以上を実行している場合には、ソフトアップグレードで十分です。そうでない場合には、ハードアップグレードが推奨されます。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90128640"></a>誤り訂正</h3></div></div></div><p>ローダ: シェープファイルの空ジオメトリ (頂点が全くない)の扱いの訂正 (Sandro Santilliさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/536" target="_top">#536</a>, ジオグラフィを引数に取るST_Intersects, ST_Covers, ST_CoveredBy およびジオメトリを引数に取るST_Equalsが空間インデックスを使っていない (Regina Obeさん, Nicklas Avenさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/573" target="_top">#573</a>, ジオグラフィを引数に取るST_Containsの改良 (Paul Ramseyさん)</p><p>ローダ: Mac GTKビルドでコマンド-qで終了する機能を追加 (Paul Ramseyさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/393" target="_top">#393</a>, ローダ: 大きなDBFファイルのための一時的なパッチを追加 (Maxime Guillaudさん, Paul Ramseyさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/507" target="_top">#507</a>, GeoJSONとGML出力で間違っているOGC URNを訂正 (Olivier Courtinさん)</p><p>spatial_ref_sys.sql SRID 3021投影のための測地系変換を追加 (Paul Ramsey)</p><p>ジオグラフィ - 全てのジオグラフィが見積もり範囲外である場合に異常終了するのを訂正 (Paul Ramseyさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/469" target="_top">#469</a>, array_aggregationの誤りを訂正 (Greg Starkさん, Paul Ramseyさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/532" target="_top">#532</a>, 一時的なジオグラフィテーブルが他のユーザのセッションから見える (Paul Ramseyさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/562" target="_top">#562</a>, 大きなジオグラフィを引数に取った際のST_Dwithinでエラー (Paul Ramsey)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/513" target="_top">#513</a>, ローダGUIがDBFのみモードの時に空間インデックスを作ろうとする (Paul Ramseyさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/527" target="_top">#527</a>, ローダGUIは、常にログメッセージを末尾に追加するべき (Mark Cave-Aylandさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/504" target="_top">#504</a>, shp2pgsqlは、xmin/xmaxフィールドの名前を変えるべき (Sandro Santilliさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/458" target="_top">#458</a>, postgis_commentsが版フォルダでなくcontribにインストールされる (Mark Cave-Aylandさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/474" target="_top">#474</a>, ジオグラフィカラムを持つテーブルにanalyzeを実行するとサーバが落ちる (Paul Ramseyさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/581" target="_top">#581</a>, LWGEOMのexpand関数で矛盾した結果が生成される (Mark Cave-Aylandさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/513" target="_top">#513</a>, shp2pgsql-guiへのdbfフィルタの追加とdbfのみのロード機能の追加 (Paul Ramseyさん)</p><p>PostgreSQL 9.0に対するビルドのさらなる問題の訂正 (Mark Cave-Aylandさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/572" target="_top">#572</a>, シェープファイルのためのパスワードの空白 (Mark Cave-Aylandさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/603" target="_top">#603</a>, shp2pgsql: "-w"でマルチ系オブジェクトの不正なWKTを生成する (Mark Cave-Aylandさん)</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp90143872"></a>A.50. リリース 1.5.1</h2></div></div></div><p>リリース日: 2010/03/11</p><p>この版は誤り訂正版です。1.4.1版以降に送られた問題の処理が行われました。PostGIS 1.3以上を実行している場合には、ソフトアップグレードで十分です。そうでない場合には、ハードアップグレードが推奨されます。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90145280"></a>誤り訂正</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/410" target="_top">#410</a>, ST_SetPoint, ST_AddPoint, ST_RemovePointをラインストリングに適用した際に、組み込みバウンダリボックスを更新するようにしました (Paul Ramseyさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/411" target="_top">#411</a>, 不正なジオメトリを持つテーブルのダンプを可能にしました (Sandro Santilliさん, for Regione Toscana-SIGTAさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/414" target="_top">#414</a>, アップグレードスクリプト実行時にgeography_columnsビューを含むようにしました (Paul Ramseyさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/419" target="_top">#419</a>, ST_Line_Substringがマルチラインストリング対応になりました (Paul Ramseyさん, Lidwala Consulting Engineersのみなさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/421" target="_top">#421</a>, ST_AsGML()の文字列長の計算の訂正 (Olivier Courtinさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/441" target="_top">#441</a>, 複数種類を持つコレクションからのGML生成を訂正 (Olivier Courtinさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/443" target="_top">#443</a>, GML3での座標値が逆になる (Olivier Courtinさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/450" target="_top">#450</a>, <a class="ulink" href="http://trac.osgeo.org/postgis/ticket/451" target="_top">#451</a>, 日付変更線をまたぐジオグラフィ型地物の面積計算が間違っている (Paul Ramseyさん)</p><p>間もなくリリースされる PostgreSQL 9.0への対応 (Paul Ramseyさん)</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp90153344"></a>A.51. リリース 1.5.0</h2></div></div></div><p>リリース日: 2010/02/04</p><p>このリリースでは、新しいGEOGRAPHY型を介した地理座標 (緯度/経度)への対応、能率強化、新しい入力書式対応 (GML, KML)、全体的な維持が行われました。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90154752"></a>API安定性</h3></div></div></div><p>PostGISのパブリックAPIはマイナーリリース (0.0.X)の間は変更しません</p><p>=~演算子をジオメトリ等価性チェックからバウンダリボックス等価性チェックに変更</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90156288"></a>互換性</h3></div></div></div><p>GEOS, Proj4およびLibXML2は必須となりました</p><p>次に示すライブラリのバージョンは、PostGIS 1.5で必要となる最低限です。</p><p>全てのプラットフォームでPostgreSQL 8.3以上</p><p>GEOS 3.1以上のみ (全ての機能の利点を得るにはGEOS 3.2以上)</p><p>新しいST_GeomFromGML/KML関数に関連してLibXML2 2.5以上</p><p>Proj4 4.5以上のみ</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90159360"></a>新機能</h3></div></div></div><p><a class="xref" href="#NewFunctions_1_5" title="15.12.13. PostGIS 1.5で新規作成/機能強化/変更された関数">「PostGIS 1.5で新規作成/機能強化/変更された関数」</a></p><p>ハウスドルフ距離計算の追加 (<a class="ulink" href="http://trac.osgeo.org/postgis/ticket/209" target="_top">#209</a>) (Vincent Picavetさん)</p><p>ST_Buffer処理で、一方のみのバッファリングと他のバッファリングスタイルに対応するためのパラメータの追加 (Sandro Santilliさん)</p><p>可視化と解析の関数に関連した、他の距離の追加 (Nicklas Avenさん)</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>ST_ClosestPoint</p></li><li class="listitem"><p>ST_DFullyWithin</p></li><li class="listitem"><p>ST_LongestLine</p></li><li class="listitem"><p>ST_MaxDistance</p></li><li class="listitem"><p>ST_ShortestLine</p></li></ul></div><p>ST_DumpPoints (Maxime van Noppenさん)</p><p>ST_GeomFromGMLとST_GeomFromKMLを介したGML, KMLの入力 (Olivier Courtinさん)</p><p>ST_CollectionExtractによる同種のコレクションの抽出 (Paul Ramseyさん)</p><p>ST_AddMeasureによる既存のラインストリングへのM値の追加 (Paul Ramseyさん)</p><p>utilsでのヒストリテーブルの実装 (George Silvaさん)</p><p>ジオグラフィ型と対応関数</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>球面アルゴリズム (Dave Skeaさん)</p></li><li class="listitem"><p>オブジェクト/インデックス実装 (Paurl Ramseyさん)</p></li><li class="listitem"><p>選択度の実装 (Mark Cave-Aylandさん)</p></li><li class="listitem"><p>KML, GMLおよびJSONへのシリアライズ (Olivier Courtin)</p></li><li class="listitem"><p>ST_Area, ST_Distance, ST_DWithin, ST_GeogFromText, ST_GeogFromWKB, ST_Intersects, ST_Covers, ST_Buffer (Paul Ramseyさん)</p></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90170624"></a>性能強化</h3></div></div></div><p>ST_Distanceの能率改善 (Nicklas Avenさん)</p><p>文書の更新と改善 (Regina Obeさん、Kevin Neufeldさん)</p><p>テストと品質管理 (Regina Obe)</p><p>PostGIS 1.5のPostgreSQL 8.5 trunkへの対応( Guillaume Lelargeさん)</p><p>shp2pgsql-guiの中核のWin32対応と改善 (Mark Cave-Aylandさん)</p><p>適切な'make check'対応 (Paul Ramseyさん)</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90173696"></a>誤り訂正</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/query?status=closed&amp;milestone=PostGIS+1.5.0&amp;order=priority" target="_top">http://trac.osgeo.org/postgis/query?status=closed&amp;milestone=PostGIS+1.5.0&amp;order=priority</a></p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp90175232"></a>A.52. リリース 1.4.0</h2></div></div></div><p>リリース日: 2009/07/24</p><p>このリリースでは、能率改善、内部構造とテストの改善、新機能、文書の更新が行われました。PostGIS 1.1以上を実行している場合には、ソフトアップグレードで十分です。そうでない場合には、ハードアップグレードが推奨されます。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90176640"></a>API安定性</h3></div></div></div><p>1.4リリース以降は、PostGISの公開APIはマイナーリリースの間は変更しません。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90177792"></a>互換性</h3></div></div></div><p>PostGIS 1.4に必須の*最低*のバージョン</p><p>全てのプラットフォームのPostgreSQL 8.2以上</p><p>GEOS 3.0以上のみ</p><p>PROJ4 4.5以上のみ</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90180096"></a>新機能</h3></div></div></div><p>GEOS 3.1以上でコンパイルした場合には、ST_Union()で高速なカスケードユニオンを使うようにしました (Paul Ramseyさん)</p><p>ST_ContainsProperly()はGEOS 3.1以上が必要です</p><p>ST_Intersects(), ST_Contains(), ST_Within()について、GEOS 3.1以上で高速なキャッシュジオメトリを使うようにしました (Paul Ramseyさん / 資金提供 Zonar Systems)</p><p>文書とマニュアルの大幅改善 (Regina ObeさんとKevin Neufeldさん)</p><p>マニュアル内の図とダイアグラム (Kevin Neufeldさん)</p><p>正当性評価に失敗した場合の、人が読める説明を返すST_IsValidReason() (Paul Ramseyさん)</p><p>ジオメトリからgeohash.orgの符号を返すST_GeoHash() (Paul Ramseyさん)</p><p>シェープファイルをロードするためのGTK+マルチプラットフォームGUI (Paul Ramseyさん)</p><p>交差方向を返すST_LineCrossingDirection() (Paul Ramseyさん)</p><p>Z軸に基づく部分列を返すST_LocateBetweenElevations() (Paul Ramseyさん)</p><p>ジオメトリのパーサが文法エラーの位置に関する明示的なエラーメッセージを返すようにしました (Mark Cave-Aylandさん)</p><p>JSON書式のジオメトリを返すST_AsGeoJSON() (Olivier Courtinさん)</p><p>Populate_Geometry_Columns() -- テーブルとビューについて自動的にgeometry_columnsに追加するようにしました (Kevin Neufeldさん)</p><p>ST_MinimumBoundingCircle()  --包含する円ポリゴンをより小さくできるようにしました (Bruce Rindahlさん)</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90186240"></a>性能強化</h3></div></div></div><p>核のジオメトリシステムを独立したライブラリliglwgeomに移動 (Mark Cave-Aylandさん)</p><p>PostgreSQLのビルドブートストラップコマンドpgxsを使った新しいビルドシステム</p><p>デバッグフレームワークの形式化と単純化 (Mark Cave-Aylandさん)</p><p>クロスプラットフォーム対応を用意にするためにヘッダに全てのビルド時の#defineをコンフィギュア時に生成しヘッダに入れるようにしました</p><p>ログ作成フレームワークの形式化と単純化 (Mark Cave-Aylandさん)</p><p>CIRCULARSTRING, COMPOUNDCURVEとCURVEPOLYGONの対応の拡張と安定性向上、パースの改善、対応関数強化 (Mark LeslieさんとMark Cave-Aylandさん)</p><p>OpenSolarisビルドへの対応改善 (Paul Ramseyさん)</p><p>MSVCビルドの対応改善 (Mateusz Loskot)</p><p>KML対応の更新 (Olivier Courtin)</p><p>liblwgeom用ユニットテストフレームワーク (Paul Ramseyさん)</p><p>全てのPostGIS関数を包括的に試験できる新しい試験フレームワーク (Regine Obeさん)</p><p>全てのジオメトリ集約関数の能率改善 (Paul Ramseyさん)</p><p>まもなく登場するPostgreSQL 8.4の対応 (Mark Cave-Aylandさん, Talha Bin Rizwanさん)</p><p>shp2pgsqとpgsql2shpをliblwgeomのパース/アンパースの共通部分に依存させるために再作成しました。</p><p>PDF文書のビルドと予備的なビルドの説明にPDF DbLaTeXを使用するようにしました (Jean David Techerさん)</p><p>ユーザ文書 (PDFとHTML)とDoxygen開発者文書の自動ビルド (Kevin Neufeldさん)</p><p>ImageMagickによるWKTジオメトリテキストファイルから文書画像への自動ビルド (Kevin Neufeldさん)</p><p>HTML文書用CSSをより魅力的にしました (Dane Springmeyerさん)</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90194048"></a>誤り訂正</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/query?status=closed&amp;milestone=PostGIS+1.4.0&amp;order=priority" target="_top">http://trac.osgeo.org/postgis/query?status=closed&amp;milestone=PostGIS+1.4.0&amp;order=priority</a></p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp90195584"></a>A.53. リリース 1.3.6</h2></div></div></div><p>リリース日: 2009/05/04</p><p>PostGIS 1.1以上を実行している場合には、ソフトアップグレードで十分です。そうでない場合には、ハードアップグレードが推奨されます。このリリースでは、PostgreSQL 8.4への対応、シェープファイルへの出力時のprjファイル出力とが追加され、shp2pgsqlの異常終了に関する訂正と、曲線タイプの処理とdbfファイルだけのインポートでの論理エラーとに関する小さな誤り訂正、AddGeometryColumnsのエラー処理の改善がなされています。</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp90213504"></a>A.54. リリース 1.3.5</h2></div></div></div><p>リリース日: 2008/12/15</p><p>PostGIS 1.1以上を実行している場合には、ソフトアップグレードで十分です。そうでない場合には、ハードアップグレードが推奨されます。このリリースは誤り訂正リリースです。ST_ForceCollectionの実行失敗への対応と、MapServerでラインストリングのレイヤを使う場合に重大な影響を受ける関連関数への対応を行っています。</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp90215040"></a>A.55. リリース 1.3.4</h2></div></div></div><p>リリース日: 2008/11/24</p><p>このリリースでは、GeoJSON出力とPostgreSQL 8.4でのビルドへの対応、文書品質と出力の美しさの改善、関数レベルのSQL文書を追加し、空間述語の性能改善 (ポリゴン内のポイントのテスト)が行われました。</p><p>誤り訂正として、多数の関数で曲線ラインストリングの処理で異常終了する問題、メモリリーク、線形参照が頂点上での計測で失敗する問題等の排除が挙げられます。詳細についてはNEWSファイルをご覧下さい。</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp90216960"></a>A.56. リリース 1.3.3</h2></div></div></div><p>リリース日: 2008/04/12</p><p>このリリースでは、shp2gpsqlの誤り訂正、SVGとKMLへの対応の強化、ST_SimplifyPreserveTopology関数の追加、GEOSの版に注意を払ったビルド、厳格かつ稀な失敗ケースの訂正が行われました。</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp90218496"></a>A.57. リリース 1.3.2</h2></div></div></div><p>リリース日: 2007/12/01</p><p>このリリースでは、ST_EndPoint()とST_Envelope()の誤り訂正、JDBCビルドとOS/Xへの対応の改善、GML3出力を含むST_AsGML()でのGML出力の対応の改善が行われました。</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp90220032"></a>A.58. リリース 1.3.1</h2></div></div></div><p>リリース日: 2007/08/13</p><p>このリリースでは、以前のリリースでの見落としていた、版番号、文書、タグ等に関する問題の訂正が行われました。</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp90221568"></a>A.59. リリース 1.3.0</h2></div></div></div><p>リリース日: 2007/08/09</p><p>このリリースでは、空間関係関数の性能改善、新しい空間関係関数の追加、関数名のSQL-MMへの変換 (空間型(Spatial Type)前置辞 (SP)を使います)が行われました。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90222976"></a>機能追加</h3></div></div></div><p>JDBC: Hibernate Dialectの追加 (Norman Barkerさんに感謝)</p><p>空間関係関数ST_CoversとST_CoveredByの追加。こららの関数の説明と根拠は<a class="ulink" href="http://lin-ear-th-inking.blogspot.com/2007/06/subtleties-of-ogc-covers-spatial.html" target="_top">http://lin-ear-th-inking.blogspot.com/2007/06/subtleties-of-ogc-covers-spatial.html</a>にあります。</p><p>空間関係関数ST_DWithinの追加。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90225536"></a>性能強化</h3></div></div></div><p>ST_Contains, ST_Intersects, ST_WithinとST_Disjoint用のキャッシュとインデックスを用いたポリゴン内ポイントの簡略版の追加。</p><p>空間関係関数のインラインインデックス対応の追加 (ST_Disjointを除く)</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90227072"></a>他の変更</h3></div></div></div><p>ジオメトリアクセサと処理関数における曲線ジオメトリ対応の拡張</p><p>空間型 (ST)前置辞を使用するSQL-MM命名規則への移動の開始。</p><p>PostgreSQL 8.3への最初の対応</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp90229120"></a>A.60. リリース 1.2.1</h2></div></div></div><p>リリース日: 2007/01/11</p><p>このリリースでは、PostgreSQL 8.2対応の誤り訂正と若干の性能改善が行われています。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89034624"></a>変更</h3></div></div></div><p>Within()のポリゴン内ポイントの短縮動作の訂正。</p><p>PostgreSQL 8.2のインデックスに対するNULL処理の訂正。</p><p>RPM specファイルの更新。</p><p>Transform()で処理を行わなくて良い場合の短縮版を追加。</p><p>JDBC: 多次元ジオメトリに対するJTS処理の訂正 (Thomas Martiさんのヒントと部分的なパッチに感謝)。さらに、Javadocがコンパイルされ同梱されるようになりました。GCJ使用時のCLASSPATH問題が訂正されました。pgjdbc 8.2互換性への対応の訂正、JDK 1.3以前の対応欠落の訂正が行われました。</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp89037440"></a>A.61. リリース 1.2.0</h2></div></div></div><p>リリース日: 2006/12/08</p><p>このリリースでは、SQL-MM定義の曲線ジオメトリのシリアライズ/デシリアライズ能力に沿ったタイプ定義と、性能改善が行われました。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90230784"></a>変更</h3></div></div></div><p>シリアライズ/デシリアライズの曲線ジオメトリタイプへの対応を追加</p><p>性能改善のためにContains()とWithin()にポリゴン内ポイントの短縮版を追加してました。</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp90232576"></a>A.62. リリース 1.1.6</h2></div></div></div><p>リリース日: 2006/11/02</p><p>これは誤り訂正のリリースです。特に64ビット機におけるGEOSインタフェースの重大なエラーを訂正しています。SRSパラメータの更新と投影変換の改善 (Z軸を取る)が行われました。アップグレードが<span class="emphasis"><em>必要です</em></span>。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90234368"></a>アップグレード</h3></div></div></div><p>1.0.3以上からアップグレードする場合には、<a class="link" href="#soft_upgrade" title="3.4.1. ソフトアップグレード">soft upgrade</a>の手続きを行います。</p><p><span class="emphasis"><em>1.0.0RC6から1.0.2まで</em></span>のリリースからアップグレードする場合には、リリース 1.0.3にある<a class="link" href="#rel_1.0.3_upgrading" title="A.72. リリース 1.0.3">アップグレード</a>をご覧ください。</p><p>1.0.0RC6より前のリリースからのアップグレードは、<a class="link" href="#hard_upgrade" title="3.4.2. ハードアップグレード">ハードアップグレード</a>が必要です。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90238208"></a>誤り訂正</h3></div></div></div><p>64ビット機で壊れていたCAPIの訂正</p><p>ローダ/ダンパ: 回帰テストと使用法出力の訂正</p><p>JDBCにおけるsetSRID()の誤り訂正。Thomas Martiさんに感謝。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90240128"></a>他の変更</h3></div></div></div><p>投影変換でのZ軸の使用</p><p>spatial_ref_sys.sqlをEPSG 6.11.1に更新</p><p>全体のためのバージョン変数を単一で使うためVersion.config基盤を単純化</p><p>ローダ/ダンパの使用法メッセージにVersion.configを含むようにしました</p><p>手作りで脆いJDBCのバージョンパーサをPropertiesに置き換え</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp90242944"></a>A.63. リリース 1.1.5</h2></div></div></div><p>リリース日: 2006/10/13</p><p>誤り訂正版です。Win32での重大なセグメンテーション違反を含みます。アップグレードは<span class="emphasis"><em>推奨されます</em></span>。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90244864"></a>アップグレード</h3></div></div></div><p>1.0.3以上からアップグレードする場合には、<a class="link" href="#soft_upgrade" title="3.4.1. ソフトアップグレード">soft upgrade</a>の手続きを行います。</p><p><span class="emphasis"><em>1.0.0RC6から1.0.2まで</em></span>のリリースからアップグレードする場合には、リリース 1.0.3にある<a class="link" href="#rel_1.0.3_upgrading" title="A.72. リリース 1.0.3">アップグレード</a>をご覧ください。</p><p>1.0.0RC6より前のリリースからのアップグレードは、<a class="link" href="#hard_upgrade" title="3.4.2. ハードアップグレード">ハードアップグレード</a>が必要です。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90248704"></a>誤り訂正</h3></div></div></div><p>PostgreSQL 8.2用でコンパイルした際に発生する、Win32上のpgsql2shpでセグメンテーション違反を引き起こすMingWのリンクの誤りの訂正</p><p>JavaのGeometry.equals()メソッドでNULLポインタ例外が発生する問題を訂正</p><p>GPL要求「変更の好まれる形式」の配布を満たすようEJB3Spatial.odtを追加</p><p>JDBC JTSコードから用いられていない同期を削除。</p><p>shp2pgsql/pgsql2shpのREADMEファイルが非常に古くなっていたのを、マニュアルページにマージして更新。</p><p>JDBCの版のタグが"1.1.4"なのに"1.1.3"になっていた問題を訂正。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90251776"></a>新機能</h3></div></div></div><p>非マルチ系ジオメトリのための-Sオプションをshp2pgsqlに追加</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp90253056"></a>A.64. リリース 1.1.4</h2></div></div></div><p>リリース日: 2006/09/27</p><p>Javaインタフェースでのいくつかの改善を含む誤り訂正版です。アップグレードは<span class="emphasis"><em>推奨されます</em></span>。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90254848"></a>アップグレード</h3></div></div></div><p>1.0.3以上からアップグレードする場合には、<a class="link" href="#soft_upgrade" title="3.4.1. ソフトアップグレード">soft upgrade</a>の手続きを行います。</p><p><span class="emphasis"><em>1.0.0RC6から1.0.2まで</em></span>のリリースからアップグレードする場合には、リリース 1.0.3にある<a class="link" href="#rel_1.0.3_upgrading" title="A.72. リリース 1.0.3">アップグレード</a>をご覧ください。</p><p>1.0.0RC6より前のリリースからのアップグレードは、<a class="link" href="#hard_upgrade" title="3.4.2. ハードアップグレード">ハードアップグレード</a>が必要です。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90258688"></a>誤り訂正</h3></div></div></div><p>PostgreSQL 8.2対応で訂正</p><p>collect()関数の入力のSRIDを捨てる問題を訂正</p><p>MakeBox2dとMakeBox3dでSRID合致確認を追加</p><p>GEOS 3.0.0が通るよう回帰テストの訂正</p><p>pgsql2shp同時実行の改善。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90261504"></a>Javaの変更</h3></div></div></div><p>SRID処理への新しいJTS開発者の姿勢を反映したJTS対応の再作業。コードの単純化とGNU Trove依存のビルドの削除。</p><p>"Geodetix s.r.l. Company"からの寄付によるEJB2対応の追加 </p><p>Norman Barker &lt;nbarker@ittvis.com&gt;さんの寄付によるEJB3チュートリアル/例の追加</p><p>Javaディレクトリ編成の若干の再編</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp90268032"></a>A.65. リリース 1.1.3</h2></div></div></div><p>リリース日: 2006/06/30</p><p>誤り訂正リリースです。新しい関数 (特にロングトランザクション対応)とポータビリティ強化を含みます。アップグレードは<span class="emphasis"><em>推奨されます</em></span>。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90269824"></a>アップグレード</h3></div></div></div><p>1.0.3以上からアップグレードする場合には、<a class="link" href="#soft_upgrade" title="3.4.1. ソフトアップグレード">soft upgrade</a>の手続きを行います。</p><p><span class="emphasis"><em>1.0.0RC6から1.0.2まで</em></span>のリリースからアップグレードする場合には、リリース 1.0.3にある<a class="link" href="#rel_1.0.3_upgrading" title="A.72. リリース 1.0.3">アップグレード</a>をご覧ください。</p><p>1.0.0RC6より前のリリースからのアップグレードは、<a class="link" href="#hard_upgrade" title="3.4.2. ハードアップグレード">ハードアップグレード</a>が必要です。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90273664"></a>誤り訂正/修正</h3></div></div></div><p>distance(ポリゴン, ポリゴン)で誤った結果となる誤り訂正</p><p>pgsql2shpの成功時の終了ステータスの誤り訂正。</p><p>shp2gpsqlにおけるマルチラインWKTの処理の誤り訂正</p><p>affine()でバウンディングボックス更新がある場合に失敗する誤り訂正</p><p>WKTパーサ: EMPTY要素を持つマルチ系ジオメトリの構築の禁止(GEOMETRYCOLLECTIONは対応)。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90276480"></a>新機能</h3></div></div></div><p>ロングトランザクション対応の新規追加。</p><p>DumpRings()関数の新規追加。</p><p>AsHEXEWKB(geom, XDR|NDR)関数の新規追加。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90278400"></a>JDBC変更</h3></div></div></div><p>回帰テストの改善: マルチポイントとXY以外の座標値</p><p>JDBCコードの小規模な訂正</p><p>全てのフィールドを今後非公開にする準備として適切なアクセサ関数の追加。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90280320"></a>他の変更</h3></div></div></div><p>ローダ/ダンパに対応する新しい回帰テスト。</p><p>コンフィギュアスイッチ--with-proj-libdirと--with-geos-libdirの追加</p><p>Tru64のビルドへの対応。</p><p>文書生成のためにJadeを使用。</p><p>pgsql2shpを求める以上のライブラリにリンクしないようにしました。</p><p>PostgreSQL 8.2への最初の対応。</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp90283520"></a>A.66. リリース 1.1.2</h2></div></div></div><p>リリース日: 2006/03/30</p><p>誤り訂正リリースで、新しい関数とポータビリティ強化を含みます。アップグレードは<span class="emphasis"><em>推奨されます</em></span>。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90285440"></a>アップグレード</h3></div></div></div><p>1.0.3以上からアップグレードする場合には、<a class="link" href="#soft_upgrade" title="3.4.1. ソフトアップグレード">soft upgrade</a>の手続きを行います。</p><p><span class="emphasis"><em>1.0.0RC6から1.0.2まで</em></span>のリリースからアップグレードする場合には、リリース 1.0.3にある<a class="link" href="#rel_1.0.3_upgrading" title="A.72. リリース 1.0.3">アップグレード</a>をご覧ください。</p><p>1.0.0RC6より前のリリースからのアップグレードは、<a class="link" href="#hard_upgrade" title="3.4.2. ハードアップグレード">ハードアップグレード</a>が必要です。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90289280"></a>誤り訂正</h3></div></div></div><p>SnapToGrid()内の出力バウンディングボックスの計算の誤り訂正</p><p>EnforceRHR()の誤り訂正</p><p>JDBC2のJTSコード内のSRID処理の訂正</p><p>64ビット対応の訂正</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90295680"></a>新機能</h3></div></div></div><p>回帰試験をPostGISのインストール*前に*実行できるようになりました</p><p>新しいafiine()行列変形関数</p><p>新しいrotate{,X,Y,Z}()関数</p><p>古い翻訳とaffine()を内部で使用している拡大縮小関数</p><p>pgsql 8.0.0以上に対するビルドで、estimated_extent()内にアクセス制御を埋め込みました</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90298368"></a>他の変更</h3></div></div></div><p>./configureスクリプトをよりポータブルにしました</p><p>./run_testスクリプトを、デフォルトの振る舞いがより健全になるよう変更しました。</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp90300032"></a>A.67. リリース 1.1.1</h2></div></div></div><p>リリース日: 2006/01/23</p><p>重要な誤り訂正リリースです。アップグレードを<span class="emphasis"><em>強くお勧めします</em></span>。前の版では、postgis_restore.plに<a class="link" href="#hard_upgrade" title="3.4.2. ハードアップグレード">ハードアップグレード</a>を阻害する誤りがあります。また、GEOS 2.2以上のコネクタで、ジオメトリコレクションのオブジェクトがトポロジ演算子で使われるのを阻害される誤りがあります。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90302336"></a>アップグレード</h3></div></div></div><p>1.0.3以上からアップグレードする場合には、<a class="link" href="#soft_upgrade" title="3.4.1. ソフトアップグレード">soft upgrade</a>の手続きを行います。</p><p><span class="emphasis"><em>1.0.0RC6から1.0.2まで</em></span>のリリースからアップグレードする場合には、リリース 1.0.3にある<a class="link" href="#rel_1.0.3_upgrading" title="A.72. リリース 1.0.3">アップグレード</a>をご覧ください。</p><p>1.0.0RC6より前のリリースからのアップグレードは、<a class="link" href="#hard_upgrade" title="3.4.2. ハードアップグレード">ハードアップグレード</a>が必要です。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90306176"></a>誤り訂正</h3></div></div></div><p>postgis_restore.plで早すぎるexitがある誤り訂正</p><p>GEOS-CAPIコネクタのジオメトリコレクションの処理に関する誤り訂正</p><p>Solaris 2.7とMingWへの対応を改善</p><p>line_locate_point()の誤り訂正</p><p>PostgreSQLのパスの処理を訂正</p><p>line_substring()の誤り訂正</p><p>回帰テストで局所化されたクラスタへの対応を追加</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90309760"></a>新機能</h3></div></div></div><p>line_substring()でZ値とM値の補間を新規追加</p><p>line_interpolate_point()でZ値とM値の補間を新規追加</p><p>OpenGISのあいまいさのためNumInteriorRing()の別名を追加</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp90311936"></a>A.68. リリース 1.1.0</h2></div></div></div><p>リリース日: 2005/12/21</p><p>多数の改善と新規追加が行われたマイナーリリースです。最も注意して頂きたいのは、ビルド手続きが非常に単純化したこと、transform()の速度が大幅に改善したこと、GEOSとの接続の安定化 (CAPI対応)、多数の新規関数、トポロジ対応の草案、です。</p><p>PostGISをインストールする前にGEOS-2.2.xにアップグレードすることを<span class="emphasis"><em>強くお勧めします</em></span>。これによって、将来のGEOSのアップグレードでPostGISライブラリの再構築が必要になることが無くなることが保証されます。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90314112"></a>貢献者</h3></div></div></div><p>このリリースには、Mark Cave Aylandさんからのproj4オブジェクトのキャッシュ機能のコードが含まれています。Markus Schaberさんは、JDBC2コードの多数の改善点を追加しました。Alex Bodnaruさんは、PostgreSQLソース依存の除去を助け、Debianのspecファイルを提供しました。Michael Fuhrさんは、Solarisアーキテクチャの新しい点をテストしました。David TecherさんとGerald Fenoyさんは、GEOS C言語APIコネクタの試験を助けました。Hartmut Tschaunerは、azimuth()関数のコードを提供しました。Devrim GUNDUZさんは、RPMのspecファイルを提供しました。Carl Andersonさんは、新しい面構築関数の作成を助けました。より多くの貢献者情報については<a class="link" href="#credits_other_contributors" title="1.4. 他の貢献者">他の貢献者</a>をご覧下さい。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90328064"></a>アップグレード</h3></div></div></div><p>1.0.3以降から更新する場合には、ダンプ/リロードは<span class="emphasis"><em>不要です</em></span>。全ての存在するデータベースで、新しいlwpostgis_upgrade.sqlスクリプトが単純に取り込まれます。詳細情報については<a class="link" href="#soft_upgrade" title="3.4.1. ソフトアップグレード">ソフトアップグレード</a>の章をご覧下さい。</p><p><span class="emphasis"><em>1.0.0RC6から1.0.2まで</em></span>のリリースからアップグレードする場合には、リリース 1.0.3にある<a class="link" href="#rel_1.0.3_upgrading" title="A.72. リリース 1.0.3">アップグレード</a>をご覧ください。</p><p>1.0.0RC6より前のリリースからのアップグレードは、<a class="link" href="#hard_upgrade" title="3.4.2. ハードアップグレード">ハードアップグレード</a>が必要です。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90332160"></a>新しい関数</h3></div></div></div><p>translate()が使用する関数scale()とtransscale()</p><p>line_substring()</p><p>line_locate_point()</p><p>M(point)</p><p>LineMerge(geometry)</p><p>shift_longitude(geometry)</p><p>azimuth(geometry)</p><p>locate_along_measure(geometry, float8)</p><p>locate_between_measures(geometry, float8, float8)</p><p>ポイントによるオフセットを行うSnapToGrid (4次元まで対応)</p><p>BuildArea(any_geometry)</p><p>OGC BdPolyFromText(linestring_wkt, srid)</p><p>OGC BdMPolyFromText(linestring_wkt, srid)</p><p>RemovePoint(linestring, offset)</p><p>ReplacePoint(linestring, offset, point)</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90338688"></a>誤り訂正</h3></div></div></div><p>polygonize()のメモリリークの誤り訂正</p><p>キャスト関数lwgeom_as_anytypeの誤り訂正</p><p>psotgis_version()の出力のUSE_GEOS, USE_PROJ , USE_STATS要素を常にライブラリの状態に合わせるよう誤り訂正</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90340608"></a>関数の内容の変更</h3></div></div></div><p>SnapToGridにおける高次元値を破棄しなくなりました</p><p>Z()関数を、Z値を持たない場合にNULLを返すよう変更</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90342144"></a>速度改善</h3></div></div></div><p>transform()関数の大幅な高速化、proj4オブジェクトのキャッシュ機能</p><p>AddGeometryColumns()とupdate_geometry_stats()からのfix_geometry_columns()の自動呼出しの削除</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90343680"></a>JDBC2での作業</h3></div></div></div><p>Mkaefileの改善</p><p>JTS対応の改善</p><p>回帰テストシステムの改善</p><p>ジオメトリコレクションの基本的な整合性検査メソッド</p><p>(HEX)(E)wkbへの対応</p><p>HexWKB / EWKT の切り替えのための自動検出機能DriverWrapper</p><p>古いJDKリリースのValueSetterで発生するコンパイルの誤り訂正。</p><p>EWKTコンストラクタを"SRID=4711;"といった表現を受け取れるよう誤り訂正</p><p>予備的な読み込み専用のJava2Dのジオメトリへの対応</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90347904"></a>他の新しいこと</h3></div></div></div><p>PostgreSQLソース依存を除去した完全なautoconfを用いたコンフィギュレーション</p><p>GEOS C-API対応 (2.2.0以上)</p><p>トポロジモデリングの最初の対応</p><p>DebianとRPMのspecファイル</p><p>lwpostgis_upgrade.sqlスクリプトの追加</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90350592"></a>他の変更</h3></div></div></div><p>JTS対応の改善</p><p>DBFとSQLの間における整数と文字列の属性の対応付けの厳格化</p><p>回帰テスト群の範囲拡大と見やすさ改善</p><p>古いjdbcコードはこの版で削除</p><p>postgis_proc_upgrade.plの直接の使用を廃止</p><p>スクリプトの版とリリースの版とを合わせました</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp90353792"></a>A.69. リリース 1.0.6</h2></div></div></div><p>リリース日: 2005/12/06</p><p>若干の誤り訂正と改善があります</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90355200"></a>アップグレード</h3></div></div></div><p>1.0.3以降から更新する場合には、ダンプ/リロードは<span class="emphasis"><em>不要です</em></span></p><p><span class="emphasis"><em>1.0.0RC6から1.0.2まで</em></span>のリリースからアップグレードする場合には、リリース 1.0.3にある<a class="link" href="#rel_1.0.3_upgrading" title="A.72. リリース 1.0.3">アップグレード</a>をご覧ください。</p><p>1.0.0RC6より前のリリースからのアップグレードは、<a class="link" href="#hard_upgrade" title="3.4.2. ハードアップグレード">ハードアップグレード</a>が必要です。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90358656"></a>誤り訂正</h3></div></div></div><p>コレクションのデシリアライザでpalloc(0)を呼ぶ誤り訂正 (--enable-cassertがある場合のみ)</p><p>バウンディングボックスキャッシュ処理の誤り訂正</p><p>geom_accum(NULL, NULL)のセグメンテーション違反の誤り訂正</p><p>addPoint()のセグメンテーション違反の誤り訂正</p><p>lwcollection_clone()の短時間メモリ確保の訂正</p><p>segmentize()の誤り訂正</p><p>SnapToGrid出力の固定バウンディングボックスの計算</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90362496"></a>改善</h3></div></div></div><p>PostgreSQL 8.2への最初の対応</p><p>GEOSオプションでSRID整合性検査が無かったのを追加</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp90364160"></a>A.70. リリース 1.0.5</h2></div></div></div><p>リリース日: 2005/11/25</p><p>ライブラリにおけるメモリのアラインメントの訂正、ローダのUTF8属性値の処理におけるセグメンテーション違反の訂正、若干の改善と整理を行っています。</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>shp2pgsqlのコードを以前の版からUNIX標準に適合する (成功時に0を返す)ように変更</p></td></tr></table></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90366336"></a>アップグレード</h3></div></div></div><p>1.0.3以降から更新する場合には、ダンプ/リロードは<span class="emphasis"><em>不要です</em></span></p><p><span class="emphasis"><em>1.0.0RC6から1.0.2まで</em></span>のリリースからアップグレードする場合には、リリース 1.0.3にある<a class="link" href="#rel_1.0.3_upgrading" title="A.72. リリース 1.0.3">アップグレード</a>をご覧ください。</p><p>1.0.0RC6より前のリリースからのアップグレードは、<a class="link" href="#hard_upgrade" title="3.4.2. ハードアップグレード">ハードアップグレード</a>が必要です。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90369792"></a>ライブラリの変更</h3></div></div></div><p>メモリのアラインメントの訂正</p><p>アナライザにおける少量のNULL値の計算の訂正</p><p>低水準関数getPoint4d_p()の小さな誤り訂正。</p><p>シリアライズ関数の速度向上</p><p>force_3dm(), force_3dz() およびorce_4d()における誤り訂正</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90372480"></a>ローダの変更</h3></div></div></div><p>shp2pgsqlの終了ステータスに関する誤り訂正</p><p>ローダの後方互換に関する誤りを訂正 (NULLシェープファイルのロード)</p><p>DBFの数値の属性値について最後にドットが付く場合の処理の誤りを訂正</p><p>shp2pgsql (utf8エンコーディング)でのセグメンテーション違反が出る誤りを訂正</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90374912"></a>他の変更</h3></div></div></div><p>スキーマ対応のpostgis_proc_upgrade.pl、PostgreSQL 7.2以上に対応</p><p>マニュアルに「問題を報告する 」の章を追加</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp90376576"></a>A.71. リリース 1.0.4</h2></div></div></div><p>リリース日: 2005/09/09</p><p>重大な誤り訂正と若干の改善があります。特に、大きな地理空間テーブルでのGiSTインデックスの構築で起こるメモリリークを訂正しています。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90377984"></a>アップグレード</h3></div></div></div><p>1.0.3から更新する場合には、ダンプ/リロードは<span class="emphasis"><em>不要です</em></span></p><p><span class="emphasis"><em>1.0.0RC6から1.0.2まで</em></span>のリリースからアップグレードする場合には、リリース 1.0.3にある<a class="link" href="#rel_1.0.3_upgrading" title="A.72. リリース 1.0.3">アップグレード</a>をご覧ください。</p><p>1.0.0RC6より前のリリースからのアップグレードは、<a class="link" href="#hard_upgrade" title="3.4.2. ハードアップグレード">ハードアップグレード</a>が必要です。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90381568"></a>誤り訂正</h3></div></div></div><p>GiSTインデックスのメモリリーク</p><p>proj4のtransform()処理でのセグメンテーション違反の誤り訂正</p><p>spatial_ref_sysのproj4の誤り訂正 (+projが無かった)</p><p>ローダ: 文字列関数の使用の訂正、NULLオブジェクトチェックの改定、MULTILINESTRING入力でのセグメンテーション違反になる誤りの訂正。</p><p>MakeLineの次元処理に関する誤り訂正</p><p>translate()で出力バウンディングボックスが壊れることに関する誤り訂正</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90384768"></a>改善</h3></div></div></div><p>文書の改善</p><p>選択度推測器の堅牢性向上</p><p>distance()の少しの速度向上</p><p>小規模な整理</p><p>GiSTインデックスの整理</p><p>BOX3Dパーサでより緩い構文を受け付けるようにしました</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="rel_1.0.3_upgrading"></a>A.72. リリース 1.0.3</h2></div></div></div><p>リリース日: 2005/08/08</p><p>いくつかの誤り訂正 - <span class="emphasis"><em>格納されているジオメトリの正しさに厳しい影響を与えるものを含みます</em></span> - および若干の改善。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90389888"></a>アップグレード</h3></div></div></div><p>バウンディングボックスの計算ルーティンの誤りのため、データベースにキャッシュされているバウンディングボックスが正しくない可能性があり、アップグレード手続きでは特別な注意が必要となりました。</p><p><a class="link" href="#hard_upgrade" title="3.4.2. ハードアップグレード">ハードアップグレード</a>手続き (ダンプ/リロード)によって、全てのバウンディングボックス (ダンプ内にない)の再計算が強制的に行われます。これは、1.0.0RC6より前のリリースからのアップグレードには<span class="emphasis"><em>必要です</em></span>。</p><p>1.0.0RC6以上からアップグレードする場合には、このリリースには、ジオメトリのバウンディングボックスの再計算と、その結果として発生する変更を伝播させる全ての処理を強制するPerlスクリプト(utils/rebuild_bbox_caches.pl)を持っています。インストール後にこのスクリプトを実行します (引数無しで走らせるとヘルプが出ます)。もしくは、utils/postgis_proc_upgrade.pを実行して、PostGISのプロシージャと関数を更新します (<a class="link" href="#soft_upgrade" title="3.4.1. ソフトアップグレード">ソフトアップグレード</a>を参照して下さい)。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90393088"></a>誤り訂正</h3></div></div></div><p>lwgeomの2次元バンディングボックス計算の厳しい誤り訂正</p><p>ローダのWKT (-w)ポイント処理の誤り訂正</p><p>64ビット機のダンパの誤り訂正</p><p>ユーザ定義クエリの処理を行うダンパの誤り訂正</p><p>create_undef.plスクリプトの誤り訂正</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90395776"></a>改善</h3></div></div></div><p>カノニカル入力関数の少しの能率改善</p><p>ローダの小規模な整理</p><p>ローダの多バイト文字によるフィールド名への対応</p><p>postgis_restore.plスクリプトの改善</p><p>ユーティリティスクリプトrebuild_bbox_caches.plの再構築</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp90419072"></a>A.73. リリース 1.0.2</h2></div></div></div><p>リリース日: 2005/07/04</p><p>若干の誤り訂正と改善があります</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90420480"></a>アップグレード</h3></div></div></div><p>1.0.0RC6から更新する場合には、ダンプ/リロードは<span class="emphasis"><em>不要です</em></span></p><p>前のリリースからアップグレードするにはダンプ/リロードが必要です。詳細については<a class="link" href="#upgrading" title="3.4. 空間データベースのアップグレード">アップグレード</a>をご覧下さい。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90422912"></a>誤り訂正</h3></div></div></div><p>B木オプションの誤り許容</p><p>pg_errorでのメモリリーク</p><p>R木インデックスの訂正</p><p>ビルドスクリプトの整理 (CFLAGSとCXXFLAGSの混在の回避)</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90425216"></a>改善</h3></div></div></div><p>ローダにおける新しいインデックス生成機能 (-lスイッチ)</p><p>PostgreSQL 8.1devへの最初の対応</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp90426880"></a>A.74. リリース 1.0.1</h2></div></div></div><p>リリース日: 2005/05/24</p><p>若干の誤り訂正といくつかの改善があります。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90428288"></a>アップグレード</h3></div></div></div><p>1.0.0RC6から更新する場合には、ダンプ/リロードは<span class="emphasis"><em>不要です</em></span></p><p>前のリリースからアップグレードするにはダンプ/リロードが必要です。詳細については<a class="link" href="#upgrading" title="3.4. 空間データベースのアップグレード">アップグレード</a>をご覧下さい。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90430720"></a>ライブラリの変更</h3></div></div></div><p>length_spheroid()の3次元計算の誤り訂正</p><p>JOIN選択推定器の誤り訂正</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90432256"></a>他の変更追加</h3></div></div></div><p>shp2pgsqlのエスケープ関数の誤り訂正</p><p>複数スキーマで同時発生するPostGISに対するより良い対応</p><p>文書の訂正</p><p>jdbc2: コンパイル時に"-target 1.2 -source 1.2"をデフォルトとするよう変更</p><p>pgsql2shpの-kスイッチの追加</p><p>postgis_restore.plの独自のcreatedへの対応</p><p>pgsql2shp属性名の一意性強制の誤り訂正</p><p>NTF (Paris)の投影定義の誤り訂正</p><p>postgis_restore.plの整理</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp90440704"></a>A.75. リリース 1.0.0</h2></div></div></div><p>リリース日: 2005/04/19</p><p>最後の1.0.0リリースです。若干の誤り訂正、ローダのいくつかの改良 (古いPostGISへの対応が特筆すべき点)、文書の追加がありました。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90442112"></a>アップグレード</h3></div></div></div><p>1.0.0RC6から更新する場合には、ダンプ/リロードは<span class="emphasis"><em>不要です</em></span></p><p>前のリリースからアップグレードするにはダンプ/リロードが必要です。詳細については<a class="link" href="#upgrading" title="3.4. 空間データベースのアップグレード">アップグレード</a>をご覧下さい。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90444544"></a>ライブラリの変更</h3></div></div></div><p>transform()が不規則なメモリアドレスを解放する問題を訂正</p><p>force_3dm()のメモリ確保が必要より小さい問題を訂正</p><p>JOIN選択度見積もりの誤り (デフォルト値、メモリリーク、行カウント、SD)訂正</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90446464"></a>他の変更追加</h3></div></div></div><p>shp2pgsqlがタブまたはシングルクォートで始まる値を読み飛ばす誤りを訂正</p><p>マニュアルへのローダ/ダンパの追加</p><p>古い (HWGEOM)PostGISに対応するshp2gsql</p><p>shp2pgsqlのフラグに -p (prepare)を追加</p><p>マニュアルにOGC互換の強制に関する新章追加</p><p>JTSライブラリに対応する新しいautoconf</p><p>推測器のテストの誤り訂正 (LWGEOMとスキーマの構文解析への対応)</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp90450048"></a>A.76. リリース 1.0.0RC6</h2></div></div></div><p>リリース日: 2005/03/30</p><p>1.0.0の6番目のリリース候補、若干の誤り訂正と整理を行っています。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90451456"></a>アップグレード</h3></div></div></div><p>前のリリースからアップグレードするにはダンプ/リロードが必要です。詳細については<a class="link" href="#upgrading" title="3.4. 空間データベースのアップグレード">アップグレード</a>をご覧下さい。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90453248"></a>ライブラリの変更</h3></div></div></div><p>multi()の誤り訂正</p><p>noop時にmulti()からの早い復帰</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90454784"></a>スクリプトの変更</h3></div></div></div><p>{x,y}{min,max}(box2d)関数の削除</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90455936"></a>他の変更</h3></div></div></div><p>postgis_restore.plスクリプトの誤り訂正</p><p>64ビット対応のダンパの誤り訂正</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp90457600"></a>A.77. リリース 1.0.0RC5</h2></div></div></div><p>リリース日: 2005/03/25</p><p>1.0.0の5番目のリリース候補、若干の誤り訂正と改善があります</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90459008"></a>アップグレード</h3></div></div></div><p>1.0.0RC4から更新する場合には、ダンプ/リロードは<span class="emphasis"><em>不要です</em></span></p><p>前のリリースからアップグレードするにはダンプ/リロードが必要です。詳細については<a class="link" href="#upgrading" title="3.4. 空間データベースのアップグレード">アップグレード</a>をご覧下さい。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90461440"></a>ライブラリの変更</h3></div></div></div><p>box3d計算の問題 (セグメンテーションフォールト)の訂正 (ほかにもあります)</p><p>estimated_extent()でのセグメンテーションフォールトの訂正</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90462976"></a>他の変更</h3></div></div></div><p>ビルドスクリプトとユーティリティの若干の改良</p><p>性能向上に関する技法の文章の追加</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp90464640"></a>A.78. リリース 1.0.0RC4</h2></div></div></div><p>リリース日: 2005/03/18</p><p>1.0.0の4番目のリリース候補、誤り訂正と若干の改善があります</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90466048"></a>アップグレード</h3></div></div></div><p>前のリリースからアップグレードするにはダンプ/リロードが必要です。詳細については<a class="link" href="#upgrading" title="3.4. 空間データベースのアップグレード">アップグレード</a>をご覧下さい。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90467840"></a>ライブラリの変更</h3></div></div></div><p>geom_accum()のセグメンテーションフォールトの誤り訂正</p><p>64ビットアーキテクチャ対応の誤り訂正</p><p>コレクションを引数に取るbox3d計算関数の誤りの訂正</p><p>副問い合わせの選択度推定への対応</p><p>force_collectionからの早い復帰</p><p>SnapToGrid()の一貫性検査の訂正</p><p>Box2d出力精度を15桁に後退</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90471296"></a>スクリプトの変更</h3></div></div></div><p>distance_sphere()の追加</p><p>get_proj4_from_sridの実装をSQLからPL/pgSQLに変更</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90472960"></a>他の変更</h3></div></div></div><p>ローダとダンパのMULTOLINEシェープの処理の問題を訂正</p><p>ローダでポリゴンの最初の穴を読み飛ばす誤りを訂正。</p><p>jdbc2: コードの整理、Makefileの改善</p><p>FLEX変数とYACC変数がpgsqlのMakefile.globalが取り込まれた*後*で、pgsqlの*空白を除いた*ものが空文字列と評価された場合に限って設定される</p><p>既に作成されていたパーサの追加</p><p>ビルドスクリプトの改良</p><p>Version.configの改善を中心とした版処理の改善</p><p>postgis_restore.plの改善</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp90477056"></a>A.79. リリース 1.0.0RC3</h2></div></div></div><p>リリース日: 2005/02/24</p><p>1.0.0の3番目のリリース候補、多数の誤り訂正と改善があります。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90478464"></a>アップグレード</h3></div></div></div><p>前のリリースからアップグレードするにはダンプ/リロードが必要です。詳細については<a class="link" href="#upgrading" title="3.4. 空間データベースのアップグレード">アップグレード</a>をご覧下さい。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89300608"></a>ライブラリの変更</h3></div></div></div><p>transform()でSRIDが消える問題を訂正、エラー処理を改善。</p><p>メモリアラインメントのハンドリングに関する誤り訂正</p><p>force_collection()で単純な (単一)ジオメトリ型でMapServerの接続が切れる問題を訂正。</p><p>GeometryFromText()でbboxキャッシュを追加しない誤り訂正。</p><p>box2d出力の精度低下。</p><p>pgsqlで異常終了する問題を避けるため、DEBUGマクロにPGIS_の前置辞を付加</p><p>GEOS2POSTGISコンバータのリークを訂正</p><p>pallocで確保したクエリコンテキストのメモリを早く開放することによるメモリ使用の削減</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90480000"></a>スクリプトの変更</h3></div></div></div><p>PostgreSQL 7.2のインデックスのバインディングを訂正しました。</p><p>PG72での動作と、1テーブルに複数カラムの場合への対応のため、probe_geometry_columns()の誤り訂正</p><p>boolからtextへのキャストの更新</p><p>動作効率改善のため、いくつかの関数をSTABLEからIMMUTABLEに変更</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90482304"></a>JDBC変更</h3></div></div></div><p>jdbc2: 小さなパッチ、box2d/box3dの試験、文書とライセンスの改定</p><p>jdbc2: pgjdbc 8.0の型の自動登録の誤り訂正とテストケース作成</p><p>jdbc2: 古いjdkリリースでの構築を有効にするためためにjdk1.4使用箇所の削除</p><p>jdbc2: pg72jdbc2.jarに対するビルドへの対応の追加</p><p>jdbc2: Makefileの更新と無駄の除去</p><p>jdbc2: JTSジオメトリクラス対応のベータ版を追加</p><p>jdbc2: 古いPostGISサーバに対して失敗するのが判明しているテストをスキップするようにしました。</p><p>jdbc2: EWKTのM値を持つジオメトリの処理の訂正</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90486400"></a>他の変更</h3></div></div></div><p>性能向上に関する技法の新章追加</p><p>ドキュメント更新: pgsql72に必要なもの、lwpostgis.sql</p><p>autoconfの若干の変更</p><p>BUILDDATE抽出の移植可能範囲を広げました</p><p>spatial_ref_sys.sqlを訂正してvacuumが全体のデータベースに及ぶのを避けるようにしました。</p><p>spatial_ref_sys: NTF (Paris)を0.xで配布していたものに合うよう変更。</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp90489600"></a>A.80. リリース 1.0.0RC2</h2></div></div></div><p>リリース日: 2005/01/26</p><p>1.0.0の第2リリース候補版。誤り訂正と若干の改善。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90491008"></a>アップグレード</h3></div></div></div><p>前のリリースからアップグレードするにはダンプ/リロードが必要です。詳細については<a class="link" href="#upgrading" title="3.4. 空間データベースのアップグレード">アップグレード</a>をご覧下さい。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp90492800"></a>ライブラリの変更</h3></div></div></div><p>ポイント配列からのbox3d計算に関する誤り訂正</p><p>distance_spheroid定義に関する誤り訂正</p><p>bboxキャッシュ更新がtransform()無かったことに関する誤り訂正</p><p>新しいJDBCドライバ (jdbc2)</p><p>後方互換のためのGEOMETRYCOLLECTION(EMPTY)書式への対応</p><p>バイナリ出力の高速化</p><p>OGC WKB/WKTコンストラクタの厳格化</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89255168"></a>スクリプトの変更</h3></div></div></div><p>lwpostgis.sql内でのSTABLE, IMMUTABLE, STRICTの訂正</p><p>OGC WKB/WKTコンストラクタの厳格化</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89256832"></a>他の変更</h3></div></div></div><p>ローダ (i18n、非i18nの両方)の高速化と堅牢化</p><p>最初のautoconfスクリプト</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp89258496"></a>A.81. リリース 1.0.0RC1</h2></div></div></div><p>リリース日: 2005/01/13</p><p>最初のPostGISメジャーリリース候補版。格納領域の低減とインデックス使用クエリの高速化のためのPostGIS型の内部格納の再設計。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89259904"></a>アップグレード</h3></div></div></div><p>前のリリースからアップグレードするにはダンプ/リロードが必要です。詳細については<a class="link" href="#upgrading" title="3.4. 空間データベースのアップグレード">アップグレード</a>をご覧下さい。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp89261696"></a>変更</h3></div></div></div><p>標準形式入力パースの高速化。</p><p>標準形式出力の可逆化。</p><p>PostgreSQL 7.3以上でのEWKBの標準形式バイナリ入出力対応。</p><p>4次元座標以上の対応、可逆shapefile-&gt;postgis-&gt;shapefile変換。</p><p>新関数: UpdateGeometrySRID(), AsGML(), SnapToGrid(), ForceRHR(), estimated_extent(), accum().</p><p>垂直方向位置インデックス演算子。</p><p>JOIN選択関数。</p><p>ジオメトリコンストラクタとエディタの強化。</p><p>PostGISエクステンションAPI。</p><p>ローダのUTF-8対応。</p></div></div></div></div></body></html>
