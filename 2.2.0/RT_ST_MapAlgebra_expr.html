<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>ST_MapAlgebra</title><link rel="stylesheet" type="text/css" href="style.css"><meta name="generator" content="DocBook XSL Stylesheets V1.76.1"><link rel="home" href="index.html" title="PostGIS 2.2.0devマニュアル日本語訳"><link rel="up" href="RT_reference.html#Raster_Processing_MapAlgebra" title="9.11.1. 地図代数"><link rel="prev" href="RT_ST_MapAlgebra.html" title="ST_MapAlgebra"><link rel="next" href="RT_ST_MapAlgebraExpr.html" title="ST_MapAlgebraExpr"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">ST_MapAlgebra</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="RT_ST_MapAlgebra.html">戻る</a> </td><th width="60%" align="center">9.11.1. 地図代数</th><td width="20%" align="right"> <a accesskey="n" href="RT_ST_MapAlgebraExpr.html">次へ</a></td></tr></table><hr></div><div class="refentry" title="ST_MapAlgebra"><a name="RT_ST_MapAlgebra_expr"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MapAlgebra — 数式版 - ひとつ以上の入力ラスタ、バンド番号、ひとつ以上のユーザ定義SQL式からひとつのバンドを持つラスタを返します。 </p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebra</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, text  <var class="pdparam">pixeltype</var>, text  <var class="pdparam">expression</var>, double precision  <var class="pdparam">nodataval=NULL</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebra</b>(</code>raster  <var class="pdparam">rast</var>, text  <var class="pdparam">pixeltype</var>, text  <var class="pdparam">expression</var>, double precision  <var class="pdparam">nodataval=NULL</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebra</b>(</code>raster  <var class="pdparam">rast1</var>, integer  <var class="pdparam">nband1</var>, raster  <var class="pdparam">rast2</var>, integer  <var class="pdparam">nband2</var>, text  <var class="pdparam">expression</var>, text  <var class="pdparam">pixeltype=NULL</var>, text  <var class="pdparam">extenttype=INTERSECTION</var>, text  <var class="pdparam">nodata1expr=NULL</var>, text  <var class="pdparam">nodata2expr=NULL</var>, double precision  <var class="pdparam">nodatanodataval=NULL</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebra</b>(</code>raster  <var class="pdparam">rast1</var>, raster  <var class="pdparam">rast2</var>, text  <var class="pdparam">expression</var>, text  <var class="pdparam">pixeltype=NULL</var>, text  <var class="pdparam">extenttype=INTERSECTION</var>, text  <var class="pdparam">nodata1expr=NULL</var>, text  <var class="pdparam">nodata2expr=NULL</var>, double precision  <var class="pdparam">nodatanodataval=NULL</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="idp90093520"></a><h2>説明</h2><p>数式版 - ひとつ以上の入力ラスタ、バンド番号、ひとつ以上のユーザ定義SQL式からひとつのバンドを持つラスタを返します。 </p><p>初出: 2.1.0</p></div><div class="refsection" title="説明: 1番目の形式と2番目の形式(ひとつのラスタ)"><a name="idp90095056"></a><h2>説明: 1番目の形式と2番目の形式(ひとつのラスタ)</h2><p><code class="varname">expression</code>で定義された妥当なPostgreSQL代数演算を入力ラスタ(<code class="varname">rast</code>)に適用して、バンドひとつのラスタを生成します。<code class="varname">nband</code>が指定されない場合には、1番バンドと仮定します。新しいラスタは、元のラスタと同じ地理参照、幅、高さになりますが、バンドはひとつだけとなります。 </p><p><code class="varname">pixeltype</code>が渡された場合には、新しいラスタのバンドは、そのピクセルタイプになります。pixeltypeにNULLが渡された場合には、新しいラスタは入力<code class="varname">rast</code>のバンドのピクセルタイプと同じになります。 </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><code class="varname">expression</code>のキーワードは次の通りです。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><code class="varname">[rast]</code> - 演算対象ピクセルの値</p></li><li class="listitem"><p><code class="varname">[rast.val]</code> - 演算対象ピクセルの値</p></li><li class="listitem"><p><code class="varname">[rast.x]</code> - 演算対象ピクセルの列(1始まり)</p></li><li class="listitem"><p><code class="varname">[rast.y]</code> - 演算対象ピクセルの行(1始まり)</p></li></ol></div></li></ul></div></div><div class="refsection" title="説明: 3番目と4番目の形式(ふたつのラスタ)"><a name="idp90104400"></a><h2>説明: 3番目と4番目の形式(ふたつのラスタ)</h2><p><code class="varname">expression</code>で定義された妥当なふたつのバンドへのPostgreSQL代数演算を入力ラスタ(<code class="varname">rast1</code>, <code class="varname">rast2</code>)に適用して、バンドひとつのラスタを生成します。<code class="varname">nband1</code>, <code class="varname">nband2</code>が指定されない場合には、1番バンドと仮定します。新しいラスタは、ひとつめのラスタと同じアラインメント(スケール、スキュー、ピクセル隅)を持ちます。新しいラスタは、<code class="varname">extenttype</code>引数で定義される範囲になります。 </p><div class="variablelist"><dl><dt><span class="term">expression</span></dt><dd><p>ふたつのラスタとPostgreSQL定義済み関数/演算子を含むPostgreSQL代数式です。関数と演算子は、ふたつのピクセルがインタセクトするピクセルの値を定めます。たとえば(([rast1] + [rast2])/2.0)::integerといったふうになります。 </p></dd><dt><span class="term">pixeltype</span></dt><dd><p>出力ラスタのピクセルタイプです。必ず<a class="xref" href="RT_ST_BandPixelType.html" title="ST_BandPixelType">ST_BandPixelType</a>に挙げられたもののひとつになるか、省略されるか、NULLに設定されます。引数として渡されないかNULLが渡された場合には、ひとつめのラスタのピクセルタイプになります。 </p></dd><dt><span class="term">extenttype</span></dt><dd><p>新しいラスタの範囲を制御します。 </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><code class="varname">INTERSECTION</code> - 新しいラスタの範囲はふたつのラスタのインタセクトした領域です。これがデフォルトです。 </p></li><li class="listitem"><p><code class="varname">UNION</code> - 新しいラスタの範囲はふたつのラスタの結合です。 </p></li><li class="listitem"><p><code class="varname">SECOND</code> - 新しいラスタの範囲はひとつめのラスタと同じです。 </p></li><li class="listitem"><p><code class="varname">SECOND</code> - 新しいラスタの範囲はふたつめのラスタと同じです。 </p></li></ol></div></dd><dt><span class="term">nodata1expr</span></dt><dd><p><code class="varname">rast1</code>がNODATA値で、特にrast2ピクセルに値がある時に、<code class="varname">rast2</code>だけを返すか返すべき値を定義する定数を含む第数式です。 </p></dd><dt><span class="term">nodata2expr</span></dt><dd><p><code class="varname">rast２</code>がNODATA値で、特にrast2ピクセルに値がある時に、<code class="varname">rast</code>だけを返すか返すべき値を定義する定数を含む第数式です。 </p></dd><dt><span class="term">nodatanodataval</span></dt><dd><p>rast1とrast2のピクセルの両方がNOADTA値になる場合に返すべき定数です。 </p></dd></dl></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><code class="varname">expression</code>, <code class="varname">nodata1expr</code> and <code class="varname">nodata2expr</code>のキーワードは次の通りです。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><code class="varname">[rast1]</code> - <code class="varname">rast1</code>の演算対象ピクセルの値</p></li><li class="listitem"><p><code class="varname">[rast1.val]</code> - <code class="varname">rast1</code>の演算対象ピクセルの値</p></li><li class="listitem"><p><code class="varname">[rast1.x]</code> - <code class="varname">rast1</code>の演算対象ピクセルの列(1始まり)</p></li><li class="listitem"><p><code class="varname">[rast1.y]</code> - <code class="varname">rast1</code>の演算対象ピクセルの行(1始まり)</p></li><li class="listitem"><p><code class="varname">[rast2]</code> - <code class="varname">rast2</code>の演算対象ピクセルの値</p></li><li class="listitem"><p><code class="varname">[rast2.val]</code> - <code class="varname">rast2</code>の演算対象ピクセルの値</p></li><li class="listitem"><p><code class="varname">[rast2.x]</code> - <code class="varname">rast2</code>の演算対象ピクセルの列(1始まり)</p></li><li class="listitem"><p><code class="varname">[rast2.y]</code> - <code class="varname">rast2</code>の演算対象ピクセルの行(1始まり)</p></li></ol></div></li></ul></div></div><div class="refsection" title="例: 1番目の形式と2番目の形式"><a name="idp90138192"></a><h2>例: 1番目の形式と2番目の形式</h2><pre class="programlisting">WITH foo AS (
        SELECT ST_AddBand(ST_MakeEmptyRaster(10, 10, 0, 0, 1, 1, 0, 0, 0), '32BF', 1, -1) AS rast
)
SELECT
        ST_MapAlgebra(rast, 1, NULL, 'ceil([rast]*[rast.x]/[rast.y]+[rast.val])')
FROM foo
                                        </pre></div><div class="refsection" title="例: 3番目の形式と4番目の形式"><a name="idp90139472"></a><h2>例: 3番目の形式と4番目の形式</h2><pre class="programlisting">WITH foo AS (
        SELECT 1 AS rid, ST_AddBand(ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(2, 2, 0, 0, 1, -1, 0, 0, 0), 1, '16BUI', 1, 0), 2, '8BUI', 10, 0), 3, '32BUI', 100, 0) AS rast UNION ALL
        SELECT 2 AS rid, ST_AddBand(ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(2, 2, 0, 1, 1, -1, 0, 0, 0), 1, '16BUI', 2, 0), 2, '8BUI', 20, 0), 3, '32BUI', 300, 0) AS rast
)
SELECT
        ST_MapAlgebra(
                t1.rast, 2,
                t2.rast, 1,
                '([rast2] + [rast1.val]) / 2'
        ) AS rast
FROM foo t1
CROSS JOIN foo t2
WHERE t1.rid = 1
        AND t2.rid = 2
                                        </pre></div><div class="refsection" title="関連情報"><a name="idp90140752"></a><h2>関連情報</h2><p><a class="xref" href="rastbandarg.html" title="rastbandarg">rastbandarg</a>, <a class="xref" href="RT_ST_Union.html" title="ST_Union">ST_Union</a>, <a class="xref" href="RT_ST_MapAlgebra.html" title="ST_MapAlgebra">ST_MapAlgebra</a> </p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="RT_ST_MapAlgebra.html">戻る</a> </td><td width="20%" align="center"><a accesskey="u" href="RT_reference.html#Raster_Processing_MapAlgebra">上に戻る</a></td><td width="40%" align="right"> <a accesskey="n" href="RT_ST_MapAlgebraExpr.html">次へ</a></td></tr><tr><td width="40%" align="left" valign="top">ST_MapAlgebra </td><td width="20%" align="center"><a accesskey="h" href="index.html">ホーム</a></td><td width="40%" align="right" valign="top"> ST_MapAlgebraExpr</td></tr></table></div></body></html>
