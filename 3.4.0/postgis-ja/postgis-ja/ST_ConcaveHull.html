<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>ST_ConcaveHull</title><link rel="stylesheet" type="text/css" href="docbook.css"><link rel="stylesheet" type="text/css" href="../style.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><link rel="home" href="index.html" title="PostGIS 3.4.0 マニュアル"><link rel="up" href="reference.html#Geometry_Processing" title="7.14. ジオメトリ処理関数"><link rel="prev" href="ST_ChaikinSmoothing.html" title="ST_ChaikinSmoothing"><link rel="next" href="ST_ConvexHull.html" title="ST_ConvexHull"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">ST_ConcaveHull</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ST_ChaikinSmoothing.html">戻る</a> </td><th width="60%" align="center">7.14. ジオメトリ処理関数</th><td width="20%" align="right"> <a accesskey="n" href="ST_ConvexHull.html">次へ</a></td></tr></table></div><div class="refentry"><a name="ST_ConcaveHull"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ConcaveHull — 全ての入力ジオメトリの頂点を含む凹ジオメトリを計算します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_ConcaveHull</b>(</code>geometry  <var class="pdparam">param_geom</var>, float  <var class="pdparam">param_pctconvex</var>, boolean  <var class="pdparam">param_allow_holes = false</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp259305760"></a><h2>説明</h2><p>凹包は (通常は)入力ジオメトリを包含する凹ジオメトリで、凹ジオメトリの頂点は入力頂点の部分集合です。一般的に凹包はポリゴンです。二つ以上の同一線上の点の凹包は2点のラインストリングです。一つ以上の同一点の凹包はポイントです。 <code class="varname">param_allow_holes</code>引数ににTRUEを与えない限りポリゴンは穴を持ちません。 </p><p>凹包はジオメトリの集合を「真空パック」したジオメトリと考えることができます。輪ゴムで囲うのに似ている<a class="link" href="ST_ConvexHull.html" title="ST_ConvexHull">凸包</a>と違います。凹包は一般的に面積が小さく、また入力ポイントからなる境界が自然になります。 </p><p><code class="varname">param_pctconvex</code>は計算される凹包の凹度を制御するためのものです。1では凸包になります。1から0に変化させると凹度が増加していきます。0では最大の凹度の凹包になります (ただし単一ポリゴンのままです)。適切な値は入力データ固有のものですが、多くの場合0.3と0.1の間が適正な結果となります。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="../images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>技術的には<code class="varname">param_pctconvex</code>は、入力ポイントのドロネー三角分割における最長エッジと最短エッジとの差の割合で示される長さを決定します。この長さより長いエッジは、三角分割で「浸食」されます。残りの三角形は凹包を形成します。 </p></td></tr></table></div><p>ポイントとラインの入力では、凹包は入力ポイントをポイントとラインの入力では、凹包は全ての入力ポイントを包みます。ポリゴン入力では、凹包は全ての入力ポイントを含み、<span class="emphasis"><em>なおかつ</em></span>入力ポリゴンが及ぶ全ての面を含みます。ポリゴン入力でもポイントとして計算した凹包が欲しい場合には、<a class="xref" href="ST_Points.html" title="ST_Points">ST_Points</a>を使って、まずポイントに変換して下さい。</p><p>これは集約関数ではありません。ジオメトリ集合の凹包の計算には<a class="xref" href="ST_Collect.html" title="ST_Collect">ST_Collect</a>を使います (例 <code class="code">ST_ConcaveHull( ST_Collect( geom ), 0.80)</code>)。</p><p class="availability">Availability: 2.0.0</p><p class="enhanced">Enhanced: 3.3.0, GEOS 3.11からGEOSネイティブ実装が有効になりました</p></div><div class="refsection"><a name="idp259313312"></a><h2>例</h2><p>
    </p><div class="informalfigure"><div class="mediaobject"><img src="../images/st_concavehull01.png"><div class="caption"><p>マルチポイントの凹包</p></div></div></div><p>
    </p><pre class="programlisting">SELECT ST_AsText( ST_ConcaveHull(
        'MULTIPOINT ((10 72), (53 76), (56 66), (63 58), (71 51), (81 48), (91 46), (101 45), (111 46), (121 47), (131 50), (140 55), (145 64), (144 74), (135 80), (125 83), (115 85), (105 87), (95 89), (85 91), (75 93), (65 95), (55 98), (45 102), (37 107), (29 114), (22 122), (19 132), (18 142), (21 151), (27 160), (35 167), (44 172), (54 175), (64 178), (74 180), (84 181), (94 181), (104 181), (114 181), (124 181), (134 179), (144 177), (153 173), (162 168), (171 162), (177 154), (182 145), (184 135), (139 132), (136 142), (128 149), (119 153), (109 155), (99 155), (89 155), (79 153), (69 150), (61 144), (63 134), (72 128), (82 125), (92 123), (102 121), (112 119), (122 118), (132 116), (142 113), (151 110), (161 106), (170 102), (178 96), (185 88), (189 78), (190 68), (189 58), (185 49), (179 41), (171 34), (162 29), (153 25), (143 23), (133 21), (123 19), (113 19), (102 19), (92 19), (82 19), (72 21), (62 22), (52 25), (43 29), (33 34), (25 41), (19 49), (14 58), (21 73), (31 74), (42 74), (173 134), (161 134), (150 133), (97 104), (52 117), (157 156), (94 171), (112 106), (169 73), (58 165), (149 40), (70 33), (147 157), (48 153), (140 96), (47 129), (173 55), (144 86), (159 67), (150 146), (38 136), (111 170), (124 94), (26 59), (60 41), (71 162), (41 64), (88 110), (122 34), (151 97), (157 56), (39 146), (88 33), (159 45), (47 56), (138 40), (129 165), (33 48), (106 31), (169 147), (37 122), (71 109), (163 89), (37 156), (82 170), (180 72), (29 142), (46 41), (59 155), (124 106), (157 80), (175 82), (56 50), (62 116), (113 95), (144 167))',
         0.1 ) );
---st_astext--
POLYGON ((18 142, 21 151, 27 160, 35 167, 44 172, 54 175, 64 178, 74 180, 84 181, 94 181, 104 181, 114 181, 124 181, 134 179, 144 177, 153 173, 162 168, 171 162, 177 154, 182 145, 184 135, 173 134, 161 134, 150 133, 139 132, 136 142, 128 149, 119 153, 109 155, 99 155, 89 155, 79 153, 69 150, 61 144, 63 134, 72 128, 82 125, 92 123, 102 121, 112 119, 122 118, 132 116, 142 113, 151 110, 161 106, 170 102, 178 96, 185 88, 189 78, 190 68, 189 58, 185 49, 179 41, 171 34, 162 29, 153 25, 143 23, 133 21, 123 19, 113 19, 102 19, 92 19, 82 19, 72 21, 62 22, 52 25, 43 29, 33 34, 25 41, 19 49, 14 58, 10 72, 21 73, 31 74, 42 74, 53 76, 56 66, 63 58, 71 51, 81 48, 91 46, 101 45, 111 46, 121 47, 131 50, 140 55, 145 64, 144 74, 135 80, 125 83, 115 85, 105 87, 95 89, 85 91, 75 93, 65 95, 55 98, 45 102, 37 107, 29 114, 22 122, 19 132, 18 142))
    </pre><p>
</p><p>
    </p><div class="informalfigure"><div class="mediaobject"><img src="../images/st_concavehull02.png"><div class="caption"><p>穴を作れるマルチポイントの凹包</p></div></div></div><p>
    </p><pre class="programlisting">SELECT ST_AsText( ST_ConcaveHull(
        'MULTIPOINT ((132 64), (114 64), (99 64), (81 64), (63 64), (57 49), (52 36), (46 20), (37 20), (26 20), (32 36), (39 55), (43 69), (50 84), (57 100), (63 118), (68 133), (74 149), (81 164), (88 180), (101 180), (112 180), (119 164), (126 149), (132 131), (139 113), (143 100), (150 84), (157 69), (163 51), (168 36), (174 20), (163 20), (150 20), (143 36), (139 49), (132 64), (99 151), (92 138), (88 124), (81 109), (74 93), (70 82), (83 82), (99 82), (112 82), (126 82), (121 96), (114 109), (110 122), (103 138), (99 151), (34 27), (43 31), (48 44), (46 58), (52 73), (63 73), (61 84), (72 71), (90 69), (101 76), (123 71), (141 62), (166 27), (150 33), (159 36), (146 44), (154 53), (152 62), (146 73), (134 76), (143 82), (141 91), (130 98), (126 104), (132 113), (128 127), (117 122), (112 133), (119 144), (108 147), (119 153), (110 171), (103 164), (92 171), (86 160), (88 142), (79 140), (72 124), (83 131), (79 118), (68 113), (63 102), (68 93), (35 45))',
         0.15, true ) );
---st_astext--
POLYGON ((43 69, 50 84, 57 100, 63 118, 68 133, 74 149, 81 164, 88 180, 101 180, 112 180, 119 164, 126 149, 132 131, 139 113, 143 100, 150 84, 157 69, 163 51, 168 36, 174 20, 163 20, 150 20, 143 36, 139 49, 132 64, 114 64, 99 64, 81 64, 63 64, 57 49, 52 36, 46 20, 37 20, 26 20, 32 36, 35 45, 39 55, 43 69), (88 124, 81 109, 74 93, 83 82, 99 82, 112 82, 121 96, 114 109, 110 122, 103 138, 92 138, 88 124))
    </pre><p>
</p><div class="informaltable"><table class="informaltable" style="border-collapse: collapse;border-top: 1px solid ; border-bottom: 1px solid ; border-left: 1px solid ; border-right: 1px solid ; "><colgroup><col><col></colgroup><tbody><tr><td style="border-right: 1px solid ; "><div class="informalfigure"><div class="mediaobject"><img src="../images/st_concavehull03.png"><div class="caption"><p><code class="varname">polygon_hull</code></p></div></div></div></td><td style=""><div class="informalfigure"><div class="mediaobject"><img src="../images/st_concavehull04.png"><div class="caption"><p><code class="varname">points_hull</code></p></div></div></div></td></tr></tbody></table></div><p>ポリゴンの凹包と構成ポイントの凹包との比較。凹包はポリゴンの境界を考慮しますが、ポイントを基にした凹包では考慮されません。 </p><pre class="programlisting">WITH data(geom) AS (VALUES
   ('POLYGON ((10 90, 39 85, 61 79, 50 90, 80 80, 95 55, 25 60, 90 45, 70 16, 63 38, 60 10, 50 30, 43 27, 30 10, 20 20, 10 90))'::geometry)
)
SELECT  ST_ConcaveHull( geom,            0.1) AS polygon_hull,
        ST_ConcaveHull( ST_Points(geom), 0.1) AS points_hull
    FROM data;
</pre><p>ST_Collectの併用でジオメトリ集合の凹包の計算。</p><pre class="programlisting">-- Compute estimate of infected area based on point observations
SELECT disease_type,
    ST_ConcaveHull( ST_Collect(obs_pnt), 0.3 ) AS geom
  FROM disease_obs
  GROUP BY disease_type;
</pre></div><div class="refsection"><a name="idp259361568"></a><h2>関連情報</h2><p><a class="xref" href="ST_ConvexHull.html" title="ST_ConvexHull">ST_ConvexHull</a>, <a class="xref" href="ST_Collect.html" title="ST_Collect">ST_Collect</a>, <a class="xref" href="ST_AlphaShape.html" title="ST_AlphaShape">ST_AlphaShape</a>, <a class="xref" href="ST_OptimalAlphaShape.html" title="ST_OptimalAlphaShape">ST_OptimalAlphaShape</a></p></div></div><div class="navfooter"><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ST_ChaikinSmoothing.html">戻る</a> </td><td width="20%" align="center"><a accesskey="u" href="reference.html#Geometry_Processing">上に戻る</a></td><td width="40%" align="right"> <a accesskey="n" href="ST_ConvexHull.html">次へ</a></td></tr><tr><td width="40%" align="left" valign="top">ST_ChaikinSmoothing </td><td width="20%" align="center"><a accesskey="h" href="index.html">ホーム</a></td><td width="40%" align="right" valign="top"> ST_ConvexHull</td></tr></table></div></body></html>
