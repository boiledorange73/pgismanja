<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>第13章 PostGIS追加機能</title><link rel="stylesheet" type="text/css" href="style.css"><meta name="generator" content="DocBook XSL Stylesheets V1.76.1"><link rel="home" href="index.html" title="PostGIS 2.3.0 マニュアル"><link rel="up" href="index.html" title="PostGIS 2.3.0 マニュアル"><link rel="prev" href="standardize_address.html" title="standardize_address"><link rel="next" href="Drop_Indexes_Generate_Script.html" title="Drop_Indexes_Generate_Script"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">第13章 PostGIS追加機能</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="standardize_address.html">戻る</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="Drop_Indexes_Generate_Script.html">次へ</a></td></tr></table><hr></div><div class="chapter" title="第13章 PostGIS追加機能"><div class="titlepage"><div><div><h2 class="title"><a name="Extras"></a>第13章 PostGIS追加機能</h2></div></div></div><div class="toc"><p><b>目次</b></p><dl><dt><span class="sect1"><a href="Extras.html#Tiger_Geocoder">13.1. Tigerジオコーダ</a></span></dt></dl></div><p>本章では、PostGISのソースアーカイブとソースレポジトリのextrasフォルダにある機能を記述します。 これらは必ずPostGISバイナリ版に同梱されているものではありませんが、通常は実行可能なplpgsqlベースのものまたは標準的なシェルスクリプトです。</p><div class="sect1" title="13.1. Tigerジオコーダ"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Tiger_Geocoder"></a>13.1. Tigerジオコーダ</h2></div><div><div class="abstract" title="概要"><p class="title"><b>概要</b></p><p>米国国勢調査局が公開している<a class="ulink" href="http://www.census.gov/geo/www/tiger/" target="_top">TIGER (Topologically Integrated Geographic Encoding and Referencing system ) / Line and Master Address database export</a>で動作するよう書かれた、PL/pgSQLベースのジオコーダです。 </p><p>データローダ機能、住所正規化、住所ジオコーダおよび逆ジオコーダ、の四つの要素があります。 </p><p>米国のための設計ですが、概念および機能の多くは適用可能で、他国の住所と道路ネットワークで動作するように適合させることができます (訳注: 日本の地名については未知です)。</p><p>Tiger関連の関数、道路型前置辞・道路型後置辞・州といった再利用可能な参照データ、データロード管理のための様々な制御テーブル、全てのロードされたテーブルが継承するスケルトンテーブル、を収容するための<code class="varname">tiger</code>というスキーマが、スクリプトによって作成されます。</p><p><code class="varname">tiger_data</code>という、もう一つのスキーマが作られます。ここに、ローダが米国国勢調査サイトからダウンロードしてデータベースにロードした州ごとの全ての国勢調査データが収容されます。現在のモデルでは、州ごとのテーブルは、<code class="varname">ma_addr</code>や<code class="varname">ma_edges</code>といったように名前の先頭に州コードを付けていて、州データのみに強制する制約が付いています。これらのテーブルは<code class="varname">tiger schema</code>にある<code class="varname">addr</code>, <code class="varname">faces</code>, <code class="varname">edges</code>等から継承されています。 </p><p>全てのジオコード関数は基底テーブルを参照するだけです。そのため、<code class="varname">tiger_data</code>データスキーマやそのデータを他のスキーマに分割できないという条件はありません。例えば、州ごとに異なるスキーマにしても、<code class="varname">tiger</code>内のテーブルから継承されているなら使用可能です。</p><p>お手持ちのデータベース内のエクステンションを有効にし、使用するデータをロードする方法については、<a class="xref" href="postgis_installation.html#install_tiger_geocoder_extension" title="2.8.1. TigerジオコーダをPostGISデータベースで有効にする: エクステンションを使用">「TigerジオコーダをPostGISデータベースで有効にする: エクステンションを使用」</a>を参照して下さい。</p><p> </p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Tigerジオコーダ (tiger_2010)を使っている場合には、extras/tiger内にあるupgrade_geocoder.bat / .sh を使ってアップグレードすることができます。<code class="varname">tiger_2010</code>と<code class="varname">tiger_2011以上</code>での大きな変更点は、<code class="varname">county</code>テーブルと<code class="varname">state</code>テーブルが、stateごとに出現することがなくなっています。tiger_2010からのデータを持っていて、tiger_2015に置き換えたい場合には、<a class="xref" href="postgis_installation.html#upgrade_tiger_geocoder" title="2.8.5. Tigerジオコーダのアップグレード">「Tigerジオコーダのアップグレード」</a>を参照して下さい。 </p></td></tr></table></div><p>

              </p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>PostGIS 2.2.0での新規機能は、Tiger 2015データに対応したことと、住所標準化がPostGISの一部に取り入れられたことです。</p><p>PostGIS 2.1.0での新規機能は、PostgreSQL 9.1以上では、TigerジオコーダをPostgreSQLエクステンションモデルでインストールすることができるようになったことです。詳細については<a class="xref" href="postgis_installation.html#install_tiger_geocoder_extension" title="2.8.1. TigerジオコーダをPostGISデータベースで有効にする: エクステンションを使用">「TigerジオコーダをPostGISデータベースで有効にする: エクステンションを使用」</a>を参照して下さい。</p></td></tr></table></div><p>
              </p><p>PostGISが用意している<a class="xref" href="Normalize_Address.html" title="Normalize_Address">Normalize_Address</a>の代替として<a class="xref" href="Pagc_Normalize_Address.html" title="Pagc_Normalize_Address文字列のストリート住所を与えると、道路後置辞、前置辞、標準タイプ、番地、ストリート名等を複数フィールドに分解して持つnorm_addy複合型を返します。この関数は、tiger_geocoder同梱のルックアップテーブルだけを使います (Tigerデータは不要です)。住所標準化エクステンションが必要です。">Pagc_Normalize_Address文字列のストリート住所を与えると、道路後置辞、前置辞、標準タイプ、番地、ストリート名等を複数フィールドに分解して持つ<code class="varname">norm_addy</code>複合型を返します。この関数は、tiger_geocoder同梱のルックアップテーブルだけを使います (Tigerデータは不要です)。住所標準化エクステンションが必要です。</a>関数があります。コンパイルとインストールの方法については、<a class="xref" href="postgis_installation.html#installing_pagc_address_standardizer" title="2.7. PAGC住所標準化ツールのインストールと使用">「PAGC住所標準化ツールのインストールと使用」</a>を参照して下さい。</p><p>設計:</p><p>このプロジェクトの目標は、任意の米国住所文字列を処理し、正規化したTiger国勢調査データを使ってポイントジオメトリを生成し、与えられた住所の位置や、位置のもっともらしさを反映した評価値を算出する、十分に実用的なジオコーダを構築することです。なお、評価値は高いほど悪い結果とします。</p><p>PostGIS 2.0.0で導入された<code class="varname">reverse_geocode</code>は、GPS位置のストリート住所と交差点を得るのに便利です。</p><p>ジオコーダは、PostGISに慣れている方ならだれでもインストールと使用が容易な程度に単純であるべきで、PostGISがサポートする全てのプラットフォームで簡便にインストール、使用ができるべきです。</p><p>書式や綴りの誤りがあっても確実に機能するための十分なロバスト性があるべきです。</p><p>将来のデータ更新が使えるか、最小のプログラムの変更で他のデータが使えるための十分な拡張性もあるべきです。</p><p>
                </p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>関数が確実に動作するために、<code class="varname">tiger</code>スキーマは、データベース検索パスに追加されていなければなりません。</p></td></tr></table></div><p>
            </p></div></div></div></div><div class="toc"><dl><dt><span class="refentrytitle"><a href="Drop_Indexes_Generate_Script.html">Drop_Indexes_Generate_Script</a></span><span class="refpurpose"> — tigerスキーマとユーザが指定したスキーマ上の、全ての主キーでなく、かつユニークでないインデックスを削除します。スキーマを指定しない場合のデフォルトスキーマは、<code class="varname">tiger_data</code>です。</span></dt><dt><span class="refentrytitle"><a href="Drop_Nation_Tables_Generate_Script.html">Drop_Nation_Tables_Generate_Script</a></span><span class="refpurpose"> — 指定したスキーマ内のテーブルのうち、<code class="varname">county_all</code>, <code class="varname">state_all</code>または、<code class="varname">county</code> or <code class="varname">state</code>を削除するスクリプトを生成します。</span></dt><dt><span class="refentrytitle"><a href="Drop_State_Tables_Generate_Script.html">Drop_State_Tables_Generate_Script</a></span><span class="refpurpose"> — 指定したスキーマ内の、名前が州コードから始まるテーブルを全て削除するスクリプトを生成します。スキーマが指定されていない場合のデフォルトスキーマは<code class="varname">tiger_data</code>です。</span></dt><dt><span class="refentrytitle"><a href="Geocode.html">Geocode</a></span><span class="refpurpose"> — 住所を文字列 (もしくは他の正規化された住所)として取り、可能性のある位置の集合を返します。返される集合の要素は、NAD 83経度緯度のポイントジオメトリ、正規化された住所と評価値を持ちます。評価値は低いほど可能性が高いことを示しています。結果は評価値の低い順に並べ替えられます。オプションにmax_result (最大結果数、デフォルトは10)とrestrict_region (制限領域、デフォルトはNULL)を渡すことができます。</span></dt><dt><span class="refentrytitle"><a href="Geocode_Intersection.html">Geocode_Intersection</a></span><span class="refpurpose"> — インタセクトする二つのストリート、州コード、市名、郵便番号を引数に取り、最初の交差点の可能性のある位置の集合を出力します。geomoutにNAD83経度緯度のポイント、<code class="varname">normalized_address</code>にそれぞれの位置、ratingに評価値がそれぞれ入ります。評価値が低いほど合致度が高くなります。結果は評価値の低い順にソートされます。最大結果数を渡すことができ、デフォルトは10です。Tigerデータ (エッジ、フェイス、住所)と、PostgreSQLあいまい文字列合致 (soundex, levenshtein)を使います。</span></dt><dt><span class="refentrytitle"><a href="Get_Geocode_Setting.html">Get_Geocode_Setting</a></span><span class="refpurpose"> — tiger.geocode_settingsテーブルに格納されている設定のうち指定したものの値を返します。</span></dt><dt><span class="refentrytitle"><a href="Get_Tract.html">Get_Tract</a></span><span class="refpurpose"> — ジオメトリで指定した位置の米国国勢調査統計区またはtractテーブルのフィールドを返します。デフォルトでは、統計区の短縮名を返します。</span></dt><dt><span class="refentrytitle"><a href="Install_Missing_Indexes.html">Install_Missing_Indexes</a></span><span class="refpurpose"> — ジオコーダで結合や検索条件に使われ、インデックスが付いていなキーカラムを持つ全てのテーブルを探し、インデックスを追加します。</span></dt><dt><span class="refentrytitle"><a href="Loader_Generate_Census_Script.html">Loader_Generate_Census_Script</a></span><span class="refpurpose"> — 指定した州について、tract (統計区)、bg (block group, 細分区グループ)、tabblock (ブロック)をダウンロードし、<code class="varname">tiger_data</code>に格納するための、指定したプラットフォーム用のシェルスクリプトを生成します。行ごとに州ごとのスクリプトが返されます。</span></dt><dt><span class="refentrytitle"><a href="Loader_Generate_Script.html">Loader_Generate_Script</a></span><span class="refpurpose"> — 指定したプラットフォーム用の、指定した州のTigerデータをダウンロードし、格納準備を行い、<code class="varname">tiger_data</code>スキーマに格納するシェルスクリプトを生成します。行ごとに州ごとのスクリプトが返ります。最新版ではTiger 2010のデータ構造変更に対応していて、国勢統計区、細分区グループ、細分区 (tabblocks)テーブルをダウンロードすることができます。</span></dt><dt><span class="refentrytitle"><a href="Loader_Generate_Nation_Script.html">Loader_Generate_Nation_Script</a></span><span class="refpurpose"> — 指定したプラットフォーム用の、国と州のルックアップテーブルをロードするシェルスクリプトを生成します。</span></dt><dt><span class="refentrytitle"><a href="Missing_Indexes_Generate_Script.html">Missing_Indexes_Generate_Script</a></span><span class="refpurpose"> — ジオコーダで結合に使われるキーカラムを持ち、インデックスが付いていないキーカラムを持つすべてのテーブルを検索し、インデックスを追加するSQLデータ定義言語を出力します。</span></dt><dt><span class="refentrytitle"><a href="Normalize_Address.html">Normalize_Address</a></span><span class="refpurpose"> — 文字列で住所が与えられると、道路後置辞、前置辞、正規化された種別、番地、ストリート名等をフィールドに分けて持つ<code class="varname">norm_addy</code>複合型を返します。tiger_geocoderに同梱されているルックアップデータで動作します (Tigerデータ自体は不要です)。</span></dt><dt><span class="refentrytitle"><a href="Pagc_Normalize_Address.html">Pagc_Normalize_Address文字列のストリート住所を与えると、道路後置辞、前置辞、標準タイプ、番地、ストリート名等を複数フィールドに分解して持つ<code class="varname">norm_addy</code>複合型を返します。この関数は、tiger_geocoder同梱のルックアップテーブルだけを使います (Tigerデータは不要です)。住所標準化エクステンションが必要です。</a></span><span class="refpurpose"> — 文字列のストリート住所を与えると、道路後置辞、前置辞、標準タイプ、番地、ストリート名等を複数フィールドに分解して持つ<code class="varname">norm_addy</code>複合型を返します。この関数は、tiger_geocoder同梱のルックアップテーブルだけを使います (Tigerデータは不要です)。住所標準化エクステンションが必要です。</span></dt><dt><span class="refentrytitle"><a href="Pprint_Addy.html">Pprint_Addy</a></span><span class="refpurpose"> — <code class="varname">norm_addy</code>複合型オブジェクトを与えると、印刷表現を返します。通常はnormalize_addressと併用します。</span></dt><dt><span class="refentrytitle"><a href="Reverse_Geocode.html">Reverse_Geocode</a></span><span class="refpurpose"> — 登録されている空間参照系に基づくポイントジオメトリを引数に取り、理論的に可能性のある住所の配列と交差するストリートの配列を一つのレコードで返します。include_strnum_range = trueの場合には、交差するストリートに番地範囲を追加します。</span></dt><dt><span class="refentrytitle"><a href="Topology_Load_Tiger.html">Topology_Load_Tiger</a></span><span class="refpurpose"> — Tigerデータの定義領域をPostGISトポロジにロードして、Tigerデータをトポロジの空間参照系に投影変換し、トポロジの許容精度にスナップします。</span></dt><dt><span class="refentrytitle"><a href="Set_Geocode_Setting.html">Set_Geocode_Setting</a></span><span class="refpurpose"> — ジオコーダ関数の振る舞いに影響を与える設定を行います。</span></dt></dl></div><p>PostGIS用の二つのオープンソースジオコーダがあります。これらはTigerジオコーダと違い、他国のジオコーディングに対応している利点があります。</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="ulink" href="http://wiki.openstreetmap.org/wiki/Nominatim" target="_top">Nominatim</a>は、OpenStreetMapの地名集データを使います。データのロードにはosm2pgsqlが必要です。PostgreSQL 8.4以上とPostGIS 1.5以上が必要です。Webサービスのインタフェースとして作られていて、Webサービスと呼ばれるような設計に見えます。Tigerジオコーダと同じように、ジオコーダと逆ジオコーダの要素を持ちます。文書からでは、Tigerジオコーダのような純粋なSQLインタフェースを持っているのか、多くの処理がWebインタフェースに実装されているのか、は明確ではありません。</p></li><li class="listitem"><p><a class="ulink" href="http://www.gisgraphy.com/" target="_top">GIS Graphy</a>も、PostGISを使用したもので、NominatimのようにOpenStreetMap (OSM)データを使用します。OSMデータのロードを行うローダとNominatimのように米国だけでなくジオコーディングを行う能力があります。Nominatimとよく似ていて、Webサービスとして動作し、Java 1.5、サーブレットアプリケーション、Apache Solrに依存しています。GisGraphyは、複数プラットフォームで動作し、他の機能の中には逆ジオコーダがあります。</p></li></ul></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="standardize_address.html">戻る</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="Drop_Indexes_Generate_Script.html">次へ</a></td></tr><tr><td width="40%" align="left" valign="top">standardize_address </td><td width="20%" align="center"><a accesskey="h" href="index.html">ホーム</a></td><td width="40%" align="right" valign="top"> Drop_Indexes_Generate_Script</td></tr></table></div></body></html>
