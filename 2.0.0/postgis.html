<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>PostGIS 2.0.0マニュアル日本語訳</title><link rel="stylesheet" type="text/css" href="style.css"><meta name="generator" content="DocBook XSL Stylesheets V1.76.1"><meta name="description" content="PostGIS は、オブジェクトRDB である PostgreSQL の拡張で、GIS (地理情報システム) オブジェクを格納することができます。 PostGISは、GiSTベースのR-Tree空間インデクスをサポートし、GISオブジェクトの解析および処理を行う機能を持ちます。  本マニュアルは 2.0.0 版のマニュアルです。 この作品は クリエイティブ・コモンズ 表示 - 継承 3.0 非移植 ライセンスの下に提供されています。好きなようにこの材料を使うことができますが、PostGIS Project のクレジット提示を求めます。また可能な限り http://www.postgis.org へのリンクを求めます。 日本語または日本国内固有の問題がありますので、を追加しました。あわせてご覧ください。 およびは訳していません。"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div lang="ja" class="book" title="PostGIS 2.0.0マニュアル日本語訳"><div class="titlepage"><div><div><h1 class="title"><a name="id286963833"></a>PostGIS 2.0.0マニュアル日本語訳</h1></div><div><div class="abstract" title="概要"><p class="title"><b>概要</b></p><p>PostGIS は、オブジェクトRDB である PostgreSQL の拡張で、GIS (地理情報システム) オブジェクを格納することができます。 PostGISは、GiSTベースのR-Tree空間インデクスをサポートし、GISオブジェクトの解析および処理を行う機能を持ちます。</p><p><span class="inlinemediaobject"><img src="images/PostGIS_logo.png"></span>
            <span class="inlinemediaobject"><img src="images/osgeo_logo.png"></span>     
      </p><p>本マニュアルは 2.0.0 版のマニュアルです。</p><p><span class="inlinemediaobject"><img src="images/ccbysa.png"></span> この作品は <a class="ulink" href="http://creativecommons.org/licenses/by-sa/3.0/" target="_top">クリエイティブ・コモンズ 表示 - 継承 3.0 非移植 ライセンス</a>の下に提供されています。好きなようにこの材料を使うことができますが、PostGIS Project のクレジット提示を求めます。また可能な限り <a class="ulink" href="http://www.postgis.org" target="_top">http://www.postgis.org</a> へのリンクを求めます。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>日本語または日本国内固有の問題がありますので、<a class="xref" href="#japanese_appendix" title="付録B 日本語訳に関する追加情報">付録B <i>日本語訳に関する追加情報</i></a>を追加しました。あわせてご覧ください。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><a class="xref" href="#Tiger_Geocoder" title="12.1. Tiger Geocoder">「Tiger Geocoder」</a>および<a class="xref" href="#release_notes" title="付録A Appendix">付録A <i>Appendix</i></a>は訳していません。</p></td></tr></table></div></div></div></div><hr></div><div class="toc"><p><b>目次</b></p><dl><dt><span class="chapter"><a href="#postgis_introduction">1. 導入</a></span></dt><dd><dl><dt><span class="sect1"><a href="#psc">1.1. プロジェクト運営委員会 </a></span></dt><dt><span class="sect1"><a href="#credits">1.2. 過去と現在の貢献者</a></span></dt><dt><span class="sect1"><a href="#id286926070">1.3. 追加情報 </a></span></dt></dl></dd><dt><span class="chapter"><a href="#postgis_installation">2. インストール</a></span></dt><dd><dl><dt><span class="sect1"><a href="#id286926897">2.1. 簡略版</a></span></dt><dt><span class="sect1"><a href="#id286926949">2.2. 必要なもの</a></span></dt><dt><span class="sect1"><a href="#id286927186">2.3. ソースの取得</a></span></dt><dt><span class="sect1"><a href="#PGInstall">2.4. インストール</a></span></dt><dd><dl><dt><span class="sect2"><a href="#installation_configuration">2.4.1. コンフィギュレーション</a></span></dt><dt><span class="sect2"><a href="#id286927660">2.4.2. ビルド</a></span></dt><dt><span class="sect2"><a href="#make_install_postgis_extensions">2.4.3. PostGIS EXTENSIONのビルドとデプロイ</a></span></dt><dt><span class="sect2"><a href="#id286963886">2.4.4. テスト</a></span></dt><dt><span class="sect2"><a href="#id286963945">2.4.5. インストール</a></span></dt></dl></dd><dt><span class="sect1"><a href="#create_new_db">2.5. PostgreSQL 9.1より前での空間データベースの作成</a></span></dt><dt><span class="sect1"><a href="#create_new_db_extensions">2.6. EXTENSIONを使った空間データベースの生成</a></span></dt><dt><span class="sect1"><a href="#loading_extras_tiger_geocoder">2.7. Tigerジオコーダのインストールとアップグレードとデータロード</a></span></dt><dd><dl><dt><span class="sect2"><a href="#install_tiger_geocoder">2.7.1. TigerジオコーダをPostGISデータベースで有効にする</a></span></dt><dt><span class="sect2"><a href="#upgrade_tiger_geocoder">2.7.2. Tigerジオコーダのアップデート</a></span></dt><dt><span class="sect2"><a href="#tiger_geocoder_loading_data">2.7.3. Tigerデータのロード</a></span></dt></dl></dd><dt><span class="sect1"><a href="#templatepostgis">2.8. 空間データベースをテンプレートから生成する</a></span></dt><dt><span class="sect1"><a href="#upgrading">2.9. アップグレード</a></span></dt><dd><dl><dt><span class="sect2"><a href="#soft_upgrade">2.9.1. ソフトアップグレード </a></span></dt><dt><span class="sect2"><a href="#hard_upgrade">2.9.2. ハードアップグレード</a></span></dt></dl></dd><dt><span class="sect1"><a href="#id286967270">2.10. 共通の問題</a></span></dt><dt><span class="sect1"><a href="#id286967348">2.11. JDBC</a></span></dt><dt><span class="sect1"><a href="#id286967438">2.12. ローダ/ダンパ </a></span></dt></dl></dd><dt><span class="chapter"><a href="#PostGIS_FAQ">3. PostGIS よくある質問</a></span></dt><dt><span class="chapter"><a href="#using_postgis_dbmanagement">4. PostGISを使う: データ管理とクエリ</a></span></dt><dd><dl><dt><span class="sect1"><a href="#RefObject">4.1. GISオブジェクト</a></span></dt><dd><dl><dt><span class="sect2"><a href="#OpenGISWKBWKT">4.1.1. OpenGIS WKBとWKT</a></span></dt><dt><span class="sect2"><a href="#EWKB_EWKT">4.1.2. PostGIS EWKB, EWKTと標準形式</a></span></dt><dt><span class="sect2"><a href="#SQL_MM_Part3">4.1.3. SQL-MM Part 3</a></span></dt></dl></dd><dt><span class="sect1"><a href="#PostGIS_Geography">4.2. PostGISジオグラフィ型</a></span></dt><dd><dl><dt><span class="sect2"><a href="#Geography_Basics">4.2.1. ジオグラフィ基礎</a></span></dt><dt><span class="sect2"><a href="#PostGIS_GeographyVSGeometry">4.2.2. ジオグラフィ型をジオメトリ型にして使用すべき時 </a></span></dt><dt><span class="sect2"><a href="#PostGIS_Geography_AdvancedFAQ">4.2.3. ジオグラフィに関する高度なよくある質問 </a></span></dt></dl></dd><dt><span class="sect1"><a href="#id286972774">4.3. OpenGIS標準を使う</a></span></dt><dd><dl><dt><span class="sect2"><a href="#spatial_ref_sys">4.3.1. SPATIAL_REF_SYSテーブルと空間参照系</a></span></dt><dt><span class="sect2"><a href="#geometry_columns">4.3.2. GEOMETRY_COLUMNSビュー</a></span></dt><dt><span class="sect2"><a href="#Create_Spatial_Table">4.3.3. 空間テーブルを作る</a></span></dt><dt><span class="sect2"><a href="#Manual_Register_Spatial_Column">4.3.4. 手動でジオメトリカラムをgeometry_columnsに登録する</a></span></dt><dt><span class="sect2"><a href="#OGC_Validity">4.3.5. ジオメトリのOpenGIS準拠を確実にする</a></span></dt><dt><span class="sect2"><a href="#DE-9IM">4.3.6. Dimensionally Extended 9 Intersection Model (DE-9IM)</a></span></dt></dl></dd><dt><span class="sect1"><a href="#id286979474">4.4. GISデータをロードする</a></span></dt><dd><dl><dt><span class="sect2"><a href="#id286979482">4.4.1. SQLを使う</a></span></dt><dt><span class="sect2"><a href="#shp2pgsql_usage">4.4.2. ローダを使う</a></span></dt></dl></dd><dt><span class="sect1"><a href="#id286980387">4.5. GISデータを検索する</a></span></dt><dd><dl><dt><span class="sect2"><a href="#id286980395">4.5.1. SQLを使う</a></span></dt><dt><span class="sect2"><a href="#id286980695">4.5.2. ダンパを使う</a></span></dt></dl></dd><dt><span class="sect1"><a href="#id286980859">4.6. インデクスを構築する</a></span></dt><dd><dl><dt><span class="sect2"><a href="#id286980891">4.6.1. GiSTインデクス</a></span></dt><dt><span class="sect2"><a href="#id286980924">4.6.2. インデクスを使う</a></span></dt></dl></dd><dt><span class="sect1"><a href="#id286980997">4.7. 複雑なクエリ</a></span></dt><dd><dl><dt><span class="sect2"><a href="#id286981012">4.7.1. インデクスの利点を使う</a></span></dt><dt><span class="sect2"><a href="#id286981166">4.7.2. 空間SQLの例</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#using_raster.xml">5. ラスタデータの管理、クエリ、アプリケーション</a></span></dt><dd><dl><dt><span class="sect1"><a href="#RT_Loading_Rasters">5.1. ラスタのロードと生成</a></span></dt><dd><dl><dt><span class="sect2"><a href="#RT_Raster_Loader">5.1.1. raster2pgsqlを使ってラスタをロードする</a></span></dt><dt><span class="sect2"><a href="#RT_Creating_Rasters">5.1.2. PostGISラスタ関数を用いたラスタの生成</a></span></dt></dl></dd><dt><span class="sect1"><a href="#RT_Raster_Catalog">5.2. ラスタカタログ</a></span></dt><dd><dl><dt><span class="sect2"><a href="#RT_Raster_Columns">5.2.1. ラスタカラムカタログ</a></span></dt><dt><span class="sect2"><a href="#RT_Raster_Overviews">5.2.2. ラスタオーバビュー</a></span></dt></dl></dd><dt><span class="sect1"><a href="#RT_Raster_Applications">5.3. PostGISラスタを使ったカスタムアプリケーションの構築</a></span></dt><dd><dl><dt><span class="sect2"><a href="#RT_PHP_Output">5.3.1. ST_AsPNG を他の関数とあわせて使った PHP 出力例</a></span></dt><dt><span class="sect2"><a href="#RT_Net_Output_CS">5.3.2. ST_AsPNGを他の関数とあわせて使ったASP.NET C#出力例</a></span></dt><dt><span class="sect2"><a href="#RT_Java_Console_App">5.3.3. ラスタクエリを画像ファイルとして出力するJavaコンソールアプリケーション</a></span></dt><dt><span class="sect2"><a href="#RT_PLPython">5.3.4. PLPython を使って SQL を介して画像をダンプする</a></span></dt><dt><span class="sect2"><a href="#RasterOutput_PSQL">5.3.5. PSQLでラスタを出力する</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#id286985699">6. PostGISを使う: アプリケーションを構築する</a></span></dt><dd><dl><dt><span class="sect1"><a href="#Using_MapServer">6.1. MapServerを使う</a></span></dt><dd><dl><dt><span class="sect2"><a href="#id286985810">6.1.1. 基本的な使い方</a></span></dt><dt><span class="sect2"><a href="#id286986077">6.1.2. よくある質問</a></span></dt><dt><span class="sect2"><a href="#id286986521">6.1.3. 踏み込んだ使用法</a></span></dt><dt><span class="sect2"><a href="#id286986593">6.1.4. 例</a></span></dt></dl></dd><dt><span class="sect1"><a href="#id286986648">6.2. Javaクライアント(JDBC)</a></span></dt><dt><span class="sect1"><a href="#id286986673">6.3. Cクライアント(libpq)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#id286986681">6.3.1. テキストカーソル</a></span></dt><dt><span class="sect2"><a href="#id286986692">6.3.2. バイナリカーソル</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#id286989453">7. 性能向上に関する技法</a></span></dt><dd><dl><dt><span class="sect1"><a href="#id286989459">7.1. 大きなジオメトリを持つ小さなテーブル</a></span></dt><dd><dl><dt><span class="sect2"><a href="#id286989464">7.1.1. 問題の説明</a></span></dt><dt><span class="sect2"><a href="#id286989488">7.1.2. 応急処置</a></span></dt></dl></dd><dt><span class="sect1"><a href="#id286989521">7.2. ジオメトリインデクスでCLUSTERを実行する</a></span></dt><dt><span class="sect1"><a href="#id286989548">7.3. 次元変換の回避</a></span></dt><dt><span class="sect1"><a href="#id286989569">7.4. コンフィギュレーションのチューン</a></span></dt><dd><dl><dt><span class="sect2"><a href="#id286989586">7.4.1. 起動時</a></span></dt><dt><span class="sect2"><a href="#id286989950">7.4.2. 実行時</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#reference">8. PostGISリファレンス</a></span></dt><dd><dl><dt><span class="sect1"><a href="#PostGIS_Types">8.1. PostgreSQL PostGIS Geometry/Geography/Box 型</a></span></dt><dt><span class="sect1"><a href="#Management_Functions">8.2. 管理関数</a></span></dt><dt><span class="sect1"><a href="#Geometry_Constructors">8.3. ジオメトリ コンストラクタ</a></span></dt><dt><span class="sect1"><a href="#Geometry_Accessors">8.4. ジオメトリ アクセサ</a></span></dt><dt><span class="sect1"><a href="#Geometry_Editors">8.5. ジオメトリ エディタ</a></span></dt><dt><span class="sect1"><a href="#Geometry_Outputs">8.6. ジオメトリ出力</a></span></dt><dt><span class="sect1"><a href="#Operators">8.7. 演算子</a></span></dt><dt><span class="sect1"><a href="#Spatial_Relationships_Measurements">8.8. 空間関係関数と空間計測関数 </a></span></dt><dt><span class="sect1"><a href="#Geometry_Processing">8.9. ジオメトリ処理関数</a></span></dt><dt><span class="sect1"><a href="#Linear_Referencing">8.10. 線型参照</a></span></dt><dt><span class="sect1"><a href="#Long_Transactions_Support">8.11. ロングトランザクション サポート</a></span></dt><dt><span class="sect1"><a href="#Miscellaneous_Functions">8.12. その他の関数</a></span></dt><dt><span class="sect1"><a href="#Exceptional_Functions">8.13. 例外的関数</a></span></dt></dl></dd><dt><span class="chapter"><a href="#RT_reference">9. ラスタ リファレンス</a></span></dt><dd><dl><dt><span class="sect1"><a href="#Raster_Types">9.1. ラスタサポートデータ型</a></span></dt><dt><span class="sect1"><a href="#Raster_Management_Functions">9.2. ラスタ管理</a></span></dt><dt><span class="sect1"><a href="#Raster_Constructors">9.3. ラスタ コンストラクタ</a></span></dt><dt><span class="sect1"><a href="#Raster_Accessors">9.4. ラスタ アクセサ</a></span></dt><dt><span class="sect1"><a href="#RasterBand_Accessors">9.5. ラスタバンド アクセサ</a></span></dt><dt><span class="sect1"><a href="#Raster_Pixel_Accessors">9.6. ラスタピクセル アクセサとセッター</a></span></dt><dt><span class="sect1"><a href="#Raster_Editors">9.7. ラスタ エディタ</a></span></dt><dt><span class="sect1"><a href="#RasterBand_Editors">9.8. ラスタバンド エディタ</a></span></dt><dt><span class="sect1"><a href="#RasterBand_Stats">9.9. ラスタバンド統計情報と解析</a></span></dt><dt><span class="sect1"><a href="#Raster_Outputs">9.10. ラスタ出力</a></span></dt><dt><span class="sect1"><a href="#Raster_Processing">9.11. ラスタ処理</a></span></dt><dt><span class="sect1"><a href="#Raster_Processing_Builtin_Functions">9.12. ラスタ処理組み込み関数</a></span></dt><dt><span class="sect1"><a href="#RT_Operators">9.13. ラスタ演算子</a></span></dt><dt><span class="sect1"><a href="#Raster_Relationships">9.14. ラスタ/ラスタバンドの空間関係関数</a></span></dt></dl></dd><dt><span class="chapter"><a href="#RT_FAQ">10. PostGISラスタ よくある質問</a></span></dt><dt><span class="chapter"><a href="#Topology">11. トポロジ</a></span></dt><dd><dl><dt><span class="sect1"><a href="#Topology_Types">11.1. トポロジ型</a></span></dt><dt><span class="sect1"><a href="#Topology_Domains">11.2. トポロジドメイン</a></span></dt><dt><span class="sect1"><a href="#Topology_ManagementFunctions">11.3. トポロジとTopoGeometryの管理</a></span></dt><dt><span class="sect1"><a href="#Topology_Constructors">11.4. トポロジコンストラクタ</a></span></dt><dt><span class="sect1"><a href="#Topology_Editing">11.5. トポロジエディタ</a></span></dt><dt><span class="sect1"><a href="#Topology_Accessors">11.6. トポロジアクセサ</a></span></dt><dt><span class="sect1"><a href="#Topology_Processing">11.7. トポロジ処理</a></span></dt><dt><span class="sect1"><a href="#TopoGeometry_Constructors">11.8. TopoGeometryコンストラクタ</a></span></dt><dt><span class="sect1"><a href="#TopoGeom_Accessors">11.9. TopoGeometryアクセサ</a></span></dt><dt><span class="sect1"><a href="#TopoGeometry_Outputs">11.10. TopoGeometry出力</a></span></dt></dl></dd><dt><span class="chapter"><a href="#Extras">12. PostGIS 追加機能</a></span></dt><dd><dl><dt><span class="sect1"><a href="#Tiger_Geocoder">12.1. Tiger Geocoder</a></span></dt></dl></dd><dt><span class="chapter"><a href="#PostGIS_Special_Functions_Index">13. PostGIS空間関数索引</a></span></dt><dd><dl><dt><span class="sect1"><a href="#PostGIS_Aggregate_Functions">13.1. PostGIS集計関数</a></span></dt><dt><span class="sect1"><a href="#PostGIS_SQLMM_Functions">13.2. PostGIS SQL-MM対応関数</a></span></dt><dt><span class="sect1"><a href="#PostGIS_GeographyFunctions">13.3. PostGISジオグラフィ対応関数</a></span></dt><dt><span class="sect1"><a href="#PostGIS_RasterFunctions">13.4. PostGISラスタ対応関数</a></span></dt><dt><span class="sect1"><a href="#PostGIS_Geometry_DumpFunctions">13.5. PostGISジオメトリ/ジオグラフィ/ラスタダンプ関数</a></span></dt><dt><span class="sect1"><a href="#PostGIS_BoxFunctions">13.6. PostGISボックス関数</a></span></dt><dt><span class="sect1"><a href="#PostGIS_3D_Functions">13.7. 3次元対応PostGIS関数</a></span></dt><dt><span class="sect1"><a href="#PostGIS_Curved_GeometryFunctions">13.8. PostGIS曲線ジオメトリ対応関数</a></span></dt><dt><span class="sect1"><a href="#PostGIS_PS_GeometryFunctions">13.9. PostGIS多面体サーフェス対応関数</a></span></dt><dt><span class="sect1"><a href="#PostGIS_TypeFunctionMatrix">13.10. PostGIS関数対応マトリクス</a></span></dt><dt><span class="sect1"><a href="#NewFunctions">13.11. 新規作成/機能強化/変更されたPostGIS関数</a></span></dt><dd><dl><dt><span class="sect2"><a href="#NewFunctions_2_0">13.11.1. PostGIS 2.0で新規作成/機能強化/変更された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_2_0_Changed">13.11.2. PostGIS 2.0での関数の挙動変更</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_1_5">13.11.3. PostGIS 1.5で新規作成/機能強化/挙動変更された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_1_4">13.11.4. PostGIS 1.4で新規作成/機能強化/挙動変更された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_1_3">13.11.5. PostGIS 1.3で新規作成された関数</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#id287246629">14. 問題を報告する</a></span></dt><dd><dl><dt><span class="sect1"><a href="#id287246634">14.1. ソフトウェアのバグを報告する</a></span></dt><dt><span class="sect1"><a href="#id287246775">14.2. 文書の問題を報告する</a></span></dt></dl></dd><dt><span class="appendix"><a href="#release_notes">A. Appendix</a></span></dt><dd><dl><dt><span class="sect1"><a href="#id287247000">A.1. Release 2.0.0</a></span></dt><dt><span class="sect1"><a href="#id287247252">A.2. Release 1.5.3</a></span></dt><dt><span class="sect1"><a href="#id287247330">A.3. Release 1.5.2</a></span></dt><dt><span class="sect1"><a href="#id287247417">A.4. Release 1.5.1</a></span></dt><dt><span class="sect1"><a href="#id287247534">A.5. Release 1.5.0</a></span></dt><dt><span class="sect1"><a href="#id287247718">A.6. Release 1.4.0</a></span></dt><dt><span class="sect1"><a href="#id287247892">A.7. Release 1.3.6</a></span></dt><dt><span class="sect1"><a href="#id287247905">A.8. Release 1.3.5</a></span></dt><dt><span class="sect1"><a href="#id287250547">A.9. Release 1.3.4</a></span></dt><dt><span class="sect1"><a href="#id287250563">A.10. Release 1.3.3</a></span></dt><dt><span class="sect1"><a href="#id287250576">A.11. Release 1.3.2</a></span></dt><dt><span class="sect1"><a href="#id287250588">A.12. Release 1.3.1</a></span></dt><dt><span class="sect1"><a href="#id287250603">A.13. Release 1.3.0</a></span></dt><dt><span class="sect1"><a href="#id287250664">A.14. Release 1.2.1</a></span></dt><dt><span class="sect1"><a href="#id287250700">A.15. Release 1.2.0</a></span></dt><dt><span class="sect1"><a href="#id287250727">A.16. Release 1.1.6</a></span></dt><dt><span class="sect1"><a href="#id287250816">A.17. Release 1.1.5</a></span></dt><dt><span class="sect1"><a href="#id287250901">A.18. Release 1.1.4</a></span></dt><dt><span class="sect1"><a href="#id287250995">A.19. Release 1.1.3</a></span></dt><dt><span class="sect1"><a href="#id287251126">A.20. Release 1.1.2</a></span></dt><dt><span class="sect1"><a href="#id287251333">A.21. Release 1.1.1</a></span></dt><dt><span class="sect1"><a href="#id287251431">A.22. Release 1.1.0</a></span></dt><dt><span class="sect1"><a href="#id287251684">A.23. Release 1.0.6</a></span></dt><dt><span class="sect1"><a href="#id287251770">A.24. Release 1.0.5</a></span></dt><dt><span class="sect1"><a href="#id287251912">A.25. Release 1.0.4</a></span></dt><dt><span class="sect1"><a href="#rel_1.0.3_upgrading">A.26. Release 1.0.3</a></span></dt><dt><span class="sect1"><a href="#id287252101">A.27. Release 1.0.2</a></span></dt><dt><span class="sect1"><a href="#id287252167">A.28. Release 1.0.1</a></span></dt><dt><span class="sect1"><a href="#id287252284">A.29. Release 1.0.0</a></span></dt><dt><span class="sect1"><a href="#id287252363">A.30. Release 1.0.0RC6</a></span></dt><dt><span class="sect1"><a href="#id287252426">A.31. Release 1.0.0RC5</a></span></dt><dt><span class="sect1"><a href="#id287252486">A.32. Release 1.0.0RC4</a></span></dt><dt><span class="sect1"><a href="#id287252587">A.33. Release 1.0.0RC3</a></span></dt><dt><span class="sect1"><a href="#id287252726">A.34. Release 1.0.0RC2</a></span></dt><dt><span class="sect1"><a href="#id287252808">A.35. Release 1.0.0RC1</a></span></dt></dl></dd><dt><span class="appendix"><a href="#japanese_appendix">B. 日本語訳に関する追加情報</a></span></dt><dd><dl><dt><span class="sect1"><a href="#intersects_and_crosses">B.1. 「インタセクト」と「クロス」</a></span></dt><dt><span class="sect1"><a href="#srs_in_japan">B.2. 空間参照系等について</a></span></dt><dd><dl><dt><span class="sect2"><a href="#wellused_srs_in_japan">B.2.1. わが国でよく使われる空間参照系</a></span></dt><dt><span class="sect2"><a href="#geod_in_japan">B.2.2. 測地系</a></span></dt><dt><span class="sect2"><a href="#utm_in_japan">B.2.3. UTM</a></span></dt><dt><span class="sect2"><a href="#jpr">B.2.4. 平面直角座標系</a></span></dt></dl></dd><dt><span class="sect1"><a href="#problem_tokyodatum">B.3. 日本測地系から投影変換する場合の問題点</a></span></dt><dd><dl><dt><span class="sect2"><a href="#id287254425">B.3.1. Proj.4で問題点を見る</a></span></dt><dt><span class="sect2"><a href="#id287254461">B.3.2. PostGISでの問題回避</a></span></dt></dl></dd><dt><span class="sect1"><a href="#with_sjis">B.4. Shift JIS系文字コードについて</a></span></dt></dl></dd></dl></div><div class="chapter" title="第1章 導入"><div class="titlepage"><div><div><h2 class="title"><a name="postgis_introduction"></a>第1章 導入</h2></div></div></div><div class="toc"><p><b>目次</b></p><dl><dt><span class="sect1"><a href="#psc">1.1. プロジェクト運営委員会 </a></span></dt><dt><span class="sect1"><a href="#credits">1.2. 過去と現在の貢献者</a></span></dt><dt><span class="sect1"><a href="#id286926070">1.3. 追加情報 </a></span></dt></dl></div><p>PostGISはRefractions Research Incが空間データベース技術研究プロジェクトとして開発しました。Refractionsはカナダ・ブリティッシュコロンビア州・ビクトリアにある、データインテグレーションとカスタムソフトウェア開発に特化した、GISとデータベースのコンサルティング会社です。私たちは完全なOpenGISサポート、高度なトポロジ構成(カバレッジ、サーフェス、ネットワーク)、GISデータの表示と編集をするためのデスクトップユーザインタフェースツール、ウェブベースのアクセスツールを持つ、 重要なGIS機能性の範囲をサポートするPostGISを、サポートおよび開発する予定です。</p><p>PostGISはOSGeo財団のインキュベーションプロジェクトです。PostGISは、多数のFOSS4G開発者と、PostGIS機能と多彩さから大きな利益を得る世界中の企業によって継続的に改善され、資金を得ています。</p><div class="sect1" title="1.1. プロジェクト運営委員会"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="psc"></a>1.1. プロジェクト運営委員会 </h2></div></div></div><p>
		PostGISプロジェクト運営委員会(PostGIS Project Steering Committee, PSC)は、総合的な指示、リリースサイクル、ドキュメンテーション、支援活動に関する調整を行っています。また、委員会は、全体的なユーザサポート、PostGISコミュニティからのパッチの受け付けと適用、 開発者のコミットのアクセス、新しい委員、APIの重要な変更といった、PostGISを含む雑多な問題に関する投票を行っています。 
	</p><div class="variablelist"><dl><dt><span class="term">Mark Cave-Ayland</span></dt><dd><p>バグフィクスとメインテナンスの調整、PostgreSQLのリリースとの調整、空間インデクスの選択とバインディング、ローダ/ダンパ、シェープファイルGUIロード、新機能の統合と強化。</p></dd><dt><span class="term">Chris Hodgson</span></dt><dd><p>総合的な開発、サイトとBuildbotのメンテナンス、OSGeoインキュベーションマネージャ。</p></dd><dt><span class="term">Regina Obe</span></dt><dd><p>文書作成、PostGISニュースグループにおける一般的なユーザサポート、Windows製品と実験ビルド、X3D機能、Tiger Geocoder機能、管理関数、新機能と大きなコード変更のスモークテスト。</p></dd><dt><span class="term">Paul Ramsey (Chair)</span></dt><dd><p>
PostGISプロジェクトの副創始者。総合的なバグフィクス、ジオグラフィ機能、ジオメトリとジオグラフィのインデクス機能(2次元,、3次元、n次元インデクスとあらゆる空間インデクス)、ジオメトリ内部構造、GEOS機能の統合とGEOSリリースとの調整、ローダ/ダンパ、シェープファイルGUIローダ。</p></dd><dt><span class="term">Sandro Santilli</span></dt><dd><p>バグフィクスとメンテナンスと、新しいGEOS機能の統合とGEOSリリースとの調整、トポロジ機能、ラスタフレームワークと、低水準API関数。</p></dd></dl></div></div><div class="sect1" title="1.2. 過去と現在の貢献者"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="credits"></a>1.2. 過去と現在の貢献者</h2></div></div></div><div class="variablelist"><dl><dt><span class="term">Kevin Neufeld</span></dt><dd><p>以前のPSCメンバ。文書と文書補助ツール、、PostGISニュースグループでの高度なユーザサポート、PostGISメンテナンス機能の強化。</p></dd><dt><span class="term">Dave Blasby</span></dt><dd><p>PostGISのオリジナルの開発/副創始者。サーバサイドのオブジェクト、インデクスのバインディングや多数のサーバサイドの解析機能を記述。</p></dd><dt><span class="term">Jeff Lounsbury</span></dt><dd><p>シェープファイルのローダ/ダンパのオリジナルの開発者。現在のPostGISプロジェクトオーナーの代表。</p></dd><dt><span class="term">Olivier Courtin</span></dt><dd><p>XML (KML,GML)/GeoJSON入出力機能と3次元機能とバグフィクス。</p></dd><dt><span class="term">Mark Leslie</span></dt><dd><p>中核機能の、継続的なメンテナンスと開発。曲線機能の強化。シェープファイルGUIローダ。</p></dd><dt><span class="term">Pierre Racine</span></dt><dd><p>ラスタの全体の構造、プロトタイピング、プログラミング補助。</p></dd><dt><span class="term">Nicklas Aven</span></dt><dd><p>距離関数強化(3次元距離とリレーションシップ関数を含む)と追加、WIndowsのテスト、総合的なユーザサポート。</p></dd><dt><span class="term">Jorge Arevalo</span></dt><dd><p>ラスタ開発、GDALドライバサポート、ローダ</p></dd><dt><span class="term">Bborie Park</span></dt><dd><p>ラスタイメージ出力(JPEG, PNG等)とラスタ解析関数。</p></dd><dt><span class="term">Mateusz Loskot</span></dt><dd><p>ラスタローダ、低水準ラスタAPI関数。</p></dd><dt><span class="term">David Zwarg</span></dt><dd><p>ラスタ開発</p></dd><dt><span class="term">他の貢献者: 個人</span></dt><dd><p>
Alex Bodnaru,
Alex Mayrhofer,
Andrea Peri,
Andreas Foro Tollefsen,
Andreas Neumann,
Anne Ghisla,
Barbara Phillipot,
Ben Jubb,
Bernhard Reiter,
Brian Hamlin,
Bruce Rindahl,
Bruno Wolff III,
Bryce L. Nordgren,
Carl Anderson,
Charlie Savage,
Dane Springmeyer,
David Skea,
David Techer,
Eduin Carrillo,
Even Rouault,
Frank Warmerdam,
George Silva,
Gerald Fenoy,
Gino Lucrezi,
Guillaume Lelarge,
IIDA Tetsushi,
Ingvild Nystuen,
Jeff Adams,
Jose Carlos Martinez Llari,
Kashif Rasul,
Klaus Foerster,
Kris Jurka,
Leo Hsu,
Loic Dachary,
Luca S. Percich,
Maria Arias de Reyna,
Mark Sondheim,
Markus Schaber,
Maxime Guillaud,
Maxime van Noppen,
Michael Fuhr,
Nikita Shulga,
Norman Vine,
Rafal Magda,
Ralph Mason,
Richard Greenwood,
Silvio Grosso,
Steffen Macke,
Stephen Frost,
Tom van Tilburg,
Vincent Picavet
(アルファベット順)
		  </p></dd><dt><span class="term">他の貢献者: 企業</span></dt><dd><p>PostGISプロジェクトへの開発時間、ホスティング、直接的な金銭提供の貢献を行った企業です。</p><p>
Arrival 3D,
Associazione Italiana per l'Informazione Geografica Libera (GFOSS.it),
AusVet,
Avencia,
Azavea,
Cadcorp,
CampToCamp,
City of Boston (DND),
Clever Elephant Solutions,
Cooperativa Alveo,
Deimos Space,
Faunalia,
Geographic Data BC,
Hunter Systems Group,
Lidwala Consulting Engineers,
LisaSoft,
Logical Tracking &amp; Tracing International AG,
Michigan Tech Research Institute,
Norwegian Forest and Landscape Institute,
OpenGeo,
OSGeo,
Oslandia,
Paragon Corporation,
R3 GIS,,
Refractions Research,
Regione Toscana-SIGTA,
Safe Software,
Sirius Corporation plc,
Stadt Uster,
UC Davis Center for Vectorborne Diseases,
University of Laval,
U.S Department of State (HIU),
Vizzuality,
Zonar Systems
(アルファベット順)
		  </p></dd><dt><span class="term">みんなで基金キャンペーン</span></dt><dd><p>みんなで基金キャンペーンは、PostGIS開発チームが走らせているキャンペーンです。欲しくて仕方ない機能に資金を与えて、多数の人々にサービスを提供できるようにするためのものです。それぞれのキャンペーンは特定の機能または機能の集合に焦点があてます。それぞれのスポンサーは、必要な資金提供のうち少しだけを提供し、十分な人/組織の寄付で、たくさんの助けになる作業に支払う基金を持ちます。他の多くの人が寄付に協力してくれそうな機能に関するアイデアがありましたら、<a class="ulink" href="http://www.postgis.org/mailman/listinfo/postgis-users" target="_top">PostGIS newsgroup</a>に、その考えを投稿して下さい。そして一緒に起きるようにすることができます。</p><p>PostGIS 2.0.0はこの戦略を実施する最初のリリースです。<a class="ulink" href="http://www.pledgebank.com" target="_top">PledgeBank</a>を使い、2件のキャンペーンが成功しました。</p><p><a class="ulink" href="http://www.pledgebank.com/postgistopology" target="_top"><span class="bold"><strong>postgistopology</strong></span></a> - 10以上のスポンサーがTopoGeometry機能の構築と2.0.0でのトポロジ対応強化とのために、それぞれ250米ドルを寄付しました。</p><p><a class="ulink" href="http://www.pledgebank.com/postgis64windows" target="_top"><span class="bold"><strong>postgis64windows</strong></span></a> - 20のスポンサーが,
Windows上でのPostGIS 64ビット版に必要な作業のために、それぞれ100米ドルを寄付しました。64ビット用PostGIS 2.0.0ベータリリースができ、PostgreSQLスタックビルダで使用可能なリリースを予定している最終版ができました。</p></dd><dt><span class="term">重要なサポートライブラリ </span></dt><dd><p>ジオメトリ演算ライブラリ<a class="ulink" href="http://trac.osgeo.org/geos/" target="_top">GEOS</a>、Martin Davisがアルゴリズムを作成し、Mateusz Loskot, Sandro Santilli (strk), Paul Ramseyらで動作するようにし、メンテナンスとサポートの進行を行っています。</p><p>地理空間データ抽出ライブラリ<a class="ulink" href="http://trac.osgeo.org/gdal/" target="_top">GDAL</a>はFrank Warmerdamらによります。PostGIS 2.0.0で導入されたラスタ機能で、非常によく使われています。
同じように、PostGISサポートに関するGDALの必要な改善は、GDALプロジェクトに寄与しています。</p><p>地図投影ライブラリ<a class="ulink" href="http://trac.osgeo.org/proj/" target="_top">Proj4</a>は、Gerald EvendenとFrank Warmerdamによって作成とメンテナンスがされています。</p><p>最後ですがおろそかにできないのが<a class="ulink" href="http://www.postgresql.org" target="_top">PostgreSQL DBMS</a>です。PostGISはこの巨人の肩に乗っています。PostGISの速度と柔軟性はPostgreSQLが提供する拡張性、偉大なクエリプランナ、GiSTインデクス、多数のSQL機能がないと成り立ちません。</p></dd></dl></div></div><div class="sect1" title="1.3. 追加情報"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id286926070"></a>1.3. 追加情報 </h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>最新のソフトウェア、ドキュメントおよびニュースについてはPostGISウェブサイト <a class="ulink" href="http://www.postgis.org" target="_top">http://www.postgis.org</a>をご覧下さい。 </p></li><li class="listitem"><p>ジオメトリ演算ライブラリGEOSに関する詳細情報は<a class="ulink" href="http://trac.osgeo.org/geos/" target="_top">
		http://trac.osgeo.org/geos/</a>をご覧下さい。</p></li><li class="listitem"><p>投影変換ライブラリProj4に関する詳細情報は<a class="ulink" href="http://trac.osgeo.org/proj/" target="_top">http://trac.osgeo.org/proj/</a>をご覧下さい。</p></li><li class="listitem"><p>データベースサーバPostgreSQLに関する詳細情報は、 PostgreSQLメインサイト<a class="ulink" href="http://www.postgresql.org" target="_top">http://www.postgresql.org</a>をご覧下さい。 </p></li><li class="listitem"><p>GiSTインデクスに関する詳細情報は、 PostgreSQL GiST開発サイト<a class="ulink" href="http://www.sai.msu.su/~megera/postgres/gist/" target="_top">http://www.sai.msu.su/~megera/postgres/gist/</a>をご覧下さい。</p></li><li class="listitem"><p>ンターネットマップサーバMapServerに関する詳細情報は<a class="ulink" href="http://mapserver.org/" target="_top">http://mapserver.org</a>をご覧下さい。</p></li><li class="listitem"><p>The "<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">Simple Features for
		Specification for SQL</a>"は、OpenGISコンソーシアムウェブサイト<a class="ulink" href="http://www.opengeospatial.org/" target="_top">http://www.opengeospatial.org/</a>にあります。</p></li></ul></div></div></div><div class="chapter" title="第2章 インストール"><div class="titlepage"><div><div><h2 class="title"><a name="postgis_installation"></a>第2章 インストール</h2></div></div></div><div class="toc"><p><b>目次</b></p><dl><dt><span class="sect1"><a href="#id286926897">2.1. 簡略版</a></span></dt><dt><span class="sect1"><a href="#id286926949">2.2. 必要なもの</a></span></dt><dt><span class="sect1"><a href="#id286927186">2.3. ソースの取得</a></span></dt><dt><span class="sect1"><a href="#PGInstall">2.4. インストール</a></span></dt><dd><dl><dt><span class="sect2"><a href="#installation_configuration">2.4.1. コンフィギュレーション</a></span></dt><dt><span class="sect2"><a href="#id286927660">2.4.2. ビルド</a></span></dt><dt><span class="sect2"><a href="#make_install_postgis_extensions">2.4.3. PostGIS EXTENSIONのビルドとデプロイ</a></span></dt><dt><span class="sect2"><a href="#id286963886">2.4.4. テスト</a></span></dt><dt><span class="sect2"><a href="#id286963945">2.4.5. インストール</a></span></dt></dl></dd><dt><span class="sect1"><a href="#create_new_db">2.5. PostgreSQL 9.1より前での空間データベースの作成</a></span></dt><dt><span class="sect1"><a href="#create_new_db_extensions">2.6. EXTENSIONを使った空間データベースの生成</a></span></dt><dt><span class="sect1"><a href="#loading_extras_tiger_geocoder">2.7. Tigerジオコーダのインストールとアップグレードとデータロード</a></span></dt><dd><dl><dt><span class="sect2"><a href="#install_tiger_geocoder">2.7.1. TigerジオコーダをPostGISデータベースで有効にする</a></span></dt><dt><span class="sect2"><a href="#upgrade_tiger_geocoder">2.7.2. Tigerジオコーダのアップデート</a></span></dt><dt><span class="sect2"><a href="#tiger_geocoder_loading_data">2.7.3. Tigerデータのロード</a></span></dt></dl></dd><dt><span class="sect1"><a href="#templatepostgis">2.8. 空間データベースをテンプレートから生成する</a></span></dt><dt><span class="sect1"><a href="#upgrading">2.9. アップグレード</a></span></dt><dd><dl><dt><span class="sect2"><a href="#soft_upgrade">2.9.1. ソフトアップグレード </a></span></dt><dt><span class="sect2"><a href="#hard_upgrade">2.9.2. ハードアップグレード</a></span></dt></dl></dd><dt><span class="sect1"><a href="#id286967270">2.10. 共通の問題</a></span></dt><dt><span class="sect1"><a href="#id286967348">2.11. JDBC</a></span></dt><dt><span class="sect1"><a href="#id286967438">2.12. ローダ/ダンパ </a></span></dt></dl></div><p>本章では、PostGISのインストールに必要な手順について説明します。</p><div class="sect1" title="2.1. 簡略版"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id286926897"></a>2.1. 簡略版</h2></div></div></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ラスタ機能は現在は選択可能ですが、デフォルトではインストールされます。PostgreSQL 9.1以上のエクステンションモデルを使ってインストールするには必須です。PostgreSQL 9.1以上を使用する場合は<a class="xref" href="#make_install_postgis_extensions" title="2.4.3. PostGIS EXTENSIONのビルドとデプロイ">「PostGIS EXTENSIONのビルドとデプロイ」</a>を参照してください。</p></td></tr></table></div><p>全ての.sqlファイルは、PostgreSQLのインストール先の share/contrib/postgis-2.0.0 フォルダにインストールされます。</p><p><code class="varname">postgis_comments.sql</code>, <code class="varname">raster_comments.sql</code>, <code class="varname">topology_comments.sql</code> は、関数ごとの簡易説明を生成するもので、pgAdmin IIIまたはpsqlを介してアクセスできます。psqlでは<code class="varname">\dd ST_SetPoint</code>等のコマンドを使います。</p><pre class="programlisting">tar xvfz postgis-2.0.0.tar.gz
cd postgis-2.0.0
./configure --with-raster --with-topology --with-gui
make
make install
createdb yourdatabase
createlang plpgsql yourdatabase
psql -d yourdatabase -f postgis.sql
psql -d yourdatabase -f postgis_comments.sql
psql -d yourdatabase -f spatial_ref_sys.sql
psql -d yourdatabase -f rtpostgis.sql
psql -d yourdatabase -f raster_comments.sql
psql -d yourdatabase -f topology/topology.sql
psql -d yourdatabase -f doc/topology_comments.sql

</pre><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>topology_comments.sqlは選択機能ですのでmake installまたはmake comments installでインストールされません。しかし<code class="varname">make comments</code>または<code class="varname">make topology_comments.sql</code>を実行すると、docsフォルダに生成されます。</p></td></tr></table></div><p>本章の残りで、上記のステップそれぞれの説明をします。</p></div><div class="sect1" title="2.2. 必要なもの"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id286926949"></a>2.2. 必要なもの</h2></div></div></div><p>
	  PostGISには、ビルド、利用するために、次のものが必要です。
	</p><p>
	  <span class="bold"><strong>必須</strong></span>
	</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>PostgreSQL 8.4以上。PostgreSQLの完全なインストール(サーバヘッダを含む)が必要です。PostgreSQLは<a class="ulink" href="http://www.postgresql.org/" target="_top">http://www.postgresql.org/</a>にあります。</p><p>完全なPosgreSQL/PostGIS対応表とPostGIS/GEOS対応表については<a class="ulink" href="http://trac.osgeo.org/postgis/wiki/UsersWikiPostgreSQLPostGIS" target="_top">http://trac.osgeo.org/postgis/wiki/UsersWikiPostgreSQLPostGIS</a>をご覧ください。</p></li><li class="listitem"><p>GNU Cコンパイラ(<code class="filename">gcc</code>)。ANSI Cコンパイラの中には、PostGISをコンパイルできるものもありますが、<code class="filename">gcc</code>でコンパイルするのが最も問題が少ないと見ています。</p></li><li class="listitem"><p>GNU Make (<code class="filename">gmake</code> または <code class="filename">make</code>)。多くのシステムで、GNU <code class="filename">make</code>がデフォルトのmakeになっています。<code class="filename">make -v</code>を実行して版を確認して下さい。他版のmakeでは、PostGISの<code class="filename">Makefile</code>を完全に処理しきれないかもしれません。</p></li><li class="listitem"><p>投影変換ライブラリ Proj4 の 4.6.0版以上。Proj4ライブラリは、PostGISの座標系投影変換機能に使われます。Proj4は、<a class="ulink" href="http://trac.osgeo.org/proj/" target="_top">http://trac.osgeo.org/proj/</a>からダウンロードできます。</p></li><li class="listitem"><p>ジオメトリライブラリGEOSの3.2.2版以上。GEOS 3.3.2以上を推奨します。GEOS 3.3以外では、トポロジ例外処理やジオメトリ評価の改善、ST_ValidDetailやST_MakeValidといったジオメトリ評価等の主要な強化が使えません。また、GEOS 3.3.2以上はトポロジ機能に必須です。GEOSは<a class="ulink" href="http://trac.osgeo.org/geos/" target="_top">http://trac.osgeo.org/geos/</a>からダウンロードできます。3.3以上は古い版との後方互換があるのでアップグレードはかなり安全です。</p></li><li class="listitem"><p>LibXML2の2.5.x以上。LibXML2は現在取り込み関数 (ST_GeomFromGMLとST_GeomFromKML)で使っています。LibXML2は<a class="ulink" href="http://xmlsoft.org/downloads.html" target="_top">http://xmlsoft.org/downloads.html</a>からダウンロード可能です。</p></li><li class="listitem"><p>JSON-C 0.9以上。JSON-Cは現在、ST_GeomFromGeoJsonによるGeoJSONの取り込みに使われます。JSON-Cは<a class="ulink" href="http://oss.metaparadigm.com/json-c/" target="_top">http://oss.metaparadigm.com/json-c/</a>からダウンロード可能です。</p></li><li class="listitem"><p>GDAL 1.6以上 (古い版では一部機能が働かないので1.9以上が望ましいです)。ラスタ機能に必要で、PostGIS 2.0の最終リリースには必須になります。<a class="ulink" href="http://trac.osgeo.org/gdal/wiki/DownloadSource" target="_top">http://trac.osgeo.org/gdal/wiki/DownloadSource</a>からダウンロード可能です。</p></li></ul></div><p>
	  <span class="bold"><strong>オプション</strong></span>
	</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>GTK (GTK+2.0が必要)。シェープファイルのローダであるshp2pgsql-guiのコンパイル用。<a class="ulink" href="http://www.gtk.org/" target="_top">http://www.gtk.org/</a>。</p></li><li class="listitem"><p>CUnit (<code class="filename">CUnit</code>)。レグレッションテスト用。<a class="ulink" href="http://cunit.sourceforge.net/" target="_top">http://cunit.sourceforge.net/</a>。</p></li><li class="listitem"><p>javaディレクトリ下のドライバのビルドを行うにはApache Ant (<code class="filename">ant</code>)が必要です。Antは<a class="ulink" href="http://ant.apache.org/" target="_top">http://ant.apache.org/</a>からダウンロード可能です。</p></li><li class="listitem"><p>文書のビルドにはDocBook (<code class="filename">xsltproc</code>)が必要です。Docbookは<a class="ulink" href="http://www.docbook.org/" target="_top">http://www.docbook.org/</a>にあります。</p></li><li class="listitem"><p>文書をPDFでビルドするにはDBLatex (d<code class="filename">blatex</code>)が必要です。DBLatexは<a class="ulink" href="http://dblatex.sourceforge.net/" target="_top">http://dblatex.sourceforge.net/</a>にあります。</p></li><li class="listitem"><p>文書で使う画像を生成するにはImageMagick (<code class="filename">convert</code>)が必要です。ImageMagixは<a class="ulink" href="http://www.imagemagick.org/" target="_top">http://www.imagemagick.org/</a>にあります。</p></li></ul></div></div><div class="sect1" title="2.3. ソースの取得"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id286927186"></a>2.3. ソースの取得</h2></div></div></div><p>ダウンロードサイト<a class="ulink" href="http://www.postgis.org/download/postgis-2.0.0.tar.gz" target="_top">http://www.postgis.org/download/postgis-2.0.0.tar.gz</a>から、ソースのアーカイブを入手します。</p><pre class="programlisting">wget http://www.postgis.org/download/postgis-2.0.0.tar.gz
tar -xvzf postgis-2.0.0.tar.gz</pre><p>これで、カレントディレクトリの下に<code class="varname">postgis-2.0.0</code>ができます。</p><p>もしくは<a class="ulink" href="http://subversion.apache.org/" target="_top">svn</a>レポジトリ<a class="ulink" href="http://svn.osgeo.org/postgis/trunk/" target="_top">http://svn.osgeo.org/postgis/trunk/</a>からチェックアウトします。</p><pre class="programlisting">svn checkout http://svn.osgeo.org/postgis/trunk/ postgis-2.0.0</pre><p>新しく作られた<code class="varname">postgis-2.0.0</code>ディレクトトリに移動して、インストールを続けます。</p></div><div class="sect1" title="2.4. インストール"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="PGInstall"></a>2.4. インストール</h2></div></div></div><div class="toc"><dl><dt><span class="sect2"><a href="#installation_configuration">2.4.1. コンフィギュレーション</a></span></dt><dt><span class="sect2"><a href="#id286927660">2.4.2. ビルド</a></span></dt><dt><span class="sect2"><a href="#make_install_postgis_extensions">2.4.3. PostGIS EXTENSIONのビルドとデプロイ</a></span></dt><dt><span class="sect2"><a href="#id286963886">2.4.4. テスト</a></span></dt><dt><span class="sect2"><a href="#id286963945">2.4.5. インストール</a></span></dt></dl></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>多くのOSでは、ビルドされたPostgreSQL/PostGISパッケージがあります。 多くの場合、コンパイルが必要なのは、最もひどい最先端の版が欲しい場合やパッケージメンテナンスを行う人ぐらいです。</p><p>
本節では、一般的なコンパイル手順を示します。Windows用や他のOS用等にコンパイルするなら、<a class="ulink" href="http://trac.osgeo.org/postgis/wiki/DevWikiMain" target="_top">PostGIS Dev Wiki</a>(コンパイルとインストールガイドの節)で、より詳細な助けを見つけるかも知れません。</p><p>Windowsユーザの場合、安定的なビルドをスタックビルダまたは<a class="ulink" href="http://www.postgis.org/download/windows/" target="_top">PostGIS Windows download site</a>で入手できます。また、<a class="ulink" href="http://www.postgis.org/download/windows/experimental.php" target="_top">とてもひどい最先端の版のビルド</a>もあり、週1, 2回ビルドしていますし、刺激的なことが発生した際は随時ビルドしています。PostGISの開発中の版で試験する際に使えます。</p></td></tr></table></div><p>PostGISモジュールは、PostgreSQLバックエンドサーバの拡張です。PostGIS 2.0.0では、コンパイルのために、完全なPostgreSQLサーバヘッダが<span class="emphasis"><em>必要です</em></span>。PostgreSQL 8.4以上でビルドできます。古い版のPostgreSQLは<span class="emphasis"><em>サポートされません</em></span>。</p><p>PostgreSQLをインストールしていないならPostgreSQLインストールガイドを参照して下さい。<a class="ulink" href="http://www.postgresql.org/" target="_top">http://www.postgresql.org/</a>にあります。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>GEOS機能を有効にするために、PostgreSQLをインストールするときに明示的に標準C++ライブラリに対する明示的なリンクが必要になる場合があります。</p><pre class="programlisting">LDFLAGS=-lstdc++ ./configure [YOUR OPTIONS HERE]</pre><p>これは、古い開発ツールとインチキC++例外との対話のための応急処置です。怪しい問題(望んでいないのにバックエンドが閉じたりそれに近い挙動を起こす)を経験したなら、このトリックを試してみて下さい。もちろん、これを行うにはPostgreSQLをはじめからコンパイルし直す必要があります。</p></td></tr></table></div><p>次のステップでは、PostGISソースのコンフィギュレーションとコンパイルに概要を記述します。 これらは、Linuxユーザ用に書いてありますので、WindowsやMacでは動作しません。</p><div class="sect2" title="2.4.1. コンフィギュレーション"><div class="titlepage"><div><div><h3 class="title"><a name="installation_configuration"></a>2.4.1. コンフィギュレーション</h3></div></div></div><p>ほとんどのLinuxのインストールと同様に、最初のステップでは、ソースコードのビルドに使われる Makefile を生成します。これは、シェルスクリプトで行います。</p><p>
		<span class="command"><strong>./configure</strong></span>
	  </p><p>パラメータを付けない場合には、このコマンドは自動で、PostGISのソースコードのビルドを行うのに必要なコンポーネントやライブラリをシステム上で探します。<span class="command"><strong>./configure</strong></span>とするのが一般的な使い方ですが、標準的でない位置に必要なライブラリやプログラムを置いてある場合のために、いくつかのパラメータを受け付けます。</p><p>次のリストで、共通して使われるパラメータを示します。 完全なリストについては、<span class="command"><strong>--help</strong></span>または<span class="command"><strong>--help=short</strong></span>パラメータを使って下さい。</p><div class="variablelist"><dl><dt><span class="term"><span class="command"><strong>--prefix=PREFIX</strong></span></span></dt><dd><p>PostGISライブラリとSQLスクリプトのインストール先を指定します。 デフォルトでは、検出されたPostgreSQLのインストール先と同じになります。</p><div class="caution" title="注意" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Caution"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注意]" src="images/caution.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>このパラメータは現在のところ壊れていて、PostgreSQLのインストール先にしかインストールされません。このバグのトラックについては<a class="ulink" href="http://trac.osgeo.org/postgis/ticket/635" target="_top">http://trac.osgeo.org/postgis/ticket/635</a>をご覧ください。</p></td></tr></table></div></dd><dt><span class="term"><span class="command"><strong>--with-pgconfig=FILE</strong></span></span></dt><dd><p>PostgreSQLは、PostGISなどの拡張に対してPostgreSQLのインストール先ディレクトリを伝える<span class="command"><strong>pg_config</strong></span>というユーティリティを持っています。PostGISの対象とするPostgreSQLインストール先を手動で指定する場合は、このパラメータ(<span class="command"><strong>--with-pgconfig=/path/to/pg_config</strong></span>)を使います。</p></dd><dt><span class="term"><span class="command"><strong>--with-gdalconfig=FILE</strong></span></span></dt><dd><p>必須ライブラリであるGDALはラスタ機能に必要な機能を提供します。GDALインストール先ディレクトリをインストールスクリプトに伝える<span class="command"><strong>gdal-config</strong></span>を提供しています。PostGISのビルドに使う特定のGDALを手動で指定する場合は、このパラメータ(<span class="command"><strong>--with-gdalconfig=/path/to/gdal-config</strong></span>)を使います。</p></dd><dt><span class="term"><span class="command"><strong>--with-geosconfig=FILE</strong></span></span></dt><dd><p>必須のジオメトリライブラリであるGEOSは、ソフトウェアのインストール時にGEOSのインストール先ディレクトリを伝える<span class="command"><strong>geos-config</strong></span>というユーティリティを持っています。PostGISのビルドに使う特定のGEOSを手動で指定する場合は、このパラメータ(<span class="command"><strong>--with-geosconfig=/path/to/geos-config</strong></span>)を使います。</p></dd><dt><span class="term"><span class="command"><strong>--with-xml2config=FILE</strong></span></span></dt><dd><p>LibXMLはGeomFromKML/GML処理を行うのに必須のライブラリです。通常はlibxmlをインストールしているなら発見されますが、発見できない場合や特定の版を使用したい場合は、PostGISに<code class="filename">xml2-config</code>を指定してインストールスクリプトにLibXMLのインストール先ディレクトリを伝えます。PostGISのビルドに使う特定のLibXMLを手動で指定する場合は、このパラメータ(<span class="command"><strong>--with-xml2config=/path/to/xml2-config</strong></span>)を使います。</p></dd><dt><span class="term"><span class="command"><strong>--with-projdir=DIR</strong></span></span></dt><dd><p>Proj4はPostGISに必須の投影変換ライブラリです。PostGISのビルドに使う特定のProj4のディレクトリを手動で指定する場合は、このパラメータ(<span class="command"><strong>--with-projdir=/path/to/projdir</strong></span>)を使います。</p></dd><dt><span class="term"><span class="command"><strong>--with-libiconv=DIR</strong></span></span></dt><dd><p>iconvのインストール先ディレクトリを指定します。</p></dd><dt><span class="term"><span class="command"><strong>--with-jsondir=DIR</strong></span></span></dt><dd><p><a class="ulink" href="http://oss.metaparadigm.com/json-c/" target="_top">JSON-C</a>は、MITライセンスのJSONライブラリで、PostGISのST_GeomFromJSON機能に必須です。PostGISのビルドに使う特定のJSON-Cを手動で指定する場合は、このパラメータ(<span class="command"><strong>--with-jsondir=/path/to/jsondir</strong></span>)を使います。</p></dd><dt><span class="term"><span class="command"><strong>--with-gui</strong></span></span></dt><dd><p>データインポートGUI(GTK+2.0が必要)をコンパイルします。このパラメータによって、shp2pgsql-guiという、shp2pgsqlのグラフィカルユーザインタフェースが作成されます。</p></dd><dt><span class="term"><span class="command"><strong>--with-raster</strong></span></span></dt><dd><p>ラスタ機能付きでコンパイルします。これによりrtpostgis-2.0.0ライブラリとrtpostgis.sqlファイルが生成されます。最終リリースでは、デフォルトでラスタ機能付きにする予定ですので、このパラメータ自体は不要になる可能性があります。</p></dd><dt><span class="term"><span class="command"><strong>--with-topology</strong></span></span></dt><dd><p>トポロジ機能付きでコンパイルします。これによりtopology.sqlファイルが生成されます。トポロジに必要なロジックは全てpostgis-2.0.0ライブラリ内に作られるので、関連ライブラリはありません。</p></dd><dt><span class="term"><span class="command"><strong>--with-gettext=no</strong></span></span></dt><dd><p>デフォルトでは、gettextの検出とこれを用いたコンパイルを試みますが、ローダ破損を引き起こす非互換性問題下で実行する場合には、このコマンドで無効にできます。これを使ったコンフィギュレーションによって解決する問題の例は<a class="ulink" href="http://trac.osgeo.org/postgis/ticket/748" target="_top">http://trac.osgeo.org/postgis/ticket/748</a>にあります。ご注意: これを切ることで多くを逃すわけではありません。まだ文書化されていなくて試験段階であるGUIローダにおける内部のヘルプ/ラベル機能に使われています。</p></dd></dl></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>PostGISをSVN<a class="ulink" href="http://svn.osgeo.org/postgis/trunk/" target="_top">レポジトリ</a>から得る場合には、はじめに次のスクリプトを実行します。</p><p>
		  <span class="command"><strong>./autogen.sh</strong></span>
		</p><p>このスクリプトによって<span class="command"><strong>configure</strong></span>スクリプトが生成されます。これはPostGISのインストールに関するカスタマイズに使われます。</p><p>PostGISをアーカイブファイルとして入手する場合には、<span class="command"><strong>configure</strong></span>が既に生成されているので<span class="command"><strong>./autogen.sh</strong></span>は不要です。</p></td></tr></table></div></div><div class="sect2" title="2.4.2. ビルド"><div class="titlepage"><div><div><h3 class="title"><a name="id286927660"></a>2.4.2. ビルド</h3></div></div></div><p>Makefileが生成されたら、PostGISのビルドは、次のコマンドを実行するだけです。</p><p>
		<span class="command"><strong>make</strong></span>
	  </p><p>出力の最後の行が "<code class="code">PostGIS was built successfully. Ready to install.</code>" と出れば終わりです。</p><p>PostGIS 1.4.0版からは、全ての関数に文書から生成されるコメントが付きます。これらのコメントを後ほどインストールするには、次のコマンドを実行しますが、docbookが必要です。アーカイブファイルからインストールする場合は、postgis_comments.sql, raster_comments.sql, topology_comments.sqlは、docフォルダにあるので、コメントを作成する必要はありません。</p><p>
		<span class="command"><strong>make comments</strong></span>
	  </p><p>PostGIS 2.0で導入されました。早見表や学習中の方のハンドアウトに適しているHTMLチートシートを生成します。xsltprocが必要で、<code class="filename">topology_cheatsheet.html</code>, <code class="filename">tiger_geocoder_cheatsheet.html</code>, <code class="filename">raster_cheatsheet.html</code>, <code class="filename">postgis_cheatsheet.html</code>の4ファイルが生成されます。</p><p>HTMLとPDFのビルド済みのものは<a class="ulink" href="http://www.postgis.us/study_guides" target="_top">PostGIS / PostgreSQL Study Guides</a>にあります。</p><p>
		<span class="command"><strong>make cheatsheets</strong></span>
	  </p></div><div class="sect2" title="2.4.3. PostGIS EXTENSIONのビルドとデプロイ"><div class="titlepage"><div><div><h3 class="title"><a name="make_install_postgis_extensions"></a>2.4.3. PostGIS EXTENSIONのビルドとデプロイ</h3></div></div></div><p>PostGIS EXTENSIONはPostgreSQL 9.1以上で使えます。extensionsフォルダに移動してmake installを実行するとビルドできます。この処理は将来的に、9.1を対象としてコンパイルする時に自動化され、ビルド処理の中に完全に統合されます。</p><p>ソースレポジトリからビルドしている場合は、関数の記述を最初にビルドする必要があります。</p><pre class="programlisting">make comments</pre><p>アーカイブファイルからのビルドの場合は、ビルド済みのものがあるので、コメントのビルドは必須ではありません。</p><p>PostgreSQL 9.1を対象にビルドしている場合は、extensionsは自動的にmake install処理の一部としてビルドするべきです。必要ならextensionsフォルダからビルドできますし、他のサーバで必要ならファイルの複製ができます。</p><pre class="programlisting">cd extensions
cd postgis
make clean
make 
make install
cd ..
cd postgis_topology
make clean
make 
make install
	  </pre><p>EXTENSIONファイルは、OSに関係なく、常に同じ版のPostGISと同じです。PostGISバイナリを既にインストールしている限りは、EXTENSIONファイルを上をあるOSから別のものに複写して大丈夫です。</p><p>開発用と異なる別のサーバでEXTENSIONを手動でインストールしたい場合は、次のファイルをEXTENSIONフォルダからPostgreSQLインストール先の<code class="filename">PostgreSQL / share / extension</code>フォルダに複写します。通常のPostGISで、サーバに無い場合に必要になるバイナリと同じです。</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>指定されていない場合のインストールするextensionの版等の情報を示す制御ファイル<code class="filename">postgis.control</code>, <code class="filename">postgis_topology.control</code>。</p></li><li class="listitem"><p>EXTENSION毎の/sqlフォルダにあるファイル全て。PostgreSQLのshare/extensionフォルダである<code class="filename">extensions/postgis/sql/*.sql</code>, <code class="filename">extensions/postgis_topology/sql/*.sql</code>の最上位に複写する必要があることに注意して下さい。</p></li></ul></div><p>実行すると、PgAdmin-&gt;extensionで<code class="varname">postgis</code>, <code class="varname">postgis_topology</code>が有効なEXTENSIONとして見えます。</p><p>psqlを使う場合は、次のクエリを実行してEXTENSIONがインストールされていることを確認できます。</p><pre class="programlisting">SELECT name, default_version,installed_version 
FROM pg_available_extensions WHERE name LIKE 'postgis%' ;
      name       | default_version | installed_version
-----------------+-----------------+-------------------
postgis          | 2.0.0     | 2.0.0
postgis_topology | 2.0.0      | </pre><p>クエリを行ったデータベースにEXTENSIONがインストールされている場合は、<code class="varname">installed_version</code>カラムに記載が見えます。
レコードブロックが無い場合は、PostGIS EXTENSIONがインストールされていないことになります。PgAdmin III 1.4以上では、データベースブラウザツリーの<code class="varname">extensions</code>セクションで提供されていて、右クリックでアップグレードまたアンインストールできます。</p><p>有効なEXTENSIONがある場合、pgAdmin EXTENSIONインタフェースまたは次のSQLの実行によって選択したデータベースにPostGIS EXTENSIONをインストールできます。</p><pre class="programlisting">CREATE EXTENSION postgis;
CREATE EXTENSION postgis_topology;</pre><p>この素晴らしいEXTENSION機能を使わずに2.0.0をインストールした場合でもEXTENSIONベースに変更することができます。まず<code class="filename">postgis_upgrade_20_minor.sql</code>, <code class="filename">raster_upgrade_20_minor.sql</code>, <code class="filename">topology_upgrade_20_minor.sql</code>のアップグレードスクリプトを実行して最新版にアップグレードします。</p><p>ラスタ機能無しでPostGISをインストールした場合には、最初にラスタ機能をインストールする必要があります(<code class="filename">rtpostgis.sql</code>を使います)。</p><p>それから、次のコマンドを実行して、個々のEXTENSIONの関数をEXTENSION形式に更新します。</p><pre class="programlisting">CREATE EXTENSION postgis FROM unpackaged;
CREATE EXTENSION postgis_topology FROM unpackaged;</pre></div><div class="sect2" title="2.4.4. テスト"><div class="titlepage"><div><div><h3 class="title"><a name="id286963886"></a>2.4.4. テスト</h3></div></div></div><p>PostGISのテストを行うには、次のコマンドを実行します。</p><p>
		<span class="command"><strong>make check</strong></span>
	  </p><p>このコマンドで、実際のPostgreSQLデータベースに対して生成したライブラリを使用した、様々なチェックとレグレッションテストを行います。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>PostgreSQL, GEOS または Proj4 を標準の位置にインストールしていない場合には、環境変数LD_LIBRARY_PATHに、ライブラリの位置を追加する必要があるかも知れません。</p></td></tr></table></div><div class="caution" title="注意" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Caution"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注意]" src="images/caution.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>現在のところ<span class="command"><strong>make check</strong></span>は、チェックを行う際に 環境変数<code class="code">PATH</code>と<code class="code">PGPORT</code>によっています。コンフィギュレーションパラメータ<span class="command"><strong>--with-pgconfig</strong></span>を使って特定したPostgreSQL<span class="emphasis"><em>ではありません</em></span>。PATHを編集して、コンフィギュレーションの際に検出したPostgreSQLと一致するようにして下さい。もしくは、間もなく襲ってくる頭痛の準備をしておいて下さい。</p></td></tr></table></div><p>成功した場合は、テストの出力は次のようなかんじになります。</p><pre class="programlisting">     CUnit - A Unit testing framework for C - Version 2.1-0
	 http://cunit.sourceforge.net/


Suite: print_suite
  Test: test_lwprint_default_format ... passed
  Test: test_lwprint_format_orders ... passed
  Test: test_lwprint_optional_format ... passed
  Test: test_lwprint_oddball_formats ... passed
  Test: test_lwprint_bad_formats ... passed
Suite: Misc Suite
  Test: test_misc_force_2d ... passed
  Test: test_misc_simplify ... passed
  Test: test_misc_count_vertices ... passed
  Test: test_misc_area ... passed
  Test: test_misc_wkb ... passed
Suite: PointArray Suite
  Test: test_ptarray_append_point ... passed
  Test: test_ptarray_append_ptarray ... passed
Suite: PostGIS Computational Geometry Suite
  Test: test_lw_segment_side ... passed
  Test: test_lw_segment_intersects ... passed
  Test: test_lwline_crossing_short_lines ... passed
  Test: test_lwline_crossing_long_lines ... passed
  Test: test_lwline_crossing_bugs ... passed
  Test: test_lwpoint_set_ordinate ... passed
  Test: test_lwpoint_get_ordinate ... passed
  Test: test_point_interpolate ... passed
  Test: test_lwline_clip ... passed
  Test: test_lwline_clip_big ... passed
  Test: test_lwmline_clip ... passed
  Test: test_geohash_point ... passed
  Test: test_geohash_precision ... passed
  Test: test_geohash ... passed
  Test: test_isclosed ... passed
Suite: PostGIS Measures Suite
  Test: test_mindistance2d_tolerance ... passed
  Test: test_rect_tree_contains_point ... passed
  Test: test_rect_tree_intersects_tree ... passed
  Test: test_lwgeom_segmentize2d ... passed
Suite: WKT Out Suite
  Test: test_wkt_out_point ... passed
  Test: test_wkt_out_linestring ... passed
  Test: test_wkt_out_polygon ... passed
  Test: test_wkt_out_multipoint ... passed
  Test: test_wkt_out_multilinestring ... passed
:
:
--Run Summary: Type      Total     Ran  Passed  Failed
               suites       17      17     n/a       0
               tests       143     143     143       0
               asserts    1228    1228    1228       0


Creating spatial db postgis_reg
 Postgis 2.0.0SVN - 2011-01-11 15:33:37
   GEOS: 3.3.0-CAPI-1.7.0
   PROJ: Rel. 4.6.1, 21 August 2008

Running tests

 loader/Point.............. ok
 loader/PointM.............. ok
 loader/PointZ.............. ok
 loader/MultiPoint.............. ok
 loader/MultiPointM.............. ok
 loader/MultiPointZ.............. ok
 loader/Arc.............. ok
 loader/ArcM.............. ok
 loader/ArcZ.......... ok
 loader/Polygon.............. ok
 loader/PolygonM.............. ok
 loader/PolygonZ.............. ok
 regress. ok
 regress_index. ok
 regress_index_nulls. ok
 lwgeom_regress. ok
 regress_lrs. ok
 removepoint. ok
 setpoint. ok
 simplify. ok
 snaptogrid. ok
 affine. ok
 measures. ok
 long_xact. ok
 ctors. ok
 sql-mm-serialize. ok
 sql-mm-circularstring. ok
 sql-mm-compoundcurve. ok
 sql-mm-curvepoly. ok
 sql-mm-general. ok
 sql-mm-multicurve. ok
 sql-mm-multisurface. ok
 polyhedralsurface. ok
 out_geometry. ok
 out_geography. ok
 in_gml. ok
 in_kml. ok
 iscollection. ok
 regress_ogc. ok
 regress_ogc_cover. ok
 regress_ogc_prep. ok
 regress_bdpoly. ok
 regress_proj. ok
 dump. ok
 dumppoints. ok
 wmsservers_new. ok
 tickets. ok
 remove_repeated_points. ok
 split. ok
 relatematch. ok
 regress_buffer_params. ok
 hausdorff. ok
 clean. ok
 sharedpaths. ok
 snap. ok

Run tests: 55
Failed: 0
</pre></div><div class="sect2" title="2.4.5. インストール"><div class="titlepage"><div><div><h3 class="title"><a name="id286963945"></a>2.4.5. インストール</h3></div></div></div><p>PostGISをインストールするには、次のコマンドを実行します。</p><p>
		<span class="command"><strong>make install</strong></span>
	  </p><p>これにより、PostGISのインストールファイルが、<span class="command"><strong>--prefix</strong></span>パラメータで指定した、適切なサブディレクトリに複写されます。次に特筆すべきサブディレクトリを示します。</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>ローダとダンパのバイナリのインストール先は<code class="filename">[prefix]/bin</code>です。</p></li><li class="listitem"><p><code class="filename">postgis.sql</code>などのSQLファイルのインストール先は<code class="filename">[prefix]/share/contrib</code>です。</p></li><li class="listitem"><p>PostGISライブラリのインストール先は<code class="filename">[prefix]/lib</code>です。</p></li></ul></div><p>先に<span class="command"><strong>make comments</strong></span>を実行していた場合は、次のコマンドを実行すると、SQLファイルのインストール先に<code class="filename">postgis_comments.sql</code>, <code class="filename">raster_comments.sql</code>がインストールされます。</p><p>
		<span class="command"><strong>make comments-install</strong></span>
	  </p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="filename">postgis_comments.sql</code>, <code class="filename">raster_comments.sql</code>, <code class="filename">topology_comments.sql</code>は、<span class="command"><strong>xsltproc</strong></span>の外部依存ができたので、通常のビルドとインストールから切り離されました。</p></td></tr></table></div></div></div><div class="sect1" title="2.5. PostgreSQL 9.1より前での空間データベースの作成"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="create_new_db"></a>2.5. PostgreSQL 9.1より前での空間データベースの作成</h2></div></div></div><p>PostGISデータベースを作る最初のステップは、単純なPostgreSQLデータベースの作成です. </p><p>
	  <span class="command"><strong>createdb [yourdatabase]</strong></span>
	</p><p>多くのPostGIS関数は、PL/pgSQL手続き言語で書かれています。 次のステップは、PL/pgSQL言語を新たに作成したデータベースで有効にすることです。 次のコマンドを実行します。PostgreSQL 8,4以上では、通常は既にインストールされています。</p><p>
	  <span class="command"><strong>createlang plpgsql [yourdatabase]</strong></span>
	</p><p>次に、PostGISオブジェクトと関数定義をデータベースにロードします。定義ファイル<code class="filename">postgis.sql</code>(コンフィギュレーション段階で指定した<code class="filename">[prefix]/share/contrib</code>にあります)をロードします。</p><p>
	  <span class="command"><strong>psql -d [yourdatabase] -f postgis.sql</strong></span>
	</p><p>完全なEPSG座標系定義IDセットについては、<code class="filename">spatial_ref_sys.sql</code>定義ファイルをロードして<code class="varname">spatial_ref_sys</code>を生成して下さい。これによりジオメトリ関数ST_Transform()が実行できるようになります。</p><p>
	  <span class="command"><strong>psql -d [yourdatabase] -f spatial_ref_sys.sql</strong></span>
	</p><p>PostGISが持つ関数についての助けとなるコメントが必要なら、<code class="filename">postgis_comments.sql</code>を、データベースにロードします。コメントは、<span class="command"><strong>psql</strong></span>ターミナルウィンドウで単に<span class="command"><strong>\dd [function_name]</strong></span>とすれば見ることができます。ロードは次のようにします。</p><p>
	  <span class="command"><strong>psql -d [yourdatabase] -f postgis_comments.sql</strong></span>
	</p><p>
	  ラスタ機能をインストールします。
	</p><p>
	  <span class="command"><strong>psql -d [yourdatabase] -f rtpostgis.sql</strong></span>
	</p><p>ラスタ機能のコメントをインストールします。ラスタ関数ごとの簡易説明が提供されます。psqlまたはPgAdmin等の関数コメントを表示できるPostgreSQLツールで使えます。</p><p>
	  <span class="command"><strong>psql -d [yourdatabase] -f raster_comments.sql</strong></span>
	</p><p>
	  トポロジ機能をインストールします。
	</p><p>
	  <span class="command"><strong>psql -d [yourdatabase] -f topology/topology.sql</strong></span>
	</p><p>トポロジ機能のコメントをインストールします。トポロジ関数/型ごとの簡易説明が提供されます。psqlまたはPgAdmin等の関数コメントを表示できるPostgreSQLツールで使えます。</p><p>
	  <span class="command"><strong>psql -d [yourdatabase] -f topology/topology_comments.sql</strong></span>
	</p><p>以前の版の古いバックアップを新しいデータベースにリストアする予定の場合には、次を実行します。</p><p><span class="command"><strong>psql -d [yourdatabase] -f legacy.sql</strong></span></p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>テーブルを回復し、MapServerやGeoServerのようなアプリケーションで動作させるのに必要な最低限をインストールするには<code class="filename">legacy_minimal.sql</code>という選択肢があります。distance/length等のようなものを使うビューがあるなら、<code class="filename">legacy.sql</code>が必要になります。</p></td></tr></table></div><p>リストアとクリーンアップを行った後で非推奨関数を消すために<code class="filename">uninstall_legacy.sql</code>を実行できます。</p></div><div class="sect1" title="2.6. EXTENSIONを使った空間データベースの生成"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="create_new_db_extensions"></a>2.6. EXTENSIONを使った空間データベースの生成</h2></div></div></div><p>PostgreSQL 9.1以上を使っていて、extensions/のPostGISモジュールをコンパイルとインストールを行っている場合は、新しい方法で空間データベースを生成できます。</p><p>
	  <span class="command"><strong>createdb [yourdatabase]</strong></span>
	</p><p>単純な</p><pre class="programlisting">CREATE EXTENSION postgis;</pre><p>によって、PostGIS EXTENSIONの中核によって、PostGISのGEOMETRY, GEOGRAPHY, RASTER, spatial_ref_sysおよび関数とコメントがインストールされます。</p><p>
	  <span class="command"><strong>psql -d [yourdatabase] -c "CREATE EXTENSION postgis;"</strong></span>
	</p><p>トポロジは別のEXTENSIONとして用意されています。次のコマンドでインストールします。</p><p>
	  <span class="command"><strong>psql -d [yourdatabase] -c "CREATE EXTENSION postgis_topology;"</strong></span>
	</p><p>以前の版の古いバックアップを新しいデータベースにリストアする予定の場合には、次を実行します。</p><p><span class="command"><strong>psql -d [yourdatabase] -f legacy.sql</strong></span></p><p>リストアとクリーンアップを行った後で非推奨関数を消すために<code class="filename">uninstall_legacy.sql</code>を実行できます。</p></div><div class="sect1" title="2.7. Tigerジオコーダのインストールとアップグレードとデータロード"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="loading_extras_tiger_geocoder"></a>2.7. Tigerジオコーダのインストールとアップグレードとデータロード</h2></div></div></div><div class="toc"><dl><dt><span class="sect2"><a href="#install_tiger_geocoder">2.7.1. TigerジオコーダをPostGISデータベースで有効にする</a></span></dt><dt><span class="sect2"><a href="#upgrade_tiger_geocoder">2.7.2. Tigerジオコーダのアップデート</a></span></dt><dt><span class="sect2"><a href="#tiger_geocoder_loading_data">2.7.3. Tigerデータのロード</a></span></dt></dl></div><p>Tigerジオコーダは、地域限定なので中核のPostGISスクリプトでインストール/アップデートされません。extrasフォルダ内にあるものは正規のPostGISインストール/アップグレードの際はデフォルトではインストールされません。Tigerジオコーダのようなextrasは、PostGISディストリビューションには含まれませんが、常にpostgis-2.0.0.tar.gzには存在します。ここで提供する説明は<code class="filename">extras/tiger_geocoder/tiger_2010/README</code>にもあります。</p><p>Windows上でtarの展開ができない場合は、<a class="ulink" href="http://www.7-zip.org/" target="_top">http://www.7-zip.org/</a>でPostGISのアーカイブファイルを展開できます。</p><div class="sect2" title="2.7.1. TigerジオコーダをPostGISデータベースで有効にする"><div class="titlepage"><div><div><h3 class="title"><a name="install_tiger_geocoder"></a>2.7.1. TigerジオコーダをPostGISデータベースで有効にする</h3></div></div></div><p>
		  まず前述のPostGISのインストールを行います。
		</p><p>
		  extrasフォルダが無い場合は<a class="ulink" href="http://www.postgis.org/download/postgis-2.0.0.tar.gz" target="_top">http://www.postgis.org/download/postgis-2.0.0.tar.gz</a>をダウンロードして下さい。
		</p><p>
		  <span class="command"><strong>tar xvfz postgis-2.0.0.tar.gz</strong></span>
		</p><p>
		  <span class="command"><strong>cd postgis-2.0.0/extras/tiger_geocoder/tiger_2010</strong></span>
		</p><p><code class="filename">tiger_loader.sql</code>のサーバ実行ファイルへのパス等を編集して下さい。</p><p>最初のTigerジオコーダのインストールで場合は、Windowsでは<code class="filename">create_geocode.bat</code>を、Linux/Unix/MacOS Xでは<code class="filename">create_geocode.sh</code>を、それぞれPostgreSQLの設定にあわせて編集します。コマンドラインから編集したスクリプトを実行します。このファイルを編集しない場合には、アイテムの位置が一般的なものになるだけです。<a class="xref" href="#Loader_Generate_Script" title="Loader_Generate_Script">Loader_Generate_Script</a>実行後に生成されたスクリプトは編集できます。</p><p>データベースに<code class="varname">tiger</code>スキーマがあるか確認して下さい。データベースのsearch_pathに含まれているかを確認して、含まれていない場合は、</p><pre class="programlisting">ALTER DATABASE geocoder SET search_path=public, tiger;</pre><p>コマンドで追加して下さい。</p><p>住所正規化機能は、ややこしい住所を除いて、データなしでも大体動きます。次に示すテストを行って確認して下さい。
			</p><pre class="programlisting">SELECT pprint_addy(normalize_address('202 East Fremont Street, Las Vegas, Nevada 89101')) As pretty_address;
pretty_address
---------------------------------------
202 E Fremont St, Las Vegas, NV 89101
			</pre><p>
		</p></div><div class="sect2" title="2.7.2. Tigerジオコーダのアップデート"><div class="titlepage"><div><div><h3 class="title"><a name="upgrade_tiger_geocoder"></a>2.7.2. Tigerジオコーダのアップデート</h3></div></div></div><p>
		  2.0に含まれるTigerジオコーダがインストールされている場合には、どうしても必要な訂正がある際の臨時のアーカイブファイルからでも機能のアップグレードができます。
		</p><p>
		  extrasフォルダが無い場合には<a class="ulink" href="http://www.postgis.org/download/postgis-2.0.0.tar.gz" target="_top">http://www.postgis.org/download/postgis-2.0.0.tar.gz</a>をダウンロードします。

		</p><p>
		  <span class="command"><strong>tar xvfz postgis-2.0.0.tar.gz</strong></span>
		</p><p>
		  <span class="command"><strong>cd postgis-2.0.0/extras/tiger_geocoder/tiger_2010</strong></span>
		</p><p>Windowsの場合は<code class="filename">upgrade_geocoder.bat</code>スクリプト、Linux/Unix/MacOS Xの場合は<code class="filename">upgrade_geocoder.sh</code>スクリプトの位置を特定します。
PostGISデータベースの資格情報を持つように編集し、コマンドラインからスクリプトを実行します。
		</p></div><div class="sect2" title="2.7.3. Tigerデータのロード"><div class="titlepage"><div><div><h3 class="title"><a name="tiger_geocoder_loading_data"></a>2.7.3. Tigerデータのロード</h3></div></div></div><p>より詳細なデータロードの説明は<code class="filename">extras/tiger_geocoder/tiger_2010/README</code>にあります。ここでは一般的な手順に触れるだけです。</p><p>ロード処理によって、センサスウェブサイトからそれぞれ求める州のデータをダウンロードし、ファイルを展開し、各州をそれぞれの州テーブルにロードします。

州テーブルは<code class="varname">tiger</code>スキーマで定義されているテーブルを継承しているので、全てのデータにアクセスするのは、これらのテーブルへのクエリで十分です。
また、ある州の再読み込みを行う必要がある場合や、それ以上の州が不要である場合に、
<a class="xref" href="#Drop_State_Tables_Generate_Script" title="Drop_State_Tables_Generate_Script">Drop_State_Tables_Generate_Script</a>を使って州テーブルの集合を削除します。</p><p>必要なデータをロードできるようにするため、次のツールが必要です。</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>センサスウェブサイトから得られるZIPファイルを展開するツール。</p><p>Unix系システム: Unix系プラットフォームでは通常インストール済みの実行ファイル<code class="varname">unzip</code>。</p><p>Windows: フリーの圧縮/解凍ツールで、<a class="ulink" href="http://www.7-zip.org/" target="_top">http://www.7-zip.org/</a>からダウンロードできる7-zip。</p></li><li class="listitem"><p>PostGISをインストールしたときにデフォルトでインストールされるコマンドラインツール<code class="filename">shp2pgsql</code>。</p></li><li class="listitem"><p>通常ほとんどのUnix/Linuxシステムでインストールされているウェブ取得ツール<code class="filename">wget</code>。</p><p>Windowsの場合には、コンパイル済みのバイナリを<a class="ulink" href="http://gnuwin32.sourceforge.net/packages/wget.htm" target="_top">http://gnuwin32.sourceforge.net/packages/wget.htm</a>から取得できます。</p></li></ul></div><p>データロードについては、求める州のデータをロードするスクリプトをプラットフォームに合わせて生成する<a class="xref" href="#Loader_Generate_Script" title="Loader_Generate_Script">Loader_Generate_Script</a>を参照して下さい。小さい単位でインストールできることに注意して下さい。求める州全てを一度にロードする必要はありません。必要に応じてロードすることができます。</p><p>求める州のダウンロードが終わった後に、次を実行します。
		</p><pre class="programlisting">SELECT install_missing_indexes();</pre><p> as described in  <a class="xref" href="#Install_Missing_Indexes" title="Install_Missing_Indexes">Install_Missing_Indexes</a></p><p>動作すべきように動作するかを試すために、ロードした州の住所のジオコードを<a class="xref" href="#Geocode" title="Geocode">Geocode</a>で実行してみます。</p></div></div><div class="sect1" title="2.8. 空間データベースをテンプレートから生成する"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="templatepostgis"></a>2.8. 空間データベースをテンプレートから生成する</h2></div></div></div><p>PostGISのディストリビューション(特にPostGIS &gt;= 1.1.5のWin32インストーラ)の中には、<code class="varname">template_postgis</code>というテンプレートにPostGIS関数をロードしていることがあります。PostgreSQLに<code class="varname">template_postgis</code>データベースが存在するなら、ユーザまたはアプリケーションは、空間データベースの生成がコマンドひとつで済みます。この二種類のやり方のどちらを使うににしても、データベースユーザは、新しいデータベースを作成する権限を与えられている必要があります。</p><p>
	  シェルからの実行:
	</p><pre class="programlisting"># createdb -T template_postgis my_spatial_db</pre><p>
	  SQLからの実行:
	</p><pre class="programlisting">postgres=# CREATE DATABASE my_spatial_db TEMPLATE=template_postgis</pre></div><div class="sect1" title="2.9. アップグレード"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="upgrading"></a>2.9. アップグレード</h2></div></div></div><div class="toc"><dl><dt><span class="sect2"><a href="#soft_upgrade">2.9.1. ソフトアップグレード </a></span></dt><dt><span class="sect2"><a href="#hard_upgrade">2.9.2. ハードアップグレード</a></span></dt></dl></div><p>
	  既存の空間データベースのアップグレードは、新しいPostGISオブジェクト定義の置き換えや導入を必要とするとき、慎重を要することがあります。
	</p><p>
	  不幸なことに、定義の全てが実行中のデータベース内で簡単には置き換えられるわけではないので、ダンプ/リロードが最善策となることがあります。
	</p><p>
	  PostGISには、マイナーバージョンアップやバグフィクスリリースの場合に使うソフトアップグレードと、メジャーアップグレードで使うハードアップグレードが用意されています。
	</p><p>
	  PostGISをアップグレードしようとする前にデータのバックアップを取ることは、常に価値のあるものです。pg_dumpで -Fc フラグを使うと、ハードアップグレードによってダンプを常にリストアすることができます。
	</p><div class="sect2" title="2.9.1. ソフトアップグレード"><div class="titlepage"><div><div><h3 class="title"><a name="soft_upgrade"></a>2.9.1. ソフトアップグレード </h3></div></div></div><p>
	  EXTENSIONを使ってインストールした場合は、EXTENSIONモデルでアップグレードしなければなりません。
	  古いSQLスクリプトを使ってインストールした場合は、SQLスクリプトでアップグレードすべきです。適切な方を参照して下さい。</p><div class="sect3" title="2.9.1.1. 9.1より前またはEXTENSIONを使わないソフトアップグレード"><div class="titlepage"><div><div><h4 class="title"><a name="soft_upgrade_sql_script"></a>2.9.1.1. 9.1より前またはEXTENSIONを使わないソフトアップグレード</h4></div></div></div><p>PostGISをEXTENSIONを使わずにインストールした人向けです。EXTENSIONを使っていてこの方法を使うと、次のようなメッセージが現れます。</p><pre class="programlisting">can't drop ... because postgis extension depends on it</pre><p>コンパイル後に<code class="filename">postgis_upgrade*.sql</code>を探して下さい。PostGISの版にあったものをインストールします。たとえば、PostGIS 1.3から1.5に上げるには postgis_upgrade_13_to_15.sqlを使います。PostGIS 1.*から2.0に移動したり、2.*からr7409以前に落とす場合は、ハードアップグレードして下さい。</p><pre class="programlisting">psql -f postgis_upgrade_20_minor.sql -d your_spatial_database</pre><p>
		ラスタ機能とトポロジ機能についても同じ手続きです。それぞれ<code class="filename">rtpostgis_upgrade*.sql</code>, <code class="filename">topology_upgrade*.sql</code>になります。次のようにします。
	  </p><pre class="programlisting">psql -f rtpostgis_upgrade_20_minor.sql -d your_spatial_database</pre><pre class="programlisting">psql -f topology_upgrade_20_minor.sql -d your_spatial_database</pre><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>
		  アップグレードのための特定の版の<code class="filename">postgis_upgrade*.sql</code>が見つからない場合は、非常に古い版を使っています。ハードアップグレードが必要です。
		</p></td></tr></table></div><p>
		<a class="xref" href="#PostGIS_Full_Version" title="PostGIS_Full_Version">PostGIS_Full_Version</a>関数によって、"procs need upgrade"メッセージを使ってこの種のアップグレードを実行する必要性についての情報が得られます。
	  </p></div><div class="sect3" title="2.9.1.2. 9.1以上でEXTENSIONを使ったソフトアップグレード"><div class="titlepage"><div><div><h4 class="title"><a name="soft_upgrade_extensions"></a>2.9.1.2. 9.1以上でEXTENSIONを使ったソフトアップグレード</h4></div></div></div><p>EXTENSIONを使ってPostGISをインストールした場合には、EXTENSIONを使ってアップグレードする必要があります。EXTENSIONを使ったマイナーアップグレードはかなり楽です。</p><pre class="programlisting">ALTER EXTENSION postgis UPDATE TO "2.0.0";
ALTER EXTENSION postgis_topology UPDATE TO "2.0.0";</pre><p>次のようなエラー通知が表示されることがあります。</p><pre class="programlisting">No migration path defined for ... to 2.0.0</pre><p>この場合は、データベースをバックアップして、<a class="xref" href="#create_new_db_extensions" title="2.6. EXTENSIONを使った空間データベースの生成">「EXTENSIONを使った空間データベースの生成」</a>に記述されているように新しいデータベースを生成し、バックアップを新しいデータベースにリストアしなければなりません。
		<code class="code">postgis extension</code>が既にインストールされているとのメッセージを得るかも知れませんが、無視して問題ありません。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>PostGISをバージョン指定なしにインストールした場合には、
しばしばリストアの前のPostGIS EXTENSIONの再インストールをとばすことができます。
バックアップは<code class="code">CREATE EXTENSION postgis</code>だけで、リストアの間に最新版になります。</p></td></tr></table></div></div></div><div class="sect2" title="2.9.2. ハードアップグレード"><div class="titlepage"><div><div><h3 class="title"><a name="hard_upgrade"></a>2.9.2. ハードアップグレード</h3></div></div></div><p>
		ハードアップグレードとは、PostGISで利用可能なデータの完全なダンプ/リロードを意味します。PostGISオブジェクトの内部格納状態が変更される場合や、ソフトアップグレードができない場合に、ハードアップグレードが必要です。付録の<a class="link" href="#release_notes" title="付録A Appendix">Release Notes</a>に、版ごとについて、ダンプ/リロード(ハードアップグレード)の要否を記載しています。
	  </p><p>
		ダンプ/リロード作業はpostgis_restore.plスクリプトが補助します。このスクリプトは、PostGIS(古いものを含む)に属する定義を全て飛ばすように注意します。また、重複シンボルエラーや非推奨オブジェクトの持越し無く、スキーマとデータをPostGISをインストールしたデータベースにリストアできます
	  </p><p>Windows用に関する追加情報は <a class="ulink" href="http://trac.osgeo.org/postgis/wiki/UsersWikiWinUpgrade" target="_top">Windows Hard upgrade</a>にあります。</p><p>
		手続きは次の通りです。
	  </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
		アップグレードしたデータベース(<code class="varname">olddb</code>と呼ぶことにしましょう)の「カスタム書式」のダンプを、バイナリBLOBデータを含めたダンプを指定して(-b)、verboseモード(-v)で生成します。ユーザはデータベースのオーナーになることができ、PostgreSQLのスーパーアカウントである必要はありません。
	  </p><pre class="programlisting">pg_dump -h localhost -p 5432 -U postgres -Fc -b -v -f "/somepath/olddb.backup" olddb</pre></li><li class="listitem"><p>
		新しいデータベースにPostGISを、PostGISが無い状態からインストールします。このデータベースを<code class="varname">newdb</code>と呼ぶことにします。この作業に関する説明については<a class="xref" href="#create_new_db" title="2.5. PostgreSQL 9.1より前での空間データベースの作成">「PostgreSQL 9.1より前での空間データベースの作成」</a>と<a class="xref" href="#create_new_db_extensions" title="2.6. EXTENSIONを使った空間データベースの生成">「EXTENSIONを使った空間データベースの生成」</a>を参照して下さい。
	  </p><p>
ダンプにあるspatial_ref_sysは、リストアされますが、既にあるspatial_ref_sysを上書きしません。リストア対象のデータベースに公式データセットの訂正が確実に伝わるようにするためです。標準のエントリを上書きしたい場合は、newdbを生成する際にspaltial_ref_sys.sqlファイルをロードしないだけです。
	  </p><p>
		データベースが本当に古く、ビューや関数に、長く非推奨になっている関数があるような場合には、関数やビューを使えるようにする<code class="filename">legacy.sql</code>をロードする必要があるでしょう。ただし、本当に必要な場合に限ります。可能なら、ビューや関数をダンプせずにアップグレードすることを検討して下さい。非推奨関数は<code class="filename">uninstall_legacy.sql</code>で後から削除することができます。
	  </p></li><li class="listitem"><p>
		バックアップを新しい<code class="varname">newdb</code>データベースにリストアするには、postgis_restore.plを使います。psqlが予期せぬエラーを標準エラー出力に出すことがあります。これらのログを保存しておいて下さい。
	  </p><pre class="programlisting">perl utils/postgis_restore.pl "/somepath/olddb.backup" | psql -h localhost -p 5432 -U postgres newdb 2&gt; errors.txt</pre></li></ol></div><p>
		エラーは次の場合に起こりえます。
	</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
		ビューまたは関数の中に非推奨のPostGISオブジェクトを使っているものがある場合。これの訂正には、リストア前に<code class="filename">legacy.sql</code>スクリプトのロードを試してみることができます。非推奨オブジェクトをまだ持っている版のPostGISにリストアして、コードを作り替えた後に再び移動させることもできます。
<code class="filename">legacy.sql</code>を利用する場合は、非推奨関数を使うのをやめたコードに訂正して、<code class="filename">uninstall_legacy.sql</code>をロードするのを忘れないでください。
	</p></li><li class="listitem"><p>
		ダンプファイル内のspatial_ref_sysにあるカスタムレコードが不正なSRIDになっている場合。妥当なSRID値は0より大きく999000より小さくなります。999000から999999の間は内部利用のための予約領域ですが、999999より大きい値は一切使用できません。全ての不正なSRIDを持つカスタムレコードは、予約領域に移動しても保持されます。しかし、spatial_ref_sysテーブルは、保持している不変値と、場合によっては主キー(複数の不正なSRIDが同じ予約領域のSRID値に変換されるとき)を保護するチェック制約を緩くできます。
  </p><p>
		これの訂正には、カスタムSRSを妥当値(多分91000から910999の間になります)に複写して、全てのテーブルを新しいSRIDに変換して(<a class="xref" href="#UpdateGeometrySRID" title="UpdateGeometrySRID">UpdateGeometrySRID</a>を参照して下さい)、不正なエントリをspatial_ref_sysから削除して、次を実行してチェック制約を再構築します。

		</p><pre class="programlisting">ALTER TABLE spatial_ref_sys ADD CONSTRAINT spatial_ref_sys_srid_check check (srid &gt; 0 AND srid &lt; 999000 );</pre><p>

		</p><pre class="programlisting">ALTER TABLE spatial_ref_sys ADD PRIMARY KEY(srid));</pre><p>
	
	</p></li></ol></div></div></div><div class="sect1" title="2.10. 共通の問題"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id286967270"></a>2.10. 共通の問題</h2></div></div></div><p>
	  インストールやアップグレードが思うようにいかない時にチェックすることがいくつかあります。
	</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
		  PostgreSQL 8.4以上をインストールしているか、実行中のPostgreSQLと同じ版のソースでコンパイルしているか、をチェックします。(Linuxの)ディストリビューションによって既にPostgreSQLがインストールされている時や、 PostgreSQLを以前にインストールして忘れた場合に、 混乱が発生することがあります。PostGISはPostgreSQL 8.4以上で動作します。古い版のものを使った場合には、おかしな予想外のエラーメッセージが表示されます。実行中のPostgreSQLの版をチェックするには、psqlを使ってデータベースを接続して、次のクエリを実行して下さい。
		</p><pre class="programlisting">SELECT version();</pre><p>
		  RPMベースのディストリビューションを実行している場合、 プリインストールされたパッケージが存在するかのチェックは、<span class="command"><strong>rpm</strong></span>コマンドを使って<span class="command"><strong>rpm -qa | grep postgresql</strong></span>でチェックできます。
		</p></li><li class="listitem"><p>アップグレードに失敗する場合、既にPostGISがインストールされているデータベースにリストアしているか確認して下さい。</p><pre class="programlisting">SELECT postgis_full_version();</pre></li></ol></div><p>
	  また、コンフィギュアが正しくPostgreSQL、Proj4ライブラリ、GEOSライブラリのインストール先を検出したかチェックして下さい。
	</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
		  コンフィギュアからの出力で<code class="filename">postgis_config.h</code>ファイルが作られます。<code class="varname">POSTGIS_PGSQL_VERSION</code>, <code class="varname">POSTGIS_PROJ_VERSION</code>, <code class="varname">POSTGIS_GEOS_VERSION</code>変数が正しくセットされたかをチェックして下さい。
		</p></li></ol></div></div><div class="sect1" title="2.11. JDBC"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id286967348"></a>2.11. JDBC</h2></div></div></div><p>
	  JDBC拡張によって、JavaオブジェクトがPostGISの内部型に対応できるようになります。このオブジェクトを使って、PostGISデータベースに問い合わせを出して、PostGISにあるGISデータの描画や計算を行うJavaクライアントを作成することができます。
	</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
		  PostGIS配布物の<code class="filename">java/jdbc</code>サブディレクトリに入ります。
		</p></li><li class="listitem"><p>
		  <code class="filename">ant</code>コマンドを実行します。<code class="filename">postgis.jar</code>ファイルをJavaライブラリを保存しているところに複写します。
		</p></li></ol></div><p>
	  JDBC拡張は、ビルド実行中は現在のCLASSPATHにPostgreSQL JDBCドライバがあるようにしておく必要があります。PostgreSQL JDBCドライバがCLASSPATHに無い場合には、個別にJDBCドライバのJARのありかを伝えます。次のようにします。
	</p><pre class="programlisting"># ant -Dclasspath=/path/to/postgresql-jdbc.jar</pre><p>
	  PostgreSQL JDBCドライバは
	  <a class="ulink" href="http://jdbc.postgresql.org" target="_top">
		http://jdbc.postgresql.org
	  </a>
	  からダウンロードできます。
	</p></div><div class="sect1" title="2.12. ローダ/ダンパ"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id286967438"></a>2.12. ローダ/ダンパ </h2></div></div></div><p>
	  データのローダとダンパは、PostGISのビルドの一部として、自動的にビルド、インストールされます。手動でビルド、インストールするには、次を実行します。 
	</p><pre class="programlisting"># cd postgis-2.0.0/loader
# make
# make install</pre><p>
	  ローダは<code class="filename">shp2pgsql</code>と呼ばれ、ESRIシェープファイルをPostGIS/PostgreSQLにロードするのに適したSQLに変換します。ダンパは<code class="filename">pgsql2shp</code>と呼ばれ、PostGISのテーブル(またはクエリ)からESRIシェープファイルに変換します。より詳しいドキュメントをご覧になるには、オンラインヘルプとマニュアルページをご覧ください。 
	</p></div></div><div class="chapter" title="第3章 PostGIS よくある質問"><div class="titlepage"><div><div><h2 class="title"><a name="PostGIS_FAQ"></a>第3章 PostGIS よくある質問</h2></div></div></div><div class="qandaset" title="よくある質問"><a name="id286971225"></a><dl><dt>3.1. <a href="#legacy_faq">PostGIS 1.5で動作していたアプリケーションやデスクトップツールがPostGIS 2.0では動作しなくなりました。解消するにはどうすればよいでしょうか?</a></dt><dt>3.2. <a href="#id286971256">PostgreSQL 9.0を動かしていて、OpenJumpo, Safe FME等のツールからジオメトリの読み書きができなくなってしまいましたが?</a></dt><dt>3.3. <a href="#id286971300">PgAdminを使ってジオメトリカラムを表示しようとしたら空っぽでした。何か方法はありませんか?</a></dt><dt>3.4. <a href="#id286971324">どの種類のジオメトリオブジェクトを格納できますか?</a></dt><dt>3.5. <a href="#id286971347">たいへん混乱しました。ジオメトリとジオグラフィのどちらを使うべきでしょうか?</a></dt><dt>3.6. <a href="#id286971383">もっとジオグラフィについて聞きたいです。 たとえば、ジオグラフィカラムにデータを入れて合理的な答えが得られる領域範囲はどれぐらいでしょうか、とか。極、全データが半球上になければならないのでしょうか(SQL Serber 2008はそう)、速度等の制限はあるのでしょうか、とか。</a></dt><dt>3.7. <a href="#id286971402">GISオブジェクトをデータベースに挿入するにはどうしますか?</a></dt><dt>3.8. <a href="#id286974067">空間クエリを作成するにはどうするのですか?</a></dt><dt>3.9. <a href="#id286974443">大きなテーブルでの空間クエリの速度向上はどうするのですか?</a></dt><dt>3.10. <a href="#id286974501">なぜPostgreSQLのR-Treeインデクスをサポートしないのですか?</a></dt><dt>3.11. <a href="#id286974536">なぜAddGeometryColumn()関数と他のOpsnGIS関数を使うべきなのですか?</a></dt><dt>3.12. <a href="#id286974570">半径内にあるオブジェクトを全て検索する最善の方法は何ですか?</a></dt><dt>3.13. <a href="#id286974599">クエリの一部として投影変換を実現するにはどうしますか?</a></dt><dt>3.14. <a href="#id286974619">ST_AsEWKT と ST_AsText を、かなり大きいジオメトリで実行すると、空のフィールドが返りました。どうしたら良いですか? </a></dt><dt>3.15. <a href="#id286974743">ST_Intersectsを使うと、2つのジオメトリがインタセクトしているのが分かっているのに、インタセクトしていないと言います。どうしたら良いですか? </a></dt><dt>3.16. <a href="#id286974762">PostGISを用いたソフトウェアをリリースしています。PostGISのようにGPLライセンスを使う必要があるのでしょうか?PostGISを使うとコードを全て公開しなければならないのでしょうか?</a></dt></dl><table border="0" width="100%" summary="Q and A Set"><col align="left" width="1%"><col><tbody><tr class="question" title="3.1."><td align="left" valign="top"><a name="legacy_faq"></a><a name="id286971230"></a><p><b>3.1.</b></p></td><td align="left" valign="top"><p>PostGIS 1.5で動作していたアプリケーションやデスクトップツールがPostGIS 2.0では動作しなくなりました。解消するにはどうすればよいでしょうか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>PostGIS 2.0で、多数の非推奨関数がPostGISコードから削除されました。これは、GeoServer, MapServer, QuantumGIS, OpenJump等のサードバーティツールに加えて、アプリケーションにも影響が出ます。これを解決する方法が2つあります。サードパーティアプリケーションの場合は、これらの問題の多くが解決されている最新版にアップグレードしてみることで対応できます。
ご自身のコードの場合は、削除された関数を使わないようにソースを変更することで対応できます。
削除された関数のほとんどは、ST_Unino, ST_Length等のエイリアスで、ST_を取ったものです。最後の手段として<code class="varname">legacy.sql</code>の全体または<code class="varname">legacy.sql</code>の必要な部分をインストールします。</p><p><code class="varname">legacy.sql</code>ファイルはpostgis.sqlのインストール先と同じフォルダにあります。postgis.sqlとspatial_ref_sys.sqlをインストールした後、このファイルをインストールすると、削除した200余の関数を復帰させられます。</p></td></tr><tr class="question" title="3.2."><td align="left" valign="top"><a name="id286971256"></a><a name="id286971258"></a><p><b>3.2.</b></p></td><td align="left" valign="top"><p>PostgreSQL 9.0を動かしていて、OpenJumpo, Safe FME等のツールからジオメトリの読み書きができなくなってしまいましたが?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>PostgreSQL 9.0以上では、byteaデータのデフォルトのエンコーディングがhexに変更されました。古いJDBCドライバはエスケープ形式を仮定しています。古いJDBCドライバを使ったJavaアプリケーションや古いNpgsqlドライバを使った.Netアプリケーションといった、ST_AsBinaryほ古い振る舞いを期待するアプリケーションが影響を受けます。再び動作させるには2つの方法があります。</p><p>JDBCドライバを最新のPostgreSQL 9.0版にアップグレードします。<a class="ulink" href="http://jdbc.postgresql.org/download.html" target="_top">http://jdbc.postgresql.org/download.html</a>からダウンロードできます。</p><p>.Netアプリケーションについては、Npgsql 2.0.11以上を使います。<a class="ulink" href="http://pgfoundry.org/frs/?group_id=1000140" target="_top">http://pgfoundry.org/frs/?group_id=1000140</a>からダウンロードできます。また、<a class="ulink" href="http://fxjr.blogspot.com/2010/11/npgsql-2011-released.html" target="_top">Francisco Figueiredo's NpgSQL 2.0.11 released blog entry</a>に説明があります。</p><p>PostgreSQLドライバのアップグレードが選択できないなら、デフォルトで古いふるまいをするようにします。次のようにします。</p><pre class="programlisting">ALTER DATABASE mypostgisdb SET bytea_output='escape';</pre></td></tr><tr class="question" title="3.3."><td align="left" valign="top"><a name="id286971300"></a><a name="id286971302"></a><p><b>3.3.</b></p></td><td align="left" valign="top"><p>PgAdminを使ってジオメトリカラムを表示しようとしたら空っぽでした。何か方法はありませんか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>PgAdminは大きなジオメトリを表示しません。ジオメトリカラムがそうなっていないか最も良い方法は次の通りです。</p><pre class="programlisting">-- 全てのジオメトリフィールドに値が入っている場合
-- レコードが返りません。
SELECT somefield FROM mytable WHERE geom IS NULL;</pre><pre class="programlisting">-- ジオメトリがどれぐらい大きいかを調べるには
-- ジオメトリカラムの中でジオメトリごとに、それが持つポイントの数を
-- 訪ねるかたちのクエリを実行します
SELECT MAX(ST_NPoints(geom)) FROM sometable;</pre></td></tr><tr class="question" title="3.4."><td align="left" valign="top"><a name="id286971324"></a><a name="id286971326"></a><p><b>3.4.</b></p></td><td align="left" valign="top"><p>どの種類のジオメトリオブジェクトを格納できますか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>ポイント、ライン、ポリゴン、マルチポイント、マルチライン、マルチポリゴン、ジオメトリコレクションです。PostGIS 2.0以上では、基本ジオメトリタイプとしてTINと多面体サーフェスも格納できます。これらはOpen GIS Well Known Text形式(XYZM, XYM, XYZM拡張付き)で指定されます。現在サポートされているのは3つのデータ型です。計測に平面座標系を使う標準OGCジオメトリデータ型があります。また、測地座標系を使うジオグラフィデータ型(OGCではないですがMicrosoft SQL Server 2008以上にあります)。ジオグラフィデータ型はWGS84経度緯度(SRID:4326)のみサポートします。最新のPostGIS空間型群に追加されたのが、ラスタデータの格納と解析に使われるラスタ型です。ラスタはそれだけで「よくある質問」を用意しています。詳細については<a class="xref" href="#RT_FAQ" title="第10章 PostGISラスタ よくある質問">10章<i>PostGISラスタ よくある質問</i></a>と<a class="xref" href="#RT_reference" title="第9章 ラスタ リファレンス">9章<i>ラスタ リファレンス</i></a>をご覧ください。</p></td></tr><tr class="question" title="3.5."><td align="left" valign="top"><a name="id286971347"></a><a name="id286971349"></a><p><b>3.5.</b></p></td><td align="left" valign="top"><p>たいへん混乱しました。ジオメトリとジオグラフィのどちらを使うべきでしょうか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>短い答: ジオグラフィは長距離の測定をサポートする新しいデータ型ですが、計算速度は現在のところジオメトリの計算より遅いです。ジオグラフィを使う場合は、平面座標系についてあまり多く学習する必要がありません。行うことが距離や長さの計測に限定され、かつ世界中からのデータを持っている場合は、一般的にジオグラフィが最善です。ジオメトリは古いデータ型で、サポートする関数が多く、サードパーティからの多大なサポートが得られます。計算速度も早く、大きなジオメトリでは10倍違います。空間参照系に慣れているか、<a class="link" href="#spatial_ref_sys" title="4.3.1. SPATIAL_REF_SYSテーブルと空間参照系">空間参照系(SRID)</a>が単一で済むような局所的なデータを扱っているか、あるいは、空間処理を多く行う必要がある場合には、ジオメトリが最善です。ご注意: 簡単に2つの型の相互変換を行ってそれぞれの利点を得ることができます。現在サポートされているもの、サポートされていないものについては<a class="xref" href="#PostGIS_TypeFunctionMatrix" title="13.10. PostGIS関数対応マトリクス">「PostGIS関数対応マトリクス」</a>を参照して下さい。</p><p>
		 	長い答: <a class="xref" href="#PostGIS_GeographyVSGeometry" title="4.2.2. ジオグラフィ型をジオメトリ型にして使用すべき時">「ジオグラフィ型をジオメトリ型にして使用すべき時 」</a>と<a class="link" href="#PostGIS_TypeFunctionMatrix" title="13.10. PostGIS関数対応マトリクス">関数タイプマトリクス</a>を参照して下さい。
		 </p></td></tr><tr class="question" title="3.6."><td align="left" valign="top"><a name="id286971383"></a><a name="id286971385"></a><p><b>3.6.</b></p></td><td align="left" valign="top"><p>もっとジオグラフィについて聞きたいです。 たとえば、ジオグラフィカラムにデータを入れて合理的な答えが得られる領域範囲はどれぐらいでしょうか、とか。極、全データが半球上になければならないのでしょうか(SQL Serber 2008はそう)、速度等の制限はあるのでしょうか、とか。</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>その質問は相当深く複雑で、このセクションで十分に答えられません。<a class="xref" href="#PostGIS_Geography_AdvancedFAQ" title="4.2.3. ジオグラフィに関する高度なよくある質問">「ジオグラフィに関する高度なよくある質問 」</a>を参照して下さい。</p></td></tr><tr class="question" title="3.7."><td align="left" valign="top"><a name="id286971402"></a><a name="id286971404"></a><p><b>3.7.</b></p></td><td align="left" valign="top"><p>GISオブジェクトをデータベースに挿入するにはどうしますか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>まず、GISデータを保持するために "geometry" または "geogprahy" カラムを持つテーブルを作成します。ジオグラフィデータ型の格納は、ジオメトリデータ型とは若干異なります。ジオグラフィの格納については<a class="xref" href="#Geography_Basics" title="4.2.1. ジオグラフィ基礎">「ジオグラフィ基礎」</a>を参照して下さい。</p><p>
		ジオメトリ: <code class="filename">psql</code>でデータベースに接続して、次のSQLを試してみて下さい。</p><pre class="programlisting">CREATE TABLE gtest ( ID int4, NAME varchar(20) );
SELECT AddGeometryColumn('', 'gtest','geom',-1,'LINESTRING',2);</pre><p>ジオメトリカラムの追加に失敗する場合は、もしかしたら PostGIS の関数とオブジェクトをデータベースにロードしていないのかも知れません。<a class="xref" href="#PGInstall" title="2.4. インストール">「インストール」</a>を参照して下さい。</p><p>これで、SQLのINSERTステートメントを使って、ジオメトリをテーブルに挿入することができます。GISオブジェクト自体は、OpenGISコンソーシアムの"well-known text"形式を使っています。</p><pre class="programlisting">INSERT INTO gtest (ID, NAME, GEOM) 
VALUES (
  1, 
  'First Geometry', 
  ST_GeomFromText('LINESTRING(2 3,4 5,6 5,7 8)', -1)
);</pre><p>他のGISオブジェクトの詳細については<a class="link" href="#RefObject" title="4.1. GISオブジェクト">object reference</a>をご覧ください。</p><p>テーブル内にあるGISデータを表示するには、次のようにします。</p><pre class="programlisting">SELECT id, name, ST_AsText(geom) AS geom FROM gtest;</pre><p>返り値は次のようなかんじになります。</p><pre class="programlisting"> id | name           | geom
----+----------------+-----------------------------
  1 | First Geometry | LINESTRING(2 3,4 5,6 5,7 8) 
(1 row)</pre></td></tr><tr class="question" title="3.8."><td align="left" valign="top"><a name="id286974067"></a><a name="id286974069"></a><p><b>3.8.</b></p></td><td align="left" valign="top"><p>空間クエリを作成するにはどうするのですか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>他のデータベースクエリを作るのと同じで、返り値、関数、テストのSQLの組み合わせです。</p><p>空間クエリでは、クエリを作成する際に心を平静に保つための重要な二つの問題があります。 ひとつは、使用することができる空間インデクスがあるか、です。もうひとつは、多数のジオメトリを相手に計算量の多い計算を行っているか、です。</p><p>一般的に、フィーチャーのバウンディングボックスがインタセクト(交差)しているかをテストするインタセクト演算子(&amp;&amp;)を使います。&amp;&amp;演算子が便利な理由は、速度向上のために空間インデクスが付けられているなら、&amp;&amp;演算子は空間インデクスを使うからです。これによって、クエリの速度はとてもとても速くなります。</p><p>また、検索結果をより狭めるために、Distance(), ST_Intersects(), ST_Contains(), ST_Within() などといった空間関数を使うことでしょう。ほとんどの空間クエリは、インデクスのテストと空間関数のテストを含みます。インデクスのテストで、返ってくるタプルを、求める条件に合致する<span class="emphasis"><em>かもしれない</em></span>タプルのみとして、タプルの数を制限します。それから、空間関数で確実な条件のテストを行います。</p><pre class="programlisting">SELECT id, the_geom 
FROM thetable 
WHERE 
  ST_Contains(the_geom,'POLYGON((0 0, 0 10, 10 10, 10 0, 0 0))');</pre></td></tr><tr class="question" title="3.9."><td align="left" valign="top"><a name="id286974443"></a><a name="id286974445"></a><p><b>3.9.</b></p></td><td align="left" valign="top"><p>大きなテーブルでの空間クエリの速度向上はどうするのですか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>大きなテーブルの速いクエリは、空間データベースの<span class="emphasis"><em>レゾンデートル</em></span>で(トランザクションサポートもそうですが)、良いインデクスは重要です。</p><p><code class="varname">geometry</code>カラムを持つテーブルでの空間インデクスの構築は、"CREATE INDEX"を使って、次のようにします。</p><pre class="programlisting">CREATE INDEX [indexname] ON [tablename] USING GIST ( [geometrycolumn] );</pre><p>"USING GIST"オプションによって、サーバにGiST(Generalized Search Tree)インデクスを作るよう指示が渡ります。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>GiSTインデクスは、不可逆であると仮定します。不可逆インデクスの構築には、代理オブジェクト(空間インデクスの場合はバウンディングボックス)を使います。</p></td></tr></table></div><p>PostgreSQLのクエリプランナがインデクスを作るべきかについて合理的な決定を行うよう、十分な情報を確実に持てるようにすべきです。そのために、ジオメトリテーブル上で"gather statistics"を実行しなければなりません。</p><p>PostgreSQL 8.0.x以上では、<span class="command"><strong>VACUUM ANALYZE</strong></span>コマンドを実行するだけです。</p><p>PostgreSQL 7.4.x以下では、<span class="command"><strong>SELECT UPDATE_GEOMETRY_STATS()</strong></span>を実行します。</p></td></tr><tr class="question" title="3.10."><td align="left" valign="top"><a name="id286974501"></a><a name="id286974503"></a><p><b>3.10.</b></p></td><td align="left" valign="top"><p>なぜPostgreSQLのR-Treeインデクスをサポートしないのですか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>PostGISの、かつての版では、PostgreSQLのR-Treeインデクスを使っていましたが、0.6版でPostgreSQLのR-Treeは完全に捨てて、R-Tree-over-GiSTスキームによる空間インデクスを提供しています。</p><p>私たちの試験では、R-TreeとGiSTの検索速度は同程度であることが示されています。PostgreSQLのR-Treeには、GISフィーチャーで使うためには好ましくない2つの制限があります(これらの制限は現在のPostgreSQLネイティブのR-Tree実装についてであって、R-Tree一般の話ではありません)。</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>PostgreSQLのR-Treeインデクスは、8K以上のサイズのフィーチャーは扱えません。GiSTインデクスはフィーチャー自体の代わりにバウンディングボックスを用いる「不可逆」トリックを使っているので扱うことができます。</p></li><li class="listitem"><p>PostgreSQLのR-Treeインデクスは「NULLセーフ」ではなく、NULLジオメトリを含むジオメトリカラムではインデクス作成に失敗します。</p></li></ul></div></td></tr><tr class="question" title="3.11."><td align="left" valign="top"><a name="id286974536"></a><a name="id286974538"></a><p><b>3.11.</b></p></td><td align="left" valign="top"><p>なぜ<code class="varname">AddGeometryColumn()</code>関数と他のOpsnGIS関数を使うべきなのですか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>OpenGIS関数を使いたくないのでしたら、使う必要はありません。単純にジオメトリカラムをCREATEステートメントで定義する古いやり方で作成して下さい。全てのジオメトリはSRIDが-1になり、OpenGISメタデータテーブルは適切に<span class="emphasis"><em>書き込まれません</em></span>。これによって、ほとんどのPostGISベースのアプリケーションでは失敗します。一般的には<code class="varname">AddGeometryColumn()</code>を用いることをお勧めします。</p><p>MapServerは<code class="varname">geometry_columns</code>メタデータを使うアプリケーションのひとつです。踏み込んでいえば、MpaserverはジオメトリカラムのSRIDを使って、正しい地図投影へのフィーチャーの自動投影変換を行います。</p></td></tr><tr class="question" title="3.12."><td align="left" valign="top"><a name="id286974570"></a><a name="id286974572"></a><p><b>3.12.</b></p></td><td align="left" valign="top"><p>半径内にあるオブジェクトを全て検索する最善の方法は何ですか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>データベースを最も効果的に使うには、半径検索とバウンディングボックス検索を組み合わせた半径検索を行うのが最も良いです。バウンディングボックス検索で空間インデクスを使用するので、半径検索が適用されるサブセットへのアクセスが早くなります。</p><p><code class="varname">ST_DWithin(geometry, geometry, distance)</code>関数は、インデクス付きの距離検索を実行する手軽な方法です。この関数は、距離半径を十分に含む大きさの検索矩形を作成して、 インデクス付きの結果サブセットに対して確実な距離検索を行います。</p><p>たとえば、POINT(1000 1000)から100メートル内の全てのオブジェクトを見つけるためには、次のクエリで動作します。</p><pre class="programlisting">SELECT * FROM geotable 
WHERE ST_DWithin(geocolumn, 'POINT(1000 1000)', 100.0);</pre></td></tr><tr class="question" title="3.13."><td align="left" valign="top"><a name="id286974599"></a><a name="id286974601"></a><p><b>3.13.</b></p></td><td align="left" valign="top"><p>クエリの一部として投影変換を実現するにはどうしますか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>投影変換を行うには、変換元と変換先双方の座標系がSPATIAL_REF_SYSテーブルに定義されていて、 かつ投影変換されるジオメトリがそのSRIDを持っている必要があります。これが行われていると、投影変換は求める変換先SRIDを参照するのと同じぐらい簡単です。次のクエリは、ジオメトリをNAD 84経度緯度に投影しています。このクエリはthe_geomが-1(空間参照系が定義されていない)でない場合のみ動作します。</p><pre class="programlisting">SELECT ST_Transform(the_geom,4269) FROM geotable;</pre></td></tr><tr class="question" title="3.14."><td align="left" valign="top"><a name="id286974619"></a><a name="id286974621"></a><p><b>3.14.</b></p></td><td align="left" valign="top"><p>ST_AsEWKT と ST_AsText を、かなり大きいジオメトリで実行すると、空のフィールドが返りました。どうしたら良いですか? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>PgAdminまたは大きなテキストを表示しないその他のツールを使用しているのかも知れません。 ジオメトリが十分に大きい場合、ツールには空として表示されます。本当にWKTで見たり出力したりしなければならない場合は、PSQLを使用して下さい。</p><pre class="programlisting">
				-- 本当に空のジオメトリの数を検索します
				SELECT count(gid) FROM geotable WHERE the_geom IS NULL;</pre></td></tr><tr class="question" title="3.15."><td align="left" valign="top"><a name="id286974743"></a><a name="id286974745"></a><p><b>3.15.</b></p></td><td align="left" valign="top"><p>ST_Intersectsを使うと、2つのジオメトリがインタセクトしているのが分かっているのに、インタセクトしていないと言います。どうしたら良いですか? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>2つの場合がよくあります。ひとつは、ジオメトリが不正な場合です。<a class="xref" href="#ST_IsValid" title="ST_IsValid">ST_IsValid</a>で確認できます。もうひとつは、ST_AsTextで数字を切り捨てていて、表示されている分より後にたくさんの小数が付いている場合です。</p></td></tr><tr class="question" title="3.16."><td align="left" valign="top"><a name="id286974762"></a><a name="id286974764"></a><p><b>3.16.</b></p></td><td align="left" valign="top"><p>PostGISを用いたソフトウェアをリリースしています。PostGISのようにGPLライセンスを使う必要があるのでしょうか?PostGISを使うとコードを全て公開しなければならないのでしょうか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>ほぼ確実に違います。
例として、Linux上で動作するOracleを考えてみます。
LinuxはGPLでOracleは違いますが、Linuxで動作するOracleはGPLで配布しなければならないでしょうか?違います。あなたのソフトウェアはPostgreSQL/PostGISデータベースを好きなだけ使うことができ、ライセンスは好きなようにできます。</p><p>PostGISソースコードに変更を加えて、変更したPostGISを配布したときだけは例外です。この場合、変更したPostGISのコードを共有しなければなりません(その上で動作するアプリケーションのコードではありません)。この限られた場合でも、ソースコードはバイナリの配布相手にだけ配布します。GPLはソースコードの<span class="emphasis"><em>公開</em></span>までは求めておらず、バイナリを配布した空いてとの共有を求めています。</p></td></tr></tbody></table></div></div><div class="chapter" title="第4章 PostGISを使う: データ管理とクエリ"><div class="titlepage"><div><div><h2 class="title"><a name="using_postgis_dbmanagement"></a>第4章 PostGISを使う: データ管理とクエリ</h2></div></div></div><div class="toc"><p><b>目次</b></p><dl><dt><span class="sect1"><a href="#RefObject">4.1. GISオブジェクト</a></span></dt><dd><dl><dt><span class="sect2"><a href="#OpenGISWKBWKT">4.1.1. OpenGIS WKBとWKT</a></span></dt><dt><span class="sect2"><a href="#EWKB_EWKT">4.1.2. PostGIS EWKB, EWKTと標準形式</a></span></dt><dt><span class="sect2"><a href="#SQL_MM_Part3">4.1.3. SQL-MM Part 3</a></span></dt></dl></dd><dt><span class="sect1"><a href="#PostGIS_Geography">4.2. PostGISジオグラフィ型</a></span></dt><dd><dl><dt><span class="sect2"><a href="#Geography_Basics">4.2.1. ジオグラフィ基礎</a></span></dt><dt><span class="sect2"><a href="#PostGIS_GeographyVSGeometry">4.2.2. ジオグラフィ型をジオメトリ型にして使用すべき時 </a></span></dt><dt><span class="sect2"><a href="#PostGIS_Geography_AdvancedFAQ">4.2.3. ジオグラフィに関する高度なよくある質問 </a></span></dt></dl></dd><dt><span class="sect1"><a href="#id286972774">4.3. OpenGIS標準を使う</a></span></dt><dd><dl><dt><span class="sect2"><a href="#spatial_ref_sys">4.3.1. SPATIAL_REF_SYSテーブルと空間参照系</a></span></dt><dt><span class="sect2"><a href="#geometry_columns">4.3.2. GEOMETRY_COLUMNSビュー</a></span></dt><dt><span class="sect2"><a href="#Create_Spatial_Table">4.3.3. 空間テーブルを作る</a></span></dt><dt><span class="sect2"><a href="#Manual_Register_Spatial_Column">4.3.4. 手動でジオメトリカラムをgeometry_columnsに登録する</a></span></dt><dt><span class="sect2"><a href="#OGC_Validity">4.3.5. ジオメトリのOpenGIS準拠を確実にする</a></span></dt><dt><span class="sect2"><a href="#DE-9IM">4.3.6. Dimensionally Extended 9 Intersection Model (DE-9IM)</a></span></dt></dl></dd><dt><span class="sect1"><a href="#id286979474">4.4. GISデータをロードする</a></span></dt><dd><dl><dt><span class="sect2"><a href="#id286979482">4.4.1. SQLを使う</a></span></dt><dt><span class="sect2"><a href="#shp2pgsql_usage">4.4.2. ローダを使う</a></span></dt></dl></dd><dt><span class="sect1"><a href="#id286980387">4.5. GISデータを検索する</a></span></dt><dd><dl><dt><span class="sect2"><a href="#id286980395">4.5.1. SQLを使う</a></span></dt><dt><span class="sect2"><a href="#id286980695">4.5.2. ダンパを使う</a></span></dt></dl></dd><dt><span class="sect1"><a href="#id286980859">4.6. インデクスを構築する</a></span></dt><dd><dl><dt><span class="sect2"><a href="#id286980891">4.6.1. GiSTインデクス</a></span></dt><dt><span class="sect2"><a href="#id286980924">4.6.2. インデクスを使う</a></span></dt></dl></dd><dt><span class="sect1"><a href="#id286980997">4.7. 複雑なクエリ</a></span></dt><dd><dl><dt><span class="sect2"><a href="#id286981012">4.7.1. インデクスの利点を使う</a></span></dt><dt><span class="sect2"><a href="#id286981166">4.7.2. 空間SQLの例</a></span></dt></dl></dd></dl></div><div class="sect1" title="4.1. GISオブジェクト"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="RefObject"></a>4.1. GISオブジェクト</h2></div></div></div><div class="toc"><dl><dt><span class="sect2"><a href="#OpenGISWKBWKT">4.1.1. OpenGIS WKBとWKT</a></span></dt><dt><span class="sect2"><a href="#EWKB_EWKT">4.1.2. PostGIS EWKB, EWKTと標準形式</a></span></dt><dt><span class="sect2"><a href="#SQL_MM_Part3">4.1.3. SQL-MM Part 3</a></span></dt></dl></div><p>PostGISでサポートされるGISオブジェクトは、OpenGIS Consortium(OGC)が定義する"Simple Features" のスーパーセットです。 PostGIS 0.9版からOGCの"Simple Features for SQL"仕様で定められた全てのオブジェクトと関数をサポートしています。</p><p>PostGISは標準から拡張して 3DZ, 3DM, 4D 座標(訳注: それぞれXYZ,XYM,XYZM)をサポートしています。</p><div class="sect2" title="4.1.1. OpenGIS WKBとWKT"><div class="titlepage"><div><div><h3 class="title"><a name="OpenGISWKBWKT"></a>4.1.1. OpenGIS WKBとWKT</h3></div></div></div><p>OpenGIS仕様は空間オブジェクトの表現について2つの標準を定義しています。Well-Knownテキスト(WKT)形式とWell- Knownバイナリ(WKB)形式です。WKTもWKBも、オブジェクトの型とオブジェクトを形成する座標に関する情報を持っています。</p><p>フィーチャーの空間オブジェクトのテキスト表現(WKT)の例は、次の通りです。</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>POINT(0 0)</p></li><li class="listitem"><p>LINESTRING(0 0,1 1,1 2)</p></li><li class="listitem"><p>POLYGON((0 0,4 0,4 4,0 4,0 0),(1 1, 2 1, 2 2, 1 2,1 1))</p></li><li class="listitem"><p>MULTIPOINT(0 0,1 2)</p></li><li class="listitem"><p>MULTILINESTRING((0 0,1 1,1 2),(2 3,3 2,5 4))</p></li><li class="listitem"><p>MULTIPOLYGON(((0 0,4 0,4 4,0 4,0 0),(1 1,2 1,2 2,1 2,1 1)),
		  ((-1 -1,-1 -2,-2 -2,-2 -1,-1 -1)))</p></li><li class="listitem"><p>GEOMETRYCOLLECTION(POINT(2 3),LINESTRING(2 3,3 4))</p></li></ul></div><p>OpenGIS仕様では、空間オブジェクトの内部保存書式は空間参照システム識別子(Spatial Referencing System IDentifier, SRID)を含むことも求められます。SRIDはデータベースへの挿入のために空間オブジェクトが生成される時に求められます。</p><p>これらの書式の入出力は次のインタフェースを用いて実現できます。</p><pre class="programlisting">bytea WKB = ST_AsBinary(geometry);
text WKT = ST_AsText(geometry);
geometry = ST_GeomFromWKB(bytea WKB, SRID);
geometry = ST_GeometryFromText(text WKT, SRID);</pre><p>たとえば、OGC空間オブジェクトを生成して挿入する妥当なINSERTステートメントは次の通りです。</p><pre class="programlisting">INSERT INTO geotable ( the_geom, the_name )
  VALUES ( ST_GeomFromText('POINT(-126.4 45.32)', 312), 'A Place');</pre></div><div class="sect2" title="4.1.2. PostGIS EWKB, EWKTと標準形式"><div class="titlepage"><div><div><h3 class="title"><a name="EWKB_EWKT"></a>4.1.2. PostGIS EWKB, EWKTと標準形式</h3></div></div></div><p>OGC書式は2次元ジオメトリしかサポートされておらず、また、入出力の表現においてSRID群は*決して*埋め込まれません。</p><p>PostGIS拡張書式は現在のところOGC書式のスーパーセットとなっています (全ての妥当なWKB/WKTは妥当なEWKB/EWKTです)。しかし、特にもしOGCがPostGIS拡張と矛盾する新しい書式を出すことがあるなら、これは将来変更されるかも知れません。ゆえにこの機能に頼るべきではありません。</p><p>PostGIS EWKB/EWKT では 3dm, 3dz, 4d の座標サポートが追加され、SRID情報が埋め込まれます。</p><p>フィーチャーの拡張空間オブジェクトのテキスト表現(EKWT)の例は次の通りです。</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>POINT(0 0 0) -- XYZ</p></li><li class="listitem"><p>SRID=32632;POINT(0 0) -- XY with SRID</p></li><li class="listitem"><p>POINTM(0 0 0) -- XYM</p></li><li class="listitem"><p>POINT(0 0 0 0) -- XYZM</p></li><li class="listitem"><p>SRID=4326;MULTIPOINTM(0 0 0,1 2 1) -- XYM with SRID</p></li><li class="listitem"><p>MULTILINESTRING((0 0 0,1 1 0,1 2 1),(2 3 1,3 2 1,5 4
		  1))</p></li><li class="listitem"><p>POLYGON((0 0 0,4 0 0,4 4 0,0 4 0,0 0 0),(1 1 0,2 1 0,2 2 0,1 2
		  0,1 1 0))</p></li><li class="listitem"><p>MULTIPOLYGON(((0 0 0,4 0 0,4 4 0,0 4 0,0 0 0),(1 1 0,2 1 0,2 2
		  0,1 2 0,1 1 0)),((-1 -1 0,-1 -2 0,-2 -2 0,-2 -1 0,-1 -1 0)))</p></li><li class="listitem"><p>GEOMETRYCOLLECTIONM( POINTM(2 3 9), LINESTRINGM(2 3 4, 3 4 5) )</p></li><li class="listitem"><p>MULTICURVE( (0 0, 5 5), CIRCULARSTRING(4 0, 4 4, 8 4) )</p></li><li class="listitem"><p>POLYHEDRALSURFACE( ((0 0 0, 0 0 1, 0 1 1, 0 1 0, 0 0 0)),  
((0 0 0, 0 1 0, 1 1 0, 1 0 0, 0 0 0)), ((0 0 0, 1 0 0, 1 0 1, 0 0 1, 0 0 0)),  ((1 1 0, 1 1 1, 1 0 1, 1 0 0, 1 1 0)),  
((0 1 0, 0 1 1, 1 1 1, 1 1 0, 0 1 0)),  ((0 0 1, 1 0 1, 1 1 1, 0 1 1, 0 0 1)) )</p></li><li class="listitem"><p>TRIANGLE ((0 0, 0 9, 9 0, 0 0))</p></li><li class="listitem"><p>TIN( ((0 0 0, 0 0 1, 0 1 0, 0 0 0)), 
		  ((0 0 0, 0 1 0, 1 1 0, 0 0 0)) )</p></li></ul></div><p>これらの書式の入出力は次のインタフェースを用いて実現できます。</p><pre class="programlisting">bytea EWKB = ST_AsEWKB(geometry);
text EWKT = ST_AsEWKT(geometry);
geometry = ST_GeomFromEWKB(bytea EWKB);
geometry = ST_GeomFromEWKT(text EWKT);</pre><p>たとえば、PostGISの空間オブジェクトを作成し挿入する妥当なINSERTステートメントは次の通りです。</p><pre class="programlisting">INSERT INTO geotable ( the_geom, the_name )
  VALUES ( ST_GeomFromEWKT('SRID=312;POINTM(-126.4 45.32 15)'), 'A Place' )</pre><p>PostgreSQLの「標準的な形式」は単純なクエリ(全く関数呼び出しが無い)で表現でできていて、INSERT, UPDATE, COPYで受け付けられることが保障されるものです。PostGISの"geometory"型の場合は次の通りです。</p><pre class="programlisting">- Output
  - binary: EWKB
	ascii: HEXEWKB (EWKB in hex form)
- Input
  - binary: EWKB
	ascii: HEXEWKB|EWKT </pre><p>たとえば、このステートメントは、標準的なASCII文字列による入出力の処理でEWKTを読み、HEXEWKBを返すものです。</p><pre class="programlisting">=# SELECT 'SRID=4;POINT(0 0)'::geometry;

geometry
----------------------------------------------------
01010000200400000000000000000000000000000000000000
(1 row)</pre></div><div class="sect2" title="4.1.3. SQL-MM Part 3"><div class="titlepage"><div><div><h3 class="title"><a name="SQL_MM_Part3"></a>4.1.3. SQL-MM Part 3</h3></div></div></div><p>SQLマルチメディア・アプリケーション空間仕様は、円弧補完曲線を定義したSQL仕様の拡張です。</p><p>TSQL-MMの定義では、3dm、3dzと4dの座標を含みますが、SRID情報の埋め込みはできません。</p><p>WKT拡張はまだ完全にはサポートされていません。単純な曲線ジオメトリの例を次に示します。</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>CIRCULARSTRING(0 0, 1 1, 1 0)</p><p>CIRCULARSTRING(0 0, 4 0, 4 4, 0 4, 0 0)</p><p>CIRCULARSTRINGは基本的な曲線型で、LINESTRINGに似ています。ひとつのセグメントで、始点、終点(一つめと三つめ)と弧上の任意の点、の3点が必要です。例外として、始点と終点が同じとなる閉曲線があります。閉曲線では2つめの点が弧の中心、すなわち円の反対側にならなければなりません。弧の連結では、LINESTRINGと同じように、前の弧の最後の点が次の弧の最初の点となります。よって、妥当なCIRCULARSTRINGは1以上の奇数になります。</p></li><li class="listitem"><p>COMPOUNDCURVE(CIRCULARSTRING(0 0, 1 1, 1 0),(1 0, 0 1))</p><p>複合曲線は、曲線(円弧)セグメントと線型セグメントの両方を持つ、単一の連続した曲線です。 よって、要素が的確である必要があることに加え、各要素(最終要素は除く)の終点は次の要素の始点と同じになる必要があります。</p></li><li class="listitem"><p>CURVEPOLYGON(CIRCULARSTRING(0 0, 4 0, 4 4, 0 4, 0 0),(1 1, 3
		  3, 3 1, 1 1))</p><p>曲線ポリゴンの中に複合ポリゴンがある例は次の通りです。 
				CURVEPOLYGON(COMPOUNDCURVE(CIRCULARSTRING(0 0,2 0, 2 1, 2 3, 4 3),(4 3, 4 5, 1 4, 0 0)),
					CIRCULARSTRING(1.7 1, 1.4 0.4, 1.6 0.4, 1.6 0.5, 1.7 1) )
		  </p><p>CURVEPOLYGONは外環と0以上の内環とを持つ点でPOLYGONと似ています。 異なる点は、環に曲線ストリング、線型ストリング、複合ストリングのいずれも取れる点です。</p><p>PostGIS 1.4から、PostGISで曲線ポリゴンで複合曲線をサポートするようになりました。</p></li><li class="listitem"><p>MULTICURVE((0 0, 5 5),CIRCULARSTRING(4 0, 4 4, 8 4))</p><p>MULTICURVEは曲線のコレクションで、線型ストリング、曲線ストリング、複合ストリングを取れます。</p></li><li class="listitem"><p>MULTISURFACE(CURVEPOLYGON(CIRCULARSTRING(0 0, 4 0, 4 4, 0 4, 0
		  0),(1 1, 3 3, 3 1, 1 1)),((10 10, 14 12, 11 10, 10 10),(11 11, 11.5
		  11, 11 11.5, 11 11)))</p><p>サーフェスのコレクションです。(線型)ポリゴンか曲線ポリゴンを取れます。</p></li></ul></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>PostGIS 1.4より前では、曲線ポリゴンで複合曲線をサポートしていませんでしたが、PostGIS 1.4以降は曲線ポリゴンでの複合曲線の使用をサポートするようになりました。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>SQL-MM実装での全ての浮動小数点数の比較では、所定の丸め誤差があります。現在は1E-8です。</p></td></tr></table></div></div></div><div class="sect1" title="4.2. PostGISジオグラフィ型"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="PostGIS_Geography"></a>4.2. PostGISジオグラフィ型</h2></div></div></div><div class="toc"><dl><dt><span class="sect2"><a href="#Geography_Basics">4.2.1. ジオグラフィ基礎</a></span></dt><dt><span class="sect2"><a href="#PostGIS_GeographyVSGeometry">4.2.2. ジオグラフィ型をジオメトリ型にして使用すべき時 </a></span></dt><dt><span class="sect2"><a href="#PostGIS_Geography_AdvancedFAQ">4.2.3. ジオグラフィに関する高度なよくある質問 </a></span></dt></dl></div><p>ジオグラフィ型は、「地理」座標(しばしば「測地」座標、"lat/lon", "lon/lat", 緯度経度, 経度緯度などとも呼ばれます)上で表現された空間フィーチャーのネイティブサポートするためのものです。地理座標は角度の単位(度)で合わさられる球面座標です。</p><p>PostGISジオメトリ型の基礎は平面です。平面上の二点間の最短コースは直線になります。よって、ジオメトリ上の計算(面積、距離、長さ、インタセクション等)は、デカルト座標と線型ベクトルを使用することができます。</p><p>PostGISのジオグラフィ型の基礎は球面です。球面上での二点間の最短距離は大圏の弧です。よって、ジオグラフィ上の計算(面積、距離、長さ、インタセクション等)は、球面上で計算しなければならず、複雑な計算が必要となります。より正確な計測のためには、世界の実際の回転楕円体の形を考慮に入れなければならず、非常に複雑です。</p><p>基礎となる数学が大変に複雑なので、ジオグラフィ型用に定義された関数は、ジオメトリ型よりも少ないです。時間とともに、新しいアルゴリズムが追加されて、ジオグラフィ型の能力は拡大していくでしょう。</p><p>WGS84経度緯度(SRID:4326)のみサポートしているという制限があります。GEOGRAPHYと呼ばれる新しいデータ型を使用します。GEOS関数にこの新しい型をサポートする関数がありません。回避策として、ジオメトリとジオグラフィの型変換を行うことができます。</p><p>ジオグラフィ型はPostgreSQL 8.3以上のtypmod定義書式を使います。ジオグラフィカラムを持つテーブルに1ステップで追加できます。標準OGC書式は曲線を除いてサポートします。</p><div class="sect2" title="4.2.1. ジオグラフィ基礎"><div class="titlepage"><div><div><h3 class="title"><a name="Geography_Basics"></a>4.2.1. ジオグラフィ基礎</h3></div></div></div><p>ジオグラフィ型は簡単なフィーチャーの最も簡単なもののみサポートします。標準的なジオメトリ型データで、SRIDが4326の場合は、ジオグラフィに自動でキャストされます。またEWKTとEWKBの取り決めを使うこともできます。</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>POINT: 2次元のポイントジオメトリを持つテーブルの作成は次の通りです。</p><pre class="programlisting">CREATE TABLE testgeog(gid serial PRIMARY KEY, the_geog geography(POINT,4326) );</pre><p>Z値を持つポイントの場合は次の通りです。</p><pre class="programlisting">CREATE TABLE testgeog(gid serial PRIMARY KEY, the_geog geography(POINTZ,4326) );</pre></li><li class="listitem"><p>LINESTRING</p></li><li class="listitem"><p>POLYGON</p></li><li class="listitem"><p>MULTIPOINT</p></li><li class="listitem"><p>MULTILINESTRING</p></li><li class="listitem"><p>MULTIPOLYGON</p></li><li class="listitem"><p>GEOMETRYCOLLECTION</p></li></ul></div><p>新しいジオグラフィカラムは<code class="varname">geometry_columns</code>に登録されません。システムカタログを見るgeography_columnsという新しいビューに登録されるので、AddGeom... といった関数を使わずに、自動管理されます。</p><p>"geography_columns"ビューをチェックして、テーブルが一覧にあるか見て下さい。 </p><p>CREATE TABLEでジオグラフィカラムを持つテーブルを作ることができます。ジオメトリと違って、AddGeometryColumns()でメタデータにカラム情報を登録する処理を別に行う必要がなくなりました。</p><p>
</p><pre class="programlisting">CREATE TABLE global_points ( 
    id SERIAL PRIMARY KEY,
    name VARCHAR(64),
    location GEOGRAPHY(POINT,4326)
  );</pre><p>
  		</p><p>locationカラムはGEOGRAPHY型で、2つのオプション修飾子をサポートすることにご注意ください。ひとつは、そのカラムで使用できる形状と次元を限定する型修飾子です。もうひとつは、座標参照IDを特定の数に限定するSRID修飾子です。</p><p>型修飾子で許される値はPOINT, LINESTRING, POLYGON, MULTIPOINT, MULTILINESTRING, MULTIPOLYGONです。この修飾子ではZ, M, ZMの拡張子によって次元を限定します。たとえば、'LINESTRINGM'という値では、3次元で、第3次元が計測値(measure)となります。同じように見て 'POINTZM' は、4次元となります。</p><p>SRID修飾子には、現在は4326(WGS84)のみ許されるという制限があります。SRIDを指定したくない場合は0(未定義の回転楕円体)を使います。この場合の全ての計算は、WGS84とします。</p><p>将来的には、他のSRIDによって、WGS84以外の回転楕円体に関する計算ができるようにします。</p><p>テーブルを作ったら、次のようにしてGEOGRAPHY_COLUMNSを見ることができます。</p><pre class="programlisting">
-- メタデータビューの中身を見る
SELECT * FROM geography_columns;</pre><p>ジオメトリカラムを使うのと同じようにテーブルへのデータの挿入ができます。</p><pre class="programlisting">-- testテーブルへのデータの追加
INSERT INTO global_points (name, location) VALUES ('Town', ST_GeographyFromText('SRID=4326;POINT(-110 30)') );
INSERT INTO global_points (name, location) VALUES ('Forest', ST_GeographyFromText('SRID=4326;POINT(-109 29)') );
INSERT INTO global_points (name, location) VALUES ('London', ST_GeographyFromText('SRID=4326;POINT(0 49)') );</pre><p>GEOMETRYと同じ操作でインデクスを作成します。PostGISは、カラム型がGEOGRAPHYであるかを見て、GEOMETRYで使われる平面用インデクスの代わりに球面ベースのインデクスを作成します。</p><pre class="programlisting">-- testテーブルに球面インデクスを作成
  CREATE INDEX global_points_gix ON global_points USING GIST ( location );</pre><p>
</p><p>クエリと計測関数はメートル単位となります。そのため距離パラメータはメートル(面積の場合は平方メートル)単位となります。</p><pre class="programlisting">-- 距離クエリの表示。ロンドンは1000km範囲外です。
  SELECT name FROM global_points WHERE ST_DWithin(location, ST_GeographyFromText('SRID=4326;POINT(-110 29)'), 1000000);</pre><p>
</p><p>GEOGRAPHYの威力については、シアトルからロンドンまで(LINESTRING(-122.33 47.606, 0.0 51.5))の飛行機がレイキャビク(POINT(-21.96 64.15))に最も近くなるときの距離を求めてみると分かります。</p><pre class="programlisting">-- GEOGRAPHYを使った距離計算 (122.2km)
  SELECT ST_Distance('LINESTRING(-122.33 47.606, 0.0 51.5)'::geography, 'POINT(-21.96 64.15)':: geography);</pre><p>
</p><pre class="programlisting">-- GEOMETRYを使った計算 (13.3"度")
  SELECT ST_Distance('LINESTRING(-122.33 47.606, 0.0 51.5)'::geometry, 'POINT(-21.96 64.15)':: geometry);</pre><p>
</p><p>GEOGRAPHY型は、レイキャビクとシアトル-ロンドン間の飛行機の大圏コースとの間の、球面上での本当に最も近い距離を計算します。</p><p> <a class="ulink" href="http://gc.kls2.com/cgi-bin/gc?PATH=SEA-LHR" target="_top">大圏コースマップ</a>
GEOMETRY型は、平面の世界地図上にプロットされたレイキャビクとシアトル-ロンドン間の直線とのデカルト距離という意味のない値を出します。結果の名目上の単位は「度」ですが、点間の本当の角度差にあっていませんので、「度」と言うこと自体不正確です。</p></div><div class="sect2" title="4.2.2. ジオグラフィ型をジオメトリ型にして使用すべき時"><div class="titlepage"><div><div><h3 class="title"><a name="PostGIS_GeographyVSGeometry"></a>4.2.2. ジオグラフィ型をジオメトリ型にして使用すべき時 </h3></div></div></div><p>GEOGRAPHY型によって、経度緯度座標でデータを格納できるようになりましたが、 GEOGRAPHYで定義されている関数が、GEOMETRYより少ないのと、実行にCPU時間がかかる、というところが犠牲になっています。 </p><p>選択した型が、期待する領域から出ないことを、ジオメトリ型にして使用する条件とすべきです。使用するデータは地球全体か、大陸か、州か、自治体か?</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>データが小さいエリア内におさまるなら、適切な投影を選択してGEOMETRYを使うのが、効率面でも機能面でも最も良い方法です。</p></li><li class="listitem"><p>
データが地球全体か大陸なら、GEOGRAPHYで投影法の細かい問題を気にせずにシステムを構築できるでしょう。経度/緯度のデータを保存して、GEOGRAPHYで定義された関数使います。</p></li><li class="listitem"><p>投影法を理解していなくて、学習したくもなくて、かつ、GEOGRAPHYで使える関数が限られていることを受け入れるのなら、GEOGRAPHYを使った方が簡単です。単にデータを経度緯度でロードして、そこから進めて下さい。</p></li></ul></div><p>ジオグラフィとジオメトリ間のサポート状況の比較については<a class="xref" href="#PostGIS_TypeFunctionMatrix" title="13.10. PostGIS関数対応マトリクス">「PostGIS関数対応マトリクス」</a>をご覧下さい。ジオグラフィ関数の簡潔なリストと説明については<a class="xref" href="#PostGIS_GeographyFunctions" title="13.3. PostGISジオグラフィ対応関数">「PostGISジオグラフィ対応関数」</a>をご覧下さい。
		</p></div><div class="sect2" title="4.2.3. ジオグラフィに関する高度なよくある質問"><div class="titlepage"><div><div><h3 class="title"><a name="PostGIS_Geography_AdvancedFAQ"></a>4.2.3. ジオグラフィに関する高度なよくある質問 </h3></div></div></div><div class="qandaset" title="よくある質問"><a name="id286972697"></a><dl><dt>4.2.3.1. <a href="#id286972699">球または回転楕円体のどちらで計算するのでしょうか?</a></dt><dt>4.2.3.2. <a href="#id286972718">日付変更線や極に関してはどうなっていますか?</a></dt><dt>4.2.3.3. <a href="#id286972734">弧の処理の最大長はどうなりますか?</a></dt><dt>4.2.3.4. <a href="#id286972750">なぜヨーロッパやロシアといった大きな範囲の面積計算はとても遅いのですか?</a></dt></dl><table border="0" width="100%" summary="Q and A Set"><col align="left" width="1%"><col><tbody><tr class="question" title="4.2.3.1."><td align="left" valign="top"><a name="id286972699"></a><a name="id286972701"></a><p><b>4.2.3.1.</b></p></td><td align="left" valign="top"><p>球または回転楕円体のどちらで計算するのでしょうか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>デフォルトでは、全ての距離と面積の計算は回転楕円体で行います。局所的なエリアでの計算結果と良好な投影を施した平面での結果と比較して下さい。大きなエリアの場合は、回転楕円体計算は、投影平面上でのどの計算よりも精度が高くなります。</p><p>全てのジオグラフィ関数には、最後の真偽パラメータを'FALSE'にすると球面を使った計算を行うというオプションがあります。これは、特にジオメトリが非常に単純である場合に計算を速くするためのものです。</p></td></tr><tr class="question" title="4.2.3.2."><td align="left" valign="top"><a name="id286972718"></a><a name="id286972721"></a><p><b>4.2.3.2.</b></p></td><td align="left" valign="top"><p>日付変更線や極に関してはどうなっていますか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>全ての計算に日付変更線や極の概念がありません。座標は球(経度/緯度)であるので、日付変更線とクロスする形状は、計算の観点からは、他のものと変わりありません。</p></td></tr><tr class="question" title="4.2.3.3."><td align="left" valign="top"><a name="id286972734"></a><a name="id286972737"></a><p><b>4.2.3.3.</b></p></td><td align="left" valign="top"><p>弧の処理の最大長はどうなりますか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>大圏の弧を2点の「補完線」として使用しています。任意の2点は、実際には2方向につながっていて、どちらの方向に行くかに依存します。PostGISの全てのコードは、大圏コースの2コースのうち*短い*方でつながっていると仮定しています。結果として、180度以上の弧を持つ形状は正しくモデル化されません。</p></td></tr><tr class="question" title="4.2.3.4."><td align="left" valign="top"><a name="id286972750"></a><a name="id286972753"></a><p><b>4.2.3.4.</b></p></td><td align="left" valign="top"><p>なぜヨーロッパやロシアといった大きな範囲の面積計算はとても遅いのですか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>ポリゴンがとんでもなく大きいからです。二つの理由から、大きなエリアは悪いです。ひとつは、バウンダリボックスが大きいため、どのようなクエリを走らせても、インデクスがフィーチャーを引っ張ってくる傾向にあるためです。もうひとつは、バーテック数が巨大で、テスト(距離、包含)関数では、少なくとも1回、通常はN(Nは、もう一方のフィーチャーのバーテック数)回、バーテックを横断しなければならないためです。</p><p>GEOMETRYでは、大きなポリゴンを持っているが小さな範囲のクエリを実行する時、ジオメトリデータ情報を小片に「非正常化」します。これにより、インデクスが効果的にオブジェクトの一部を問い合わせるようになり、またクエリが常にオブジェクト全体を引っ張りこむようなことがないようになります。ヨーロッパ全体を一つに*格納できる*からといって、そうすべきだというわけではありません。</p></td></tr></tbody></table></div></div></div><div class="sect1" title="4.3. OpenGIS標準を使う"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id286972774"></a>4.3. OpenGIS標準を使う</h2></div></div></div><div class="toc"><dl><dt><span class="sect2"><a href="#spatial_ref_sys">4.3.1. SPATIAL_REF_SYSテーブルと空間参照系</a></span></dt><dt><span class="sect2"><a href="#geometry_columns">4.3.2. GEOMETRY_COLUMNSビュー</a></span></dt><dt><span class="sect2"><a href="#Create_Spatial_Table">4.3.3. 空間テーブルを作る</a></span></dt><dt><span class="sect2"><a href="#Manual_Register_Spatial_Column">4.3.4. 手動でジオメトリカラムをgeometry_columnsに登録する</a></span></dt><dt><span class="sect2"><a href="#OGC_Validity">4.3.5. ジオメトリのOpenGIS準拠を確実にする</a></span></dt><dt><span class="sect2"><a href="#DE-9IM">4.3.6. Dimensionally Extended 9 Intersection Model (DE-9IM)</a></span></dt></dl></div><p>OpenGISの「SQL用シンプルフィーチャー仕様」では、標準GISオブジェクト型とこれらを操作するために必要な関数、メタデータテーブルのセットが定義されています。メタデータが一貫性を維持していることを保証するために、空間カラムの生成、消去といった操作はOpenGISで定義されている空間プロシージャを通して実行されます。</p><p>OpenGISメタデータテーブルには<code class="varname">SPATIAL_REF_SYS</code>と<code class="varname">GEOMETRY_COLUMNS</code>の2つあります。<code class="varname">SPATIAL_REF_SYS</code>テーブルは空間データベースで用いられる座標系の、数字によるIDと文字による説明を持っています。</p><div class="sect2" title="4.3.1. SPATIAL_REF_SYSテーブルと空間参照系"><div class="titlepage"><div><div><h3 class="title"><a name="spatial_ref_sys"></a>4.3.1. SPATIAL_REF_SYSテーブルと空間参照系</h3></div></div></div><p>spatial_ref_sysテーブルは、PostGISに含まれるもので、3000以上の<a class="ulink" href="http://www.sharpgis.net/post/2007/05/Spatial-references2c-coordinate-systems2c-projections2c-datums2c-ellipsoids-e28093-confusing.aspx" target="_top">空間参照系</a>を持つ、OGC準拠のデータベーステーブルです。これらの間での変換/投影変換に必要です。</p><p>PostGISのspatial_ref_sysテーブルには、projライブラリで使われる3000以上の一般に使われる空間参照系定義がありますが、全てを持っているわけではなく、projライブラリの構築に慣れているならカスタム投影を定義することができます。ほとんどの空間参照系は地域限定のもので、想定されている範囲の外で使うと意味が無いことに注意して下さい。</p><p>PostGISのコアセットに入っていない空間参照系を探すための素晴らしい資料が<a class="ulink" href="http://spatialreference.org/" target="_top">http://spatialreference.org/</a>にあります。</p><p>よく共通的に使われる空間参照系は次の通りです(訳注: 日本では状況が異なります)。<a class="ulink" href="http://spatialreference.org/ref/epsg/4326/" target="_top">4326 - WGS 84経度緯度</a>,
			<a class="ulink" href="http://spatialreference.org/ref/epsg/4269/" target="_top">4269 - NAD 83経度緯度</a>,
			<a class="ulink" href="http://spatialreference.org/ref/epsg/3395/" target="_top">3395 - WGS 84メルカトル図法</a>,
			<a class="ulink" href="http://spatialreference.org/ref/epsg/2163/" target="_top">2163 - 米国ナショナルアトラス正積図法</a>,
			NAD83, WGS84 UTMの空間参照系 - UTMゾーンは計測に最も理想的なもののひとつですが6度(訳注: 経度を指します)の領域しかカバーしません。
	</p><p>さまざまな米国の州の平面空間参照系(メートルまたはフィート単位) - 通常は州ごとに一つか二つあります。メートル単位のもののほとんどがPostGISのコアセットに入っていますが、多数のフィート単位のものやESRIが作ったものについては<a class="ulink" href="http://spatialreference.org" target="_top">spatialreference.org</a>から取得して下さい。</p><p>対象領域がどのUTMゾーンになるかを決めるには、<a class="ulink" href="http://trac.osgeo.org/postgis/wiki/UsersWikiplpgsqlfunctionsDistance" target="_top">utmzone PostGIS plpgsql helper function</a>を参照して下さい。</p><p><code class="varname">SPATIAL_REF_SYS</code>テーブル定義は次の通りです。</p><pre class="programlisting">CREATE TABLE spatial_ref_sys (
  srid       INTEGER NOT NULL PRIMARY KEY,
  auth_name  VARCHAR(256),
  auth_srid  INTEGER,
  srtext     VARCHAR(2048),
  proj4text  VARCHAR(2048)
)</pre><p><code class="varname">SPATIAL_REF_SYS</code>のカラムは次の通りです。</p><div class="variablelist"><dl><dt><span class="term"><a class="ulink" href="http://en.wikipedia.org/wiki/SRID" target="_top">SRID</a></span></dt><dd><p>一意に定められた整数値で、データベースで空間参照系(SRS)を識別するものです。</p></dd><dt><span class="term">AUTH_NAME</span></dt><dd><p>その参照系の引用元である標準の名前です。たとえば「EPSG」は妥当な<code class="varname">AUTH_NAME</code>です。</p></dd><dt><span class="term">AUTH_SRID</span></dt><dd><p><code class="varname">AUTH_NAME</code>で引用される団体によって定義された空間参照系のIDです。EPSGの場合、EPSG投影コードが入ります。</p></dd><dt><span class="term">SRTEXT</span></dt><dd><p>空間参照系のWell-Knownテキスト表現です。たとえば、WKT SRSの表現は、次のようになります。</p><pre class="programlisting">PROJCS["NAD83 / UTM Zone 10N",
  GEOGCS["NAD83",
	DATUM["North_American_Datum_1983",
	  SPHEROID["GRS 1980",6378137,298.257222101]
	],
	PRIMEM["Greenwich",0],
	UNIT["degree",0.0174532925199433]
  ],
  PROJECTION["Transverse_Mercator"],
  PARAMETER["latitude_of_origin",0],
  PARAMETER["central_meridian",-123],
  PARAMETER["scale_factor",0.9996],
  PARAMETER["false_easting",500000],
  PARAMETER["false_northing",0],
  UNIT["metre",1]
]</pre><p>EPSG投影コードと対応するWKT表現の一覧については、<a class="ulink" href="http://www.opengeospatial.org/" target="_top">http://www.opengeospatial.org/</a>をご覧下さい。WKTの一般的な議論については、OpenGISの「座標変換サービス実装仕様」<a class="ulink" href="http://www.opengeospatial.org/standards" target="_top">http://www.opengeospatial.org/standards</a>をご覧下さい。欧州石油調査グループ(European Petroleum Survey Group, EPSG)とEPSG空間参照系のデータベースに関する情報は、<a class="ulink" href="http://www.epsg.org/" target="_top">http://www.epsg.org</a>をご覧下さい。</p></dd><dt><span class="term">PROJ4TEXT</span></dt><dd><p>PostGISは座標変換機能を提供するためにProj4ライブラリを用いています。<code class="varname">PROJ4TEXT</code>カラムには、特定のSRIDを示すProj4座標定義文字列が入ります。たとえば次のようになります。</p><pre class="programlisting">+proj=utm +zone=10 +ellps=clrk66 +datum=NAD27 +units=m</pre><p>詳細情報については、Proj4ウェブサイト<a class="ulink" href="http://trac.osgeo.org/proj/" target="_top">http://trac.osgeo.org/proj/</a>をご覧下さい。<code class="filename">spatial_ref_sys.sql</code>は、全てのEPSG投影法のための<code class="varname">SRTEXT</code>と<code class="varname">PROJ4TEXT</code>を持っています。</p></dd></dl></div></div><div class="sect2" title="4.3.2. GEOMETRY_COLUMNSビュー"><div class="titlepage"><div><div><h3 class="title"><a name="geometry_columns"></a>4.3.2. GEOMETRY_COLUMNSビュー</h3></div></div></div><p>2.0.0より前のPostGISでは、直接編集可能なgeometry_columnsはテーブル、時々、実際のジオメトリカラムとの同期が取れていませんでした。PostGIS 2.0.0では、<code class="varname">GEOMETRY_COLUMNS</code>は、以前の版と同じ外見構造を持ちますが、データベースシステムカタログから読むビューになりました。構造は次の通りです。</p><pre class="programlisting">\d geometry_columns</pre><pre class="screen">             View "public.geometry_columns"
      Column       |          Type          | Modifiers
-------------------+------------------------+-----------
 f_table_catalog   | character varying(256) |
 f_table_schema    | character varying(256) |
 f_table_name      | character varying(256) |
 f_geometry_column | character varying(256) |
 coord_dimension   | integer                |
 srid              | integer                |
 type              | character varying(30)  |</pre><p>カラムは以前の版と変わりません。カラムについては次の通りです。</p><div class="variablelist"><dl><dt><span class="term">F_TABLE_CATALOG, F_TABLE_SCHEMA, F_TABLE_NAME</span></dt><dd><p>ジオメトリカラムを持つフィーチャーテーブルの完全修飾名。"catalog"および"schema"の語はOracle風であることに注意して下さい。"catalog"に類似するものはPostgreSQLになく、このカラムは空白にされます。"schema"についてはPostgreSQLスキーマ名が使われています(<code class="varname">public</code>がデフォルトです)。</p></dd><dt><span class="term">F_GEOMETRY_COLUMN</span></dt><dd><p>フィーチャーテーブル内のジオメトリカラムの名前。</p></dd><dt><span class="term">COORD_DIMENSION</span></dt><dd><p>そのカラムの空間の次元(2, 3 または 4)。</p></dd><dt><span class="term">SRID</span></dt><dd><p>このテーブルの座標ジオメトリのために使われる空間参照系のID。<code class="varname">SPATIAL_REF_SYS</code>への外部キーになっています。</p></dd><dt><span class="term">TYPE</span></dt><dd><p>空間オブジェクトの型。空間カラムを単一型に制限するには、POINT, LINESTRING, POLYGON, MULTIPOINT, MULTILINESTRING, MULTIPOLYGON, GEOMETRYCOLLECTIONのうちのいずれかを、また、XYMで使う場合には、LINESTRINGM, POLYGONM, MULTIPOINTM, MULTILINESTRINGM, MULTIPOLYGONM, GEOMETRYCOLLECTIONMのうちのいずれかを使います。複数の型が混合するコレクションの場合は"GEOMETRY"を型とすることができます。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この属性は(おそらく)OpenGIS仕様に入っていませんが、型の同一性を保証するために必要です。</p></td></tr></table></div></dd></dl></div></div><div class="sect2" title="4.3.3. 空間テーブルを作る"><div class="titlepage"><div><div><h3 class="title"><a name="Create_Spatial_Table"></a>4.3.3. 空間テーブルを作る</h3></div></div></div><p>空間データを持つテーブルの生成は、1段階でできます。2次元ラインストリングでWGS84経度緯度のジオメトリカラムを持つroadsテーブルの生成の例を次に示します。</p><pre class="programlisting">CREATE TABLE ROADS ( ID int4
	  	, ROAD_NAME varchar(25), geom geometry(LINESTRING,4326) );</pre><p>次の、3次元ラインストリングを追加する例で示す通り、標準的なALTER TABLEコマンドを使ってカラムを追加できます。</p><pre class="programlisting">ALTER TABLE roads ADD COLUMN geom2 geometry(LINESTRINGZ,4326);</pre><p>後方互換のため、今でも、管理関数を使って空間テーブルを2段階で生成することもできます。</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>通常の非空間テーブルを生成します。</p><p>例: <span class="command"><strong>CREATE TABLE ROADS ( ID int4, ROAD_NAME varchar(25) )</strong></span></p></li><li class="listitem"><p>OpenGISの "AddGeometryColumn"関数によって空間カラムをテーブルに追加します。詳細情報については<a class="xref" href="#AddGeometryColumn" title="AddGeometryColumn">AddGeometryColumn</a>を参照して下さい。</p><p>文法は次の通りです。</p><pre class="programlisting">AddGeometryColumn(
  &lt;schema_name&gt;,
  &lt;table_name&gt;,
  &lt;column_name&gt;,
  &lt;srid&gt;,
  &lt;type&gt;,
  &lt;dimension&gt;
)</pre><p> 現在のスキーマを使う場合には次のようにします。</p><pre class="programlisting">AddGeometryColumn(
  &lt;table_name&gt;,
  &lt;column_name&gt;,
  &lt;srid&gt;,
  &lt;type&gt;,
  &lt;dimension&gt;
)</pre><p>例1: <span class="command"><strong>SELECT AddGeometryColumn('public',
		  'roads', 'geom', 423, 'LINESTRING', 2)</strong></span></p><p>例2: <span class="command"><strong>SELECT AddGeometryColumn( 'roads',
		  'geom', 423, 'LINESTRING', 2)</strong></span></p></li></ul></div><p>次はテーブルを作成して空間カラムを作る例です(128というSRIDがあると仮定します)。</p><pre class="programlisting">CREATE TABLE parks (
  park_id    INTEGER,
  park_name  VARCHAR,
  park_date  DATE,
  park_type  VARCHAR
);
SELECT AddGeometryColumn('parks', 'park_geom', 128, 'MULTIPOLYGON', 2 );</pre><p>うひとつ、ジェネリックな"geometry"型とSRID不明を示す0を使った例を挙げます。</p><pre class="programlisting">CREATE TABLE roads (
  road_id INTEGER,
  road_name VARCHAR
);
SELECT AddGeometryColumn( 'roads', 'roads_geom', 0, 'GEOMETRY', 3 );</pre></div><div class="sect2" title="4.3.4. 手動でジオメトリカラムをgeometry_columnsに登録する"><div class="titlepage"><div><div><h3 class="title"><a name="Manual_Register_Spatial_Column"></a>4.3.4. 手動でジオメトリカラムをgeometry_columnsに登録する</h3></div></div></div><p>AddGeometryColumn()アプローチでは、ジオメトリカラムを作成して、新しいカラムをgeometry_columnsテーブルに登録します。ソフトウェアでgeometry_columnsを使う場合には、クエリに必要なジオメトリカラムの全てがこのビューに登録されている必要があります。PostGIS 2.0からは、geometry_columnsは編集可能でなく、全てのジオメトリカラムは自動登録されます。</p><p>しかし、
カラムが生成時に特定のタイプで定義されなかった場合には、一般的なジオメトリカラムとして登録することがあります。</p><p>こういうことが発生して、AddGeometryColumnが使えない事例は、SQLビューとバルクインサートの2つがあります。これらの場合には、カラムに制約を与えることで、geometry_columnsテーブル内の登録を訂正することができます。
PostGIS 2.0以上では、カラムが型修飾に基づく場合には、生成処理によって正しく登録されるので、何も行う必要がありません。</p><pre class="programlisting">-- 次のように作ったビューがあるとしましょう
CREATE VIEW  public.vwmytablemercator AS
	SELECT gid, ST_Transform(geom,3395) As geom, f_name
	FROM public.mytable;
	
-- PostGIS 2.0以上で正しく登録するには
-- ジオメトリへのキャストが必要です。
--
DROP VIEW public.vwmytablemercator;
CREATE VIEW  public.vwmytablemercator AS
	SELECT gid, ST_Transform(geom,3395)::geometry(3395) As geom, f_name
	FROM public.mytable;
	
-- 2次元ポリゴンだと確信できる場合は次を実行します
DROP VIEW public.vwmytablemercator;
CREATE VIEW  public.vwmytablemercator AS
	SELECT gid, ST_Transform(geom,3395)::geometry(Polygon, 3395) As geom, f_name
	FROM public.mytable;</pre><pre class="programlisting">-- 巨大なデータ挿入によって派生テーブルを作ったとしましょう
SELECT poi.gid, poi.geom, citybounds.city_name
INTO myschema.my_special_pois
FROM poi INNER JOIN citybounds ON ST_Intersects(citybounds.geom, poi.geom);

-- 新テーブルに2次元インデクスを作成します
CREATE INDEX idx_myschema_myspecialpois_geom_gist
  ON myschema.my_special_pois USING gist(geom);

-- ポイントが3次元または3Mのポイントの場合、
-- 2次元インデクスのかわりにn次元インデクスを
-- 作成します
CREATE INDEX my_special_pois_geom_gist_nd 
	ON my_special_pois USING gist(geom gist_geometry_ops_nd);

-- 手動で新テーブルのジオメトリカラムをgeometry_columnsに登録するには、
-- このアプローチはPostGIS 2.0でもPostGIS 1.4以上でも動作します。
-- PostGIS 2.0ではテーブル構造をカラムをTypmodに基づくものに変更します。
-- PostGIS 2.0より前ではこれはビューを登録するのにも使えます。
SELECT populate_geometry_columns('myschema.my_special_pois'::regclass); 

-- PostGIS 2.0を使用していて、どんな理由にしても、
-- 古い制約を基にした定義の挙動が必要だとします
-- (全ての子テーブルが同じタイプとSRIDを持っているわけではない継承テーブルといった場合)
-- 新しい、省略可能引数のuse_typmodをfalseにします
SELECT populate_geometry_columns('myschema.my_special_pois'::regclass, false); </pre><p>古い制約を基にした手法は現在も対応していますが、制約を基にしたジオメトリカラムで直接的にビューで使われている場合は、型修飾子のようには正しくgeometry_columnsに登録されません。この例では、型修飾子を使ったカラム定義と、制約に基づくカラムの定義とを行っています。</p><pre class="programlisting">CREATE TABLE pois_ny(gid SERIAL PRIMARY KEY
   , poi_name text, cat varchar(20)
   , geom geometry(POINT,4326) );
SELECT AddGeometryColumn('pois_ny', 'geom_2160', 2160, 'POINT', 2, false);</pre><p>psqlで次を実行します。</p><pre class="programlisting">\d pois_ny;</pre><p>型修飾子と制約に基づくのとでは異なった定義になっているのが見えます。</p><pre class="screen">                                  Table "public.pois_ny"
  Column   |         Type          |                       Modifiers

-----------+-----------------------+------------------------------------------------------
 gid       | integer               | not null default nextval('pois_ny_gid_seq'::regclass)
 poi_name  | text                  |
 cat       | character varying(20) |
 geom      | geometry(Point,4326)  |
 geom_2160 | geometry              |
Indexes:
    "pois_ny_pkey" PRIMARY KEY, btree (gid)
Check constraints:
    "enforce_dims_geom_2160" CHECK (st_ndims(geom_2160) = 2)
    "enforce_geotype_geom_2160" CHECK (geometrytype(geom_2160) = 'POINT'::text 
        OR geom_2160 IS NULL)
    "enforce_srid_geom_2160" CHECK (st_srid(geom_2160) = 2160)</pre><p>geometry_columnsでは、両方とも正しく登録されています。</p><pre class="programlisting">SELECT f_table_name, f_geometry_column, srid, type 
	FROM geometry_columns 
	WHERE f_table_name = 'pois_ny';</pre><pre class="screen">f_table_name | f_geometry_column | srid | type
-------------+-------------------+------+-------
pois_ny      | geom              | 4326 | POINT
pois_ny      | geom_2160         | 2160 | POINT</pre><p>しかし、次のようにビューを作ろうとします。</p><pre class="programlisting">CREATE VIEW vw_pois_ny_parks AS 
SELECT * 
  FROM pois_ny 
  WHERE cat='park';
  
SELECT f_table_name, f_geometry_column, srid, type 
	FROM geometry_columns 
	WHERE f_table_name = 'vw_pois_ny_parks';</pre><p>型修飾子によるgeomのビューカラムは正しく登録されますが、制約に基づくものは正しく登録されません。</p><pre class="screen">   f_table_name   | f_geometry_column | srid |   type
------------------+-------------------+------+----------
 vw_pois_ny_parks | geom              | 4326 | POINT
 vw_pois_ny_parks | geom_2160         |    0 | GEOMETRY</pre><p>これは、将来的にPostGISの版で変更されるかもしれませんが、今のところは、制約に基づくビューカラムを正しく登録させるには、次のようにします。</p><pre class="programlisting">DROP VIEW vw_pois_ny_parks;
CREATE VIEW vw_pois_ny_parks AS 
SELECT gid, poi_name, cat
  , geom
  , geom_2160::geometry(POINT,2160) As geom_2160 
  FROM pois_ny 
  WHERE cat='park';
SELECT f_table_name, f_geometry_column, srid, type 
	FROM geometry_columns 
	WHERE f_table_name = 'vw_pois_ny_parks';</pre><pre class="screen">   f_table_name   | f_geometry_column | srid | type
------------------+-------------------+------+-------
 vw_pois_ny_parks | geom              | 4326 | POINT
 vw_pois_ny_parks | geom_2160         | 2160 | POINT</pre></div><div class="sect2" title="4.3.5. ジオメトリのOpenGIS準拠を確実にする"><div class="titlepage"><div><div><h3 class="title"><a name="OGC_Validity"></a>4.3.5. ジオメトリのOpenGIS準拠を確実にする</h3></div></div></div><p>PostGISはOpen Geospatial Consortium (OGC)のOpenGIS仕様に準拠しています。多くのPostGISメソッドは、操作対象のジオメトリが単純かつ妥当である(正確に言うとそう仮定します)ことを求めます。たとえば、ポリゴンの外に穴があるようなものの面積を計算したり、単純でない境界線を持つポリゴンを作ったりするのは、意味がありません。</p><p>OGS仕様に沿うと、<span class="emphasis"><em>単純な</em></span>ジオメトリとは、自己インタセクトや自己接触があるような、異常な幾何点を持たないことです。主に0次元または1次元のジオメトリ(<code class="varname">[MULTI]POINT, [MULTI]LINESTRING</code>)に適用します。 他方、ジオメトリの妥当性は、主に2次元ジオメトリ(<code class="varname">[MULTI]POLYGON</code>)に適用し、妥当なポリゴンを特徴づける位置指定子の集合を定義します。個々のジオメトリクラスには、単純性と妥当性をさらに詳細に述べる特定の条件があります。</p><p><code class="varname">POINT</code>は0次元ジオメトリオブジェクトとして常に<span class="emphasis"><em>単純です</em></span>。</p><p><code class="varname">MULTIPOINT</code>は、2つの座標値(<code class="varname">POINT</code>)が同じでないなら<span class="emphasis"><em>単純です</em></span>。</p><p><code class="varname">LINESTRING</code>は、2度同じ<code class="varname">POINT</code>を通らない(終点は除きます。この場合は線型環と呼ばれ、さらに言うと閉じていると思われます)なら単純です。</p><div class="informaltable"><table border="0"><colgroup><col><col></colgroup><tbody><tr><td align="center"><div class="informalfigure"><div class="mediaobject"><img src="images/st_issimple01.png"><div class="caption"><p><span class="bold"><strong>(a)</strong></span></p></div></div></div></td><td align="center"><div class="informalfigure"><div class="mediaobject"><img src="images/st_issimple02.png"><div class="caption"><p><span class="bold"><strong>(b)</strong></span></p></div></div></div></td></tr><tr><td align="center"><div class="informalfigure"><div class="mediaobject"><img src="images/st_issimple03.png"><div class="caption"><p><span class="bold"><strong>(c)</strong></span></p></div></div></div></td><td align="center"><div class="informalfigure"><div class="mediaobject"><img src="images/st_issimple04.png"><div class="caption"><p><span class="bold"><strong>(d)</strong></span></p></div></div></div></td></tr></tbody></table><table border="0"><colgroup><col></colgroup><tbody><tr><td><p><span class="bold"><strong>(a)</strong></span>と<span class="bold"><strong>(c)</strong></span>は単純な<code class="varname">LINESTRING</code>で、<span class="bold"><strong>(b)</strong></span>と<span class="bold"><strong>(d)</strong></span>は単純ではありません。</p></td></tr></tbody></table></div><p>A <code class="varname">MULTILINESTRING</code>は、 全ての要素が単純で、かつ任意の2要素のインタセクトが要素の境界である<code class="varname">POINT</code>でだけ発生する場合に限って<span class="emphasis"><em>単純です</em></span>。</p><div class="informaltable"><table border="0"><colgroup><col><col><col></colgroup><tbody><tr><td align="center"><div class="informalfigure"><div class="mediaobject"><img src="images/st_issimple05.png"><div class="caption"><p><span class="bold"><strong>(e)</strong></span></p></div></div></div></td><td align="center"><div class="informalfigure"><div class="mediaobject"><img src="images/st_issimple06.png"><div class="caption"><p><span class="bold"><strong>(f)</strong></span></p></div></div></div></td><td align="center"><div class="informalfigure"><div class="mediaobject"><img src="images/st_issimple07.png"><div class="caption"><p><span class="bold"><strong>(g)</strong></span></p></div></div></div></td></tr></tbody></table><table border="0"><colgroup><col></colgroup><tbody><tr><td><p><span class="bold"><strong>(e)</strong></span>と<span class="bold"><strong>(f)</strong></span>は単純な<code class="varname">MULTILINESTRING</code>で、<span class="bold"><strong>(g)</strong></span>は単純ではありません。</p></td></tr></tbody></table></div><p>定義から<code class="varname">POLYGON</code>は常に<span class="emphasis"><em>単純です</em></span>。バウンダリ内の環(外環と内環からなる)のうち2つがクロスしていないなら<span class="emphasis"><em>妥当です</em></span>。<code class="varname">POLYGON</code>の境界は、<code class="varname">POINT</code>とインタセクトするかも知れませんが、接点にしかなりません(すなわち線上にない)。<code class="varname">POLYGON</code>はカットラインまたはスパイクを持たなくても良く、内環は外環の中に完全に含まれていなければなりません。</p><div class="informaltable"><table border="0"><colgroup><col><col><col></colgroup><tbody><tr><td align="center"><div class="informalfigure"><div class="mediaobject"><img src="images/st_isvalid01.png"><div class="caption"><p><span class="bold"><strong>(h)</strong></span></p></div></div></div></td><td align="center"><div class="informalfigure"><div class="mediaobject"><img src="images/st_isvalid02.png"><div class="caption"><p><span class="bold"><strong>(i)</strong></span></p></div></div></div></td><td align="center"><div class="informalfigure"><div class="mediaobject"><img src="images/st_isvalid03.png"><div class="caption"><p><span class="bold"><strong>(j)</strong></span></p></div></div></div></td></tr><tr><td align="center"><div class="informalfigure"><div class="mediaobject"><img src="images/st_isvalid04.png"><div class="caption"><p><span class="bold"><strong>(k)</strong></span></p></div></div></div></td><td align="center"><div class="informalfigure"><div class="mediaobject"><img src="images/st_isvalid05.png"><div class="caption"><p><span class="bold"><strong>(l)</strong></span></p></div></div></div></td><td align="center"><div class="informalfigure"><div class="mediaobject"><img src="images/st_isvalid06.png"><div class="caption"><p><span class="bold"><strong>(m)</strong></span></p></div></div></div></td></tr></tbody></table><table border="0"><colgroup><col></colgroup><tbody><tr><td><p><span class="bold"><strong>(h)</strong></span>と<span class="bold"><strong>(i)</strong></span>は妥当な<code class="varname">POLYGON</code>です。<span class="bold"><strong>(j-m)</strong></span>は単一の<code class="varname">POLYGON</code>としては表現できませんが、<span class="bold"><strong>(j)</strong></span>と<span class="bold"><strong>(m)</strong></span>は妥当な<code class="varname">MULTIPOLYGON</code>として表現できます。</p></td></tr></tbody></table></div><p><code class="varname">MULTIPOLYGON</code>は、全ての要素が妥当で、2つのポリゴン要素について内環がインタセクトしていない場合は<span class="emphasis"><em>妥当です</em></span>。ポリゴン要素の任意の2つの境界は接触してもよいですが、有限な数の<code class="varname">POINT</code>でなければなりません。</p><div class="informaltable"><table border="0"><colgroup><col><col></colgroup><tbody><tr><td align="center"><div class="informalfigure"><div class="mediaobject"><img src="images/st_isvalid07.png"><div class="caption"><p><span class="bold"><strong>(n)</strong></span></p></div></div></div></td><td align="center"><div class="informalfigure"><div class="mediaobject"><img src="images/st_isvalid08.png"><div class="caption"><p><span class="bold"><strong>(o)</strong></span></p></div></div></div></td><td align="center"><div class="informalfigure"><div class="mediaobject"><img src="images/st_isvalid09.png"><div class="caption"><p><span class="bold"><strong>(p)</strong></span></p></div></div></div></td></tr></tbody></table><table border="0"><colgroup><col></colgroup><tbody><tr><td><p><span class="bold"><strong>(n)</strong></span>と<span class="bold"><strong>(o)</strong></span>妥当でない<code class="varname">MULTIPOLYGON</code>です。<span class="bold"><strong>(p)</strong></span>は妥当です。</p></td></tr></tbody></table></div><p>GEOSライブラリを使って実装されている関数のほとんどは、ジオメトリがOpenGIS Simple Feature Specificationで定義されているように妥当であると仮定しています。ジオメトリが単純であるか、また妥当であるか、のチェックとして<a class="link" href="#ST_IsSimple" title="ST_IsSimple">ST_IsSimple()</a>と<a class="link" href="#ST_IsValid" title="ST_IsValid">ST_IsValid()</a>が使えます。</p><pre class="programlisting">-- 一般的に、線フィーチャーの妥当性のチェックは、
-- 常にTRUEを返すので意味がありません。
-- しかし、この例では、PostGISがOGCのIsValidの定義を拡張して、
-- 一意な頂点が2より少ないラインストリングについてFALSEを
-- 返すようにしています。
gisdb=# SELECT
   ST_IsValid('LINESTRING(0 0, 1 1)'),
   ST_IsValid('LINESTRING(0 0, 0 0, 0 0)');

 st_isvalid | st_isvalid
------------+-----------
      t     |     f</pre><p>デフォルトでは、PostGISはジオメトリ入力に関するこの妥当性チェックを適用しません。複雑なジオメトリの妥当性のチェックはCPU時間を多く必要とするためです。データソースが信用できない場合は、手動でこのチェックを強制するための制約を付けることができます。</p><pre class="programlisting">ALTER TABLE mytable
  ADD CONSTRAINT geometry_valid_check
	CHECK (ST_IsValid(the_geom));</pre><p>妥当な入力ジオメトリでPostGIS関数を呼んだのに"GEOS Intersection()がエラーを投げました!"や"JTS Intersection()がエラーを投げました!"というようなメッセージに遭遇したら、それはたぶん、PostGISまたは使用しているライブラリの中のエラーを発見しました。PostGIS開発者に連絡するべきです。PostGIS関数が妥当である入力ジオメトリから妥当でないジオメトリが返る場合も同じです。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>厳格にOGCジオメトリに準拠すると、Z値やM値を持てません。<a class="link" href="#ST_IsValid" title="ST_IsValid">ST_IsValid()</a>は高次を考慮に入れません。<a class="link" href="#AddGeometryColumn" title="AddGeometryColumn">AddGeometryColumn()</a>を実行するとジオメトリの次元をチェックする制約が加わるので、そこで2を指定すれば十分です。</p></td></tr></table></div></div><div class="sect2" title="4.3.6. Dimensionally Extended 9 Intersection Model (DE-9IM)"><div class="titlepage"><div><div><h3 class="title"><a name="DE-9IM"></a>4.3.6. Dimensionally Extended 9 Intersection Model (DE-9IM)</h3></div></div></div><p>代表的な空間述語(<a class="xref" href="#ST_Contains" title="ST_Contains">ST_Contains</a>, <a class="xref" href="#ST_Crosses" title="ST_Crosses">ST_Crosses</a>, <a class="xref" href="#ST_Intersects" title="ST_Intersects">ST_Intersects</a>, <a class="xref" href="#ST_Touches" title="ST_Touches">ST_Touches</a>, ...)は、求める空間フィルタを十分に提供しきれないことがあります。</p><div class="informaltable"><table border="0"><colgroup><col></colgroup><tbody><tr><td><div class="informalfigure-float" style="float: left;"><div class="informalfigure"><div align="left"><img src="images/de9im01.png" align="left"></div></div></div><p>たとえば、道路網を表現する線型のデータセットがあるとします。ビジネスルールを無視しているかも知れませんが、点で交差するだけでなく線上で交差する道路区間を全て判別することがGIS解析者の仕事となるかも知れません。この場合、<a class="xref" href="#ST_Crosses" title="ST_Crosses">ST_Crosses</a>では重要な空間フィルタとして十分ではありません。線型のフィーチャーでは、点で交差している場合のみ<code class="varname">true</code>が返ります。</p>
<p>空間的にインタセクトしている(<a class="xref" href="#ST_Intersects" title="ST_Intersects">ST_Intersects</a>)と判別された2つの区間の組み合わせについて、実際のインタセクト(<a class="xref" href="#ST_Intersection" title="ST_Intersection">ST_Intersection</a>)を取り、 インタセクトの<a class="xref" href="#ST_GeometryType" title="ST_GeometryType">ST_GeometryType</a>が'<code class="varname">LINESTRING</code>'であるかを見る(<code class="varname">[MULTI]POINT</code>, <code class="varname">[MULTI]LINESTRING</code>等からなる<code class="varname">GEOMETRYCOLLECTION</code>が返ってくる場合にしっかり対処します)、とい2段階の方法で解くことはできます。</p>
<p>よりエレガントかつ速い解法が本当に望ましいでしょう。</p></td></tr></tbody></table></div><div class="informaltable"><table border="0"><colgroup><col></colgroup><tbody><tr><td><p> </p><div class="informalfigure-float" style="float: right;"><div class="informalfigure"><div align="right"><img src="images/de9im02.png" align="right"></div></div></div> <p>
二つ目の[理論的な]例として、GIS解析者が全ての湖の境界に線でインタセクトする波止場やドックの全ての位置を特定しようとするとします。ここで、波止場の一端だけ陸にあるとします。言いかえると、波止場が湖の中にあるが完全に中に入りきってはいなくて、湖と線でインタセクトして、波止場の一方の端が完全に湖に入っていて、かつもう一方の端点が境界線上にあります。解析者は空間述語の組み合わせで、非常に望まれるフィーチャーを引き出す必要があるかも知れません。</p> <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="xref" href="#ST_Contains" title="ST_Contains">ST_Contains</a>(lake, wharf) = TRUE</p></li><li class="listitem"><p><a class="xref" href="#ST_ContainsProperly" title="ST_ContainsProperly">ST_ContainsProperly</a>(lake, wharf) = FALSE</p></li><li class="listitem"><p><a class="xref" href="#ST_GeometryType" title="ST_GeometryType">ST_GeometryType</a>(<a class="xref" href="#ST_Intersection" title="ST_Intersection">ST_Intersection</a>(wharf, lake)) =
                      'LINESTRING'</p></li><li class="listitem"><p><a class="xref" href="#ST_NumGeometries" title="ST_NumGeometries">ST_NumGeometries</a>(<a class="xref" href="#ST_Multi" title="ST_Multi">ST_Multi</a>(<a class="xref" href="#ST_Intersection" title="ST_Intersection">ST_Intersection</a>(<a class="xref" href="#ST_Boundary" title="ST_Boundary">ST_Boundary</a>(wharf),
                      <a class="xref" href="#ST_Boundary" title="ST_Boundary">ST_Boundary</a>(lake)))) = 1</p><p>... (複雑なので以下略)</p></li></ul></div></td></tr></tbody></table></div><p>ここで、Dimensionally Extended 9 Intersection Modelまたは略してDE-9IMを見てみましょう。</p><div class="sect3" title="4.3.6.1. Theory"><div class="titlepage"><div><div><h4 class="title"><a name="id286978535"></a>4.3.6.1. Theory</h4></div></div></div><p><a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features Implementation Specification for SQL</a>によると「2つのジオメトリの比較の基本的なアプローチは、2つのジオメトリの内部、境界、外部のインタセクションの比較と、『インタセクション行列』の要素に基づく2ジオメトリの関係の分類です」。</p><div class="glosslist"><dl><dt>境界(Boundary)</dt><dd><p>ジオメトリの境界はひとつ低い次元のジオメトリの集合です。0次元の<code class="varname">POINT</code>の境界は空集合です。<code class="varname">LINESTRING</code>の境界は二つの端点です。<code class="varname">POLYGON</code>の境界は外環と内環を形成する線です。</p></dd><dt>内部(Interior)</dt><dd><p>ジオメトリの内部は境界を取り去った際に残るジオメトリです。<code class="varname">POINT</code>の内部は<code class="varname">POINT</code>自身です。<code class="varname">LINESTRING</code>の内部は二つの端点の間の実際の点の集合です。<code class="varname">POLYGON</code>の内部はポリゴンの内側の範囲であるサーフェスです。</p></dd><dt>外部(Exterior) </dt><dd><p>ジオメトリの外部は、内部と境界を除いた全領域のサーフェスです。</p></dd></dl></div><p>ジオメトリ<span class="emphasis"><em>a</em></span>があり、aの<span class="emphasis"><em>内部</em></span>、<span class="emphasis"><em>境界</em></span>、<span class="emphasis"><em>外部</em></span>をそれぞれ<span class="emphasis"><em>I(a)</em></span>, <span class="emphasis"><em>B(a)</em></span>, <span class="emphasis"><em>E(a)</em></span>とします。数学的な行列表現は次のようになります。</p><div class="styledtable"><table border="1"><colgroup><col><col><col><col></colgroup><thead><tr><th align="center">i￡°</th><th align="center"><span class="bold"><strong>内部</strong></span></th><th align="center"><span class="bold"><strong>境界</strong></span></th><th align="center"><span class="bold"><strong>外部</strong></span></th></tr></thead><tbody><tr><td align="center"><span class="bold"><strong>内部</strong></span></td><td align="center"><span class="emphasis"><em><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" display="block" overflow="scroll">
                        <mml:mrow>
                          <mml:mtext mathvariant="italic">dim(
                          I(a)</mml:mtext>

                          <mml:mo>∩</mml:mo>

                          <mml:mtext mathvariant="italic">I(b) )</mml:mtext>
                        </mml:mrow>
                      </mml:math></em></span></td><td align="center"><span class="emphasis"><em><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" display="block" overflow="scroll">
                        <mml:mrow>
                          <mml:mtext mathvariant="italic">dim(
                          I(a)</mml:mtext>

                          <mml:mo>∩</mml:mo>

                          <mml:mtext mathvariant="italic">B(b) )</mml:mtext>
                        </mml:mrow>
                      </mml:math></em></span></td><td align="center"><span class="emphasis"><em><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" display="block" overflow="scroll">
                        <mml:mrow>
                          <mml:mtext mathvariant="italic">dim(
                          I(a)</mml:mtext>

                          <mml:mo>∩</mml:mo>

                          <mml:mtext mathvariant="italic">E(b) )</mml:mtext>
                        </mml:mrow>
                      </mml:math></em></span></td></tr><tr><td align="center"><span class="bold"><strong>境界</strong></span></td><td align="center"><span class="emphasis"><em><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" display="block" overflow="scroll">
                        <mml:mrow>
                          <mml:mtext mathvariant="italic">dim(
                          B(a)</mml:mtext>

                          <mml:mo>∩</mml:mo>

                          <mml:mtext mathvariant="italic">I(b) )</mml:mtext>
                        </mml:mrow>
                      </mml:math></em></span></td><td align="center"><span class="emphasis"><em><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" display="block" overflow="scroll">
                        <mml:mrow>
                          <mml:mtext mathvariant="italic">dim(
                          B(a)</mml:mtext>

                          <mml:mo>∩</mml:mo>

                          <mml:mtext mathvariant="italic">B(b) )</mml:mtext>
                        </mml:mrow>
                      </mml:math></em></span></td><td align="center"><span class="emphasis"><em><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" display="block" overflow="scroll">
                        <mml:mrow>
                          <mml:mtext mathvariant="italic">dim(
                          B(a)</mml:mtext>

                          <mml:mo>∩</mml:mo>

                          <mml:mtext mathvariant="italic">E(b) )</mml:mtext>
                        </mml:mrow>
                      </mml:math></em></span></td></tr><tr><td align="center"><span class="bold"><strong>外部</strong></span></td><td align="center"><span class="emphasis"><em><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" display="block" overflow="scroll">
                        <mml:mrow>
                          <mml:mtext mathvariant="italic">dim(
                          E(a)</mml:mtext>

                          <mml:mo>∩</mml:mo>

                          <mml:mtext mathvariant="italic">I(b) )</mml:mtext>
                        </mml:mrow>
                      </mml:math></em></span></td><td align="center"><span class="emphasis"><em><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" display="block" overflow="scroll">
                        <mml:mrow>
                          <mml:mtext mathvariant="italic">dim(
                          E(a)</mml:mtext>

                          <mml:mo>∩</mml:mo>

                          <mml:mtext mathvariant="italic">B(b) )</mml:mtext>
                        </mml:mrow>
                      </mml:math></em></span></td><td align="center"><span class="emphasis"><em><mml:math xmlns:mml="http://www.w3.org/1998/Math/MathML" display="block" overflow="scroll">
                        <mml:mrow>
                          <mml:mtext mathvariant="italic">dim(
                          E(a)</mml:mtext>

                          <mml:mo>∩</mml:mo>

                          <mml:mtext mathvariant="italic">E(b) )</mml:mtext>
                        </mml:mrow>
                      </mml:math></em></span></td></tr></tbody></table></div><p>ここで<span class="emphasis"><em>dim(a)</em></span>は<span class="emphasis"><em>a</em></span>の次元で、<a class="xref" href="#ST_Dimension" title="ST_Dimension">ST_Dimension</a>で規定されますが、<code class="literal">{0,1,2,T,F,*}</code>の値域を持ちます。</p><div class="itemizedlist"><ul class="itemizedlist" type="disc" compact><li class="listitem"><p><code class="literal">0</code> =&gt; ポイント</p></li><li class="listitem"><p><code class="literal">1</code> =&gt; ライン</p></li><li class="listitem"><p><code class="literal">2</code> =&gt; 領域</p></li><li class="listitem"><p><code class="literal">T</code> =&gt;
              <code class="literal">{0,1,2}</code></p></li><li class="listitem"><p><code class="literal">F</code> =&gt; 空集合</p></li><li class="listitem"><p><code class="literal">*</code> =&gt; 何でも良い</p></li></ul></div><p>可視化すると、二つのオーバラップするポリゴンについては、次のようになります。</p><div class="informaltable"><table border="0"><colgroup><col width="80pt"><col></colgroup><tbody><tr><td>i￡°</td><td align="center"><div class="informalfigure"><div align="center"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0"><tr><td align="center" valign="middle"><img src="images/de9im04.png" align="middle"></td></tr></table></div></div></td></tr><tr><td align="center" valign="middle"><div class="informalfigure"><div align="center"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0"><tr><td align="center" valign="middle"><img src="images/de9im03.png" align="middle"></td></tr></table></div></div></td><td><p> </p><div class="styledtable"><table border="1"><colgroup><col><col><col><col></colgroup><thead valign="middle"><tr><th align="center" valign="middle">i￡°</th><th align="center" valign="middle"><span class="bold"><strong>内部</strong></span></th><th align="center" valign="middle"><span class="bold"><strong>境界</strong></span></th><th align="center" valign="middle"><span class="bold"><strong>外部</strong></span></th></tr></thead><tbody valign="middle"><tr><td align="center" valign="middle"><span class="bold"><strong>内部</strong></span></td><td align="center" valign="middle"><div class="informalfigure"><div><img src="images/de9im05.png"></div></div><p><span class="emphasis"><em>dim(...) =
                            </em></span><span class="bold"><strong>2</strong></span></p></td><td align="center" valign="middle"><div class="informalfigure"><div><img src="images/de9im06.png"></div></div><p><span class="emphasis"><em>dim(...) =
                            </em></span><span class="bold"><strong>1</strong></span></p></td><td align="center" valign="middle"><div class="informalfigure"><div><img src="images/de9im07.png"></div></div><p><span class="emphasis"><em>dim(...) =
                            </em></span><span class="bold"><strong>2</strong></span></p></td></tr><tr><td align="center" valign="middle"><span class="bold"><strong>境界</strong></span></td><td align="center" valign="middle"><div class="informalfigure"><div><img src="images/de9im08.png"></div></div><p><span class="emphasis"><em>dim(...) =
                            </em></span><span class="bold"><strong>1</strong></span></p></td><td align="center" valign="middle"><div class="informalfigure"><div><img src="images/de9im09.png"></div></div><p><span class="emphasis"><em>dim(...) =
                            </em></span><span class="bold"><strong>0</strong></span></p></td><td align="center" valign="middle"><div class="informalfigure"><div><img src="images/de9im10.png"></div></div><p><span class="emphasis"><em>dim(...) =
                            </em></span><span class="bold"><strong>1</strong></span></p></td></tr><tr><td align="center" valign="middle"><span class="bold"><strong>外部</strong></span></td><td align="center" valign="middle"><div class="informalfigure"><div><img src="images/de9im11.png"></div></div><p><span class="emphasis"><em>dim(...) =
                            </em></span><span class="bold"><strong>2</strong></span></p></td><td align="center" valign="middle"><div class="informalfigure"><div><img src="images/de9im12.png"></div></div><p><span class="emphasis"><em>dim(...) =
                            </em></span><span class="bold"><strong>1</strong></span></p></td><td align="center" valign="middle"><div class="informalfigure"><div><img src="images/de9im13.png"></div></div><p><span class="emphasis"><em>dim(...) =
                            </em></span><span class="bold"><strong>2</strong></span></p></td></tr></tbody></table></div></td></tr></tbody></table></div><p>左から右、上から下に読むと、次元行列は'<span class="bold"><strong>212101212</strong></span>'と表現されます。</p><p>1つ目の例である、2線が線上でインタセクトする場合の関係行列は'<span class="bold"><strong>1*1***1**</strong></span>'となります。</p><pre class="programlisting">-- 線上でクロスする道路区間の判別
SELECT a.id
FROM roads a, roads b
WHERE a.id != b.id 
AND a.geom &amp;&amp; b.geom
AND ST_Relate(a.geom, b.geom, '1*1***1**');</pre><p>2つ目の例である、一部が湖の水涯線上にある波止場についての関係行列は'<span class="bold"><strong>102101FF2</strong></span>'となります。</p><pre class="programlisting">-- 一部が湖の水涯線上にある波止場の判別
SELECT a.lake_id, b.wharf_id
FROM lakes a, wharfs b
WHERE a.geom &amp;&amp; b.geom
AND ST_Relate(a.geom, b.geom, '102101FF2');</pre><p>詳細情報ついては、次のページをご覧ください。</p><div class="itemizedlist"><ul class="itemizedlist" type="disc" compact><li class="listitem"><p><a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple
          Features Implementation Specification for SQL</a> (version 1.1, section 2.1.13.2)</p></li><li class="listitem"><p><a class="ulink" href="http://gis.hsr.ch/wiki/images/3/3d/9dem_springer.pdf" target="_top">Dimensionally 
              Extended Nine-Intersection Model (DE-9IM) by Christian Strobl</a></p></li><li class="listitem"><p><a class="ulink" href="http://docs.geotools.org/latest/userguide/library/jts/dim9.html" target="_top">GeoTools: Point Set Theory and the DE-9IM Matrix</a></p></li><li class="listitem"><p><span class="emphasis"><em>Encyclopedia of GIS</em></span> By Hui Xiong</p></li></ul></div></div></div></div><div class="sect1" title="4.4. GISデータをロードする"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id286979474"></a>4.4. GISデータをロードする</h2></div></div></div><div class="toc"><dl><dt><span class="sect2"><a href="#id286979482">4.4.1. SQLを使う</a></span></dt><dt><span class="sect2"><a href="#shp2pgsql_usage">4.4.2. ローダを使う</a></span></dt></dl></div><p>空間テーブルを作成したら、これでGISデータをデータベースにアップロードする準備ができたことになります。現在、PostGIS/PostgreSQLデータベースにデータをロードするには、SQLステートメントを使う、またはシェープファイルのローダ/ダンパを使う、2つの方法があります。</p><div class="sect2" title="4.4.1. SQLを使う"><div class="titlepage"><div><div><h3 class="title"><a name="id286979482"></a>4.4.1. SQLを使う</h3></div></div></div><p>データをテキスト表現に変換できるなら、フォーマットされたSQLを使うのがデータをPostGISに入れる最も簡単な方法です。Oracleや他のSQLデータベースを使うように、SQL端末モニタにSQLの"INSERT"ステートメントで一杯になった大きなテキストファイルをパイプで送ることで、大量のデータをロードできます。</p><p>データアップロードファイル(たとえば<code class="filename">roads.sql</code>)はこのようになるでしょう。</p><pre class="programlisting">BEGIN;
INSERT INTO roads (road_id, roads_geom, road_name)
  VALUES (1,ST_GeomFromText('LINESTRING(191232 243118,191108 243242)',-1),'Jeff Rd');
INSERT INTO roads (road_id, roads_geom, road_name)
  VALUES (2,ST_GeomFromText('LINESTRING(189141 244158,189265 244817)',-1),'Geordie Rd');
INSERT INTO roads (road_id, roads_geom, road_name)
  VALUES (3,ST_GeomFromText('LINESTRING(192783 228138,192612 229814)',-1),'Paul St');
INSERT INTO roads (road_id, roads_geom, road_name)
  VALUES (4,ST_GeomFromText('LINESTRING(189412 252431,189631 259122)',-1),'Graeme Ave');
INSERT INTO roads (road_id, roads_geom, road_name)
  VALUES (5,ST_GeomFromText('LINESTRING(190131 224148,190871 228134)',-1),'Phil Tce');
INSERT INTO roads (road_id, roads_geom, road_name)
  VALUES (6,ST_GeomFromText('LINESTRING(198231 263418,198213 268322)',-1),'Dave Cres');
COMMIT;</pre><p>データファイルは、次に示す"psql"というSQL端末モニタを使って、簡単にPostgreSQLにパイプで送ることができます。</p><pre class="programlisting">psql -d [database] -f roads.sql</pre></div><div class="sect2" title="4.4.2. ローダを使う"><div class="titlepage"><div><div><h3 class="title"><a name="shp2pgsql_usage"></a>4.4.2. ローダを使う</h3></div></div></div><p>
    <code class="filename">shp2pgsql</code>データローダは、ESRIシェープファイルをPostGIS/PostgreSQLデータベースに、ジオメトリまたはジオグラフィとして挿入するための適切なSQLに変換します。ローダには、次に示すコマンドラインフラグによって区別される、いくつかの操作モードがあります。</p><p>さらに、コマンドラインローダのほとんどのオプションに対応する<code class="filename">shp2pgsql-gui</code>グラフィカルユーザインタフェースがあります。一度限りでスクリプト化しないロードを行う場合やPostGISに不慣れな方にとって便利になるかもしれません。これはPgAdminIIIのプラグインとし構築することもできます。</p><div class="variablelist"><dl><dt><span class="term">(c|a|d|p) 相互に排他的なオプションです</span></dt><dd><p>
          </p><div class="variablelist"><dl><dt><span class="term">-c</span></dt><dd><p>
                  新しいテーブルの作成とシェープファイルからのデータの読み込みを行います。<span class="emphasis"><em>これがデフォルトモードです。</em></span>
                </p></dd><dt><span class="term">-a</span></dt><dd><p>
                  シェープファイルからデータベーステーブルにデータを追加します。複数のファイルをロードするためにこのオプションを使う場合は、これらのファイルは同じ属性と同じデータ型を持つ必要があります。
                </p></dd><dt><span class="term">-d</span></dt><dd><p>
                  シェープファイルにあるデータを持つ新しいテーブルを作成する前にデータベーステーブルを削除します。
                </p></dd><dt><span class="term">-p</span></dt><dd><p>
                  テーブル作成のSQLコードを生成するだけで、実際のデータは追加しません。このモードは、テーブル作成とデータロードとを完全に分けたい場合に使用します。
                </p></dd></dl></div><p>
        </p></dd><dt><span class="term">-?</span></dt><dd><p>
          ヘルプ画面を表示します。
        </p></dd><dt><span class="term">-D</span></dt><dd><p>
          出力データにPostgreSQLの"dump"書式を用います。このモードは-a, -c, -dと組み合わせて利用します。デフォルトの"insert"によるSQL書式よりも、大変早くロードできます。大きなデータセットではこちらを使用して下さい。
        </p></dd><dt><span class="term">-s [&lt;FROM_SRID%gt;:]&lt;SRID&gt;</span></dt><dd><p>
          指定したSRIDでジオメトリデーブルの作成とデータの読み込みを行います。
入力シェープファイルが使っているFROM_SRIDの指定が可能で、この場合は対象SRIDに投影変換を行います。FROM_SRIDは-Dと一緒には指定できません。
        </p></dd><dt><span class="term">-k</span></dt><dd><p>
          識別子(カラム、スキーマおよび属性)の大文字小文字を保持します。シェープファイルの属性は全て大文字であることに注意して下さい。
        </p></dd><dt><span class="term">-i</span></dt><dd><p>
          全ての整数を標準の32ビット整数に強制します。DBFヘッダではそれが正当であったとしても、64ビットのbigintを生成しません。
        </p></dd><dt><span class="term">-I</span></dt><dd><p>
          ジオメトリカラムにGiSTインデクスを生成します。
        </p></dd><dt><span class="term">-S </span></dt><dd><p>
          MULTIジオメトリの替りに単一ジオメトリを生成します。全てのジオメトリが実際に単一である(たとえば単一の外環でなるMULTIPOLYGONや単一の頂点でなるMULTIPOINT)場合にのみ成功します。
        </p></dd><dt><span class="term">-t &lt;dimensionality&gt;</span></dt><dd><p>
          出力ジオメトリが特定の次元を持つよう強制します。次元は、2D, 3DZ, 3DM, 4Dの文字列を使います。
        </p><p>
            入力の次元が出力より小さい場合には、出力では0が入ります。入力の次元が大きい場合には、外されます。
        </p></dd><dt><span class="term">-w</span></dt><dd><p>
          出力書式をWKBでなくWKTにします。精度が低下して、座標変動が発生しうることに注意が必要です。
        </p></dd><dt><span class="term">-e</span></dt><dd><p>
          トランザクションを使わずに、ステートメントごとに実行するようにします。エラーの元となる不良なジオメトリがいくつか含んでいる時に、大半の良好なデータのロードが可能にするものです。"dump"書式ではトランザクションを常に使うので、-Dフラグを指定している場合には使えません。
        </p></dd><dt><span class="term">-W &lt;encoding&gt;</span></dt><dd><p>
          入力データ(dbfファイル)のエンコーディングを指定します。全てのdbfの属性は指定されたエンコーディングからUTF8に変換されます。SQL出力結果には<code class="code">SET CLIENT_ENCODING to UTF8</code>が含まれるようになり、バックエンドはUTF-8からデータベースが内部利用のために設定したエンコーディングに再変換できます。
        </p></dd><dt><span class="term">-N &lt;policy&gt;</span></dt><dd><p>
           NULLジオメトリ操作方針(insert*=挿入, skip=スキップ, abort=強制終了)を選択します。
        </p></dd><dt><span class="term">-n</span></dt><dd><p>
          DBFファイルのみインポートします。対応するシェープファイルを持っていない場合、 自動的にこのモードになり、DBFファイルのみロードします。 このフラグは、完全なシェープファイル群を持っていて、属性データだけが欲しくてジオメトリが欲しくない時のみ使用します。
        </p></dd><dt><span class="term">-G</span></dt><dd><p>
			ジオメトリ型のかわりに、ジオグラフィ型で、WGS84経度緯度(SRID=4326)を使用します(経度緯度データが必要です)。
		</p></dd><dt><span class="term">-T &lt;tablespace&gt;</span></dt><dd><p>
          新しいテーブルのテーブル空間を指定します。
-Xパラメータが使われない場合には、インデクスはデフォルトのテーブル空間を使用します。PostgreSQL文書には、テーブル空間を用いるべき時に関する良い文書があります。
        </p></dd><dt><span class="term">-X &lt;tablespace&gt;</span></dt><dd><p>
          新しいテーブルのインデクスで使われるテーブル空間を指定します。
主キーインデクスに適用され、-Iが合わせて使われている場合にはGiST空間インデクスにも適用されます。
        </p></dd></dl></div><p>
    ローダを使って入力ファイルを生成してアップロードするセッション例は次の通りです。
  </p><pre class="programlisting"># shp2pgsql -c -D -s 4269 -i -I shaperoads.shp myschema.roadstable &gt; roads.sql
# psql -d roadsdb -f roads.sql</pre><p>
    変換とアップロードはUNIXのパイプを使うと一回で実行できます。
  </p><pre class="programlisting"># shp2pgsql shaperoads.shp myschema.roadstable | psql -d roadsdb</pre></div></div><div class="sect1" title="4.5. GISデータを検索する"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id286980387"></a>4.5. GISデータを検索する</h2></div></div></div><div class="toc"><dl><dt><span class="sect2"><a href="#id286980395">4.5.1. SQLを使う</a></span></dt><dt><span class="sect2"><a href="#id286980695">4.5.2. ダンパを使う</a></span></dt></dl></div><p>データは、SQLまたはシェープファイルローダ/ダンパを使ってデータベースから抜き出すことができます。SQLに関する節において、空間テーブルでの比較とクエリを行うために用いることができる演算子のいくつかを議論します。</p><div class="sect2" title="4.5.1. SQLを使う"><div class="titlepage"><div><div><h3 class="title"><a name="id286980395"></a>4.5.1. SQLを使う</h3></div></div></div><p>データベースからデータを引き出す最も直接的な手段は、次のように、SQLのSELECTクエリを使って返ってくるレコードとカラムの数を減らし、結果のカラムを可読テキストファイルにダンプするやり方です。</p><pre class="programlisting">db=# SELECT road_id, ST_AsText(road_geom) AS geom, road_name FROM roads;

road_id | geom                                    | road_name
--------+-----------------------------------------+-----------
	  1 | LINESTRING(191232 243118,191108 243242) | Jeff Rd
	  2 | LINESTRING(189141 244158,189265 244817) | Geordie Rd
	  3 | LINESTRING(192783 228138,192612 229814) | Paul St
	  4 | LINESTRING(189412 252431,189631 259122) | Graeme Ave
	  5 | LINESTRING(190131 224148,190871 228134) | Phil Tce
	  6 | LINESTRING(198231 263418,198213 268322) | Dave Cres
	  7 | LINESTRING(218421 284121,224123 241231) | Chris Way
(6 rows)</pre><p>しかし、返ってくる結果の数を削るために、なんらかの制限をかけることが重要となるときがあるでしょう。属性ベースの制限の場合、非空間テーブルで使う通常の文法と同じSQLを使うだけです。空間ベースの制限の場合、次の演算子が使用可能であり、便利です。</p><div class="variablelist"><dl><dt><span class="term">&amp;&amp;</span></dt><dd><p>この演算子で、ひとつのジオメトリのバウンディングボックスが他のバウンディングボックスとインタセクトするかを問い合わせることができます。</p></dd><dt><span class="term">ST_OrderingEquals</span></dt><dd><p>この演算子で、二つのジオメトリが幾何的に同一であるかを見ることができます。たとえば、'POLYGON((0 0,1 1,1 0,0 0))' は 'POLYGON((0 0,1 1,1 0,0 0))' と同じかを見ることができます (これは同じとなります)。</p></dd><dt><span class="term">=</span></dt><dd><p>この演算子は他より若干素朴なもので、二つのジオメトリのバウンディングボックスが同じかを見るだけです。</p></dd></dl></div><p>次に、これらの演算子をクエリで使うことができます。SQLコマンドラインからジオメトリとボックスの特定を行うときは、"GeomFromText()"関数で、明示的に文字列表現をジオメトリに変換しなければならないことに注意して下さい。
たとえば、次のようになります(312は架空の空間参照系番号で、ここでのデータに合致しています)。</p><pre class="programlisting">SELECT road_id, road_name
  FROM roads
  WHERE ST_OrderingEquals(roads_geom , ST_GeomFromText('LINESTRING(191232 243118,191108 243242)',312) ) ;</pre><p>上のクエリは"ROADS_GEOM"テーブルから、その値と等価である単一のレコードを返します。</p><p>"&amp;&amp;"演算子を使うとき、比較フィーチャーをBOX3DかGEOMETRYかに指定することができます。ただし、GEOMETRYを指定すると、それのバウンディングボックスが比較に使われます。</p><pre class="programlisting">SELECT road_id, road_name
FROM roads
WHERE roads_geom &amp;&amp; ST_GeomFromText('POLYGON((...))',312);</pre><p>上のクエリでは、比較するためにポリゴンのバウンディングボックスを用いています。</p><p>最も一般的な空間クエリは「フレームベース」のクエリでしょう。これは、表示するためのデータの価値のある「マップフレーム」を取得するために、データブラウザやウェブマッパのようなクライアントソフトウェアに使われます。このフレームで"BOX3D"オブジェクトを使う場合は、次のようなクエリになります。</p><pre class="programlisting">SELECT ST_AsText(roads_geom) AS geom
FROM roads
WHERE
  roads_geom &amp;&amp; ST_MakeEnvelope(191232, 243117,191232, 243119,312);</pre><p>SRID 312を使っていますが、エンベロープの投影を指定してます。</p></div><div class="sect2" title="4.5.2. ダンパを使う"><div class="titlepage"><div><div><h3 class="title"><a name="id286980695"></a>4.5.2. ダンパを使う</h3></div></div></div><p><code class="filename">pgsql2shp</code>テーブルダンパは、データベースに直接接続して、テーブル(あるいはクエリによって定義されたもの)をシェープファイルに変換するものです。基本的な文法は次の通りです。</p><pre class="programlisting">pgsql2shp [&lt;options&gt;] &lt;database&gt; [&lt;schema&gt;.]&lt;table&gt;</pre><pre class="programlisting">pgsql2shp [&lt;options&gt;] &lt;database&gt; &lt;query&gt;</pre><p>コマンドラインオプションは次の通りです。</p><div class="variablelist"><dl><dt><span class="term">-f &lt;filename&gt;</span></dt><dd><p>特定のファイル名に出力を書きこみます。</p></dd><dt><span class="term">-h &lt;ホスト&gt;</span></dt><dd><p>接続先データベースのホスト名。</p></dd><dt><span class="term">-p &lt;ポート&gt;</span></dt><dd><p>接続先データベースのポート。 </p></dd><dt><span class="term">-P &lt;パスワード&gt;</span></dt><dd><p>データベースに接続するためのパスワード。</p></dd><dt><span class="term">-u &lt;ユーザ名&gt;</span></dt><dd><p>データベースに接続する際のユーザ名。</p></dd><dt><span class="term">-g &lt;ジオメトリカラム&gt;</span></dt><dd><p>複数のジオメトリカラムを持つテーブルの場合の、シェープファイルの出力に使用するジオメトリカラム。</p></dd><dt><span class="term">-b</span></dt><dd><p>バイナリカーソルを使います。これは、実行時間を短くしますが、テーブルの非ジオメトリ属性がテキストへのキャストを持っていない場合には、動作しません。</p></dd><dt><span class="term">-r</span></dt><dd><p>Rawモード。<code class="varname">gid</code>フィールドを落としたり、カラム名をエスケープしてはいけません。</p></dd><dt><span class="term">-d</span></dt><dd><p>後方互換: 古い(1.0.0より前)のPostGISデータベースからダンプする際に3次元のシェープファイルを出力します(デフォルトでは2次元になります)。 PostGIS-1.0.0以上から始めている場合には、次元は完全に反映されます。</p></dd><dt><span class="term">-m <code class="varname">ファイル名</code></span></dt><dd><p>
識別名を10文字名に再割り当てします。
ファイルの中身は、1つの空白で区切られ、前と後に空白が無い2つのシンボルの行からなります。VERYLONGSYMBOL SHORTONE ANOTHERVERYLONGSYMBOL SHORTER等となります。</p></dd></dl></div></div></div><div class="sect1" title="4.6. インデクスを構築する"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id286980859"></a>4.6. インデクスを構築する</h2></div></div></div><div class="toc"><dl><dt><span class="sect2"><a href="#id286980891">4.6.1. GiSTインデクス</a></span></dt><dt><span class="sect2"><a href="#id286980924">4.6.2. インデクスを使う</a></span></dt></dl></div><p>インデクスは大きなデータセットを持つ空間データベースの利用を可能にするものです。インデクスなしでは、フィーチャーの検索でデータベースの全レコードを「シーケンシャルスキャン」する必要があります。インデクスをつけることで、データを検索木に組織化して、特定のレコードを発見するための検索をより早くすることができます。 PostgreSQLは、B-Tree, R-Tree, GiST の三種類のインデクスをデフォルトでサポートしています。</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>B-Treeは、数字、文字、日付といった、ひとつの軸に沿ってソートできるデータに使用します。 GISデータは合理的にひとつの軸に沿ったソートはできません ((0,0)と(0,1)と(1,0)で大きいのはどれでしょう?)ので、B-Treeインデックスは、ここでは使えません。</p></li><li class="listitem"><p>R-Treeはデータを長方形に分割して、さらにその長方形を小さい長方形に分割していったものです。R-Treeはいくつかの空間データベースでGISデータのインデクスに使われますが、PostgreSQLのR-Tree実装は、GiST実装ほどにロバストではありません。</p></li><li class="listitem"><p>GiST(Generalized Search Trees)インデクスはデータを「一方へのもの」(訳注: 「左側にあるもの」「上側にあるもの」など)、「オーバラップするもの」、「中にあるもの」に分割して、GISデータを含む幅広いデータ型で使えるようにしたものです。PostGISではGISデータにインデクスを付けるためにGiSTの上でR-Treeインデクス実装を使用しています。</p></li></ul></div><div class="sect2" title="4.6.1. GiSTインデクス"><div class="titlepage"><div><div><h3 class="title"><a name="id286980891"></a>4.6.1. GiSTインデクス</h3></div></div></div><p>GiSTは「汎用的な検索木(Generalized Search Tree)」の意味で、インデックスの一般化された形式です。GISインデクスに加えて、GiSTは通常のB-Treeインデクスに従わない全ての種類の不規則なデータ構造(整数配列, スペクトラルデータ等)の検索速度を向上させるために使います。</p><p>ひとたびGISデータテーブルが数千行を超えたら、空間検索の速度向上のためインデクスを構築したくなるでしょう (これは属性検索でない場合です。属性でしたら通常のインデクスを属性フィールドに追加します)。</p><p>GiSTインデクスを「ジオメトリ」カラムに追加するための文は次の通りです。</p><pre class="programlisting">CREATE INDEX [インデクス名] ON [テーブル名] USING GIST ( [ジオメトリカラム名] ); </pre><p>空間インデクスの構築は、計算量を集中させて行われます。100万行のテーブルで、300MHzのSolaris機ではGiSTインデクスの構築に概ね1時間かかりました。インデクスを構築したあとは、クエリプランの最適化に使うため、次のようにPostgreSQLにテーブル統計情報の収集をさせることが重要です。</p><pre class="programlisting">VACUUM ANALYZE [テーブル名] [(カラム名)];
-- 次のクエリはPostgreSQL 7.4以前でのみ必要です
SELECT UPDATE_GEOMETRY_STATS([table_name], [column_name]);</pre><p>GiSTインデクスはPostgreSQLのR-Treeインデクスと比べて2つの利点を持っています。まず、GiSTインデクスは「NULLセーフ」、すなわちNULL値を含むインデクスカラムで利用できることです。次に、GiSTインデクスはGISオブジェクトがPostgreSQLで8Kのページサイズを超えるサイズを扱う際に重要な「不可逆」の概念を持っていることです。不可逆にすることによって、PostgreSQLは、インデクスにおけるオブジェクトの「重要な」部分、GISオブジェクトの場合にはバウンディングボックスになりますが、これのみを納めることができます。 R-Treeインデクスで8Kを超えるGISオブジェクトのインデクスを構築しようとすると、失敗します。</p></div><div class="sect2" title="4.6.2. インデクスを使う"><div class="titlepage"><div><div><h3 class="title"><a name="id286980924"></a>4.6.2. インデクスを使う</h3></div></div></div><p>通常、インデクスは見えないところでデータアクセスの速度向上を行います。すなわち、ひとたびインデクスが構築されたら、クエリプランナは透過的に、クエリプランの速度を向上させるためにインデクス情報を使うべき時を判断します。残念なことに、PostgreSQLクエリプランナは、GiSTインデクスの使用について十分に最適化できず、時々、検索で空間インデクスを使用すべきなのに、テーブル全体を順に走査することがあります。</p><p>空間インデクスが使用されていない(または属性インデクスがその問題のために使用されていない)場合、次の2つのことができます。</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>まず、クエリプランナにインデクス使用まわりの判断に利用するためのより良い情報を提供するために、値の数量と分散に関する統計情報が収集されたかを確認してください。PostgreSQL 7.4以前では、<span class="command"><strong>update_geometry_stats([テーブル名, カラム名])</strong></span>(分散計算)と<span class="command"><strong>VACUUM ANALYZE [テーブル名] [カラム名]</strong></span>(値の数量の計算)とを実行します。 PostgreSQL 8.0については、<span class="command"><strong>VACUUM ANALYZE</strong></span>を実行することで同じ動作になります。常に定期的なデータベースへのvacuumを実行すべきです。多くのPostgreSQLのデータベースエージェントは、閑散時のcronジョブとして定期的に<span class="command"><strong>VACUUM</strong></span>を実行します。</p></li><li class="listitem"><p>vacuumが働かないなら、<span class="command"><strong>SET ENABLE_SEQSCAN=OFF</strong></span>コマンドで、プランナにインデクス情報を強制的に使わせることができます。このコマンドは控え目に実行すべきで、かつ、空間インデクスがあるクエリ上でのみ使うべきです。一般的に言うと、通常のB-Treeインデクスを使うべき時に関してあなたが知っていることよりも、プランナはより良く知っています。クエリを実行したら、<code class="varname">ENABLE_SEQSCAN</code>設定を戻して、他のクエリでは通常通りプランナを使用することを考えるべきです。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>version 0.6では、<code class="varname">ENABLE_SEQSCAN</code>でプランナにインデクスを使わせることは重要ではありません。</p></td></tr></table></div></li><li class="listitem"><p>もし、順に走査する際のコストとインデクスを使う際のコストとを比較してプランナが間違っていることに気付いたら、postgresql.confでrandom_page_costの値を減らしてみるか、"SET random_page_cost=#" を使ってみてください。このパラメータのデフォルト値は4ですが、それを1か2にしてみて下さい。値を減らすことで、プランナがよりインデクススキャンを行う傾向になります。</p></li></ul></div></div></div><div class="sect1" title="4.7. 複雑なクエリ"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id286980997"></a>4.7. 複雑なクエリ</h2></div></div></div><div class="toc"><dl><dt><span class="sect2"><a href="#id286981012">4.7.1. インデクスの利点を使う</a></span></dt><dt><span class="sect2"><a href="#id286981166">4.7.2. 空間SQLの例</a></span></dt></dl></div><p>空間データベース機能の<span class="emphasis"><em>レゾンデートル</em></span>は、通常はデスクトップGISに求める機能を、データベース内部のクエリで実現してすることです。PostGISを効果的に使用するには、どの空間機能が有効かを知り、また、良好なパフォーマンスを提供する所に適切にインデクスがあることが保証されていることが求められます。なお、本例ではSRID 312を使っていますが、これは純粋に例として出しているだけです。spatial_ref_sysテーブルにあり、データの投影法に合致している、本当のSRIDを使ってください。空間参照系を持たないデータについては、なぜ持っていないのか、持つべきなのかも知れないのか、をじっくり*考えてください*。


たとえば分子内部や火星旅行の到達位置といった、定義された空間参照系を持たない場合には、単にSRIDを無視するか、ひとつ作成して<code class="varname">spatial_ref_sys</code>テーブルに追加して下さい。</p><div class="sect2" title="4.7.1. インデクスの利点を使う"><div class="titlepage"><div><div><h3 class="title"><a name="id286981012"></a>4.7.1. インデクスの利点を使う</h3></div></div></div><p>クエリを作成するとき、 &amp;&amp;のようなバウンディングボックスを基準とした演算子によってのみGiST空間インデクスの利点が出てくることだけは覚えておくことが重要です。<code class="varname">ST_Distance()</code>のような関数では演算の最適化を行うためにインデクスを使うことができません。たとえば、次のクエリでは、大きなテーブルでは本当に遅くなります。</p><pre class="programlisting">SELECT the_geom
FROM geom_table
WHERE ST_Distance(the_geom, ST_GeomFromText('POINT(100000 200000)', 312)) &lt; 100</pre><p>このクエリは、geom_tableにおける(100000, 200000)の点から距離が100単位以内にある全てのジオメトリを選択します。このクエリでは、テーブル内にあるそれぞれの点と指定した点との距離を計算する、すなわち、それぞれの行でひとつの<code class="varname">ST_Distance()</code>計算を行うため、遅くなるのです。&amp;&amp;演算子を使うと、求められる距離計算の量を減らすことで回避できます。次のようにします。</p><pre class="programlisting">SELECT the_geom
FROM geom_table
WHERE ST_DWithin(the_geom,  ST_MakeEnvelope(90900, 190900, 100100, 200100,312), 100)
</pre><p>このクエリは、同じジオメトリを選択しますが、より効果的な方法で行われます。the_geomにGiSTインデクスがあると仮定すると、クエリプランナは<code class="varname">ST_distance()</code>関数の結果を計算する前にインデクスを使って行を減らせると認識します。
&amp;&amp;演算子で使われる<code class="varname">ST_MakeEnvelope</code>ジオメトリが、元のポイントに中央寄せした200単位の正方形



&amp;&amp;演算子で使われる<code class="varname">ST_MakeEnvelope</code>ジオメトリは、元のポイント位置を中心とした一辺200単位の正方形です。これは「クエリボックス」です。&amp;&amp;演算子は、結果セットを「クエリボックス」にオーバラップするバウンディングボックスを持つジオメトリだけに素早く減らすためにインデクスを使います。「クエリボックス」がジオメトリテーブル全体の範囲より十分に小さいと仮定すると、行われなければならない距離計算の量は劇的に減少します。</p><div class="note" title="ふるまいの変更" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note: ふるまいの変更"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left">ふるまいの変更</th></tr><tr><td align="left" valign="top"><p>PostGIS 1.3.0では、ST_DisjointとST_Relateの注目すべき例外がありますが、ほとんどのジオメトリ関係関数は暗黙的なバウンディングボックスオーバラップ演算子を含んでいます。</p></td></tr></table></div></div><div class="sect2" title="4.7.2. 空間SQLの例"><div class="titlepage"><div><div><h3 class="title"><a name="id286981166"></a>4.7.2. 空間SQLの例</h3></div></div></div><p>本節の例では、線形の道、ポリゴンの自治体境界、の2つのテーブルを使います。テーブルの定義をしまします。<code class="varname">bc_roads</code>については次の通りです。</p><pre class="programlisting">Column      | Type              | Description
------------+-------------------+-------------------
gid         | integer           | Unique ID
name        | character varying | Road Name
the_geom    | geometry          | Location Geometry (Linestring)</pre><p><code class="varname">bc_municipality</code>の定義については次の通りです。</p><pre class="programlisting">Column     | Type              | Description
-----------+-------------------+-------------------
gid        | integer           | Unique ID
code       | integer           | Unique ID
name       | character varying | City / Town Name
the_geom   | geometry          | Location Geometry (Polygon)</pre><div class="qandaset" title="よくある質問"><a name="id286981193"></a><dl><dt>4.7.2.1. <a href="#id286981195">道路の総延長はkm表記でいくらになるでしょう?</a></dt><dt>4.7.2.2. <a href="#id286981217">プリンスジョージ市の大きさはha表記でいくらになるでしょう?</a></dt><dt>4.7.2.3. <a href="#id286981238">県内で最も大きな面積を持つ自治体はどこでしょう?</a></dt><dt>4.7.2.4. <a href="#id286981262">各自治体内に含まれる道路の総延長はいくらでしょう?</a></dt><dt>4.7.2.5. <a href="#id286981286">プリンスジョージ市内の全ての道路からなるテーブルを作る</a></dt><dt>4.7.2.6. <a href="#id286981306">ビクトリア州の「ダグラス通り」の長さはkm表記でいくらになるでしょう?</a></dt><dt>4.7.2.7. <a href="#id286981323">穴を持つ自治体ポリゴンのうち最も大きいのはどれでしょう?</a></dt></dl><table border="0" width="100%" summary="Q and A Set"><col align="left" width="1%"><col><tbody><tr class="question" title="4.7.2.1."><td align="left" valign="top"><a name="id286981195"></a><a name="id286981197"></a><p><b>4.7.2.1.</b></p></td><td align="left" valign="top"><p>道路の総延長はkm表記でいくらになるでしょう?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>この問題は、次のようなとても単純なSQLで答えを得ることができます。</p><pre class="programlisting">SELECT sum(ST_Length(the_geom))/1000 AS km_roads FROM bc_roads;

km_roads
------------------
70842.1243039643
(1 row)</pre></td></tr><tr class="question" title="4.7.2.2."><td align="left" valign="top"><a name="id286981217"></a><a name="id286981219"></a><p><b>4.7.2.2.</b></p></td><td align="left" valign="top"><p>プリンスジョージ市の大きさはha表記でいくらになるでしょう?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>このクエリでは、属性条件(municipality name, 自治体名)に空間計算(面積)を併用しています。</p><pre class="programlisting">SELECT
  ST_Area(the_geom)/10000 AS hectares
FROM bc_municipality
WHERE name = 'PRINCE GEORGE';

hectares
------------------
32657.9103824927
(1 row)</pre></td></tr><tr class="question" title="4.7.2.3."><td align="left" valign="top"><a name="id286981238"></a><a name="id286981240"></a><p><b>4.7.2.3.</b></p></td><td align="left" valign="top"><p>県内で最も大きな面積を持つ自治体はどこでしょう?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>このクエリは、空間計測をクエリ条件に持ってきています。この問題へのアプローチの方法はいくつかありますが、最も効率的なのは次の通りです。</p><pre class="programlisting">SELECT
  name,
  ST_Area(the_geom)/10000 AS hectares
FROM
  bc_municipality
ORDER BY hectares DESC
LIMIT 1;

name           | hectares
---------------+-----------------
TUMBLER RIDGE  | 155020.02556131
(1 row)</pre><p>このクエリの答えを出すためには、全てのポリゴンの面積を求める必要があることに注意して下さい。このクエリを多く実行する場合、性能向上のためにテーブルに"area"カラムを追加して、別のインデクスを追加することができるようにするのは、意義のあることです。結果を距離について降順に並べ替え、PostgreSQLの"LIMIT"コマンドを用いることで、max()のような集計関数を使わずに、簡単に最も大きい値を集計関数を得ることができます。</p></td></tr><tr class="question" title="4.7.2.4."><td align="left" valign="top"><a name="id286981262"></a><a name="id286981265"></a><p><b>4.7.2.4.</b></p></td><td align="left" valign="top"><p>各自治体内に含まれる道路の総延長はいくらでしょう?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>これは、二つのテーブルからデータを持ち込んで(ジョインして)いるので「空間ジョイン」の例です。しかし、ジョインの条件として共通キーの上で接続するという普通のリレーションのやり方でなく空間インタラクション条件("contained")を使っています。</p><pre class="programlisting">SELECT
  m.name,
  sum(ST_Length(r.the_geom))/1000 as roads_km
FROM
  bc_roads AS r,
  bc_municipality AS m
WHERE
  ST_Contains(m.the_geom,r.the_geom)
GROUP BY m.name
ORDER BY roads_km;

name                        | roads_km
----------------------------+------------------
SURREY                      | 1539.47553551242
VANCOUVER                   | 1450.33093486576
LANGLEY DISTRICT            | 833.793392535662
BURNABY                     | 773.769091404338
PRINCE GEORGE               | 694.37554369147
...</pre><p>このクエリは、テーブル内の全ての道路の合計を最終結果(この例での話ですが約250Kmの道です)にまとめられるので、少し時間がかかります。より小さいオーバレイ(数百の道路で数千のレコード)の場合、応答はもっと早くなりえます。</p></td></tr><tr class="question" title="4.7.2.5."><td align="left" valign="top"><a name="id286981286"></a><a name="id286981288"></a><p><b>4.7.2.5.</b></p></td><td align="left" valign="top"><p>プリンスジョージ市内の全ての道路からなるテーブルを作る</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>これは「オーバレイ」の例です。つまり、2つのテーブルを取得して、空間的に切り取られた結果からなる新しいテーブルを出力します。上で示した「空間ジョイン」と違い、このクエリは実際に新しいジオメトリを生成します。生成されたオーバレイはターボのかかった空間ジョインみたいなもので、より確かな解析作業に便利です。</p><pre class="programlisting">CREATE TABLE pg_roads as
SELECT
  ST_Intersection(r.the_geom, m.the_geom) AS intersection_geom,
  ST_Length(r.the_geom) AS rd_orig_length,
  r.*
FROM
  bc_roads AS r,
  bc_municipality AS m
WHERE  m.name = 'PRINCE GEORGE' AND ST_Intersects(r.the_geom, m.the_geom);</pre></td></tr><tr class="question" title="4.7.2.6."><td align="left" valign="top"><a name="id286981306"></a><a name="id286981308"></a><p><b>4.7.2.6.</b></p></td><td align="left" valign="top"><p>ビクトリア州の「ダグラス通り」の長さはkm表記でいくらになるでしょう?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><pre class="programlisting">SELECT
  sum(ST_Length(r.the_geom))/1000 AS kilometers
FROM
  bc_roads r,
  bc_municipality m
WHERE  r.name = 'Douglas St' AND m.name = 'VICTORIA'
	AND ST_Contains(m.the_geom, r.the_geom) ;

kilometers
------------------
4.89151904172838
(1 row)</pre></td></tr><tr class="question" title="4.7.2.7."><td align="left" valign="top"><a name="id286981323"></a><a name="id286981326"></a><p><b>4.7.2.7.</b></p></td><td align="left" valign="top"><p>穴を持つ自治体ポリゴンのうち最も大きいのはどれでしょう?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><pre class="programlisting">SELECT gid, name, ST_Area(the_geom) AS area
FROM bc_municipality
WHERE ST_NRings(the_geom) &gt; 1
ORDER BY area DESC LIMIT 1;

gid  | name         | area
-----+--------------+------------------
12   | SPALLUMCHEEN | 257374619.430216
(1 row)</pre></td></tr></tbody></table></div></div></div></div><div class="chapter" title="第5章 ラスタデータの管理、クエリ、アプリケーション"><div class="titlepage"><div><div><h2 class="title"><a name="using_raster.xml"></a>第5章 ラスタデータの管理、クエリ、アプリケーション</h2></div></div></div><div class="toc"><p><b>目次</b></p><dl><dt><span class="sect1"><a href="#RT_Loading_Rasters">5.1. ラスタのロードと生成</a></span></dt><dd><dl><dt><span class="sect2"><a href="#RT_Raster_Loader">5.1.1. raster2pgsqlを使ってラスタをロードする</a></span></dt><dt><span class="sect2"><a href="#RT_Creating_Rasters">5.1.2. PostGISラスタ関数を用いたラスタの生成</a></span></dt></dl></dd><dt><span class="sect1"><a href="#RT_Raster_Catalog">5.2. ラスタカタログ</a></span></dt><dd><dl><dt><span class="sect2"><a href="#RT_Raster_Columns">5.2.1. ラスタカラムカタログ</a></span></dt><dt><span class="sect2"><a href="#RT_Raster_Overviews">5.2.2. ラスタオーバビュー</a></span></dt></dl></dd><dt><span class="sect1"><a href="#RT_Raster_Applications">5.3. PostGISラスタを使ったカスタムアプリケーションの構築</a></span></dt><dd><dl><dt><span class="sect2"><a href="#RT_PHP_Output">5.3.1. ST_AsPNG を他の関数とあわせて使った PHP 出力例</a></span></dt><dt><span class="sect2"><a href="#RT_Net_Output_CS">5.3.2. ST_AsPNGを他の関数とあわせて使ったASP.NET C#出力例</a></span></dt><dt><span class="sect2"><a href="#RT_Java_Console_App">5.3.3. ラスタクエリを画像ファイルとして出力するJavaコンソールアプリケーション</a></span></dt><dt><span class="sect2"><a href="#RT_PLPython">5.3.4. PLPython を使って SQL を介して画像をダンプする</a></span></dt><dt><span class="sect2"><a href="#RasterOutput_PSQL">5.3.5. PSQLでラスタを出力する</a></span></dt></dl></dd></dl></div><div class="sect1" title="5.1. ラスタのロードと生成"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="RT_Loading_Rasters"></a>5.1. ラスタのロードと生成</h2></div></div></div><div class="toc"><dl><dt><span class="sect2"><a href="#RT_Raster_Loader">5.1.1. raster2pgsqlを使ってラスタをロードする</a></span></dt><dt><span class="sect2"><a href="#RT_Creating_Rasters">5.1.2. PostGISラスタ関数を用いたラスタの生成</a></span></dt></dl></div><p><code class="varname">raster2pgsql</code>ラスタローダを使ってPostGISラスタを既存のラスタファイルからロードするのは、最もよく行われます。</p><div class="sect2" title="5.1.1. raster2pgsqlを使ってラスタをロードする"><div class="titlepage"><div><div><h3 class="title"><a name="RT_Raster_Loader"></a>5.1.1. raster2pgsqlを使ってラスタをロードする</h3></div></div></div><p><code class="varname">raster2pgsql</code>は、GDALがサポートするラスタ書式をPostGISラスタテーブルにロードするのに適切なSQLにするバイナリファイルです。ラスタのオーバビューの生成だけでなく、ラスタファイルのフォルダのロードも可能です。</p><p>raster2pgsqlは、ほとんどの場合、PostGISの一部としてコンパイルされます(GDALライブラリをコンパイルしていない場合)が、バイナリファイルによってサポートされるラスタタイプは、GDALでコンパイルされたのと同じです。raster2pgsqlがサポートするラスタタイプの一覧を得るには、<code class="varname">-G</code>スイッチを使います。この一覧は、インストールした PostGIS が提供する <a class="xref" href="#RT_ST_GDALDrivers" title="ST_GDALDrivers">ST_GDALDrivers</a> と同じになるはずです。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>このツールの古い版では、Pythonスクリプトでした。実行ファイルに置き換えられています。Pytonスクリプトが必要な場合は、<a class="ulink" href="http://trac.osgeo.org/gdal/wiki/frmts_wtkraster.html" target="_top">GDAL PostGIS Raster Driver Usage</a>に、Pythonの例があります。raster2pgsql の Python スクリプトは、今後の PostGIS raster では動作しないかも知れませんし、サポートされませんんおで、ご注意ください。</p></td></tr></table></div><p>使用例: 
    	</p><pre class="programlisting">raster2pgsql <code class="varname">raster_options_go_here</code> <code class="varname">raster_file</code> <code class="varname">someschema</code>.<code class="varname">sometable</code> &gt; out.sql</pre><p>
    </p><div class="variablelist"><dl><dt><span class="term">-?</span></dt><dd><p>
              ヘルプを表示します。引数を全く指定しない場合にも表示されます。
            </p></dd><dt><span class="term">-G</span></dt><dd><p>
             サポートされているラスタ書式を印字します。
            </p></dd><dt><span class="term">(c|a|d) 相互に排他的なオプションです。</span></dt><dd><p>
              </p><div class="variablelist"><dl><dt><span class="term">-c</span></dt><dd><p>
                      新しいテーブルを生成し、ラスタを入れます。<span class="emphasis"><em>これがデフォルトモードです。</em></span>
                    </p></dd><dt><span class="term">-a</span></dt><dd><p>
                      既存のテーブルにラスタを追加します。
                    </p></dd><dt><span class="term">-d</span></dt><dd><p>
                      テーブルを削除し、新しいテーブルを生成し、ラスタを入れます。
                    </p></dd></dl></div><p>
            </p></dd><dt><span class="term">ラスタ処理: ラスタカタログでの適切に登録するための制約の適用</span></dt><dd><p>
					</p><div class="variablelist"><dl><dt><span class="term">-C </span></dt><dd><p>
									SRIDやピクセルサイズ等のラスタ制約を適用して、<code class="varname">raster_columns</code>ビューで適切な登録ができるようにします。
								</p></dd><dt><span class="term">-x </span></dt><dd><p>
									制約の最大範囲を無効にします。-Cフラグが使われている場合のみ適用されます。
								</p></dd><dt><span class="term">-r </span></dt><dd><p>
									正規ブロック制約です。-Cフラグが使用されている場合のみ適用されます。
								</p></dd></dl></div><p>	    	
				</p></dd><dt><span class="term">ラスタ処理: 入力ラスタデータセットの操作に使われる追加的なパラメータ</span></dt><dd><p>
            </p><div class="variablelist"><dl><dt><span class="term">-s &lt;SRID&gt;</span></dt><dd><p>
                            出力ラスタを指定されたSRIDにします。
                        </p></dd><dt><span class="term">-b BAND</span></dt><dd><p>
                           ラスタから抽出するバンドのインデクス(1はじまり)。1より多いバンドを抽出するには、コンマ(,)で区切ります。指定しない場合、全てのバンドが抽出されます。
                        </p></dd><dt><span class="term">-t TILE_SIZE</span></dt><dd><p>
                        行毎に挿入するラスタを切断します。<code class="varname">TILE_SIZE</code>は、「幅x高さ」で表現します。
			</p></dd><dt><span class="term">-R, --register</span></dt><dd><p>ファイルシステム(データベース外)ラスタとして、ラスタを登録します。</p><p>データベースには、ラスタのメタデータとラスタのファイルパスのみ格納されます(ピクセルは格納されません)。</p></dd><dt><span class="term">-l <code class="varname">OVERVIEW_FACTOR</code></span></dt><dd><p>-l <code class="varname">overview factor</code>で、ラスタのオーバビューを生成します。1より多い係数を用いる場合は、コンマ (,) で区切ります。オーバビューのテーブル名は o_<code class="varname">overview factor</code>_<code class="varname">table</code>となります。生成されるオーバビューはデータベースに格納され、-Rは無視されます。生成されたSQLファイルは元データのテーブルとオーバビューテーブルの両方を含むことに注意して下さい。</p></dd></dl></div><p>
            </p></dd><dt><span class="term">テータベースオブジェクトの操作に使われる追加的なパラメータ</span></dt><dd><p>
              </p><div class="variablelist"><dl><dt><span class="term">-q </span></dt><dd><p>PostgreSQL 識別子に引用符を付けます。
                    </p></dd><dt><span class="term">-f COLUMN</span></dt><dd><p>出力先ラスタカラムの名前を指定します。デフォルトは'rast'です。
                    </p></dd><dt><span class="term">-F</span></dt><dd><p>ファイル名でカラムを追加します。</p></dd><dt><span class="term">-I</span></dt><dd><p>
                      ラスタカラムにGiSTインデクスを生成します。
                    </p></dd><dt><span class="term">-M</span></dt><dd><p>
                      ラスタテーブルにVacuum analyzeを行います。
                    </p></dd><dt><span class="term">-T <code class="varname">tablespace</code></span></dt><dd><p>
                      生成されるテーブルのテーブルスペースを指定します。-Xフラグを併用しない場合には、インデクス(主キーを含む)はデフォルトのテーブルスペースを使用することにご注意ください。
                    </p></dd><dt><span class="term">-Y</span></dt><dd><p>
                      INSERT ステートメントでなく COPY ステートメントを使います。</p></dd></dl></div><p>
            </p></dd><dt><span class="term">-e</span></dt><dd><p>ステートメント毎に実行して、トランザクションを使用しないようにします。</p></dd><dt><span class="term">-E ENDIAN</span></dt><dd><p>生成されるラスタのバイナリ出力のエンディアンを制御します。XDRの場合は0を、NDRの場合は1を、それぞれ指定します。デフォルトは1です。現時点ではNDR出力のみサポートします。</p></dd><dt><span class="term">-V <code class="varname">version</code></span></dt><dd><p>出力書式の版を指定します。デフォルトは0です。現時点では0のみサポートします。</p></dd></dl></div><p>ローダを用いて入力ファイルを100x100のタイルで生成して、データベースにアップロードする例は、次の通りです。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">public.demelevation</code>でなく<code class="varname">demelevation</code>というようにスキーマ名を外すことができます。ラスタテーブルはデータベースまたユーザの指定するデフォルトのスキーマに生成されます。</p></td></tr></table></div><pre class="programlisting">raster2pgsql -s 4236 -I -C -M *.tif -F -t 100x100 public.demelevation &gt; elev.sql
psql -d gisdb -f elev.sql</pre><p>変換とアップロードは UNIX のパイプを使って一度に実行できます。</p><pre class="programlisting">raster2pgsql -s 4236 -I -C -M *.tif -F -t 100x100 public.demelevation | psql -d gisdb</pre><p>マサチューセッツ州平面のメートル単位の空中写真タイルを<code class="varname">aerial</code>という名前のスキーマにロードします。
元の画像と2, 4レベルのオーバビューのテーブルとを生成します。
データ格納にCOPYを使用し(データベースに仲介ファイルなくまっすぐ入ります)。
-eでトランザクションを指定しません(待たずにテーブルのデータを見たい場合には良いです)。ラスタを128x128ピクセルのタイルに分解してラスタ制約を適用します。INSERTモードでなくCOPYモードを使用します。-Fで、カラム名をタイル切り出し元ファイルのファイル名にします。</p><pre class="programlisting">raster2pgsql -I -C -e -Y -F -s 26986 -t 128x128  -l 2,4 bostonaerials2008/*.jpg aerials.boston | psql -U postgres -d gisdb -h localhost -p 5432</pre><pre class="programlisting">-- サポートされているラスタタイプの一覧:
raster2pgsql -G</pre><p>-Gコマンドの出力は次のようになります。</p><pre class="screen">
Available GDAL raster formats:
  Virtual Raster
  GeoTIFF
  National Imagery Transmission Format
  Raster Product Format TOC format
  ECRG TOC format
  Erdas Imagine Images (.img)
  CEOS SAR Image
  CEOS Image
  JAXA PALSAR Product Reader (Level 1.1/1.5)
  Ground-based SAR Applications Testbed File Format (.gff)
  ELAS
  Arc/Info Binary Grid
  Arc/Info ASCII Grid
  GRASS ASCII Grid
  SDTS Raster
  DTED Elevation Raster
  Portable Network Graphics
  JPEG JFIF
  In Memory Raster
  Japanese DEM (.mem)
  Graphics Interchange Format (.gif)
  Graphics Interchange Format (.gif)
  Envisat Image Format
  Maptech BSB Nautical Charts
  X11 PixMap Format
  MS Windows Device Independent Bitmap
  SPOT DIMAP
  AirSAR Polarimetric Image
  RadarSat 2 XML Product
  PCIDSK Database File
  PCRaster Raster File
  ILWIS Raster Map
  SGI Image File Format 1.0
  SRTMHGT File Format
  Leveller heightfield
  Terragen heightfield
  USGS Astrogeology ISIS cube (Version 3)
  USGS Astrogeology ISIS cube (Version 2)
  NASA Planetary Data System
  EarthWatch .TIL
  ERMapper .ers Labelled
  NOAA Polar Orbiter Level 1b Data Set
  FIT Image
  GRIdded Binary (.grb)
  Raster Matrix Format
  EUMETSAT Archive native (.nat)
  Idrisi Raster A.1
  Intergraph Raster
  Golden Software ASCII Grid (.grd)
  Golden Software Binary Grid (.grd)
  Golden Software 7 Binary Grid (.grd)
  COSAR Annotated Binary Matrix (TerraSAR-X)
  TerraSAR-X Product
  DRDC COASP SAR Processor Raster
  R Object Data Store
  Portable Pixmap Format (netpbm)
  USGS DOQ (Old Style)
  USGS DOQ (New Style)
  ENVI .hdr Labelled
  ESRI .hdr Labelled
  Generic Binary (.hdr Labelled)
  PCI .aux Labelled
  Vexcel MFF Raster
  Vexcel MFF2 (HKV) Raster
  Fuji BAS Scanner Image
  GSC Geogrid
  EOSAT FAST Format
  VTP .bt (Binary Terrain) 1.3 Format
  Erdas .LAN/.GIS
  Convair PolGASP
  Image Data and Analysis
  NLAPS Data Format
  Erdas Imagine Raw
  DIPEx
  FARSITE v.4 Landscape File (.lcp)
  NOAA Vertical Datum .GTX
  NADCON .los/.las Datum Grid Shift
  NTv2 Datum Grid Shift
  ACE2
  Snow Data Assimilation System
  Swedish Grid RIK (.rik)
  USGS Optional ASCII DEM (and CDED)
  GeoSoft Grid Exchange Format
  Northwood Numeric Grid Format .grd/.tab
  Northwood Classified Grid Format .grc/.tab
  ARC Digitized Raster Graphics
  Standard Raster Product (ASRP/USRP)
  Magellan topo (.blx)
  SAGA GIS Binary Grid (.sdat)
  Kml Super Overlay
  ASCII Gridded XYZ
  HF2/HFZ heightfield raster
  OziExplorer Image File
  USGS LULC Composite Theme Grid
  Arc/Info Export E00 GRID
  ZMap Plus Grid
  NOAA NGS Geoid Height Grids</pre></div><div class="sect2" title="5.1.2. PostGISラスタ関数を用いたラスタの生成"><div class="titlepage"><div><div><h3 class="title"><a name="RT_Creating_Rasters"></a>5.1.2. PostGISラスタ関数を用いたラスタの生成</h3></div></div></div><p>データベース内でラスタやラスタテーブルを生成したい場合が多くあります。これを行うための関数が多数あります。一般的な手順は次の通りです。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>新しいラスタ行を保持するためのラスタカラムを持つテーブルを生成します。次を実行します。</p><pre class="programlisting">CREATE TABLE myrasters(rid serial primary key, rast raster);</pre></li><li class="listitem"><p>この目標で助けとなる関数は多数あります。他のラスタの派生でないラスタを生成する場合、<a class="xref" href="#RT_ST_MakeEmptyRaster" title="ST_MakeEmptyRaster">ST_MakeEmptyRaster</a>と<a class="xref" href="#RT_ST_AddBand" title="ST_AddBand">ST_AddBand</a>を順次実行して作業を開始します。</p><p>ジオメトリからラスタを生成することもできます。<a class="xref" href="#RT_ST_AsRaster" title="ST_AsRaster">ST_AsRaster</a>を使います。<a class="xref" href="#RT_ST_Union" title="ST_Union">ST_Union</a> や <a class="xref" href="#RT_ST_MapAlgebraFct2" title="ST_MapAlgebraFct">ST_MapAlgebraFct</a>や、地図解析関数群等といった、他の関数を組み合わせる場合もあります。</p><p>既存テーブルから新しいラスタテーブルを生成するための多数の選択肢があります。たとえば、<a class="xref" href="#RT_ST_Transform" title="ST_Transform">ST_Transform</a>を使って、既存テーブルから異なる投影法のラスタテーブルを生成します。</p></li><li class="listitem"><p>はじめにテーブルにデータを入れたら、ラスタカラムに空間インデクスを生成したくなるでしょう。次のようにします。</p><pre class="programlisting">CREATE INDEX myrasters_rast_st_convexhull_idx ON myrasters USING gist( ST_ConvexHull(rast) );</pre><p>xref linkend="RT_ST_ConvexHull" /&gt;を使用していることに注意して下さい。多くのラスタ演算子はラスタの凸包を元にしています。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>2.0より前の PostGIS ラスタは、エンベロープを基本にして、凸包ではありませんでした。空間インデクスを適切に働かせるには、エンベロープを基本にしたインデクスを削除して、凸包を元にしたインデクスに置き換えます。</p></td></tr></table></div></li><li class="listitem"><p><a class="xref" href="#RT_AddRasterConstraints" title="AddRasterConstraints">AddRasterConstraints</a>を用いてラスタ制約を適用します。</p></li></ol></div></div></div><div class="sect1" title="5.2. ラスタカタログ"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="RT_Raster_Catalog"></a>5.2. ラスタカタログ</h2></div></div></div><div class="toc"><dl><dt><span class="sect2"><a href="#RT_Raster_Columns">5.2.1. ラスタカラムカタログ</a></span></dt><dt><span class="sect2"><a href="#RT_Raster_Overviews">5.2.2. ラスタオーバビュー</a></span></dt></dl></div><p>PostGISが生成する、2つのラスタカタログのビューがあります。両方ともラスタテーブルの制約の中に埋め込まれる情報を用いています。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><code class="varname">raster_columns</code> データベース内のラスタテーブルのカラム全てのカタログです。</p></li><li class="listitem"><p><code class="varname">raster_overviews</code> データベース内の、より詳細なテーブルのためのオーバビューを提供するラスタテーブルのカラム全てのカタログです。この種のテーブルは、ロード時に<code class="varname">-l</code>を指定した時に生成されます。</p></li></ol></div><div class="sect2" title="5.2.1. ラスタカラムカタログ"><div class="titlepage"><div><div><h3 class="title"><a name="RT_Raster_Columns"></a>5.2.1. ラスタカラムカタログ</h3></div></div></div><p><code class="varname">raster_columns</code>は、ラスタタイプのデータベースにおける全てのラスタテーブルカラムのカタログです。テーブルの制約を使ったビューなので、他のデータベースのバックアップからラスタテーブルをリストアしたとしても、情報は常に矛盾がありません。<code class="varname">raster_columns</code>カタログには次のカラムがあります。</p><p>ローダを使わずにテーブルを生成したり、ロード時に<code class="varname">-C</code>フラグを忘れたりした場合には、事後に<a class="xref" href="#RT_AddRasterConstraints" title="AddRasterConstraints">AddRasterConstraints</a>で制約を強制でき、<code class="varname">raster_columns</code>カタログは、ラスタタイルの共通の情報を登録します。</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><code class="varname">r_table_catalog</code> テーブルが存在するデータベースです。これは常に現在のデータベースを読みます。</p></li><li class="listitem"><p><code class="varname">r_table_schema</code> ラスタテーブルが属するデータベーススキーマです。</p></li><li class="listitem"><p><code class="varname">r_table_name</code> raster table</p></li><li class="listitem"><p><code class="varname">r_raster_column</code> ラスタタイプである<code class="varname">r_table_name</code>テーブル内のカラムです。PostGISには、1つのテーブルに複数のラスタカラムを持つことを妨げません。異なるラスタカラムを持つラスタテーブルが、ラスタカラム毎に複数回出現するテーブルを持つことができます。</p></li><li class="listitem"><p><code class="varname">srid</code> ラスタの空間参照系識別番号です。<a class="xref" href="#spatial_ref_sys" title="4.3.1. SPATIAL_REF_SYSテーブルと空間参照系">「SPATIAL_REF_SYSテーブルと空間参照系」</a> にあるエントリであるべきです。</p></li><li class="listitem"><p><code class="varname">scale_x</code> 地理空間座標とピクセルの間の拡大縮小係数です。これは、ラスタカラムのすべてのタイルが同じ<code class="varname">scale_x</code>を持ち、制約が適用されている場合のみ出現します。詳細情報については<a class="xref" href="#RT_ST_ScaleX" title="ST_ScaleX">ST_ScaleX</a>を参照してください。</p></li><li class="listitem"><p><code class="varname">scale_y</code> 地理空間座標とピクセルの間の拡大縮小係数です。これは、ラスタカラムのすべてのタイルが同じ<code class="varname">scale_y</code>を持ち、制約が適用されている場合のみ出現します。詳細情報については<a class="xref" href="#RT_ST_ScaleY" title="ST_ScaleY">ST_ScaleY</a>を参照してください。</p></li><li class="listitem"><p><code class="varname">blocksize_x</code> ラスタタイルごとの幅(横方向のピクセル数)です。詳細情報については<a class="xref" href="#RT_ST_Width" title="ST_Width">ST_Width</a>を参照してください。</p></li><li class="listitem"><p><code class="varname">blocksize_y</code> ラスタタイルごとの高さ(縦方向のピクセル数)です。詳細情報については<a class="xref" href="#RT_ST_Height" title="ST_Height">ST_Height</a>を参照してください。</p></li><li class="listitem"><p><code class="varname">same_alignment</code> 全てのラスタタイルが同じアラインメントを持っているかを示す真偽値です。詳細情報については<a class="xref" href="#RT_ST_SameAlignment" title="ST_SameAlignment">ST_SameAlignment</a>を参照してください。</p></li><li class="listitem"><p><code class="varname">regular_blocking</code> テーブルに設定された真偽値の制約フラグで、タイルがオーバラップせず、かつアラインメント、ピクセルサイズ、SRID等が同じであるかどうかを示します。実際の評価は行いませんが、与えられた情報を利用するので、参考情報として使うべきものです。将来的には、確実にこの制約がかかるようにして、<code class="varname">true</code>が返る時にはこの情報が正しいことを保証できるようにする予定です。</p></li><li class="listitem"><p><code class="varname">num_bands</code> 格納されているラスタセットのタイル毎のバンド数です。<a class="xref" href="#RT_ST_NumBands" title="ST_NumBands">ST_NumBands</a>で得られる情報と同じです。</p></li><li class="listitem"><p><code class="varname">pixel_types</code> バンドごとのピクセルタイプを定義する配列です。この配列の要素数はバンド数と同じです。pixel_typesは、<a class="xref" href="#RT_ST_BandPixelType" title="ST_BandPixelType">ST_BandPixelType</a>で定義されるピクセルタイプのひとつを取ります。</p></li><li class="listitem"><p><code class="varname">nodata_values</code> バンド毎の<code class="varname">nodata_value</code>を示す倍精度浮動小数点数です。この配列の要素数はバンド数と同じです。これらの数は、バンド毎にほとんどの操作で無視すべきピクセル値を定義します。<a class="xref" href="#RT_ST_BandNoDataValue" title="ST_BandNoDataValue">ST_BandNoDataValue</a> で提供される情報と似ています。</p></li><li class="listitem"><p><code class="varname">extent</code> ラスタ集合における全てのラスタ行の範囲です。集合の範囲を変更するデータを別途ロードする予定である場合、ロード前に<a class="xref" href="#RT_DropRasterConstraints" title="DropRasterConstraints">DropRasterConstraints</a>関数を実行して、ロード後に<a class="xref" href="#RT_AddRasterConstraints" title="AddRasterConstraints">AddRasterConstraints</a>で制約を再適用します。</p></li></ul></div></div><div class="sect2" title="5.2.2. ラスタオーバビュー"><div class="titlepage"><div><div><h3 class="title"><a name="RT_Raster_Overviews"></a>5.2.2. ラスタオーバビュー</h3></div></div></div><p><code class="varname">raster_overviews</code> は、オーバビューで使われるラスタテーブルカラムに関する情報のカタログで、オーバビューを用いる際に知っておくと便利な情報も持ちます。オーバビューテーブルは<code class="varname">raster_columns</code>と<code class="varname">raster_overviews</code>の両方のカタログに入れられます。オーバビューもラスタのひとつであるのは確かですが、より高い解像度テーブルの解像度を落としたカリカチュアになるという特殊な目的を満たすためでもあるからです。ラスタをロードする際に<code class="varname">-l</code>スイッチを使うと、オーバビューが主ラスタテーブルと一緒に生成されます。</p><p>オーバビューテーブルには、他のラスタテーブルと同じ制約と、オーバビュー特有の制約となる追加情報があります。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">raster_overviews</code>の情報は<code class="varname">raster_columns</code>とは重複しません。<code class="varname">raster_columns</code>にあるオーバビューテーブルに関する情報が必要な場合は、<code class="varname">raster_overviews</code>と<code class="varname">raster_columns</code>を結合すると、必要な情報の集合を完全に取得することができます。</p></td></tr></table></div><p>オーバビューの主たる理由は次の2つです。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>ズームアウトした際の地図表示を早くするために、主テーブルの低解像度表現が一般的に使われます。</p></li><li class="listitem"><p>レコード数が少なく、ピクセル毎の適用範囲が広いため、高解像度の元テーブルより計算が一般的に早くなります。計算は高解像度テーブルより精度は落ちますが、大まかな計算には十分でありえます。</p></li></ol></div><p><code class="varname">raster_overviews</code>カタログには、次の情報のカラムがあります。</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><code class="varname">o_table_catalog</code> オーバビューテーブルが存在するデータベースです。常に現在のデータベースを読みます。</p></li><li class="listitem"><p><code class="varname">o_table_schema</code> オーバビューラスタテーブルが属するデータベーススキーマです。</p></li><li class="listitem"><p><code class="varname">o_table_name</code> ラスタオーバビューテーブル名です。</p></li><li class="listitem"><p><code class="varname">o_raster_column</code> オーバビューテーブル内のラスタカラムです。</p></li><li class="listitem"><p><code class="varname">r_table_catalog</code> このオーバビューの元となるラスタテーブルのデータベースです。常に現在のデータベースを読みます。</p></li><li class="listitem"><p><code class="varname">r_table_schema</code> このオーバビューの元となるラスタテーブルが属するデータベーススキーマです。</p></li><li class="listitem"><p><code class="varname">r_table_name</code> このオーバビューの元となるラスタテーブルです。</p></li><li class="listitem"><p><code class="varname">r_raster_column</code> このオーバビューの元となるラスタカラムです。</p></li><li class="listitem"><p><code class="varname">overview_factor</code> - オーバビューテーブルのピラミッドレベルです。高い数字ほど解像度が低くなります。raster2pgsqlは、画像のフォルダを渡された場合は、分割して、イメージファイルのオーバビューの計算とロードを行います。レベル1は元ファイルと同じです。レベル2は、元ファイルの4分の1になります。たとえば、5000x5000ピクセルの画像ファイルのフォルダがあるとして、125x125に分ける場合、画像ファイルごとに(5000*5000)/(125*125) = 1600行のレコードを持ち、<code class="varname">o_2</code>テーブル(レベル2)はceiling(1600/Power(2,2)) = 400行、<code class="varname">o_3</code>(レベル3)ではceiling(1600/Power(2,3) ) = 200行のレコードを持ちます。
						ピクセルがタイルサイズで割り切れない場合、スクラップタイル(完全には値が入っていない)が得られます。raster2pgsqlによって生成される個々のオーバビュータイルは、元となるラスタと同じピクセル数を持ち、個々のピクセルの表現範囲(オリジナルの Power(2,overview_factor)ピクセル分)が低い解像度になっている点に注意して下さい。</p></li></ul></div></div></div><div class="sect1" title="5.3. PostGISラスタを使ったカスタムアプリケーションの構築"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="RT_Raster_Applications"></a>5.3. PostGISラスタを使ったカスタムアプリケーションの構築</h2></div></div></div><div class="toc"><dl><dt><span class="sect2"><a href="#RT_PHP_Output">5.3.1. ST_AsPNG を他の関数とあわせて使った PHP 出力例</a></span></dt><dt><span class="sect2"><a href="#RT_Net_Output_CS">5.3.2. ST_AsPNGを他の関数とあわせて使ったASP.NET C#出力例</a></span></dt><dt><span class="sect2"><a href="#RT_Java_Console_App">5.3.3. ラスタクエリを画像ファイルとして出力するJavaコンソールアプリケーション</a></span></dt><dt><span class="sect2"><a href="#RT_PLPython">5.3.4. PLPython を使って SQL を介して画像をダンプする</a></span></dt><dt><span class="sect2"><a href="#RasterOutput_PSQL">5.3.5. PSQLでラスタを出力する</a></span></dt></dl></div><p>PostGISラスタには、対応イメージ書式のラスタをレンダリングするSQL関数があり、レンダリングを行うための多数の選択肢があります。たとえば、<a class="ulink" href="http://www.postgresonline.com/journal/archives/244-Rendering-PostGIS-Raster-graphics-with-LibreOffice-Base-Reports.html" target="_top">Rendering PostGIS Raster graphics with LibreOffice Base Reports</a>で例を挙げている通り、OpenOffice/LibreOfficeを使うことができます。さらに、ここで示すように、幅広い言語で使うことができます。</p><div class="sect2" title="5.3.1. ST_AsPNG を他の関数とあわせて使った PHP 出力例"><div class="titlepage"><div><div><h3 class="title"><a name="RT_PHP_Output"></a>5.3.1. ST_AsPNG を他の関数とあわせて使った PHP 出力例</h3></div></div></div><p>本節では、PHP の PostgreSQL ドライバと <a class="xref" href="#RT_ST_AsGDALRaster" title="ST_AsGDALRaster">ST_AsGDALRaster</a> 等の関数を使って、HTML img タグに埋め込むことができる PHP リクエストストリームにラスタの 1, 2, 3 バンドを出力する方法を示します</p><p>サンプルクエリでは、
指定したWGS84バウンディングボックスにインタセクトするタイルを取って、
<a class="xref" href="#RT_ST_Union" title="ST_Union">ST_Union</a>でインタセクトしたタイルを結合して全てのバンドを返し、<a class="xref" href="#RT_ST_Transform" title="ST_Transform">ST_Transform</a>でユーザ指定投影法に変換し、<a class="xref" href="#RT_ST_AsPNG" title="ST_AsPNG">ST_AsPNG</a>を使ってPNGで結果を出力するためのラスタ関数群全体をまとめる方法を示します。</p><p>後に示すスクリプトは、</p><pre class="programlisting">http://mywebserver/test_raster.php?srid=2249</pre><p>で、マサチューセッツ州平面(フィート単位)のラスタ画像を取得します。</p><pre class="programlisting">
&lt;?php
/** test_raster.php コンテント **/
$conn_str ='dbname=mydb host=localhost port=5432 user=myuser password=mypwd';
$dbconn = pg_connect($conn_str);
header('Content-Type: image/png');  
/** 投影法が指定されたらそれを使います。
    指定されないなら、マサチューセッツ州平面(メートル) を使います。 **/
if (!empty( $_REQUEST['srid'] ) &amp;&amp; is_numeric( $_REQUEST['srid']) ){
		$input_srid = intval($_REQUEST['srid']);
}
else { $input_srid = 26986; }
/** PostgreSQL 9.0以上ではbytea_outputの設定が必要でしょう。
    8.4 では不要です。 **/
$sql = "set bytea_output='escape';
SELECT ST_AsPNG(ST_Transform(
			ST_AddBand(ST_Union(rast,1), ARRAY[ST_Union(rast,2),ST_Union(rast,3)])
				,$input_srid) ) As new_rast
 FROM aerials.boston 
	WHERE 
	 ST_Intersects(rast, ST_Transform(ST_MakeEnvelope(-71.1217, 42.227, -71.1210, 42.218,4326),26986) )"; 
$result = pg_query($sql);
$row = pg_fetch_row($result);
pg_free_result($result);
if ($row === false) return;
echo pg_unescape_bytea($row[0]);
?&gt;</pre></div><div class="sect2" title="5.3.2. ST_AsPNGを他の関数とあわせて使ったASP.NET C#出力例"><div class="titlepage"><div><div><h3 class="title"><a name="RT_Net_Output_CS"></a>5.3.2. ST_AsPNGを他の関数とあわせて使ったASP.NET C#出力例</h3></div></div></div><p>本節では、Npgsql PostgreSQL .NETドライバと<a class="xref" href="#RT_ST_AsGDALRaster" title="ST_AsGDALRaster">ST_AsGDALRaster</a>等の関数を使って、HTML imgタグに埋め込むことができるように、ラスタの 1, 2, 3 バンドを出力する方法を示します。</p><p>この例ではNpgsql .NET PostgreSQLドライバが必要です。最新版は<a class="ulink" href="http://npgsql.projects.postgresql.org/" target="_top">http://npgsql.projects.postgresql.org/</a> あります。最新版をダウンロードして、ASP.NET の binフォルダに入れるだけでうまくいきます。</p><p>サンプルクエリでは、指定したWGS84バウンディングボックスにインタセクトするタイルを取り、<a class="xref" href="#RT_ST_Union" title="ST_Union">ST_Union</a>でインタセクトしたタイルを結合して全てのバンドを返し、<a class="xref" href="#RT_ST_Transform" title="ST_Transform">ST_Transform</a>でユーザ指定投影法に変換し、<a class="xref" href="#RT_ST_AsPNG" title="ST_AsPNG">ST_AsPNG</a>を使ってPNGで結果を出力するためのラスタ関数群全体をまとめる方法を示します。</p><p>この例はC#で実装している点を除いては<a class="xref" href="#RT_PHP_Output" title="5.3.1. ST_AsPNG を他の関数とあわせて使った PHP 出力例">「ST_AsPNG を他の関数とあわせて使った PHP 出力例」</a>と同じです。</p><p>後に示すスクリプトは、</p><pre class="programlisting">http://mywebserver/TestRaster.ashx?srid=2249</pre><p>で、マサチューセッツ州平面(フィート単位)のラスタ画像を取得します。</p><pre class="programlisting"> -- web.config 接続文字列部 --
&lt;connectionStrings&gt;
    &lt;add name="DSN" 
        connectionString="server=localhost;database=mydb;Port=5432;User Id=myuser;password=mypwd"/&gt;
&lt;/connectionStrings&gt;</pre><pre class="programlisting">// Code for TestRaster.ashx
&lt;%@ WebHandler Language="C#" Class="TestRaster" %&gt;
using System;
using System.Data;
using System.Web;
using Npgsql;

public class TestRaster : IHttpHandler
{
	public void ProcessRequest(HttpContext context)
	{
		
		context.Response.ContentType = "image/png";
		context.Response.BinaryWrite(GetResults(context));
		
	}

	public bool IsReusable {
		get { return false; }
	}

	public byte[] GetResults(HttpContext context)
	{
		byte[] result = null;
		NpgsqlCommand command;
		string sql = null;
		int input_srid = 26986;
        try {
		    using (NpgsqlConnection conn = new NpgsqlConnection(System.Configuration.ConfigurationManager.ConnectionStrings["DSN"].ConnectionString)) {
			    conn.Open();

                if (context.Request["srid"] != null)
                {
                    input_srid = Convert.ToInt32(context.Request["srid"]);  
                }
                sql = @"SELECT ST_AsPNG(
                            ST_Transform(
			                ST_AddBand(
                                ST_Union(rast,1), ARRAY[ST_Union(rast,2),ST_Union(rast,3)])
				                    ,:input_srid) ) As new_rast 
                        FROM aerials.boston 
	                        WHERE 
	                            ST_Intersects(rast, 
                                    ST_Transform(ST_MakeEnvelope(-71.1217, 42.227, -71.1210, 42.218,4326),26986) )";
			    command = new NpgsqlCommand(sql, conn);
                command.Parameters.Add(new NpgsqlParameter("input_srid", input_srid));
           
			
			    result = (byte[]) command.ExecuteScalar();
                conn.Close();
			}

		}
        catch (Exception ex)
        {
            result = null;
            context.Response.Write(ex.Message.Trim());
        }
		return result;
	}
}</pre></div><div class="sect2" title="5.3.3. ラスタクエリを画像ファイルとして出力するJavaコンソールアプリケーション"><div class="titlepage"><div><div><h3 class="title"><a name="RT_Java_Console_App"></a>5.3.3. ラスタクエリを画像ファイルとして出力するJavaコンソールアプリケーション</h3></div></div></div><p>ひとつのイメージを取って指定したファイルに出力する、Javaコンソールアプリケーションです。</p><p>最新のPostgreSQL JDBC ドライバは<a class="ulink" href="http://jdbc.postgresql.org/download.html" target="_top">http://jdbc.postgresql.org/download.html</a>から取得できます。</p><p>後に示すコードをコンパイルします。コマンドは次の通りです。</p><pre class="programlisting">set env CLASSPATH .:..\postgresql-9.0-801.jdbc4.jar
javac SaveQueryImage.java
jar cfm SaveQueryImage.jar Manifest.txt *.class</pre><p>次のようにコマンドラインから呼び出します。</p><pre class="programlisting">java -jar SaveQueryImage.jar "SELECT ST_AsPNG(ST_AsRaster(ST_Buffer(ST_Point(1,5),10, 'quad_segs=2'),150, 150, '8BUI',100));" "test.png" </pre><pre class="programlisting"> -- Manifest.txt --
Class-Path: postgresql-9.0-801.jdbc4.jar
Main-Class: SaveQueryImage</pre><pre class="programlisting">// Code for SaveQueryImage.java
import java.sql.Connection;
import java.sql.SQLException;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.io.*;

public class SaveQueryImage {
  public static void main(String[] argv) {
      System.out.println("Checking if Driver is registered with DriverManager.");
      
      try {
        //java.sql.DriverManager.registerDriver (new org.postgresql.Driver());
        Class.forName("org.postgresql.Driver");
      } 
      catch (ClassNotFoundException cnfe) {
        System.out.println("Couldn't find the driver!");
        cnfe.printStackTrace();
        System.exit(1);
      }
      
      Connection conn = null;
      
      try {
        conn = DriverManager.getConnection("jdbc:postgresql://localhost:5432/mydb","myuser", "mypwd");
        conn.setAutoCommit(false);

        PreparedStatement sGetImg = conn.prepareStatement(argv[0]);
		
        ResultSet rs = sGetImg.executeQuery();
		
		FileOutputStream fout;
		try
		{
			rs.next();
			/** ユーザが指定するファイルへの出力 **/
			fout = new FileOutputStream(new File(argv[1]) );
			fout.write(rs.getBytes(1));
			fout.close();
		}
		catch(Exception e)
		{
			System.out.println("Can't create file");
			e.printStackTrace();
		}
		
        rs.close();
		sGetImg.close();
        conn.close();
      } 
      catch (SQLException se) {
        System.out.println("Couldn't connect: print out a stack trace and exit.");
        se.printStackTrace();
        System.exit(1);
      }   
  }
}</pre></div><div class="sect2" title="5.3.4. PLPython を使って SQL を介して画像をダンプする"><div class="titlepage"><div><div><h3 class="title"><a name="RT_PLPython"></a>5.3.4. PLPython を使って SQL を介して画像をダンプする</h3></div></div></div><p>これは、サーバディレクトリ内でレコードごとにファイルを生成するPythonストアド関数です。</p><pre class="programlisting">// PLPython PostgreSQLストアドプロシージャです。
// PL/Pythonが必要です。
CREATE OR REPLACE FUNCTION write_file (param_bytes bytea, param_filepath text)
RETURNS text
AS $$
f = open(param_filepath, 'wb+')
f.write(param_bytes)
return param_filepath
$$ LANGUAGE plpythonu;</pre><pre class="programlisting">-- 5つの画像をPostgreSQLサーバに可変サイズで描きます。
-- PostgreSQLデーモンのアカウントにフォルダへの書き込み権限が必要ですので
-- ご注意ください。
-- 生成されたファイル名をエコーバックします。
 SELECT write_file(ST_AsPNG(
	ST_AsRaster(ST_Buffer(ST_Point(1,5),j*5, 'quad_segs=2'),150*j, 150*j, '8BUI',100)),
	 'C:/temp/slices'|| j || '.png')
	 FROM generate_series(1,5) As j;
	 
     write_file
---------------------
 C:/temp/slices1.png
 C:/temp/slices2.png
 C:/temp/slices3.png
 C:/temp/slices4.png
 C:/temp/slices5.png	 
</pre></div><div class="sect2" title="5.3.5. PSQLでラスタを出力する"><div class="titlepage"><div><div><h3 class="title"><a name="RasterOutput_PSQL"></a>5.3.5. PSQLでラスタを出力する</h3></div></div></div><p>悲しいことにPSQLには、組み込み機能を用いてバイナリを出力するのは簡単ではありません。これは、ちょっとしたハックです。<a class="ulink" href="http://people.planetpostgresql.org/andrew/index.php?/archives/196-Clever-trick-challenge.html" target="_top">Clever Trick Challenge -- Outputting bytea with psql</a>で提案されている概要に基づいています。レガシー気味になっているPostgreSQLラージオブジェクトのサポートに乗っているものです。最初の起動時に、PSQLはデータベースに接続します。
   			</p><p>この方法はPythonの場合と違い、ローカル機にファイルが生成されます</p><pre class="screen">SELECT oid, lowrite(lo_open(oid, 131072), png) As num_bytes
 FROM 
 ( VALUES (lo_create(0), 
   ST_AsPNG( (SELECT rast FROM aerials.boston WHERE rid=1) ) 
  ) ) As v(oid,png);
-- 次のような出力が得られます --
   oid   | num_bytes
---------+-----------
 2630819 |     74860
 
-- 続いて、oidに注意して'C:/temp/aerial_smap.png'を
-- ローカル機のファイルパスに置き換えたうえで
-- 次を実行します。
 \lo_export 2630819 'C:/temp/aerial_samp.png'
 
-- データベース上のラージオブジェクトストレージから
-- ファイルを削除します。
SELECT lo_unlink(2630819);
   			</pre></div></div></div><div class="chapter" title="第6章 PostGISを使う: アプリケーションを構築する"><div class="titlepage"><div><div><h2 class="title"><a name="id286985699"></a>第6章 PostGISを使う: アプリケーションを構築する</h2></div></div></div><div class="toc"><p><b>目次</b></p><dl><dt><span class="sect1"><a href="#Using_MapServer">6.1. MapServerを使う</a></span></dt><dd><dl><dt><span class="sect2"><a href="#id286985810">6.1.1. 基本的な使い方</a></span></dt><dt><span class="sect2"><a href="#id286986077">6.1.2. よくある質問</a></span></dt><dt><span class="sect2"><a href="#id286986521">6.1.3. 踏み込んだ使用法</a></span></dt><dt><span class="sect2"><a href="#id286986593">6.1.4. 例</a></span></dt></dl></dd><dt><span class="sect1"><a href="#id286986648">6.2. Javaクライアント(JDBC)</a></span></dt><dt><span class="sect1"><a href="#id286986673">6.3. Cクライアント(libpq)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#id286986681">6.3.1. テキストカーソル</a></span></dt><dt><span class="sect2"><a href="#id286986692">6.3.2. バイナリカーソル</a></span></dt></dl></dd></dl></div><div class="sect1" title="6.1. MapServerを使う"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Using_MapServer"></a>6.1. MapServerを使う</h2></div></div></div><div class="toc"><dl><dt><span class="sect2"><a href="#id286985810">6.1.1. 基本的な使い方</a></span></dt><dt><span class="sect2"><a href="#id286986077">6.1.2. よくある質問</a></span></dt><dt><span class="sect2"><a href="#id286986521">6.1.3. 踏み込んだ使用法</a></span></dt><dt><span class="sect2"><a href="#id286986593">6.1.4. 例</a></span></dt></dl></div><p>MapServerはOpenGIS Web Mapping Server仕様を満たすウェブマッピングサーバです。</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>MapServerのウェブサイトは<a class="ulink" href="http://mapserver.org" target="_top">http://mapserver.org</a>です。</p></li><li class="listitem"><p>The OpenGIS Web Map Specificationは<a class="ulink" href="http://www.opengeospatial.org/standards/wms" target="_top">http://www.opengeospatial.org/standards/wms</a>にあります。</p></li></ul></div><div class="sect2" title="6.1.1. 基本的な使い方"><div class="titlepage"><div><div><h3 class="title"><a name="id286985810"></a>6.1.1. 基本的な使い方</h3></div></div></div><p>MapServerでPostGISを使うには、MapServerのコンフィギュレーション方法についての知識が必要ですが、この文書の範囲外です。この節では、PostGIS特有の問題とコンフィギュレーション詳細について記載します。</p><p>PostGISをMapServerで使うには、次のものが必要です。 </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>PostGIS 0.6以上</p></li><li class="listitem"><p>MapServer 3.5以上</p></li></ul></div><p>MapServerは、他のPostgreSQLクライアントのように、<code class="filename">libpq</code>インタフェースを使って、PostGIS/PostgreSQLデータにアクセスします。よってMapServerはPostGISサーバにアクセスするネットワークを持つ計算機にインストールでき、PostGISをデータソースとして使用することができます。システム間の接続は速いほど良いです。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>"--with-postgis"と好きなconfigureオプションを付けてMpaServerのコンパイルとインストールを行います。</p></li><li class="listitem"><p>Mapserverのmapファイルの中に、PostGISレイヤを追加します。たとえば次のようになります。</p><pre class="programlisting">LAYER 
  CONNECTIONTYPE postgis 
  NAME "widehighways" 
  # リモートの空間データベースに接続
  CONNECTION "user=dbuser dbname=gisdatabase host=bigserver"
  PROCESSING "CLOSE_CONNECTION=DEFER"
  # 'road'テーブルの'geom'カラムから線を取得
  DATA "geom from roads using srid=4326 using unique gid" 
  STATUS ON
  TYPE LINE 
  # 範囲内の線のうち広い高速道路のみ描画
  FILTER "type = 'highway' and numlanes &gt;= 4" 
  CLASS 
    # スーパー高速道路は、明るくし、2ピクセル幅にする
    EXPRESSION ([numlanes] &gt;= 6) 
    STYLE
      COLOR 255 22 22 
      WIDTH 2 
    END
  END 
  CLASS 
    # 残りの道路は、暗くし、1ピクセル幅にする
    EXPRESSION ([numlanes] &lt; 6) 
    STYLE
      COLOR 205 92 82
    END
  END 
END</pre><p>上の例におけるPostGIS特有のディレクティブは次の通りです。</p><div class="variablelist"><dl><dt><span class="term">CONNECTIONTYPE</span></dt><dd><p>PostGISレイヤにするには、ここは常に"postgis"になります。</p></dd><dt><span class="term">CONNECTION</span></dt><dd><p>データベース接続は「接続文字列」によって制御されます。接続文字列は、次に示すような標準的なキーと値からなります(&lt;&gt;内はデフォルト値)。</p><p>user=&lt;username&gt; password=&lt;password&gt;
                dbname=&lt;username&gt; hostname=&lt;server&gt;
                port=&lt;5432&gt;</p><p>空の接続文字列も妥当とされますし、あらゆるキーと値のペアは省略できます。接続するためには一般的にはdbnameとusernameとが最少で与えるものとなります。</p></dd><dt><span class="term">DATA</span></dt><dd><p>このパラメータの形式は"&lt;カラム&gt; from &lt;テーブル名&gt; using srid=&lt;srid&gt; using unique &lt;主キー&gt;"です。ここで、カラムは地図に描画する空間カラムで、SRIDは、カラムが使用するSRIDで、主キーはテーブルの主キー(または他の、インデクスを持つユニークな値のカラム)です。</p><p>"using srid"と"using unique"節は省略可能です。MapServerは可能なら自動的に正しい値を決定しますが、マップを描画するたびにいくつかの追加クエリを実行するコストがかかります。</p></dd><dt><span class="term">PROCESSING</span></dt><dd><p>接続を閉じずに、複数のレイヤで再利用する場合にCLOSE_CONNECTION=DEFERを設定します。これで速度が改善します。より詳しい説明については<a class="ulink" href="http://blog.cleverelephant.ca/2008/10/mapserverpostgis-performance-tips.html" target="_top">MapServer PostGIS Performance Tips</a>を参照して下さい。</p></dd><dt><span class="term">FILTER</span></dt><dd><p>フィルタは、妥当なSQL文字列でなければなりません。普通はSQLクエリ内で"WHERE"キーワードに続く論理式に沿います。たとえば、6レーン以上の道路のみをレンダリングするには、フィルタを"num_lanes &gt;= 6"とします。</p></dd></dl></div></li><li class="listitem"><p>空間データベースにおいては、空間(GiST)インデクスを、マップに描かれるレイヤ全てに構築していることを保証して下さい。</p><pre class="programlisting">CREATE INDEX [インデクス名] ON [テーブル名] USING GIST ( [ジオメトリカラム名] );</pre></li><li class="listitem"><p>MapServerを使用するレイヤのクエリを実行する場合には、"using unique"節もDATAステートメントに追加しなければなりません。</p><p>MapServerでは、クエリ実行の際には、それぞれの空間レコードを識別するための一意な識別子が必要です。MapServerのPostGISモジュールは、一意な識別子を提供するために、ユーザ指定の一意な値を使います。テーブルの主キーを使うのが最も良い方法です。</p></li></ol></div></div><div class="sect2" title="6.1.2. よくある質問"><div class="titlepage"><div><div><h3 class="title"><a name="id286986077"></a>6.1.2. よくある質問</h3></div></div></div><div class="qandaset" title="よくある質問"><a name="id286986083"></a><dl><dt>6.1.2.1. <a href="#id286986085">EXPRESSIONをmapファイルで使う時に、値がテーブルにあるのを確認しているのに条件がtrueになりません。</a></dt><dt>6.1.2.2. <a href="#id286986420">シェープファイルで使っているFILTERが、同じデータを持つPostGISテーブルでは動作しません。</a></dt><dt>6.1.2.3. <a href="#id286986441">PostGISレイヤの描画がシェープファイルより遅くなりますが、これが普通なのでしょうか?</a></dt><dt>6.1.2.4. <a href="#id286986465">PostGISレイヤはちゃんと描けましたが、クエリが本当に遅いです。何が問題なのですか?</a></dt><dt>6.1.2.5. <a href="#id286986494">ジオグラフィカラム(PostGIS 1.5で機能追加)をMapServerのレイヤのソースとして使用できますか?</a></dt></dl><table border="0" width="100%" summary="Q and A Set"><col align="left" width="1%"><col><tbody><tr class="question" title="6.1.2.1."><td align="left" valign="top"><a name="id286986085"></a><a name="id286986087"></a><p><b>6.1.2.1.</b></p></td><td align="left" valign="top"><p><code class="varname">EXPRESSION</code>をmapファイルで使う時に、値がテーブルにあるのを確認しているのに条件がtrueになりません。</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>EXPRESIONで使うフィールド名は、シェープファイルと違ってPostGISの場合<span class="emphasis"><em>小文字</em></span>になります。</p><pre class="programlisting">EXPRESSION ([numlanes] &gt;= 6)</pre></td></tr><tr class="question" title="6.1.2.2."><td align="left" valign="top"><a name="id286986420"></a><a name="id286986422"></a><p><b>6.1.2.2.</b></p></td><td align="left" valign="top"><p>シェープファイルで使っているFILTERが、同じデータを持つPostGISテーブルでは動作しません。</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>シェープファイルと違い、PostGISレイヤのためのフィルタは、SQL構文を使います(PostGISコネクタがMapServerでレイヤを描画するために生成するSQLステートメントに追加されます)。</p><pre class="programlisting">FILTER "type = 'highway' and numlanes &gt;= 4"</pre></td></tr><tr class="question" title="6.1.2.3."><td align="left" valign="top"><a name="id286986441"></a><a name="id286986443"></a><p><b>6.1.2.3.</b></p></td><td align="left" valign="top"><p>PostGISレイヤの描画がシェープファイルより遅くなりますが、これが普通なのでしょうか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>一般的に、地図に描画されるフィーチャーが多くなると、PostGISはシェープファイルより遅くなります。比較的少ないフィーチャー(100台)ではPostGISの方が早く、フィーチャー密度が高くなる(1000台)と、PostGISの方が遅くなります。</p><p>重大な描画性能の問題があるようでしたら、テーブルにある空間インデクスを構築していないというのがありそうです。</p><pre class="programlisting">postgis# CREATE INDEX geotable_gix ON geotable USING GIST ( geocolumn ); 
postgis# VACUUM ANALYZE;</pre></td></tr><tr class="question" title="6.1.2.4."><td align="left" valign="top"><a name="id286986465"></a><a name="id286986467"></a><p><b>6.1.2.4.</b></p></td><td align="left" valign="top"><p>PostGISレイヤはちゃんと描けましたが、クエリが本当に遅いです。何が問題なのですか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>クエリを早くするには、空間テーブルに一意なキーを持たせ、そのキーにインデクスを持たせなければなりません。</p><p><code class="varname">DATA</code>行の<code class="varname">USING UNIQUE</code>節で、MapServerで使用する一意なキーをどれにするか指定することができます。</p><pre class="programlisting">DATA "geom FROM geotable USING UNIQUE gid"</pre></td></tr><tr class="question" title="6.1.2.5."><td align="left" valign="top"><a name="id286986494"></a><a name="id286986497"></a><p><b>6.1.2.5.</b></p></td><td align="left" valign="top"><p>ジオグラフィカラム(PostGIS 1.5で機能追加)をMapServerのレイヤのソースとして使用できますか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>できます!MapServerはジオグラフィカラムをジオメトリカラムと同じに認識します。しかし、常にSRIDを4326とします。"using srid=43426"節を<code class="varname">DATA</code>ステートメントに入れて下さい。他の部分はジオメトリの場合と同じです。</p><pre class="programlisting">DATA "geog FROM geogtable USING SRID=4326 USING UNIQUE gid"</pre></td></tr></tbody></table></div></div><div class="sect2" title="6.1.3. 踏み込んだ使用法"><div class="titlepage"><div><div><h3 class="title"><a name="id286986521"></a>6.1.3. 踏み込んだ使用法</h3></div></div></div><p><code class="varname">USING</code>疑似SQL節を使ってMapServerがより複雑なクエリの結果を理解できるようにするための情報を追加します。より詳しく言うと、ビューまたは副問い合わせが元テーブル(<code class="varname">DATA</code>定義で"FROM"の右にあるもの)として使われる時、MapServerが自動的に一意な識別子がそれぞれの行にあるか、また、SRIDがテーブルにあるかを判別するのは困難です。<code class="varname">USING</code>節によって、MapServerがこれらの情報を得ることができます。例を次に挙げます。</p><pre class="programlisting">DATA "geom FROM (
  SELECT 
    table1.geom AS geom, 
    table1.gid AS gid, 
    table2.data AS data 
  FROM table1 
  LEFT JOIN table2 
  ON table1.id = table2.id
) AS new_table USING UNIQUE gid USING SRID=4326"</pre><div class="variablelist"><dl><dt><span class="term">USING UNIQUE &lt;uniqueid&gt;</span></dt><dd><p>Mapserverは、マップクエリを実行する際、行識別のために、それぞれの行に一意な識別子を求めます。通常ならシステムテーブルから主キーを識別しますが、ビューや副問い合わせでは、一意性のあるカラムを自動的に知ることができません。MapServerのクエリ機能を使いたいなら、一意性のあるカラムをビューまたは副問い合わせに追加する必要があり、そのカラムに<code class="varname">USING UNIQUE</code>宣言を付ける必要があります。たとえば、この目的のための主キー値のテーブルでのカラム名や、結果セットで一意性が保障されたカラムを明示的にSELECTに入れることができます。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>「マップクエリ」はップ上でクリックして、その場所におけるフィーチャーに関する情報を問い合わせる動作です。「マップクエリ」と<code class="varname">DATA</code>定義におけるSQLクエリと混同しないで下さい。</p></td></tr></table></div></dd><dt><span class="term">USING SRID=&lt;srid&gt;</span></dt><dd><p>PostGISは、MapServerに正しいデータを返すために、ジオメトリがどの空間参照系を使っているかを知る必要があります。通常は、この情報はPostGISデータベースの「geometry_columns」テーブルから得ることができます。しかし、副問い合わせやビューのような一時テーブルでは、この方法は不可能です。そこで、<code class="varname">USING SRID=</code>オプションを使って、正しいSRIDが<code class="varname">DATA</code>定義で使われるように指定します。</p></dd></dl></div></div><div class="sect2" title="6.1.4. 例"><div class="titlepage"><div><div><h3 class="title"><a name="id286986593"></a>6.1.4. 例</h3></div></div></div><p>簡単な例から始めて、ステップアップしていきましょう。次のMapServerレイヤ定義を考えて下さい。</p><pre class="programlisting">LAYER 
  CONNECTIONTYPE postgis 
  NAME "roads"
  CONNECTION "user=theuser password=thepass dbname=thedb host=theserver" 
  DATA "geom from roads" 
  STATUS ON 
  TYPE LINE 
  CLASS 
    STYLE
      COLOR 0 0 0 
    END
  END 
END</pre><p>このレイヤは"roads"テーブルにある道路ジオメトリの全部を黒線で表示するものです。</p><p>では、少なくとも1:100000にズームするまでは高速道路だけを表示したい、と言ってみましょう。次の2つのレイヤで、その効果が実現できます。</p><pre class="programlisting">LAYER 
  CONNECTIONTYPE postgis 
  CONNECTION "user=theuser password=thepass dbname=thedb host=theserver" 
  PROCESSING "CLOSE_CONNECTION=DEFER"
  DATA "geom from roads"
  MINSCALE 100000 
  STATUS ON 
  TYPE LINE 
  FILTER "road_type = 'highway'" 
  CLASS 
    COLOR 0 0 0 
  END 
END 
LAYER 
  CONNECTIONTYPE postgis 
  CONNECTION "user=theuser password=thepass dbname=thedb host=theserver"
  PROCESSING "CLOSE_CONNECTION=DEFER"
  DATA "geom from roads" 
  MAXSCALE 100000 
  STATUS ON 
  TYPE LINE
  CLASSITEM road_type 
  CLASS 
    EXPRESSION "highway" 
    STYLE
      WIDTH 2 
      COLOR 255 0 0  
    END
  END 
  CLASS  
    STYLE
      COLOR 0 0 0 
    END
  END 
END</pre><p>1つ目のレイヤはスケールが1:100000以上であるときに使われ、道路タイプが"highway"である道路のみ黒線で表示されます。<code class="varname">FILTER</code>オプションによって、道路タイプが"highway"の場合のみ表示することになります。</p><p>2つ目のレイヤはスケールが1:100000未満である時に使われ、"highway"は赤い二重細線で表示され、他の道路は黒線で表示されます。</p><p>さて、Mapserverの機能を使うだけで、2つのおもしろいことを実行しました。しかし、<code class="varname">DATA</code>のSQLステートメントは、単純なままです。道路名が(どういう理由かは知りませんが)他のテーブルに収められていて、それのデータを取得するためにテーブルを連結して、道路のラベルを取る必要がある、とします。</p><pre class="programlisting">LAYER 
  CONNECTIONTYPE postgis
  CONNECTION "user=theuser password=thepass dbname=thedb host=theserver" 
  DATA "geom FROM (SELECT roads.gid AS gid, roads.geom AS geom, 
        road_names.name as name FROM roads LEFT JOIN road_names ON 
        roads.road_name_id = road_names.road_name_id) 
        AS named_roads USING UNIQUE gid USING SRID=4326" 
  MAXSCALE 20000 
  STATUS ON 
  TYPE ANNOTATION 
  LABELITEM name
  CLASS 
    LABEL 
      ANGLE auto 
      SIZE 8 
      COLOR 0 192 0 
      TYPE truetype 
      FONT arial
    END
  END 
END</pre><p>このANNOTAIONレイヤでは、縮尺が1:20000以下のときに、全ての道路に緑色のラベルを表示します。また、この例は、<code class="varname">DATA</code>定義で、SQLのJOINを使用する方法も示しています。</p></div></div><div class="sect1" title="6.2. Javaクライアント(JDBC)"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id286986648"></a>6.2. Javaクライアント(JDBC)</h2></div></div></div><p>Javaクライアントは、直接的にテキスト表現として、またはPostGISにバンドルされているJDBC拡張オブジェクトを使用して、PostgreSQLデータベース内にある、PostGISの"geometry"オブジェクトにアクセスできます。拡張オブジェクトを使うためには、"postgis.jar"ファイルを、JDBCドライバパッケージの"postgresql.jar"とともに、 CLASSPATHに置く必要があります。</p><pre class="programlisting">import java.sql.*; 
import java.util.*; 
import java.lang.*; 
import org.postgis.*; 

public class JavaGIS { 

public static void main(String[] args) { 

  java.sql.Connection conn; 

  try { 
    /* 
    * JDBCドライバをロードして接続を確立します。
    */
    Class.forName("org.postgresql.Driver"); 
    String url = "jdbc:postgresql://localhost:5432/database"; 
    conn = DriverManager.getConnection(url, "postgres", ""); 
    /* 
    * ジオメトリ型を接続に追加します。
    * ご注意 : addDateType()を呼ぶ前に
    *   接続をpgsql特有の接続実装にキャストしなければなりません。
    */
    ((org.postgresql.PGConnection)conn).addDataType("geometry",Class.forName("org.postgis.PGgeometry"));
    ((org.postgresql.PGConnection)conn).addDataType("box3d",Class.forName("org.postgis.PGbox3d"));
    /* 
    * ステートメントの生成とSELECTクエリの実行を行います。
    */ 
    Statement s = conn.createStatement(); 
    ResultSet r = s.executeQuery("select geom,id from geomtable"); 
    while( r.next() ) { 
      /* 
      * ジオメトリをオブジェクトとして検索してジオメトリ型にキャストします。
      * オブジェクトを印字します。
      */ 
      PGgeometry geom = (PGgeometry)r.getObject(1); 
      int id = r.getInt(2); 
      System.out.println("Row " + id + ":");
      System.out.println(geom.toString()); 
    } 
    s.close(); 
    conn.close(); 
  } 
catch( Exception e ) { 
  e.printStackTrace(); 
  } 
} 
}</pre><p>"PGeometry"オブジェクトは、 Point, LineString, Polygon, MultiPoint, MultiLineString, MultiPolygonの各型に依存する、特定のトポロジカルジオメトリオブジェクト("Geometory"抽象クラスの子クラス)を持つラッパオブジェクトです。</p><pre class="programlisting">PGgeometry geom = (PGgeometry)r.getObject(1); 
if( geom.getType() == Geometry.POLYGON ) { 
  Polygon pl = (Polygon)geom.getGeometry(); 
  for( int r = 0; r &lt; pl.numRings(); r++) { 
    LinearRing rng = pl.getRing(r); 
    System.out.println("Ring: " + r); 
    for( int p = 0; p &lt; rng.numPoints(); p++ ) { 
      Point pt = rng.getPoint(p); 
      System.out.println("Point: " + p);
      System.out.println(pt.toString()); 
    } 
  } 
}</pre><p>幾何オブジェクトのさまざまなデータアクセサ関数に関する参照情報については、拡張オブジェクトのJavaDocをご覧下さい。</p></div><div class="sect1" title="6.3. Cクライアント(libpq)"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id286986673"></a>6.3. Cクライアント(libpq)</h2></div></div></div><div class="toc"><dl><dt><span class="sect2"><a href="#id286986681">6.3.1. テキストカーソル</a></span></dt><dt><span class="sect2"><a href="#id286986692">6.3.2. バイナリカーソル</a></span></dt></dl></div><p>...</p><div class="sect2" title="6.3.1. テキストカーソル"><div class="titlepage"><div><div><h3 class="title"><a name="id286986681"></a>6.3.1. テキストカーソル</h3></div></div></div><p>...</p></div><div class="sect2" title="6.3.2. バイナリカーソル"><div class="titlepage"><div><div><h3 class="title"><a name="id286986692"></a>6.3.2. バイナリカーソル</h3></div></div></div><p>...</p></div></div></div><div class="chapter" title="第7章 性能向上に関する技法"><div class="titlepage"><div><div><h2 class="title"><a name="id286989453"></a>第7章 性能向上に関する技法</h2></div></div></div><div class="toc"><p><b>目次</b></p><dl><dt><span class="sect1"><a href="#id286989459">7.1. 大きなジオメトリを持つ小さなテーブル</a></span></dt><dd><dl><dt><span class="sect2"><a href="#id286989464">7.1.1. 問題の説明</a></span></dt><dt><span class="sect2"><a href="#id286989488">7.1.2. 応急処置</a></span></dt></dl></dd><dt><span class="sect1"><a href="#id286989521">7.2. ジオメトリインデクスでCLUSTERを実行する</a></span></dt><dt><span class="sect1"><a href="#id286989548">7.3. 次元変換の回避</a></span></dt><dt><span class="sect1"><a href="#id286989569">7.4. コンフィギュレーションのチューン</a></span></dt><dd><dl><dt><span class="sect2"><a href="#id286989586">7.4.1. 起動時</a></span></dt><dt><span class="sect2"><a href="#id286989950">7.4.2. 実行時</a></span></dt></dl></dd></dl></div><div class="sect1" title="7.1. 大きなジオメトリを持つ小さなテーブル"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id286989459"></a>7.1. 大きなジオメトリを持つ小さなテーブル</h2></div></div></div><div class="toc"><dl><dt><span class="sect2"><a href="#id286989464">7.1.1. 問題の説明</a></span></dt><dt><span class="sect2"><a href="#id286989488">7.1.2. 応急処置</a></span></dt></dl></div><div class="sect2" title="7.1.1. 問題の説明"><div class="titlepage"><div><div><h3 class="title"><a name="id286989464"></a>7.1.1. 問題の説明</h3></div></div></div><p>現版のPostgreSQL(8.0を含む)では、TOASTテーブルに従うクエリオプティマイザの弱さに苦しみます。 TOASTテーブルは、(長いテキスト、イメージ、多数の頂点を持つ複合ジオメトリといった)通常のデータページに適合しない、(データサイズという意味では)巨大な値を納めるための「拡張部屋」の一種です。詳細情報は<a class="ulink" href="http://www.postgresql.org/docs/current/static/storage-toast.html" target="_top">the PostgreSQL Documentation for TOAST</a>をご覧ください。</p><p>(高解像度で全てのヨーロッパの国の境界を含むテーブルのような)大きなジオメトリがあるうえ、行がそう多くないテーブルを持つようになると、この問題が出てきます。テーブル自体は小さいのですが、多くのTOASTスペースを使います。例として、テーブル自体は概ね80行で3データページしか使わなくてもTOASTテーブルで8225ページを使うとします。</p><p>ここで、ジオメトリ演算子の&amp;&amp;を使って、ほとんどマッチしないようなバウンダリボックスを検索するクエリを出してみます。クエリオプティマイザにはテーブルは3ページ80行しかないように見えます。オプティマイザは、小さなテーブルを順に走査する方がインデクスを使うよりも早いと見積もります。そして、GiSTインデクスは無視すると決めます。通常なら、この見積もりは正しいです。しかし、この場合は&amp;&amp;演算子が全てのジオメトリをディスクから呼び出しでバウンディングボックスと比較しなければならなくなり、ゆえに、全てのTOASTページもまた呼び出す必要があります。</p><p>このバグに苦しむかどうかを見るには、PostgreSQLの"EXPLAIN ANALYZE"コマンドを使います。詳しい情報と技術に関する詳細については、postgres performance mailing list のスレッド(http://archives.postgresql.org/pgsql-performance/2005-02/msg00030.php)をご覧下さい。</p></div><div class="sect2" title="7.1.2. 応急処置"><div class="titlepage"><div><div><h3 class="title"><a name="id286989488"></a>7.1.2. 応急処置</h3></div></div></div><p>PostgreSQLコミュニティでは、TOASTを意識したクエリ見積もりを作ることで、この問題を解決しようとしています。今のところは、二つの応急処置があります。</p><p>ひとつは、クエリプランナにインデクスの使用を強制することです。クエリを発行する前に"SET enable_seqscan TO off;"をサーバに送信します。これは基本的にクエリプランナに対して可能な限り順に走査することを避けるよう強制します。そのためGiSTインデクスを通常使うようになります。しかし、このフラグは接続するたびに設定しなければならず、他のケースにおいてはクエリプランナに誤った見積もりをさせることになるので、 "SET enable_seqscan TO on;"をクエリの後に送信すべきです。</p><p>もうひとつは、順に走査することをクエリプランナが考える程度に早くすることです。これは、バウンダリボックスの「キャッシュ」を行う追加カラムを作成し、このカラムにマッチさせるようにすることで達成することができます。ここでの例では次のようになります。</p><pre class="programlisting">SELECT AddGeometryColumn('myschema','mytable','bbox','4326','GEOMETRY','2'); 
UPDATE mytable SET bbox = ST_Envelope(ST_Force_2d(the_geom));</pre><p>そして、次のように、&amp;&amp;演算子をgeom_columnに対して行っていたものをbboxに変更します。</p><pre class="programlisting">SELECT geom_column 
FROM mytable 
WHERE bbox &amp;&amp; ST_SetSRID('BOX3D(0 0,1 1)'::box3d,4326);</pre><p>もちろん、mytableの行を変更または追加したら、bboxを「同期」するようにしなければなりません。最もすっきりした方法はトリガです。もしくは、アプリケーションを変更してbboxカラムの現状を保持するか、テーブル更新後にいつもUPDATEクエリを実行するかでも対応できます。</p></div></div><div class="sect1" title="7.2. ジオメトリインデクスでCLUSTERを実行する"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id286989521"></a>7.2. ジオメトリインデクスでCLUSTERを実行する</h2></div></div></div><p>読み込むことがほとんどで、かつほとんどのクエリでひとつのインデクスを使うようなテーブルのために、PostgreSQLはCLUSTERコマンドを提供しています。このコマンドは、全てのデータ行を、インデクス基準にあわせて物理的に再整理するので、二つの性能の利点を生みます。ひとつは、インデクスの範囲走査のために、データテーブルのシーク回数が劇的に減少することです。ふたつめは、いくつかの小さなインデクス間隔に集中する場合には、データ行が分布するデータページがより少なくなるので、より効率的なキャッシュを持つことです(この点で、PostgreSQLマニュアルのCLUSTERコマンドのドキュメントを読むように仕向けられていると感じて下さい)。</p><p>しかし、GiSTインデクスは単純にNULL値を無視するため現在のところPostGISのGiSTインデクスのクラスタリングはできず、次のようなエラーメッセージを得ます。</p><pre class="programlisting">lwgeom=# CLUSTER my_geom_index ON my_table; 
ERROR: cannot cluster when index access method does not handle null values
(エラー: インデクスアクセスメソッドがNULL値を扱わない場合クラスタ化できません)
HINT: You may be able to work around this by marking column "the_geom" NOT NULL.(ヒント: 列"the_geom"をNOT NULLとすることで、これを回避できるかもしれません)
</pre><p>ヒントメッセージにある通り、テーブルに"not null"制限を追加することで、この欠陥にとりあえず対応できます。例を示します。</p><pre class="programlisting">lwgeom=# ALTER TABLE my_table ALTER COLUMN the_geom SET not null; 
ALTER TABLE</pre><p>もちろん、ジオメトリカラムで実際にNULL値が必要な場合、この対応はできません。さらには、制限を追加するには上の方法を使わなければならず、"ALTER TABLE blubb ADD CHECK (geometry is not null);"のようなCHECK制限は使えません。 </p></div><div class="sect1" title="7.3. 次元変換の回避"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id286989548"></a>7.3. 次元変換の回避</h2></div></div></div><p>ときどき、テーブルで3次元、4次元のデータを持つのに、常にOpenGIS準拠のST_AsText()またはST_AsBinary()関数を使ってアクセスして 2次元ジオメトリを出力させるようなことが起きます。内部でST_Force_2d()関数を呼んでいるために発生しますが、これは、大きなジオメトリでは重大なオーバヘッドを誘引することになります。このオーバヘッドを回避するには、一度追加された次元を前もって落とし、かつこれを永続化するのが適当かも知れません。</p><pre class="programlisting">UPDATE mytable SET the_geom = ST_Force_2d(the_geom); 
VACUUM FULL ANALYZE mytable;</pre><p>AddGeometryColumn()を使ってジオメトリカラムを追加した場合、ジオメトリの次元に関する制限があることに注意してください。この制限を迂回するには、制限の削除が必要になります。geometry_columnsテーブル内のエントリを更新して、その後で制限を再作成することを忘れないで下さい。</p><p>大きなテーブルの場合、WHERE節、およびプライマリキー若しくは他の適切な基準によってテーブルの一部へのUPDATEを制限させて、UPDATEの実行の間に単に"VACUUM;"と実行することで、UPDATEをより小さい塊に分割するのが賢いやり方かもしれません。これにより、テンポラリディスクスペースが劇的に減少します。さらに、次元混合のジオメトリを持つ場合、"WHERE dimension(the_geom)&gt;2"によってUPDATEを制限することで、2次元で書かれているジオメトリの再書き込みをスキップさせることができます。</p></div><div class="sect1" title="7.4. コンフィギュレーションのチューン"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id286989569"></a>7.4. コンフィギュレーションのチューン</h2></div></div></div><div class="toc"><dl><dt><span class="sect2"><a href="#id286989586">7.4.1. 起動時</a></span></dt><dt><span class="sect2"><a href="#id286989950">7.4.2. 実行時</a></span></dt></dl></div><p>この技法は、FOSS4G 2007カンファレンスでのKevin Neufeldさんのプレゼンテーション「PostGISパワーユーザのための技法(Tips for the PostGIS Power User)」から得たものです。 PostGISの使用(たとえば、「静的データと複雑な解析」対「よくアップデートされるデータと多数のユーザ」など)に依存して、これらの変更によって、クエリがはっきり速度向上するようになります。</p><p>詳細情報(およびよりよい書式)については、オリジナルのプレゼンテーションが<a class="ulink" href="http://2007.foss4g.org/presentations/view.php?abstract_id=117" target="_top">http://2007.foss4g.org/presentations/view.php?abstract_id=117</a>にあります。
    </p><div class="sect2" title="7.4.1. 起動時"><div class="titlepage"><div><div><h3 class="title"><a name="id286989586"></a>7.4.1. 起動時</h3></div></div></div><p>
          これらの設定はpostgresql.conf内にあります。
        </p><p>
          <a class="ulink" href="http://www.postgresql.org/docs/current/static/runtime-config-wal.html#GUC-CHECKPOINT-SEGMENTS" target="_top">checkpoint_segments</a>
        </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
              自動WALチェックポイント間のログファイルのセグメント(1セグメントは通常16MB)の数です。デフォルトは3です。
            </p></li><li class="listitem"><p>
              書き込み処理が多いデータベースごとに少なくとも10から30を設定します。大きいデータベース負荷がかかる場合は増やします。この話題に関する別の記事として、<a class="ulink" href="http://www.westnet.com/~gsmith/content/postgresql/chkp-bgw-83.htm" target="_top">Greg Smith: Checkpoint and Background writer</a>は読む価値があります。
            </p></li><li class="listitem"><p>
              できればxlogは別のディスク装置に保存します。
            </p></li></ul></div><p>
           <a class="ulink" href="http://www.postgresql.org/docs/current/static/runtime-config-query.html#GUC-CONSTRAINT-EXCLUSION" target="_top">constraint_exclusion</a>
        </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
              デフォルト: off (PostgreSQL 8.4より前の場合。PostgreSQL 8.4以上はpartitionに設定)
            </p></li><li class="listitem"><p>
              一般的にテーブルのパーティショニングに使われます。PostgreSQL 8.4より前を使用している場合、"on"にして、クエリプランナに対して求めるような最適化をさせます。
			  PostgreSQL 8.4からは、デフォルトは"partition"になっています。この場合、制約やテーブルが継承階層の中にあって、クエリプランナに他のペナルティを与えない場合に、制約を考慮に入れたテーブルの解析を強制します。PostgreSQL 8.4以上ではこれが理想的です。
            </p></li></ul></div><p>
           <a class="ulink" href="http://www.postgresql.org/docs/current/static/runtime-config-resource.html#GUC-SHARED-BUFFERS" target="_top">shared_buffers</a>
        </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
              デフォルト: ~32MB
            </p></li><li class="listitem"><p>
              有効RAMの1/3から3/4程度にします。
            </p></li></ul></div></div><div class="sect2" title="7.4.2. 実行時"><div class="titlepage"><div><div><h3 class="title"><a name="id286989950"></a>7.4.2. 実行時</h3></div></div></div><p>
          <a class="ulink" href="http://www.postgresql.org/docs/current/static/runtime-config-resource.html#GUC-WORK-MEM" target="_top">work_mem</a>(並べ替えや複雑なクエリに使われるメモリ)
        </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
              デフォルトt: 1MB
            </p></li><li class="listitem"><p>
              大きなデータベースの場合や、複雑なクエリの場合、RAMが多い場合は値を大きくするように調整します。
            </p></li><li class="listitem"><p>
              同時接続ユーザ数が多い場合や、RAMが少ない場合には値を小さくするように調整します。
            </p></li><li class="listitem"><p>
                たくさんのRAMを持ち、少数の開発者しかいない場合は次のようにします。
                </p><pre class="programlisting">
                    SET work_mem TO 1200000;
                </pre><p>
            </p></li></ul></div><p>
          <a class="ulink" href="http://www.postgresql.org/docs/current/static/runtime-config-resource.html#GUC-MAINTENANCE-WORK-MEM" target="_top">maintenance_work_mem</a> (VACUUM, CREATE INDEX等で使われるメモリ)
        </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
              デフォルト: 16MB
            </p></li><li class="listitem"><p>
              一般的には低すぎます - メモリスワップの間、入出力が拘束され、オブジェクトがロックされます。
            </p></li><li class="listitem"><p>
              本番サーバでは32MBから256MBが推奨ですが、同時接続ユーザ数に依存します。たくさんのRAMを持ち、少数の開発者しかいない場合は次のようにします。
                </p><pre class="programlisting">
                    SET maintainence_work_mem TO 1200000;
                </pre><p>
            </p></li></ul></div></div></div></div><div class="chapter" title="第8章 PostGISリファレンス"><div class="titlepage"><div><div><h2 class="title"><a name="reference"></a>第8章 PostGISリファレンス</h2></div></div></div><div class="toc"><p><b>目次</b></p><dl><dt><span class="sect1"><a href="#PostGIS_Types">8.1. PostgreSQL PostGIS Geometry/Geography/Box 型</a></span></dt><dt><span class="sect1"><a href="#Management_Functions">8.2. 管理関数</a></span></dt><dt><span class="sect1"><a href="#Geometry_Constructors">8.3. ジオメトリ コンストラクタ</a></span></dt><dt><span class="sect1"><a href="#Geometry_Accessors">8.4. ジオメトリ アクセサ</a></span></dt><dt><span class="sect1"><a href="#Geometry_Editors">8.5. ジオメトリ エディタ</a></span></dt><dt><span class="sect1"><a href="#Geometry_Outputs">8.6. ジオメトリ出力</a></span></dt><dt><span class="sect1"><a href="#Operators">8.7. 演算子</a></span></dt><dt><span class="sect1"><a href="#Spatial_Relationships_Measurements">8.8. 空間関係関数と空間計測関数 </a></span></dt><dt><span class="sect1"><a href="#Geometry_Processing">8.9. ジオメトリ処理関数</a></span></dt><dt><span class="sect1"><a href="#Linear_Referencing">8.10. 線型参照</a></span></dt><dt><span class="sect1"><a href="#Long_Transactions_Support">8.11. ロングトランザクション サポート</a></span></dt><dt><span class="sect1"><a href="#Miscellaneous_Functions">8.12. その他の関数</a></span></dt><dt><span class="sect1"><a href="#Exceptional_Functions">8.13. 例外的関数</a></span></dt></dl></div><p>ここで示す関数はPostGISユーザが必要とすると思われる関数です。この他に、一般的なユーザが使わないPostGISオブジェクトに対して求められるサポート関数があります。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>PostGISは、既存の名前付け方針からSQL-MM中心の方針への切り替えを開始しています。結果として、ユーザが知っていて愛用している関数の多くが標準空間型 (ST) プレフィクスを使うように名前変更されました。以前の関数はまだ有効ですが、更新された等価な関数があるものについては、この文書の一覧から外しています(訳注: 非推奨関数はPostGIS 2.0では基本的に外れています)。これらの関数は非推奨であり、将来のリリースでは削除されますので、*使わないでください*。</p></td></tr></table></div><div class="sect1" title="8.1. PostgreSQL PostGIS Geometry/Geography/Box 型"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="PostGIS_Types"></a>8.1. PostgreSQL PostGIS Geometry/Geography/Box 型</h2></div><div><div class="abstract" title="概要"><p class="title"><b>概要</b></p><p>本節では、PostGISによってインストールされるPostgreSQLデータ型を挙げます。特にユーザ定義関数をデザインする際に大変重要なキャストの挙動を記載しています。    </p><p>ある型が他の型に強制されることをキャストといいます。PostgreSQLは、ほとんどのデータベースと異なり、カスタム型のキャストの挙動と、キャストのために使われる関数を定義することができます。キャストは自動的に指定することができます。この場合は、otherfootypeでしか動作しない関数にmyfooを渡す場合で、自動キャストがそこにある場合には、CAST(myfoo AS otherfootype)やmyfoo::otherfootypeというものを必要としません。
    </p><p>自動キャストの挙動に頼る危険性は、関数をオーバロードするときに出てきます。たとえば、box2dを取るものとbox3dとを取るものがあるけれどもジオメトリをとるものが無いとします。どちらの関数とも、ジオメトリは両方に自動キャストするので、ジオメトリを使って良いことになります。-- しかし、あいまいな関数エラーで終わります。PostgreSQLに強制的に選択させるために、CAST(mygeom As box3d)またはmygeom::box3dを実行します。</p><p><span class="emphasis"><em>少なくともPostgreSQL 8.3では</em></span>、全て文字列にキャストできます(おそらく、不思議な未知の型のためです)。オブジェクトを文字列にキャストするために表現するキャストの定義は必要ありません。</p></div></div></div></div><div class="toc"><dl><dt><span class="refentrytitle"><a href="#box2d_type">box2d</a></span><span class="refpurpose"> ? xmin, ymin, xmax, ymaxで作られるボックス。しばしばジオメトリを囲む2次元のボックスを返すために使われます。</span></dt><dt><span class="refentrytitle"><a href="#box3d_type">box3d</a></span><span class="refpurpose"> ? xmin, ymin, zmin, xmax, ymax, zmaxで作られるボックス。しばしばジオメトリやジオメトリのコレクションの3次元範囲を返すために使われます。</span></dt><dt><span class="refentrytitle"><a href="#geometry">geometry</a></span><span class="refpurpose"> ? 平面空間データ型。</span></dt><dt><span class="refentrytitle"><a href="#geometry_dump">geometry_dump</a></span><span class="refpurpose"> ? geom(ジオメトリオブジェクトを保持)とpath[](ダンプされたオブジェクト内のジオメトリの位置を保持する1次元配列)の、二つのフィールドを持つ空間データ型。</span></dt><dt><span class="refentrytitle"><a href="#geography">geography</a></span><span class="refpurpose"> ? 回転楕円体空間データ型。</span></dt></dl></div><div class="refentry" title="box2d"><a name="box2d_type"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>box2d ? xmin, ymin, xmax, ymaxで作られるボックス。しばしばジオメトリを囲む2次元のボックスを返すために使われます。</p></div><div class="refsection" title="説明"><a name="id286992866"></a><h2>説明</h2><p>box2dは、ジオメトリまたはジオメトリ集合を囲むボックスを表現するPostGIS空間データ型です。PostGIS 1.4より前のST_Extentはbox2dを返しました。</p></div></div><div class="refentry" title="box3d"><div class="refentry.separator"><hr></div><a name="box3d_type"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>box3d ? xmin, ymin, zmin, xmax, ymax, zmaxで作られるボックス。しばしばジオメトリやジオメトリのコレクションの3次元範囲を返すために使われます。</p></div><div class="refsection" title="説明"><a name="id286992889"></a><h2>説明</h2><p>box3dは、ジオメトリまたはジオメトリ集合を囲むボックスを表現するPostGIS空間データ型です。ST_3DExtentはbox3dオブジェクトを返します。</p></div><div class="refsection" title="キャストの挙動"><a name="id286992899"></a><h2>キャストの挙動</h2><p>本節では、このデータ型で許容される明示的なキャストと自動キャストの一覧を挙げます。</p><div class="informaltable"><table border="1"><colgroup><col><col></colgroup><tbody><tr><td>キャスト先</td><td>挙動</td></tr><tr><td>box</td><td>自動</td></tr><tr><td>box2d</td><td>自動</td></tr><tr><td>geometry</td><td>自動</td></tr></tbody></table></div></div></div><div class="refentry" title="geometry"><div class="refentry.separator"><hr></div><a name="geometry"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>geometry ? 平面空間データ型。</p></div><div class="refsection" title="説明"><a name="id286992976"></a><h2>説明</h2><p>geometryは基礎的なPostGIS空間データ型です。ユークリッド座標系上の地物を表現するために使われます。</p></div><div class="refsection" title="キャストの挙動"><a name="id286992985"></a><h2>キャストの挙動</h2><p>本節では、このデータ型で許容される明示的なキャストと自動キャストの一覧を挙げます。</p><div class="informaltable"><table border="1"><colgroup><col><col></colgroup><tbody><tr><td>キャスト先</td><td>挙動</td></tr><tr><td>box</td><td>自動</td></tr><tr><td>box2d</td><td>自動</td></tr><tr><td>box3d</td><td>自動</td></tr><tr><td>bytea</td><td>自動</td></tr><tr><td>geography</td><td>自動</td></tr><tr><td>text</td><td>自動</td></tr></tbody></table></div></div><div class="refsection" title="関連情報"><a name="id286993078"></a><h2>関連情報</h2><p><a class="xref" href="#RefObject" title="4.1. GISオブジェクト">「GISオブジェクト」</a></p></div></div><div class="refentry" title="geometry_dump"><div class="refentry.separator"><hr></div><a name="geometry_dump"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>geometry_dump ? geom(ジオメトリオブジェクトを保持)とpath[](ダンプされたオブジェクト内のジオメトリの位置を保持する1次元配列)の、二つのフィールドを持つ空間データ型。</p></div><div class="refsection" title="説明"><a name="id286993102"></a><h2>説明</h2><p>geometry_dumpは.geomフィールドで参照するジオメトリオブジェクトと1次元整数配列のpath[](1始まりで、path[1]が最初の要素)からなる複合データ型です。 ST_Dump*関数群に使われます。これらの関数は複雑なジオメトリを複数の要素とその位置に分解します。</p></div><div class="refsection" title="関連情報"><a name="id286993112"></a><h2>関連情報</h2><p><a class="xref" href="#PostGIS_Geometry_DumpFunctions" title="13.5. PostGISジオメトリ/ジオグラフィ/ラスタダンプ関数">「PostGISジオメトリ/ジオグラフィ/ラスタダンプ関数」</a> </p></div></div><div class="refentry" title="geography"><div class="refentry.separator"><hr></div><a name="geography"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>geography ? 回転楕円体空間データ型。</p></div><div class="refsection" title="説明"><a name="id286993139"></a><h2>説明</h2><p>geographyは球面座標系での地物表現に使われる空間データ型です。</p></div><div class="refsection" title="キャストの挙動"><a name="id286993148"></a><h2>キャストの挙動</h2><p>本節では、このデータ型で許容される明示的なキャストと自動キャストの一覧を挙げます。</p><div class="informaltable"><table border="1"><colgroup><col><col></colgroup><tbody><tr><td>キャスト先</td><td>挙動</td></tr><tr><td>geometry</td><td>explicit</td></tr></tbody></table></div></div><div class="refsection" title="関連情報"><a name="id286993191"></a><h2>関連情報</h2><p><a class="xref" href="#PostGIS_GeographyFunctions" title="13.3. PostGISジオグラフィ対応関数">「PostGISジオグラフィ対応関数」</a>, <a class="xref" href="#PostGIS_Geography" title="4.2. PostGISジオグラフィ型">「PostGISジオグラフィ型」</a></p></div></div></div><div class="sect1" title="8.2. 管理関数"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Management_Functions"></a>8.2. 管理関数</h2></div></div></div><div class="toc"><dl><dt><span class="refentrytitle"><a href="#AddGeometryColumn">AddGeometryColumn</a></span><span class="refpurpose"> ? ジオメトリカラムを既存の属性テーブルに追加します。デフォルトでは、制約の定義でなく型の変更を使います。use_typmodパラメタをfalseで渡すと制約ベースの古い挙動で動作します。</span></dt><dt><span class="refentrytitle"><a href="#DropGeometryColumn">DropGeometryColumn</a></span><span class="refpurpose"> ? ジオメトリカラムを空間テーブルから除去します。</span></dt><dt><span class="refentrytitle"><a href="#DropGeometryTable">DropGeometryTable</a></span><span class="refpurpose"> ? テーブルとgeometry_columnsの当該テーブルへの参照の全てを削除します。</span></dt><dt><span class="refentrytitle"><a href="#PostGIS_Full_Version">PostGIS_Full_Version</a></span><span class="refpurpose"> ? 完全なPostGISのバージョン情報とコンフィギュレーション情報を報告します。</span></dt><dt><span class="refentrytitle"><a href="#PostGIS_GEOS_Version">PostGIS_GEOS_Version</a></span><span class="refpurpose"> ? GEOSライブラリのバージョン番号を返します。</span></dt><dt><span class="refentrytitle"><a href="#PostGIS_LibXML_Version">PostGIS_LibXML_Version</a></span><span class="refpurpose"> ? LibXML2ライブラリのバージョン番号を返します。</span></dt><dt><span class="refentrytitle"><a href="#PostGIS_Lib_Build_Date">PostGIS_Lib_Build_Date</a></span><span class="refpurpose"> ? PostGISライブラリのビルド日付を返します。</span></dt><dt><span class="refentrytitle"><a href="#PostGIS_Lib_Version">PostGIS_Lib_Version</a></span><span class="refpurpose"> ? PostGISのバージョン番号を返します。</span></dt><dt><span class="refentrytitle"><a href="#PostGIS_PROJ_Version">PostGIS_PROJ_Version</a></span><span class="refpurpose"> ? PROJ4のバージョン番号を返します。</span></dt><dt><span class="refentrytitle"><a href="#PostGIS_Scripts_Build_Date">PostGIS_Scripts_Build_Date</a></span><span class="refpurpose"> ? PostGISスクリプトのビルド日付を返します。</span></dt><dt><span class="refentrytitle"><a href="#PostGIS_Scripts_Installed">PostGIS_Scripts_Installed</a></span><span class="refpurpose"> ? このデータベースにインストールしたPostGISスクリプトのバージョン番号を返します。</span></dt><dt><span class="refentrytitle"><a href="#PostGIS_Scripts_Released">PostGIS_Scripts_Released</a></span><span class="refpurpose"> ? インストールしたPostGISライブラリとともにリリースされたpostgis.sqlスクリプトのバージョン番号を返します。</span></dt><dt><span class="refentrytitle"><a href="#PostGIS_Version">PostGIS_Version</a></span><span class="refpurpose"> ? PostGISバージョン番号とコンパイルオプションを返します。</span></dt><dt><span class="refentrytitle"><a href="#Populate_Geometry_Columns">Populate_Geometry_Columns</a></span><span class="refpurpose"> ? ジオメトリカラムが型修飾子で定義されるか、適切な制約を持つことを確実にします。ジオメトリカラムが<code class="varname">geometry_columns</code>に正しく登録されることを確実にします。デフォルトでは、型修飾子によらないジオメトリカラムを型修飾子によるジオメトリカラムに変換します。以前の挙動にするには<code class="varname">use_typmod=false</code>とします。</span></dt><dt><span class="refentrytitle"><a href="#UpdateGeometrySRID">UpdateGeometrySRID</a></span><span class="refpurpose"> ? ジオメトリカラムの全てのフィーチャーのSRID、geometry_columnsメタデータとSRIDテーブル制約を更新します。</span></dt></dl></div><div class="refentry" title="AddGeometryColumn"><a name="AddGeometryColumn"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>AddGeometryColumn ? ジオメトリカラムを既存の属性テーブルに追加します。デフォルトでは、制約の定義でなく型の変更を使います。use_typmodパラメタをfalseで渡すと制約ベースの古い挙動で動作します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">AddGeometryColumn</b>(</code>varchar 
			<var class="pdparam">table_name</var>, varchar 
			<var class="pdparam">column_name</var>, integer 
			<var class="pdparam">srid</var>, varchar 
			<var class="pdparam">type</var>, integer 
			<var class="pdparam">dimension</var>, boolean 
			<var class="pdparam">use_typmod=true</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">AddGeometryColumn</b>(</code>varchar 
			<var class="pdparam">schema_name</var>, varchar 
			<var class="pdparam">table_name</var>, varchar 
			<var class="pdparam">column_name</var>, integer 
			<var class="pdparam">srid</var>, varchar 
			<var class="pdparam">type</var>, integer 
			<var class="pdparam">dimension</var>, boolean 
			<var class="pdparam">use_typmod=true</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">AddGeometryColumn</b>(</code>varchar 
			<var class="pdparam">catalog_name</var>, varchar 
			<var class="pdparam">schema_name</var>, varchar 
			<var class="pdparam">table_name</var>, varchar 
			<var class="pdparam">column_name</var>, integer 
			<var class="pdparam">srid</var>, varchar 
			<var class="pdparam">type</var>, integer 
			<var class="pdparam">dimension</var>, boolean 
			<var class="pdparam">use_typmod=true</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id286994072"></a><h2>説明</h2><p>ジオメトリカラムを既存の属性テーブルに追加します。<code class="varname">schema_name</code>はスキーマ名です。<code class="varname">srid</code>はSPATIAL_REF_SYSテーブルのエントリを参照する整数でなければなりません。<code class="varname">type</code>は'POLYGON'や'MULTILINESTRING'といった、ジオメトリ型を示す文字でなければなりません。指定したスキーマが存在しない(または現在のsearch_pathからは見えない)場合、または指定したSRID、ジオメトリ型もしくは次元が不正である場合はエラーが投げられます。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>変更: 2.0.0では、geometry_columnsがシステムカタログを読むビューになったため、geometry_columnsを更新しないようになりました。デフォルトでは制約を生成せず、PostgreSQLの型変更を使います。この関数でWGS 84のPOINTカラムを構築するのと<code class="code">ALTER TABLE some_table ADD COLUMN geom geometry(Point,4326);</code>とは等価です。</p><p>変更: 2.0.0では、制約を使う必要がある場合には、<code class="varname">use_typmod</code>をfalseにします。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>変更: 2.0.0では、

ビューについては、geometry_columnsへの手動登録はできなくなりました。しかし、tyomodテーブルジオメトリに対して構築されていて、かつラッパ関数が無いビューは、親テーブルカラムのtypmodの挙動を継承するので、正しく登録されます。他のジオメトリを出力するジオメトリ関数を使うビューについては、ビューのジオメトリカラムが正しく登録されるようにするため、typmodジオメトリへのキャストが必要です。<a class="xref" href="#Manual_Register_Spatial_Column" title="4.3.4. 手動でジオメトリカラムをgeometry_columnsに登録する">「手動でジオメトリカラムをgeometry_columnsに登録する」</a>を参照して下さい。
			</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p><p>機能強化: 2.0.0では、use_typmod引数が導入されました。デフォルトでは制約を基にしたものでなくtypmodジオメトリカラムが生成されます。</p></div><div class="refsection" title="例"><a name="id286994156"></a><h2>例</h2><pre class="programlisting">-- データを保持するスキーマの生成
CREATE SCHEMA my_schema;
-- 新しい単純なPostgreSQLテーブルの生成
CREATE TABLE my_schema.my_spatial_table (id serial);

-- "id"カラムのみを持つ単純なテーブルの説明
postgis=# \d my_schema.my_spatial_table
							 Table "my_schema.my_spatial_table"
 Column |  Type   |                                Modifiers
--------+---------+-------------------------------------------------------------------------
 id     | integer | not null default nextval('my_schema.my_spatial_table_id_seq'::regclass)

-- テーブルにジオメトリカラムを追加
SELECT AddGeometryColumn ('my_schema','my_spatial_table','geom',4326,'POINT',2);

-- 制約を基にしたPOINTカラムを追加
SELECT AddGeometryColumn ('my_schema','my_spatial_table','geom_c',4326,'POINT',2, false);

-- 制約を基にしたCURVEPOLYGONを追加
SELECT AddGeometryColumn ('my_schema','my_spatial_table','geomcp_c',4326,'CURVEPOLYGON',2, false);

-- 新しいジオメトリカラムが追加されたことを確認
\d my_schema.my_spatial_table
                            addgeometrycolumn                            
-------------------------------------------------------------------------
 my_schema.my_spatial_table.geomcp_c SRID:4326 TYPE:CURVEPOLYGON DIMS:2 
(1 row)

                                    Table "my_schema.my_spatial_table"
  Column  |         Type         |                                Modifiers                                
----------+----------------------+-------------------------------------------------------------------------
 id       | integer              | not null default nextval('my_schema.my_spatial_table_id_seq'::regclass)
 geom     | geometry(Point,4326) | 
 geom_c   | geometry             | 
 geomcp_c | geometry             | 
Check constraints:
    "enforce_dims_geom_c" CHECK (st_ndims(geom_c) = 2)
    "enforce_dims_geomcp_c" CHECK (st_ndims(geomcp_c) = 2)
    "enforce_geotype_geom_c" CHECK (geometrytype(geom_c) = 'POINT'::text OR geom_c IS NULL)
    "enforce_geotype_geomcp_c" CHECK (geometrytype(geomcp_c) = 'CURVEPOLYGON'::text OR geomcp_c IS NULL)
    "enforce_srid_geom_c" CHECK (st_srid(geom_c) = 4326)
    "enforce_srid_geomcp_c" CHECK (st_srid(geomcp_c) = 4326)
    
-- geometry_columnsビューへの新しいカラムの登録も --
SELECT f_geometry_column As col_name, type, srid, coord_dimension As ndims 
    FROM geometry_columns
    WHERE f_table_name = 'my_spatial_table' AND f_table_schema = 'my_schema';

 col_name |     type     | srid | ndims 
----------+--------------+------+-------
 geom     | Point        | 4326 |     2
 geom_c   | Point        | 4326 |     2
 geomcp_c | CurvePolygon | 4326 |     2
</pre></div><div class="refsection" title="関連情報"><a name="id286994167"></a><h2>関連情報</h2><p><a class="xref" href="#DropGeometryColumn" title="DropGeometryColumn">DropGeometryColumn</a>, <a class="xref" href="#DropGeometryTable" title="DropGeometryTable">DropGeometryTable</a>, <a class="xref" href="#geometry_columns" title="4.3.2. GEOMETRY_COLUMNSビュー">「GEOMETRY_COLUMNSビュー」</a>, <a class="xref" href="#Manual_Register_Spatial_Column" title="4.3.4. 手動でジオメトリカラムをgeometry_columnsに登録する">「手動でジオメトリカラムをgeometry_columnsに登録する」</a></p></div></div><div class="refentry" title="DropGeometryColumn"><div class="refentry.separator"><hr></div><a name="DropGeometryColumn"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>DropGeometryColumn ? ジオメトリカラムを空間テーブルから除去します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">DropGeometryColumn</b>(</code>varchar 
			<var class="pdparam">table_name</var>, varchar 
			<var class="pdparam">column_name</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">DropGeometryColumn</b>(</code>varchar 
			<var class="pdparam">schema_name</var>, varchar 
			<var class="pdparam">table_name</var>, varchar 
			<var class="pdparam">column_name</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">DropGeometryColumn</b>(</code>varchar 
			<var class="pdparam">catalog_name</var>, varchar 
			<var class="pdparam">schema_name</var>, varchar 
			<var class="pdparam">table_name</var>, varchar 
			<var class="pdparam">column_name</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id286994349"></a><h2>説明</h2><p>ジオメトリカラムを空間テーブルから除去します。schema_nameはgeometry_columnsテーブルの該当行のf_table_schemaフィールドと一致しなければならないことにご注意ください</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>変更: 2.0.0では、この関数は後方互換のためのものです。geometry_columnsは現在はシステムカタログに対するビューですので、他のテーブルのカラムと同じように<code class="code">ALTER TABLE</code>を使った削除が可能です。</p></td></tr></table></div></div><div class="refsection" title="例"><a name="id286994405"></a><h2>例</h2><pre class="programlisting">
			SELECT DropGeometryColumn ('my_schema','my_spatial_table','geom');
			----RESULT output ---
			                  dropgeometrycolumn
------------------------------------------------------
 my_schema.my_spatial_table.geom effectively removed.
 
-- PostGIS 2.0以上では標準的なALTER TABLEと上の例とは等価です。
-- 両方ともgeometry_columnsの登録を抹消します。
ALTER TABLE my_schema.my_spatial_table DROP column geom;
		</pre></div><div class="refsection" title="関連情報"><a name="id286994416"></a><h2>関連情報</h2><p><a class="xref" href="#AddGeometryColumn" title="AddGeometryColumn">AddGeometryColumn</a>, <a class="xref" href="#DropGeometryTable" title="DropGeometryTable">DropGeometryTable</a>, <a class="xref" href="#geometry_columns" title="4.3.2. GEOMETRY_COLUMNSビュー">「GEOMETRY_COLUMNSビュー」</a></p></div></div><div class="refentry" title="DropGeometryTable"><div class="refentry.separator"><hr></div><a name="DropGeometryTable"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>DropGeometryTable ? テーブルとgeometry_columnsの当該テーブルへの参照の全てを削除します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">DropGeometryTable</b>(</code>varchar 
			<var class="pdparam">table_name</var><code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">DropGeometryTable</b>(</code>varchar 
			<var class="pdparam">schema_name</var>, varchar 
			<var class="pdparam">table_name</var><code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">DropGeometryTable</b>(</code>varchar 
			<var class="pdparam">catalog_name</var>, varchar 
			<var class="pdparam">schema_name</var>, varchar 
			<var class="pdparam">table_name</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id286994535"></a><h2>説明</h2><p>テーブルとgeometry_columnsの当該テーブルへの参照の全てを削除します。スキーマ対応版PostgreSQLではスキーマが与えられない場合はcurrent_schema()を使います。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>変更: 2.0.0では、この関数は後方互換のためのものです。geometry_columnsは現在はシステムカタログに対するビューですので、他のテーブルのカラムと同じように<code class="code">DROP TABLE</code>を使った削除が可能です。</p></td></tr></table></div></div><div class="refsection" title="例"><a name="id286994554"></a><h2>例</h2><pre class="programlisting">SELECT DropGeometryTable ('my_schema','my_spatial_table');
---- 結果出力 ---
my_schema.my_spatial_table dropped.
			
-- 上の例は次の例と等価です --
DROP TABLE my_schema.my_spatial_table;
		</pre></div><div class="refsection" title="関連情報"><a name="id286994565"></a><h2>関連情報</h2><p><a class="xref" href="#AddGeometryColumn" title="AddGeometryColumn">AddGeometryColumn</a>, <a class="xref" href="#DropGeometryColumn" title="DropGeometryColumn">DropGeometryColumn</a>, <a class="xref" href="#geometry_columns" title="4.3.2. GEOMETRY_COLUMNSビュー">「GEOMETRY_COLUMNSビュー」</a></p></div></div><div class="refentry" title="PostGIS_Full_Version"><div class="refentry.separator"><hr></div><a name="PostGIS_Full_Version"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>PostGIS_Full_Version ? 完全なPostGISのバージョン情報とコンフィギュレーション情報を報告します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">PostGIS_Full_Version</b>(</code><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id286994615"></a><h2>説明</h2><p>完全なPostGISのバージョン情報とコンフィギュレーション情報を報告します。ライブラリとスクリプトとの間の同期について情報を提供して、必要に応じてアップグレードの提案に関する情報を提供します。</p></div><div class="refsection" title="例"><a name="id286994625"></a><h2>例</h2><pre class="programlisting">SELECT PostGIS_Full_Version();
							   postgis_full_version
----------------------------------------------------------------------------------
 POSTGIS="1.3.3" GEOS="3.1.0-CAPI-1.5.0" PROJ="Rel. 4.4.9, 29 Oct 2004" USE_STATS
(1 row)</pre></div><div class="refsection" title="関連情報"><a name="id286994635"></a><h2>関連情報</h2><p>
		<a class="xref" href="#upgrading" title="2.9. アップグレード">「アップグレード」</a>,
		<a class="xref" href="#PostGIS_GEOS_Version" title="PostGIS_GEOS_Version">PostGIS_GEOS_Version</a>,
		<a class="xref" href="#PostGIS_Lib_Version" title="PostGIS_Lib_Version">PostGIS_Lib_Version</a>,
		<a class="xref" href="#PostGIS_LibXML_Version" title="PostGIS_LibXML_Version">PostGIS_LibXML_Version</a>,
		<a class="xref" href="#PostGIS_PROJ_Version" title="PostGIS_PROJ_Version">PostGIS_PROJ_Version</a>,
		<a class="xref" href="#PostGIS_Version" title="PostGIS_Version">PostGIS_Version</a>
		</p></div></div><div class="refentry" title="PostGIS_GEOS_Version"><div class="refentry.separator"><hr></div><a name="PostGIS_GEOS_Version"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>PostGIS_GEOS_Version ? GEOSライブラリのバージョン番号を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">PostGIS_GEOS_Version</b>(</code><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id286994698"></a><h2>説明</h2><p>GEOSライブラリのバージョン番号を返します。GEOS対応が有効でない場合は<code class="varname">NULL</code>を返します。</p></div><div class="refsection" title="例"><a name="id286994746"></a><h2>例</h2><pre class="programlisting">SELECT PostGIS_GEOS_Version();
 postgis_geos_version
----------------------
 3.1.0-CAPI-1.5.0
(1 row)</pre></div><div class="refsection" title="関連情報"><a name="id286994757"></a><h2>関連情報</h2><p><a class="xref" href="#PostGIS_Full_Version" title="PostGIS_Full_Version">PostGIS_Full_Version</a>, <a class="xref" href="#PostGIS_Lib_Version" title="PostGIS_Lib_Version">PostGIS_Lib_Version</a>, <a class="xref" href="#PostGIS_LibXML_Version" title="PostGIS_LibXML_Version">PostGIS_LibXML_Version</a>, <a class="xref" href="#PostGIS_PROJ_Version" title="PostGIS_PROJ_Version">PostGIS_PROJ_Version</a>, <a class="xref" href="#PostGIS_Version" title="PostGIS_Version">PostGIS_Version</a></p></div></div><div class="refentry" title="PostGIS_LibXML_Version"><div class="refentry.separator"><hr></div><a name="PostGIS_LibXML_Version"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>PostGIS_LibXML_Version ? LibXML2ライブラリのバージョン番号を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">PostGIS_LibXML_Version</b>(</code><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id286994848"></a><h2>説明</h2><p>LibXML2ライブラリのバージョン番号を返します。</p><p>初出: 1.5</p></div><div class="refsection" title="例"><a name="id286994860"></a><h2>例</h2><pre class="programlisting">SELECT PostGIS_LibXML_Version();
 postgis_libxml_version
----------------------
 2.7.6
(1 row)</pre></div><div class="refsection" title="関連情報"><a name="id286994871"></a><h2>関連情報</h2><p><a class="xref" href="#PostGIS_Full_Version" title="PostGIS_Full_Version">PostGIS_Full_Version</a>, <a class="xref" href="#PostGIS_Lib_Version" title="PostGIS_Lib_Version">PostGIS_Lib_Version</a>, <a class="xref" href="#PostGIS_PROJ_Version" title="PostGIS_PROJ_Version">PostGIS_PROJ_Version</a>, <a class="xref" href="#PostGIS_GEOS_Version" title="PostGIS_GEOS_Version">PostGIS_GEOS_Version</a>, <a class="xref" href="#PostGIS_Version" title="PostGIS_Version">PostGIS_Version</a></p></div></div><div class="refentry" title="PostGIS_Lib_Build_Date"><div class="refentry.separator"><hr></div><a name="PostGIS_Lib_Build_Date"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>PostGIS_Lib_Build_Date ? PostGISライブラリのビルド日付を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">PostGIS_Lib_Build_Date</b>(</code><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id286994929"></a><h2>説明</h2><p>PostGISライブラリのビルド日付を返します。</p></div><div class="refsection" title="例"><a name="id286994939"></a><h2>例</h2><pre class="programlisting">SELECT PostGIS_Lib_Build_Date();
 postgis_lib_build_date
------------------------
 2008-06-21 17:53:21
(1 row)</pre></div></div><div class="refentry" title="PostGIS_Lib_Version"><div class="refentry.separator"><hr></div><a name="PostGIS_Lib_Version"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>PostGIS_Lib_Version ? PostGISのバージョン番号を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">PostGIS_Lib_Version</b>(</code><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id286994983"></a><h2>説明</h2><p>PostGISのバージョン番号を返します。</p></div><div class="refsection" title="例"><a name="id286994993"></a><h2>例</h2><pre class="programlisting">SELECT PostGIS_Lib_Version();
 postgis_lib_version
---------------------
 1.3.3
(1 row)</pre></div><div class="refsection" title="関連情報"><a name="id286995003"></a><h2>関連情報</h2><p><a class="xref" href="#PostGIS_Full_Version" title="PostGIS_Full_Version">PostGIS_Full_Version</a>, <a class="xref" href="#PostGIS_GEOS_Version" title="PostGIS_GEOS_Version">PostGIS_GEOS_Version</a>,  <a class="xref" href="#PostGIS_LibXML_Version" title="PostGIS_LibXML_Version">PostGIS_LibXML_Version</a>, <a class="xref" href="#PostGIS_PROJ_Version" title="PostGIS_PROJ_Version">PostGIS_PROJ_Version</a>, <a class="xref" href="#PostGIS_Version" title="PostGIS_Version">PostGIS_Version</a></p></div></div><div class="refentry" title="PostGIS_PROJ_Version"><div class="refentry.separator"><hr></div><a name="PostGIS_PROJ_Version"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>PostGIS_PROJ_Version ? PROJ4のバージョン番号を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">PostGIS_PROJ_Version</b>(</code><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id286995060"></a><h2>説明</h2><p>PROJ4のバージョン番号を返します。PROJ4対応が有効でない場合は<code class="varname">NULL</code>を返します。</p></div><div class="refsection" title="例"><a name="id286995073"></a><h2>例</h2><pre class="programlisting">SELECT PostGIS_PROJ_Version();
  postgis_proj_version
-------------------------
 Rel. 4.4.9, 29 Oct 2004
(1 row)</pre></div><div class="refsection" title="関連情報"><a name="id286995084"></a><h2>関連情報</h2><p><a class="xref" href="#PostGIS_Full_Version" title="PostGIS_Full_Version">PostGIS_Full_Version</a>, <a class="xref" href="#PostGIS_GEOS_Version" title="PostGIS_GEOS_Version">PostGIS_GEOS_Version</a>,  <a class="xref" href="#PostGIS_Lib_Version" title="PostGIS_Lib_Version">PostGIS_Lib_Version</a>, <a class="xref" href="#PostGIS_LibXML_Version" title="PostGIS_LibXML_Version">PostGIS_LibXML_Version</a>, <a class="xref" href="#PostGIS_Version" title="PostGIS_Version">PostGIS_Version</a></p></div></div><div class="refentry" title="PostGIS_Scripts_Build_Date"><div class="refentry.separator"><hr></div><a name="PostGIS_Scripts_Build_Date"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>PostGIS_Scripts_Build_Date ? PostGISスクリプトのビルド日付を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">PostGIS_Scripts_Build_Date</b>(</code><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id286995142"></a><h2>説明</h2><p>PostGISスクリプトのビルド日付を返します。</p><p>初出: 1.0.0RC1</p></div><div class="refsection" title="例"><a name="id286995156"></a><h2>例</h2><pre class="programlisting">SELECT PostGIS_Scripts_Build_Date();
  postgis_scripts_build_date
-------------------------
 2007-08-18 09:09:26
(1 row)</pre></div><div class="refsection" title="関連情報"><a name="id286995168"></a><h2>関連情報</h2><p><a class="xref" href="#PostGIS_Full_Version" title="PostGIS_Full_Version">PostGIS_Full_Version</a>, <a class="xref" href="#PostGIS_GEOS_Version" title="PostGIS_GEOS_Version">PostGIS_GEOS_Version</a>, <a class="xref" href="#PostGIS_Lib_Version" title="PostGIS_Lib_Version">PostGIS_Lib_Version</a>, <a class="xref" href="#PostGIS_LibXML_Version" title="PostGIS_LibXML_Version">PostGIS_LibXML_Version</a>, <a class="xref" href="#PostGIS_Version" title="PostGIS_Version">PostGIS_Version</a></p></div></div><div class="refentry" title="PostGIS_Scripts_Installed"><div class="refentry.separator"><hr></div><a name="PostGIS_Scripts_Installed"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>PostGIS_Scripts_Installed ? このデータベースにインストールしたPostGISスクリプトのバージョン番号を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">PostGIS_Scripts_Installed</b>(</code><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id286995532"></a><h2>説明</h2><p>このデータベースにインストールしたPostGISスクリプトのバージョン番号を返します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数の出力<a class="xref" href="#PostGIS_Scripts_Released" title="PostGIS_Scripts_Released">PostGIS_Scripts_Released</a>と合わない場合、既存のデータベースの確実なアップグレードに失敗しているかも知れません。詳細情報については<a class="link" href="#upgrading" title="2.9. アップグレード">アップグレード</a>をご覧ください。</p></td></tr></table></div><p>初出: 0.9.0</p></div><div class="refsection" title="例"><a name="id286995561"></a><h2>例</h2><pre class="programlisting">SELECT PostGIS_Scripts_Installed();
  postgis_scripts_installed
-------------------------
 1.5.0SVN
(1 row)</pre></div><div class="refsection" title="関連情報"><a name="id286995572"></a><h2>関連情報</h2><p><a class="xref" href="#PostGIS_Full_Version" title="PostGIS_Full_Version">PostGIS_Full_Version</a>, <a class="xref" href="#PostGIS_Scripts_Released" title="PostGIS_Scripts_Released">PostGIS_Scripts_Released</a>, <a class="xref" href="#PostGIS_Version" title="PostGIS_Version">PostGIS_Version</a></p></div></div><div class="refentry" title="PostGIS_Scripts_Released"><div class="refentry.separator"><hr></div><a name="PostGIS_Scripts_Released"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>PostGIS_Scripts_Released ? インストールしたPostGISライブラリとともにリリースされたpostgis.sqlスクリプトのバージョン番号を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">PostGIS_Scripts_Released</b>(</code><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id286995621"></a><h2>説明</h2><p>インストールしたPostGISライブラリとともにリリースされたpostgis.sqlスクリプトのバージョン番号を返します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>1.1.0からこの関数は<a class="xref" href="#PostGIS_Lib_Version" title="PostGIS_Lib_Version">PostGIS_Lib_Version</a>と同じ値を返すようになりました。後方互換のためです。</p></td></tr></table></div><p>初出: 0.9.0</p></div><div class="refsection" title="例"><a name="id286995644"></a><h2>例</h2><pre class="programlisting">SELECT PostGIS_Scripts_Released();
  postgis_scripts_released
-------------------------
 1.3.4SVN
(1 row)</pre></div><div class="refsection" title="関連情報"><a name="id286995655"></a><h2>関連情報</h2><p><a class="xref" href="#PostGIS_Full_Version" title="PostGIS_Full_Version">PostGIS_Full_Version</a>, <a class="xref" href="#PostGIS_Scripts_Installed" title="PostGIS_Scripts_Installed">PostGIS_Scripts_Installed</a>, <a class="xref" href="#PostGIS_Lib_Version" title="PostGIS_Lib_Version">PostGIS_Lib_Version</a></p></div></div><div class="refentry" title="PostGIS_Version"><div class="refentry.separator"><hr></div><a name="PostGIS_Version"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>PostGIS_Version ? PostGISバージョン番号とコンパイルオプションを返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">PostGIS_Version</b>(</code><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id286995705"></a><h2>説明</h2><p>PostGISバージョン番号とコンパイルオプションを返します。</p></div><div class="refsection" title="例"><a name="id286995715"></a><h2>例</h2><pre class="programlisting">SELECT PostGIS_Version();
			postgis_version
---------------------------------------
 1.3 USE_GEOS=1 USE_PROJ=1 USE_STATS=1
(1 row)</pre></div><div class="refsection" title="関連情報"><a name="id286995725"></a><h2>関連情報</h2><p><a class="xref" href="#PostGIS_Full_Version" title="PostGIS_Full_Version">PostGIS_Full_Version</a>, <a class="xref" href="#PostGIS_GEOS_Version" title="PostGIS_GEOS_Version">PostGIS_GEOS_Version</a>, <a class="xref" href="#PostGIS_Lib_Version" title="PostGIS_Lib_Version">PostGIS_Lib_Version</a>, <a class="xref" href="#PostGIS_LibXML_Version" title="PostGIS_LibXML_Version">PostGIS_LibXML_Version</a>, <a class="xref" href="#PostGIS_PROJ_Version" title="PostGIS_PROJ_Version">PostGIS_PROJ_Version</a></p></div></div><div class="refentry" title="Populate_Geometry_Columns"><div class="refentry.separator"><hr></div><a name="Populate_Geometry_Columns"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Populate_Geometry_Columns ? ジオメトリカラムが型修飾子で定義されるか、適切な制約を持つことを確実にします。ジオメトリカラムが<code class="varname">geometry_columns</code>に正しく登録されることを確実にします。デフォルトでは、型修飾子によらないジオメトリカラムを型修飾子によるジオメトリカラムに変換します。以前の挙動にするには<code class="varname">use_typmod=false</code>とします。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">Populate_Geometry_Columns</b>(</code>boolean  <var class="pdparam">use_typmod=true</var><code>)</code>;</p><p><code class="funcdef">int <b class="fsfunc">Populate_Geometry_Columns</b>(</code>oid <var class="pdparam">relation_oid</var>, boolean  <var class="pdparam">use_typmod=true</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id286995821"></a><h2>説明</h2><p>ジオメトリカラムが<code class="varname">geometry_columns</code>に正しく登録されるために、ジオメトリカラムが型修飾子で定義されるか、適切な制約を持つことを確実にします。</p>

ことを確実にします。デフォルトでは、型修飾子によらないジオメトリカラムを型修飾子によるジオメトリカラムに変換します。以前の挙動にするには<code class="varname">use_typmod=false</code>とします。
		
		<p>古い制約をチェックする挙動は現在も対応しています。後方互換のためであるのと、子テーブルが異なるジオメトリタイプを持ち得るテーブル継承といった場合に使われます。古い挙動が必要な場合には、新しいオプション引数について<code class="varname">use_typmod=false</code>を渡します。これにより型修飾子を使わないジオメトリカラムの作成が行われ、3つの定義された制約を持ちます。特に、これはテーブルに属するあらゆるジオメトリカラムが少なくとも次の3つの制約を持つことを意味します。</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><code class="varname">enforce_dims_the_geom</code> - あらゆるジオメトリが同じ次元を持つことを確実にします(<a class="xref" href="#ST_NDims" title="ST_NDims">ST_NDims</a>をご覧下さい)</p></li><li class="listitem"><p><code class="varname">enforce_geotype_the_geom</code> - あらゆるジオメトリが同じ型を持つことを確実にします(<a class="xref" href="#GeometryType" title="GeometryType">GeometryType</a>をご覧下さい)</p></li><li class="listitem"><p><code class="varname">enforce_srid_the_geom</code> - あらゆるジオメトリが同じ投影法になることを確実にします(<a class="xref" href="#ST_SRID" title="ST_SRID">ST_SRID</a>をご覧下さい)</p></li></ul></div><p>テーブルに<code class="varname">oid</code>がある場合には、この関数はテーブルのジオメトリカラム全てについて、SRIDと次元とジオメトリタイプを判定して、必要に応じて制約を追加しようとします。
成功した場合には、geometry_columnsに適切な行が追加され、その他の場合には、例外が捕まえられ、問題を記述したエラーが通知されます。</p><p>ビューの<code class="varname">oid</code>がある場合、テーブルの場合と同じで、SIRDと次元とジオメトリタイプを判定して、適切なエントリを<code class="varname">geometry_columns</code>テーブルに挿入しますが、制約の追加はされません。</p><p>パラメタの無い版は、geometry_columnsの行を削除したうえで、全ての空間テーブルと空間ビューについて再挿入し、適切な空間制約をテーブルに追加する、パラメタ付き版の単純なラッパです。パラメタ無し版は、検出したジオメトリカラムの数の要約と<code class="varname">geometry_columns</code>に挿入された行の数とを返します。パラメタ付き版は単純に<code class="varname">geometry_columns</code>に挿入された行の数を返します。</p><p>初出: 1.4.0</p><p>変更: 2.0.0では、ジオメトリタイプへの制約をチェックする替りに型修飾子を使用しています。<code class="varname">use_typmod</code>をfalseに設定して使うことで、制約をチェックすることができます。</p><p>機能強化: 2.0.0では、<code class="varname">use_typmod</code>引数が導入されました。カラムが型修飾子で作られるか制約チェックで作られるかの制御ができます。</p></div><div class="refsection" title="例"><a name="id286995927"></a><h2>例</h2><pre class="programlisting">
CREATE TABLE public.myspatial_table(gid serial, geom geometry);
INSERT INTO myspatial_table(geom) VALUES(ST_GeomFromText('LINESTRING(1 2, 3 4)',4326) );
-- 型修飾子を使います。データが存在しないと動作しません。
SELECT Populate_Geometry_Columns('public.myspatial_table'::regclass);

populate_geometry_columns
--------------------------
                        1
                        
                        
\d myspatial_table

                                   Table "public.myspatial_table"
 Column |           Type            |                           Modifiers                           
--------+---------------------------+---------------------------------------------------------------
 gid    | integer                   | not null default nextval('myspatial_table_gid_seq'::regclass)
 geom   | geometry(LineString,4326) | 
</pre><pre class="programlisting">
-- 型修飾子を使っていなくて既に制約を持っている場合に
-- ジオメトリカラムを変更して制約を使うようにします。
-- データが存在しないと動作しません。
CREATE TABLE public.myspatial_table_cs(gid serial, geom geometry);
INSERT INTO myspatial_table_cs(geom) VALUES(ST_GeomFromText('LINESTRING(1 2, 3 4)',4326) );
SELECT Populate_Geometry_Columns('public.myspatial_table_cs'::regclass, false);
populate_geometry_columns
--------------------------
                        1
\d myspatial_table_cs

                          Table "public.myspatial_table_cs"
 Column |   Type   |                            Modifiers                             
--------+----------+------------------------------------------------------------------
 gid    | integer  | not null default nextval('myspatial_table_cs_gid_seq'::regclass)
 geom   | geometry | 
Check constraints:
    "enforce_dims_geom" CHECK (st_ndims(geom) = 2)
    "enforce_geotype_geom" CHECK (geometrytype(geom) = 'LINESTRING'::text OR geom IS NULL)
    "enforce_srid_geom" CHECK (st_srid(geom) = 4326)</pre></div></div><div class="refentry" title="UpdateGeometrySRID"><div class="refentry.separator"><hr></div><a name="UpdateGeometrySRID"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>UpdateGeometrySRID ? ジオメトリカラムの全てのフィーチャーのSRID、geometry_columnsメタデータとSRIDテーブル制約を更新します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">UpdateGeometrySRID</b>(</code>varchar 
			<var class="pdparam">table_name</var>, varchar 
			<var class="pdparam">column_name</var>, integer 
			<var class="pdparam">srid</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">UpdateGeometrySRID</b>(</code>varchar 
			<var class="pdparam">schema_name</var>, varchar 
			<var class="pdparam">table_name</var>, varchar 
			<var class="pdparam">column_name</var>, integer 
			<var class="pdparam">srid</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">UpdateGeometrySRID</b>(</code>varchar 
			<var class="pdparam">catalog_name</var>, varchar 
			<var class="pdparam">schema_name</var>, varchar 
			<var class="pdparam">table_name</var>, varchar 
			<var class="pdparam">column_name</var>, integer 
			<var class="pdparam">srid</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id286996133"></a><h2>説明</h2><p>ジオメトリカラムの全てのフィーチャーのSRID、geometry_columnsメタデータとSRIDテーブル制約を更新します。スキーマ対応版pgsqlでは、スキーマが提供されていない場合には、この関数はcurrent_schema()を使うことにご注意下さい。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p></div><div class="refsection" title="関連情報"><a name="id286996165"></a><h2>関連情報</h2><p><a class="xref" href="#ST_SetSRID" title="ST_SetSRID">ST_SetSRID</a></p></div></div></div><div class="sect1" title="8.3. ジオメトリ コンストラクタ"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Geometry_Constructors"></a>8.3. ジオメトリ コンストラクタ</h2></div></div></div><div class="toc"><dl><dt><span class="refentrytitle"><a href="#ST_BdPolyFromText">ST_BdPolyFromText</a></span><span class="refpurpose"> ? マルチラインストリングのWell-Known Text表現による、閉じたラインストリングの任意のコレクションからポリゴンを生成します。</span></dt><dt><span class="refentrytitle"><a href="#ST_BdMPolyFromText">ST_BdMPolyFromText</a></span><span class="refpurpose"> ? マルチラインストリングのWell-Known Text表現による、閉じたラインストリングの任意のコレクションからマルチポリゴンを構築します。</span></dt><dt><span class="refentrytitle"><a href="#ST_GeogFromText">ST_GeogFromText</a></span><span class="refpurpose"> ? Well-Known Text表現または拡張WKTから指定したジオグラフィ値を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_GeographyFromText">ST_GeographyFromText</a></span><span class="refpurpose"> ? Well-Known Text表現または拡張WKTから指定したジオグラフィ値を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_GeogFromWKB">ST_GeogFromWKB</a></span><span class="refpurpose"> ? Well-Known Binaryジオメトリ表現(WKB)または拡張WKB(EWKB)からジオグラフィインスタンスを生成します。</span></dt><dt><span class="refentrytitle"><a href="#ST_GeomCollFromText">ST_GeomCollFromText</a></span><span class="refpurpose"> ? ジオメトリのコレクションをWKTのコレクションと与えられたSRIDから生成します。SRIDが与えられていない場合は-1とします。</span></dt><dt><span class="refentrytitle"><a href="#ST_GeomFromEWKB">ST_GeomFromEWKB</a></span><span class="refpurpose"> ? 拡張Well-Known Binary表現(EWKB)から指定したST_Geometry値を返します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_GeomFromEWKT">ST_GeomFromEWKT</a></span><span class="refpurpose"> ? 拡張Well-Known Text表現(EWKT)から指定されたST_Geometry値を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_GeometryFromText">ST_GeometryFromText</a></span><span class="refpurpose"> ? Well-Knwon Text表現(WKT)から指定したST_Geometry値を返します。これはST_GeomFromTextの別名です。</span></dt><dt><span class="refentrytitle"><a href="#ST_GeomFromGML">ST_GeomFromGML</a></span><span class="refpurpose"> ? ジオメトリのGML表現を入力とし、PostGISジオメトリオブジェクトを出力します。</span></dt><dt><span class="refentrytitle"><a href="#ST_GeomFromGeoJSON">ST_GeomFromGeoJSON</a></span><span class="refpurpose"> ? ジオメトリのGeoJSON表現を入力として、PostGISジオメトリオブジェクトを出力します。</span></dt><dt><span class="refentrytitle"><a href="#ST_GeomFromKML">ST_GeomFromKML</a></span><span class="refpurpose"> ? ジオメトリのKML表現の入力をとり、PostGISジオメトリオブジェクトを出力します。</span></dt><dt><span class="refentrytitle"><a href="#ST_GMLToSQL">ST_GMLToSQL</a></span><span class="refpurpose"> ? GML表現から指定したST_Geometry値を返します。これはST_GeomFromGMLの別名です。</span></dt><dt><span class="refentrytitle"><a href="#ST_GeomFromText">ST_GeomFromText</a></span><span class="refpurpose"> ? Well-Known Text表現(WKT)から指定したST_Geometryを返します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_GeomFromWKB">ST_GeomFromWKB</a></span><span class="refpurpose"> ? Well-Knwon Binaryジオメトリ表現(WKB)と任意パラメタのSRIDからジオメトリインスタンスを生成します。</span></dt><dt><span class="refentrytitle"><a href="#ST_LineFromMultiPoint">ST_LineFromMultiPoint</a></span><span class="refpurpose"> ? MULTIPOINTジオメトリからLINESTRINGを生成します。</span></dt><dt><span class="refentrytitle"><a href="#ST_LineFromText">ST_LineFromText</a></span><span class="refpurpose"> ? WKT表現と与えられたSRIDからジオメトリを生成します。SRIDが与えられていない場合は-1(不明)となります。</span></dt><dt><span class="refentrytitle"><a href="#ST_LineFromWKB">ST_LineFromWKB</a></span><span class="refpurpose"> ? WKB表現と与えられたSRIDから<code class="varname">LINESTRING</code>を生成します。</span></dt><dt><span class="refentrytitle"><a href="#ST_LinestringFromWKB">ST_LinestringFromWKB</a></span><span class="refpurpose"> ? WKB表現と与えられたSRIDからジオメトリを生成します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_MakeBox2D">ST_MakeBox2D</a></span><span class="refpurpose"> ? 与えられたポイントジオメトリから定義されるBOX2Dを生成します。</span></dt><dt><span class="refentrytitle"><a href="#ST_3DMakeBox">ST_3DMakeBox</a></span><span class="refpurpose"> ? 与えられた3次元ポイントジオメトリから定義されるBOX3Dを生成します。</span></dt><dt><span class="refentrytitle"><a href="#ST_MakeLine">ST_MakeLine</a></span><span class="refpurpose"> ? ポイントまたはラインジオメトリからラインストリングを生成します。</span></dt><dt><span class="refentrytitle"><a href="#ST_MakeEnvelope">ST_MakeEnvelope</a></span><span class="refpurpose"> ? 与えられた最小値と最大値から長方形ポリゴンを生成します。入力値はSRIDで指定された空間参照系でなければなりません。</span></dt><dt><span class="refentrytitle"><a href="#ST_MakePolygon">ST_MakePolygon</a></span><span class="refpurpose"> ? 与えられた外環で形成されるポリゴンを生成します。入力ジオメトリは閉じたラインストリングでなければなりません。</span></dt><dt><span class="refentrytitle"><a href="#ST_MakePoint">ST_MakePoint</a></span><span class="refpurpose"> ? 2次元、XYZの3次元、4次元のポイントジオメトリを生成します。</span></dt><dt><span class="refentrytitle"><a href="#ST_MakePointM">ST_MakePointM</a></span><span class="refpurpose"> ? X, Y, M座標を持つポイントジオメトリを生成します。</span></dt><dt><span class="refentrytitle"><a href="#ST_MLineFromText">ST_MLineFromText</a></span><span class="refpurpose"> ? WKT表現から指定したST_MultiLineString値を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_MPointFromText">ST_MPointFromText</a></span><span class="refpurpose"> ? Well-Known Text(WKT)表現と与えられたSRIDからジオメトリを生成します。SRIDを与えない場合は-1(不明)となります。</span></dt><dt><span class="refentrytitle"><a href="#ST_MPolyFromText">ST_MPolyFromText</a></span><span class="refpurpose"> ? Well-Known Text(WKT)表現と与えられたSRIDからマルチポリゴンを生成します。SRIDを与えない場合は-1(不明)となります。</span></dt><dt><span class="refentrytitle"><a href="#ST_Point">ST_Point</a></span><span class="refpurpose"> ? 与えられた座標値のST_Pointを返します。ST_MakePointのOGC別名です。</span></dt><dt><span class="refentrytitle"><a href="#ST_PointFromText">ST_PointFromText</a></span><span class="refpurpose"> ? WKTと与えられたSRIDからポイントジオメトリを生成します。SRIDが与えられていない場合は-1(不明)とします。</span></dt><dt><span class="refentrytitle"><a href="#ST_PointFromWKB">ST_PointFromWKB</a></span><span class="refpurpose"> ? WKBと与えられたSRIDからジオメトリを生成します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Polygon">ST_Polygon</a></span><span class="refpurpose"> ? 指定されたラインストリングとSRIDからポリゴンを生成します。</span></dt><dt><span class="refentrytitle"><a href="#ST_PolygonFromText">ST_PolygonFromText</a></span><span class="refpurpose"> ? WKTと与えられたSRIDからジオメトリを生成します。SRIDが与えられていない場合は-1(不明)とします。</span></dt><dt><span class="refentrytitle"><a href="#ST_WKBToSQL">ST_WKBToSQL</a></span><span class="refpurpose"> ? Well-Known Binary表現(WKB)からST_Geometry値を生成します。これはSRIDを取らないST_GeomFromWKBの別名です。</span></dt><dt><span class="refentrytitle"><a href="#ST_WKTToSQL">ST_WKTToSQL</a></span><span class="refpurpose"> ? Well-Known Text表現(WKT)からST_Geometry値を生成します。これはSRIDを取らないST_GeomFromTextの別名です。</span></dt></dl></div><div class="refentry" title="ST_BdPolyFromText"><a name="ST_BdPolyFromText"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_BdPolyFromText ? マルチラインストリングのWell-Known Text表現による、閉じたラインストリングの任意のコレクションからポリゴンを生成します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_BdPolyFromText</b>(</code>text  <var class="pdparam">WKT</var>, integer  <var class="pdparam">srid</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id286992805"></a><h2>説明</h2><p>マルチラインストリングのWell-Known Text表現による、閉じたラインストリングの任意のコレクションからポリゴンを構築します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>WKTがMULTILINESTRINGでない場合には、エラーが投げられます。出力がMULTIPOLYGONになる場合には、エラーが投げられますが、この場合はST_BdMPolyFromTextを使うかPostGIS独特のアプローチとしてST_BuildArea()をご覧ください。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です s3.2.6.2</p><p>初出: 1.1.0 - GEOS 2.1.0以降が必要です。</p></div><div class="refsection" title="例"><a name="id286992841"></a><h2>例</h2><pre class="programlisting">Forthcoming</pre></div><div class="refsection" title="関連情報"><a name="id286992852"></a><h2>関連情報</h2><p><a class="xref" href="#ST_BuildArea" title="ST_BuildArea">ST_BuildArea</a>, <a class="xref" href="#ST_BdMPolyFromText" title="ST_BdMPolyFromText">ST_BdMPolyFromText</a></p></div></div><div class="refentry" title="ST_BdMPolyFromText"><div class="refentry.separator"><hr></div><a name="ST_BdMPolyFromText"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_BdMPolyFromText ? マルチラインストリングのWell-Known Text表現による、閉じたラインストリングの任意のコレクションからマルチポリゴンを構築します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_BdMPolyFromText</b>(</code>text  <var class="pdparam">WKT</var>, integer  <var class="pdparam">srid</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id286998682"></a><h2>説明</h2><p>マルチラインストリングのWell-Known Text表現による、閉じたラインストリングの任意のコレクションからマルチポリゴンを構築します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>WKTがMULTILINESTRINGでない場合には、エラーが投げられます。出力が単一のポリゴンであってもマルチポリゴンに強制されます。単一のポリゴンが返って欲しい場合はST_BdPolyFromTextを使うかPostGIS独特のアプローチとして<a class="link" href="#ST_BuildArea" title="ST_BuildArea">ST_BuildArea()</a>をご覧ください。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です s3.2.6.2</p><p>初出: 1.1.0 - GEOS 2.1.0以上が必要です。</p></div><div class="refsection" title="例"><a name="id286998724"></a><h2>例</h2><pre class="programlisting">Forthcoming</pre></div><div class="refsection" title="関連情報"><a name="id286998734"></a><h2>関連情報</h2><p><a class="xref" href="#ST_BuildArea" title="ST_BuildArea">ST_BuildArea</a>, <a class="xref" href="#ST_BdPolyFromText" title="ST_BdPolyFromText">ST_BdPolyFromText</a></p></div></div><div class="refentry" title="ST_GeogFromText"><div class="refentry.separator"><hr></div><a name="ST_GeogFromText"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_GeogFromText ? Well-Known Text表現または拡張WKTから指定したジオグラフィ値を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geography <b class="fsfunc">ST_GeogFromText</b>(</code>text  <var class="pdparam">EWKT</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id286998788"></a><h2>説明</h2><p>Well-Known Text表現または拡張WKTから指定したジオグラフィ値を返します。SRID 4326を仮定します。この関数はST_GeographyFromTextの別名です。</p></div><div class="refsection" title="例"><a name="id286998797"></a><h2>例</h2><pre class="programlisting">
--- 経度緯度座標値からジオグラフィへの変換
ALTER TABLE sometable ADD COLUMN geog geography(POINT,4326);
UPDATE sometable SET geog = ST_GeogFromText('SRID=4326;POINT(' || lon || ' ' || lat || ')');		
			</pre></div><div class="refsection" title="関連情報"><a name="id286998808"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a>, <a class="xref" href="#ST_GeographyFromText" title="ST_GeographyFromText">ST_GeographyFromText</a></p></div></div><div class="refentry" title="ST_GeographyFromText"><div class="refentry.separator"><hr></div><a name="ST_GeographyFromText"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_GeographyFromText ? Well-Known Text表現または拡張WKTから指定したジオグラフィ値を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geography <b class="fsfunc">ST_GeographyFromText</b>(</code>text  <var class="pdparam">EWKT</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id286998861"></a><h2>説明</h2><p>Well-Known Text表現または拡張WKTから指定したジオグラフィ値を返します。SRID 4326を仮定します。</p></div><div class="refsection" title="関連情報"><a name="id286998873"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeogFromText" title="ST_GeogFromText">ST_GeogFromText</a>, <a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a></p></div></div><div class="refentry" title="ST_GeogFromWKB"><div class="refentry.separator"><hr></div><a name="ST_GeogFromWKB"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_GeogFromWKB ? Well-Known Binaryジオメトリ表現(WKB)または拡張WKB(EWKB)からジオグラフィインスタンスを生成します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geography <b class="fsfunc">ST_GeogFromWKB</b>(</code>bytea  <var class="pdparam">geom</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id286998926"></a><h2>説明</h2><p><code class="varname">ST_GeogFromWKB</code>は、ジオメトリのWell-Known Binary表現(WKB)またはPostGIS拡張WKBを得て、適切なジオグラフィ型のインスタンスを生成します。この関数はSQLのジオメトリファクトリの役割を果たします。</p><p>SRIDが指定されていない場合、デフォルトは4326(WGS 84経度緯度)となります。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p></div><div class="refsection" title="例"><a name="id286998951"></a><h2>例</h2><pre class="programlisting">-- bytea表現には1つの\がありますが、テーブル挿入時にエスケープする必要があるので2つになります。
SELECT ST_AsText(
ST_GeogFromWKB(E'\\001\\002\\000\\000\\000\\002\\000\\000\\000\\037\\205\\353Q\\270~\\\\\\300\\323Mb\\020X\\231C@\\020X9\\264\\310~\\\\\\300)\\\\\\217\\302\\365\\230C@')
);
					  st_astext
------------------------------------------------------
 LINESTRING(-113.98 39.198,-113.981 39.195)
(1 row)

</pre></div><div class="refsection" title="関連情報"><a name="id286998962"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeogFromText" title="ST_GeogFromText">ST_GeogFromText</a>, <a class="xref" href="#ST_AsBinary" title="ST_AsBinary">ST_AsBinary</a></p></div></div><div class="refentry" title="ST_GeomCollFromText"><div class="refentry.separator"><hr></div><a name="ST_GeomCollFromText"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_GeomCollFromText ? ジオメトリのコレクションをWKTのコレクションと与えられたSRIDから生成します。SRIDが与えられていない場合は-1とします。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_GeomCollFromText</b>(</code>text  <var class="pdparam">WKT</var>, integer  <var class="pdparam">srid</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_GeomCollFromText</b>(</code>text  <var class="pdparam">WKT</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id286999111"></a><h2>説明</h2><p>ジオメトリのコレクションをWell-Kown-Text(WKT)表現のコレクションと与えられたSRIDから生成します。SRIDが与えられていない場合は-1とします。</p><p>OGC SPEC 3.2.6.2 - option SRID is from the conformance suite</p><p>WKTがGEOMETRYCOLLECTIONでない場合には、NULLを返します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>全てのWKTジオメトリがジオメトリコレクションであると絶対的な確信を持てる場合は、この関数は使わないでください。付加的な評価ステップが追加されるのでST_GeomFromTextより遅いです。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です s3.2.6.2</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。</p></div><div class="refsection" title="例"><a name="id286999160"></a><h2>例</h2><pre class="programlisting">SELECT ST_GeomCollFromText('GEOMETRYCOLLECTION(POINT(1 2),LINESTRING(1 2, 3 4))');
</pre></div><div class="refsection" title="関連情報"><a name="id286999173"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a>, <a class="xref" href="#ST_SRID" title="ST_SRID">ST_SRID</a></p></div></div><div class="refentry" title="ST_GeomFromEWKB"><div class="refentry.separator"><hr></div><a name="ST_GeomFromEWKB"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_GeomFromEWKB ? 拡張Well-Known Binary表現(EWKB)から指定したST_Geometry値を返します。 </p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_GeomFromEWKB</b>(</code>bytea  <var class="pdparam">EWKB</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id286999226"></a><h2>説明</h2><p>拡張Well-Known Binary表現(EWKB)からPostGISのST_Geometryオブジェクトを構築します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>EWKB書式はOGC標準ではなくPostGIS独特の書式で、空間参照系識別番号(<code class="varname">SRID</code>)を含みます。</p></td></tr></table></div><p>機能強化: 2.0.0で、多面体サーフェスとTINが導入されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は多面体サーフェスに対応しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は三角形と不規則三角網(TIN)に対応しています。</p></div><div class="refsection" title="例"><a name="id286999294"></a><h2>例</h2><p>NAD83経度緯度(4269)のLINESTRING(-71.160281 42.258729,-71.160837 42.259113,-71.161144 42.25932)のバイナリ表現です。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ご注意: bytea配列は\で区切られ'を持ちますが、standard_conforming_stringsが切られている場合には、\と''でエスケープします。正確にはAsEWKB表現とはあいません。</p></td></tr></table></div><pre class="programlisting">SELECT ST_GeomFromEWKB(E'\\001\\002\\000\\000 \\255\\020\\000\\000\\003\\000\\000\\000\\344J=
\\013B\\312Q\\300n\\303(\\010\\036!E@''\\277E''K
\\312Q\\300\\366{b\\235*!E@\\225|\\354.P\\312Q
\\300p\\231\\323e1!E@');</pre><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>PostgreSQL 9.1より前では、standard_conforming_stringsは切られていましたが、9.1以上では、デフォルトで入っていることになりました。必要に応じて、クエリ1回で、データベースまたはサーバレベルでのデフォルトを変更できます。standard_conforming_strings = on使った場合を次に示します。この場合、'を標準ANSIの'でエスケープしますが、バックスラッシュはエスケープしていません。</p></td></tr></table></div><pre class="programlisting">
	    set standard_conforming_strings = on;
SELECT ST_GeomFromEWKB('\001\002\000\000 \255\020\000\000\003\000\000\000\344J=\012\013B
    \312Q\300n\303(\010\036!E@''\277E''K\012\312Q\300\366{b\235*!E@\225|\354.P\312Q\012\300p\231\323e1')</pre></div><div class="refsection" title="関連情報"><a name="id286999322"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsBinary" title="ST_AsBinary">ST_AsBinary</a>, <a class="xref" href="#ST_AsEWKB" title="ST_AsEWKB">ST_AsEWKB</a>, <a class="xref" href="#ST_GeomFromWKB" title="ST_GeomFromWKB">ST_GeomFromWKB</a></p></div></div><div class="refentry" title="ST_GeomFromEWKT"><div class="refentry.separator"><hr></div><a name="ST_GeomFromEWKT"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_GeomFromEWKT ? 拡張Well-Known Text表現(EWKT)から指定されたST_Geometry値を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_GeomFromEWKT</b>(</code>text  <var class="pdparam">EWKT</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id286999378"></a><h2>説明</h2><p>OGC拡張Well-Known Text表現(EWKT)からPostGIS ST_Geometryオブジェクトを生成します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>EWKT書式はOGC標準ではなくPostGIS独特の書式で、空間参照系ID(SRID)を含みます。</p></td></tr></table></div><p>機能強化: 2.0.0で、多面体サーフェスとTINが導入されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は多面体サーフェスに対応しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は三角形と不規則三角網(TIN)に対応しています。</p></div><div class="refsection" title="例"><a name="id286999443"></a><h2>例</h2><pre class="programlisting">SELECT ST_GeomFromEWKT('SRID=4269;LINESTRING(-71.160281 42.258729,-71.160837 42.259113,-71.161144 42.25932)');
SELECT ST_GeomFromEWKT('SRID=4269;MULTILINESTRING((-71.160281 42.258729,-71.160837 42.259113,-71.161144 42.25932))');

SELECT ST_GeomFromEWKT('SRID=4269;POINT(-71.064544 42.28787)');

SELECT ST_GeomFromEWKT('SRID=4269;POLYGON((-71.1776585052917 42.3902909739571,-71.1776820268866 42.3903701743239,
-71.1776063012595 42.3903825660754,-71.1775826583081 42.3903033653531,-71.1776585052917 42.3902909739571))');

SELECT ST_GeomFromEWKT('SRID=4269;MULTIPOLYGON(((-71.1031880899493 42.3152774590236,
-71.1031627617667 42.3152960829043,-71.102923838298 42.3149156848307,
-71.1023097974109 42.3151969047397,-71.1019285062273 42.3147384934248,
-71.102505233663 42.3144722937587,-71.10277487471 42.3141658254797,
-71.103113945163 42.3142739188902,-71.10324876416 42.31402489987,
-71.1033002961013 42.3140393340215,-71.1033488797549 42.3139495090772,
-71.103396240451 42.3138632439557,-71.1041521907712 42.3141153348029,
-71.1041411411543 42.3141545014533,-71.1041287795912 42.3142114839058,
-71.1041188134329 42.3142693656241,-71.1041112482575 42.3143272556118,
-71.1041072845732 42.3143851580048,-71.1041057218871 42.3144430686681,
-71.1041065602059 42.3145009876017,-71.1041097995362 42.3145589148055,
-71.1041166403905 42.3146168544148,-71.1041258822717 42.3146748022936,
-71.1041375307579 42.3147318674446,-71.1041492906949 42.3147711126569,
-71.1041598612795 42.314808571739,-71.1042515013869 42.3151287620809,
-71.1041173835118 42.3150739481917,-71.1040809891419 42.3151344119048,
-71.1040438678912 42.3151191367447,-71.1040194562988 42.3151832057859,
-71.1038734225584 42.3151140942995,-71.1038446938243 42.3151006300338,
-71.1038315271889 42.315094347535,-71.1037393329282 42.315054824985,
-71.1035447555574 42.3152608696313,-71.1033436658644 42.3151648370544,
-71.1032580383161 42.3152269126061,-71.103223066939 42.3152517403219,
-71.1031880899493 42.3152774590236)),
((-71.1043632495873 42.315113108546,-71.1043583974082 42.3151211109857,
-71.1043443253471 42.3150676015829,-71.1043850704575 42.3150793250568,-71.1043632495873 42.315113108546)))');
</pre><pre class="programlisting">
-- 3次元曲線ストリング
SELECT ST_GeomFromEWKT('CIRCULARSTRING(220268 150415 1,220227 150505 2,220227 150406 3)');
</pre><pre class="programlisting">
-- 多面体サーフェスの例
SELECT ST_GeomFromEWKT('POLYHEDRALSURFACE( 
	((0 0 0, 0 0 1, 0 1 1, 0 1 0, 0 0 0)),  
	((0 0 0, 0 1 0, 1 1 0, 1 0 0, 0 0 0)), 
	((0 0 0, 1 0 0, 1 0 1, 0 0 1, 0 0 0)), 
	((1 1 0, 1 1 1, 1 0 1, 1 0 0, 1 1 0)),  
	((0 1 0, 0 1 1, 1 1 1, 1 1 0, 0 1 0)),  
	((0 0 1, 1 0 1, 1 1 1, 0 1 1, 0 0 1)) 
)');
</pre></div><div class="refsection" title="関連情報"><a name="id286999463"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a>, <a class="xref" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a>, <a class="xref" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a></p></div></div><div class="refentry" title="ST_GeometryFromText"><div class="refentry.separator"><hr></div><a name="ST_GeometryFromText"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_GeometryFromText ? Well-Knwon Text表現(WKT)から指定したST_Geometry値を返します。これはST_GeomFromTextの別名です。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_GeometryFromText</b>(</code>text  <var class="pdparam">WKT</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_GeometryFromText</b>(</code>text  <var class="pdparam">WKT</var>, integer  <var class="pdparam">srid</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id286999546"></a><h2>説明</h2><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.40</p></div><div class="refsection" title="関連情報"><a name="id286999579"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a></p></div></div><div class="refentry" title="ST_GeomFromGML"><div class="refentry.separator"><hr></div><a name="ST_GeomFromGML"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_GeomFromGML ? ジオメトリのGML表現を入力とし、PostGISジオメトリオブジェクトを出力します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_GeomFromGML</b>(</code>text  <var class="pdparam">geomgml</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_GeomFromGML</b>(</code>text  <var class="pdparam">geomgml</var>, integer  <var class="pdparam">srid</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id286999760"></a><h2>説明</h2><p>OGC GML表現からPostGIS ST_Geometryオブジェクトを生成します。</p><p>ST_GeomFromGMLは、GMLのうちジオメトリ部分でのみ動作します。GML文書全体に使用しようとするとエラーが投げられます。</p><p>
			OGC GML versions supported:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>GML 3.2.1 Namespace</p></li><li class="listitem"><p>GML 3.1.1 Simple Features profile SF-2 (with GML 3.1.0 and 3.0.0 backward compatibility)</p></li><li class="listitem"><p>GML 2.1.2</p></li></ul></div><p>
			OGC GML standards, cf: <a class="ulink" href="http://www.opengeospatial.org/standards/gml" target="_top">http://www.opengeospatial.org/standards/gml</a>:
		</p><p>初出: 1.5, libxml2 1.6+が必要です。</p><p>機能強化: 2.0.0で、多面体サーフェスとTINが導入されました。</p><p>機能強化: 2.0.0で、任意パラメタにデフォルトのSRIDが追加されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は多面体サーフェスに対応しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は三角形と不規則三角網(TIN)に対応しています。</p><p>GMLは、複合次元(たとえば、2次元と3次元が同じMultiGeometry内にある)を許します。PostGISジオメトリは許さないので、ST_GeomFromGMLは、Z次元が無いジオメトリをひとつでも発見すると、ジオメトリ全体を2次元に変換します。</p><p>GMLは同じMultiGeometry内での複合SRSをサポートします。PostGISではサポートしないので、ST_GeomFromGMLは、この場合には、全てのサブジオメトリをルートノードのSRSに投影変換します。GMLのルートノードにsrsName属性が無い場合、関数はエラーを投げます。</p><p>ST_GeomFromGML関数は、明示的なGML名前空間について杓子定規ではありません。共通使用で名前空間の明示を避けることができます。ただし、GML内でXLink機能を使いたい場合は必要です。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_GeomFromGMLはSQL/MM曲線ジオメトリに対応していません。</p></td></tr></table></div></div><div class="refsection" title="例 - srsName属性を持つ単一のジオメトリ"><a name="id286999864"></a><h2>例 - srsName属性を持つ単一のジオメトリ</h2><pre class="programlisting">SELECT ST_GeomFromGML('
		&lt;gml:LineString srsName="EPSG:4269"&gt;
			&lt;gml:coordinates&gt;
				-71.16028,42.258729 -71.160837,42.259112 -71.161143,42.25932
			&lt;/gml:coordinates&gt;
		&lt;/gml:LineString&gt;');
		</pre></div><div class="refsection" title="例 - XLink使用法"><a name="id286999875"></a><h2>例 - XLink使用法</h2><pre class="programlisting">SELECT ST_GeomFromGML('
		&lt;gml:LineString xmlns:gml="http://www.opengis.net/gml" 
				xmlns:xlink="http://www.w3.org/1999/xlink"
				srsName="urn:ogc:def:crs:EPSG::4269"&gt;
			&lt;gml:pointProperty&gt;
				&lt;gml:Point gml:id="p1"&gt;&lt;gml:pos&gt;42.258729 -71.16028&lt;/gml:pos&gt;&lt;/gml:Point&gt;
			&lt;/gml:pointProperty&gt;
			&lt;gml:pos&gt;42.259112 -71.160837&lt;/gml:pos&gt;
			&lt;gml:pointProperty&gt;
				&lt;gml:Point xlink:type="simple" xlink:href="#p1"/&gt;
			&lt;/gml:pointProperty&gt;
		&lt;/gml:LineString&gt;'););
		</pre></div><div class="refsection" title="例 - 多面体サーフェス"><a name="id286999885"></a><h2>例 - 多面体サーフェス</h2><pre class="programlisting">SELECT ST_AsEWKT(ST_GeomFromGML('
&lt;gml:PolyhedralSurface&gt;
&lt;gml:polygonPatches&gt;
  &lt;gml:PolygonPatch&gt;
    &lt;gml:exterior&gt;
      &lt;gml:LinearRing&gt;&lt;gml:posList srsDimension="3"&gt;0 0 0 0 0 1 0 1 1 0 1 0 0 0 0&lt;/gml:posList&gt;&lt;/gml:LinearRing&gt;
    &lt;/gml:exterior&gt;
  &lt;/gml:PolygonPatch&gt;
  &lt;gml:PolygonPatch&gt;
    &lt;gml:exterior&gt;
    	&lt;gml:LinearRing&gt;&lt;gml:posList srsDimension="3"&gt;0 0 0 0 1 0 1 1 0 1 0 0 0 0 0&lt;/gml:posList&gt;&lt;/gml:LinearRing&gt;
    &lt;/gml:exterior&gt;
  &lt;/gml:PolygonPatch&gt;
  &lt;gml:PolygonPatch&gt;
    &lt;gml:exterior&gt;
    	&lt;gml:LinearRing&gt;&lt;gml:posList srsDimension="3"&gt;0 0 0 1 0 0 1 0 1 0 0 1 0 0 0&lt;/gml:posList&gt;&lt;/gml:LinearRing&gt;
    &lt;/gml:exterior&gt;
  &lt;/gml:PolygonPatch&gt;
  &lt;gml:PolygonPatch&gt;
    &lt;gml:exterior&gt;
    	&lt;gml:LinearRing&gt;&lt;gml:posList srsDimension="3"&gt;1 1 0 1 1 1 1 0 1 1 0 0 1 1 0&lt;/gml:posList&gt;&lt;/gml:LinearRing&gt;
    &lt;/gml:exterior&gt;
  &lt;/gml:PolygonPatch&gt;
  &lt;gml:PolygonPatch&gt;
    &lt;gml:exterior&gt;
    	&lt;gml:LinearRing&gt;&lt;gml:posList srsDimension="3"&gt;0 1 0 0 1 1 1 1 1 1 1 0 0 1 0&lt;/gml:posList&gt;&lt;/gml:LinearRing&gt;
    &lt;/gml:exterior&gt;
  &lt;/gml:PolygonPatch&gt;
  &lt;gml:PolygonPatch&gt;
    &lt;gml:exterior&gt;
    	&lt;gml:LinearRing&gt;&lt;gml:posList srsDimension="3"&gt;0 0 1 1 0 1 1 1 1 0 1 1 0 0 1&lt;/gml:posList&gt;&lt;/gml:LinearRing&gt;
    &lt;/gml:exterior&gt;
  &lt;/gml:PolygonPatch&gt;
&lt;/gml:polygonPatches&gt;
&lt;/gml:PolyhedralSurface&gt;'));

-- result --
 POLYHEDRALSURFACE(((0 0 0,0 0 1,0 1 1,0 1 0,0 0 0)),
 ((0 0 0,0 1 0,1 1 0,1 0 0,0 0 0)),
 ((0 0 0,1 0 0,1 0 1,0 0 1,0 0 0)),
 ((1 1 0,1 1 1,1 0 1,1 0 0,1 1 0)),
 ((0 1 0,0 1 1,1 1 1,1 1 0,0 1 0)),
 ((0 0 1,1 0 1,1 1 1,0 1 1,0 0 1)))
		</pre></div><div class="refsection" title="関連情報"><a name="id286996211"></a><h2>関連情報</h2><p><a class="xref" href="#installation_configuration" title="2.4.1. コンフィギュレーション">「コンフィギュレーション」</a>, <a class="xref" href="#ST_AsGML" title="ST_AsGML">ST_AsGML</a>, <a class="xref" href="#ST_GMLToSQL" title="ST_GMLToSQL">ST_GMLToSQL</a></p></div></div><div class="refentry" title="ST_GeomFromGeoJSON"><div class="refentry.separator"><hr></div><a name="ST_GeomFromGeoJSON"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_GeomFromGeoJSON ? ジオメトリのGeoJSON表現を入力として、PostGISジオメトリオブジェクトを出力します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_GeomFromGeoJSON</b>(</code>text  <var class="pdparam">geomjson</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id286996267"></a><h2>説明</h2><p>GeoJSON表現からPostGISジオメトリオブジェクトを生成します。</p><p>ST_GeomFromGeoJSONは、JSONのうちジオメトリ部分でのみ動作します。JSON文書全体を使おうとするとエラーが投げられます。</p><p>初出: 2.0.0 JSON-C 0.9以上が必要です。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>有効なJSON-Cが無い場合には、出力の替りに、エラー通知を得ます。JSON-Cを有効にするには--with-jsondir=/path/to/json-cをコンフィギュアで指定します。詳細については<a class="xref" href="#installation_configuration" title="2.4.1. コンフィギュレーション">「コンフィギュレーション」</a>をご覧下さい。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p></div><div class="refsection" title="例"><a name="id286996304"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(ST_GeomFromGeoJSON('{"type":"Point","coordinates":[-48.23456,20.12345]}')) As wkt;
wkt
------
POINT(-48.23456 20.12345)
</pre><pre class="programlisting">-- 3次元ラインストリング
SELECT ST_AsText(ST_GeomFromGeoJSON('{"type":"LineString","coordinates":[[1,2,3],[4,5,6],[7,8,9]]}')) As wkt;

wkt
-------------------
LINESTRING(1 2,4 5,7 8)
</pre></div><div class="refsection" title="関連情報"><a name="id286996318"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a>, <a class="xref" href="#ST_AsGeoJSON" title="ST_AsGeoJSON">ST_AsGeoJSON</a>, <a class="xref" href="#installation_configuration" title="2.4.1. コンフィギュレーション">「コンフィギュレーション」</a></p></div></div><div class="refentry" title="ST_GeomFromKML"><div class="refentry.separator"><hr></div><a name="ST_GeomFromKML"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_GeomFromKML ? ジオメトリのKML表現の入力をとり、PostGISジオメトリオブジェクトを出力します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_GeomFromKML</b>(</code>text  <var class="pdparam">geomkml</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id286996375"></a><h2>説明</h2><p>OGC KML表現からPostGIS ST_Geometryオブジェクトを生成します。 </p><p>ST_GeomFromKMLは、KMLのうちジオメトリ部分でのみ動作します。KML文書全体に使用しようとするとエラーが投げられます。</p><p>
			OGC KML versions supported:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>KML 2.2.0 Namespace</p></li></ul></div><p>
			OGC KML標準については<a class="ulink" href="http://www.opengeospatial.org/standards/kml" target="_top">http://www.opengeospatial.org/standards/kml</a>をご覧ください。
		</p><p>初出: 1.5, libxml2 2.6以上が必要です。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_GeomFromKML function not support SQL/MM curves geometries.</p></td></tr></table></div></div><div class="refsection" title="例 - srsNameを持つ単一ジオメトリ"><a name="id286996427"></a><h2>例 - srsNameを持つ単一ジオメトリ</h2><pre class="programlisting">SELECT ST_GeomFromKML('
		&lt;LineString&gt;
			&lt;coordinates&gt;-71.1663,42.2614 
				-71.1667,42.2616&lt;/coordinates&gt;
		&lt;/LineString&gt;');
		</pre></div><div class="refsection" title="関連情報"><a name="id286996438"></a><h2>関連情報</h2><p><a class="xref" href="#installation_configuration" title="2.4.1. コンフィギュレーション">「コンフィギュレーション」</a>, <a class="xref" href="#ST_AsKML" title="ST_AsKML">ST_AsKML</a></p></div></div><div class="refentry" title="ST_GMLToSQL"><div class="refentry.separator"><hr></div><a name="ST_GMLToSQL"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_GMLToSQL ? GML表現から指定したST_Geometry値を返します。これはST_GeomFromGMLの別名です。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_GMLToSQL</b>(</code>text  <var class="pdparam">geomgml</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_GMLToSQL</b>(</code>text  <var class="pdparam">geomgml</var>, integer  <var class="pdparam">srid</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id286996552"></a><h2>説明</h2><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.50 (except for curves support).</p><p>初出: 1.5, requires libxml2 1.6+</p><p>機能強化: 2.0.0で、多面体サーフェスとTINが導入されました。</p><p>機能強化: 2.0.0で、任意パラメタにデフォルトのSRIDが追加されました。</p></div><div class="refsection" title="関連情報"><a name="id286996581"></a><h2>関連情報</h2><p><a class="xref" href="#installation_configuration" title="2.4.1. コンフィギュレーション">「コンフィギュレーション」</a>, <a class="xref" href="#ST_GeomFromGML" title="ST_GeomFromGML">ST_GeomFromGML</a>, <a class="xref" href="#ST_AsGML" title="ST_AsGML">ST_AsGML</a></p></div></div><div class="refentry" title="ST_GeomFromText"><div class="refentry.separator"><hr></div><a name="ST_GeomFromText"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_GeomFromText ? Well-Known Text表現(WKT)から指定したST_Geometryを返します。 </p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_GeomFromText</b>(</code>text  <var class="pdparam">WKT</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_GeomFromText</b>(</code>text  <var class="pdparam">WKT</var>, integer  <var class="pdparam">srid</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id286996665"></a><h2>説明</h2><p>OGC Well-Known Text表現からPostGIS ST_Geometryオブジェクトを生成します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>2種類のST_GeomFromText関数があります。ひとつはSRIDを取らずに空間参照系を定義しないジオメトリを返すものです。 もうひとつは空間参照系識別番号を第二引数で取り、このSRIDをメタデータの一部として含むST_Geometryを返すものです。 SRIDはspatial_ref_sysテーブルで定義されていなければなりません。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です s3.2.6.2 - option SRID is from the conformance suite.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.40</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p><div class="warning" title="警告" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>変更: 2.0.0以前ではST_GeomFromText('GEOMETRYCOLLECTION(EMPTY)')が許されていました。SQL/MM標準への適合のためPostGIS 2.0.0では不正とされます。今はST_GeomFromText('GEOMETRYCOLLECTION EMPTY')となります。</p></td></tr></table></div></div><div class="refsection" title="例"><a name="id286996726"></a><h2>例</h2><pre class="programlisting">SELECT ST_GeomFromText('LINESTRING(-71.160281 42.258729,-71.160837 42.259113,-71.161144 42.25932)');
SELECT ST_GeomFromText('LINESTRING(-71.160281 42.258729,-71.160837 42.259113,-71.161144 42.25932)',4269);

SELECT ST_GeomFromText('MULTILINESTRING((-71.160281 42.258729,-71.160837 42.259113,-71.161144 42.25932))');

SELECT ST_GeomFromText('POINT(-71.064544 42.28787)');

SELECT ST_GeomFromText('POLYGON((-71.1776585052917 42.3902909739571,-71.1776820268866 42.3903701743239,
-71.1776063012595 42.3903825660754,-71.1775826583081 42.3903033653531,-71.1776585052917 42.3902909739571))');

SELECT ST_GeomFromText('MULTIPOLYGON(((-71.1031880899493 42.3152774590236,
-71.1031627617667 42.3152960829043,-71.102923838298 42.3149156848307,
-71.1023097974109 42.3151969047397,-71.1019285062273 42.3147384934248,
-71.102505233663 42.3144722937587,-71.10277487471 42.3141658254797,
-71.103113945163 42.3142739188902,-71.10324876416 42.31402489987,
-71.1033002961013 42.3140393340215,-71.1033488797549 42.3139495090772,
-71.103396240451 42.3138632439557,-71.1041521907712 42.3141153348029,
-71.1041411411543 42.3141545014533,-71.1041287795912 42.3142114839058,
-71.1041188134329 42.3142693656241,-71.1041112482575 42.3143272556118,
-71.1041072845732 42.3143851580048,-71.1041057218871 42.3144430686681,
-71.1041065602059 42.3145009876017,-71.1041097995362 42.3145589148055,
-71.1041166403905 42.3146168544148,-71.1041258822717 42.3146748022936,
-71.1041375307579 42.3147318674446,-71.1041492906949 42.3147711126569,
-71.1041598612795 42.314808571739,-71.1042515013869 42.3151287620809,
-71.1041173835118 42.3150739481917,-71.1040809891419 42.3151344119048,
-71.1040438678912 42.3151191367447,-71.1040194562988 42.3151832057859,
-71.1038734225584 42.3151140942995,-71.1038446938243 42.3151006300338,
-71.1038315271889 42.315094347535,-71.1037393329282 42.315054824985,
-71.1035447555574 42.3152608696313,-71.1033436658644 42.3151648370544,
-71.1032580383161 42.3152269126061,-71.103223066939 42.3152517403219,
-71.1031880899493 42.3152774590236)),
((-71.1043632495873 42.315113108546,-71.1043583974082 42.3151211109857,
-71.1043443253471 42.3150676015829,-71.1043850704575 42.3150793250568,-71.1043632495873 42.315113108546)))',4326);

SELECT ST_GeomFromText('CIRCULARSTRING(220268 150415,220227 150505,220227 150406)');
	</pre></div><div class="refsection" title="関連情報"><a name="id286996737"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a>, <a class="xref" href="#ST_GeomFromWKB" title="ST_GeomFromWKB">ST_GeomFromWKB</a>, <a class="xref" href="#ST_SRID" title="ST_SRID">ST_SRID</a></p></div></div><div class="refentry" title="ST_GeomFromWKB"><div class="refentry.separator"><hr></div><a name="ST_GeomFromWKB"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_GeomFromWKB ? Well-Knwon Binaryジオメトリ表現(WKB)と任意パラメタのSRIDからジオメトリインスタンスを生成します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_GeomFromWKB</b>(</code>bytea  <var class="pdparam">geom</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_GeomFromWKB</b>(</code>bytea  <var class="pdparam">geom</var>, integer  <var class="pdparam">srid</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id286996820"></a><h2>説明</h2><p><code class="varname">ST_GeomFromWKB</code>は、ジオメトリのWell-Known Binary表現と空間参照系識別番号(<code class="varname">SRID</code>)を取り、適切なジオメトリ型のインスタンスを生成します。この関数は、SQLのジオメトリファクトリの役割を果たします。これは、ST_WKBToSQLの代替名です。</p><p>SRIDが指定されていない場合、-1(不明)となります。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です s3.2.7.2 - the optional SRID is from the conformance suite</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.41</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p></div><div class="refsection" title="例"><a name="id286996876"></a><h2>例</h2><pre class="programlisting">-- bytea表現には1つの\がありますが、standard_conforming_stringsがonの場合には、
-- テーブル挿入時にエスケープする必要があるので、2つになります。
SELECT ST_AsEWKT(
ST_GeomFromWKB(E'\\001\\002\\000\\000\\000\\002\\000\\000\\000\\037\\205\\353Q\\270~\\\\\\300\\323Mb\\020X\\231C@\\020X9\\264\\310~\\\\\\300)\\\\\\217\\302\\365\\230C@',4326)
);
					  st_asewkt
------------------------------------------------------
 SRID=4326;LINESTRING(-113.98 39.198,-113.981 39.195)
(1 row)

SELECT
  ST_AsText(
	ST_GeomFromWKB(
	  ST_AsEWKB('POINT(2 5)'::geometry)
	)
  );
 st_astext
------------
 POINT(2 5)
(1 row)</pre></div><div class="refsection" title="関連情報"><a name="id286996889"></a><h2>関連情報</h2><p><a class="xref" href="#ST_WKBToSQL" title="ST_WKBToSQL">ST_WKBToSQL</a>, <a class="xref" href="#ST_AsBinary" title="ST_AsBinary">ST_AsBinary</a>, <a class="xref" href="#ST_GeomFromEWKB" title="ST_GeomFromEWKB">ST_GeomFromEWKB</a></p></div></div><div class="refentry" title="ST_LineFromMultiPoint"><div class="refentry.separator"><hr></div><a name="ST_LineFromMultiPoint"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_LineFromMultiPoint ? MULTIPOINTジオメトリからLINESTRINGを生成します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_LineFromMultiPoint</b>(</code>geometry  <var class="pdparam">aMultiPoint</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id286997015"></a><h2>説明</h2><p>MULTIPOINTジオメトリからLINESTRINGを生成します。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p></div><div class="refsection" title="例"><a name="id286997037"></a><h2>例</h2><pre class="programlisting">
-- 3次元ラインストリングを3次元マルチポイントから生成
SELECT ST_AsEWKT(ST_LineFromMultiPoint(ST_GeomFromEWKT('MULTIPOINT(1 2 3, 4 5 6, 7 8 9)')));
-- 結果 --
LINESTRING(1 2 3,4 5 6,7 8 9)
		</pre></div><div class="refsection" title="関連情報"><a name="id286997050"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a>, <a class="xref" href="#ST_Collect" title="ST_Collect">ST_Collect</a>, <a class="xref" href="#ST_MakeLine" title="ST_MakeLine">ST_MakeLine</a></p></div></div><div class="refentry" title="ST_LineFromText"><div class="refentry.separator"><hr></div><a name="ST_LineFromText"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_LineFromText ? WKT表現と与えられたSRIDからジオメトリを生成します。SRIDが与えられていない場合は-1(不明)となります。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_LineFromText</b>(</code>text  <var class="pdparam">WKT</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_LineFromText</b>(</code>text  <var class="pdparam">WKT</var>, integer  <var class="pdparam">srid</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id286997134"></a><h2>説明</h2><p>WKT表現と与えられたSRIDからジオメトリを生成します。SRIDが与えられていない場合は-1(不明)となります。渡されたWKTがLINESTRINGでない場合はNULLが返ります。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>OGC SPEC 3.2.6.2 - option SRID is from the conformance
				suite.</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>全てのジオメトリが<code class="varname">LINESTRING</code>であると知っている場合は、<a class="xref" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a>を使う方が効果的です。 この関数は<a class="xref" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a>の呼び出しと、LINESTRINGを返すかどうかの評価とを行います。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です s3.2.6.2</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 7.2.8</p></div><div class="refsection" title="例"><a name="id286997194"></a><h2>例</h2><pre class="programlisting">SELECT ST_LineFromText('LINESTRING(1 2, 3 4)') AS aline, ST_LineFromText('POINT(1 2)') AS null_return;
aline                            | null_return
------------------------------------------------
010200000002000000000000000000F ... | t
		</pre></div><div class="refsection" title="関連情報"><a name="id286997208"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a></p></div></div><div class="refentry" title="ST_LineFromWKB"><div class="refentry.separator"><hr></div><a name="ST_LineFromWKB"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_LineFromWKB ? WKB表現と与えられたSRIDから<code class="varname">LINESTRING</code>を生成します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_LineFromWKB</b>(</code>bytea  <var class="pdparam">WKB</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_LineFromWKB</b>(</code>bytea  <var class="pdparam">WKB</var>, integer  <var class="pdparam">srid</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id286997322"></a><h2>説明</h2><p><code class="varname">ST_LineFromWKB</code>は、ジオメトリのWell-Known Binary表現と空間参照系識別番号(<code class="varname">SRID</code>)を取り、適切なジオメトリ型を返します。この場合は<code class="varname">LINESTRING</code>ジオメトリです。この関数はSQLのジオメトリファクトリの役割を果たします。</p><p>SRIDが指定されていない場合は-1(不明)となります。入力<code class="varname">bytea</code>が<code class="varname">LINESTRING</code>を表現していない場合は<code class="varname">NULL</code>を返します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>OGC SPEC 3.2.6.2 - option SRID is from the conformance
				suite.</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>全てのジオメトリが<code class="varname">LINESTRING</code>であると知っている場合は、<a class="xref" href="#ST_GeomFromWKB" title="ST_GeomFromWKB">ST_GeomFromWKB</a>を使う方が効果的です。 この関数は<a class="xref" href="#ST_GeomFromWKB" title="ST_GeomFromWKB">ST_GeomFromWKB</a>の呼び出しと、LINESTRINGを返すかどうかの評価とを行います。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です s3.2.6.2</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 7.2.9</p></div><div class="refsection" title="例"><a name="id286997404"></a><h2>例</h2><pre class="programlisting">SELECT ST_LineFromWKB(ST_AsBinary(ST_GeomFromText('LINESTRING(1 2, 3 4)'))) AS aline,
		ST_LineFromWKB(ST_AsBinary(ST_GeomFromText('POINT(1 2)'))) IS NULL AS null_return;
aline                            | null_return
------------------------------------------------
010200000002000000000000000000F ... | t
		</pre></div><div class="refsection" title="関連情報"><a name="id286997417"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeomFromWKB" title="ST_GeomFromWKB">ST_GeomFromWKB</a>, <a class="xref" href="#ST_LinestringFromWKB" title="ST_LinestringFromWKB">ST_LinestringFromWKB</a></p></div></div><div class="refentry" title="ST_LinestringFromWKB"><div class="refentry.separator"><hr></div><a name="ST_LinestringFromWKB"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_LinestringFromWKB ? WKB表現と与えられたSRIDからジオメトリを生成します。 </p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_LinestringFromWKB</b>(</code>bytea  <var class="pdparam">WKB</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_LinestringFromWKB</b>(</code>bytea  <var class="pdparam">WKB</var>, integer  <var class="pdparam">srid</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id286997497"></a><h2>説明</h2><p><code class="varname">ST_LinestringFromWKB</code>は、ジオメトリのWell-Known Binary表現と空間参照系識別番号(<code class="varname">SRID</code>)を取り、適切なジオメトリ型のインスタンスを生成します。この場合、<code class="varname">LINESTRING</code>ジオメトリです。この関数はSQLのジオメトリファクトリの役割を果たします。</p><p>SRIDが指定されていない場合は-1(不明)となります。入力<code class="varname">bytea</code>が<code class="varname">LINESTRING</code>を表現していない場合は<code class="varname">NULL</code>を返します。これは<a class="xref" href="#ST_LineFromWKB" title="ST_LineFromWKB">ST_LineFromWKB</a>の別名です。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>OGC SPEC 3.2.6.2 - optional SRID is from the conformance suite.</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>全てのジオメトリが<code class="varname">LINESTRING</code>であると知っている場合は、<a class="xref" href="#ST_GeomFromWKB" title="ST_GeomFromWKB">ST_GeomFromWKB</a>を使う方が効果的です。この関数は<a class="xref" href="#ST_GeomFromWKB" title="ST_GeomFromWKB">ST_GeomFromWKB</a>の呼び出しと、<code class="varname">LINESTRING</code>を返すかどうかの評価とを行います。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です s3.2.6.2</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 7.2.9</p></div><div class="refsection" title="例"><a name="id286997621"></a><h2>例</h2><pre class="programlisting">SELECT
  ST_LineStringFromWKB(
	ST_AsBinary(ST_GeomFromText('LINESTRING(1 2, 3 4)'))
  ) AS aline,
  ST_LinestringFromWKB(
	ST_AsBinary(ST_GeomFromText('POINT(1 2)'))
  ) IS NULL AS null_return;
   aline                            | null_return
------------------------------------------------
010200000002000000000000000000F ... | t</pre></div><div class="refsection" title="関連情報"><a name="id286997634"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeomFromWKB" title="ST_GeomFromWKB">ST_GeomFromWKB</a>, <a class="xref" href="#ST_LineFromWKB" title="ST_LineFromWKB">ST_LineFromWKB</a></p></div></div><div class="refentry" title="ST_MakeBox2D"><div class="refentry.separator"><hr></div><a name="ST_MakeBox2D"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MakeBox2D ? 与えられたポイントジオメトリから定義されるBOX2Dを生成します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">box2d <b class="fsfunc">ST_MakeBox2D</b>(</code>geometry  <var class="pdparam">pointLowLeft</var>, geometry  <var class="pdparam">pointUpRight</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id286997696"></a><h2>説明</h2><p>与えられた2つのポイントジオメトリから定義されるBOX2Dを生成します。これは範囲クエリを実行する際に使われます。</p></div><div class="refsection" title="例"><a name="id286997705"></a><h2>例</h2><pre class="programlisting">
-- 米国ナショナルアトラス内に入っているまたは部分的に入っている
-- 全ての地物を返します。
-- ジオメトリはSRID=2163(米国ナショナルアトラス正積図法)
-- で保存されていると仮定します。
SELECT feature_id, feature_name, the_geom
FROM features
WHERE the_geom &amp;&amp; ST_SetSRID(ST_MakeBox2D(ST_Point(-989502.1875, 528439.5625),
	ST_Point(-987121.375 ,529933.1875)),2163)</pre></div><div class="refsection" title="関連情報"><a name="id286997718"></a><h2>関連情報</h2><p><a class="xref" href="#ST_MakePoint" title="ST_MakePoint">ST_MakePoint</a>, <a class="xref" href="#ST_Point" title="ST_Point">ST_Point</a>, <a class="xref" href="#ST_SetSRID" title="ST_SetSRID">ST_SetSRID</a>, <a class="xref" href="#ST_SRID" title="ST_SRID">ST_SRID</a></p></div></div><div class="refentry" title="ST_3DMakeBox"><div class="refentry.separator"><hr></div><a name="ST_3DMakeBox"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_3DMakeBox ? 与えられた3次元ポイントジオメトリから定義されるBOX3Dを生成します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">box3d <b class="fsfunc">ST_3DMakeBox</b>(</code>geometry  <var class="pdparam">point3DLowLeftBottom</var>, geometry  <var class="pdparam">point3DUpRightTop</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id286997786"></a><h2>説明</h2><p>与えられた3次元ポイントジオメトリから定義されるBOX3Dを生成します。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> この関数は3次元に対応し、Zインデクスを削除しません。</p><p>変更: 2.0.0以前の版ではST_MakeBox3Dと呼ばれていました。</p></div><div class="refsection" title="例"><a name="id286997814"></a><h2>例</h2><pre class="programlisting">
SELECT ST_3DMakeBox(ST_MakePoint(-989502.1875, 528439.5625, 10),
	ST_MakePoint(-987121.375 ,529933.1875, 10)) As abb3d

--bb3d--
--------
BOX3D(-989502.1875 528439.5625 10,-987121.375 529933.1875 10)
	</pre></div><div class="refsection" title="関連情報"><a name="id286997827"></a><h2>関連情報</h2><p><a class="xref" href="#ST_MakePoint" title="ST_MakePoint">ST_MakePoint</a>, <a class="xref" href="#ST_SetSRID" title="ST_SetSRID">ST_SetSRID</a>, <a class="xref" href="#ST_SRID" title="ST_SRID">ST_SRID</a></p></div></div><div class="refentry" title="ST_MakeLine"><div class="refentry.separator"><hr></div><a name="ST_MakeLine"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MakeLine ? ポイントまたはラインジオメトリからラインストリングを生成します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_MakeLine</b>(</code>geometry set <var class="pdparam">geoms</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_MakeLine</b>(</code>geometry <var class="pdparam">geom1</var>, geometry <var class="pdparam">geom2</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_MakeLine</b>(</code>geometry[] <var class="pdparam">geoms_array</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id286997928"></a><h2>説明</h2><p>ST_MakeLineには3形式があります。ひとつめは、ポイントまたはラインジオメトリの行を取り、1つのラインストリングを返す空間集計です。ふたつめは、ポイントまたはラインジオメトリの配列を取る関数です。みっつめは、2つのポイントまたはラインジオメトリを取る通常関数です。集計関数版に送る前にポイントの整列を行う副問い合わせを使えます。</p><p>ライン要素を追加する時には、共通ノードは出力から削除されます。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p>初出: 1.4.0 - ST_MakeLine(geomarray)が導入されました。ST_MakeLine集計関数はより多くのポイントをより早く扱うための強化が施されています。</p><p>初出: 2.0.0 - ラインストリング入力要素が導入されました。</p></div><div class="refsection" title="例: 空間集計版"><a name="id286997994"></a><h2>例: 空間集計版</h2><p>この例では、GPS位置の順列を取り、ジオメトリフィールドがGPSポイントからなるラインストリングで行程順になるよう、行程ごとにひとつのレコードを生成します。</p><pre class="programlisting">
-- PostgreSQL 9.0より前の版 - これは普通に動きますが、
-- プランナが副問い合わせの並び順を尊重しない選択を発生させることがあります。
SELECT gps.gps_track, ST_MakeLine(gps.the_geom) As newgeom
	FROM (SELECT gps_track,gps_time, the_geom
			FROM gps_points ORDER BY gps_track, gps_time) As gps
	GROUP BY gps.gps_track;</pre><pre class="programlisting">
-- PostgreSQL 9.0以上(集計関数用の新しいORDER BY機能を使えます)では、
-- これは、正しく整列したラインストリングが得られることが
-- 保証されている方法です。
-- 必要ならORDER BYは複数のカラムで利用できます。
SELECT gps.gps_track, ST_MakeLine(gps.the_geom ORDER BY gps_time) As newgeom
	FROM gps_points As gps
	GROUP BY gps.gps_track;</pre></div><div class="refsection" title="例: 非空間集計版"><a name="id286998012"></a><h2>例: 非空間集計版</h2><p>ひとつめの例は2ポイントからなる使い捨てのラインストリングです。ふたつめは、ユーザが描いた2ポイントからラインストリングを生成しています。みっつめは、2つの3次元ポイントを接続した使い捨ての3次元ラインを生成しています。</p><pre class="programlisting">
SELECT ST_AsText(ST_MakeLine(ST_MakePoint(1,2), ST_MakePoint(3,4)));
	  st_astext
---------------------
 LINESTRING(1 2,3 4)

SELECT userpoints.id, ST_MakeLine(startpoint, endpoint) As drawn_line
	FROM userpoints ;

SELECT ST_AsEWKT(ST_MakeLine(ST_MakePoint(1,2,3), ST_MakePoint(3,4,5)));
		st_asewkt
-------------------------
 LINESTRING(1 2 3,3 4 5)
			</pre></div><div class="refsection" title="例: 配列使用版"><a name="id286998026"></a><h2>例: 配列使用版</h2><pre class="programlisting">
SELECT ST_MakeLine(ARRAY(SELECT ST_Centroid(the_geom) FROM visit_locations ORDER BY visit_time));

-- 3つの3次元ポイントから3次元ラインを生成
SELECT ST_AsEWKT(ST_MakeLine(ARRAY[ST_MakePoint(1,2,3),
				ST_MakePoint(3,4,5), ST_MakePoint(6,6,6)]));
		st_asewkt
-------------------------
LINESTRING(1 2 3,3 4 5,6 6 6)
			</pre></div><div class="refsection" title="関連情報"><a name="id286998039"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a>, <a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a>, <a class="xref" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a>, <a class="xref" href="#ST_MakePoint" title="ST_MakePoint">ST_MakePoint</a></p></div></div><div class="refentry" title="ST_MakeEnvelope"><div class="refentry.separator"><hr></div><a name="ST_MakeEnvelope"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MakeEnvelope ? 与えられた最小値と最大値から長方形ポリゴンを生成します。入力値はSRIDで指定された空間参照系でなければなりません。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_MakeEnvelope</b>(</code>double precision <var class="pdparam">xmin</var>, double precision <var class="pdparam">ymin</var>, double precision <var class="pdparam">xmax</var>, double precision <var class="pdparam">ymax</var>, integer  <var class="pdparam">srid=unknown</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id286998135"></a><h2>説明</h2><p>与えられた最小値と最大値から長方形ポリゴンを生成します。入力値はSRIDで指定された空間参照系でなければなりません。SRIDが指定されない場合には、不明な空間参照系と仮定します。</p><p>初出: 1.5</p><p>機能強化: 2.0: SRID指定なしでエンベロープを指定できるようになりました。</p></div><div class="refsection" title="例: バウンディングボックスポリゴン"><a name="id286998151"></a><h2>例: バウンディングボックスポリゴン</h2><pre class="programlisting">
SELECT ST_AsText(ST_MakeEnvelope(10, 10, 11, 11, 4326));

st_asewkt
-----------
POLYGON((10 10, 10 11, 11 11, 11 10, 10 10))
			  </pre></div><div class="refsection" title="関連情報"><a name="id286998162"></a><h2>関連情報</h2><p><a class="xref" href="#ST_MakePoint" title="ST_MakePoint">ST_MakePoint</a>, <a class="xref" href="#ST_MakeLine" title="ST_MakeLine">ST_MakeLine</a>, <a class="xref" href="#ST_MakePolygon" title="ST_MakePolygon">ST_MakePolygon</a></p></div></div><div class="refentry" title="ST_MakePolygon"><div class="refentry.separator"><hr></div><a name="ST_MakePolygon"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MakePolygon ? 与えられた外環で形成されるポリゴンを生成します。入力ジオメトリは閉じたラインストリングでなければなりません。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_MakePolygon</b>(</code>geometry <var class="pdparam">linestring</var><code>)</code>;</p></div><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_MakePolygon</b>(</code>geometry <var class="pdparam">outerlinestring</var>, geometry[] <var class="pdparam">interiorlinestrings</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id286998248"></a><h2>説明</h2><p>与えられた外環で形成されるポリゴンを生成します。入力ジオメトリは閉じたラインストリングでなければなりません。2つの形式があります。</p><p>ひとつめは、閉じたラインストリングをひとつ取るものです。</p><p>ふたつめは、外環と内環配列を取るものです。ST_AccumまたはPostgreSQLのARRAY[]やARRAY()コンストラクタを使用してジオメトリ配列を生成できます。入力ジオメトリは閉じたラインストリングでなければなりません。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はマルチラインストリングを受け付けません。<a class="xref" href="#ST_LineMerge" title="ST_LineMerge">ST_LineMerge</a>または<a class="xref" href="#ST_Dump" title="ST_Dump">ST_Dump</a>でラインストリングを生成して下さい。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p></div><div class="refsection" title="例: 単一の閉じたラインストリング"><a name="id286998290"></a><h2>例: 単一の閉じたラインストリング</h2><pre class="programlisting">
-- 2次元ライン
SELECT ST_MakePolygon(ST_GeomFromText('LINESTRING(75.15 29.53,77 29,77.6 29.5, 75.15 29.53)'));
-- ラインストリングが閉じていない場合は
-- 開始点を追加して閉じさせることができます
SELECT ST_MakePolygon(ST_AddPoint(foo.open_line, ST_StartPoint(foo.open_line)))
FROM (
SELECT ST_GeomFromText('LINESTRING(75.15 29.53,77 29,77.6 29.5)') As open_line) As foo;

-- 3次元の閉じたライン --
SELECT ST_MakePolygon(ST_GeomFromText('LINESTRING(75.15 29.53 1,77 29 1,77.6 29.5 1, 75.15 29.53 1)'));

st_asewkt
-----------
POLYGON((75.15 29.53 1,77 29 1,77.6 29.5 1,75.15 29.53 1))

-- M値を持つライン --
SELECT ST_MakePolygon(ST_GeomFromText('LINESTRINGM(75.15 29.53 1,77 29 1,77.6 29.5 2, 75.15 29.53 2)'));

st_asewkt
----------
POLYGONM((75.15 29.53 1,77 29 1,77.6 29.5 2,75.15 29.53 2))
			  </pre></div><div class="refsection" title="例: 外環と内環"><a name="id286998300"></a><h2>例: 外環と内環 </h2><p>蟻の穴を持つドーナツの生成です。</p><pre class="programlisting">
SELECT ST_MakePolygon(
		ST_ExteriorRing(ST_Buffer(foo.line,10)),
	ARRAY[ST_Translate(foo.line,1,1),
		ST_ExteriorRing(ST_Buffer(ST_MakePoint(20,20),1)) ]
	)
FROM
	(SELECT ST_ExteriorRing(ST_Buffer(ST_MakePoint(10,10),10,10))
		As line )
		As foo;
		</pre><p>Build province boundaries with holes
		representing lakes in the province from a set of
		province polygons/multipolygons and water line strings
		this is an example of using PostGIS ST_Accum
		</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>The use of CASE because feeding a null array into
		ST_MakePolygon results in NULL</p></td></tr></table></div><p>
		</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>the use of left join to guarantee we get all provinces back even if they have no lakes</p></td></tr></table></div><pre class="programlisting">
	SELECT p.gid, p.province_name,
		CASE WHEN
			ST_Accum(w.the_geom) IS NULL THEN p.the_geom
		ELSE  ST_MakePolygon(ST_LineMerge(ST_Boundary(p.the_geom)), ST_Accum(w.the_geom)) END
	FROM
		provinces p LEFT JOIN waterlines w
			ON (ST_Within(w.the_geom, p.the_geom) AND ST_IsClosed(w.the_geom))
	GROUP BY p.gid, p.province_name, p.the_geom;

	-- 上と同じ例ですが、相関副問い合わせと、
	-- 行集合を配列に変換するPostgreSQL組み込み関数ARRAY()を使っています。

	SELECT p.gid,  p.province_name, CASE WHEN
		EXISTS(SELECT w.the_geom
			FROM waterlines w
			WHERE ST_Within(w.the_geom, p.the_geom)
			AND ST_IsClosed(w.the_geom))
		THEN
		ST_MakePolygon(ST_LineMerge(ST_Boundary(p.the_geom)),
			ARRAY(SELECT w.the_geom
				FROM waterlines w
				WHERE ST_Within(w.the_geom, p.the_geom)
				AND ST_IsClosed(w.the_geom)))
		ELSE p.the_geom END As the_geom
	FROM
		provinces p;
			  </pre></div><div class="refsection" title="関連情報"><a name="id286998330"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Accum" title="ST_Accum">ST_Accum</a>, <a class="xref" href="#ST_AddPoint" title="ST_AddPoint">ST_AddPoint</a>, <a class="xref" href="#ST_GeometryType" title="ST_GeometryType">ST_GeometryType</a>, <a class="xref" href="#ST_IsClosed" title="ST_IsClosed">ST_IsClosed</a>, <a class="xref" href="#ST_LineMerge" title="ST_LineMerge">ST_LineMerge</a></p></div></div><div class="refentry" title="ST_MakePoint"><div class="refentry.separator"><hr></div><a name="ST_MakePoint"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MakePoint ? 2次元、XYZの3次元、4次元のポイントジオメトリを生成します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_MakePoint</b>(</code>double precision <var class="pdparam">x</var>, double precision <var class="pdparam">y</var><code>)</code>;</p></div><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_MakePoint</b>(</code>double precision <var class="pdparam">x</var>, double precision <var class="pdparam">y</var>, double precision <var class="pdparam">z</var><code>)</code>;</p></div><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_MakePoint</b>(</code>double precision <var class="pdparam">x</var>, double precision <var class="pdparam">y</var>, double precision <var class="pdparam">z</var>, double precision <var class="pdparam">m</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id286998556"></a><h2>説明</h2><p>2次元、XYZの3次元、4次元のポイントジオメトリ(M値を持つジオメトリ)を生成します。<code class="varname">ST_MakePoint</code>はOGC対応になっていませんが、一般的に<a class="xref" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a>や<a class="xref" href="#ST_PointFromText" title="ST_PointFromText">ST_PointFromText</a>より速く、高精度です。また、WKTでなく生の座標値を持っている場合は扱いやすいです。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Xが経度でYが緯度ですのでご注意ください。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>X,Y,Mのポイントを生成する必要がある場合には、<a class="xref" href="#ST_MakePointM" title="ST_MakePointM">ST_MakePointM</a>を使います。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p></div><div class="refsection" title="例"><a name="id287002493"></a><h2>例</h2><pre class="programlisting">-- 不明なSRIDを持つポイントを返します
SELECT ST_MakePoint(-71.1043443253471, 42.3150676015829);

-- WGS84経度緯度のポイントを返します
SELECT ST_SetSRID(ST_MakePoint(-71.1043443253471, 42.3150676015829),4326);

-- 3次元ポイント(標高を持つ)を返します
SELECT ST_MakePoint(1, 2,1.5);

-- ポイントのZ値を得ます
SELECT ST_Z(ST_MakePoint(1, 2,1.5));
result
-------
1.5</pre></div><div class="refsection" title="関連情報"><a name="id287002504"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a>, <a class="xref" href="#ST_PointFromText" title="ST_PointFromText">ST_PointFromText</a>, <a class="xref" href="#ST_SetSRID" title="ST_SetSRID">ST_SetSRID</a>, <a class="xref" href="#ST_MakePointM" title="ST_MakePointM">ST_MakePointM</a></p></div></div><div class="refentry" title="ST_MakePointM"><div class="refentry.separator"><hr></div><a name="ST_MakePointM"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MakePointM ? X, Y, M座標を持つポイントジオメトリを生成します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_MakePointM</b>(</code>float <var class="pdparam">x</var>, float <var class="pdparam">y</var>, float <var class="pdparam">m</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287002581"></a><h2>説明</h2><p>X, Y, M座標を持つポイントジオメトリを生成します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Xが経度でYが緯度ですのでご注意ください。</p></td></tr></table></div></div><div class="refsection" title="例"><a name="id287002596"></a><h2>例</h2><p>この例では、文字列表現にST_AsTextでなくST_AsEWKTを使っています。ST_AsTextはM値をサポートしていないためです。</p><pre class="programlisting">
-- SRIDが不明のEWKT表現を返します
SELECT ST_AsEWKT(ST_MakePointM(-71.1043443253471, 42.3150676015829, 10));

-- 結果
				   st_asewkt
-----------------------------------------------
 POINTM(-71.1043443253471 42.3150676015829 10)

-- WGS 84経度緯度のSRIDを付けたM値を持つポイントのEWKT表現を返します
SELECT ST_AsEWKT(ST_SetSRID(ST_MakePointM(-71.1043443253471, 42.3150676015829,10),4326));

						st_asewkt
---------------------------------------------------------
SRID=4326;POINTM(-71.1043443253471 42.3150676015829 10)

-- 3次元ポイント(標高を持つ)を返します
SELECT ST_MakePoint(1, 2,1.5);

-- ポイントのM値を得ます
SELECT ST_M(ST_MakePointM(-71.1043443253471, 42.3150676015829,10));
result
-------
10
			  </pre></div><div class="refsection" title="関連情報"><a name="id287002610"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a>, <a class="xref" href="#ST_MakePoint" title="ST_MakePoint">ST_MakePoint</a>, <a class="xref" href="#ST_SetSRID" title="ST_SetSRID">ST_SetSRID</a></p></div></div><div class="refentry" title="ST_MLineFromText"><div class="refentry.separator"><hr></div><a name="ST_MLineFromText"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MLineFromText ? WKT表現から指定したST_MultiLineString値を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_MLineFromText</b>(</code>text  <var class="pdparam">WKT</var>, integer  <var class="pdparam">srid</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_MLineFromText</b>(</code>text  <var class="pdparam">WKT</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287002694"></a><h2>説明</h2><p>Well-Known Text(WKT)表現と与えられたSRIDからジオメトリを生成します。SRIDを与えない場合は-1(不明)となります。</p><p>OGC SPEC 3.2.6.2 - option SRID is from the conformance
			suite</p><p>WKTがMULTILINESTRINGでない場合はNULLを返します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>全てのWKTジオメトリがマルチラインストリングであると絶対的な確信を持てる場合は、この関数は使わないでください。付加的な評価ステップが追加されるのでST_GeomFromTextより遅いです。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です s3.2.6.2</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。SQL-MM 3: 9.4.4</p></div><div class="refsection" title="例"><a name="id287002745"></a><h2>例</h2><pre class="programlisting">SELECT ST_MLineFromText('MULTILINESTRING((1 2, 3 4), (4 5, 6 7))');</pre></div><div class="refsection" title="関連情報"><a name="id287002758"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a></p></div></div><div class="refentry" title="ST_MPointFromText"><div class="refentry.separator"><hr></div><a name="ST_MPointFromText"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MPointFromText ? Well-Known Text(WKT)表現と与えられたSRIDからジオメトリを生成します。SRIDを与えない場合は-1(不明)となります。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_MPointFromText</b>(</code>text  <var class="pdparam">WKT</var>, integer  <var class="pdparam">srid</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_MPointFromText</b>(</code>text  <var class="pdparam">WKT</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287002870"></a><h2>説明</h2><p>Well-Known Text(WKT)表現と与えられたSRIDからジオメトリを生成します。SRIDを与えない場合は-1(不明)となります。</p><p>OGC SPEC 3.2.6.2 - option SRID is from the conformance
			suite</p><p>WKTがMULTIPOINTでない場合はNULLを返します。 </p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>全てのWKTジオメトリがマルチポイントであると絶対的な確信を持てる場合は、この関数は使わないでください。付加的な評価ステップが追加されるのでST_GeomFromTextより遅いです。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です 3.2.6.2</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 9.2.4</p></div><div class="refsection" title="例"><a name="id287002921"></a><h2>例</h2><pre class="programlisting">SELECT ST_MPointFromText('MULTIPOINT(1 2, 3 4)');
SELECT ST_MPointFromText('MULTIPOINT(-70.9590 42.1180, -70.9611 42.1223)', 4326);</pre></div><div class="refsection" title="関連情報"><a name="id287002935"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a></p></div></div><div class="refentry" title="ST_MPolyFromText"><div class="refentry.separator"><hr></div><a name="ST_MPolyFromText"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MPolyFromText ? Well-Known Text(WKT)表現と与えられたSRIDからマルチポリゴンを生成します。SRIDを与えない場合は-1(不明)となります。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_MPolyFromText</b>(</code>text  <var class="pdparam">WKT</var>, integer  <var class="pdparam">srid</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_MPolyFromText</b>(</code>text  <var class="pdparam">WKT</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287003012"></a><h2>説明</h2><p>Well-Known Text(WKT)表現と与えられたSRIDからマルチポリゴンを生成します。SRIDを与えない場合は-1(不明)となります。</p><p>OGC SPEC 3.2.6.2 - option SRID is from the conformance suite</p><p>WKTがMULTIPOLYGONでない場合はエラーを投げます。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>全てのWKTジオメトリがマルチポリゴンであると絶対的な確信を持てる場合は、この関数は使わないでください。付加的な評価ステップが追加されるのでST_GeomFromTextより遅いです。 </p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です s3.2.6.2</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 9.6.4</p></div><div class="refsection" title="例"><a name="id287003063"></a><h2>例</h2><pre class="programlisting">SELECT ST_MPolyFromText('MULTIPOLYGON(((0 0 1,20 0 1,20 20 1,0 20 1,0 0 1),(5 5 3,5 7 3,7 7 3,7 5 3,5 5 3)))');
SELECt ST_MPolyFromText('MULTIPOLYGON(((-70.916 42.1002,-70.9468 42.0946,-70.9765 42.0872,-70.9754 42.0875,-70.9749 42.0879,-70.9752 42.0881,-70.9754 42.0891,-70.9758 42.0894,-70.9759 42.0897,-70.9759 42.0899,-70.9754 42.0902,-70.9756 42.0906,-70.9753 42.0907,-70.9753 42.0917,-70.9757 42.0924,-70.9755 42.0928,-70.9755 42.0942,-70.9751 42.0948,-70.9755 42.0953,-70.9751 42.0958,-70.9751 42.0962,-70.9759 42.0983,-70.9767 42.0987,-70.9768 42.0991,-70.9771 42.0997,-70.9771 42.1003,-70.9768 42.1005,-70.977 42.1011,-70.9766 42.1019,-70.9768 42.1026,-70.9769 42.1033,-70.9775 42.1042,-70.9773 42.1043,-70.9776 42.1043,-70.9778 42.1048,-70.9773 42.1058,-70.9774 42.1061,-70.9779 42.1065,-70.9782 42.1078,-70.9788 42.1085,-70.9798 42.1087,-70.9806 42.109,-70.9807 42.1093,-70.9806 42.1099,-70.9809 42.1109,-70.9808 42.1112,-70.9798 42.1116,-70.9792 42.1127,-70.979 42.1129,-70.9787 42.1134,-70.979 42.1139,-70.9791 42.1141,-70.9987 42.1116,-71.0022 42.1273,
	-70.9408 42.1513,-70.9315 42.1165,-70.916 42.1002)))',4326);
</pre></div><div class="refsection" title="関連情報"><a name="id287003077"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a>, <a class="xref" href="#ST_SRID" title="ST_SRID">ST_SRID</a></p></div></div><div class="refentry" title="ST_Point"><div class="refentry.separator"><hr></div><a name="ST_Point"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Point ? 与えられた座標値のST_Pointを返します。ST_MakePointのOGC別名です。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Point</b>(</code>float  <var class="pdparam">x_lon</var>, float  <var class="pdparam">y_lat</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287003139"></a><h2>説明</h2><p>与えられた座標値のST_Pointを返します。XとYを取るST_MakePointのMM対応の別名です。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 6.1.2</p></div><div class="refsection" title="例: ジオメトリ"><a name="id287003161"></a><h2>例: ジオメトリ</h2><pre class="programlisting">SELECT ST_SetSRID(ST_Point(-71.1043443253471, 42.3150676015829),4326)</pre></div><div class="refsection" title="例: ジオグラフィ"><a name="id287003172"></a><h2>例: ジオグラフィ</h2><pre class="programlisting">SELECT CAST(ST_SetSRID(ST_Point(-71.1043443253471, 42.3150676015829),4326) As geography);</pre><pre class="programlisting">-- "::"はPostgreSQLのキャストの簡略表現です
SELECT ST_SetSRID(ST_Point(-71.1043443253471, 42.3150676015829),4326)::geography;</pre><pre class="programlisting">--ポイント座標がWGS 84経度緯度と
-- 異なる座標系の場合には、
-- キャスト前に投影変換が必要です。
-- この例では、
-- ペンシルベニア州平面(フィート)からWGS 84に投影変換したうえで
-- ジオグラフィに変換しています。
SELECT ST_Transform(ST_SetSRID(ST_Point(3637510, 3014852),2273),4326)::geography;</pre></div><div class="refsection" title="関連情報"><a name="id287003193"></a><h2>関連情報</h2><p><a class="xref" href="#Geography_Basics" title="4.2.1. ジオグラフィ基礎">「ジオグラフィ基礎」</a>, <a class="xref" href="#ST_MakePoint" title="ST_MakePoint">ST_MakePoint</a>, <a class="xref" href="#ST_SetSRID" title="ST_SetSRID">ST_SetSRID</a>, <a class="xref" href="#ST_Transform" title="ST_Transform">ST_Transform</a></p></div></div><div class="refentry" title="ST_PointFromText"><div class="refentry.separator"><hr></div><a name="ST_PointFromText"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_PointFromText ? WKTと与えられたSRIDからポイントジオメトリを生成します。SRIDが与えられていない場合は-1(不明)とします。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_PointFromText</b>(</code>text  <var class="pdparam">WKT</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_PointFromText</b>(</code>text  <var class="pdparam">WKT</var>, integer  <var class="pdparam">srid</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287003315"></a><h2>説明</h2><p>OGC Well-Known Text表現からPostGISのST_Geometryポイントオブジェクトを生成します。SRIDが与えられていない場合は不明(現在は-1)とします。ジオメトリがWKTポイント表現でない場合はNULLを返します。完全に不正なWKTならエラーが投げられます。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_PointFromTextには2つの形式があります。 ひとつめは、SRIDを取らずに空間参照系を定義していないジオメトリを返すものです。 ふたつめは、空間参照系識別番号を第2引数に取り、SRIDをメタデータの一部として含むST_Geometryを返すものです。SRIDはspatial_ref_sysテーブルで定義されていなければなりません。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>全てのWKTジオメトリがジオメトリコレクションであると絶対的な確信を持てる場合は、この関数は使わないでください。付加的な評価ステップが追加されるのでST_GeomFromTextより遅いです。 経度緯度座標からポイントを生成していて、OGC対応よりもパフォーマンスと精度を重視する場合は、<a class="xref" href="#ST_MakePoint" title="ST_MakePoint">ST_MakePoint</a>か、OGC対応の別名<a class="xref" href="#ST_Point" title="ST_Point">ST_Point</a>を使用して下さい。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です s3.2.6.2 - option SRID is from the conformance suite.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 6.1.8</p></div><div class="refsection" title="例"><a name="id287003373"></a><h2>例</h2><pre class="programlisting">
SELECT ST_PointFromText('POINT(-71.064544 42.28787)');
SELECT ST_PointFromText('POINT(-71.064544 42.28787)', 4326);
	</pre></div><div class="refsection" title="関連情報"><a name="id287003728"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a>, <a class="xref" href="#ST_MakePoint" title="ST_MakePoint">ST_MakePoint</a>, <a class="xref" href="#ST_Point" title="ST_Point">ST_Point</a>, <a class="xref" href="#ST_SRID" title="ST_SRID">ST_SRID</a></p></div></div><div class="refentry" title="ST_PointFromWKB"><div class="refentry.separator"><hr></div><a name="ST_PointFromWKB"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_PointFromWKB ? WKBと与えられたSRIDからジオメトリを生成します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_GeomFromWKB</b>(</code>bytea  <var class="pdparam">geom</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_GeomFromWKB</b>(</code>bytea  <var class="pdparam">geom</var>, integer  <var class="pdparam">srid</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287003814"></a><h2>説明</h2><p><code class="varname">ST_PointFromWKB</code>は、ジオメトリのWell-Known Binary表現と空間参照系識別番号(SRID)を取り、適切なジオメトリ型のインスタンスを生成します。この場合、<code class="varname">POINT</code>ジオメトリです。この関数はSQLのジオメトリファクトリの役割を果たします。</p><p>SRIDが指定されていない場合は-1(不明)となります。入力<code class="varname">bytea</code>がPOINTジオメトリを表現しないなら<code class="varname">NULL</code>が返されます。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です s3.2.7.2</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 6.1.9</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p></div><div class="refsection" title="例"><a name="id287003889"></a><h2>例</h2><pre class="programlisting">SELECT
  ST_AsText(
	ST_PointFromWKB(
	  ST_AsEWKB('POINT(2 5)'::geometry)
	)
  );
 st_astext
------------
 POINT(2 5)
(1 row)

SELECT
  ST_AsText(
	ST_PointFromWKB(
	  ST_AsEWKB('LINESTRING(2 5, 2 6)'::geometry)
	)
  );
 st_astext
-----------

(1 row)</pre></div><div class="refsection" title="関連情報"><a name="id287003901"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeomFromWKB" title="ST_GeomFromWKB">ST_GeomFromWKB</a>, <a class="xref" href="#ST_LineFromWKB" title="ST_LineFromWKB">ST_LineFromWKB</a></p></div></div><div class="refentry" title="ST_Polygon"><div class="refentry.separator"><hr></div><a name="ST_Polygon"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Polygon ? 指定されたラインストリングとSRIDからポリゴンを生成します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Polygon</b>(</code>geometry  <var class="pdparam">aLineString</var>, integer  <var class="pdparam">srid</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287003997"></a><h2>説明</h2><p>指定されたラインストリングとSRIDからポリゴンを生成します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_PolygonはST_MakePolygonのひとつめの形式に似ていますが、ポリゴンの空間参照系識別番号(SRID)を渡す点が異なります。MULTILINESTRINGでは動作しません。LineMergeでマルチラインをマージして下さい。また、内環をもつポリゴンを生成しません。ST_MakePolygonを使用して下さい。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 8.3.2</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p></div><div class="refsection" title="例"><a name="id287004055"></a><h2>例</h2><pre class="programlisting">
-- 2次元ポリゴン
SELECT ST_Polygon(ST_GeomFromText('LINESTRING(75.15 29.53,77 29,77.6 29.5, 75.15 29.53)'), 4326);

-- 結果 --
POLYGON((75.15 29.53,77 29,77.6 29.5,75.15 29.53))
-- 3次元ポリゴン
SELECT ST_AsEWKT(ST_Polygon(ST_GeomFromEWKT('LINESTRING(75.15 29.53 1,77 29 1,77.6 29.5 1, 75.15 29.53 1)'), 4326));

result
------
SRID=4326;POLYGON((75.15 29.53 1,77 29 1,77.6 29.5 1,75.15 29.53 1))
			</pre></div><div class="refsection" title="関連情報"><a name="id287004068"></a><h2>関連情報</h2><p> <a class="xref" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a>, <a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a>, <a class="xref" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a>, <a class="xref" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a>, <a class="xref" href="#ST_LineMerge" title="ST_LineMerge">ST_LineMerge</a>, <a class="xref" href="#ST_MakePolygon" title="ST_MakePolygon">ST_MakePolygon</a></p></div></div><div class="refentry" title="ST_PolygonFromText"><div class="refentry.separator"><hr></div><a name="ST_PolygonFromText"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_PolygonFromText ? WKTと与えられたSRIDからジオメトリを生成します。SRIDが与えられていない場合は-1(不明)とします。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_PolygonFromText</b>(</code>text  <var class="pdparam">WKT</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_PolygonFromText</b>(</code>text  <var class="pdparam">WKT</var>, integer  <var class="pdparam">srid</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287004231"></a><h2>説明</h2><p>MWKTと与えられたSRIDからジオメトリを生成します。SRIDが与えられていない場合は-1(不明)とします。WKTがポリゴンでない場合はNULLを返します。 </p><p>OGC SPEC 3.2.6.2 - option SRID is from the conformance
			suite</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>全てのWKTジオメトリがポリゴンであると絶対的な確信を持てる場合は、この関数は使わないでください。付加的な評価ステップが追加されるのでST_GeomFromTextより遅いです。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です s3.2.6.2</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 8.3.6</p></div><div class="refsection" title="例"><a name="id287004276"></a><h2>例</h2><pre class="programlisting">SELECT ST_PolygonFromText('POLYGON((-71.1776585052917 42.3902909739571,-71.1776820268866 42.3903701743239,
-71.1776063012595 42.3903825660754,-71.1775826583081 42.3903033653531,-71.1776585052917 42.3902909739571))');
st_polygonfromtext
------------------
010300000001000000050000006...


SELECT ST_PolygonFromText('POINT(1 2)') IS NULL as point_is_notpoly;

point_is_not_poly
----------
t
</pre></div><div class="refsection" title="関連情報"><a name="id287004289"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a></p></div></div><div class="refentry" title="ST_WKBToSQL"><div class="refentry.separator"><hr></div><a name="ST_WKBToSQL"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_WKBToSQL ? Well-Known Binary表現(WKB)からST_Geometry値を生成します。これはSRIDを取らないST_GeomFromWKBの別名です。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_WKBToSQL</b>(</code>bytea  <var class="pdparam">WKB</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287004339"></a><h2>説明</h2><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.36</p></div><div class="refsection" title="関連情報"><a name="id287004358"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeomFromWKB" title="ST_GeomFromWKB">ST_GeomFromWKB</a></p></div></div><div class="refentry" title="ST_WKTToSQL"><div class="refentry.separator"><hr></div><a name="ST_WKTToSQL"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_WKTToSQL ? Well-Known Text表現(WKT)からST_Geometry値を生成します。これはSRIDを取らないST_GeomFromTextの別名です。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_WKTToSQL</b>(</code>text  <var class="pdparam">WKT</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287004408"></a><h2>説明</h2><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.34</p></div><div class="refsection" title="関連情報"><a name="id287004427"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a></p></div></div></div><div class="sect1" title="8.4. ジオメトリ アクセサ"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Geometry_Accessors"></a>8.4. ジオメトリ アクセサ</h2></div></div></div><div class="toc"><dl><dt><span class="refentrytitle"><a href="#GeometryType">GeometryType</a></span><span class="refpurpose"> ? ジオメトリ型を'LINESTRING', 'POLYGON', 'MULTIPOINT'などの文字列で返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Boundary">ST_Boundary</a></span><span class="refpurpose"> ? ジオメトリの組み合わせ境界の閉包を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_CoordDim">ST_CoordDim</a></span><span class="refpurpose"> ? ST_Geometry値の座標次元を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Dimension">ST_Dimension</a></span><span class="refpurpose"> ? ジオメトリの固有次元を返します。座標次元以下でなければなりません。</span></dt><dt><span class="refentrytitle"><a href="#ST_EndPoint">ST_EndPoint</a></span><span class="refpurpose"> ? <code class="varname">LINESTRING</code>の最後のポイントを<code class="varname">POINT</code>で返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Envelope">ST_Envelope</a></span><span class="refpurpose"> ? ジオメトリの浮動小数点数(float8)バウンディングボックスを表現するジオメトリを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_ExteriorRing">ST_ExteriorRing</a></span><span class="refpurpose"> ? <code class="varname">POLYGON</code>の外環を表現するラインストリングを返します。ジオメトリがポリゴンでない場合はNULLを返します。マルチポリゴンでは動作しません。</span></dt><dt><span class="refentrytitle"><a href="#ST_GeometryN">ST_GeometryN</a></span><span class="refpurpose"> ? GEOMETRYCOLLECTION, MULTIPOINT, MULTILINESTRING, MULTICURVE, MULTIPOLYGONの場合には、1はじまりでN番目のジオメトリを返します。それ以外の場合にはNULLを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_GeometryType">ST_GeometryType</a></span><span class="refpurpose"> ? ST_Geometry値のジオメトリ型を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_InteriorRingN">ST_InteriorRingN</a></span><span class="refpurpose"> ? ポリゴンのN番目の内環を返します。ジオメトリがポリゴンでないかNが範囲外の場合はNULLを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_IsClosed">ST_IsClosed</a></span><span class="refpurpose"> ? <code class="varname">LINESTRING</code>の始点と終点が一致する場合に<code class="varname">TRUE</code>を返します。多面体サーフェスの場合は閉じています(ボリュームです)。</span></dt><dt><span class="refentrytitle"><a href="#ST_IsCollection">ST_IsCollection</a></span><span class="refpurpose"> ? 引数がコレクション(<code class="varname">MULTI*</code>, <code class="varname">GEOMETRYCOLLECTION</code>, ...)の場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_IsEmpty">ST_IsEmpty</a></span><span class="refpurpose"> ? ジオメトリが、空のジオメトリコレクション、ポリゴン、ポイント等の場合に、trueを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_IsRing">ST_IsRing</a></span><span class="refpurpose"> ? <code class="varname">LINESTRING</code>が閉じていて、かつ単純である場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_IsSimple">ST_IsSimple</a></span><span class="refpurpose"> ? ジオメトリが自己インタセクションや自己接触のような異常な幾何学ポイントを持っていない場合にTRUEを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_IsValid">ST_IsValid</a></span><span class="refpurpose"> ? <code class="varname">ST_Geometry</code>が整形されている場合に<code class="varname">true</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_IsValidReason">ST_IsValidReason</a></span><span class="refpurpose"> ? ジオメトリが妥当か否かを示すテキストを返し、不正な場合は理由を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_IsValidDetail">ST_IsValidDetail</a></span><span class="refpurpose"> ? ジオメトリが妥当か否かを示すvalid_detail (valid,reason,location)行を返します。不正である場合には、理由と位置を示します。</span></dt><dt><span class="refentrytitle"><a href="#ST_M">ST_M</a></span><span class="refpurpose"> ? ポイントのM座標値を返し、有効でないならNULLを返します。入力はポイントでなければなりません。</span></dt><dt><span class="refentrytitle"><a href="#ST_NDims">ST_NDims</a></span><span class="refpurpose"> ? オメトリの座標次元をsmall intで返します。値は2, 3, 4のいずれかです。</span></dt><dt><span class="refentrytitle"><a href="#ST_NPoints">ST_NPoints</a></span><span class="refpurpose"> ? ジオメトリのポイント(バーテック)数を返します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_NRings">ST_NRings</a></span><span class="refpurpose"> ? ジオメトリがポリゴンまたはマルチポリゴンの場合、リング数を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_NumGeometries">ST_NumGeometries</a></span><span class="refpurpose"> ? ジオメトリがジオメトリコレクションまたはマルチ系の場合はジオメトリの数を、単一のジオメトリの場合は1を返し、それ以外の場合はNULLを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_NumInteriorRings">ST_NumInteriorRings</a></span><span class="refpurpose"> ? ジオメトリの最初のポリゴンの内環数を返します。この関数はポリゴンとマルチポリゴンの両方で動作しますが、最初のポリゴンしか見ません。ジオメトリにポリゴンが存在しない場合はNULLを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_NumInteriorRing">ST_NumInteriorRing</a></span><span class="refpurpose"> ? ジオメトリの最初のポリゴンの内環の数を返します。ST_NumInteriorRingsと同義です。</span></dt><dt><span class="refentrytitle"><a href="#ST_NumPatches">ST_NumPatches</a></span><span class="refpurpose"> ? 多面体サーフェスのフェイス数を返します。多面体でないジオメトリの場合にはNULLを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_NumPoints">ST_NumPoints</a></span><span class="refpurpose"> ? ST_LineStringまたはST_CircularStringのポイント数を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_PatchN">ST_PatchN</a></span><span class="refpurpose"> ? ジオメトリがPOLYHEDRALSURFACEかPOLYHEDRALSURFACEMの場合には、1はじまりでN番目のジオメトリ(フェイス)を返します。それ以外の場合には、NULLを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_PointN">ST_PointN</a></span><span class="refpurpose"> ? ジオメトリの最初のラインストリングまたは曲線ストリングのN番目のポイントを返します。ラインストリングが存在しない場合はNULLを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_SRID">ST_SRID</a></span><span class="refpurpose"> ? ST_Geometryのspatial_ref_sysテーブルで定義されている空間参照系の識別番号を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_StartPoint">ST_StartPoint</a></span><span class="refpurpose"> ? <code class="varname">LINESTRING</code>の最初のポイントを<code class="varname">POINT</code>として返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Summary">ST_Summary</a></span><span class="refpurpose"> ? 
ジオメトリについての要約文を返します。
		</span></dt><dt><span class="refentrytitle"><a href="#ST_X">ST_X</a></span><span class="refpurpose"> ? ポイントのX座標値を返し、有効でないならNULLを返します。入力はポイントでなければなりません。</span></dt><dt><span class="refentrytitle"><a href="#ST_XMax">ST_XMax</a></span><span class="refpurpose"> ? 2次元,3次元バウンディングボックスまたはジオメトリにおけるXの最大値を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_XMin">ST_XMin</a></span><span class="refpurpose"> ? 2次元,3次元バウンディングボックスまたはジオメトリにおけるXの最小値を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Y">ST_Y</a></span><span class="refpurpose"> ? ポイントのY座標値を返し、有効でないならNULLを返します。入力はポイントでなければなりません。</span></dt><dt><span class="refentrytitle"><a href="#ST_YMax">ST_YMax</a></span><span class="refpurpose"> ? 2次元,3次元バウンディングボックスまたはジオメトリにおけるYの最大値を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_YMin">ST_YMin</a></span><span class="refpurpose"> ? 2次元,3次元バウンディングボックスまたはジオメトリにおけるYの最小値を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Z">ST_Z</a></span><span class="refpurpose"> ? ポイントのZ座標値を返し、有効でないならNULLを返します。入力はポイントでなければなりません。</span></dt><dt><span class="refentrytitle"><a href="#ST_ZMax">ST_ZMax</a></span><span class="refpurpose"> ? 2次元,3次元バウンディングボックスまたはジオメトリにおけるZの最大値を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Zmflag">ST_Zmflag</a></span><span class="refpurpose"> ? ポイントのZM(次元の意味)フラグをsmall intで返します。値は 0=XY, 1=XYM, 2=XYZ, 3=XYZMとなります。</span></dt><dt><span class="refentrytitle"><a href="#ST_ZMin">ST_ZMin</a></span><span class="refpurpose"> ? 2次元または3次元ジオメトリのバウンディングボックスにおけるZの最小値を返します。</span></dt></dl></div><div class="refentry" title="GeometryType"><a name="GeometryType"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>GeometryType ? ジオメトリ型を'LINESTRING', 'POLYGON', 'MULTIPOINT'などの文字列で返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">GeometryType</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287009960"></a><h2>説明</h2><p>ジオメトリ型を'LINESTRING', 'POLYGON', 'MULTIPOINT'などの文字列で返します。</p><p>OGC SPEC s2.1.1.1 - Returns the name of the instantiable
		subtype of Geometry of which this Geometry instance is a member.
		The name of the instantiable subtype of Geometry is returned as a
		string.</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数は、'POINTM'等が返るので、ジオメトリがM値を持っているかどうかも示します。 </p></td></tr></table></div><p>機能強化: 2.0.0で多面体サーフェス、三角、TINが導入されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は多面体サーフェスに対応しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は三角形と不規則三角網(TIN)に対応しています。</p></div><div class="refsection" title="例"><a name="id287010043"></a><h2>例</h2><pre class="programlisting">SELECT GeometryType(ST_GeomFromText('LINESTRING(77.29 29.07,77.42 29.26,77.27 29.31,77.29 29.07)'));
 geometrytype
--------------
 LINESTRING
</pre><pre class="programlisting">SELECT ST_GeometryType(ST_GeomFromEWKT('POLYHEDRALSURFACE( ((0 0 0, 0 0 1, 0 1 1, 0 1 0, 0 0 0)), 
		((0 0 0, 0 1 0, 1 1 0, 1 0 0, 0 0 0)), ((0 0 0, 1 0 0, 1 0 1, 0 0 1, 0 0 0)), 
		((1 1 0, 1 1 1, 1 0 1, 1 0 0, 1 1 0)), 
		((0 1 0, 0 1 1, 1 1 1, 1 1 0, 0 1 0)), ((0 0 1, 1 0 1, 1 1 1, 0 1 1, 0 0 1)) )'));
			--result
			POLYHEDRALSURFACE
			</pre><pre class="programlisting">SELECT GeometryType(geom) as result
  FROM
    (SELECT 
       ST_GeomFromEWKT('TIN (((
                0 0 0, 
                0 0 1, 
                0 1 0, 
                0 0 0
            )), ((
                0 0 0, 
                0 1 0, 
                1 1 0, 
                0 0 0
            ))
            )')  AS geom
    ) AS g;
 result
--------
 TIN    </pre></div><div class="refsection" title="追加情報"><a name="id287010066"></a><h2>追加情報</h2><p><a class="xref" href="#ST_GeometryType" title="ST_GeometryType">ST_GeometryType</a></p></div></div><div class="refentry" title="ST_Boundary"><div class="refentry.separator"><hr></div><a name="ST_Boundary"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Boundary ? ジオメトリの組み合わせ境界の閉包を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Boundary</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287010115"></a><h2>説明</h2><p>ジオメトリの組み合わせ境界の閉包を返します(訳注: ラインストリングは端点、ポリゴンはエッジ、複合オブジェクトは境界のうち奇数番)。組み合わせ境界はOGC仕様の3.12.3.2節に記述されています。結果として出てくる境界は、OGC SPEC 3.12.2で議論されているように、ジオメトリプリミティブを使って表現できます。</p><p>この関数はGEOSモジュールによって実現しています。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>2.0.0より前の版では、この関数は<code class="varname">GEOMETRYCOLLECTION</code>を与えると例外を投げました。2.0.0以上では替りにNULLが返ります(非対応入力)。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です OGC SPEC s2.1.1.1</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.14</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p></div><div class="refsection" title="例"><a name="id287010177"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(ST_Boundary(ST_GeomFromText('LINESTRING(1 1,0 0, -1 1)')));
st_astext
-----------
MULTIPOINT(1 1,-1 1)

SELECT ST_AsText(ST_Boundary(ST_GeomFromText('POLYGON((1 1,0 0, -1 1, 1 1))')));
st_astext
----------
LINESTRING(1 1,0 0,-1 1,1 1)

--Using a 3d polygon
SELECT ST_AsEWKT(ST_Boundary(ST_GeomFromEWKT('POLYGON((1 1 1,0 0 1, -1 1 1, 1 1 1))')));

st_asewkt
-----------------------------------
LINESTRING(1 1 1,0 0 1,-1 1 1,1 1 1)

--Using a 3d multilinestring
SELECT ST_AsEWKT(ST_Boundary(ST_GeomFromEWKT('MULTILINESTRING((1 1 1,0 0 0.5, -1 1 1),(1 1 0.5,0 0 0.5, -1 1 0.5, 1 1 0.5) )')));

st_asewkt
----------
MULTIPOINT(-1 1 1,1 1 0.75)
</pre></div><div class="refsection" title="追加情報"><a name="id287010187"></a><h2>追加情報</h2><p><a class="xref" href="#ST_ExteriorRing" title="ST_ExteriorRing">ST_ExteriorRing</a>, <a class="xref" href="#ST_MakePolygon" title="ST_MakePolygon">ST_MakePolygon</a></p></div></div><div class="refentry" title="ST_CoordDim"><div class="refentry.separator"><hr></div><a name="ST_CoordDim"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_CoordDim ? ST_Geometry値の座標次元を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_CoordDim</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287010275"></a><h2>説明</h2><p>ST_Geometry値の座標次元を返します。</p><p>この関数は<a class="xref" href="#ST_NDims" title="ST_NDims">ST_NDims</a>のMM対応の別名です。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.3</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は多面体サーフェスに対応しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は三角形と不規則三角網(TIN)に対応しています。</p></div><div class="refsection" title="例"><a name="id287010363"></a><h2>例</h2><pre class="programlisting">SELECT ST_CoordDim('CIRCULARSTRING(1 2 3, 1 3 4, 5 6 7, 8 9 10, 11 12 13)');
			---result--
				3

				SELECT ST_CoordDim(ST_Point(1,2));
			--result--
				2

		</pre></div><div class="refsection" title="追加情報"><a name="id287010377"></a><h2>追加情報</h2><p><a class="xref" href="#ST_NDims" title="ST_NDims">ST_NDims</a></p></div></div><div class="refentry" title="ST_Dimension"><div class="refentry.separator"><hr></div><a name="ST_Dimension"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Dimension ? ジオメトリの固有次元を返します。座標次元以下でなければなりません。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_Dimension</b>(</code>geometry  <var class="pdparam">g</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287010426"></a><h2>説明</h2><p>ジオメトリの固有次元を返します。座標次元以下でなければなりません。 OGC SPEC s2.1.1.1 - 0なら<code class="varname">POINT</code>、1なら<code class="varname">LINESTRING</code>、2なら<code class="varname">POLYGON</code>で、<code class="varname">GEOMETRYCOLLECTION</code>の場合は要素ごとの次元の最大値です。不明なジオメトリ(空ジオメトリ)の場合はNULLが返ります。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.2</p><p>機能強化: 2.0.0で多面体サーフェスとTINが導入されました。空ジオメトリを与えた場合に例外を投げなくなりました。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>2.0.0より前では、空ジオメトリを与えると例外を投げていました。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は多面体サーフェスに対応しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は三角形と不規則三角網(TIN)に対応しています。</p></div><div class="refsection" title="例"><a name="id287010496"></a><h2>例</h2><pre class="programlisting">SELECT ST_Dimension('GEOMETRYCOLLECTION(LINESTRING(1 1,0 0),POINT(0 0))');
ST_Dimension
-----------
1
</pre></div><div class="refsection" title="追加情報"><a name="id287010506"></a><h2>追加情報</h2><p><a class="xref" href="#ST_NDims" title="ST_NDims">ST_NDims</a></p></div></div><div class="refentry" title="ST_EndPoint"><div class="refentry.separator"><hr></div><a name="ST_EndPoint"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_EndPoint ? <code class="varname">LINESTRING</code>の最後のポイントを<code class="varname">POINT</code>で返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_EndPoint</b>(</code>geometry  <var class="pdparam">g</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287010562"></a><h2>説明</h2><p><code class="varname">LINESTRING</code>の最後のポイントを<code class="varname">POINT</code>で返します。パラメタが<code class="varname">LINESTRING</code>でない場合は<code class="varname">NULL</code>を返します。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 7.1.4</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>変更: 2.0.0では単一ジオメトリのMULTILINESTRINGで動作しなくなりました。単一のラインストリングからなるMULTILINESTRINGについては幸運にも動いていて、最初のポイントを返していました。2.0.0では他のMULTILINESTRINGと同様にNULLを返すようになりました。古い振る舞いは記載されていませんでしたが、LINESTRINGとして格納されているデータを持っていると思われる人々は2.0でNULLが返って来ることを経験することでしょう。</p></td></tr></table></div></div><div class="refsection" title="例"><a name="id287010681"></a><h2>例</h2><pre class="programlisting">postgis=# SELECT ST_AsText(ST_EndPoint('LINESTRING(1 1, 2 2, 3 3)'::geometry));
 st_astext
------------
 POINT(3 3)
(1 row)

postgis=# SELECT ST_EndPoint('POINT(1 1)'::geometry) IS NULL AS is_null;
  is_null
----------
 t
(1 row)

--3d endpoint
SELECT ST_AsEWKT(ST_EndPoint('LINESTRING(1 1 2, 1 2 3, 0 0 5)'));
  st_asewkt
--------------
 POINT(0 0 5)
(1 row)
</pre></div><div class="refsection" title="追加情報"><a name="id287010692"></a><h2>追加情報</h2><p><a class="xref" href="#ST_PointN" title="ST_PointN">ST_PointN</a>, <a class="xref" href="#ST_StartPoint" title="ST_StartPoint">ST_StartPoint</a></p></div></div><div class="refentry" title="ST_Envelope"><div class="refentry.separator"><hr></div><a name="ST_Envelope"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Envelope ? ジオメトリの浮動小数点数(float8)バウンディングボックスを表現するジオメトリを返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Envelope</b>(</code>geometry  <var class="pdparam">g1</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287010746"></a><h2>説明</h2><p>ジオメトリのfloat8数の最小バウンディングボックスをジオメトリとして返します。バウンディングボックスの角で定義されたポリゴンで、((<code class="varname">MINX</code>, <code class="varname">MINY</code>), (<code class="varname">MINX</code>, <code class="varname">MAXY</code>), (<code class="varname">MAXX</code>, <code class="varname">MAXY</code>), (<code class="varname">MAXX</code>, <code class="varname">MINY</code>), (<code class="varname">MINX</code>, <code class="varname">MINY</code>))となります。可能なら<code class="varname">ZMIN</code>/<code class="varname">ZMAX</code>座標が追加されます。</p><p>縮退する場合(縦のライン、ポイント)は、<code class="varname">POLYGON</code>より低い次元のジオメトリ、すなわち<code class="varname">POINT</code>または<code class="varname">LINESTRING</code>を返します。</p><p>初出: 1.5.0で振る舞いが変更され出力がfloat4からfloat8になりました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です s2.1.1.1</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.15</p></div><div class="refsection" title="例"><a name="id287010839"></a><h2>例</h2><pre class="programlisting">
SELECT ST_AsText(ST_Envelope('POINT(1 3)'::geometry));
 st_astext
------------
 POINT(1 3)
(1 row)


SELECT ST_AsText(ST_Envelope('LINESTRING(0 0, 1 3)'::geometry));
		   st_astext
--------------------------------
 POLYGON((0 0,0 3,1 3,1 0,0 0))
(1 row)


SELECT ST_AsText(ST_Envelope('POLYGON((0 0, 0 1, 1.0000001 1, 1.0000001 0, 0 0))'::geometry));
						  st_astext
--------------------------------------------------------------
 POLYGON((0 0,0 1,1.00000011920929 1,1.00000011920929 0,0 0))
(1 row)
SELECT ST_AsText(ST_Envelope('POLYGON((0 0, 0 1, 1.0000000001 1, 1.0000000001 0, 0 0))'::geometry));
						  st_astext
--------------------------------------------------------------
 POLYGON((0 0,0 1,1.00000011920929 1,1.00000011920929 0,0 0))
(1 row)
	
SELECT Box3D(geom), Box2D(geom), ST_AsText(ST_Envelope(geom)) As envelopewkt
	FROM (SELECT 'POLYGON((0 0, 0 1000012333334.34545678, 1.0000001 1, 1.0000001 0, 0 0))'::geometry As geom) As foo;


	</pre></div><div class="refsection" title="追加情報"><a name="id287010887"></a><h2>追加情報</h2><p><a class="xref" href="#Box2D" title="Box2D">Box2D</a>, <a class="xref" href="#Box3D" title="Box3D">Box3D</a></p></div></div><div class="refentry" title="ST_ExteriorRing"><div class="refentry.separator"><hr></div><a name="ST_ExteriorRing"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ExteriorRing ? <code class="varname">POLYGON</code>の外環を表現するラインストリングを返します。ジオメトリがポリゴンでない場合はNULLを返します。マルチポリゴンでは動作しません。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_ExteriorRing</b>(</code>geometry  <var class="pdparam">a_polygon</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287010941"></a><h2>説明</h2><p><code class="varname">POLYGON</code>の外環を表現するラインストリングを返します。ジオメトリがポリゴンでない場合はNULLを返します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>POLYGONタイプでのみ動作します。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です 2.1.5.1</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 8.2.3, 8.3.3</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p></div><div class="refsection" title="例"><a name="id287010998"></a><h2>例</h2><pre class="programlisting">
-- ポリゴンのテーブルを持っているとします
SELECT gid, ST_ExteriorRing(the_geom) AS ering
FROM sometable;

-- マルチポリゴンのテーブルを持っていて、
-- それぞれのポリゴンの外環からなるマルチラインストリングを返させたいとします。
SELECT gid, ST_Collect(ST_ExteriorRing(the_geom)) AS erings
	FROM (SELECT gid, (ST_Dump(the_geom)).geom As the_geom
			FROM sometable) As foo
GROUP BY gid;

-- 2次元の例
SELECT ST_AsEWKT(
	ST_ExteriorRing(
	ST_GeomFromEWKT('POLYGON((0 0 1, 1 1 1, 1 2 1, 1 1 1, 0 0 1))')
	)
);

st_asewkt
---------
LINESTRING(0 0 1,1 1 1,1 2 1,1 1 1,0 0 1)
</pre></div><div class="refsection" title="追加情報"><a name="id287011009"></a><h2>追加情報</h2><p>
<a class="xref" href="#ST_InteriorRingN" title="ST_InteriorRingN">ST_InteriorRingN</a>,
<a class="xref" href="#ST_Boundary" title="ST_Boundary">ST_Boundary</a>,
<a class="xref" href="#ST_NumInteriorRings" title="ST_NumInteriorRings">ST_NumInteriorRings</a>
		</p></div></div><div class="refentry" title="ST_GeometryN"><div class="refentry.separator"><hr></div><a name="ST_GeometryN"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_GeometryN ? GEOMETRYCOLLECTION, MULTIPOINT, MULTILINESTRING, MULTICURVE, MULTIPOLYGONの場合には、1はじまりでN番目のジオメトリを返します。それ以外の場合にはNULLを返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_GeometryN</b>(</code>geometry  <var class="pdparam">geomA</var>, integer  <var class="pdparam">n</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287011076"></a><h2>説明</h2><p>GEOMETRYCOLLECTION, MULTIPOINT, MULTILINESTRING, MULTICURVE, MULTIPOLYGONの場合には、1はじまりでN番目のジオメトリを返します。それ以外の場合にはNULLを返します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>OGC仕様のため0.8.0版からインデクスを1はじまりにしています。これより前の版では0はじまりになっています。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ひとつのジオメトリから全てのジオメトリを抽出したい場合は、ST_Dumpを使う方が効果的ですし、単一ジオメトリにも対応しています。</p></td></tr></table></div><p>機能強化: 2.0.0で、多面体サーフェス、三角形、TINが導入されました。</p><p>変更: 2.0.0以前の版では非マルチのジオメトリではNULLが返りました。ST_GeometryN(..,1)の場合にはジオメトリを返すよう変更されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 9.1.5</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は多面体サーフェスに対応しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は三角形と不規則三角網(TIN)に対応しています。</p></div><div class="refsection" title="標準的な例"><a name="id287011178"></a><h2>標準的な例</h2><pre class="programlisting">-- 3次元マルチポイントから部分集合を抽出
SELECT n, ST_AsEWKT(ST_GeometryN(the_geom, n)) As geomewkt
FROM (
VALUES (ST_GeomFromEWKT('MULTIPOINT(1 2 7, 3 4 7, 5 6 7, 8 9 10)') ),
( ST_GeomFromEWKT('MULTICURVE(CIRCULARSTRING(2.5 2.5,4.5 2.5, 3.5 3.5), (10 11, 12 11))') )
	)As foo(the_geom)
	CROSS JOIN generate_series(1,100) n
WHERE n &lt;= ST_NumGeometries(the_geom);

 n |               geomewkt
---+-----------------------------------------
 1 | POINT(1 2 7)
 2 | POINT(3 4 7)
 3 | POINT(5 6 7)
 4 | POINT(8 9 10)
 1 | CIRCULARSTRING(2.5 2.5,4.5 2.5,3.5 3.5)
 2 | LINESTRING(10 11,12 11)


-- 全てのジオメトリを抽出(idを付けたい場合に便利です)
SELECT gid, n, ST_GeometryN(the_geom, n)
FROM sometable CROSS JOIN generate_series(1,100) n
WHERE n &lt;= ST_NumGeometries(the_geom);</pre></div><div class="refsection" title="多面体サーフェス、三角形、TINの例"><a name="id287011189"></a><h2>多面体サーフェス、三角形、TINの例</h2><pre class="programlisting">-- 多面体サーフェスの例
-- 多面体サーフェスをフェイスにする
SELECT ST_AsEWKT(ST_GeometryN(p_geom,3)) As geom_ewkt
  FROM (SELECT ST_GeomFromEWKT('POLYHEDRALSURFACE( 
((0 0 0, 0 0 1, 0 1 1, 0 1 0, 0 0 0)),  
((0 0 0, 0 1 0, 1 1 0, 1 0 0, 0 0 0)), 
((0 0 0, 1 0 0, 1 0 1, 0 0 1, 0 0 0)), 
((1 1 0, 1 1 1, 1 0 1, 1 0 0, 1 1 0)),  
((0 1 0, 0 1 1, 1 1 1, 1 1 0, 0 1 0)),  
((0 0 1, 1 0 1, 1 1 1, 0 1 1, 0 0 1)) 
)')  AS p_geom )  AS a;

                geom_ewkt
------------------------------------------
 POLYGON((0 0 0,1 0 0,1 0 1,0 0 1,0 0 0))</pre><pre class="programlisting">-- TIN --		
SELECT ST_AsEWKT(ST_GeometryN(geom,2)) as wkt
  FROM
    (SELECT 
       ST_GeomFromEWKT('TIN (((
                0 0 0, 
                0 0 1, 
                0 1 0, 
                0 0 0
            )), ((
                0 0 0, 
                0 1 0, 
                1 1 0, 
                0 0 0
            ))
            )')  AS geom
    ) AS g;
-- result --
                 wkt
-------------------------------------
 TRIANGLE((0 0 0,0 1 0,1 1 0,0 0 0))</pre></div><div class="refsection" title="追加情報"><a name="id287011205"></a><h2>追加情報</h2><p><a class="xref" href="#ST_Dump" title="ST_Dump">ST_Dump</a>, <a class="xref" href="#ST_NumGeometries" title="ST_NumGeometries">ST_NumGeometries</a></p></div></div><div class="refentry" title="ST_GeometryType"><div class="refentry.separator"><hr></div><a name="ST_GeometryType"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_GeometryType ? ST_Geometry値のジオメトリ型を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_GeometryType</b>(</code>geometry  <var class="pdparam">g1</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287011258"></a><h2>説明</h2><p>ジオメトリ型を'ST_Linestring', 'ST_Polygon', 'ST_MultiPolygon'等の文字列で返します。この関数はGeometryType(geometry)とは異なり、先頭に'ST'が付き、M値を持っているかを示しません。</p><p>機能強化: 2.0.0で、多面体サーフェスが導入されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。	SQL-MM 3: 5.1.4</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は多面体サーフェスに対応しています。</p></div><div class="refsection" title="例"><a name="id287011308"></a><h2>例</h2><pre class="programlisting">SELECT ST_GeometryType(ST_GeomFromText('LINESTRING(77.29 29.07,77.42 29.26,77.27 29.31,77.29 29.07)'));
			-- 結果
			ST_LineString</pre><pre class="programlisting">SELECT ST_GeometryType(ST_GeomFromEWKT('POLYHEDRALSURFACE( ((0 0 0, 0 0 1, 0 1 1, 0 1 0, 0 0 0)), 
		((0 0 0, 0 1 0, 1 1 0, 1 0 0, 0 0 0)), ((0 0 0, 1 0 0, 1 0 1, 0 0 1, 0 0 0)), 
		((1 1 0, 1 1 1, 1 0 1, 1 0 0, 1 1 0)), 
		((0 1 0, 0 1 1, 1 1 1, 1 1 0, 0 1 0)), ((0 0 1, 1 0 1, 1 1 1, 0 1 1, 0 0 1)) )'));
			-- 結果
			ST_PolyhedralSurface</pre><pre class="programlisting">SELECT ST_GeometryType(ST_GeomFromEWKT('POLYHEDRALSURFACE( ((0 0 0, 0 0 1, 0 1 1, 0 1 0, 0 0 0)), 
		((0 0 0, 0 1 0, 1 1 0, 1 0 0, 0 0 0)), ((0 0 0, 1 0 0, 1 0 1, 0 0 1, 0 0 0)), 
		((1 1 0, 1 1 1, 1 0 1, 1 0 0, 1 1 0)), 
		((0 1 0, 0 1 1, 1 1 1, 1 1 0, 0 1 0)), ((0 0 1, 1 0 1, 1 1 1, 0 1 1, 0 0 1)) )'));
			-- 結果
			ST_PolyhedralSurface</pre><pre class="programlisting">SELECT ST_GeometryType(geom) as result
  FROM
    (SELECT 
       ST_GeomFromEWKT('TIN (((
                0 0 0, 
                0 0 1, 
                0 1 0, 
                0 0 0
            )), ((
                0 0 0, 
                0 1 0, 
                1 1 0, 
                0 0 0
            ))
            )')  AS geom
    ) AS g;
 result
--------
 ST_Tin    </pre></div><div class="refsection" title="追加情報"><a name="id287011332"></a><h2>追加情報</h2><p><a class="xref" href="#GeometryType" title="GeometryType">GeometryType</a></p></div></div><div class="refentry" title="ST_InteriorRingN"><div class="refentry.separator"><hr></div><a name="ST_InteriorRingN"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_InteriorRingN ? ポリゴンのN番目の内環を返します。ジオメトリがポリゴンでないかNが範囲外の場合はNULLを返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_InteriorRingN</b>(</code>geometry  <var class="pdparam">a_polygon</var>, integer  <var class="pdparam">n</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287011425"></a><h2>説明</h2><p>ポリゴンのN番目の内環となるラインストリングを返します。ジオメトリがポリゴンでないかNが範囲外の場合はNULLを返します。1はじまりです。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はマルチポリゴンでは動作しません。マルチポリゴンに対してはST_Dumpを併用して下さい。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 8.2.6, 8.3.5</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p></div><div class="refsection" title="例"><a name="id287011482"></a><h2>例</h2><pre class="programlisting">
SELECT ST_AsText(ST_InteriorRingN(the_geom, 1)) As the_geom
FROM (SELECT ST_BuildArea(
		ST_Collect(ST_Buffer(ST_Point(1,2), 20,3),
			ST_Buffer(ST_Point(1, 2), 10,3))) As the_geom
		)  as foo
		</pre></div><div class="refsection" title="追加情報"><a name="id287011495"></a><h2>追加情報</h2><p>
<a class="xref" href="#ST_ExteriorRing" title="ST_ExteriorRing">ST_ExteriorRing</a>
<a class="xref" href="#ST_BuildArea" title="ST_BuildArea">ST_BuildArea</a>,
<a class="xref" href="#ST_Collect" title="ST_Collect">ST_Collect</a>,
<a class="xref" href="#ST_Dump" title="ST_Dump">ST_Dump</a>,
<a class="xref" href="#ST_NumInteriorRing" title="ST_NumInteriorRing">ST_NumInteriorRing</a>,
<a class="xref" href="#ST_NumInteriorRings" title="ST_NumInteriorRings">ST_NumInteriorRings</a>
		</p></div></div><div class="refentry" title="ST_IsClosed"><div class="refentry.separator"><hr></div><a name="ST_IsClosed"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_IsClosed ? <code class="varname">LINESTRING</code>の始点と終点が一致する場合に<code class="varname">TRUE</code>を返します。多面体サーフェスの場合は閉じています(ボリュームです)。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_IsClosed</b>(</code>geometry  <var class="pdparam">g</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287011569"></a><h2>説明</h2><p><code class="varname">LINESTRING</code>の始点と終点が一致する場合に<code class="varname">TRUE</code>を返します。多面体サーフェスの場合、サーフェスは面(開いている)かボリューム(閉じている)かを問い合わせます。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 7.1.5, 9.3.3</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>SQL-MMでは<code class="function">ST_IsClosed(<code class="varname">NULL</code>)</code>は0を返しますが、PostGISでは<code class="varname">NULL</code>を返します。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p><p>機能強化: 2.0.0で、多面体サーフェスが導入されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は多面体サーフェスに対応しています。</p></div><div class="refsection" title="ラインストリングとポイントの例"><a name="id287011665"></a><h2>ラインストリングとポイントの例</h2><pre class="programlisting">postgis=# SELECT ST_IsClosed('LINESTRING(0 0, 1 1)'::geometry);
 st_isclosed
-------------
 f
(1 row)

postgis=# SELECT ST_IsClosed('LINESTRING(0 0, 0 1, 1 1, 0 0)'::geometry);
 st_isclosed
-------------
 t
(1 row)

postgis=# SELECT ST_IsClosed('MULTILINESTRING((0 0, 0 1, 1 1, 0 0),(0 0, 1 1))'::geometry);
 st_isclosed
-------------
 f
(1 row)

postgis=# SELECT ST_IsClosed('POINT(0 0)'::geometry);
 st_isclosed
-------------
 t
(1 row)

postgis=# SELECT ST_IsClosed('MULTIPOINT((0 0), (1 1))'::geometry);
 st_isclosed
-------------
 t
(1 row)</pre></div><div class="refsection" title="多面体サーフェスの例"><a name="id287011676"></a><h2>多面体サーフェスの例</h2><pre class="programlisting">
		-- 立方体 --
		SELECT ST_IsClosed(ST_GeomFromEWKT('POLYHEDRALSURFACE( ((0 0 0, 0 0 1, 0 1 1, 0 1 0, 0 0 0)), 
		((0 0 0, 0 1 0, 1 1 0, 1 0 0, 0 0 0)), ((0 0 0, 1 0 0, 1 0 1, 0 0 1, 0 0 0)), 
		((1 1 0, 1 1 1, 1 0 1, 1 0 0, 1 1 0)), 
		((0 1 0, 0 1 1, 1 1 1, 1 1 0, 0 1 0)), ((0 0 1, 1 0 1, 1 1 1, 0 1 1, 0 0 1)) )'));

 st_isclosed
-------------
 t


 -- 立方体と同じですが側面のひとつがありません --
 SELECT ST_IsClosed(ST_GeomFromEWKT('POLYHEDRALSURFACE( ((0 0 0, 0 0 1, 0 1 1, 0 1 0, 0 0 0)), 
		((0 0 0, 0 1 0, 1 1 0, 1 0 0, 0 0 0)), ((0 0 0, 1 0 0, 1 0 1, 0 0 1, 0 0 0)), 
		((1 1 0, 1 1 1, 1 0 1, 1 0 0, 1 1 0)), 
		((0 1 0, 0 1 1, 1 1 1, 1 1 0, 0 1 0)) )'));

 st_isclosed
-------------
 f

</pre></div><div class="refsection" title="追加情報"><a name="id287011687"></a><h2>追加情報</h2><p><a class="xref" href="#ST_IsRing" title="ST_IsRing">ST_IsRing</a></p></div></div><div class="refentry" title="ST_IsCollection"><div class="refentry.separator"><hr></div><a name="ST_IsCollection"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_IsCollection ? 引数がコレクション(<code class="varname">MULTI*</code>, <code class="varname">GEOMETRYCOLLECTION</code>, ...)の場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_IsCollection</b>(</code>geometry  <var class="pdparam">g</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287012293"></a><h2>説明</h2><p>引数が次のいずれかの場合には<code class="varname">TRUE</code>を返します。
                  </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>GEOMETRYCOLLECTION</p></li><li class="listitem"><p>MULTI{POINT,POLYGON,LINESTRING,CURVE,SURFACE}</p></li><li class="listitem"><p>COMPOUNDCURVE</p></li></ul></div><p>
                </p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>
この関数はジオメトリのタイプを解析します。これは、空のコレクションである場合、またはひとつのエレメントを持つコレクションである場合には<code class="varname">TRUE</code>を返すことを意味します。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p></div><div class="refsection" title="例"><a name="id287012354"></a><h2>例</h2><pre class="programlisting">postgis=# SELECT ST_IsCollection('LINESTRING(0 0, 1 1)'::geometry);
 st_iscollection
-------------
 f
(1 row)

postgis=# SELECT ST_IsCollection('MULTIPOINT EMPTY'::geometry);
 st_iscollection
-------------
 t
(1 row)

postgis=# SELECT ST_IsCollection('MULTIPOINT((0 0))'::geometry);
 st_iscollection
-------------
 t
(1 row)

postgis=# SELECT ST_IsCollection('MULTIPOINT((0 0), (42 42))'::geometry);
 st_iscollection
-------------
 t
(1 row)

postgis=# SELECT ST_IsCollection('GEOMETRYCOLLECTION(POINT(0 0))'::geometry);
 st_iscollection
-------------
 t
(1 row)</pre></div><div class="refsection" title="追加情報"><a name="id287012364"></a><h2>追加情報</h2><p><a class="xref" href="#ST_NumGeometries" title="ST_NumGeometries">ST_NumGeometries</a></p></div></div><div class="refentry" title="ST_IsEmpty"><div class="refentry.separator"><hr></div><a name="ST_IsEmpty"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_IsEmpty ? ジオメトリが、空のジオメトリコレクション、ポリゴン、ポイント等の場合に、trueを返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_IsEmpty</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287012413"></a><h2>説明</h2><p>ジオメトリが空ジオメトリの場合にtrueを返します。
trueの場合には、このジオメトリは、空のジオメトリコレクション、ポリゴン、ポイント等です。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>SQL-MMでは、ST_IsEmpty(NULL)は0を返しますが、PostGISではNULLを返します。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です s2.1.1.1</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.7</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p><div class="warning" title="警告" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>変更: 2.0.0以前の版のPostGISではST_GeomFromText('GEOMETRYCOLLECTION(EMPTY)')を許しました。PostGIS 2.0.0では、SQL/MM標準により準拠させるため、これは不正となります。</p></td></tr></table></div></div><div class="refsection" title="例"><a name="id287012506"></a><h2>例</h2><pre class="programlisting">
SELECT ST_IsEmpty(ST_GeomFromText('GEOMETRYCOLLECTION EMPTY'));
 st_isempty
------------
 t
(1 row)

 SELECT ST_IsEmpty(ST_GeomFromText('POLYGON EMPTY'));
 st_isempty
------------
 t
(1 row)

SELECT ST_IsEmpty(ST_GeomFromText('POLYGON((1 2, 3 4, 5 6, 1 2))'));

 st_isempty
------------
 f
(1 row)

 SELECT ST_IsEmpty(ST_GeomFromText('POLYGON((1 2, 3 4, 5 6, 1 2))')) = false;
 ?column?
----------
 t
(1 row)

 SELECT ST_IsEmpty(ST_GeomFromText('CIRCULARSTRING EMPTY'));
  st_isempty
------------
 t
(1 row)


		</pre></div></div><div class="refentry" title="ST_IsRing"><div class="refentry.separator"><hr></div><a name="ST_IsRing"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_IsRing ? <code class="varname">LINESTRING</code>が閉じていて、かつ単純である場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_IsRing</b>(</code>geometry  <var class="pdparam">g</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287012562"></a><h2>説明</h2><p><code class="varname">LINESTRING</code>が<a class="xref" href="#ST_IsClosed" title="ST_IsClosed">ST_IsClosed</a>((<code class="function">ST_StartPoint(<em class="parameter"><code>g</code></em>)</code> <code class="function">~=</code> <code class="function">ST_Endpoint(<em class="parameter"><code>g</code></em>)</code>)で、かつ<a class="xref" href="#ST_IsSimple" title="ST_IsSimple">ST_IsSimple</a>(自己インタセクションが無い)場合に<code class="varname">TRUE</code>を返します。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です 2.1.5.1</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 7.1.6</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>SQL-MMでは、<code class="function">ST_IsRing(<code class="varname">NULL</code>)</code>は0を返しますが、PostGISでは<code class="varname">NULL</code>を返します。</p></td></tr></table></div></div><div class="refsection" title="例"><a name="id287012684"></a><h2>例</h2><pre class="programlisting">SELECT ST_IsRing(the_geom), ST_IsClosed(the_geom), ST_IsSimple(the_geom)
FROM (SELECT 'LINESTRING(0 0, 0 1, 1 1, 1 0, 0 0)'::geometry AS the_geom) AS foo;
 st_isring | st_isclosed | st_issimple
-----------+-------------+-------------
 t         | t           | t
(1 row)

SELECT ST_IsRing(the_geom), ST_IsClosed(the_geom), ST_IsSimple(the_geom)
FROM (SELECT 'LINESTRING(0 0, 0 1, 1 0, 1 1, 0 0)'::geometry AS the_geom) AS foo;
 st_isring | st_isclosed | st_issimple
-----------+-------------+-------------
 f         | t           | f
(1 row)</pre></div><div class="refsection" title="追加情報"><a name="id287012696"></a><h2>追加情報</h2><p><a class="xref" href="#ST_IsClosed" title="ST_IsClosed">ST_IsClosed</a>, <a class="xref" href="#ST_IsSimple" title="ST_IsSimple">ST_IsSimple</a>, <a class="xref" href="#ST_StartPoint" title="ST_StartPoint">ST_StartPoint</a>,
	  <a class="xref" href="#ST_EndPoint" title="ST_EndPoint">ST_EndPoint</a></p></div></div><div class="refentry" title="ST_IsSimple"><div class="refentry.separator"><hr></div><a name="ST_IsSimple"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_IsSimple ? ジオメトリが自己インタセクションや自己接触のような異常な幾何学ポイントを持っていない場合にTRUEを返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_IsSimple</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287012755"></a><h2>説明</h2><p>ジオメトリが自己インタセクションや自己接触のような異常な幾何学ポイントを持っていない場合にTRUEを返します。OGCのジオメトリ単純性と妥当性の定義に関する詳細情報については「<a class="link" href="#OGC_Validity" title="4.3.5. ジオメトリのOpenGIS準拠を確実にする">"ジオメトリのOpenGIS準拠を確実にする</a>」をご覧ください。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>SQL-MMでは、ST_IsSimple(NULL)は0を返しますが、PostGISではNULLを返します。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です s2.1.1.1</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.8</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p></div><div class="refsection" title="例"><a name="id287012816"></a><h2>例</h2><pre class="programlisting"> SELECT ST_IsSimple(ST_GeomFromText('POLYGON((1 2, 3 4, 5 6, 1 2))'));
 st_issimple
-------------
 t
(1 row)

 SELECT ST_IsSimple(ST_GeomFromText('LINESTRING(1 1,2 2,2 3.5,1 3,1 2,2 1)'));
 st_issimple
-------------
 f
(1 row)</pre></div><div class="refsection" title="追加情報"><a name="id287012826"></a><h2>追加情報</h2><p><a class="xref" href="#ST_IsValid" title="ST_IsValid">ST_IsValid</a></p></div></div><div class="refentry" title="ST_IsValid"><div class="refentry.separator"><hr></div><a name="ST_IsValid"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_IsValid ? <code class="varname">ST_Geometry</code>が整形されている場合に<code class="varname">true</code>を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_IsValid</b>(</code>geometry  <var class="pdparam">g</var><code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">ST_IsValid</b>(</code>geometry  <var class="pdparam">g</var>, integer  <var class="pdparam">flags</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287012978"></a><h2>説明</h2><p>ST_Geometry値が整形されているかを見ます。不正なジオメトリに対しては、その理由の詳細をPostgreSQLの警告で提供します。OGCのジオメトリ単純性と妥当性の定義に関する詳細情報については「<a class="link" href="#OGC_Validity" title="4.3.5. ジオメトリのOpenGIS準拠を確実にする">"ジオメトリのOpenGIS準拠を確実にする</a>」をご覧ください。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>SQL-MMでは、ST_IsValid(NULL)は0を返しますが、PostGISではNULLを返します。</p></td></tr></table></div><p>flagsを受け付ける版は、2.0.0で追加されました。GEOS &gt;= 3.3.0が必要です。不正の説明をPostgreSQLの警告で印字しません。許される<code class="varname">flags</code>については<a class="xref" href="#ST_IsValidDetail" title="ST_IsValidDetail">ST_IsValidDetail</a>をご覧ください。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.9</p></div><div class="refsection" title="例"><a name="id287013069"></a><h2>例</h2><pre class="programlisting">SELECT ST_IsValid(ST_GeomFromText('LINESTRING(0 0, 1 1)')) As good_line,
	ST_IsValid(ST_GeomFromText('POLYGON((0 0, 1 1, 1 2, 1 1, 0 0))')) As bad_poly
--results
NOTICE:  Self-intersection at or near point 0 0
 good_line | bad_poly
-----------+----------
 t         | f
</pre></div><div class="refsection" title="追加情報"><a name="id287013080"></a><h2>追加情報</h2><p>
<a class="xref" href="#ST_IsSimple" title="ST_IsSimple">ST_IsSimple</a>,
<a class="xref" href="#ST_IsValidReason" title="ST_IsValidReason">ST_IsValidReason</a>,
<a class="xref" href="#ST_IsValidDetail" title="ST_IsValidDetail">ST_IsValidDetail</a>,
<a class="xref" href="#ST_Summary" title="ST_Summary">ST_Summary</a>
</p></div></div><div class="refentry" title="ST_IsValidReason"><div class="refentry.separator"><hr></div><a name="ST_IsValidReason"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_IsValidReason ? ジオメトリが妥当か否かを示すテキストを返し、不正な場合は理由を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_IsValidReason</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">ST_IsValidReason</b>(</code>geometry  <var class="pdparam">geomA</var>, integer  <var class="pdparam">flags</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287013169"></a><h2>説明</h2><p>ジオメトリが妥当か否かを示すテキストを返し、不正な場合は理由を返します。</p><p>ST_IsValidと併用して、不正なジオメトリとその理由の細かい報告を生成するのに便利です。</p><p>
許される<code class="varname">flags</code>は、<a class="xref" href="#ST_IsValidDetail" title="ST_IsValidDetail">ST_IsValidDetail</a>にあります。
		</p><p>初出: 1.4 - requires GEOS &gt;= 3.1.0.</p><p>初出: 2.0 - requires GEOS &gt;= 3.3.0 flagsを受け付ける版</p></div><div class="refsection" title="例"><a name="id287013197"></a><h2>例</h2><pre class="programlisting">
-- 試験に成功した5つのレコードを除いた最初の3つのレコード
SELECT gid, ST_IsValidReason(the_geom) as validity_info
FROM
(SELECT ST_MakePolygon(ST_ExteriorRing(e.buff), ST_Accum(f.line)) As the_geom, gid
FROM (SELECT ST_Buffer(ST_MakePoint(x1*10,y1), z1) As buff, x1*10 + y1*100 + z1*1000 As gid
	FROM generate_series(-4,6) x1
	CROSS JOIN generate_series(2,5) y1
	CROSS JOIN generate_series(1,8) z1
	WHERE x1 &gt; y1*0.5 AND z1 &lt; x1*y1) As e
	INNER JOIN (SELECT ST_Translate(ST_ExteriorRing(ST_Buffer(ST_MakePoint(x1*10,y1), z1)),y1*1, z1*2) As line
	FROM generate_series(-3,6) x1
	CROSS JOIN generate_series(2,5) y1
	CROSS JOIN generate_series(1,10) z1
	WHERE x1 &gt; y1*0.75 AND z1 &lt; x1*y1) As f
ON (ST_Area(e.buff) &gt; 78 AND ST_Contains(e.buff, f.line))
GROUP BY gid, e.buff) As quintuplet_experiment
WHERE ST_IsValid(the_geom) = false
ORDER BY gid
LIMIT 3;

 gid  |      validity_info
------+--------------------------
 5330 | Self-intersection [32 5]
 5340 | Self-intersection [42 5]
 5350 | Self-intersection [52 5]

 -- 単純なものの例
SELECT ST_IsValidReason('LINESTRING(220227 150406,2220227 150407,222020 150410)');

 st_isvalidreason
------------------
 Valid Geometry

		</pre></div><div class="refsection" title="追加情報"><a name="id287013211"></a><h2>追加情報</h2><p><a class="xref" href="#ST_IsValid" title="ST_IsValid">ST_IsValid</a>, <a class="xref" href="#ST_Summary" title="ST_Summary">ST_Summary</a></p></div></div><div class="refentry" title="ST_IsValidDetail"><div class="refentry.separator"><hr></div><a name="ST_IsValidDetail"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_IsValidDetail ? ジオメトリが妥当か否かを示すvalid_detail (valid,reason,location)行を返します。不正である場合には、理由と位置を示します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">valid_detail <b class="fsfunc">ST_IsValidDetail</b>(</code>geometry  <var class="pdparam">geom</var><code>)</code>;</p><p><code class="funcdef">valid_detail <b class="fsfunc">ST_IsValidDetail</b>(</code>geometry  <var class="pdparam">geom</var>, integer  <var class="pdparam">flags</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287013291"></a><h2>説明</h2><p>valid_detail行を返します。validはboolean型で、ジオメトリが妥当かを示します。reasonはvarchar型で、不正の理由を示します。locationはジオメトリ型で、不正になっている位置を示します。</p><p>不正なジオメトリの詳細報告を生成するためのST_IsValidとST_IsValidReasonの組み合わせを代替し、かつ改良するものとして使われます。</p><p>
引数'flags'はビットフィールドです。次の値を取ることができます。
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
1: 穴を形成する自己インタセクトする環を妥当と考慮します。「ESRIフラグ」としも言われます。これはOGCモデルと対立します。</p></li></ul></div><p>
		</p><p>初出: 2.0.0 - GEOS 3.3.0以上が必要です。</p></div><div class="refsection" title="例"><a name="id287013320"></a><h2>例</h2><pre class="programlisting">
-- 試験に成功した5つのレコードを除いた最初の3つのレコード
SELECT gid, reason(ST_IsValidDetail(the_geom)), ST_AsText(location(ST_IsValidDetail(the_geom))) as location 
FROM
(SELECT ST_MakePolygon(ST_ExteriorRing(e.buff), ST_Accum(f.line)) As the_geom, gid
FROM (SELECT ST_Buffer(ST_MakePoint(x1*10,y1), z1) As buff, x1*10 + y1*100 + z1*1000 As gid
	FROM generate_series(-4,6) x1
	CROSS JOIN generate_series(2,5) y1
	CROSS JOIN generate_series(1,8) z1
	WHERE x1 &gt; y1*0.5 AND z1 &lt; x1*y1) As e
	INNER JOIN (SELECT ST_Translate(ST_ExteriorRing(ST_Buffer(ST_MakePoint(x1*10,y1), z1)),y1*1, z1*2) As line
	FROM generate_series(-3,6) x1
	CROSS JOIN generate_series(2,5) y1
	CROSS JOIN generate_series(1,10) z1
	WHERE x1 &gt; y1*0.75 AND z1 &lt; x1*y1) As f
ON (ST_Area(e.buff) &gt; 78 AND ST_Contains(e.buff, f.line))
GROUP BY gid, e.buff) As quintuplet_experiment
WHERE ST_IsValid(the_geom) = false
ORDER BY gid
LIMIT 3;

 gid  |      reason       |  location
------+-------------------+-------------
 5330 | Self-intersection | POINT(32 5)
 5340 | Self-intersection | POINT(42 5)
 5350 | Self-intersection | POINT(52 5)

 -- 単純なものの例
SELECT * FROM ST_IsValidDetail('LINESTRING(220227 150406,2220227 150407,222020 150410)');

 valid | reason | location
-------+--------+----------
 t     |        |

		</pre></div><div class="refsection" title="追加情報"><a name="id287013333"></a><h2>追加情報</h2><p>
<a class="xref" href="#ST_IsValid" title="ST_IsValid">ST_IsValid</a>,
<a class="xref" href="#ST_IsValidReason" title="ST_IsValidReason">ST_IsValidReason</a>
</p></div></div><div class="refentry" title="ST_M"><div class="refentry.separator"><hr></div><a name="ST_M"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_M ? ポイントのM座標値を返し、有効でないならNULLを返します。入力はポイントでなければなりません。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_M</b>(</code>geometry  <var class="pdparam">a_point</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287013388"></a><h2>説明</h2><p>ポイントのM座標値を返し、有効でないならNULLを返します。入力はポイントでなければなりません。 </p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これは(いまだに)OGC仕様に入っていませんが、ポイント座標抽出関数のリストを完全にするために挙げています。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p></div><div class="refsection" title="例"><a name="id287013443"></a><h2>例</h2><pre class="programlisting">SELECT ST_M(ST_GeomFromEWKT('POINT(1 2 3 4)'));
 st_m
------
	4
(1 row)

		</pre></div><div class="refsection" title="追加情報"><a name="id287013456"></a><h2>追加情報</h2><p><a class="xref" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a>, <a class="xref" href="#ST_X" title="ST_X">ST_X</a>, <a class="xref" href="#ST_Y" title="ST_Y">ST_Y</a>, <a class="xref" href="#ST_Z" title="ST_Z">ST_Z</a></p></div></div><div class="refentry" title="ST_NDims"><div class="refentry.separator"><hr></div><a name="ST_NDims"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_NDims ? オメトリの座標次元をsmall intで返します。値は2, 3, 4のいずれかです。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_NDims</b>(</code>geometry  <var class="pdparam">g1</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287013549"></a><h2>説明</h2><p>ジオメトリの座標次元返します。PostGISでは、2 - (X,Y), 3 - (X,Y,Z), (X,Y,M), 4 - (X,Y,Z,M)をサポートします。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p></div><div class="refsection" title="例"><a name="id287013571"></a><h2>例</h2><pre class="programlisting">SELECT ST_NDims(ST_GeomFromText('POINT(1 1)')) As d2point,
	ST_NDims(ST_GeomFromEWKT('POINT(1 1 2)')) As d3point,
	ST_NDims(ST_GeomFromEWKT('POINTM(1 1 0.5)')) As d2pointm;

	 d2point | d3point | d2pointm
---------+---------+----------
	   2 |       3 |        3
			</pre></div><div class="refsection" title="追加情報"><a name="id287013582"></a><h2>追加情報</h2><p><a class="xref" href="#ST_CoordDim" title="ST_CoordDim">ST_CoordDim</a>, <a class="xref" href="#ST_Dimension" title="ST_Dimension">ST_Dimension</a>, <a class="xref" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a></p></div></div><div class="refentry" title="ST_NPoints"><div class="refentry.separator"><hr></div><a name="ST_NPoints"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_NPoints ? ジオメトリのポイント(バーテック)数を返します。 </p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_NPoints</b>(</code>geometry  <var class="pdparam">g1</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287013638"></a><h2>説明</h2><p>ジオメトリのポイントの数を返します。全てのジオメトリに対して動作します。</p><p>機能強化: 2.0.0で、多面体サーフェスが導入されました。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>1.3.4より前では、この関数は曲線を含むジオメトリに対して使うとクラッシュしました。1.3.4以上では訂正されています。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は多面体サーフェスに対応しています。</p></div><div class="refsection" title="例"><a name="id287013689"></a><h2>例</h2><pre class="programlisting">SELECT ST_NPoints(ST_GeomFromText('LINESTRING(77.29 29.07,77.42 29.26,77.27 29.31,77.29 29.07)'));
-- 結果
4

-- 三次元空間上のポリゴン
SELECT ST_NPoints(ST_GeomFromEWKT('LINESTRING(77.29 29.07 1,77.42 29.26 0,77.27 29.31 -1,77.29 29.07 3)'))
-- 結果
4</pre></div><div class="refsection" title="追加情報"><a name="id287013700"></a><h2>追加情報</h2><p><a class="xref" href="#ST_NumPoints" title="ST_NumPoints">ST_NumPoints</a></p></div></div><div class="refentry" title="ST_NRings"><div class="refentry.separator"><hr></div><a name="ST_NRings"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_NRings ? ジオメトリがポリゴンまたはマルチポリゴンの場合、リング数を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_NRings</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287013750"></a><h2>説明</h2><p>ジオメトリがポリゴンまたはマルチポリゴンの場合、リング数を返します。NumInteriorRingsと違い、外環も数えます。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p></div><div class="refsection" title="例"><a name="id287013781"></a><h2>例</h2><pre class="programlisting">SELECT ST_NRings(the_geom) As Nrings, ST_NumInteriorRings(the_geom) As ninterrings
					FROM (SELECT ST_GeomFromText('POLYGON((1 2, 3 4, 5 6, 1 2))') As the_geom) As foo;
	 nrings | ninterrings
--------+-------------
	  1 |           0
(1 row)
</pre></div><div class="refsection" title="追加情報"><a name="id287013795"></a><h2>追加情報</h2><p><a class="xref" href="#ST_NumInteriorRings" title="ST_NumInteriorRings">ST_NumInteriorRings</a></p></div></div><div class="refentry" title="ST_NumGeometries"><div class="refentry.separator"><hr></div><a name="ST_NumGeometries"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_NumGeometries ? ジオメトリがジオメトリコレクションまたはマルチ系の場合はジオメトリの数を、単一のジオメトリの場合は1を返し、それ以外の場合はNULLを返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_NumGeometries</b>(</code>geometry  <var class="pdparam">geom</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287013844"></a><h2>説明</h2><p>ジオメトリがジオメトリコレクションまたはマルチ系の場合は、ジオメトリの数を返し、単一のジオメトリの場合は1を返し、それ以外の場合はNULLを返します。</p><p>機能強化: 2.0.0で、多面体サーフェス、三角形、TINが導入されました。</p><p>変更: 2.0.0より前の版では、ジオメトリがコレクション/マルチ系でない場合にはNULLを返しました。2.0.0以上では、POLYGON, LINESTRING, POINTといった単一ジオメトリについては1を返します。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 9.1.4</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は多面体サーフェスに対応しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は三角形と不規則三角網(TIN)に対応しています。</p></div><div class="refsection" title="例"><a name="id287013909"></a><h2>例</h2><pre class="programlisting">
-- この例は、以前の版ではNULLを返しましたが、2.0.0では1を返します。
SELECT ST_NumGeometries(ST_GeomFromText('LINESTRING(77.29 29.07,77.42 29.26,77.27 29.31,77.29 29.07)'));
-- 結果
1

-- ジオメトリコレクションの例
-- コレクションのジオメトリがマルチの場合、1つとして変え添えられます。
SELECT ST_NumGeometries(ST_GeomFromEWKT('GEOMETRYCOLLECTION(MULTIPOINT(-2 3 , -2 2),
LINESTRING(5 5 ,10 10),
POLYGON((-7 4.2,-7.1 5,-7.1 4.3,-7 4.2)))'));
-- 結果
3
</pre></div><div class="refsection" title="追加情報"><a name="id287013920"></a><h2>追加情報</h2><p><a class="xref" href="#ST_GeometryN" title="ST_GeometryN">ST_GeometryN</a>, <a class="xref" href="#ST_Multi" title="ST_Multi">ST_Multi</a></p></div></div><div class="refentry" title="ST_NumInteriorRings"><div class="refentry.separator"><hr></div><a name="ST_NumInteriorRings"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_NumInteriorRings ? ジオメトリの最初のポリゴンの内環数を返します。この関数はポリゴンとマルチポリゴンの両方で動作しますが、最初のポリゴンしか見ません。ジオメトリにポリゴンが存在しない場合はNULLを返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_NumInteriorRings</b>(</code>geometry  <var class="pdparam">a_polygon</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287013973"></a><h2>説明</h2><p>ジオメトリの最初のポリゴンの内環数を返します。この関数はポリゴンとマルチポリゴンの両方で動作しますが、最初のポリゴンしか見ません。ジオメトリにポリゴンが存在しない場合はNULLを返します。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 8.2.5</p></div><div class="refsection" title="例"><a name="id287014065"></a><h2>例</h2><pre class="programlisting">
-- 通常のポリゴンの場合
SELECT gid, field1, field2, ST_NumInteriorRings(the_geom) AS numholes
FROM sometable;

-- マルチポリゴンの内環の総数を知りたい場合
SELECT gid, field1, field2, SUM(ST_NumInteriorRings(the_geom)) AS numholes
FROM (SELECT gid, field1, field2, (ST_Dump(the_geom)).geom As the_geom
	FROM sometable) As foo
GROUP BY gid, field1,field2;
			</pre></div><div class="refsection" title="追加情報"><a name="id287014075"></a><h2>追加情報</h2><p><a class="xref" href="#ST_NumInteriorRing" title="ST_NumInteriorRing">ST_NumInteriorRing</a></p></div></div><div class="refentry" title="ST_NumInteriorRing"><div class="refentry.separator"><hr></div><a name="ST_NumInteriorRing"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_NumInteriorRing ? ジオメトリの最初のポリゴンの内環の数を返します。ST_NumInteriorRingsと同義です。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_NumInteriorRing</b>(</code>geometry  <var class="pdparam">a_polygon</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287014124"></a><h2>説明</h2><p>ジオメトリの最初のポリゴンの内環の数を返します。ST_NumInteriorRingsと同義です。OpenGIS仕様では、関数の名前付けについてあいまいであるため、両方のスペリングの関数を提供しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 8.2.5</p></div><div class="refsection" title="追加情報"><a name="id287014148"></a><h2>追加情報</h2><p><a class="xref" href="#ST_NumInteriorRings" title="ST_NumInteriorRings">ST_NumInteriorRings</a></p></div></div><div class="refentry" title="ST_NumPatches"><div class="refentry.separator"><hr></div><a name="ST_NumPatches"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_NumPatches ? 多面体サーフェスのフェイス数を返します。多面体でないジオメトリの場合にはNULLを返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_NumPatches</b>(</code>geometry  <var class="pdparam">g1</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287014232"></a><h2>説明</h2><p>多面体サーフェスのフェイス数を返します。多面体でないジオメトリの場合にはNULLを返します。ST_NumGeometriesの別名で、MMの名前付けに対応するためのものです。MM規約を気にしない場合はST_NumGeometriesの方が速いです。</p><p>初出: 2.0.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: ?</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は多面体サーフェスに対応しています。</p></div><div class="refsection" title="例"><a name="id287014295"></a><h2>例</h2><pre class="programlisting">SELECT ST_NumPatches(ST_GeomFromEWKT('POLYHEDRALSURFACE( ((0 0 0, 0 0 1, 0 1 1, 0 1 0, 0 0 0)), 
		((0 0 0, 0 1 0, 1 1 0, 1 0 0, 0 0 0)), ((0 0 0, 1 0 0, 1 0 1, 0 0 1, 0 0 0)), 
		((1 1 0, 1 1 1, 1 0 1, 1 0 0, 1 1 0)), 
		((0 1 0, 0 1 1, 1 1 1, 1 1 0, 0 1 0)), ((0 0 1, 1 0 1, 1 1 1, 0 1 1, 0 0 1)) )'));
		-- 結果
		6
		</pre></div><div class="refsection" title="追加情報"><a name="id287014341"></a><h2>追加情報</h2><p><a class="xref" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a>, <a class="xref" href="#ST_NumGeometries" title="ST_NumGeometries">ST_NumGeometries</a></p></div></div><div class="refentry" title="ST_NumPoints"><div class="refentry.separator"><hr></div><a name="ST_NumPoints"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_NumPoints ? ST_LineStringまたはST_CircularStringのポイント数を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_NumPoints</b>(</code>geometry  <var class="pdparam">g1</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287014393"></a><h2>説明</h2><p>ST_LineStringまたはST_CircularStringのポイント数を返します。1.4より前は仕様通りにラインストリングにのみ対応していました。1.4以上ではラインストリングだけでなくバーテックス数を返すST_NPointsの別名です。多目的で多数のジオメトリタイプで動作するST_NPointsを使うことを考えて下さい。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 7.2.4</p></div><div class="refsection" title="例"><a name="id287014430"></a><h2>例</h2><pre class="programlisting">SELECT ST_NumPoints(ST_GeomFromText('LINESTRING(77.29 29.07,77.42 29.26,77.27 29.31,77.29 29.07)'));
		-- 結果
		4
		</pre></div><div class="refsection" title="追加情報"><a name="id287014441"></a><h2>追加情報</h2><p><a class="xref" href="#ST_NPoints" title="ST_NPoints">ST_NPoints</a></p></div></div><div class="refentry" title="ST_PatchN"><div class="refentry.separator"><hr></div><a name="ST_PatchN"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_PatchN ? ジオメトリがPOLYHEDRALSURFACEかPOLYHEDRALSURFACEMの場合には、1はじまりでN番目のジオメトリ(フェイス)を返します。それ以外の場合には、NULLを返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_PatchN</b>(</code>geometry  <var class="pdparam">geomA</var>, integer  <var class="pdparam">n</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287014500"></a><h2>説明</h2><p>ジオメトリがPOLYHEDRALSURFACEかPOLYHEDRALSURFACEMの場合には、1はじまりでN番目のジオメトリ(フェイス)を返します。それ以外の場合には、NULLを返します。多面体サーフェスを引数にとるST_GeometryNと同じ答えが返ります。ST_GeometryNの方が速いです。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>インデクスは1はじまりです。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ひとつのジオメトリから全てのジオメトリを抽出したい場合は、ST_Dumpを使う方が効果的です。</p></td></tr></table></div><p>初出: 2.0.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: ?</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は多面体サーフェスに対応しています。</p></div><div class="refsection" title="例"><a name="id287014564"></a><h2>例</h2><pre class="programlisting">
-- 多面体サーフェスの2番目のサーフェスを抽出
SELECT ST_AsEWKT(ST_PatchN(geom, 2)) As geomewkt
FROM (
VALUES (ST_GeomFromEWKT('POLYHEDRALSURFACE( ((0 0 0, 0 0 1, 0 1 1, 0 1 0, 0 0 0)), 
	((0 0 0, 0 1 0, 1 1 0, 1 0 0, 0 0 0)), ((0 0 0, 1 0 0, 1 0 1, 0 0 1, 0 0 0)), 
	((1 1 0, 1 1 1, 1 0 1, 1 0 0, 1 1 0)), 
	((0 1 0, 0 1 1, 1 1 1, 1 1 0, 0 1 0)), ((0 0 1, 1 0 1, 1 1 1, 0 1 1, 0 0 1)) )')) ) As foo(geom);

              geomewkt
---+-----------------------------------------
 POLYGON((0 0 0,0 1 0,1 1 0,1 0 0,0 0 0))
</pre></div><div class="refsection" title="追加情報"><a name="id287014577"></a><h2>追加情報</h2><p><a class="xref" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a>, <a class="xref" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a>, <a class="xref" href="#ST_Dump" title="ST_Dump">ST_Dump</a>, <a class="xref" href="#ST_GeometryN" title="ST_GeometryN">ST_GeometryN</a>, <a class="xref" href="#ST_NumGeometries" title="ST_NumGeometries">ST_NumGeometries</a></p></div></div><div class="refentry" title="ST_PointN"><div class="refentry.separator"><hr></div><a name="ST_PointN"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_PointN ? ジオメトリの最初のラインストリングまたは曲線ストリングのN番目のポイントを返します。ラインストリングが存在しない場合はNULLを返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_PointN</b>(</code>geometry  <var class="pdparam">a_linestring</var>, integer  <var class="pdparam">n</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287014682"></a><h2>説明</h2><p>ジオメトリの最初のラインストリングまたは曲線ストリングのN番目のポイントを返します。ラインストリングが存在しない場合はNULLを返します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>0.8.0版からOGC仕様にあわせてインデクスは1はじまりです。それより前の版では0はじまりでした。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>マルチラインストリングからN番目のポイントを得たい場合には、ST_Dumpを併用して下さい。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 7.2.5, 7.3.5</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p></div><div class="refsection" title="例"><a name="id287014755"></a><h2>例</h2><pre class="programlisting">-- ラインストリングの全てのポイントの抽出
SELECT ST_AsText(
   ST_PointN(
	  column1,
	  generate_series(1, ST_NPoints(column1))
   ))
FROM ( VALUES ('LINESTRING(0 0, 1 1, 2 2)'::geometry) ) AS foo;

 st_astext
------------
 POINT(0 0)
 POINT(1 1)
 POINT(2 2)
(3 rows)

-- 曲線ストリングの例
SELECT ST_AsText(ST_PointN(ST_GeomFromText('CIRCULARSTRING(1 2, 3 2, 1 2)'),2));

st_astext
----------
POINT(3 2)
</pre></div><div class="refsection" title="追加情報"><a name="id287014765"></a><h2>追加情報</h2><p><a class="xref" href="#ST_NPoints" title="ST_NPoints">ST_NPoints</a></p></div></div><div class="refentry" title="ST_SRID"><div class="refentry.separator"><hr></div><a name="ST_SRID"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SRID ? ST_Geometryのspatial_ref_sysテーブルで定義されている空間参照系の識別番号を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_SRID</b>(</code>geometry  <var class="pdparam">g1</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287014816"></a><h2>説明</h2><p>ST_Geometryのspatial_ref_sysテーブルで定義されている空間参照系の識別番号を返します。<a class="xref" href="#spatial_ref_sys" title="4.3.1. SPATIAL_REF_SYSテーブルと空間参照系">「SPATIAL_REF_SYSテーブルと空間参照系」</a>を参照して下さい。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>spatial_ref_sysテーブル、はPostGISが知る参照系の全てのカタログを作っていて、ある空間参照系から他の空間参照系に変換するために使われます。ジオメトリの変換を予定している場合は正しい空間参照系の識別番号を持っているか確認することは重要です。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です s2.1.1.1</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.5</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p></div><div class="refsection" title="例"><a name="id287014872"></a><h2>例</h2><pre class="programlisting">SELECT ST_SRID(ST_GeomFromText('POINT(-71.1043 42.315)',4326));
		-- 結果
		4326
		</pre></div><div class="refsection" title="追加情報"><a name="id287014883"></a><h2>追加情報</h2><p><a class="xref" href="#spatial_ref_sys" title="4.3.1. SPATIAL_REF_SYSテーブルと空間参照系">「SPATIAL_REF_SYSテーブルと空間参照系」</a>, <a class="xref" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a>, <a class="xref" href="#ST_SetSRID" title="ST_SetSRID">ST_SetSRID</a>, <a class="xref" href="#ST_Transform" title="ST_Transform">ST_Transform</a></p></div></div><div class="refentry" title="ST_StartPoint"><div class="refentry.separator"><hr></div><a name="ST_StartPoint"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_StartPoint ? <code class="varname">LINESTRING</code>の最初のポイントを<code class="varname">POINT</code>として返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_StartPoint</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287014948"></a><h2>説明</h2><p><code class="varname">LINESTRING</code>の最初のポイントを<code class="varname">POINT</code>として返します。入力パラメタが<code class="varname">LINESTRING</code>でない場合には、<code class="varname">NULL</code>を返します。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 7.1.3</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>変更: 2.0.0では単一ジオメトリのMULTILINESTRINGで動作しなくなりました。単一のラインストリングからなるMULTILINESTRINGについては幸運にも動いていて、最初のポイントを返していました。2.0.0では他のMULTILINESTRINGと同様にNULLを返すようになりました。古い振る舞いは記載されていませんでしたが、LINESTRINGとして格納されているデータを持っていると思われる人々は2.0でNULLが返って来ることを経験することでしょう。</p></td></tr></table></div></div><div class="refsection" title="例"><a name="id287014999"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(ST_StartPoint('LINESTRING(0 1, 0 2)'::geometry));
 st_astext
------------
 POINT(0 1)
(1 row)

SELECT ST_StartPoint('POINT(0 1)'::geometry) IS NULL AS is_null;
  is_null
----------
 t
(1 row)

--3d line
SELECT ST_AsEWKT(ST_StartPoint('LINESTRING(0 1 1, 0 2 2)'::geometry));
 st_asewkt
------------
 POINT(0 1 1)
(1 row)

</pre></div><div class="refsection" title="追加情報"><a name="id287015010"></a><h2>追加情報</h2><p><a class="xref" href="#ST_EndPoint" title="ST_EndPoint">ST_EndPoint</a>, <a class="xref" href="#ST_PointN" title="ST_PointN">ST_PointN</a></p></div></div><div class="refentry" title="ST_Summary"><div class="refentry.separator"><hr></div><a name="ST_Summary"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Summary ? 
ジオメトリについての要約文を返します。
		</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_Summary</b>(</code>geometry  <var class="pdparam">g</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">ST_Summary</b>(</code>geography  <var class="pdparam">g</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287015082"></a><h2>説明</h2><p>ジオメトリについての要約文を返します。</p><p>
                  ジオメトリ型の後の角括弧で示されたフラグには次の意味があります。
                  </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>M: M軸を持ちます</p></li><li class="listitem"><p>Z: Z軸を持ちます</p></li><li class="listitem"><p>B: バウンディングボックスを持ちます</p></li><li class="listitem"><p>G: 測地座標系(ジオグラフィ)です</p></li></ul></div><p>
                </p><p>初出: 1.2.2 - 2.0.0 ジオグラフィ対応が追加</p></div><div class="refsection" title="例"><a name="id287015154"></a><h2>例</h2><pre class="programlisting">
=# SELECT ST_Summary(ST_GeomFromText('LINESTRING(0 0, 1 1)')) as geom,
        ST_Summary(ST_GeogFromText('POLYGON((0 0, 1 1, 1 2, 1 1, 0 0))')) geog;
            geom             |          geog    
-----------------------------+--------------------------
 LineString[B] with 2 points | Polygon[BG] with 1 rings
                             :    ring 0 has 5 points
                             :
(1 row)


=# SELECT ST_Summary(ST_GeogFromText('LINESTRING(0 0 1, 1 1 1)')) As geog_line,
        ST_Summary(ST_GeomFromText('POLYGON((0 0 1, 1 1 2, 1 2 3, 1 1 1, 0 0 1))')) As geom_poly;
;
           geog_line           |        geom_poly
-------------------------------+--------------------------
 LineString[ZBG] with 2 points | Polygon[ZB] with 1 rings
                               :    ring 0 has 5 points
                               :
(1 row)

</pre></div><div class="refsection" title="追加情報"><a name="id287015164"></a><h2>追加情報</h2><p>
<a class="xref" href="#PostGIS_DropBBox" title="PostGIS_DropBBox">PostGIS_DropBBox</a>,
<a class="xref" href="#PostGIS_AddBBox" title="PostGIS_AddBBox">PostGIS_AddBBox</a>,
<a class="xref" href="#ST_Force_3DM" title="ST_Force_3DM">ST_Force_3DM</a>,
<a class="xref" href="#ST_Force_3DZ" title="ST_Force_3DZ">ST_Force_3DZ</a>,
<a class="xref" href="#ST_Force_2D" title="ST_Force_2D">ST_Force_2D</a>,
<a class="xref" href="#geography" title="geography">geography</a>
		</p><p>
<a class="xref" href="#ST_IsValid" title="ST_IsValid">ST_IsValid</a>,
<a class="xref" href="#ST_IsValid" title="ST_IsValid">ST_IsValid</a>,
<a class="xref" href="#ST_IsValidReason" title="ST_IsValidReason">ST_IsValidReason</a>,
<a class="xref" href="#ST_IsValidDetail" title="ST_IsValidDetail">ST_IsValidDetail</a>
		</p></div></div><div class="refentry" title="ST_X"><div class="refentry.separator"><hr></div><a name="ST_X"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_X ? ポイントのX座標値を返し、有効でないならNULLを返します。入力はポイントでなければなりません。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_X</b>(</code>geometry  <var class="pdparam">a_point</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287015249"></a><h2>説明</h2><p>ポイントのX座標値を返し、有効でないならNULLを返します。入力はポイントでなければなりません。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ジオメトリのX座標値の最大値、最小値を得たい場合には、ST_XMin, ST_XMax関数をご覧ください。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 6.1.3</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p></div><div class="refsection" title="例"><a name="id287015289"></a><h2>例</h2><pre class="programlisting">SELECT ST_X(ST_GeomFromEWKT('POINT(1 2 3 4)'));
 st_x
------
	1
(1 row)

SELECT ST_Y(ST_Centroid(ST_GeomFromEWKT('LINESTRING(1 2 3 4, 1 1 1 1)')));
 st_y
------
  1.5
(1 row)

		</pre></div><div class="refsection" title="追加情報"><a name="id287015302"></a><h2>追加情報</h2><p><a class="xref" href="#ST_Centroid" title="ST_Centroid">ST_Centroid</a>, <a class="xref" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a>, <a class="xref" href="#ST_M" title="ST_M">ST_M</a>, <a class="xref" href="#ST_XMax" title="ST_XMax">ST_XMax</a>, <a class="xref" href="#ST_XMin" title="ST_XMin">ST_XMin</a>, <a class="xref" href="#ST_Y" title="ST_Y">ST_Y</a>, <a class="xref" href="#ST_Z" title="ST_Z">ST_Z</a></p></div></div><div class="refentry" title="ST_XMax"><div class="refentry.separator"><hr></div><a name="ST_XMax"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_XMax ? 2次元,3次元バウンディングボックスまたはジオメトリにおけるXの最大値を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_XMax</b>(</code>box3d  <var class="pdparam">aGeomorBox2DorBox3D</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287015405"></a><h2>説明</h2><p>2次元,3次元バウンディングボックスまたはジオメトリにおけるXの最大値を返します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はbox3dのみ定義していますが、ジオメトリとbox2dに定義されている自動キャストの振る舞いによって、box2dとジオメトリでも動作します。ジオメトリまたはbox2dの文字列表現については、自動キャストしないため、与えることはできません。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p></div><div class="refsection" title="例"><a name="id287015443"></a><h2>例</h2><pre class="programlisting">SELECT ST_XMax('BOX3D(1 2 3, 4 5 6)');
st_xmax
-------
4

SELECT ST_XMax(ST_GeomFromText('LINESTRING(1 3 4, 5 6 7)'));
st_xmax
-------
5

SELECT ST_XMax(CAST('BOX(-3 2, 3 4)' As box2d));
st_xmax
-------
3
-- 文字列表現からBOX3Dへの自動キャストを試みるために動作しないのを
-- 観察します。
tation to a BOX3D
SELECT ST_XMax('LINESTRING(1 3, 5 6)');

--ERROR:  BOX3D parser - doesnt start with BOX3D(

SELECT ST_XMax(ST_GeomFromEWKT('CIRCULARSTRING(220268 150415 1,220227 150505 2,220227 150406 3)'));
st_xmax
--------
220288.248780547
		</pre></div><div class="refsection" title="追加情報"><a name="id287015456"></a><h2>追加情報</h2><p><a class="xref" href="#ST_XMin" title="ST_XMin">ST_XMin</a>, <a class="xref" href="#ST_YMax" title="ST_YMax">ST_YMax</a>, <a class="xref" href="#ST_YMin" title="ST_YMin">ST_YMin</a>, <a class="xref" href="#ST_ZMax" title="ST_ZMax">ST_ZMax</a>, <a class="xref" href="#ST_ZMin" title="ST_ZMin">ST_ZMin</a></p></div></div><div class="refentry" title="ST_XMin"><div class="refentry.separator"><hr></div><a name="ST_XMin"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_XMin ? 2次元,3次元バウンディングボックスまたはジオメトリにおけるXの最小値を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_XMin</b>(</code>box3d  <var class="pdparam">aGeomorBox2DorBox3D</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287015518"></a><h2>説明</h2><p>2次元,3次元バウンディングボックスまたはジオメトリにおけるXの最小値を返します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はbox3dのみ定義していますが、ジオメトリとbox2dに定義されている自動キャストの振る舞いによって、box2dとジオメトリでも動作します。ジオメトリまたはbox2dの文字列表現については、自動キャストしないため、与えることはできません。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p></div><div class="refsection" title="例"><a name="id287015557"></a><h2>例</h2><pre class="programlisting">SELECT ST_XMin('BOX3D(1 2 3, 4 5 6)');
st_xmin
-------
1

SELECT ST_XMin(ST_GeomFromText('LINESTRING(1 3 4, 5 6 7)'));
st_xmin
-------
1

SELECT ST_XMin(CAST('BOX(-3 2, 3 4)' As box2d));
st_xmin
-------
-3
-- 文字列表現からBOX3Dへの自動キャストを試みるために動作しないのを
-- 観察します。
SELECT ST_XMin('LINESTRING(1 3, 5 6)');

--ERROR:  BOX3D parser - doesnt start with BOX3D(

SELECT ST_XMin(ST_GeomFromEWKT('CIRCULARSTRING(220268 150415 1,220227 150505 2,220227 150406 3)'));
st_xmin
--------
220186.995121892
		</pre></div><div class="refsection" title="追加情報"><a name="id287015570"></a><h2>追加情報</h2><p><a class="xref" href="#ST_XMax" title="ST_XMax">ST_XMax</a>, <a class="xref" href="#ST_YMax" title="ST_YMax">ST_YMax</a>, <a class="xref" href="#ST_YMin" title="ST_YMin">ST_YMin</a>, <a class="xref" href="#ST_ZMax" title="ST_ZMax">ST_ZMax</a>, <a class="xref" href="#ST_ZMin" title="ST_ZMin">ST_ZMin</a></p></div></div><div class="refentry" title="ST_Y"><div class="refentry.separator"><hr></div><a name="ST_Y"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Y ? ポイントのY座標値を返し、有効でないならNULLを返します。入力はポイントでなければなりません。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_Y</b>(</code>geometry  <var class="pdparam">a_point</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287015667"></a><h2>説明</h2><p>ポイントのY座標値を返し、有効でないならNULLを返します。入力はポイントでなければなりません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 6.1.4</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p></div><div class="refsection" title="例"><a name="id287015716"></a><h2>例</h2><pre class="programlisting">SELECT ST_Y(ST_GeomFromEWKT('POINT(1 2 3 4)'));
 st_y
------
	2
(1 row)

SELECT ST_Y(ST_Centroid(ST_GeomFromEWKT('LINESTRING(1 2 3 4, 1 1 1 1)')));
 st_y
------
  1.5
(1 row)


		</pre></div><div class="refsection" title="追加情報"><a name="id287015729"></a><h2>追加情報</h2><p><a class="xref" href="#ST_Centroid" title="ST_Centroid">ST_Centroid</a>, <a class="xref" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a>, <a class="xref" href="#ST_M" title="ST_M">ST_M</a>, <a class="xref" href="#ST_X" title="ST_X">ST_X</a>, <a class="xref" href="#ST_YMax" title="ST_YMax">ST_YMax</a>, <a class="xref" href="#ST_YMin" title="ST_YMin">ST_YMin</a>, <a class="xref" href="#ST_Z" title="ST_Z">ST_Z</a></p></div></div><div class="refentry" title="ST_YMax"><div class="refentry.separator"><hr></div><a name="ST_YMax"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_YMax ? 2次元,3次元バウンディングボックスまたはジオメトリにおけるYの最大値を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_YMax</b>(</code>box3d  <var class="pdparam">aGeomorBox2DorBox3D</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287015798"></a><h2>説明</h2><p>2次元,3次元バウンディングボックスまたはジオメトリにおけるYの最大値を返します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はbox3dのみ定義していますが、ジオメトリとbox2dに定義されている自動キャストの振る舞いによって、box2dとジオメトリでも動作します。ジオメトリまたはbox2dの文字列表現については、自動キャストしないため、与えることはできません。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p></div><div class="refsection" title="例"><a name="id287015836"></a><h2>例</h2><pre class="programlisting">SELECT ST_YMax('BOX3D(1 2 3, 4 5 6)');
st_ymax
-------
5

SELECT ST_YMax(ST_GeomFromText('LINESTRING(1 3 4, 5 6 7)'));
st_ymax
-------
6

SELECT ST_YMax(CAST('BOX(-3 2, 3 4)' As box2d));
st_ymax
-------
4
-- 文字列表現からBOX3Dへの自動キャストを試みるために動作しないのを
-- 観察します。
SELECT ST_YMax('LINESTRING(1 3, 5 6)');

--ERROR:  BOX3D parser - doesnt start with BOX3D(

SELECT ST_YMax(ST_GeomFromEWKT('CIRCULARSTRING(220268 150415 1,220227 150505 2,220227 150406 3)'));
st_ymax
--------
150506.126829327
		</pre></div><div class="refsection" title="追加情報"><a name="id287015849"></a><h2>追加情報</h2><p><a class="xref" href="#ST_XMin" title="ST_XMin">ST_XMin</a>, <a class="xref" href="#ST_XMax" title="ST_XMax">ST_XMax</a>, <a class="xref" href="#ST_YMin" title="ST_YMin">ST_YMin</a>, <a class="xref" href="#ST_ZMax" title="ST_ZMax">ST_ZMax</a>, <a class="xref" href="#ST_ZMin" title="ST_ZMin">ST_ZMin</a></p></div></div><div class="refentry" title="ST_YMin"><div class="refentry.separator"><hr></div><a name="ST_YMin"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_YMin ? 2次元,3次元バウンディングボックスまたはジオメトリにおけるYの最小値を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_YMin</b>(</code>box3d  <var class="pdparam">aGeomorBox2DorBox3D</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287015912"></a><h2>説明</h2><p>2次元,3次元バウンディングボックスまたはジオメトリにおけるYの最小値を返します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はbox3dのみ定義していますが、ジオメトリとbox2dに定義されている自動キャストの振る舞いによって、box2dとジオメトリでも動作します。ジオメトリまたはbox2dの文字列表現については、自動キャストしないため、与えることはできません。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p></div><div class="refsection" title="例"><a name="id287015949"></a><h2>例</h2><pre class="programlisting">SELECT ST_YMin('BOX3D(1 2 3, 4 5 6)');
st_ymin
-------
2

SELECT ST_YMin(ST_GeomFromText('LINESTRING(1 3 4, 5 6 7)'));
st_ymin
-------
3

SELECT ST_YMin(CAST('BOX(-3 2, 3 4)' As box2d));
st_ymin
-------
2
-- 文字列表現からBOX3Dへの自動キャストを試みるために動作しないのを
-- 観察します。
SELECT ST_YMin('LINESTRING(1 3, 5 6)');

--ERROR:  BOX3D parser - doesnt start with BOX3D(

SELECT ST_YMin(ST_GeomFromEWKT('CIRCULARSTRING(220268 150415 1,220227 150505 2,220227 150406 3)'));
st_ymin
--------
150406
		</pre></div><div class="refsection" title="追加情報"><a name="id287015962"></a><h2>追加情報</h2><p><a class="xref" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a>, <a class="xref" href="#ST_XMin" title="ST_XMin">ST_XMin</a>, <a class="xref" href="#ST_XMax" title="ST_XMax">ST_XMax</a>, <a class="xref" href="#ST_YMax" title="ST_YMax">ST_YMax</a>, <a class="xref" href="#ST_ZMax" title="ST_ZMax">ST_ZMax</a>, <a class="xref" href="#ST_ZMin" title="ST_ZMin">ST_ZMin</a></p></div></div><div class="refentry" title="ST_Z"><div class="refentry.separator"><hr></div><a name="ST_Z"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Z ? ポイントのZ座標値を返し、有効でないならNULLを返します。入力はポイントでなければなりません。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_Z</b>(</code>geometry  <var class="pdparam">a_point</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287016062"></a><h2>説明</h2><p>ポイントのZ座標値を返し、有効でないならNULLを返します。入力はポイントでなければなりません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p></div><div class="refsection" title="例"><a name="id287016097"></a><h2>例</h2><pre class="programlisting">SELECT ST_Z(ST_GeomFromEWKT('POINT(1 2 3 4)'));
 st_z
------
	3
(1 row)

		</pre></div><div class="refsection" title="追加情報"><a name="id287016109"></a><h2>追加情報</h2><p><a class="xref" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a>, <a class="xref" href="#ST_M" title="ST_M">ST_M</a>, <a class="xref" href="#ST_X" title="ST_X">ST_X</a>, <a class="xref" href="#ST_Y" title="ST_Y">ST_Y</a>, <a class="xref" href="#ST_ZMax" title="ST_ZMax">ST_ZMax</a>, <a class="xref" href="#ST_ZMin" title="ST_ZMin">ST_ZMin</a> </p></div></div><div class="refentry" title="ST_ZMax"><div class="refentry.separator"><hr></div><a name="ST_ZMax"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ZMax ? 2次元,3次元バウンディングボックスまたはジオメトリにおけるZの最大値を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_ZMax</b>(</code>box3d  <var class="pdparam">aGeomorBox2DorBox3D</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287016177"></a><h2>説明</h2><p>2次元,3次元バウンディングボックスまたはジオメトリにおけるZの最大値を返します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はbox3dのみ定義していますが、ジオメトリとbox2dに定義されている自動キャストの振る舞いによって、box2dとジオメトリでも動作します。ジオメトリまたはbox2dの文字列表現については、自動キャストしないため、与えることはできません。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p></div><div class="refsection" title="例"><a name="id287016215"></a><h2>例</h2><pre class="programlisting">SELECT ST_ZMax('BOX3D(1 2 3, 4 5 6)');
st_zmax
-------
6

SELECT ST_ZMax(ST_GeomFromEWKT('LINESTRING(1 3 4, 5 6 7)'));
st_zmax
-------
7

SELECT ST_ZMax('BOX3D(-3 2 1, 3 4 1)' );
st_zmax
-------
1
-- 文字列表現からBOX3Dへの自動キャストを試みるために動作しないのを
-- 観察します。
SELECT ST_ZMax('LINESTRING(1 3 4, 5 6 7)');

--ERROR:  BOX3D parser - doesnt start with BOX3D(

SELECT ST_ZMax(ST_GeomFromEWKT('CIRCULARSTRING(220268 150415 1,220227 150505 2,220227 150406 3)'));
st_zmax
--------
3
		</pre></div><div class="refsection" title="追加情報"><a name="id287016228"></a><h2>追加情報</h2><p><a class="xref" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a>, <a class="xref" href="#ST_XMin" title="ST_XMin">ST_XMin</a>, <a class="xref" href="#ST_XMax" title="ST_XMax">ST_XMax</a>, <a class="xref" href="#ST_YMax" title="ST_YMax">ST_YMax</a>, <a class="xref" href="#ST_YMin" title="ST_YMin">ST_YMin</a>, <a class="xref" href="#ST_ZMax" title="ST_ZMax">ST_ZMax</a></p></div></div><div class="refentry" title="ST_Zmflag"><div class="refentry.separator"><hr></div><a name="ST_Zmflag"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Zmflag ? ポイントのZM(次元の意味)フラグをsmall intで返します。値は 0=XY, 1=XYM, 2=XYZ, 3=XYZMとなります。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">smallint <b class="fsfunc">ST_Zmflag</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287016295"></a><h2>説明</h2><p>ポイントのZM(次元の意味)フラグをsmall intで返します。値は 0=XY, 1=XYM, 2=XYZ, 3=XYZMとなります。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p></div><div class="refsection" title="例"><a name="id287016327"></a><h2>例</h2><pre class="programlisting">SELECT ST_Zmflag(ST_GeomFromEWKT('LINESTRING(1 2, 3 4)'));
 st_zmflag
-----------
		 0

SELECT ST_Zmflag(ST_GeomFromEWKT('LINESTRINGM(1 2 3, 3 4 3)'));
 st_zmflag
-----------
		 1

SELECT ST_Zmflag(ST_GeomFromEWKT('CIRCULARSTRING(1 2 3, 3 4 3, 5 6 3)'));
 st_zmflag
-----------
		 2
SELECT ST_Zmflag(ST_GeomFromEWKT('POINT(1 2 3 4)'));
 st_zmflag
-----------
		 3
</pre></div><div class="refsection" title="追加情報"><a name="id287016340"></a><h2>追加情報</h2><p><a class="xref" href="#ST_CoordDim" title="ST_CoordDim">ST_CoordDim</a>, <a class="xref" href="#ST_NDims" title="ST_NDims">ST_NDims</a>, <a class="xref" href="#ST_Dimension" title="ST_Dimension">ST_Dimension</a></p></div></div><div class="refentry" title="ST_ZMin"><div class="refentry.separator"><hr></div><a name="ST_ZMin"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ZMin ? 2次元または3次元ジオメトリのバウンディングボックスにおけるZの最小値を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_ZMin</b>(</code>box3d  <var class="pdparam">aGeomorBox2DorBox3D</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287016396"></a><h2>説明</h2><p>2次元または3次元ジオメトリのバウンディングボックスにおけるZの最小値を返します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はbox3dのみ定義していますが、ジオメトリとbox2dに定義されている自動キャストの振る舞いによって、box2dとジオメトリでも動作します。ジオメトリまたはbox2dの文字列表現については、自動キャストしないため、与えることはできません。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p></div><div class="refsection" title="例"><a name="id287016469"></a><h2>例</h2><pre class="programlisting">SELECT ST_ZMin('BOX3D(1 2 3, 4 5 6)');
st_zmin
-------
3

SELECT ST_ZMin(ST_GeomFromEWKT('LINESTRING(1 3 4, 5 6 7)'));
st_zmin
-------
4

SELECT ST_ZMin('BOX3D(-3 2 1, 3 4 1)' );
st_zmin
-------
1
-- 文字列表現からBOX3Dへの自動キャストを試みるために動作しないのを
-- 観察します。
SELECT ST_ZMin('LINESTRING(1 3 4, 5 6 7)');

--ERROR:  BOX3D parser - doesnt start with BOX3D(

SELECT ST_ZMin(ST_GeomFromEWKT('CIRCULARSTRING(220268 150415 1,220227 150505 2,220227 150406 3)'));
st_zmin
--------
1
		</pre></div><div class="refsection" title="追加情報"><a name="id287016482"></a><h2>追加情報</h2><p><a class="xref" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a>, <a class="xref" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a>, <a class="xref" href="#ST_XMin" title="ST_XMin">ST_XMin</a>, <a class="xref" href="#ST_XMax" title="ST_XMax">ST_XMax</a>, <a class="xref" href="#ST_YMax" title="ST_YMax">ST_YMax</a>, <a class="xref" href="#ST_YMin" title="ST_YMin">ST_YMin</a>, <a class="xref" href="#ST_ZMax" title="ST_ZMax">ST_ZMax</a></p></div></div></div><div class="sect1" title="8.5. ジオメトリ エディタ"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Geometry_Editors"></a>8.5. ジオメトリ エディタ</h2></div></div></div><div class="toc"><dl><dt><span class="refentrytitle"><a href="#ST_AddPoint">ST_AddPoint</a></span><span class="refpurpose"> ? ラインストリングに対して指定した&lt;position&gt;(0はじまり)の前にポイントを追加します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Affine">ST_Affine</a></span><span class="refpurpose"> ? 3次元アフィン変換をジオメトリに適用して移動、回転、拡大縮小を一度に行います。 </span></dt><dt><span class="refentrytitle"><a href="#ST_Force_2D">ST_Force_2D</a></span><span class="refpurpose"> ? ジオメトリを「2次元モード」に強制させます。全ての出力表現はXY座標値のみを持つことになります。</span></dt><dt><span class="refentrytitle"><a href="#ST_Force_3D">ST_Force_3D</a></span><span class="refpurpose"> ? ジオメトリをXYZモードに強制します。これはST_Force_3DZの別名です。</span></dt><dt><span class="refentrytitle"><a href="#ST_Force_3DZ">ST_Force_3DZ</a></span><span class="refpurpose"> ? ジオメトリをXYZモードに強制します。これはST_Force_3Dと同義です。</span></dt><dt><span class="refentrytitle"><a href="#ST_Force_3DM">ST_Force_3DM</a></span><span class="refpurpose"> ? ジオメトリをXYMモードに強制します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Force_4D">ST_Force_4D</a></span><span class="refpurpose"> ? ジオメトリをXYZMモードに強制します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Force_Collection">ST_Force_Collection</a></span><span class="refpurpose"> ? ジオメトリをGEOMETRYCOLLECTIONに変換します。</span></dt><dt><span class="refentrytitle"><a href="#ST_ForceRHR">ST_ForceRHR</a></span><span class="refpurpose"> ? ポリゴンの頂点の方向を右回りに強制します。</span></dt><dt><span class="refentrytitle"><a href="#ST_LineMerge">ST_LineMerge</a></span><span class="refpurpose"> ? MULTILINESTRINGをまとめ合わせて形成されるラインストリング(またはその集合)を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_CollectionExtract">ST_CollectionExtract</a></span><span class="refpurpose"> ? (マルチ)ジオメトリを与えると、指定したタイプの要素でのみ構成される(マルチ)ジオメトリを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_CollectionHomogenize">ST_CollectionHomogenize</a></span><span class="refpurpose"> ? ジオメトリコレクションを与えると、「最も単純な」表現を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Multi">ST_Multi</a></span><span class="refpurpose"> ? ルチ系ジオメトリを返します。ジオメトリが既にマルチ系なら変更せずに返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_RemovePoint">ST_RemovePoint</a></span><span class="refpurpose"> ? ラインストリングからポイントを削除します。オフセットは0はじまりです。</span></dt><dt><span class="refentrytitle"><a href="#ST_Reverse">ST_Reverse</a></span><span class="refpurpose"> ? 頂点の順序を逆にしたジオメトリを返します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_Rotate">ST_Rotate</a></span><span class="refpurpose"> ? ジオメトリを、原点について反時計回りにrotRadiasnぶん回転させます。</span></dt><dt><span class="refentrytitle"><a href="#ST_RotateX">ST_RotateX</a></span><span class="refpurpose"> ? ジオメトリをX軸についてrotRadians回転させます。</span></dt><dt><span class="refentrytitle"><a href="#ST_RotateY">ST_RotateY</a></span><span class="refpurpose"> ? ジオメトリgeomAをY軸についてrotRadians回転させます。</span></dt><dt><span class="refentrytitle"><a href="#ST_RotateZ">ST_RotateZ</a></span><span class="refpurpose"> ? ジオメトリをZ軸についてrotRadians回転させます。</span></dt><dt><span class="refentrytitle"><a href="#ST_Scale">ST_Scale</a></span><span class="refpurpose"> ? パラメータで軸を乗算してジオメトリを新しいサイズに拡大縮小します。ST_Scale(geom, Xfactor, Yfactor, Zfactor)となります。</span></dt><dt><span class="refentrytitle"><a href="#ST_Segmentize">ST_Segmentize</a></span><span class="refpurpose"> ? 与えられた距離より長い辺を持たないジオメトリに編集して返します。距離計算は2次元でしか行いません。</span></dt><dt><span class="refentrytitle"><a href="#ST_SetPoint">ST_SetPoint</a></span><span class="refpurpose"> ? ラインストリングのN番目を与えられたポイントに置き換えます。インデクスは0はじまりです。</span></dt><dt><span class="refentrytitle"><a href="#ST_SetSRID">ST_SetSRID</a></span><span class="refpurpose"> ? ジオメトリのSRIDを特定の整数値に設定します。</span></dt><dt><span class="refentrytitle"><a href="#ST_SnapToGrid">ST_SnapToGrid</a></span><span class="refpurpose"> ? 入力ジオメトリの全ての点を規則的なグリッドにスナップします。</span></dt><dt><span class="refentrytitle"><a href="#ST_Snap">ST_Snap</a></span><span class="refpurpose"> ? 入力ジオメトリの辺と頂点を参照ジオメトリの頂点にスナップします。</span></dt><dt><span class="refentrytitle"><a href="#ST_Transform">ST_Transform</a></span><span class="refpurpose"> ? 整数パラメータで参照されるSRIDに座標変換し、新しいジオメトリを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Translate">ST_Translate</a></span><span class="refpurpose"> ? 整数パラメータをオフセットにして新しい位置にジオメトリを移動させます。ST_Translate(geom, X, Y)またはST_Translate(geom, X, Y, Z)になります。 </span></dt><dt><span class="refentrytitle"><a href="#ST_TransScale">ST_TransScale</a></span><span class="refpurpose"> ? deltaXとdeltaY引数を使ってジオメトリを移動させ、XFactor,YFactor引数で拡大縮小させます。2次元でのみ動作します。</span></dt></dl></div><div class="refentry" title="ST_AddPoint"><a name="ST_AddPoint"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AddPoint ? ラインストリングに対して指定した&lt;position&gt;(0はじまり)の前にポイントを追加します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_AddPoint</b>(</code>geometry <var class="pdparam">linestring</var>, geometry <var class="pdparam">point</var><code>)</code>;</p></div><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_AddPoint</b>(</code>geometry <var class="pdparam">linestring</var>, geometry <var class="pdparam">point</var>, integer <var class="pdparam">position</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287023085"></a><h2>説明</h2><p>ラインストリングに対して指定した&lt;position&gt;(0はじまり)の前にポイントを追加します。第3引数に-1を指定すると末尾に追加できます。</p><p>初出: 1.1.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p></div><div class="refsection" title="例"><a name="id287023111"></a><h2>例</h2><pre class="programlisting">
-- 閉じてないラインストリングについてのみ末尾に始点を追加して、
-- テーブル内の全てのラインストリングが閉じることを保障するようにします。
UPDATE sometable
SET the_geom = ST_AddPoint(the_geom, ST_StartPoint(the_geom))
FROM sometable
WHERE ST_IsClosed(the_geom) = false;

-- 3次元ラインストリングにポイントを追加
SELECT ST_AsEWKT(ST_AddPoint(ST_GeomFromEWKT('LINESTRING(0 0 1, 1 1 1)'), ST_MakePoint(1, 2, 3)));

-- 結果
st_asewkt
----------
LINESTRING(0 0 1,1 1 1,1 2 3)
			</pre></div><div class="refsection" title="関連情報"><a name="id287023122"></a><h2>関連情報</h2><p><a class="xref" href="#ST_RemovePoint" title="ST_RemovePoint">ST_RemovePoint</a>, <a class="xref" href="#ST_SetPoint" title="ST_SetPoint">ST_SetPoint</a></p></div></div><div class="refentry" title="ST_Affine"><div class="refentry.separator"><hr></div><a name="ST_Affine"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Affine ? 3次元アフィン変換をジオメトリに適用して移動、回転、拡大縮小を一度に行います。 </p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Affine</b>(</code>geometry  <var class="pdparam">geomA</var>, float  <var class="pdparam">a</var>, float  <var class="pdparam">b</var>, float  <var class="pdparam">c</var>, float  <var class="pdparam">d</var>, float  <var class="pdparam">e</var>, float  <var class="pdparam">f</var>, float  <var class="pdparam">g</var>, float  <var class="pdparam">h</var>, float  <var class="pdparam">i</var>, float  <var class="pdparam">xoff</var>, float  <var class="pdparam">yoff</var>, float  <var class="pdparam">zoff</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_Affine</b>(</code>geometry  <var class="pdparam">geomA</var>, float  <var class="pdparam">a</var>, float  <var class="pdparam">b</var>, float  <var class="pdparam">d</var>, float  <var class="pdparam">e</var>, float  <var class="pdparam">xoff</var>, float  <var class="pdparam">yoff</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287023383"></a><h2>説明</h2><p>3次元アフィン変換をジオメトリに適用して移動、回転、拡大縮小を一度に行います。</p><p>
		1つめの形式では、次のように関数を呼んでいます。</p><pre class="programlisting">ST_Affine(geom, a, b, c, d, e, f, g, h, i, xoff, yoff, zoff) </pre><p>
			これは次のような変換行列を表現しています。</p><pre class="programlisting">/ a  b  c  xoff \
| d  e  f  yoff |
| g  h  i  zoff |
\ 0  0  0     1 /</pre><p>次のようにも表現できます。</p><pre class="programlisting">x' = a*x + b*y + c*z + xoff
y' = d*x + e*y + f*z + yoff
z' = g*x + h*y + i*z + zoff</pre><p>全ての移動/拡大縮小関数はこのようなアフィン変換を経由しています。</p><p>2つめの形式では、2次元アフィン変換をジオメトリに適用します。次のように関数を呼んでいます。</p><pre class="programlisting">ST_Affine(geom, a, b, d, e, xoff, yoff)</pre><p>これは次のような変換行列を表現しています。</p><pre class="programlisting">/  a  b  0  xoff  \       /  a  b  xoff  \
|  d  e  0  yoff  | rsp.  |  d  e  yoff  |
|  0  0  1     0  |       \  0  0     1  /
\  0  0  0     1  /</pre><p>頂点は次のように変換されます。</p><pre class="programlisting">x' = a*x + b*y + xoff
y' = d*x + e*y + yoff
z' = z </pre><p>このメソッドは上述の3次元メソッドの特異ケースです。 </p><p>機能強化: 2.0.0では、多面体サーフェス、三角形、TINが導入されました。</p><p>初出: 1.1.2。AffineからST_Affineに名称変更しました。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>1.3.4より前は、曲線を含むジオメトリで使うとクラッシュしました。これは1.3.4以降では訂正されています。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は多面体サーフェスに対応しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は三角形と不規則三角網(TIN)に対応しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p></div><div class="refsection" title="例"><a name="id287023482"></a><h2>例</h2><pre class="programlisting">
-- 3次元ラインストリングをZ軸で180度回転させます。
-- ST_RotateZ()を冗長にしたものです。
 SELECT ST_AsEWKT(ST_Affine(the_geom,  cos(pi()), -sin(pi()), 0,  sin(pi()), cos(pi()), 0,  0, 0, 1,  0, 0, 0)) As using_affine,
	 ST_AsEWKT(ST_Rotate(the_geom, pi())) As using_rotate
	FROM (SELECT ST_GeomFromEWKT('LINESTRING(1 2 3, 1 4 3)') As the_geom) As foo;
        using_affine         |        using_rotate
-----------------------------+-----------------------------
 LINESTRING(-1 -2 3,-1 -4 3) | LINESTRING(-1 -2 3,-1 -4 3)
(1 row)

-- 3次元ラインストリングをX軸とZ軸で180度回転させます。
SELECT ST_AsEWKT(ST_Affine(the_geom, cos(pi()), -sin(pi()), 0, sin(pi()), cos(pi()), -sin(pi()), 0, sin(pi()), cos(pi()), 0, 0, 0))
	FROM (SELECT ST_GeomFromEWKT('LINESTRING(1 2 3, 1 4 3)') As the_geom) As foo;
           st_asewkt
-------------------------------
 LINESTRING(-1 -2 -3,-1 -4 -3)
(1 row)
		</pre></div><div class="refsection" title="関連情報"><a name="id287023495"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Rotate" title="ST_Rotate">ST_Rotate</a>, <a class="xref" href="#ST_Scale" title="ST_Scale">ST_Scale</a>, <a class="xref" href="#ST_Translate" title="ST_Translate">ST_Translate</a>, <a class="xref" href="#ST_TransScale" title="ST_TransScale">ST_TransScale</a></p></div></div><div class="refentry" title="ST_Force_2D"><div class="refentry.separator"><hr></div><a name="ST_Force_2D"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Force_2D ? ジオメトリを「2次元モード」に強制させます。全ての出力表現はXY座標値のみを持つことになります。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Force_2D</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287023555"></a><h2>説明</h2><p>ジオメトリを「2次元モード」に強制させます。全ての出力表現はXY座標値のみを持つことになります。OGC準拠の出力(OGCは2次元ジオメトリのみ策定しています)に強制するために使われます。</p><p>機能強化: 2.0.0では、多面体サーフェスが導入されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は多面体サーフェスに対応しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p></div><div class="refsection" title="例"><a name="id287023601"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsEWKT(ST_Force_2D(ST_GeomFromEWKT('CIRCULARSTRING(1 1 2, 2 3 2, 4 5 2, 6 7 2, 5 6 2)')));
		st_asewkt
-------------------------------------
CIRCULARSTRING(1 1,2 3,4 5,6 7,5 6)

SELECT  ST_AsEWKT(ST_Force_2D('POLYGON((0 0 2,0 5 2,5 0 2,0 0 2),(1 1 2,3 1 2,1 3 2,1 1 2))'));

				  st_asewkt
----------------------------------------------
 POLYGON((0 0,0 5,5 0,0 0),(1 1,3 1,1 3,1 1))

		</pre></div><div class="refsection" title="関連情報"><a name="id287023613"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Force_3D" title="ST_Force_3D">ST_Force_3D</a></p></div></div><div class="refentry" title="ST_Force_3D"><div class="refentry.separator"><hr></div><a name="ST_Force_3D"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Force_3D ? ジオメトリをXYZモードに強制します。これはST_Force_3DZの別名です。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Force_3D</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287023698"></a><h2>説明</h2><p>ジオメトリをXYZモードに強制します。これはST_Force_3DZの別名です。ジオメトリがZ値を持っていない場合は0のZ値を追加します。 </p><p>機能強化: 2.0.0では、多面体サーフェスが導入されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は多面体サーフェスに対応しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p></div><div class="refsection" title="例"><a name="id287023745"></a><h2>例</h2><pre class="programlisting">
		-- 既に3次元ジオメトリになっている場合は何も起きません
		SELECT ST_AsEWKT(ST_Force_3D(ST_GeomFromEWKT('CIRCULARSTRING(1 1 2, 2 3 2, 4 5 2, 6 7 2, 5 6 2)')));
				   st_asewkt
-----------------------------------------------
 CIRCULARSTRING(1 1 2,2 3 2,4 5 2,6 7 2,5 6 2)


SELECT  ST_AsEWKT(ST_Force_3D('POLYGON((0 0,0 5,5 0,0 0),(1 1,3 1,1 3,1 1))'));

						 st_asewkt
--------------------------------------------------------------
 POLYGON((0 0 0,0 5 0,5 0 0,0 0 0),(1 1 0,3 1 0,1 3 0,1 1 0))
		</pre></div><div class="refsection" title="関連情報"><a name="id287023757"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a>, <a class="xref" href="#ST_Force_2D" title="ST_Force_2D">ST_Force_2D</a>, <a class="xref" href="#ST_Force_3DM" title="ST_Force_3DM">ST_Force_3DM</a>, <a class="xref" href="#ST_Force_3DZ" title="ST_Force_3DZ">ST_Force_3DZ</a></p></div></div><div class="refentry" title="ST_Force_3DZ"><div class="refentry.separator"><hr></div><a name="ST_Force_3DZ"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Force_3DZ ? ジオメトリをXYZモードに強制します。これはST_Force_3Dと同義です。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Force_3DZ</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287023851"></a><h2>説明</h2><p>ジオメトリをXYZモードに強制します。これはST_Force_3Dと同義です。ジオメトリがZ値を持っていない場合は0のZ値を追加します。</p><p>機能強化: 2.0.0では、多面体サーフェスが導入されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は多面体サーフェスに対応しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p></div><div class="refsection" title="例"><a name="id287023932"></a><h2>例</h2><pre class="programlisting">
-- 既に3次元ジオメトリになっている場合は何も起きません
SELECT ST_AsEWKT(ST_Force_3DZ(ST_GeomFromEWKT('CIRCULARSTRING(1 1 2, 2 3 2, 4 5 2, 6 7 2, 5 6 2)')));
				   st_asewkt
-----------------------------------------------
 CIRCULARSTRING(1 1 2,2 3 2,4 5 2,6 7 2,5 6 2)


SELECT  ST_AsEWKT(ST_Force_3DZ('POLYGON((0 0,0 5,5 0,0 0),(1 1,3 1,1 3,1 1))'));

						 st_asewkt
--------------------------------------------------------------
 POLYGON((0 0 0,0 5 0,5 0 0,0 0 0),(1 1 0,3 1 0,1 3 0,1 1 0))
		</pre></div><div class="refsection" title="関連情報"><a name="id287023945"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a>, <a class="xref" href="#ST_Force_2D" title="ST_Force_2D">ST_Force_2D</a>, <a class="xref" href="#ST_Force_3DM" title="ST_Force_3DM">ST_Force_3DM</a>, <a class="xref" href="#ST_Force_3D" title="ST_Force_3D">ST_Force_3D</a></p></div></div><div class="refentry" title="ST_Force_3DM"><div class="refentry.separator"><hr></div><a name="ST_Force_3DM"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Force_3DM ? ジオメトリをXYMモードに強制します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Force_3DM</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287024005"></a><h2>説明</h2><p>ジオメトリをXYMモードに強制します。ジオメトリがM値を持っていない場合は0のM値を追加します。Z値を持っている場合はZ値は除去されます。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p></div><div class="refsection" title="例"><a name="id287024024"></a><h2>例</h2><pre class="programlisting">
SELECT ST_AsEWKT(ST_Force_3DM(ST_GeomFromEWKT('CIRCULARSTRING(1 1 2, 2 3 2, 4 5 2, 6 7 2, 5 6 2)')));
				   st_asewkt
------------------------------------------------
 CIRCULARSTRINGM(1 1 0,2 3 0,4 5 0,6 7 0,5 6 0)


SELECT  ST_AsEWKT(ST_Force_3DM('POLYGON((0 0 1,0 5 1,5 0 1,0 0 1),(1 1 1,3 1 1,1 3 1,1 1 1))'));

						  st_asewkt
---------------------------------------------------------------
 POLYGONM((0 0 0,0 5 0,5 0 0,0 0 0),(1 1 0,3 1 0,1 3 0,1 1 0))

		</pre></div><div class="refsection" title="関連情報"><a name="id287024037"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a>,  <a class="xref" href="#ST_Force_2D" title="ST_Force_2D">ST_Force_2D</a>, <a class="xref" href="#ST_Force_3DM" title="ST_Force_3DM">ST_Force_3DM</a>, <a class="xref" href="#ST_Force_3D" title="ST_Force_3D">ST_Force_3D</a>, <a class="xref" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a></p></div></div><div class="refentry" title="ST_Force_4D"><div class="refentry.separator"><hr></div><a name="ST_Force_4D"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Force_4D ? ジオメトリをXYZMモードに強制します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Force_4D</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287024100"></a><h2>説明</h2><p>ジオメトリをXYZMモードに強制します。Z値やM値が無い場合は0を追加します。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p></div><div class="refsection" title="例"><a name="id287024166"></a><h2>例</h2><pre class="programlisting">
SELECT ST_AsEWKT(ST_Force_4D(ST_GeomFromEWKT('CIRCULARSTRING(1 1 2, 2 3 2, 4 5 2, 6 7 2, 5 6 2)')));
						st_asewkt
---------------------------------------------------------
 CIRCULARSTRING(1 1 2 0,2 3 2 0,4 5 2 0,6 7 2 0,5 6 2 0)



SELECT  ST_AsEWKT(ST_Force_4D('MULTILINESTRINGM((0 0 1,0 5 2,5 0 3,0 0 4),(1 1 1,3 1 1,1 3 1,1 1 1))'));

									  st_asewkt
--------------------------------------------------------------------------------------
 MULTILINESTRING((0 0 0 1,0 5 0 2,5 0 0 3,0 0 0 4),(1 1 0 1,3 1 0 1,1 3 0 1,1 1 0 1))

		</pre></div><div class="refsection" title="関連情報"><a name="id287024179"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a>, <a class="xref" href="#ST_Force_2D" title="ST_Force_2D">ST_Force_2D</a>, <a class="xref" href="#ST_Force_3DM" title="ST_Force_3DM">ST_Force_3DM</a>, <a class="xref" href="#ST_Force_3D" title="ST_Force_3D">ST_Force_3D</a></p></div></div><div class="refentry" title="ST_Force_Collection"><div class="refentry.separator"><hr></div><a name="ST_Force_Collection"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Force_Collection ? ジオメトリをGEOMETRYCOLLECTIONに変換します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Force_Collection</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287024273"></a><h2>説明</h2><p>ジオメトリをジオメトリコレクションに変換します。これはWKB表現を単純化するのに便利です。</p><p>機能強化: 2.0.0では、多面体サーフェスが導入されました。</p><p>初出: 1.2.2。1.3.4より前は、曲線を含むジオメトリで使うとクラッシュしました。これは1.3.4以上では訂正されています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は多面体サーフェスに対応しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p></div><div class="refsection" title="例"><a name="id287024322"></a><h2>例</h2><pre class="programlisting">

SELECT  ST_AsEWKT(ST_Force_Collection('POLYGON((0 0 1,0 5 1,5 0 1,0 0 1),(1 1 1,3 1 1,1 3 1,1 1 1))'));

								   st_asewkt
----------------------------------------------------------------------------------
 GEOMETRYCOLLECTION(POLYGON((0 0 1,0 5 1,5 0 1,0 0 1),(1 1 1,3 1 1,1 3 1,1 1 1)))


  SELECT ST_AsText(ST_Force_Collection('CIRCULARSTRING(220227 150406,2220227 150407,220227 150406)'));
								   st_astext
--------------------------------------------------------------------------------
 GEOMETRYCOLLECTION(CIRCULARSTRING(220227 150406,2220227 150407,220227 150406))
(1 row)

		</pre><pre class="programlisting">
-- POLYHEDRAL example --
SELECT ST_AsEWKT(ST_Force_Collection('POLYHEDRALSURFACE(((0 0 0,0 0 1,0 1 1,0 1 0,0 0 0)),
 ((0 0 0,0 1 0,1 1 0,1 0 0,0 0 0)),
 ((0 0 0,1 0 0,1 0 1,0 0 1,0 0 0)),
 ((1 1 0,1 1 1,1 0 1,1 0 0,1 1 0)),
 ((0 1 0,0 1 1,1 1 1,1 1 0,0 1 0)),
 ((0 0 1,1 0 1,1 1 1,0 1 1,0 0 1)))'))

								   st_asewkt
----------------------------------------------------------------------------------
GEOMETRYCOLLECTION(
  POLYGON((0 0 0,0 0 1,0 1 1,0 1 0,0 0 0)),
  POLYGON((0 0 0,0 1 0,1 1 0,1 0 0,0 0 0)),
  POLYGON((0 0 0,1 0 0,1 0 1,0 0 1,0 0 0)),
  POLYGON((1 1 0,1 1 1,1 0 1,1 0 0,1 1 0)),
  POLYGON((0 1 0,0 1 1,1 1 1,1 1 0,0 1 0)),
  POLYGON((0 0 1,1 0 1,1 1 1,0 1 1,0 0 1))
)
		</pre></div><div class="refsection" title="関連情報"><a name="id287024647"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a>,  <a class="xref" href="#ST_Force_2D" title="ST_Force_2D">ST_Force_2D</a>, <a class="xref" href="#ST_Force_3DM" title="ST_Force_3DM">ST_Force_3DM</a>, <a class="xref" href="#ST_Force_3D" title="ST_Force_3D">ST_Force_3D</a>, <a class="xref" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a></p></div></div><div class="refentry" title="ST_ForceRHR"><div class="refentry.separator"><hr></div><a name="ST_ForceRHR"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ForceRHR ? ポリゴンの頂点の方向を右回りに強制します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean
						<b class="fsfunc">ST_ForceRHR</b>(</code>geometry <var class="pdparam">g</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287024710"></a><h2>説明</h2><p>ポリゴンの頂点の方向を右回りに強制します。GIS用語では、ポリゴンで境界が作られた範囲は、境界線の右側になります。特に外環は時計回り方向で内環は反時計回りになります。</p><p>機能強化: 2.0.0では、多面体サーフェスが導入されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は多面体サーフェスに対応しています。</p></div><div class="refsection" title="例"><a name="id287024746"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsEWKT(
  ST_ForceRHR(
	'POLYGON((0 0 2, 5 0 2, 0 5 2, 0 0 2),(1 1 2, 1 3 2, 3 1 2, 1 1 2))'
  )
);
						  st_asewkt
--------------------------------------------------------------
 POLYGON((0 0 2,0 5 2,5 0 2,0 0 2),(1 1 2,3 1 2,1 3 2,1 1 2))
(1 row)</pre></div><div class="refsection" title="関連情報"><a name="id287024757"></a><h2>関連情報</h2><p><a class="xref" href="#ST_BuildArea" title="ST_BuildArea">ST_BuildArea</a>,
				<a class="xref" href="#ST_Polygonize" title="ST_Polygonize">ST_Polygonize</a>,
				<a class="xref" href="#ST_Reverse" title="ST_Reverse">ST_Reverse</a></p></div></div><div class="refentry" title="ST_LineMerge"><div class="refentry.separator"><hr></div><a name="ST_LineMerge"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_LineMerge ? MULTILINESTRINGをまとめ合わせて形成されるラインストリング(またはその集合)を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_LineMerge</b>(</code>geometry  <var class="pdparam">amultilinestring</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287024984"></a><h2>説明</h2><p>MULTILINESTRINGをまとめ合わせて形成されるラインストリング(またはその集合)を返します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>MULTILINESTRING/LINESTRINGに対してのみ使用して下さい。ポリゴンやジオメトリコレクションに対してこの関数を使うと、空のGEOMETRYCOLLECTIONが返ります。</p></td></tr></table></div><p>初出: 1.1.0</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>GEOS 2.1.0以降が必要です。</p></td></tr></table></div></div><div class="refsection" title="例"><a name="id287025005"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(ST_LineMerge(
ST_GeomFromText('MULTILINESTRING((-29 -27,-30 -29.7,-36 -31,-45 -33),(-45 -33,-46 -32))')
		)
);
st_astext
--------------------------------------------------------------------------------------------------
LINESTRING(-29 -27,-30 -29.7,-36 -31,-45 -33,-46 -32)
(1 row)

--If can't be merged - original MULTILINESTRING is returned
SELECT ST_AsText(ST_LineMerge(
ST_GeomFromText('MULTILINESTRING((-29 -27,-30 -29.7,-36 -31,-45 -33),(-45.2 -33.2,-46 -32))')
)
);
st_astext
----------------
MULTILINESTRING((-45.2 -33.2,-46 -32),(-29 -27,-30 -29.7,-36 -31,-45 -33))
			</pre></div><div class="refsection" title="関連情報"><a name="id287025017"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Segmentize" title="ST_Segmentize">ST_Segmentize</a>, <a class="xref" href="#ST_Line_Substring" title="ST_Line_Substring">ST_Line_Substring</a></p></div></div><div class="refentry" title="ST_CollectionExtract"><div class="refentry.separator"><hr></div><a name="ST_CollectionExtract"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_CollectionExtract ? (マルチ)ジオメトリを与えると、指定したタイプの要素でのみ構成される(マルチ)ジオメトリを返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_CollectionExtract</b>(</code>geometry  <var class="pdparam">collection</var>, integer  <var class="pdparam">type</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287025078"></a><h2>説明</h2><p>(マルチ)ジオメトリを与えると、指定したタイプの要素でのみ構成される(マルチ)ジオメトリを返します。指定したタイプでないジオメトリ要素は無視されます。正しいタイプのジオメトリ要素が無い場合はEMPTYジオメトリが返ります。ポイント、ラインストリング、ポリゴンのみをサポートします。番号は、1==ポイント, 2==ラインストリング, 3==ポリゴンです。</p><p>初出: 1.5.0</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>
1.5.3より前では、この関数は、非コクレションの入力については手を付けずに問題のないタイプで返しました。1.5.3では、適合しない単一ジオメトリについてはNULLを返しました。2.0.0では、適合するジオメトリが無い場合は常にEMPTYを返すようになりました。
			</p></td></tr></table></div></div><div class="refsection" title="例"><a name="id287025096"></a><h2>例</h2><pre class="programlisting">-- 定数: 1 == POINT, 2 == LINESTRING, 3 == POLYGON
SELECT ST_AsText(ST_CollectionExtract(ST_GeomFromText('GEOMETRYCOLLECTION(GEOMETRYCOLLECTION(POINT(0 0)))'),1));
st_astext
---------------
MULTIPOINT(0 0)
(1 row)

SELECT ST_AsText(ST_CollectionExtract(ST_GeomFromText('GEOMETRYCOLLECTION(GEOMETRYCOLLECTION(LINESTRING(0 0, 1 1)),LINESTRING(2 2, 3 3))'),2));
st_astext
---------------
MULTILINESTRING((0 0, 1 1), (2 2, 3 3))
(1 row)
			</pre></div><div class="refsection" title="関連情報"><a name="id287025107"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Multi" title="ST_Multi">ST_Multi</a>, <a class="xref" href="#ST_Dump" title="ST_Dump">ST_Dump</a>, <a class="xref" href="#ST_CollectionHomogenize" title="ST_CollectionHomogenize">ST_CollectionHomogenize</a></p></div></div><div class="refentry" title="ST_CollectionHomogenize"><div class="refentry.separator"><hr></div><a name="ST_CollectionHomogenize"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_CollectionHomogenize ? ジオメトリコレクションを与えると、「最も単純な」表現を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_CollectionHomogenize</b>(</code>geometry  <var class="pdparam">collection</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287025163"></a><h2>説明</h2><p>ジオメトリコレクションを与えると、「最も単純な」表現を返します。非マルチなタイプは非マルチのタイプを返します。同質なコレクションは適切なマルチ系タイプを返します。</p><p>初出: 2.0.0</p></div><div class="refsection" title="例"><a name="id287025176"></a><h2>例</h2><pre class="programlisting">
  SELECT ST_AsText(ST_CollectionHomogenize('GEOMETRYCOLLECTION(POINT(0 0))'));	

	st_astext
	------------
	 POINT(0 0)
	(1 row)

  SELECT ST_AsText(ST_CollectionHomogenize('GEOMETRYCOLLECTION(POINT(0 0),POINT(1 1))'));	

	st_astext
	---------------------
	 MULTIPOINT(0 0,1 1)
	(1 row)

				</pre></div><div class="refsection" title="関連情報"><a name="id287025187"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Multi" title="ST_Multi">ST_Multi</a>, <a class="xref" href="#ST_CollectionExtract" title="ST_CollectionExtract">ST_CollectionExtract</a></p></div></div><div class="refentry" title="ST_Multi"><div class="refentry.separator"><hr></div><a name="ST_Multi"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Multi ? ルチ系ジオメトリを返します。ジオメトリが既にマルチ系なら変更せずに返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Multi</b>(</code>geometry  <var class="pdparam">g1</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287025275"></a><h2>説明</h2><p>マルチ系ジオメトリを返します。ジオメトリが既にマルチ系なら変更せずに返します。</p></div><div class="refsection" title="例"><a name="id287025286"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(ST_Multi(ST_GeomFromText('POLYGON((743238 2967416,743238 2967450,
743265 2967450,743265.625 2967416,743238 2967416))')));
st_astext
--------------------------------------------------------------------------------------------------
MULTIPOLYGON(((743238 2967416,743238 2967450,743265 2967450,743265.625 2967416,
743238 2967416)))
(1 row)
			</pre></div><div class="refsection" title="関連情報"><a name="id287025297"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a></p></div></div><div class="refentry" title="ST_RemovePoint"><div class="refentry.separator"><hr></div><a name="ST_RemovePoint"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_RemovePoint ? ラインストリングからポイントを削除します。オフセットは0はじまりです。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_RemovePoint</b>(</code>geometry <var class="pdparam">linestring</var>, integer <var class="pdparam">offset</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287025355"></a><h2>説明</h2><p>インストリングからポイントを削除します。閉じたリングを開いたラインストリングに変えるのに使います。</p><p>初出: 1.1.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p></div><div class="refsection" title="例"><a name="id287025380"></a><h2>例</h2><pre class="programlisting">
-- 終点を削除して閉じたラインストリングが無いこを保障します。
-- 下の例ではthe_geomはラインストリングであると仮定しています。
UPDATE sometable
	SET the_geom = ST_RemovePoint(the_geom, ST_NPoints(the_geom) - 1)
	FROM sometable
	WHERE ST_IsClosed(the_geom) = true;
		</pre></div><div class="refsection" title="関連情報"><a name="id287025426"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AddPoint" title="ST_AddPoint">ST_AddPoint</a>, <a class="xref" href="#ST_NPoints" title="ST_NPoints">ST_NPoints</a>, <a class="xref" href="#ST_NumPoints" title="ST_NumPoints">ST_NumPoints</a></p></div></div><div class="refentry" title="ST_Reverse"><div class="refentry.separator"><hr></div><a name="ST_Reverse"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Reverse ? 頂点の順序を逆にしたジオメトリを返します。 </p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Reverse</b>(</code>geometry  <var class="pdparam">g1</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287025481"></a><h2>説明</h2><p>どのジオメトリでも使用可能です。頂点の順序を逆にします。</p></div><div class="refsection" title="例"><a name="id287025491"></a><h2>例</h2><pre class="programlisting">
SELECT ST_AsText(the_geom) as line, ST_AsText(ST_Reverse(the_geom)) As reverseline
FROM
(SELECT ST_MakeLine(ST_MakePoint(1,2),
		ST_MakePoint(1,10)) As the_geom) as foo;
-- 結果
		line         |     reverseline
---------------------+----------------------
LINESTRING(1 2,1 10) | LINESTRING(1 10,1 2)
</pre></div></div><div class="refentry" title="ST_Rotate"><div class="refentry.separator"><hr></div><a name="ST_Rotate"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Rotate ? ジオメトリを、原点について反時計回りにrotRadiasnぶん回転させます。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Rotate</b>(</code>geometry <var class="pdparam">geomA</var>, float <var class="pdparam">rotRadians</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_Rotate</b>(</code>geometry <var class="pdparam">geomA</var>, float <var class="pdparam">rotRadians</var>, float <var class="pdparam">x0</var>, float <var class="pdparam">y0</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_Rotate</b>(</code>geometry <var class="pdparam">geomA</var>, float <var class="pdparam">rotRadians</var>, geometry <var class="pdparam">pointOrigin</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287025665"></a><h2>説明</h2><p>ジオメトリを、原点について反時計回りにrotRadiasnぶん回転させます。原点はPOINTジオメトリか、xとyの座標値を指定します。原点を指定しない場合にはPOINT(0,0)について回転させます。</p><p>機能強化: 2.0.0では、多面体サーフェス、三角形、TINが導入されました。</p><p>機能強化: 2.0.0で、回転の原点を指定するパラメタを追加しました。</p><p>初出: 1.1.2。1.2.2でRotateからST_Rotateに名称変更しました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は多面体サーフェスに対応しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は三角形と不規則三角網(TIN)に対応しています。</p></div><div class="refsection" title="例"><a name="id287025729"></a><h2>例</h2><pre class="programlisting">
-- 180度回転
SELECT ST_AsEWKT(ST_Rotate('LINESTRING (50 160, 50 50, 100 50)', pi()));
               st_asewkt
---------------------------------------
 LINESTRING(-50 -160,-50 -50,-100 -50)
(1 row)

-- x=50,y=160で反時計回りに30度回転
SELECT ST_AsEWKT(ST_Rotate('LINESTRING (50 160, 50 50, 100 50)', pi()/6, 50, 160));
                                 st_asewkt
---------------------------------------------------------------------------
 LINESTRING(50 160,105 64.7372055837117,148.301270189222 89.7372055837117)
(1 row)

-- 重心位置で時計回りに60度回転
SELECT ST_AsEWKT(ST_Rotate(geom, -pi()/3, ST_Centroid(geom)))
FROM (SELECT 'LINESTRING (50 160, 50 50, 100 50)'::geometry AS geom) AS foo;
                           st_asewkt
--------------------------------------------------------------
 LINESTRING(116.4225 130.6721,21.1597 75.6721,46.1597 32.3708)
(1 row)
		</pre></div><div class="refsection" title="関連情報"><a name="id287025742"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Affine" title="ST_Affine">ST_Affine</a>, <a class="xref" href="#ST_RotateX" title="ST_RotateX">ST_RotateX</a>, <a class="xref" href="#ST_RotateY" title="ST_RotateY">ST_RotateY</a>, <a class="xref" href="#ST_RotateZ" title="ST_RotateZ">ST_RotateZ</a></p></div></div><div class="refentry" title="ST_RotateX"><div class="refentry.separator"><hr></div><a name="ST_RotateX"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_RotateX ? ジオメトリをX軸についてrotRadians回転させます。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_RotateX</b>(</code>geometry <var class="pdparam">geomA</var>, float <var class="pdparam">rotRadians</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287025845"></a><h2>説明</h2><p>ジオメトリgeomAをX軸についてrotRadians回転させます。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="code">ST_RotateX(geomA,  rotRadians)</code>は<code class="code">ST_Affine(geomA, 1, 0, 0, 0, cos(rotRadians), -sin(rotRadians), 0, sin(rotRadians), cos(rotRadians), 0, 0, 0)</code>の短縮版です。</p></td></tr></table></div><p>機能強化: 2.0.0では、多面体サーフェス、三角形、TINが導入されました。</p><p>初出: 1.1.2。1.2.2でRotateXからST_RotateXに名称変更しました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は多面体サーフェスに対応しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は三角形と不規則三角網(TIN)に対応しています。</p></div><div class="refsection" title="例"><a name="id287025907"></a><h2>例</h2><pre class="programlisting">
-- ラインをX軸について90度回転
SELECT ST_AsEWKT(ST_RotateX(ST_GeomFromEWKT('LINESTRING(1 2 3, 1 1 1)'), pi()/2));
		 st_asewkt
---------------------------
 LINESTRING(1 -3 2,1 -1 1)
</pre></div><div class="refsection" title="関連情報"><a name="id287025920"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Affine" title="ST_Affine">ST_Affine</a>, <a class="xref" href="#ST_RotateY" title="ST_RotateY">ST_RotateY</a>, <a class="xref" href="#ST_RotateZ" title="ST_RotateZ">ST_RotateZ</a></p></div></div><div class="refentry" title="ST_RotateY"><div class="refentry.separator"><hr></div><a name="ST_RotateY"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_RotateY ? ジオメトリgeomAをY軸についてrotRadians回転させます。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_RotateY</b>(</code>geometry <var class="pdparam">geomA</var>, float <var class="pdparam">rotRadians</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287026019"></a><h2>説明</h2><p>ジオメトリgeomAをY軸についてrotRadians回転させます。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="code">ST_RotateY(geomA,  rotRadians)</code>は<code class="code">ST_Affine(geomA,  cos(rotRadians), 0, sin(rotRadians),  0, 1, 0,  -sin(rotRadians), 0, cos(rotRadians), 0,  0, 0)</code>の短縮版です。</p></td></tr></table></div><p>機能強化: 2.0.0では、多面体サーフェス、三角形、TINが導入されました。</p><p>初出: 1.1.2。1.2.2でRotateYからST_RotateYに名称変更しました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は多面体サーフェスに対応しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は三角形と不規則三角網(TIN)に対応しています。</p></div><div class="refsection" title="例"><a name="id287026082"></a><h2>例</h2><pre class="programlisting">
-- ラインをY軸について90度回転
 SELECT ST_AsEWKT(ST_RotateY(ST_GeomFromEWKT('LINESTRING(1 2 3, 1 1 1)'), pi()/2));
		 st_asewkt
---------------------------
 LINESTRING(3 2 -1,1 1 -1)
</pre></div><div class="refsection" title="関連情報"><a name="id287026094"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Affine" title="ST_Affine">ST_Affine</a>, <a class="xref" href="#ST_RotateX" title="ST_RotateX">ST_RotateX</a>, <a class="xref" href="#ST_RotateZ" title="ST_RotateZ">ST_RotateZ</a></p></div></div><div class="refentry" title="ST_RotateZ"><div class="refentry.separator"><hr></div><a name="ST_RotateZ"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_RotateZ ? ジオメトリをZ軸についてrotRadians回転させます。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_RotateZ</b>(</code>geometry <var class="pdparam">geomA</var>, float <var class="pdparam">rotRadians</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287026160"></a><h2>説明</h2><p>ジオメトリをZ軸についてrotRadians回転させます。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はST_Rotateと同じです。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="code">ST_RotateZ(geomA,  rotRadians)</code>は<code class="code">SELECT ST_Affine(geomA,  cos(rotRadians), -sin(rotRadians), 0,  sin(rotRadians), cos(rotRadians), 0,  0, 0, 1,  0, 0, 0)</code>の短縮版です。</p></td></tr></table></div><p>機能強化: 2.0.0では、多面体サーフェス、三角形、TINが導入されました。</p><p>初出: 1.1.2。1.2.2でRotateZからST_RotateZに名称変更しました。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>1.3.4より前の版では、この関数は曲線を含むジオメトリで使うとクラッシュしました。1.3.4以降では訂正されています。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は多面体サーフェスに対応しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は三角形と不規則三角網(TIN)に対応しています。</p></div><div class="refsection" title="例"><a name="id287026241"></a><h2>例</h2><pre class="programlisting">
-- ラインをZ軸について90度回転
SELECT ST_AsEWKT(ST_RotateZ(ST_GeomFromEWKT('LINESTRING(1 2 3, 1 1 1)'), pi()/2));
		 st_asewkt
---------------------------
 LINESTRING(-2 1 3,-1 1 1)

 --Rotate a curved circle around z-axis
SELECT ST_AsEWKT(ST_RotateZ(the_geom, pi()/2))
FROM (SELECT ST_LineToCurve(ST_Buffer(ST_GeomFromText('POINT(234 567)'), 3)) As the_geom) As foo;

													   st_asewkt
----------------------------------------------------------------------------------------------------------------------------
 CURVEPOLYGON(CIRCULARSTRING(-567 237,-564.87867965644 236.12132034356,-564 234,-569.12132034356 231.87867965644,-567 237))

</pre></div><div class="refsection" title="関連情報"><a name="id287026253"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Affine" title="ST_Affine">ST_Affine</a>, <a class="xref" href="#ST_RotateX" title="ST_RotateX">ST_RotateX</a>, <a class="xref" href="#ST_RotateY" title="ST_RotateY">ST_RotateY</a></p></div></div><div class="refentry" title="ST_Scale"><div class="refentry.separator"><hr></div><a name="ST_Scale"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Scale ? パラメータで軸を乗算してジオメトリを新しいサイズに拡大縮小します。ST_Scale(geom, Xfactor, Yfactor, Zfactor)となります。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Scale</b>(</code>geometry  <var class="pdparam">geomA</var>, float <var class="pdparam">XFactor</var>, float <var class="pdparam">YFactor</var>, float <var class="pdparam">ZFactor</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_Scale</b>(</code>geometry  <var class="pdparam">geomA</var>, float <var class="pdparam">XFactor</var>, float <var class="pdparam">YFactor</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287026406"></a><h2>説明</h2><p>パラメータで軸を乗算してジオメトリを新しいサイズに拡大縮小します。ST_Scale(geom, Xfactor, Yfactor, Zfactor)となります。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="code">ST_Scale(geomA,  XFactor, YFactor, ZFactor)</code>は<code class="code">ST_Affine(geomA,  XFactor, 0, 0,  0, YFactor, 0,  0, 0, ZFactor,  0, 0, 0)</code>の短縮版です。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>1.3.4より前では曲線を含むジオメトリで使うとクラッシュしました。これは1.3.4以上では訂正されています。</p></td></tr></table></div><p>初出: 1.1.0</p><p>機能強化: 2.0.0では、多面体サーフェス、三角形、TINが導入されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は多面体サーフェスに対応しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は三角形と不規則三角網(TIN)に対応しています。</p></div><div class="refsection" title="例"><a name="id287026482"></a><h2>例</h2><pre class="programlisting">-- ひとつめ: X, Y, Zの拡大縮小
SELECT ST_AsEWKT(ST_Scale(ST_GeomFromEWKT('LINESTRING(1 2 3, 1 1 1)'), 0.5, 0.75, 0.8));
			  st_asewkt
--------------------------------------
 LINESTRING(0.5 1.5 2.4,0.5 0.75 0.8)

-- ふたつめ: X, Yの拡大縮小
 SELECT ST_AsEWKT(ST_Scale(ST_GeomFromEWKT('LINESTRING(1 2 3, 1 1 1)'), 0.5, 0.75));
			st_asewkt
----------------------------------
 LINESTRING(0.5 1.5 3,0.5 0.75 1)


</pre></div><div class="refsection" title="関連情報"><a name="id287026494"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Affine" title="ST_Affine">ST_Affine</a>, <a class="xref" href="#ST_TransScale" title="ST_TransScale">ST_TransScale</a></p></div></div><div class="refentry" title="ST_Segmentize"><div class="refentry.separator"><hr></div><a name="ST_Segmentize"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Segmentize ? 与えられた距離より長い辺を持たないジオメトリに編集して返します。距離計算は2次元でしか行いません。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Segmentize</b>(</code>geometry  <var class="pdparam">geomA</var>, float  <var class="pdparam">max_length</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287026556"></a><h2>説明</h2><p>与えられた距離より長い辺を持たないジオメトリに編集して返します。距離計算は2次元でしか行いません。</p><p>初出: 1.2.2</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これは辺を増やすだけです。最大長より短い辺を伸ばしません。</p></td></tr></table></div></div><div class="refsection" title="例"><a name="id287026573"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(ST_Segmentize(
ST_GeomFromText('MULTILINESTRING((-29 -27,-30 -29.7,-36 -31,-45 -33),(-45 -33,-46 -32))')
		,5)
);
st_astext
--------------------------------------------------------------------------------------------------
MULTILINESTRING((-29 -27,-30 -29.7,-34.886615700134 -30.758766735029,-36 -31,
-40.8809353009198 -32.0846522890933,-45 -33),
(-45 -33,-46 -32))
(1 row)

SELECT ST_AsText(ST_Segmentize(ST_GeomFromText('POLYGON((-29 28, -30 40, -29 28))'),10));
st_astext
-----------------------
POLYGON((-29 28,-29.8304547985374 37.9654575824488,-30 40,-29.1695452014626 30.0345424175512,-29 28))
(1 row)

			</pre></div><div class="refsection" title="関連情報"><a name="id287026584"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Line_Substring" title="ST_Line_Substring">ST_Line_Substring</a></p></div></div><div class="refentry" title="ST_SetPoint"><div class="refentry.separator"><hr></div><a name="ST_SetPoint"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SetPoint ? ラインストリングのN番目を与えられたポイントに置き換えます。インデクスは0はじまりです。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_SetPoint</b>(</code>geometry <var class="pdparam">linestring</var>, integer <var class="pdparam">zerobasedposition</var>, geometry <var class="pdparam">point</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287026651"></a><h2>説明</h2><p>ラインストリングのN番目を与えられたポイントに置き換えます。インデクスは0はじまりです。これは、頂点がひとつ動いた時に接続のリレーションシップを維持しようとする場合のトリガに特に便利です。</p><p>初出: 1.1.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p></div><div class="refsection" title="例"><a name="id287026677"></a><h2>例</h2><pre class="programlisting">
--Change first point in line string from -1 3 to -1 1
SELECT ST_AsText(ST_SetPoint('LINESTRING(-1 2,-1 3)', 0, 'POINT(-1 1)'));
	   st_astext
-----------------------
 LINESTRING(-1 1,-1 3)

---Change last point in a line string (lets play with 3d linestring this time)
SELECT ST_AsEWKT(ST_SetPoint(foo.the_geom, ST_NumPoints(foo.the_geom) - 1, ST_GeomFromEWKT('POINT(-1 1 3)')))
FROM (SELECT ST_GeomFromEWKT('LINESTRING(-1 2 3,-1 3 4, 5 6 7)') As the_geom) As foo;
	   st_asewkt
-----------------------
LINESTRING(-1 2 3,-1 3 4,-1 1 3)
			</pre></div><div class="refsection" title="関連情報"><a name="id287026688"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AddPoint" title="ST_AddPoint">ST_AddPoint</a>, <a class="xref" href="#ST_NPoints" title="ST_NPoints">ST_NPoints</a>, <a class="xref" href="#ST_NumPoints" title="ST_NumPoints">ST_NumPoints</a>, <a class="xref" href="#ST_PointN" title="ST_PointN">ST_PointN</a>, <a class="xref" href="#ST_RemovePoint" title="ST_RemovePoint">ST_RemovePoint</a></p></div></div><div class="refentry" title="ST_SetSRID"><div class="refentry.separator"><hr></div><a name="ST_SetSRID"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SetSRID ? ジオメトリのSRIDを特定の整数値に設定します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_SetSRID</b>(</code>geometry 
			<var class="pdparam">geom</var>, integer 
			<var class="pdparam">srid</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287026759"></a><h2>説明</h2><p>ジオメトリのSRIDを特定の整数値に設定します。クエリのためのバウンディングボックスを生成する際に使います。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はジオメトリを変換せず、ジオメトリが仮定する空間参照系を定義するメタデータを設定するだけです。ジオメトリを新しい投影法に変換したい場合は<a class="xref" href="#ST_Transform" title="ST_Transform">ST_Transform</a>を使います。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p></div><div class="refsection" title="例"><a name="id287026837"></a><h2>例</h2><p>-- ポイントをWGS84経度緯度に設定 --</p><pre class="programlisting">SELECT ST_SetSRID(ST_Point(-123.365556, 48.428611),4326) As wgs84long_lat;
-- EWKT表現(ST_AsEWKTでラップします) --
SRID=4326;POINT(-123.365556 48.428611)
			</pre><p>-- ポイントをWGS84経度緯度に設定したうえで、WEBメルカトル(球面メルカトル)に変換 --</p><pre class="programlisting">SELECT ST_Transform(ST_SetSRID(ST_Point(-123.365556, 48.428611),4326),3785) As spere_merc;
-- the ewkt representation (wrap with ST_AsEWKT) -
SRID=3785;POINT(-13732990.8753491 6178458.96425423)
			</pre></div><div class="refsection" title="関連情報"><a name="id287026858"></a><h2>関連情報</h2><p><a class="xref" href="#spatial_ref_sys" title="4.3.1. SPATIAL_REF_SYSテーブルと空間参照系">「SPATIAL_REF_SYSテーブルと空間参照系」</a>, <a class="xref" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a>,  <a class="xref" href="#ST_Point" title="ST_Point">ST_Point</a>, <a class="xref" href="#ST_SRID" title="ST_SRID">ST_SRID</a>, <a class="xref" href="#ST_Transform" title="ST_Transform">ST_Transform</a>, <a class="xref" href="#UpdateGeometrySRID" title="UpdateGeometrySRID">UpdateGeometrySRID</a></p></div></div><div class="refentry" title="ST_SnapToGrid"><div class="refentry.separator"><hr></div><a name="ST_SnapToGrid"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SnapToGrid ? 入力ジオメトリの全ての点を規則的なグリッドにスナップします。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_SnapToGrid</b>(</code>geometry  <var class="pdparam">geomA</var>, float  <var class="pdparam">originX</var>, float  <var class="pdparam">originY</var>, float  <var class="pdparam">sizeX</var>, float  <var class="pdparam">sizeY</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_SnapToGrid</b>(</code>geometry  <var class="pdparam">geomA</var>, float  <var class="pdparam">sizeX</var>, float  <var class="pdparam">sizeY</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_SnapToGrid</b>(</code>geometry  <var class="pdparam">geomA</var>, float  <var class="pdparam">size</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_SnapToGrid</b>(</code>geometry  <var class="pdparam">geomA</var>, geometry  <var class="pdparam">pointOrigin</var>, float  <var class="pdparam">sizeX</var>, float  <var class="pdparam">sizeY</var>, float  <var class="pdparam">sizeZ</var>, float  <var class="pdparam">sizeM</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287027083"></a><h2>説明</h2><p>1, 2, 3番目の形式では、入力ジオメトリの全てのポイントを原点とセルサイズを定めたグリッドにスナップします。同じセルに落ちた、連続するポイントを削除します。引数ジオメトリのジオメトリタイプを定義できないポイントしか残らなかった場合は、NULLを返します。コレクション内で崩壊したジオメトリはそこから削除されます。精度を落とすのに使います。</p><p>4番目の形式は、1.1.0で導入されました。入力ジオメトリの全てのポイントを原点(第2引数で指定するもので、ポイントでなければなりません)とセルサイズを定めたグリッドにスナップします。グリッドにスナップしたくない次元についてはサイズに0を指定します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>T返されるジオメトリは単純性を失う可能性があります(<a class="xref" href="#ST_IsSimple" title="ST_IsSimple">ST_IsSimple</a>を参照して下さい)。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>1.1.0版より前では、この関数は常に2次元ジオメトリを返しました。1.1.0版からは、返されるジオメトリの次元数は、入力値のうちで手のつけられていない最大の次元と同じになります。全てのグリッドの次元を定義するには、第2引数にジオメトリを取る形式を使って下さい。</p></td></tr></table></div><p>初出: 1.0.0RC1</p><p>初出: 1.1.0 - ZとMのサポート </p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p></div><div class="refsection" title="例"><a name="id287027131"></a><h2>例</h2><pre class="programlisting">
-- 10^-3の精度のグリッドにジオメトリをスナップ
UPDATE mytable
   SET the_geom = ST_SnapToGrid(the_geom, 0.001);

SELECT ST_AsText(ST_SnapToGrid(
			ST_GeomFromText('LINESTRING(1.1115678 2.123, 4.111111 3.2374897, 4.11112 3.23748667)'),
			0.001)
		);
			  st_astext
-------------------------------------
 LINESTRING(1.112 2.123,4.111 3.237)
 -- 4次元ジオメトリをスナップ
SELECT ST_AsEWKT(ST_SnapToGrid(
	ST_GeomFromEWKT('LINESTRING(-1.1115678 2.123 2.3456 1.11111,
		4.111111 3.2374897 3.1234 1.1111, -1.11111112 2.123 2.3456 1.1111112)'),
 ST_GeomFromEWKT('POINT(1.12 2.22 3.2 4.4444)'),
 0.1, 0.1, 0.1, 0.01) );
								  st_asewkt
------------------------------------------------------------------------------
 LINESTRING(-1.08 2.12 2.3 1.1144,4.12 3.22 3.1 1.1144,-1.08 2.12 2.3 1.1144)


-- 4次元ジオメトリ - ST_SnapToGrid(geom,size)を使い、
-- X, Y座標だけに手を付けM, Z座標は変更しない
SELECT ST_AsEWKT(ST_SnapToGrid(ST_GeomFromEWKT('LINESTRING(-1.1115678 2.123 3 2.3456,
		4.111111 3.2374897 3.1234 1.1111)'),
	   0.01)      );
						st_asewkt
---------------------------------------------------------
 LINESTRING(-1.11 2.12 3 2.3456,4.11 3.24 3.1234 1.1111)

		</pre></div><div class="refsection" title="関連情報"><a name="id287027144"></a><h2>関連情報</h2><p>
		<a class="xref" href="#ST_Snap" title="ST_Snap">ST_Snap</a>,
		<a class="xref" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a>,
		<a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a>,
		<a class="xref" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a>,
		<a class="xref" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a>,
		<a class="xref" href="#ST_Simplify" title="ST_Simplify">ST_Simplify</a>
		</p></div></div><div class="refentry" title="ST_Snap"><div class="refentry.separator"><hr></div><a name="ST_Snap"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Snap ? 入力ジオメトリの辺と頂点を参照ジオメトリの頂点にスナップします。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Snap</b>(</code>geometry  <var class="pdparam">input</var>, geometry  <var class="pdparam">reference</var>, float  <var class="pdparam">tolerance</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287029858"></a><h2>説明</h2><p>入力ジオメトリの辺と頂点を、もうひとつのジオメトリの頂点にスナップします。スナップが実行される位置を制御するにはスナップ距離許容値を使います。</p><p>ひとつのジオメトリからもうひとつへの変換によって、近傍エッジ(ノード生成とインタセクション計算で問題を引き起こします)を除くことになり、オーバレイ処理のロバスト性が改善されます。</p><p>あまりに多数のスナップを行った場合には、生成されるトポロジが不正になる可能性があります。いつスナップが安全かを判定するために、ヒューリスティックにスナップされた頂点の数と位置が決めるしかありません。しかし、省略された潜在的なスナップになりえます。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>返されるジオメトリは単純さを失うかも知れません(<a class="xref" href="#ST_IsSimple" title="ST_IsSimple">ST_IsSimple</a>参照)し、妥当性を失うかも知れません(<a class="xref" href="#ST_IsValid" title="ST_IsValid">ST_IsValid</a>参照)。
</p></td></tr></table></div><p>初出: 2.0.0 GEOS 3.3.0以降が必要です。</p></div><div class="refsection" title="例"><a name="id287029891"></a><h2>例</h2><div class="informaltable"><table border="1"><colgroup><col class="column1"><col class="column2"></colgroup><tbody><tr><td colspan="2" align="center"><div class="informalfigure"><div class="mediaobject"><img src="images/st_snap01.png"><div class="caption"><p>マルチポリゴンとラインストリング(スナップ前)</p></div></div></div>
					   </td></tr><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_snap02.png"><div class="caption"><p>ラインストリングに1.01の許容距離でマルチポリゴンをスナップします。新しいマルチポリゴンはラインストリングにつながります。</p></div></div></div><p>
				</p><pre class="programlisting">
SELECT ST_AsText(ST_Snap(poly,line, ST_Distance(poly,line)*1.01)) AS polysnapped
FROM (SELECT 
   ST_GeomFromText('MULTIPOLYGON(
     ((26 125, 26 200, 126 200, 126 125, 26 125 ),
      ( 51 150, 101 150, 76 175, 51 150 )), 
      (( 151 100, 151 200, 176 175, 151 100 )))') As poly,
       ST_GeomFromText('LINESTRING (5 107, 54 84, 101 100)') As line
		
	) As foo;

                             polysnapped
---------------------------------------------------------------------
 MULTIPOLYGON(((26 125,26 200,126 200,126 125,101 100,26 125),
 (51 150,101 150,76 175,51 150)),((151 100,151 200,176 175,151 100)))
				</pre>
					</td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_snap04.png"><div class="caption"><p>マルチラインストリングに1.25の許容距離でマルチポリゴンをスナップします。新しいマルチポリゴンはラインストリングにつながります。</p></div></div></div><p>
				</p><pre class="programlisting">
SELECT ST_AsText(
    ST_Snap(poly,line, ST_Distance(poly,line)*1.25)
  ) AS polysnapped
FROM (SELECT 
  ST_GeomFromText('MULTIPOLYGON(
    (( 26 125, 26 200, 126 200, 126 125, 26 125 ),
      ( 51 150, 101 150, 76 175, 51 150 )),
      (( 151 100, 151 200, 176 175, 151 100 )))') As poly,
       ST_GeomFromText('LINESTRING (5 107, 54 84, 101 100)') As line
		
	) As foo;

                             polysnapped
---------------------------------------------------------------------
MULTIPOLYGON(((5 107,26 200,126 200,126 125,101 100,54 84,5 107),
(51 150,101 150,76 175,51 150)),((151 100,151 200,176 175,151 100)))
				</pre>
						</td></tr><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_snap03.png"><div class="caption"><p>元のマルチポリゴンに1.01の許容距離でラインストリングをスナップします。新しいまラインストリングはマルチポリゴンにつながります。</p></div></div></div><p>
				</p><pre class="programlisting">
SELECT ST_AsText(
   ST_Snap(line, poly, ST_Distance(poly,line)*1.01)
  ) AS linesnapped
FROM (SELECT 
  ST_GeomFromText('MULTIPOLYGON(
     ((26 125, 26 200, 126 200, 126 125, 26 125),
      (51 150, 101 150, 76 175, 51 150 )), 
      ((151 100, 151 200, 176 175, 151 100)))') As poly,
       ST_GeomFromText('LINESTRING (5 107, 54 84, 101 100)') As line
	) As foo;

              linesnapped
----------------------------------------
 LINESTRING(5 107,26 125,54 84,101 100)
				</pre><p>
						  </p>
					</td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_snap05.png"><div class="caption"><p>元のマルチポリゴンに1.25の許容距離でラインストリングをスナップします。新しいまラインストリングはマルチポリゴンにつながります。</p></div></div></div><p>
				</p><pre class="programlisting">
SELECT ST_AsText(
 ST_Snap(line, poly, ST_Distance(poly,line)*1.25)
  ) AS linesnapped
FROM (SELECT 
  ST_GeomFromText('MULTIPOLYGON(
     (( 26 125, 26 200, 126 200, 126 125, 26 125 ),
      (51 150, 101 150, 76 175, 51 150 )), 
      ((151 100, 151 200, 176 175, 151 100 )))') As poly,
       ST_GeomFromText('LINESTRING (5 107, 54 84, 101 100)') As line	
	) As foo;
              linesnapped
---------------------------------------
LINESTRING(26 125,54 84,101 100)
				</pre>
					</td></tr></tbody></table></div></div><div class="refsection" title="関連情報"><a name="id287030060"></a><h2>関連情報</h2><p>
		<a class="xref" href="#ST_SnapToGrid" title="ST_SnapToGrid">ST_SnapToGrid</a>
		</p></div></div><div class="refentry" title="ST_Transform"><div class="refentry.separator"><hr></div><a name="ST_Transform"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Transform ? 整数パラメータで参照されるSRIDに座標変換し、新しいジオメトリを返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Transform</b>(</code>geometry  <var class="pdparam">g1</var>, integer  <var class="pdparam">srid</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287030121"></a><h2>説明</h2><p>SRID整数パラメータで参照される空間参系に座標変換し、新しいジオメトリを返します。変換先SRIDは<code class="varname">SPATIAL_REF_SYS</code>テーブルに存在しなければなりません。</p><p>ST_TransformはしばしばST_SetSRIDと混同されます。ST_Transformは実際にジオメトリの座標を、ある空間参照系から他のものに変換します。ST_SetSRIDは単にジオメトリのSRIDを変更するだけです。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>PostGISがProj対応でコンパイルされている必要があります。PostGIS_Full_Versionを使ってProj対応でコンパイルされているか確認して下さい。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>1つ以上の変換を行う場合は、インデクスの利点を得るために、使用する変換に関する関数インデクスを持つと便利です。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>1.3.4より前は、曲線を含むジオメトリで使うとクラッシュしました。これは1.3.4以上では訂正されています。</p></td></tr></table></div><p>機能強化: 2.0.0では、多面体サーフェスが導入されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.6</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は多面体サーフェスに対応しています。</p></div><div class="refsection" title="例"><a name="id287030193"></a><h2>例</h2><p>マサチューセッツ州平面座標系(アメリカ測量フィート)をWGS84経度緯度に変更します。</p><pre class="programlisting">
SELECT ST_AsText(ST_Transform(ST_GeomFromText('POLYGON((743238 2967416,743238 2967450,
	743265 2967450,743265.625 2967416,743238 2967416))',2249),4326)) As wgs_geom;

 wgs_geom
---------------------------
 POLYGON((-71.1776848522251 42.3902896512902,-71.1776843766326 42.3903829478009,
-71.1775844305465 42.3903826677917,-71.1775825927231 42.3902893647987,-71.177684
8522251 42.3902896512902));
(1 row)

--3D Circular String example
SELECT ST_AsEWKT(ST_Transform(ST_GeomFromEWKT('SRID=2249;CIRCULARSTRING(743238 2967416 1,743238 2967450 2,743265 2967450 3,743265.625 2967416 3,743238 2967416 4)'),4326));

				 st_asewkt
--------------------------------------------------------------------------------------
 SRID=4326;CIRCULARSTRING(-71.1776848522251 42.3902896512902 1,-71.1776843766326 42.3903829478009 2,
 -71.1775844305465 42.3903826677917 3,
 -71.1775825927231 42.3902893647987 3,-71.1776848522251 42.3902896512902 4)

		</pre><p>部分関数インデクスを作る例です。全てのジオメトリが入っているとは確信できないテーブルのためには、スペースの節約とインデクスを小さく効率的にするために、NULLジオメトリを無視する部分インデクスを使うのが最善です。</p><pre class="programlisting">
CREATE INDEX idx_the_geom_26986_parcels
  ON parcels
  USING gist
  (ST_Transform(the_geom, 26986))
  WHERE the_geom IS NOT NULL;
		</pre></div><div class="refsection" title="変換の挙動の設定"><a name="id287020693"></a><h2>変換の挙動の設定 </h2><p>グリッドシフトを含む座標変換は、ときどき失敗します。たとえば、PROJ.4にグリッドシフトファイルを付けてビルドされていなかった場合や、座標がグリッドシフト定義の範囲内に無い、といった場合です。デフォルトでは、PostGISはグリッドシフトファイルが無い場合はエラーを投げますが、この挙動は、spatial_ref_sysテーブルのproj4text値を変更することで、SRID毎の原則を設定することができます。</p><p>たとえば、proj4textパラメータ +datum=NAD87 は次に示す+nadgridsパラメータの短縮形です。</p><pre class="programlisting">+nadgrids=@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat</pre><p>接頭辞 @ は、ファイルが無くてもエラー報告をしないという意味ですが、適切だった(発見されてオーバラップした)ファイルがないままリストの終わりに達した場合はエラーが出ます。</p><p>逆にいえば、少なくとも標準的なファイルが確実にあって欲しいが、該当が無いまま全てのファイルが走査された場合はNULL変換にしたい場合は、次が使えます。</p><pre class="programlisting">+nadgrids=@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat,null</pre><p>NULLグリッドシフトファイルは、世界全体をカバーして、シフトを行わない、妥当なグリッドシフトファイルです。 完全な例のために、正しい範囲にないSRID 4267への変換でエラーは投げられないようPostGISを変えたいなら、次のようにします。</p><pre class="programlisting">UPDATE spatial_ref_sys SET proj4text = '+proj=longlat +ellps=clrk66 +nadgrids=@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat,null +no_defs' WHERE srid = 4267;</pre></div><div class="refsection" title="関連情報"><a name="id287020731"></a><h2>関連情報</h2><p><a class="xref" href="#PostGIS_Full_Version" title="PostGIS_Full_Version">PostGIS_Full_Version</a>, <a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a>, <a class="xref" href="#ST_SetSRID" title="ST_SetSRID">ST_SetSRID</a>, <a class="xref" href="#UpdateGeometrySRID" title="UpdateGeometrySRID">UpdateGeometrySRID</a></p></div></div><div class="refentry" title="ST_Translate"><div class="refentry.separator"><hr></div><a name="ST_Translate"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Translate ? 整数パラメータをオフセットにして新しい位置にジオメトリを移動させます。ST_Translate(geom, X, Y)またはST_Translate(geom, X, Y, Z)になります。 </p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Translate</b>(</code>geometry  <var class="pdparam">g1</var>, float  <var class="pdparam">deltax</var>, float  <var class="pdparam">deltay</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_Translate</b>(</code>geometry  <var class="pdparam">g1</var>, float  <var class="pdparam">deltax</var>, float  <var class="pdparam">deltay</var>, float  <var class="pdparam">deltaz</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287020887"></a><h2>説明</h2><p>deltax, deltay, deltaz ぶん移動した新しいジオメトリを返します。単位は、このジオメトリの空間参照系(SRID)で定義された単位です。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>1.3.4より前は、曲線を含むジオメトリで使うとクラッシュしました。これは1.3.4以上では訂正されています。</p></td></tr></table></div><p>初出: 1.2.2</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p></div><div class="refsection" title="例"><a name="id287020926"></a><h2>例</h2><p>ポイントを経度1度ぶん移動させます。</p><pre class="programlisting">
SELECT ST_AsText(ST_Translate(ST_GeomFromText('POINT(-71.01 42.37)',4326),1,0)) As wgs_transgeomtxt;

wgs_transgeomtxt
---------------------
POINT(-70.01 42.37)
		</pre><p>ラインストリングを緯度1度ぶん、経度1/2度ぶん移動させます。</p><pre class="programlisting">SELECT ST_AsText(ST_Translate(ST_GeomFromText('LINESTRING(-71.01 42.37,-71.11 42.38)',4326),1,0.5)) As wgs_transgeomtxt;
	   wgs_transgeomtxt
---------------------------------------
LINESTRING(-70.01 42.87,-70.11 42.88)
	</pre><p>3次元ポイントを移動させます。</p><pre class="programlisting">SELECT ST_AsEWKT(ST_Translate(CAST('POINT(0 0 0)' As geometry), 5, 12,3));
st_asewkt
---------
POINT(5 12 3)
		</pre><p>Move a curve and a point</p><pre class="programlisting">SELECT ST_AsText(ST_Translate(ST_Collect('CURVEPOLYGON(CIRCULARSTRING(4 3,3.12 0.878,1 0,-1.121 5.1213,6 7, 8 9,4 3))','POINT(1 3)'),1,2));
														 st_astext
------------------------------------------------------------------------------------------------------------
 GEOMETRYCOLLECTION(CURVEPOLYGON(CIRCULARSTRING(5 5,4.12 2.878,2 2,-0.121 7.1213,7 9,9 11,5 5)),POINT(2 5))
</pre></div><div class="refsection" title="関連情報"><a name="id287020965"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Affine" title="ST_Affine">ST_Affine</a>, <a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a>, <a class="xref" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a></p></div></div><div class="refentry" title="ST_TransScale"><div class="refentry.separator"><hr></div><a name="ST_TransScale"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_TransScale ? deltaXとdeltaY引数を使ってジオメトリを移動させ、XFactor,YFactor引数で拡大縮小させます。2次元でのみ動作します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_TransScale</b>(</code>geometry  <var class="pdparam">geomA</var>, float <var class="pdparam">deltaX</var>, float <var class="pdparam">deltaY</var>, float <var class="pdparam">XFactor</var>, float <var class="pdparam">YFactor</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287021057"></a><h2>説明</h2><p>deltaXとdeltaY引数を使ってジオメトリを移動させ、XFactor,YFactor引数で拡大縮小させます。2次元でのみ動作します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="code">ST_TransScale(geomA, deltaX, deltaY, XFactor, YFactor)</code>は<code class="code">ST_Affine(geomA, XFactor, 0, 0, 0, YFactor, 0,
			0, 0, 1, deltaX*XFactor, deltaY*YFactor, 0)</code>の短縮版です。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>1.3.4より前は、曲線を含むジオメトリで使うとクラッシュしました。これは1.3.4以上では訂正されています。</p></td></tr></table></div><p>初出: 1.1.0.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p></div><div class="refsection" title="例"><a name="id287021105"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsEWKT(ST_TransScale(ST_GeomFromEWKT('LINESTRING(1 2 3, 1 1 1)'), 0.5, 1, 1, 2));
		  st_asewkt
-----------------------------
 LINESTRING(1.5 6 3,1.5 4 1)


-- ポイントのバッファで適切な円を生成して、曲線に変換し、1,2に移動させ3,4に拡大
  SELECT ST_AsText(ST_Transscale(ST_LineToCurve(ST_Buffer('POINT(234 567)', 3)),1,2,3,4));
														  st_astext
------------------------------------------------------------------------------------------------------------------------------
 CURVEPOLYGON(CIRCULARSTRING(714 2276,711.363961030679 2267.51471862576,705 2264,698.636038969321 2284.48528137424,714 2276))

</pre></div><div class="refsection" title="関連情報"><a name="id287021117"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Affine" title="ST_Affine">ST_Affine</a>, <a class="xref" href="#ST_Translate" title="ST_Translate">ST_Translate</a></p></div></div></div><div class="sect1" title="8.6. ジオメトリ出力"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Geometry_Outputs"></a>8.6. ジオメトリ出力</h2></div></div></div><div class="toc"><dl><dt><span class="refentrytitle"><a href="#ST_AsBinary">ST_AsBinary</a></span><span class="refpurpose"> ? ジオメトリ/ジオグラフィのSRIDメタデータのないWell-Known Binary(WKB)表現を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_AsEWKB">ST_AsEWKB</a></span><span class="refpurpose"> ? ジオメトリのSRIDメタデータが付いたWell-Known Binary(WKB)表現を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_AsEWKT">ST_AsEWKT</a></span><span class="refpurpose"> ? ジオメトリのSRIDメタデータが付いたWell-Known Text(WKT)表現を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_AsGeoJSON">ST_AsGeoJSON</a></span><span class="refpurpose"> ? GeoJSON要素としてジオメトリを返します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_AsGML">ST_AsGML</a></span><span class="refpurpose"> ? GML第2版または第3版としてジオメトリを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_AsHEXEWKB">ST_AsHEXEWKB</a></span><span class="refpurpose"> ? ジオメトリのHEXEWKB表現(文字列)を返します。リトルエンディアン(NDS)またはビッグエンディアン(XDR)のどちらかのエンコーディングを使います。</span></dt><dt><span class="refentrytitle"><a href="#ST_AsKML">ST_AsKML</a></span><span class="refpurpose"> ? ジオメトリをKML要素で返します。いくつかの形式があります。デフォルトはversion=2, precision=15です。</span></dt><dt><span class="refentrytitle"><a href="#ST_AsSVG">ST_AsSVG</a></span><span class="refpurpose"> ? ジオメトリまたはジオグラフィで与えられたSVGパスデータによるジオメトリを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_AsX3D">ST_AsX3D</a></span><span class="refpurpose"> ? ジオメトリをX3Dノード要素書式(ISO-IEC-19776-1.2-X3DEncodings-XML)で返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_GeoHash">ST_GeoHash</a></span><span class="refpurpose"> ? ジオメトリのGeoHash表現(geohash.org)を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_AsText">ST_AsText</a></span><span class="refpurpose"> ? ジオメトリ/ジオグラフィのSRIDメタデータのないWell-Known Text(WKT)表現を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_AsLatLonText">ST_AsLatLonText</a></span><span class="refpurpose"> ? 与えられたポイントの度・分・秒表現を返します。</span></dt></dl></div><div class="refentry" title="ST_AsBinary"><a name="ST_AsBinary"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsBinary ? ジオメトリ/ジオグラフィのSRIDメタデータのないWell-Known Binary(WKB)表現を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">bytea <b class="fsfunc">ST_AsBinary</b>(</code>geometry  <var class="pdparam">g1</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsBinary</b>(</code>geometry  <var class="pdparam">g1</var>, text <var class="pdparam">NDR_or_XDR</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsBinary</b>(</code>geography  <var class="pdparam">g1</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsBinary</b>(</code>geography  <var class="pdparam">g1</var>, text <var class="pdparam">NDR_or_XDR</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287033323"></a><h2>説明</h2><p>ジオメトリのWell-Knwon Binary表現を返します。2つの形式があります。ひとつめの形式では、エンディアンエンコーディングのパラメータを取らずにサーバ機のエンディアンとします。ふたつめの形式では、第2引数にリトルエンディアン('NDR')かビッグエンディアン('XDR')を使ってエンコーディングを明示します。</p><p>これは文字列表現に変換することなくデータベース外にデータを引き出すバイナリカーソルに使用します。 </p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>WKB仕様ではSRIDは入りません。SRIDを持つOGC WKBの書式を得るにはST_AsEWKBを使用します。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_AsBinaryはジオメトリに対する<a class="xref" href="#ST_GeomFromWKB" title="ST_GeomFromWKB">ST_GeomFromWKB</a>の逆です。PostGISジオメトリをST_AsBinary表現から変換するには<a class="xref" href="#ST_GeomFromWKB" title="ST_GeomFromWKB">ST_GeomFromWKB</a>を使います。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>PostgreSQL 9.0でのデフォルトの挙動が、16進数エンコーディングに変わりました。ST_AsBinaryはジオメトリに対する<a class="xref" href="#ST_GeomFromWKB" title="ST_GeomFromWKB">ST_GeomFromWKB</a>の反対です。GUIツールが古い挙動を求める場合には、データベースでSET bytea_output='escape'を実行して下さい。</p></td></tr></table></div><p>機能強化: 2.0.0では、多角形サーフェス、三角形、TINが導入されました。</p><p>機能強化: 2.0.0では、高次元が導入されました。</p><p>機能強化: 2.0.0では、ジオグラフィでのエンディアン指定が導入されました。</p><p>初出: 1.5.0では、ジオグラフィが導入されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です s2.1.1.1</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.37</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は多面体サーフェスに対応しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は三角形と不規則三角網(TIN)に対応しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p></div><div class="refsection" title="例"><a name="id287033486"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsBinary(ST_GeomFromText('POLYGON((0 0,0 1,1 1,1 0,0 0))',4326));

		   st_asbinary
--------------------------------
\001\003\000\000\000\001\000\000\000\005
\000\000\000\000\000\000\000\000\000\000
\000\000\000\000\000\000\000\000\000\000
\000\000\000\000\000\000\000\000\000\000
\000\000\000\360?\000\000\000\000\000\000
\360?\000\000\000\000\000\000\360?\000\000
\000\000\000\000\360?\000\000\000\000\000
\000\000\000\000\000\000\000\000\000\000\000
\000\000\000\000\000\000\000\000
(1 row)</pre><pre class="programlisting">SELECT ST_AsBinary(ST_GeomFromText('POLYGON((0 0,0 1,1 1,1 0,0 0))',4326), 'XDR');
		   st_asbinary
--------------------------------
\000\000\000\000\003\000\000\000\001\000\000\000\005\000\000\000\000\000
\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000
\000?\360\000\000\000\000\000\000?\360\000\000\000\000\000\000?\360\000\000
\000\000\000\000?\360\000\000\000\000\000\000\000\000\000\000\000\000\000\000
\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000
(1 row)</pre></div><div class="refsection" title="関連情報"><a name="id287033504"></a><h2>関連情報</h2><p>
<a class="xref" href="#ST_GeomFromWKB" title="ST_GeomFromWKB">ST_GeomFromWKB</a>
<a class="xref" href="#ST_AsEWKB" title="ST_AsEWKB">ST_AsEWKB</a>,
<a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a>,
			</p></div></div><div class="refentry" title="ST_AsEWKB"><div class="refentry.separator"><hr></div><a name="ST_AsEWKB"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsEWKB ? ジオメトリのSRIDメタデータが付いたWell-Known Binary(WKB)表現を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">bytea <b class="fsfunc">ST_AsEWKB</b>(</code>geometry  <var class="pdparam">g1</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsEWKB</b>(</code>geometry  <var class="pdparam">g1</var>, text <var class="pdparam">NDR_or_XDR</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287033589"></a><h2>説明</h2><p>ジオメトリのSRIDメタデータが付いWell-Knwon Binary表現を返します。2つの形式があります。ひとつめの形式では、エンディアンエンコーディングのパラメータを取らずにサーバ機のエンディアンとします。ふたつめの形式では、第2引数にリトルエンディアン('NDR')かビッグエンディアン('XDR')を使ってエンコーディングを明示します。</p><p>これは文字列表現に変換することなくデータベース外にデータを引き出すバイナリカーソルに使用します。 </p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>WKB仕様ではSRIDは入りません。SRIDを持たないOGC WKBの書式を得るにはST_AsBinaryを使用します。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_AsEWKBはジオメトリに対するST_GeomFromEWKBの逆です。PostGISジオメトリをST_AsEWKB表現から変換するにはST_GeomFromEWKBを使います。 </p></td></tr></table></div><p>機能強化: 2.0.0では、多角形サーフェス、三角形、TINが導入されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は多面体サーフェスに対応しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は三角形と不規則三角網(TIN)に対応しています。</p></div><div class="refsection" title="例"><a name="id287033664"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsEWKB(ST_GeomFromText('POLYGON((0 0,0 1,1 1,1 0,0 0))',4326));

		   st_asewkb
--------------------------------
\001\003\000\000 \346\020\000\000\001\000
\000\000\005\000\000\000\000
\000\000\000\000\000\000\000\000
\000\000\000\000\000\000\000\000\000
\000\000\000\000\000\000\000\000\000\000
\000\000\360?\000\000\000\000\000\000\360?
\000\000\000\000\000\000\360?\000\000\000\000\000
\000\360?\000\000\000\000\000\000\000\000\000\000\000
\000\000\000\000\000\000\000\000\000\000\000\000\000
(1 row)</pre><pre class="programlisting">SELECT ST_AsEWKB(ST_GeomFromText('POLYGON((0 0,0 1,1 1,1 0,0 0))',4326), 'XDR');
		   st_asewkb
--------------------------------
\000 \000\000\003\000\000\020\346\000\000\000\001\000\000\000\005\000\000\000\000\
000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000?
\360\000\000\000\000\000\000?\360\000\000\000\000\000\000?\360\000\000\000\000
\000\000?\360\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000
\000\000\000\000\000\000\000\000\000\000\000\000\000
		</pre></div><div class="refsection" title="関連情報"><a name="id287033681"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsBinary" title="ST_AsBinary">ST_AsBinary</a>, <a class="xref" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a>, <a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a>, <a class="xref" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a>, <a class="xref" href="#ST_SRID" title="ST_SRID">ST_SRID</a></p></div></div><div class="refentry" title="ST_AsEWKT"><div class="refentry.separator"><hr></div><a name="ST_AsEWKT"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsEWKT ? ジオメトリのSRIDメタデータが付いたWell-Known Text(WKT)表現を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_AsEWKT</b>(</code>geometry  <var class="pdparam">g1</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">ST_AsEWKT</b>(</code>geography  <var class="pdparam">g1</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287030826"></a><h2>説明</h2><p>ジオメトリのSRIDメタデータが前に付いたWell-Known Text(WKT)表現を返します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>WKT仕様ではSRIDは入りません。SRIDを持たないOGC WKTの書式を得るにはST_AsTextを使用します。</p></td></tr></table></div><p><img src="images/warning.png">
				WKT書式は精度はあまり維持しませんので、浮動小数点数の打ち切りをさせないために、ST_AsBinaryかST_AsEWKB書式を使用して運んで下さい。
			</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_AsEWKTは<a class="xref" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a>の逆です。ST_AsEWKT表現をPostGISジオメトリに変換するには<a class="xref" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a>を使います。</p></td></tr></table></div><p>機能強化: 2.0.0では、ジオグラフィ、多面体サーフェス、三角形、TINが導入されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は多面体サーフェスに対応しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は三角形と不規則三角網(TIN)に対応しています。</p></div><div class="refsection" title="例"><a name="id287030910"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsEWKT('0103000020E61000000100000005000000000000
			000000000000000000000000000000000000000000000000000000
			F03F000000000000F03F000000000000F03F000000000000F03
			F000000000000000000000000000000000000000000000000'::geometry);

		   st_asewkt
--------------------------------
SRID=4326;POLYGON((0 0,0 1,1 1,1 0,0 0))
(1 row)

SELECT ST_AsEWKT('0108000080030000000000000060E30A4100000000785C0241000000000000F03F0000000018
E20A4100000000485F024100000000000000400000000018
E20A4100000000305C02410000000000000840')

--st_asewkt---
CIRCULARSTRING(220268 150415 1,220227 150505 2,220227 150406 3)
</pre></div><div class="refsection" title="関連情報"><a name="id287030958"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsBinary" title="ST_AsBinary">ST_AsBinary</a><a class="xref" href="#ST_AsEWKB" title="ST_AsEWKB">ST_AsEWKB</a><a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a>, <a class="xref" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a></p></div></div><div class="refentry" title="ST_AsGeoJSON"><div class="refentry.separator"><hr></div><a name="ST_AsGeoJSON"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsGeoJSON ? GeoJSON要素としてジオメトリを返します。 </p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_AsGeoJSON</b>(</code>geometry  <var class="pdparam">geom</var>, integer  <var class="pdparam">maxdecimaldigits=15</var>, integer  <var class="pdparam">options=0</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">ST_AsGeoJSON</b>(</code>geography  <var class="pdparam">geog</var>, integer  <var class="pdparam">maxdecimaldigits=15</var>, integer  <var class="pdparam">options=0</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">ST_AsGeoJSON</b>(</code>integer  <var class="pdparam">gj_version</var>, geometry  <var class="pdparam">geom</var>, integer  <var class="pdparam">maxdecimaldigits=15</var>, integer  <var class="pdparam">options=0</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">ST_AsGeoJSON</b>(</code>integer  <var class="pdparam">gj_version</var>, geography  <var class="pdparam">geog</var>, integer  <var class="pdparam">maxdecimaldigits=15</var>, integer  <var class="pdparam">options=0</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287031202"></a><h2>説明</h2><p>Geometry JavaScript Object Noation(GeoJSON)要素としてジオメトリを返します。(<a class="ulink" href="http://geojson.org/geojson-spec.html" target="_top">GeoJSON specifications 1.0</a>参照)。2次元と3次元のジオメトリの両方に対応しています。GeoJSONはSFS 1.1ジオメトリタイプのみ対応します(たとえば曲線は対応していません)。</p><p>gj_versionパラメタはGeoJSON仕様のメジャーバージョンです。指定した場合1でなければなりません。これはGeoJSONの仕様の版を表現します。</p><p>第3引数は、出力の最大有効桁数を減らすために使われることがあります(デフォルトは15です)。</p><p>最後の'options'引数は、GeoJSON出力の中にBboxまたはCrsを追加するために使います。与える値は次の通りです。
			in GeoJSON output:
			  </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>0: オプションなし(デフォルト値)</p></li><li class="listitem"><p>1: GeoJSON Bbox</p></li><li class="listitem"><p>2: GeoJSON Short CRS (たとえば EPSG:4326)</p></li><li class="listitem"><p>4: GeoJSON Long CRS (たとえば urn:ogc:def:crs:EPSG:4326)</p></li></ul></div><p>
			</p><p>1つ目の形式: ST_AsGeoJSON(geom) / precision=15 version=1 options=0</p><p>2つ目の形式: ST_AsGeoJSON(geom, precision) / version=1 options=0</p><p>3つ目の形式: ST_AsGeoJSON(geom, precision, options) / version=1</p><p>4つ目の形式: ST_AsGeoJSON(gj_version, geom) / precision=15 options=0</p><p>5つ目の形式: ST_AsGeoJSON(gj_version, geom, precision) /options=0</p><p>6つ目の形式: ST_AsGeoJSON(gj_version, geom, precision,options)</p><p>初出: 1.3.4</p><p>初出: 1.5.0では、ジオグラフィが導入されました。</p><p>変更: 2.0.0では、デフォルト引数と名前付き引数に対応しました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p></div><div class="refsection" title="例"><a name="id287031297"></a><h2>例</h2><p>GeoJSON書式は一般的にAjaxマッピングでの使用に効果的です。OpenLayersはこれをサポートする有名なJavaSciprクライアントです。使用例が<a class="ulink" href="http://openlayers.org/dev/examples/vector-formats.html" target="_top">OpenLayers GeoJSON Example</a>にあります。</p><pre class="programlisting">SELECT ST_AsGeoJSON(the_geom) from fe_edges limit 1;
					   st_asgeojson
-----------------------------------------------------------------------------------------------------------

{"type":"MultiLineString","coordinates":[[[-89.734634999999997,31.492072000000000],
[-89.734955999999997,31.492237999999997]]]}
(1 row)
--3d point
SELECT ST_AsGeoJSON('LINESTRING(1 2 3, 4 5 6)');

st_asgeojson
-----------------------------------------------------------------------------------------
 {"type":"LineString","coordinates":[[1,2,3],[4,5,6]]}

</pre></div></div><div class="refentry" title="ST_AsGML"><div class="refentry.separator"><hr></div><a name="ST_AsGML"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsGML ? GML第2版または第3版としてジオメトリを返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_AsGML</b>(</code>geometry  <var class="pdparam">geom</var>, integer  <var class="pdparam">maxdecimaldigits=15</var>, integer  <var class="pdparam">options=0</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">ST_AsGML</b>(</code>geography  <var class="pdparam">geog</var>, integer  <var class="pdparam">maxdecimaldigits=15</var>, integer  <var class="pdparam">options=0</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">ST_AsGML</b>(</code>integer  <var class="pdparam">version</var>, geometry  <var class="pdparam">geom</var>, integer  <var class="pdparam">maxdecimaldigits=15</var>, integer  <var class="pdparam">options=0</var>, text  <var class="pdparam">nprefix=null</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">ST_AsGML</b>(</code>integer  <var class="pdparam">version</var>, geography  <var class="pdparam">geog</var>, integer  <var class="pdparam">maxdecimaldigits=15</var>, integer  <var class="pdparam">options=0</var>, text  <var class="pdparam">nprefix=null</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287031558"></a><h2>説明</h2><p>Geography Markup Language (GML)要素としてジオメトリを返します。 versionパラメータは、指定した場合には、2または3となります。version引数が無い場合は、2と仮定します。 precision引数は、出力の最大有効桁数(<code class="varname">maxdecimaldigits</code>)を減らすために使います(デフォルトは15です)。</p><p>GML2では2.1.2版を参照し、GML3では3.1.1を参照します。</p><p>最後の'options'引数はビットフィールドです。GML出力のCRS出力型を定義するために、また緯度/経度でデータを宣言するために使います。
						  </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>GML Short CRS (たとえば EPSG:4326), デフォルト値</p></li><li class="listitem"><p>1: GML Long CRS (たとえば urn:ogc:def:crs:EPSG:4326)</p></li><li class="listitem"><p>2: GML 3のみ対応。srsDimension属性を出力から削除します。</p></li><li class="listitem"><p>4: GML 3のみ対応。線について&lt;Curve&gt;でなく&lt;LineString&gt;要素を使います。</p></li><li class="listitem"><p>16: データは緯度/経度(すなわち SRID=4326)です。デフォルトではデータは平面上にあると仮定します。このオプションはGML 3.1.1による出力でのみ使われ、軸のオーダに関連します。これを設定すると、座標の順序を入れ替えます。</p></li><li class="listitem"><p>32: ジオメトリのボックス(エンベロープ)を出力します。</p></li></ul></div><p>
						</p><p>'namespace prefix'引数は、カスタム名前空間のプリフィクスを指定したり、名前空間プリフィクスを指定しない(空にした場合)ために使用します。NULLを指定するか省略した場合には、'gml'プレフィクスを使用します。</p><p>初出: 1.3.2。</p><p>初出: 1.5.0では、ジオグラフィが導入されました。</p><p>機能強化: 2.0.0では、プレフィクスが導入されました。
GML 3用であるoptionsの4は、曲線のかわりにラインストリングを使えるようにするためのものです。GML 3の多面体サーフェスとTINが導入されました。optionsの32はボックスを出力するために導入されました。</p><p>変更: 2.0.0では、デフォルトの名前付き引数を使います。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_AsGMLのGML 3版以上では多面体サーフェスとTINに対応しています。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は多面体サーフェスに対応しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は三角形と不規則三角網(TIN)に対応しています。</p></div><div class="refsection" title="例: 2版"><a name="id287031678"></a><h2>例: 2版</h2><pre class="programlisting">SELECT ST_AsGML(ST_GeomFromText('POLYGON((0 0,0 1,1 1,1 0,0 0))',4326));
		st_asgml
		--------
		&lt;gml:Polygon srsName="EPSG:4326"&gt;&lt;gml:outerBoundaryIs&gt;&lt;gml:LinearRing&gt;&lt;gml:coordinates&gt;0,0 0,1 1,1 1,0 0,0&lt;/gml:coordinates&gt;&lt;/gml:LinearRing&gt;&lt;/gml:outerBoundaryIs&gt;&lt;/gml:Polygon&gt;
			</pre></div><div class="refsection" title="例: 3版"><a name="id287031689"></a><h2>例: 3版</h2><pre class="programlisting">-- Flip coordinates and output extended EPSG (16 | 1)--
SELECT ST_AsGML(3, ST_GeomFromText('POINT(5.234234233242 6.34534534534)',4326), 5, 17);
			st_asgml
			--------
		&lt;gml:Point srsName="urn:ogc:def:crs:EPSG::4326"&gt;&lt;gml:pos&gt;6.34535 5.23423&lt;/gml:pos&gt;&lt;/gml:Point&gt;
			</pre><pre class="programlisting">-- Output the envelope (32) --
SELECT ST_AsGML(3, ST_GeomFromText('LINESTRING(1 2, 3 4, 10 20)',4326), 5, 32);
		st_asgml
		--------
	&lt;gml:Envelope srsName="EPSG:4326"&gt;
		&lt;gml:lowerCorner&gt;1 2&lt;/gml:lowerCorner&gt;
		&lt;gml:upperCorner&gt;10 20&lt;/gml:upperCorner&gt;
	&lt;/gml:Envelope&gt;
			</pre><pre class="programlisting">-- エンベロープを出力(32)
-- 経度緯度の順でなく緯度経度の順に入れ替え (16)
-- 長い表現のSRS (1)
-- 32 | 16 | 1 = 49
SELECT ST_AsGML(3, ST_GeomFromText('LINESTRING(1 2, 3 4, 10 20)',4326), 5, 49);
	st_asgml
	--------
&lt;gml:Envelope srsName="urn:ogc:def:crs:EPSG::4326"&gt;
	&lt;gml:lowerCorner&gt;2 1&lt;/gml:lowerCorner&gt;
	&lt;gml:upperCorner&gt;20 10&lt;/gml:upperCorner&gt;
&lt;/gml:Envelope&gt;
			</pre><pre class="programlisting">-- 多面体サーフェスの例 --
SELECT ST_AsGML(3, ST_GeomFromEWKT('POLYHEDRALSURFACE( ((0 0 0, 0 0 1, 0 1 1, 0 1 0, 0 0 0)), 
((0 0 0, 0 1 0, 1 1 0, 1 0 0, 0 0 0)), ((0 0 0, 1 0 0, 1 0 1, 0 0 1, 0 0 0)), 
((1 1 0, 1 1 1, 1 0 1, 1 0 0, 1 1 0)), 
((0 1 0, 0 1 1, 1 1 1, 1 1 0, 0 1 0)), ((0 0 1, 1 0 1, 1 1 1, 0 1 1, 0 0 1)) )'));
	st_asgml
	--------
 &lt;gml:PolyhedralSurface&gt;
&lt;gml:polygonPatches&gt;
   &lt;gml:PolygonPatch&gt;
		&lt;gml:exterior&gt;
			  &lt;gml:LinearRing&gt;
				   &lt;gml:posList srsDimension="3"&gt;0 0 0 0 0 1 0 1 1 0 1 0 0 0 0&lt;/gml:posList&gt;
			  &lt;/gml:LinearRing&gt;
		&lt;/gml:exterior&gt;
   &lt;/gml:PolygonPatch&gt;
   &lt;gml:PolygonPatch&gt;
		&lt;gml:exterior&gt;
			  &lt;gml:LinearRing&gt;
				   &lt;gml:posList srsDimension="3"&gt;0 0 0 0 1 0 1 1 0 1 0 0 0 0 0&lt;/gml:posList&gt;
			  &lt;/gml:LinearRing&gt;
		&lt;/gml:exterior&gt;
   &lt;/gml:PolygonPatch&gt;
   &lt;gml:PolygonPatch&gt;
		&lt;gml:exterior&gt;
			  &lt;gml:LinearRing&gt;
				   &lt;gml:posList srsDimension="3"&gt;0 0 0 1 0 0 1 0 1 0 0 1 0 0 0&lt;/gml:posList&gt;
			  &lt;/gml:LinearRing&gt;
		&lt;/gml:exterior&gt;
   &lt;/gml:PolygonPatch&gt;
   &lt;gml:PolygonPatch&gt;
		&lt;gml:exterior&gt;
			  &lt;gml:LinearRing&gt;
				   &lt;gml:posList srsDimension="3"&gt;1 1 0 1 1 1 1 0 1 1 0 0 1 1 0&lt;/gml:posList&gt;
			  &lt;/gml:LinearRing&gt;
		&lt;/gml:exterior&gt;
   &lt;/gml:PolygonPatch&gt;
   &lt;gml:PolygonPatch&gt;
		&lt;gml:exterior&gt;
			  &lt;gml:LinearRing&gt;
				   &lt;gml:posList srsDimension="3"&gt;0 1 0 0 1 1 1 1 1 1 1 0 0 1 0&lt;/gml:posList&gt;
			  &lt;/gml:LinearRing&gt;
		&lt;/gml:exterior&gt;
   &lt;/gml:PolygonPatch&gt;
   &lt;gml:PolygonPatch&gt;
		&lt;gml:exterior&gt;
			  &lt;gml:LinearRing&gt;
				   &lt;gml:posList srsDimension="3"&gt;0 0 1 1 0 1 1 1 1 0 1 1 0 0 1&lt;/gml:posList&gt;
			  &lt;/gml:LinearRing&gt;
		&lt;/gml:exterior&gt;
   &lt;/gml:PolygonPatch&gt;
&lt;/gml:polygonPatches&gt;
&lt;/gml:PolyhedralSurface&gt;
			</pre></div><div class="refsection" title="関連情報"><a name="id287031748"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeomFromGML" title="ST_GeomFromGML">ST_GeomFromGML</a></p></div></div><div class="refentry" title="ST_AsHEXEWKB"><div class="refentry.separator"><hr></div><a name="ST_AsHEXEWKB"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsHEXEWKB ? ジオメトリのHEXEWKB表現(文字列)を返します。リトルエンディアン(NDS)またはビッグエンディアン(XDR)のどちらかのエンコーディングを使います。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_AsHEXEWKB</b>(</code>geometry  <var class="pdparam">g1</var>, text  <var class="pdparam">NDRorXDR</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">ST_AsHEXEWKB</b>(</code>geometry  <var class="pdparam">g1</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287031859"></a><h2>説明</h2><p>ジオメトリのHEXEWKB表現(文字列)を返します。リトルエンディアン(NDS)またはビッグエンディアン(XDR)のどちらかのエンコーディングを使います。エンコーディングを指定しない場合はNDRを使います。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>初出: 1.2.2</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p></div><div class="refsection" title="例"><a name="id287031896"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsHEXEWKB(ST_GeomFromText('POLYGON((0 0,0 1,1 1,1 0,0 0))',4326));
		which gives same answer as

		SELECT ST_GeomFromText('POLYGON((0 0,0 1,1 1,1 0,0 0))',4326)::text;

		st_ashexewkb
		--------
		0103000020E6100000010000000500
		00000000000000000000000000000000
		00000000000000000000000000000000F03F
		000000000000F03F000000000000F03F000000000000F03
		F000000000000000000000000000000000000000000000000</pre></div></div><div class="refentry" title="ST_AsKML"><div class="refentry.separator"><hr></div><a name="ST_AsKML"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsKML ? ジオメトリをKML要素で返します。いくつかの形式があります。デフォルトはversion=2, precision=15です。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_AsKML</b>(</code>geometry  <var class="pdparam">geom</var>, integer  <var class="pdparam">maxdecimaldigits=15</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">ST_AsKML</b>(</code>geography  <var class="pdparam">geog</var>, integer  <var class="pdparam">maxdecimaldigits=15</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">ST_AsKML</b>(</code>integer  <var class="pdparam">version</var>, geometry  <var class="pdparam">geom</var>, integer  <var class="pdparam">maxdecimaldigits=15</var>, text  <var class="pdparam">nprefix=NULL</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">ST_AsKML</b>(</code>integer  <var class="pdparam">version</var>, geography  <var class="pdparam">geog</var>, integer  <var class="pdparam">maxdecimaldigits=15</var>, text  <var class="pdparam">nprefix=NULL</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287032077"></a><h2>説明</h2><p>ジオメトリをKeyhole Markup Language(KML)要素で返します。この関数にはいくつかの形式があります。出力に使われる小数位の最大数のデフォルトは15で、デフォルトのバージョンは2で、デフォルトの名前空間はプリフィクス無しです。</p><p>1つめの形式: ST_AsKML(geom_or_geog, maxdecimaldigits) / version=2 / maxdecimaldigits=15 </p><p>2つめの形式: ST_AsKML(version, geom_or_geog, maxdecimaldigits, nprefix) maxdecimaldigits=15 / nprefix=NULL </p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>PostGISがProjサポートでコンパイルされている必要があります。<a class="xref" href="#PostGIS_Full_Version" title="PostGIS_Full_Version">PostGIS_Full_Version</a>を使ってProjサポートでコンパイルされているか確認して下さい。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>初出: 1.2.2 - versionパラメータが付く形式は1.3.2からです。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>機能強化: 2.0.0 - プレフィクス名前空間を追加しました。デフォルトではプリフィクス無しです。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>変更: 2.0.0 - デフォルト引数と名前付き引数に対応しました。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>AsKML出力はSRIDを持たないジオメトリでは動作しません。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p></div><div class="refsection" title="例"><a name="id287032141"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsKML(ST_GeomFromText('POLYGON((0 0,0 1,1 1,1 0,0 0))',4326));

		st_askml
		--------
		&lt;Polygon&gt;&lt;outerBoundaryIs&gt;&lt;LinearRing&gt;&lt;coordinates&gt;0,0 0,1 1,1 1,0 0,0&lt;/coordinates&gt;&lt;/LinearRing&gt;&lt;/outerBoundaryIs&gt;&lt;/Polygon&gt;

		--3d linestring
		SELECT ST_AsKML('SRID=4326;LINESTRING(1 2 3, 4 5 6)');
		&lt;LineString&gt;&lt;coordinates&gt;1,2,3 4,5,6&lt;/coordinates&gt;&lt;/LineString&gt;
		
		</pre></div><div class="refsection" title="関連情報"><a name="id287032152"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsSVG" title="ST_AsSVG">ST_AsSVG</a>, <a class="xref" href="#ST_AsGML" title="ST_AsGML">ST_AsGML</a></p></div></div><div class="refentry" title="ST_AsSVG"><div class="refentry.separator"><hr></div><a name="ST_AsSVG"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsSVG ? ジオメトリまたはジオグラフィで与えられたSVGパスデータによるジオメトリを返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_AsSVG</b>(</code>geometry  <var class="pdparam">geom</var>, integer  <var class="pdparam">rel=0</var>, integer  <var class="pdparam">maxdecimaldigits=15</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">ST_AsSVG</b>(</code>geography  <var class="pdparam">geog</var>, integer  <var class="pdparam">rel=0</var>, integer  <var class="pdparam">maxdecimaldigits=15</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287032298"></a><h2>説明</h2><p>Scalar Vector Graphics (SVG)としてジオメトリを返します。 第2引数に1を指定すると、相対移動によるパスデータ実装を返し、絶対移動の場合はデフォルト(または0)とします。第3引数は、出力の十進数の最大桁数を減らすために使います(デフォルトは15です)。ポイントジオメトリは、'rel'が0のときはポイントはcx/cyに、'rel'が1のときはx/yに、それぞれ出力されます。マルチポイントはコンマ(",")で区切られ、ジオメトリコレクションはセミコロン(";")で区切られます。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>初出: 1.2.2. 初出: 1.4.0 PostGIS 1.4.0で<a class="ulink" href="http://www.w3.org/TR/SVG/paths.html#PathDataBNF" target="_top">http://www.w3.org/TR/SVG/paths.html#PathDataBNF</a>に従うため、絶対パスにLコマンドが入りました。</p></td></tr></table></div><p>変更: 2.0.0では、デフォルト引数と名前付き引数に対応しました。</p></div><div class="refsection" title="例"><a name="id287032322"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsSVG(ST_GeomFromText('POLYGON((0 0,0 1,1 1,1 0,0 0))',4326));

		st_assvg
		--------
		M 0 0 L 0 -1 1 -1 1 0 Z</pre></div></div><div class="refentry" title="ST_AsX3D"><div class="refentry.separator"><hr></div><a name="ST_AsX3D"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsX3D ? ジオメトリをX3Dノード要素書式(ISO-IEC-19776-1.2-X3DEncodings-XML)で返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_AsX3D</b>(</code>geometry  <var class="pdparam">g1</var>, integer  <var class="pdparam">maxdecimaldigits=15</var>, integer  <var class="pdparam">options=0</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287032392"></a><h2>説明</h2><p>ジオメトリをX3Dノード要素(<a class="ulink" href="http://web3d.org/x3d/specifications/ISO-IEC-19776-1.2-X3DEncodings-XML/Part01/EncodingOfNodes.html" target="_top">http://web3d.org/x3d/specifications/ISO-IEC-19776-1.2-X3DEncodings-XML/Part01/EncodingOfNodes.html</a>)で返します。<code class="varname">maxdecimaldigits</code>(精度)が指定されない場合のデフォルト値は15です。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>PostGISジオメトリをX3Dに変換するには様々なオプションがあります。X3Dジオメトリのタイプは直接的にPostGISジオメトリタイプに対応付けされないためです。また、新しいX3D型は、よりよい対応付けになるかも知れませんが、大部分の描画ツールが現在のところ対応していないため避けています。これらは私たちが同意した対応付けです。アイデアまたは私たちが人々にそれらの好ましい対応付けを示すことができる方法についての考えがあるようでしたら、遠慮なくバグチケットに投稿して下さい。</p><p>次に現在PostGIS 2次元/3次元型からX3D型への対応付けを示します。</p></td></tr></table></div><div class="informaltable"><table border="1"><colgroup><col><col><col></colgroup><thead><tr><th>PostGIS Type</th><th>2D X3D Type</th><th>3D X3D Type</th></tr></thead><tbody><tr><td>LINESTRING</td><td>未実装 - PolyLine2Dの予定</td><td>LineSet</td></tr><tr><td>MULTILINESTRING</td><td>未実装 - PolyLine2Dの予定</td><td>IndexedLineSet</td></tr><tr><td>MULTIPOINT</td><td>Polypoint2D</td><td>PointSet</td></tr><tr><td>POINT</td><td>空白区切り座標値を出力</td><td>空白区切り座標値を出力</td></tr><tr><td>(MULTI) POLYGON, POLYHEDRALSURFACE</td><td>不正なX3Dマークアップ</td><td>IndexedFaceSet (内環は現在は他のfacesetとして出力)</td></tr><tr><td>TIN</td><td>TriangleSet2D (未実装)</td><td>IndexedTriangleSet</td></tr></tbody></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>2次元ジオメトリ対応はまだ不完全です。
内環は現在は分けられたポリゴンとして描画されます。</p></td></tr></table></div><p>3次元空間については、特に<a class="ulink" href="http://www.web3d.org/x3d/wiki/index.php/X3D_and_HTML5#Goals:_X3D_and_HTML5" target="_top">X3D Integration with HTML5</a>によって、よく進展しています。</p><p>また、描画されたジオメトリを閲覧するための素晴らしいオープンソースのX3Dビューアがあります。Free Wrl <a class="ulink" href="http://freewrl.sourceforge.net/" target="_top">http://freewrl.sourceforge.net/</a>のバイナリがMac, Linux, Windows用であります。ジオメトリを見るためのパッケージであるFreeWRL_Launcherを使います。</p><p>初出: 2.0.0: ISO-IEC-19776-1.2-X3DEncodings-XML</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は多面体サーフェスに対応しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は三角形と不規則三角網(TIN)に対応しています。</p></div><div class="refsection" title="例: 完全に機能するX3D文書の作成 - FreeWrlや他のX3Dビューアで見ることができる立方体を生成しています。"><a name="id287032590"></a><h2>例: 完全に機能するX3D文書の作成 - FreeWrlや他のX3Dビューアで見ることができる立方体を生成しています。</h2><pre class="programlisting">SELECT '&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE X3D PUBLIC "ISO//Web3D//DTD X3D 3.0//EN" "http://www.web3d.org/specifications/x3d-3.0.dtd"&gt;
&lt;X3D&gt;
  &lt;Scene&gt;
    &lt;Transform&gt;
      &lt;Shape&gt;
       &lt;Appearance&gt;
            &lt;Material emissiveColor=''0 0 1''/&gt;   
       &lt;/Appearance&gt; ' || 
       ST_AsX3D( ST_GeomFromEWKT('POLYHEDRALSURFACE( ((0 0 0, 0 0 1, 0 1 1, 0 1 0, 0 0 0)), 
((0 0 0, 0 1 0, 1 1 0, 1 0 0, 0 0 0)), ((0 0 0, 1 0 0, 1 0 1, 0 0 1, 0 0 0)), 
((1 1 0, 1 1 1, 1 0 1, 1 0 0, 1 1 0)), 
((0 1 0, 0 1 1, 1 1 1, 1 1 0, 0 1 0)), ((0 0 1, 1 0 1, 1 1 1, 0 1 1, 0 0 1)) )')) ||
      '&lt;/Shape&gt;
    &lt;/Transform&gt;
  &lt;/Scene&gt;
&lt;/X3D&gt;' As x3ddoc;

		x3ddoc
		--------
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE X3D PUBLIC "ISO//Web3D//DTD X3D 3.0//EN" "http://www.web3d.org/specifications/x3d-3.0.dtd"&gt;
&lt;X3D&gt;
  &lt;Scene&gt;
    &lt;Transform&gt;
      &lt;Shape&gt;
       &lt;Appearance&gt;
            &lt;Material emissiveColor='0 0 1'/&gt;   
       &lt;/Appearance&gt; 
       &lt;IndexedFaceSet  coordIndex='0 1 2 3 -1 4 5 6 7 -1 8 9 10 11 -1 12 13 14 15 -1 16 17 18 19 -1 20 21 22 23'&gt;
            &lt;Coordinate point='0 0 0 0 0 1 0 1 1 0 1 0 0 0 0 0 1 0 1 1 0 1 0 0 0 0 0 1 0 0 1 0 1 0 0 1 1 1 0 1 1 1 1 0 1 1 0 0 0 1 0 0 1 1 1 1 1 1 1 0 0 0 1 1 0 1 1 1 1 0 1 1' /&gt;
      &lt;/IndexedFaceSet&gt;
      &lt;/Shape&gt;
    &lt;/Transform&gt;
  &lt;/Scene&gt;
&lt;/X3D&gt;</pre></div><div class="refsection" title="例: 高さ3単位で精度が6桁の八角柱"><a name="id287032601"></a><h2>例: 高さ3単位で精度が6桁の八角柱</h2><pre class="programlisting">SELECT ST_AsX3D(
ST_Translate(
    ST_Force_3d(
        ST_Buffer(ST_Point(10,10),5, 'quad_segs=2')), 0,0,
    3)
  ,6) As x3dfrag;

x3dfrag
--------
&lt;IndexedFaceSet coordIndex="0 1 2 3 4 5 6 7"&gt;
    &lt;Coordinate point="15 10 3 13.535534 6.464466 3 10 5 3 6.464466 6.464466 3 5 10 3 6.464466 13.535534 3 10 15 3 13.535534 13.535534 3 " /&gt;
&lt;/IndexedFaceSet&gt;</pre></div><div class="refsection" title="例: TIN"><a name="id287032612"></a><h2>例: TIN</h2><pre class="programlisting">SELECT ST_AsX3D(ST_GeomFromEWKT('TIN (((
                0 0 0, 
                0 0 1, 
                0 1 0, 
                0 0 0
            )), ((
                0 0 0, 
                0 1 0, 
                1 1 0, 
                0 0 0
            ))
            )')) As x3dfrag;

		x3dfrag
		--------
&lt;IndexedTriangleSet  index='0 1 2 3 4 5'&gt;&lt;Coordinate point='0 0 0 0 0 1 0 1 0 0 0 0 0 1 0 1 1 0'/&gt;&lt;/IndexedTriangleSet&gt;</pre></div><div class="refsection" title="Example: Closed multilinestring (the boundary of a polygon with holes)"><a name="id287032622"></a><h2>Example: Closed multilinestring (the boundary of a polygon with holes)</h2><pre class="programlisting">SELECT ST_AsX3D(
		    ST_GeomFromEWKT('MULTILINESTRING((20 0 10,16 -12 10,0 -16 10,-12 -12 10,-20 0 10,-12 16 10,0 24 10,16 16 10,20 0 10),
  (12 0 10,8 8 10,0 12 10,-8 8 10,-8 0 10,-8 -4 10,0 -8 10,8 -4 10,12 0 10))') 
) As x3dfrag;

		x3dfrag
		--------
&lt;IndexedLineSet  coordIndex='0 1 2 3 4 5 6 7 0 -1 8 9 10 11 12 13 14 15 8'&gt;
    &lt;Coordinate point='20 0 10 16 -12 10 0 -16 10 -12 -12 10 -20 0 10 -12 16 10 0 24 10 16 16 10 12 0 10 8 8 10 0 12 10 -8 8 10 -8 0 10 -8 -4 10 0 -8 10 8 -4 10 ' /&gt;
 &lt;/IndexedLineSet&gt;</pre></div></div><div class="refentry" title="ST_GeoHash"><div class="refentry.separator"><hr></div><a name="ST_GeoHash"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_GeoHash ? ジオメトリのGeoHash表現(geohash.org)を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_GeoHash</b>(</code>geometry  <var class="pdparam">geom</var>, integer  <var class="pdparam">maxchars=full_precision_of_point</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287032682"></a><h2>説明</h2><p>ジオメトリのGeoHash表現(geohash.org)を返します。GeoHashによって、ポイントをprefixingに基づいてソートと検索が可能なテキスト形式にエンコードします。短いGeoHashは低精度のポイント表現です。実際の点を含むボックスとも考えられます。</p><p><code class="varname">maxchars</code>を指定しなかった場合には、ST_GeoHashは、入力ジオメトリタイプの、完全な精度に基づくGeoHashを返します。ポイントについては20文字の精度を持つGeoHashを返します(入力の倍精度を完全に保持するのに概ね十分です)。他のタイプでは可変的な精度量を持つGeoHashを返します。大きなフィーチャーは低精度で表現され、小さいフィーチャーは高精度で表現されます。GeoHashが含むボックスは常に入力地物を含むという考えです。</p><p><code class="varname">maxchars</code>を指定した場合には、ST_GeoHashは、最高でもその文字数によるGeoHashを返し、入力ジオメトリはおそらく低精度表現となります。ポイント以外では、計算の開始点はジオメトリのバウンディングボックスの中心となります。</p><p>初出: 1.4.0</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_GeoHashはジオグラフィ(経度緯度)座標系では動作しません。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p></div><div class="refsection" title="例"><a name="id287033030"></a><h2>例</h2><pre class="programlisting">SELECT ST_GeoHash(ST_SetSRID(ST_MakePoint(-126,48),4326));

	 st_geohash
----------------------
 c0w3hf1s70w3hf1s70w3

SELECT ST_GeoHash(ST_SetSRID(ST_MakePoint(-126,48),4326),5);

 st_geohash
------------
 c0w3h
		
		</pre></div><div class="refsection" title="関連情報"><a name="id287033041"></a><h2>関連情報</h2><p></p></div></div><div class="refentry" title="ST_AsText"><div class="refentry.separator"><hr></div><a name="ST_AsText"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsText ? ジオメトリ/ジオグラフィのSRIDメタデータのないWell-Known Text(WKT)表現を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_AsText</b>(</code>geometry  <var class="pdparam">g1</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">ST_AsText</b>(</code>geography  <var class="pdparam">g1</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287033141"></a><h2>説明</h2><p>ジオメトリ/ジオグラフィのWell-Knwon Text表現を返します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>WKT仕様ではSRIDは入りません。SRIDを持つOGC WKTの書式を得るには、OGC標準ではないPostGIS  <a class="xref" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a>を使用します。</p></td></tr></table></div><p><img src="images/warning.png">
				WKT書式は精度はあまり維持しませんので、浮動小数点数の打ち切りをさせないために、ST_AsBinaryかST_AsEWKB書式を使用して運んで下さい。
			</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_AsTextは<a class="xref" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a>の逆です。ST_AsText表現をPostGISジオメトリに変換するには<a class="xref" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a>を使います。</p></td></tr></table></div><p>初出: 1.5 - ジオグラフィが導入されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です s2.1.1.1</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.25</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p></div><div class="refsection" title="例"><a name="id287036360"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText('01030000000100000005000000000000000000
000000000000000000000000000000000000000000000000
F03F000000000000F03F000000000000F03F000000000000F03
F000000000000000000000000000000000000000000000000');

		   st_astext
--------------------------------
 POLYGON((0 0,0 1,1 1,1 0,0 0))
(1 row)</pre></div><div class="refsection" title="関連情報"><a name="id287036373"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsBinary" title="ST_AsBinary">ST_AsBinary</a>, <a class="xref" href="#ST_AsEWKB" title="ST_AsEWKB">ST_AsEWKB</a>, <a class="xref" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a>, <a class="xref" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a></p></div></div><div class="refentry" title="ST_AsLatLonText"><div class="refentry.separator"><hr></div><a name="ST_AsLatLonText"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsLatLonText ? 与えられたポイントの度・分・秒表現を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_AsLatLonText</b>(</code>geometry  <var class="pdparam">pt</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">ST_AsLatLonText</b>(</code>geometry  <var class="pdparam">pt</var>, text  <var class="pdparam">format</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287036460"></a><h2>説明</h2><p>ポイントの度・分・秒表現を返します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>緯度経度座標系のポイントを前提としています。X(経度)とY(緯度)座標系は「正常な」範囲(経度は-180から180、緯度は-90から90)に正常化されます。</p></td></tr></table></div><p>text引数は結果文字列のための書式を含む書式文字列です。日付書式文字列に近いものです。妥当なトークンは"D"が度、"M"が分、"S"が秒、"C"(cardinal direction)が4方位(NSEW)です。DMSトークンは、求める幅と精度で示すために、繰り返せます("SSS.SSSS" means "  1.0023")。</p><p>"M"と"S"と"C"は必須ではありません。"C"が省略された場合には、南または西の場合には"-"符号がついたうえで、指定した精度で、度が表示されます。"M"も省略された場合には、指定した精度の桁数で十進の度が表示されます。</p><p>書式文字列が省略された(または長さが0の)場合には、デフォルトの書式が使われます。</p><p>
			</p><p>初出: 2.0</p></div><div class="refsection" title="例"><a name="id287036493"></a><h2>例</h2><p>デフォルト書式。</p><pre class="programlisting">
SELECT (ST_AsLatLonText('POINT (-3.2342342 -2.32498)'));
      st_aslatlontext       
----------------------------
 2ｰ19'29.928"S 3ｰ14'3.243"W
</pre><p>書式を指定(デフォルトと同じ)。</p><pre class="programlisting">
SELECT (ST_AsLatLonText('POINT (-3.2342342 -2.32498)', 'DｰM''S.SSS"C'));
      st_aslatlontext       
----------------------------
 2ｰ19'29.928"S 3ｰ14'3.243"W
</pre><p>Characters other than D, M, S, C and . are just passed through.</p><pre class="programlisting">
SELECT (ST_AsLatLonText('POINT (-3.2342342 -2.32498)', 'D degrees, M minutes, S seconds to the C'));
                                   st_aslatlontext                                    
--------------------------------------------------------------------------------------
 2 degrees, 19 minutes, 30 seconds to the S 3 degrees, 14 minutes, 3 seconds to the W
</pre><p>4方位文字でなく符号で示された度。</p><pre class="programlisting">
SELECT (ST_AsLatLonText('POINT (-3.2342342 -2.32498)', 'DｰM''S.SSS"'));
      st_aslatlontext       
----------------------------
 -2ｰ19'29.928" -3ｰ14'3.243"
</pre><p>十進の度。</p><pre class="programlisting">
SELECT (ST_AsLatLonText('POINT (-3.2342342 -2.32498)', 'D.DDDD degrees C'));
          st_aslatlontext          
-----------------------------------
 2.3250 degrees S 3.2342 degrees W
</pre><p>Excessively large values are normalized.</p><pre class="programlisting">
SELECT (ST_AsLatLonText('POINT (-302.2342342 -792.32498)'));
        st_aslatlontext        
-------------------------------
 72ｰ19'29.928"S 57ｰ45'56.757"E
</pre></div></div></div><div class="sect1" title="8.7. 演算子"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Operators"></a>8.7. 演算子</h2></div></div></div><div class="toc"><dl><dt><span class="refentrytitle"><a href="#geometry_overlaps">&amp;&amp;</a></span><span class="refpurpose"> ? AのバウンディングボックスがBのバウンディングボックスをオーバラップする場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#geometry_overlaps_nd">&amp;&amp;&amp;</a></span><span class="refpurpose"> ? 3次元バウンディングボックスがBの3次元バウンディングボックスにインタセクトする場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Geometry_Overleft">&amp;&lt;</a></span><span class="refpurpose"> ? AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの左にある場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Geometry_Overbelow">&amp;&lt;|</a></span><span class="refpurpose"> ? AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの下にある場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Geometry_Overright">&amp;&gt;</a></span><span class="refpurpose"> ? AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの右にある場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Geometry_Left">&lt;&lt;</a></span><span class="refpurpose"> ? Aのバウンダリボックスが、厳密にBのバウンダリボックスの左にある場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Geometry_Below">&lt;&lt;|</a></span><span class="refpurpose"> ? Aのバウンダリボックスが、厳密にBのバウンダリボックスの下にある場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Geometry_EQ">=</a></span><span class="refpurpose"> ? Aのバウンダリボックスが、Bのバウンダリボックスと同じ場合に<code class="varname">TRUE</code>を返します。バウンディングボックスには倍精度浮動小数点数を使います。</span></dt><dt><span class="refentrytitle"><a href="#ST_Geometry_Right">&gt;&gt;</a></span><span class="refpurpose"> ? Aのバウンダリボックスが、厳密にBのバウンダリボックスの右にある場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Geometry_Contained">@</a></span><span class="refpurpose"> ? AのバウンダリボックスがBのバウンダリボックスに含まれている場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Geometry_Overabove">|&amp;&gt;</a></span><span class="refpurpose"> ? AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの上にある場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Geometry_Above">|&gt;&gt;</a></span><span class="refpurpose"> ? Aのバウンダリボックスが、厳密にBのバウンダリボックスの上にある場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Geometry_Contain">~</a></span><span class="refpurpose"> ? AのバウンディングボックスがBのバウンディングボックスを含む場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Geometry_Same">~=</a></span><span class="refpurpose"> ? AのバウンディングボックスがBのバウンディングボックスと同じ場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#geometry_distance_centroid">&lt;-&gt;</a></span><span class="refpurpose"> ? 
2つのポイントの間の距離を返します。ポイントでは、ポイントは単精度(元となるポイントジオメトリが倍精度ですが)を使って調べます。他のジオメトリタイプでは、バウンディングボックスの重心どうしの距離を返します。KNN GiST機能を使った距離による並べ替えや近傍の制限に使います。</span></dt><dt><span class="refentrytitle"><a href="#geometry_distance_box">&lt;#&gt;</a></span><span class="refpurpose"> ? 2ジオメトリのバウンディングボックス間の距離を返します。ポイントの場合は、距離とほとんど同じ(バウンディングボックスは単精度であり、ジオメトリは倍精度なので異なる)かを調べます。KNN GiST機能を使った距離による並べ替えと近傍の制限とに使います。</span></dt></dl></div><div class="refentry" title="&amp;&amp;"><a name="geometry_overlaps"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>&amp;&amp; ? AのバウンディングボックスがBのバウンディングボックスをオーバラップする場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">&amp;&amp;</b>(</code>
				  geometry 

				  <var class="pdparam">A</var>
				, 
				  geometry 

				  <var class="pdparam">B</var>
				<code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">&amp;&amp;</b>(</code>
				  geography 

				  <var class="pdparam">A</var>
				, 
				  geography 

				  <var class="pdparam">B</var>
				<code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287039509"></a><h2>説明</h2><p><code class="varname">&amp;&amp;</code>演算子は、AのバウンディングボックスがBのバウンディングボックスをオーバラップする場合に<code class="varname">TRUE</code>を返します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この演算子はジオメトリで利用できるインデクスを使用します。</p></td></tr></table></div><p>機能強化: 2.0.0では、多面体サーフェスを導入しました。</p><p>初出: 1.5.0では、ジオグラフィを導入しました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は多面体サーフェスに対応しています。</p></div><div class="refsection" title="例"><a name="id287039557"></a><h2>例</h2><pre class="programlisting">SELECT tbl1.column1, tbl2.column1, tbl1.column2 &amp;&amp; tbl2.column2 AS overlaps
FROM ( VALUES
	(1, 'LINESTRING(0 0, 3 3)'::geometry),
	(2, 'LINESTRING(0 1, 0 5)'::geometry)) AS tbl1,
( VALUES
	(3, 'LINESTRING(1 2, 4 6)'::geometry)) AS tbl2;

 column1 | column1 | overlaps
---------+---------+----------
	   1 |       3 | t
	   2 |       3 | f
(2 rows)</pre></div><div class="refsection" title="関連情報"><a name="id287039570"></a><h2>関連情報</h2><p>
				<a class="xref" href="#ST_Geometry_Overabove" title="|&amp;&gt;">|&amp;&gt;</a>,
				<a class="xref" href="#ST_Geometry_Overright" title="&amp;&gt;">&amp;&gt;</a>,
				<a class="xref" href="#ST_Geometry_Overbelow" title="&amp;&lt;|">&amp;&lt;|</a>,
				<a class="xref" href="#ST_Geometry_Overleft" title="&amp;&lt;">&amp;&lt;</a>,
				<a class="xref" href="#ST_Geometry_Contain" title="~">~</a>,
				<a class="xref" href="#ST_Geometry_Contained" title="@">@</a></p></div></div><div class="refentry" title="&amp;&amp;&amp;"><div class="refentry.separator"><hr></div><a name="geometry_overlaps_nd"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>&amp;&amp;&amp; ? 3次元バウンディングボックスがBの3次元バウンディングボックスにインタセクトする場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">&amp;&amp;&amp;</b>(</code>
				  geometry 

				  <var class="pdparam">A</var>
				, 
				  geometry 

				  <var class="pdparam">B</var>
				<code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287039653"></a><h2>説明</h2><p><code class="varname">&amp;&amp;&amp;</code>演算子は、n次元バウンディングボックスがBのn次元バウンディングボックスにインタセクトする場合に<code class="varname">TRUE</code>を返します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この演算子はジオメトリで利用できるインデクスを使用します。</p></td></tr></table></div><p>初出: 2.0.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は多面体サーフェスに対応しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は三角形と不規則三角網(TIN)に対応しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p></div><div class="refsection" title="例: 3次元ラインストリング"><a name="id287039721"></a><h2>例: 3次元ラインストリング</h2><pre class="programlisting">SELECT tbl1.column1, tbl2.column1, tbl1.column2 &amp;&amp;&amp; tbl2.column2 AS overlaps_3d, 
			            tbl1.column2 &amp;&amp; tbl2.column2 AS overlaps_2d
FROM ( VALUES
	(1, 'LINESTRING Z(0 0 1, 3 3 2)'::geometry),
	(2, 'LINESTRING Z(1 2 0, 0 5 -1)'::geometry)) AS tbl1,
( VALUES
	(3, 'LINESTRING Z(1 2 1, 4 6 1)'::geometry)) AS tbl2;

 column1 | column1 | overlaps_3d | overlaps_2d
---------+---------+-------------+-------------
       1 |       3 | t           | t
       2 |       3 | f           | t
</pre></div><div class="refsection" title="例: XYMラインストリング"><a name="id287039732"></a><h2>例: XYMラインストリング</h2><pre class="programlisting">SELECT tbl1.column1, tbl2.column1, tbl1.column2 &amp;&amp;&amp; tbl2.column2 AS overlaps_3zm, 
			            tbl1.column2 &amp;&amp; tbl2.column2 AS overlaps_2d
FROM ( VALUES
	(1, 'LINESTRING M(0 0 1, 3 3 2)'::geometry),
	(2, 'LINESTRING M(1 2 0, 0 5 -1)'::geometry)) AS tbl1,
( VALUES
	(3, 'LINESTRING M(1 2 1, 4 6 1)'::geometry)) AS tbl2;

 column1 | column1 | overlaps_3zm | overlaps_2d
---------+---------+-------------+-------------
       1 |       3 | t           | t
       2 |       3 | f           | t
</pre></div><div class="refsection" title="関連情報"><a name="id287039742"></a><h2>関連情報</h2><p><a class="xref" href="#geometry_overlaps" title="&amp;&amp;">&amp;&amp;</a></p></div></div><div class="refentry" title="&amp;&lt;"><div class="refentry.separator"><hr></div><a name="ST_Geometry_Overleft"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>&amp;&lt; ? AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの左にある場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">&amp;&lt;</b>(</code>
				  geometry 

				  <var class="pdparam">A</var>
				, 
				  geometry 

				  <var class="pdparam">B</var>
				<code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287039811"></a><h2>説明</h2><p><code class="varname">&amp;&lt;</code>演算子は、AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの左にある場合に<code class="varname">TRUE</code>を返します。条件についてより詳細に言うと、BのバウンディングボックスをオーバラップするかBのバウンディングボックスの右に*ない*場合です。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この演算子はジオメトリで利用できるインデクスを使用します。</p></td></tr></table></div></div><div class="refsection" title="例"><a name="id287039831"></a><h2>例</h2><pre class="programlisting">SELECT tbl1.column1, tbl2.column1, tbl1.column2 &amp;&lt; tbl2.column2 AS overleft
FROM
  ( VALUES
	(1, 'LINESTRING(1 2, 4 6)'::geometry)) AS tbl1,
  ( VALUES
	(2, 'LINESTRING(0 0, 3 3)'::geometry),
	(3, 'LINESTRING(0 1, 0 5)'::geometry),
	(4, 'LINESTRING(6 0, 6 1)'::geometry)) AS tbl2;

 column1 | column1 | overleft
---------+---------+----------
	   1 |       2 | f
	   1 |       3 | f
	   1 |       4 | t
(3 rows)</pre></div><div class="refsection" title="関連情報"><a name="id287039842"></a><h2>関連情報</h2><p>
				<a class="xref" href="#geometry_overlaps" title="&amp;&amp;">&amp;&amp;</a>,
				<a class="xref" href="#ST_Geometry_Overabove" title="|&amp;&gt;">|&amp;&gt;</a>,
				<a class="xref" href="#ST_Geometry_Overright" title="&amp;&gt;">&amp;&gt;</a>,
				<a class="xref" href="#ST_Geometry_Overbelow" title="&amp;&lt;|">&amp;&lt;|</a></p></div></div><div class="refentry" title="&amp;&lt;|"><div class="refentry.separator"><hr></div><a name="ST_Geometry_Overbelow"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>&amp;&lt;| ? AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの下にある場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">&amp;&lt;|</b>(</code>
				  geometry 

				  <var class="pdparam">A</var>
				, 
				  geometry 

				  <var class="pdparam">B</var>
				<code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287039921"></a><h2>説明</h2><p><code class="varname">&amp;&lt;|</code>演算子は、AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの下にある場合に<code class="varname">TRUE</code>を返します。条件についてより詳細に言うと、BのバウンディングボックスをオーバラップするかBのバウンディングボックスの上に*ない*場合です。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は多面体サーフェスに対応しています。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この演算子はジオメトリで利用できるインデクスを使用します。</p></td></tr></table></div></div><div class="refsection" title="例"><a name="id287039961"></a><h2>例</h2><pre class="programlisting">SELECT tbl1.column1, tbl2.column1, tbl1.column2 &amp;&lt;| tbl2.column2 AS overbelow
FROM
  ( VALUES
	(1, 'LINESTRING(6 0, 6 4)'::geometry)) AS tbl1,
  ( VALUES
	(2, 'LINESTRING(0 0, 3 3)'::geometry),
	(3, 'LINESTRING(0 1, 0 5)'::geometry),
	(4, 'LINESTRING(1 2, 4 6)'::geometry)) AS tbl2;

 column1 | column1 | overbelow
---------+---------+-----------
	   1 |       2 | f
	   1 |       3 | t
	   1 |       4 | t
(3 rows)</pre></div><div class="refsection" title="関連情報"><a name="id287040007"></a><h2>関連情報</h2><p>
				<a class="xref" href="#geometry_overlaps" title="&amp;&amp;">&amp;&amp;</a>,
				<a class="xref" href="#ST_Geometry_Overabove" title="|&amp;&gt;">|&amp;&gt;</a>,
				<a class="xref" href="#ST_Geometry_Overright" title="&amp;&gt;">&amp;&gt;</a>,
				<a class="xref" href="#ST_Geometry_Overleft" title="&amp;&lt;">&amp;&lt;</a></p></div></div><div class="refentry" title="&amp;&gt;"><div class="refentry.separator"><hr></div><a name="ST_Geometry_Overright"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>&amp;&gt; ? AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの右にある場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">&amp;&gt;</b>(</code>
				  geometry 

				  <var class="pdparam">A</var>
				, 
				  geometry 

				  <var class="pdparam">B</var>
				<code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287040086"></a><h2>説明</h2><p><code class="varname">&amp;&gt;</code>演算子は、AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの右にある場合に<code class="varname">TRUE</code>を返します。条件についてより詳細に言うと、BのバウンディングボックスをオーバラップするかBのバウンディングボックスの左に*ない*場合です。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この演算子はジオメトリで利用できるインデクスを使用します。</p></td></tr></table></div></div><div class="refsection" title="例"><a name="id287040105"></a><h2>例</h2><pre class="programlisting">SELECT tbl1.column1, tbl2.column1, tbl1.column2 &amp;&gt; tbl2.column2 AS overright
FROM
  ( VALUES
	(1, 'LINESTRING(1 2, 4 6)'::geometry)) AS tbl1,
  ( VALUES
	(2, 'LINESTRING(0 0, 3 3)'::geometry),
	(3, 'LINESTRING(0 1, 0 5)'::geometry),
	(4, 'LINESTRING(6 0, 6 1)'::geometry)) AS tbl2;

 column1 | column1 | overright
---------+---------+-----------
	   1 |       2 | t
	   1 |       3 | t
	   1 |       4 | f
(3 rows)</pre></div><div class="refsection" title="関連情報"><a name="id287040116"></a><h2>関連情報</h2><p>
				<a class="xref" href="#geometry_overlaps" title="&amp;&amp;">&amp;&amp;</a>,
				<a class="xref" href="#ST_Geometry_Overabove" title="|&amp;&gt;">|&amp;&gt;</a>,
				<a class="xref" href="#ST_Geometry_Overbelow" title="&amp;&lt;|">&amp;&lt;|</a>,
				<a class="xref" href="#ST_Geometry_Overleft" title="&amp;&lt;">&amp;&lt;</a></p></div></div><div class="refentry" title="&lt;&lt;"><div class="refentry.separator"><hr></div><a name="ST_Geometry_Left"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>&lt;&lt; ? Aのバウンダリボックスが、厳密にBのバウンダリボックスの左にある場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">&lt;&lt;</b>(</code>
				  geometry 

				  <var class="pdparam">A</var>
				, 
				  geometry 

				  <var class="pdparam">B</var>
				<code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287040229"></a><h2>説明</h2><p><code class="varname">&lt;&lt;</code>演算子はAのバウンダリボックスが、厳密にBのバウンダリボックスの左にある場合に<code class="varname">TRUE</code>を返します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この演算子はジオメトリで利用できるインデクスを使用します。</p></td></tr></table></div></div><div class="refsection" title="例"><a name="id287040250"></a><h2>例</h2><pre class="programlisting">SELECT tbl1.column1, tbl2.column1, tbl1.column2 &lt;&lt; tbl2.column2 AS left
FROM
  ( VALUES
	(1, 'LINESTRING (1 2, 1 5)'::geometry)) AS tbl1,
  ( VALUES
	(2, 'LINESTRING (0 0, 4 3)'::geometry),
	(3, 'LINESTRING (6 0, 6 5)'::geometry),
	(4, 'LINESTRING (2 2, 5 6)'::geometry)) AS tbl2;

 column1 | column1 | left
---------+---------+------
	   1 |       2 | f
	   1 |       3 | t
	   1 |       4 | t
(3 rows)</pre></div><div class="refsection" title="関連情報"><a name="id287040261"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Geometry_Right" title="&gt;&gt;">&gt;&gt;</a>, <a class="xref" href="#ST_Geometry_Above" title="|&gt;&gt;">|&gt;&gt;</a>, <a class="xref" href="#ST_Geometry_Below" title="&lt;&lt;|">&lt;&lt;|</a></p></div></div><div class="refentry" title="&lt;&lt;|"><div class="refentry.separator"><hr></div><a name="ST_Geometry_Below"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>&lt;&lt;| ? Aのバウンダリボックスが、厳密にBのバウンダリボックスの下にある場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">&lt;&lt;|</b>(</code>
				  geometry 

				  <var class="pdparam">A</var>
				, 
				  geometry 

				  <var class="pdparam">B</var>
				<code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287040336"></a><h2>説明</h2><p><code class="varname">&lt;&lt;|</code>演算子は、Aのバウンダリボックスが、厳密にBのバウンダリボックスの下にある場合に<code class="varname">TRUE</code>を返します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この演算子はジオメトリで利用できるインデクスを使用します。</p></td></tr></table></div></div><div class="refsection" title="例"><a name="id287040356"></a><h2>例</h2><pre class="programlisting">SELECT tbl1.column1, tbl2.column1, tbl1.column2 &lt;&lt;| tbl2.column2 AS below
FROM
  ( VALUES
	(1, 'LINESTRING (0 0, 4 3)'::geometry)) AS tbl1,
  ( VALUES
	(2, 'LINESTRING (1 4, 1 7)'::geometry),
	(3, 'LINESTRING (6 1, 6 5)'::geometry),
	(4, 'LINESTRING (2 3, 5 6)'::geometry)) AS tbl2;

 column1 | column1 | below
---------+---------+-------
	   1 |       2 | t
	   1 |       3 | f
	   1 |       4 | f
(3 rows)</pre></div><div class="refsection" title="関連情報"><a name="id287040366"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Geometry_Left" title="&lt;&lt;">&lt;&lt;</a>, <a class="xref" href="#ST_Geometry_Right" title="&gt;&gt;">&gt;&gt;</a>, <a class="xref" href="#ST_Geometry_Above" title="|&gt;&gt;">|&gt;&gt;</a></p></div></div><div class="refentry" title="="><div class="refentry.separator"><hr></div><a name="ST_Geometry_EQ"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>= ? Aのバウンダリボックスが、Bのバウンダリボックスと同じ場合に<code class="varname">TRUE</code>を返します。バウンディングボックスには倍精度浮動小数点数を使います。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">=</b>(</code>
				  geometry 

				  <var class="pdparam">A</var>
				, 
				  geometry 

				  <var class="pdparam">B</var>
				<code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">=</b>(</code>
					  geography 
	
					  <var class="pdparam">A</var>
					, 
					  geography 
	
					  <var class="pdparam">B</var>
					<code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287040473"></a><h2>説明</h2><p><code class="varname">=</code>演算子は、ジオメトリ/ジオグラフィAのバウンダリボックスが、Bのバウンダリボックスと同じ場合に<code class="varname">TRUE</code>を返します。PostgreSQLは、ジオメトリが内部の並べ替えの実行やジオメトリの比較を行うために定義した=, &lt;, &gt;演算子を使います(GROUP BYやORDER BY節)。</p><div class="warning" title="警告" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これは多数の混乱の元です。geometryA = geometryBの比較を行うと、ジオメトリが明確に異なっていたとしても、バウンディングボックスが同じならTRUEが返ります。本当の等価性をチェックするには<a class="xref" href="#ST_OrderingEquals" title="ST_OrderingEquals">ST_OrderingEquals</a>または<a class="xref" href="#ST_Equals" title="ST_Equals">ST_Equals</a>を使います。</p></td></tr></table></div><div class="caution" title="注意" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Caution"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注意]" src="images/caution.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この演算子はジオメトリで使用できるインデクスを*使いません*。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は多面体サーフェスに対応しています。</p><p>変更: 2.0.0では、
ジオメトリのバウンディングボックスをfloat4使用から倍精度使用に変更しました。ほんの少し違う位置にある特定のポイントについて、float4でのバウンディングボックスなら同じになるのにfloat8(倍精度)でのバウンディングボックスでは異なるため、以前の版ではtrueが返ったのが2.0以上ではfalseが返る、という副作用があります。</p></div><div class="refsection" title="例"><a name="id287040565"></a><h2>例</h2><pre class="programlisting">SELECT 'LINESTRING(0 0, 0 1, 1 0)'::geometry = 'LINESTRING(1 1, 0 0)'::geometry;
 ?column?
----------
 t
(1 row)

SELECT ST_AsText(column1)
FROM ( VALUES
	('LINESTRING(0 0, 1 1)'::geometry),
	('LINESTRING(1 1, 0 0)'::geometry)) AS foo;
	  st_astext
---------------------
 LINESTRING(0 0,1 1)
 LINESTRING(1 1,0 0)
(2 rows)

-- Note: the GROUP BY uses the "=" to compare for geometry equivalency.
SELECT ST_AsText(column1)
FROM ( VALUES
	('LINESTRING(0 0, 1 1)'::geometry),
	('LINESTRING(1 1, 0 0)'::geometry)) AS foo
GROUP BY column1;
	  st_astext
---------------------
 LINESTRING(0 0,1 1)
(1 row)

-- In versions prior to 2.0, this used to return true --
 SELECT ST_GeomFromText('POINT(1707296.37 4820536.77)') =
	ST_GeomFromText('POINT(1707296.27 4820536.87)') As pt_intersect;
	
--pt_intersect --
f
</pre></div><div class="refsection" title="関連情報"><a name="id287040576"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Equals" title="ST_Equals">ST_Equals</a>, <a class="xref" href="#ST_OrderingEquals" title="ST_OrderingEquals">ST_OrderingEquals</a>
			</p></div></div><div class="refentry" title="&gt;&gt;"><div class="refentry.separator"><hr></div><a name="ST_Geometry_Right"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>&gt;&gt; ? Aのバウンダリボックスが、厳密にBのバウンダリボックスの右にある場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">&gt;&gt;</b>(</code>
				  geometry 

				  <var class="pdparam">A</var>
				, 
				  geometry 

				  <var class="pdparam">B</var>
				<code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287037031"></a><h2>説明</h2><p><code class="varname">&gt;&gt;</code>演算子は、Aのバウンダリボックスが、厳密にBのバウンダリボックスの右にある場合に<code class="varname">TRUE</code>を返します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この演算子はジオメトリで利用できるインデクスを使用します。</p></td></tr></table></div></div><div class="refsection" title="例"><a name="id287037051"></a><h2>例</h2><pre class="programlisting">SELECT tbl1.column1, tbl2.column1, tbl1.column2 &gt;&gt; tbl2.column2 AS right
FROM
  ( VALUES
	(1, 'LINESTRING (2 3, 5 6)'::geometry)) AS tbl1,
  ( VALUES
	(2, 'LINESTRING (1 4, 1 7)'::geometry),
	(3, 'LINESTRING (6 1, 6 5)'::geometry),
	(4, 'LINESTRING (0 0, 4 3)'::geometry)) AS tbl2;

 column1 | column1 | right
---------+---------+-------
	   1 |       2 | t
	   1 |       3 | f
	   1 |       4 | f
(3 rows)</pre></div><div class="refsection" title="関連情報"><a name="id287037062"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Geometry_Left" title="&lt;&lt;">&lt;&lt;</a>, <a class="xref" href="#ST_Geometry_Above" title="|&gt;&gt;">|&gt;&gt;</a>, <a class="xref" href="#ST_Geometry_Below" title="&lt;&lt;|">&lt;&lt;|</a></p></div></div><div class="refentry" title="@"><div class="refentry.separator"><hr></div><a name="ST_Geometry_Contained"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>@ ? AのバウンダリボックスがBのバウンダリボックスに含まれている場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">@</b>(</code>
				  geometry 

				  <var class="pdparam">A</var>
				, 
				  geometry 

				  <var class="pdparam">B</var>
				<code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287037138"></a><h2>説明</h2><p><code class="varname">@</code>演算子は、AのバウンダリボックスがBのバウンダリボックスに、完全に含まれている場合に<code class="varname">TRUE</code>を返します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この演算子はジオメトリで利用できるインデクスを使用します。</p></td></tr></table></div></div><div class="refsection" title="例"><a name="id287037160"></a><h2>例</h2><pre class="programlisting">SELECT tbl1.column1, tbl2.column1, tbl1.column2 @ tbl2.column2 AS contained
FROM
  ( VALUES
	(1, 'LINESTRING (1 1, 3 3)'::geometry)) AS tbl1,
  ( VALUES
	(2, 'LINESTRING (0 0, 4 4)'::geometry),
	(3, 'LINESTRING (2 2, 4 4)'::geometry),
	(4, 'LINESTRING (1 1, 3 3)'::geometry)) AS tbl2;

 column1 | column1 | contained
---------+---------+-----------
	   1 |       2 | t
	   1 |       3 | f
	   1 |       4 | t
(3 rows)</pre></div><div class="refsection" title="関連情報"><a name="id287037171"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Geometry_Contain" title="~">~</a>, <a class="xref" href="#geometry_overlaps" title="&amp;&amp;">&amp;&amp;</a></p></div></div><div class="refentry" title="|&amp;&gt;"><div class="refentry.separator"><hr></div><a name="ST_Geometry_Overabove"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>|&amp;&gt; ? AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの上にある場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">|&amp;&gt;</b>(</code>
				  geometry 

				  <var class="pdparam">A</var>
				, 
				  geometry 

				  <var class="pdparam">B</var>
				<code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287037481"></a><h2>説明</h2><p><code class="varname">|&amp;&gt;</code>演算子は、AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの上にある場合に<code class="varname">TRUE</code>を返します。条件についてより詳細に言うと、BのバウンディングボックスをオーバラップするかBのバウンディングボックスの下に*ない*場合です。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この演算子はジオメトリで利用できるインデクスを使用します。</p></td></tr></table></div></div><div class="refsection" title="例"><a name="id287037500"></a><h2>例</h2><pre class="programlisting">SELECT tbl1.column1, tbl2.column1, tbl1.column2 |&amp;&gt; tbl2.column2 AS overabove
FROM
  ( VALUES
	(1, 'LINESTRING(6 0, 6 4)'::geometry)) AS tbl1,
  ( VALUES
	(2, 'LINESTRING(0 0, 3 3)'::geometry),
	(3, 'LINESTRING(0 1, 0 5)'::geometry),
	(4, 'LINESTRING(1 2, 4 6)'::geometry)) AS tbl2;

 column1 | column1 | overabove
---------+---------+-----------
	   1 |       2 | t
	   1 |       3 | f
	   1 |       4 | f
(3 rows)</pre></div><div class="refsection" title="関連情報"><a name="id287037512"></a><h2>関連情報</h2><p>
				<a class="xref" href="#geometry_overlaps" title="&amp;&amp;">&amp;&amp;</a>,
				<a class="xref" href="#ST_Geometry_Overright" title="&amp;&gt;">&amp;&gt;</a>,
				<a class="xref" href="#ST_Geometry_Overbelow" title="&amp;&lt;|">&amp;&lt;|</a>,
				<a class="xref" href="#ST_Geometry_Overleft" title="&amp;&lt;">&amp;&lt;</a></p></div></div><div class="refentry" title="|&gt;&gt;"><div class="refentry.separator"><hr></div><a name="ST_Geometry_Above"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>|&gt;&gt; ? Aのバウンダリボックスが、厳密にBのバウンダリボックスの上にある場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">|&gt;&gt;</b>(</code>
				  geometry 

				  <var class="pdparam">A</var>
				, 
				  geometry 

				  <var class="pdparam">B</var>
				<code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287037591"></a><h2>説明</h2><p><code class="varname">|&gt;&gt;</code>演算子は、Aのバウンダリボックスが、厳密にBのバウンダリボックスの上にある場合に<code class="varname">TRUE</code>を返します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この演算子はジオメトリで利用できるインデクスを使用します。</p></td></tr></table></div></div><div class="refsection" title="例"><a name="id287037611"></a><h2>例</h2><pre class="programlisting">SELECT tbl1.column1, tbl2.column1, tbl1.column2 |&gt;&gt; tbl2.column2 AS above
FROM
  ( VALUES
	(1, 'LINESTRING (1 4, 1 7)'::geometry)) AS tbl1,
  ( VALUES
	(2, 'LINESTRING (0 0, 4 2)'::geometry),
	(3, 'LINESTRING (6 1, 6 5)'::geometry),
	(4, 'LINESTRING (2 3, 5 6)'::geometry)) AS tbl2;

 column1 | column1 | above
---------+---------+-------
	   1 |       2 | t
	   1 |       3 | f
	   1 |       4 | f
(3 rows)</pre></div><div class="refsection" title="関連情報"><a name="id287037622"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Geometry_Left" title="&lt;&lt;">&lt;&lt;</a>, <a class="xref" href="#ST_Geometry_Right" title="&gt;&gt;">&gt;&gt;</a>, <a class="xref" href="#ST_Geometry_Below" title="&lt;&lt;|">&lt;&lt;|</a></p></div></div><div class="refentry" title="~"><div class="refentry.separator"><hr></div><a name="ST_Geometry_Contain"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>~ ? AのバウンディングボックスがBのバウンディングボックスを含む場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">~</b>(</code>
				  geometry 

				  <var class="pdparam">A</var>
				, 
				  geometry 

				  <var class="pdparam">B</var>
				<code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287037731"></a><h2>説明</h2><p><code class="varname">~</code>演算子は、AのバウンディングボックスがBのバウンディングボックスを、完全に含む場合に<code class="varname">TRUE</code>を返します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この演算子はジオメトリで利用できるインデクスを使用します。</p></td></tr></table></div></div><div class="refsection" title="例"><a name="id287037752"></a><h2>例</h2><pre class="programlisting">SELECT tbl1.column1, tbl2.column1, tbl1.column2 ~ tbl2.column2 AS contains
FROM
  ( VALUES
	(1, 'LINESTRING (0 0, 3 3)'::geometry)) AS tbl1,
  ( VALUES
	(2, 'LINESTRING (0 0, 4 4)'::geometry),
	(3, 'LINESTRING (1 1, 2 2)'::geometry),
	(4, 'LINESTRING (0 0, 3 3)'::geometry)) AS tbl2;

 column1 | column1 | contains
---------+---------+----------
	   1 |       2 | f
	   1 |       3 | t
	   1 |       4 | t
(3 rows)</pre></div><div class="refsection" title="関連情報"><a name="id287037763"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Geometry_Contained" title="@">@</a>, <a class="xref" href="#geometry_overlaps" title="&amp;&amp;">&amp;&amp;</a></p></div></div><div class="refentry" title="~="><div class="refentry.separator"><hr></div><a name="ST_Geometry_Same"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>~= ? AのバウンディングボックスがBのバウンディングボックスと同じ場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">~=</b>(</code>
				  geometry 

				  <var class="pdparam">A</var>
				, 
				  geometry 

				  <var class="pdparam">B</var>
				<code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287037868"></a><h2>説明</h2><p><code class="varname">~=</code>演算子はジオメトリ/ジオグラフィAのバウンディングボックスがジオメトリ/ジオグラフィBのバウンディングボックスと同じ場合に<code class="varname">TRUE</code>を返します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この演算子はジオメトリで利用できるインデクスを使用します。</p></td></tr></table></div><p>初出: 1.5.0では、挙動を変更しました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は多面体サーフェスに対応しています。</p><div class="warning" title="警告" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この演算子のふるまいはPostGIS 1.5で、実際のジオメトリとしての等価性のテストから、バウンディングボックスの等価性のテストに変更されました。ハードアップグレードまたはソフトアップグレードを実行している場合は、データベースがどの挙動を持つかに動作が依存して、ややこしくなります。データベースがどの挙動を持つか判断するために、下のクエリを実行することができます。本当の等価性をチェックするには、<a class="xref" href="#ST_OrderingEquals" title="ST_OrderingEquals">ST_OrderingEquals</a>または<a class="xref" href="#ST_Equals" title="ST_Equals">ST_Equals</a>が、安全な選択肢です。</p></td></tr></table></div></div><div class="refsection" title="例"><a name="id287037915"></a><h2>例</h2><pre class="programlisting">

select 'LINESTRING(0 0, 1 1)'::geometry ~= 'LINESTRING(0 1, 1 0)'::geometry as equality;
 equality   |
-----------------+
          t    |
 			</pre><p>上の例は、~=の新しい挙動でも古い挙動でも使えます。</p></div><div class="refsection" title="関連情報"><a name="id287037930"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Equals" title="ST_Equals">ST_Equals</a>, <a class="xref" href="#ST_OrderingEquals" title="ST_OrderingEquals">ST_OrderingEquals</a>, <a class="xref" href="#ST_Geometry_EQ" title="=">=</a></p></div></div><div class="refentry" title="&lt;-&gt;"><div class="refentry.separator"><hr></div><a name="geometry_distance_centroid"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>&lt;-&gt; ? 
2つのポイントの間の距離を返します。ポイントでは、ポイントは単精度(元となるポイントジオメトリが倍精度ですが)を使って調べます。他のジオメトリタイプでは、バウンディングボックスの重心どうしの距離を返します。KNN GiST機能を使った距離による並べ替えや近傍の制限に使います。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">double precision <b class="fsfunc">&lt;-&gt;</b>(</code>
				  geometry 

				  <var class="pdparam">A</var>
				, 
				  geometry 

				  <var class="pdparam">B</var>
				<code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287038000"></a><h2>説明</h2><p>
<code class="varname">&lt;-&gt;</code>演算子はポイント(単精度)の空間インデクスから読まれた2ポイント間の距離を返します。他のジオメトリについては、ジオメトリのバウンディングボックスの重心からの距離を返します。近傍の<span class="strong"><strong>概ねの</strong></span>距離による並べ替えに使います。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この演算子はジオメトリで利用できるインデクスを使用します。他の演算子との相違点は、ORDER BY節でのみインデクスが使用される点です。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ジオメトリのひとつが定数(副問い合わせ/共通テーブル式にない)となる(a.geomでなく'SRID=3005;POINT(1011102 450541)'::geometry等となる)場合には、インデクスが有効になるだけです。</p></td></tr></table></div><p>初出: 2.0.0 PostgreSQL 9.1以上でのみ有効です。</p></div><div class="refsection" title="例"><a name="id287038028"></a><h2>例</h2><pre class="programlisting">SELECT ST_Distance(geom, 'SRID=3005;POINT(1011102 450541)'::geometry) as d,edabbr, vaabbr 
FROM va2005 
ORDER BY d limit 10;

        d         | edabbr | vaabbr
------------------+--------+--------
                0 | ALQ    | 128
 5541.57712511724 | ALQ    | 129A
 5579.67450712005 | ALQ    | 001
  6083.4207708641 | ALQ    | 131
  7691.2205404848 | ALQ    | 003
 7900.75451037313 | ALQ    | 122
 8694.20710669982 | ALQ    | 129B
 9564.24289057111 | ALQ    | 130
  12089.665931705 | ALQ    | 127
 18472.5531479404 | ALQ    | 002
(10 rows)
</pre><p>
KNNの答えは次のようになります。
</p><pre class="programlisting">SELECT st_distance(geom, 'SRID=3005;POINT(1011102 450541)'::geometry) as d,edabbr, vaabbr 
FROM va2005 
ORDER BY geom &lt;-&gt; 'SRID=3005;POINT(1011102 450541)'::geometry limit 10;

        d         | edabbr | vaabbr
------------------+--------+--------
                0 | ALQ    | 128
 5579.67450712005 | ALQ    | 001
 5541.57712511724 | ALQ    | 129A
 8694.20710669982 | ALQ    | 129B
 9564.24289057111 | ALQ    | 130
  6083.4207708641 | ALQ    | 131
  12089.665931705 | ALQ    | 127
  24795.264503022 | ALQ    | 124
 24587.6584922302 | ALQ    | 123
 26764.2555463114 | ALQ    | 125
(10 rows)
</pre><p>実際の距離との順序が違い、実際に表示される上位10行が違うことに注意して下さい。</p><p>最終的なハイブリッドのクエリは次の通りです。</p><pre class="programlisting">WITH index_query AS (
  SELECT ST_Distance(geom, 'SRID=3005;POINT(1011102 450541)'::geometry) as d,edabbr, vaabbr
  	FROM va2005
  ORDER BY geom &lt;-&gt; 'SRID=3005;POINT(1011102 450541)'::geometry LIMIT 100) 
  SELECT * 
  	FROM index_query 
  ORDER BY d limit 10;

        d         | edabbr | vaabbr
------------------+--------+--------
                0 | ALQ    | 128
 5541.57712511724 | ALQ    | 129A
 5579.67450712005 | ALQ    | 001
  6083.4207708641 | ALQ    | 131
  7691.2205404848 | ALQ    | 003
 7900.75451037313 | ALQ    | 122
 8694.20710669982 | ALQ    | 129B
 9564.24289057111 | ALQ    | 130
  12089.665931705 | ALQ    | 127
 18472.5531479404 | ALQ    | 002
(10 rows)

 			</pre></div><div class="refsection" title="関連情報"><a name="id287038059"></a><h2>関連情報</h2><p><a class="xref" href="#ST_DWithin" title="ST_DWithin">ST_DWithin</a>, <a class="xref" href="#ST_Distance" title="ST_Distance">ST_Distance</a>, <a class="xref" href="#geometry_distance_box" title="&lt;#&gt;">&lt;#&gt;</a></p></div></div><div class="refentry" title="&lt;#&gt;"><div class="refentry.separator"><hr></div><a name="geometry_distance_box"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>&lt;#&gt; ? 2ジオメトリのバウンディングボックス間の距離を返します。ポイントの場合は、距離とほとんど同じ(バウンディングボックスは単精度であり、ジオメトリは倍精度なので異なる)かを調べます。KNN GiST機能を使った距離による並べ替えと近傍の制限とに使います。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">double precision <b class="fsfunc">&lt;#&gt;</b>(</code>
				  geometry 

				  <var class="pdparam">A</var>
				, 
				  geometry 

				  <var class="pdparam">B</var>
				<code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287038129"></a><h2>説明</h2><p>

KNN GiST 演算子 <code class="varname">&lt;#&gt;</code> は、空間インデクスが有効な場合に、2つの浮動小数点数による、空間インデクスから読まれるバウンディングボックス間の距離を返します。近傍の<span class="strong"><strong>概ねの</strong></span>距離による並び替えに使います。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この演算子はジオメトリで利用できるインデクスを使用します。他の演算子との相違点は、ORDER BY節でのみインデクスが使用される点です。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ジオメトリのひとつが定数となる(g1.geom &lt;#&gt;でなくORDER BY (ST_GeomFromText('POINT(1 2)') &lt;#&gt; geom)等となる)場合には、インデクスが有効になるだけです。</p></td></tr></table></div><p>初出: 2.0.0 PostgreSQL 9.1以上でのみ有効です。</p></div><div class="refsection" title="例"><a name="id287038157"></a><h2>例</h2><pre class="programlisting">SELECT *
FROM (
SELECT b.tlid, b.mtfcc, 
	b.geom &lt;#&gt; ST_GeomFromText('LINESTRING(746149 2948672,745954 2948576,
		745787 2948499,745740 2948468,745712 2948438,
		745690 2948384,745677 2948319)',2249) As b_dist, 
		ST_Distance(b.geom, ST_GeomFromText('LINESTRING(746149 2948672,745954 2948576,
		745787 2948499,745740 2948468,745712 2948438,
		745690 2948384,745677 2948319)',2249)) As act_dist
    FROM bos_roads As b 
    ORDER BY b_dist, b.tlid
    LIMIT 100) As foo
    ORDER BY act_dist, tlid LIMIT 10;

   tlid    | mtfcc |      b_dist      |     act_dist
-----------+-------+------------------+------------------
  85732027 | S1400 |                0 |                0
  85732029 | S1400 |                0 |                0
  85732031 | S1400 |                0 |                0
  85734335 | S1400 |                0 |                0
  85736037 | S1400 |                0 |                0
 624683742 | S1400 |                0 | 128.528874268666
  85719343 | S1400 | 260.839270432962 | 260.839270432962
  85741826 | S1400 | 164.759294123275 | 260.839270432962
  85732032 | S1400 |           277.75 | 311.830282365264
  85735592 | S1400 |           222.25 | 311.830282365264
(10 rows)
</pre></div><div class="refsection" title="関連情報"><a name="id287038168"></a><h2>関連情報</h2><p><a class="xref" href="#ST_DWithin" title="ST_DWithin">ST_DWithin</a>, <a class="xref" href="#ST_Distance" title="ST_Distance">ST_Distance</a>, <a class="xref" href="#geometry_distance_centroid" title="&lt;-&gt;">&lt;-&gt;</a></p></div></div></div><div class="sect1" title="8.8. 空間関係関数と空間計測関数"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Spatial_Relationships_Measurements"></a>8.8. 空間関係関数と空間計測関数 </h2></div></div></div><div class="toc"><dl><dt><span class="refentrytitle"><a href="#ST_3DClosestPoint">ST_3DClosestPoint</a></span><span class="refpurpose"> ? g1上の、g2に最も近い3次元ポイントを返します。3次元最短線のひとつめのポイントです。</span></dt><dt><span class="refentrytitle"><a href="#ST_3DDistance">ST_3DDistance</a></span><span class="refpurpose"> ? ジオメトリ型について、2つのジオメトリの、3次元の最小デカルト距離(空間参照系に基づきます)を、投影法の単位で返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_3DDWithin">ST_3DDWithin</a></span><span class="refpurpose"> ? 3次元(XYZ)ジオメトリ型について、2つのジオメトリの3次元距離が指定した数の内にある場合にtrueを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_3DDFullyWithin">ST_3DDFullyWithin</a></span><span class="refpurpose"> ? 3次元ジオメトリが他のジオメトリとの距離が指定した範囲内ならtrueを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_3DIntersects">ST_3DIntersects</a></span><span class="refpurpose"> ? ジオメトリが3次元で「空間的にインタセクトする」場合にTRUEを返します。ポイントとラインストリングのみで動作します。</span></dt><dt><span class="refentrytitle"><a href="#ST_3DLongestLine">ST_3DLongestLine</a></span><span class="refpurpose"> ? 2つのジオメトリの3次元長が最長となるラインを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_3DMaxDistance">ST_3DMaxDistance</a></span><span class="refpurpose"> ? ジオメトリ型について、2つのジオメトリの、3次元の最大デカルト距離(空間参照系に基づきます)を、投影法の単位で返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_3DShortestLine">ST_3DShortestLine</a></span><span class="refpurpose"> ? 2つのジオメトリの3次元長が最短となるラインを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Area">ST_Area</a></span><span class="refpurpose"> ? ポリゴンまたはマルチポリゴンの場合にはサーフェスの面積を返します。ジオメトリ型の「面積」はSRIDに基づく単位で、ジオグラフィ型の面積は平方メートルです。</span></dt><dt><span class="refentrytitle"><a href="#ST_Azimuth">ST_Azimuth</a></span><span class="refpurpose"> ? pointAとPointBで定義されるベクタの、水平面での方位をラジアン単位で返します。方位は時計回りで、前半は下向き方向で後半は上向き方向になります。時計でいうと12=0; 3=PI/2; 6=PI; 9=3PI/4となります。</span></dt><dt><span class="refentrytitle"><a href="#ST_Centroid">ST_Centroid</a></span><span class="refpurpose"> ? ジオメトリの幾何学的重心を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_ClosestPoint">ST_ClosestPoint</a></span><span class="refpurpose"> ? g1上の、g2に最も近い3次元ポイントを返します。2次元最短線のひとつめのポイントです。</span></dt><dt><span class="refentrytitle"><a href="#ST_Contains">ST_Contains</a></span><span class="refpurpose"> ? BのポイントがAの外部に無く、かつBの内部の少なくとも1つの点がAの内部にある場合に限って、TRUEを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_ContainsProperly">ST_ContainsProperly</a></span><span class="refpurpose"> ? BがAの内部にインタセクトするが境界(または外部)にインタセクトしない場合に、TRUEを返します。Aは自身には、ContainsProperlyではありませんが、Containsです。</span></dt><dt><span class="refentrytitle"><a href="#ST_Covers">ST_Covers</a></span><span class="refpurpose"> ? ジオメトリBにジオメトリAの外となるポイントが無い場合には、1(TRUE)を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_CoveredBy">ST_CoveredBy</a></span><span class="refpurpose"> ? オメトリ/ジオグラフィAの点がジオメトリ/ジオグラフィBの外に無い場合に、1(TRUE)を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Crosses">ST_Crosses</a></span><span class="refpurpose"> ? 与えられたジオメトリが共通の内部の点を持ち、かつそうでない点を持つ場合に、<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_LineCrossingDirection">ST_LineCrossingDirection</a></span><span class="refpurpose"> ? 2つのラインストリングが与えられ、クロスの種類を-3から3の区間の数で返します。0の場合はクロスしていません。</span></dt><dt><span class="refentrytitle"><a href="#ST_Disjoint">ST_Disjoint</a></span><span class="refpurpose"> ? ジオメトリが「空間的にインタセクトしていない」すなわち、空間を共有ししていない場合に、TRUEを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Distance">ST_Distance</a></span><span class="refpurpose"> ? ジオメトリ型については、2つのジオメトリの、2次元の最小デカルト距離(空間参照系に基づきます)を、投影法の単位で返します。ジオグラフィ型については、デフォルトでは、2つのジオメトリ間の回転楕円体上の最小距離をメートル単位で返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_HausdorffDistance">ST_HausdorffDistance</a></span><span class="refpurpose"> ? 2つのジオメトリ間のハウスドルフ距離を返します。基本的にジオメトリが似ているかどうかを計測するものです。単位はジオメトリの空間参照系の単位です。</span></dt><dt><span class="refentrytitle"><a href="#ST_MaxDistance">ST_MaxDistance</a></span><span class="refpurpose"> ? 2つのジオメトリ間の2次元距離の最大値を、投影法の単位で返します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_Distance_Sphere">ST_Distance_Sphere</a></span><span class="refpurpose"> ? 2つの経度緯度ジオメトリ間の最小距離をメートル単位で返します。半径6370986メートルの球面を用います。xref linkend="ST_Distance_Spheroid" /&gt;より早いですが精度が低くなります。PostGIS 1.5より前では、ポイントについてのみ実装されていました。</span></dt><dt><span class="refentrytitle"><a href="#ST_Distance_Spheroid">ST_Distance_Spheroid</a></span><span class="refpurpose"> ? 指定した回転楕円体による、2つのジオメトリ間の最小距離を返します。PostGIS 1.5より前ではポイントのみサポートされていました。</span></dt><dt><span class="refentrytitle"><a href="#ST_DFullyWithin">ST_DFullyWithin</a></span><span class="refpurpose"> ? 全てのジオメトリが、指定したジオメトリから指定した距離内にある場合に、TRUEを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_DWithin">ST_DWithin</a></span><span class="refpurpose"> ? ジオメトリが、指定したジオメトリから指定した距離内にある場合に、TRUEを返します。ジオメトリについては、距離は空間参照系で定義されている単位になります。ジオグラフィについては、メートル単位で、デフォルトではuse_spheroid=true(回転楕円体を使った計算)となり、速いチェックをするにはuse_spheroid=falseとして球面を使って計算します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Equals">ST_Equals</a></span><span class="refpurpose"> ? 与えられたジオメトリ表現が同じ場合にはTRUEを返します。方向は無視されます。</span></dt><dt><span class="refentrytitle"><a href="#ST_HasArc">ST_HasArc</a></span><span class="refpurpose"> ? ジオメトリまたはジオメトリコレクションが曲線ストリングを含む場合に、TRUEを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Intersects">ST_Intersects</a></span><span class="refpurpose"> ? ジオメトリ/ジオグラフィが「2次元空間で空間的にインタセクトする」(空間に共有部分がある)場合には、TRUEを返します。そうでない(非接続)場合はFALSEを返します。ジオグラフィについては、許容量は0.00001メートルです(どの閉じた点でもインタセクトを考慮されます)。
			</span></dt><dt><span class="refentrytitle"><a href="#ST_Length">ST_Length</a></span><span class="refpurpose"> ? LINESTRINGまたはMULTILINESTRINGの場合に、ジオメトリの2次元長を返します。ジオメトリでは、単位は空間参照系の単位です。ジオグラフィでは、メートル単位です(回転楕円体がデフォルトです)。</span></dt><dt><span class="refentrytitle"><a href="#ST_Length2D">ST_Length2D</a></span><span class="refpurpose"> ? LINESTRINGまたはMULTILINESTRINGに対して、ジオメトリの2次元長を返します。これは<code class="varname">ST_Length</code>の別名です。</span></dt><dt><span class="refentrytitle"><a href="#ST_3DLength">ST_3DLength</a></span><span class="refpurpose"> ? LINESTRINGまたはMULTILINESTRINGに対して、ジオメトリの3次元長または2次元長を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Length_Spheroid">ST_Length_Spheroid</a></span><span class="refpurpose"> ? LINESTRINGまたはMULTILINESTRINGに対して、回転楕円体上の2次元長または3次元長を返します。ジオメトリの座標が経度/緯度で、投影変換なしに距離を求める場合に使います。</span></dt><dt><span class="refentrytitle"><a href="#ST_Length2D_Spheroid">ST_Length2D_Spheroid</a></span><span class="refpurpose"> ? LINESTRINGまたはMULTILINESTRINGに対して、回転楕円体上の2次元長を返します。ジオメトリの座標が経度/緯度で、投影変換なしに距離を求める場合に使います。</span></dt><dt><span class="refentrytitle"><a href="#ST_3DLength_Spheroid">ST_3DLength_Spheroid</a></span><span class="refpurpose"> ? 標高を考慮に入れて回転楕円体上の長さを計算します。これはST_Length_Spheroidの別名です。</span></dt><dt><span class="refentrytitle"><a href="#ST_LongestLine">ST_LongestLine</a></span><span class="refpurpose"> ? 2つのジオメトリの2次元長が最長となるポイントを返します。見つかった最長線が複数ある場合は、最初のもののみ返します。返されるラインは常にg1側を始点、g2側を終点とします。この関数が返すラインの長さは、常に始点をg1に終点をg2にそれぞれ指定した場合のST_MaxDistanceが返す値と同じになります。</span></dt><dt><span class="refentrytitle"><a href="#ST_OrderingEquals">ST_OrderingEquals</a></span><span class="refpurpose"> ? 与えられたジオメトリが同じジオメトリを示し、ポイントの順序が同じである場合に、TRUEを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Overlaps">ST_Overlaps</a></span><span class="refpurpose"> ? ジオメトリが共有空間を持ち、同じ次元で、かつ完全には一方に含まれていない場合に、TRUEを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Perimeter">ST_Perimeter</a></span><span class="refpurpose"> ? ST_SrrfaceまたはST_MultiSurface(POLYGONまたはMULTIPOLYGON)の境界の長さの計測値を返します。ジオメトリの単位は空間参照系によります。ジオグラフィはメートル単位になります。</span></dt><dt><span class="refentrytitle"><a href="#ST_Perimeter2D">ST_Perimeter2D</a></span><span class="refpurpose"> ? POLYGONまたはMULTIPOLYGONジオメトリの場合に、2次元周囲長を返します。これは、現在はST_Perimeterの別名です。</span></dt><dt><span class="refentrytitle"><a href="#ST_3DPerimeter">ST_3DPerimeter</a></span><span class="refpurpose"> ? POLYGONまたはMULTIPOLYGONジオメトリの場合に、3次元周囲長を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_PointOnSurface">ST_PointOnSurface</a></span><span class="refpurpose"> ? サーフェス上にあることを保障された<code class="varname">POINT</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Project">ST_Project</a></span><span class="refpurpose"> ? 方位と距離を使って始点から算出された<code class="varname">POINT</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Relate">ST_Relate</a></span><span class="refpurpose"> ? intersectionMatrixPatternの値について、2つのジオメトリの内部、境界、外部のインタセクションを見て、指定したジオメトリがもうひとつのジオメトリと空間的に関係している場合に、TRUEを返します。intersectionMatrixPatternが無い場合には、2ジオメトリについての最大のintersectionMatrixPatternを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_RelateMatch">ST_RelateMatch</a></span><span class="refpurpose"> ? intersectionMattrixPattern1がintersectionMatrixPattern2を含む場合にTRUEを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_ShortestLine">ST_ShortestLine</a></span><span class="refpurpose"> ? 2つのジオメトリの2次元長が最短となるラインを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Touches">ST_Touches</a></span><span class="refpurpose"> ? ジオメトリが共通のポイントを少なくとも1つ持ち、内部でインタセクトしない場合に、TRUEを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Within">ST_Within</a></span><span class="refpurpose"> ? ジオメトリAが完全にジオメトリBの内側にある場合にTRUEを返します。</span></dt></dl></div><div class="refentry" title="ST_3DClosestPoint"><a name="ST_3DClosestPoint"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_3DClosestPoint ? g1上の、g2に最も近い3次元ポイントを返します。3次元最短線のひとつめのポイントです。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_3DClosestPoint</b>(</code>geometry 
				<var class="pdparam">g1</var>, geometry 
				<var class="pdparam">g2</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287044390"></a><h2>説明</h2><p>g1上の、g2に最も近い3次元ポイントを返します。3次元最短線のひとつめのポイントです。3次元最短線の長さは、3次元距離とは同じになです。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は多面体サーフェスに対応しています。</p><p>初出: 2.0.0</p></div><div class="refsection" title="例"><a name="id287044429"></a><h2>例</h2><div class="informaltable"><table border="1"><colgroup><col></colgroup><tbody><tr><td><p>ラインストリングとポイント -- 3次元と2次元の両方の最も近いポイント
					</p><pre class="programlisting">
SELECT ST_AsEWKT(ST_3DClosestPoint(line,pt)) AS cp3d_line_pt, 
		ST_AsEWKT(ST_ClosestPoint(line,pt)) As cp2d_line_pt
	FROM (SELECT 'POINT(100 100 30)'::geometry As pt, 
			'LINESTRING (20 80 20, 98 190 1, 110 180 3, 50 75 1000)'::geometry As line
		) As foo;
	
		
 cp3d_line_pt                        						|               cp2d_line_pt
-----------------------------------------------------------+------------------------------------------
 POINT(54.6993798867619 128.935022917228 11.5475869506606) | POINT(73.0769230769231 115.384615384615)
					</pre><p>
							  </p></td></tr><tr><td><p>ラインストリングとマルチポイント -- 3次元と2次元の両方の最も近いポイント
					</p><pre class="programlisting">SELECT ST_AsEWKT(ST_3DClosestPoint(line,pt)) AS cp3d_line_pt, 
		ST_AsEWKT(ST_ClosestPoint(line,pt)) As cp2d_line_pt
	FROM (SELECT 'MULTIPOINT(100 100 30, 50 74 1000)'::geometry As pt, 
			'LINESTRING (20 80 20, 98 190 1, 110 180 3, 50 75 900)'::geometry As line
		) As foo;
	
		
                       cp3d_line_pt                        | cp2d_line_pt
-----------------------------------------------------------+--------------
 POINT(54.6993798867619 128.935022917228 11.5475869506606) | POINT(50 75)
					</pre><p>
							  </p></td></tr><tr><td><p>Multilinestring and polygon both 3d and 2d closest point
					</p><pre class="programlisting">SELECT ST_AsEWKT(ST_3DClosestPoint(poly, mline)) As cp3d,
    ST_AsEWKT(ST_ClosestPoint(poly, mline)) As cp2d 
        FROM (SELECT  ST_GeomFromEWKT('POLYGON((175 150 5, 20 40 5, 35 45 5, 50 60 5, 100 100 5, 175 150 5))') As poly,
                ST_GeomFromEWKT('MULTILINESTRING((175 155 2, 20 40 20, 50 60 -2, 125 100 1, 175 155 1),
                (1 10 2, 5 20 1))') As mline ) As foo;
                   cp3d                    |     cp2d
-------------------------------------------+--------------
 POINT(39.993580415989 54.1889925532825 5) | POINT(20 40)            
             </pre><p>
							  </p></td></tr></tbody></table></div></div><div class="refsection" title="関連情報"><a name="id287044483"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a>, <a class="xref" href="#ST_ClosestPoint" title="ST_ClosestPoint">ST_ClosestPoint</a>, <a class="xref" href="#ST_3DDistance" title="ST_3DDistance">ST_3DDistance</a>, <a class="xref" href="#ST_3DShortestLine" title="ST_3DShortestLine">ST_3DShortestLine</a></p></div></div><div class="refentry" title="ST_3DDistance"><div class="refentry.separator"><hr></div><a name="ST_3DDistance"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_3DDistance ? ジオメトリ型について、2つのジオメトリの、3次元の最小デカルト距離(空間参照系に基づきます)を、投影法の単位で返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_3DDistance</b>(</code>geometry 
			<var class="pdparam">g1</var>, geometry 
			<var class="pdparam">g2</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287044551"></a><h2>説明</h2><p>ジオメトリ型については、2つのジオメトリの、3次元の最小デカルト距離(空間参照系に基づきます)を、投影法の単位で返します。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は多面体サーフェスに対応しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM ?</p><p>初出: 2.0.0</p></div><div class="refsection" title="例"><a name="id287044602"></a><h2>例</h2><pre class="programlisting">
-- ジオメトリの例 - メートル単位(SRID: 2163 米国ナショナルアトラス正積図法)
-- (3次元ポイントとラインの距離と、2次元ポイントとラインの距離とを比較)
-- ご注意: 現在は垂直データムに対応していないので、
-- Zは変換されずに、最終的に同じであると仮定されます。
SELECT ST_3DDistance(
			ST_Transform(ST_GeomFromEWKT('SRID=4326;POINT(-72.1235 42.3521 4)'),2163),
			ST_Transform(ST_GeomFromEWKT('SRID=4326;LINESTRING(-72.1260 42.45 15, -72.123 42.1546 20)'),2163)
		) As dist_3d,
		ST_Distance(
			ST_Transform(ST_GeomFromText('POINT(-72.1235 42.3521)',4326),2163),
			ST_Transform(ST_GeomFromText('LINESTRING(-72.1260 42.45, -72.123 42.1546)', 4326),2163)
		) As dist_2d;

     dist_3d      |     dist_2d
------------------+-----------------
 127.295059324629 | 126.66425605671
</pre><pre class="programlisting">
-- 3次元2次元両方のマルチラインストリングとポリゴンの距離
-- 3次元最も近い点の例と同じです
SELECT ST_3DDistance(poly, mline) As dist3d,
    ST_Distance(poly, mline) As dist2d 
        FROM (SELECT  ST_GeomFromEWKT('POLYGON((175 150 5, 20 40 5, 35 45 5, 50 60 5, 100 100 5, 175 150 5))') As poly,
                ST_GeomFromEWKT('MULTILINESTRING((175 155 2, 20 40 20, 50 60 -2, 125 100 1, 175 155 1),
                (1 10 2, 5 20 1))') As mline ) As foo;
      dist3d       | dist2d
-------------------+--------
 0.716635696066337 |      0          
</pre></div><div class="refsection" title="関連情報"><a name="id287044618"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Distance" title="ST_Distance">ST_Distance</a>, <a class="xref" href="#ST_3DClosestPoint" title="ST_3DClosestPoint">ST_3DClosestPoint</a>, <a class="xref" href="#ST_3DDWithin" title="ST_3DDWithin">ST_3DDWithin</a>, <a class="xref" href="#ST_3DMaxDistance" title="ST_3DMaxDistance">ST_3DMaxDistance</a>, <a class="xref" href="#ST_3DShortestLine" title="ST_3DShortestLine">ST_3DShortestLine</a>, <a class="xref" href="#ST_Transform" title="ST_Transform">ST_Transform</a></p></div></div><div class="refentry" title="ST_3DDWithin"><div class="refentry.separator"><hr></div><a name="ST_3DDWithin"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_3DDWithin ? 3次元(XYZ)ジオメトリ型について、2つのジオメトリの3次元距離が指定した数の内にある場合にtrueを返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_3DDWithin</b>(</code>geometry 
			<var class="pdparam">g1</var>, geometry 
			<var class="pdparam">g2</var>, double precision 
			<var class="pdparam">distance_of_srid</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287044736"></a><h2>説明</h2><p>ジオメト型について、2つのオブジェクト間の距離が、投影法の単位(空間参照系の単位)でdistance_of_srid内にある場合にtrueを返します。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は多面体サーフェスに対応しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM ?</p><p>初出: 2.0.0</p></div><div class="refsection" title="例"><a name="id287044788"></a><h2>例</h2><pre class="programlisting">
-- ジオメトリの例 - メートル単位(SRID: 2163 米国ナショナルアトラス正積図法)
-- (3次元ポイントとラインの距離と、2次元ポイントとラインの距離とを比較)
-- ご注意: 現在は垂直データムに対応していないので、
-- Zは変換されずに、最終的に同じであると仮定されます。
SELECT ST_3DDWithin(
			ST_Transform(ST_GeomFromEWKT('SRID=4326;POINT(-72.1235 42.3521 4)'),2163),
			ST_Transform(ST_GeomFromEWKT('SRID=4326;LINESTRING(-72.1260 42.45 15, -72.123 42.1546 20)'),2163),
			126.8
		) As within_dist_3d,
ST_DWithin(
			ST_Transform(ST_GeomFromEWKT('SRID=4326;POINT(-72.1235 42.3521 4)'),2163),
			ST_Transform(ST_GeomFromEWKT('SRID=4326;LINESTRING(-72.1260 42.45 15, -72.123 42.1546 20)'),2163),
			126.8
		) As within_dist_2d;

 within_dist_3d | within_dist_2d
----------------+----------------
 f              | t
</pre></div><div class="refsection" title="関連情報"><a name="id287044798"></a><h2>関連情報</h2><p><a class="xref" href="#ST_3DDistance" title="ST_3DDistance">ST_3DDistance</a>, <a class="xref" href="#ST_Distance" title="ST_Distance">ST_Distance</a>, <a class="xref" href="#ST_DWithin" title="ST_DWithin">ST_DWithin</a>, <a class="xref" href="#ST_3DMaxDistance" title="ST_3DMaxDistance">ST_3DMaxDistance</a>, <a class="xref" href="#ST_Transform" title="ST_Transform">ST_Transform</a></p></div></div><div class="refentry" title="ST_3DDFullyWithin"><div class="refentry.separator"><hr></div><a name="ST_3DDFullyWithin"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_3DDFullyWithin ? 3次元ジオメトリが他のジオメトリとの距離が指定した範囲内ならtrueを返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_3DDFullyWithin</b>(</code>geometry 
			<var class="pdparam">g1</var>, geometry 
			<var class="pdparam">g2</var>, double precision 
			<var class="pdparam">distance</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287044878"></a><h2>説明</h2><p>3次元ジオメトリが他のジオメトリとの距離が、完全に指定した範囲内ならtrueを返します。距離の単位はジオメトリの空間参照系で定義されているものとされます。この関数が意味を持つためには、与えられるジオメトリは両方とも同じ座標系で同じSRIDを持つ必要があります。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数の呼び出しによって、ジオメトリで使用可能なインデクスを使用したバウンディングボックスの比較が自動的に行われます。</p></td></tr></table></div><p>初出: 2.0.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は多面体サーフェスに対応しています。</p></div><div class="refsection" title="例"><a name="id287044924"></a><h2>例</h2><pre class="programlisting">
-- これは、完全に範囲内にあるかどうかと範囲内にあるかどうかの比較と、
-- ライン/ポイントの2次元平面への投影で完全に範囲内にあるかどうかと
-- 3次元で完全に範囲内にあるかの比較とを行っています。
		SELECT ST_3DDFullyWithin(geom_a, geom_b, 10) as D3DFullyWithin10, ST_3DDWithin(geom_a, geom_b, 10) as D3DWithin10, 
	ST_DFullyWithin(geom_a, geom_b, 20) as D2DFullyWithin20, 
	ST_3DDFullyWithin(geom_a, geom_b, 20) as D3DFullyWithin20 from 
		(select ST_GeomFromEWKT('POINT(1 1 2)') as geom_a,
		ST_GeomFromEWKT('LINESTRING(1 5 2, 2 7 20, 1 9 100, 14 12 3)') as geom_b) t1;
 d3dfullywithin10 | d3dwithin10 | d2dfullywithin20 | d3dfullywithin20
------------------+-------------+------------------+------------------
 f                | t           | t                | f </pre></div><div class="refsection" title="関連情報"><a name="id287044935"></a><h2>関連情報</h2><p><a class="xref" href="#ST_3DMaxDistance" title="ST_3DMaxDistance">ST_3DMaxDistance</a>, <a class="xref" href="#ST_3DDWithin" title="ST_3DDWithin">ST_3DDWithin</a>, <a class="xref" href="#ST_DWithin" title="ST_DWithin">ST_DWithin</a>, <a class="xref" href="#ST_DFullyWithin" title="ST_DFullyWithin">ST_DFullyWithin</a></p></div></div><div class="refentry" title="ST_3DIntersects"><div class="refentry.separator"><hr></div><a name="ST_3DIntersects"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_3DIntersects ? ジオメトリが3次元で「空間的にインタセクトする」場合にTRUEを返します。ポイントとラインストリングのみで動作します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_3DIntersects</b>(</code>
						geometry
						<var class="pdparam">geomA</var>
					, 
						geometry
						<var class="pdparam">geomB</var>
					<code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287045008"></a><h2>説明</h2><p>オーバラップ、接触、Withinは全て、ジオメトリがインタセクトしていることを意味しています。これらがTRUEを返す場合は、空間的にインタセクトしています。非接続は、空間インタセクトについてFALSEとなります。</p><p>初出: 2.0.0</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数の呼び出しによって、ジオメトリで使用可能なインデクスを使用したバウンディングボックスの比較が自動的に行われます。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は多面体サーフェスに対応しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: ?</p></div><div class="refsection" title="Geometry Examples"><a name="id287045066"></a><h2>Geometry Examples</h2><pre class="programlisting">SELECT ST_3DIntersects(pt, line), ST_Intersects(pt,line) 
	FROM (SELECT 'POINT(0 0 2)'::geometry As pt, 
		'LINESTRING (0 0 1, 0 2 3 )'::geometry As line) As foo;
 st_3dintersects | st_intersects
-----------------+---------------
 f               | t
(1 row)
		</pre></div><div class="refsection" title="関連情報"><a name="id287045077"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Intersects" title="ST_Intersects">ST_Intersects</a></p></div></div><div class="refentry" title="ST_3DLongestLine"><div class="refentry.separator"><hr></div><a name="ST_3DLongestLine"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_3DLongestLine ? 2つのジオメトリの3次元長が最長となるラインを返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_3DLongestLine</b>(</code>geometry 
			<var class="pdparam">g1</var>, geometry 
			<var class="pdparam">g2</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287045136"></a><h2>説明</h2><p>2つのジオメトリの3次元長が最長となるポイントを返します。見つかった最長線が複数ある場合は、最初のもののみ返します。返されるラインは常にg1側を始点、g2側を終点とします。この関数が返すラインの長さは、常に始点をg1に終点をg2にそれぞれ指定した場合の<a class="xref" href="#ST_3DMaxDistance" title="ST_3DMaxDistance">ST_3DMaxDistance</a>が返す値と同じになります。</p><p>初出: 2.0.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は多面体サーフェスに対応しています。</p></div><div class="refsection" title="例"><a name="id287045177"></a><h2>例</h2><div class="informaltable"><table border="1"><colgroup><col></colgroup><tbody><tr><td><p>ラインストリングとポイント -- 3次元と2次元の最長ライン
					</p><pre class="programlisting">
SELECT ST_AsEWKT(ST_3DLongestLine(line,pt)) AS lol3d_line_pt, 
		ST_AsEWKT(ST_LongestLine(line,pt)) As lol2d_line_pt
	FROM (SELECT 'POINT(100 100 30)'::geometry As pt, 
			'LINESTRING (20 80 20, 98 190 1, 110 180 3, 50 75 1000)'::geometry As line
		) As foo;
	
		
           lol3d_line_pt           |       lol2d_line_pt
-----------------------------------+----------------------------
 LINESTRING(50 75 1000,100 100 30) | LINESTRING(98 190,100 100)
					</pre><p>
							  </p></td></tr><tr><td><p>ラインストリングとマルチポイント -- 3次元と2次元の最長ライン
					</p><pre class="programlisting">SELECT ST_AsEWKT(ST_3DLongestLine(line,pt)) AS lol3d_line_pt, 
		ST_AsEWKT(ST_LongestLine(line,pt)) As lol2d_line_pt
	FROM (SELECT 'MULTIPOINT(100 100 30, 50 74 1000)'::geometry As pt, 
			'LINESTRING (20 80 20, 98 190 1, 110 180 3, 50 75 900)'::geometry As line
		) As foo;
	
		
          lol3d_line_pt          |      lol2d_line_pt
---------------------------------+--------------------------
 LINESTRING(98 190 1,50 74 1000) | LINESTRING(98 190,50 74)
					</pre><p>
							  </p></td></tr><tr><td><p>マルチラインストリングとポリゴン -- 3次元と2次元の最長ライン
					</p><pre class="programlisting">SELECT ST_AsEWKT(ST_3DLongestLine(poly, mline)) As lol3d,
    ST_AsEWKT(ST_LongestLine(poly, mline)) As lol2d 
        FROM (SELECT  ST_GeomFromEWKT('POLYGON((175 150 5, 20 40 5, 35 45 5, 50 60 5, 100 100 5, 175 150 5))') As poly,
                ST_GeomFromEWKT('MULTILINESTRING((175 155 2, 20 40 20, 50 60 -2, 125 100 1, 175 155 1),
                (1 10 2, 5 20 1))') As mline ) As foo;
            lol3d             |          lol2d
------------------------------+--------------------------
 LINESTRING(175 150 5,1 10 2) | LINESTRING(175 150,1 10)        
             </pre><p>
							  </p></td></tr></tbody></table></div></div><div class="refsection" title="関連情報"><a name="id287045299"></a><h2>関連情報</h2><p><a class="xref" href="#ST_3DClosestPoint" title="ST_3DClosestPoint">ST_3DClosestPoint</a>, <a class="xref" href="#ST_3DDistance" title="ST_3DDistance">ST_3DDistance</a>, <a class="xref" href="#ST_LongestLine" title="ST_LongestLine">ST_LongestLine</a>, <a class="xref" href="#ST_3DShortestLine" title="ST_3DShortestLine">ST_3DShortestLine</a>, <a class="xref" href="#ST_3DMaxDistance" title="ST_3DMaxDistance">ST_3DMaxDistance</a></p></div></div><div class="refentry" title="ST_3DMaxDistance"><div class="refentry.separator"><hr></div><a name="ST_3DMaxDistance"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_3DMaxDistance ? ジオメトリ型について、2つのジオメトリの、3次元の最大デカルト距離(空間参照系に基づきます)を、投影法の単位で返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_3DMaxDistance</b>(</code>geometry 
			<var class="pdparam">g1</var>, geometry 
			<var class="pdparam">g2</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287045404"></a><h2>説明</h2><p>ジオメトリ型について、2つのジオメトリの、3次元の最大デカルト距離(空間参照系に基づきます)を、投影法の単位で返します。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は多面体サーフェスに対応しています。</p><p>初出: 2.0.0</p></div><div class="refsection" title="例"><a name="id287045444"></a><h2>例</h2><pre class="programlisting">
-- ジオメトリの例 - メートル単位(SRID: 2163 米国ナショナルアトラス正積図法)
-- (3次元ポイントとラインの距離と、2次元ポイントとラインの距離とを比較)
-- ご注意: 現在は垂直データムに対応していないので、
-- Zは変換されずに、最終的に同じであると仮定されます。
SELECT ST_3DMaxDistance(
			ST_Transform(ST_GeomFromEWKT('SRID=4326;POINT(-72.1235 42.3521 10000)'),2163),
			ST_Transform(ST_GeomFromEWKT('SRID=4326;LINESTRING(-72.1260 42.45 15, -72.123 42.1546 20)'),2163)
		) As dist_3d,
		ST_MaxDistance(
			ST_Transform(ST_GeomFromEWKT('SRID=4326;POINT(-72.1235 42.3521 10000)'),2163),
			ST_Transform(ST_GeomFromEWKT('SRID=4326;LINESTRING(-72.1260 42.45 15, -72.123 42.1546 20)'),2163)
		) As dist_2d;

     dist_3d      |     dist_2d
------------------+------------------
 24383.7467488441 | 22247.8472107251
</pre></div><div class="refsection" title="関連情報"><a name="id287045454"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Distance" title="ST_Distance">ST_Distance</a>, <a class="xref" href="#ST_3DDWithin" title="ST_3DDWithin">ST_3DDWithin</a>, <a class="xref" href="#ST_3DMaxDistance" title="ST_3DMaxDistance">ST_3DMaxDistance</a>, <a class="xref" href="#ST_Transform" title="ST_Transform">ST_Transform</a></p></div></div><div class="refentry" title="ST_3DShortestLine"><div class="refentry.separator"><hr></div><a name="ST_3DShortestLine"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_3DShortestLine ? 2つのジオメトリの3次元長が最短となるラインを返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_3DShortestLine</b>(</code>geometry 
			<var class="pdparam">g1</var>, geometry 
			<var class="pdparam">g2</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287045557"></a><h2>説明</h2><p>2つのジオメトリの3次元長が最短となるポイントを返します。見つかった最短線が複数ある場合は、最初のもののみ返します。g1とg2が1点のみでインタセクトする場合は、インタセクション点を開始点と終了点とします。g1とg2が1点より多くインタセクトする場合は、同じ点を開始点と終了点としますが、その点は不定です。返されるラインは常にg1側を始点、g2側を終点とします。この関数が返すラインの長さは、常にg1とg2を指定した場合の<a class="xref" href="#ST_3DDistance" title="ST_3DDistance">ST_3DDistance</a>が返す値と同じになります。</p><p>初出: 2.0.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は多面体サーフェスに対応しています。</p></div><div class="refsection" title="例"><a name="id287045600"></a><h2>例</h2><div class="informaltable"><table border="1"><colgroup><col></colgroup><tbody><tr><td><p>ラインストリングとポイント -- 3次元と2次元の最短ライン
					</p><pre class="programlisting">
SELECT ST_AsEWKT(ST_3DShortestLine(line,pt)) AS shl3d_line_pt, 
		ST_AsEWKT(ST_ShortestLine(line,pt)) As shl2d_line_pt
	FROM (SELECT 'POINT(100 100 30)'::geometry As pt, 
			'LINESTRING (20 80 20, 98 190 1, 110 180 3, 50 75 1000)'::geometry As line
		) As foo;
	
		
 shl3d_line_pt                        						                 |               shl2d_line_pt
----------------------------------------------------------------------------+------------------------------------------------------
 LINESTRING(54.6993798867619 128.935022917228 11.5475869506606,100 100 30)  | LINESTRING(73.0769230769231 115.384615384615,100 100)
					</pre><p>
							  </p></td></tr><tr><td><p>ラインストリングとマルチポイント -- 3次元と2次元の最短ライン
					</p><pre class="programlisting">SELECT ST_AsEWKT(ST_3DShortestLine(line,pt)) AS shl3d_line_pt, 
		ST_AsEWKT(ST_ShortestLine(line,pt)) As shl2d_line_pt
	FROM (SELECT 'MULTIPOINT(100 100 30, 50 74 1000)'::geometry As pt, 
			'LINESTRING (20 80 20, 98 190 1, 110 180 3, 50 75 900)'::geometry As line
		) As foo;
	
		
                       shl3d_line_pt                                       | shl2d_line_pt
---------------------------------------------------------------------------+------------------------
 LINESTRING(54.6993798867619 128.935022917228 11.5475869506606,100 100 30) | LINESTRING(50 75,50 74)
					</pre><p>
							  </p></td></tr><tr><td><p>マルチラインストリングとポリゴン -- 3次元と2次元の最短ライン
					</p><pre class="programlisting">SELECT ST_AsEWKT(ST_3DShortestLine(poly, mline)) As shl3d,
    ST_AsEWKT(ST_ShortestLine(poly, mline)) As shl2d 
        FROM (SELECT  ST_GeomFromEWKT('POLYGON((175 150 5, 20 40 5, 35 45 5, 50 60 5, 100 100 5, 175 150 5))') As poly,
                ST_GeomFromEWKT('MULTILINESTRING((175 155 2, 20 40 20, 50 60 -2, 125 100 1, 175 155 1),
                (1 10 2, 5 20 1))') As mline ) As foo;
                   shl3d                                                                           |     shl2d
---------------------------------------------------------------------------------------------------+------------------------
 LINESTRING(39.993580415989 54.1889925532825 5,40.4078575708294 53.6052383805529 5.03423778139177) | LINESTRING(20 40,20 40)            
             </pre><p>
							  </p></td></tr></tbody></table></div></div><div class="refsection" title="関連情報"><a name="id287045652"></a><h2>関連情報</h2><p><a class="xref" href="#ST_3DClosestPoint" title="ST_3DClosestPoint">ST_3DClosestPoint</a>, <a class="xref" href="#ST_3DDistance" title="ST_3DDistance">ST_3DDistance</a>, <a class="xref" href="#ST_LongestLine" title="ST_LongestLine">ST_LongestLine</a>, <a class="xref" href="#ST_ShortestLine" title="ST_ShortestLine">ST_ShortestLine</a>, <a class="xref" href="#ST_3DMaxDistance" title="ST_3DMaxDistance">ST_3DMaxDistance</a></p></div></div><div class="refentry" title="ST_Area"><div class="refentry.separator"><hr></div><a name="ST_Area"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Area ? ポリゴンまたはマルチポリゴンの場合にはサーフェスの面積を返します。ジオメトリ型の「面積」はSRIDに基づく単位で、ジオグラフィ型の面積は平方メートルです。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_Area</b>(</code>geometry <var class="pdparam">g1</var><code>)</code>;</p><p><code class="funcdef">float <b class="fsfunc">ST_Area</b>(</code>geography <var class="pdparam">geog</var>, boolean <var class="pdparam">use_spheroid=true</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287042020"></a><h2>説明</h2><p>ポリゴンまたはマルチポリゴンの場合にはサーフェスの面積を返します。ST_SurfaceまたはST_MultiSurface値の面積計測を返します。ジオメトリ型の面積はSRIDに基づく単位です。ジオグラフィ型の面積は平方メートルで、デフォルトでは回転楕円体についての計測です(現在はWGS 84のみ)。計算速度が速い反面精度が落ちる球面での計測を行うにはST_Area(geog,false)とします。</p><p>機能強化: 2.0.0 - 2次元多面体サーフェスが導入されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 8.1.2, 9.5.3</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は多面体サーフェスに対応しています。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>多面体サーフェスについて、2次元多面体サーフェスのみ対応します(2.5次元は対応しません)。2.5次元について、0でない答が与えられるかも知れませんが、完全にXY平面に付いているサーフェスのみです。</p></td></tr></table></div></div><div class="refsection" title="例"><a name="id287042075"></a><h2>例</h2><p>マサチューセッツのプロットから平方フィートの面積を返すものと、乗算で平方フィートから平方メートルに変換するものです。2249はマサチューセッツ州フィート平面であるので、平方フィートで面積が出ることに注意して下さい。</p><pre class="programlisting">
SELECT ST_Area(the_geom) As sqft, ST_Area(the_geom)*POWER(0.3048,2) As sqm
		FROM (SELECT
		ST_GeomFromText('POLYGON((743238 2967416,743238 2967450,
			743265 2967450,743265.625 2967416,743238 2967416))',2249) ) As foo(the_geom);
  sqft   |     sqm
---------+-------------
 928.625 | 86.27208552
</pre><p>平方フィートの面積を返すものと、マサチューセッツ州メートル平面(26986)に変換して平方メートルを得るものです。2249はマサチューセッツ州フィート平面であり、26986はマサチューセッツ州メートル平面であることに注意して下さい。</p><pre class="programlisting">

SELECT ST_Area(the_geom) As sqft, ST_Area(ST_Transform(the_geom,26986)) As sqm
		FROM (SELECT
		ST_GeomFromText('POLYGON((743238 2967416,743238 2967450,
			743265 2967450,743265.625 2967416,743238 2967416))',2249) ) As foo(the_geom);
  sqft   |       sqm
---------+------------------
 928.625 | 86.2724304199219
			</pre><p>ジオグラフィ型を使って平方フィートと平方メートルを返すものです。
ジオメトリをジオグラフィに変換することに注意して下さい(変換に先立ってジオメトリがWGS 84緯度経度の4326であることを確認します)。ジオグラフィは常にメートルで計測されます。これは比較のためのデモンストレーションです。通常は、ジオグラフィ型が既に格納されているものです。</p><pre class="programlisting">

SELECT ST_Area(the_geog)/POWER(0.3048,2) As sqft_spheroid,  ST_Area(the_geog,false)/POWER(0.3048,2) As sqft_sphere, ST_Area(the_geog) As sqm_spheroid
		FROM (SELECT
		geography(
		ST_Transform(
			ST_GeomFromText('POLYGON((743238 2967416,743238 2967450,743265 2967450,743265.625 2967416,743238 2967416))',
				2249
				) ,4326
			)
		)
	) As foo(the_geog);
 sqft_spheroid   |   sqft_sphere    |   sqm_spheroid
-----------------+------------------+------------------
928.684405217197 | 927.186481558724 | 86.2776044452694

 --if your data is in geography already
 SELECT ST_Area(the_geog)/POWER(0.3048,2) As  sqft, ST_Area(the_geog) As sqm
	FROM somegeogtable;</pre></div><div class="refsection" title="関連情報"><a name="id287042139"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a>, <a class="xref" href="#ST_GeographyFromText" title="ST_GeographyFromText">ST_GeographyFromText</a>, <a class="xref" href="#ST_SetSRID" title="ST_SetSRID">ST_SetSRID</a>, <a class="xref" href="#ST_Transform" title="ST_Transform">ST_Transform</a></p></div></div><div class="refentry" title="ST_Azimuth"><div class="refentry.separator"><hr></div><a name="ST_Azimuth"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Azimuth ? pointAとPointBで定義されるベクタの、水平面での方位をラジアン単位で返します。方位は時計回りで、前半は下向き方向で後半は上向き方向になります。時計でいうと12=0; 3=PI/2; 6=PI; 9=3PI/4となります。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_Azimuth</b>(</code>geometry <var class="pdparam">pointA</var>, geometry <var class="pdparam">pointB</var><code>)</code>;</p><p><code class="funcdef">float <b class="fsfunc">ST_Azimuth</b>(</code>geography <var class="pdparam">pointA</var>, geography <var class="pdparam">pointB</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287042776"></a><h2>説明</h2><p>与えられたポイントジオメトリで定義される線分の方位を返し、2点が同位置にある場合はNULLを返します。返り値はラジアン単位です。方位は時計回りで、前半は下向き方向で後半は上向き方向になります。時計でいうと12=0; 3=PI/2; 6=PI; 9=3PI/4となります。</p><p>方位は基準面とポイントのあいたの角度(この場合はラジアン単位)と定義される数学的な概念です。</p><p>初出: 1.1.0</p><p>機能強化: 2.0.0では、ジオグラフィが導入されました。</p><p>ST_Azimuthは、ST_Translateと併用して、垂直軸に沿ってオブジェクトをシフトさせる場合に、特に便利です。これの例として、upgis_lineshift <a class="ulink" href="http://trac.osgeo.org/postgis/wiki/UsersWikiplpgsqlfunctions" target="_top">Plpgsqlfunctions PostGIS wiki section</a>を参照して下さい。</p></div><div class="refsection" title="例"><a name="id287042804"></a><h2>例</h2><p>度単位のジオメトリの方位</p><pre class="programlisting">
SELECT ST_Azimuth(ST_Point(25,45), ST_Point(75,100))/(2*pi())*360 as degAz,
	ST_Azimuth(ST_Point(75,100), ST_Point(25,45))/(2*pi())*360 As degAzrev;
	
-- ご注意: 度に関するPostgreSQL組み込み関数を使うと覚えやすいです。
-- 両方とも同じ答えです。
SELECT degrees( ST_Azimuth(ST_Point(25,45), ST_Point(75,100)) ) as degAz,
	degrees( ST_Azimuth(ST_Point(75,100), ST_Point(25,45)) ) As degAzrev;

      degaz       |     degazrev
------------------+------------------
 42.2736890060937 | 222.273689006094
</pre><div class="informaltable"><table border="1"><colgroup><col><col></colgroup><tbody><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_azimuth01.png"><div class="caption"><p>
degAzは行程(方位)、水平線(始点から初めて終点が落ちてきてほしい終点で終了)とポイント(始点:25,45は緑)です。</p></div></div></div><p>
				</p></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_azimuth02.png"><div class="caption"><p>
degAzrevは方位曲線、水平線(始点から初めて終点が落ちてきてほしい終点で終了)とポイント(始点:75,100は緑)</p></div></div></div><p>
				</p></td></tr></tbody></table></div></div><div class="refsection" title="関連情報"><a name="id287042875"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Point" title="ST_Point">ST_Point</a>, <a class="xref" href="#ST_Translate" title="ST_Translate">ST_Translate</a></p></div></div><div class="refentry" title="ST_Centroid"><div class="refentry.separator"><hr></div><a name="ST_Centroid"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Centroid ? ジオメトリの幾何学的重心を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Centroid</b>(</code>geometry 
		  <var class="pdparam">g1</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287042928"></a><h2>説明</h2><p>ジオメトリの幾何学的重心を計算します。ジオメトリの質量中心の<code class="varname">POINT</code>と同じです。[MULTI]POINTに対しては、入力座標の算術平均として計算されます。 [MULTI]LINESTRINGに対しては、各区分の重み付き長さとして計算されます。 [MULTI]POLYGONに対しては、「重み」を面積ととらえて計算します。空ジオメトリが与えられた場合は、空のGEOMETRYCOLLECTIONが返されます。NULLが与えられた場合は、NULLが返されます。</p><p>重心は、最も高い次元のジオメトリの要素の集合の重心と同じです(低い次元のジオメトリは「重み」0に貢献するため)。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>GEOSモジュールを使用することで計算は高精度になります(コンパイル時に有効にします)。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 8.1.4, 9.5.5</p></div><div class="refsection" title="例"><a name="id287043010"></a><h2>例</h2><p>次に示す図では、青点が入力ジオメトリの重心です。</p><div class="informaltable"><table border="1"><colgroup><col><col></colgroup><tbody><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_centroid01.png"><div class="caption"><p><code class="varname">MULTIPOINT</code>の重心</p></div></div></div></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_centroid02.png"><div class="caption"><p><code class="varname">LINESTRING</code>の重心</p></div></div></div></td></tr><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_centroid03.png"><div class="caption"><p><code class="varname">POLYGON</code>の重心</p></div></div></div></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_centroid04.png"><div class="caption"><p><code class="varname">GEOMETRYCOLLECTION</code>の重心</p></div></div></div></td></tr></tbody></table></div><pre class="programlisting">SELECT ST_AsText(ST_Centroid('MULTIPOINT ( -1 0, -1 2, -1 3, -1 4, -1 7, 0 1, 0 3, 1 1, 2 0, 6 0, 7 8, 9 8, 10 6 )'));
				st_astext
------------------------------------------
 POINT(2.30769230769231 3.30769230769231)
(1 row)</pre></div><div class="refsection" title="関連情報"><a name="id287043132"></a><h2>関連情報</h2><p><a class="xref" href="#ST_PointOnSurface" title="ST_PointOnSurface">ST_PointOnSurface</a></p></div></div><div class="refentry" title="ST_ClosestPoint"><div class="refentry.separator"><hr></div><a name="ST_ClosestPoint"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ClosestPoint ? g1上の、g2に最も近い3次元ポイントを返します。2次元最短線のひとつめのポイントです。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_ClosestPoint</b>(</code>geometry 
			<var class="pdparam">g1</var>, geometry 
			<var class="pdparam">g2</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287043191"></a><h2>説明</h2><p>g1上の、g2に最も近い2次元ポイントを返します。2次元最短線のひとつめのポイントです</p><p>初出: 1.5.0</p></div><div class="refsection" title="例"><a name="id287043204"></a><h2>例</h2><div class="informaltable"><table border="1"><colgroup><col><col></colgroup><tbody><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_closestpoint01.png"><div class="caption"><p>ポイントとラインストリングの間の最短は、ポイントそのものです。ラインストリングとポイントの間の最短は、ラインストリング上の最短となるポイントです。</p></div></div></div><p>
				</p><pre class="programlisting">
SELECT ST_AsText(ST_ClosestPoint(pt,line)) AS cp_pt_line, 
	ST_AsText(ST_ClosestPoint(line,pt)) As cp_line_pt
FROM (SELECT 'POINT(100 100)'::geometry As pt, 
		'LINESTRING (20 80, 98 190, 110 180, 50 75 )'::geometry As line
	) As foo;

	
   cp_pt_line   |                cp_line_pt
----------------+------------------------------------------
 POINT(100 100) | POINT(73.0769230769231 115.384615384615)
				</pre><p>
						  </p></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_closestpoint02.png"><div class="caption"><p>ポリゴンA上のポリゴンBへの最短点</p></div></div></div><p>
				</p><pre class="programlisting">
SELECT ST_AsText(
		ST_ClosestPoint(
			ST_GeomFromText('POLYGON((175 150, 20 40, 50 60, 125 100, 175 150))'),
			ST_Buffer(ST_GeomFromText('POINT(110 170)'), 20)
			) 
		) As ptwkt;
		
                  ptwkt
------------------------------------------
 POINT(140.752120669087 125.695053378061)
				</pre><p>
						</p></td></tr></tbody></table></div></div><div class="refsection" title="関連情報"><a name="id287043276"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Distance" title="ST_Distance">ST_Distance</a>, <a class="xref" href="#ST_LongestLine" title="ST_LongestLine">ST_LongestLine</a>, <a class="xref" href="#ST_ShortestLine" title="ST_ShortestLine">ST_ShortestLine</a>, <a class="xref" href="#ST_MaxDistance" title="ST_MaxDistance">ST_MaxDistance</a></p></div></div><div class="refentry" title="ST_Contains"><div class="refentry.separator"><hr></div><a name="ST_Contains"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Contains ? BのポイントがAの外部に無く、かつBの内部の少なくとも1つの点がAの内部にある場合に限って、TRUEを返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_Contains</b>(</code>geometry 
			<var class="pdparam">geomA</var>, geometry 
			<var class="pdparam">geomB</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287043345"></a><h2>説明</h2><p>ジオメトリAとジオメトリBを含むのは、BのポイントがAの外部に無く、かつBの内部の少なくとも1つの点がAの内部にある場合に限ります。この定義の重要で微妙なところは、Aはその境界を含まず、Aは自身を含む、ということです。ジオメトリAが自身を正しく含むかどうかを見る<a class="xref" href="#ST_ContainsProperly" title="ST_ContainsProperly">ST_ContainsProperly</a>と対照的です。</p><p>ジオメトリBが完全にジオメトリAの内側になる場合はTRUEを返します。この関数が意味のあるものにするためには、元のジオメトリは同じ投影座標である、同じSRIDを持っている必要があります。ST_ContainsはST_Withinの逆のものです。ST_Contains(A,B)はST_Within(B,A)を意味します。ただし、結果が常にFALSEになる、気にしないか、または定義されていない不正なジオメトリの場合を除きます。</p><p>GEOSモジュールによって実現しています。</p><div class="important" title="重要" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[重要]" src="images/important.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">GEOMETRYCOLLECTION</code>を引数にして呼ばないでください。</p></td></tr></table></div><div class="important" title="重要" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[重要]" src="images/important.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数を不正なジオメトリで呼ばないでください。予期しない結果が返されます。</p></td></tr></table></div><p>この関数の呼び出しによって、ジオメトリで使用可能なインデクスを使用したバウンディングボックスの比較が自動的に行われます。インデクスの使用を避けるには、_ST_Containsを使います。</p><p>ご注意: これは論理値を返して整数を返さないのが「許される」版です。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です s2.1.1.2 // s2.1.13.3 
		- same as within(geometry B, geometry A)</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。	SQL-MM 3: 5.1.31</p><p>直感的に分かりにくいST_ContainsとST_Withinの微妙な違いがあります。詳細については、<a class="ulink" href="http://lin-ear-th-inking.blogspot.com/2007/06/subtleties-of-ogc-covers-spatial.html" target="_top">Subtleties of OGC Covers, Contains, Within</a>をご覧ください。</p></div><div class="refsection" title="例"><a name="id287043424"></a><h2>例</h2><p>次に示す図全てで、<code class="function">ST_Contains</code>は<code class="varname">TRUE</code>を返します。</p><div class="informaltable"><table border="1"><colgroup><col><col></colgroup><tbody><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_contains01.png"><div class="caption"><p><code class="varname">LINESTRING</code> / <code class="varname">MULTIPOINT</code></p></div></div></div></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_contains02.png"><div class="caption"><p><code class="varname">POLYGON</code> / <code class="varname">POINT</code></p></div></div></div></td></tr><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_contains03.png"><div class="caption"><p><code class="varname">POLYGON</code> / <code class="varname">LINESTRING</code></p></div></div></div></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_contains04.png"><div class="caption"><p><code class="varname">POLYGON</code> / <code class="varname">POLYGON</code></p></div></div></div></td></tr></tbody></table></div><p>
次に示す図全てで、<code class="function">ST_Contains</code>は<code class="varname">FALSE</code>を返します。</p><div class="informaltable"><table border="1"><colgroup><col><col></colgroup><tbody><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_contains05.png"><div class="caption"><p><code class="varname">POLYGON</code> / <code class="varname">MULTIPOINT</code></p></div></div></div></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_contains06.png"><div class="caption"><p><code class="varname">POLYGON</code> / <code class="varname">LINESTRING</code></p></div></div></div></td></tr></tbody></table></div><pre class="programlisting">
-- 円の中にある円
SELECT ST_Contains(smallc, bigc) As smallcontainsbig,
	   ST_Contains(bigc,smallc) As bigcontainssmall,
	   ST_Contains(bigc, ST_Union(smallc, bigc)) as bigcontainsunion,
	   ST_Equals(bigc, ST_Union(smallc, bigc)) as bigisunion,
	   ST_Covers(bigc, ST_ExteriorRing(bigc)) As bigcoversexterior,
	   ST_Contains(bigc, ST_ExteriorRing(bigc)) As bigcontainsexterior
FROM (SELECT ST_Buffer(ST_GeomFromText('POINT(1 2)'), 10) As smallc,
			 ST_Buffer(ST_GeomFromText('POINT(1 2)'), 20) As bigc) As foo;

-- 結果
  smallcontainsbig | bigcontainssmall | bigcontainsunion | bigisunion | bigcoversexterior | bigcontainsexterior
------------------+------------------+------------------+------------+-------------------+---------------------
 f                | t                | t                | t          | t        | f

-- ST_ContainsとST_ContainsProperlyとの違いのデモ
SELECT ST_GeometryType(geomA) As geomtype, ST_Contains(geomA,geomA) AS acontainsa, ST_ContainsProperly(geomA, geomA) AS acontainspropa,
   ST_Contains(geomA, ST_Boundary(geomA)) As acontainsba, ST_ContainsProperly(geomA, ST_Boundary(geomA)) As acontainspropba
FROM (VALUES ( ST_Buffer(ST_Point(1,1), 5,1) ),
			 ( ST_MakeLine(ST_Point(1,1), ST_Point(-1,-1) ) ),
			 ( ST_Point(1,1) )
	  ) As foo(geomA);

  geomtype    | acontainsa | acontainspropa | acontainsba | acontainspropba
--------------+------------+----------------+-------------+-----------------
ST_Polygon    | t          | f              | f           | f
ST_LineString | t          | f              | f           | f
ST_Point      | t          | t              | f           | f

 </pre></div><div class="refsection" title="関連情報"><a name="id287043671"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Boundary" title="ST_Boundary">ST_Boundary</a>, <a class="xref" href="#ST_ContainsProperly" title="ST_ContainsProperly">ST_ContainsProperly</a>, <a class="xref" href="#ST_Covers" title="ST_Covers">ST_Covers</a>, <a class="xref" href="#ST_CoveredBy" title="ST_CoveredBy">ST_CoveredBy</a>, <a class="xref" href="#ST_Equals" title="ST_Equals">ST_Equals</a>, <a class="xref" href="#ST_Within" title="ST_Within">ST_Within</a></p></div></div><div class="refentry" title="ST_ContainsProperly"><div class="refentry.separator"><hr></div><a name="ST_ContainsProperly"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ContainsProperly ? BがAの内部にインタセクトするが境界(または外部)にインタセクトしない場合に、TRUEを返します。Aは自身には、ContainsProperlyではありませんが、Containsです。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_ContainsProperly</b>(</code>geometry 
			<var class="pdparam">geomA</var>, geometry 
			<var class="pdparam">geomB</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287043746"></a><h2>説明</h2><p>BがAの内部にインタセクトするが境界(または外部)にインタセクトしない場合に、TRUEを返します。</p><p>Aは自身には、ContainsProperlyではありませんが、Containsです。</p><p>他のジオメトリの全てのポイントは、このジオメトリの内部のポイントです。<a class="xref" href="#ST_Relate" title="ST_Relate">ST_Relate</a>で使われるDE-9IMでは[T**FF*FF*]に合致します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>JTS文書からわずかに言い換えると、<a class="xref" href="#ST_Contains" title="ST_Contains">ST_Contains</a>と<a class="xref" href="#ST_Intersects" title="ST_Intersects">ST_Intersects</a>でこの述語を併用する利点は、個々のポイントでのトポロジの計算が必要なく、効果的に計算されることです。</p><p>この述語の使用事例として、大きいポリゴンジオメトリでのジオメトリの集合のインタセクションを計算が挙げられます。インタセクションはかなり遅いので、ContainsProperlyを使って、対象ジオメトリのうち全体が領域内にあるものを抜き出すことができ、効果的になります。これらの場面では、インタセクションは確実に元の対象ジオメトリであることが直感的に分かります。</p></td></tr></table></div><p>初出: 1.4.0 - GEOS 3.1.0以上が必要です。</p><div class="important" title="重要" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[重要]" src="images/important.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">GEOMETRYCOLLECTION</code>を引数にして呼ばないでください。</p></td></tr></table></div><div class="important" title="重要" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[重要]" src="images/important.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数を不正なジオメトリで呼ばないでください。予期しない結果が返されます。</p></td></tr></table></div><p>この関数の呼び出しによって、ジオメトリで使用可能なインデクスを使用したバウンディングボックスの比較が自動的に行われます。インデクスの使用を避けるには、_ST_ContainsProperlyを使います。</p></div><div class="refsection" title="例"><a name="id287043838"></a><h2>例</h2><pre class="programlisting">
	-- 円の中にある円
	SELECT ST_ContainsProperly(smallc, bigc) As smallcontainspropbig,
	ST_ContainsProperly(bigc,smallc) As bigcontainspropsmall,
	ST_ContainsProperly(bigc, ST_Union(smallc, bigc)) as bigcontainspropunion,
	ST_Equals(bigc, ST_Union(smallc, bigc)) as bigisunion,
	ST_Covers(bigc, ST_ExteriorRing(bigc)) As bigcoversexterior,
	ST_ContainsProperly(bigc, ST_ExteriorRing(bigc)) As bigcontainsexterior
	FROM (SELECT ST_Buffer(ST_GeomFromText('POINT(1 2)'), 10) As smallc,
	ST_Buffer(ST_GeomFromText('POINT(1 2)'), 20) As bigc) As foo;
	-- 結果
  smallcontainspropbig | bigcontainspropsmall | bigcontainspropunion | bigisunion | bigcoversexterior | bigcontainsexterior
------------------+------------------+------------------+------------+-------------------+---------------------
 f                     | t                    | f                    | t          | t                 | f

 -- ST_ContainsとST_ContainsProperlyとの違いのデモ
 SELECT ST_GeometryType(geomA) As geomtype, ST_Contains(geomA,geomA) AS acontainsa, ST_ContainsProperly(geomA, geomA) AS acontainspropa,
 ST_Contains(geomA, ST_Boundary(geomA)) As acontainsba, ST_ContainsProperly(geomA, ST_Boundary(geomA)) As acontainspropba
 FROM (VALUES ( ST_Buffer(ST_Point(1,1), 5,1) ),
		  ( ST_MakeLine(ST_Point(1,1), ST_Point(-1,-1) ) ),
		  ( ST_Point(1,1) )
	) As foo(geomA);

  geomtype    | acontainsa | acontainspropa | acontainsba | acontainspropba
--------------+------------+----------------+-------------+-----------------
ST_Polygon    | t          | f              | f           | f
ST_LineString | t          | f              | f           | f
ST_Point      | t          | t              | f           | f
 </pre></div><div class="refsection" title="関連情報"><a name="id287043849"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeometryType" title="ST_GeometryType">ST_GeometryType</a>, <a class="xref" href="#ST_Boundary" title="ST_Boundary">ST_Boundary</a>, <a class="xref" href="#ST_Contains" title="ST_Contains">ST_Contains</a>, <a class="xref" href="#ST_Covers" title="ST_Covers">ST_Covers</a>, <a class="xref" href="#ST_CoveredBy" title="ST_CoveredBy">ST_CoveredBy</a>, <a class="xref" href="#ST_Equals" title="ST_Equals">ST_Equals</a>, <a class="xref" href="#ST_Relate" title="ST_Relate">ST_Relate</a>, <a class="xref" href="#ST_Within" title="ST_Within">ST_Within</a></p></div></div><div class="refentry" title="ST_Covers"><div class="refentry.separator"><hr></div><a name="ST_Covers"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Covers ? ジオメトリBにジオメトリAの外となるポイントが無い場合には、1(TRUE)を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_Covers</b>(</code>geometry 
			<var class="pdparam">geomA</var>, geometry 
			<var class="pdparam">geomB</var><code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">ST_Covers</b>(</code>geography 
			<var class="pdparam">geogpolyA</var>, geography 
			<var class="pdparam">geogpointB</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287043992"></a><h2>説明</h2><p>ジオメトリ/ジオグラフィBにジオメトリ/ジオグラフィAの外となるポイントが無い場合には、1(TRUE)を返します。</p><p>GEOSモジュールによって実現しています。</p><div class="important" title="重要" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[重要]" src="images/important.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">GEOMETRYCOLLECTION</code>を引数にして呼ばないでください。</p></td></tr></table></div><div class="important" title="重要" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[重要]" src="images/important.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ジオグラフィではAにポリゴン、Bにポイントがある場合のみ対応します。</p></td></tr></table></div><div class="important" title="重要" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[重要]" src="images/important.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数を不正なジオメトリで呼ばないでください。予期しない結果が返されます。</p></td></tr></table></div><p>この関数の呼び出しによって、ジオメトリで使用可能なインデクスを使用したバウンディングボックスの比較が自動的に行われます。インデクスの使用を避けるには、_ST_Coversを使います。</p><p>初出: 1.2.2 - GEOS 3.0以上が必要です。</p><p>初出: 1.5 - ジオグラフィが導入されました。</p><p>ご注意: これは論理値を返して整数を返さないのが「許される」版です。</p><p>これはOGC標準と違いますがOracleは持っています。</p><p>直感的に分かりにくいST_ContainsとST_Withinの微妙な違いがあります。詳細については、<a class="ulink" href="http://lin-ear-th-inking.blogspot.com/2007/06/subtleties-of-ogc-covers-spatial.html" target="_top">Subtleties of OGC Covers, Contains, Within</a>をご覧ください。</p></div><div class="refsection" title="例"><a name="id287044053"></a><h2>例</h2><p>ジオメトリの例</p><pre class="programlisting">
	-- 円をカバーする円
SELECT ST_Covers(smallc,smallc) As smallinsmall,
	ST_Covers(smallc, bigc) As smallcoversbig,
	ST_Covers(bigc, ST_ExteriorRing(bigc)) As bigcoversexterior,
	ST_Contains(bigc, ST_ExteriorRing(bigc)) As bigcontainsexterior
FROM (SELECT ST_Buffer(ST_GeomFromText('POINT(1 2)'), 10) As smallc,
	ST_Buffer(ST_GeomFromText('POINT(1 2)'), 20) As bigc) As foo;
	-- 結果
 smallinsmall | smallcoversbig | bigcoversexterior | bigcontainsexterior
--------------+----------------+-------------------+---------------------
 t            | f              | t                 | f
(1 row)	</pre><p>ジオグラフィの例</p><pre class="programlisting">
-- ポイントと他のポイントから300メートルのバッファとの比較と
-- ポイントとそのポイントから10メートルのバッファとの比較
SELECT ST_Covers(geog_poly, geog_pt) As poly_covers_pt, 
	ST_Covers(ST_Buffer(geog_pt,10), geog_pt) As buff_10m_covers_cent
	FROM (SELECT ST_Buffer(ST_GeogFromText('SRID=4326;POINT(-99.327 31.4821)'), 300) As geog_poly,
				ST_GeogFromText('SRID=4326;POINT(-99.33 31.483)') As geog_pt ) As foo;
				
 poly_covers_pt | buff_10m_covers_cent
----------------+------------------
 f              | t
		</pre></div><div class="refsection" title="関連情報"><a name="id287044074"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Contains" title="ST_Contains">ST_Contains</a>, <a class="xref" href="#ST_CoveredBy" title="ST_CoveredBy">ST_CoveredBy</a>, <a class="xref" href="#ST_Within" title="ST_Within">ST_Within</a></p></div></div><div class="refentry" title="ST_CoveredBy"><div class="refentry.separator"><hr></div><a name="ST_CoveredBy"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_CoveredBy ? オメトリ/ジオグラフィAの点がジオメトリ/ジオグラフィBの外に無い場合に、1(TRUE)を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_CoveredBy</b>(</code>geometry 
			<var class="pdparam">geomA</var>, geometry 
			<var class="pdparam">geomB</var><code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">ST_CoveredBy</b>(</code>geography 
			<var class="pdparam">geogA</var>, geography 
			<var class="pdparam">geogB</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287044167"></a><h2>説明</h2><p>ジオメトリ/ジオグラフィAの点がジオメトリ/ジオグラフィBの外に無い場合に、1(TRUE)を返します。</p><p>GEOSモジュールによって実現しています。</p><div class="important" title="重要" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[重要]" src="images/important.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">GEOMETRYCOLLECTION</code>を引数にして呼ばないでください。</p></td></tr></table></div><div class="important" title="重要" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[重要]" src="images/important.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数を不正なジオメトリで呼ばないでください。予期しない結果が返されます。</p></td></tr></table></div><p>初出: 1.2.2 - GEOS 3.0以上が必要です。</p><p>この関数の呼び出しによって、ジオメトリで使用可能なインデクスを使用したバウンディングボックスの比較が自動的に行われます。インデクスの使用を避けるには、_ST_CoveredByを使います。</p><p>ご注意: これは論理値を返して整数を返さないのが「許される」版です。</p><p>これはOGC標準と違いますがOracleは持っています。</p><p>直感的に分かりにくいST_ContainsとST_Withinの微妙な違いがあります。詳細については、<a class="ulink" href="http://lin-ear-th-inking.blogspot.com/2007/06/subtleties-of-ogc-covers-spatial.html" target="_top">Subtleties of OGC Covers, Contains, Within</a>をご覧ください。</p></div><div class="refsection" title="例"><a name="id287044217"></a><h2>例</h2><pre class="programlisting">
	-- 円にカバーされる円
SELECT ST_CoveredBy(smallc,smallc) As smallinsmall,
	ST_CoveredBy(smallc, bigc) As smallcoveredbybig,
	ST_CoveredBy(ST_ExteriorRing(bigc), bigc) As exteriorcoveredbybig,
	ST_Within(ST_ExteriorRing(bigc),bigc) As exeriorwithinbig
FROM (SELECT ST_Buffer(ST_GeomFromText('POINT(1 2)'), 10) As smallc,
	ST_Buffer(ST_GeomFromText('POINT(1 2)'), 20) As bigc) As foo;
	-- 結果
 smallinsmall | smallcoveredbybig | exteriorcoveredbybig | exeriorwithinbig
--------------+-------------------+----------------------+------------------
 t            | t                 | t                    | f
(1 row)	</pre></div><div class="refsection" title="関連情報"><a name="id287044228"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Contains" title="ST_Contains">ST_Contains</a>, <a class="xref" href="#ST_Covers" title="ST_Covers">ST_Covers</a>, <a class="xref" href="#ST_ExteriorRing" title="ST_ExteriorRing">ST_ExteriorRing</a>, <a class="xref" href="#ST_Within" title="ST_Within">ST_Within</a></p></div></div><div class="refentry" title="ST_Crosses"><div class="refentry.separator"><hr></div><a name="ST_Crosses"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Crosses ? 与えられたジオメトリが共通の内部の点を持ち、かつそうでない点を持つ場合に、<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_Crosses</b>(</code>geometry <var class="pdparam">g1</var>, geometry <var class="pdparam">g2</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287044297"></a><h2>説明</h2><p><code class="function">ST_Crosses</code>は2つのジオメトリを取り、インタセクションが「空間的にクロスする」、すなわち、ジオメトリが共通の内部の点を持ち、かつそうでない点を持つ場合に<code class="varname">TRUE</code>を返します。ジオメトリの内部のインタセクションは、空集合であってはならず、2つのジオメトリの最大次元より低い次元でなければなりません。さらに言うと、2つのジオメトリのインタセクションは、元のジオメトリのいずれとも一致してはなりません。これらを満たさない場合には<code class="varname">FALSE</code>が返ります。</p><p>数学的に述べると、次のようになります。</p><p class="remark"><em><span class="remark">TODO: Insert appropriate MathML markup here or use a gif.
	  Simple HTML markup does not work well in both IE and Firefox.</span></em></p><div class="informalfigure"><div class="mediaobject"><img src="images/st_crosses-math.gif"></div></div><p>DE-9IMでは次のようになります。</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="markup">T*T******</span> (Point/Line, Point/Area, Line/Areaの場合)</p></li><li class="listitem"><p><span class="markup">T*****T**</span> (Line/Point, Area/Point, Area/Lineの場合)</p></li><li class="listitem"><p><span class="markup">0********</span> (Line/Lineの場合)</p></li></ul></div><p>他の次元の組み合わせでは、FALSEが返されます。</p><p>OpenGIS Simple Feature Specificationでは、この述語はPoint/Line, Point/Area, Line/Line, Line/Areaの場合についてのみ定義されています。JTS/GEOSでは、Line/Point, Area/Point, Area/Lineについて拡張しています。これによって関係が対称になっています。</p><div class="important" title="重要" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[重要]" src="images/important.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">GEOMETRYCOLLECTION</code>を引数にして呼ばないでください。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数の呼び出しによって、ジオメトリで使用可能なインデクスを使用したバウンディングボックスの比較が自動的に行われます。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です s2.1.13.3</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.29</p></div><div class="refsection" title="例"><a name="id287048414"></a><h2>例</h2><p>次に示す図全てで、<code class="varname">TRUE</code>が返されます。</p><div class="informaltable"><table border="1"><colgroup><col><col></colgroup><tbody><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_crosses01.png"><div class="caption"><p><code class="varname">MULTIPOINT</code> / <code class="varname">LINESTRING</code></p></div></div></div></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_crosses02.png"><div class="caption"><p><code class="varname">MULTIPOINT</code> / <code class="varname">POLYGON</code></p></div></div></div></td></tr><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_crosses03.png"><div class="caption"><p><code class="varname">LINESTRING</code> / <code class="varname">POLYGON</code></p></div></div></div></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_crosses04.png"><div class="caption"><p><code class="varname">LINESTRING</code> / <code class="varname">LINESTRING</code></p></div></div></div></td></tr></tbody></table></div><p>roads(道路)とhighways(高速道路)の2つのテーブルを持っている場面を考えます。</p><div class="informaltable"><table border="1"><colgroup><col><col></colgroup><tbody><tr><td><p> </p><div class="informalexample"><pre class="programlisting">CREATE TABLE roads (
  id serial NOT NULL,
  the_geom geometry,
  CONSTRAINT roads_pkey PRIMARY KEY (road_id)
);</pre></div><p> </p></td><td><p> </p><div class="informalexample"><pre class="programlisting">CREATE TABLE highways (
  id serial NOT NULL,
  the_gem geometry,
  CONSTRAINT roads_pkey PRIMARY KEY (road_id)
);</pre></div><p> </p></td></tr></tbody></table></div><p>次のようなクエリを使って、highwayとクロスするroadsのリストを決定します。</p><div class="informalexample"><pre class="programlisting">SELECT roads.id
FROM roads, highways
WHERE ST_Crosses(roads.the_geom, highways.the_geom);</pre></div></div></div><div class="refentry" title="ST_LineCrossingDirection"><div class="refentry.separator"><hr></div><a name="ST_LineCrossingDirection"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_LineCrossingDirection ? 2つのラインストリングが与えられ、クロスの種類を-3から3の区間の数で返します。0の場合はクロスしていません。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_LineCrossingDirection</b>(</code>geometry  <var class="pdparam">linestringA</var>, geometry  <var class="pdparam">linestringB</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287048648"></a><h2>説明</h2><p>2つのラインストリングが与えられ、クロスの種類を-3から3の区間の数で返します。0の場合はクロスしていません。<code class="varname">LINESTRING</code>のみサポートします。</p><p>整定数の定義は次の通りです。
		   </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p> 0: クロスが無い</p></li><li class="listitem"><p>-1: 左クロス</p></li><li class="listitem"><p> 1: 右クロス</p></li><li class="listitem"><p>-2: 複数クロスで最後が左</p></li><li class="listitem"><p> 2: 複数クロスで最後が右</p></li><li class="listitem"><p>-3: 複数クロスで開始終了ともに左</p></li><li class="listitem"><p> 3: 複数クロスで開始終了ともに右</p></li></ul></div><p>
	  </p><p>初出: 1.4</p></div><div class="refsection" title="例"><a name="id287048718"></a><h2>例</h2><div class="informaltable"><table border="1"><colgroup><col><col></colgroup><tbody><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_linecrossingdirection01.png"><div class="caption"><p>ライン1(緑)とライン2(青)、円が始点、三角が終点。クエリは次の通り。</p></div></div></div><p>
				  </p><pre class="programlisting">
SELECT ST_LineCrossingDirection(foo.line1, foo.line2) As l1_cross_l2 ,
	  ST_LineCrossingDirection(foo.line2, foo.line1) As l2_cross_l1
FROM (
SELECT
 ST_GeomFromText('LINESTRING(25 169,89 114,40 70,86 43)') As line1,
 ST_GeomFromText('LINESTRING(171 154,20 140,71 74,161 53)') As line2
	) As foo;

 l1_cross_l2 | l2_cross_l1
-------------+-------------
           3 |          -3
				</pre><p>
			</p>
		</td><td>
			<div class="informalfigure"><div class="mediaobject"><img src="images/st_linecrossingdirection02.png"><div class="caption"><p>ライン1(緑)とライン2(青)、円が始点、三角が終点。クエリは次の通り。</p></div></div></div><p>
			  </p><pre class="programlisting">
SELECT ST_LineCrossingDirection(foo.line1, foo.line2) As l1_cross_l2 ,
	  ST_LineCrossingDirection(foo.line2, foo.line1) As l2_cross_l1
FROM (
 SELECT
  ST_GeomFromText('LINESTRING(25 169,89 114,40 70,86 43)') As line1,
  ST_GeomFromText('LINESTRING (171 154, 20 140, 71 74, 2.99 90.16)') As line2
) As foo;

 l1_cross_l2 | l2_cross_l1
-------------+-------------
           2 |          -2
				</pre><p>
			</p>
		</td></tr><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_linecrossingdirection03.png"><div class="caption"><p>ライン1(緑)とライン2(青)、円が始点、三角が終点。クエリは次の通り。</p></div></div></div><p>
				  </p><pre class="programlisting">
SELECT
	ST_LineCrossingDirection(foo.line1, foo.line2) As l1_cross_l2 ,
	ST_LineCrossingDirection(foo.line2, foo.line1) As l2_cross_l1
FROM (
 SELECT
  ST_GeomFromText('LINESTRING(25 169,89 114,40 70,86 43)') As line1,
  ST_GeomFromText('LINESTRING (20 140, 71 74, 161 53)') As line2
  ) As foo;

 l1_cross_l2 | l2_cross_l1
-------------+-------------
          -1 |          1
				</pre><p>
			</p>
		</td><td>
			<div class="informalfigure"><div class="mediaobject"><img src="images/st_linecrossingdirection04.png"><div class="caption"><p>ライン1(緑)とライン2(青)、円が始点、三角が終点。クエリは次の通り。</p></div></div></div><p>
			  </p><pre class="programlisting">
SELECT ST_LineCrossingDirection(foo.line1, foo.line2) As l1_cross_l2 ,
	  ST_LineCrossingDirection(foo.line2, foo.line1) As l2_cross_l1
FROM (SELECT
	ST_GeomFromText('LINESTRING(25 169,89 114,40 70,86 43)') As line1,
	ST_GeomFromText('LINESTRING(2.99 90.16,71 74,20 140,171 154)') As line2
	) As foo;

 l1_cross_l2 | l2_cross_l1
-------------+-------------
          -2 |          2
				</pre><p>
			</p>
		</td></tr></tbody></table></div><pre class="programlisting">
SELECT s1.gid, s2.gid, ST_LineCrossingDirection(s1.the_geom, s2.the_geom)
	FROM streets s1 CROSS JOIN streets s2 ON (s1.gid != s2.gid AND s1.the_geom &amp;&amp; s2.the_geom )
WHERE ST_CrossingDirection(s1.the_geom, s2.the_geom) &gt; 0;
</pre></div><div class="refsection" title="関連情報"><a name="id287048861"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Crosses" title="ST_Crosses">ST_Crosses</a></p></div></div><div class="refentry" title="ST_Disjoint"><div class="refentry.separator"><hr></div><a name="ST_Disjoint"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Disjoint ? ジオメトリが「空間的にインタセクトしていない」すなわち、空間を共有ししていない場合に、TRUEを返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_Disjoint</b>(</code>
						geometry
						<var class="pdparam">A</var>
					, 
						geometry
						<var class="pdparam">B</var>
					<code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287048924"></a><h2>説明</h2><p>オーバラップ、接触、Withinは全て、ジオメトリが非接続でないことを意味しています。これらがTRUEを返す場合は、空間的に非接続ではありません。非接続は、空間インタセクトについてFALSEとなります。</p><div class="important" title="重要" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[重要]" src="images/important.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">GEOMETRYCOLLECTION</code>を引数にして呼ばないでください。</p></td></tr></table></div><p>GEOSモジュールによって実現しています。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はインデクスを使用しません。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ご注意: これは論理値を返して整数を返さないのが「許される」版です。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です s2.1.1.2 //s2.1.13.3
			- a.Relate(b, 'FF*FF****')</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.26</p></div><div class="refsection" title="例"><a name="id287048987"></a><h2>例</h2><pre class="programlisting">SELECT ST_Disjoint('POINT(0 0)'::geometry, 'LINESTRING ( 2 0, 0 2 )'::geometry);
 st_disjoint
---------------
 t
(1 row)
SELECT ST_Disjoint('POINT(0 0)'::geometry, 'LINESTRING ( 0 0, 0 2 )'::geometry);
 st_disjoint
---------------
 f
(1 row)
		</pre></div><div class="refsection" title="関連情報"><a name="id287048998"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Intersects" title="ST_Intersects">ST_Intersects</a>ST_Intersects</p></div></div><div class="refentry" title="ST_Distance"><div class="refentry.separator"><hr></div><a name="ST_Distance"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Distance ? ジオメトリ型については、2つのジオメトリの、2次元の最小デカルト距離(空間参照系に基づきます)を、投影法の単位で返します。ジオグラフィ型については、デフォルトでは、2つのジオメトリ間の回転楕円体上の最小距離をメートル単位で返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_Distance</b>(</code>geometry 
			<var class="pdparam">g1</var>, geometry 
			<var class="pdparam">g2</var><code>)</code>;</p><p><code class="funcdef">float <b class="fsfunc">ST_Distance</b>(</code>geography 
			<var class="pdparam">gg1</var>, geography 
			<var class="pdparam">gg2</var><code>)</code>;</p><p><code class="funcdef">float <b class="fsfunc">ST_Distance</b>(</code>geography 
			<var class="pdparam">gg1</var>, geography 
			<var class="pdparam">gg2</var>, boolean 
			<var class="pdparam">use_spheroid</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287049155"></a><h2>説明</h2><p>ジオメトリ型について、2つのジオメトリの、2次元の最小デカルト距離(空間参照系に基づきます)を、投影法の単位で返します。ジオグラフィ型について、デフォルトでは、2つのジオメトリ間の、WGS84回転楕円体上の最小距離をメートル単位で返します。回転楕円体の替わりに球面による答えを得るにはFALSEを渡します。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.23</p><p>初出: 1.5.0 1.5でジオグラフィが導入されました。大きいジオメトリや頂点の多いジオメトリについての速度が改善しました。</p></div><div class="refsection" title="例"><a name="id287049194"></a><h2>例</h2><pre class="programlisting">
-- ジオメトリの例 - 平面上の度単位 4326はWGS84経度緯度 単位は度
SELECT ST_Distance(
		ST_GeomFromText('POINT(-72.1235 42.3521)',4326),
		ST_GeomFromText('LINESTRING(-72.1260 42.45, -72.123 42.1546)', 4326)
	);
st_distance
-----------------
0.00150567726382282

-- Geometry example - units in meters (SRID: 26986 Massachusetts state plane meters) (most accurate for Massachusetts)
SELECT ST_Distance(
			ST_Transform(ST_GeomFromText('POINT(-72.1235 42.3521)',4326),26986),
			ST_Transform(ST_GeomFromText('LINESTRING(-72.1260 42.45, -72.123 42.1546)', 4326),26986)
		);
st_distance
-----------------
123.797937878454

-- ジオメトリの例 - メートル単位 (SRID: 2163 米国ナショナルアトラス正積図法)
-- (最も精度が低い)
SELECT ST_Distance(
			ST_Transform(ST_GeomFromText('POINT(-72.1235 42.3521)',4326),2163),
			ST_Transform(ST_GeomFromText('LINESTRING(-72.1260 42.45, -72.123 42.1546)', 4326),2163)
		);

st_distance
------------------
126.664256056812

-- ジオグラフィの例 - 同じですがメートル単位になっている点に注意
-- 球面を使うと若干速度が向上し精度が低下します
SELECT ST_Distance(gg1, gg2) As spheroid_dist, ST_Distance(gg1, gg2, false) As sphere_dist 
FROM (SELECT
	ST_GeographyFromText('SRID=4326;POINT(-72.1235 42.3521)') As gg1,
	ST_GeographyFromText('SRID=4326;LINESTRING(-72.1260 42.45, -72.123 42.1546)') As gg2
	) As foo  ;

  spheroid_dist   |   sphere_dist
------------------+------------------
 123.802076746848 | 123.475736916397

</pre></div><div class="refsection" title="関連情報"><a name="id287049205"></a><h2>関連情報</h2><p><a class="xref" href="#ST_3DDistance" title="ST_3DDistance">ST_3DDistance</a>, <a class="xref" href="#ST_DWithin" title="ST_DWithin">ST_DWithin</a>, <a class="xref" href="#ST_Distance_Sphere" title="ST_Distance_Sphere">ST_Distance_Sphere</a>, <a class="xref" href="#ST_Distance_Spheroid" title="ST_Distance_Spheroid">ST_Distance_Spheroid</a>, <a class="xref" href="#ST_MaxDistance" title="ST_MaxDistance">ST_MaxDistance</a>, <a class="xref" href="#ST_Transform" title="ST_Transform">ST_Transform</a></p></div></div><div class="refentry" title="ST_HausdorffDistance"><div class="refentry.separator"><hr></div><a name="ST_HausdorffDistance"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_HausdorffDistance ? 2つのジオメトリ間のハウスドルフ距離を返します。基本的にジオメトリが似ているかどうかを計測するものです。単位はジオメトリの空間参照系の単位です。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_HausdorffDistance</b>(</code>geometry 
			<var class="pdparam">g1</var>, geometry 
			<var class="pdparam">g2</var><code>)</code>;</p><p><code class="funcdef">float <b class="fsfunc">ST_HausdorffDistance</b>(</code>geometry 
			<var class="pdparam">g1</var>, geometry 
			<var class="pdparam">g2</var>, float
			<var class="pdparam">densifyFrac</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287049350"></a><h2>説明</h2><p>「離散ハウスドルフ距離」とみなすことができる距離基準を計算します。これは、一つのジオメトリの離散点に制限されたハウスドルフ距離です。<a class="ulink" href="http://en.wikipedia.org/wiki/Hausdorff_distance" target="_top">Hausdorff distanceに関するWikiPedia英語版の記事</a>や<a class="ulink" href="http://lin-ear-th-inking.blogspot.com/2009/01/computing-geometric-similarity.html" target="_top">Martin Davis note on how Hausdorff Distance calculation was used to prove correctness of the CascadePolygonUnion approach.</a>などを参照して下さい。</p><p>densifyFracが指定された際には、この関数は離散ハウスドルフ距離を計算する前に線分への頂点の挿入を行います。densifyFracパラメータは頂点の挿入を行うための小数です。総延長の小数が与えられた値に近くなるように、線分ごとに等しい長さに分割します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>現在の実装では、頂点のみを離散位置としてサポートします。任意の密度でポイントを使用することができるよう拡張されています。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>このアルゴリズムは標準的なハウスドルフ距離と等価では*ありません*。しかし、使用可能な場面の大部分で正しくなる近似計算がなされています。重要なものに、それぞれが概ね平行で概ね等しい長さのラインストリングがあります。これはラインのマッチングに使う基準です。</p></td></tr></table></div><p>初出: 1.5.0 - GEOS 3.2.0以上が必要です。</p></div><div class="refsection" title="例"><a name="id287049390"></a><h2>例</h2><pre class="programlisting">postgis=# SELECT st_HausdorffDistance(
				'LINESTRING (0 0, 2 0)'::geometry,
				'MULTIPOINT (0 1, 1 0, 2 1)'::geometry);
 st_hausdorffdistance
 ----------------------
					 1
(1 row)
			</pre><pre class="programlisting">postgis=# SELECT st_hausdorffdistance('LINESTRING (130 0, 0 0, 0 150)'::geometry, 'LINESTRING (10 10, 10 150, 130 10)'::geometry, 0.5);
 st_hausdorffdistance
 ----------------------
					70
(1 row)
			</pre></div></div><div class="refentry" title="ST_MaxDistance"><div class="refentry.separator"><hr></div><a name="ST_MaxDistance"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MaxDistance ? 2つのジオメトリ間の2次元距離の最大値を、投影法の単位で返します。 </p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_MaxDistance</b>(</code>geometry  <var class="pdparam">g1</var>, geometry  <var class="pdparam">g2</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287049452"></a><h2>説明</h2><p>2つのラインストリングの最大2次元距離を投影法の単位で返します。g1とg2が同じジオメトリの場合には、ジオメトリ内の最も遠くなる頂点の距離を返します。</p><p>初出: 1.5.0</p></div><div class="refsection" title="例"><a name="id287049466"></a><h2>例</h2><pre class="programlisting">postgis=# SELECT ST_MaxDistance('POINT(0 0)'::geometry, 'LINESTRING ( 2 0, 0 2 )'::geometry);
   st_maxdistance
-----------------
 2
(1 row)

postgis=# SELECT ST_MaxDistance('POINT(0 0)'::geometry, 'LINESTRING ( 2 2, 2 2 )'::geometry);
  st_maxdistance  
------------------
 2.82842712474619
(1 row)</pre></div><div class="refsection" title="関連情報"><a name="id287049479"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Distance" title="ST_Distance">ST_Distance</a>, <a class="xref" href="#ST_LongestLine" title="ST_LongestLine">ST_LongestLine</a></p></div></div><div class="refentry" title="ST_Distance_Sphere"><div class="refentry.separator"><hr></div><a name="ST_Distance_Sphere"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Distance_Sphere ? 2つの経度緯度ジオメトリ間の最小距離をメートル単位で返します。半径6370986メートルの球面を用います。xref linkend="ST_Distance_Spheroid" /&gt;より早いですが精度が低くなります。PostGIS 1.5より前では、ポイントについてのみ実装されていました。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_Distance_Sphere</b>(</code>geometry  <var class="pdparam">geomlonlatA</var>, geometry  <var class="pdparam">geomlonlatB</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287049541"></a><h2>説明</h2><p>二つの経度緯度ジオメトリ間の最小距離をメートル単位で返します。半径6370986メートルの球面を用います<a class="xref" href="#ST_Distance_Spheroid" title="ST_Distance_Spheroid">ST_Distance_Spheroid</a>より早いですが精度が低くなります。PostGIS 1.5より前では、ポイントについてのみ実装されていました。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数は現在のところ、ジオメトリのSRIDを見ずに、常にWGS84経度緯度を仮定します。以前の版ではポイントのみ対応していました。</p></td></tr></table></div><p>初出: 1.5 - ポイント以外のジオメトリが導入されました。以前の版ではポイントでのみ動作しました。</p></div><div class="refsection" title="例"><a name="id287049563"></a><h2>例</h2><pre class="programlisting">SELECT round(CAST(ST_Distance_Sphere(ST_Centroid(the_geom), ST_GeomFromText('POINT(-118 38)',4326)) As numeric),2) As dist_meters,
round(CAST(ST_Distance(ST_Transform(ST_Centroid(the_geom),32611),
		ST_Transform(ST_GeomFromText('POINT(-118 38)', 4326),32611)) As numeric),2) As dist_utm11_meters,
round(CAST(ST_Distance(ST_Centroid(the_geom), ST_GeomFromText('POINT(-118 38)', 4326)) As numeric),5) As dist_degrees,
round(CAST(ST_Distance(ST_Transform(the_geom,32611),
		ST_Transform(ST_GeomFromText('POINT(-118 38)', 4326),32611)) As numeric),2) As min_dist_line_point_meters
FROM
	(SELECT ST_GeomFromText('LINESTRING(-118.584 38.374,-118.583 38.5)', 4326) As the_geom) as foo;
	 dist_meters | dist_utm11_meters | dist_degrees | min_dist_line_point_meters
	-------------+-------------------+--------------+----------------------------
		70424.47 |          70438.00 |      0.72900 |                   65871.18

	</pre></div><div class="refsection" title="関連情報"><a name="id287049576"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Distance" title="ST_Distance">ST_Distance</a>, <a class="xref" href="#ST_Distance_Spheroid" title="ST_Distance_Spheroid">ST_Distance_Spheroid</a></p></div></div><div class="refentry" title="ST_Distance_Spheroid"><div class="refentry.separator"><hr></div><a name="ST_Distance_Spheroid"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Distance_Spheroid ? 指定した回転楕円体による、2つのジオメトリ間の最小距離を返します。PostGIS 1.5より前ではポイントのみサポートされていました。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_Distance_Spheroid</b>(</code>geometry  <var class="pdparam">geomlonlatA</var>, geometry  <var class="pdparam">geomlonlatB</var>, spheroid  <var class="pdparam">measurement_spheroid</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287049681"></a><h2>説明</h2><p>指定した回転楕円体による、2つのジオメトリ間の最小距離を、メートル単位で返します。回転楕円体の説明については、<a class="xref" href="#ST_Length_Spheroid" title="ST_Length_Spheroid">ST_Length_Spheroid</a>を参照して下さい。PostGIS 1.5より前ではポイントのみサポートされていました。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数は現在のところ、ジオメトリのSRIDを見ずに、常に関数に渡される回転楕円体の座標で表現されていると仮定します。以前の版ではポイントのみのサポートでした。</p></td></tr></table></div><p>初出: 1.5 - ポイント以外のジオメトリ型が導入されました。以前の版ではポイントでのみ動作しました。</p></div><div class="refsection" title="例"><a name="id287049704"></a><h2>例</h2><pre class="programlisting">SELECT round(CAST(
		ST_Distance_Spheroid(ST_Centroid(the_geom), ST_GeomFromText('POINT(-118 38)',4326), 'SPHEROID["WGS 84",6378137,298.257223563]')
			As numeric),2) As dist_meters_spheroid,
		round(CAST(ST_Distance_Sphere(ST_Centroid(the_geom), ST_GeomFromText('POINT(-118 38)',4326)) As numeric),2) As dist_meters_sphere,
round(CAST(ST_Distance(ST_Transform(ST_Centroid(the_geom),32611),
		ST_Transform(ST_GeomFromText('POINT(-118 38)', 4326),32611)) As numeric),2) As dist_utm11_meters
FROM
	(SELECT ST_GeomFromText('LINESTRING(-118.584 38.374,-118.583 38.5)', 4326) As the_geom) as foo;
 dist_meters_spheroid | dist_meters_sphere | dist_utm11_meters
----------------------+--------------------+-------------------
			 70454.92 |           70424.47 |          70438.00

	</pre></div><div class="refsection" title="関連情報"><a name="id287049717"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Distance" title="ST_Distance">ST_Distance</a>, <a class="xref" href="#ST_Distance_Sphere" title="ST_Distance_Sphere">ST_Distance_Sphere</a></p></div></div><div class="refentry" title="ST_DFullyWithin"><div class="refentry.separator"><hr></div><a name="ST_DFullyWithin"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_DFullyWithin ? 全てのジオメトリが、指定したジオメトリから指定した距離内にある場合に、TRUEを返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_DFullyWithin</b>(</code>geometry 
			<var class="pdparam">g1</var>, geometry 
			<var class="pdparam">g2</var>, double precision 
			<var class="pdparam">distance</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287049788"></a><h2>説明</h2><p>全てのジオメトリが、指定したジオメトリから指定した距離内に場合に、TRUEを返します。距離はジオメトリの空間参照系で定義されている単位になります。この関数が意味のあるものにするためには、与えられるジオメトリは両方とも同じ座標系で同じSRIDを持つ必要があります。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数の呼び出しによって、ジオメトリで使用可能なインデクスを使用したバウンディングボックスの比較が自動的に行われます。</p></td></tr></table></div><p>初出: 1.5.0</p></div><div class="refsection" title="例"><a name="id287049808"></a><h2>例</h2><pre class="programlisting">postgis=# SELECT ST_DFullyWithin(geom_a, geom_b, 10) as DFullyWithin10, ST_DWithin(geom_a, geom_b, 10) as DWithin10, ST_DFullyWithin(geom_a, geom_b, 20) as DFullyWithin20 from 
		(select ST_GeomFromText('POINT(1 1)') as geom_a,ST_GeomFromText('LINESTRING(1 5, 2 7, 1 9, 14 12)') as geom_b) t1;
   
-----------------
 DFullyWithin10 | DWithin10 | DFullyWithin20 |
---------------+----------+---------------+
 f             | t        | t             |  </pre></div><div class="refsection" title="関連情報"><a name="id287049818"></a><h2>関連情報</h2><p><a class="xref" href="#ST_MaxDistance" title="ST_MaxDistance">ST_MaxDistance</a>, <a class="xref" href="#ST_DWithin" title="ST_DWithin">ST_DWithin</a></p></div></div><div class="refentry" title="ST_DWithin"><div class="refentry.separator"><hr></div><a name="ST_DWithin"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_DWithin ? ジオメトリが、指定したジオメトリから指定した距離内にある場合に、TRUEを返します。ジオメトリについては、距離は空間参照系で定義されている単位になります。ジオグラフィについては、メートル単位で、デフォルトではuse_spheroid=true(回転楕円体を使った計算)となり、速いチェックをするにはuse_spheroid=falseとして球面を使って計算します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_DWithin</b>(</code>geometry 
				<var class="pdparam">g1</var>, geometry 
				<var class="pdparam">g2</var>, double precision 
				<var class="pdparam">distance_of_srid</var><code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">ST_DWithin</b>(</code>geography 
				<var class="pdparam">gg1</var>, geography 
				<var class="pdparam">gg2</var>, double precision 
				<var class="pdparam">distance_meters</var><code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">ST_DWithin</b>(</code>geography 
				<var class="pdparam">gg1</var>, geography 
				<var class="pdparam">gg2</var>, double precision 
				<var class="pdparam">distance_meters</var>, boolean 
				<var class="pdparam">use_spheroid</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287049970"></a><h2>説明</h2><p>ジオメトリが、指定したジオメトリから指定した距離内にある場合に、TRUEを返します。</p><p>ジオメトリについては、距離は空間参照系で定義されている単位になります。この関数が意味を持つためには、与えられるジオメトリは両方とも同じ座標系で同じSRIDを持つ必要があります。</p><p>ジオグラフィについては、メートル単位で、デフォルトではuse_spheroid=true(回転楕円体を使った計算)となり、速いチェックをするにはuse_spheroid=falseとして球面を使って計算します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数の呼び出しによって、ジオメトリで使用可能なインデクスを使用したバウンディングボックスの比較が自動的に行われます。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>1.3より前では、ST_Expandは一般的に&amp;&amp;とST_Distanceとを併用して、同じ効果を得ていました。1.3.4より前では、この関数は、基本的にこのやり方の短縮版でした。1.3.4から、ST_DWithinは、大きなバッファ領域について前の版より効果的になる、より短縮した距離関数を使っています。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>3次元ジオメトリの場合にはST_3DDWithinを使います。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です</p><p>初出: 1.5.0 ジオグラフィが導入されました。 </p></div><div class="refsection" title="例"><a name="id287050021"></a><h2>例</h2><pre class="programlisting">
-- それぞれの学校から3000単位以内の、最も近い病院の探索。
-- インデクスを使用しないST_Distanceの処理に渡す学校リストを制限するために、
-- ST_DWithin探索でインデクスを使います。
-- 空間参照系の単位がメートルの場合は、単位はメートルになります。
SELECT DISTINCT ON (s.gid) s.gid, s.school_name, s.the_geom, h.hospital_name
	FROM schools s
		LEFT JOIN hospitals h ON ST_DWithin(s.the_geom, h.the_geom, 3000)
	ORDER BY s.gid, ST_Distance(s.the_geom, h.the_geom);
-- 病院が近くに無い学校の探索。
-- 病院が3000単位内に無い全ての学校を探索します。
-- 単位は空間参照系の単位です(メートル、フィート、度)
SELECT s.gid, s.school_name
	FROM schools s
		LEFT JOIN hospitals h ON ST_DWithin(s.the_geom, h.the_geom, 3000)
	WHERE h.gid IS NULL;
			  </pre></div><div class="refsection" title="関連情報"><a name="id287050032"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Distance" title="ST_Distance">ST_Distance</a>, <a class="xref" href="#ST_Expand" title="ST_Expand">ST_Expand</a></p></div></div><div class="refentry" title="ST_Equals"><div class="refentry.separator"><hr></div><a name="ST_Equals"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Equals ? 与えられたジオメトリ表現が同じ場合にはTRUEを返します。方向は無視されます。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_Equals</b>(</code>geometry  <var class="pdparam">A</var>, geometry  <var class="pdparam">B</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287050093"></a><h2>説明</h2><p>与えられたジオメトリが「空間的に同じ」場合には、TRUEを返します。'='よりも「よりよい」答を得るために使います。空間的に同じということは、ST_Within(A,B) = trueかつST_Within(B,A) = trueとなります。また、ポイントの順序が違っても同じジオメトリ構造となります。構成ポイントの順序の確認にはST_OrderingEqualsを使用します(ST_OrderingEqualsはポイントのオーダが同じかを確認するよりも若干厳しくなります)。</p><div class="important" title="重要" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[重要]" src="images/important.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数は、どちらのジオメトリも不正である場合は、バイナリで同じ場合であっても、FALSEを返します。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です s2.1.1.2</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.24</p></div><div class="refsection" title="例"><a name="id287050206"></a><h2>例</h2><pre class="programlisting">SELECT ST_Equals(ST_GeomFromText('LINESTRING(0 0, 10 10)'),
		ST_GeomFromText('LINESTRING(0 0, 5 5, 10 10)'));
 st_equals
-----------
 t
(1 row)

SELECT ST_Equals(ST_Reverse(ST_GeomFromText('LINESTRING(0 0, 10 10)')),
		ST_GeomFromText('LINESTRING(0 0, 5 5, 10 10)'));
 st_equals
-----------
 t
(1 row)
</pre></div><div class="refsection" title="関連情報"><a name="id287050217"></a><h2>関連情報</h2><p><a class="xref" href="#ST_IsValid" title="ST_IsValid">ST_IsValid</a>, <a class="xref" href="#ST_OrderingEquals" title="ST_OrderingEquals">ST_OrderingEquals</a>, <a class="xref" href="#ST_Reverse" title="ST_Reverse">ST_Reverse</a>, <a class="xref" href="#ST_Within" title="ST_Within">ST_Within</a></p></div></div><div class="refentry" title="ST_HasArc"><div class="refentry.separator"><hr></div><a name="ST_HasArc"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_HasArc ? ジオメトリまたはジオメトリコレクションが曲線ストリングを含む場合に、TRUEを返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_HasArc</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287050278"></a><h2>説明</h2><p>ジオメトリまたはジオメトリコレクションが曲線ストリングを含む場合に、TRUEを返します。</p><p>初出: 1.2.3?</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p></div><div class="refsection" title="例"><a name="id287050314"></a><h2>例</h2><pre class="programlisting">SELECT ST_HasArc(ST_Collect('LINESTRING(1 2, 3 4, 5 6)', 'CIRCULARSTRING(1 1, 2 3, 4 5, 6 7, 5 6)'));
		st_hasarc
		--------
		t
		</pre></div><div class="refsection" title="関連情報"><a name="id287050327"></a><h2>関連情報</h2><p><a class="xref" href="#ST_CurveToLine" title="ST_CurveToLine">ST_CurveToLine</a>, <a class="xref" href="#ST_LineToCurve" title="ST_LineToCurve">ST_LineToCurve</a></p></div></div><div class="refentry" title="ST_Intersects"><div class="refentry.separator"><hr></div><a name="ST_Intersects"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Intersects ? ジオメトリ/ジオグラフィが「2次元空間で空間的にインタセクトする」(空間に共有部分がある)場合には、TRUEを返します。そうでない(非接続)場合はFALSEを返します。ジオグラフィについては、許容量は0.00001メートルです(どの閉じた点でもインタセクトを考慮されます)。
			</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_Intersects</b>(</code>
						geometry
						<var class="pdparam">geomA</var>
					, 
						geometry
						<var class="pdparam">geomB</var>
					<code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">ST_Intersects</b>(</code>
						geography
						<var class="pdparam">geogA</var>
					, 
						geography
						<var class="pdparam">geogB</var>
					<code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287050424"></a><h2>説明</h2><p>オーバラップ、接触、Withinは全て、ジオメトリがインタセクトしていることを意味しています。これらがTRUEを返す場合は、空間的にインタセクトしています。非接続は、空間インタセクトについてFALSEとなります。</p><div class="important" title="重要" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[重要]" src="images/important.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ジオメトリ版では、<code class="varname">GEOMETRYCOLLECTION</code>を引数にして呼ばないでください。ジオグラフィ版では、Distanceの実装にかぶせられる薄いラッパですので、GEOMETRYCOLLECTIONをサポートしています。</p></td></tr></table></div><p>ジオメトリについては、GEOSモジュールで実現しています。ジオグラフィについてはネイティブです。</p><p>初出: 1.5 ジオメトリが導入されました。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数の呼び出しによって、ジオメトリで使用可能なインデクスを使用したバウンディングボックスの比較が自動的に行われます。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ジオグラフィでは、この関数は0.00001メートルの距離許容を持ち、回転楕円体計算よりむしろ球面を使います。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ご注意: これは論理値を返して整数を返さないのが「許される」版です。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です s2.1.1.2 //s2.1.13.3 
			  - ST_Intersects(g1, g2 ) --&gt; Not (ST_Disjoint(g1, g2 ))
			</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.27</p></div><div class="refsection" title="ジオメトリの例"><a name="id287050499"></a><h2>ジオメトリの例</h2><pre class="programlisting">SELECT ST_Intersects('POINT(0 0)'::geometry, 'LINESTRING ( 2 0, 0 2 )'::geometry);
 st_intersects
---------------
 f
(1 row)
SELECT ST_Intersects('POINT(0 0)'::geometry, 'LINESTRING ( 0 0, 0 2 )'::geometry);
 st_intersects
---------------
 t
(1 row)
		</pre></div><div class="refsection" title="ジオグラフィの例"><a name="id287050509"></a><h2>ジオグラフィの例</h2><pre class="programlisting">SELECT ST_Intersects(
		ST_GeographyFromText('SRID=4326;LINESTRING(-43.23456 72.4567,-43.23456 72.4568)'),
		ST_GeographyFromText('SRID=4326;POINT(-43.23456 72.4567772)')
		);

 st_intersects
---------------
t
</pre></div><div class="refsection" title="関連情報"><a name="id287050521"></a><h2>関連情報</h2><p> <a class="xref" href="#ST_3DIntersects" title="ST_3DIntersects">ST_3DIntersects</a>, <a class="xref" href="#ST_Disjoint" title="ST_Disjoint">ST_Disjoint</a></p></div></div><div class="refentry" title="ST_Length"><div class="refentry.separator"><hr></div><a name="ST_Length"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Length ? LINESTRINGまたはMULTILINESTRINGの場合に、ジオメトリの2次元長を返します。ジオメトリでは、単位は空間参照系の単位です。ジオグラフィでは、メートル単位です(回転楕円体がデフォルトです)。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_Length</b>(</code>geometry <var class="pdparam">a_2dlinestring</var><code>)</code>;</p><p><code class="funcdef">float <b class="fsfunc">ST_Length</b>(</code>geography <var class="pdparam">geog</var>, boolean <var class="pdparam">use_spheroid=true</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287050600"></a><h2>説明</h2><p>ジオメトリについては、LINESTRING, MULTILINESTRING, ST_Curve, ST_MultiCurveの場合には、ジオメトリの2次元デカルト距離を返します。領域ジオメトリに対しては0を返します。領域ジオメトリに対してはST_Perimeterを使います。計測単位はジオメトリの空間参照系の単位になります。ジオグラフィについては、領域ジオメトリに対する周囲長関数としての働きもします。</p><p>現在は、ジオメトリに対してはST_Length2Dの別名ですが、高次元サポートに変更されるかも知れません。</p><div class="warning" title="警告" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>変更: 2.0.0 仕様変更 -- 以前の版では、ジオグラフィ型のPOLYGON/MULTIPOLYGONに対して周囲長を返していましたが、2.0.0では、ジオメトリでの0を返すように変更されました。ポリゴンの周囲長を求めるにはST_Perimeterを使用して下さい。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ジオグラフィに対しては、回転楕円体面での計測を行います。速くなる反面精度が下がる球面を使用するには、ST_Length(gg,false)；とします。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です s2.1.5.1</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 7.1.2, 9.3.4</p><p>初出: 1.5.0 ジオグラフィが導入されました。</p></div><div class="refsection" title="ジオメトリの例"><a name="id287050688"></a><h2>ジオメトリの例</h2><p>フィート単位でラインストリングの長さを返します。2249がフィート単位のマサチューセッツ州平面ですので、フィート単位になります。</p><pre class="programlisting">
SELECT ST_Length(ST_GeomFromText('LINESTRING(743238 2967416,743238 2967450,743265 2967450,
743265.625 2967416,743238 2967416)',2249));
st_length
---------
 122.630744000095


-- WGS84のラインストリングからメートル単位のマサチューセッツ州平面への変換
SELECT ST_Length(
	ST_Transform(
		ST_GeomFromEWKT('SRID=4326;LINESTRING(-72.1260 42.45, -72.1240 42.45666, -72.123 42.1546)'),
		26986
	)
);
st_length
---------
34309.4563576191
			</pre></div><div class="refsection" title="ジオグラフィの例"><a name="id287050701"></a><h2>ジオグラフィの例 </h2><p>WGS84ジオグラフィのラインの長さを返します。</p><pre class="programlisting">
			-- default calculation is using a sphere rather than spheroid
SELECT ST_Length(the_geog) As length_spheroid,  ST_Length(the_geog,false) As length_sphere
FROM (SELECT ST_GeographyFromText(
'SRID=4326;LINESTRING(-72.1260 42.45, -72.1240 42.45666, -72.123 42.1546)') As the_geog)
 As foo;
 length_spheroid  |  length_sphere
------------------+------------------
 34310.5703627305 | 34346.2060960742
(1 row)
			</pre></div><div class="refsection" title="関連情報"><a name="id287050716"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeographyFromText" title="ST_GeographyFromText">ST_GeographyFromText</a>, <a class="xref" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a>, <a class="xref" href="#ST_Length_Spheroid" title="ST_Length_Spheroid">ST_Length_Spheroid</a>, <a class="xref" href="#ST_Perimeter" title="ST_Perimeter">ST_Perimeter</a>, <a class="xref" href="#ST_Transform" title="ST_Transform">ST_Transform</a></p></div></div><div class="refentry" title="ST_Length2D"><div class="refentry.separator"><hr></div><a name="ST_Length2D"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Length2D ? LINESTRINGまたはMULTILINESTRINGに対して、ジオメトリの2次元長を返します。これは<code class="varname">ST_Length</code>の別名です。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_Length2D</b>(</code>geometry  <var class="pdparam">a_2dlinestring</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287050782"></a><h2>説明</h2><p>LINESTRINGまたはMULTILINESTRINGに対して、ジオメトリの2次元長を返します。これは<code class="varname">ST_Length</code>の別名です。</p></div><div class="refsection" title="関連情報"><a name="id287050797"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Length" title="ST_Length">ST_Length</a>, <a class="xref" href="#ST_3DLength" title="ST_3DLength">ST_3DLength</a></p></div></div><div class="refentry" title="ST_3DLength"><div class="refentry.separator"><hr></div><a name="ST_3DLength"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_3DLength ? LINESTRINGまたはMULTILINESTRINGに対して、ジオメトリの3次元長または2次元長を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_3DLength</b>(</code>geometry  <var class="pdparam">a_3dlinestring</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287050851"></a><h2>説明</h2><p>LINESTRINGまたはMULTILINESTRINGに対して、ジオメトリの3次元長または2次元長を返します。2次元ラインについては、2次元長を返します(ST_LengthやST_Length2Dと同じです)。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p>変更: 2.0.0 以前の版ではST_Length3Dと呼ばれていました。</p></div><div class="refsection" title="例"><a name="id287050875"></a><h2>例</h2><p>3次元ケーブルのフィート単位の長さを返します。2249がフィート単位のマサチューセッツ州平面ですので、フィート単位になります。</p><pre class="programlisting">
SELECT ST_3DLength(ST_GeomFromText('LINESTRING(743238 2967416 1,743238 2967450 1,743265 2967450 3,
743265.625 2967416 3,743238 2967416 3)',2249));
ST_3DLength
-----------
122.704716741457
		</pre></div><div class="refsection" title="関連情報"><a name="id287050892"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Length" title="ST_Length">ST_Length</a>, <a class="xref" href="#ST_Length2D" title="ST_Length2D">ST_Length2D</a></p></div></div><div class="refentry" title="ST_Length_Spheroid"><div class="refentry.separator"><hr></div><a name="ST_Length_Spheroid"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Length_Spheroid ? LINESTRINGまたはMULTILINESTRINGに対して、回転楕円体上の2次元長または3次元長を返します。ジオメトリの座標が経度/緯度で、投影変換なしに距離を求める場合に使います。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_Length_Spheroid</b>(</code>geometry  <var class="pdparam">a_linestring</var>, spheroid  <var class="pdparam">a_spheroid</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287050953"></a><h2>説明</h2><p>回転楕円体上のジオメトリの長さを返します。ジオメトリの座標が経度/緯度で、投影変換なしに距離を求める場合に使います。回転楕円体は独立したデータベースタイプで、次のように構成されています。</p><div class="literallayout"><p>SPHEROID[&lt;名称&gt;,&lt;長軸半径&gt;,&lt;扁平率の逆数&gt;]</p></div><div class="literallayout"><p>SPHEROID["GRS_1980",6378137,298.257222101]</p></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>MULTILINESTRINGかLINESTRINGでない場合は0が返されます。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p></div><div class="refsection" title="例"><a name="id287050990"></a><h2>例</h2><pre class="programlisting">SELECT ST_Length_Spheroid( geometry_column,
			  'SPHEROID["GRS_1980",6378137,298.257222101]' )
			  FROM geometry_table;

SELECT ST_Length_Spheroid( the_geom, sph_m ) As tot_len,
ST_Length_Spheroid(ST_GeometryN(the_geom,1), sph_m) As len_line1,
ST_Length_Spheroid(ST_GeometryN(the_geom,2), sph_m) As len_line2
			  FROM (SELECT ST_GeomFromText('MULTILINESTRING((-118.584 38.374,-118.583 38.5),
	(-71.05957 42.3589 , -71.061 43))') As the_geom,
CAST('SPHEROID["GRS_1980",6378137,298.257222101]' As spheroid) As sph_m)  as foo;
	tot_len      |    len_line1     |    len_line2
------------------+------------------+------------------
 85204.5207562955 | 13986.8725229309 | 71217.6482333646

 --3D
SELECT ST_Length_Spheroid( the_geom, sph_m ) As tot_len,
ST_Length_Spheroid(ST_GeometryN(the_geom,1), sph_m) As len_line1,
ST_Length_Spheroid(ST_GeometryN(the_geom,2), sph_m) As len_line2
			  FROM (SELECT ST_GeomFromEWKT('MULTILINESTRING((-118.584 38.374 20,-118.583 38.5 30),
	(-71.05957 42.3589 75, -71.061 43 90))') As the_geom,
CAST('SPHEROID["GRS_1980",6378137,298.257222101]' As spheroid) As sph_m)  as foo;

	 tot_len      |    len_line1    |    len_line2
------------------+-----------------+------------------
 85204.5259107402 | 13986.876097711 | 71217.6498130292

</pre></div><div class="refsection" title="関連情報"><a name="id287051003"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeometryN" title="ST_GeometryN">ST_GeometryN</a>, <a class="xref" href="#ST_Length" title="ST_Length">ST_Length</a>, <a class="xref" href="#ST_3DLength_Spheroid" title="ST_3DLength_Spheroid">ST_3DLength_Spheroid</a></p></div></div><div class="refentry" title="ST_Length2D_Spheroid"><div class="refentry.separator"><hr></div><a name="ST_Length2D_Spheroid"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Length2D_Spheroid ? LINESTRINGまたはMULTILINESTRINGに対して、回転楕円体上の2次元長を返します。ジオメトリの座標が経度/緯度で、投影変換なしに距離を求める場合に使います。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_Length2D_Spheroid</b>(</code>geometry  <var class="pdparam">a_linestring</var>, spheroid  <var class="pdparam">a_spheroid</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287051239"></a><h2>説明</h2><p>LINESTRINGまたはMULTILINESTRINGに対して、回転楕円体上の2次元長を返します。ジオメトリの座標が経度/緯度で、投影変換なしに距離を求める場合に使います。回転楕円体は独立したデータベースタイプで、次のように構成されています。</p><div class="literallayout"><p>SPHEROID[&lt;名称&gt;,&lt;長軸半径&gt;,&lt;扁平率の逆数&gt;]</p></div><div class="literallayout"><p>SPHEROID["GRS_1980",6378137,298.257222101]</p></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>MULTILINESTRINGかLINESTRINGでない場合は0が返されます。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数は<a class="xref" href="#ST_Length_Spheroid" title="ST_Length_Spheroid">ST_Length_Spheroid</a>と<a class="xref" href="#ST_3DLength_Spheroid" title="ST_3DLength_Spheroid">ST_3DLength_Spheroid</a>によく似ていますが、計算でZ値は考慮されない点が異なります。</p></td></tr></table></div></div><div class="refsection" title="例"><a name="id287051309"></a><h2>例</h2><pre class="programlisting">SELECT ST_Length2D_Spheroid( geometry_column,
			  'SPHEROID["GRS_1980",6378137,298.257222101]' )
			  FROM geometry_table;

SELECT ST_Length2D_Spheroid( the_geom, sph_m ) As tot_len,
ST_Length2D_Spheroid(ST_GeometryN(the_geom,1), sph_m) As len_line1,
ST_Length2D_Spheroid(ST_GeometryN(the_geom,2), sph_m) As len_line2
			  FROM (SELECT ST_GeomFromText('MULTILINESTRING((-118.584 38.374,-118.583 38.5),
	(-71.05957 42.3589 , -71.061 43))') As the_geom,
CAST('SPHEROID["GRS_1980",6378137,298.257222101]' As spheroid) As sph_m)  as foo;
	tot_len      |    len_line1     |    len_line2
------------------+------------------+------------------
 85204.5207562955 | 13986.8725229309 | 71217.6482333646

 --3D Observe same answer
SELECT ST_Length2D_Spheroid( the_geom, sph_m ) As tot_len,
ST_Length2D_Spheroid(ST_GeometryN(the_geom,1), sph_m) As len_line1,
ST_Length2D_Spheroid(ST_GeometryN(the_geom,2), sph_m) As len_line2
			  FROM (SELECT ST_GeomFromEWKT('MULTILINESTRING((-118.584 38.374 20,-118.583 38.5 30),
	(-71.05957 42.3589 75, -71.061 43 90))') As the_geom,
CAST('SPHEROID["GRS_1980",6378137,298.257222101]' As spheroid) As sph_m)  as foo;

	tot_len      |    len_line1     |    len_line2
------------------+------------------+------------------
 85204.5207562955 | 13986.8725229309 | 71217.6482333646

</pre></div><div class="refsection" title="関連情報"><a name="id287051322"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeometryN" title="ST_GeometryN">ST_GeometryN</a>, <a class="xref" href="#ST_Length_Spheroid" title="ST_Length_Spheroid">ST_Length_Spheroid</a>, <a class="xref" href="#ST_3DLength_Spheroid" title="ST_3DLength_Spheroid">ST_3DLength_Spheroid</a></p></div></div><div class="refentry" title="ST_3DLength_Spheroid"><div class="refentry.separator"><hr></div><a name="ST_3DLength_Spheroid"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_3DLength_Spheroid ? 標高を考慮に入れて回転楕円体上の長さを計算します。これはST_Length_Spheroidの別名です。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_3DLength_Spheroid</b>(</code>geometry  <var class="pdparam">a_linestring</var>, spheroid  <var class="pdparam">a_spheroid</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287051388"></a><h2>説明</h2><p>標高を考慮に入れて回転楕円体上の長さを計算します。これはST_Length_Spheroidの別名です。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>MULTILINESTRINGかLINESTRINGでない場合は0が返されます。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はST_Length_Spheroidの別名です。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p>変更: 2.0.0 以前の版では、ST_LengthSpheroid3Dと呼ばれていました。</p></div><div class="refsection" title="例"><a name="id287051422"></a><h2>例</h2><pre class="programlisting">ST_Length_Spheroidをご覧下さい。</pre></div><div class="refsection" title="関連情報"><a name="id287051436"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeometryN" title="ST_GeometryN">ST_GeometryN</a>, <a class="xref" href="#ST_Length" title="ST_Length">ST_Length</a>, <a class="xref" href="#ST_Length_Spheroid" title="ST_Length_Spheroid">ST_Length_Spheroid</a></p></div></div><div class="refentry" title="ST_LongestLine"><div class="refentry.separator"><hr></div><a name="ST_LongestLine"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_LongestLine ? 2つのジオメトリの2次元長が最長となるポイントを返します。見つかった最長線が複数ある場合は、最初のもののみ返します。返されるラインは常にg1側を始点、g2側を終点とします。この関数が返すラインの長さは、常に始点をg1に終点をg2にそれぞれ指定した場合のST_MaxDistanceが返す値と同じになります。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_LongestLine</b>(</code>geometry 
			<var class="pdparam">g1</var>, geometry 
			<var class="pdparam">g2</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287051500"></a><h2>説明</h2><p>2つのジオメトリの2次元長が最長となるポイントを返します。</p><p>初出: 1.5.0</p></div><div class="refsection" title="例"><a name="id287051514"></a><h2>例</h2><div class="informaltable"><table border="1"><colgroup><col><col></colgroup><tbody><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_longestline01.png"><div class="caption"><p>ポイントとラインとの間の最長線</p></div></div></div><p>
				</p><pre class="programlisting">
SELECT ST_AsText(
	ST_LongestLine('POINT(100 100)'::geometry, 
		'LINESTRING (20 80, 98 190, 110 180, 50 75 )'::geometry)
	) As lline;

	
   lline
-----------------
LINESTRING(100 100,98 190)
				</pre><p>
						  </p></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_longestline02.png"><div class="caption"><p>ポリゴンとポリトンとの間の最長線</p></div></div></div><p>
				</p><pre class="programlisting">
SELECT ST_AsText(
	ST_LongestLine(
		ST_GeomFromText('POLYGON((175 150, 20 40, 
			50 60, 125 100, 175 150))'),
		ST_Buffer(ST_GeomFromText('POINT(110 170)'), 20)
		) 
	) As llinewkt;
		
   lline
-----------------
LINESTRING(20 40,121.111404660392 186.629392246051)
				</pre><p>
						</p></td></tr></tbody></table></div><div class="informaltable"><table border="1"><colgroup><col></colgroup><tbody><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_longestline03.png"><div class="caption"><p>
素敵な街のある部分から他の部分への直線移動距離(最大距離=この線の長さ)</p></div></div></div><p>
				</p><pre class="programlisting">
SELECT ST_AsText(ST_LongestLine(c.the_geom, c.the_geom)) As llinewkt, 
	ST_MaxDistance(c.the_geom,c.the_geom) As max_dist, 
	ST_Length(ST_LongestLine(c.the_geom, c.the_geom)) As lenll 
FROM (SELECT ST_BuildArea(ST_Collect(the_geom)) As the_geom
	FROM (SELECT ST_Translate(ST_SnapToGrid(ST_Buffer(ST_Point(50 ,generate_series(50,190, 50) 
			),40, 'quad_segs=2'),1), x, 0)  As the_geom 
			FROM generate_series(1,100,50) As x)  AS foo
) As c;
		
          llinewkt          |     max_dist     |      lenll
---------------------------+------------------+------------------
 LINESTRING(23 22,129 178) | 188.605408193933 | 188.605408193933
				</pre><p>
						</p></td></tr></tbody></table></div></div><div class="refsection" title="関連情報"><a name="id287051626"></a><h2>関連情報</h2><p><a class="xref" href="#ST_MaxDistance" title="ST_MaxDistance">ST_MaxDistance</a>, <a class="xref" href="#ST_ShortestLine" title="ST_ShortestLine">ST_ShortestLine</a>, <a class="xref" href="#ST_LongestLine" title="ST_LongestLine">ST_LongestLine</a></p></div></div><div class="refentry" title="ST_OrderingEquals"><div class="refentry.separator"><hr></div><a name="ST_OrderingEquals"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_OrderingEquals ? 与えられたジオメトリが同じジオメトリを示し、ポイントの順序が同じである場合に、TRUEを返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_OrderingEquals</b>(</code>geometry  <var class="pdparam">A</var>, geometry  <var class="pdparam">B</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287051691"></a><h2>説明</h2><p>ST_OrderingEqualsは、二つのジオメトリを比較して、ジオメトリが同じで、座標値が同じ順序である場合には、t (TRUE)を返し、それ以外の場合には、f (FALSE)を返します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数は、SQL-MM仕様ではなくArcSDE SQL仕様に従って実装しています。http://edndoc.esri.com/arcsde/9.1/sql_api/sqlapi3.htm#ST_OrderingEquals をご覧ください。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.43</p></div><div class="refsection" title="例"><a name="id287051755"></a><h2>例</h2><pre class="programlisting">SELECT ST_OrderingEquals(ST_GeomFromText('LINESTRING(0 0, 10 10)'),
		ST_GeomFromText('LINESTRING(0 0, 5 5, 10 10)'));
 st_orderingequals
-----------
 f
(1 row)

SELECT ST_OrderingEquals(ST_GeomFromText('LINESTRING(0 0, 10 10)'),
		ST_GeomFromText('LINESTRING(0 0, 0 0, 10 10)'));
 st_orderingequals
-----------
 t
(1 row)

SELECT ST_OrderingEquals(ST_Reverse(ST_GeomFromText('LINESTRING(0 0, 10 10)')),
		ST_GeomFromText('LINESTRING(0 0, 0 0, 10 10)'));
 st_orderingequals
-----------
 f
(1 row)
</pre></div><div class="refsection" title="関連情報"><a name="id287051766"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Equals" title="ST_Equals">ST_Equals</a>, <a class="xref" href="#ST_Reverse" title="ST_Reverse">ST_Reverse</a></p></div></div><div class="refentry" title="ST_Overlaps"><div class="refentry.separator"><hr></div><a name="ST_Overlaps"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Overlaps ? ジオメトリが共有空間を持ち、同じ次元で、かつ完全には一方に含まれていない場合に、TRUEを返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_Overlaps</b>(</code>geometry  <var class="pdparam">A</var>, geometry  <var class="pdparam">B</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287051828"></a><h2>説明</h2><p>ジオメトリが「空間的にオーバラップ」する場合に、TRUEを返します。ジオメトリがインタセクトして、かつ一方が他方を完全には含まない場合です。</p><p>GEOSモジュールによって実現しています。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">GEOMETRYCOLLECTION</code>を引数にして呼ばないでください。</p></td></tr></table></div><p>この関数の呼び出しによって、ジオメトリで使用可能なインデクスを使用したバウンディングボックスの比較が自動的に行われます。インデクスの使用を避けるには_ST_Overlapsを使います。</p><p>ご注意: これは論理値を返して整数を返さないのが「許される」版です。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です s2.1.1.2 // s2.1.13.3</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.32</p></div><div class="refsection" title="例"><a name="id287051916"></a><h2>例</h2><p>次に示す図全てで、<code class="function">ST_Overlaps</code>は<code class="varname">TRUE</code>を返します。</p><div class="informaltable"><table border="1"><colgroup><col><col><col></colgroup><tbody><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_overlaps01.png"><div class="caption"><p><code class="varname">MULTIPOINT</code> / <code class="varname">MULTIPOINT</code></p></div></div></div></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_overlaps02.png"><div class="caption"><p><code class="varname">LINESTRING</code> / <code class="varname">LINESTRING</code></p></div></div></div></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_overlaps03.png"><div class="caption"><p><code class="varname">POLYGON</code> / <code class="varname">POLYGON</code></p></div></div></div></td></tr></tbody></table></div><pre class="programlisting">-- 線上にある点は線に含まれていて、低い次元ですので、線とオーバラップもクロスもしません。

SELECT ST_Overlaps(a,b) As a_overlap_b,
	ST_Crosses(a,b) As a_crosses_b,
		ST_Intersects(a, b) As a_intersects_b, ST_Contains(b,a) As b_contains_a
FROM (SELECT ST_GeomFromText('POINT(1 0.5)') As a, ST_GeomFromText('LINESTRING(1 0, 1 1, 3 5)')  As b)
	As foo

a_overlap_b | a_crosses_b | a_intersects_b | b_contains_a
------------+-------------+----------------+--------------
f           | f           | t              | t

-- ラインは部分的に円に含まれますが、完全にはインタセクトとクロスを満たしません。
-- 次元の違いからオーバラップしません。
SELECT ST_Overlaps(a,b) As a_overlap_b, ST_Crosses(a,b) As a_crosses_b,
	ST_Intersects(a, b) As a_intersects_b,
	ST_Contains(a,b) As a_contains_b
FROM (SELECT ST_Buffer(ST_GeomFromText('POINT(1 0.5)'), 3)  As a, ST_GeomFromText('LINESTRING(1 0, 1 1, 3 5)')  As b)
	As foo;

 a_overlap_b | a_crosses_b | a_intersects_b | a_contains_b
-------------+-------------+----------------+--------------
 f           | t           | t              | f

-- 円にインタセクトした、2次元の曲がったホットドッグ
-- (または、ふくれたラインストリング)です。
-- 完全には円に含まれず、同じ次元ですのでオーバラップします。
-- インタセクションの次元が最大次元と同じ2次元ですから、クロスしません。

SELECT ST_Overlaps(a,b) As a_overlap_b, ST_Crosses(a,b) As a_crosses_b, ST_Intersects(a, b) As a_intersects_b,
ST_Contains(b,a) As b_contains_a,
ST_Dimension(a) As dim_a, ST_Dimension(b) as dim_b, ST_Dimension(ST_Intersection(a,b)) As dima_intersection_b
FROM (SELECT ST_Buffer(ST_GeomFromText('POINT(1 0.5)'), 3)  As a,
	ST_Buffer(ST_GeomFromText('LINESTRING(1 0, 1 1, 3 5)'),0.5)  As b)
	As foo;

 a_overlap_b | a_crosses_b | a_intersects_b | b_contains_a | dim_a | dim_b | dima_intersection_b
-------------+-------------+----------------+--------------+-------+-------+---------------------
 t           | f           | t              | f            |     2 |     2 |              2
</pre></div><div class="refsection" title="関連情報"><a name="id287052026"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Contains" title="ST_Contains">ST_Contains</a>, <a class="xref" href="#ST_Crosses" title="ST_Crosses">ST_Crosses</a>, <a class="xref" href="#ST_Dimension" title="ST_Dimension">ST_Dimension</a>, <a class="xref" href="#ST_Intersects" title="ST_Intersects">ST_Intersects</a></p></div></div><div class="refentry" title="ST_Perimeter"><div class="refentry.separator"><hr></div><a name="ST_Perimeter"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Perimeter ? ST_SrrfaceまたはST_MultiSurface(POLYGONまたはMULTIPOLYGON)の境界の長さの計測値を返します。ジオメトリの単位は空間参照系によります。ジオグラフィはメートル単位になります。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_Perimeter</b>(</code>geometry <var class="pdparam">g1</var><code>)</code>;</p></div><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_Perimeter</b>(</code>geography <var class="pdparam">geog</var>, boolean <var class="pdparam">use_spheroid=true</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287052148"></a><h2>説明</h2><p>ジオメトリ/ジオグラフィがST_SrrfaceまたはST_MultiSurface(POLYGONまたはMULTIPOLYGON)の場合に、2次元長の周囲長を返します。面ジオメトリでない場合には0を返します。ラインストリングについてはST_Lengthを使います。ジオメトリの単位は空間参照系によります。ジオグラフィはメートル単位になります。<code class="varname">use_spheroid</code>がfalseに設定されると、回転楕円体でなく球面で計算します。</p><p>現在は、この関数はST_Perimeter2Dの別名ですが、高次元サポートに変更されるかも知れません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です s2.1.5.1</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 8.1.3, 9.5.4</p><p>初出: 2.0.0 ジオグラフィが導入されました。</p></div><div class="refsection" title="例: ジオメトリ"><a name="id287052197"></a><h2>例: ジオメトリ</h2><p>POLYGONとMULTIPOLYGONに対するフィート単位の周囲長を返します。2249はフィート単位のマサチューセッツ平面なので、フィート単位です。</p><pre class="programlisting">
SELECT ST_Perimeter(ST_GeomFromText('POLYGON((743238 2967416,743238 2967450,743265 2967450,
743265.625 2967416,743238 2967416))', 2249));
st_perimeter
---------
 122.630744000095
(1 row)

SELECT ST_Perimeter(ST_GeomFromText('MULTIPOLYGON(((763104.471273676 2949418.44119003,
763104.477769673 2949418.42538203,
763104.189609677 2949418.22343004,763104.471273676 2949418.44119003)),
((763104.471273676 2949418.44119003,763095.804579742 2949436.33850239,
763086.132105649 2949451.46730207,763078.452329651 2949462.11549407,
763075.354136904 2949466.17407812,763064.362142565 2949477.64291974,
763059.953961626 2949481.28983009,762994.637609571 2949532.04103014,
762990.568508415 2949535.06640477,762986.710889563 2949539.61421415,
763117.237897679 2949709.50493431,763235.236617789 2949617.95619822,
763287.718121842 2949562.20592617,763111.553321674 2949423.91664605,
763104.471273676 2949418.44119003)))', 2249));
st_perimeter
---------
 845.227713366825
(1 row)
			</pre></div><div class="refsection" title="例: ジオグラフィ"><a name="id287052211"></a><h2>例: ジオグラフィ</h2><p>ポリゴンとマルチポリゴンのメートル単位とフィート単位の周囲長を返します。ジオグラフィ(WGS 84経度緯度)であることに注意して下さい。</p><pre class="programlisting">
SELECT  ST_Perimeter(geog) As per_meters, ST_Perimeter(geog)/0.3048 As per_ft 
FROM ST_GeogFromText('POLYGON((-71.1776848522251 42.3902896512902,-71.1776843766326 42.3903829478009,
-71.1775844305465 42.3903826677917,-71.1775825927231 42.3902893647987,-71.1776848522251 42.3902896512902))') As geog;

   per_meters    |      per_ft
-----------------+------------------
37.3790462565251 | 122.634666195949


-- マルチポリゴンの例 --
SELECT  ST_Perimeter(geog) As per_meters, ST_Perimeter(geog,false) As per_sphere_meters,  ST_Perimeter(geog)/0.3048 As per_ft 
FROM ST_GeogFromText('MULTIPOLYGON(((-71.1044543107478 42.340674480411,-71.1044542869917 42.3406744369506,
-71.1044553562977 42.340673886454,-71.1044543107478 42.340674480411)),
((-71.1044543107478 42.340674480411,-71.1044860600303 42.3407237015564,-71.1045215770124 42.3407653385914,
-71.1045498002983 42.3407946553165,-71.1045611902745 42.3408058316308,-71.1046016507427 42.340837442371,
-71.104617893173 42.3408475056957,-71.1048586153981 42.3409875993595,-71.1048736143677 42.3409959528211,
-71.1048878050242 42.3410084812078,-71.1044020965803 42.3414730072048,
-71.1039672113619 42.3412202916693,-71.1037740497748 42.3410666421308,
-71.1044280218456 42.3406894151355,-71.1044543107478 42.340674480411)))') As geog;

    per_meters    | per_sphere_meters |      per_ft
------------------+-------------------+------------------
 257.634283683311 |  257.412311446337 | 845.256836231335
			</pre></div><div class="refsection" title="関連情報"><a name="id287052328"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeogFromText" title="ST_GeogFromText">ST_GeogFromText</a>, <a class="xref" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a>, <a class="xref" href="#ST_Length" title="ST_Length">ST_Length</a></p></div></div><div class="refentry" title="ST_Perimeter2D"><div class="refentry.separator"><hr></div><a name="ST_Perimeter2D"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Perimeter2D ? POLYGONまたはMULTIPOLYGONジオメトリの場合に、2次元周囲長を返します。これは、現在はST_Perimeterの別名です。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_Perimeter2D</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287052384"></a><h2>説明</h2><p>POLYGONまたはMULTIPOLYGONジオメトリの場合に、2次元周囲長を返します。これは、現在はST_Perimeterの別名です。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これは、現在はST_Perimeterの別名です。将来的に、ST_Perimeterがジオメトリの最大次元の周囲長を返すようになるかも知れません。これは、まだ考慮中です。</p></td></tr></table></div></div><div class="refsection" title="関連情報"><a name="id287053600"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Perimeter" title="ST_Perimeter">ST_Perimeter</a></p></div></div><div class="refentry" title="ST_3DPerimeter"><div class="refentry.separator"><hr></div><a name="ST_3DPerimeter"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_3DPerimeter ? POLYGONまたはMULTIPOLYGONジオメトリの場合に、3次元周囲長を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_3DPerimeter</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287053649"></a><h2>説明</h2><p>POLYGONまたはMULTIPOLYGONジオメトリの場合に、3次元周囲長を返します。ジオメトリが2次元の場合には、2次元周囲長を返します。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p>変更: 2.0.0 以前の版ではST_Perimeter3Dと呼ばれていました。</p></div><div class="refsection" title="例"><a name="id287053674"></a><h2>例</h2><p>フィート単位のマサチューセッツ州平面での、大気中にある、わずかに標高を持つポリゴンの周囲長です。</p><pre class="programlisting">SELECT ST_3DPerimeter(the_geom), ST_Perimeter2d(the_geom), ST_Perimeter(the_geom) FROM
			(SELECT ST_GeomFromEWKT('SRID=2249;POLYGON((743238 2967416 2,743238 2967450 1,
743265.625 2967416 1,743238 2967416 2))') As the_geom) As foo;

  ST_3DPerimeter  |  st_perimeter2d  |   st_perimeter
------------------+------------------+------------------
 105.465793597674 | 105.432997272188 | 105.432997272188

</pre></div><div class="refsection" title="関連情報"><a name="id287053690"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a>, <a class="xref" href="#ST_Perimeter" title="ST_Perimeter">ST_Perimeter</a>, <a class="xref" href="#ST_Perimeter2D" title="ST_Perimeter2D">ST_Perimeter2D</a></p></div></div><div class="refentry" title="ST_PointOnSurface"><div class="refentry.separator"><hr></div><a name="ST_PointOnSurface"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_PointOnSurface ? サーフェス上にあることを保障された<code class="varname">POINT</code>を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_PointOnSurface</b>(</code>geometry 
			<var class="pdparam">g1</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287053750"></a><h2>説明</h2><p>サーフェス上にあることを保障された<code class="varname">POINT</code>を返します。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です s3.2.14.2 // s3.2.18.2</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 8.1.5, 9.5.6.
		 According to the specs, ST_PointOnSurface works for surface geometries (POLYGONs, MULTIPOLYGONS, CURVED POLYGONS).  So PostGIS seems to be extending what
		 the spec allows here.  Most databases Oracle,DB II, ESRI SDE seem to only support this function for surfaces.  SQL Server 2008 like PostGIS supports for all common geometries.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p></div><div class="refsection" title="例"><a name="id287053803"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(ST_PointOnSurface('POINT(0 5)'::geometry));
 st_astext
------------
 POINT(0 5)
(1 row)

SELECT ST_AsText(ST_PointOnSurface('LINESTRING(0 5, 0 10)'::geometry));
 st_astext
------------
 POINT(0 5)
(1 row)

SELECT ST_AsText(ST_PointOnSurface('POLYGON((0 0, 0 5, 5 5, 5 0, 0 0))'::geometry));
   st_astext
----------------
 POINT(2.5 2.5)
(1 row)

SELECT ST_AsEWKT(ST_PointOnSurface(ST_GeomFromEWKT('LINESTRING(0 5 1, 0 0 1, 0 10 2)')));
   st_asewkt
----------------
 POINT(0 0 1)
(1 row)
</pre></div><div class="refsection" title="関連情報"><a name="id287053814"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Centroid" title="ST_Centroid">ST_Centroid</a>, <a class="xref" href="#ST_Point_Inside_Circle" title="ST_Point_Inside_Circle">ST_Point_Inside_Circle</a></p></div></div><div class="refentry" title="ST_Project"><div class="refentry.separator"><hr></div><a name="ST_Project"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Project ? 方位と距離を使って始点から算出された<code class="varname">POINT</code>を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geography <b class="fsfunc">ST_Project</b>(</code>geography 
				<var class="pdparam">g1</var>, float 
				<var class="pdparam">distance</var>, float 
				<var class="pdparam">azimuth</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287053888"></a><h2>説明</h2><p>方位(bearing)と距離を使って始点から算出された<code class="varname">POINT</code>を返します。</p><p>
距離、方位、位置計算は同じ操作の全ての状況で、世界における2ポイント間の関係を説明するものです(位置計算の場合には関係を構築します)。</p><p>
方位はナビゲーションでは時々ヘディングまたはベアリングと呼ばれます。
真北(0度)との相対値です。東が90で、南が180、西が270となります。</p><p>距離はメートル単位です。</p></div><div class="refsection" title="例"><a name="id287053910"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(ST_Project('POINT(0 0)'::geography, 100000, 45));
                  st_astext
	------------------------------------------
	 POINT(0.63523102912532 0.63947233472882)
	(1 row)
	</pre></div><div class="refsection" title="関連情報"><a name="id287053921"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Azimuth" title="ST_Azimuth">ST_Azimuth</a>, <a class="xref" href="#ST_Distance" title="ST_Distance">ST_Distance</a></p></div></div><div class="refentry" title="ST_Relate"><div class="refentry.separator"><hr></div><a name="ST_Relate"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Relate ? intersectionMatrixPatternの値について、2つのジオメトリの内部、境界、外部のインタセクションを見て、指定したジオメトリがもうひとつのジオメトリと空間的に関係している場合に、TRUEを返します。intersectionMatrixPatternが無い場合には、2ジオメトリについての最大のintersectionMatrixPatternを返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_Relate</b>(</code>geometry  <var class="pdparam">geomA</var>, geometry  <var class="pdparam">geomB</var>, text  <var class="pdparam">intersectionMatrixPattern</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">ST_Relate</b>(</code>geometry  <var class="pdparam">geomA</var>, geometry  <var class="pdparam">geomB</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">ST_Relate</b>(</code>geometry  <var class="pdparam">geomA</var>, geometry  <var class="pdparam">geomB</var>, int  <var class="pdparam">BoundaryNodeRule</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287054054"></a><h2>説明</h2><p>1版: geomA, geomB, intersectionMatrixを取り、<a class="ulink" href="http://en.wikipedia.org/wiki/DE-9IM" target="_top">DE-9IM matrix pattern</a>の値によって指定される、2つのジオメトリの内部、境界、外部のインタセクションを見て、指定したジオメトリがもうひとつのジオメトリと空間的に関係している場合に、1(TRUE)を返します。</p><p>これは特にインタセクト、クロス等の複合チェックを一度に行うために使います。</p><p><code class="varname">GEOMETRYCOLLECTION</code>を引数にして呼ばないでください。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これは論理値を返して整数を返さないのが「許される」版です。これはOGC仕様で定められています。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数は、自動的にはインデクスを呼びだしません。非接続など、関連が否定的になるものがあるためです。インタセクションを必要とするパターンの関連を使うのでしたら、&amp;&amp;演算子でインデクスを呼び出して下さい。</p></td></tr></table></div><p>2版: geomAとgeomBを取り、<a class="xref" href="#DE-9IM" title="4.3.6. Dimensionally Extended 9 Intersection Model (DE-9IM)">「Dimensionally Extended 9 Intersection Model (DE-9IM)」</a>を返します。</p><p>3版: 2版と同じですが、特定の境界ノード規則(1:OGC/MOD2, 2:Endpoint, 3:MultivalentEndpoint, 4:MonovalentEndpoint)を許容します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">GEOMETRYCOLLECTION</code>を引数にして呼ばないでください。</p></td></tr></table></div><p>not in OGC spec, but implied. see s2.1.13.2</p><p>GEOSモジュールによって実現しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です s2.1.1.2 // s2.1.13.3</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.25</p><p>機能強化: 2.0.0 - 境界ノード規則が追加されました(GEOS 3,0以上が必要です)。</p></div><div class="refsection" title="例"><a name="id287054174"></a><h2>例</h2><pre class="programlisting">
-- あるポリゴンとインタセクトして接触しない
-- (内部でインタセクトする)区域を探索します。
SELECT l.* , b.name As poly_name
	FROM polys As b
INNER JOIN compounds As l
ON (p.the_geom &amp;&amp; b.the_geom
AND ST_Relate(l.the_geom, b.the_geom,'T********'));

SELECT ST_Relate(ST_GeometryFromText('POINT(1 2)'), ST_Buffer(ST_GeometryFromText('POINT(1 2)'),2));
st_relate
-----------
0FFFFF212

SELECT ST_Relate(ST_GeometryFromText('LINESTRING(1 2, 3 4)'), ST_GeometryFromText('LINESTRING(5 6, 7 8)'));
st_relate
-----------
FF1FF0102


SELECT ST_Relate(ST_GeometryFromText('POINT(1 2)'), ST_Buffer(ST_GeometryFromText('POINT(1 2)'),2), '0FFFFF212');
st_relate
-----------
t

SELECT ST_Relate(ST_GeometryFromText('POINT(1 2)'), ST_Buffer(ST_GeometryFromText('POINT(1 2)'),2), '*FF*FF212');
st_relate
-----------
t
		</pre></div><div class="refsection" title="関連情報"><a name="id287054187"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Crosses" title="ST_Crosses">ST_Crosses</a>, <a class="xref" href="#DE-9IM" title="4.3.6. Dimensionally Extended 9 Intersection Model (DE-9IM)">「Dimensionally Extended 9 Intersection Model (DE-9IM)」</a>, <a class="xref" href="#ST_Disjoint" title="ST_Disjoint">ST_Disjoint</a>, <a class="xref" href="#ST_Intersects" title="ST_Intersects">ST_Intersects</a>, <a class="xref" href="#ST_Touches" title="ST_Touches">ST_Touches</a></p></div></div><div class="refentry" title="ST_RelateMatch"><div class="refentry.separator"><hr></div><a name="ST_RelateMatch"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_RelateMatch ? intersectionMattrixPattern1がintersectionMatrixPattern2を含む場合にTRUEを返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_RelateMatch</b>(</code>text  <var class="pdparam">intersectionMatrix</var>, text  <var class="pdparam">intersectionMatrixPattern</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287054259"></a><h2>説明</h2><p>intersectionMatrixとintersectionMatrixPatternを取り、intersectionMatrixがintersectionMatrixPatternを満たす場合にTRUEを返します。詳細情報については<a class="xref" href="#DE-9IM" title="4.3.6. Dimensionally Extended 9 Intersection Model (DE-9IM)">「Dimensionally Extended 9 Intersection Model (DE-9IM)」</a>を参照して下さい。</p><p>初出: 2.0.0 - GEOS 3.3.0以上が必要です。</p></div><div class="refsection" title="例"><a name="id287054275"></a><h2>例</h2><pre class="programlisting">
SELECT ST_RelateMatch('101202FFF', 'TTTTTTFFF') ;
-- 結果 --
t
--example of common intersection matrix patterns and example matrices
-- comparing relationships of involving one invalid geometry and ( a line and polygon that intersect at interior and boundary)
SELECT mat.name, pat.name, ST_RelateMatch(mat.val, pat.val) As satisfied
    FROM 
        ( VALUES ('Equality', 'T1FF1FFF1'),
                ('Overlaps', 'T*T***T**'),
                ('Within', 'T*F**F***'),
                ('Disjoint', 'FF*FF****') As pat(name,val)
        CROSS JOIN 
            (	VALUES ('Self intersections (invalid)', '111111111'),
                    ('IE2_BI1_BB0_BE1_EI1_EE2', 'FF2101102'),
                    ('IB1_IE1_BB0_BE0_EI2_EI1_EE2', 'F11F00212')
            ) As mat(name,val);
							
		</pre></div><div class="refsection" title="関連情報"><a name="id287054288"></a><h2>関連情報</h2><p><a class="xref" href="#DE-9IM" title="4.3.6. Dimensionally Extended 9 Intersection Model (DE-9IM)">「Dimensionally Extended 9 Intersection Model (DE-9IM)」</a>, <a class="xref" href="#ST_Relate" title="ST_Relate">ST_Relate</a></p></div></div><div class="refentry" title="ST_ShortestLine"><div class="refentry.separator"><hr></div><a name="ST_ShortestLine"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ShortestLine ? 2つのジオメトリの2次元長が最短となるラインを返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_ShortestLine</b>(</code>geometry 
			<var class="pdparam">g1</var>, geometry 
			<var class="pdparam">g2</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287054349"></a><h2>説明</h2><p>2つのジオメトリの、2次元の最短ラインを返します。見つかった最短線が複数ある場合は、最初のもののみ返します。g1とg2が1点のみでインタセクトする場合は、インタセクション点を開始点と終了点とします。g1とg2が一点以上でインタセクトする場合は、同じ点を開始点と終了点としますが、その点は不定です。返されるラインは常にg1を始点、g2を終点とします。</p><p>初出: 1.5.0</p></div><div class="refsection" title="例"><a name="id287054362"></a><h2>例</h2><div class="informaltable"><table border="1"><colgroup><col><col></colgroup><tbody><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_shortestline01.png"><div class="caption"><p>ポイントとラインストリングの最短ライン </p></div></div></div><p>
				</p><pre class="programlisting">
SELECT ST_AsText(
	ST_ShortestLine('POINT(100 100)'::geometry, 
		'LINESTRING (20 80, 98 190, 110 180, 50 75 )'::geometry)
	) As sline;

	
   sline
-----------------
LINESTRING(100 100,73.0769230769231 115.384615384615)
				</pre><p>
						  </p></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_shortestline02.png"><div class="caption"><p>ポリゴンとポリゴンの最短ライン</p></div></div></div><p>
				</p><pre class="programlisting">
SELECT ST_AsText(
		ST_ShortestLine(
			ST_GeomFromText('POLYGON((175 150, 20 40, 50 60, 125 100, 175 150))'),
			ST_Buffer(ST_GeomFromText('POINT(110 170)'), 20)
			) 
		) As slinewkt;
		
 LINESTRING(140.752120669087 125.695053378061,121.111404660392 153.370607753949)
				</pre><p>
						</p></td></tr></tbody></table></div></div><div class="refsection" title="関連情報"><a name="id287054742"></a><h2>関連情報</h2><p><a class="xref" href="#ST_ClosestPoint" title="ST_ClosestPoint">ST_ClosestPoint</a>, <a class="xref" href="#ST_Distance" title="ST_Distance">ST_Distance</a>, <a class="xref" href="#ST_LongestLine" title="ST_LongestLine">ST_LongestLine</a>, <a class="xref" href="#ST_MaxDistance" title="ST_MaxDistance">ST_MaxDistance</a></p></div></div><div class="refentry" title="ST_Touches"><div class="refentry.separator"><hr></div><a name="ST_Touches"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Touches ? ジオメトリが共通のポイントを少なくとも1つ持ち、内部でインタセクトしない場合に、TRUEを返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_Touches</b>(</code>geometry 
			<var class="pdparam">g1</var>, geometry 
			<var class="pdparam">g2</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287054810"></a><h2>説明</h2><p><em class="parameter"><code>g1</code></em>と<em class="parameter"><code>g2</code></em>の共通部分のポイントが<em class="parameter"><code>g1</code></em>と<em class="parameter"><code>g2</code></em>の境界の結合上にある場合は、<code class="varname">TRUE</code>を返します。<code class="function">ST_Touches</code>は、面/面, 線/線, 線/面, 点/面, 点/線の全てを受け付けますが、点/点は<span class="emphasis"><em>受け付けません</em></span>。</p><p>数学用語で言うと、この述語は次のように表現されます。</p><div class="informalfigure"><div class="mediaobject"><img src="images/st_touches-math.gif"></div></div><p>2つのジオメトリに対して許されるDE-9IMは次のようになります。</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="markup">FT*******</span></p></li><li class="listitem"><p><span class="markup">F**T*****</span></p></li><li class="listitem"><p><span class="markup">F***T****</span></p></li></ul></div><div class="important" title="重要" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[重要]" src="images/important.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">GEOMETRYCOLLECTION</code>を引数にして呼ばないでください。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数の呼び出しによって、ジオメトリで使用可能なインデクスを使用したバウンディングボックスの比較が自動的に行われます。インデクスの使用を避けるには<code class="function">_ST_Touches</code>を使います。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です s2.1.1.2 // s2.1.13.3</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.28</p></div><div class="refsection" title="例"><a name="id287054976"></a><h2>例</h2><p>次に示す図全てで、<code class="function">ST_Touches</code>は<code class="varname">TRUE</code>を返します。</p><div class="informaltable"><table border="1"><colgroup><col><col><col></colgroup><tbody><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_touches01.png"><div class="caption"><p><code class="varname">POLYGON</code> / <code class="varname">POLYGON</code></p></div></div></div></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_touches02.png"><div class="caption"><p><code class="varname">POLYGON</code> / <code class="varname">POLYGON</code></p></div></div></div></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_touches03.png"><div class="caption"><p><code class="varname">POLYGON</code> / <code class="varname">LINESTRING</code></p></div></div></div></td></tr><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_touches04.png"><div class="caption"><p><code class="varname">LINESTRING</code> / <code class="varname">LINESTRING</code></p></div></div></div></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_touches05.png"><div class="caption"><p><code class="varname">LINESTRING</code> / <code class="varname">LINESTRING</code></p></div></div></div></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_touches06.png"><div class="caption"><p><code class="varname">POLYGON</code> / <code class="varname">POINT</code></p></div></div></div></td></tr></tbody></table></div><pre class="programlisting">SELECT ST_Touches('LINESTRING(0 0, 1 1, 0 2)'::geometry, 'POINT(1 1)'::geometry);
 st_touches
------------
 f
(1 row)

SELECT ST_Touches('LINESTRING(0 0, 1 1, 0 2)'::geometry, 'POINT(0 2)'::geometry);
 st_touches
------------
 t
(1 row)</pre></div></div><div class="refentry" title="ST_Within"><div class="refentry.separator"><hr></div><a name="ST_Within"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Within ? ジオメトリAが完全にジオメトリBの内側にある場合にTRUEを返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_Within</b>(</code>geometry 
			<var class="pdparam">A</var>, geometry 
			<var class="pdparam">B</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287055246"></a><h2>説明</h2><p>ジオメトリAが完全にジオメトリBの内側にある場合にTRUEを返します。この関数が意味を持つためには、与えられるジオメトリは両方とも同じ座標系で同じSRIDを持つ必要があります。ST_Within(A,B)がTRUEかつST_Within(B,A)がTRUEである場合には、二つのジオメトリは空間的に同じであると考えられます。</p><p>GEOSモジュールによって実現しています。</p><div class="important" title="重要" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[重要]" src="images/important.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">GEOMETRYCOLLECTION</code>を引数にして呼ばないでください。</p></td></tr></table></div><div class="important" title="重要" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[重要]" src="images/important.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数を不正なジオメトリで呼ばないでください。予期しない結果が返されます。</p></td></tr></table></div><p>この関数の呼び出しによって、ジオメトリで使用可能なインデクスを使用したバウンディングボックスの比較が自動的に行われます。インデクスの使用を避けるには_ST_Withinを使います。</p><p>ご注意: これは論理値を返して整数を返さないのが「許される」版です。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です s2.1.1.2 // s2.1.13.3 
		  - a.Relate(b, 'T*F**F***')
		</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.30</p></div><div class="refsection" title="例"><a name="id287055310"></a><h2>例</h2><pre class="programlisting">
-- 円の中にある円
SELECT ST_Within(smallc,smallc) As smallinsmall,
	ST_Within(smallc, bigc) As smallinbig,
	ST_Within(bigc,smallc) As biginsmall,
	ST_Within(ST_Union(smallc, bigc), bigc) as unioninbig,
	ST_Within(bigc, ST_Union(smallc, bigc)) as biginunion,
	ST_Equals(bigc, ST_Union(smallc, bigc)) as bigisunion
FROM
(
SELECT ST_Buffer(ST_GeomFromText('POINT(50 50)'), 20) As smallc,
	ST_Buffer(ST_GeomFromText('POINT(50 50)'), 40) As bigc) As foo;
-- 結果
 smallinsmall | smallinbig | biginsmall | unioninbig | biginunion | bigisunion
--------------+------------+------------+------------+------------+------------
 t            | t          | f          | t          | t          | t
(1 row)
		</pre><p><span class="inlinemediaobject"><img src="images/st_within01.png"></span> </p></div><div class="refsection" title="関連情報"><a name="id287055333"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Contains" title="ST_Contains">ST_Contains</a>, <a class="xref" href="#ST_Equals" title="ST_Equals">ST_Equals</a>, <a class="xref" href="#ST_IsValid" title="ST_IsValid">ST_IsValid</a></p></div></div></div><div class="sect1" title="8.9. ジオメトリ処理関数"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Geometry_Processing"></a>8.9. ジオメトリ処理関数</h2></div></div></div><div class="toc"><dl><dt><span class="refentrytitle"><a href="#ST_Buffer">ST_Buffer</a></span><span class="refpurpose"> ? (T) ジオメトリ: このジオメトリからの距離が指定された距離以下となるポイント全てを表現するジオメトリを返します。計算は、ジオメトリの空間参照系で行われます。ジオグラフィ: 平面変換ラッパを使います。形状制御のために異なる終端キャップと継ぎ目の設定のサポートが1.5で導入されました。buffer_styleオプションは、quad_segs=#,endcap=round|flat|square,join=round|mitre|bevel,mitre_limit=#.# となります。</span></dt><dt><span class="refentrytitle"><a href="#ST_BuildArea">ST_BuildArea</a></span><span class="refpurpose"> ? 与えられたジオメトリの構成ラインから面ジオメトリを生成します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Collect">ST_Collect</a></span><span class="refpurpose"> ? 他のジオメトリのコレクションから、指定したST_Geometry値を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_ConcaveHull">ST_ConcaveHull</a></span><span class="refpurpose"> ? 凹包は、集合の範囲内におけるすべてのジオメトリーを囲む、できる限り凹となるジオメトリを表現するものです。収縮包装とみることができます。</span></dt><dt><span class="refentrytitle"><a href="#ST_ConvexHull">ST_ConvexHull</a></span><span class="refpurpose"> ? 凸包は与えられた集合の全てのジオメトリを含む最小の閉じた凸ジオメトリです。</span></dt><dt><span class="refentrytitle"><a href="#ST_CurveToLine">ST_CurveToLine</a></span><span class="refpurpose"> ? CIRCULARSTRING/CURVEPOLYGONをLINESTRING/POLYGONに変換します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Difference">ST_Difference</a></span><span class="refpurpose"> ? ジオメトリBにインタセクトしないジオメトリAの部分を表現するジオメトリを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Dump">ST_Dump</a></span><span class="refpurpose"> ? ジオメトリg1から作られたgeometry_dump(geom, path)行の集合を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_DumpPoints">ST_DumpPoints</a></span><span class="refpurpose"> ? ジオメトリを作る全ての点のgometry_dump(geom,path)行の集合を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_DumpRings">ST_DumpRings</a></span><span class="refpurpose"> ? ポリゴンの外環と内環を表す<code class="varname">geometry_dump</code>行の集合を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_FlipCoordinates">ST_FlipCoordinates</a></span><span class="refpurpose"> ? 与えられたジオメトリのX軸とY軸とを入れ替えたものを返します。緯度/経度の地物を構築して、これを訂正したい場合に使います。</span></dt><dt><span class="refentrytitle"><a href="#ST_Intersection">ST_Intersection</a></span><span class="refpurpose"> ? (T) geomAとgeomBの共有部分を表すジオメトリを返します。ジオグラフィ実装では、インタセクトするためにジオメトリに変換して、WGS84に戻します。</span></dt><dt><span class="refentrytitle"><a href="#ST_LineToCurve">ST_LineToCurve</a></span><span class="refpurpose"> ? LINESTRING/POLYGONをCIRCULARSTRINGとCURVED POLYGONに変換します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_MakeValid">ST_MakeValid</a></span><span class="refpurpose"> ? 頂点を失うことなしに不正なジオメトリを妥当なジオメトリにしようと試みます。</span></dt><dt><span class="refentrytitle"><a href="#ST_MemUnion">ST_MemUnion</a></span><span class="refpurpose"> ? ST_Unionと同じですが、メモリフレンドリ(少ないメモリ使用、多いCPU時間)です。</span></dt><dt><span class="refentrytitle"><a href="#ST_MinimumBoundingCircle">ST_MinimumBoundingCircle</a></span><span class="refpurpose"> ? ジオメトリを完全に含む最小の円ポリゴンを返します。デフォルトでは、4分の1円に対して48区分を使用します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Polygonize">ST_Polygonize</a></span><span class="refpurpose"> ? 集計関数。ジオメトリの集合のラインから形成されうるポリゴンを含むジオメトリコレクションを生成します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Node">ST_Node</a></span><span class="refpurpose"> ? ラインストリングの集合にノードを作成します。</span></dt><dt><span class="refentrytitle"><a href="#ST_OffsetCurve">ST_OffsetCurve</a></span><span class="refpurpose"> ? 与えられた距離と方面に入力ラインをずらしたラインを返します。中心線と平行する線を引く際に使用します。</span></dt><dt><span class="refentrytitle"><a href="#ST_RemoveRepeatedPoints">ST_RemoveRepeatedPoints</a></span><span class="refpurpose"> ? 入力ジオメトリから重複ポイントを除いたものを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_SharedPaths">ST_SharedPaths</a></span><span class="refpurpose"> ? 2つの入力LINESTRING/MULTILINESTRINGが共有するパスのコレクションを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Shift_Longitude">ST_Shift_Longitude</a></span><span class="refpurpose"> ? ジオメトリの全ての地物の全ての構成要素の全てのポイント/頂点を読み、経度が0未満なら360を足します。結果は、180度を中心とした地図にプロットされる0度から360度の間にあるデータとなります。</span></dt><dt><span class="refentrytitle"><a href="#ST_Simplify">ST_Simplify</a></span><span class="refpurpose"> ? 与えられたジオメトリを「簡略化」したものを返します。Douglas-Peukerアルゴリズムを使用します。</span></dt><dt><span class="refentrytitle"><a href="#ST_SimplifyPreserveTopology">ST_SimplifyPreserveTopology</a></span><span class="refpurpose"> ? 与えられたジオメトリを「簡略化」したものを返します。Douglas-Peukerアルゴリズムを使用します。不正な派生ジオメトリ(特にポリゴン)の生成を回避します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Split">ST_Split</a></span><span class="refpurpose"> ? ジオメトリを分割したジオメトリのコレクションを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_SymDifference">ST_SymDifference</a></span><span class="refpurpose"> ? AとBの、インタセクトしていない部分を表現するジオメトリを返します。対称と呼ばれるのは、ST_SymDifference(A,B) = ST_SymDifference(B,A) となるからです。</span></dt><dt><span class="refentrytitle"><a href="#ST_Union">ST_Union</a></span><span class="refpurpose"> ? ジオメトリの結合の点集合を表現するジオメトリを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_UnaryUnion">ST_UnaryUnion</a></span><span class="refpurpose"> ? ST_Unionに似ていますが、ジオメトリ要素レベルで動作します。</span></dt></dl></div><div class="refentry" title="ST_Buffer"><a name="ST_Buffer"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Buffer ? (T) ジオメトリ: このジオメトリからの距離が指定された距離以下となるポイント全てを表現するジオメトリを返します。計算は、ジオメトリの空間参照系で行われます。ジオグラフィ: 平面変換ラッパを使います。形状制御のために異なる終端キャップと継ぎ目の設定のサポートが1.5で導入されました。buffer_styleオプションは、quad_segs=#,endcap=round|flat|square,join=round|mitre|bevel,mitre_limit=#.# となります。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Buffer</b>(</code>geometry  <var class="pdparam">g1</var>, float  <var class="pdparam">radius_of_buffer</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_Buffer</b>(</code>geometry  <var class="pdparam">g1</var>, float  <var class="pdparam">radius_of_buffer</var>, integer  <var class="pdparam">num_seg_quarter_circle</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_Buffer</b>(</code>geometry  <var class="pdparam">g1</var>, float  <var class="pdparam">radius_of_buffer</var>, text  <var class="pdparam">buffer_style_parameters</var><code>)</code>;</p><p><code class="funcdef">geography <b class="fsfunc">ST_Buffer</b>(</code>geography  <var class="pdparam">g1</var>, float  <var class="pdparam">radius_of_buffer_in_meters</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287065021"></a><h2>説明</h2><p>このジオメトリ/ジオグラフィからの距離が指定された距離以下となるポイント全てを表現するジオメトリ/ジオグラフィを返します。</p><p>ジオメトリ: 計算は、ジオメトリの空間参照系で行われます。形状制御のために異なる終端キャップと継ぎ目を設定する機能が1.5で導入されました。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>負の半径: ポリゴンでは、負の半径が使えます。ポリゴンを拡張させずに縮小させることができます。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ジオグラフィ: ジオメトリ実装にかぶさる、薄いラッパです。ジオグラフィオブジェクトのバウンディングボックスに最適なSRIDを決定し(UTMが望ましいですが、ランベルト正積方位図法(北/南)、最悪のシナリオでメルカトルに頼ります)、その平面でバッファを生成し、WGS84ジオグラフィに戻します。</p></td></tr></table></div><p><img src="images/warning.png">
			ジオグラフィでは、オブジェクトが2つのUTMゾーンをまたいだり、日付変更線をまたぐような、相当に大きい場合には、期待した通りの動作をないかも知れません。</p><p>初出: 1.5 - ST_Bufferが異なる終端と継ぎ目の型に対応するよう強化されました。たとえば、道路ラインストリングを、丸の代わりに平坦や四角形の終端を持つ道路ポリゴンに変換するのに使います。ジオグラフィ用の薄いラッパが追加されました。最新のジオメトリ機能の利点を得るにはGEOS 3.2以上が必要です。</p><p>第3引数(現在ジオメトリしか適用できません)で、4分の1円に近づけるための区分数を指定でき(整数の場合、デフォルトは8です)、また、空白区切りのkey=valueペア(文字列の場合)を、次に示す操作として指定することができます。
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>'quad_segs=#' : number of segments used to approximate a quarter circle (defaults to 8).</p></li><li class="listitem"><p>'endcap=round|flat|square' : endcap style (defaults to "round", needs GEOS-3.2 or higher for a different value). 'butt' is also accepted as a synonym for 'flat'.</p></li><li class="listitem"><p>'join=round|mitre|bevel' : join style (defaults to "round", needs GEOS-3.2 or higher for a different value). 'miter' is also accepted as a synonym for 'mitre'.</p></li><li class="listitem"><p>'mitre_limit=#.#' : mitre ratio limit (only affects mitred join style). 'miter_limit' is also accepted as a synonym for 'mitre_limit'.</p></li></ul></div><p>
				</p><p>半径の単位は空間参照系の単位です。</p><p>入力は、POINT, MULTIPOINT, LINESTRING, MULTILINESTRING, POLYGON, MULTIPOLYGON, GEOMETRYCOLLECTIONが可能です。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数は第3次元(Z軸)は無視し、3次元ジオメトリが与えられても、常に2次元バッファを返します。</p></td></tr></table></div><p>GEOSモジュールで実現しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です s2.1.1.3</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.17</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数を半径探索に使おうとして失敗する人がいらっしゃいます。バッファを生成して半径探索に使うのと遅いし無意味です。<a class="xref" href="#ST_DWithin" title="ST_DWithin">ST_DWithin</a>を使います。</p></td></tr></table></div></div><div class="refsection" title="例"><a name="id287065134"></a><h2>例</h2><div class="informaltable"><table border="1"><colgroup><col><col></colgroup><tbody><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_buffer01.png"><div class="caption"><p>quad_segs=8 (default)</p></div></div></div><p>
				</p><pre class="programlisting">
SELECT ST_Buffer(
 ST_GeomFromText('POINT(100 90)'),
 50, 'quad_segs=8');
				</pre><p>
						  </p></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_buffer02.png"><div class="caption"><p>quad_segs=2 (lame)</p></div></div></div><p>
				</p><pre class="programlisting">
SELECT ST_Buffer(
 ST_GeomFromText('POINT(100 90)'),
 50, 'quad_segs=2');
				</pre><p>
						</p></td></tr><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_buffer03.png"><div class="caption"><p>endcap=round join=round (default)</p></div></div></div><p>
				</p><pre class="programlisting">
SELECT ST_Buffer(
 ST_GeomFromText(
  'LINESTRING(50 50,150 150,150 50)'
 ), 10, 'endcap=round join=round');
				</pre><p>
						 </p></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_buffer04.png"><div class="caption"><p>endcap=square</p></div></div></div><p>
				</p><pre class="programlisting">
SELECT ST_Buffer(
 ST_GeomFromText(
  'LINESTRING(50 50,150 150,150 50)'
 ), 10, 'endcap=square join=round');
				</pre><p>
						  </p></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_buffer05.png"><div class="caption"><p>endcap=flat</p></div></div></div><p>
				</p><pre class="programlisting">
SELECT ST_Buffer(
 ST_GeomFromText(
  'LINESTRING(50 50,150 150,150 50)'
 ), 10, 'endcap=flat join=round');
				</pre><p>
						  </p></td></tr><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_buffer07.png"><div class="caption"><p>join=bevel</p></div></div></div><p>
				</p><pre class="programlisting">
SELECT ST_Buffer(
 ST_GeomFromText(
  'LINESTRING(50 50,150 150,150 50)'
 ), 10, 'join=bevel');
				</pre><p>
						  </p></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_buffer06.png"><div class="caption"><p>join=mitre mitre_limit=5.0 (default mitre limit)</p></div></div></div><p>
				</p><pre class="programlisting">
SELECT ST_Buffer(
 ST_GeomFromText(
  'LINESTRING(50 50,150 150,150 50)'
 ), 10, 'join=mitre mitre_limit=5.0');
				</pre><p>
						  </p></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_buffer08.png"><div class="caption"><p>join=mitre mitre_limit=1</p></div></div></div><p>
				</p><pre class="programlisting">
SELECT ST_Buffer(
 ST_GeomFromText(
  'LINESTRING(50 50,150 150,150 50)'
 ), 10, 'join=mitre mitre_limit=1.0');
				</pre><p>
						  </p></td></tr></tbody></table></div><pre class="programlisting">-- 近似円バッファ
-- 近似を強制するバッファされたポイント(ダイアグラム参照)
-- 円にポイント2つは8辺のポリゴン(ダイアグラム参照)
SELECT ST_NPoints(ST_Buffer(ST_GeomFromText('POINT(100 90)'), 50)) As promisingcircle_pcount,
ST_NPoints(ST_Buffer(ST_GeomFromText('POINT(100 90)'), 50, 2)) As lamecircle_pcount;

promisingcircle_pcount | lamecircle_pcount
------------------------+-------------------
			 33 |                9

-- 手軽だが不十分な円(4分の1円で2点だけの八角形)
-- 次に示すのは100メートルの八角形です。
-- 座標系は、メートル単位マサチューセッツ州平面に変換したNAD 83経度緯度で、
-- メートルでバッファを取っています。
SELECT ST_AsText(ST_Buffer(
ST_Transform(
ST_SetSRID(ST_MakePoint(-71.063526, 42.35785),4269), 26986)
,100,2)) As octagon;
----------------------
POLYGON((236057.59057465 900908.759918696,236028.301252769 900838.049240578,235
957.59057465 900808.759918696,235886.879896532 900838.049240578,235857.59057465
900908.759918696,235886.879896532 900979.470596815,235957.59057465 901008.759918
696,236028.301252769 900979.470596815,236057.59057465 900908.759918696))
		</pre></div><div class="refsection" title="関連情報"><a name="id287065687"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Collect" title="ST_Collect">ST_Collect</a>, <a class="xref" href="#ST_DWithin" title="ST_DWithin">ST_DWithin</a>, <a class="xref" href="#ST_SetSRID" title="ST_SetSRID">ST_SetSRID</a>, <a class="xref" href="#ST_Transform" title="ST_Transform">ST_Transform</a>, <a class="xref" href="#ST_Union" title="ST_Union">ST_Union</a></p></div></div><div class="refentry" title="ST_BuildArea"><div class="refentry.separator"><hr></div><a name="ST_BuildArea"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_BuildArea ? 与えられたジオメトリの構成ラインから面ジオメトリを生成します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_BuildArea</b>(</code>geometry  <var class="pdparam">A</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287065750"></a><h2>説明</h2><p>与えられたジオメトリの構成ラインから面ジオメトリを生成します。返り値はポリゴンまたはマルチポリゴンで、どちらになるかは入力に依存します。入力構成ラインがポリゴンを形成しない場合はNULLを返します。入力はLINESTRING, MULTILINESTRING, POLYGON, MULTIPOLYGON, GEOMETRYCOLLECTIONにすることができます。</p><p>この関数は全ての内部ジオメトリが穴を表現すると仮定します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数が正しく動作するには、入力ラインに正しくノードが作成されている必要があります。</p></td></tr></table></div><p>初出: 1.1.0 - GEOS 2.1.0が必要です。</p></div><div class="refsection" title="例"><a name="id287065772"></a><h2>例</h2><div class="informaltable"><table border="1"><colgroup><col></colgroup><tbody><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_buildarea01.png"><div class="caption"><p>ドーナツを生成します。</p></div></div></div><p>
				</p><pre class="programlisting">
SELECT ST_BuildArea(ST_Collect(smallc,bigc))
FROM (SELECT
	ST_Buffer(
	  ST_GeomFromText('POINT(100 90)'), 25) As smallc,
	ST_Buffer(ST_GeomFromText('POINT(100 90)'), 50) As bigc) As foo;
				</pre><p>
						  </p></td></tr><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_buildarea02.png"><div class="caption"><p>円内にとがったものの先で、裂け目を生成します。</p></div></div></div><p>
				</p><pre class="programlisting">
SELECT ST_BuildArea(ST_Collect(line,circle))
FROM (SELECT
	ST_Buffer(
		ST_MakeLine(ST_MakePoint(10, 10),ST_MakePoint(190, 190)),
				5)  As line,
	ST_Buffer(ST_GeomFromText('POINT(100 90)'), 50) As circle) As foo;

--this creates the same gaping hole
--but using linestrings instead of polygons
SELECT ST_BuildArea(
	ST_Collect(ST_ExteriorRing(line),ST_ExteriorRing(circle))
	)
FROM (SELECT ST_Buffer(
	ST_MakeLine(ST_MakePoint(10, 10),ST_MakePoint(190, 190))
		,5)  As line,
	ST_Buffer(ST_GeomFromText('POINT(100 90)'), 50) As circle) As foo;

				</pre><p>
						</p></td></tr></tbody></table></div></div><div class="refsection" title="関連情報"><a name="id287065882"></a><h2>関連情報</h2><p>
			<a class="xref" href="#ST_Node" title="ST_Node">ST_Node</a>,
			<a class="xref" href="#ST_BdPolyFromText" title="ST_BdPolyFromText">ST_BdPolyFromText</a>,
			<a class="xref" href="#ST_BdMPolyFromText" title="ST_BdMPolyFromText">ST_BdMPolyFromText</a>wrappers to
			this function with standard OGC interface</p></div></div><div class="refentry" title="ST_Collect"><div class="refentry.separator"><hr></div><a name="ST_Collect"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Collect ? 他のジオメトリのコレクションから、指定したST_Geometry値を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Collect</b>(</code>geometry set <var class="pdparam">g1field</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_Collect</b>(</code>geometry <var class="pdparam">g1</var>, geometry <var class="pdparam">g2</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_Collect</b>(</code>geometry[] <var class="pdparam">g1_array</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287066021"></a><h2>説明</h2><p>出力タイプはMULTI系またはGEOMETRYCOLLECTIONです。2つの形式があります。 ひとつめは、2つのジオメトリをまとめるものです。ふたつめは、ジオメトリの集合を取って単一のST_Geometryにまとめる集計関数です。</p><p>集計関数版: この関数は、ジオメトリの集合からGEOMETRYCOLLECTIONまたはMULTI系を返します。ST_Collect()関数はPostgreSQL用語で言うところの「集計関数」です。SUM()やMEAN()と同じ方法でデータ行での操作を行うことを意味します。たとえば、"SELECT ST_Collect(GEOM) FROM GEOMTABLE GROUP BY ATTRCOLUMN"はATTRCOLUMNの異なった値ごとに、別々のGEOMETRYCOLLECTIONを返します。</p><p>非集計関数版: この関数は、2つの入力ジオメトリをまとめたジオメトリを返します。出力タイプはMULTI系またはGEOMETRYCOLLECTIONです。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_CollectとST_Unionはしばしば交換して使うことができます。ST_Collectは境界を更新しようとしないので、一般的にST_Unionよりも桁違いに早く動きます。ST_Collectは、単に、シングルジオメトリをMULTI系ジオメトリに巻き込み、MULTI系ジオメトリまたはジオメトリ型混在の集合をジオメトリコレクションに巻き込む、ということを行っているだけです。不幸なことに、GISツールはジオメトリコレクションを十分にサポートしていません。MULTI系ジオメトリを集める時にST_Collectがジオメトリコレクションを返すのを防ぐために、次に示すように、<a class="xref" href="#ST_Dump" title="ST_Dump">ST_Dump</a>でMULTI系ジオメトリをシングルジオメトリに展開したうえで再グループ化するというトリックを使うことができます。</p></td></tr></table></div><p>初出: 1.4.0 - ST_Collect(geometry)が導入されました。ST_Collectがより多くのジオメトリをより早く扱えるよう強化されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています このメソッドは曲線ストリングと曲線をサポートします。 ただし、MULTICURVEまたはMULTI系は期待するように返ることはなく、PostGISは現在のところこれに対応していません。</p></div><div class="refsection" title="例"><a name="id287066070"></a><h2>例</h2><p>集計関数の例(<a class="ulink" href="http://postgis.refractions.net/pipermail/postgis-users/2008-June/020331.html" target="_top">http://postgis.refractions.net/pipermail/postgis-users/2008-June/020331.html</a>)</p><pre class="programlisting">SELECT stusps,
	   ST_Multi(ST_Collect(f.the_geom)) as singlegeom
	 FROM (SELECT stusps, (ST_Dump(the_geom)).geom As the_geom
				FROM
				somestatetable ) As f
GROUP BY stusps</pre><p>非集計関数の例</p><pre class="programlisting">SELECT ST_AsText(ST_Collect(ST_GeomFromText('POINT(1 2)'),
	ST_GeomFromText('POINT(-2 3)') ));

st_astext
----------
MULTIPOINT(1 2,-2 3)

-- 2次元ポイント
SELECT ST_AsText(ST_Collect(ST_GeomFromText('POINT(1 2)'),
		ST_GeomFromText('POINT(1 2)') ) );

st_astext
----------
MULTIPOINT(1 2,1 2)

-- 3次元ポイント
SELECT ST_AsEWKT(ST_Collect(ST_GeomFromEWKT('POINT(1 2 3)'),
		ST_GeomFromEWKT('POINT(1 2 4)') ) );

		st_asewkt
-------------------------
 MULTIPOINT(1 2 3,1 2 4)

 -- 曲線の例
SELECT ST_AsText(ST_Collect(ST_GeomFromText('CIRCULARSTRING(220268 150415,220227 150505,220227 150406)'),
ST_GeomFromText('CIRCULARSTRING(220227 150406,2220227 150407,220227 150406)')));
																st_astext
------------------------------------------------------------------------------------
 GEOMETRYCOLLECTION(CIRCULARSTRING(220268 150415,220227 150505,220227 150406),
 CIRCULARSTRING(220227 150406,2220227 150407,220227 150406))

-- ST_Collect配列の生成
SELECT ST_Collect(ARRAY(SELECT the_geom FROM sometable));

SELECT ST_AsText(ST_Collect(ARRAY[ST_GeomFromText('LINESTRING(1 2, 3 4)'),
			ST_GeomFromText('LINESTRING(3 4, 4 5)')])) As wktcollect;

-- wkt collect --
MULTILINESTRING((1 2,3 4),(3 4,4 5))

</pre></div><div class="refsection" title="関連情報"><a name="id287066097"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Dump" title="ST_Dump">ST_Dump</a>, <a class="xref" href="#ST_Union" title="ST_Union">ST_Union</a></p></div></div><div class="refentry" title="ST_ConcaveHull"><div class="refentry.separator"><hr></div><a name="ST_ConcaveHull"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ConcaveHull ? 凹包は、集合の範囲内におけるすべてのジオメトリーを囲む、できる限り凹となるジオメトリを表現するものです。収縮包装とみることができます。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_ConcaveHull</b>(</code>geometry  <var class="pdparam">geomA</var>, float  <var class="pdparam">target_percent</var>, boolean  <var class="pdparam">allow_holes=false</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287066202"></a><h2>説明</h2><p>凹包は、集合の範囲内におけるすべてのジオメトリーを囲む、できる限り凹となるジオメトリを表現するものです。ポリゴンの穴を認めるのはデフォルトではfalseです。結果はシングルポリゴンより高くなることはありません。</p><p>target_percentは、凸包からPostGISがあきらめるか終了するまでに接近を試みる、凸包に対する目標割合です。凹包はジオメトリの集合を真空パックしたジオメトリと考えることができます。target_percentが1の場合には、凸包と同じ答えになります。target_parcetが0から0.99までの間では、凸包より小さい面積が得られます。これが、ジオメトリ集合を輪ゴムで囲うのに似ている凸包との違いです。</p><p>通常はMULTI系とジオメトリコレクションに使われます。
集計関数ではないのですが、ST_CollectやST_Unionと併用して、ポイント/ラインストリング/ポリゴンの凹包を得ることができます。"ST_ConcaveHull(ST_Collect(somepointfield), 0.80)"といったようにします。</p><p>凸包の計算よりも非常に遅いですが、よりよくジオメトリを囲みますし、画像認識にも使用されます。</p><p>GEOSモジュールで実現しています。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ご注意 - ポイント、ラインストリング、ジオメトリコレクションで使用する場合には、ST_Collectを使用して下さい。ポリゴンで使用する場合には、ST_Unionを使用して下さい。不正なジオメトリで失敗する可能性があるためです。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ご注意 - 目標割合を小さくすると、凹包処理が長くなり、トポロジ例外が発生しやすくなります。蓄積される浮動小数点数とポイントの数もまた多くなります。最初に0.99で実行してみて下さい。普通は非常に速く、時々凸包と同じ速さです。99%縮小ではほとんどの場合行き過ぎになるので、通常は99%縮小より良い結果になります。次に0.98で実行すると、2乗のオーダーで遅くなります。ST_ConcaveHull実行後に、精度と浮動小数点数を減らすために、<a class="xref" href="#ST_SimplifyPreserveTopology" title="ST_SimplifyPreserveTopology">ST_SimplifyPreserveTopology</a>や<a class="xref" href="#ST_SnapToGrid" title="ST_SnapToGrid">ST_SnapToGrid</a>を使用します。ST_SnapToGridは少し早くなりますが、不正なジオメトリが得られることがあります。ST_SimplifyPreserveTopologyは常にジオメトリの妥当性を確保します。</p></td></tr></table></div><p>現実世界の例と技術面でのしっかりした説明は、<a class="ulink" href="http://www.bostongis.com/postgis_concavehull.snippet" target="_top">http://www.bostongis.com/postgis_concavehull.snippet</a>にあります。</p><p>Oracle 11G R2で導入された凹包のデモンストレーションに関するSimon Greenerさんの記事も見てください。<a class="ulink" href="http://www.spatialdbadvisor.com/oracle_spatial_tips_tricks/172/concave-hull-geometries-in-oracle-11gr2" target="_top">http://www.spatialdbadvisor.com/oracle_spatial_tips_tricks/172/concave-hull-geometries-in-oracle-11gr2</a>にあります。凸包に対する目標割合を0.75にした際の形状がSimonさんOracleのSDO_CONCAVEHULL_BOUNDARYで得た形状と似ています。</p><p>初出: 2.0.0</p></div><div class="refsection" title="例"><a name="id287066259"></a><h2>例</h2><pre class="programlisting">
-- 観察ポイントを基に感染域の見積もりを得ます
SELECT d.disease_type,
	ST_ConcaveHull(ST_Collect(d.pnt_geom), 0.99) As geom
	FROM disease_obs As d
	GROUP BY d.disease_type;
</pre><div class="informaltable"><table border="1"><colgroup><col><col></colgroup><tbody><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_concavehull03.png"><div class="caption"><p>
縮小目標割合100%にした場合の2ポリゴンのST_ConcaveHull</p></div></div></div><p>
				</p><pre class="programlisting">
-- 縮小目標割合100%の凹包(凸包と同じとなり縮小しません)
-- で覆われるジオメトリ
SELECT 
	ST_ConcaveHull(
		ST_Union(ST_GeomFromText('POLYGON((175 150, 20 40, 
			50 60, 125 100, 175 150))'),
		ST_Buffer(ST_GeomFromText('POINT(110 170)'), 20)
		), 1)  
	 As convexhull;
				</pre><p>
						  </p></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_concavehull02.png"><div class="caption"><p>凸包に対する縮小目標割合を90%にした凹包で覆われるジオメトリ</p></div></div></div><p>
				</p><pre class="programlisting">
-- 縮小目標割合90%の凹包で覆われるジオメトリ
SELECT 
	ST_ConcaveHull(
		ST_Union(ST_GeomFromText('POLYGON((175 150, 20 40, 
			50 60, 125 100, 175 150))'),
		ST_Buffer(ST_GeomFromText('POINT(110 170)'), 20)
		), 0.9)  
	 As target_90;
				</pre><p>
						</p></td></tr><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_concavehull04.png"><div class="caption"><p>凸包で覆われたL字型のポイント群</p></div></div></div><p>
				</p><pre class="programlisting">
-- 42ポイントでL字型を形成するテーブルを生成
SELECT (ST_DumpPoints(ST_GeomFromText(
'MULTIPOINT(14 14,34 14,54 14,74 14,94 14,114 14,134 14,
150 14,154 14,154 6,134 6,114 6,94 6,74 6,54 6,34 6,
14 6,10 6,8 6,7 7,6 8,6 10,6 30,6 50,6 70,6 90,6 110,6 130,
6 150,6 170,6 190,6 194,14 194,14 174,14 154,14 134,14 114,
14 94,14 74,14 54,14 34,14 14)'))).geom 
	INTO TABLE l_shape;

SELECT ST_ConvexHull(ST_Collect(geom))
FROM l_shape;
				</pre><p>
						  </p></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_concavehull05.png"><div class="caption"><p>凸包に対する縮小目標割合を99%としたL字型のポイント群の凹包</p></div></div></div><p>
				</p><pre class="programlisting">
SELECT ST_ConcaveHull(ST_Collect(geom), 0.99)
	FROM l_shape;
				</pre><p>
						  </p></td></tr><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_concavehull06.png"><div class="caption"><p>凸包に対する縮小目標割合を80%としたL字型のポイント群の凹包</p></div></div></div><p>
	</p><pre class="programlisting">
	-- Concave Hull L shape points
	-- at target 80% of convexhull
	SELECT ST_ConcaveHull(ST_Collect(geom), 0.80)
	FROM l_shape;
	</pre><p>
			</p>
			</td><td><p>
				</p><div class="informalfigure"><div class="mediaobject"><img src="images/st_concavehull07.png"><div class="caption"><p>凸包に覆われたマルチラインストリング</p></div></div></div><p>
				</p><div class="informalfigure"><div class="mediaobject"><img src="images/st_concavehull08.png"><div class="caption"><p>凸包に対する縮小目標割合を99%(第1段階)とした凹包に覆われたマルチラインストリング</p></div></div></div><p>
	</p><pre class="programlisting">
SELECT ST_ConcaveHull(ST_GeomFromText('MULTILINESTRING((106 164,30 112,74 70,82 112,130 94,
	130 62,122 40,156 32,162 76,172 88),
(132 178,134 148,128 136,96 128,132 108,150 130,
170 142,174 110,156 96,158 90,158 88),
(22 64,66 28,94 38,94 68,114 76,112 30,
132 10,168 18,178 34,186 52,184 74,190 100,
190 122,182 148,178 170,176 184,156 164,146 178,
132 186,92 182,56 158,36 150,62 150,76 128,88 118))'),0.99)
	</pre><p>
			</p>
			</td></tr></tbody></table></div></div><div class="refsection" title="関連情報"><a name="id287066503"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Collect" title="ST_Collect">ST_Collect</a>, <a class="xref" href="#ST_ConvexHull" title="ST_ConvexHull">ST_ConvexHull</a>, <a class="xref" href="#ST_SimplifyPreserveTopology" title="ST_SimplifyPreserveTopology">ST_SimplifyPreserveTopology</a>, <a class="xref" href="#ST_SnapToGrid" title="ST_SnapToGrid">ST_SnapToGrid</a></p></div></div><div class="refentry" title="ST_ConvexHull"><div class="refentry.separator"><hr></div><a name="ST_ConvexHull"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ConvexHull ? 凸包は与えられた集合の全てのジオメトリを含む最小の閉じた凸ジオメトリです。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_ConvexHull</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287066563"></a><h2>説明</h2><p>凸包は与えられた集合の全てのジオメトリを含む最小の閉じた凸ジオメトリです。 </p><p>凸包は、ジオメトリの集合に輪ゴムをかけて得られるジオメトリと見ることができます。これは縮小包装に似ている凹包と異なります。</p><p>通常はMULTI系まはたジオメトリカラムを使いますが、集計関数ではありません - ST_Collectと併用してST_ConvexHull(ST_Collect(somepointfield))とすると、ポイントの集合の凸包を得ることができます。</p><p>ポイント観察の集合を基にして、影響を受ける範囲を決定するのに使用します。</p><p>GEOSモジュールで実現しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です s2.1.1.3</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.16</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p></div><div class="refsection" title="例"><a name="id287066627"></a><h2>例</h2><pre class="programlisting">
-- ポイント観察に基づいて、感染域の推定を得る
SELECT d.disease_type,
	ST_ConvexHull(ST_Collect(d.the_geom)) As the_geom
	FROM disease_obs As d
	GROUP BY d.disease_type;
</pre><p>
	</p><div class="informalfigure"><div class="mediaobject"><img src="images/st_convexhull01.png"><div class="caption"><p>マルチラインストリングとマルチポイントとその凸包t</p></div></div></div><p>
	</p><pre class="programlisting">
SELECT ST_AsText(ST_ConvexHull(
	ST_Collect(
		ST_GeomFromText('MULTILINESTRING((100 190,10 8),(150 10, 20 30))'),
			ST_GeomFromText('MULTIPOINT(50 5, 150 30, 50 10, 10 10)')
			)) );
---st_astext--
POLYGON((50 5,10 8,10 10,100 190,150 30,150 10,50 5))
	</pre><p>
</p></div><div class="refsection" title="関連情報"><a name="id287066663"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Collect" title="ST_Collect">ST_Collect</a>, <a class="xref" href="#ST_ConcaveHull" title="ST_ConcaveHull">ST_ConcaveHull</a>, <a class="xref" href="#ST_MinimumBoundingCircle" title="ST_MinimumBoundingCircle">ST_MinimumBoundingCircle</a></p></div></div><div class="refentry" title="ST_CurveToLine"><div class="refentry.separator"><hr></div><a name="ST_CurveToLine"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_CurveToLine ? CIRCULARSTRING/CURVEPOLYGONをLINESTRING/POLYGONに変換します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_CurveToLine</b>(</code>geometry <var class="pdparam">curveGeom</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_CurveToLine</b>(</code>geometry <var class="pdparam">curveGeom</var>, integer <var class="pdparam">segments_per_qtr_circle</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287066746"></a><h2>説明</h2><p>CIRCULARSTRING/CURVEPOLYGONをLINESTRING/POLYGONに変換します。CIRCULARSTRING型をサポートしないデバイスへの出力に使います。</p><p>与えられたジオメトリを線型ジオメトリに変換します。それぞれの曲線ジオメトリまたはその区分は4分の1円ごとに32区分とするのをデフォルトとする線型近似に変換します。</p><p>初出: 1.2.2?</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 7.1.7</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p></div><div class="refsection" title="例"><a name="id287066845"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(ST_CurveToLine(ST_GeomFromText('CIRCULARSTRING(220268 150415,220227 150505,220227 150406)')));

-- 結果 --
 LINESTRING(220268 150415,220269.95064912 150416.539364228,220271.823415575 150418.17258804,220273.613787707 150419.895736857,
 220275.317452352 150421.704659462,220276.930305234 150423.594998003,220278.448460847 150425.562198489,
 220279.868261823 150427.60152176,220281.186287736 150429.708054909,220282.399363347 150431.876723113,
 220283.50456625 150434.10230186,220284.499233914 150436.379429536,220285.380970099 150438.702620341,220286.147650624 150441.066277505,
 220286.797428488 150443.464706771,220287.328738321 150445.892130112,220287.740300149 150448.342699654,
 220288.031122486 150450.810511759,220288.200504713 150453.289621251,220288.248038775 150455.77405574,
 220288.173610157 150458.257830005,220287.977398166 150460.734960415,220287.659875492 150463.199479347,
 220287.221807076 150465.64544956,220286.664248262 150468.066978495,220285.988542259 150470.458232479,220285.196316903 150472.81345077,
 220284.289480732 150475.126959442,220283.270218395 150477.39318505,220282.140985384 150479.606668057,
 220280.90450212 150481.762075989,220279.5637474 150483.85421628,220278.12195122 150485.87804878,
 220276.582586992 150487.828697901,220274.949363179 150489.701464356,220273.226214362 150491.491836488,
 220271.417291757 150493.195501133,220269.526953216 150494.808354014,220267.559752731 150496.326509628,
 220265.520429459 150497.746310603,220263.41389631 150499.064336517,220261.245228106 150500.277412127,
 220259.019649359 150501.38261503,220256.742521683 150502.377282695,220254.419330878 150503.259018879,
 220252.055673714 150504.025699404,220249.657244448 150504.675477269,220247.229821107 150505.206787101,
 220244.779251566 150505.61834893,220242.311439461 150505.909171266,220239.832329968 150506.078553494,
 220237.347895479 150506.126087555,220234.864121215 150506.051658938,220232.386990804 150505.855446946,
 220229.922471872 150505.537924272,220227.47650166 150505.099855856,220225.054972724 150504.542297043,
 220222.663718741 150503.86659104,220220.308500449 150503.074365683,
 220217.994991777 150502.167529512,220215.72876617 150501.148267175,
 220213.515283163 150500.019034164,220211.35987523 150498.7825509,
 220209.267734939 150497.441796181,220207.243902439 150496,
 220205.293253319 150494.460635772,220203.420486864 150492.82741196,220201.630114732 150491.104263143,
 220199.926450087 150489.295340538,220198.313597205 150487.405001997,220196.795441592 150485.437801511,
 220195.375640616 150483.39847824,220194.057614703 150481.291945091,220192.844539092 150479.123276887,220191.739336189 150476.89769814,
 220190.744668525 150474.620570464,220189.86293234 150472.297379659,220189.096251815 150469.933722495,
 220188.446473951 150467.535293229,220187.915164118 150465.107869888,220187.50360229 150462.657300346,
 220187.212779953 150460.189488241,220187.043397726 150457.710378749,220186.995863664 150455.22594426,
 220187.070292282 150452.742169995,220187.266504273 150450.265039585,220187.584026947 150447.800520653,
 220188.022095363 150445.35455044,220188.579654177 150442.933021505,220189.25536018 150440.541767521,
 220190.047585536 150438.18654923,220190.954421707 150435.873040558,220191.973684044 150433.60681495,
 220193.102917055 150431.393331943,220194.339400319 150429.237924011,220195.680155039 150427.14578372,220197.12195122 150425.12195122,
 220198.661315447 150423.171302099,220200.29453926 150421.298535644,220202.017688077 150419.508163512,220203.826610682 150417.804498867,
 220205.716949223 150416.191645986,220207.684149708 150414.673490372,220209.72347298 150413.253689397,220211.830006129 150411.935663483,
 220213.998674333 150410.722587873,220216.22425308 150409.61738497,220218.501380756 150408.622717305,220220.824571561 150407.740981121,
 220223.188228725 150406.974300596,220225.586657991 150406.324522731,220227 150406)

-- 3次元の例
SELECT ST_AsEWKT(ST_CurveToLine(ST_GeomFromEWKT('CIRCULARSTRING(220268 150415 1,220227 150505 2,220227 150406 3)')));
Output
------
 LINESTRING(220268 150415 1,220269.95064912 150416.539364228 1.0181172856673,
 220271.823415575 150418.17258804 1.03623457133459,220273.613787707 150419.895736857 1.05435185700189,....AD INFINITUM ....
	220225.586657991 150406.324522731 1.32611114201132,220227 150406 3)

-- 2つの区分だけで4分の1円を近似
SELECT ST_AsText(ST_CurveToLine(ST_GeomFromText('CIRCULARSTRING(220268 150415,220227 150505,220227 150406)'),2));
st_astext
------------------------------
 LINESTRING(220268 150415,220287.740300149 150448.342699654,220278.12195122 150485.87804878,
 220244.779251566 150505.61834893,220207.243902439 150496,220187.50360229 150462.657300346,
 220197.12195122 150425.12195122,220227 150406)


		</pre></div><div class="refsection" title="関連情報"><a name="id287066858"></a><h2>関連情報</h2><p><a class="xref" href="#ST_LineToCurve" title="ST_LineToCurve">ST_LineToCurve</a></p></div></div><div class="refentry" title="ST_Difference"><div class="refentry.separator"><hr></div><a name="ST_Difference"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Difference ? ジオメトリBにインタセクトしないジオメトリAの部分を表現するジオメトリを返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Difference</b>(</code>geometry  <var class="pdparam">geomA</var>, geometry  <var class="pdparam">geomB</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287062549"></a><h2>説明</h2><p>ジオメトリBにインタセクトしないジオメトリAの部分を表現するジオメトリを返します。これは、ジオメトリA - ST_Intersection(A,B)と見ることができます。Aが完全にBに含まれる場合に、空ジオメトリコレクションが返されます。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>順序の問題に注意が必要です。B-Aでは常にBの部分が返ります。</p></td></tr></table></div><p>GEOSモジュールで実現しています。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ジオメトリコレクションを引数として呼ばないでください。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です s2.1.1.3</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.20</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。 ただし、差を取ってZインデクスを戻す時に、X Yのみ考慮に入れたように見えます。</p></div><div class="refsection" title="例"><a name="id287062612"></a><h2>例</h2><div class="informaltable"><table border="1"><colgroup><col><col></colgroup><tbody><tr><td>
						<p>
							</p><div class="informalfigure"><div class="mediaobject"><img src="images/st_symdifference01.png"><div class="caption"><p>元のラインストリングと一緒に表示</p></div></div></div><p>
						</p>
					</td><td>
						<div class="informalfigure"><div class="mediaobject"><img src="images/st_difference01.png"><div class="caption"><p>2つのラインストリングの差 </p></div></div></div><p>
					</p>
				</td></tr></tbody></table></div><pre class="programlisting">
-- 2次元では安全です。これは同じST_SymDifferenceで示したのと同じジオメトリです。
SELECT ST_AsText(
	ST_Difference(
			ST_GeomFromText('LINESTRING(50 100, 50 200)'),
			ST_GeomFromText('LINESTRING(50 50, 50 150)')
		)
	);

st_astext
---------
LINESTRING(50 150,50 200)
</pre><pre class="programlisting">

-- 3次元では正しく動作しません
SELECT ST_AsEWKT(ST_Difference(ST_GeomFromEWKT('MULTIPOINT(-118.58 38.38 5,-118.60 38.329 6,-118.614 38.281 7)'), ST_GeomFromEWKT('POINT(-118.614 38.281 5)')));
st_asewkt
---------
MULTIPOINT(-118.6 38.329 6,-118.58 38.38 5)
		</pre></div><div class="refsection" title="関連情報"><a name="id287062692"></a><h2>関連情報</h2><p><a class="xref" href="#ST_SymDifference" title="ST_SymDifference">ST_SymDifference</a></p></div></div><div class="refentry" title="ST_Dump"><div class="refentry.separator"><hr></div><a name="ST_Dump"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Dump ? ジオメトリg1から作られたgeometry_dump(geom, path)行の集合を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry_dump[] <b class="fsfunc">ST_Dump</b>(</code>geometry  <var class="pdparam">g1</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287062742"></a><h2>説明</h2><p>これは集合を返す関数(SRF=set-returning function)です。ジオメトリ(<code class="varname">geom</code>)と整数配列(<code class="varname">path</code>)で作られる<code class="varname">geometry_dump</code>行を返します。入力ジオメトリが単純型(POINT,LINESTRING,POLYGON)の場合は、単一の行で返り、pathには空配列、geomには入力ジオメトリが入ります。入力ジオメトリがジオメトリコレクションまたはMULTI系の場合は、要素ごとの行で返り、pathはコレクション内の要素位置を表します。</p><p>ST_Dumpはジオメトリを拡大するのに使います。新しい行を作る点では、GROUP BYの逆です。たとえば、MULTIPOLYGONをPOLYGON内に拡大するために使われます。</p><p>機能強化: 2.0.0では、多角形サーフェス、三角形、TINが導入されました。</p><p>初出: PostGIS 1.0.0RC1 PostgreSQL 7.3以上が必要です。 </p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Prior to 1.3.4, this function crashes if used with geometries that contain CURVES.  This is fixed in 1.3.4+</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は多面体サーフェスに対応しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は三角形と不規則三角網(TIN)に対応しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p></div><div class="refsection" title="標準的な例"><a name="id287062821"></a><h2>標準的な例</h2><pre class="programlisting">SELECT sometable.field1, sometable.field1,
      (ST_Dump(sometable.the_geom)).geom AS the_geom
FROM sometable;

-- COMPOUNDCURVEをLINESTRINGとCIRCULARSTRINGとに分けます
SELECT ST_AsEWKT(a.geom), ST_HasArc(a.geom)
  FROM ( SELECT (ST_Dump(p_geom)).geom AS geom
         FROM (SELECT ST_GeomFromEWKT('COMPOUNDCURVE(CIRCULARSTRING(0 0, 1 1, 1 0),(1 0, 0 1))') AS p_geom) AS b
        ) AS a;
          st_asewkt          | st_hasarc
-----------------------------+----------
 CIRCULARSTRING(0 0,1 1,1 0) | t
 LINESTRING(1 0,0 1)         | f
(2 rows)</pre></div><div class="refsection" title="Polyhedral Surfaces, TIN and Triangle Examples"><a name="id287062832"></a><h2>Polyhedral Surfaces, TIN and Triangle Examples</h2><pre class="programlisting">-- Polyhedral surface example
-- Break a Polyhedral surface into its faces
SELECT (a.p_geom).path[1] As path, ST_AsEWKT((a.p_geom).geom) As geom_ewkt
  FROM (SELECT ST_Dump(ST_GeomFromEWKT('POLYHEDRALSURFACE( 
((0 0 0, 0 0 1, 0 1 1, 0 1 0, 0 0 0)),  
((0 0 0, 0 1 0, 1 1 0, 1 0 0, 0 0 0)), ((0 0 0, 1 0 0, 1 0 1, 0 0 1, 0 0 0)),  ((1 1 0, 1 1 1, 1 0 1, 1 0 0, 1 1 0)),  
((0 1 0, 0 1 1, 1 1 1, 1 1 0, 0 1 0)),  ((0 0 1, 1 0 1, 1 1 1, 0 1 1, 0 0 1)) 
)') ) AS p_geom )  AS a;

 path |                geom_ewkt
------+------------------------------------------
    1 | POLYGON((0 0 0,0 0 1,0 1 1,0 1 0,0 0 0))
    2 | POLYGON((0 0 0,0 1 0,1 1 0,1 0 0,0 0 0))
    3 | POLYGON((0 0 0,1 0 0,1 0 1,0 0 1,0 0 0))
    4 | POLYGON((1 1 0,1 1 1,1 0 1,1 0 0,1 1 0))
    5 | POLYGON((0 1 0,0 1 1,1 1 1,1 1 0,0 1 0))
    6 | POLYGON((0 0 1,1 0 1,1 1 1,0 1 1,0 0 1))</pre><pre class="programlisting">-- TIN --		
SELECT (g.gdump).path, ST_AsEWKT((g.gdump).geom) as wkt
  FROM
    (SELECT 
       ST_Dump( ST_GeomFromEWKT('TIN (((
                0 0 0, 
                0 0 1, 
                0 1 0, 
                0 0 0
            )), ((
                0 0 0, 
                0 1 0, 
                1 1 0, 
                0 0 0
            ))
            )') ) AS gdump
    ) AS g;
-- 結果 --
 path |                 wkt
------+-------------------------------------
 {1}  | TRIANGLE((0 0 0,0 0 1,0 1 0,0 0 0))
 {2}  | TRIANGLE((0 0 0,0 1 0,1 1 0,0 0 0))
</pre></div><div class="refsection" title="関連情報"><a name="id287062881"></a><h2>関連情報</h2><p><a class="xref" href="#geometry_dump" title="geometry_dump">geometry_dump</a>, <a class="xref" href="#PostGIS_Geometry_DumpFunctions" title="13.5. PostGISジオメトリ/ジオグラフィ/ラスタダンプ関数">「PostGISジオメトリ/ジオグラフィ/ラスタダンプ関数」</a>, <a class="xref" href="#ST_Collect" title="ST_Collect">ST_Collect</a>, <a class="xref" href="#ST_Collect" title="ST_Collect">ST_Collect</a>, <a class="xref" href="#ST_GeometryN" title="ST_GeometryN">ST_GeometryN</a></p></div></div><div class="refentry" title="ST_DumpPoints"><div class="refentry.separator"><hr></div><a name="ST_DumpPoints"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_DumpPoints ? ジオメトリを作る全ての点のgometry_dump(geom,path)行の集合を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry_dump[]<b class="fsfunc">ST_DumpPoints</b>(</code>geometry  <var class="pdparam">geom</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287062944"></a><h2>説明</h2><p>この集合を返す関数(SRF=set-returning function)は、ジオメトリ(<code class="varname">geom</code>)と整数配列(<code class="varname">path</code>)で作られる<code class="varname">geometry_dump</code>行を返します。</p><p><code class="varname">geometry_dump</code>の<em class="parameter"><code>geom</code></em>要素は全て、与えられたジオメトリを作る<code class="varname">POINT</code>です。</p><p><code class="varname">geometry_dump</code>pの<em class="parameter"><code>path</code></em>要素(<code class="varname">integer[]</code>)は、与えられたジオメトリの<code class="varname">POINT</code>を列挙するインデクス参照です。たとえば、<code class="varname">LINESTRING</code>が与えられた場合に、<code class="varname">{i}</code>のpathが返ります。ここで、<code class="varname">i</code>は<code class="varname">LINESTRING</code>の<code class="varname">n</code>番目の座標です。<code class="varname">POLYGON</code>が与えられた場合には、<code class="varname">{i,j}</code>のpathが返ります。ここで、<code class="varname">i</code>は環番号(1が外環で、内環が続きます)で、<code class="varname">j</code>はPOINTを列挙するものです(1はじまり)。</p><p>機能強化: 2.0.0では、多角形サーフェス、三角形、TINが導入されました。</p><p>初出: 1.5.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は多面体サーフェスに対応しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は三角形と不規則三角網(TIN)に対応しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p></div><div class="refsection" title="標準的なジオメトリの例"><a name="id287063073"></a><h2>標準的なジオメトリの例</h2><div class="informalfigure"><div class="mediaobject"><img src="images/st_dumppoints01.png"></div></div><pre class="programlisting">SELECT path, ST_AsText(geom) 
FROM (
  SELECT (ST_DumpPoints(g.geom)).* 
  FROM
    (SELECT 
       'GEOMETRYCOLLECTION(
          POINT ( 0 1 ), 
          LINESTRING ( 0 3, 3 4 ),
          POLYGON (( 2 0, 2 3, 0 2, 2 0 )),
          POLYGON (( 3 0, 3 3, 6 3, 6 0, 3 0 ), 
                   ( 5 1, 4 2, 5 2, 5 1 )),
          MULTIPOLYGON (
                  (( 0 5, 0 8, 4 8, 4 5, 0 5 ), 
                   ( 1 6, 3 6, 2 7, 1 6 )), 
                  (( 5 4, 5 8, 6 7, 5 4 ))
          )
        )'::geometry AS geom
    ) AS g
  ) j;
  
   path    | st_astext  
-----------+------------
 {1,1}     | POINT(0 1)
 {2,1}     | POINT(0 3)
 {2,2}     | POINT(3 4)
 {3,1,1}   | POINT(2 0)
 {3,1,2}   | POINT(2 3)
 {3,1,3}   | POINT(0 2)
 {3,1,4}   | POINT(2 0)
 {4,1,1}   | POINT(3 0)
 {4,1,2}   | POINT(3 3)
 {4,1,3}   | POINT(6 3)
 {4,1,4}   | POINT(6 0)
 {4,1,5}   | POINT(3 0)
 {4,2,1}   | POINT(5 1)
 {4,2,2}   | POINT(4 2)
 {4,2,3}   | POINT(5 2)
 {4,2,4}   | POINT(5 1)
 {5,1,1,1} | POINT(0 5)
 {5,1,1,2} | POINT(0 8)
 {5,1,1,3} | POINT(4 8)
 {5,1,1,4} | POINT(4 5)
 {5,1,1,5} | POINT(0 5)
 {5,1,2,1} | POINT(1 6)
 {5,1,2,2} | POINT(3 6)
 {5,1,2,3} | POINT(2 7)
 {5,1,2,4} | POINT(1 6)
 {5,2,1,1} | POINT(5 4)
 {5,2,1,2} | POINT(5 8)
 {5,2,1,3} | POINT(6 7)
 {5,2,1,4} | POINT(5 4)
(29 rows)</pre></div><div class="refsection" title="多面体サーフェス、TIN、三角形の例"><a name="id287063098"></a><h2>多面体サーフェス、TIN、三角形の例</h2><pre class="programlisting">-- 多面体サーフェスの直方体 --		
SELECT (g.gdump).path, ST_AsEWKT((g.gdump).geom) as wkt
  FROM
    (SELECT 
       ST_DumpPoints(ST_GeomFromEWKT('POLYHEDRALSURFACE( ((0 0 0, 0 0 1, 0 1 1, 0 1 0, 0 0 0)), 
((0 0 0, 0 1 0, 1 1 0, 1 0 0, 0 0 0)), ((0 0 0, 1 0 0, 1 0 1, 0 0 1, 0 0 0)), 
((1 1 0, 1 1 1, 1 0 1, 1 0 0, 1 1 0)), 
((0 1 0, 0 1 1, 1 1 1, 1 1 0, 0 1 0)), ((0 0 1, 1 0 1, 1 1 1, 0 1 1, 0 0 1)) )') ) AS gdump
    ) AS g;
-- 結果 --
  path   |     wkt
---------+--------------
 {1,1,1} | POINT(0 0 0)
 {1,1,2} | POINT(0 0 1)
 {1,1,3} | POINT(0 1 1)
 {1,1,4} | POINT(0 1 0)
 {1,1,5} | POINT(0 0 0)
 {2,1,1} | POINT(0 0 0)
 {2,1,2} | POINT(0 1 0)
 {2,1,3} | POINT(1 1 0)
 {2,1,4} | POINT(1 0 0)
 {2,1,5} | POINT(0 0 0)
 {3,1,1} | POINT(0 0 0)
 {3,1,2} | POINT(1 0 0)
 {3,1,3} | POINT(1 0 1)
 {3,1,4} | POINT(0 0 1)
 {3,1,5} | POINT(0 0 0)
 {4,1,1} | POINT(1 1 0)
 {4,1,2} | POINT(1 1 1)
 {4,1,3} | POINT(1 0 1)
 {4,1,4} | POINT(1 0 0)
 {4,1,5} | POINT(1 1 0)
 {5,1,1} | POINT(0 1 0)
 {5,1,2} | POINT(0 1 1)
 {5,1,3} | POINT(1 1 1)
 {5,1,4} | POINT(1 1 0)
 {5,1,5} | POINT(0 1 0)
 {6,1,1} | POINT(0 0 1)
 {6,1,2} | POINT(1 0 1)
 {6,1,3} | POINT(1 1 1)
 {6,1,4} | POINT(0 1 1)
 {6,1,5} | POINT(0 0 1)
(30 rows)</pre><pre class="programlisting">-- 三角形 --		
SELECT (g.gdump).path, ST_AsText((g.gdump).geom) as wkt
  FROM
    (SELECT 
       ST_DumpPoints( ST_GeomFromEWKT('TRIANGLE ((
                0 0, 
                0 9, 
                9 0, 
                0 0
            ))') ) AS gdump
    ) AS g;
-- 結果 --
 path |    wkt
------+------------
 {1}  | POINT(0 0)
 {2}  | POINT(0 9)
 {3}  | POINT(9 0)
 {4}  | POINT(0 0)
</pre><pre class="programlisting">-- TIN --		
SELECT (g.gdump).path, ST_AsEWKT((g.gdump).geom) as wkt
  FROM
    (SELECT 
       ST_DumpPoints( ST_GeomFromEWKT('TIN (((
                0 0 0, 
                0 0 1, 
                0 1 0, 
                0 0 0
            )), ((
                0 0 0, 
                0 1 0, 
                1 1 0, 
                0 0 0
            ))
            )') ) AS gdump
    ) AS g;
-- 結果 --
  path   |     wkt
---------+--------------
 {1,1,1} | POINT(0 0 0)
 {1,1,2} | POINT(0 0 1)
 {1,1,3} | POINT(0 1 0)
 {1,1,4} | POINT(0 0 0)
 {2,1,1} | POINT(0 0 0)
 {2,1,2} | POINT(0 1 0)
 {2,1,3} | POINT(1 1 0)
 {2,1,4} | POINT(0 0 0)
(8 rows)
</pre></div><div class="refsection" title="関連情報"><a name="id287063117"></a><h2>関連情報</h2><p><a class="xref" href="#geometry_dump" title="geometry_dump">geometry_dump</a>, <a class="xref" href="#PostGIS_Geometry_DumpFunctions" title="13.5. PostGISジオメトリ/ジオグラフィ/ラスタダンプ関数">「PostGISジオメトリ/ジオグラフィ/ラスタダンプ関数」</a>, <a class="xref" href="#ST_Dump" title="ST_Dump">ST_Dump</a>, <a class="xref" href="#ST_DumpRings" title="ST_DumpRings">ST_DumpRings</a></p></div></div><div class="refentry" title="ST_DumpRings"><div class="refentry.separator"><hr></div><a name="ST_DumpRings"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_DumpRings ? ポリゴンの外環と内環を表す<code class="varname">geometry_dump</code>行の集合を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry_dump[] <b class="fsfunc">ST_DumpRings</b>(</code>geometry  <var class="pdparam">a_polygon</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287063180"></a><h2>説明</h2><p>これは集合を返す関数(SRF=set-returning function)です。それぞれ"path", "geom"と別名が付けられた<code class="varname">integer[]</code>, <code class="varname">geometry</code>として定義された<code class="varname">geometry_dump</code>行の集合を返します。"path"フィールドは、単一整数を持つ環のインデクスで、0が外環で、0より大きい値は内環です。"geom"フィールドは、ポリゴンとした対応する環を持ちます。</p><p>初出: PostGIS 1.1.3 PostgreSQL 7.3以上が必要です。 </p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>TPOLYGONジオメトリでのみ動作します。MULTIPOLYGONでは動作しません。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p></div><div class="refsection" title="例"><a name="id287063221"></a><h2>例</h2><pre class="programlisting">SELECT sometable.field1, sometable.field1,
	  (ST_DumpRings(sometable.the_geom)).geom As the_geom
FROM sometableOfpolys;

SELECT ST_AsEWKT(geom) As the_geom, path
	FROM ST_DumpRings(
		ST_GeomFromEWKT('POLYGON((-8149064 5133092 1,-8149064 5132986 1,-8148996 5132839 1,-8148972 5132767 1,-8148958 5132508 1,-8148941 5132466 1,-8148924 5132394 1,
		-8148903 5132210 1,-8148930 5131967 1,-8148992 5131978 1,-8149237 5132093 1,-8149404 5132211 1,-8149647 5132310 1,-8149757 5132394 1,
		-8150305 5132788 1,-8149064 5133092 1),
		(-8149362 5132394 1,-8149446 5132501 1,-8149548 5132597 1,-8149695 5132675 1,-8149362 5132394 1))')
		)  as foo;
 path |                                            the_geom
----------------------------------------------------------------------------------------------------------------
  {0} | POLYGON((-8149064 5133092 1,-8149064 5132986 1,-8148996 5132839 1,-8148972 5132767 1,-8148958 5132508 1,
	  |          -8148941 5132466 1,-8148924 5132394 1,
	  |          -8148903 5132210 1,-8148930 5131967 1,
	  |          -8148992 5131978 1,-8149237 5132093 1,
	  |          -8149404 5132211 1,-8149647 5132310 1,-8149757 5132394 1,-8150305 5132788 1,-8149064 5133092 1))
  {1} | POLYGON((-8149362 5132394 1,-8149446 5132501 1,
	  |          -8149548 5132597 1,-8149695 5132675 1,-8149362 5132394 1))</pre></div><div class="refsection" title="関連情報"><a name="id287063234"></a><h2>関連情報</h2><p><a class="xref" href="#geometry_dump" title="geometry_dump">geometry_dump</a>, <a class="xref" href="#PostGIS_Geometry_DumpFunctions" title="13.5. PostGISジオメトリ/ジオグラフィ/ラスタダンプ関数">「PostGISジオメトリ/ジオグラフィ/ラスタダンプ関数」</a>, <a class="xref" href="#ST_Dump" title="ST_Dump">ST_Dump</a>, <a class="xref" href="#ST_ExteriorRing" title="ST_ExteriorRing">ST_ExteriorRing</a>, <a class="xref" href="#ST_InteriorRingN" title="ST_InteriorRingN">ST_InteriorRingN</a></p></div></div><div class="refentry" title="ST_FlipCoordinates"><div class="refentry.separator"><hr></div><a name="ST_FlipCoordinates"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_FlipCoordinates ? 与えられたジオメトリのX軸とY軸とを入れ替えたものを返します。緯度/経度の地物を構築して、これを訂正したい場合に使います。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_FlipCoordinates</b>(</code>geometry <var class="pdparam">geom</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287063297"></a><h2>説明</h2><p>与えられたジオメトリのX軸とY軸とを入れ替えたものを返します。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数はM軸に対応しています。</p><p>初出: 2.0.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は多面体サーフェスに対応しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は三角形と不規則三角網(TIN)に対応しています。</p></div><div class="refsection" title="例"><a name="id287063401"></a><h2>例</h2><pre class="programlisting">
SELECT ST_AsEWKT(ST_FlipCoordinates(GeomFromEWKT('POINT(1 2)')));
 st_asewkt  
------------
POINT(2 1)
		 </pre></div></div><div class="refentry" title="ST_Intersection"><div class="refentry.separator"><hr></div><a name="ST_Intersection"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Intersection ? (T) geomAとgeomBの共有部分を表すジオメトリを返します。ジオグラフィ実装では、インタセクトするためにジオメトリに変換して、WGS84に戻します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Intersection</b>(</code>
						geometry
						<var class="pdparam">geomA</var>
					, 
						geometry
						<var class="pdparam">geomB</var>
					<code>)</code>;</p><p><code class="funcdef">geography <b class="fsfunc">ST_Intersection</b>(</code>
						geography
						<var class="pdparam">geogA</var>
					, 
						geography
						<var class="pdparam">geogB</var>
					<code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287063495"></a><h2>説明</h2><p>ジオメトリのインタセクションとなる点集合を表現するジオメトリを返します。</p><p>言い換えると、ジオメトリAとジオメトリBとで共有されている部分のことです。</p><p>ジオメトリの共有部分が無い(非接触になる)場合には、空ジオメトリコレクションが返されます。</p><p>ST_IntersectionとST_Intersectsとの併用は、バウンディングボックス、バッファ、領域のクエリ等で、対象とする国または地域にあるジオメトリの部分の返ってほしいところを切り取るのに使います。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ジオグラフィ: ジオメトリ実装にかぶさる、薄いラッパです。ジオグラフィオブジェクトのバウンディングボックスに最適なSRIDを決定し(UTMが望ましいですが、ランベルト正積方位図法(北/南)、最悪のシナリオでメルカトルに頼ります)、その平面でバッファを生成し、WGS84ジオグラフィに戻します。</p></td></tr></table></div><div class="important" title="重要" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[重要]" src="images/important.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">GEOMETRYCOLLECTION</code>を引数として呼ばないでください。</p></td></tr></table></div><p>GEOSモジュールで実現しています。</p><p>初出: 1.5 では、ジオグラフィ型が導入されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です s2.1.1.3</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.18</p></div><div class="refsection" title="例"><a name="id287063562"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(ST_Intersection('POINT(0 0)'::geometry, 'LINESTRING ( 2 0, 0 2 )'::geometry));
 st_astext
---------------
GEOMETRYCOLLECTION EMPTY
(1 row)
SELECT ST_AsText(ST_Intersection('POINT(0 0)'::geometry, 'LINESTRING ( 0 0, 0 2 )'::geometry));
 st_astext
---------------
POINT(0 0)
(1 row)

-- 全てのライン(trails)の、国(POLYGONまたはMUYLTIPOLYGONと仮定します)での切り取り
-- 注意: ポイントを共有するだけであるtrailに注意を払っていないので、
-- LINESTRINGまたはMULTILINESTRINGを返すインタセクションを保持しているだけです。
-- ダンプを行うには、ジオメトリコレクションを個々の単一のMULTI系に拡張する必要があります。
-- 下に示す例は、かなり一般的なもので、WHERE節を変更するだけでポリゴンで動作します。
SELECT clipped.gid, clipped.f_name, clipped_geom
FROM (SELECT trails.gid, trails.f_name, (ST_Dump(ST_Intersection(country.the_geom, trails.the_geom))).geom As clipped_geom
FROM country
	INNER JOIN trails
	ON ST_Intersects(country.the_geom, trails.the_geom))  As clipped
	WHERE ST_Dimension(clipped.clipped_geom) = 1 ;

-- ポリゴンランドマークといったpolyに、空ジオメトリコレクションを返すポリゴンを除いて、
-- 0.0のバッファ作成という速い方法を使うこともできます。
-- (ジオメトリコレクションはポリゴン、ライン、ポイントを含みます)
-- 0.0でのバッファ作成は、ポリゴンを残して、コレクションの外側をつなげるだけです。
SELECT poly.gid,  ST_Multi(ST_Buffer(
				ST_Intersection(country.the_geom, poly.the_geom),
				0.0)
				) As clipped_geom
FROM country
	INNER JOIN poly
	ON ST_Intersects(country.the_geom, poly.the_geom)
	WHERE Not ST_IsEmpty(ST_Buffer(ST_Intersection(country.the_geom, poly.the_geom),0.0));
		</pre></div><div class="refsection" title="関連情報"><a name="id287063573"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Difference" title="ST_Difference">ST_Difference</a>, <a class="xref" href="#ST_Dimension" title="ST_Dimension">ST_Dimension</a>, <a class="xref" href="#ST_Dump" title="ST_Dump">ST_Dump</a>, <a class="xref" href="#ST_SymDifference" title="ST_SymDifference">ST_SymDifference</a>, <a class="xref" href="#ST_Intersects" title="ST_Intersects">ST_Intersects</a>, <a class="xref" href="#ST_Multi" title="ST_Multi">ST_Multi</a></p></div></div><div class="refentry" title="ST_LineToCurve"><div class="refentry.separator"><hr></div><a name="ST_LineToCurve"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_LineToCurve ? LINESTRING/POLYGONをCIRCULARSTRINGとCURVED POLYGONに変換します。 </p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_LineToCurve</b>(</code>geometry  <var class="pdparam">geomANoncircular</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287063639"></a><h2>説明</h2><p>LINESTRING/POLYGONをCIRCULARSTRINGとCURVED POLYGONに変換します。等価の曲線を記述するのに必要なポイントが少なくなります。</p><p>初出: 1.2.2?</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p></div><div class="refsection" title="例"><a name="id287063674"></a><h2>例</h2><pre class="programlisting">
SELECT ST_AsText(ST_LineToCurve(foo.the_geom)) As curvedastext,ST_AsText(foo.the_geom) As non_curvedastext
	FROM (SELECT ST_Buffer('POINT(1 3)'::geometry, 3) As the_geom) As foo;

curvedatext                                                            non_curvedastext
--------------------------------------------------------------------|-----------------------------------------------------------------
CURVEPOLYGON(CIRCULARSTRING(4 3,3.12132034355964 0.878679656440359, | POLYGON((4 3,3.94235584120969 2.41472903395162,3.77163859753386 1.85194970290473,
1 0,-1.12132034355965 5.12132034355963,4 3))                        |  3.49440883690764 1.33328930094119,3.12132034355964 0.878679656440359,
                                                                    |  2.66671069905881 0.505591163092366,2.14805029709527 0.228361402466141,
                                                                    |  1.58527096604839 0.0576441587903094,1 0,
                                                                    |  0.414729033951621 0.0576441587903077,-0.148050297095264 0.228361402466137,
                                                                    |  -0.666710699058802 0.505591163092361,-1.12132034355964 0.878679656440353,
                                                                    |  -1.49440883690763 1.33328930094119,-1.77163859753386 1.85194970290472
                                                                    |  --ETC-- ,3.94235584120969 3.58527096604839,4 3))
-- 3次元の例
SELECT ST_AsEWKT(ST_LineToCurve(ST_GeomFromEWKT('LINESTRING(1 2 3, 3 4 8, 5 6 4, 7 8 4, 9 10 4)')));

			 st_asewkt
------------------------------------
 CIRCULARSTRING(1 2 3,5 6 4,9 10 4)

		</pre></div><div class="refsection" title="関連情報"><a name="id287063687"></a><h2>関連情報</h2><p><a class="xref" href="#ST_CurveToLine" title="ST_CurveToLine">ST_CurveToLine</a></p></div></div><div class="refentry" title="ST_MakeValid"><div class="refentry.separator"><hr></div><a name="ST_MakeValid"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MakeValid ? 頂点を失うことなしに不正なジオメトリを妥当なジオメトリにしようと試みます。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_MakeValid</b>(</code>geometry <var class="pdparam">input</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287063737"></a><h2>説明</h2><p>入力頂点を失うことなしに、与えられた不正なジオメトリの妥当な表現を生成しようと試みます。既に妥当であるジオメトリは、さらなる操作無しに返ります。</p><p>
    対応する入力はLINESTRINGS, MULTILINESTRINGS, POLYGONS, MULTIPOLYGONSです。
    </p><p>全部また部分的に次元減少が発生した場合には、出力ジオメトリが低い次元のジオメトリまたは元の次元以下の次元のコレクションになります。</p><p>シングルポリゴンは、自己インタセクトがある場合には、マルチポリゴンになります。</p><p>初出: 2.0.0, GEOS 3.3.0以上が必要です。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p></div><div class="refsection" title="関連情報"><a name="id287063772"></a><h2>関連情報</h2><p>
                <a class="xref" href="#ST_IsValid" title="ST_IsValid">ST_IsValid</a>
                <a class="xref" href="#ST_CollectionExtract" title="ST_CollectionExtract">ST_CollectionExtract</a>
            </p></div></div><div class="refentry" title="ST_MemUnion"><div class="refentry.separator"><hr></div><a name="ST_MemUnion"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MemUnion ? ST_Unionと同じですが、メモリフレンドリ(少ないメモリ使用、多いCPU時間)です。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_MemUnion</b>(</code>geometry set <var class="pdparam">geomfield</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287063862"></a><h2>説明</h2><p>ST_Unionと同じですが、メモリフレンドリ(少ないメモリ使用、多いCPU時間)ですこの集計関数は、最初に配列を作って結合していくST_Union集計関数と対象的に、1つずつ前の結果にジオメトリを結合させることによって動作します。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p></div><div class="refsection" title="例"><a name="id287063885"></a><h2>例</h2><pre class="programlisting">See ST_Union</pre></div><div class="refsection" title="関連情報"><a name="id287063899"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Union" title="ST_Union">ST_Union</a></p></div></div><div class="refentry" title="ST_MinimumBoundingCircle"><div class="refentry.separator"><hr></div><a name="ST_MinimumBoundingCircle"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MinimumBoundingCircle ? ジオメトリを完全に含む最小の円ポリゴンを返します。デフォルトでは、4分の1円に対して48区分を使用します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_MinimumBoundingCircle</b>(</code>geometry  <var class="pdparam">geomA</var>, integer  <var class="pdparam">num_segs_per_qt_circ=48</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287063958"></a><h2>説明</h2><p>ジオメトリを完全に含む最小の円ポリゴンを返します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>	円は、デフォルトでは、4分の1円に対して48区分を使用した近似円です。より精度良い結果を得るには、この数を増やします。ほとんどパフォーマンス上のペナルティがありません。</p></td></tr></table></div><p>しばしば、MULTI系とジオメトリコレクションで使用します。しかし、集計関数ではありません。ST_MinimumBoundingCircle(ST_Collect(somepointfield))として、ST_Collectと併用して、ジオメトリの集合の最小バウンディング円を得ます。</p><p>ポリゴンの面積を最小バウンディング円の面積で割った割合は、しばしばRoeckテストとして参照されます。</p><p>初出: 1.4.0 - GEOSが必要です。</p></div><div class="refsection" title="例"><a name="id287063982"></a><h2>例</h2><pre class="programlisting">SELECT d.disease_type,
	ST_MinimumBoundingCircle(ST_Collect(d.the_geom)) As the_geom
	FROM disease_obs As d
	GROUP BY d.disease_type;
</pre><div class="informalfigure"><div class="mediaobject"><img src="images/st_minimumboundingcircle01.png"><div class="caption"><p>ポイントとラインストリングの最小バウンディング円です。4分の1円の近似に8区分使用しています。</p></div></div></div><pre class="programlisting">
SELECT ST_AsText(ST_MinimumBoundingCircle(
		ST_Collect(
			ST_GeomFromEWKT('LINESTRING(55 75,125 150)'),
				ST_Point(20, 80)), 8
				)) As wktmbc;
wktmbc
-----------
POLYGON((135.59714732062 115,134.384753327498 102.690357210921,130.79416296937 90.8537670908995,124.963360620072 79.9451031602111,117.116420743937 70.3835792560632,107.554896839789 62.5366393799277,96.6462329091006 56.70583703063,84.8096427890789 53.115246672502,72.5000000000001 51.9028526793802,60.1903572109213 53.1152466725019,48.3537670908996 56.7058370306299,37.4451031602112 62.5366393799276,27.8835792560632 70.383579256063,20.0366393799278 79.9451031602109,14.20583703063 90.8537670908993,10.615246672502 102.690357210921,9.40285267938019 115,10.6152466725019 127.309642789079,14.2058370306299 139.1462329091,20.0366393799275 150.054896839789,27.883579256063 159.616420743937,
37.4451031602108 167.463360620072,48.3537670908992 173.29416296937,60.190357210921 176.884753327498,
72.4999999999998 178.09714732062,84.8096427890786 176.884753327498,96.6462329091003 173.29416296937,107.554896839789 167.463360620072,
117.116420743937 159.616420743937,124.963360620072 150.054896839789,130.79416296937 139.146232909101,134.384753327498 127.309642789079,135.59714732062 115))
				</pre></div><div class="refsection" title="関連情報"><a name="id287064016"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Collect" title="ST_Collect">ST_Collect</a>, <a class="xref" href="#ST_ConvexHull" title="ST_ConvexHull">ST_ConvexHull</a></p></div></div><div class="refentry" title="ST_Polygonize"><div class="refentry.separator"><hr></div><a name="ST_Polygonize"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Polygonize ? 集計関数。ジオメトリの集合のラインから形成されうるポリゴンを含むジオメトリコレクションを生成します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Polygonize</b>(</code>geometry set <var class="pdparam">geomfield</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_Polygonize</b>(</code>geometry[] <var class="pdparam">geom_array</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287064087"></a><h2>説明</h2><p>ジオメトリの集合のラインから形成された可能なポリゴンを含むジオメトリコレクションを生成します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ジオメトリコレクションはしばしばサードパーティのツールでは扱いにくいことがあります。ST_Polygonizeを<a class="xref" href="#ST_Dump" title="ST_Dump">ST_Dump</a>と併用して、ポリゴンを個々のポリゴンにダンプします。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数が正しく動作するには、入力ラインに正しくノードが作成されている必要があります。</p></td></tr></table></div><p>初出: 1.0.0RC1 - GEOS 2.1.0が必要です。</p></div><div class="refsection" title="例: シングルラインストリングのポリゴン化"><a name="id287064117"></a><h2>例: シングルラインストリングのポリゴン化</h2><pre class="programlisting">
SELECT ST_AsEWKT(ST_Polygonize(the_geom_4269)) As geomtextrep
FROM (SELECT the_geom_4269 FROM ma.suffolk_edges ORDER BY tlid LIMIT 45) As foo;

geomtextrep
-------------------------------------
 SRID=4269;GEOMETRYCOLLECTION(POLYGON((-71.040878 42.285678,-71.040943 42.2856,-71.04096 42.285752,-71.040878 42.285678)),
 POLYGON((-71.17166 42.353675,-71.172026 42.354044,-71.17239 42.354358,-71.171794 42.354971,-71.170511 42.354855,
 -71.17112 42.354238,-71.17166 42.353675)))
(1 row)

-- ポリゴン化ジオメトリを個々のポリゴンにダンプするためST_Dumpを使います
SELECT ST_AsEWKT((ST_Dump(foofoo.polycoll)).geom) As geomtextrep
FROM (SELECT ST_Polygonize(the_geom_4269) As polycoll
	FROM (SELECT the_geom_4269 FROM ma.suffolk_edges
		ORDER BY tlid LIMIT 45) As foo) As foofoo;

geomtextrep
------------------------
 SRID=4269;POLYGON((-71.040878 42.285678,-71.040943 42.2856,-71.04096 42.285752,
-71.040878 42.285678))
 SRID=4269;POLYGON((-71.17166 42.353675,-71.172026 42.354044,-71.17239 42.354358
,-71.171794 42.354971,-71.170511 42.354855,-71.17112 42.354238,-71.17166 42.353675))
(2 rows)

			  </pre></div><div class="refsection" title="関連情報"><a name="id287064128"></a><h2>関連情報</h2><p>
			<a class="xref" href="#ST_Node" title="ST_Node">ST_Node</a>,
			<a class="xref" href="#ST_Dump" title="ST_Dump">ST_Dump</a>
			</p></div></div><div class="refentry" title="ST_Node"><div class="refentry.separator"><hr></div><a name="ST_Node"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Node ? ラインストリングの集合にノードを作成します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Node</b>(</code>geometry  <var class="pdparam">geom</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287064183"></a><h2>説明</h2><p>最小の可能なノード数を使ってラインストリングにノードを作成します。全ての入力ラインストリングは保存されます。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p>初出: 2.0.0 - GEOS 3.3.0以上が必要です。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>GEOS 3.3.1までのバグのため、この関数は自己インタセクトするラインのノード作成に失敗します。GEOS 3.3.2以上で訂正されています。</p></td></tr></table></div></div><div class="refsection" title="例"><a name="id287064212"></a><h2>例</h2><pre class="programlisting">
SELECT ST_AsEWKT(
		ST_Node('LINESTRINGZ(0 0 0, 10 10 10, 0 10 5, 10 0 3)'::geometry)
	) As  output;
output
-----------
MULTILINESTRING((0 0 0,5 5 4.5),(5 5 4.5,10 10 10,0 10 5,5 5 4.5),(5 5 4.5,10 0 3))	
		</pre></div><div class="refsection" title="関連情報"><a name="id287064225"></a><h2>関連情報</h2><p>
			<a class="xref" href="#ST_UnaryUnion" title="ST_UnaryUnion">ST_UnaryUnion</a>
		</p></div></div><div class="refentry" title="ST_OffsetCurve"><div class="refentry.separator"><hr></div><a name="ST_OffsetCurve"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_OffsetCurve ? 与えられた距離と方面に入力ラインをずらしたラインを返します。中心線と平行する線を引く際に使用します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_OffsetCurve</b>(</code>geometry  <var class="pdparam">line</var>, float  <var class="pdparam">signed_distance</var>, text  <var class="pdparam">style_parameters=''</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287064295"></a><h2>説明</h2><p>与えられた距離と方面に入力ラインをずらしたラインを返します。返されるジオメトリの全てのポイントは、入力ジオメトリより与えられた距離以上には離れません。</p><p>距離が正の場合には、入力ラインの左側にずらして、方向が保持されます。負の場合には、右側にずらし、逆方向のラインになります。</p><p>初出: 2.0 - GEOS 3.2以上、GEOS 3.3以上で改善されました。</p><p>任意指定の第3引数では、空白区切りのkey=valueペアの一覧を指定して、次のような操作をすることができます。
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>'quad_segs=#' : 4分の1円近似の区分数(デフォルトは8)。</p></li><li class="listitem"><p>'join=round|mitre|bevel' : 接続スタイル(デフォルトは"round")。'miter'も'mitre'の同義語として受け付けます。</p></li><li class="listitem"><p>'mitre_limit=#.#' : マイターの割合制限(接続スタイルがマイターである場合のみ影響が出ます)。'miter_limit'も'mitre_limit'の同義語として受け付けます。</p></li></ul></div><p>
				</p><p>距離の単位は空間参照系の単位です。</p><p>入力はLINESTRINGのみ可能です。</p><p>GEOSモジュールで実現しています。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数は第3次元(Z)を無視し、3次元ジオメトリが与えられたとしても、常に2次元の結果を返します。</p></td></tr></table></div></div><div class="refsection" title="例"><a name="id287064352"></a><h2>例</h2><p>Compute an open buffer around roads</p><pre class="programlisting">
SELECT ST_Union(
 ST_OffsetCurve(f.the_geom,  f.width/2, 'quad_segs=4 join=round'),
 ST_OffsetCurve(f.the_geom, -f.width/2, 'quad_segs=4 join=round')
) as track
FROM someroadstable;

				</pre><div class="informaltable"><table border="1"><colgroup><col><col></colgroup><tbody><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_offsetcurve01.png"><div class="caption"><p>15, 'quad_segs=4 join=round' 元のラインと15単位ずらしたライン。</p></div></div></div><p>
				</p><pre class="programlisting">
SELECT ST_AsText(ST_OffsetCurve(ST_GeomFromText(
'LINESTRING(164 16,144 16,124 16,104 16,84 16,64 16,
	44 16,24 16,20 16,18 16,17 17,
	16 18,16 20,16 40,16 60,16 80,16 100,
	16 120,16 140,16 160,16 180,16 195)'),
	15, 'quad_segs=4 join=round'));
-- 出力 --
LINESTRING(164 1,18 1,12.2597485145237 2.1418070123307,
	7.39339828220179 5.39339828220179,
	5.39339828220179 7.39339828220179,
	2.14180701233067 12.2597485145237,1 18,1 195)
				</pre><p>
						  </p></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_offsetcurve02.png"><div class="caption"><p>-15, 'quad_segs=4 join=round' 元のラインと-15単位ずらしたライン。</p></div></div></div><p>
				</p><pre class="programlisting">
SELECT ST_AsText(ST_OffsetCurve(geom,
	-15, 'quad_segs=4 join=round')) As notsocurvy
	FROM ST_GeomFromText(
'LINESTRING(164 16,144 16,124 16,104 16,84 16,64 16,
	44 16,24 16,20 16,18 16,17 17,
	16 18,16 20,16 40,16 60,16 80,16 100,
	16 120,16 140,16 160,16 180,16 195)') As geom;
-- 曲線になりません --
LINESTRING(31 195,31 31,164 31)
				</pre><p>
						</p></td></tr><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_offsetcurve05.png"><div class="caption"><p>二重にずらして曲線を得ます。1回目で逆方向にしていて、-30 + 15 = -15としています。</p></div></div></div><p>
				</p><pre class="programlisting">
SELECT ST_AsText(ST_OffsetCurve(ST_OffsetCurve(geom,
	-30, 'quad_segs=4 join=round'), -15, 'quad_segs=4 join=round')) As morecurvy
	FROM ST_GeomFromText(
'LINESTRING(164 16,144 16,124 16,104 16,84 16,64 16,
	44 16,24 16,20 16,18 16,17 17,
	16 18,16 20,16 40,16 60,16 80,16 100,
	16 120,16 140,16 160,16 180,16 195)') As geom;
-- 曲線 --
LINESTRING(164 31,46 31,40.2597485145236 32.1418070123307,
35.3933982822018 35.3933982822018,
32.1418070123307 40.2597485145237,31 46,31 195)
				</pre><p>
						</p></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_offsetcurve06.png"><div class="caption"><p>二重にずらして曲線を得て、順方向に15ずらして平行線を得ます。元のラインを覆います。</p></div></div></div><p>
				</p><pre class="programlisting">SELECT ST_AsText(ST_Collect(
	ST_OffsetCurve(geom, 15, 'quad_segs=4 join=round'), 
	ST_OffsetCurve(ST_OffsetCurve(geom,
	-30, 'quad_segs=4 join=round'), -15, 'quad_segs=4 join=round')
	)
) As parallel_curves
	FROM ST_GeomFromText(
'LINESTRING(164 16,144 16,124 16,104 16,84 16,64 16,
	44 16,24 16,20 16,18 16,17 17,
	16 18,16 20,16 40,16 60,16 80,16 100,
	16 120,16 140,16 160,16 180,16 195)') As geom;
-- 並行曲線 --
MULTILINESTRING((164 1,18 1,12.2597485145237 2.1418070123307,
7.39339828220179 5.39339828220179,5.39339828220179 7.39339828220179,
2.14180701233067 12.2597485145237,1 18,1 195),
(164 31,46 31,40.2597485145236 32.1418070123307,35.3933982822018 35.3933982822018,
32.1418070123307 40.2597485145237,31 46,31 195))
				</pre><p>
						</p></td></tr><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_offsetcurve03.png"><div class="caption"><p>15, 'quad_segs=4 join=bevel' と元のライン</p></div></div></div><p>
				</p><pre class="programlisting">
SELECT ST_AsText(ST_OffsetCurve(ST_GeomFromText(
'LINESTRING(164 16,144 16,124 16,104 16,84 16,64 16,
	44 16,24 16,20 16,18 16,17 17,
	16 18,16 20,16 40,16 60,16 80,16 100,
	16 120,16 140,16 160,16 180,16 195)'), 
		15, 'quad_segs=4 join=bevel'));
-- 出力 --
LINESTRING(164 1,18 1,7.39339828220179 5.39339828220179,
	5.39339828220179 7.39339828220179,1 18,1 195)
				</pre><p>
						 </p></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_offsetcurve04.png"><div class="caption"><p>join=mitre mitre_limit=2.1で、15ずらしたものと-15ずらしたものとを集めたもの。</p></div></div></div><p>
				</p><pre class="programlisting">
SELECT ST_AsText(ST_Collect(
	ST_OffsetCurve(geom, 15, 'quad_segs=4 join=mitre mitre_limit=2.2'),
	ST_OffsetCurve(geom, -15, 'quad_segs=4 join=mitre mitre_limit=2.2')
	) )
	FROM ST_GeomFromText(
'LINESTRING(164 16,144 16,124 16,104 16,84 16,64 16,
	44 16,24 16,20 16,18 16,17 17,
	16 18,16 20,16 40,16 60,16 80,16 100,
	16 120,16 140,16 160,16 180,16 195)') As geom;
-- output --
MULTILINESTRING((164 1,11.7867965644036 1,1 11.7867965644036,1 195),
	(31 195,31 31,164 31))
				</pre><p>
						  </p></td></tr></tbody></table></div></div><div class="refsection" title="関連情報"><a name="id287064579"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Buffer" title="ST_Buffer">ST_Buffer</a></p></div></div><div class="refentry" title="ST_RemoveRepeatedPoints"><div class="refentry.separator"><hr></div><a name="ST_RemoveRepeatedPoints"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_RemoveRepeatedPoints ? 入力ジオメトリから重複ポイントを除いたものを返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_RemoveRepeatedPoints</b>(</code>geometry <var class="pdparam">geom</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287064663"></a><h2>説明</h2><p>入力ジオメトリから重複ポイントを除いたものを返します。実際には(MULTI)LINE, (MULTI)POLYGONとMULTIPOINTで動作します。あらゆる種類のジオメトリで安全に呼び出せます。簡略化がオブジェクトごとに行われるので、ジオメトリコレクションでこの関数を呼ぶことができます。</p><p>初出: 2.0.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は多面体サーフェスに対応しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p></div><div class="refsection" title="関連情報"><a name="id287064699"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Simplify" title="ST_Simplify">ST_Simplify</a></p></div></div><div class="refentry" title="ST_SharedPaths"><div class="refentry.separator"><hr></div><a name="ST_SharedPaths"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SharedPaths ? 2つの入力LINESTRING/MULTILINESTRINGが共有するパスのコレクションを返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_SharedPaths</b>(</code>geometry <var class="pdparam">lineal1</var>, geometry <var class="pdparam">lineal2</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287064758"></a><h2>説明</h2><p>2つの入力ジオメトリが共有するパスのコレクションを返します。順方向に行くものはコレクションの1つ目の要素にあり、逆方向は2つ目の要素にあります。これらのパス自体は1つ目のジオメトリの方向をもとにします。</p><p>初出: 2.0.0 GEOS 3.3.0以上が必要です。</p></div><div class="refsection" title="例: 共有パスの探索"><a name="id287064771"></a><h2>例: 共有パスの探索</h2><div class="informaltable"><table border="1"><colgroup><col></colgroup><tbody><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_sharedpaths01.png"><div class="caption"><p>マルチラインストリングとラインストリング。</p></div></div></div>
			   </td></tr><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_sharedpaths02.png"><div class="caption"><p>マルチラインストリングとラインストリングとの共有パスと元のジオメトリ。</p></div></div></div><p>
				  </p><pre class="programlisting">
 SELECT ST_AsText(
  ST_SharedPaths(
    ST_GeomFromText('MULTILINESTRING((26 125,26 200,126 200,126 125,26 125),
 	   (51 150,101 150,76 175,51 150))'),
 	ST_GeomFromText('LINESTRING(151 100,126 156.25,126 125,90 161, 76 175)')
 	)
  ) As wkt

                                wkt
-------------------------------------------------------------
GEOMETRYCOLLECTION(MULTILINESTRING((126 156.25,126 125),
 (101 150,90 161),(90 161,76 175)),MULTILINESTRING EMPTY)
			  </pre><p>
			</p>
			</td></tr><tr><td><p>
				  </p><pre class="programlisting">
-- ラインストリングが反転する以外は同じ場合の例
SELECT ST_AsText(
  ST_SharedPaths(
   ST_GeomFromText('LINESTRING(76 175,90 161,126 125,126 156.25,151 100)'),
   ST_GeomFromText('MULTILINESTRING((26 125,26 200,126 200,126 125,26 125),
 	   (51 150,101 150,76 175,51 150))')
 	)
  ) As wkt

                                wkt
-------------------------------------------------------------
GEOMETRYCOLLECTION(MULTILINESTRING EMPTY,
MULTILINESTRING((76 175,90 161),(90 161,101 150),(126 125,126 156.25)))
			  </pre><p>
			</p>
			</td></tr></tbody></table></div></div><div class="refsection" title="関連情報"><a name="id287069499"></a><h2>関連情報</h2><p>
		<a class="xref" href="#ST_Dump" title="ST_Dump">ST_Dump</a>,
		<a class="xref" href="#ST_GeometryN" title="ST_GeometryN">ST_GeometryN</a>,
		<a class="xref" href="#ST_NumGeometries" title="ST_NumGeometries">ST_NumGeometries</a>
	</p></div></div><div class="refentry" title="ST_Shift_Longitude"><div class="refentry.separator"><hr></div><a name="ST_Shift_Longitude"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Shift_Longitude ? ジオメトリの全ての地物の全ての構成要素の全てのポイント/頂点を読み、経度が0未満なら360を足します。結果は、180度を中心とした地図にプロットされる0度から360度の間にあるデータとなります。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Shift_Longitude</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287069557"></a><h2>説明</h2><p>ジオメトリの全ての地物の全ての構成要素の全てのポイント/頂点を読み、経度が0未満なら360を足します。結果は、180度を中心とした地図にプロットされる0度から360度の間にあるデータとなります。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これは4326(WGS84経度緯度)のように経度緯度でのみ動作します。</p></td></tr></table></div><p><img src="images/warning.png">
			1.3.4より前ではMULTIPOINTでは動作しないバグがありました。1.3.4以上ではMULTIPOINTでも動作します。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p>機能強化: 2.0.0では、多面体サーフェスとTINが導入されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は多面体サーフェスに対応しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は三角形と不規則三角網(TIN)に対応しています。</p></div><div class="refsection" title="例"><a name="id287069650"></a><h2>例</h2><pre class="programlisting">-- 3次元ポイント
SELECT ST_AsEWKT(ST_Shift_Longitude(ST_GeomFromEWKT('SRID=4326;POINT(-118.58 38.38 10)'))) As geomA,
	ST_AsEWKT(ST_Shift_Longitude(ST_GeomFromEWKT('SRID=4326;POINT(241.42 38.38 10)'))) As geomb
geomA							  geomB
----------						  -----------
SRID=4326;POINT(241.42 38.38 10) SRID=4326;POINT(-118.58 38.38 10)

-- 普通のラインストリング
SELECT ST_AsText(ST_Shift_Longitude(ST_GeomFromText('LINESTRING(-118.58 38.38, -118.20 38.45)')))

st_astext
----------
LINESTRING(241.42 38.38,241.8 38.45)
		</pre></div><div class="refsection" title="関連情報"><a name="id287069664"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a>, <a class="xref" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a>, <a class="xref" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a></p></div></div><div class="refentry" title="ST_Simplify"><div class="refentry.separator"><hr></div><a name="ST_Simplify"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Simplify ? 与えられたジオメトリを「簡略化」したものを返します。Douglas-Peukerアルゴリズムを使用します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Simplify</b>(</code>geometry <var class="pdparam">geomA</var>, float <var class="pdparam">tolerance</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287069728"></a><h2>説明</h2><p>与えられたジオメトリを「簡略化」したものを返します。Douglas-Peukerアルゴリズムを使用します。(MULTI)LINEと(MULTI)POLYGONとで実際に動作をしますが、どのような種類のジオメトリでも安全に呼ぶことができます。簡略化はオブジェクトごとに行われるので、ジオメトリコレクションでこの関数を呼ぶことができます。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>返されるジオメトリは単純さ(<a class="xref" href="#ST_IsSimple" title="ST_IsSimple">ST_IsSimple</a>参照)を失うことがあります。トポロジを保存するには<a class="xref" href="#ST_SimplifyPreserveTopology" title="ST_SimplifyPreserveTopology">ST_SimplifyPreserveTopology</a>を使います。</p></td></tr></table></div><p>GEOSモジュールで実現しています。</p><p>初出: 1.2.2</p></div><div class="refsection" title="例"><a name="id287069755"></a><h2>例</h2><p>簡略化をやりすぎて三角形になった円、八角形になる円です。</p><pre class="programlisting">
SELECT ST_Npoints(the_geom) As np_before, ST_NPoints(ST_Simplify(the_geom,0.1)) As np01_notbadcircle, ST_NPoints(ST_Simplify(the_geom,0.5)) As np05_notquitecircle,
ST_NPoints(ST_Simplify(the_geom,1)) As np1_octagon, ST_NPoints(ST_Simplify(the_geom,10)) As np10_triangle,
(ST_Simplify(the_geom,100) is null) As  np100_geometrygoesaway
FROM (SELECT ST_Buffer('POINT(1 3)', 10,12) As the_geom) As foo;
-result
 np_before | np01_notbadcircle | np05_notquitecircle | np1_octagon | np10_triangle | np100_geometrygoesaway
-----------+-------------------+---------------------+-------------+---------------+------------------------
		49 |                33 |                  17 |           9 |             4 | t

				</pre></div><div class="refsection" title="関連情報"><a name="id287069769"></a><h2>関連情報</h2><p><a class="xref" href="#ST_IsSimple" title="ST_IsSimple">ST_IsSimple</a>, <a class="xref" href="#ST_SimplifyPreserveTopology" title="ST_SimplifyPreserveTopology">ST_SimplifyPreserveTopology</a></p></div></div><div class="refentry" title="ST_SimplifyPreserveTopology"><div class="refentry.separator"><hr></div><a name="ST_SimplifyPreserveTopology"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SimplifyPreserveTopology ? 与えられたジオメトリを「簡略化」したものを返します。Douglas-Peukerアルゴリズムを使用します。不正な派生ジオメトリ(特にポリゴン)の生成を回避します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_SimplifyPreserveTopology</b>(</code>geometry <var class="pdparam">geomA</var>, float <var class="pdparam">tolerance</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287069831"></a><h2>説明</h2><p>与えられたジオメトリを「簡略化」したものを返します。Douglas-Peukerアルゴリズムを使用します。不正な派生ジオメトリ(特にポリゴン)の生成を回避します。(MULTI)LINEと(MULTI)POLYGONとで実際に動作をしますが、どのような種類のジオメトリでも安全に呼ぶことができます。簡略化はオブジェクトごとに行われるので、ジオメトリコレクションでこの関数を呼ぶことができます。</p><p>GEOSモジュールで実現しています。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>GEOS 3.0.0以上が必要です。</p></td></tr></table></div><p>初出: 1.3.3</p></div><div class="refsection" title="例"><a name="id287069851"></a><h2>例</h2><p>Simplyfyと同じ例ですが、トポロジ保存で簡略化の行きすぎを阻止します。円は最低でも四角形になります。</p><pre class="programlisting">
SELECT ST_Npoints(the_geom) As np_before, ST_NPoints(ST_SimplifyPreserveTopology(the_geom,0.1)) As np01_notbadcircle, ST_NPoints(ST_SimplifyPreserveTopology(the_geom,0.5)) As np05_notquitecircle,
ST_NPoints(ST_SimplifyPreserveTopology(the_geom,1)) As np1_octagon, ST_NPoints(ST_SimplifyPreserveTopology(the_geom,10)) As np10_square,
ST_NPoints(ST_SimplifyPreserveTopology(the_geom,100)) As  np100_stillsquare
FROM (SELECT ST_Buffer('POINT(1 3)', 10,12) As the_geom) As foo;

-- 結果 --
 np_before | np01_notbadcircle | np05_notquitecircle | np1_octagon | np10_square | np100_stillsquare
-----------+-------------------+---------------------+-------------+---------------+-------------------
		49 |                33 |                  17 |           9 |             5 |                 5
				</pre></div><div class="refsection" title="関連情報"><a name="id287069865"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Simplify" title="ST_Simplify">ST_Simplify</a></p></div></div><div class="refentry" title="ST_Split"><div class="refentry.separator"><hr></div><a name="ST_Split"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Split ? ジオメトリを分割したジオメトリのコレクションを返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Split</b>(</code>geometry <var class="pdparam">input</var>, geometry <var class="pdparam">blade</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287069924"></a><h2>説明</h2><p>この関数は、ラインのポイントによる分割、ラインのラインによる分割、ポリゴンのラインによる分割に対応しています。返されるジオメトリは常にコレクションです。</p><p>この関数はST_Unionの逆と考えられます。理論的には、返されたコレクションにST_Unionを適用すると、常に元のジオメトリが得られます。</p><p>初出: 2.0.0</p></div><div class="refsection" title="例"><a name="id287069941"></a><h2>例</h2><p>ラインに切られるポリゴン</p><div class="informaltable"><table border="1"><colgroup><col><col></colgroup><tbody><tr><td>
                                               <p>
                            </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_split01.png"><div class="caption"><p>分割前</p></div></div></div><p>
                                               </p>
                        </td><td>
                                               <p>
                            </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_split02.png"><div class="caption"><p>分割後</p></div></div></div><p>
                                              </p>
                        </td></tr></tbody></table></div><pre class="programlisting">
-- 2つの半分になったポリゴンからなるジオメトリコレクションを生成します
-- ST_BuildAreaでの例に似ています
SELECT ST_Split(circle, line)
FROM (SELECT 
    ST_MakeLine(ST_MakePoint(10, 10),ST_MakePoint(190, 190)) As line,
    ST_Buffer(ST_GeomFromText('POINT(100 90)'), 50) As circle) As foo;
    
-- 結果 --
 GEOMETRYCOLLECTION(POLYGON((150 90,149.039264020162 80.2454838991936,146.193976625564 70.8658283817455,..), POLYGON(..)))
 
-- ST_DumpかST_GeometryNを使って個々のポリゴンに変換できます
SELECT ST_AsText((ST_Dump(ST_Split(circle, line))).geom) As wkt
FROM (SELECT 
    ST_MakeLine(ST_MakePoint(10, 10),ST_MakePoint(190, 190)) As line,
    ST_Buffer(ST_GeomFromText('POINT(100 90)'), 50) As circle) As foo;
    
-- 結果 --
wkt
---------------
POLYGON((150 90,149.039264020162 80.2454838991936,..))
POLYGON((60.1371179574584 60.1371179574584,58.4265193848728 62.2214883490198,53.8060233744357 ..))
            </pre><p>ポイントで切られるマルチラインストリング</p><div class="informaltable"><table border="1"><colgroup><col><col></colgroup><tbody><tr><td>
                                               <p>
                            </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_split03.png"><div class="caption"><p>分割前</p></div></div></div><p>
                                               </p>
                        </td><td>
                                               <p>
                            </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_split04.png"><div class="caption"><p>分割後</p></div></div></div><p>
                                               </p>
                        </td></tr></tbody></table></div><pre class="programlisting">
SELECT ST_AsText(ST_Split(mline, pt)) As wktcut
        FROM (SELECT 
    ST_GeomFromText('MULTILINESTRING((10 10, 190 190), (15 15, 30 30, 100 90))') As mline,
    ST_Point(30,30) As pt) As foo;
    
wktcut
------
GEOMETRYCOLLECTION(
    LINESTRING(10 10,30 30),
    LINESTRING(30 30,190 190),
    LINESTRING(15 15,30 30),
    LINESTRING(30 30,100 90)
)
            </pre></div><div class="refsection" title="関連情報"><a name="id287070124"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a>, <a class="xref" href="#ST_BuildArea" title="ST_BuildArea">ST_BuildArea</a>, <a class="xref" href="#ST_Dump" title="ST_Dump">ST_Dump</a>, <a class="xref" href="#ST_GeometryN" title="ST_GeometryN">ST_GeometryN</a>, <a class="xref" href="#ST_Union" title="ST_Union">ST_Union</a></p></div></div><div class="refentry" title="ST_SymDifference"><div class="refentry.separator"><hr></div><a name="ST_SymDifference"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SymDifference ? AとBの、インタセクトしていない部分を表現するジオメトリを返します。対称と呼ばれるのは、ST_SymDifference(A,B) = ST_SymDifference(B,A) となるからです。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_SymDifference</b>(</code>geometry  <var class="pdparam">geomA</var>, geometry  <var class="pdparam">geomB</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287070196"></a><h2>説明</h2><p>AとBの、インタセクトしていない部分を表現するジオメトリを返します。対称と呼ばれるのは、ST_SymDifference(A,B) = ST_SymDifference(B,A)となるからです。ST_Union(geomA,geomB) - ST_Intersection(A,B)と見ることができます。</p><p>GEOSモジュールで実現しています。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ジオメトリコレクションを引数として呼ばないでください。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です s2.1.1.3</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.21</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。 ただし、差をとってZインデクスを戻す時、X Yのみを考慮に入れているように見えます。</p></div><div class="refsection" title="例"><a name="id287070254"></a><h2>例</h2><div class="informaltable"><table border="1"><colgroup><col><col></colgroup><tbody><tr><td>
						<p>
							</p><div class="informalfigure"><div class="mediaobject"><img src="images/st_symdifference01.png"><div class="caption"><p>元のラインストリングと一緒に表示</p></div></div></div><p>
						</p>
					</td><td>
						<div class="informalfigure"><div class="mediaobject"><img src="images/st_symdifference02.png"><div class="caption"><p>二つのラインストリングの対称差</p></div></div></div><p>
					</p>
				</td></tr></tbody></table></div><pre class="programlisting">
-- 2次元では安全です - 2つのラインストリングの対称差
SELECT ST_AsText(
	ST_SymDifference(
		ST_GeomFromText('LINESTRING(50 100, 50 200)'),
		ST_GeomFromText('LINESTRING(50 50, 50 150)')
	)
);

st_astext
---------
MULTILINESTRING((50 150,50 200),(50 50,50 100))
</pre><pre class="programlisting">

-- 3次元で使用すると、完全には正しいものとはなりません
SELECT ST_AsEWKT(ST_SymDifference(ST_GeomFromEWKT('LINESTRING(1 2 1, 1 4 2)'),
	ST_GeomFromEWKT('LINESTRING(1 1 3, 1 3 4)')))

st_astext
------------
MULTILINESTRING((1 3 2.75,1 4 2),(1 1 3,1 2 2.25))
		</pre></div><div class="refsection" title="関連情報"><a name="id287070334"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Difference" title="ST_Difference">ST_Difference</a>, <a class="xref" href="#ST_Intersection" title="ST_Intersection">ST_Intersection</a>, <a class="xref" href="#ST_Union" title="ST_Union">ST_Union</a></p></div></div><div class="refentry" title="ST_Union"><div class="refentry.separator"><hr></div><a name="ST_Union"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Union ? ジオメトリの結合の点集合を表現するジオメトリを返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Union</b>(</code>geometry set <var class="pdparam">g1field</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_Union</b>(</code>geometry <var class="pdparam">g1</var>, geometry <var class="pdparam">g2</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_Union</b>(</code>geometry[] <var class="pdparam">g1_array</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287070436"></a><h2>説明</h2><p>MULTI系、単一ジオメトリ、ジオメトリコレクションのいずれでも出力されます。2つの形式があります。ひとつめは、2つのジオメトリからインタセクトしている領域の無い新しいジオメトリを返します。ふたつめは、ジオメトリの集合を取り、インタセクトしている領域の無い単一のST_Geometryを返すものです。</p><p>集計関数版: この関数は、ジオメトリの集合から、MULTI系ジオメトリまたは非MULTI系ジオメトリを返します。ST_Union()関数は、PostgreSQL用語で言うところの「集計関数」です。SUM()やMEAN()と同じ方法でデータリストの操作を行うことを意味します。</p><p>非集計関数版: この関数は二つの入力ジオメトリの結合したジオメトリを返します。出力型はMULTI系、非MULTI系またはGEOMETRYCOLLECTIONです。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_CollectとST_Unionはしばしば交換して使うことができます。ST_Unionは境界を更新し、生成されるMULTI系ジオメトリがインタセクトした領域を持たないようにするため、一般的にST_Collectよりも桁違いに遅く動きます。</p></td></tr></table></div><p>GEOSモジュールで実現しています。</p><p>ご注意: この関数は以前は、"Union"から改名してGeomUnion()と呼ばれていました。UNIONはSQLの予約語であるためです。</p><p>初出: 1.4.0 - ST_Unionが強化されました。ST_Union(geomarray)が導入され、また、PostgreSQL内での集計が速くなりました。GEOS 3.1.0以上を使用している場合は、ST_Unionは、<a class="ulink" href="http://blog.cleverelephant.ca/2009/01/must-faster-unions-in-postgis-14.html" target="_top">http://blog.cleverelephant.ca/2009/01/must-faster-unions-in-postgis-14.html</a>に記述がある、Cascaded Unionアルゴリズムを使います。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a>の実装です s2.1.1.3</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>集約関数版は、OGC仕様に明示的に定義されていません。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.19
		the z-index (elevation) when polygons are involved.</p></div><div class="refsection" title="例"><a name="id287070537"></a><h2>例</h2><p>集約関数版の例</p><pre class="programlisting">
SELECT stusps,
	   ST_Multi(ST_Union(f.the_geom)) as singlegeom
	 FROM sometable As f
GROUP BY stusps
			  </pre><p>集約関数版の例</p><pre class="programlisting">
SELECT ST_AsText(ST_Union(ST_GeomFromText('POINT(1 2)'),
	ST_GeomFromText('POINT(-2 3)') ) )

st_astext
----------
MULTIPOINT(-2 3,1 2)


SELECT ST_AsText(ST_Union(ST_GeomFromText('POINT(1 2)'),
		ST_GeomFromText('POINT(1 2)') ) );
st_astext
----------
POINT(1 2)

-- 3次元の例 - 3次元かつ次元混合になっています
SELECT ST_AsEWKT(st_union(the_geom))
FROM
(SELECT ST_GeomFromEWKT('POLYGON((-7 4.2,-7.1 4.2,-7.1 4.3,
-7 4.2))') as the_geom
UNION ALL
SELECT ST_GeomFromEWKT('POINT(5 5 5)') as the_geom
UNION ALL
	SELECT ST_GeomFromEWKT('POINT(-2 3 1)') as the_geom
UNION ALL
SELECT ST_GeomFromEWKT('LINESTRING(5 5 5, 10 10 10)') as the_geom ) as foo;

st_asewkt
---------
GEOMETRYCOLLECTION(POINT(-2 3 1),LINESTRING(5 5 5,10 10 10),POLYGON((-7 4.2 5,-7.1 4.2 5,-7.1 4.3 5,-7 4.2 5)));

-- 次元混合の無い3次元の例
SELECT ST_AsEWKT(st_union(the_geom))
FROM
(SELECT ST_GeomFromEWKT('POLYGON((-7 4.2 2,-7.1 4.2 3,-7.1 4.3 2,
-7 4.2 2))') as the_geom
UNION ALL
SELECT ST_GeomFromEWKT('POINT(5 5 5)') as the_geom
UNION ALL
	SELECT ST_GeomFromEWKT('POINT(-2 3 1)') as the_geom
UNION ALL
SELECT ST_GeomFromEWKT('LINESTRING(5 5 5, 10 10 10)') as the_geom ) as foo;

st_asewkt
---------
GEOMETRYCOLLECTION(POINT(-2 3 1),LINESTRING(5 5 5,10 10 10),POLYGON((-7 4.2 2,-7.1 4.2 3,-7.1 4.3 2,-7 4.2 2)))

-- 配列生成を使った例
SELECT ST_Union(ARRAY(SELECT the_geom FROM sometable));

SELECT ST_AsText(ST_Union(ARRAY[ST_GeomFromText('LINESTRING(1 2, 3 4)'),
			ST_GeomFromText('LINESTRING(3 4, 4 5)')])) As wktunion;

--wktunion---
MULTILINESTRING((3 4,4 5),(1 2,3 4))

			  </pre></div><div class="refsection" title="関連情報"><a name="id287070560"></a><h2>関連情報</h2><p>
			<a class="xref" href="#ST_Collect" title="ST_Collect">ST_Collect</a>
			<a class="xref" href="#ST_UnaryUnion" title="ST_UnaryUnion">ST_UnaryUnion</a>
		</p></div></div><div class="refentry" title="ST_UnaryUnion"><div class="refentry.separator"><hr></div><a name="ST_UnaryUnion"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_UnaryUnion ? ST_Unionに似ていますが、ジオメトリ要素レベルで動作します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_UnaryUnion</b>(</code>geometry  <var class="pdparam">geom</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287070614"></a><h2>説明</h2><p>ST_UnaryUnionは、ST_Unionと違い、マルチポリゴンの要素間の境界更新を行い、ジオメトリコレクションの要素間の結合を行います。入力ジオメトリの要素は、それぞれ妥当であると仮定しているので、蝶ネクタイポリゴン(不正なポリゴンです)から妥当なマルチポリゴンを得ることはできません。</p><p>この関数をラインストリングの集合にノードを作成するのに使えます。ST_UnaryUnionとST_Collectを混ぜて、ST_UnionとST_MemUnionの釣り合いを見つけて、メモリサイズとCPU時間の両方について適切になるように、一度に結合したいジオメトリ数を微調整することができます。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p>初出: 2.0.0 - GEOS 3.3.0以上が必要です。</p></div><div class="refsection" title="関連情報"><a name="id287070645"></a><h2>関連情報</h2><p>
			<a class="xref" href="#ST_Union" title="ST_Union">ST_Union</a>
			<a class="xref" href="#ST_MemUnion" title="ST_MemUnion">ST_MemUnion</a>
			<a class="xref" href="#ST_Collect" title="ST_Collect">ST_Collect</a>
		</p></div></div></div><div class="sect1" title="8.10. 線型参照"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Linear_Referencing"></a>8.10. 線型参照</h2></div></div></div><div class="toc"><dl><dt><span class="refentrytitle"><a href="#ST_Line_Interpolate_Point">ST_Line_Interpolate_Point</a></span><span class="refpurpose"> ? 線に沿った内挿点を返します。第2引数はfloat8で0から1の区間で、そのポイントが位置するラインストリングの総延長についての割合です。</span></dt><dt><span class="refentrytitle"><a href="#ST_Line_Locate_Point">ST_Line_Locate_Point</a></span><span class="refpurpose"> ? ラインストリング上の、与えたポイントへの最短点を、2次元長に対する割合として0から1の区間で返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Line_Substring">ST_Line_Substring</a></span><span class="refpurpose"> ? 2次元長に対する割合で示された開始位置と終了位置で切り取られた部分ラインストリングを返します。第2引数と第3引数は、float8で0から1の区間です。</span></dt><dt><span class="refentrytitle"><a href="#ST_LocateAlong">ST_LocateAlong</a></span><span class="refpurpose"> ? 指定したM値に一致する要素からなる、派生ジオメトリコレクション値を返します。ポリゴン要素には対応していません。</span></dt><dt><span class="refentrytitle"><a href="#ST_LocateBetween">ST_LocateBetween</a></span><span class="refpurpose"> ? 指定したM値の範囲内にある要素からなる、派生ジオメトリコレクション値を返します。ポリゴン要素には対応していません。</span></dt><dt><span class="refentrytitle"><a href="#ST_LocateBetweenElevations">ST_LocateBetweenElevations</a></span><span class="refpurpose"> ? 指定したZ値の範囲内にある要素からなる、派生ジオメトリ(コレクション)値を返します。3次元、4次元のLINESTRINGSとMULTILINESTRINGSのみをサポートします。</span></dt><dt><span class="refentrytitle"><a href="#ST_InterpolatePoint">ST_InterpolatePoint</a></span><span class="refpurpose"> ? ジオメトリの、指定したポイントに近いポイントにおけるM値を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_AddMeasure">ST_AddMeasure</a></span><span class="refpurpose"> ? 開始点と終了点の間の線型的にM値を内挿した派生ジオメトリを返します。ジオメトリがM軸を持たない場合は追加されます。ジオメトリがM軸を持つ場合は新しい値に上書きされます。LINESTRINGSとMULTILINESTRINGSのみサポートされます。</span></dt></dl></div><div class="refentry" title="ST_Line_Interpolate_Point"><a name="ST_Line_Interpolate_Point"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Line_Interpolate_Point ? 線に沿った内挿点を返します。第2引数はfloat8で0から1の区間で、そのポイントが位置するラインストリングの総延長についての割合です。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Line_Interpolate_Point</b>(</code>geometry  <var class="pdparam">a_linestring</var>, float  <var class="pdparam">a_fraction</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287076827"></a><h2>説明</h2><p>線に沿った内挿点を返します。第1引数は LINESTRINGでなければなりません。第2引数はfloat8で0から1の区間で、そのポイントが位置するラインストリングの総延長に対する割合です。</p><p>ポイントに最も近いライン位置の計算については<a class="xref" href="#ST_Line_Locate_Point" title="ST_Line_Locate_Point">ST_Line_Locate_Point</a>を参照して下さい。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>1.1.1から、この関数はM軸やZ軸の内挿点も(存在するなら)計算するようになりました。それより前の版では0.0となります。</p></td></tr></table></div><p>初出: 0.8.2, Z軸とM軸のサポートが1.1.1で追加されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p></div><div class="refsection" title="例"><a name="id287076866"></a><h2>例</h2><div class="informalfigure"><div class="mediaobject"><img src="images/st_line_interpolate_point01.png"><div class="caption"><p>ラインストリングの20%(0.20)位置の内挿点</p></div></div></div><pre class="programlisting">-- 2次元ラインに沿った20%ポイント
SELECT ST_AsEWKT(ST_Line_Interpolate_Point(the_line, 0.20))
	FROM (SELECT ST_GeomFromEWKT('LINESTRING(25 50, 100 125, 150 190)') as the_line) As foo;
   st_asewkt
----------------
 POINT(51.5974135047432 76.5974135047432)

</pre><pre class="programlisting">
-- 3次元線の中点
SELECT ST_AsEWKT(ST_Line_Interpolate_Point(the_line, 0.5))
	FROM (SELECT ST_GeomFromEWKT('LINESTRING(1 2 3, 4 5 6, 6 7 8)') as the_line) As foo;

	st_asewkt
--------------------
 POINT(3.5 4.5 5.5)

-- ポイントまたは他のジオメトリへの、ライン上の最短点の探索
 SELECT ST_AsText(ST_Line_Interpolate_Point(foo.the_line, ST_Line_Locate_Point(foo.the_line, ST_GeomFromText('POINT(4 3)'))))
FROM (SELECT ST_GeomFromText('LINESTRING(1 2, 4 5, 6 7)') As the_line) As foo;
   st_astext
----------------
 POINT(3 4)

</pre></div><div class="refsection" title="関連情報"><a name="id287076901"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a>, <a class="xref" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a>, <a class="xref" href="#ST_Length" title="ST_Length">ST_Length</a>, <a class="xref" href="#ST_Line_Locate_Point" title="ST_Line_Locate_Point">ST_Line_Locate_Point</a></p></div></div><div class="refentry" title="ST_Line_Locate_Point"><div class="refentry.separator"><hr></div><a name="ST_Line_Locate_Point"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Line_Locate_Point ? ラインストリング上の、与えたポイントへの最短点を、2次元長に対する割合として0から1の区間で返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_Line_Locate_Point</b>(</code>geometry  <var class="pdparam">a_linestring</var>, geometry  <var class="pdparam">a_point</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287076969"></a><h2>説明</h2><p>ラインストリング上の、与えたポイントへの最短点を、<a class="link" href="#ST_Length2D" title="ST_Length2D">2次元ラインストリング</a>の総延長に対する割合として0から1の区間で返します。</p><p>返された位置は、ポイント(<a class="xref" href="#ST_Line_Interpolate_Point" title="ST_Line_Interpolate_Point">ST_Line_Interpolate_Point</a>)または、部分ラインストリング(<a class="xref" href="#ST_Line_Substring" title="ST_Line_Substring">ST_Line_Substring</a>)の抽出に使用することができます。</p><p>この関数は、住所番号に近づくのに使用します(訳注: 道路方式の住居表示の場合)。</p><p>初出: 1.1.0</p></div><div class="refsection" title="例"><a name="id287077035"></a><h2>例</h2><pre class="programlisting">
-- ストリートに沿った、ストリート番号の点の、粗い探索です。
-- なお、foo全体は住居の重心とストリートのように見えるダミーデータです。
-- ST_DWithInで対象とするストリートから大きく外れる住居を除外しています。
SELECT ST_AsText(house_loc) As as_text_house_loc,
	startstreet_num +
		CAST( (endstreet_num - startstreet_num)
			* ST_Line_Locate_Point(street_line, house_loc) As integer) As street_num
FROM
(SELECT ST_GeomFromText('LINESTRING(1 2, 3 4)') As street_line,
	ST_MakePoint(x*1.01,y*1.03) As house_loc, 10 As startstreet_num,
		20 As endstreet_num
FROM generate_series(1,3) x CROSS JOIN generate_series(2,4) As y)
As foo
WHERE ST_DWithin(street_line, house_loc, 0.2);

 as_text_house_loc | street_num
-------------------+------------
 POINT(1.01 2.06)  |         10
 POINT(2.02 3.09)  |         15
 POINT(3.03 4.12)  |         20

 -- ポイントまたは他のジオメトリへのライン上の最短点の探索
 SELECT ST_AsText(ST_Line_Interpolate_Point(foo.the_line, ST_Line_Locate_Point(foo.the_line, ST_GeomFromText('POINT(4 3)'))))
FROM (SELECT ST_GeomFromText('LINESTRING(1 2, 4 5, 6 7)') As the_line) As foo;
   st_astext
----------------
 POINT(3 4)

</pre></div><div class="refsection" title="関連情報"><a name="id287077048"></a><h2>関連情報</h2><p><a class="xref" href="#ST_DWithin" title="ST_DWithin">ST_DWithin</a>, <a class="xref" href="#ST_Length2D" title="ST_Length2D">ST_Length2D</a>, <a class="xref" href="#ST_Line_Interpolate_Point" title="ST_Line_Interpolate_Point">ST_Line_Interpolate_Point</a>, <a class="xref" href="#ST_Line_Substring" title="ST_Line_Substring">ST_Line_Substring</a></p></div></div><div class="refentry" title="ST_Line_Substring"><div class="refentry.separator"><hr></div><a name="ST_Line_Substring"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Line_Substring ? 2次元長に対する割合で示された開始位置と終了位置で切り取られた部分ラインストリングを返します。第2引数と第3引数は、float8で0から1の区間です。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Line_Substring</b>(</code>geometry  <var class="pdparam">a_linestring</var>, float  <var class="pdparam">startfraction</var>, float  <var class="pdparam">endfraction</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287077125"></a><h2>説明</h2><p>2次元長に対する割合で示された開始位置と終了位置で切り取られた部分ラインストリングを返します。第2引数と第3引数は、float8で0から1の区間です。この関数はLINESTRINGでのみ動作します。MULTILINESTRINGで使用するには、<a class="xref" href="#ST_LineMerge" title="ST_LineMerge">ST_LineMerge</a>と併用します。</p><p>'start'と'end'が同じ値を持つ場合は、<a class="xref" href="#ST_Line_Interpolate_Point" title="ST_Line_Interpolate_Point">ST_Line_Interpolate_Point</a>と等価になります。</p><p>ポイントに最も近いライン位置の計算については<a class="xref" href="#ST_Line_Locate_Point" title="ST_Line_Locate_Point">ST_Line_Locate_Point</a>を参照して下さい。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>1.1.1から、この関数はM軸やZ軸の内挿点も(存在するなら)計算するようになりました。それより前の版では不定値となります。</p></td></tr></table></div><p>初出: 1.1.0, Z軸とM軸のサポートが1.1.1で追加されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p></div><div class="refsection" title="例"><a name="id287077207"></a><h2>例</h2><div class="informalfigure"><div class="mediaobject"><img src="images/st_line_substring01.png"><div class="caption"><p>1/3の真ん中(0.333, 0.666)のラインストリング</p></div></div></div><pre class="programlisting">
-- ラインストリングの概ね1/3の真ん中の線を返します
SELECT ST_AsText(ST_Line_SubString(ST_GeomFromText('LINESTRING(25 50, 100 125, 150 190)'), 0.333, 0.666));

										   st_astext
------------------------------------------------------------------------------------------------
LINESTRING(69.2846934853974 94.2846934853974,100 125,111.700356260683 140.210463138888)

--次に示す例では、PostgreSQLのgenerate_series()を
--使ったwhileループに似たことを行って、
--テーブル内の全てのラインストリングを100単位の
--区分にカットしています。
--単位はSRIDで決まります。
--全てのジオメトリがラインストリングまたは
--隣接するマルチラインストリングで、
--100単位*10000より長いジオメトリが無いと仮定します。
--パフォーマンスを良くするために、10000を減らして、
--期待する最大区分数にあわせることができます。

SELECT field1, field2, ST_Line_Substring(the_geom, 100.00*n/length,
  CASE
	WHEN 100.00*(n+1) &lt; length THEN 100.00*(n+1)/length
	ELSE 1
  END) As the_geom
FROM
  (SELECT sometable.field1, sometable.field2,
  ST_LineMerge(sometable.the_geom) AS the_geom,
  ST_Length(sometable.the_geom) As length
  FROM sometable
  ) AS t
CROSS JOIN generate_series(0,10000) AS n
WHERE n*100.00/length &lt; 1;
			</pre></div><div class="refsection" title="関連情報"><a name="id287077239"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Length" title="ST_Length">ST_Length</a>, <a class="xref" href="#ST_Line_Interpolate_Point" title="ST_Line_Interpolate_Point">ST_Line_Interpolate_Point</a>, <a class="xref" href="#ST_LineMerge" title="ST_LineMerge">ST_LineMerge</a></p></div></div><div class="refentry" title="ST_LocateAlong"><div class="refentry.separator"><hr></div><a name="ST_LocateAlong"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_LocateAlong ? 指定したM値に一致する要素からなる、派生ジオメトリコレクション値を返します。ポリゴン要素には対応していません。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_LocateAlong</b>(</code>geometry  <var class="pdparam">ageom_with_measure</var>, float  <var class="pdparam">a_measure</var>, float  <var class="pdparam">offset</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287077314"></a><h2>説明</h2><p>指定したM値に一致する要素からなる、派生ジオメトリコレクション値を返します。ポリゴン要素には対応していません。</p><p>offsetを与えた場合には、結果は
入力ラインの右または左に、指定した数字分ずれます。正のオフセットでは左に、負のオフセットでは右にずれます。</p><p>意味は ISO/IEC CD 13249-3:200x(E) - Text for Continuation CD Editing Meeting で決められています。</p><p>初出: 1.1.0 ST_Locale_Along_Measureでした。</p><p>変更: 2.0.0 - 以前の版ではST_Locate_Along_Measureと呼ばれていましたが、古い名前は非推奨となり、将来的には削除しますが現時点では有効です。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>の関数は、M要素を持つジオメトリでのみ使います。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数はM軸に対応しています。</p></div><div class="refsection" title="例"><a name="id287077353"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(the_geom)
		FROM
		(SELECT ST_LocateAlong(
			ST_GeomFromText('MULTILINESTRINGM((1 2 3, 3 4 2, 9 4 3),
		(1 2 3, 5 4 5))'),3) As the_geom) As foo;

						 st_asewkt
-----------------------------------------------------------
 MULTIPOINT M (1 2 3)

-- ジオメトリコレクションは難しいものですので、
-- 簡略化するためにダンプしています。
SELECT ST_AsText((ST_Dump(the_geom)).geom)
	FROM
	(SELECT ST_LocateAlong(
			ST_GeomFromText('MULTILINESTRINGM((1 2 3, 3 4 2, 9 4 3),
	(1 2 3, 5 4 5))'),3) As the_geom) As foo;

   st_asewkt
---------------
 POINTM(1 2 3)
 POINTM(9 4 3)
 POINTM(1 2 3)
	</pre></div><div class="refsection" title="関連情報"><a name="id287077366"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Dump" title="ST_Dump">ST_Dump</a>, <a class="xref" href="#ST_LocateBetween" title="ST_LocateBetween">ST_LocateBetween</a></p></div></div><div class="refentry" title="ST_LocateBetween"><div class="refentry.separator"><hr></div><a name="ST_LocateBetween"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_LocateBetween ? 指定したM値の範囲内にある要素からなる、派生ジオメトリコレクション値を返します。ポリゴン要素には対応していません。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_LocateBetween</b>(</code>geometry  <var class="pdparam">geomA</var>, float  <var class="pdparam">measure_start</var>, float  <var class="pdparam">measure_end</var>, float  <var class="pdparam">offset</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287077480"></a><h2>説明</h2><p>指定したM値の範囲内にある要素からなる、派生ジオメトリコレクション値を返します。ポリゴン要素には対応していません。</p><p>意味は ISO/IEC CD 13249-3:200x(E) - Text for Continuation CD Editing Meeting で決められています。 </p><p>初出: 1.1.0 ST_Locate_Between_Measuresでした。</p><p>変更: 2.0.0 - 以前の版でST_Locate_Between_Measuresと呼ばれていましたが、古い名前は非推奨となり、将来的には削除しますが現時点では後方互換のため有効になっています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数はM軸に対応しています。</p></div><div class="refsection" title="例"><a name="id287077511"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(the_geom)
		FROM
		(SELECT ST_LocateBetween(
			ST_GeomFromText('MULTILINESTRING M ((1 2 3, 3 4 2, 9 4 3),
		(1 2 3, 5 4 5))'),1.5, 3) As the_geom) As foo;

							 st_asewkt
------------------------------------------------------------------------
 GEOMETRYCOLLECTION M (LINESTRING M (1 2 3,3 4 2,9 4 3),POINT M (1 2 3))

-- ジオメトリコレクションは難しいものですので、
-- 簡略化するためにダンプしています。
SELECT ST_AsText((ST_Dump(the_geom)).geom)
		FROM
		(SELECT ST_LocateBetween(
			ST_GeomFromText('MULTILINESTRING M ((1 2 3, 3 4 2, 9 4 3),
		(1 2 3, 5 4 5))'),1.5, 3) As the_geom) As foo;

		   st_asewkt
--------------------------------
 LINESTRING M (1 2 3,3 4 2,9 4 3)
 POINT M (1 2 3)</pre></div><div class="refsection" title="関連情報"><a name="id287077525"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Dump" title="ST_Dump">ST_Dump</a>, <a class="xref" href="#ST_LocateAlong" title="ST_LocateAlong">ST_LocateAlong</a></p></div></div><div class="refentry" title="ST_LocateBetweenElevations"><div class="refentry.separator"><hr></div><a name="ST_LocateBetweenElevations"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_LocateBetweenElevations ? 指定したZ値の範囲内にある要素からなる、派生ジオメトリ(コレクション)値を返します。3次元、4次元のLINESTRINGSとMULTILINESTRINGSのみをサポートします。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_LocateBetweenElevations</b>(</code>geometry  <var class="pdparam">geom_mline</var>, float  <var class="pdparam">elevation_start</var>, float  <var class="pdparam">elevation_end</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287077595"></a><h2>説明</h2><p>指定したZ値の範囲内にある要素からなる、派生ジオメトリ(コレクション)値を返します。3次元、4次元のLINESTRINGSとMULTILINESTRINGSのみをサポートします。</p><p>初出: 1.4.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p></div><div class="refsection" title="例"><a name="id287077620"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsEWKT(ST_LocateBetweenElevations(
			ST_GeomFromEWKT('LINESTRING(1 2 3, 4 5 6)'),2,4)) As ewelev;
								   ewelev
----------------------------------------------------------------
	MULTILINESTRING((1 2 3,2 3 4))

SELECT ST_AsEWKT(ST_LocateBetweenElevations(
			ST_GeomFromEWKT('LINESTRING(1 2 6, 4 5 -1, 7 8 9)'),6,9)) As ewelev;

				ewelev
----------------------------------------------------------------
GEOMETRYCOLLECTION(POINT(1 2 6),LINESTRING(6.1 7.1 6,7 8 9))

-- ジオメトリコレクションは難しいものですので、
-- 簡略化するためにダンプしています。
SELECT ST_AsEWKT((ST_Dump(the_geom)).geom)
		FROM
		(SELECT ST_LocateBetweenElevations(
			ST_GeomFromEWKT('LINESTRING(1 2 6, 4 5 -1, 7 8 9)'),6,9) As the_geom) As foo;

		   st_asewkt
--------------------------------
POINT(1 2 6)
LINESTRING(6.1 7.1 6,7 8 9)
</pre></div><div class="refsection" title="関連情報"><a name="id287077633"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Dump" title="ST_Dump">ST_Dump</a></p></div></div><div class="refentry" title="ST_InterpolatePoint"><div class="refentry.separator"><hr></div><a name="ST_InterpolatePoint"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_InterpolatePoint ? ジオメトリの、指定したポイントに近いポイントにおけるM値を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_InterpolatePoint</b>(</code>geometry  <var class="pdparam">line</var>, geometry  <var class="pdparam">point</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287077691"></a><h2>説明</h2><p>ジオメトリの、指定したポイントに近いポイントにおけるM値を返します。</p><p>初出: 2.0.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p></div><div class="refsection" title="例"><a name="id287077716"></a><h2>例</h2><pre class="programlisting">SELECT ST_InterpolatePoint('LINESTRING M (0 0 0, 10 0 20)', 'POINT(5 5)');
 st_interpolatepoint 
 ---------------------
			            10
	</pre></div><div class="refsection" title="関連情報"><a name="id287077762"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AddMeasure" title="ST_AddMeasure">ST_AddMeasure</a>, <a class="xref" href="#ST_LocateAlong" title="ST_LocateAlong">ST_LocateAlong</a>, <a class="xref" href="#ST_LocateBetween" title="ST_LocateBetween">ST_LocateBetween</a></p></div></div><div class="refentry" title="ST_AddMeasure"><div class="refentry.separator"><hr></div><a name="ST_AddMeasure"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AddMeasure ? 開始点と終了点の間の線型的にM値を内挿した派生ジオメトリを返します。ジオメトリがM軸を持たない場合は追加されます。ジオメトリがM軸を持つ場合は新しい値に上書きされます。LINESTRINGSとMULTILINESTRINGSのみサポートされます。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_AddMeasure</b>(</code>geometry  <var class="pdparam">geom_mline</var>, float  <var class="pdparam">measure_start</var>, float  <var class="pdparam">measure_end</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287077835"></a><h2>説明</h2><p>開始点と終了点の間の線型的にM値を内挿した派生ジオメトリを返します。ジオメトリがM軸を持たない場合は追加されます。ジオメトリがM軸を持つ場合は新しい値に上書きされます。LINESTRINGSとMULTILINESTRINGSのみサポートされます。</p><p>初出: 1.5.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p></div><div class="refsection" title="例"><a name="id287077860"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(ST_AddMeasure(
ST_GeomFromEWKT('LINESTRING(1 0, 2 0, 4 0)'),1,4)) As ewelev;
           ewelev             
--------------------------------
 LINESTRINGM(1 0 1,2 0 2,4 0 4)

SELECT ST_AsText(ST_AddMeasure(
ST_GeomFromEWKT('LINESTRING(1 0 4, 2 0 4, 4 0 4)'),10,40)) As ewelev;
                 ewelev                 
----------------------------------------
 LINESTRING(1 0 4 10,2 0 4 20,4 0 4 40)

SELECT ST_AsText(ST_AddMeasure(
ST_GeomFromEWKT('LINESTRINGM(1 0 4, 2 0 4, 4 0 4)'),10,40)) As ewelev;
                 ewelev                 
----------------------------------------
 LINESTRINGM(1 0 10,2 0 20,4 0 40)
 
SELECT ST_AsText(ST_AddMeasure(
ST_GeomFromEWKT('MULTILINESTRINGM((1 0 4, 2 0 4, 4 0 4),(1 0 4, 2 0 4, 4 0 4))'),10,70)) As ewelev;
                             ewelev                              
-----------------------------------------------------------------
 MULTILINESTRINGM((1 0 10,2 0 20,4 0 40),(1 0 40,2 0 50,4 0 70))
</pre></div></div></div><div class="sect1" title="8.11. ロングトランザクション サポート"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Long_Transactions_Support"></a>8.11. ロングトランザクション サポート</h2></div></div></div><div class="toc"><dl><dt><span class="refentrytitle"><a href="#AddAuth">AddAuth</a></span><span class="refpurpose"> ? 現在のトランザクションで使われる認証トークンを追加します。</span></dt><dt><span class="refentrytitle"><a href="#CheckAuth">CheckAuth</a></span><span class="refpurpose"> ? 認証トークンに基づいて行の更新と削除を拒否/許可するテーブルのトリガを生成します。</span></dt><dt><span class="refentrytitle"><a href="#DisableLongTransactions">DisableLongTransactions</a></span><span class="refpurpose"> ? ロングトランザクションサポートを無効にします。この関数によって、ロングトランザクションサポート用のメタデータテーブルが削除され、ロックチェックテーブルに付けられた全てのトリガが削除されます。</span></dt><dt><span class="refentrytitle"><a href="#EnableLongTransactions">EnableLongTransactions</a></span><span class="refpurpose"> ? ロングトランザクションサポートを有効にします。この関数によって、必要なメタデータテーブルが生成されます。このセクションにある他の関数を呼ぶ前に、一度呼ぶ必要があります。二度呼んでも構いません。</span></dt><dt><span class="refentrytitle"><a href="#LockRow">LockRow</a></span><span class="refpurpose"> ? テーブルの指定した行についてロック/認証を設定します。</span></dt><dt><span class="refentrytitle"><a href="#UnlockRows">UnlockRows</a></span><span class="refpurpose"> ? 指定した認証IDが保持するロックを全て削除します。解放されたロックの数が返されます。</span></dt></dl></div><p>このモジュールとPL/pgSQL関数は、<a class="ulink" href="http://www.opengeospatial.org/standards/wfs" target="_top">Web Feature Service</a>仕様で求められているロングロックをサポートします。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><a class="ulink" href="http://www.postgresql.org/docs/current/static/transaction-iso.html" target="_top">serializable transaction level</a>を使わなければなりません。さもなくばロック機構が壊れます。</p></td></tr></table></div><div class="refentry" title="AddAuth"><a name="AddAuth"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>AddAuth ? 現在のトランザクションで使われる認証トークンを追加します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">AddAuth</b>(</code>text  <var class="pdparam">auth_token</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287075552"></a><h2>説明</h2><p>現在のトランザクションで使われる認証トークンを追加します。</p><p>temp_lock_have_tableという一時テーブルに現在のトランザクション識別子と認証トークンキーを作成、追加します。</p><p>初出: 1.1.3</p></div><div class="refsection" title="例"><a name="id287075569"></a><h2>例</h2><pre class="programlisting">
		SELECT LockRow('towns', '353', 'priscilla');
		BEGIN TRANSACTION;
			SELECT AddAuth('joey');
			UPDATE towns SET the_geom = ST_Translate(the_geom,2,2) WHERE gid = 353;
		COMMIT;


		---Error--
		ERROR:  UPDATE where "gid" = '353' requires authorization 'priscilla'
		</pre></div><div class="refsection" title="関連情報"><a name="id287075581"></a><h2>関連情報</h2><p><a class="xref" href="#LockRow" title="LockRow">LockRow</a></p></div></div><div class="refentry" title="CheckAuth"><div class="refentry.separator"><hr></div><a name="CheckAuth"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>CheckAuth ? 認証トークンに基づいて行の更新と削除を拒否/許可するテーブルのトリガを生成します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">CheckAuth</b>(</code>text  <var class="pdparam">a_schema_name</var>, text  <var class="pdparam">a_table_name</var>, text  <var class="pdparam">a_key_column_name</var><code>)</code>;</p><p><code class="funcdef">integer <b class="fsfunc">CheckAuth</b>(</code>text  <var class="pdparam">a_table_name</var>, text  <var class="pdparam">a_key_column_name</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287075676"></a><h2>説明</h2><p>認証トークンに基づいて行の更新と削除を拒否/許可するテーブルのトリガを生成します。&lt;rowid_col&gt;カラムを使用する行を判別します。</p><p>a_schema_nameが渡されない場合には、現在のスキーマのテーブルを探索します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>このテーブルに認証トリガが既に存在している場合には、エラーになります。</p><p>トランザクションサポートが無い場合は、例外が投げられます。</p></td></tr></table></div><p>初出: 1.1.3</p></div><div class="refsection" title="例"><a name="id287075701"></a><h2>例</h2><pre class="programlisting">
			SELECT CheckAuth('public', 'towns', 'gid');
			result
			------
			0
			</pre></div><div class="refsection" title="関連情報"><a name="id287075749"></a><h2>関連情報</h2><p><a class="xref" href="#EnableLongTransactions" title="EnableLongTransactions">EnableLongTransactions</a></p></div></div><div class="refentry" title="DisableLongTransactions"><div class="refentry.separator"><hr></div><a name="DisableLongTransactions"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>DisableLongTransactions ? ロングトランザクションサポートを無効にします。この関数によって、ロングトランザクションサポート用のメタデータテーブルが削除され、ロックチェックテーブルに付けられた全てのトリガが削除されます。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">DisableLongTransactions</b>(</code><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287075792"></a><h2>説明</h2><p>ロングトランザクションサポートを無効にします。この関数によって、ロングトランザクションサポート用のメタデータテーブルが削除され、ロックチェックテーブルに付けられた全てのトリガが削除されます。</p><p><code class="varname">authorization_table</code>メタデータテーブル、<code class="varname">authorized_tables</code>ビュー、<code class="varname">checkauthtrigger</code>トリガの全てが削除されます。</p><p>初出: 1.1.3</p></div><div class="refsection" title="例"><a name="id287075817"></a><h2>例</h2><pre class="programlisting">SELECT DisableLongTransactions();
-- 結果 --
Long transactions support disabled
		  </pre></div><div class="refsection" title="関連情報"><a name="id287075830"></a><h2>関連情報</h2><p><a class="xref" href="#EnableLongTransactions" title="EnableLongTransactions">EnableLongTransactions</a></p></div></div><div class="refentry" title="EnableLongTransactions"><div class="refentry.separator"><hr></div><a name="EnableLongTransactions"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>EnableLongTransactions ? ロングトランザクションサポートを有効にします。この関数によって、必要なメタデータテーブルが生成されます。このセクションにある他の関数を呼ぶ前に、一度呼ぶ必要があります。二度呼んでも構いません。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">EnableLongTransactions</b>(</code><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287075873"></a><h2>説明</h2><p>ロングトランザクションサポートを有効にします。この関数によって、必要なメタデータテーブルが生成されます。このセクションにある他の関数を呼ぶ前に、一度呼ぶ必要があります。二度呼んでも構いません</p><p><code class="varname">authorization_table</code>メタデータテーブルと<code class="varname">authorized_tables</code>ビューが生成されます。</p><p>初出: 1.1.3</p></div><div class="refsection" title="例"><a name="id287075895"></a><h2>例</h2><pre class="programlisting">SELECT EnableLongTransactions();
-- 結果 --
Long transactions support enabled
		  </pre></div><div class="refsection" title="関連情報"><a name="id287075908"></a><h2>関連情報</h2><p><a class="xref" href="#DisableLongTransactions" title="DisableLongTransactions">DisableLongTransactions</a></p></div></div><div class="refentry" title="LockRow"><div class="refentry.separator"><hr></div><a name="LockRow"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>LockRow ? テーブルの指定した行についてロック/認証を設定します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">LockRow</b>(</code>text  <var class="pdparam">a_schema_name</var>, text  <var class="pdparam">a_table_name</var>, text  <var class="pdparam">a_row_key</var>, text <var class="pdparam">an_auth_token</var>, timestamp <var class="pdparam">expire_dt</var><code>)</code>;</p><p><code class="funcdef">integer <b class="fsfunc">LockRow</b>(</code>text  <var class="pdparam">a_table_name</var>, text  <var class="pdparam">a_row_key</var>, text <var class="pdparam">an_auth_token</var>, timestamp <var class="pdparam">expire_dt</var><code>)</code>;</p><p><code class="funcdef">integer <b class="fsfunc">LockRow</b>(</code>text  <var class="pdparam">a_table_name</var>, text  <var class="pdparam">a_row_key</var>, text <var class="pdparam">an_auth_token</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287076072"></a><h2>説明</h2><p>テーブルの指定した行についてロック/認証を設定します。&lt;authid&gt;は文字列値です。&lt;expires&gt;はタイムスタンプ値で、now()+1時間がデフォルトです。ロックされた場合は1を返し、他の場合(既に他の認証によってロックされている場合)には、0を返します。</p><p>初出: 1.1.3</p></div><div class="refsection" title="例"><a name="id287076086"></a><h2>例</h2><pre class="programlisting">SELECT LockRow('public', 'towns', '2', 'joey');
LockRow
-------
1

-- Joeyは既にレコードをロックしていてPriscillaはラックが無かった
SELECT LockRow('public', 'towns', '2', 'priscilla');
LockRow
-------
0

		</pre></div><div class="refsection" title="関連情報"><a name="id287076099"></a><h2>関連情報</h2><p><a class="xref" href="#UnlockRows" title="UnlockRows">UnlockRows</a></p></div></div><div class="refentry" title="UnlockRows"><div class="refentry.separator"><hr></div><a name="UnlockRows"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>UnlockRows ? 指定した認証IDが保持するロックを全て削除します。解放されたロックの数が返されます。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">UnlockRows</b>(</code>text  <var class="pdparam">auth_token</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287076184"></a><h2>説明</h2><p>指定した認証IDが保持するロックを全て削除します。解放されたロックの数が返されます。</p><p>初出: 1.1.3</p></div><div class="refsection" title="例"><a name="id287076198"></a><h2>例</h2><pre class="programlisting">
		SELECT LockRow('towns', '353', 'priscilla');
		SELECT LockRow('towns', '2', 'priscilla');
		SELECT UnLockRows('priscilla');
		UnLockRows
		------------
		2
		</pre></div><div class="refsection" title="関連情報"><a name="id287076211"></a><h2>関連情報</h2><p><a class="xref" href="#LockRow" title="LockRow">LockRow</a></p></div></div></div><div class="sect1" title="8.12. その他の関数"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Miscellaneous_Functions"></a>8.12. その他の関数</h2></div></div></div><div class="toc"><dl><dt><span class="refentrytitle"><a href="#ST_Accum">ST_Accum</a></span><span class="refpurpose"> ? 集計関数です。ジオメトリの配列を生成します。</span></dt><dt><span class="refentrytitle"><a href="#Box2D">Box2D</a></span><span class="refpurpose"> ? ジオメトリの最大範囲を表すBOX2Dを返します。</span></dt><dt><span class="refentrytitle"><a href="#Box3D">Box3D</a></span><span class="refpurpose"> ? ジオメトリの最大範囲を表すBOX3Dを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Estimated_Extent">ST_Estimated_Extent</a></span><span class="refpurpose"> ? 与えられた空間テーブルの「見積もられた」範囲を返します。ジオメトリカラムの統計情報から見積もります。指定されていない場合は現在のスキーマが使われます。</span></dt><dt><span class="refentrytitle"><a href="#ST_Expand">ST_Expand</a></span><span class="refpurpose"> ? 入力ジオメトリのバウンディングボックスから全ての方向に拡張されたバウンディングボックスを返します。倍精度浮動小数点数を使います。</span></dt><dt><span class="refentrytitle"><a href="#ST_Extent">ST_Extent</a></span><span class="refpurpose"> ? ジオメトリのバウンディングボックスを返す集計関数です。 </span></dt><dt><span class="refentrytitle"><a href="#ST_3DExtent">ST_3DExtent</a></span><span class="refpurpose"> ? ジオメトリのbox3Dバウンディングボックスを返す集計関数です。</span></dt><dt><span class="refentrytitle"><a href="#Find_SRID">Find_SRID</a></span><span class="refpurpose"> ? find_srid(&lt;db/schema&gt;, &lt;table&gt;, &lt;column&gt;)という書式で、指定したカラムについてGEOMETRY_COLUMNSテーブルを探索して、SRID整数値を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Mem_Size">ST_Mem_Size</a></span><span class="refpurpose"> ? ジオメトリが取る容量(バイト単位)を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Point_Inside_Circle">ST_Point_Inside_Circle</a></span><span class="refpurpose"> ? ポイントジオメトリがcenter_x, center_y , radiusで定義される円内にあるかどうかを見ます。</span></dt></dl></div><div class="refentry" title="ST_Accum"><a name="ST_Accum"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Accum ? 集計関数です。ジオメトリの配列を生成します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry[] <b class="fsfunc">ST_Accum</b>(</code>geometry set <var class="pdparam">geomfield</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287080553"></a><h2>説明</h2><p>集計関数です。ジオメトリの配列を生成します。</p><p>機能強化: 2.0.0では、多面体サーフェス、三角形、TINが導入されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は多面体サーフェスに対応しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は三角形と不規則三角網(TIN)に対応しています。</p></div><div class="refsection" title="例"><a name="id287080611"></a><h2>例</h2><pre class="programlisting">SELECT (ST_Accum(the_geom)) As all_em, ST_AsText((ST_Accum(the_geom))[1]) As grabone,
(ST_Accum(the_geom))[2:4] as grab_rest
			FROM (SELECT ST_MakePoint(a*CAST(random()*10 As integer), a*CAST(random()*10 As integer), a*CAST(random()*10 As integer)) As the_geom
				FROM generate_series(1,4) a) As foo;

all_em|grabone   | grab_rest

-------------------------------------------------------------------------------+

 {0101000080000000000000144000000000000024400000000000001040:
 0101000080000000000
00018400000000000002C400000000000003040:
0101000080000000000000354000000000000038400000000000001840:
010100008000000000000040400000000000003C400000000000003040} |
 POINT(5 10) | {010100008000000000000018400000000000002C400000000000003040:
 0101000080000000000000354000000000000038400000000000001840:
 010100008000000000000040400000000000003C400000000000003040}
(1 row)
		</pre></div><div class="refsection" title="関連情報"><a name="id287080625"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Collect" title="ST_Collect">ST_Collect</a></p></div></div><div class="refentry" title="Box2D"><div class="refentry.separator"><hr></div><a name="Box2D"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Box2D ? ジオメトリの最大範囲を表すBOX2Dを返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">box2d <b class="fsfunc">Box2D</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287080674"></a><h2>説明</h2><p>ジオメトリの最大範囲を表すBOX2Dを返します。</p><p>機能強化: 2.0.0では、多面体サーフェス、三角形、TINが導入されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は多面体サーフェスに対応しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は三角形と不規則三角網(TIN)に対応しています。</p></div><div class="refsection" title="例"><a name="id287080721"></a><h2>例</h2><pre class="programlisting">SELECT Box2D(ST_GeomFromText('LINESTRING(1 2, 3 4, 5 6)'));
	box2d
	---------
	BOX(1 2,5 6)

	SELECT Box2D(ST_GeomFromText('CIRCULARSTRING(220268 150415,220227 150505,220227 150406)'));
	box2d
	--------
	BOX(220186.984375 150406,220288.25 150506.140625)
	</pre></div><div class="refsection" title="関連情報"><a name="id287080733"></a><h2>関連情報</h2><p><a class="xref" href="#Box3D" title="Box3D">Box3D</a>, <a class="xref" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a></p></div></div><div class="refentry" title="Box3D"><div class="refentry.separator"><hr></div><a name="Box3D"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Box3D ? ジオメトリの最大範囲を表すBOX3Dを返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">box3d <b class="fsfunc">Box3D</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287080787"></a><h2>説明</h2><p>ジオメトリの最大範囲を表すBOX3Dを返します。</p><p>機能強化: 2.0.0では、多面体サーフェス、三角形、TINが導入されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は多面体サーフェスに対応しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は三角形と不規則三角網(TIN)に対応しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p></div><div class="refsection" title="例"><a name="id287080845"></a><h2>例</h2><pre class="programlisting">SELECT Box3D(ST_GeomFromEWKT('LINESTRING(1 2 3, 3 4 5, 5 6 5)'));
	Box3d
	---------
	BOX3D(1 2 3,5 6 5)

	SELECT Box3D(ST_GeomFromEWKT('CIRCULARSTRING(220268 150415 1,220227 150505 1,220227 150406 1)'));
	Box3d
	--------
	BOX3D(220227 150406 1,220268 150415 1)
	</pre></div><div class="refsection" title="関連情報"><a name="id287080858"></a><h2>関連情報</h2><p><a class="xref" href="#Box2D" title="Box2D">Box2D</a>, <a class="xref" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a></p></div></div><div class="refentry" title="ST_Estimated_Extent"><div class="refentry.separator"><hr></div><a name="ST_Estimated_Extent"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Estimated_Extent ? 与えられた空間テーブルの「見積もられた」範囲を返します。ジオメトリカラムの統計情報から見積もります。指定されていない場合は現在のスキーマが使われます。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">box2d <b class="fsfunc">ST_Estimated_Extent</b>(</code>text  <var class="pdparam">schema_name</var>, text  <var class="pdparam">table_name</var>, text  <var class="pdparam">geocolumn_name</var><code>)</code>;</p><p><code class="funcdef">box2d <b class="fsfunc">ST_Estimated_Extent</b>(</code>text  <var class="pdparam">table_name</var>, text  <var class="pdparam">geocolumn_name</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287081092"></a><h2>説明</h2><p>与えられた空間テーブルの「見積もられた」範囲を返します。ジオメトリカラムの統計情報から見積もります。指定されていない場合は現在のスキーマが使われます。</p><p>PostgreSQL 8.0.0以上では、統計情報はVACUUM ANALYZEで集められ、結果の範囲は実際の約95%です。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>統計情報が無い(空のテーブルまたはANALYZEを実行していない)場合には、この関数はNULLを返します。1.5.4より前では、代わりに例外が投げられていました。</p></td></tr></table></div><p>PostgreSQL 8.0.0より前では、統計情報はupdate_geometry_stats()で集められ、範囲は確実です。</p><p>初出: 1.0.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p></div><div class="refsection" title="例"><a name="id287081162"></a><h2>例</h2><pre class="programlisting">SELECT ST_Estimated_extent('ny', 'edges', 'the_geom');
-- 結果 --
BOX(-8877653 4912316,-8010225.5 5589284)

SELECT ST_Estimated_Extent('feature_poly', 'the_geom');
-- 結果 --
BOX(-124.659652709961 24.6830825805664,-67.7798080444336 49.0012092590332)
		</pre></div><div class="refsection" title="関連情報"><a name="id287081175"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Extent" title="ST_Extent">ST_Extent</a></p></div></div><div class="refentry" title="ST_Expand"><div class="refentry.separator"><hr></div><a name="ST_Expand"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Expand ? 入力ジオメトリのバウンディングボックスから全ての方向に拡張されたバウンディングボックスを返します。倍精度浮動小数点数を使います。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Expand</b>(</code>geometry  <var class="pdparam">g1</var>, float <var class="pdparam">units_to_expand</var><code>)</code>;</p><p><code class="funcdef">box2d <b class="fsfunc">ST_Expand</b>(</code>box2d  <var class="pdparam">g1</var>, float <var class="pdparam">units_to_expand</var><code>)</code>;</p><p><code class="funcdef">box3d <b class="fsfunc">ST_Expand</b>(</code>box3d  <var class="pdparam">g1</var>, float <var class="pdparam">units_to_expand</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287081288"></a><h2>説明</h2><p>この関数は、入力ジオメトリのバウンディングボックスから全ての方向に拡張されたバウンディングボックスを返します。拡張する量は第2引数で指定します。倍精度浮動小数点数を使います。ST_Distance()クエリやバウンディングボックスクエリでクエリにインデクスフィルタを追加する際によく使われます。</p><p>この関数には3つの形式があります。 ひとつめは、ジオメトリを取り、ポリゴンジオメトリ表現を返すもので、最も一般的な使用形式です。</p><p>ST_ExpandはST_bufferに概念的に似ていますが、バッファはジオメトリを全ての方向に拡張し、ST_Expandはバウンディングボックスをx,y,zの単位の量を拡張します。</p><p>単位はSRIDで示されている空間参照系の単位です。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>
1.3より前は、ST_Expandは、インデクスを利用するクエリを実行するために、distanceと併せて使用されていました。形式は<code class="code">the_geom &amp;&amp; ST_Expand('POINT(10 20)', 10) AND ST_Distance(the_geom, 'POINT(10 20)') &lt; 10</code>となります。1.2以降は、より簡単なST_DWithinと入れ替えられました。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>全てのジオメトリのバウンディングボックスは、2次元ジオメトリであっても、現在は2次元になります。 </p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>初出: 1.5.0でふるまいが変わり、float4座標値から倍精度になりました。</p></td></tr></table></div><p>機能強化: 2.0.0では、多面体サーフェス、三角形、TINが導入されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は多面体サーフェスに対応しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は三角形と不規則三角網(TIN)に対応しています。</p></div><div class="refsection" title="例"><a name="id287081357"></a><h2>例</h2><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>次に示す例では、メートル単位の投影法である米国 National Atlas 正積図法(SRID=2163)を使っています。</p></td></tr></table></div><pre class="programlisting">
		
-- ラインストリングのバウンディングボックスを10メートル拡張
SELECT CAST(ST_Expand(ST_GeomFromText('LINESTRING(2312980 110676,2312923 110701,2312892 110714)', 2163),10) As box2d);
					 st_expand
------------------------------------
 BOX(2312882 110666,2312990 110724)

-- 3次元ボックスを10メートル拡張
SELECT ST_Expand(CAST('BOX3D(778783 2951741 1,794875 2970042.61545891 10)' As box3d),10)
							  st_expand
-----------------------------------------------------
 BOX3D(778773 2951731 -9,794885 2970052.61545891 20)

-- ポイントを10メートル拡張したAsText表現
 SELECT ST_AsEWKT(ST_Expand(ST_GeomFromEWKT('SRID=2163;POINT(2312980 110676)'),10));
											st_asewkt
-------------------------------------------------------------------------------------------------
 SRID=2163;POLYGON((2312970 110666,2312970 110686,2312990 110686,2312990 110666,2312970 110666))

		</pre></div><div class="refsection" title="関連情報"><a name="id287081374"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a>, <a class="xref" href="#ST_Buffer" title="ST_Buffer">ST_Buffer</a>, <a class="xref" href="#ST_DWithin" title="ST_DWithin">ST_DWithin</a>, <a class="xref" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a>, <a class="xref" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a>, <a class="xref" href="#ST_SRID" title="ST_SRID">ST_SRID</a></p></div></div><div class="refentry" title="ST_Extent"><div class="refentry.separator"><hr></div><a name="ST_Extent"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Extent ? ジオメトリのバウンディングボックスを返す集計関数です。 </p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">box2d <b class="fsfunc">ST_Extent</b>(</code>geometry set <var class="pdparam">geomfield</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287081441"></a><h2>説明</h2><p>ST_Extentは、ジオメトリの集合を囲むバウンディングボックスを返します。ST_Extentは、PostgreSQL用語で言うところの「集計関数」です。SUM()やMEAN()と同じ方法でデータリストの操作を行うことを意味します。</p><p>バウンディングボックスを返しますが、空間単位はSRIDで示された空間参照系の単位です。</p><p>ST_ExtntはOracle Spatial/LocatorのSDO_AGGR_MBRと似た発想のものです。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_Extentはバウンディングボックスを返しますが、SRIDメタデータは失います。ST_SetSRIDを使って、SRIDメタデータをジオメトリに強制的に戻します。座標値の単位は元のジオメトリの空間参照系の単位です。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_Extentは(X,Y,Z)を持っていても、X値とY値のボックスを返します。X,Y,Zを維持するにはST_Extent3Dを使います。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>初出: 1.4.0</p></td></tr></table></div><p>機能強化: 2.0.0では、多面体サーフェス、三角形、TINが導入されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は多面体サーフェスに対応しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は三角形と不規則三角網(TIN)に対応しています。</p></div><div class="refsection" title="例"><a name="id287081505"></a><h2>例</h2><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Examples below use Massachusetts State Plane ft (SRID=2249)</p></td></tr></table></div><pre class="programlisting">

SELECT ST_Extent(the_geom) as bextent FROM sometable;
					 st_bextent
------------------------------------
BOX(739651.875 2908247.25,794875.8125 2970042.75)


-- ジオメトリの各カテゴリの範囲を返します
SELECT ST_Extent(the_geom) as bextent
FROM sometable
GROUP BY category ORDER BY category;

					  bextent                       |         name
----------------------------------------------------+----------------
 BOX(778783.5625 2951741.25,794875.8125 2970042.75) | A
 BOX(751315.8125 2919164.75,765202.6875 2935417.25) | B
 BOX(739651.875 2917394.75,756688.375 2935866)      | C

-- ジオメトリに強制的戻し、ジオメトリのEWKT表現を表示します
SELECT ST_SetSRID(ST_Extent(the_geom),2249) as bextent FROM sometable;

				bextent
--------------------------------------------------------------------------------
 SRID=2249;POLYGON((739651.875 2908247.25,739651.875 2970042.75,794875.8125 2970042.75,
 794875.8125 2908247.25,739651.875 2908247.25))
		</pre></div><div class="refsection" title="関連情報"><a name="id287081520"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a>, <a class="xref" href="#ST_3DExtent" title="ST_3DExtent">ST_3DExtent</a>, <a class="xref" href="#ST_SetSRID" title="ST_SetSRID">ST_SetSRID</a>, <a class="xref" href="#ST_SRID" title="ST_SRID">ST_SRID</a></p></div></div><div class="refentry" title="ST_3DExtent"><div class="refentry.separator"><hr></div><a name="ST_3DExtent"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_3DExtent ? ジオメトリのbox3Dバウンディングボックスを返す集計関数です。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">box3d <b class="fsfunc">ST_3DExtent</b>(</code>geometry set <var class="pdparam">geomfield</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287081579"></a><h2>説明</h2><p>ST_3DExtentはジオメトリの集合を囲むbox3d(Z座標を含む)のバウンディングボックスを返します。ST_Extentは、PostgreSQL用語で言うところの「集計関数」です。SUM()やMEAN()と同じ方法でデータリストの操作を行うことを意味します。</p><p>バウンディングボックスを返しますが、空間単位はSRIDで示された空間参照系の単位です。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_3DExtentはバウンディングボックスを返しますが、SRIDメタデータは失います。ST_SetSRIDを使って、SRIDメタデータをジオメトリに強制的に戻します。座標値の単位は元のジオメトリの空間参照系の単位です。</p></td></tr></table></div><p>機能強化: 2.0.0では、多面体サーフェス、三角形、TINが導入されました。</p><p>変更: 2.0.0 In prior versions this used to be called ST_Extent3D</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は多面体サーフェスに対応しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は三角形と不規則三角網(TIN)に対応しています。</p></div><div class="refsection" title="例"><a name="id287081652"></a><h2>例</h2><pre class="programlisting">
SELECT ST_3DExtent(foo.the_geom) As b3extent
FROM (SELECT ST_MakePoint(x,y,z) As the_geom
	FROM generate_series(1,3) As x
		CROSS JOIN generate_series(1,2) As y
		CROSS JOIN generate_series(0,2) As Z) As foo;
	  b3extent
--------------------
 BOX3D(1 1 0,3 2 2)

--Get the extent of various elevated circular strings
SELECT ST_3DExtent(foo.the_geom) As b3extent
FROM (SELECT ST_Translate(ST_Force_3DZ(ST_LineToCurve(ST_Buffer(ST_MakePoint(x,y),1))),0,0,z) As the_geom
	FROM generate_series(1,3) As x
		CROSS JOIN generate_series(1,2) As y
		CROSS JOIN generate_series(0,2) As Z) As foo;

	b3extent
--------------------
 BOX3D(1 0 0,4 2 2)
		</pre></div><div class="refsection" title="関連情報"><a name="id287081662"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Extent" title="ST_Extent">ST_Extent</a>, <a class="xref" href="#ST_Force_3DZ" title="ST_Force_3DZ">ST_Force_3DZ</a></p></div></div><div class="refentry" title="Find_SRID"><div class="refentry.separator"><hr></div><a name="Find_SRID"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Find_SRID ? find_srid(&lt;db/schema&gt;, &lt;table&gt;, &lt;column&gt;)という書式で、指定したカラムについてGEOMETRY_COLUMNSテーブルを探索して、SRID整数値を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">Find_SRID</b>(</code>varchar  <var class="pdparam">a_schema_name</var>, varchar  <var class="pdparam">a_table_name</var>, varchar  <var class="pdparam">a_geomfield_name</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287081767"></a><h2>説明</h2><p>find_srid(&lt;db/schema&gt;, &lt;table&gt;,
			&lt;column&gt;)という書式で、指定したカラムについてGEOMETRY_COLUMNSテーブルを探索して、SRID整数値を返します。ジオメトリカラムがAddGeometryColumns()関数を使って確実に追加されていない場合は、この関数は動作しません。</p><p>訳注: 2.0.0以上で型修飾子を使用してジオメトリカラムを追加した場合には、AddGeometryColumns()を使っていませんが、この関数は正しく動作します。</p></div><div class="refsection" title="例"><a name="id287081781"></a><h2>例</h2><pre class="programlisting"> SELECT Find_SRID('public', 'tiger_us_state_2007', 'the_geom_4269');
find_srid
----------
4269
</pre></div><div class="refsection" title="関連情報"><a name="id287081794"></a><h2>関連情報</h2><p><a class="xref" href="#ST_SRID" title="ST_SRID">ST_SRID</a></p></div></div><div class="refentry" title="ST_Mem_Size"><div class="refentry.separator"><hr></div><a name="ST_Mem_Size"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Mem_Size ? ジオメトリが取る容量(バイト単位)を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_Mem_Size</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287081843"></a><h2>説明</h2><p>ジオメトリが取る容量(バイト単位)を返します。</p><p>これは、pg_size_pretty, pg_relation_size, pg_total_relation_size を持つPostgreSQLへの素晴らしい賛辞です。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>テーブルのバイト単位のサイズを与えるpg_relation_sizeはST_Mem_Sizeより低いバイト数が返ります。これはpg_relation_sizeがTOAST化されたテーブルの寄与を追加せず、TOASTテーブルに格納された大きなジオメトリを加えないためです。</p><p>pg_total_relation_sizeはテーブル、TOAST化テーブル、インデクスを含みます。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は3次元に対応しています。Zインデクスを削除しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は多面体サーフェスに対応しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 この関数は三角形と不規則三角網(TIN)に対応しています。</p></div><div class="refsection" title="例"><a name="id287081911"></a><h2>例</h2><pre class="programlisting">
-- マサチューセッツデータセット内のボストンのバイト数を返します
SELECT pg_size_pretty(SUM(ST_Mem_Size(the_geom))) as totgeomsum,
pg_size_pretty(SUM(CASE WHEN town = 'BOSTON' THEN st_mem_size(the_geom) ELSE 0 END)) As bossum,
CAST(SUM(CASE WHEN town = 'BOSTON' THEN st_mem_size(the_geom) ELSE 0 END)*1.00 /
		SUM(st_mem_size(the_geom))*100 As numeric(10,2)) As perbos
FROM towns;

totgeomsum	bossum	perbos
----------	------	------
1522 kB		30 kB	1.99


SELECT ST_Mem_Size(ST_GeomFromText('CIRCULARSTRING(220268 150415,220227 150505,220227 150406)'));

---
73

-- このジオメトリがテーブル全体に占める割合のパーセンテージ表示
SELECT pg_total_relation_size('public.neighborhoods') As fulltable_size, sum(ST_Mem_Size(the_geom)) As geomsize,
sum(ST_Mem_Size(the_geom))*1.00/pg_total_relation_size('public.neighborhoods')*100 As pergeom
FROM neighborhoods;
fulltable_size geomsize  pergeom
------------------------------------------------
262144         96238	 36.71188354492187500000
	</pre></div><div class="refsection" title="関連情報"><a name="id287081925"></a><h2>関連情報</h2><p></p></div></div><div class="refentry" title="ST_Point_Inside_Circle"><div class="refentry.separator"><hr></div><a name="ST_Point_Inside_Circle"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Point_Inside_Circle ? ポイントジオメトリがcenter_x, center_y , radiusで定義される円内にあるかどうかを見ます。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_Point_Inside_Circle</b>(</code>geometry  <var class="pdparam">a_point</var>, float  <var class="pdparam">center_x</var>, float  <var class="pdparam">center_y</var>, float  <var class="pdparam">radius</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287082000"></a><h2>説明</h2><p>この関数の書式はpoint_inside_circle(&lt;geometry&gt;,&lt;circle_center_x&gt;,&lt;circle_center_y&gt;,&lt;radius&gt;)です。ジオメトリがポイントで、かつ円内にある場合にTRUEを返します。他の場合はFALSEを返します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数は名前が示すようにポイントでのみ動作します。</p></td></tr></table></div></div><div class="refsection" title="例"><a name="id287082013"></a><h2>例</h2><pre class="programlisting">SELECT ST_Point_Inside_Circle(ST_Point(1,2), 0.5, 2, 3);
 st_point_inside_circle
------------------------
 t
</pre></div><div class="refsection" title="関連情報"><a name="id287082026"></a><h2>関連情報</h2><p><a class="xref" href="#ST_DWithin" title="ST_DWithin">ST_DWithin</a></p></div></div></div><div class="sect1" title="8.13. 例外的関数"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Exceptional_Functions"></a>8.13. 例外的関数</h2></div></div></div><div class="toc"><dl><dt><span class="refentrytitle"><a href="#PostGIS_AddBBox">PostGIS_AddBBox</a></span><span class="refpurpose"> ? ジオメトリにバウンディングボックスを追加します。</span></dt><dt><span class="refentrytitle"><a href="#PostGIS_DropBBox">PostGIS_DropBBox</a></span><span class="refpurpose"> ? バウンディングボックスのキャッシュをジオメトリから削除します。</span></dt><dt><span class="refentrytitle"><a href="#PostGIS_HasBBox">PostGIS_HasBBox</a></span><span class="refpurpose"> ? このジオメトリのバウンディングボックスがキャッシュされているならTRUEを、それ以外ならFALSEを返します。</span></dt></dl></div><p>これらの関数は、データが何らかの方法で壊された場合にのみ使用されるべきのもので、めったに使われません。データ破壊のトラブルシューティングに使われ、また、通常の状況下では決して起こらないことの修復にも使われます。</p><div class="refentry" title="PostGIS_AddBBox"><a name="PostGIS_AddBBox"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>PostGIS_AddBBox ? ジオメトリにバウンディングボックスを追加します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">PostGIS_AddBBox</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287079661"></a><h2>説明</h2><p>ジオメトリにバウンディングボックスを追加します。 これにより、バウンディングボックスベースのクエリの速度が上がりますが、ジオメトリのサイズが大きくなります。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>バウンディングボックスは自動的にジオメトリに追加されるので、一般的には、何らかの方法でバウンディングボックスが壊されたり、バウンダリボックスが欠けている古い版のデータベースを持っている場合のみ使う必要があります。その際、古いものを削除して追加しなおす必要があります。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p></div><div class="refsection" title="例"><a name="id287079722"></a><h2>例</h2><pre class="programlisting">UPDATE sometable
 SET the_geom =  PostGIS_AddBBox(the_geom)
 WHERE PostGIS_HasBBox(the_geom) = false;</pre></div><div class="refsection" title="関連情報"><a name="id287079735"></a><h2>関連情報</h2><p><a class="xref" href="#PostGIS_DropBBox" title="PostGIS_DropBBox">PostGIS_DropBBox</a>, <a class="xref" href="#PostGIS_HasBBox" title="PostGIS_HasBBox">PostGIS_HasBBox</a></p></div></div><div class="refentry" title="PostGIS_DropBBox"><div class="refentry.separator"><hr></div><a name="PostGIS_DropBBox"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>PostGIS_DropBBox ? バウンディングボックスのキャッシュをジオメトリから削除します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">PostGIS_DropBBox</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287079788"></a><h2>説明</h2><p>バウンディングボックスのキャッシュをジオメトリから削除します。これによりジオメトリのサイズは縮小しますが、バウンディングボックスベースのクエリは遅くなります。
不正なバウンディングボックスの削除にも使います。不正なバウンディングボックスを知るためのサインは、ST_Intersectsや他の関連クエリが当然TRUEになるべきジオメトリを無視する時です。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>自動的にジオメトリにバウンディングボックスが追加され、クエリ速度が改善されます。一般的には、生成されたバウンディングボックスが壊れるか、バウンディングボックスが欠けている古い版で使用します。その時は、古いものを削除し、追加しなおす必要があります。この種の破壊は8.3-8.3.6シリーズで見られます。ジオメトリ更新時に、キャッシュされたバウンディングボックスは常には計算されません。また、ダンプ/リロードを使わない新版へのアップデートでは、既に壊れたボックスが修正されません。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p></div><div class="refsection" title="例"><a name="id287079814"></a><h2>例</h2><pre class="programlisting">--この例ではキャッシュが不正になっている
--バウンダリボックスを削除しています。
--Box2Dを適用する前にST_AsBinaryを強制することで、
--ボックスを強制的に再計算します。
--テーブルジオメトリに適用されたBox2Dは
--常にキャッシュされたバウンディングボックスを返します。
			UPDATE sometable
 SET the_geom =  PostGIS_DropBBox(the_geom)
 WHERE Not (Box2D(ST_AsBinary(the_geom)) = Box2D(the_geom));

	UPDATE sometable
 SET the_geom =  PostGIS_AddBBox(the_geom)
 WHERE Not PostGIS_HasBBOX(the_geom);


 </pre></div><div class="refsection" title="関連情報"><a name="id287079827"></a><h2>関連情報</h2><p><a class="xref" href="#PostGIS_AddBBox" title="PostGIS_AddBBox">PostGIS_AddBBox</a>, <a class="xref" href="#PostGIS_HasBBox" title="PostGIS_HasBBox">PostGIS_HasBBox</a>, <a class="xref" href="#Box2D" title="Box2D">Box2D</a></p></div></div><div class="refentry" title="PostGIS_HasBBox"><div class="refentry.separator"><hr></div><a name="PostGIS_HasBBox"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>PostGIS_HasBBox ? このジオメトリのバウンディングボックスがキャッシュされているならTRUEを、それ以外ならFALSEを返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">PostGIS_HasBBox</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287079883"></a><h2>説明</h2><p>このジオメトリのバウンディングボックスがキャッシュされているならTRUEを、それ以外ならFALSEを返します。キャッシュを制御するにはxref linkend="PostGIS_AddBBox" /&gt;と<a class="xref" href="#PostGIS_DropBBox" title="PostGIS_DropBBox">PostGIS_DropBBox</a>を使います。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 このメソッドは曲線ストリングと曲線に対応しています</p></div><div class="refsection" title="例"><a name="id287080009"></a><h2>例</h2><pre class="programlisting">SELECT the_geom
FROM sometable WHERE PostGIS_HasBBox(the_geom) = false;</pre></div><div class="refsection" title="関連情報"><a name="id287080022"></a><h2>関連情報</h2><p><a class="xref" href="#PostGIS_AddBBox" title="PostGIS_AddBBox">PostGIS_AddBBox</a>, <a class="xref" href="#PostGIS_DropBBox" title="PostGIS_DropBBox">PostGIS_DropBBox</a></p></div></div></div></div><div class="chapter" title="第9章 ラスタ リファレンス"><div class="titlepage"><div><div><h2 class="title"><a name="RT_reference"></a>第9章 ラスタ リファレンス</h2></div></div></div><div class="toc"><p><b>目次</b></p><dl><dt><span class="sect1"><a href="#Raster_Types">9.1. ラスタサポートデータ型</a></span></dt><dt><span class="sect1"><a href="#Raster_Management_Functions">9.2. ラスタ管理</a></span></dt><dt><span class="sect1"><a href="#Raster_Constructors">9.3. ラスタ コンストラクタ</a></span></dt><dt><span class="sect1"><a href="#Raster_Accessors">9.4. ラスタ アクセサ</a></span></dt><dt><span class="sect1"><a href="#RasterBand_Accessors">9.5. ラスタバンド アクセサ</a></span></dt><dt><span class="sect1"><a href="#Raster_Pixel_Accessors">9.6. ラスタピクセル アクセサとセッター</a></span></dt><dt><span class="sect1"><a href="#Raster_Editors">9.7. ラスタ エディタ</a></span></dt><dt><span class="sect1"><a href="#RasterBand_Editors">9.8. ラスタバンド エディタ</a></span></dt><dt><span class="sect1"><a href="#RasterBand_Stats">9.9. ラスタバンド統計情報と解析</a></span></dt><dt><span class="sect1"><a href="#Raster_Outputs">9.10. ラスタ出力</a></span></dt><dt><span class="sect1"><a href="#Raster_Processing">9.11. ラスタ処理</a></span></dt><dt><span class="sect1"><a href="#Raster_Processing_Builtin_Functions">9.12. ラスタ処理組み込み関数</a></span></dt><dt><span class="sect1"><a href="#RT_Operators">9.13. ラスタ演算子</a></span></dt><dt><span class="sect1"><a href="#Raster_Relationships">9.14. ラスタ/ラスタバンドの空間関係関数</a></span></dt></dl></div><p>ここで挙げる関数は、PostGISラスタにとって必要と思われるもので、現在PostGISラスタで有効なものです。一般的なユーザが利用しない、ラスタオブジェクトに対して求められるサポート関数があります。</p><p><code class="varname">raster</code>はラスタデータを格納、解析するためのPostGISの型です。</p><p>ラスタファイルからラスタをロードするには<a class="xref" href="#RT_Loading_Rasters" title="5.1. ラスタのロードと生成">「ラスタのロードと生成」</a>を参照して下さい。</p><p>このリファレンスにおける例ではダミーラスタのラスタテーブルを使っています。ラスタは次のようなコードで形成しています。</p><pre class="programlisting">CREATE TABLE dummy_rast(rid integer, rast raster);
INSERT INTO dummy_rast(rid, rast)
VALUES (1,
('01' -- little endian (uint8 ndr)
|| 
'0000' -- version (uint16 0)
||
'0000' -- nBands (uint16 0)
||
'0000000000000040' -- scaleX (float64 2)
||
'0000000000000840' -- scaleY (float64 3)
||
'000000000000E03F' -- ipX (float64 0.5)
||
'000000000000E03F' -- ipY (float64 0.5)
||
'0000000000000000' -- skewX (float64 0)
||
'0000000000000000' -- skewY (float64 0)
||
'00000000' -- SRID (int32 0)
||
'0A00' -- width (uint16 10)
||
'1400' -- height (uint16 20)
)::raster
),
-- Raster: 5 x 5 pixels, 3 bands, PT_8BUI pixel type, NODATA = 0
(2,  ('01000003009A9999999999A93F9A9999999999A9BF000000E02B274A' ||
'41000000007719564100000000000000000000000000000000FFFFFFFF050005000400FDFEFDFEFEFDFEFEFDF9FAFEF' ||
'EFCF9FBFDFEFEFDFCFAFEFEFE04004E627AADD16076B4F9FE6370A9F5FE59637AB0E54F58617087040046566487A1506CA2E3FA5A6CAFFBFE4D566DA4CB3E454C5665')::raster);</pre><div class="sect1" title="9.1. ラスタサポートデータ型"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Raster_Types"></a>9.1. ラスタサポートデータ型</h2></div><div><div class="abstract" title="概要"><p class="title"><b>概要</b></p><p>本節では、ラスタ機能をサポートするために作られたPostgreSQLデータ型の一覧を挙げます。</p></div></div></div></div><div class="toc"><dl><dt><span class="refentrytitle"><a href="#geomval">geomval</a></span><span class="refpurpose"> ? geom(ジオメトリオブジェクトを保持)とval(ラスタバンドからのピクセル値を倍精度浮動小数点数で保持)の2フィールドからなるデータ型。</span></dt><dt><span class="refentrytitle"><a href="#histogram">ヒストグラム</a></span><span class="refpurpose"> ? ST_HistogramとST_ApproxHistogram関数のレコード出力として使われる複合型。</span></dt><dt><span class="refentrytitle"><a href="#raster">raster</a></span><span class="refpurpose"> ? ラスタ空間データ型</span></dt><dt><span class="refentrytitle"><a href="#reclassarg">reclassarg</a></span><span class="refpurpose"> ? ST_Reclass関数への入力として使用する複合型です。再分類の挙動を定義します。</span></dt><dt><span class="refentrytitle"><a href="#summarystats">summarystats</a></span><span class="refpurpose"> ? ST_SummaryStats関数の出力として使う複合型です。</span></dt></dl></div><div class="refentry" title="geomval"><a name="geomval"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>geomval ? geom(ジオメトリオブジェクトを保持)とval(ラスタバンドからのピクセル値を倍精度浮動小数点数で保持)の2フィールドからなるデータ型。</p></div><div class="refsection" title="説明"><a name="id287126599"></a><h2>説明</h2><p>geomvalは.geomフィールドで参照されるジオメトリオブジェクトと、特定の地理位置におけるラスタバンドのピクセル値を表現する浮動小数点数のvalからなる複合型です。ポリゴンにラスタバンドを展開するための出力型として、ST_DumpAsPolygonとラスタのインタセクション関連関数群に使われます。</p></div><div class="refsection" title="関連情報"><a name="id287126609"></a><h2>関連情報</h2><p><a class="xref" href="#PostGIS_Geometry_DumpFunctions" title="13.5. PostGISジオメトリ/ジオグラフィ/ラスタダンプ関数">「PostGISジオメトリ/ジオグラフィ/ラスタダンプ関数」</a> </p></div></div><div class="refentry" title="ヒストグラム"><div class="refentry.separator"><hr></div><a name="histogram"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ヒストグラム ? ST_HistogramとST_ApproxHistogram関数のレコード出力として使われる複合型。</p></div><div class="refsection" title="説明"><a name="id287126634"></a><h2>説明</h2><p><a class="xref" href="#RT_ST_Histogram" title="ST_Histogram">ST_Histogram</a>と<code class="varname">ST_ApproxHistogram</code>関数のレコード出力として使われる複合型です。nodataピクセルを含めて良いかどうかは、関数の<code class="varname">exclude_nodata_value</code>に依存していることに注意して下さい。</p><p>結果のヒストグラム行は選択されたラスタバンドのビン(訳注: ヒストグラムをグラフにした際の柱)に一致します。</p><div class="variablelist"><dl><dt><span class="term"><em class="parameter"><code>min </code></em><span class="type">double precision</span></span></dt><dd><p>このビンの最小ピクセル値。</p></dd><dt><span class="term"><em class="parameter"><code>max </code></em><span class="type">double precision</span></span></dt><dd><p>このビンの最大ピクセル値。</p></dd><dt><span class="term"><em class="parameter"><code>count </code></em><span class="type">integer</span></span></dt><dd><p>このビンのピクセル数。</p></dd><dt><span class="term"><em class="parameter"><code>percent </code></em><span class="type">double precision</span></span></dt><dd><p>このビンのピクセル数の、全体のピクセル数に対する割合。</p></dd></dl></div></div><div class="refsection" title="関連情報"><a name="id287126720"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Histogram" title="ST_Histogram">ST_Histogram</a></p></div></div><div class="refentry" title="raster"><div class="refentry.separator"><hr></div><a name="raster"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>raster ? ラスタ空間データ型</p></div><div class="refsection" title="説明"><a name="id287126745"></a><h2>説明</h2><p>rasterは、JPEG, TIFF, PNG, デジタル標高モデルといったラスタデータを表現する空間データ型です。ラスタはそれぞれ1以上のバンドを持ち、バンドはそれぞれにピクセルの集合を持ちます。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>PostGISをGDALサポート付きでコンパイルする必要があります。
現在、ラスタは暗黙にジオメトリ型に変換することができますが、ラスタの<a class="xref" href="#RT_ST_ConvexHull" title="ST_ConvexHull">ST_ConvexHull</a>を返します。この自動キャストは近いうちに削除するかも知れないので、この関数に頼らないようにして下さい。</p></td></tr></table></div></div><div class="refsection" title="キャストの挙動"><a name="id287126764"></a><h2>キャストの挙動</h2><p>本節では、このデータ型で許容される明示的なキャストと自動キャストの一覧を挙げます。</p><div class="informaltable"><table border="1"><colgroup><col><col></colgroup><tbody><tr><td>キャスト先</td><td>挙動</td></tr><tr><td>geometry</td><td>automatic</td></tr></tbody></table></div></div><div class="refsection" title="関連情報"><a name="id287126842"></a><h2>関連情報</h2><p><a class="xref" href="#RT_reference" title="第9章 ラスタ リファレンス">9章<i>ラスタ リファレンス</i></a></p></div></div><div class="refentry" title="reclassarg"><div class="refentry.separator"><hr></div><a name="reclassarg"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>reclassarg ? ST_Reclass関数への入力として使用する複合型です。再分類の挙動を定義します。</p></div><div class="refsection" title="説明"><a name="id287126867"></a><h2>説明</h2><p>ST_Reclass関数への入力として使用する複合型です。再分類の挙動を定義します。</p><div class="variablelist"><dl><dt><span class="term"><em class="parameter"><code>nband </code></em><span class="type">integer</span></span></dt><dd><p>再分類対象バンドの番号。</p></dd><dt><span class="term"><em class="parameter"><code>reclassexpr </code></em><span class="type">text</span></span></dt><dd><p>
コンマ区切りの範囲表現。古い値から新しい値にマップする方法を定義します。
'('は「これより大きい」、')'は「これより小さい」、'['は「これ以上」、']'は「これ以下」、をそれぞれ示します。</p><pre class="programlisting">1. [a-b] = a &lt;= x &lt;= b

2. (a-b] = a &lt; x &lt;= b

3. [a-b) = a &lt;= x &lt; b

4. (a-b) = a &lt; x &lt; b</pre><p>'('標記はオプションです。'a-b'は'(a-b)'と同じ意味になります。</p></dd><dt><span class="term"><em class="parameter"><code>pixeltype </code></em><span class="type">text</span></span></dt><dd><p><a class="xref" href="#RT_ST_BandPixelType" title="ST_BandPixelType">ST_BandPixelType</a>の記述にあるピクセル型の1つ。</p></dd><dt><span class="term"><em class="parameter"><code>nodataval </code></em><span class="type">double precision</span></span></dt><dd><p>NoDataとして扱う値。透過が可能な画像出力では、この値は空白になります。</p></dd></dl></div></div><div class="refsection" title="例: 2番バンドを8BUIで255をNoDataに再分類します。"><a name="id287126952"></a><h2>例: 2番バンドを8BUIで255をNoDataに再分類します。</h2><pre class="programlisting">SELECT ROW(2, '0-100:1-10, 101-500:11-150,501 - 10000: 151-254', '8BUI', 255)::reclassarg;</pre></div><div class="refsection" title="例: 1番バンドを1BBでNoDataを定義しないで再分類します。"><a name="id287126963"></a><h2>例: 1番バンドを1BBでNoDataを定義しないで再分類します。</h2><pre class="programlisting">SELECT ROW(1, '0-100]:0, (100-255:1', '1BB', NULL)::reclassarg;</pre></div><div class="refsection" title="関連情報"><a name="id287126974"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Reclass" title="ST_Reclass">ST_Reclass</a></p></div></div><div class="refentry" title="summarystats"><div class="refentry.separator"><hr></div><a name="summarystats"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>summarystats ? ST_SummaryStats関数の出力として使う複合型です。</p></div><div class="refsection" title="説明"><a name="id287127000"></a><h2>説明</h2><p><code class="varname">ST_SummaryStats</code>関数の出力として使う複合型です。<code class="varname">exclude_nodata_value</code>に従って、NoDataピクセルを含んで良いかどうかが異なります。</p><div class="variablelist"><dl><dt><span class="term"><em class="parameter"><code>count </code></em><span class="type">bigint</span></span></dt><dd><p>ラスタバンドのピクセル数。引数によってNoDataピクセル値を含んで良いかどうかが異なります。</p></dd><dt><span class="term"><em class="parameter"><code>sum </code></em><span class="type">double precision</span></span></dt><dd><p>バンドのピクセルの合計。</p></dd><dt><span class="term"><em class="parameter"><code>mean </code></em><span class="type">double precision</span></span></dt><dd><p>ピクセル値の平均値。</p></dd><dt><span class="term"><em class="parameter"><code>stddev </code></em><span class="type">double precision</span></span></dt><dd><p>ピクセル値の標準偏差。</p></dd><dt><span class="term"><em class="parameter"><code>min </code></em><span class="type">double precision</span></span></dt><dd><p>ピクセル値の最小値。</p></dd><dt><span class="term"><em class="parameter"><code>max </code></em><span class="type">double precision</span></span></dt><dd><p>ピクセル値の最大値。</p></dd></dl></div></div><div class="refsection" title="関連情報"><a name="id287127110"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_SummaryStats" title="ST_SummaryStats">ST_SummaryStats</a></p></div></div></div><div class="sect1" title="9.2. ラスタ管理"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Raster_Management_Functions"></a>9.2. ラスタ管理</h2></div></div></div><div class="toc"><dl><dt><span class="refentrytitle"><a href="#RT_AddRasterConstraints">AddRasterConstraints</a></span><span class="refpurpose"> ? ロードされたラスタテーブルの特定のカラムにラスタ制約を追加します。制約には空間参照系、スケール、ブロックサイズ、アラインメント、バンド、バンド型、ラスタカラムが規則正しいブロックかどうかを示すフラグがあります。テーブルは制約が推論されるためのデータがロードされなければなりません。制約の設定が完了するとtrueを返し、問題があると通知を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_DropRasterConstraints">DropRasterConstraints</a></span><span class="refpurpose"> ? ラスタテーブルカラムへの参照であるPostGISラスタ制約を削除します。データの再読み込みやラスタカラムデータの更新の際に使います。</span></dt><dt><span class="refentrytitle"><a href="#RT_PostGIS_Raster_Lib_Build_Date">PostGIS_Raster_Lib_Build_Date</a></span><span class="refpurpose"> ? Reports full raster library build date.</span></dt><dt><span class="refentrytitle"><a href="#RT_PostGIS_Raster_Lib_Version">PostGIS_Raster_Lib_Version</a></span><span class="refpurpose"> ? Reports full raster version and build configuration
		infos.</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_GDALDrivers">ST_GDALDrivers</a></span><span class="refpurpose"> ? 使用しているGDALライブラリが対応するラスタ書式の一覧を返します。ST_AsGDALRasterを使って出力できるラスタの書式です。</span></dt></dl></div><div class="refentry" title="AddRasterConstraints"><a name="RT_AddRasterConstraints"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>AddRasterConstraints ? ロードされたラスタテーブルの特定のカラムにラスタ制約を追加します。制約には空間参照系、スケール、ブロックサイズ、アラインメント、バンド、バンド型、ラスタカラムが規則正しいブロックかどうかを示すフラグがあります。テーブルは制約が推論されるためのデータがロードされなければなりません。制約の設定が完了するとtrueを返し、問題があると通知を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">AddRasterConstraints</b>(</code>name 
			<var class="pdparam">rasttable</var>, name 
			<var class="pdparam">rastcolumn</var>, boolean 
			<var class="pdparam">srid</var>, boolean 
			<var class="pdparam">scale_x</var>, boolean 
			<var class="pdparam">scale_y</var>, boolean 
			<var class="pdparam">blocksize_x</var>, boolean 
			<var class="pdparam">blocksize_y</var>, boolean 
			<var class="pdparam">same_alignment</var>, boolean 
			<var class="pdparam">regular_blocking</var>, boolean 
				<var class="pdparam">num_bands=true</var>
			, boolean 
				<var class="pdparam">pixel_types=true</var>
			, boolean 
				<var class="pdparam">nodata_values=true</var>
			, boolean 
				<var class="pdparam">out_db=true</var>
			, boolean 
				<var class="pdparam">extent=true</var>
			<code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">AddRasterConstraints</b>(</code>name 
			<var class="pdparam">rasttable</var>, name 
			<var class="pdparam">rastcolumn</var>, text[] 
			<var class="pdparam">VARIADIC constraints</var><code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">AddRasterConstraints</b>(</code>name 
			<var class="pdparam">rastschema</var>, name 
			<var class="pdparam">rasttable</var>, name 
			<var class="pdparam">rastcolumn</var>, text[] 
			<var class="pdparam">VARIADIC constraints</var><code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">AddRasterConstraints</b>(</code>name 
			<var class="pdparam">rastschema</var>, name 
			<var class="pdparam">rasttable</var>, name 
			<var class="pdparam">rastcolumn</var>, boolean 
			<var class="pdparam">srid=true</var>, boolean 
			<var class="pdparam">scale_x=true</var>, boolean 
			<var class="pdparam">scale_y=true</var>, boolean 
			<var class="pdparam">blocksize_x=true</var>, boolean 
			<var class="pdparam">blocksize_y=true</var>, boolean 
			<var class="pdparam">same_alignment=true</var>, boolean 
			<var class="pdparam">regular_blocking=true</var>, boolean 
			<var class="pdparam">num_bands=true</var>, boolean 
			<var class="pdparam">pixel_types=true</var>, boolean 
				<var class="pdparam">nodata_values=true</var>
			, boolean 
				<var class="pdparam">out_db=true</var>
			, boolean 
				<var class="pdparam">extent=true</var>
			<code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287127561"></a><h2>説明</h2><p>ラスタカラム上に、ラスタカタログ<code class="varname">raster_columns</code>で情報を表示するために使われる制約を生成します。<code class="varname">rastschema</code>は、テーブルがあるテーブルスキーマの名前です。
<code class="varname">srid</code>はSPATIAL_REF_SYSテーブル内のエントリを参照する整数でなければなりません。</p><p><code class="varname">raster2pgsql</code>はこの関数を使ってラスタテーブルラスタテーブルを登録します。</p><p>渡すのに妥当な制約名は次の通りです。詳細情報については<a class="xref" href="#RT_Raster_Columns" title="5.2.1. ラスタカラムカタログ">「ラスタカラムカタログ」</a>を参照して下さい。</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><code class="varname">blocksize</code> ブロックのXとY両方のサイズを指定します</p></li><li class="listitem"><p><code class="varname">blocksize_x</code> Xタイル(タイル毎のピクセル幅)を設定します</p></li><li class="listitem"><p><code class="varname">blocksize_y</code> Yタイル(タイル毎のピクセル幅)を設定します</p></li><li class="listitem"><p><code class="varname">extent</code> テーブル全体の範囲を計算し、全てのラスタがこの範囲内にある制約を適用します</p></li><li class="listitem"><p><code class="varname">num_bands</code> バンド数</p></li><li class="listitem"><p><code class="varname">pixel_types</code> バンドごとにピクセルタイプを読み、全てのバンドが同じピクセルタイプであることを確認するためのものです。</p></li><li class="listitem"><p><code class="varname">regular_blocking</code> 全てのタイルが規則正しいブロックになっていることを示すフラグを適用します。</p></li><li class="listitem"><p><code class="varname">same_alignment</code> 同じアラインメントを持つことを確認するためのものです。任意の2タイルについて比較するとtrueを返すという意味です。<a class="xref" href="#RT_ST_SameAlignment" title="ST_SameAlignment">ST_SameAlignment</a>を参照して下さい。</p></li><li class="listitem"><p><code class="varname">srid</code> 全て同じSRIDを持っていることを確認するためのものです。</p></li><li class="listitem"><p>その他 -- 上の関数の中に入力一覧が挙げられています。</p></li></ul></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はテーブル内に存在するデータから制約を推論します。動作させるには、ラスタカラムを生成し、データをロードする必要があります。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>制約を適用した後にデータをさらにロードする必要がある場合には、データ範囲が変わるならDropRasterConstraintsを使います。</p></td></tr></table></div><p>初出: 2.0.0</p></div><div class="refsection" title="例: Apply all possible constraints on column based on data"><a name="id287127715"></a><h2>例: Apply all possible constraints on column based on data</h2><pre class="programlisting">CREATE TABLE myrasters(rid SERIAL primary key, rast raster);
INSERT INTO myrasters(rast)
SELECT ST_AddBand(ST_MakeEmptyRaster(1000, 1000, 0.3, -0.3, 2, 2, 0, 0,4326), 1, '8BSI', -129, NULL);

SELECT AddRasterConstraints('myrasters'::name, 'rast'::name);


-- verify if registered correctly in the raster_columns view --
SELECT srid, scale_x, scale_y, blocksize_x, blocksize_y, num_bands, pixel_types, nodata_values
	FROM raster_columns
	WHERE r_table_name = 'myrasters';
	
 srid | scale_x | scale_y | blocksize_x | blocksize_y | num_bands | pixel_types| nodata_values
------+---------+---------+-------------+-------------+-----------+-------------+---------------
 4326 |       2 |       2 |        1000 |        1000 |         1 | {8BSI}      | {0}
		</pre></div><div class="refsection" title="例: Apply single constraint"><a name="id287127726"></a><h2>例: Apply single constraint</h2><pre class="programlisting">CREATE TABLE public.myrasters2(rid SERIAL primary key, rast raster);
INSERT INTO myrasters2(rast)
SELECT ST_AddBand(ST_MakeEmptyRaster(1000, 1000, 0.3, -0.3, 2, 2, 0, 0,4326), 1, '8BSI', -129, NULL);

SELECT AddRasterConstraints('public'::name, 'myrasters2'::name, 'rast'::name,'regular_blocking', 'blocksize');
-- get notice--
NOTICE:  Adding regular blocking constraint
INFO:  The regular_blocking constraint is just a flag indicating that the column "rast" is regularly blocked.  As no function exist yet to assert that a raster column is regularly blocked, it is up to the end-user to ensure that the column is truely regularly blocked.
CONTEXT:  PL/pgSQL function "addrasterconstraints" line 85 at assignment
NOTICE:  Adding blocksize-X constraint
NOTICE:  Adding blocksize-Y constraint</pre></div><div class="refsection" title="関連情報"><a name="id287127737"></a><h2>関連情報</h2><p><a class="xref" href="#RT_Raster_Columns" title="5.2.1. ラスタカラムカタログ">「ラスタカラムカタログ」</a>, <a class="xref" href="#RT_ST_AddBand" title="ST_AddBand">ST_AddBand</a>, <a class="xref" href="#RT_ST_MakeEmptyRaster" title="ST_MakeEmptyRaster">ST_MakeEmptyRaster</a>, <a class="xref" href="#RT_DropRasterConstraints" title="DropRasterConstraints">DropRasterConstraints</a>, <a class="xref" href="#RT_ST_BandPixelType" title="ST_BandPixelType">ST_BandPixelType</a>, <a class="xref" href="#RT_ST_SRID" title="ST_SRID">ST_SRID</a></p></div></div><div class="refentry" title="DropRasterConstraints"><div class="refentry.separator"><hr></div><a name="RT_DropRasterConstraints"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>DropRasterConstraints ? ラスタテーブルカラムへの参照であるPostGISラスタ制約を削除します。データの再読み込みやラスタカラムデータの更新の際に使います。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">DropRasterConstraints</b>(</code>name 
			<var class="pdparam">rasttable</var>, name 
			<var class="pdparam">rastcolumn</var>, boolean 
			<var class="pdparam">srid</var>, boolean 
			<var class="pdparam">scale_x</var>, boolean 
			<var class="pdparam">scale_y</var>, boolean 
			<var class="pdparam">blocksize_x</var>, boolean 
			<var class="pdparam">blocksize_y</var>, boolean 
			<var class="pdparam">same_alignment</var>, boolean 
			<var class="pdparam">regular_blocking</var>, boolean 
			<var class="pdparam">num_bands=true</var>, boolean 
			<var class="pdparam">pixel_types=true</var>, boolean 
			<var class="pdparam">nodata_values=true</var>, boolean 
				<var class="pdparam">out_db=true</var>
			, boolean 
			<var class="pdparam">extent=true</var><code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">DropRasterConstraints</b>(</code>name 
			<var class="pdparam">rastschema</var>, name 
			<var class="pdparam">rasttable</var>, name 
			<var class="pdparam">rastcolumn</var>, boolean 
			<var class="pdparam">srid=true</var>, boolean 
			<var class="pdparam">scale_x=true</var>, boolean 
			<var class="pdparam">scale_y=true</var>, boolean 
			<var class="pdparam">blocksize_x=true</var>, boolean 
			<var class="pdparam">blocksize_y=true</var>, boolean 
			<var class="pdparam">same_alignment=true</var>, boolean 
			<var class="pdparam">regular_blocking=true</var>, boolean 
			<var class="pdparam">num_bands=true</var>, boolean 
			<var class="pdparam">pixel_types=true</var>, boolean 
			<var class="pdparam">nodata_values=true</var>, boolean 
				<var class="pdparam">out_db=true</var>
			, boolean 
			<var class="pdparam">extent=true</var><code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">DropRasterConstraints</b>(</code>name 
			<var class="pdparam">rastschema</var>, name 
			<var class="pdparam">rasttable</var>, name 
			<var class="pdparam">rastcolumn</var>, text[] 
			<var class="pdparam">constraints</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287130816"></a><h2>説明</h2><p><a class="xref" href="#RT_AddRasterConstraints" title="AddRasterConstraints">AddRasterConstraints</a>で追加された、ラスタテーブルカラムへの参照であるPostGISラスタ制約を削除します。データの追加ロードやラスタカラムデータの更新で使います。ラスタテーブルまたはラスタカラムのridを取得したい場合には使う必要がありません。</p><p>ラスタテーブルを削除するには、標準的な</p><pre class="programlisting">DROP TABLE mytable</pre><p>を使います。</p><p>ラスタカラムを削除してテーブルの残りを置いておくには標準的なSQLである</p><pre class="programlisting">ALTER TABLE mytable DROP COLUMN rast</pre><p>を使います。</p><p>カラムまたはテーブルが削除されると、テーブルは<code class="varname">raster_columns</code>カタログから見えなくなります。しかしながら、制約だけが削除されたので、ラスタカラムはなお<code class="varname">raster_columns</code>カタログに残ります。しかし、カラム名とテーブルからの内部に関する他の情報は存在しません。</p><p>初出: 2.0.0</p></div><div class="refsection" title="例"><a name="id287130856"></a><h2>例</h2><pre class="programlisting">
SELECT DropRasterConstraints ('myrasters','rast');
----RESULT output ---
t

-- verify change in raster_columns --
SELECT srid, scale_x, scale_y, blocksize_x, blocksize_y, num_bands, pixel_types, nodata_values
	FROM raster_columns
	WHERE r_table_name = 'myrasters';
	
 srid | scale_x | scale_y | blocksize_x | blocksize_y | num_bands | pixel_types| nodata_values
------+---------+---------+-------------+-------------+-----------+-------------+---------------
    0 |         |         |             |             |           |             |
		</pre></div><div class="refsection" title="関連情報"><a name="id287130867"></a><h2>関連情報</h2><p><a class="xref" href="#RT_AddRasterConstraints" title="AddRasterConstraints">AddRasterConstraints</a></p></div></div><div class="refentry" title="PostGIS_Raster_Lib_Build_Date"><div class="refentry.separator"><hr></div><a name="RT_PostGIS_Raster_Lib_Build_Date"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>PostGIS_Raster_Lib_Build_Date ? Reports full raster library build date.</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">PostGIS_Raster_Lib_Build_Date</b>(</code><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287130910"></a><h2>説明</h2><p>Reports raster build date</p></div><div class="refsection" title="例"><a name="id287130920"></a><h2>例</h2><pre class="programlisting">SELECT PostGIS_Raster_Lib_Build_Date();
postgis_raster_lib_build_date
-----------------------------
2010-04-28 21:15:10
</pre></div><div class="refsection" title="関連情報"><a name="id287130932"></a><h2>関連情報</h2><p> <a class="xref" href="#RT_PostGIS_Raster_Lib_Version" title="PostGIS_Raster_Lib_Version">PostGIS_Raster_Lib_Version</a></p></div></div><div class="refentry" title="PostGIS_Raster_Lib_Version"><div class="refentry.separator"><hr></div><a name="RT_PostGIS_Raster_Lib_Version"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>PostGIS_Raster_Lib_Version ? Reports full raster version and build configuration
		infos.</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">PostGIS_Raster_Lib_Version</b>(</code><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287130977"></a><h2>説明</h2><p>Reports full raster version and build configuration
		infos.</p></div><div class="refsection" title="例"><a name="id287130986"></a><h2>例</h2><pre class="programlisting">SELECT PostGIS_Raster_Lib_Version();
postgis_raster_lib_version
-----------------------------
 2.0.0
</pre></div><div class="refsection" title="関連情報"><a name="id287130997"></a><h2>関連情報</h2><p> <a class="xref" href="#PostGIS_Lib_Version" title="PostGIS_Lib_Version">PostGIS_Lib_Version</a></p></div></div><div class="refentry" title="ST_GDALDrivers"><div class="refentry.separator"><hr></div><a name="RT_ST_GDALDrivers"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_GDALDrivers ? 使用しているGDALライブラリが対応するラスタ書式の一覧を返します。ST_AsGDALRasterを使って出力できるラスタの書式です。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">setof record <b class="fsfunc">ST_GDALDrivers</b>(</code>integer  <var class="pdparam">OUT idx</var>, text  <var class="pdparam">OUT short_name</var>, text  <var class="pdparam">OUT long_name</var>, text  <var class="pdparam">OUT create_options</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287131074"></a><h2>説明</h2><p>使用しているGDALライブラリが対応するラスタ書式のshort_name, long_nameと作成オプションの一覧を返します。short_nameは、<a class="xref" href="#RT_ST_AsGDALRaster" title="ST_AsGDALRaster">ST_AsGDALRaster</a>の<code class="varname">format</code>パラメタに使います。オプションはGDALライブラリのコンパイルに使ったドライバに依存します。<code class="varname">create_options</code>は、XML形式のCretionOptionList/Optionの集合で、ドライバごとの生成オプションごとに、名前を持ち、追加情報の<code class="varname">type</code>, <code class="varname">description</code>と、<code class="varname">VALUE</code>の集合を持ちます。</p><p>初出: 2.0.0 - GDAL 1.6.0以上が必要です。</p></div><div class="refsection" title="例: ドライバ一覧"><a name="id287131209"></a><h2>例: ドライバ一覧</h2><pre class="programlisting">SELECT short_name, long_name
FROM st_gdaldrivers()
ORDER BY short_name;
  short_name    |              long_name
----------------+--------------------------------------
AAIGrid         | Arc/Info ASCII Grid
DTED            | DTED Elevation Raster
EHdr            | ESRI .hdr Labelled
FIT             | FIT Image
GIF             | Graphics Interchange Format (.gif)
GSAG            | Golden Software ASCII Grid (.grd)
GSBG            | Golden Software Binary Grid (.grd)
GTiff           | GeoTIFF
HF2             | HF2/HFZ heightfield raster
HFA             | Erdas Imagine Images (.img)
ILWIS           | ILWIS Raster Map
INGR            | Intergraph Raster
JPEG            | JPEG JFIF
KMLSUPEROVERLAY | Kml Super Overlay
NITF            | National Imagery Transmission Format
PNG             | Portable Network Graphics
R               | R Object Data Store
SAGA            | SAGA GIS Binary Grid (.sdat)
SRTMHGT         | SRTMHGT File Format
USGSDEM         | USGS Optional ASCII DEM (and CDED)
VRT             | Virtual Raster
XPM             | X11 PixMap Format

</pre></div><div class="refsection" title="例: ドライバ毎のオプション一覧"><a name="id287131220"></a><h2>例: ドライバ毎のオプション一覧</h2><pre class="programlisting">-- JPEGについて生成オプションXMLカラムをテーブルとして出力します --
-- ST_AsGDALRasterの任意引数で使うことができます
SELECT (xpath('@name', g.opt))[1]::text As oname,
       (xpath('@type', g.opt))[1]::text As otype,
       (xpath('@description', g.opt))[1]::text As descrip
FROM (SELECT unnest(xpath('/CreationOptionList/Option', create_options::xml)) As opt
FROM  st_gdaldrivers()
WHERE short_name = 'JPEG') As g;

    oname    |  otype  |           descrip
-------------+---------+-----------------------------
 PROGRESSIVE | boolean |
 QUALITY     | int     | good=100, bad=0, default=75
 WORLDFILE   | boolean |
</pre><pre class="programlisting">
-- GeoTiffについて生成オプションの生のXMLを出力します --
SELECT create_options
FROM st_gdaldrivers()
WHERE short_name = 'GTiff';

&lt;CreationOptionList&gt;
    &lt;Option name="COMPRESS" type="string-select"&gt;
        &lt;Value&gt;NONE&lt;/Value&gt;
        &lt;Value&gt;LZW&lt;/Value&gt;
        &lt;Value&gt;PACKBITS&lt;/Value&gt;
        &lt;Value&gt;JPEG&lt;/Value&gt;
        &lt;Value&gt;CCITTRLE&lt;/Value&gt;
        &lt;Value&gt;CCITTFAX3&lt;/Value&gt;
        &lt;Value&gt;CCITTFAX4&lt;/Value&gt;
        &lt;Value&gt;DEFLATE&lt;/Value&gt;
    &lt;/Option&gt;
    &lt;Option name="PREDICTOR" type="int" description="Predictor Type"/&gt;
    &lt;Option name="JPEG_QUALITY" type="int" description="JPEG quality 1-100" default="75"/&gt;
    &lt;Option name="ZLEVEL" type="int" description="DEFLATE compression level 1-9" default="6"/&gt;
    &lt;Option name="NBITS" type="int" description="BITS for sub-byte files (1-7), sub-uint16 (9-15), sub-uint32 (17-31)"/&gt;
    &lt;Option name="INTERLEAVE" type="string-select" default="PIXEL"&gt;
        &lt;Value&gt;BAND&lt;/Value&gt;
        &lt;Value&gt;PIXEL&lt;/Value&gt;
    &lt;/Option&gt;
    &lt;Option name="TILED" type="boolean" description="Switch to tiled format"/&gt;
    &lt;Option name="TFW" type="boolean" description="Write out world file"/&gt;
    &lt;Option name="RPB" type="boolean" description="Write out .RPB (RPC) file"/&gt;
    &lt;Option name="BLOCKXSIZE" type="int" description="Tile Width"/&gt;
    &lt;Option name="BLOCKYSIZE" type="int" description="Tile/Strip Height"/&gt;
    &lt;Option name="PHOTOMETRIC" type="string-select"&gt;
        &lt;Value&gt;MINISBLACK&lt;/Value&gt;
        &lt;Value&gt;MINISWHITE&lt;/Value&gt;
        &lt;Value&gt;PALETTE&lt;/Value&gt;
        &lt;Value&gt;RGB&lt;/Value&gt;
        &lt;Value&gt;CMYK&lt;/Value&gt;
        &lt;Value&gt;YCBCR&lt;/Value&gt;
        &lt;Value&gt;CIELAB&lt;/Value&gt;
        &lt;Value&gt;ICCLAB&lt;/Value&gt;
        &lt;Value&gt;ITULAB&lt;/Value&gt;
    &lt;/Option&gt;
    &lt;Option name="SPARSE_OK" type="boolean" description="Can newly created files have missing blocks?" default="FALSE"/&gt;
    &lt;Option name="ALPHA" type="boolean" description="Mark first extrasample as being alpha"/&gt;
    &lt;Option name="PROFILE" type="string-select" default="GDALGeoTIFF"&gt;
        &lt;Value&gt;GDALGeoTIFF&lt;/Value&gt;
        &lt;Value&gt;GeoTIFF&lt;/Value&gt;
        &lt;Value&gt;BASELINE&lt;/Value&gt;
    &lt;/Option&gt;
    &lt;Option name="PIXELTYPE" type="string-select"&gt;
        &lt;Value&gt;DEFAULT&lt;/Value&gt;
        &lt;Value&gt;SIGNEDBYTE&lt;/Value&gt;
    &lt;/Option&gt;
    &lt;Option name="BIGTIFF" type="string-select" description="Force creation of BigTIFF file"&gt;
        &lt;Value&gt;YES&lt;/Value&gt;
        &lt;Value&gt;NO&lt;/Value&gt;
        &lt;Value&gt;IF_NEEDED&lt;/Value&gt;
        &lt;Value&gt;IF_SAFER&lt;/Value&gt;
    &lt;/Option&gt;
    &lt;Option name="ENDIANNESS" type="string-select" default="NATIVE" description="Force endianness of created file. For DEBUG purpose mostly"&gt;
        &lt;Value&gt;NATIVE&lt;/Value&gt;
        &lt;Value&gt;INVERTED&lt;/Value&gt;
        &lt;Value&gt;LITTLE&lt;/Value&gt;
        &lt;Value&gt;BIG&lt;/Value&gt;
    &lt;/Option&gt;
    &lt;Option name="COPY_SRC_OVERVIEWS" type="boolean" default="NO" description="Force copy of overviews of source dataset (CreateCopy())"/&gt;
&lt;/CreationOptionList&gt;

-- GeoTiffについて生成オプションのXMLカラムをテーブルとして出力 --
SELECT (xpath('@name', g.opt))[1]::text As oname,
       (xpath('@type', g.opt))[1]::text As otype,
       (xpath('@description', g.opt))[1]::text As descrip,
       array_to_string(xpath('Value/text()', g.opt),', ') As vals 
FROM (SELECT unnest(xpath('/CreationOptionList/Option', create_options::xml)) As opt
FROM  st_gdaldrivers()
WHERE short_name = 'GTiff') As g;

       oname        |     otype     |                               descrip                                |                                   vals                                    
--------------------+---------------+----------------------------------------------------------------------+---------------------------------------------------------------------------
 COMPRESS           | string-select |                                                                      | NONE, LZW, PACKBITS, JPEG, CCITTRLE, CCITTFAX3, CCITTFAX4, DEFLATE
 PREDICTOR          | int           | Predictor Type                                                       | 
 JPEG_QUALITY       | int           | JPEG quality 1-100                                                   | 
 ZLEVEL             | int           | DEFLATE compression level 1-9                                        | 
 NBITS              | int           | BITS for sub-byte files (1-7), sub-uint16 (9-15), sub-uint32 (17-31) | 
 INTERLEAVE         | string-select |                                                                      | BAND, PIXEL
 TILED              | boolean       | Switch to tiled format                                               | 
 TFW                | boolean       | Write out world file                                                 | 
 RPB                | boolean       | Write out .RPB (RPC) file                                            | 
 BLOCKXSIZE         | int           | Tile Width                                                           | 
 BLOCKYSIZE         | int           | Tile/Strip Height                                                    | 
 PHOTOMETRIC        | string-select |                                                                      | MINISBLACK, MINISWHITE, PALETTE, RGB, CMYK, YCBCR, CIELAB, ICCLAB, ITULAB
 SPARSE_OK          | boolean       | Can newly created files have missing blocks?                         | 
 ALPHA              | boolean       | Mark first extrasample as being alpha                                | 
 PROFILE            | string-select |                                                                      | GDALGeoTIFF, GeoTIFF, BASELINE
 PIXELTYPE          | string-select |                                                                      | DEFAULT, SIGNEDBYTE
 BIGTIFF            | string-select | Force creation of BigTIFF file                                       | YES, NO, IF_NEEDED, IF_SAFER
 ENDIANNESS         | string-select | Force endianness of created file. For DEBUG purpose mostly           | NATIVE, INVERTED, LITTLE, BIG
 COPY_SRC_OVERVIEWS | boolean       | Force copy of overviews of source dataset (CreateCopy())             | 
(19 rows)
</pre></div><div class="refsection" title="関連情報"><a name="id287131234"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_AsGDALRaster" title="ST_AsGDALRaster">ST_AsGDALRaster</a>, <a class="xref" href="#ST_SRID" title="ST_SRID">ST_SRID</a> </p></div></div></div><div class="sect1" title="9.3. ラスタ コンストラクタ"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Raster_Constructors"></a>9.3. ラスタ コンストラクタ</h2></div></div></div><div class="toc"><dl><dt><span class="refentrytitle"><a href="#RT_ST_AddBand">ST_AddBand</a></span><span class="refpurpose"> ? 与えられたタイプで、与えられた初期値にした新しいバンドを、与えられたインデクス位置に付けたラスタを返します。インデクス位置を指定していない場合には、バンドは末尾に追加されます。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_AsRaster">ST_AsRaster</a></span><span class="refpurpose"> ? PostGISジオメトリをPostGISラスタに変換します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Band">ST_Band</a></span><span class="refpurpose"> ? 既存のラスタの1つ以上のバンドを新しいラスタとして返します。既存のラスタから新しいラスタを構築する際に使います。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_MakeEmptyRaster">ST_MakeEmptyRaster</a></span><span class="refpurpose"> ? 与えられたピクセル範囲(width, height)、左上のX,Y、ピクセルサイズ、回転(scalex, scaley, skewx, skewy)と空間参照系(SRID)が指定された空ラスタ(バンドを持たないラスタ)を返します。ラスタが渡されると、新しいラスタは渡されたラスタと同じサイズ、アラインメント、SRIDになります。SRIDが指定されていない場合には、空間参照系は不明(0)とされます。</span></dt></dl></div><div class="refentry" title="ST_AddBand"><a name="RT_ST_AddBand"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AddBand ? 与えられたタイプで、与えられた初期値にした新しいバンドを、与えられたインデクス位置に付けたラスタを返します。インデクス位置を指定していない場合には、バンドは末尾に追加されます。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_AddBand</b>(</code>raster  <var class="pdparam">rast</var>, text  <var class="pdparam">pixeltype</var>, double precision  <var class="pdparam">initialvalue=0</var>, double precision  <var class="pdparam">nodataval=NULL</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_AddBand</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">index</var>, text  <var class="pdparam">pixeltype</var>, double precision  <var class="pdparam">initialvalue=0</var>, double precision  <var class="pdparam">nodataval=NULL</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_AddBand</b>(</code>raster  <var class="pdparam">torast</var>, raster  <var class="pdparam">fromrast</var>, integer  <var class="pdparam">fromband=1</var>, integer  <var class="pdparam">torastindex=at_end</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_AddBand</b>(</code>raster  <var class="pdparam">torast</var>, raster[]  <var class="pdparam">fromrasts</var>, integer  <var class="pdparam">fromband=1</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287131496"></a><h2>説明</h2><p>与えられたタイプで、与えられた初期値にし、与えられたnodata値を付した新しいバンドを追加したラスタを返します。インデクス位置を指定していない場合には、バンドは末尾に追加されます。
<code class="varname">fromband</code>が指定されない場合には、1番バンドと仮定します。ピクセルタイプは<a class="xref" href="#RT_ST_BandPixelType" title="ST_BandPixelType">ST_BandPixelType</a>で指定されているピクセルタイプの文字列表現です。
既存のインデクスが指定された場合には、以降のバンドは全て1以上足されたインデクスになります。初期値としてピクセルタイプの最大値を超えた値が指定された場合には、初期値にピクセルタイプの許容最大値が指定されます。ふたつめの版は<code class="varname">fromrast</code>ラスタから<code class="varname">torast</code>に<code class="varname">torastindex</code>の位置に<code class="varname">fromband</code>を追加します。</p><p>バンド配列を取る版については、<code class="varname">torast</code>がNULLの場合には、バンド配列の要素ごとの<code class="varname">fromband</code>のバンドを新しいラスタに集めます。</p></div><div class="refsection" title="例: 単一のバンド追加版"><a name="id287131536"></a><h2>例: 単一のバンド追加版</h2><pre class="programlisting">-- 8ビット符号無し整数で初期値200のバンドを追加します
UPDATE dummy_rast
    SET rast = ST_AddBand(rast,'8BUI',200)  
WHERE rid = 1;
					</pre><pre class="programlisting">-- 100x100単位で左上を0,0としたラスタを生成して、2バンドを追加します
-- (1番バンドは0/1の真偽ビットスイッチで、2番バンドは0-15の値を取ります)
INSERT INTO dummy_rast(rid,rast)
    VALUES(10, ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(100, 100, 0, 0, 1, -1, 0, 0, 0), '1BB'), '4BUI') );
    
-- output meta data of raster bands to verify all is right --
SELECT  (bmd).*
FROM (SELECT ST_BandMetaData(rast,generate_series(1,2)) As bmd 
    FROM dummy_rast WHERE rid = 10) AS foo;
 --result --   
 pixeltype | nodatavalue | isoutdb | path
-----------+----------------+-------------+---------+------
 1BB       |             | f       |
 4BUI      |             | f       |
 
 
-- ラスタのメタデータを出力します -
SELECT  (rmd).width, (rmd).height, (rmd).numbands
FROM (SELECT ST_MetaData(rast) As rmd 
    FROM dummy_rast WHERE rid = 10) AS foo;
-- 結果 --
 upperleftx | upperlefty | width | height | scalex | scaley | skewx | skewy | srid | numbands
------------+------------+-------+--------+------------+------------+-------+-------+------+----------
          0 |          0 |   100 |    100 |      1 |     -1 |     0 |     0 |   0 |        2
					</pre></div><div class="refsection" title="例: 複数バンド版"><a name="id287131550"></a><h2>例: 複数バンド版</h2><pre class="programlisting">-- ラスタのようなテーブルの1番バンドを集計して単一ラスタに入れます。
-- test_typeと同じ数のバンドを持つ、マウスの数と同じ行(新しいラスタ)になります。
-- ご注意: ORDER BY test_typeは、PostgreSQL 9.0以上でのみ対応します
--   8.4以下では副問い合わせ内の並び順になります(保証もされません)
-- 結果ラスタはtest_typeのアルファベット順でtest_typeごとのバンドを持ちます
-- マウス好きの方へ: この例ではマウスは傷つきませんでした
SELECT mouse, ST_AddBand(NULL, array_agg(rast ORDER BY test_type), 1 ) As rast 
	FROM mice_studies
			GROUP BY mouse; 	
					</pre></div><div class="refsection" title="関連情報"><a name="id287131561"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_BandMetaData" title="ST_BandMetaData">ST_BandMetaData</a>, <a class="xref" href="#RT_ST_BandPixelType" title="ST_BandPixelType">ST_BandPixelType</a>, <a class="xref" href="#RT_ST_MakeEmptyRaster" title="ST_MakeEmptyRaster">ST_MakeEmptyRaster</a>, <a class="xref" href="#RT_ST_MetaData" title="ST_MetaData">ST_MetaData</a>, <a class="xref" href="#RT_ST_NumBands" title="ST_NumBands">ST_NumBands</a>, <a class="xref" href="#RT_ST_Reclass" title="ST_Reclass">ST_Reclass</a></p></div></div><div class="refentry" title="ST_AsRaster"><div class="refentry.separator"><hr></div><a name="RT_ST_AsRaster"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsRaster ? PostGISジオメトリをPostGISラスタに変換します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_AsRaster</b>(</code>geometry  <var class="pdparam">geom</var>, raster  <var class="pdparam">ref</var>, text  <var class="pdparam">pixeltype</var>, double precision  <var class="pdparam">value=1</var>, double precision  <var class="pdparam">nodataval=0</var>, boolean  <var class="pdparam">touched=false</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_AsRaster</b>(</code>geometry  <var class="pdparam">geom</var>, raster  <var class="pdparam">ref</var>, text[]  <var class="pdparam">pixeltype=ARRAY['8BUI']</var>, double precision[]  <var class="pdparam">value=ARRAY[1]</var>, double precision[]  <var class="pdparam">nodataval=ARRAY[0]</var>, boolean  <var class="pdparam">touched=false</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_AsRaster</b>(</code>geometry  <var class="pdparam">geom</var>, double precision  <var class="pdparam">scalex</var>, double precision  <var class="pdparam">scaley</var>, double precision  <var class="pdparam">gridx</var>, double precision  <var class="pdparam">gridy</var>, text  <var class="pdparam">pixeltype</var>, double precision  <var class="pdparam">value=1</var>, double precision  <var class="pdparam">nodataval=0</var>, double precision  <var class="pdparam">skewx=0</var>, double precision  <var class="pdparam">skewy=0</var>, boolean  <var class="pdparam">touched=false</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_AsRaster</b>(</code>geometry  <var class="pdparam">geom</var>, double precision  <var class="pdparam">scalex</var>, double precision  <var class="pdparam">scaley</var>, double precision  <var class="pdparam">gridx=NULL</var>, double precision  <var class="pdparam">gridy=NULL</var>, text[]  <var class="pdparam">pixeltype=ARRAY['8BUI']</var>, double precision[]  <var class="pdparam">value=ARRAY[1]</var>, double precision[]  <var class="pdparam">nodataval=ARRAY[0]</var>, double precision  <var class="pdparam">skewx=0</var>, double precision  <var class="pdparam">skewy=0</var>, boolean  <var class="pdparam">touched=false</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_AsRaster</b>(</code>geometry  <var class="pdparam">geom</var>, double precision  <var class="pdparam">scalex</var>, double precision  <var class="pdparam">scaley</var>, text  <var class="pdparam">pixeltype</var>, double precision  <var class="pdparam">value=1</var>, double precision  <var class="pdparam">nodataval=0</var>, double precision  <var class="pdparam">upperleftx=NULL</var>, double precision  <var class="pdparam">upperlefty=NULL</var>, double precision  <var class="pdparam">skewx=0</var>, double precision  <var class="pdparam">skewy=0</var>, boolean  <var class="pdparam">touched=false</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_AsRaster</b>(</code>geometry  <var class="pdparam">geom</var>, double precision  <var class="pdparam">scalex</var>, double precision  <var class="pdparam">scaley</var>, text[]  <var class="pdparam">pixeltype</var>, double precision[]  <var class="pdparam">value=ARRAY[1]</var>, double precision[]  <var class="pdparam">nodataval=ARRAY[0]</var>, double precision  <var class="pdparam">upperleftx=NULL</var>, double precision  <var class="pdparam">upperlefty=NULL</var>, double precision  <var class="pdparam">skewx=0</var>, double precision  <var class="pdparam">skewy=0</var>, boolean  <var class="pdparam">touched=false</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_AsRaster</b>(</code>geometry  <var class="pdparam">geom</var>, integer  <var class="pdparam">width</var>, integer  <var class="pdparam">height</var>, double precision  <var class="pdparam">gridx</var>, double precision  <var class="pdparam">gridy</var>, text  <var class="pdparam">pixeltype</var>, double precision  <var class="pdparam">value=1</var>, double precision  <var class="pdparam">nodataval=0</var>, double precision  <var class="pdparam">skewx=0</var>, double precision  <var class="pdparam">skewy=0</var>, boolean  <var class="pdparam">touched=false</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_AsRaster</b>(</code>geometry  <var class="pdparam">geom</var>, integer  <var class="pdparam">width</var>, integer  <var class="pdparam">height</var>, double precision  <var class="pdparam">gridx=NULL</var>, double precision  <var class="pdparam">gridy=NULL</var>, text[]  <var class="pdparam">pixeltype=ARRAY['8BUI']</var>, double precision[]  <var class="pdparam">value=ARRAY[1]</var>, double precision[]  <var class="pdparam">nodataval=ARRAY[0]</var>, double precision  <var class="pdparam">skewx=0</var>, double precision  <var class="pdparam">skewy=0</var>, boolean  <var class="pdparam">touched=false</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_AsRaster</b>(</code>geometry  <var class="pdparam">geom</var>, integer  <var class="pdparam">width</var>, integer  <var class="pdparam">height</var>, text  <var class="pdparam">pixeltype</var>, double precision  <var class="pdparam">value=1</var>, double precision  <var class="pdparam">nodataval=0</var>, double precision  <var class="pdparam">upperleftx=NULL</var>, double precision  <var class="pdparam">upperlefty=NULL</var>, double precision  <var class="pdparam">skewx=0</var>, double precision  <var class="pdparam">skewy=0</var>, boolean  <var class="pdparam">touched=false</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_AsRaster</b>(</code>geometry  <var class="pdparam">geom</var>, integer  <var class="pdparam">width</var>, integer  <var class="pdparam">height</var>, text[]  <var class="pdparam">pixeltype</var>, double precision[]  <var class="pdparam">value=ARRAY[1]</var>, double precision[]  <var class="pdparam">nodataval=ARRAY[0]</var>, double precision  <var class="pdparam">upperleftx=NULL</var>, double precision  <var class="pdparam">upperlefty=NULL</var>, double precision  <var class="pdparam">skewx=0</var>, double precision  <var class="pdparam">skewy=0</var>, boolean  <var class="pdparam">touched=false</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287132808"></a><h2>説明</h2><p>PostGISジオメトリをPostGISラスタに変換します。多数の形式がありますが、結果ラスタのアラインメントとピクセルサイズを設定する3つの考えられる類型に分かれます。</p><p>ひとつめの群は、最初の2形式です。
アラインメント(<code class="varname">scalex</code>, <code class="varname">scaley</code>, <code class="varname">gridx</code>, <code class="varname">gridy</code>)、ピクセルタイプ、nodata値が提供される参照ラスタと同じラスタを生成します。一般的にこの参照ラスタは、ジオメトリを含むテーブルを参照ラスタを含むテーブルに結合して渡します。</p><p>ふたつめの群は、4形式あります。ピクセルサイズ(<code class="varname">scalex</code> &amp; <code class="varname">scaley</code> と <code class="varname">skewx</code> &amp; <code class="varname">skewy</code>)の引数を渡してラスタのピクセル範囲を設定します。結果ラスタの<code class="varname">width</code> &amp; <code class="varname">height</code>はジオメトリの範囲にあわせて調整されます。ほとんどの場合、PostgreSQLが正しい形式を選択するために、<code class="varname">scalex</code> &amp; <code class="varname">scaley</code>の整数引数を倍精度浮動小数点数にキャストしなければなりません。</p><p>みっつめの群は、4形式あります。ラスタのピクセル範囲(<code class="varname">width</code> &amp; <code class="varname">height</code>)を渡してラスタのピクセル範囲を固定するものです。結果ラスタのピクセルサイズパラメタは(<code class="varname">scalex</code> &amp; <code class="varname">scaley</code> と <code class="varname">skewx</code> &amp; <code class="varname">skewy</code>)ジオメトリの範囲にあわせて調整されます。</p><p>これら後半2グループの、グループ前半2形式は、アラインメントグリッド(<code class="varname">gridx</code> &amp; <code class="varname">gridy</code>)の適切な角でアラインメントを特定します。グループ後半2形式は左上角(<code class="varname">upperleftx</code> &amp; <code class="varname">upperlefty</code>)を取ります。</p><p>
これらの群のそれぞれによって、1バンドまたは複数バンドのラスタを生成することができます。複数バンドのラスタを生成するには、ピクセルタイプ配列(<code class="varname">pixeltype[]</code>)、初期値配列(<code class="varname">value</code>)、nodata値配列(<code class="varname">nodataval</code>)を渡す必要があります。ピクセルタイプが渡されていない場合には、デフォルトは8BUIになり、初期値については1、nodata値については0になります。</p><p>出力ラスタは元のジオメトリと同じ空間参照系になります。参照ラスタを使う形式は例外で、結果ラスタは参照ラスタと同じSRIDになります。</p><p>任意引数<code class="varname">touched</code>はデフォルトではfalseになります。GDALのALL_TOUCHEDラスタ化オプションに相当し、ラインまたはポリゴンに接触するピクセルが描画されます。ライン上または中心点がポリゴン内部にあるピクセルが描画されます。</p><p>これは特にジオメトリをデータベースから<a class="xref" href="#RT_ST_AsPNG" title="ST_AsPNG">ST_AsPNG</a>や<a class="xref" href="#RT_ST_AsGDALRaster" title="ST_AsGDALRaster">ST_AsGDALRaster</a>系の関数を併用して直接JPEGやPNGに描画する際に使います。</p><p>初出: 2.0.0 - GDAL 1.6.0以上が必要です。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>曲線、TIN、多面体サーフェス等の複雑なジオメトリタイプの描画ができませんが、GDALができることならできるはずです。</p></td></tr></table></div></div><div class="refsection" title="例: Output geometries as PNG files"><a name="id287132978"></a><h2>例: Output geometries as PNG files</h2><div class="informalfigure"><div class="mediaobject"><img src="images/st_asraster01.png"><div class="caption"><p>黒い円</p></div></div></div><pre class="programlisting">
-- 150x150ピクセルを占める黒い円を出力します --
SELECT ST_AsPNG(ST_AsRaster(ST_Buffer(ST_Point(1,5),10),150, 150, '2BUI'));</pre><div class="informalfigure"><div class="mediaobject"><img src="images/st_asraster02.png"><div class="caption"><p>PostGISだけで描画したバッファの例</p></div></div></div><pre class="programlisting">-- RGBバンド (118,154,118) - 鴨の羽色 にマップします --
SELECT ST_AsPNG(
	ST_AsRaster(
		ST_Buffer(
			ST_GeomFromText('LINESTRING(50 50,150 150,150 50)'), 10,'join=bevel'), 
			200,200,ARRAY['8BUI', '8BUI', '8BUI'], ARRAY[118,154,118], ARRAY[0,0,0]));</pre></div><div class="refsection" title="関連情報"><a name="id287133034"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_BandPixelType" title="ST_BandPixelType">ST_BandPixelType</a>, <a class="xref" href="#ST_Buffer" title="ST_Buffer">ST_Buffer</a>, <a class="xref" href="#RT_ST_GDALDrivers" title="ST_GDALDrivers">ST_GDALDrivers</a>, <a class="xref" href="#RT_ST_AsGDALRaster" title="ST_AsGDALRaster">ST_AsGDALRaster</a>, <a class="xref" href="#RT_ST_AsPNG" title="ST_AsPNG">ST_AsPNG</a>, <a class="xref" href="#RT_ST_AsJPEG" title="ST_AsJPEG">ST_AsJPEG</a>, <a class="xref" href="#RT_ST_SRID" title="ST_SRID">ST_SRID</a></p></div></div><div class="refentry" title="ST_Band"><div class="refentry.separator"><hr></div><a name="RT_ST_Band"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Band ? 既存のラスタの1つ以上のバンドを新しいラスタとして返します。既存のラスタから新しいラスタを構築する際に使います。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_Band</b>(</code>raster  <var class="pdparam">rast</var>, integer[]  <var class="pdparam">nbands = ARRAY[1]</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Band</b>(</code>raster  <var class="pdparam">rast</var>, text  <var class="pdparam">nbands</var>, character  <var class="pdparam">delimiter=,</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Band</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287133177"></a><h2>説明</h2><p>既存のラスタの1つ以上のバンドを新しいラスタとして返します。既存ラスタから新しいラスタを構築したり、ラスタの選択したバンドのみを出力する際に使います。バンドが指定されない場合には、1番バンドのみと仮定します。バンド削除等の様々な関数を補助する関数として使われています。</p><p>初出: 2.0.0</p></div><div class="refsection" title="例"><a name="id287133190"></a><h2>例</h2><pre class="programlisting">-- 2つの新しいラスタを生成します
-- 1-ダミーラスタの1番バンド
-- 2-ダミーラスタの3番バンドを生成して2BUIで再分類
SELECT ST_NumBands(rast1) As numb1, ST_BandPixelType(rast1) As pix1, 
 ST_NumBands(rast2) As numb2,  ST_BandPixelType(rast2) As pix2
FROM (
    SELECT ST_Band(rast) As rast1, ST_Reclass(ST_Band(rast,3), '100-200):1, [200-254:2', '2BUI') As rast2
        FROM dummy_rast
        WHERE rid = 2) As foo;
        
 numb1 | pix1 | numb2 | pix2
-------+------+-------+------
     1 | 8BUI |     1 | 2BUI
					</pre><pre class="programlisting">-- バンドの指定に文字列を使って2番と3番バンドを返します
SELECT ST_NumBands(ST_Band(rast, '2,3')) As num_bands
    FROM dummy_rast WHERE rid=2;
    
num_bands
----------
2
    
-- バンドの指定に配列を使って2番と3番バンドを返します
SELECT ST_NumBands(ST_Band(rast, ARRAY[2,3])) As num_bands
    FROM dummy_rast 
WHERE rid=2;
					</pre><div class="informaltable"><table border="1"><colgroup><col><col><col></colgroup><tbody><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_band01.png"><div class="caption"><p>元画像 (rastカラム)</p></div></div></div>
		 </td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_band02.png"><div class="caption"><p>dupe_band</p></div></div></div>
		 </td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_band03.png"><div class="caption"><p>sing_band</p></div></div></div>
		 </td></tr></tbody></table></div><pre class="programlisting">-- 元画像の2番バンドと1番バンドを2回繰り返したラスタと
-- 3番バンドだけのラスタの生成
Make a new raster with 2nd band of original and 1st band repeated twice,
and another with just the third band
SELECT rast, ST_Band(rast, ARRAY[2,1,1]) As dupe_band,  
	ST_Band(rast, 3) As sing_band 
FROM samples.than_chunked 
WHERE rid=35;							
					</pre></div><div class="refsection" title="関連情報"><a name="id287133323"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_AddBand" title="ST_AddBand">ST_AddBand</a>, <a class="xref" href="#RT_ST_NumBands" title="ST_NumBands">ST_NumBands</a>, <a class="xref" href="#RT_ST_Reclass" title="ST_Reclass">ST_Reclass</a></p></div></div><div class="refentry" title="ST_MakeEmptyRaster"><div class="refentry.separator"><hr></div><a name="RT_ST_MakeEmptyRaster"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MakeEmptyRaster ? 与えられたピクセル範囲(width, height)、左上のX,Y、ピクセルサイズ、回転(scalex, scaley, skewx, skewy)と空間参照系(SRID)が指定された空ラスタ(バンドを持たないラスタ)を返します。ラスタが渡されると、新しいラスタは渡されたラスタと同じサイズ、アラインメント、SRIDになります。SRIDが指定されていない場合には、空間参照系は不明(0)とされます。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_MakeEmptyRaster</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_MakeEmptyRaster</b>(</code>integer  <var class="pdparam">width</var>, integer  <var class="pdparam">height</var>, float8  <var class="pdparam">upperleftx</var>, float8  <var class="pdparam">upperlefty</var>, float8  <var class="pdparam">scalex</var>, float8  <var class="pdparam">scaley</var>, float8  <var class="pdparam">skewx</var>, float8  <var class="pdparam">skewy</var>, integer  <var class="pdparam">srid=unknown</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_MakeEmptyRaster</b>(</code>integer  <var class="pdparam">width</var>, integer  <var class="pdparam">height</var>, float8   <var class="pdparam">upperleftx</var>, float8   <var class="pdparam">upperlefty</var>, float8   <var class="pdparam">pixelsize</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287133521"></a><h2>説明</h2><p>与えられたピクセル範囲(width, height)と、左上のX,Y、ピクセルサイズ、回転(scalex, scaley, skewx, skewy)と空間参照系(SRID)を持つ、空間(または世界)内の地理参照が取られた座標系とを持つ空ラスタが返ります。</p><p>最後の形式では、ピクセルサイズを1つの引数(pixelsize)で指定しています。scalexはこの引数に、scaleyは引数の正負逆の数に、それぞれ設定され、skewxとskewyは0に設定されます。</p><p>既存のラスタを渡すと、同じメタデータ設定(バンド以外)を持つ新しいラスタが返ります。</p><p>SRIDが設定されていない場合には、デフォルトは0です。空ラスタを生成した後に、バンドを追加や編集を行うことになります。<a class="xref" href="#RT_ST_AddBand" title="ST_AddBand">ST_AddBand</a>でバンドを定義し、<a class="xref" href="#RT_ST_SetValue" title="ST_SetValue">ST_SetValue</a>で初期ピクセル値を設定します。</p></div><div class="refsection" title="例"><a name="id287133582"></a><h2>例</h2><pre class="programlisting">
INSERT INTO dummy_rast(rid,rast)
VALUES(3, ST_MakeEmptyRaster( 100, 100, 0.0005, 0.0005, 1, 1, 0, 0, 4326) );

-- 既存のラスタをテンプレートに使って新しいラスタを生成
INSERT INTO dummy_rast(rid,rast)
SELECT 4, ST_MakeEmptyRaster(rast)
FROM dummy_rast WHERE rid = 3;

-- 既存ラスタと生成したラスタのメタデータを出力
SELECT rid, (md).*
FROM (SELECT rid, ST_MetaData(rast) As md 
	FROM dummy_rast
	WHERE rid IN(3,4)) As foo;
	
-- output --
 rid | upperleftx | upperlefty | width | height | scalex | scaley | skewx | skewy | srid | numbands
-----+------------+------------+-------+--------+------------+------------+-------+-------+------+----------
   3 |     0.0005 |     0.0005 |   100 |    100 |          1 |          1 |    0  |     0 | 4326 |        0
   4 |     0.0005 |     0.0005 |   100 |    100 |          1 |          1 |    0  |     0 | 4326 |        0
				</pre></div><div class="refsection" title="関連情報"><a name="id287133593"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_AddBand" title="ST_AddBand">ST_AddBand</a>, <a class="xref" href="#RT_ST_MetaData" title="ST_MetaData">ST_MetaData</a>, <a class="xref" href="#RT_ST_ScaleX" title="ST_ScaleX">ST_ScaleX</a>, <a class="xref" href="#RT_ST_ScaleY" title="ST_ScaleY">ST_ScaleY</a>, <a class="xref" href="#RT_ST_SetValue" title="ST_SetValue">ST_SetValue</a>, <a class="xref" href="#RT_ST_SkewX" title="ST_SkewX">ST_SkewX</a>, , <a class="xref" href="#RT_ST_SkewY" title="ST_SkewY">ST_SkewY</a></p></div></div></div><div class="sect1" title="9.4. ラスタ アクセサ"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Raster_Accessors"></a>9.4. ラスタ アクセサ</h2></div></div></div><div class="toc"><dl><dt><span class="refentrytitle"><a href="#RT_ST_GeoReference">ST_GeoReference</a></span><span class="refpurpose"> ? 一般的にワールドファイルでみられるGDALまたはESRI書式の地理参照メタデータを返します。デフォルトはGDALです。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Height">ST_Height</a></span><span class="refpurpose"> ? ラスタの高さをピクセル単位で返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_MetaData">ST_MetaData</a></span><span class="refpurpose"> ? ピクセルサイズ、回転(skew)、左上隅位置等のラスタオブジェクトに関する基本的なメタデータを返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_NumBands">ST_NumBands</a></span><span class="refpurpose"> ? ラスタオブジェクトのバンド数を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_PixelHeight">ST_PixelHeight</a></span><span class="refpurpose"> ? 空間参照系の単位での地理的なピクセルの高さを返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_PixelWidth">ST_PixelWidth</a></span><span class="refpurpose"> ? 空間参照系の単位での地理的なピクセルの幅を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_ScaleX">ST_ScaleX</a></span><span class="refpurpose"> ? 空間参照系の単位での地理的なピクセル幅のX成分を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_ScaleY">ST_ScaleY</a></span><span class="refpurpose"> ? 空間参照系の単位での地理的なピクセルの高さのY成分を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Raster2WorldCoordX">ST_Raster2WorldCoordX</a></span><span class="refpurpose"> ? ラスタの指定した列と行における左上隅の地理座標X値を返します。列と行の番号は1始まりです。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Raster2WorldCoordY">ST_Raster2WorldCoordY</a></span><span class="refpurpose"> ? ラスタの指定した列と行における左上隅の地理座標Y値を返します。列と行の番号は1始まりです。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Rotation">ST_Rotation</a></span><span class="refpurpose"> ? ラスタの回転をラジアンで返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_SkewX">ST_SkewX</a></span><span class="refpurpose"> ? 空間参照のXスキュー(回転パラメータ)を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_SkewY">ST_SkewY</a></span><span class="refpurpose"> ? 空間参照のYスキュー(回転パラメータ)を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_SRID">ST_SRID</a></span><span class="refpurpose"> ? ラスタのspatial_ref_sysテーブルで定義されている空間参照系識別番号を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_UpperLeftX">ST_UpperLeftX</a></span><span class="refpurpose"> ? 適用されている空間参照系でのラスタの左上隅のX座標値を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_UpperLeftY">ST_UpperLeftY</a></span><span class="refpurpose"> ? 適用されている空間参照系でのラスタの左上隅のY座標値を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Width">ST_Width</a></span><span class="refpurpose"> ? ラスタの幅をピクセル単位で返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_World2RasterCoordX">ST_World2RasterCoordX</a></span><span class="refpurpose"> ? ラスタのワールド空間参照系に基づくポイントジオメトリ(pt)またはX,Y座標値(xw,yw)に対応するラスタの列を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_World2RasterCoordY">ST_World2RasterCoordY</a></span><span class="refpurpose"> ? ラスタのワールド空間参照系に基づくポイントジオメトリ(pt)またはX,Y座標値(xw,yw)に対応するラスタの行を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_IsEmpty">ST_IsEmpty</a></span><span class="refpurpose"> ? ラスタが空(width = 0かつheight = 0)の場合にはTRUEを返します。他の場合にはFALSEを返します。</span></dt></dl></div><div class="refentry" title="ST_GeoReference"><a name="RT_ST_GeoReference"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_GeoReference ? 一般的にワールドファイルでみられるGDALまたはESRI書式の地理参照メタデータを返します。デフォルトはGDALです。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_GeoReference</b>(</code>raster  <var class="pdparam">rast</var>, text  <var class="pdparam">format=GDAL</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287133714"></a><h2>説明</h2><p>一般的に<a class="ulink" href="http://en.wikipedia.org/wiki/World_file" target="_top">world file</a>(英語版 WikiPedia)でみられるGDALまたはESRI書式の地理参照メタデータを返します。書式を指定しない場合には、デフォルトはGDALです。typeは文字列で'GDAL'または'ESRI'とします。</p><p>書式の表現の違うは次の通りです。</p><p><code class="varname">GDAL</code>: 
</p><pre class="programlisting">scalex 
skewy 
skewx
scaley
upperleftx
upperlefty</pre><p><code class="varname">ESRI</code>: 
</p><pre class="programlisting">scalex 
skewy 
skewx
scaley
upperleftx + scalex*0.5
upperlefty + scaley*0.5</pre></div><div class="refsection" title="例"><a name="id287133749"></a><h2>例</h2><pre class="programlisting">SELECT ST_GeoReference(rast, 'ESRI') As esri_ref, ST_GeoReference(rast, 'GDAL') As gdal_ref
 FROM dummy_rast WHERE rid=1;

   esri_ref   |   gdal_ref
--------------+--------------
 2.0000000000 | 2.0000000000
 0.0000000000 : 0.0000000000
 0.0000000000 : 0.0000000000
 3.0000000000 : 3.0000000000
 1.5000000000 : 0.5000000000
 2.0000000000 : 0.5000000000
				</pre></div><div class="refsection" title="関連情報"><a name="id287133760"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_SetGeoReference" title="ST_SetGeoReference">ST_SetGeoReference</a>, <a class="xref" href="#RT_ST_ScaleX" title="ST_ScaleX">ST_ScaleX</a>, <a class="xref" href="#RT_ST_ScaleY" title="ST_ScaleY">ST_ScaleY</a></p></div></div><div class="refentry" title="ST_Height"><div class="refentry.separator"><hr></div><a name="RT_ST_Height"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Height ? ラスタの高さをピクセル単位で返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_Height</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287133884"></a><h2>説明</h2><p>ラスタの高さを返します。</p></div><div class="refsection" title="例"><a name="id287133894"></a><h2>例</h2><pre class="programlisting">SELECT rid, ST_Height(rast) As rastheight
FROM dummy_rast;

 rid | rastheight
-----+------------
   1 |         20
   2 |          5
				</pre></div><div class="refsection" title="関連情報"><a name="id287133905"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Width" title="ST_Width">ST_Width</a></p></div></div><div class="refentry" title="ST_MetaData"><div class="refentry.separator"><hr></div><a name="RT_ST_MetaData"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MetaData ? ピクセルサイズ、回転(skew)、左上隅位置等のラスタオブジェクトに関する基本的なメタデータを返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">record <b class="fsfunc">ST_MetaData</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287133955"></a><h2>説明</h2><p>ピクセルサイズ、回転(skew)、左上隅位置等のラスタオブジェクトに関する基本的なメタデータを返します。返されるカラムは upperleftx | upperlefty | width | height | scalex | scaley | skewx | skewy | srid | numbands です。</p></div><div class="refsection" title="例"><a name="id287133964"></a><h2>例</h2><pre class="programlisting">SELECT rid, (foo.md).*  
 FROM (SELECT rid, ST_MetaData(rast) As md
FROM dummy_rast) As foo;

 rid | upperleftx | upperlefty | width | height | scalex | scaley | skewx | skewy | srid | numbands
 ----+------------+------------+-------+--------+--------+-----------+-------+-------+------+-------
   1 |        0.5 |        0.5 |    10 |     20 |      2 |      3 |		0 |     0 |    0 |        0
   2 | 3427927.75 |    5793244 |     5 |      5 |   0.05 |  -0.05 |		0 |     0 |    0 |        3
				</pre></div><div class="refsection" title="関連情報"><a name="id287133977"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_BandMetaData" title="ST_BandMetaData">ST_BandMetaData</a>, <a class="xref" href="#RT_ST_NumBands" title="ST_NumBands">ST_NumBands</a></p></div></div><div class="refentry" title="ST_NumBands"><div class="refentry.separator"><hr></div><a name="RT_ST_NumBands"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_NumBands ? ラスタオブジェクトのバンド数を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_NumBands</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287134030"></a><h2>説明</h2><p>ラスタオブジェクトのバンド数を返します。</p></div><div class="refsection" title="例"><a name="id287134040"></a><h2>例</h2><pre class="programlisting">SELECT rid, ST_NumBands(rast) As numbands
FROM dummy_rast;

rid | numbands
----+----------
  1 |        0
  2 |        3
				</pre></div><div class="refsection" title="関連情報"><a name="id287134054"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Value" title="ST_Value">ST_Value</a></p></div></div><div class="refentry" title="ST_PixelHeight"><div class="refentry.separator"><hr></div><a name="RT_ST_PixelHeight"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_PixelHeight ? 空間参照系の単位での地理的なピクセルの高さを返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">double precision <b class="fsfunc">ST_PixelHeight</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287134104"></a><h2>説明</h2><p>空間参照系の単位での地理的なピクセルの高さを返します。回転が無い一般的な状況では、ピクセル高は地理座標とラスタピクセルのスケール率です。</p><p>図示した関係については<a class="xref" href="#RT_ST_PixelWidth" title="ST_PixelWidth">ST_PixelWidth</a>を参照して下さい。</p></div><div class="refsection" title="例: 回転の無いラスタ"><a name="id287134120"></a><h2>例: 回転の無いラスタ</h2><pre class="programlisting">SELECT ST_Height(rast) As rastheight, ST_PixelHeight(rast) As pixheight,
 ST_ScaleX(rast) As scalex, ST_ScaleY(rast) As scaley, ST_SkewX(rast) As skewx,
        ST_SkewY(rast) As skewy
FROM dummy_rast;

 rastheight | pixheight | scalex | scaley | skewx | skewy
------------+-----------+--------+--------+-------+----------
         20 |         3 |      2 |      3 |     0 |        0
          5 |      0.05 |   0.05 |  -0.05 |     0 |        0
			</pre></div><div class="refsection" title="例: 回転が0でないラスタ"><a name="id287134131"></a><h2>例: 回転が0でないラスタ</h2><pre class="programlisting">SELECT ST_Height(rast) As rastheight, ST_PixelHeight(rast) As pixheight,
 ST_ScaleX(rast) As scalex, ST_ScaleY(rast) As scaley, ST_SkewX(rast) As skewx,
        ST_SkewY(rast) As skewy
FROM (SELECT ST_SetSKew(rast,0.5,0.5) As rast
        FROM dummy_rast) As skewed;

rastheight |     pixheight     | scalex | scaley | skewx | skewy
-----------+-------------------+--------+--------+-------+----------
        20 |  3.04138126514911 |      2 |      3 |   0.5 |      0.5
         5 | 0.502493781056044 |   0.05 |  -0.05 |   0.5 |      0.5
			</pre></div><div class="refsection" title="関連情報"><a name="id287134179"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_PixelWidth" title="ST_PixelWidth">ST_PixelWidth</a>, <a class="xref" href="#RT_ST_ScaleX" title="ST_ScaleX">ST_ScaleX</a>, <a class="xref" href="#RT_ST_ScaleY" title="ST_ScaleY">ST_ScaleY</a>, <a class="xref" href="#RT_ST_SkewX" title="ST_SkewX">ST_SkewX</a>, 
			<a class="xref" href="#RT_ST_SkewY" title="ST_SkewY">ST_SkewY</a></p></div></div><div class="refentry" title="ST_PixelWidth"><div class="refentry.separator"><hr></div><a name="RT_ST_PixelWidth"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_PixelWidth ? 空間参照系の単位での地理的なピクセルの幅を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">double precision <b class="fsfunc">ST_PixelWidth</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287134241"></a><h2>説明</h2><p>空間参照系の単位での地理的なピクセルの幅を返します。回転が無い一般的な状況では、ピクセル幅は地理座標とラスタピクセルのスケール率です。</p><p>関係について次の図に示します。</p><p>
			</p><div class="informalfigure"><div class="mediaobject"><img src="images/raster_xscale_yscale_xskew_yskew.png"><div class="caption"><p>ピクセル幅: i方向のピクセルサイズ</p><p>ピクセル高: j方向のピクセルサイズ</p></div></div></div><p>
			</p></div><div class="refsection" title="例: 回転の無いラスタ"><a name="id287134278"></a><h2>例: 回転の無いラスタ</h2><pre class="programlisting">SELECT ST_Width(rast) As rastwidth, ST_PixelWidth(rast) As pixwidth,
	ST_ScaleX(rast) As scalex, ST_ScaleY(rast) As scaley, ST_SkewX(rast) As skewx,
	ST_SkewY(rast) As skewy
	FROM dummy_rast;
	
	rastwidth | pixwidth | scalex | scaley | skewx | skewy
	-----------+----------+--------+--------+-------+----------
	10 |        2 |      2 |      3 |     0 |        0
	 5 |     0.05 |   0.05 |  -0.05 |     0 |        0
		</pre></div><div class="refsection" title="例: 回転が0でないラスタ"><a name="id287134289"></a><h2>例: 回転が0でないラスタ</h2><pre class="programlisting">SELECT ST_Width(rast) As rastwidth, ST_PixelWidth(rast) As pixwidth,
	ST_ScaleX(rast) As scalex, ST_ScaleY(rast) As scaley, ST_SkewX(rast) As skewx,
	ST_SkewY(rast) As skewy
	FROM (SELECT ST_SetSkew(rast,0.5,0.5) As rast
	FROM dummy_rast) As skewed;
	
	rastwidth |     pixwidth      | scalex | scaley | skewx | skewy
	-----------+-------------------+--------+--------+-------+----------
	10 |  2.06155281280883 |      2 |      3 |   0.5 |      0.5
	 5 | 0.502493781056044 |   0.05 |  -0.05 |   0.5 |      0.5
		</pre></div><div class="refsection" title="関連情報"><a name="id287134301"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_PixelHeight" title="ST_PixelHeight">ST_PixelHeight</a>, <a class="xref" href="#RT_ST_ScaleX" title="ST_ScaleX">ST_ScaleX</a>, <a class="xref" href="#RT_ST_ScaleY" title="ST_ScaleY">ST_ScaleY</a>, <a class="xref" href="#RT_ST_SkewX" title="ST_SkewX">ST_SkewX</a>, <a class="xref" href="#RT_ST_SkewY" title="ST_SkewY">ST_SkewY</a></p></div></div><div class="refentry" title="ST_ScaleX"><div class="refentry.separator"><hr></div><a name="RT_ST_ScaleX"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ScaleX ? 空間参照系の単位での地理的なピクセル幅のX成分を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float8 <b class="fsfunc">ST_ScaleX</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287134364"></a><h2>説明</h2><p>空間参照系の単位での地理的なピクセル幅のX成分を返します。詳細については<a class="ulink" href="http://en.wikipedia.org/wiki/World_file" target="_top">World File</a>(英語版 WikiPedia)をご覧ください。</p><p>変更: 2.0.0. WKTRaster版ではST_PixelSizeXと呼ばれていました。</p></div><div class="refsection" title="例"><a name="id287134417"></a><h2>例</h2><pre class="programlisting">SELECT rid, ST_ScaleX(rast) As rastpixwidth
FROM dummy_rast;

 rid | rastpixwidth
-----+--------------
   1 |            2
   2 |         0.05
				</pre></div><div class="refsection" title="関連情報"><a name="id287134429"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Width" title="ST_Width">ST_Width</a></p></div></div><div class="refentry" title="ST_ScaleY"><div class="refentry.separator"><hr></div><a name="RT_ST_ScaleY"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ScaleY ? 空間参照系の単位での地理的なピクセルの高さのY成分を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float8 <b class="fsfunc">ST_ScaleY</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287134478"></a><h2>説明</h2><p>空間参照系の単位での地理的なピクセル高のY成分を返します。詳細については<a class="ulink" href="http://en.wikipedia.org/wiki/World_file" target="_top">World File</a>(英語版 WikiPedia)をご覧ください。</p><p>変更: 2.0.0. In  WKTRaster版ではST_PixelSizeYと呼ばれていました。</p></div><div class="refsection" title="例"><a name="id287134497"></a><h2>例</h2><pre class="programlisting">SELECT rid, ST_ScaleY(rast) As rastpixheight
FROM dummy_rast;

 rid | rastpixheight
-----+---------------
   1 |             3
   2 |         -0.05
				</pre></div><div class="refsection" title="関連情報"><a name="id287134509"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Height" title="ST_Height">ST_Height</a></p></div></div><div class="refentry" title="ST_Raster2WorldCoordX"><div class="refentry.separator"><hr></div><a name="RT_ST_Raster2WorldCoordX"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Raster2WorldCoordX ? ラスタの指定した列と行における左上隅の地理座標X値を返します。列と行の番号は1始まりです。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float8 <b class="fsfunc">ST_Raster2WorldCoordX</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">xcolumn</var><code>)</code>;</p><p><code class="funcdef">float8 <b class="fsfunc">ST_Raster2WorldCoordX</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">xcolumn</var>, integer  <var class="pdparam">yrow</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287134603"></a><h2>説明</h2><p>ラスタの指定した列と行における左上隅の地理座標X値を返します。列と行の番号は1始まりです。負数またはラスタの列数を超える値を渡した場合には、回転とピクセルサイズが選択したラスタと同じであるという仮定のもとで、ラスタファイルから左または右にはずれた座標値を返します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>回転の無いラスタでは、X列を与えれば十分です。回転しているラスタの場合には、地理参照のとれた座標はST_ScaleXとST_SkewXおよび行と列の関数となります。回転しているラスタでX列のみ与えた場合にはエラーが発生します。</p></td></tr></table></div></div><div class="refsection" title="例"><a name="id287134618"></a><h2>例</h2><pre class="programlisting">
-- 回転の無いラスタでは列を与えれば十分です
		
SELECT rid, ST_Raster2WorldCoordX(rast,1) As x1coord, 
	ST_Raster2WorldCoordX(rast,2) As x2coord,
	ST_ScaleX(rast) As pixelx
FROM dummy_rast;

 rid |  x1coord   |  x2coord  | pixelx
-----+------------+-----------+--------
   1 |        0.5 |       2.5 |      2
   2 | 3427927.75 | 3427927.8 |   0.05
				</pre><pre class="programlisting">
-- 面白半分に回転させてみましょう
SELECT rid, ST_Raster2WorldCoordX(rast, 1, 1) As x1coord, 
	ST_Raster2WorldCoordX(rast, 2, 3) As x2coord,
	ST_ScaleX(rast) As pixelx
FROM (SELECT rid, ST_SetSkew(rast, 100.5, 0) As rast FROM dummy_rast) As foo;

 rid |  x1coord   |  x2coord  | pixelx
-----+------------+-----------+--------
   1 |        0.5 |     203.5 |      2
   2 | 3427927.75 | 3428128.8 |   0.05
				</pre></div><div class="refsection" title="関連情報"><a name="id287134635"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_ScaleX" title="ST_ScaleX">ST_ScaleX</a>, <a class="xref" href="#RT_ST_Raster2WorldCoordY" title="ST_Raster2WorldCoordY">ST_Raster2WorldCoordY</a>, <a class="xref" href="#RT_ST_SetSkew" title="ST_SetSkew">ST_SetSkew</a>, <a class="xref" href="#RT_ST_SkewX" title="ST_SkewX">ST_SkewX</a></p></div></div><div class="refentry" title="ST_Raster2WorldCoordY"><div class="refentry.separator"><hr></div><a name="RT_ST_Raster2WorldCoordY"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Raster2WorldCoordY ? ラスタの指定した列と行における左上隅の地理座標Y値を返します。列と行の番号は1始まりです。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float8 <b class="fsfunc">ST_Raster2WorldCoordY</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">yrow</var><code>)</code>;</p><p><code class="funcdef">float8 <b class="fsfunc">ST_Raster2WorldCoordY</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">xcolumn</var>, integer  <var class="pdparam">yrow</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287134739"></a><h2>説明</h2><p>ラスタの指定した列と行における左上隅の地理座標Y値を返します。列と行の番号は1始まりです。負数またはラスタの列/行数を超える値を渡した場合には、回転とピクセルサイズが選択したラスタと同じであるという仮定のもとで、ラスタファイルから左または右にはずれた座標値を返します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>回転の無いラスタでは、Y行を与えれば十分です。回転しているラスタの場合には、地理参照のとれた座標はST_ScaleYとST_SkewYおよび行と列の関数となります。回転しているラスタでY行のみ与えた場合にはエラーが発生します。</p></td></tr></table></div></div><div class="refsection" title="例"><a name="id287134753"></a><h2>例</h2><pre class="programlisting">
-- 回転の無いラスタでは行を与えれば十分です		
	
SELECT rid, ST_Raster2WorldCoordY(rast,1) As y1coord, 
	ST_Raster2WorldCoordY(rast,3) As y2coord,
	ST_ScaleY(rast) As pixely
FROM dummy_rast;

 rid | y1coord |  y2coord  | pixely
-----+---------+-----------+--------
   1 |     0.5 |       6.5 |      3
   2 | 5793244 | 5793243.9 |  -0.05
				</pre><pre class="programlisting">
-- 面白半分に回転させてみましょう
SELECT rid, ST_Raster2WorldCoordY(rast,1,1) As y1coord, 
	ST_Raster2WorldCoordY(rast,2,3) As y2coord,
	ST_ScaleY(rast) As pixely
FROM (SELECT rid, ST_SetSkew(rast,0,100.5) As rast FROM dummy_rast) As foo;

 rid | y1coord |  y2coord  | pixely
-----+---------+-----------+--------
   1 |     0.5 |       107 |      3
   2 | 5793244 | 5793344.4 |  -0.05
				</pre></div><div class="refsection" title="関連情報"><a name="id287134805"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_ScaleY" title="ST_ScaleY">ST_ScaleY</a>, <a class="xref" href="#RT_ST_Raster2WorldCoordX" title="ST_Raster2WorldCoordX">ST_Raster2WorldCoordX</a>, <a class="xref" href="#RT_ST_SetSkew" title="ST_SetSkew">ST_SetSkew</a>, <a class="xref" href="#RT_ST_SkewY" title="ST_SkewY">ST_SkewY</a></p></div></div><div class="refentry" title="ST_Rotation"><div class="refentry.separator"><hr></div><a name="RT_ST_Rotation"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Rotation ? ラスタの回転をラジアンで返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float8 <b class="fsfunc">ST_Rotation</b>(</code>raster <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287134865"></a><h2>説明</h2><p>ラスタの回転をラジアンで返します。ラスタが回転を持っていない場合には、NaNが返されます。詳細については<a class="ulink" href="http://en.wikipedia.org/wiki/World_file" target="_top">World File</a>を参照して下さい。</p></div><div class="refsection" title="例"><a name="id287134878"></a><h2>例</h2><pre class="programlisting">SELECT rid, ST_Rotation(ST_SetScale(ST_SetSkew(rast, sqrt(2)), sqrt(2))) as rot FROM dummy_rast;

 rid |        rot 
-----+-------------------
   1 | 0.785398163397448
   2 | 0.785398163397448
                </pre></div><div class="refsection" title="関連情報"><a name="id287134891"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_SetRotation" title="ST_SetRotation">ST_SetRotation</a>, <a class="xref" href="#RT_ST_SetScale" title="ST_SetScale">ST_SetScale</a>, <a class="xref" href="#RT_ST_SetSkew" title="ST_SetSkew">ST_SetSkew</a></p></div></div><div class="refentry" title="ST_SkewX"><div class="refentry.separator"><hr></div><a name="RT_ST_SkewX"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SkewX ? 空間参照のXスキュー(回転パラメータ)を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float8 <b class="fsfunc">ST_SkewX</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287134948"></a><h2>説明</h2><p>空間参照のXスキュー(回転パラメータ)を返します。詳細については<a class="ulink" href="http://en.wikipedia.org/wiki/World_file" target="_top">World File</a>を参照して下さい。</p></div><div class="refsection" title="例"><a name="id287134962"></a><h2>例</h2><pre class="programlisting">SELECT rid, ST_SkewX(rast) As skewx, ST_SkewY(rast) As skewy, 
    ST_GeoReference(rast) as georef
FROM dummy_rast;

 rid | skewx | skewy |       georef
-----+-------+-------+--------------------
   1 |     0 |     0 | 2.0000000000
                     : 0.0000000000
                     : 0.0000000000
                     : 3.0000000000
                     : 0.5000000000
                     : 0.5000000000
                     :
   2 |     0 |     0 | 0.0500000000
                     : 0.0000000000
                     : 0.0000000000
                     : -0.0500000000
                     : 3427927.7500000000
                     : 5793244.0000000000
				</pre></div><div class="refsection" title="関連情報"><a name="id287134974"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_GeoReference" title="ST_GeoReference">ST_GeoReference</a>, <a class="xref" href="#RT_ST_SkewY" title="ST_SkewY">ST_SkewY</a>, <a class="xref" href="#RT_ST_SetSkew" title="ST_SetSkew">ST_SetSkew</a></p></div></div><div class="refentry" title="ST_SkewY"><div class="refentry.separator"><hr></div><a name="RT_ST_SkewY"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SkewY ? 空間参照のYスキュー(回転パラメータ)を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float8 <b class="fsfunc">ST_SkewY</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287135031"></a><h2>説明</h2><p>空間参照のYスキュー(回転パラメータ)を返します。詳細については<a class="ulink" href="http://en.wikipedia.org/wiki/World_file" target="_top">World File</a>を参照して下さい。</p></div><div class="refsection" title="例"><a name="id287135045"></a><h2>例</h2><pre class="programlisting">SELECT rid, ST_SkewX(rast) As skewx, ST_SkewY(rast) As skewy, 
    ST_GeoReference(rast) as georef
FROM dummy_rast;

 rid | skewx | skewy |       georef
-----+-------+-------+--------------------
   1 |     0 |     0 | 2.0000000000
                     : 0.0000000000
                     : 0.0000000000
                     : 3.0000000000
                     : 0.5000000000
                     : 0.5000000000
                     :
   2 |     0 |     0 | 0.0500000000
                     : 0.0000000000
                     : 0.0000000000
                     : -0.0500000000
                     : 3427927.7500000000
                     : 5793244.0000000000
				</pre></div><div class="refsection" title="関連情報"><a name="id287135058"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_GeoReference" title="ST_GeoReference">ST_GeoReference</a>, <a class="xref" href="#RT_ST_SkewX" title="ST_SkewX">ST_SkewX</a>, <a class="xref" href="#RT_ST_SetSkew" title="ST_SetSkew">ST_SetSkew</a></p></div></div><div class="refentry" title="ST_SRID"><div class="refentry.separator"><hr></div><a name="RT_ST_SRID"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SRID ? ラスタのspatial_ref_sysテーブルで定義されている空間参照系識別番号を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_SRID</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287135353"></a><h2>説明</h2><p>ラスタのspatial_ref_sysテーブルで定義されている空間参照系識別番号を返します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>空間参照を持たないラスタ/ジオメトリのSRIDは、以前は-1でしたがPostGIS 2.0以上では0になります。</p></td></tr></table></div></div><div class="refsection" title="例"><a name="id287135367"></a><h2>例</h2><pre class="programlisting">SELECT ST_SRID(rast) As srid
FROM dummy_rast WHERE rid=1;

srid
----------------
0
				</pre></div><div class="refsection" title="関連情報"><a name="id287135381"></a><h2>関連情報</h2><p><a class="xref" href="#spatial_ref_sys" title="4.3.1. SPATIAL_REF_SYSテーブルと空間参照系">「SPATIAL_REF_SYSテーブルと空間参照系」</a>, <a class="xref" href="#ST_SRID" title="ST_SRID">ST_SRID</a></p></div></div><div class="refentry" title="ST_UpperLeftX"><div class="refentry.separator"><hr></div><a name="RT_ST_UpperLeftX"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_UpperLeftX ? 適用されている空間参照系でのラスタの左上隅のX座標値を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float8 <b class="fsfunc">ST_UpperLeftX</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287135433"></a><h2>説明</h2><p>適用されている空間参照系でのラスタの左上隅のX座標値を返します。</p></div><div class="refsection" title="例"><a name="id287135478"></a><h2>例</h2><pre class="programlisting">
SELECt rid, ST_UpperLeftX(rast) As ulx
FROM dummy_rast;

 rid |    ulx
-----+------------
   1 |        0.5
   2 | 3427927.75
				</pre></div><div class="refsection" title="関連情報"><a name="id287135489"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_UpperLeftY" title="ST_UpperLeftY">ST_UpperLeftY</a>, <a class="xref" href="#RT_ST_GeoReference" title="ST_GeoReference">ST_GeoReference</a>, <a class="xref" href="#RT_Box3D" title="Box3D">Box3D</a></p></div></div><div class="refentry" title="ST_UpperLeftY"><div class="refentry.separator"><hr></div><a name="RT_ST_UpperLeftY"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_UpperLeftY ? 適用されている空間参照系でのラスタの左上隅のY座標値を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float8 <b class="fsfunc">ST_UpperLeftY</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287135545"></a><h2>説明</h2><p>適用されている空間参照系でのラスタの左上隅のY座標値を返します。</p></div><div class="refsection" title="例"><a name="id287135555"></a><h2>例</h2><pre class="programlisting">
SELECT rid, ST_UpperLeftY(rast) As uly
FROM dummy_rast;

 rid |   uly
-----+---------
   1 |     0.5
   2 | 5793244
				</pre></div><div class="refsection" title="関連情報"><a name="id287135566"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_UpperLeftX" title="ST_UpperLeftX">ST_UpperLeftX</a>, <a class="xref" href="#RT_ST_GeoReference" title="ST_GeoReference">ST_GeoReference</a>, <a class="xref" href="#RT_Box3D" title="Box3D">Box3D</a></p></div></div><div class="refentry" title="ST_Width"><div class="refentry.separator"><hr></div><a name="RT_ST_Width"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Width ? ラスタの幅をピクセル単位で返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_Width</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287135623"></a><h2>説明</h2><p>ラスタの幅をピクセル単位で返します。</p></div><div class="refsection" title="例"><a name="id287135633"></a><h2>例</h2><pre class="programlisting">SELECT ST_Width(rast) As rastwidth
FROM dummy_rast WHERE rid=1;

rastwidth
----------------
10
				</pre></div><div class="refsection" title="関連情報"><a name="id287135645"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Height" title="ST_Height">ST_Height</a></p></div></div><div class="refentry" title="ST_World2RasterCoordX"><div class="refentry.separator"><hr></div><a name="RT_ST_World2RasterCoordX"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_World2RasterCoordX ? ラスタのワールド空間参照系に基づくポイントジオメトリ(pt)またはX,Y座標値(xw,yw)に対応するラスタの列を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_World2RasterCoordX</b>(</code>raster  <var class="pdparam">rast</var>, geometry  <var class="pdparam">pt</var><code>)</code>;</p><p><code class="funcdef">integer <b class="fsfunc">ST_World2RasterCoordX</b>(</code>raster  <var class="pdparam">rast</var>, double precision  <var class="pdparam">xw</var><code>)</code>;</p><p><code class="funcdef">integer <b class="fsfunc">ST_World2RasterCoordX</b>(</code>raster  <var class="pdparam">rast</var>, double precision  <var class="pdparam">xw</var>, double precision  <var class="pdparam">yw</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287135801"></a><h2>説明</h2><p>ラスタのワールド空間参照系に基づくポイントジオメトリ(pt)またはX,Y座標値(xw,yw)に対応するラスタの列を返します。ラスタが回転している場合には、ポイントまたはxwとywの両方が必要です。ラスタが回転していない場合には、xwを指定すれば十分です。ワールド座標系はラスタの空間参照系です。</p></div><div class="refsection" title="例"><a name="id287135811"></a><h2>例</h2><pre class="programlisting">SELECT rid, ST_World2RasterCoordX(rast,3427927.8) As xcoord, 
		ST_World2RasterCoordX(rast,3427927.8,20.5) As xcoord_xwyw, 
		ST_World2RasterCoordX(rast,ST_GeomFromText('POINT(3427927.8 20.5)',ST_SRID(rast))) As ptxcoord
FROM dummy_rast;

 rid | xcoord  |  xcoord_xwyw   | ptxcoord
-----+---------+---------+----------
   1 | 1713964 | 1713964 |  1713964
   2 |       1 |       1 |        1
				</pre></div><div class="refsection" title="関連情報"><a name="id287135824"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Raster2WorldCoordX" title="ST_Raster2WorldCoordX">ST_Raster2WorldCoordX</a>, <a class="xref" href="#RT_ST_Raster2WorldCoordY" title="ST_Raster2WorldCoordY">ST_Raster2WorldCoordY</a>, <a class="xref" href="#RT_ST_SRID" title="ST_SRID">ST_SRID</a></p></div></div><div class="refentry" title="ST_World2RasterCoordY"><div class="refentry.separator"><hr></div><a name="RT_ST_World2RasterCoordY"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_World2RasterCoordY ? ラスタのワールド空間参照系に基づくポイントジオメトリ(pt)またはX,Y座標値(xw,yw)に対応するラスタの行を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_World2RasterCoordY</b>(</code>raster  <var class="pdparam">rast</var>, geometry  <var class="pdparam">pt</var><code>)</code>;</p><p><code class="funcdef">integer <b class="fsfunc">ST_World2RasterCoordY</b>(</code>raster  <var class="pdparam">rast</var>, double precision  <var class="pdparam">xw</var><code>)</code>;</p><p><code class="funcdef">integer <b class="fsfunc">ST_World2RasterCoordY</b>(</code>raster  <var class="pdparam">rast</var>, double precision  <var class="pdparam">xw</var>, double precision  <var class="pdparam">yw</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287135986"></a><h2>説明</h2><p>ラスタのワールド空間参照系に基づくポイントジオメトリ(pt)またはX,Y座標値(xw,yw)に対応するラスタの行を返します。ラスタが回転している場合には、ポイントまたはxwとywの両方が必要です。ラスタが回転していない場合には、ywを指定すれば十分です。ワールド座標系はラスタの空間参照系です。</p></div><div class="refsection" title="例"><a name="id287135995"></a><h2>例</h2><pre class="programlisting">SELECT rid, ST_World2RasterCoordY(rast,20.5) As ycoord, 
		ST_World2RasterCoordY(rast,3427927.8,20.5) As ycoord_xwyw, 
		ST_World2RasterCoordY(rast,ST_GeomFromText('POINT(3427927.8 20.5)',ST_SRID(rast))) As ptycoord
FROM dummy_rast;

 rid |  ycoord   | ycoord_xwyw | ptycoord
-----+-----------+-------------+-----------
   1 |         7 |           7 |         7
   2 | 115864471 |   115864471 | 115864471
				</pre></div><div class="refsection" title="関連情報"><a name="id287136008"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Raster2WorldCoordX" title="ST_Raster2WorldCoordX">ST_Raster2WorldCoordX</a>, <a class="xref" href="#RT_ST_Raster2WorldCoordY" title="ST_Raster2WorldCoordY">ST_Raster2WorldCoordY</a>, <a class="xref" href="#RT_ST_SRID" title="ST_SRID">ST_SRID</a></p></div></div><div class="refentry" title="ST_IsEmpty"><div class="refentry.separator"><hr></div><a name="RT_ST_IsEmpty"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_IsEmpty ? ラスタが空(width = 0かつheight = 0)の場合にはTRUEを返します。他の場合にはFALSEを返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_IsEmpty</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287136066"></a><h2>説明</h2><p>ラスタが空(width = 0かつheight = 0)の場合にはTRUEを返します。他の場合にはFALSEを返します。</p></div><div class="refsection" title="例"><a name="id287136076"></a><h2>例</h2><pre class="programlisting">SELECT ST_IsEmpty(ST_MakeEmptyRaster(100, 100, 0, 0, 0, 0, 0, 0))
st_isempty |
-----------+
f          |
                       
                        
SELECT ST_IsEmpty(ST_MakeEmptyRaster(0, 0, 0, 0, 0, 0, 0, 0))
st_isempty |
-----------+
t          |

                </pre></div><div class="refsection" title="関連情報"><a name="id287136090"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_HasNoBand" title="ST_HasNoBand">ST_HasNoBand</a></p></div></div></div><div class="sect1" title="9.5. ラスタバンド アクセサ"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="RasterBand_Accessors"></a>9.5. ラスタバンド アクセサ</h2></div></div></div><div class="toc"><dl><dt><span class="refentrytitle"><a href="#RT_ST_BandMetaData">ST_BandMetaData</a></span><span class="refpurpose"> ? 指定したラスタバンドの基本的なメタデータを返します。バンド番号を指定しない場合には、1番と仮定します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_BandNoDataValue">ST_BandNoDataValue</a></span><span class="refpurpose"> ? 指定されたバンドについてデータが無いことを表現する値を返します。バンド番号を指定しない場合には、1番と仮定します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_BandIsNoData">ST_BandIsNoData</a></span><span class="refpurpose"> ? 指定したバンドがNODATA値で満たされている場合にはTRUEを返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_BandPath">ST_BandPath</a></span><span class="refpurpose"> ? ファイルシステムに格納されているバンドのシステムファイルパスを返します。バンド番号が指定されていない場合には1番と仮定します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_BandPixelType">ST_BandPixelType</a></span><span class="refpurpose"> ? 指定したバンドのピクセルタイプを返します。バンド番号が指定されていない場合には、1番と仮定します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_HasNoBand">ST_HasNoBand</a></span><span class="refpurpose"> ? 指定したバンド番号のバンドが無い場合にTRUEを返します。バンド番号を指定していない場合には、1番と仮定します。</span></dt></dl></div><div class="refentry" title="ST_BandMetaData"><a name="RT_ST_BandMetaData"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_BandMetaData ? 指定したラスタバンドの基本的なメタデータを返します。バンド番号を指定しない場合には、1番と仮定します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">record <b class="fsfunc">ST_BandMetaData</b>(</code>raster <var class="pdparam">rast</var>, integer <var class="pdparam">bandnum=1</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287136155"></a><h2>説明</h2><p>指定したラスタバンドの基本的なメタデータを返します。返されるカラムは pixeltype | nodatavalue | isoutdb | path です。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>
					ラスタがバンドを持たない場合にはエラーが投げられます。
                                  </p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>
					バンドにNODATA値が無い場合には、nodatabalueはNULLになります。
                                  </p></td></tr></table></div></div><div class="refsection" title="例"><a name="id287136178"></a><h2>例</h2><pre class="programlisting">SELECT rid, (foo.md).*  
 FROM (SELECT rid, ST_BandMetaData(rast,1) As md
FROM dummy_rast WHERE rid=2) As foo;

 rid | pixeltype | nodatavalue | isoutdb | path
-----+-----------+----------------+-------------+---------+------
   2 | 8BUI      |           0 | f       |
				</pre></div><div class="refsection" title="関連情報"><a name="id287136190"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_MetaData" title="ST_MetaData">ST_MetaData</a>, <a class="xref" href="#RT_ST_BandPixelType" title="ST_BandPixelType">ST_BandPixelType</a></p></div></div><div class="refentry" title="ST_BandNoDataValue"><div class="refentry.separator"><hr></div><a name="RT_ST_BandNoDataValue"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_BandNoDataValue ? 指定されたバンドについてデータが無いことを表現する値を返します。バンド番号を指定しない場合には、1番と仮定します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">double precision <b class="fsfunc">ST_BandNoDataValue</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">bandnum=1</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287136390"></a><h2>説明</h2><p>指定されたバンドについてデータが無いことを表現する値を返します。</p></div><div class="refsection" title="例"><a name="id287136400"></a><h2>例</h2><pre class="programlisting">SELECT ST_BandNoDataValue(rast,1) As bnval1, 
    ST_BandNoDataValue(rast,2) As bnval2, ST_BandNoDataValue(rast,3) As bnval3
FROM dummy_rast
WHERE rid = 2;

 bnval1 | bnval2 | bnval3
--------+--------+--------
      0 |      0 |      0
				</pre></div><div class="refsection" title="関連情報"><a name="id287136410"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_NumBands" title="ST_NumBands">ST_NumBands</a></p></div></div><div class="refentry" title="ST_BandIsNoData"><div class="refentry.separator"><hr></div><a name="RT_ST_BandIsNoData"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_BandIsNoData ? 指定したバンドがNODATA値で満たされている場合にはTRUEを返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_BandIsNoData</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">band</var>, boolean  <var class="pdparam">forceChecking=true</var><code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">ST_BandIsNoData</b>(</code>raster  <var class="pdparam">rast</var>, boolean  <var class="pdparam">forceChecking=true</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287136507"></a><h2>説明</h2><p>指定したバンドがNODATA値で満たされている場合にはTRUEを返します。バンド番号を指定しない場合には、1番と仮定します。
最後の引数がTRUEの場合には、全バンドについてピクセル毎に調べます。他の場合には、isnodataフラグの値を返すだけです。この引数を指定しない場合のデフォルト値はFALSEです。</p><p>初出: 2.0.0</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>

フラグが汚れている(最後の引数をTRUEにした場合としない場合とで結果が違う)場合には、
ST_SetBandIsNodata関数、または最後の引数をTRUEにしたST_BandNodataValue関数を使って、フラグにTRUEを設定するためにラスタを更新するべきです。ローダ(raster2pgsql.py)は現在のところ、ラスタデータをロードする時に確実なフラグの設定ができません。<a class="xref" href="#RT_ST_SetBandIsNoData" title="ST_SetBandIsNoData">ST_SetBandIsNoData</a>を参照して下さい。</p></td></tr></table></div></div><div class="refsection" title="例"><a name="id287136530"></a><h2>例</h2><pre class="programlisting">
-- ラスタカラムを持つダミーテーブルの生成
create table dummy_rast (rid integer, rast raster);

-- 2バンドでバンドごとに1ピクセルを持つラスタを追加します
-- ひとつめのバンドにはnodatavalueとピクセル値をともに3とし、
-- ふたつめのバンドにはnodatavalue=13とピクセル値=4とします。
insert into dummy_rast values(1,
(
'01' -- little endian (uint8 ndr)
|| 
'0000' -- version (uint16 0)
||
'0200' -- nBands (uint16 0)
||
'17263529ED684A3F' -- scaleX (float64 0.000805965234044584)
||
'F9253529ED684ABF' -- scaleY (float64 -0.00080596523404458)
||
'1C9F33CE69E352C0' -- ipX (float64 -75.5533328537098)
||
'718F0E9A27A44840' -- ipY (float64 49.2824585505576)
||
'ED50EB853EC32B3F' -- skewX (float64 0.000211812383858707)
||
'7550EB853EC32B3F' -- skewY (float64 0.000211812383858704)
||
'E6100000' -- SRID (int32 4326)
||
'0100' -- width (uint16 1)
||
'0100' -- height (uint16 1)
||
'6' -- hasnodatavalue and isnodata value set to true.
||
'2' -- first band type (4BUI) 
||
'03' -- novalue==3
||
'03' -- pixel(0,0)==3 (same that nodata)
||
'0' -- hasnodatavalue set to false
||
'5' -- second band type (16BSI)
||
'0D00' -- novalue==13
||
'0400' -- pixel(0,0)==4
)::raster
);

select st_bandisnodata(rast, 1) from dummy_rast where rid = 1; -- TRUEを期待
select st_bandisnodata(rast, 2) from dummy_rast where rid = 1; -- FALSEを期待
			</pre></div><div class="refsection" title="関連情報"><a name="id287136540"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_BandNoDataValue" title="ST_BandNoDataValue">ST_BandNoDataValue</a>, <a class="xref" href="#RT_ST_NumBands" title="ST_NumBands">ST_NumBands</a>, <a class="xref" href="#RT_ST_SetBandNoDataValue" title="ST_SetBandNoDataValue">ST_SetBandNoDataValue</a>, <a class="xref" href="#RT_ST_SetBandIsNoData" title="ST_SetBandIsNoData">ST_SetBandIsNoData</a></p></div></div><div class="refentry" title="ST_BandPath"><div class="refentry.separator"><hr></div><a name="RT_ST_BandPath"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_BandPath ? ファイルシステムに格納されているバンドのシステムファイルパスを返します。バンド番号が指定されていない場合には1番と仮定します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_BandPath</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">bandnum=1</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287136644"></a><h2>説明</h2><p>バンドへのシステムファイルパスを返します。データベース内に格納されているバンドでこの関数を読んだ場合にはエラーが投げられます。</p></div><div class="refsection" title="例"><a name="id287136653"></a><h2>例</h2><pre class="programlisting">
					</pre></div><div class="refsection" title="関連情報"><a name="id287136666"></a><h2>関連情報</h2><p></p></div></div><div class="refentry" title="ST_BandPixelType"><div class="refentry.separator"><hr></div><a name="RT_ST_BandPixelType"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_BandPixelType ? 指定したバンドのピクセルタイプを返します。バンド番号が指定されていない場合には、1番と仮定します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_BandPixelType</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">bandnum=1</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287136723"></a><h2>説明</h2><p>バンドにおけるピクセルタイプを表現する値を返します。</p><p>ピクセルタイプは11通りあります。対応しているピクセルタイプは次の通りです。
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>1BB -  1ビット 真偽値</p></li><li class="listitem"><p>2BUI - 2ビット 符号なし整数</p></li><li class="listitem"><p>4BUI - 4ビット 符号なし整数</p></li><li class="listitem"><p>8BSI - 8ビット 整数</p></li><li class="listitem"><p>8BUI - 8ビット 符号なし整数</p></li><li class="listitem"><p>16BSI - 16ビット 整数</p></li><li class="listitem"><p>16BUI - 16ビット 符号なし整数</p></li><li class="listitem"><p>32BSI - 32ビット 整数</p></li><li class="listitem"><p>32BUI - 32ビット 符号なし整数</p></li><li class="listitem"><p>32BF - 32ビット 浮動小数点数</p></li><li class="listitem"><p>64BF - 64ビット 浮動小数点数</p></li></ul></div><p>
				</p></div><div class="refsection" title="例"><a name="id287136812"></a><h2>例</h2><pre class="programlisting">SELECT ST_BandPixelType(rast,1) As btype1, 
    ST_BandPixelType(rast,2) As btype2, ST_BandPixelType(rast,3) As btype3
FROM dummy_rast
WHERE rid = 2;

 btype1 | btype2 | btype3
--------+--------+--------
 8BUI   | 8BUI   | 8BUI
				</pre></div><div class="refsection" title="関連情報"><a name="id287136823"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_NumBands" title="ST_NumBands">ST_NumBands</a></p></div></div><div class="refentry" title="ST_HasNoBand"><div class="refentry.separator"><hr></div><a name="RT_ST_HasNoBand"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_HasNoBand ? 指定したバンド番号のバンドが無い場合にTRUEを返します。バンド番号を指定していない場合には、1番と仮定します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_HasNoBand</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">bandnum=1</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287136916"></a><h2>説明</h2><p>指定したバンド番号のバンドが無い場合にTRUEを返します。バンド番号を指定していない場合には、1番と仮定します。</p><p>初出: 2.0.0</p></div><div class="refsection" title="例"><a name="id287136929"></a><h2>例</h2><pre class="programlisting">SELECT rid, ST_HasNoBand(rast) As hb1, ST_HasNoBand(rast,2) as hb2, 
ST_HasNoBand(rast,4) as hb4, ST_NumBands(rast) As numbands 
FROM dummy_rast;

rid | hb1 | hb2 | hb4 | numbands
-----+-----+-----+-----+----------
1 | t   | t   | t   |        0
2 | f   | f   | t   |        3
			</pre></div><div class="refsection" title="関連情報"><a name="id287136939"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_NumBands" title="ST_NumBands">ST_NumBands</a></p></div></div></div><div class="sect1" title="9.6. ラスタピクセル アクセサとセッター"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Raster_Pixel_Accessors"></a>9.6. ラスタピクセル アクセサとセッター</h2></div></div></div><div class="toc"><dl><dt><span class="refentrytitle"><a href="#RT_ST_PixelAsPolygon">ST_PixelAsPolygon</a></span><span class="refpurpose"> ? 指定した行と列のピクセルの境界となるジオメトリを返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_PixelAsPolygons">ST_PixelAsPolygons</a></span><span class="refpurpose"> ? 全てのピクセルについて境界となるジオメトリを、ピクセルごとのピクセル値とラスタ座標系のXとYとを付けて返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Value">ST_Value</a></span><span class="refpurpose"> ? 指定したバンドの指定した列Xと行Yまたはジオメトリポイントに対応するピクセルの値を返します。
バンド番号は1始まりで、指定しない場合には1と仮定します。
<code class="varname">exclude_nodata_value</code>がFALSEに設定された場合には、<code class="varname">nodata</code>ピクセルを含む全てのピクセルがインタセクトするかが考慮され、値を返します。<code class="varname">exclude_nodata_value</code>を渡さない場合には、ラスタのメタデータから読みます。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_SetValue">ST_SetValue</a></span><span class="refpurpose"> ? 指定したバンドの指定した列Xと行Yのピクセルまたは指定したジオメトリポイントとインタセクトするピクセルの値を設定することから得られた変更結果を返します。バンド番号は1始まりで、指定しない場合には1と仮定します。</span></dt></dl></div><div class="refentry" title="ST_PixelAsPolygon"><a name="RT_ST_PixelAsPolygon"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_PixelAsPolygon ? 指定した行と列のピクセルの境界となるジオメトリを返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_PixelAsPolygon</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">columnx</var>, integer  <var class="pdparam">rowy</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287137014"></a><h2>説明</h2><p>指定した行と列のピクセルの境界となるジオメトリを返します。</p></div><div class="refsection" title="例"><a name="id287137024"></a><h2>例</h2><pre class="programlisting">
-- ラスタピクセルのポリゴンを得ます
SELECT i,j, ST_AsText(ST_PixelAsPolygon(foo.rast, i,j)) As b1pgeom
FROM dummy_rast As foo 
	CROSS JOIN generate_series(1,2) As i 
	CROSS JOIN generate_series(1,1) As j
WHERE rid=2;

 i | j |                                                    b1pgeom
---+---+-----------------------------------------------------------------------------
 1 | 1 | POLYGON((3427927.75 5793244,3427927.8 5793244,3427927.8 5793243.95,...
 2 | 1 | POLYGON((3427927.8 5793244,3427927.85 5793244,3427927.85 5793243.95, ..
  </pre></div><div class="refsection" title="関連情報"><a name="id287137034"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_DumpAsPolygons" title="ST_DumpAsPolygons">ST_DumpAsPolygons</a>, <a class="xref" href="#RT_ST_Intersection" title="ST_Intersection">ST_Intersection</a>,
							 <a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a>
				</p></div></div><div class="refentry" title="ST_PixelAsPolygons"><div class="refentry.separator"><hr></div><a name="RT_ST_PixelAsPolygons"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_PixelAsPolygons ? 全てのピクセルについて境界となるジオメトリを、ピクセルごとのピクセル値とラスタ座標系のXとYとを付けて返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">setof record <b class="fsfunc">ST_PixelAsPolygons</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">band=1</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287137101"></a><h2>説明</h2><p>全てのピクセルについて境界となるジオメトリを、ピクセルごとのピクセル値(倍精度浮動小数点数)とラスタ座標系のXとY(ともに整数)とを付けて返します。</p></div><div class="refsection" title="例"><a name="id287137112"></a><h2>例</h2><pre class="programlisting">
-- ラスタピクセルのポリゴンを得ます
SELECT (gv).x, (gv).y, (gv).val, ST_AsText((gv).geom) geom
FROM (SELECT ST_PixelAsPolygons(
                 ST_SetValue(ST_SetValue(ST_AddBand(ST_MakeEmptyRaster(2, 2, 0, 0, 0.001, -0.001, 0.001, 0.001, 4269), 
                                                    '8BUI'::text, 1, 0), 
                                         2, 2, 10), 
                             1, 1, NULL)
) gv 
) foo;

 x | y | val |                geom
---+---+-----------------------------------------------------------------------------
 1 | 1 |     | POLYGON((0 0,0.001 0.001,0.002 0,0.001 -0.001,0 0))
 1 | 2 |   1 | POLYGON((0.001 -0.001,0.002 0,0.003 -0.001,0.002 -0.002,0.001 -0.001))
 2 | 1 |   1 | POLYGON((0.001 0.001,0.002 0.002,0.003 0.001,0.002 0,0.001 0.001))
 2 | 2 |  10 | POLYGON((0.002 0,0.003 0.001,0.004 0,0.003 -0.001,0.002 0))
  </pre></div><div class="refsection" title="関連情報"><a name="id287137123"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_DumpAsPolygons" title="ST_DumpAsPolygons">ST_DumpAsPolygons</a>, <a class="xref" href="#RT_ST_PixelAsPolygon" title="ST_PixelAsPolygon">ST_PixelAsPolygon</a>,
							 <a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a>
				</p></div></div><div class="refentry" title="ST_Value"><div class="refentry.separator"><hr></div><a name="RT_ST_Value"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Value ? 指定したバンドの指定した列Xと行Yまたはジオメトリポイントに対応するピクセルの値を返します。
バンド番号は1始まりで、指定しない場合には1と仮定します。
<code class="varname">exclude_nodata_value</code>がFALSEに設定された場合には、<code class="varname">nodata</code>ピクセルを含む全てのピクセルがインタセクトするかが考慮され、値を返します。<code class="varname">exclude_nodata_value</code>を渡さない場合には、ラスタのメタデータから読みます。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">double precision <b class="fsfunc">ST_Value</b>(</code>raster  <var class="pdparam">rast</var>, geometry  <var class="pdparam">pt</var>, boolean  <var class="pdparam">exclude_nodata_value=true</var><code>)</code>;</p><p><code class="funcdef">double precision <b class="fsfunc">ST_Value</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">bandnum</var>, geometry  <var class="pdparam">pt</var>, boolean  <var class="pdparam">exclude_nodata_value=true</var><code>)</code>;</p><p><code class="funcdef">double precision <b class="fsfunc">ST_Value</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">columnx</var>, integer  <var class="pdparam">rowy</var>, boolean  <var class="pdparam">exclude_nodata_value=true</var><code>)</code>;</p><p><code class="funcdef">double precision <b class="fsfunc">ST_Value</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">bandnum</var>, integer  <var class="pdparam">columnx</var>, integer  <var class="pdparam">rowy</var>, boolean  <var class="pdparam">exclude_nodata_value=true</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287138070"></a><h2>説明</h2><p>指定したバンドの指定した列Xと行Yまたはジオメトリポイントに対応するピクセルの値を返します。バンド番号は1始まりで、指定しない場合には1と仮定します。<code class="varname">exclude_nodata_value</code>がTRUEに設定された場合には、<code class="varname">nodata</code>ピクセルだけが考慮されます。<code class="varname">exclude_nodata_value</code>がFALSEに設定された場合には、全てのピクセルが考慮されます。</p><p>機能強化: 2.0.0 exclude_nodata_value optional argument was added.</p></div><div class="refsection" title="例"><a name="id287138092"></a><h2>例</h2><pre class="programlisting">
-- PostGISジオメトリのポイントを指定してラスタの値を得ます
-- ジオメトリのSRIDはラスタと同じにします
SELECT rid, ST_Value(rast, foo.pt_geom) As b1pval, ST_Value(rast, 2, foo.pt_geom) As b2pval
FROM dummy_rast CROSS JOIN (SELECT ST_SetSRID(ST_Point(3427927.77, 5793243.76), 0) As pt_geom) As foo
WHERE rid=2;

 rid | b1pval | b2pval
-----+--------+--------
   2 |    252 |     79
   
   
-- 実際のテーブルを使う一般的な仮想的な例
SELECT rid, ST_Value(rast, 3, sometable.geom) As b3pval
FROM sometable
WHERE ST_Intersects(rast,sometable.geom);
				</pre><pre class="programlisting">
SELECT rid, ST_Value(rast, 1, 1, 1) As b1pval, 
    ST_Value(rast, 2, 1, 1) As b2pval, ST_Value(rast, 3, 1, 1) As b3pval
FROM dummy_rast
WHERE rid=2;

 rid | b1pval | b2pval | b3pval
-----+--------+--------+--------
   2 |    253 |     78 |     70
				</pre><pre class="programlisting">
-- 1番、2番、3番バンドの全ての値を得ます
SELECT x, y, ST_Value(rast, 1, x, y) As b1val, 
	ST_Value(rast, 2, x, y) As b2val, ST_Value(rast, 3, x, y) As b3val
FROM dummy_rast CROSS JOIN
generate_series(1, 1000) As x CROSS JOIN generate_series(1, 1000) As y
WHERE rid =  2 AND x &lt;= ST_Width(rast) AND y &lt;= ST_Height(rast);

 x | y | b1val | b2val | b3val
---+---+-------+-------+-------
 1 | 1 |   253 |    78 |    70
 1 | 2 |   253 |    96 |    80
 1 | 3 |   250 |    99 |    90
 1 | 4 |   251 |    89 |    77
 1 | 5 |   252 |    79 |    62
 2 | 1 |   254 |    98 |    86
 2 | 2 |   254 |   118 |   108
 :
 :
				</pre><pre class="programlisting">
-- 上の例と同じに、1番、2番、3番バンドの全ての値を得ますが、
-- 返り値をピクセル毎の左上隅のポイントを返します
SELECT ST_AsText(ST_SetSRID(
	ST_Point(ST_UpperLeftX(rast) + ST_ScaleX(rast)*x, 
		ST_UpperLeftY(rast) + ST_ScaleY(rast)*y), 
		ST_SRID(rast))) As uplpt
    , ST_Value(rast, 1, x, y) As b1val, 
	ST_Value(rast, 2, x, y) As b2val, ST_Value(rast, 3, x, y) As b3val
FROM dummy_rast CROSS JOIN
generate_series(1,1000) As x CROSS JOIN generate_series(1,1000) As y
WHERE rid =  2 AND x &lt;= ST_Width(rast) AND y &lt;= ST_Height(rast);

            uplpt            | b1val | b2val | b3val
-----------------------------+-------+-------+-------
 POINT(3427929.25 5793245.5) |   253 |    78 |    70
 POINT(3427929.25 5793247)   |   253 |    96 |    80
 POINT(3427929.25 5793248.5) |   250 |    99 |    90
:
				</pre><pre class="programlisting">
-- 指定した範囲内の値を持ち、指定したポリゴンにインタセクトする、
-- 全てのピクセルの結合によって形成されるポリゴンを得ます
SELECT ST_AsText(ST_Union(pixpolyg)) As shadow
FROM (SELECT ST_Translate(ST_MakeEnvelope(
		ST_UpperLeftX(rast), ST_UpperLeftY(rast), 
			ST_UpperLeftX(rast) + ST_ScaleX(rast),
			ST_UpperLeftY(rast) + ST_ScaleY(rast), 0
			), ST_ScaleX(rast)*x, ST_ScaleY(rast)*y
		) As pixpolyg, ST_Value(rast, 2, x, y) As b2val
	FROM dummy_rast CROSS JOIN
generate_series(1,1000) As x CROSS JOIN generate_series(1,1000) As y
WHERE rid =  2 
	AND x &lt;= ST_Width(rast) AND y &lt;= ST_Height(rast)) As foo
WHERE  
	ST_Intersects(
		pixpolyg, 
		ST_GeomFromText('POLYGON((3427928 5793244,3427927.75 5793243.75,3427928 5793243.75,3427928 5793244))',0)
		) AND b2val != 254;


		shadow
------------------------------------------------------------------------------------
 MULTIPOLYGON(((3427928 5793243.9,3427928 5793243.85,3427927.95 5793243.85,3427927.95 5793243.9,
 3427927.95 5793243.95,3427928 5793243.95,3427928.05 5793243.95,3427928.05 5793243.9,3427928 5793243.9)),((3427927.95 5793243.9,3427927.95 579324
3.85,3427927.9 5793243.85,3427927.85 5793243.85,3427927.85 5793243.9,3427927.9 5793243.9,3427927.9 5793243.95,
3427927.95 5793243.95,3427927.95 5793243.9)),((3427927.85 5793243.75,3427927.85 5793243.7,3427927.8 5793243.7,3427927.8 5793243.75
,3427927.8 5793243.8,3427927.8 5793243.85,3427927.85 5793243.85,3427927.85 5793243.8,3427927.85 5793243.75)),
((3427928.05 5793243.75,3427928.05 5793243.7,3427928 5793243.7,3427927.95 5793243.7,3427927.95 5793243.75,3427927.95 5793243.8,3427
927.95 5793243.85,3427928 5793243.85,3427928 5793243.8,3427928.05 5793243.8,
3427928.05 5793243.75)),((3427927.95 5793243.75,3427927.95 5793243.7,3427927.9 5793243.7,3427927.85 5793243.7,
3427927.85 5793243.75,3427927.85 5793243.8,3427927.85 5793243.85,3427927.9 5793243.85,
3427927.95 5793243.85,3427927.95 5793243.8,3427927.95 5793243.75)))
				</pre><pre class="programlisting">--- Checking all the pixels of a large raster tile can take a long time.
--- You can dramatically improve speed at some lose of precision by orders of magnitude 
--  by sampling pixels using the step optional parameter of generate_series.  
--  This next example does the same as previous but by checking 1 for every 4 (2x2) pixels and putting in the last checked
--  putting in the checked pixel as the value for subsequent 4
	
SELECT ST_AsText(ST_Union(pixpolyg)) As shadow
FROM (SELECT ST_Translate(ST_MakeEnvelope(
		ST_UpperLeftX(rast), ST_UpperLeftY(rast), 
			ST_UpperLeftX(rast) + ST_ScaleX(rast)*2,
			ST_UpperLeftY(rast) + ST_ScaleY(rast)*2, 0
			), ST_ScaleX(rast)*x, ST_ScaleY(rast)*y
		) As pixpolyg, ST_Value(rast, 2, x, y) As b2val
	FROM dummy_rast CROSS JOIN
generate_series(1,1000,2) As x CROSS JOIN generate_series(1,1000,2) As y
WHERE rid =  2 
	AND x &lt;= ST_Width(rast)  AND y &lt;= ST_Height(rast)  ) As foo
WHERE  
	ST_Intersects(
		pixpolyg, 
		ST_GeomFromText('POLYGON((3427928 5793244,3427927.75 5793243.75,3427928 5793243.75,3427928 5793244))',0)
		) AND b2val != 254;

		shadow
------------------------------------------------------------------------------------
 MULTIPOLYGON(((3427927.9 5793243.85,3427927.8 5793243.85,3427927.8 5793243.95,
 3427927.9 5793243.95,3427928 5793243.95,3427928.1 5793243.95,3427928.1 5793243.85,3427928 5793243.85,3427927.9 5793243.85)),
 ((3427927.9 5793243.65,3427927.8 5793243.65,3427927.8 5793243.75,3427927.8 5793243.85,3427927.9 5793243.85,
 3427928 5793243.85,3427928 5793243.75,3427928.1 5793243.75,3427928.1 5793243.65,3427928 5793243.65,3427927.9 5793243.65)))
				</pre></div><div class="refsection" title="関連情報"><a name="id287138125"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_DumpAsPolygons" title="ST_DumpAsPolygons">ST_DumpAsPolygons</a>, <a class="xref" href="#RT_ST_NumBands" title="ST_NumBands">ST_NumBands</a>, <a class="xref" href="#RT_ST_PixelAsPolygon" title="ST_PixelAsPolygon">ST_PixelAsPolygon</a>, <a class="xref" href="#RT_ST_ScaleX" title="ST_ScaleX">ST_ScaleX</a>,
					, <a class="xref" href="#RT_ST_ScaleY" title="ST_ScaleY">ST_ScaleY</a>, <a class="xref" href="#RT_ST_UpperLeftX" title="ST_UpperLeftX">ST_UpperLeftX</a>, 
					<a class="xref" href="#RT_ST_UpperLeftY" title="ST_UpperLeftY">ST_UpperLeftY</a>, <a class="xref" href="#RT_ST_SRID" title="ST_SRID">ST_SRID</a>, <a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a>,
					, <a class="xref" href="#ST_Point" title="ST_Point">ST_Point</a>, <a class="xref" href="#ST_MakeEnvelope" title="ST_MakeEnvelope">ST_MakeEnvelope</a>, 
					<a class="xref" href="#ST_Intersects" title="ST_Intersects">ST_Intersects</a>, <a class="xref" href="#ST_Intersection" title="ST_Intersection">ST_Intersection</a></p></div></div><div class="refentry" title="ST_SetValue"><div class="refentry.separator"><hr></div><a name="RT_ST_SetValue"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SetValue ? 指定したバンドの指定した列Xと行Yのピクセルまたは指定したジオメトリポイントとインタセクトするピクセルの値を設定することから得られた変更結果を返します。バンド番号は1始まりで、指定しない場合には1と仮定します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_SetValue</b>(</code>raster  <var class="pdparam">rast</var>, geometry  <var class="pdparam">pt</var>, double precision  <var class="pdparam">newvalue</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_SetValue</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">bandnum</var>, geometry  <var class="pdparam">pt</var>, double precision  <var class="pdparam">newvalue</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_SetValue</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">columnx</var>, integer  <var class="pdparam">rowy</var>, double precision  <var class="pdparam">newvalue</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_SetValue</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">bandnum</var>, integer  <var class="pdparam">columnx</var>, integer  <var class="pdparam">rowy</var>, double precision  <var class="pdparam">newvalue</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287138408"></a><h2>説明</h2><p>指定したバンドの指定した列と行のピクセルまたは指定したジオメトリポイントとインタセクトするピクセルの値を設定することから得られた変更結果を返します。バンド番号を指定しない場合には1と仮定します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ジオメトリによる値設定は現在のところポイントでのみ動作します。</p></td></tr></table></div></div><div class="refsection" title="例"><a name="id287138422"></a><h2>例</h2><pre class="programlisting">
				-- ジオメトリの例
SELECT (foo.geomval).val, ST_AsText(ST_Union((foo.geomval).geom))
FROM (SELECT ST_DumpAsPolygons(
		ST_SetValue(rast,1,
				ST_Point(3427927.75, 5793243.95),
				50)
			) As geomval
FROM dummy_rast
where rid = 2) As foo
WHERE (foo.geomval).val &lt; 250
GROUP BY (foo.geomval).val;

 val |                                                     st_astext
-----+-------------------------------------------------------------------
  50 | POLYGON((3427927.75 5793244,3427927.75 5793243.95,3427927.8 579324 ...
 249 | POLYGON((3427927.95 5793243.95,3427927.95 5793243.85,3427928 57932 ...
 
				</pre><pre class="programlisting">
-- 変更したラスタの格納 --
	UPDATE dummy_rast SET rast = ST_SetValue(rast,1, ST_Point(3427927.75, 5793243.95),100)
		WHERE rid = 2   ;

				</pre></div><div class="refsection" title="関連情報"><a name="id287138437"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Value" title="ST_Value">ST_Value</a>, <a class="xref" href="#RT_ST_DumpAsPolygons" title="ST_DumpAsPolygons">ST_DumpAsPolygons</a></p></div></div></div><div class="sect1" title="9.7. ラスタ エディタ"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Raster_Editors"></a>9.7. ラスタ エディタ</h2></div></div></div><div class="toc"><dl><dt><span class="refentrytitle"><a href="#RT_ST_SetGeoReference">ST_SetGeoReference</a></span><span class="refpurpose"> ? 1回の関数呼び出しで6つの地理参照パラメータを設定します。値は空白区切りです。GDALまたはESRI書式の入力を受け付けます。デフォルトはGDALです。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_SetRotation">ST_SetRotation</a></span><span class="refpurpose"> ? ラスタの回転をラジアン単位で設定します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_SetScale">ST_SetScale</a></span><span class="refpurpose"> ? ピクセルのXとYのサイズを空間参照系の単位で設定します。数値はunits/pixelで、幅、高さの順です。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_SetSkew">ST_SetSkew</a></span><span class="refpurpose"> ? XとYのスキュー(回転パラメータ)を設定します。引数を1つだけ渡した場合には、XとYは同じ値に設定されます。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_SetSRID">ST_SetSRID</a></span><span class="refpurpose"> ? ラスタのSRIDを、指定した整数でspatial_ref_sysテーブルで定義されているSRIDに設定します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_SetUpperLeft">ST_SetUpperLeft</a></span><span class="refpurpose"> ? ラスタの左上隅の地理参照のX,Y座標値を設定します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Resample">ST_Resample</a></span><span class="refpurpose"> ? 指定したリサンプリングアルゴリズム、新しいピクセル範囲、グリッドの角、定義するか他のラスタから借りてきた地理参照属性を使ってリサンプリングを行います。新しいピクセル値は、最近傍補間('NearestNeighbor')、双線形補間('Bilinear')、3次補完('Cubic')、3次スプライン補完('CubicSpline')、ランツォシュ補完('Lanczos')、のいずれかのアルゴリズムを使います。デフォルトは最近傍補完です。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Rescale">ST_Rescale</a></span><span class="refpurpose"> ? スケール(ピクセルサイズ)だけを調整するリサンプリングを行います。新しいピクセル値は、最近傍補間('NearestNeighbor')、双線形補間('Bilinear')、3次補完('Cubic')、3次スプライン補完('CubicSpline')、ランツォシュ補完('Lanczos')、のいずれかのアルゴリズムを使います。デフォルトは最近傍補完です。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Reskew">ST_Reskew</a></span><span class="refpurpose"> ? スキュー(回転パラメタ)の調整によるリサンプリングを行います。新しいピクセル値は、最近傍補間('NearestNeighbor')、双線形補間('Bilinear')、3次補完('Cubic')、3次スプライン補完('CubicSpline')、ランツォシュ補完('Lanczos')、のいずれかのアルゴリズムを使います。デフォルトは最近傍補完です。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_SnapToGrid">ST_SnapToGrid</a></span><span class="refpurpose"> ? グリッドにスナップさせるリサンプリングを行います。新しいピクセル値は、最近傍補間('NearestNeighbor')、双線形補間('Bilinear')、3次補完('Cubic')、3次スプライン補完('CubicSpline')、ランツォシュ補完('Lanczos')、のいずれかのアルゴリズムを使います。デフォルトは最近傍補完です。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Transform">ST_Transform</a></span><span class="refpurpose"> ? ラスタを既知の空間参照系から他の既知の空間参照系に、指定したリサンプリングアルゴリズムで投影変換します。選択肢は、最近傍補間('NearestNeighbor')、双線形補間('Bilinear')、3次補完('Cubic')、3次スプライン補完('CubicSpline')、ランツォシュ補完('Lanczos')、があります。デフォルトは最近傍補完です。</span></dt></dl></div><div class="refentry" title="ST_SetGeoReference"><a name="RT_ST_SetGeoReference"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SetGeoReference ? 1回の関数呼び出しで6つの地理参照パラメータを設定します。値は空白区切りです。GDALまたはESRI書式の入力を受け付けます。デフォルトはGDALです。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_SetGeoReference</b>(</code>raster  <var class="pdparam">rast</var>, text  <var class="pdparam">georefcoords</var>, text  <var class="pdparam">format=GDAL</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287138516"></a><h2>説明</h2><p>1回の関数呼び出しで6つの地理参照パラメータを設定します。値は空白区切りです。'GDAL'または'ESRI'書式の入力を受け付けます。デフォルトはGDALです。6つの値を与えられない場合にはNULLを返します。</p><p>書式の違いは次の通りです。</p><p><code class="varname">GDAL</code>: 
</p><pre class="programlisting">scalex skewy skewx scaley upperleftx upperlefty</pre><p><code class="varname">ESRI</code>: 
</p><pre class="programlisting">scalex skewy skewx scaley upperleftx + scalex*0.5 upperlefty + scaley*0.5</pre></div><div class="refsection" title="例"><a name="id287138547"></a><h2>例</h2><pre class="programlisting">UPDATE dummy_rast SET rast = ST_SetGeoReference(rast, '2 0 0 3 0.5 0.5','GDAL') 
	WHERE rid=1;
	
-- same coordinates set in 'ESRI' format
UPDATE dummy_rast SET rast = ST_SetGeoReference(rast, '2 0 0 3 1.5 2','ESRI') 
	WHERE rid=1;
				</pre></div><div class="refsection" title="関連情報"><a name="id287138557"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_GeoReference" title="ST_GeoReference">ST_GeoReference</a>, <a class="xref" href="#RT_ST_ScaleX" title="ST_ScaleX">ST_ScaleX</a>, <a class="xref" href="#RT_ST_ScaleY" title="ST_ScaleY">ST_ScaleY</a>, <a class="xref" href="#RT_ST_UpperLeftX" title="ST_UpperLeftX">ST_UpperLeftX</a>, <a class="xref" href="#RT_ST_UpperLeftY" title="ST_UpperLeftY">ST_UpperLeftY</a></p></div></div><div class="refentry" title="ST_SetRotation"><div class="refentry.separator"><hr></div><a name="RT_ST_SetRotation"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SetRotation ? ラスタの回転をラジアン単位で設定します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float8 <b class="fsfunc">ST_SetRotation</b>(</code>raster <var class="pdparam">rast</var>, float8 <var class="pdparam">rotation</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287138663"></a><h2>説明</h2><p>ラスタを均一に回転させます。回転はラジアン単位です。詳細については<a class="ulink" href="http://en.wikipedia.org/wiki/World_file" target="_top">World File</a>を参照して下さい。</p></div><div class="refsection" title="例"><a name="id287138677"></a><h2>例</h2><pre class="programlisting">SELECT 
  ST_ScaleX(rast1), ST_ScaleY(rast1), ST_SkewX(rast1), ST_SkewY(rast1),
  ST_ScaleX(rast2), ST_ScaleY(rast2), ST_SkewX(rast2), ST_SkewY(rast2) 
FROM (
  SELECT ST_SetRotation(rast, 15) AS rast1, rast as rast2 FROM dummy_rast
) AS foo;
      st_scalex      |      st_scaley      |      st_skewx      |      st_skewy      | st_scalex | st_scaley | st_skewx | st_skewy
---------------------+---------------------+--------------------+--------------------+-----------+-----------+----------+----------
   -1.51937582571764 |   -2.27906373857646 |   1.95086352047135 |   1.30057568031423 |         2 |         3 |        0 |        0
 -0.0379843956429411 | -0.0379843956429411 | 0.0325143920078558 | 0.0325143920078558 |      0.05 |     -0.05 |        0 |        0
                </pre></div><div class="refsection" title="関連情報"><a name="id287138690"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Rotation" title="ST_Rotation">ST_Rotation</a>, <a class="xref" href="#RT_ST_ScaleX" title="ST_ScaleX">ST_ScaleX</a>, <a class="xref" href="#RT_ST_ScaleY" title="ST_ScaleY">ST_ScaleY</a>, <a class="xref" href="#RT_ST_SkewX" title="ST_SkewX">ST_SkewX</a>, <a class="xref" href="#RT_ST_SkewY" title="ST_SkewY">ST_SkewY</a></p></div></div><div class="refentry" title="ST_SetScale"><div class="refentry.separator"><hr></div><a name="RT_ST_SetScale"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SetScale ? ピクセルのXとYのサイズを空間参照系の単位で設定します。数値はunits/pixelで、幅、高さの順です。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_SetScale</b>(</code>raster  <var class="pdparam">rast</var>, float8  <var class="pdparam">xy</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_SetScale</b>(</code>raster  <var class="pdparam">rast</var>, float8  <var class="pdparam">x</var>, float8  <var class="pdparam">y</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287138797"></a><h2>説明</h2><p>ピクセルのXとYのサイズを空間参照系の単位で設定します。数値はunits/pixelで、幅、高さの順です。1つの数値だけを渡した場合には、XとYは同じ値であると仮定します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_SetScaleは<a class="xref" href="#RT_ST_Rescale" title="ST_Rescale">ST_Rescale</a>と異なります。ST_SetScaleはラスタの範囲をあわせるためのリサンプリングをしません。根本的に誤った設定を行ったのを訂正するためにラスタのメタデータ(地理参照)を変更するだけです。ST_Rescaleは、入力ラスタの地理範囲に合わせて計算された幅、高さを持つラスタを返します。ST_SetScaleはラスタの幅も高さも変更しません。</p></td></tr></table></div><p>変更: 2.0.0 WKTRaster版ではこれはST_SetPixelSizeと呼ばれていました。2.0.0で変更されました。</p></div><div class="refsection" title="例"><a name="id287138819"></a><h2>例</h2><pre class="programlisting">UPDATE dummy_rast 
	SET rast = ST_SetScale(rast, 1.5)
WHERE rid = 2;

SELECT ST_ScaleX(rast) As pixx, ST_ScaleY(rast) As pixy, Box3D(rast) As newbox
FROM dummy_rast
WHERE rid = 2;

 pixx | pixy |                    newbox
------+------+----------------------------------------------
  1.5 |  1.5 | BOX(3427927.75 5793244 0, 3427935.25 5793251.5 0)
				</pre><pre class="programlisting">UPDATE dummy_rast 
	SET rast = ST_SetScale(rast, 1.5, 0.55)
WHERE rid = 2;

SELECT ST_ScaleX(rast) As pixx, ST_ScaleY(rast) As pixy, Box3D(rast) As newbox
FROM dummy_rast
WHERE rid = 2;

 pixx | pixy |                   newbox
------+------+--------------------------------------------
  1.5 | 0.55 | BOX(3427927.75 5793244 0,3427935.25 5793247 0)
				</pre></div><div class="refsection" title="関連情報"><a name="id287138834"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_ScaleX" title="ST_ScaleX">ST_ScaleX</a>, <a class="xref" href="#RT_ST_ScaleY" title="ST_ScaleY">ST_ScaleY</a>, <a class="xref" href="#RT_Box3D" title="Box3D">Box3D</a></p></div></div><div class="refentry" title="ST_SetSkew"><div class="refentry.separator"><hr></div><a name="RT_ST_SetSkew"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SetSkew ? XとYのスキュー(回転パラメータ)を設定します。引数を1つだけ渡した場合には、XとYは同じ値に設定されます。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_SetSkew</b>(</code>raster  <var class="pdparam">rast</var>, float8  <var class="pdparam">skewxy</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_SetSkew</b>(</code>raster  <var class="pdparam">rast</var>, float8  <var class="pdparam">skewx</var>, float8  <var class="pdparam">skewy</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287138935"></a><h2>説明</h2><p>XとYのスキュー(回転パラメータ)を設定します。引数を1つだけ渡した場合には、XとYは同じ値に設定されます。詳細については<a class="ulink" href="http://en.wikipedia.org/wiki/World_file" target="_top">World File</a>を参照して下さい。</p></div><div class="refsection" title="例"><a name="id287138949"></a><h2>例</h2><pre class="programlisting">
-- 例1
UPDATE dummy_rast SET rast = ST_SetSkew(rast,1,2) WHERE rid = 1;
SELECT rid, ST_SkewX(rast) As skewx, ST_SkewY(rast) As skewy, 
    ST_GeoReference(rast) as georef
FROM dummy_rast WHERE rid = 1;

rid | skewx | skewy |    georef
----+-------+-------+--------------
  1 |     1 |     2 | 2.0000000000
                    : 2.0000000000
                    : 1.0000000000
                    : 3.0000000000
                    : 0.5000000000
                    : 0.5000000000
                    
				</pre><pre class="programlisting">
-- 例2 両方に同じ値を設定
UPDATE dummy_rast SET rast = ST_SetSkew(rast,0) WHERE rid = 1;
SELECT rid, ST_SkewX(rast) As skewx, ST_SkewY(rast) As skewy, 
    ST_GeoReference(rast) as georef
FROM dummy_rast WHERE rid = 1;
			
 rid | skewx | skewy |    georef
-----+-------+-------+--------------
   1 |     0 |     0 | 2.0000000000
                     : 0.0000000000
                     : 0.0000000000
                     : 3.0000000000
                     : 0.5000000000
                     : 0.5000000000
				</pre></div><div class="refsection" title="関連情報"><a name="id287138966"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_GeoReference" title="ST_GeoReference">ST_GeoReference</a>, <a class="xref" href="#RT_ST_SetGeoReference" title="ST_SetGeoReference">ST_SetGeoReference</a>, <a class="xref" href="#RT_ST_SkewX" title="ST_SkewX">ST_SkewX</a>, <a class="xref" href="#RT_ST_SkewY" title="ST_SkewY">ST_SkewY</a></p></div></div><div class="refentry" title="ST_SetSRID"><div class="refentry.separator"><hr></div><a name="RT_ST_SetSRID"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SetSRID ? ラスタのSRIDを、指定した整数でspatial_ref_sysテーブルで定義されているSRIDに設定します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_SetSRID</b>(</code>raster 
				<var class="pdparam">rast</var>, integer 
				<var class="pdparam">srid</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287139069"></a><h2>説明</h2><p>ラスタのSRIDを、指定した整数に設定します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数は、どんなかたちであれ、ラスタの変換を行いません。空間参照系を定義するメタデータを設定するだけです。後で変換する際に使います。</p></td></tr></table></div></div><div class="refsection" title="関連情報"><a name="id287139085"></a><h2>関連情報</h2><p><a class="xref" href="#spatial_ref_sys" title="4.3.1. SPATIAL_REF_SYSテーブルと空間参照系">「SPATIAL_REF_SYSテーブルと空間参照系」</a>, <a class="xref" href="#RT_ST_SRID" title="ST_SRID">ST_SRID</a></p></div></div><div class="refentry" title="ST_SetUpperLeft"><div class="refentry.separator"><hr></div><a name="RT_ST_SetUpperLeft"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SetUpperLeft ? ラスタの左上隅の地理参照のX,Y座標値を設定します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_SetUpperLeft</b>(</code>raster  <var class="pdparam">rast</var>, double precision  <var class="pdparam">x</var>, double precision  <var class="pdparam">y</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287139156"></a><h2>説明</h2><p>ラスタの左上隅の地理参照のX,Y座標値を設定します。</p></div><div class="refsection" title="例"><a name="id287139166"></a><h2>例</h2><pre class="programlisting">
SELECT ST_SetUpperLeft(rast,-71.01,42.37)  
FROM dummy_rast
WHERE rid = 2;
					</pre></div><div class="refsection" title="関連情報"><a name="id287139177"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_UpperLeftX" title="ST_UpperLeftX">ST_UpperLeftX</a>, <a class="xref" href="#RT_ST_UpperLeftY" title="ST_UpperLeftY">ST_UpperLeftY</a></p></div></div><div class="refentry" title="ST_Resample"><div class="refentry.separator"><hr></div><a name="RT_ST_Resample"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Resample ? 指定したリサンプリングアルゴリズム、新しいピクセル範囲、グリッドの角、定義するか他のラスタから借りてきた地理参照属性を使ってリサンプリングを行います。新しいピクセル値は、最近傍補間('NearestNeighbor')、双線形補間('Bilinear')、3次補完('Cubic')、3次スプライン補完('CubicSpline')、ランツォシュ補完('Lanczos')、のいずれかのアルゴリズムを使います。デフォルトは最近傍補完です。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_Resample</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">width</var>, integer  <var class="pdparam">height</var>, integer  <var class="pdparam">srid=same_as_rast</var>, double precision  <var class="pdparam">gridx=NULL</var>, double precision  <var class="pdparam">gridy=NULL</var>, double precision  <var class="pdparam">skewx=0</var>, double precision  <var class="pdparam">skewy=0</var>, text  <var class="pdparam">algorithm=NearestNeighbour</var>, double precision  <var class="pdparam">maxerr=0.125</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Resample</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">srid=NULL</var>, double precision  <var class="pdparam">scalex=0</var>, double precision  <var class="pdparam">scaley=0</var>, double precision  <var class="pdparam">gridx=NULL</var>, double precision  <var class="pdparam">gridy=NULL</var>, double precision  <var class="pdparam">skewx=0</var>, double precision  <var class="pdparam">skewy=0</var>, text  <var class="pdparam">algorithm=NearestNeighbor</var>, double precision  <var class="pdparam">maxerr=0.125</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Resample</b>(</code>raster  <var class="pdparam">rast</var>, raster  <var class="pdparam">ref</var>, text  <var class="pdparam">algorithm=NearestNeighbour</var>, double precision  <var class="pdparam">maxerr=0.125</var>, boolean  <var class="pdparam">usescale=true</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Resample</b>(</code>raster  <var class="pdparam">rast</var>, raster  <var class="pdparam">ref</var>, boolean  <var class="pdparam">usescale</var>, text  <var class="pdparam">algorithm=NearestNeighbour</var>, double precision  <var class="pdparam">maxerr=0.125</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287139568"></a><h2>説明</h2><p>指定したリサンプリングアルゴリズム、新しいピクセル範囲(width, height)、グリッドコーナー(gridx, gridy)、定義するか他のラスタから借りてきた地理参照属性(scalex, scaley, skewx, skewy)を使ってリサンプリングを行います。</p><p>新しいピクセル値は、最近傍補間('NearestNeighbor')、双線形補間('Bilinear')、3次補完('Cubic')、3次スプライン補完('CubicSpline')、ランツォシュ補完('Lanczos')、のいずれかのアルゴリズムを使います。デフォルトは最近傍補完で、最も早いですが最も悪い内挿を行います。</p><p><code class="varname">maxerr</code>が指定されていない場合には0.125とします。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ラスタが既知の空間参照系(SRID)にある場合に限って動作します。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>詳細については<a class="ulink" href="http://www.gdal.org/gdalwarp.html" target="_top">GDAL Warp resampling methods</a>を参照して下さい。</p></td></tr></table></div><p>初出: 2.0.0 GDAL 1.6.1以上が必要です。</p></div><div class="refsection" title="例"><a name="id287139603"></a><h2>例</h2><pre class="programlisting">SELECT ST_Width(orig) As orig_width, ST_Width(reduce_100) As new_width
 FROM (
 SELECT rast As orig, ST_Resample(rast,100,100) As reduce_100   
  FROM aerials.boston 
	WHERE ST_Intersects(rast,
	  ST_Transform(
	    ST_MakeEnvelope(-71.128, 42.2392,-71.1277, 42.2397, 4326),26986) ) 
	        limit 1 ) As foo;
 orig_width | new_width
------------+-------------
        200 |         100				
</pre></div><div class="refsection" title="関連情報"><a name="id287139613"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Rescale" title="ST_Rescale">ST_Rescale</a>, <a class="xref" href="#RT_ST_Transform" title="ST_Transform">ST_Transform</a></p></div></div><div class="refentry" title="ST_Rescale"><div class="refentry.separator"><hr></div><a name="RT_ST_Rescale"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Rescale ? スケール(ピクセルサイズ)だけを調整するリサンプリングを行います。新しいピクセル値は、最近傍補間('NearestNeighbor')、双線形補間('Bilinear')、3次補完('Cubic')、3次スプライン補完('CubicSpline')、ランツォシュ補完('Lanczos')、のいずれかのアルゴリズムを使います。デフォルトは最近傍補完です。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_Rescale</b>(</code>raster  <var class="pdparam">rast</var>, double precision  <var class="pdparam">scalexy</var>, text  <var class="pdparam">algorithm=NearestNeighbour</var>, double precision  <var class="pdparam">maxerr=0.125</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Rescale</b>(</code>raster  <var class="pdparam">rast</var>, double precision  <var class="pdparam">scalex</var>, double precision  <var class="pdparam">scaley</var>, text  <var class="pdparam">algorithm=NearestNeighbour</var>, double precision  <var class="pdparam">maxerr=0.125</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287139818"></a><h2>説明</h2><p>スケール(ピクセルサイズ)だけを調整するリサンプリングを行います。新しいピクセル値は、最近傍補間('NearestNeighbor')、双線形補間('Bilinear')、3次補完('Cubic')、3次スプライン補完('CubicSpline')、ランツォシュ補完('Lanczos')、のいずれかのアルゴリズムを使います。デフォルトは最近傍補完で、最も早いですが最も悪い内挿を行います。</p><p><code class="varname">scalex</code>と<code class="varname">scaley</code>で、新しいピクセルサイズを定義します。ラスタを正しい方向にするには、scaleyは負数でなければなりません。</p><p>新しいscalexまたはscaleyがラスタのwidthまたはheightの除数でない時、結果ラスタの範囲は元のラスタの範囲を含むために拡大されます。</p><p><code class="varname">maxerr</code>が指定されていない場合には0.125とします。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>詳細については<a class="ulink" href="http://www.gdal.org/gdalwarp.html" target="_top">GDAL Warp resampling methods</a>を参照して下さい。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ラスタが既知の空間参照系(SRID)にある場合に限って動作します。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_Rescaleは<a class="xref" href="#RT_ST_SetScale" title="ST_SetScale">ST_SetScale</a>と異なります。ST_SetScaleはラスタの範囲をあわせるためのリサンプリングをしません。根本的に誤った設定を行ったのを訂正するためにラスタのメタデータ(地理参照)を変更するだけです。ST_Rescaleは、入力ラスタの地理範囲に合わせて計算された幅、高さを持つラスタを返します。ST_SetScaleはラスタの幅も高さも変更しません。</p></td></tr></table></div><p>初出: 2.0.0 GDAL 1.6.1以上が必要です。</p></div><div class="refsection" title="例"><a name="id287139868"></a><h2>例</h2><p>ラスタのピクセルサイズを0.001度から0.0015度にリサンプリングする例です。</p><pre class="programlisting">-- 元のラスタのピクセルサイズ
SELECT ST_PixelWidth(ST_AddBand(ST_MakeEmptyRaster(100, 100, 0, 0, 0.001, -0.001, 0, 0, 4269), '8BUI'::text, 1, 0)) width

   width
----------
0.001

-- スケール再設定したラスタのピクセルサイズ
SELECT ST_PixelWidth(ST_Rescale(ST_AddBand(ST_MakeEmptyRaster(100, 100, 0, 0, 0.001, -0.001, 0, 0, 4269), '8BUI'::text, 1, 0), 0.0015)) width

   width
----------
0.0015
</pre></div><div class="refsection" title="関連情報"><a name="id287139883"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_SetScale" title="ST_SetScale">ST_SetScale</a>, <a class="xref" href="#RT_ST_ScaleX" title="ST_ScaleX">ST_ScaleX</a>, <a class="xref" href="#RT_ST_ScaleY" title="ST_ScaleY">ST_ScaleY</a>, <a class="xref" href="#RT_ST_Resample" title="ST_Resample">ST_Resample</a>, <a class="xref" href="#RT_ST_Transform" title="ST_Transform">ST_Transform</a></p></div></div><div class="refentry" title="ST_Reskew"><div class="refentry.separator"><hr></div><a name="RT_ST_Reskew"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Reskew ? スキュー(回転パラメタ)の調整によるリサンプリングを行います。新しいピクセル値は、最近傍補間('NearestNeighbor')、双線形補間('Bilinear')、3次補完('Cubic')、3次スプライン補完('CubicSpline')、ランツォシュ補完('Lanczos')、のいずれかのアルゴリズムを使います。デフォルトは最近傍補完です。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_Reskew</b>(</code>raster  <var class="pdparam">rast</var>, double precision  <var class="pdparam">skewxy</var>, text  <var class="pdparam">algorithm=NearestNeighbour</var>, double precision  <var class="pdparam">maxerr=0.125</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Reskew</b>(</code>raster  <var class="pdparam">rast</var>, double precision  <var class="pdparam">skewx</var>, double precision  <var class="pdparam">skewy</var>, text  <var class="pdparam">algorithm=NearestNeighbour</var>, double precision  <var class="pdparam">maxerr=0.125</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287140064"></a><h2>説明</h2><p>スキュー(回転パラメタ)の調整によるリサンプリングを行います。新しいピクセル値は、最近傍補間('NearestNeighbor')、双線形補間('Bilinear')、3次補完('Cubic')、3次スプライン補完('CubicSpline')、ランツォシュ補完('Lanczos')、のいずれかのアルゴリズムを使います。デフォルトは最近傍補完で、最も早いですが最も悪い内挿を行います。</p><p><code class="varname">skewx</code>と<code class="varname">skewy</code>によって新しいスキューが定義されます。</p><p>新しいラスタの範囲は元のラスタの範囲を含みます。</p><p><code class="varname">maxerr</code>が指定されていない場合には0.125とします。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ラスタが既知の空間参照系(SRID)にある場合に限って動作します。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>詳細については<a class="ulink" href="http://www.gdal.org/gdalwarp.html" target="_top">GDAL Warp resampling methods</a>を参照して下さい。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_Reskewは<a class="xref" href="#RT_ST_SetSkew" title="ST_SetSkew">ST_SetSkew</a>と異なります。ST_SetSkewはラスタの範囲をあわせるためのリサンプリングをしません。根本的に誤った設定を行ったのを訂正するためにラスタのメタデータ(地理参照)を変更するだけです。ST_Reskewは、入力ラスタの地理範囲に合わせて計算された幅、高さを持つラスタを返します。ST_SetSkewはラスタの幅も高さも変更しません。</p></td></tr></table></div><p>初出: 2.0.0 GDAL 1.6.1以上が必要です。</p></div><div class="refsection" title="例"><a name="id287140115"></a><h2>例</h2><p>スキューを0.0から0.0015に変えてリサンプリングを行う例です。</p><pre class="programlisting">-- 元のラスタのピクセルサイズ
SELECT ST_Rotation(ST_AddBand(ST_MakeEmptyRaster(100, 100, 0, 0, 0.001, -0.001, 0, 0, 4269), '8BUI'::text, 1, 0))
					
-- リサンプリングされたラスタのピクセルサイズ
SELECT ST_Rotation(ST_Reskew(ST_AddBand(ST_MakeEmptyRaster(100, 100, 0, 0, 0.001, -0.001, 0, 0, 4269), '8BUI'::text, 1, 0), 0.0015))
                    </pre></div><div class="refsection" title="関連情報"><a name="id287140129"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Resample" title="ST_Resample">ST_Resample</a>, <a class="xref" href="#RT_ST_Rescale" title="ST_Rescale">ST_Rescale</a>, <a class="xref" href="#RT_ST_SetSkew" title="ST_SetSkew">ST_SetSkew</a>, <a class="xref" href="#RT_ST_SetRotation" title="ST_SetRotation">ST_SetRotation</a>, <a class="xref" href="#RT_ST_SkewX" title="ST_SkewX">ST_SkewX</a>, <a class="xref" href="#RT_ST_SkewY" title="ST_SkewY">ST_SkewY</a>, <a class="xref" href="#RT_ST_Transform" title="ST_Transform">ST_Transform</a></p></div></div><div class="refentry" title="ST_SnapToGrid"><div class="refentry.separator"><hr></div><a name="RT_ST_SnapToGrid"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SnapToGrid ? グリッドにスナップさせるリサンプリングを行います。新しいピクセル値は、最近傍補間('NearestNeighbor')、双線形補間('Bilinear')、3次補完('Cubic')、3次スプライン補完('CubicSpline')、ランツォシュ補完('Lanczos')、のいずれかのアルゴリズムを使います。デフォルトは最近傍補完です。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_SnapToGrid</b>(</code>raster  <var class="pdparam">rast</var>, double precision  <var class="pdparam">gridx</var>, double precision  <var class="pdparam">gridy</var>, text  <var class="pdparam">algorithm=NearestNeighbour</var>, double precision  <var class="pdparam">maxerr=0.125</var>, double precision  <var class="pdparam">scalex=DEFAULT 0</var>, double precision  <var class="pdparam">scaley=DEFAULT 0</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_SnapToGrid</b>(</code>raster  <var class="pdparam">rast</var>, double precision  <var class="pdparam">gridx</var>, double precision  <var class="pdparam">gridy</var>, double precision  <var class="pdparam">scalex</var>, double precision  <var class="pdparam">scaley</var>, text  <var class="pdparam">algorithm=NearestNeighbour</var>, double precision  <var class="pdparam">maxerr=0.125</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_SnapToGrid</b>(</code>raster  <var class="pdparam">rast</var>, double precision  <var class="pdparam">gridx</var>, double precision  <var class="pdparam">gridy</var>, double precision  <var class="pdparam">scalexy</var>, text  <var class="pdparam">algorithm=NearestNeighbour</var>, double precision  <var class="pdparam">maxerr=0.125</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287140732"></a><h2>説明</h2><p>任意のピクセル角(gridx, gridy)で定義されるグリッドにスナップさせるリサンプリングを行います。新しいピクセル値は、最近傍補間('NearestNeighbor')、双線形補間('Bilinear')、3次補完('Cubic')、3次スプライン補完('CubicSpline')、ランツォシュ補完('Lanczos')、のいずれかのアルゴリズムを使います。デフォルトは最近傍補完で、最も早いですが最も悪い内挿を行います。</p><p><code class="varname">gridx</code>と<code class="varname">gridy</code>は、新しいグリッドの任意のピクセルの角を定義します。必ずしも新しいラスタの左上隅であるわけではありませんし、新しいラスタ範囲の内側にある必要も端にある必要もありません。</p><p>任意で新しいグリッドのピクセルサイズを<code class="varname">scalex</code>と<code class="varname">scaley</code>で定義することができます。</p><p>新しいラスタの範囲は元のラスタの範囲を含みます。</p><p><code class="varname">maxerr</code>が指定されていない場合には0.125とします。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ラスタが既知の空間参照系(SRID)にある場合に限って動作します。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>詳細については<a class="ulink" href="http://www.gdal.org/gdalwarp.html" target="_top">GDAL Warp resampling methods</a>を参照して下さい。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>グリッドパラメタより多くの制御が必要な場合には、<a class="xref" href="#RT_ST_Resample" title="ST_Resample">ST_Resample</a>を使います。</p></td></tr></table></div><p>初出: 2.0.0 GDAL 1.6.1以上が必要です。</p></div><div class="refsection" title="例"><a name="id287140792"></a><h2>例</h2><p>ラスタをわずかに異なるグリッドにスナップさせる例です。</p><pre class="programlisting">-- 元のラスタのピクセルサイズ
SELECT ST_UpperLeftX(ST_AddBand(ST_MakeEmptyRaster(10, 10, 0, 0, 0.001, -0.001, 0, 0, 4269), '8BUI'::text, 1, 0))
					
-- リサンプリングしたラスタのピクセルサイズ
SELECT ST_UpperLeftX(ST_SnapToGrid(ST_AddBand(ST_MakeEmptyRaster(10, 10, 0, 0, 0.001, -0.001, 0, 0, 4269), '8BUI'::text, 1, 0), 0.0002, 0.0002))
                    </pre></div><div class="refsection" title="関連情報"><a name="id287140841"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Resample" title="ST_Resample">ST_Resample</a>, <a class="xref" href="#RT_ST_Rescale" title="ST_Rescale">ST_Rescale</a>, <a class="xref" href="#RT_ST_UpperLeftX" title="ST_UpperLeftX">ST_UpperLeftX</a>, <a class="xref" href="#RT_ST_UpperLeftY" title="ST_UpperLeftY">ST_UpperLeftY</a></p></div></div><div class="refentry" title="ST_Transform"><div class="refentry.separator"><hr></div><a name="RT_ST_Transform"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Transform ? ラスタを既知の空間参照系から他の既知の空間参照系に、指定したリサンプリングアルゴリズムで投影変換します。選択肢は、最近傍補間('NearestNeighbor')、双線形補間('Bilinear')、3次補完('Cubic')、3次スプライン補完('CubicSpline')、ランツォシュ補完('Lanczos')、があります。デフォルトは最近傍補完です。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_Transform</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">srid</var>, double precision  <var class="pdparam">scalex</var>, double precision  <var class="pdparam">scaley</var>, text  <var class="pdparam">algorithm=NearestNeighbor</var>, double precision  <var class="pdparam">maxerr=0.125</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Transform</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">srid</var>, text  <var class="pdparam">algorithm=NearestNeighbor</var>, double precision  <var class="pdparam">maxerr=0.125</var>, double precision  <var class="pdparam">scalex</var>, double precision  <var class="pdparam">scaley</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287141046"></a><h2>説明</h2><p>ラスタを既知の空間参照系から他の既知の空間参照系に、指定したリサンプリングアルゴリズムで投影変換します。algorithmが指定されていない場合には'NearestNeighbor'とし、maxerrorが指定されていない場合には0.125とします。</p><p>アルゴリズムの選択肢は、最近傍補間('NearestNeighbor')、双線形補間('Bilinear')、3次補完('Cubic')、3次スプライン補完('CubicSpline')、ランツォシュ補完('Lanczos')です。詳細については<a class="ulink" href="http://www.gdal.org/gdalwarp.html" target="_top">GDAL Warp resampling methods</a>を参照して下さい。</p><p>初出: 2.0.0 GDAL 1.6.1以上が必要です。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>変換機能が思ったように働かない場合には、環境変数PROJSOをPostGISが使用する投影変換ライブラリの.soまたは.dllに指定する必要があるかも知れません。ファイル名の指定だけ必要です。Windowsでの例として、コントロールパネル→システム→システムの詳細設定→環境変数で、<code class="varname">PROJSO</code>という名前のシステム変数を追加して、<code class="varname">libproj.dll</code>(Proj 4.6.1を使用している場合)を設定します。変更後はPostgreSQLサービス/デーモンを再起動します。</p></td></tr></table></div></div><div class="refsection" title="例"><a name="id287141078"></a><h2>例</h2><pre class="programlisting">SELECT ST_Width(mass_stm) As w_before, ST_Width(wgs_84) As w_after,
  ST_Height(mass_stm) As h_before, ST_Height(wgs_84) As h_after
	FROM 
	( SELECT rast As mass_stm, ST_Transform(rast,4326) As wgs_84
  ,  ST_Transform(rast,4326, 'Bilinear') AS wgs_84_bilin
		FROM aerials.o_2_boston 
			WHERE ST_Intersects(rast,
				ST_Transform(ST_MakeEnvelope(-71.128, 42.2392,-71.1277, 42.2397, 4326),26986) )
		LIMIT 1) As foo;
						
 w_before | w_after | h_before | h_after
----------+---------+----------+---------
      200 |     228 |      200 |     170
					</pre><div class="informaltable"><table border="1"><colgroup><col><col><col></colgroup><tbody><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/rt_st_transform01.png"><div class="caption"><p>元のラスタはメートル単位のマサチューセッツ州平面(mass_stm)</p></div></div></div>
		 </td><td><div class="informalfigure"><div class="mediaobject"><img src="images/rt_st_transform02.png"><div class="caption"><p>WGS84経度緯度に変換した後(wgs_84)</p></div></div></div>
		 </td><td><div class="informalfigure"><div class="mediaobject"><img src="images/rt_st_transform03.png"><div class="caption"><p>最近傍補完の代わりに双線形補間を使ってWGS84経度緯度に変換した後(wgs_84_bilin)</p></div></div></div>
		 </td></tr></tbody></table></div></div><div class="refsection" title="関連情報"><a name="id287141168"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Transform" title="ST_Transform">ST_Transform</a>, <a class="xref" href="#RT_ST_SetSRID" title="ST_SetSRID">ST_SetSRID</a></p></div></div></div><div class="sect1" title="9.8. ラスタバンド エディタ"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="RasterBand_Editors"></a>9.8. ラスタバンド エディタ</h2></div></div></div><div class="toc"><dl><dt><span class="refentrytitle"><a href="#RT_ST_SetBandNoDataValue">ST_SetBandNoDataValue</a></span><span class="refpurpose"> ? 指定したバンドにNODATAを表現する値を設定します。バンドを指定しない場合は1番と仮定します。NODATA値を持たないようにするには、nodatavalue = NULLとします。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_SetBandIsNoData">ST_SetBandIsNoData</a></span><span class="refpurpose"> ? バンドのisnodataフラグをTRUEにします。ST_BandIsNoData(rast, band) != ST_BandIsNodata(rast, band, TRUE)となり、isnodataフラグが汚れている場合に使用することがあります。バンドを指定しない場合は1番バンドと仮定します。</span></dt></dl></div><div class="refentry" title="ST_SetBandNoDataValue"><a name="RT_ST_SetBandNoDataValue"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SetBandNoDataValue ? 指定したバンドにNODATAを表現する値を設定します。バンドを指定しない場合は1番と仮定します。NODATA値を持たないようにするには、nodatavalue = NULLとします。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_SetBandNoDataValue</b>(</code>raster  <var class="pdparam">rast</var>, double precision  <var class="pdparam">nodatavalue</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_SetBandNoDataValue</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">band</var>, double precision  <var class="pdparam">nodatavalue</var>, boolean  <var class="pdparam">forcechecking=false</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287141317"></a><h2>説明</h2><p>指定したバンドにNODATAを表現する値を設定します。バンドを指定しない場合は1番と仮定します。これは<a class="xref" href="#RT_ST_Polygon" title="ST_Polygon">ST_Polygon</a>と<a class="xref" href="#RT_ST_ConvexHull" title="ST_ConvexHull">ST_ConvexHull</a>の結果に影響を与えます。</p></div><div class="refsection" title="例"><a name="id287141333"></a><h2>例</h2><pre class="programlisting">-- 1番バンドのNODATA値を変更します
UPDATE dummy_rast 
	SET rast = ST_SetBandNoDataValue(rast,1, 254)  
WHERE rid = 2;

-- change no data band value of bands 1,2,3
UPDATE dummy_rast 
	SET rast = 
		ST_SetBandNoDataValue(
			ST_SetBandNoDataValue(
				ST_SetBandNoDataValue(
					rast,1, 254)
				,2,99),
				3,108)  
		WHERE rid = 2;
		
-- NODATA値の設定を解除して、全てのピクセルが処理されるようにします
UPDATE dummy_rast 
	SET rast = ST_SetBandNoDataValue(rast,1, NULL)  
WHERE rid = 2;
					</pre></div><div class="refsection" title="関連情報"><a name="id287141344"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_BandNoDataValue" title="ST_BandNoDataValue">ST_BandNoDataValue</a>, <a class="xref" href="#RT_ST_NumBands" title="ST_NumBands">ST_NumBands</a></p></div></div><div class="refentry" title="ST_SetBandIsNoData"><div class="refentry.separator"><hr></div><a name="RT_ST_SetBandIsNoData"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SetBandIsNoData ? バンドのisnodataフラグをTRUEにします。ST_BandIsNoData(rast, band) != ST_BandIsNodata(rast, band, TRUE)となり、isnodataフラグが汚れている場合に使用することがあります。バンドを指定しない場合は1番バンドと仮定します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_SetBandIsNoData</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">band=1</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287141406"></a><h2>説明</h2><p>バンドのisnodataフラグをTRUEにします。バンドを指定しない場合は1番バンドと仮定します。isnodataフラグが汚れている場合にのみ呼ぶべきものです。これは、<a class="xref" href="#RT_ST_BandIsNoData" title="ST_BandIsNoData">ST_BandIsNoData</a>の、最後の引数にTRUEを設定した場合の結果と指定しない場合の結果とで異なっている時です。</p><p>初出: 2.0.0</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ローダ(raster2pgsql.py)は現在のところ、ラスタデータをロードする時に確実なバンドへのisnodataフラグの設定ができません。この関数がTRUEを設定する最も早い方法で、他のバンド値を変更しません。</p></td></tr></table></div></div><div class="refsection" title="例"><a name="id287141428"></a><h2>例</h2><pre class="programlisting">
-- ラスタカラムを1つ持つダミーテーブルを生成します
create table dummy_rast (rid integer, rast raster);

-- 2バンドでバンドごとに1ピクセルを持つラスタを追加します
-- ひとつめのバンドにはnodatavalueとピクセル値をともに3とし、
-- ふたつめのバンドにはnodatavalue=13とピクセル値=4とします。
insert into dummy_rast values(1,
(
'01' -- little endian (uint8 ndr)
|| 
'0000' -- version (uint16 0)
||
'0200' -- nBands (uint16 0)
||
'17263529ED684A3F' -- scaleX (float64 0.000805965234044584)
||
'F9253529ED684ABF' -- scaleY (float64 -0.00080596523404458)
||
'1C9F33CE69E352C0' -- ipX (float64 -75.5533328537098)
||
'718F0E9A27A44840' -- ipY (float64 49.2824585505576)
||
'ED50EB853EC32B3F' -- skewX (float64 0.000211812383858707)
||
'7550EB853EC32B3F' -- skewY (float64 0.000211812383858704)
||
'E6100000' -- SRID (int32 4326)
||
'0100' -- width (uint16 1)
||
'0100' -- height (uint16 1)
||
'4' -- hasnodatavalue set to true, isnodata value set to false (when it should be true)
||
'2' -- first band type (4BUI) 
||
'03' -- novalue==3
||
'03' -- pixel(0,0)==3 (same that nodata)
||
'0' -- hasnodatavalue set to false
||
'5' -- second band type (16BSI)
||
'0D00' -- novalue==13
||
'0400' -- pixel(0,0)==4
)::raster
);

select st_bandisnodata(rast, 1) from dummy_rast where rid = 1; -- FALSEを期待
select st_bandisnodata(rast, 1, TRUE) from dummy_rast where rid = 1; -- TRUEを期待

-- isnodataフラグが汚れているのでTRUEに設定します
update dummy_rast set rast = st_setbandisnodata(rast, 1) where rid = 1;


select st_bandisnodata(rast, 1) from dummy_rast where rid = 1; -- Expected true

                    </pre></div><div class="refsection" title="関連情報"><a name="id287141438"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_BandNoDataValue" title="ST_BandNoDataValue">ST_BandNoDataValue</a>, <a class="xref" href="#RT_ST_NumBands" title="ST_NumBands">ST_NumBands</a>, <a class="xref" href="#RT_ST_SetBandNoDataValue" title="ST_SetBandNoDataValue">ST_SetBandNoDataValue</a>, <a class="xref" href="#RT_ST_BandIsNoData" title="ST_BandIsNoData">ST_BandIsNoData</a></p></div></div></div><div class="sect1" title="9.9. ラスタバンド統計情報と解析"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="RasterBand_Stats"></a>9.9. ラスタバンド統計情報と解析</h2></div></div></div><div class="toc"><dl><dt><span class="refentrytitle"><a href="#RT_ST_Count">ST_Count</a></span><span class="refpurpose"> ? ラスタまたはラスタカバレッジの指定したバンドのピクセル数を返します。バンドを指定しない場合は1番と仮定します。exclude_nodata_valueをTRUEに設定している場合には、NODATA値と等しくないピクセルのみを数えます。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Histogram">ST_Histogram</a></span><span class="refpurpose"> ? ラスタまたはラスタカバレッジのビン範囲で分割したデータ分布をまとめるヒストグラムの集合を返します。ビン数を指定しない場合には自動計算されます。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Quantile">ST_Quantile</a></span><span class="refpurpose"> ? ラスタまたはラスタテーブルカバレッジのサンプルまたは母集団の分位数を計算します。値がラスタの25%,50%,75%にあるかを調べることができます。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_SummaryStats">ST_SummaryStats</a></span><span class="refpurpose"> ? ラスタまたはラスタカバレッジの指定したバンドについて、ピクセル数、合計値、平均値、標準偏差、最小値、最大値からなる統計情報の概要を返します。バンドを指定しない場合は1番と仮定します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_ValueCount">ST_ValueCount</a></span><span class="refpurpose"> ? 
ラスタ(またはラスタカバレッジの)指定されたバンドで、指定した値を持つピクセルを対象として、ピクセルバンド値とピクセル数からなるレコードの集合を返します。バンドを指定しない場合は1番と仮定します。デフォルトではNODATA値のピクセルは数えられず、ピクセルの他の値は出力され、ピクセルバンド値は最も近い整数に丸められます。</span></dt></dl></div><div class="refentry" title="ST_Count"><a name="RT_ST_Count"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Count ? ラスタまたはラスタカバレッジの指定したバンドのピクセル数を返します。バンドを指定しない場合は1番と仮定します。exclude_nodata_valueをTRUEに設定している場合には、NODATA値と等しくないピクセルのみを数えます。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">bigint <b class="fsfunc">ST_Count</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband=1</var>, boolean  <var class="pdparam">exclude_nodata_value=true</var><code>)</code>;</p><p><code class="funcdef">bigint <b class="fsfunc">ST_Count</b>(</code>raster  <var class="pdparam">rast</var>, boolean  <var class="pdparam">exclude_nodata_value</var><code>)</code>;</p><p><code class="funcdef">bigint <b class="fsfunc">ST_Count</b>(</code>text  <var class="pdparam">rastertable</var>, text  <var class="pdparam">rastercolumn</var>, integer  <var class="pdparam">nband=1</var>, boolean  <var class="pdparam">exclude_nodata_value=true</var><code>)</code>;</p><p><code class="funcdef">bigint <b class="fsfunc">ST_Count</b>(</code>text  <var class="pdparam">rastertable</var>, text  <var class="pdparam">rastercolumn</var>, boolean  <var class="pdparam">exclude_nodata_value</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287141669"></a><h2>説明</h2><p>ラスタまたはラスタカバレッジの指定したバンドのピクセル数を返します。<code class="varname">nband</code>でバンドを指定しない場合は1番と仮定します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">exclude_nodata_value</code>をTRUEに設定している場合には、<code class="varname">nodata</code>値と等しくないピクセルのみ数えます。<code class="varname">exclude_nodata_value</code>をFALSEに設定している場合には、全てのピクセルを数えます。</p></td></tr></table></div><p>初出: 2.0.0 </p></div><div class="refsection" title="例"><a name="id287141733"></a><h2>例</h2><pre class="programlisting">
-- 249でないピクセルを数え上げと、全てのピクセルの数え上げを行います --
SELECT rid, ST_Count(ST_SetBandNoDataValue(rast,249)) As exclude_nodata, 
        ST_Count(ST_SetBandNoDataValue(rast,249),false) As include_nodata
    FROM dummy_rast WHERE rid=2;
				    
rid | exclude_nodata | include_nodata
-----+----------------+----------------
   2 |             23 |             25
				</pre></div><div class="refsection" title="関連情報"><a name="id287141746"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_SetBandNoDataValue" title="ST_SetBandNoDataValue">ST_SetBandNoDataValue</a></p></div></div><div class="refentry" title="ST_Histogram"><div class="refentry.separator"><hr></div><a name="RT_ST_Histogram"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Histogram ? ラスタまたはラスタカバレッジのビン範囲で分割したデータ分布をまとめるヒストグラムの集合を返します。ビン数を指定しない場合には自動計算されます。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">SETOF histogram <b class="fsfunc">ST_Histogram</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband=1</var>, boolean  <var class="pdparam">exclude_nodata_value=true</var>, integer  <var class="pdparam">bins=autocomputed</var>, double precision[]  <var class="pdparam">width=NULL</var>, boolean  <var class="pdparam">right=false</var><code>)</code>;</p><p><code class="funcdef">SETOF histogram <b class="fsfunc">ST_Histogram</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, integer  <var class="pdparam">bins</var>, double precision[]  <var class="pdparam">width=NULL</var>, boolean  <var class="pdparam">right=false</var><code>)</code>;</p><p><code class="funcdef">SETOF histogram <b class="fsfunc">ST_Histogram</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, boolean  <var class="pdparam">exclude_nodata_value</var>, integer  <var class="pdparam">bins</var>, boolean  <var class="pdparam">right</var><code>)</code>;</p><p><code class="funcdef">SETOF histogram <b class="fsfunc">ST_Histogram</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, integer  <var class="pdparam">bins</var>, boolean  <var class="pdparam">right</var><code>)</code>;</p><p><code class="funcdef">SETOF histogram <b class="fsfunc">ST_Histogram</b>(</code>text  <var class="pdparam">rastertable</var>, text  <var class="pdparam">rastercolumn</var>, integer  <var class="pdparam">nband</var>, integer  <var class="pdparam">bins</var>, boolean  <var class="pdparam">right</var><code>)</code>;</p><p><code class="funcdef">SETOF histogram <b class="fsfunc">ST_Histogram</b>(</code>text  <var class="pdparam">rastertable</var>, text  <var class="pdparam">rastercolumn</var>, integer  <var class="pdparam">nband</var>, boolean  <var class="pdparam">exclude_nodata_value</var>, integer  <var class="pdparam">bins</var>, boolean  <var class="pdparam">right</var><code>)</code>;</p><p><code class="funcdef">SETOF histogram <b class="fsfunc">ST_Histogram</b>(</code>text  <var class="pdparam">rastertable</var>, text  <var class="pdparam">rastercolumn</var>, integer  <var class="pdparam">nband=1</var>, boolean  <var class="pdparam">exclude_nodata_value=true</var>, integer  <var class="pdparam">bins=autocomputed</var>, double precision[]  <var class="pdparam">width=NULL</var>, boolean  <var class="pdparam">right=false</var><code>)</code>;</p><p><code class="funcdef">SETOF histogram <b class="fsfunc">ST_Histogram</b>(</code>text  <var class="pdparam">rastertable</var>, text  <var class="pdparam">rastercolumn</var>, integer  <var class="pdparam">nband=1</var>, integer  <var class="pdparam">bins</var>, double precision[]  <var class="pdparam">width=NULL</var>, boolean  <var class="pdparam">right=false</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287142286"></a><h2>説明</h2><p>最小値、最大値、合計数、全体から見た割合からなる<code class="varname">histogram</code>レコードの集合を返します。<code class="varname">nband</code>でバンドを指定しない場合は1番と仮定します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>デフォルトでは、<code class="varname">nodata</code>値と等しくないピクセルのみ数えます。<code class="varname">exclude_nodata_value</code>をFALSEに設定すると全てのピクセルを数えます。</p></td></tr></table></div><div class="variablelist"><dl><dt><span class="term"><em class="parameter"><code>width </code></em><span class="type">double precision[]</span></span></dt><dd><p>ビン毎の幅を示す配列です。ビン数の指定がwidth要素数を超える場合には、widthを繰り返します。</p><p>例: ビンが9でwidthが[a, b, c]となる場合の出力は[a, b, c, a, b, c, a, b, c]です。</p></dd><dt><span class="term"><em class="parameter"><code>bins </code></em><span class="type">integer</span></span></dt><dd><p>取り出し数 -- 関数から戻そうとするレコード数です。指定しない場合には、自動計算されます。</p></dd><dt><span class="term"><em class="parameter"><code>right </code></em><span class="type">boolean</span></span></dt><dd><p>
ヒストグラムを右から計算します(デフォルトは左からです)。値の評価の優先順位が[a, b)から(a, b]に変わります。</p></dd></dl></div><p>初出: 2.0.0 </p></div><div class="refsection" title="例: 単一ラスタタイル - ビン数を自動計算とした、1番、2番、3番バンドのヒストグラムの計算"><a name="id287142370"></a><h2>例: 単一ラスタタイル - ビン数を自動計算とした、1番、2番、3番バンドのヒストグラムの計算</h2><pre class="programlisting">SELECT band, (stats).*
FROM (SELECT rid, band, ST_Histogram(rast, band) As stats
    FROM dummy_rast CROSS JOIN generate_series(1,3) As band
     WHERE rid=2) As foo;
				    
 band |  min  |  max  | count | percent
------+-------+-------+-------+---------
    1 |   249 |   250 |     2 |    0.08
    1 |   250 |   251 |     2 |    0.08
    1 |   251 |   252 |     1 |    0.04
    1 |   252 |   253 |     2 |    0.08
    1 |   253 |   254 |    18 |    0.72
    2 |    78 | 113.2 |    11 |    0.44
    2 | 113.2 | 148.4 |     4 |    0.16
    2 | 148.4 | 183.6 |     4 |    0.16
    2 | 183.6 | 218.8 |     1 |    0.04
    2 | 218.8 |   254 |     5 |     0.2
    3 |    62 | 100.4 |    11 |    0.44
    3 | 100.4 | 138.8 |     5 |     0.2
    3 | 138.8 | 177.2 |     4 |    0.16
    3 | 177.2 | 215.6 |     1 |    0.04
    3 | 215.6 |   254 |     4 |    0.16</pre></div><div class="refsection" title="例: ビン数を6で固定して2番バンドだけを計算"><a name="id287142381"></a><h2>例: ビン数を6で固定して2番バンドだけを計算</h2><pre class="programlisting">SELECT (stats).*
FROM (SELECT rid, ST_Histogram(rast, 2,6) As stats
    FROM dummy_rast 
     WHERE rid=2) As foo;
				    
    min     |    max     | count | percent
------------+------------+-------+---------
         78 | 107.333333 |     9 |    0.36
 107.333333 | 136.666667 |     6 |    0.24
 136.666667 |        166 |     0 |       0
        166 | 195.333333 |     4 |    0.16
 195.333333 | 224.666667 |     1 |    0.04
 224.666667 |        254 |     5 |     0.2
(6 rows)
    
-- 前と同じですが、明示的にビン毎のピクセル値範囲を指定しています
SELECT (stats).*
FROM (SELECT rid, ST_Histogram(rast, 2,6,ARRAY[0.5,1,4,100,5]) As stats
    FROM dummy_rast 
     WHERE rid=2) As foo;
     
  min  |  max  | count | percent
-------+-------+-------+----------
    78 |  78.5 |     1 |     0.08
  78.5 |  79.5 |     1 |     0.04
  79.5 |  83.5 |     0 |        0
  83.5 | 183.5 |    17 |   0.0068
 183.5 | 188.5 |     0 |        0
 188.5 |   254 |     6 | 0.003664
(6 rows)</pre></div><div class="refsection" title="関連情報"><a name="id287142392"></a><h2>関連情報</h2><p><a class="xref" href="#histogram" title="ヒストグラム">ヒストグラム</a>, <a class="xref" href="#RT_ST_Count" title="ST_Count">ST_Count</a>, <a class="xref" href="#RT_ST_SummaryStats" title="ST_SummaryStats">ST_SummaryStats</a></p></div></div><div class="refentry" title="ST_Quantile"><div class="refentry.separator"><hr></div><a name="RT_ST_Quantile"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Quantile ? ラスタまたはラスタテーブルカバレッジのサンプルまたは母集団の分位数を計算します。値がラスタの25%,50%,75%にあるかを調べることができます。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">SETOF quantile <b class="fsfunc">ST_Quantile</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband=1</var>, boolean  <var class="pdparam">exclude_nodata_value=true</var>, double precision[]  <var class="pdparam">quantiles=NULL</var><code>)</code>;</p><p><code class="funcdef">SETOF quantile <b class="fsfunc">ST_Quantile</b>(</code>raster  <var class="pdparam">rast</var>, double precision[]  <var class="pdparam">quantiles</var><code>)</code>;</p><p><code class="funcdef">SETOF quantile <b class="fsfunc">ST_Quantile</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, double precision[]  <var class="pdparam">quantiles</var><code>)</code>;</p><p><code class="funcdef">double precision <b class="fsfunc">ST_Quantile</b>(</code>raster  <var class="pdparam">rast</var>, double precision  <var class="pdparam">quantile</var><code>)</code>;</p><p><code class="funcdef">double precision <b class="fsfunc">ST_Quantile</b>(</code>raster  <var class="pdparam">rast</var>, boolean  <var class="pdparam">exclude_nodata_value</var>, double precision  <var class="pdparam">quantile=NULL</var><code>)</code>;</p><p><code class="funcdef">double precision <b class="fsfunc">ST_Quantile</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, double precision  <var class="pdparam">quantile</var><code>)</code>;</p><p><code class="funcdef">double precision <b class="fsfunc">ST_Quantile</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, boolean  <var class="pdparam">exclude_nodata_value</var>, double precision  <var class="pdparam">quantile</var><code>)</code>;</p><p><code class="funcdef">double precision <b class="fsfunc">ST_Quantile</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, double precision  <var class="pdparam">quantile</var><code>)</code>;</p><p><code class="funcdef">setof quantile <b class="fsfunc">ST_Quantile</b>(</code>text  <var class="pdparam">rastertable</var>, text  <var class="pdparam">rastercolumn</var>, integer  <var class="pdparam">nband=1</var>, boolean  <var class="pdparam">exclude_nodata_value=true</var>, double precision[]  <var class="pdparam">quantiles=NULL</var><code>)</code>;</p><p><code class="funcdef">setof quantile <b class="fsfunc">ST_Quantile</b>(</code>text  <var class="pdparam">rastertable</var>, text  <var class="pdparam">rastercolumn</var>, integer  <var class="pdparam">nband</var>, double precision[]  <var class="pdparam">quantiles</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287142893"></a><h2>説明</h2><p>ラスタまたはラスタテーブルカバレッジのサンプルまたは母集団の分位数を計算します。値がラスタの25%,50%,75%にあるかを調べることができます。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">exclude_nodata_value</code>をFALSEに設定している場合には、NODATA値となるピクセルも数えます。</p></td></tr></table></div><p>初出: 2.0.0 </p></div><div class="refsection" title="例"><a name="id287142914"></a><h2>例</h2><pre class="programlisting">
UPDATE dummy_rast SET rast = ST_SetBandNoDataValue(rast,249) WHERE rid=2;
-- 1番バンドの値が249でないピクセルのみ考慮に入れた分位数を計算する例です

SELECT (pvq).*
FROM (SELECT ST_Quantile(rast, ARRAY[0.25,0.75]) As pvq
    FROM dummy_rast WHERE rid=2) As foo
    ORDER BY (pvq).quantile;
				    			    
 quantile | value
----------+-------
     0.25 |   253
     0.75 |   254
   
SELECT ST_Quantile(rast, 0.75) As value
    FROM dummy_rast WHERE rid=2;
    
value
------
  254
</pre><pre class="programlisting">
-- 実際の例です。2番バンドでジオメトリとインタセクトする部分の
--   全てのピクセルの分位数を計算します。
SELECT rid, (ST_Quantile(rast,2)).* As pvc
    FROM o_4_boston 
        WHERE ST_Intersects(rast, 
            ST_GeomFromText('POLYGON((224486 892151,224486 892200,224706 892200,224706 892151,224486 892151))',26986)
            )
ORDER BY value, quantile,rid
;
				
    
 rid | quantile | value
-----+----------+-------
   1 |        0 |     0
   2 |        0 |     0
  14 |        0 |     1
  15 |        0 |     2
  14 |     0.25 |    37
   1 |     0.25 |    42
  15 |     0.25 |    47
   2 |     0.25 |    50
  14 |      0.5 |    56
   1 |      0.5 |    64
  15 |      0.5 |    66
   2 |      0.5 |    77
  14 |     0.75 |    81
  15 |     0.75 |    87
   1 |     0.75 |    94
   2 |     0.75 |   106
  14 |        1 |   199
   1 |        1 |   244
   2 |        1 |   255
  15 |        1 |   255
</pre></div><div class="refsection" title="関連情報"><a name="id287142929"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Count" title="ST_Count">ST_Count</a>, <a class="xref" href="#RT_ST_SetBandNoDataValue" title="ST_SetBandNoDataValue">ST_SetBandNoDataValue</a></p></div></div><div class="refentry" title="ST_SummaryStats"><div class="refentry.separator"><hr></div><a name="RT_ST_SummaryStats"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SummaryStats ? ラスタまたはラスタカバレッジの指定したバンドについて、ピクセル数、合計値、平均値、標準偏差、最小値、最大値からなる統計情報の概要を返します。バンドを指定しない場合は1番と仮定します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">summarystats <b class="fsfunc">ST_SummaryStats</b>(</code>text  <var class="pdparam">rastertable</var>, text  <var class="pdparam">rastercolumn</var>, boolean  <var class="pdparam">exclude_nodata_value</var><code>)</code>;</p><p><code class="funcdef">summarystats <b class="fsfunc">ST_SummaryStats</b>(</code>raster  <var class="pdparam">rast</var>, boolean  <var class="pdparam">exclude_nodata_value</var><code>)</code>;</p><p><code class="funcdef">summarystats <b class="fsfunc">ST_SummaryStats</b>(</code>text  <var class="pdparam">rastertable</var>, text  <var class="pdparam">rastercolumn</var>, integer  <var class="pdparam">nband=1</var>, boolean  <var class="pdparam">exclude_nodata_value=true</var><code>)</code>;</p><p><code class="funcdef">summarystats <b class="fsfunc">ST_SummaryStats</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, boolean  <var class="pdparam">exclude_nodata_value</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287143108"></a><h2>説明</h2><p>ラスタまたはラスタカバレッジの指定したバンドについて、ピクセル数、合計値、平均値、標準偏差、最小値、最大値からなる<code class="varname">summarystats</code>による統計情報の概要を返します。<code class="varname">nband</code>でバンドを指定しない場合は1番と仮定します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>デフォルトでは、<code class="varname">nodata</code>値と等しくないピクセルのみ数えます。<code class="varname">exclude_nodata_value</code>をFALSEに設定している場合には、全てのピクセルを数えます。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>デフォルトでは全てのピクセルをサンプリングします。より速い応答を得るには、<code class="varname">sample_percent</code>を1より小さくします。</p></td></tr></table></div><p>初出: 2.0.0 </p></div><div class="refsection" title="例: 単一ラスタタイル"><a name="id287143146"></a><h2>例: 単一ラスタタイル</h2><pre class="programlisting">
SELECT rid, band, (stats).*
FROM (SELECT rid, band, ST_SummaryStats(rast, band) As stats
    FROM dummy_rast CROSS JOIN generate_series(1,3) As band
     WHERE rid=2) As foo;
				    
 rid | band | count | sum  |    mean    |  stddev   | min | max
-----+------+-------+------+------------+-----------+-----+-----
   2 |    1 |    23 | 5821 | 253.086957 |  1.248061 | 250 | 254
   2 |    2 |    25 | 3682 |     147.28 | 59.862188 |  78 | 254
   2 |    3 |    25 | 3290 |      131.6 | 61.647384 |  62 | 254
				</pre></div><div class="refsection" title="例: 対象とする建物とインタセクトするピクセルの概要"><a name="id287143157"></a><h2>例: 対象とする建物とインタセクトするピクセルの概要</h2><p>この例は、ボストンの建物の全てと空中写真タイル(150x150ピクセルで134,000タイル)とで、Windows 64ビット上のPostGISで計算したところ、574ミリ秒かかりました。</p><pre class="programlisting">WITH 
-- インタセクトする地物
   feat AS (SELECT gid As building_id, geom_26986 As geom FROM buildings AS b 
    WHERE gid IN(100, 103,150)
   ),
-- ラスタタイルの2番バンドを建物の境界で切り取って
-- その範囲の統計情報を得ます
   b_stats AS
	(SELECT  building_id, (stats).*
FROM (SELECT building_id, ST_SummaryStats(ST_Clip(rast,2,geom)) As stats
    FROM aerials.boston
		INNER JOIN feat
	ON ST_Intersects(feat.geom,rast) 
 ) As foo
 )
-- 最後に統計情報の概要を得ます
SELECT building_id, SUM(count) As num_pixels
  , MIN(min) As min_pval
  ,  MAX(max) As max_pval
  , SUM(mean*count)/SUM(count) As avg_pval
	FROM b_stats
 WHERE count &gt; 0
	GROUP BY building_id
	ORDER BY building_id;
 building_id | num_pixels | min_pval | max_pval |     avg_pval
-------------+------------+----------+----------+------------------
         100 |       1090 |        1 |      255 | 61.0697247706422
         103 |        655 |        7 |      182 | 70.5038167938931
         150 |        895 |        2 |      252 | 185.642458100559</pre></div><div class="refsection" title="例:ラスタカバレッジ"><a name="id287143171"></a><h2>例:ラスタカバレッジ</h2><pre class="programlisting">
-- バンドごとの統計情報 --
SELECT band, (stats).*
FROM (SELECT band, ST_SummaryStats('o_4_boston','rast', band) As stats
    FROM generate_series(1,3) As band) As foo;
				    
 band |  count  |  sum   |       mean       |      stddev      | min | max
------+---------+--------+------------------+------------------+-----+-----
    1 | 8450000 | 725799 | 82.7064349112426 | 45.6800222638537 |   0 | 255
    2 | 8450000 | 700487 | 81.4197705325444 | 44.2161184161765 |   0 | 255
    3 | 8450000 | 575943 |  74.682739408284 | 44.2143885481407 |   0 | 255
    
-- テーブルの場合 -- サンプリング率を100%より低くすると早くなります
-- 25%に設定して、速く答を得ています
SELECT band, (stats).*
FROM (SELECT band, ST_SummaryStats('o_4_boston','rast', band,true,0.25) As stats
    FROM generate_series(1,3) As band) As foo;
				    
 band |  count  |  sum   |       mean       |      stddev      | min | max
------+---------+--------+------------------+------------------+-----+-----
    1 | 2112500 | 180686 | 82.6890480473373 | 45.6961043857248 |   0 | 255
    2 | 2112500 | 174571 |  81.448503668639 | 44.2252623171821 |   0 | 255
    3 | 2112500 | 144364 | 74.6765884023669 | 44.2014869384578 |   0 | 255
				</pre></div><div class="refsection" title="関連情報"><a name="id287143181"></a><h2>関連情報</h2><p>
<a class="xref" href="#RT_ST_Count" title="ST_Count">ST_Count</a>,
<a class="xref" href="#summarystats" title="summarystats">summarystats</a>, <a class="xref" href="#RT_ST_Clip" title="ST_Clip">ST_Clip</a>
				</p></div></div><div class="refentry" title="ST_ValueCount"><div class="refentry.separator"><hr></div><a name="RT_ST_ValueCount"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ValueCount ? 
ラスタ(またはラスタカバレッジの)指定されたバンドで、指定した値を持つピクセルを対象として、ピクセルバンド値とピクセル数からなるレコードの集合を返します。バンドを指定しない場合は1番と仮定します。デフォルトではNODATA値のピクセルは数えられず、ピクセルの他の値は出力され、ピクセルバンド値は最も近い整数に丸められます。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">SETOF record <b class="fsfunc">ST_ValueCount</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband=1</var>, boolean  <var class="pdparam">exclude_nodata_value=true</var>, double precision[]  <var class="pdparam">searchvalues=NULL</var>, double precision  <var class="pdparam">roundto=0</var>, double precision  <var class="pdparam">OUT value</var>, integer  <var class="pdparam">OUT count</var><code>)</code>;</p><p><code class="funcdef">SETOF record <b class="fsfunc">ST_ValueCount</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, double precision[]  <var class="pdparam">searchvalues</var>, double precision  <var class="pdparam">roundto=0</var>, double precision  <var class="pdparam">OUT value</var>, integer  <var class="pdparam">OUT count</var><code>)</code>;</p><p><code class="funcdef">SETOF record <b class="fsfunc">ST_ValueCount</b>(</code>raster  <var class="pdparam">rast</var>, double precision[]  <var class="pdparam">searchvalues</var>, double precision  <var class="pdparam">roundto=0</var>, double precision  <var class="pdparam">OUT value</var>, integer  <var class="pdparam">OUT count</var><code>)</code>;</p><p><code class="funcdef">bigint <b class="fsfunc">ST_ValueCount</b>(</code>raster  <var class="pdparam">rast</var>, double precision  <var class="pdparam">searchvalue</var>, double precision  <var class="pdparam">roundto=0</var><code>)</code>;</p><p><code class="funcdef">bigint <b class="fsfunc">ST_ValueCount</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, boolean  <var class="pdparam">exclude_nodata_value</var>, double precision  <var class="pdparam">searchvalue</var>, double precision  <var class="pdparam">roundto=0</var><code>)</code>;</p><p><code class="funcdef">bigint <b class="fsfunc">ST_ValueCount</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, double precision  <var class="pdparam">searchvalue</var>, double precision  <var class="pdparam">roundto=0</var><code>)</code>;</p><p><code class="funcdef">SETOF record <b class="fsfunc">ST_ValueCount</b>(</code>text  <var class="pdparam">rastertable</var>, text  <var class="pdparam">rastercolumn</var>, integer  <var class="pdparam">nband=1</var>, boolean  <var class="pdparam">exclude_nodata_value=true</var>, double precision[]  <var class="pdparam">searchvalues=NULL</var>, double precision  <var class="pdparam">roundto=0</var>, double precision  <var class="pdparam">OUT value</var>, integer  <var class="pdparam">OUT count</var><code>)</code>;</p><p><code class="funcdef">SETOF record <b class="fsfunc">ST_ValueCount</b>(</code>text  <var class="pdparam">rastertable</var>, text  <var class="pdparam">rastercolumn</var>, double precision[]  <var class="pdparam">searchvalues</var>, double precision  <var class="pdparam">roundto=0</var>, double precision  <var class="pdparam">OUT value</var>, integer  <var class="pdparam">OUT count</var><code>)</code>;</p><p><code class="funcdef">SETOF record <b class="fsfunc">ST_ValueCount</b>(</code>text  <var class="pdparam">rastertable</var>, text  <var class="pdparam">rastercolumn</var>, integer  <var class="pdparam">nband</var>, double precision[]  <var class="pdparam">searchvalues</var>, double precision  <var class="pdparam">roundto=0</var>, double precision  <var class="pdparam">OUT value</var>, integer  <var class="pdparam">OUT count</var><code>)</code>;</p><p><code class="funcdef">bigint<b class="fsfunc">ST_ValueCount</b>(</code>text  <var class="pdparam">rastertable</var>, text  <var class="pdparam">rastercolumn</var>, integer  <var class="pdparam">nband</var>, boolean  <var class="pdparam">exclude_nodata_value</var>, double precision  <var class="pdparam">searchvalue</var>, double precision  <var class="pdparam">roundto=0</var><code>)</code>;</p><p><code class="funcdef">bigint <b class="fsfunc">ST_ValueCount</b>(</code>text  <var class="pdparam">rastertable</var>, text  <var class="pdparam">rastercolumn</var>, double precision  <var class="pdparam">searchvalue</var>, double precision  <var class="pdparam">roundto=0</var><code>)</code>;</p><p><code class="funcdef">bigint <b class="fsfunc">ST_ValueCount</b>(</code>text  <var class="pdparam">rastertable</var>, text  <var class="pdparam">rastercolumn</var>, integer  <var class="pdparam">nband</var>, double precision  <var class="pdparam">searchvalue</var>, double precision  <var class="pdparam">roundto=0</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287144101"></a><h2>説明</h2><p>
ラスタタイルまたはラスタカバレッジの指定したバンドにおけるピクセルバンド値とピクセル数にあたる、<code class="varname">value</code>と<code class="varname">count</code>からなるレコードの集合を返します。</p><p><code class="varname">nband</code>でバンドを指定しない場合は1番と仮定します。<code class="varname">searchvalues</code>が指定されていない場合には、ラスタまたはラスタカバレッジで発見した全てのピクセル値が返ります。searchvalueを1つ指定した場合には、指定したピクセルバンド値を持つピクセルの数を示すレコードでなく、整数を返します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">exclude_nodata_value</code>をFALSEに設定している場合には、NODATA値となるピクセルも数えます。</p></td></tr></table></div><p>初出: 2.0.0 </p></div><div class="refsection" title="例"><a name="id287144136"></a><h2>例</h2><pre class="programlisting">
UPDATE dummy_rast SET rast = ST_SetBandNoDataValue(rast,249) WHERE rid=2;
-- この例では1番バンドの249以外のピクセルを数えます

SELECT (pvc).*
FROM (SELECT ST_ValueCount(rast) As pvc
    FROM dummy_rast WHERE rid=2) As foo
    ORDER BY (pvc).value;
				    			    
 value | count
-------+-------
   250 |     2
   251 |     1
   252 |     2
   253 |     6
   254 |    12
   
-- この例では1番バンドの249を含む全てのピクセルを数えます
SELECT (pvc).*
FROM (SELECT ST_ValueCount(rast,1,false) As pvc
    FROM dummy_rast WHERE rid=2) As foo
    ORDER BY (pvc).value;
				    
 value | count
-------+-------
   249 |     2
   250 |     2
   251 |     1
   252 |     2
   253 |     6
   254 |    12
   
-- 2番バンドのNODATAでないピクセルのみ数えます
SELECT (pvc).*
FROM (SELECT ST_ValueCount(rast,2) As pvc
    FROM dummy_rast WHERE rid=2) As foo
    ORDER BY (pvc).value;
 value | count
-------+-------
    78 |     1
    79 |     1
    88 |     1
    89 |     1
    96 |     1
    97 |     1
    98 |     1
    99 |     2
   112 |     2
:				    

				</pre><pre class="programlisting">
-- 現実の例です。空中写真ラスタタイルの2番バンドで、
-- ジオメトリとインタセクトするピクセル数を数え、
-- 500を超えるピクセル数があるピクセルバンド値のみ返します。
SELECT (pvc).value, SUM((pvc).count) As total
FROM (SELECT ST_ValueCount(rast,2) As pvc
    FROM o_4_boston 
        WHERE ST_Intersects(rast, 
            ST_GeomFromText('POLYGON((224486 892151,224486 892200,224706 892200,224706 892151,224486 892151))',26986)
             ) 
        ) As foo
    GROUP BY (pvc).value
    HAVING SUM((pvc).count) &gt; 500
    ORDER BY (pvc).value;
    
 value | total
-------+-----
    51 | 502
    54 | 521
</pre><pre class="programlisting">
-- 指定したジオメトリとインタセクトするタイルの
-- 値が100のぴくセロをラスタタイルごとに数えて返します
es that intersect  a specific geometry --
SELECT rid, ST_ValueCount(rast,2,100) As count
    FROM o_4_boston 
        WHERE ST_Intersects(rast, 
            ST_GeomFromText('POLYGON((224486 892151,224486 892200,224706 892200,224706 892151,224486 892151))',26986)
             ) ;

 rid | count
-----+-------
   1 |    56
   2 |    95
  14 |    37
  15 |    64
</pre></div><div class="refsection" title="関連情報"><a name="id287144155"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Count" title="ST_Count">ST_Count</a>, <a class="xref" href="#RT_ST_SetBandNoDataValue" title="ST_SetBandNoDataValue">ST_SetBandNoDataValue</a></p></div></div></div><div class="sect1" title="9.10. ラスタ出力"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Raster_Outputs"></a>9.10. ラスタ出力</h2></div></div></div><div class="toc"><dl><dt><span class="refentrytitle"><a href="#RT_ST_AsBinary">ST_AsBinary</a></span><span class="refpurpose"> ? SRIDメタデータを持たないラスタのWell-Known Binary(WKB)表現を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_AsGDALRaster">ST_AsGDALRaster</a></span><span class="refpurpose"> ? 
指定されたGDALラスタ書式でラスタタイルを返します。ラスタ書式はコンパイルしたライブラリが対応するものです。ライブラリが対応する書式の一覧を得るにはST_GDALRasters()を使います。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_AsJPEG">ST_AsJPEG</a></span><span class="refpurpose"> ? ラスタの選択されたバンドを、単一のJoint Photographic Exports Group (JPEG)画像としてバイト配列で返します。バンドを指定せず、1バンドか3以上のバンドがある場合には、1番バンドを使用します。3バンドのみ指定した場合には、3バンドを使用し、RGBに対応付けます。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_AsPNG">ST_AsPNG</a></span><span class="refpurpose"> ? ラスタの選択されたバンドを、単一のportable network graphics(PNG)画像としてバイト配列で返します。バンドを指定せず、1バンドか3バンド化4バンドある場合には、全てのバンドを使用します。バンドを指定せず、2バンドか4以上のバンドがある場合には、1番バンドを使用します。対象バンドはRGBまたはRGBAに対応付けられます。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_AsTIFF">ST_AsTIFF</a></span><span class="refpurpose"> ? ラスタの選択されたバンドを、単一のTIFF画像として返します。バンドを指定しない場合には、全てのバンドの使用を試みます。</span></dt></dl></div><div class="refentry" title="ST_AsBinary"><a name="RT_ST_AsBinary"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsBinary ? SRIDメタデータを持たないラスタのWell-Known Binary(WKB)表現を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">bytea <b class="fsfunc">ST_AsBinary</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287144216"></a><h2>説明</h2><p>ラスタのバイナリ表現を返します。2形式があります。ひとつめは、エンディアンのパラメータを持たず、リトルエンディアンで出力する者です。ふたつめは、第2引数にエンディアンの指示を取るもので、リトルエンディアン('NDX')または('XDR')を使います。</p><p>データを文字列表現に変換せずにデータベース外に引き出すためのバイナリカーソルに使います。</p></div><div class="refsection" title="例"><a name="id287144229"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsBinary(rast) As rastbin
FROM dummy_rast WHERE rid=1;

					 rastbin
---------------------------------------------------------------------------------
\001\000\000\000\000\000\000\000\000\000\000\000@\000\000\000\000\000\000\010@\
000\000\000\000\000\000\340?\000\000\000\000\000\000\340?\000\000\000\000\000\00
0\000\000\000\000\000\000\000\000\000\000\012\000\000\000\012\000\024\000 
				</pre></div></div><div class="refentry" title="ST_AsGDALRaster"><div class="refentry.separator"><hr></div><a name="RT_ST_AsGDALRaster"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsGDALRaster ? 
指定されたGDALラスタ書式でラスタタイルを返します。ラスタ書式はコンパイルしたライブラリが対応するものです。ライブラリが対応する書式の一覧を得るにはST_GDALRasters()を使います。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">bytea <b class="fsfunc">ST_AsGDALRaster</b>(</code>raster  <var class="pdparam">rast</var>, text  <var class="pdparam">format</var>, text[]  <var class="pdparam">options=NULL</var>, integer  <var class="pdparam">srid=sameassource</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287144307"></a><h2>説明</h2><p>指定された書式でラスタタイルを返します。引数は次の通りです。</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                       <code class="varname">format</code> 出力する形式です。libgdalライブラリでコンパイルしたドライバに依存します。一般的には'JPEG', 'GTIff', 'PNG'が有効になっています。ライブラリが対応する形式の一覧を得るにはST_GDALRasters()を使います。
			</p></li><li class="listitem"><p>
			<code class="varname">options</code> GDALオプションの文字列配列です。妥当なオプションは書式に依存します。詳細については<a class="ulink" href="http://www.gdal.org/frmt_various.html" target="_top">GDAL Raster format options</a>を参照して下さい。
			</p></li><li class="listitem"><p>
			<code class="varname">srs</code> 画像に埋め込むproj4textまたはsrtext(spatial_ref_sysから)です。
			</p></li></ul></div><p>初出: 2.0.0 - GDAL 1.6.0以上が必要です。</p></div><div class="refsection" title="JPEG出力の例"><a name="id287144357"></a><h2>JPEG出力の例</h2><pre class="programlisting">SELECT ST_AsGDALRaster(rast, 'JPEG') As rastjpg
FROM dummy_rast WHERE rid=1;

SELECT ST_AsGDALRaster(rast, 'JPEG', ARRAY!['QUALITY=50']) As rastjpg
FROM dummy_rast WHERE rid=2;
				</pre></div><div class="refsection" title="GTIFF出力の例"><a name="id287144368"></a><h2>GTIFF出力の例</h2><pre class="programlisting">SELECT ST_AsGDALRaster(rast, 'GTiff') As rastjpg
FROM dummy_rast WHERE rid=2;

-- 90%品質のJPEG圧縮でGeoTIFFを出力
SELECT ST_AsGDALRaster(rast, 'GTiff',  
  ARRAY['COMPRESS=JPEG', 'JPEG_QUALITY=90'], 
  4269) As rasttiff
FROM dummy_rast WHERE rid=2;
				</pre></div><div class="refsection" title="関連情報"><a name="id287144381"></a><h2>関連情報</h2><p><a class="xref" href="#RT_Raster_Applications" title="5.3. PostGISラスタを使ったカスタムアプリケーションの構築">「PostGISラスタを使ったカスタムアプリケーションの構築」</a>, <a class="xref" href="#RT_ST_GDALDrivers" title="ST_GDALDrivers">ST_GDALDrivers</a>, <a class="xref" href="#RT_ST_SRID" title="ST_SRID">ST_SRID</a></p></div></div><div class="refentry" title="ST_AsJPEG"><div class="refentry.separator"><hr></div><a name="RT_ST_AsJPEG"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsJPEG ? ラスタの選択されたバンドを、単一のJoint Photographic Exports Group (JPEG)画像としてバイト配列で返します。バンドを指定せず、1バンドか3以上のバンドがある場合には、1番バンドを使用します。3バンドのみ指定した場合には、3バンドを使用し、RGBに対応付けます。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">bytea <b class="fsfunc">ST_AsJPEG</b>(</code>raster  <var class="pdparam">rast</var>, text[]  <var class="pdparam">options=NULL</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsJPEG</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, integer  <var class="pdparam">quality</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsJPEG</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, text[]  <var class="pdparam">options=NULL</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsJPEG</b>(</code>raster  <var class="pdparam">rast</var>, integer[]  <var class="pdparam">nbands</var>, text[]  <var class="pdparam">options=NULL</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsJPEG</b>(</code>raster  <var class="pdparam">rast</var>, integer[]  <var class="pdparam">nbands</var>, integer  <var class="pdparam">quality</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287144661"></a><h2>説明</h2><p>ラスタの選択されたバンドを、単一のJoint Photographic Exports Group (JPEG)画像として返します。

より一般でないラスタタイプで出力する必要がある場合には、<a class="xref" href="#RT_ST_AsGDALRaster" title="ST_AsGDALRaster">ST_AsGDALRaster</a>を使います。バンドを指定せず、1バンドか3以上のバンドがある場合には、1番バンドを使用します。3バンドのみ指定した場合には、3バンドを使用します。この関数には多数の任意引数が付くさまざまな形式があります。引数については次の通りです。</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                       <code class="varname">nband</code> 単一バンド出力のためのものです。
                      </p></li><li class="listitem"><p>
                        <code class="varname">nbands</code> 出力バンドの配列(JPEGでは3要素が最大です)で、バンドの並び順はRGBです。たとえばARRAY[3,2,1]は、3番バンドを赤、2番バンドを緑、1番バンドを赤にそれぞれ対応させます。
                      </p></li><li class="listitem"><p>
                        <code class="varname">quality</code> 0から100の数値です。高いほどしっかりした画像になります。
                      </p></li><li class="listitem"><p>
                        <code class="varname">options</code> JPEGのために定義するGDALオプションの文字列配列です(<a class="xref" href="#RT_ST_GDALDrivers" title="ST_GDALDrivers">ST_GDALDrivers</a>のcreate_optionsを見てください)。JPEGの妥当なパラメタは<code class="varname">PROGRESSIVE</code>の'ON'または'OFF'と、<code class="varname">QUALITY</code>の0から100までの数(デフォルトは75)です。詳細については<a class="ulink" href="http://www.gdal.org/frmt_various.html" target="_top">GDAL Raster format options</a>を参照して下さい。
                      </p></li></ul></div><p>初出: 2.0.0 - GDAL 1.6.0以上が必要です。</p></div><div class="refsection" title="例: 出力"><a name="id287144768"></a><h2>例: 出力</h2><pre class="programlisting">-- 前から3バンドを75%品質で出力
SELECT ST_AsJPEG(rast) As rastjpg
    FROM dummy_rast WHERE rid=2;
    
-- 第1バンドのみ90%品質で出力
SELECT ST_AsJPEG(rast,1,90) As rastjpg
    FROM dummy_rast WHERE rid=2;
    
-- 前から3バンドを、プログレッシブ、90%品質で出力します
-- 2番を赤、1番を緑、3番を青にします
SELECT ST_AsJPEG(rast,ARRAY[2,1,3],ARRAY['QUALITY=90','PROGRESSIVE=ON']) As rastjpg
    FROM dummy_rast WHERE rid=2;</pre></div><div class="refsection" title="関連情報"><a name="id287144780"></a><h2>関連情報</h2><p><a class="xref" href="#RT_Raster_Applications" title="5.3. PostGISラスタを使ったカスタムアプリケーションの構築">「PostGISラスタを使ったカスタムアプリケーションの構築」</a>, <a class="xref" href="#RT_ST_GDALDrivers" title="ST_GDALDrivers">ST_GDALDrivers</a>, <a class="xref" href="#RT_ST_AsGDALRaster" title="ST_AsGDALRaster">ST_AsGDALRaster</a>, <a class="xref" href="#RT_ST_AsPNG" title="ST_AsPNG">ST_AsPNG</a>, <a class="xref" href="#RT_ST_AsTIFF" title="ST_AsTIFF">ST_AsTIFF</a> </p></div></div><div class="refentry" title="ST_AsPNG"><div class="refentry.separator"><hr></div><a name="RT_ST_AsPNG"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsPNG ? ラスタの選択されたバンドを、単一のportable network graphics(PNG)画像としてバイト配列で返します。バンドを指定せず、1バンドか3バンド化4バンドある場合には、全てのバンドを使用します。バンドを指定せず、2バンドか4以上のバンドがある場合には、1番バンドを使用します。対象バンドはRGBまたはRGBAに対応付けられます。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">bytea <b class="fsfunc">ST_AsPNG</b>(</code>raster  <var class="pdparam">rast</var>, text[]  <var class="pdparam">options=NULL</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsPNG</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, integer  <var class="pdparam">compression</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsPNG</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, text[]  <var class="pdparam">options=NULL</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsPNG</b>(</code>raster  <var class="pdparam">rast</var>, integer[]  <var class="pdparam">nbands</var>, integer  <var class="pdparam">compression</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsPNG</b>(</code>raster  <var class="pdparam">rast</var>, integer[]  <var class="pdparam">nbands</var>, text[]  <var class="pdparam">options=NULL</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287145033"></a><h2>説明</h2><p>ラスタの選択されたバンドを、単一のportable network graphics(PNG)画像として返します。より一般でないラスタタイプで出力する必要がある場合には、<a class="xref" href="#RT_ST_AsGDALRaster" title="ST_AsGDALRaster">ST_AsGDALRaster</a>を使います。バンドを指定しない場合には、前から3バンドを出力します。この関数には多数の任意引数が付くさまざまな形式があります。引数については次の通りです。
<code class="varname">srid</code>が指定されない場合には、sridはラスタが使用しているSRDIを指定します。引数の一覧は次の通りです。</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                       <code class="varname">nband</code> 単一バンド出力のためのものです。
                      </p></li><li class="listitem"><p>
                        <code class="varname">nbands</code> 出力バンドの配列(PNGでは3要素が最大です)で、バンドの並び順はRGBです。たとえばARRAY[3,2,1]は、3番バンドを赤、2番バンドを緑、1番バンドを赤にそれぞれ対応させます。
                      </p></li><li class="listitem"><p>
                        <code class="varname">compression</code> 1から9の数を指定します。大きいほど圧縮効率が上がります。
                      </p></li><li class="listitem"><p>
                        <code class="varname">options</code> PNGのために定義するGDALオプションの文字列配列です(ST_GDALDriversのcreate_optionsを見てください)。PNGの妥当なパラメタはZLEVEL(圧縮に費やす時間の合計で、デフォルトは6)です。ARRAY['ZLEVEL=9']というようにします。この関数が2つの出力を行う必要があるため、WORLDFILEはPNGでは許されません。詳細については<a class="ulink" href="http://www.gdal.org/frmt_various.html" target="_top">GDAL Raster format options</a>を参照して下さい。
                      </p></li></ul></div><p>初出: 2.0.0 - GDAL 1.6.0以上が必要です。</p></div><div class="refsection" title="例"><a name="id287145099"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsPNG(rast) As rastpng
FROM dummy_rast WHERE rid=2;

-- 前から3バンドを出力し、3番を赤、1番を緑、2番を青に対応付けます
SELECT ST_AsPNG(rast, ARRAY[3,1,2]) As rastpng
FROM dummy_rast WHERE rid=2;  
				</pre></div><div class="refsection" title="関連情報"><a name="id287145112"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_GDALDrivers" title="ST_GDALDrivers">ST_GDALDrivers</a>, <a class="xref" href="#RT_ST_AsGDALRaster" title="ST_AsGDALRaster">ST_AsGDALRaster</a>, <a class="xref" href="#RT_Raster_Applications" title="5.3. PostGISラスタを使ったカスタムアプリケーションの構築">「PostGISラスタを使ったカスタムアプリケーションの構築」</a></p></div></div><div class="refentry" title="ST_AsTIFF"><div class="refentry.separator"><hr></div><a name="RT_ST_AsTIFF"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsTIFF ? ラスタの選択されたバンドを、単一のTIFF画像として返します。バンドを指定しない場合には、全てのバンドの使用を試みます。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">bytea <b class="fsfunc">ST_AsTIFF</b>(</code>raster  <var class="pdparam">rast</var>, text[]  <var class="pdparam">options=''</var>, integer  <var class="pdparam">srid=sameassource</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsTIFF</b>(</code>raster  <var class="pdparam">rast</var>, text  <var class="pdparam">compression=''</var>, integer  <var class="pdparam">srid=sameassource</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsTIFF</b>(</code>raster  <var class="pdparam">rast</var>, integer[]  <var class="pdparam">nbands</var>, text  <var class="pdparam">compression=''</var>, integer  <var class="pdparam">srid=sameassource</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsTIFF</b>(</code>raster  <var class="pdparam">rast</var>, integer[]  <var class="pdparam">nbands</var>, text[]  <var class="pdparam">options</var>, integer  <var class="pdparam">srid=sameassource</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287145316"></a><h2>説明</h2><p>ラスタの選択されたバンドを、単一のTagged Image File Format(TIFF)画像として返します。バンドを指定しない場合には、全てのバンドの使用を試みます。この関数は<a class="xref" href="#RT_ST_AsGDALRaster" title="ST_AsGDALRaster">ST_AsGDALRaster</a>のラッパです。より一般でないラスタタイプで出力する必要がある場合には、<a class="xref" href="#RT_ST_AsGDALRaster" title="ST_AsGDALRaster">ST_AsGDALRaster</a>を使います。この関数には多数の任意引数が付くさまざまな形式があります。空間参照系(SRS)の文字列表現が指定されていない場合には、ラスタの空間参照系を使います。引数については次の通りです。</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                        <code class="varname">nbands</code> 出力バンドの配列(PNGでは3要素が最大です)で、バンドの並び順はRGBです。たとえばARRAY[3,2,1]は、3番バンドを赤、2番バンドを緑、1番バンドを赤にそれぞれ対応させます。 
                      </p></li><li class="listitem"><p>
<code class="varname">compression</code> 圧縮式 -- JPEG90(または他のパーセント値), LZW, JPEG, DEFLATE9のいずれかです。
                      </p></li><li class="listitem"><p>
<code class="varname">options</code> GTiffを定義するGDALオプションの文字列配列です(ST_GDALDriversのGTiff用のcreate_optionsを見てください)。詳細については<a class="ulink" href="http://www.gdal.org/frmt_various.html" target="_top">GDAL Raster format options</a>を参照して下さい。
                      </p></li><li class="listitem"><p>
<code class="varname">srid</code> ラスタのspatial_ref_sysのSRIDです。地理参照情報を登録するために使われます。
                      </p></li></ul></div><p>初出: 2.0.0 - GDAL 1.6.0以上が必要です。</p></div><div class="refsection" title="例: JPEG90%品質圧縮の使用"><a name="id287145382"></a><h2>例: JPEG90%品質圧縮の使用</h2><pre class="programlisting">SELECT ST_AsTIFF(rast, 'JPEG90') As rasttiff
FROM dummy_rast WHERE rid=2;
				</pre></div><div class="refsection" title="関連情報"><a name="id287145395"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_GDALDrivers" title="ST_GDALDrivers">ST_GDALDrivers</a>, <a class="xref" href="#RT_ST_AsGDALRaster" title="ST_AsGDALRaster">ST_AsGDALRaster</a>, <a class="xref" href="#RT_ST_SRID" title="ST_SRID">ST_SRID</a></p></div></div></div><div class="sect1" title="9.11. ラスタ処理"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Raster_Processing"></a>9.11. ラスタ処理</h2></div></div></div><div class="toc"><dl><dt><span class="refentrytitle"><a href="#RT_Box3D">Box3D</a></span><span class="refpurpose"> ? ラスタを囲むボックスのbox3d表現を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Clip">ST_Clip</a></span><span class="refpurpose"> ? 入力ジオメトリで切り取ったラスタを返します。バンドが指定されていない場合には、全てのバンドが返されます。<code class="varname">crop</code>が指定されていない場合はTRUEと仮定され、出力ラスタをクロップします。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_ConvexHull">ST_ConvexHull</a></span><span class="refpurpose"> ? BandNoDataValueと等しいピクセル値を含むラスタの凸包ジオメトリを返します。一般的な形状で回転していないラスタでは、ST_Envelopeと同じ結果になります。不規則な形状をしているか回転しているラスタでのみ使います。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_DumpAsPolygons">ST_DumpAsPolygons</a></span><span class="refpurpose"> ? 指定されたラスタバンドからgeomval(geom,val)行の集合を返します。バンドを指定しない場合のデフォルトは1番です。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Envelope">ST_Envelope</a></span><span class="refpurpose"> ? ラスタの範囲のポリゴン表現を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_HillShade">ST_HillShade</a></span><span class="refpurpose"> ? 方位、高度、輝度、標高スケールの入力を使って、標高ラスタバンドの仮定的な光による明暗を返します。地形の視覚化に使用します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Aspect">ST_Aspect</a></span><span class="refpurpose"> ? 標高ラスタバンドの斜面方位を返します。地形解析に使います。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Slope">ST_Slope</a></span><span class="refpurpose"> ? 標高ラスタバンドの傾斜角を返します。地形解析に使います。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Intersection">ST_Intersection</a></span><span class="refpurpose"> ? 2つのラスタの共有部分またはベクタ化したラスタとジオメトリとのインタセクションを表現する、ラスタまたはジオメトリとピクセル値のペアの集合を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_MapAlgebraExpr">ST_MapAlgebraExpr</a></span><span class="refpurpose"> ? 1バンド版: 入力バンドに対する妥当なPostgreSQL代数演算で形成された、指定したピクセルタイプの1バンドのラスタを生成します。バンドを指定しない場合は1番と仮定します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_MapAlgebraExpr2">ST_MapAlgebraExpr</a></span><span class="refpurpose"> ? 2バンド版: 2つの入力バンドに対する妥当なPostgreSQL代数演算で形成された、指定したピクセルタイプの1バンドのラスタを生成します。バンドを指定しない場合はどちらも1番と仮定します。結果ラスタは、ひとつめのラスタのアラインメント(スケール、スキュー、ピクセル角位置)にあわされます。範囲は"extenttype"引数で定義されます。取りうる"extenttype"の値はINTERSECTION, UNION, FIRST, SECONDです。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_MapAlgebraFct">ST_MapAlgebraFct</a></span><span class="refpurpose"> ? 1バンド版 - 入力バンドに対する妥当なPostgreSQL関数で形成された、指定したピクセルタイプの1バンドのラスタを生成します。バンドを指定しない場合は1番と仮定します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_MapAlgebraFct2">ST_MapAlgebraFct</a></span><span class="refpurpose"> ? 2ラスタ版 - 2つの入力バンドに対する妥当なPostgreSQL関数で形成された、指定したピクセルタイプの1バンドのラスタを生成します。バンドを指定しない場合は1番と仮定します。"extenttype"のデフォルトはINTERSECTIONです。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a></span><span class="refpurpose"> ? 1バンド版: ユーザ定義PostgreSQL関数を使用する最近傍地図代数関数です。入力ラスタバンドの近傍の値を与えたPL/pgSQLユーザ定義関数の結果からなるラスタを返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Polygon">ST_Polygon</a></span><span class="refpurpose"> ? 
NODATA値でないピクセル値を持つピクセルの結合で形成されるポリゴンジオメトリを返します。バンド番号を設定しない場合には、デフォルトは1番バンドです。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Reclass">ST_Reclass</a></span><span class="refpurpose"> ? 元のラスタから再分類したバンドタイプからなるラスタを生成します。nbandは変更するバンドです。nbandが指定されていない場合は1番と仮定します。他の全てのバンドは変更せずに返します。可視画像の書式としてより単純な描画を行うために、16BUIバンドを8BUIバンドに変換する、等のために使います。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Union">ST_Union</a></span><span class="refpurpose"> ? ラスタタイルの集合を1バンドの単一のラスタに結合します。バンドを指定しない場合は1番と仮定します。結果ラスタの範囲は、集合全体の範囲となります。インタセクトする場合には、結果値はp_expressionで定義されます。p_expressionはLAST, MEAN, SUM, FIRST, MAX, MINで、デフォルトはLASTです。</span></dt></dl></div><div class="refentry" title="Box3D"><a name="RT_Box3D"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Box3D ? ラスタを囲むボックスのbox3d表現を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">box3d <b class="fsfunc">Box3D</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287145459"></a><h2>説明</h2><p>ラスタの範囲を表現するボックスを返します。</p><p>ポリゴンは、バウンディングボックス((<code class="varname">MINX</code>, <code class="varname">MINY</code>), (<code class="varname">MAXX</code>, <code class="varname">MAXY</code>))の角のポイントにより定義されます。</p><p>変更: 2.0.0 2.0より前の版では、box3dの代わりにbox2dが使われていました。box2dは非推奨の型となり、box3dに変更しました。</p></div><div class="refsection" title="例"><a name="id287145523"></a><h2>例</h2><pre class="programlisting">SELECT rid, Box3D(rast) As rastbox
FROM dummy_rast;

rid |        rastbox
----+-------------------------------------------------
1   | BOX3D(0.5 0.5 0,20.5 60.5 0)
2   | BOX3D(3427927.75 5793243.5 0,3427928 5793244 0)
			</pre></div><div class="refsection" title="関連情報"><a name="id287145533"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Envelope" title="ST_Envelope">ST_Envelope</a></p></div></div><div class="refentry" title="ST_Clip"><div class="refentry.separator"><hr></div><a name="RT_ST_Clip"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Clip ? 入力ジオメトリで切り取ったラスタを返します。バンドが指定されていない場合には、全てのバンドが返されます。<code class="varname">crop</code>が指定されていない場合はTRUEと仮定され、出力ラスタをクロップします。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_Clip</b>(</code>raster  <var class="pdparam">rast</var>, geometry  <var class="pdparam">geom</var>, double precision[]  <var class="pdparam">nodataval=NULL</var>, boolean  <var class="pdparam">crop=true</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Clip</b>(</code>raster  <var class="pdparam">rast</var>, geometry  <var class="pdparam">geom</var>, boolean  <var class="pdparam">crop</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Clip</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">band</var>, geometry  <var class="pdparam">geom</var>, boolean  <var class="pdparam">crop</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287145694"></a><h2>説明</h2><p>入力ジオメトリ<code class="varname">geom</code>で切り取ったラスタを返します。バンドが指定されていない場合には、全てのバンドが返されます。</p><p>ST_Clipが返すラスタは、バンド毎に1つずつ必ず切り取った領域に適用するNODATA値を持ちます。NODATA値が渡されず、入力ラスタがNODATA値を持たない場合には、結果ラスタのNODATA値はST_MinPossibleValue(ST_BandPixelType(rast, band))に設定されます。配列におけるNODATA値の要素数がバンド数より小さい場いいには、配列の最後の要素が残りのバンドに適用されます。NODATA値の要素数がバンド数より多い場合には、超過分は無視されます。全てのNODATA値配列を受け付ける形式では、バンド毎に適用される単一値も受け付けます</p><p>

<code class="varname">crop</code>が指定されていない場合はTRUEと仮定され、出力ラスタを
<code class="varname">geom</code>範囲とと<code class="varname">rast</code>範囲とのインタセクトした範囲にクロップします。<code class="varname">crop</code>がFALSEに設定されている場合には、新しいラスタは<code class="varname">rast</code>と同じ範囲になります。</p><p>初出: 2.0.0 </p><p>MssGISサイト<a class="ulink" href="http://www.mass.gov/mgis/colororthos2008.htm" target="_top">MassGIS Aerial Orthos</a>にあるマサチューセッツ空中写真データを使った例です。座標はメートル単位のマサチューセッツ州平面です。</p></div><div class="refsection" title="例: 1バンドの切り取り"><a name="id287145741"></a><h2>例: 1バンドの切り取り</h2><pre class="programlisting">-- 空中写真タイルの1番バンドを
-- 中心から20メートルのバッファで切り取ります
SELECT ST_Clip(rast, 1,
		ST_Buffer(ST_Centroid(ST_Envelope(rast)),20)
	) from aerials.boston
WHERE rid = 4;</pre><pre class="programlisting">--ラスタの最終的なピクセル範囲についての
--   クロップの効果のデモンストレーション
-- crop = trueの場合に、どのように最終的な範囲がジオメトリに切り取られるか
--   をみます
SELECT ST_XMax(ST_Envelope(ST_Clip(rast, 1, clipper, true))) As xmax_w_trim,
	ST_XMax(clipper) As xmax_clipper,
	ST_XMax(ST_Envelope(ST_Clip(rast, 1, clipper, false))) As xmax_wo_trim,
	ST_XMax(ST_Envelope(rast)) As xmax_rast_orig
FROM (SELECT rast, ST_Buffer(ST_Centroid(ST_Envelope(rast)),6) As clipper
	FROM aerials.boston
WHERE rid = 6) As foo;

   xmax_w_trim    |   xmax_clipper   |   xmax_wo_trim   |  xmax_rast_orig
------------------+------------------+------------------+------------------
 230657.436173996 | 230657.436173996 | 230666.436173996 | 230666.436173996
</pre><div class="informaltable"><table border="1"><colgroup><col><col></colgroup><tbody><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_clip01.png"><div class="caption"><p>切り取り前の完全なラスタタイル</p></div></div></div>
		 </td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_clip02.png"><div class="caption"><p>切り取り後</p></div></div></div>
		 </td></tr></tbody></table></div></div><div class="refsection" title="例: クロップがなく他のバンドは切り取らず1バンドを切り取る"><a name="id287146053"></a><h2>例: クロップがなく他のバンドは切り取らず1バンドを切り取る</h2><pre class="programlisting">-- 前の例と同じですが、
-- ST_AddBandは全てのバンドが同じピクセル範囲を持っている必要があるので
-- ST_AddBandを使えるようにするためcropをFALSEに設定しなければなりません
SELECT ST_AddBand(ST_Clip(rast, 1,
		ST_Buffer(ST_Centroid(ST_Envelope(rast)),20),false
	), ARRAY[ST_Band(rast,2),ST_Band(rast,3)] ) from aerials.boston
WHERE rid = 6;</pre><div class="informaltable"><table border="1"><colgroup><col><col></colgroup><tbody><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_clip04.png"><div class="caption"><p>切り取り前の完全なラスタタイル</p></div></div></div>
		 </td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_clip05.png"><div class="caption"><p>切り取り後 - シュールですね</p></div></div></div>
		 </td></tr></tbody></table></div></div><div class="refsection" title="例: 全バンドの切り取り"><a name="id287146121"></a><h2>例: 全バンドの切り取り</h2><pre class="programlisting">-- 空中写真タイルの全バンドを20メートルバッファで切り取ります
-- 違いは、全バンドの切り取りのため
--   切り取り対象のバンドを指定しないことだけです
SELECT ST_Clip(rast,
	  ST_Buffer(ST_Centroid(ST_Envelope(rast)), 20), 
	  false
	) from aerials.boston
WHERE rid = 4;</pre><div class="informaltable"><table border="1"><colgroup><col><col></colgroup><tbody><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_clip01.png"><div class="caption"><p>切り取り前の完全なラスタタイル</p></div></div></div>
		 </td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_clip03.png"><div class="caption"><p>切り取り後</p></div></div></div>
		 </td></tr></tbody></table></div></div><div class="refsection" title="関連情報"><a name="id287146226"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_AddBand" title="ST_AddBand">ST_AddBand</a>, <a class="xref" href="#RT_ST_Intersection" title="ST_Intersection">ST_Intersection</a></p></div></div><div class="refentry" title="ST_ConvexHull"><div class="refentry.separator"><hr></div><a name="RT_ST_ConvexHull"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ConvexHull ? BandNoDataValueと等しいピクセル値を含むラスタの凸包ジオメトリを返します。一般的な形状で回転していないラスタでは、ST_Envelopeと同じ結果になります。不規則な形状をしているか回転しているラスタでのみ使います。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_ConvexHull</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287146279"></a><h2>説明</h2><p>BandNoDataValue値のピクセルを含むラスタの凸包ジオメトリを返します。一般的な形状で回転していないラスタでは、だいたいST_Envelopeと同じ結果になります。不規則な形状をしているか回転しているラスタでのみ使います。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>
ST_Envelopeは、座標値の小数部を切り捨て、ラスタのまわりに小さなバッファを追加します。小数部の切り捨てを行わないST_ConvexHullの答えと若干異なります。</p></td></tr></table></div></div><div class="refsection" title="例"><a name="id287146294"></a><h2>例</h2><p>これの図については<a class="ulink" href="http://trac.osgeo.org/postgis/wiki/WKTRaster/SpecificationWorking01" target="_top">PostGIS Raster Specification</a>を参照して下さい。</p><div class="informaltable"><table border="1"><colgroup><col></colgroup><tbody><tr><td>
							<p> 
</p><pre class="programlisting">-- ST_EnvelopeとST_ConvexHullはだいたい同じです
SELECT ST_AsText(ST_ConvexHull(rast)) As convhull, 
	ST_AsText(ST_Envelope(rast)) As env
FROM dummy_rast WHERE rid=1;

                        convhull                        |                env

--------------------------------------------------------+-----------------------
 POLYGON((0.5 0.5,20.5 0.5,20.5 60.5,0.5 60.5,0.5 0.5)) | POLYGON((0 0,20 0,20 60,0 60,0 0))
 </pre><p>
						</p>
					</td></tr><tr><td>
						<p> 
				</p><pre class="programlisting"> 
-- ラスタをスキューします
-- 凸包とエンベロープがどのくらいことなるかをみます
SELECT ST_AsText(ST_ConvexHull(rast)) As convhull, 
	ST_AsText(ST_Envelope(rast)) As env
FROM (SELECT ST_SetRotation(rast, 0.1, 0.1) As rast 
	FROM dummy_rast WHERE rid=1) As foo;
	
                        convhull                        |                env

--------------------------------------------------------+------------------------------------
 POLYGON((0.5 0.5,20.5 1.5,22.5 61.5,2.5 60.5,0.5 0.5)) | POLYGON((0 0,22 0,22 61,0 61,0 0))
				</pre><p>
						</p>
					</td></tr></tbody></table></div></div><div class="refsection" title="関連情報"><a name="id287146354"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Envelope" title="ST_Envelope">ST_Envelope</a>, <a class="xref" href="#ST_ConvexHull" title="ST_ConvexHull">ST_ConvexHull</a>, <a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a></p></div></div><div class="refentry" title="ST_DumpAsPolygons"><div class="refentry.separator"><hr></div><a name="RT_ST_DumpAsPolygons"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_DumpAsPolygons ? 指定されたラスタバンドからgeomval(geom,val)行の集合を返します。バンドを指定しない場合のデフォルトは1番です。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">setof geomval <b class="fsfunc">ST_DumpAsPolygons</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">band_num=1</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287146454"></a><h2>説明</h2><p>集合を返す関数(SRF=set-returning function)です。geomval行の集合を返します。geomvalはジオメトリ(geom)とピクセルバンド値(val)からなります。それぞれポリゴンは、指定したバンドの、valで示される値と同じピクセル値を持っている全てのピクセルの結合です。</p><p>ST_DumpAsPolygonはラスタのポリゴン化に使います。新しい行を生成するのでGROUP BYの逆です。たとえば、単一ラスタを複数のPOLYGON/MULTIPOLYGONに展開できます。</p><p>初出: GDAL 1.7以上が必要です。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>バンドにNODATA値が設定されている場合には、NODATA値を持つピクセルは返りません。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ラスタ内の与えた値を持つピクセル数にのみ注意する場合には、<a class="xref" href="#RT_ST_ValueCount" title="ST_ValueCount">ST_ValueCount</a>を使う方が速いです。</p></td></tr></table></div></div><div class="refsection" title="例"><a name="id287146482"></a><h2>例</h2><pre class="programlisting">SELECT val, ST_AsText(geom) As geomwkt
FROM (
SELECT (ST_DumpAsPolygons(rast)).*
FROM dummy_rast 
WHERE rid = 2
) As foo
WHERE val BETWEEN 249 and 251
ORDER BY val;

 val |                                                       geomwkt
-----+--------------------------------------------------------------------------
 249 | POLYGON((3427927.95 5793243.95,3427927.95 5793243.85,3427928 5793243.85,
 		3427928 5793243.95,3427927.95 5793243.95))
 250 | POLYGON((3427927.75 5793243.9,3427927.75 5793243.85,3427927.8 5793243.85,
 		3427927.8 5793243.9,3427927.75 5793243.9))
 250 | POLYGON((3427927.8 5793243.8,3427927.8 5793243.75,3427927.85 5793243.75,
 		3427927.85 5793243.8, 3427927.8 5793243.8))
 251 | POLYGON((3427927.75 5793243.85,3427927.75 5793243.8,3427927.8 5793243.8,
 		3427927.8 5793243.85,3427927.75 5793243.85))
			</pre></div><div class="refsection" title="関連情報"><a name="id287146492"></a><h2>関連情報</h2><p><a class="xref" href="#geomval" title="geomval">geomval</a>, <a class="xref" href="#RT_ST_Value" title="ST_Value">ST_Value</a>, <a class="xref" href="#RT_ST_Polygon" title="ST_Polygon">ST_Polygon</a>, <a class="xref" href="#RT_ST_ValueCount" title="ST_ValueCount">ST_ValueCount</a></p></div></div><div class="refentry" title="ST_Envelope"><div class="refentry.separator"><hr></div><a name="RT_ST_Envelope"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Envelope ? ラスタの範囲のポリゴン表現を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Envelope</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287146552"></a><h2>説明</h2><p>sridで定義されている空間参照系上でのラスタの範囲のポリゴン表現を返します。ポリゴンで表現されるfloat8の最小バウンディングボックスです。</p><p>ポリゴンはバウンディングボックスの角のポイント、すなわち((<code class="varname">MINX</code>, <code class="varname">MINY</code>), (<code class="varname">MINX</code>, <code class="varname">MAXY</code>), (<code class="varname">MAXX</code>, <code class="varname">MAXY</code>), (<code class="varname">MAXX</code>, <code class="varname">MINY</code>), (<code class="varname">MINX</code>, <code class="varname">MINY</code>))で定義されます。</p></div><div class="refsection" title="例"><a name="id287146598"></a><h2>例</h2><pre class="programlisting">SELECT rid, ST_AsText(ST_Envelope(rast)) As envgeomwkt
FROM dummy_rast;

 rid |                                         envgeomwkt
-----+--------------------------------------------------------------------
   1 | POLYGON((0 0,20 0,20 60,0 60,0 0))
   2 | POLYGON((3427927 5793243,3427928 5793243,
   		3427928 5793244,3427927 5793244, 3427927 5793243))
				</pre></div><div class="refsection" title="関連情報"><a name="id287146609"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Envelope" title="ST_Envelope">ST_Envelope</a>, <a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a>, <a class="xref" href="#RT_ST_SRID" title="ST_SRID">ST_SRID</a></p></div></div><div class="refentry" title="ST_HillShade"><div class="refentry.separator"><hr></div><a name="RT_ST_HillShade"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_HillShade ? 方位、高度、輝度、標高スケールの入力を使って、標高ラスタバンドの仮定的な光による明暗を返します。地形の視覚化に使用します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_HillShade</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">band</var>, text  <var class="pdparam">pixeltype</var>, double precision  <var class="pdparam">azimuth</var>, double precision  <var class="pdparam">altitude</var>, double precision  <var class="pdparam">max_bright=255</var>, double precision  <var class="pdparam">elevation_scale=1</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287146754"></a><h2>説明</h2><p>方位、高度、輝度、標高スケールの入力を使って、標高ラスタバンドの仮定的な光による明暗を返します。地図代数関数を利用して、隣接ピクセルに陰影図方程式を適用します。</p><p>陰影図方程式は次の通りです。</p><pre class="programlisting">max_bright * ( (cos(zenith)*cos(slope)) + (sin(zenith)*sin(slope)*cos(azimuth - aspect)) )</pre><p>初出: 2.0.0 </p></div><div class="refsection" title="例 - 近日登場"><a name="id287146773"></a><h2>例 - 近日登場</h2><pre class="programlisting">近日登場</pre></div><div class="refsection" title="関連情報"><a name="id287146784"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a></p><p><a class="xref" href="#RT_ST_Aspect" title="ST_Aspect">ST_Aspect</a></p><p><a class="xref" href="#RT_ST_Slope" title="ST_Slope">ST_Slope</a></p></div></div><div class="refentry" title="ST_Aspect"><div class="refentry.separator"><hr></div><a name="RT_ST_Aspect"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Aspect ? 標高ラスタバンドの斜面方位を返します。地形解析に使います。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_Aspect</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">band</var>, text  <var class="pdparam">pixeltype</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287146859"></a><h2>説明</h2><p>標高ラスタバンドの斜面方位を返します。地図代数関数を使用して、斜面方位方程式を隣接ピクセルに適用します。</p><p>次の3*3の隣接ピクセル表現があるとします。</p><div class="informaltable"><table border="1"><colgroup><col><col><col></colgroup><tbody><tr><td>A</td><td>B</td><td>C</td></tr><tr><td>D</td><td>E</td><td>F</td></tr><tr><td>G</td><td>H</td><td>I</td></tr></tbody></table></div><p>セルEにおける斜面方位方程式は atan2((((G + 2H + I) - (A + 2B + C))  / 8), -(((C + 2F + I) - (A + 2D + G)) / 8)) です。</p><p>初出: 2.0.0 </p></div><div class="refsection" title="例 - 近日登場"><a name="id287146931"></a><h2>例 - 近日登場</h2><pre class="programlisting">近日登場</pre></div><div class="refsection" title="関連情報"><a name="id287146942"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a></p><p><a class="xref" href="#RT_ST_HillShade" title="ST_HillShade">ST_HillShade</a></p><p><a class="xref" href="#RT_ST_Slope" title="ST_Slope">ST_Slope</a></p></div></div><div class="refentry" title="ST_Slope"><div class="refentry.separator"><hr></div><a name="RT_ST_Slope"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Slope ? 標高ラスタバンドの傾斜角を返します。地形解析に使います。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_Slope</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">band</var>, text  <var class="pdparam">pixeltype</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287147018"></a><h2>説明</h2><p>標高ラスタバンドの傾斜角を返します。地形解析に使います。地図代数関数を使って、傾斜角方程式を隣接ピクセルに適用します。</p><p>次の3*3の隣接ピクセル表現があるとします。</p><div class="informaltable"><table border="1"><colgroup><col><col><col></colgroup><tbody><tr><td>A</td><td>B</td><td>C</td></tr><tr><td>D</td><td>E</td><td>F</td></tr><tr><td>G</td><td>H</td><td>I</td></tr></tbody></table></div><p>セルEにおける傾斜角方程式は atan(sqrt(((c + 2f + i) - (a + 2d + g) / 8)^2 + (((g + 2h + i) - (a + 2b + c)) / 8) ^ 2)) です。</p><p>初出: 2.0.0 </p></div><div class="refsection" title="例 - 近日登場"><a name="id287147090"></a><h2>例 - 近日登場</h2><pre class="programlisting">近日登場</pre></div><div class="refsection" title="関連情報"><a name="id287147100"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a></p><p><a class="xref" href="#RT_ST_HillShade" title="ST_HillShade">ST_HillShade</a></p><p><a class="xref" href="#RT_ST_Aspect" title="ST_Aspect">ST_Aspect</a></p></div></div><div class="refentry" title="ST_Intersection"><div class="refentry.separator"><hr></div><a name="RT_ST_Intersection"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Intersection ? 2つのラスタの共有部分またはベクタ化したラスタとジオメトリとのインタセクションを表現する、ラスタまたはジオメトリとピクセル値のペアの集合を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">setof geomval <b class="fsfunc">ST_Intersection</b>(</code>geometry  <var class="pdparam">geom</var>, raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">band_num=1</var><code>)</code>;</p><p><code class="funcdef">setof geomval <b class="fsfunc">ST_Intersection</b>(</code>raster  <var class="pdparam">rast</var>, geometry  <var class="pdparam">geom</var><code>)</code>;</p><p><code class="funcdef">setof geomval <b class="fsfunc">ST_Intersection</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">band_num</var>, geometry  <var class="pdparam">geom</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Intersection</b>(</code>raster  <var class="pdparam">rast1</var>, raster  <var class="pdparam">rast2</var>, double precision[]  <var class="pdparam">nodataval</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Intersection</b>(</code>raster  <var class="pdparam">rast1</var>, raster  <var class="pdparam">rast2</var>, text  <var class="pdparam">returnband='BOTH'</var>, double precision[]  <var class="pdparam">nodataval=NULL</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Intersection</b>(</code>raster  <var class="pdparam">rast1</var>, integer  <var class="pdparam">band_num1</var>, raster  <var class="pdparam">rast2</var>, integer  <var class="pdparam">band_num2</var>, double precision[]  <var class="pdparam">nodataval</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Intersection</b>(</code>raster  <var class="pdparam">rast1</var>, integer  <var class="pdparam">band_num1</var>, raster  <var class="pdparam">rast2</var>, integer  <var class="pdparam">band_num2</var>, text  <var class="pdparam">returnband='BOTH'</var>, double precision[]  <var class="pdparam">nodataval=NULL</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287147508"></a><h2>説明</h2><p>2つのラスタの共有部分またはベクタ化したラスタとジオメトリとのインタセクションを表現する、ラスタまたはジオメトリとピクセル値のペアの集合を返します。</p><p>前半の3形式は、setof geomvalを返すもので、ベクタ形状を引数に取ります。ラスタは初めにgeomval行の集合にベクトル化されます(ST_DumpAsPolygonを使用)。これらの行はPostGIS関数のST_Intersection(geometry, geometry)を使ってジオメトリとインタセクトさせます。NODATA値の領域とだけインタセクトするジオメトリについては空ジオメトリを返します。通常はWHERE節でST_Intersectsを使って結果から確実に排除します。</p><p>


丸括弧でくくって式の末尾に'.geom'や'.val'をつけることにより、geomvalの結果集合のジオメトリや値の部分にアクセスすることができます。たとえば(ST_Intersection(rast, geom)).geom等とします。</p><p>他の形式は、ラスタを引数に取り、ラスタを返します。ST_MapAlgebraExprの2ラスタ版を使って、インタセクトしている部分を取得します。</p><p>
結果ラスタの範囲は、2つのラスタの範囲についてインタセクトしている部分です。結果ラスタは、<code class="varname">returnband</code>引数として渡されたものにあわせられた'BAND1','BAND2','BOTH'バンドを含みます。どのバンドでもNODATA値の領域は、結果ラスタの全てのバンドのNODATA値領域に現れます。言い換えると、あらゆるNODATA値ピクセルとインタセクトしているピクセルは、結果ラスタではNODATA値ピクセルになります。</p><p>
インタセクトしなかった領域に値を入れるために、ST_Intersectionからの結果ラスタは、NODATA値を持たなければなりません。
結果ラスタのどのバンドにも、1つか2つのNODATA値を持つ<code class="varname">nodataval[]</code>配列を与えることでNODATA値を定義したり置き換えたりできます。この配列は、引数で与えた'BAND1','BAND2','BOTH'バンドに依存します。
配列のひとつめの値は、ひとつめのバンドのNODATA値を入れ替えるものです。ふたつめの値はふたつめのバンドのNODATA値を入れ替えるののです。入力バンドの1つがNODATA値を持っておらず、かつ配列を渡さなかった場合には、ST_MinPossibleValue関数を使ってNODATA値が選ばれます。NODATA値の配列を受け付ける形式の全てが、単一値を受け付けます。単一値は結果ラスタのそれぞれのバンドに適用されます。</p><p>全ての形式で、バンド番号がない場合には、1番バンドを仮定します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>
NODATA値に遭遇した時の、結果範囲や返された物に関して、より多くの制御を行いたい場合には、<a class="xref" href="#RT_ST_MapAlgebraExpr2" title="ST_MapAlgebraExpr">ST_MapAlgebraExpr</a>の2ラスタ版を使います。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ラスタバンドとジオメトリとがインタセクトする部分を計算するには、<a class="xref" href="#RT_ST_Clip" title="ST_Clip">ST_Clip</a>を使います。ST_Clipは複数のバンドで動作し、ラスタ化されたジオメトリに従ったバンドを返すことはしません。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_IntersectionはST_Intersectsと併用して、ラスタカラムとジオメトリカラムのインデクスを使うべきです。</p></td></tr></table></div><p>機能強化: 2.0.0 - ラスタ空間のインタセクションが導入されました。2.0.0より前の版では、ベクタ空間でのインタセクションの計算のみに対応していました。</p></div><div class="refsection" title="例: ジオメトリ,ラスタ -- ジオメトリと値を得ます"><a name="id287147566"></a><h2>例: ジオメトリ,ラスタ -- ジオメトリと値を得ます</h2><pre class="programlisting">SELECT foo.rid, foo.gid, 
   ST_AsText((foo.geomval).geom) As geomwkt, (foo.geomval).val
FROM
	(
SELECT A.rid, g.gid , ST_Intersection(A.rast, g.geom) As geomval
 FROM dummy_rast AS A CROSS JOIN 
	(VALUES (1, ST_Point(3427928, 5793243.85) ) ,
		(2, ST_GeomFromText('LINESTRING(3427927.85 5793243.75,3427927.8 5793243.75,3427927.8 5793243.8)') ),
		(3, ST_GeomFromText('LINESTRING(1 2, 3 4)') )
		) As g(gid,geom)
WHERE A.rid =2 ) As foo;

 rid | gid |      geomwkt												| val
-----+-----+---------------------------------------------------------------------------------------------
   2 |   1 | POINT(3427928 5793243.85)									| 249
   2 |   1 | POINT(3427928 5793243.85)									| 253
   2 |   2 | POINT(3427927.85 5793243.75)								| 254
   2 |   2 | POINT(3427927.8 5793243.8)									| 251
   2 |   2 | POINT(3427927.8 5793243.8)									| 253
   2 |   2 | LINESTRING(3427927.8 5793243.75,3427927.8 5793243.8)   	| 252
   2 |   2 | MULTILINESTRING((3427927.8 5793243.8,3427927.8 5793243.75),...) | 250
   2 |   3 | GEOMETRYCOLLECTION EMPTY
</pre></div><div class="refsection" title="例: ラスタ,ジオメトリ-- ラスタを得ます"><a name="id287147577"></a><h2>例: ラスタ,ジオメトリ-- ラスタを得ます</h2><p>近日公開</p></div><div class="refsection" title="関連情報"><a name="id287147589"></a><h2>関連情報</h2><p><a class="xref" href="#geomval" title="geomval">geomval</a>, <a class="xref" href="#RT_ST_Intersects" title="ST_Intersects">ST_Intersects</a>, <a class="xref" href="#RT_ST_MapAlgebraExpr2" title="ST_MapAlgebraExpr">ST_MapAlgebraExpr</a>, <a class="xref" href="#RT_ST_Clip" title="ST_Clip">ST_Clip</a>, <a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a></p></div></div><div class="refentry" title="ST_MapAlgebraExpr"><div class="refentry.separator"><hr></div><a name="RT_ST_MapAlgebraExpr"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MapAlgebraExpr ? 1バンド版: 入力バンドに対する妥当なPostgreSQL代数演算で形成された、指定したピクセルタイプの1バンドのラスタを生成します。バンドを指定しない場合は1番と仮定します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebraExpr</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">band</var>, text  <var class="pdparam">pixeltype</var>, text  <var class="pdparam">expression</var>, double precision  <var class="pdparam">nodataval=NULL</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebraExpr</b>(</code>raster  <var class="pdparam">rast</var>, text  <var class="pdparam">pixeltype</var>, text  <var class="pdparam">expression</var>, double precision  <var class="pdparam">nodataval=NULL</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287147767"></a><h2>説明</h2><p>入力ラスタ(<code class="varname">rast</code>)に対して<code class="varname">expression</code>で定義される妥当なPostgreSQL代数演算で形成されるラスタを返します。生成されるラスタは指定したピクセルタイプの1バンドのラスタです。<code class="varname">band</code>を指定しない場合は1番と仮定します。新しいラスタは、元のラスタと同じ地理参照、幅、高さを持ちますが、1つのバンドしか持ちません。</p><p><code class="varname">pixeltype</code>が渡された場合には、新しいラスタは、指定されたピクセルタイプのバンドを持ちます。pixeltypeとしてNULLが渡されたりピクセルタイプを指定しない場合には、新しいラスタは<code class="varname">rast</code>の入力バンドと同じピクセルタイプになります。</p><p>数式の中で使える語は、元バンドのピクセル値を参照する<code class="varname">[rast]</code>、1はじまりのピクセル列インデクスを参照する<code class="varname">[rast.x]</code>、1はじまりのピクセル行インデクスを参照する<code class="varname">[rast.y]</code>です。</p><p>初出: 2.0.0 </p></div><div class="refsection" title="例"><a name="id287147812"></a><h2>例</h2><p>元のラスタから1バンドのラスタを生成します。元のラスタバンドの値について2で割った余りが入ります。</p><pre class="programlisting">ALTER TABLE dummy_rast ADD COLUMN map_rast raster;
UPDATE dummy_rast SET map_rast = ST_MapAlgebraExpr(rast,NULL,'mod([rast],2)') WHERE rid = 2;

SELECT ST_Value(rast,1,i,j) As origval, ST_Value(map_rast, 1, i, j) As mapval
FROM dummy_rast CROSS JOIN generate_series(1, 3) AS i CROSS JOIN generate_series(1,3) AS j
WHERE rid = 2;

 origval | mapval
---------+--------
     253 |      1
     254 |      0
     253 |      1
     253 |      1
     254 |      0
     254 |      0
     250 |      0
     254 |      0
     254 |      0
				</pre><p>ピクセルタイプが2BUIの1バンドラスタを生成します。元のラスタに対して再分類を行った値が入り、NODATA値を0に設定します。</p><pre class="programlisting">ALTER TABLE dummy_rast ADD COLUMN map_rast2 raster;
UPDATE dummy_rast SET map_rast2 = ST_MapAlgebraExpr(rast,'2BUI','CASE WHEN [rast] BETWEEN 100 and 250 THEN 1 
WHEN [rast] = 252 THEN 2 
WHEN [rast] BETWEEN 253 and 254 THEN 3 ELSE 0 END', '0') WHERE rid = 2;

SELECT DISTINCT ST_Value(rast,1,i,j) As origval, ST_Value(map_rast2, 1, i, j) As mapval
FROM dummy_rast CROSS JOIN generate_series(1, 5) AS i CROSS JOIN generate_series(1,5) AS j
WHERE rid = 2;

 origval | mapval
---------+--------
     249 |      1
     250 |      1
     251 |
     252 |      2
     253 |      3
     254 |      3
     
SELECT ST_BandPixelType(map_rast2) As b1pixtyp
FROM dummy_rast WHERE rid = 2;

 b1pixtyp
----------
 2BUI</pre><div class="informaltable"><table border="1"><colgroup><col><col></colgroup><tbody><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_mapalgebraexpr01.png"><div class="caption"><p>元のラスタ(rast-viewカラム)</p></div></div></div>
		 </td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_mapalgebraexpr02.png"><div class="caption"><p>rast_view_ma</p></div></div></div>
		 </td></tr></tbody></table></div><p>新しい3バンドラスタを生成します。元の3バンドラスタと同じピクセルタイプです。1番バンドは地図代数関数によって変更され、あとの2バンドは値が代わりません。</p><pre class="programlisting">SELECT ST_AddBand(
ST_AddBand(
	ST_AddBand(
		ST_MakeEmptyRaster(rast_view),
			ST_MapAlgebraExpr(rast_view,1,NULL,'tan([rast])*[rast]')
			), 
		ST_Band(rast_view,2)
			),
	ST_Band(rast_view, 3) As rast_view_ma
)
FROM wind
WHERE rid=167;		
				</pre></div><div class="refsection" title="関連情報"><a name="id287147898"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_MapAlgebraExpr2" title="ST_MapAlgebraExpr">ST_MapAlgebraExpr</a>, <a class="xref" href="#RT_ST_MapAlgebraFct" title="ST_MapAlgebraFct">ST_MapAlgebraFct</a>, <a class="xref" href="#RT_ST_BandPixelType" title="ST_BandPixelType">ST_BandPixelType</a>, <a class="xref" href="#RT_ST_GeoReference" title="ST_GeoReference">ST_GeoReference</a>,  <a class="xref" href="#RT_ST_Value" title="ST_Value">ST_Value</a></p></div></div><div class="refentry" title="ST_MapAlgebraExpr"><div class="refentry.separator"><hr></div><a name="RT_ST_MapAlgebraExpr2"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MapAlgebraExpr ? 2バンド版: 2つの入力バンドに対する妥当なPostgreSQL代数演算で形成された、指定したピクセルタイプの1バンドのラスタを生成します。バンドを指定しない場合はどちらも1番と仮定します。結果ラスタは、ひとつめのラスタのアラインメント(スケール、スキュー、ピクセル角位置)にあわされます。範囲は"extenttype"引数で定義されます。取りうる"extenttype"の値はINTERSECTION, UNION, FIRST, SECONDです。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebraExpr</b>(</code>raster  <var class="pdparam">rast1</var>, raster  <var class="pdparam">rast2</var>, text  <var class="pdparam">expression</var>, text  <var class="pdparam">pixeltype=same_as_rast1_band</var>, text  <var class="pdparam">extenttype=INTERSECTION</var>, text  <var class="pdparam">nodata1expr=NULL</var>, text  <var class="pdparam">nodata2expr=NULL</var>, double precision  <var class="pdparam">nodatanodataval=NULL</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebraExpr</b>(</code>raster  <var class="pdparam">rast1</var>, integer  <var class="pdparam">band1</var>, raster  <var class="pdparam">rast2</var>, integer  <var class="pdparam">band2</var>, text  <var class="pdparam">expression</var>, text  <var class="pdparam">pixeltype=same_as_rast1_band</var>, text  <var class="pdparam">extenttype=INTERSECTION</var>, text  <var class="pdparam">nodata1expr=NULL</var>, text  <var class="pdparam">nodata2expr=NULL</var>, double precision  <var class="pdparam">nodatanodataval=NULL</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287148197"></a><h2>説明</h2><p>2つの入力ラスタ(<code class="varname">rast1</code>, <code class="varname">rast2</code>)に対して<code class="varname">expression</code>で定義される妥当なPostgreSQL代数演算で形成されラスタを返します。
<code class="varname">band1</code>と<code class="varname">band2</code>が指定されていない場合は1番と仮定します。結果ラスタは、ひとつめのラスタのアラインメント(スケール、スキュー、ピクセル角位置)にあわされます。範囲は"extenttype"引数で定義されます。</p><div class="variablelist"><dl><dt><span class="term">expression</span></dt><dd><p>2つのラスタを使うPsotgreSQL代数式です。関数と演算子が定義されているPostgreSQLは、ピクセルがインタセクトする時、ピクセル値を (([rast1] + [rast2])/2.0)::integer のように定義します。</p></dd><dt><span class="term">pixeltype</span></dt><dd><p>出力ラスタのピクセルタイプです。<a class="xref" href="#RT_ST_BandPixelType" title="ST_BandPixelType">ST_BandPixelType</a>で挙げられるうちの1つか、渡さない、NULLでなければなりません。渡さないかNULLを渡した場合には、ピクセルタイプは、ひとつめのラスタと同じになります。</p></dd><dt><span class="term">extenttype</span></dt><dd><p>結果ラスタの範囲を制御します。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><code class="varname">INTERSECTION</code> - 新しいラスタの範囲は2つのラスタがインタセクトしている部分です。これがデフォルトです。</p></li><li class="listitem"><p><code class="varname">UNION</code> - 新しいラスタの範囲は2つのラスタの結合です。</p></li><li class="listitem"><p><code class="varname">FIRST</code> - 新しいラスタの範囲は、ひとつめのラスタと同じです。</p></li><li class="listitem"><p><code class="varname">SECOND</code> - 新しいラスタの範囲は、ふたつめのラスタと同じです。</p></li></ol></div></dd><dt><span class="term">nodata1expr</span></dt><dd><p><code class="varname">rast1</code>のピクセルががNODATA値になり、空間的に対応するrast2のピクセルが値を持っている時に返される値を定義する、<code class="varname">rast2</code>だけを使う代数式または定数です。</p></dd><dt><span class="term">nodata2expr</span></dt><dd><p><code class="varname">rast2</code>のピクセルががNODATA値になり、空間的に対応するrast1のピクセルが値を持っている時に返される値を定義する、<code class="varname">rast1</code>だけを使う代数式または定数です。</p></dd><dt><span class="term">nodatanodataval</span></dt><dd><p>空間的に対応するrast1とrast2のピクセルの両方がNODATA値の時に返される数値定数です。</p></dd></dl></div><p>
<code class="varname">pixeltype</code>が渡された場合には、新しいラスタは、指定されたピクセルタイプのバンドを持ちます。pixeltypeとしてNULLが渡されたりピクセルタイプを指定しない場合には、新しいラスタはrastの<code class="varname">rast1</code>バンドと同じピクセルタイプになります。</p><p>数式の中で使える語は、元バンドのピクセル値を参照する<code class="varname">[rast1.val]</code>と<code class="varname">[rast2.val]</code>、1はじまりのピクセル/行インデクスを参照する<code class="varname">[rast1.x]</code>と<code class="varname">[rast1.y]</code>です。</p><p>初出: 2.0.0 </p></div><div class="refsection" title="例: 2バンドの共有と結合"><a name="id287148480"></a><h2>例: 2バンドの共有と結合</h2><pre class="programlisting">
-- ラスタの集合の生成 --
DROP TABLE IF EXISTS fun_shapes; 
CREATE TABLE fun_shapes(rid serial PRIMARY KEY, fun_name text, rast raster);

-- メートル単位のマサチューセッツ平面でボストンのまわりの形状を挿入 --
INSERT INTO fun_shapes(fun_name, rast)
VALUES ('ref', ST_AsRaster(ST_MakeEnvelope(235229, 899970, 237229, 901930,26986),200,200,'8BUI',0,0));

INSERT INTO fun_shapes(fun_name,rast)
WITH ref(rast) AS (SELECT rast FROM fun_shapes WHERE fun_name = 'ref' ) 
SELECT 'area' AS fun_name, ST_AsRaster(ST_Buffer(ST_SetSRID(ST_Point(236229, 900930),26986), 1000), 
			ref.rast,'8BUI', 10, 0) As rast
FROM ref
UNION ALL
SELECT 'rand bubbles', 
		 	ST_AsRaster( 
		 	(SELECT ST_Collect(geom)
	FROM (SELECT ST_Buffer(ST_SetSRID(ST_Point(236229 + i*random()*100, 900930 + j*random()*100),26986), random()*20) As geom
			FROM generate_series(1,10) As i, generate_series(1,10) As j
			) As foo ), ref.rast,'8BUI', 200, 0) 
FROM ref;

-- 共有と結合の生成 --
SELECT  ST_MapAlgebraExpr(
		area.rast, bub.rast, '[rast2.val]', '8BUI', 'INTERSECTION', '[rast2.val]', '[rast1.val]') As interrast,
		ST_MapAlgebraExpr(
			area.rast, bub.rast, '[rast2.val]', '8BUI', 'UNION', '[rast2.val]', '[rast1.val]') As unionrast
FROM 
  (SELECT rast FROM fun_shapes WHERE
 fun_name = 'area') As area
CROSS JOIN  (SELECT rast 
FROM fun_shapes WHERE
 fun_name = 'rand bubbles') As bub
				</pre><div class="informaltable"><table border="1"><colgroup><col><col></colgroup><tbody><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_mapalgebraexpr2_01.png"><div class="caption"><p>INTERSECTIONの場合</p></div></div></div>
		 </td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_mapalgebraexpr2_02.png"><div class="caption"><p>UNIONの場合</p></div></div></div>
		 </td></tr></tbody></table></div></div><div class="refsection" title="例: 別個のバンドとしてのキャンバス上へのラスタのオーバレイ"><a name="id287148550"></a><h2>例: 別個のバンドとしてのキャンバス上へのラスタのオーバレイ</h2><pre class="programlisting">
-- ST_AsPNGを使って1バンドで灰色に見える画像を作成します --
WITH mygeoms 
    AS ( SELECT 2 As bnum, ST_Buffer(ST_Point(1,5),10) As geom
            UNION ALL
            SELECT 3 AS bnum, 
                ST_Buffer(ST_GeomFromText('LINESTRING(50 50,150 150,150 50)'), 10,'join=bevel') As geom
            UNION ALL
            SELECT 1 As bnum, 
                ST_Buffer(ST_GeomFromText('LINESTRING(60 50,150 150,150 50)'), 5,'join=bevel') As geom
            ),
   -- define our canvas to be 1 to 1 pixel to geometry
   canvas
    AS (SELECT ST_AddBand(ST_MakeEmptyRaster(200, 
        200, 
        ST_XMin(e)::integer, ST_YMax(e)::integer, 1, -1, 0, 0) , '8BUI'::text,0) As rast
        FROM (SELECT ST_Extent(geom) As e,
                    Max(ST_SRID(geom)) As srid 
                    from mygeoms 
                    ) As foo
            ),
   rbands AS (SELECT ARRAY(SELECT ST_MapAlgebraExpr(canvas.rast, ST_AsRaster(m.geom, canvas.rast, '8BUI', 100),
                 '[rast2.val]', '8BUI', 'FIRST', '[rast2.val]', '[rast1.val]') As rast
                FROM mygeoms AS m CROSS JOIN canvas
                ORDER BY m.bnum) As rasts
                )
          SELECT rasts[1] As rast1 , rasts[2] As rast2, rasts[3] As rast3, ST_AddBand(
                    ST_AddBand(rasts[1],rasts[2]), rasts[3]) As final_rast
            FROM rbands;</pre><div class="informaltable"><table border="1"><colgroup><col><col></colgroup><tbody><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_mapalgebraexpr2_04.png"><div class="caption"><p>rast1</p></div></div></div>
		 </td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_mapalgebraexpr2_05.png"><div class="caption"><p>rast2</p></div></div></div>
		 </td></tr><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_mapalgebraexpr2_06.png"><div class="caption"><p>rast3</p></div></div></div>
		 </td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_mapalgebraexpr2_07.png"><div class="caption"><p>final_rast</p></div></div></div>
		 </td></tr></tbody></table></div></div><div class="refsection" title="例: 選択した区画の2メートル幅境界線の空中写真へのオーバレイ"><a name="id287148665"></a><h2>例: 選択した区画の2メートル幅境界線の空中写真へのオーバレイ</h2><pre class="programlisting">-- 前2つの切り取ったバンドと
--   第3バンドにジオメトリをオーバレイしたバンドの
--   3バンドのラスタを生成します
-- このクエリはWindows 64ビット版のPostGISで3.6秒かかりました
WITH pr AS
-- 演算の順序の注意: 全てのラスタを必要なピクセル範囲に切り抜いています
(SELECT ST_Clip(rast,ST_Expand(geom,50) ) As rast, g.geom
	FROM aerials.o_2_boston AS r INNER JOIN
-- あとでインタセクトできるように対象区画を結合して1つのジオメトリにします
		(SELECT ST_Union(ST_Transform(the_geom,26986)) AS geom 
		  FROM landparcels WHERE pid IN('0303890000', '0303900000')) As g
		ON ST_Intersects(rast::geometry, ST_Expand(g.geom,50))
),
-- ラスタの破片を結合します
-- ラスタのST_Unionは非常に遅いですがラスタを小さくすれば速度が上がります
-- 先に切り出しておいてから結合しているのはこのためです
prunion AS
(SELECT ST_AddBand(NULL, ARRAY[ST_Union(rast,1),ST_Union(rast,2),ST_Union(rast,3)] ) As clipped,geom
FROM pr
GROUP BY geom)
-- ラスタの破片が結合され、区画境界線のオーバレイも持った
-- 最終のラスタを返します
-- 最初の2バンドと3番バンド+ジオメトリの地図代数関数とを追加します
SELECT ST_AddBand(ST_Band(clipped,ARRAY[1,2])
	, ST_MapAlgebraExpr(ST_Band(clipped,3), ST_AsRaster(ST_Buffer(ST_Boundary(geom),2),clipped, '8BUI',250),
	 '[rast2.val]', '8BUI', 'FIRST', '[rast2.val]', '[rast1.val]') ) As rast
FROM prunion;</pre><div class="informaltable"><table border="1"><colgroup><col></colgroup><tbody><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_mapalgebraexpr2_08.png"><div class="caption"><p>The blue lines are the boundaries of select parcels</p></div></div></div>
		 </td></tr></tbody></table></div></div><div class="refsection" title="関連情報"><a name="id287148711"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_MapAlgebraExpr" title="ST_MapAlgebraExpr">ST_MapAlgebraExpr</a>, <a class="xref" href="#RT_ST_AddBand" title="ST_AddBand">ST_AddBand</a>, <a class="xref" href="#RT_ST_AsPNG" title="ST_AsPNG">ST_AsPNG</a>, <a class="xref" href="#RT_ST_AsRaster" title="ST_AsRaster">ST_AsRaster</a>, <a class="xref" href="#RT_ST_MapAlgebraFct" title="ST_MapAlgebraFct">ST_MapAlgebraFct</a>, <a class="xref" href="#RT_ST_BandPixelType" title="ST_BandPixelType">ST_BandPixelType</a>, <a class="xref" href="#RT_ST_GeoReference" title="ST_GeoReference">ST_GeoReference</a>,  <a class="xref" href="#RT_ST_Value" title="ST_Value">ST_Value</a>
				, <a class="xref" href="#RT_ST_Union" title="ST_Union">ST_Union</a>,  <a class="xref" href="#ST_Union" title="ST_Union">ST_Union</a></p></div></div><div class="refentry" title="ST_MapAlgebraFct"><div class="refentry.separator"><hr></div><a name="RT_ST_MapAlgebraFct"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MapAlgebraFct ? 1バンド版 - 入力バンドに対する妥当なPostgreSQL関数で形成された、指定したピクセルタイプの1バンドのラスタを生成します。バンドを指定しない場合は1番と仮定します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebraFct</b>(</code>raster <var class="pdparam">rast</var>, regprocedure <var class="pdparam">onerasteruserfunc</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebraFct</b>(</code>raster <var class="pdparam">rast</var>, regprocedure <var class="pdparam">onerasteruserfunc</var>, text[] <var class="pdparam">VARIADIC args</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebraFct</b>(</code>raster <var class="pdparam">rast</var>, text <var class="pdparam">pixeltype</var>, regprocedure <var class="pdparam">onerasteruserfunc</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebraFct</b>(</code>raster <var class="pdparam">rast</var>, text <var class="pdparam">pixeltype</var>, regprocedure <var class="pdparam">onerasteruserfunc</var>, text[] <var class="pdparam">VARIADIC args</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebraFct</b>(</code>raster <var class="pdparam">rast</var>, integer <var class="pdparam">band</var>, regprocedure <var class="pdparam">onerasteruserfunc</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebraFct</b>(</code>raster <var class="pdparam">rast</var>, integer <var class="pdparam">band</var>, regprocedure <var class="pdparam">onerasteruserfunc</var>, text[] <var class="pdparam">VARIADIC args</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebraFct</b>(</code>raster <var class="pdparam">rast</var>, integer <var class="pdparam">band</var>, text <var class="pdparam">pixeltype</var>, regprocedure <var class="pdparam">onerasteruserfunc</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebraFct</b>(</code>raster <var class="pdparam">rast</var>, integer <var class="pdparam">band</var>, text <var class="pdparam">pixeltype</var>, regprocedure <var class="pdparam">onerasteruserfunc</var>, text[] <var class="pdparam">VARIADIC args</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287149161"></a><h2>説明</h2><p>
入力ラスタ(<code class="varname">rast</code>)に対して<code class="varname">onerasteruserfunc</code>で指定される妥当なPostgreSQL関数で形成されラスタを返します。生成されるラスタは指定したピクセルタイプの1バンドのラスタです。<code class="varname">band</code>を指定しない場合は1番と仮定します。新しいラスタは、元のラスタと同じ地理参照、幅、高さを持ちますが、1つのバンドしか持ちません。</p><p><code class="varname">pixeltype</code>が渡された場合には、新しいラスタは、指定されたピクセルタイプのバンドを持ちます。pixeltypeとしてNULLが渡された場合には、新しいラスタは<code class="varname">rast</code>の入力バンドと同じピクセルタイプになります。</p><p>
<code class="varname">onerasteruserfunc</code>引数は
SQL関数またはPL/pgSQL関数のシグネチャで、regprocedureにキャストします。大変単純で本当に使えないPL/pgSQL関数の例を挙げます。
                </p><pre class="programlisting">CREATE OR REPLACE FUNCTION simple_function(pixel FLOAT, pos INTEGER[], VARIADIC args TEXT[])
    RETURNS FLOAT
    AS $$ BEGIN
        RETURN 0.0;
    END; $$
    LANGUAGE 'plpgsql' IMMUTABLE;</pre><p>
                <code class="varname">userfunction</code>は2または3の引数を受け付けます。すなわち、float値、任意の整数配列、VARIADIC文字列配列です。第1引数はラスタセルごとの値です(ラスタのデータ型に関係なく)。第2引数は現在の処理セルの位置で、'{x,y}'であらわされます。第3引数は、<a class="xref" href="#RT_ST_MapAlgebraFct" title="ST_MapAlgebraFct">ST_MapAlgebraFct</a>へのパラメータの残っているもの全てが<code class="varname">userfunction</code>に渡されることを示します。</p><p>

<span class="type">regprodedure</span>引数をSQL関数に渡す際は完全な関数シグネチャと<span class="type">regprocedure</span>型へのキャストが求められます。
上のPL/pgSQL関数を引数に取るには、引数のSQLは</p><pre class="programlisting">'simple_function(float,integer[],text[])'::regprocedure</pre><p>となります。
引数は関数名、引数の型を含み、名前と引数型全体に対して引用符でくくり、<span class="type">regprocedure</span>にキャストしていることに注意して下さい。</p><p><code class="varname">userfunction</code>の第3引数は<span class="type">variadic text</span>配列です。どの<a class="xref" href="#RT_ST_MapAlgebraFct" title="ST_MapAlgebraFct">ST_MapAlgebraFct</a>にもついてくる全ての文字列引数は、指定された<code class="varname">userfunction</code>に、そのまま渡されて、<code class="varname">args</code>引数内に入ります。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>VARIADICキーワードについてのより多くの情報については、PostgreSQLドキュメント、<a class="ulink" href="http://www.postgresql.jp/document/9.1/html/xfunc-sql.html" target="_top">問い合わせ言語（SQL）関数</a>の「可変長引数を取るSQL関数」の節を参照して下さい。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">userfunction</code>への<span class="type">text[]</span>引数は、あらゆる引数を処理のためにユーザ関数に渡すかどうかの選択にかかわらず求められます。</p></td></tr></table></div><p>初出: 2.0.0</p></div><div class="refsection" title="例"><a name="id287149269"></a><h2>例</h2><p>元のラスタから1バンドのラスタを生成します。元のラスタバンドの値について2で割った余りが入ります。</p><pre class="programlisting">ALTER TABLE dummy_rast ADD COLUMN map_rast raster;
CREATE FUNCTION mod_fct(pixel float, pos integer[], variadic args text[])
RETURNS float
AS $$
BEGIN
    RETURN pixel::integer % 2;
END;
$$
LANGUAGE 'plpgsql' IMMUTABLE;

UPDATE dummy_rast SET map_rast = ST_MapAlgebraFct(rast,NULL,'mod_fct(float,integer[],text[])'::regprocedure) WHERE rid = 2;

SELECT ST_Value(rast,1,i,j) As origval, ST_Value(map_rast, 1, i, j) As mapval
FROM dummy_rast CROSS JOIN generate_series(1, 3) AS i CROSS JOIN generate_series(1,3) AS j
WHERE rid = 2;

 origval | mapval
---------+--------
     253 |      1
     254 |      0
     253 |      1
     253 |      1
     254 |      0
     254 |      0
     250 |      0
     254 |      0
     254 |      0
 				</pre><p>ピクセルタイプが2BUIの1バンドラスタを生成します。元のラスタに対して再分類を行った値が入り、NODATA値をユーザ関数に渡される引数の値(0)に設定します。</p><pre class="programlisting">ALTER TABLE dummy_rast ADD COLUMN map_rast2 raster;
CREATE FUNCTION classify_fct(pixel float, pos integer[], variadic args text[])
RETURNS float
AS
$$
DECLARE
    nodata float := 0;
BEGIN
    IF NOT args[1] IS NULL THEN
        nodata := args[1];
    END IF;
    IF pixel &lt; 251 THEN
        RETURN 1;
    ELSIF pixel = 252 THEN
        RETURN 2;
    ELSIF pixel &gt; 252 THEN
        RETURN 3;
    ELSE
        RETURN nodata;
    END IF;
END;
$$
LANGUAGE 'plpgsql';
UPDATE dummy_rast SET map_rast2 = ST_MapAlgebraFct(rast,'2BUI','classify_fct(float,integer[],text[])'::regprocedure, '0') WHERE rid = 2;

SELECT DISTINCT ST_Value(rast,1,i,j) As origval, ST_Value(map_rast2, 1, i, j) As mapval
FROM dummy_rast CROSS JOIN generate_series(1, 5) AS i CROSS JOIN generate_series(1,5) AS j
WHERE rid = 2;

 origval | mapval
---------+--------
     249 |      1
     250 |      1
     251 |
     252 |      2
     253 |      3
     254 |      3
     
SELECT ST_BandPixelType(map_rast2) As b1pixtyp
FROM dummy_rast WHERE rid = 2;

 b1pixtyp
----------
 2BUI</pre><div class="informaltable"><table border="1"><colgroup><col><col></colgroup><tbody><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_mapalgebraexpr01.png"><div class="caption"><p>元のラスタ(rast-viewカラム)</p></div></div></div></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_mapalgebraexpr02.png"><div class="caption"><p>rast_view_ma</p></div></div></div></td></tr></tbody></table></div><p>新しい3バンドラスタを生成します。元の3バンドラスタと同じピクセルタイプです。1番バンドは地図代数関数によって変更され、あとの2バンドは値が代わりません。</p><pre class="programlisting">CREATE FUNCTION rast_plus_tan(pixel float, pos integer[], variadic args text[])
RETURNS float
AS
$$
BEGIN
	RETURN tan(pixel) * pixel;
END;
$$
LANGUAGE 'plpgsql';

SELECT ST_AddBand(
	ST_AddBand(
		ST_AddBand(
			ST_MakeEmptyRaster(rast_view),
			ST_MapAlgebraFct(rast_view,1,NULL,'rast_plus_tan(float,integer[],text[])'::regprocedure)
		), 
		ST_Band(rast_view,2)
	),
	ST_Band(rast_view, 3) As rast_view_ma
)
FROM wind
WHERE rid=167;		
				</pre></div><div class="refsection" title="関連情報"><a name="id287149353"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_MapAlgebraExpr" title="ST_MapAlgebraExpr">ST_MapAlgebraExpr</a>, <a class="xref" href="#RT_ST_BandPixelType" title="ST_BandPixelType">ST_BandPixelType</a>, <a class="xref" href="#RT_ST_GeoReference" title="ST_GeoReference">ST_GeoReference</a>, <a class="xref" href="#RT_ST_SetValue" title="ST_SetValue">ST_SetValue</a></p></div></div><div class="refentry" title="ST_MapAlgebraFct"><div class="refentry.separator"><hr></div><a name="RT_ST_MapAlgebraFct2"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MapAlgebraFct ? 2ラスタ版 - 2つの入力バンドに対する妥当なPostgreSQL関数で形成された、指定したピクセルタイプの1バンドのラスタを生成します。バンドを指定しない場合は1番と仮定します。"extenttype"のデフォルトはINTERSECTIONです。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebraFct</b>(</code>raster <var class="pdparam">rast1</var>, raster <var class="pdparam">rast2</var>, regprocedure <var class="pdparam">tworastuserfunc</var>, text <var class="pdparam">pixeltype=same_as_rast1</var>, text <var class="pdparam">extenttype=INTERSECTION</var>, text[] <var class="pdparam">VARIADIC userargs</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebraFct</b>(</code>raster <var class="pdparam">rast1</var>, integer <var class="pdparam">band1</var>, raster <var class="pdparam">rast2</var>, integer <var class="pdparam">band2</var>, regprocedure <var class="pdparam">tworastuserfunc</var>, text <var class="pdparam">pixeltype=same_as_rast1</var>, text <var class="pdparam">extenttype=INTERSECTION</var>, text[] <var class="pdparam">VARIADIC userargs</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287149608"></a><h2>説明</h2><p>

2つの入力ラスタ(<code class="varname">rast1</code>, <code class="varname">rast2</code>)に対して<code class="varname">tworastuserfunc</code>で指定される妥当なPostgreSQL関数で形成されるラスタを返します。
<code class="varname">band1</code>と<code class="varname">band2</code>が指定されていない場合は1番と仮定します。結果ラスタは、ひとつめのラスタのアラインメント(スケール、スキュー、ピクセル角位置)にあわされます。範囲は"extenttype"引数で定義されます。</p><p><code class="varname">pixeltype</code>が渡された場合には、新しいラスタはそのピクセルタイプのバンドを持ちます。pixelteypeとしてNULLが渡されりピクセルタイプを指定しない場合には、新しいラスタは<code class="varname">rast1</code>の入力バンドと同じピクセルタイプになります。</p><p><code class="varname">tworastuserfunc</code>引数はSQL関数またはPL/pgSQL関数のシグネチャで、regprocedureにキャストします。大変単純で本当に使えないPL/pgSQL関数の例を挙げます。
                </p><pre class="programlisting">CREATE OR REPLACE FUNCTION simple_function_for_two_rasters(pixel1 FLOAT, pixel2 FLOAT, pos INTEGER[], VARIADIC args TEXT[])
    RETURNS FLOAT
    AS $$ BEGIN
        RETURN 0.0;
    END; $$
    LANGUAGE 'plpgsql' IMMUTABLE;</pre><p>

                <code class="varname">tworastuserfunc</code>は3または4の引数を受け付けます。すなわち、倍精度浮動小数点数、倍精度浮動小数点数、任意の整数配列、VARIADIC文字列配列です。第1引数は<code class="varname">rast1</code>のラスタセルごとの値です(ラスタのデータ型に関係なく)。第2引数は<code class="varname">rast2</code>のラスタセルごとの値です。第3引数は現在の処理セルの位置で、'{x,y}'であらわされます。第4引数は、<a class="xref" href="#RT_ST_MapAlgebraFct2" title="ST_MapAlgebraFct">ST_MapAlgebraFct</a>へのパラメータの残っているもの全てが<code class="varname">tworastuserfunc</code>に渡されることを示します。</p><p><span class="type">regprodedure</span>引数をSQL関数に渡す際は完全な関数シグネチャと<span class="type">regprodedure</span>型へのキャストが求められます。上のPL/pgSQL関数を引数に取るには、引数のSQLは</p><pre class="programlisting">'simple_function(double precision, double precision, integer[], text[])'::regprocedure</pre><p>となります。引数は関数名、引数の型を含み、名前と引数型全体に対して引用符でくくり、<span class="type">regprocedure</span>にキャストしていることに注意して下さい。</p><p><code class="varname">tworastuserfunc</code>の第3引数は<span class="type">variadic text</span>配列です。どの<a class="xref" href="#RT_ST_MapAlgebraFct2" title="ST_MapAlgebraFct">ST_MapAlgebraFct</a>にもついてくる全ての文字列引数は、指定された<code class="varname">tworastuserfunc</code>に、そのまま渡されて、<code class="varname">userargs</code>引数内に入ります。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>VARIADICキーワードについてのより多くの情報については、PostgreSQLドキュメント、<a class="ulink" href="http://www.postgresql.jp/document/9.1/html/xfunc-sql.html" target="_top">問い合わせ言語（SQL）関数</a>の「可変長引数を取るSQL関数」の節を参照して下さい。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">tworastuserfunc</code>への<span class="type">text[]</span>引数は、あらゆる引数を処理のためにユーザ関数に渡すかどうかの選択にかかわらず求められます。</p></td></tr></table></div><p>初出: 2.0.0</p></div><div class="refsection" title="例: 別個のバンドとしてのキャンバス上へのラスタのオーバレイ"><a name="id287149725"></a><h2>例: 別個のバンドとしてのキャンバス上へのラスタのオーバレイ</h2><pre class="programlisting">
-- ユーザ関数の定義 --
CREATE OR REPLACE FUNCTION raster_mapalgebra_union(
	rast1 double precision,
	rast2 double precision,
    pos integer[],
	VARIADIC userargs text[]
)
	RETURNS double precision
	AS $$
	DECLARE
	BEGIN
		CASE
			WHEN rast1 IS NOT NULL AND rast2 IS NOT NULL THEN
				RETURN ((rast1 + rast2)/2.);
			WHEN rast1 IS NULL AND rast2 IS NULL THEN
				RETURN NULL;
			WHEN rast1 IS NULL THEN
				RETURN rast2;
			ELSE
				RETURN rast1;
		END CASE;

		RETURN NULL;
	END;
	$$ LANGUAGE 'plpgsql' IMMUTABLE COST 1000;

-- ラスタの試験テーブルを用意します
DROP TABLE IF EXISTS map_shapes;
CREATE TABLE map_shapes(rid serial PRIMARY KEY, rast raster, bnum integer, descrip text);
INSERT INTO map_shapes(rast,bnum, descrip)
WITH mygeoms 
    AS ( SELECT 2 As bnum, ST_Buffer(ST_Point(90,90),30) As geom, 'circle' As descrip
            UNION ALL
            SELECT 3 AS bnum, 
                ST_Buffer(ST_GeomFromText('LINESTRING(50 50,150 150,150 50)'), 15) As geom, 'big road' As descrip
            UNION ALL
            SELECT 1 As bnum, 
                ST_Translate(ST_Buffer(ST_GeomFromText('LINESTRING(60 50,150 150,150 50)'), 8,'join=bevel'), 10,-6) As geom, 'small road' As descrip
            ),
   -- ジオメトリキャンバスと1対1でキャンバスを定義
    AS ( SELECT ST_AddBand(ST_MakeEmptyRaster(250, 
        250, 
        ST_XMin(e)::integer, ST_YMax(e)::integer, 1, -1, 0, 0 ) , '8BUI'::text,0) As rast
        FROM (SELECT ST_Extent(geom) As e,
                    Max(ST_SRID(geom)) As srid 
                    from mygeoms 
                    ) As foo
            )
-- キャンバスとアラインメントの合ったラスタを返します
SELECT ST_AsRaster(m.geom, canvas.rast, '8BUI', 240) As rast, bnum, descrip
                FROM mygeoms AS m CROSS JOIN canvas
UNION ALL 
SELECT canvas.rast, 4, 'canvas'
FROM canvas;

-- 1つのバンド版の地図代数関数の実行とST_AddBandで集めます
INSERT INTO map_shapes(rast,bnum,descrip)
SELECT ST_AddBand(ST_AddBand(rasts[1], rasts[2]),rasts[3]), 4, 'map bands overlay fct union (canvas)'
	FROM (SELECT ARRAY(SELECT ST_MapAlgebraFct(m1.rast, m2.rast, 
			'raster_mapalgebra_union(double precision, double precision, integer[], text[])'::regprocedure, '8BUI', 'FIRST')
                FROM map_shapes As m1 CROSS JOIN map_shapes As m2
                	WHERE m1.descrip = 'canvas' AND m2.descrip &lt;&gt; 'canvas' ORDER BY m2.bnum) As rasts) As foo;

          </pre><div class="informaltable"><table border="1"><colgroup><col></colgroup><tbody><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_mapalgebrafct2_01.png"><div class="caption"><p>バンドオーバレイ(キャンバス)の図(赤:小さい道 緑:円、青:大きな道)</p></div></div></div>
		 </td></tr></tbody></table></div></div><div class="refsection" title="追加引数を取るユーザ定義関数"><a name="id287149772"></a><h2>追加引数を取るユーザ定義関数</h2><pre class="programlisting">	
CREATE OR REPLACE FUNCTION raster_mapalgebra_userargs(
	rast1 double precision,
	rast2 double precision,
    pos integer[],
	VARIADIC userargs text[]
)
	RETURNS double precision
	AS $$
	DECLARE
	BEGIN
		CASE
			WHEN rast1 IS NOT NULL AND rast2 IS NOT NULL THEN
				RETURN least(userargs[1]::integer,(rast1 + rast2)/2.);
			WHEN rast1 IS NULL AND rast2 IS NULL THEN
				RETURN userargs[2]::integer;
			WHEN rast1 IS NULL THEN
				RETURN greatest(rast2,random()*userargs[3]::integer)::integer;
			ELSE
				RETURN greatest(rast1, random()*userargs[4]::integer)::integer;
		END CASE;

		RETURN NULL;
	END;
	$$ LANGUAGE 'plpgsql' VOLATILE COST 1000;
	
SELECT ST_MapAlgebraFct(m1.rast, 1, m1.rast, 3,
			'raster_mapalgebra_userargs(double precision, double precision, integer[], text[])'::regprocedure,
				'8BUI', 'INTERSECT', '100','200','200','0') 
                FROM map_shapes As m1
                	WHERE m1.descrip = 'map bands overlay fct union (canvas)'; 
</pre><p>
	</p><div class="informalfigure"><div class="mediaobject"><img src="images/st_mapalgebrafct2_02.png"><div class="caption"><p>追加引数を持つユーザ定義関数と同じラスタからの異なるバンド</p></div></div></div><p>
	</p></div><div class="refsection" title="関連情報"><a name="id287149804"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_MapAlgebraExpr2" title="ST_MapAlgebraExpr">ST_MapAlgebraExpr</a>, <a class="xref" href="#RT_ST_BandPixelType" title="ST_BandPixelType">ST_BandPixelType</a>, <a class="xref" href="#RT_ST_GeoReference" title="ST_GeoReference">ST_GeoReference</a>, <a class="xref" href="#RT_ST_SetValue" title="ST_SetValue">ST_SetValue</a></p></div></div><div class="refentry" title="ST_MapAlgebraFctNgb"><div class="refentry.separator"><hr></div><a name="RT_ST_MapAlgebraFctNgb"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MapAlgebraFctNgb ? 1バンド版: ユーザ定義PostgreSQL関数を使用する最近傍地図代数関数です。入力ラスタバンドの近傍の値を与えたPL/pgSQLユーザ定義関数の結果からなるラスタを返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebraFctNgb</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">band</var>, text  <var class="pdparam">pixeltype</var>, integer  <var class="pdparam">ngbwidth</var>, integer  <var class="pdparam">ngbheight</var>, regprocedure  <var class="pdparam">onerastngbuserfunc</var>, text  <var class="pdparam">nodatamode</var>, text[]  <var class="pdparam">VARIADIC args</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287149959"></a><h2>説明</h2><p>(1バンド版)入力ラスタバンドの近傍の値を与えたPL/pgSQLユーザ定義関数の結果からなるラスタを返します。ユーザ定義関数は近傍のピクセル値を数の配列として取り、ピクセル毎に、ユーザ定義関数からの結果を返し、現在の対象ピクセルのピクセル値を関数の返り値に置き換えます。</p><div class="variablelist"><dl><dt><span class="term">rast</span></dt><dd><p>ユーザ定義関数が評価されるラスタです。</p></dd><dt><span class="term">band</span></dt><dd><p>評価されるラスタのバンド番号です。デフォルトは1です。</p></dd><dt><span class="term">pixeltype</span></dt><dd><p>出力ラスタのピクセルタイプです。<a class="xref" href="#RT_ST_BandPixelType" title="ST_BandPixelType">ST_BandPixelType</a>の一覧にあるものか、指定しないか、NULLを指定します。指定しないかNULLを指定した場合には、<code class="varname">rast</code>のピクセルタイプがデフォルトになります。結果ピクセル値がピクセルタイプが許容する範囲を超える場合には、切り詰められます。</p></dd><dt><span class="term">ngbwidth</span></dt><dd><p>セル単位の近傍の幅です。</p></dd><dt><span class="term">ngbheight</span></dt><dd><p>セル単位の近傍の高さです。</p></dd><dt><span class="term">onerastngbuserfunc</span></dt><dd><p>ラスタの単一バンドの近傍ピクセルに適用されるPL/pgSQLユーザ定義関数です。1つ目の要素は、近傍ピクセルの四角形を表現する数値の2次元配列です。</p></dd><dt><span class="term">nodatamode</span></dt><dd><p>NODATAまたはNULLとなる近傍ピクセルにおける関数に渡す値を定義します。</p><p>'ignore': 近傍で遭遇したNODATA値全てが計算から除外されます。ユーザ定義関数に必ず送られ、ユーザ定義関数が対処方法を決定します。</p><p>'NULL': 近傍で遭遇したNODATA値全てが結果をNULLとします。この場合はユーザ定義関数が呼び出されません。</p><p>'value': 近傍で遭遇したNODATA値全てが参照ピクセル(近傍の中心にあるピクセル)の値に置き換えられます。この値がNODATAになった場合には、'NULL'(影響のある近傍について)と同じ挙動を取ります。</p></dd><dt><span class="term">args</span></dt><dd><p>ユーザ定義関数に渡される引数です。</p></dd></dl></div><p>初出: 2.0.0 </p></div><div class="refsection" title="例"><a name="id287150113"></a><h2>例</h2><p>単一タイルとしてロードされたカトリーナのラスタを使った例です。<a class="ulink" href="http://trac.osgeo.org/gdal/wiki/frmts_wtkraster.html" target="_top">http://trac.osgeo.org/gdal/wiki/frmts_wtkraster.html</a>に説明があります。また、<a class="xref" href="#RT_ST_Rescale" title="ST_Rescale">ST_Rescale</a>の例で準備を行っています。</p><pre class="programlisting">
--
-- 近傍の値の全てに関する平均を計算する
--   単純なユーザ定義の「コールバック」関数です。
--
CREATE OR REPLACE FUNCTION rast_avg(matrix float[][], nodatamode text, variadic args text[])
    RETURNS float AS
    $$
    DECLARE
		_matrix float[][];
        x1 integer;
        x2 integer;
        y1 integer;
        y2 integer;
        sum float;
    BEGIN
		_matrix := matrix;
        sum := 0;
        FOR x in array_lower(matrix, 1)..array_upper(matrix, 1) LOOP
            FOR y in array_lower(matrix, 2)..array_upper(matrix, 2) LOOP
                sum := sum + _matrix[x][y];
            END LOOP;
        END LOOP;
        RETURN (sum*1.0/(array_upper(matrix,1)*array_upper(matrix,2) ))::integer ;
    END;
    $$
LANGUAGE 'plpgsql' IMMUTABLE COST 1000;
    
-- ラスタに対してX,Y軸でそれぞれ2ピクセル内の平均を計算するようにしています --
SELECT ST_MapAlgebraFctNgb(rast, 1,  '8BUI', 4,4,
		'rast_avg(float[][], text, text[])'::regprocedure, 'NULL', NULL) As nn_with_border
	FROM katrinas_rescaled 
	limit 1;
</pre><div class="informaltable"><table border="1"><colgroup><col><col></colgroup><tbody><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_mapalgebrafctngb01.png"><div class="caption"><p>ラスタの1番バンド</p></div></div></div></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_mapalgebrafctngb02.png"><div class="caption"><p>ぴくせる毎に4x4ピクセル内のピクセル平均を計算したラスタ</p></div></div></div></td></tr></tbody></table></div></div><div class="refsection" title="関連情報"><a name="id287150192"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_MapAlgebraFct" title="ST_MapAlgebraFct">ST_MapAlgebraFct</a>, <a class="xref" href="#RT_ST_MapAlgebraExpr" title="ST_MapAlgebraExpr">ST_MapAlgebraExpr</a>, <a class="xref" href="#RT_ST_Rescale" title="ST_Rescale">ST_Rescale</a></p></div></div><div class="refentry" title="ST_Polygon"><div class="refentry.separator"><hr></div><a name="RT_ST_Polygon"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Polygon ? 
NODATA値でないピクセル値を持つピクセルの結合で形成されるポリゴンジオメトリを返します。バンド番号を設定しない場合には、デフォルトは1番バンドです。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Polygon</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">band_num=1</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287150292"></a><h2>説明</h2><p>初出: GDAL 1.7以上が必要です。</p></div><div class="refsection" title="例"><a name="id287150301"></a><h2>例</h2><pre class="programlisting">
-- デフォルトではNODATA値は0になるか設定されていないので
--   ポリゴンは四角形のポリゴンとなります
SELECT ST_AsText(ST_Polygon(rast)) As geomwkt
FROM dummy_rast
WHERE rid = 2;

geomwkt
--------------------------------------------
POLYGON((3427927.8 5793243.75,3427927.75 5793243.75,3427927.75 5793243.8,3427927.75 5793243.85,3427927.75 5793243.9,
3427927.75 5793244,3427927.8 5793244,3427927.85 5793244,3427927.9 5793244,3427928 5793244,3427928 5793243.95,
3427928 5793243.85,3427928 5793243.8,3427928 5793243.75,3427927.85 5793243.75,3427927.8 5793243.75))
 		
 		
-- 1番バンドのNODATA値を変更します
UPDATE dummy_rast SET rast = ST_SetBandNoDataValue(rast,1,254)
WHERE rid = 2;
SELECt rid, ST_BandNoDataValue(rast)
from dummy_rast where rid = 2;

-- ST_Polygonピクセル値が254のピクセルを除外してマルチポリゴンを返します
SELECT ST_AsText(ST_Polygon(rast)) As geomwkt
FROM dummy_rast
WHERE rid = 2;

geomwkt
---------------------------------------------------------
MULTIPOLYGON(((3427927.9 5793243.95,3427927.85 5793243.95,3427927.85 5793244,3427927.9 5793244,3427927.9 5793243.95)),
((3427928 5793243.85,3427928 5793243.8,3427927.95 5793243.8,3427927.95 5793243.85,3427927.9 5793243.85,3427927.9 5793243.9,3427927.9 5793243.95,3427927.95 5793243.95,3427928 5793243.95,3427928 5793243.85)),
((3427927.8 5793243.75,3427927.75 5793243.75,3427927.75 5793243.8,3427927.75 5793243.85,3427927.75 5793243.9,3427927.75 5793244,3427927.8 5793244,
3427927.8 5793243.9,3427927.8 5793243.85,3427927.85 5793243.85,3427927.85 5793243.8,3427927.85 5793243.75,3427927.8 5793243.75)))

-- 1回だけ違うNODATA値にしてみます

SELECT ST_AsText(
	ST_Polygon(
		ST_SetBandNoDataValue(rast,1,252)
		)
	) As geomwkt
FROM dummy_rast
WHERE rid =2;

geomwkt
---------------------------------
POLYGON((3427928 5793243.85,3427928 5793243.8,3427928 5793243.75,3427927.85 5793243.75,3427927.8 5793243.75,3427927.8 5793243.8,3427927.75 5793243.8,3427927.75 5793243.85,3427927.75 5793243.9,3427927.75 5793244,3427927.8 5793244,3427927.85 5793244,3427927.9 5793244,3427928 5793244,3427928 5793243.95,3427928 5793243.85),
(3427927.9 5793243.9,3427927.9 5793243.85,3427927.95 5793243.85,3427927.95 5793243.9,3427927.9 5793243.9))


			</pre></div><div class="refsection" title="関連情報"><a name="id287150312"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Value" title="ST_Value">ST_Value</a>, <a class="xref" href="#RT_ST_DumpAsPolygons" title="ST_DumpAsPolygons">ST_DumpAsPolygons</a></p></div></div><div class="refentry" title="ST_Reclass"><div class="refentry.separator"><hr></div><a name="RT_ST_Reclass"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Reclass ? 元のラスタから再分類したバンドタイプからなるラスタを生成します。nbandは変更するバンドです。nbandが指定されていない場合は1番と仮定します。他の全てのバンドは変更せずに返します。可視画像の書式としてより単純な描画を行うために、16BUIバンドを8BUIバンドに変換する、等のために使います。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_Reclass</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, text  <var class="pdparam">reclassexpr</var>, text  <var class="pdparam">pixeltype</var>, double precision  <var class="pdparam">nodataval=NULL</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Reclass</b>(</code>raster  <var class="pdparam">rast</var>, reclassarg[]  <var class="pdparam">VARIADIC reclassargset</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Reclass</b>(</code>raster  <var class="pdparam">rast</var>, text  <var class="pdparam">reclassexpr</var>, text  <var class="pdparam">pixeltype</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287150465"></a><h2>説明</h2><p>
入力ラスタ(<code class="varname">rast</code>)に<code class="varname">reclassexpr</code>で定義する妥当なPostgreSQL代数演算子を起用して新しいラスタを生成します。
<code class="varname">band</code>が指定されていない場合は1番と仮定します。新しいラスは、元のラスタと同じ地理参照、幅、高さを持ちます。指示されていないバンドは変更せずに返ります。妥当な再分類の数式の説明については<a class="xref" href="#reclassarg" title="reclassarg">reclassarg</a>を参照して下さい。</p><p>新しいラスタのバンドは<code class="varname">pixeltype</code>で指定するピクセルタイプになります。<code class="varname">reclassargset</code>を渡した場合は、個々のreclassargが生成されるバンド毎の挙動を定義します。</p><p>初出: 2.0.0 </p></div><div class="refsection" title="基本的な例"><a name="id287150500"></a><h2>基本的な例</h2><p>元ラスタから新しいラスタを生成しますが、2番バンドを8BUIから4BUIに変換して、101-254をNODATA値にします。</p><pre class="programlisting">ALTER TABLE dummy_rast ADD COLUMN reclass_rast raster;
UPDATE dummy_rast SET reclass_rast = ST_Reclass(rast,2,'0-87:1-10, 88-100:11-15, 101-254:0-0', '4BUI',0) WHERE rid = 2;

SELECT i as col, j as row, ST_Value(rast,2,i,j) As origval, 
    ST_Value(reclass_rast, 2, i, j) As reclassval, 
    ST_Value(reclass_rast, 2, i, j, false) As reclassval_include_nodata
FROM dummy_rast CROSS JOIN generate_series(1, 3) AS i CROSS JOIN generate_series(1,3) AS j
WHERE rid = 2;

 col | row | origval | reclassval | reclassval_include_nodata
-----+-----+---------+------------+---------------------------
   1 |   1 |      78 |          9 |                         9
   2 |   1 |      98 |         14 |                        14
   3 |   1 |     122 |            |                         0
   1 |   2 |      96 |         14 |                        14
   2 |   2 |     118 |            |                         0
   3 |   2 |     180 |            |                         0
   1 |   3 |      99 |         15 |                        15
   2 |   3 |     112 |            |                         0
   3 |   3 |     169 |            |                         0</pre></div><div class="refsection" title="例: 複数の再分類を使った高度な例"><a name="id287150514"></a><h2>例: 複数の再分類を使った高度な例</h2><p>元ラスタから新しいラスタを生成しますが、1番,2番,3番バンドを1BB,4BUI,4BUIにそれぞれ変換して再分類します。
再分類の識別番号(理論的には元ラスタと同数のバンド)を入力するために取るVARIADIC <code class="varname">reclassarg</code>引数を使っています。</p><pre class="programlisting">UPDATE dummy_rast SET reclass_rast = 
    ST_Reclass(rast,
        ROW(2,'0-87]:1-10, (87-100]:11-15, (101-254]:0-0', '4BUI',NULL)::reclassarg,
        ROW(1,'0-253]:1, 254:0', '1BB', NULL)::reclassarg,
        ROW(3,'0-70]:1, (70-86:2, [86-150):3, [150-255:4', '4BUI', NULL)::reclassarg
        ) WHERE rid = 2;

SELECT i as col, j as row,ST_Value(rast,1,i,j) As ov1,  ST_Value(reclass_rast, 1, i, j) As rv1, 
    ST_Value(rast,2,i,j) As ov2, ST_Value(reclass_rast, 2, i, j) As rv2, 
    ST_Value(rast,3,i,j) As ov3, ST_Value(reclass_rast, 3, i, j) As rv3
FROM dummy_rast CROSS JOIN generate_series(1, 3) AS i CROSS JOIN generate_series(1,3) AS j
WHERE rid = 2;

col | row | ov1 | rv1 | ov2 | rv2 | ov3 | rv3
----+-----+-----+-----+-----+-----+-----+-----
  1 |   1 | 253 |   1 |  78 |   9 |  70 |   1
  2 |   1 | 254 |   0 |  98 |  14 |  86 |   3
  3 |   1 | 253 |   1 | 122 |   0 | 100 |   3
  1 |   2 | 253 |   1 |  96 |  14 |  80 |   2
  2 |   2 | 254 |   0 | 118 |   0 | 108 |   3
  3 |   2 | 254 |   0 | 180 |   0 | 162 |   4
  1 |   3 | 250 |   1 |  99 |  15 |  90 |   3
  2 |   3 | 254 |   0 | 112 |   0 | 108 |   3
  3 |   3 | 254 |   0 | 169 |   0 | 175 |   4</pre></div><div class="refsection" title="例: 単一バンドで32BFのラスタをの可視ラスタへの高度な対応付け"><a name="id287150532"></a><h2>例: 単一バンドで32BFのラスタをの可視ラスタへの高度な対応付け</h2><p>32BFバンドを1つ持つだけのラスタから3つのバンド(8BUI,8BUI,8BUI 可視ラスタ)を生成します。</p><pre class="programlisting">
ALTER TABLE wind ADD COLUMN rast_view raster;
UPDATE wind 
	set rast_view = ST_AddBand( NULL,
        ARRAY[
        	ST_Reclass(rast, 1,'0.1-10]:1-10,9-10]:11,(11-33:0'::text, '8BUI'::text,0),
        	ST_Reclass(rast,1, '11-33):0-255,[0-32:0,(34-1000:0'::text, '8BUI'::text,0),  
        	ST_Reclass(rast,1,'0-32]:0,(32-100:100-255'::text, '8BUI'::text,0)
        	]
        	) ;</pre></div><div class="refsection" title="関連情報"><a name="id287150546"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_AddBand" title="ST_AddBand">ST_AddBand</a>, <a class="xref" href="#RT_ST_Band" title="ST_Band">ST_Band</a>, <a class="xref" href="#RT_ST_BandPixelType" title="ST_BandPixelType">ST_BandPixelType</a>, <a class="xref" href="#RT_ST_MakeEmptyRaster" title="ST_MakeEmptyRaster">ST_MakeEmptyRaster</a>,  <a class="xref" href="#reclassarg" title="reclassarg">reclassarg</a>, <a class="xref" href="#RT_ST_Value" title="ST_Value">ST_Value</a></p></div></div><div class="refentry" title="ST_Union"><div class="refentry.separator"><hr></div><a name="RT_ST_Union"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Union ? ラスタタイルの集合を1バンドの単一のラスタに結合します。バンドを指定しない場合は1番と仮定します。結果ラスタの範囲は、集合全体の範囲となります。インタセクトする場合には、結果値はp_expressionで定義されます。p_expressionはLAST, MEAN, SUM, FIRST, MAX, MINで、デフォルトはLASTです。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_Union</b>(</code>setof raster  <var class="pdparam">rast</var><code>)</code>;</p></div><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_Union</b>(</code>raster set <var class="pdparam">rast</var>, integer <var class="pdparam">band_num</var><code>)</code>;</p></div><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_Union</b>(</code>raster set <var class="pdparam">rast</var>, text <var class="pdparam">p_expression</var><code>)</code>;</p></div><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_Union</b>(</code>raster set <var class="pdparam">rast</var>, integer <var class="pdparam">band_num</var>, text <var class="pdparam">p_expression</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287150745"></a><h2>説明</h2><p>ラスタタイルを1バンドの単一のラスタに結合します。バンドを指定しない場合は1番と仮定します。結果ラスタの範囲は、集合全体の範囲となります。インタセクトする場合には、結果値はp_expressionで定義されます。p_expressionはLAST, MEAN, SUM, FIRST, MAX, MINで、デフォルトはLASTです。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>
この関数には、この他に、PostGIS 2.0.0ではデフォルトでインストールされないものもあります。これらは、PostGISのそーづコードのraster/scripts/plpgsql/st_union.sqlファイルにあります。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>
2.0.0のST_Union関数は、現在のところ、主にPL/pgSQLで実装しています。

CとPL/pgSQLのレイヤ間での複製に必要なメモリコピーのため、この関数は、必要以上に、非常に非常に遅くなります。
今後の2.0リリースでは、この関数はCで実装します。変更された際には、重大な速度改善が見られます。一般的な経験則として、ラスタサイズを最小にして、ST_Unionを動かします。ひとつの方法として、最初に切り取って、切り取ったラスタでST_Unionを実行します。切り取り前に結合すると、4倍ぐらい実行時間が長くなる場合があります。高解像度の画像では、より長くなります。</p></td></tr></table></div><p>初出: 2.0.0 </p></div><div class="refsection" title="例: 塊になっているラスタタイルの単一バンドへの再構成"><a name="id287151042"></a><h2>例: 塊になっているラスタタイルの単一バンドへの再構成</h2><pre class="programlisting">-- ファイルシステムタイルの1番バンドから新しい単一バンドを生成します
SELECT filename, ST_Union(rast) As file_rast
FROM sometable WHERE filename IN('dem01', 'dem02') GROUP BY filename;</pre></div><div class="refsection" title="例: タイルのジオメトリとインタセクトするタイルを結合した複数バンドのラスタ"><a name="id287151052"></a><h2>例: タイルのジオメトリとインタセクトするタイルを結合した複数バンドのラスタ</h2><pre class="programlisting">-- ラインとインタセクトするタイルを結合した複数バンドラスタを生成します
SELECT ST_AddBand(NULL,ARRAY[ST_Union(rast,1), ST_Union(rast,2), ST_Union(rast,3) ])
FROM aerials.boston
WHERE ST_Intersects(rast,  ST_GeomFromText('LINESTRING(230486 887771, 230500 88772)',26986) );</pre></div><div class="refsection" title="関連情報"><a name="id287151065"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Envelope" title="ST_Envelope">ST_Envelope</a>, <a class="xref" href="#RT_ST_ConvexHull" title="ST_ConvexHull">ST_ConvexHull</a>, , <a class="xref" href="#RT_ST_MapAlgebraExpr2" title="ST_MapAlgebraExpr">ST_MapAlgebraExpr</a></p></div></div></div><div class="sect1" title="9.12. ラスタ処理組み込み関数"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Raster_Processing_Builtin_Functions"></a>9.12. ラスタ処理組み込み関数</h2></div></div></div><div class="toc"><dl><dt><span class="refentrytitle"><a href="#RT_ST_Min4ma">ST_Min4ma</a></span><span class="refpurpose"> ? 近傍における最小ピクセル値を計算するラスタ処理関数です。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Max4ma">ST_Max4ma</a></span><span class="refpurpose"> ? 近傍における最大ピクセル値を計算するラスタ処理関数です。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Sum4ma">ST_Sum4ma</a></span><span class="refpurpose"> ? 近傍におけるピクセル値の合計を計算するラスタ処理関数です。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Mean4ma">ST_Mean4ma</a></span><span class="refpurpose"> ? 近傍におけるピクセル値の平均を計算するラスタ処理関数です。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Range4ma">ST_Range4ma</a></span><span class="refpurpose"> ? 近傍におけるピクセル値の範囲合計を計算するラスタ処理関数です。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Distinct4ma">ST_Distinct4ma</a></span><span class="refpurpose"> ? 近傍における一意となるピクセル値の数を計算するラスタ処理関数です。

Raster processing function that calculates the number of unique pixel values in a neighborhood.</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_StdDev4ma">ST_StdDev4ma</a></span><span class="refpurpose"> ? 近傍におけるピクセル値の標準偏差を計算するラスタ処理関数です。</span></dt></dl></div><div class="refentry" title="ST_Min4ma"><a name="RT_ST_Min4ma"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Min4ma ? 近傍における最小ピクセル値を計算するラスタ処理関数です。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float8 <b class="fsfunc">ST_Min4ma</b>(</code>float8[][] <var class="pdparam">matrix</var>, text  <var class="pdparam">nodatamode</var>, text[] <var class="pdparam">VARIADIC args</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287151146"></a><h2>説明</h2><p>近傍における最小ピクセル値を計算します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数は<a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a>に渡すのに特化したユーザ定義関数です。</p></td></tr></table></div><p>初出: 2.0.0</p></div><div class="refsection" title="例"><a name="id287151169"></a><h2>例</h2><pre class="programlisting">SELECT 
    rid,
    st_value(
        st_mapalgebrafctngb(rast, 1, NULL, 1, 1, 'st_min4ma(float[][],text,text[])'::regprocedure, 'ignore', NULL), 2, 2
    ) 
FROM dummy_rast 
WHERE rid = 2;
 rid | st_value
-----+----------
   2 |      250
(1 row)
				</pre></div><div class="refsection" title="関連情報"><a name="id287151180"></a><h2>関連情報</h2><p>
                    <a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a>,
                    <a class="xref" href="#RT_ST_Max4ma" title="ST_Max4ma">ST_Max4ma</a>,
                    <a class="xref" href="#RT_ST_Sum4ma" title="ST_Sum4ma">ST_Sum4ma</a>,
                    <a class="xref" href="#RT_ST_Mean4ma" title="ST_Mean4ma">ST_Mean4ma</a>,
                    <a class="xref" href="#RT_ST_Range4ma" title="ST_Range4ma">ST_Range4ma</a>,
                    <a class="xref" href="#RT_ST_Distinct4ma" title="ST_Distinct4ma">ST_Distinct4ma</a>
                    <a class="xref" href="#RT_ST_StdDev4ma" title="ST_StdDev4ma">ST_StdDev4ma</a>
                </p></div></div><div class="refentry" title="ST_Max4ma"><div class="refentry.separator"><hr></div><a name="RT_ST_Max4ma"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Max4ma ? 近傍における最大ピクセル値を計算するラスタ処理関数です。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float8 <b class="fsfunc">ST_Max4ma</b>(</code>float8[][] <var class="pdparam">matrix</var>, text <var class="pdparam">nodatamode</var>, text[] <var class="pdparam">VARIADIC args</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287151303"></a><h2>説明</h2><p>近傍における最大ピクセル値を計算します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数は<a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a>に渡すのに特化したユーザ定義関数です。</p></td></tr></table></div><p>初出: 2.0.0</p></div><div class="refsection" title="例"><a name="id287151325"></a><h2>例</h2><pre class="programlisting">SELECT 
    rid,
    st_value(
        st_mapalgebrafctngb(rast, 1, NULL, 1, 1, 'st_max4ma(float[][],text,text[])'::regprocedure, 'ignore', NULL), 2, 2
    ) 
FROM dummy_rast 
WHERE rid = 2;
 rid | st_value
-----+----------
   2 |      254
(1 row)
				</pre></div><div class="refsection" title="関連情報"><a name="id287151336"></a><h2>関連情報</h2><p>
                    <a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a>,
                    <a class="xref" href="#RT_ST_Min4ma" title="ST_Min4ma">ST_Min4ma</a>,
                    <a class="xref" href="#RT_ST_Sum4ma" title="ST_Sum4ma">ST_Sum4ma</a>,
                    <a class="xref" href="#RT_ST_Mean4ma" title="ST_Mean4ma">ST_Mean4ma</a>,
                    <a class="xref" href="#RT_ST_Range4ma" title="ST_Range4ma">ST_Range4ma</a>,
                    <a class="xref" href="#RT_ST_Distinct4ma" title="ST_Distinct4ma">ST_Distinct4ma</a>
                    <a class="xref" href="#RT_ST_StdDev4ma" title="ST_StdDev4ma">ST_StdDev4ma</a>
                </p></div></div><div class="refentry" title="ST_Sum4ma"><div class="refentry.separator"><hr></div><a name="RT_ST_Sum4ma"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Sum4ma ? 近傍におけるピクセル値の合計を計算するラスタ処理関数です。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float8 <b class="fsfunc">ST_Sum4ma</b>(</code>float8[][] <var class="pdparam">matrix</var>, text <var class="pdparam">nodatamode</var>, text[] <var class="pdparam">VARIADIC args</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287151460"></a><h2>説明</h2><p>近傍におけるピクセル値の合計を計算します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数は<a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a>に渡すのに特化したユーザ定義関数です。</p></td></tr></table></div><p>初出: 2.0.0</p></div><div class="refsection" title="例"><a name="id287151482"></a><h2>例</h2><pre class="programlisting">SELECT 
    rid,
    st_value(
        st_mapalgebrafctngb(rast, 1, '32BF', 1, 1, 'st_sum4ma(float[][],text,text[])'::regprocedure, 'ignore', NULL), 2, 2
    ) 
FROM dummy_rast 
WHERE rid = 2;
 rid | st_value
-----+----------
   2 |     2279
(1 row)
				</pre></div><div class="refsection" title="関連情報"><a name="id287151493"></a><h2>関連情報</h2><p>
                    <a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a>,
                    <a class="xref" href="#RT_ST_Min4ma" title="ST_Min4ma">ST_Min4ma</a>,
                    <a class="xref" href="#RT_ST_Max4ma" title="ST_Max4ma">ST_Max4ma</a>,
                    <a class="xref" href="#RT_ST_Mean4ma" title="ST_Mean4ma">ST_Mean4ma</a>,
                    <a class="xref" href="#RT_ST_Range4ma" title="ST_Range4ma">ST_Range4ma</a>,
                    <a class="xref" href="#RT_ST_Distinct4ma" title="ST_Distinct4ma">ST_Distinct4ma</a>
                    <a class="xref" href="#RT_ST_StdDev4ma" title="ST_StdDev4ma">ST_StdDev4ma</a>
                </p></div></div><div class="refentry" title="ST_Mean4ma"><div class="refentry.separator"><hr></div><a name="RT_ST_Mean4ma"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Mean4ma ? 近傍におけるピクセル値の平均を計算するラスタ処理関数です。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float8 <b class="fsfunc">ST_Mean4ma</b>(</code>float8[][] <var class="pdparam">matrix</var>, text <var class="pdparam">nodatamode</var>, text[] <var class="pdparam">VARIADIC args</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287151617"></a><h2>説明</h2><p>近傍におけるピクセル値の平均を計算します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数は<a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a>に渡すのに特化したユーザ定義関数です。</p></td></tr></table></div><p>初出: 2.0.0</p></div><div class="refsection" title="例"><a name="id287151639"></a><h2>例</h2><pre class="programlisting">SELECT 
    rid,
    st_value(
        st_mapalgebrafctngb(rast, 1, '32BF', 1, 1, 'st_mean4ma(float[][],text,text[])'::regprocedure, 'ignore', NULL), 2, 2
    ) 
FROM dummy_rast 
WHERE rid = 2;
 rid |     st_value
-----+------------------
   2 | 253.222229003906
(1 row)
				</pre></div><div class="refsection" title="関連情報"><a name="id287151650"></a><h2>関連情報</h2><p>
                    <a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a>,
                    <a class="xref" href="#RT_ST_Min4ma" title="ST_Min4ma">ST_Min4ma</a>,
                    <a class="xref" href="#RT_ST_Max4ma" title="ST_Max4ma">ST_Max4ma</a>,
                    <a class="xref" href="#RT_ST_Sum4ma" title="ST_Sum4ma">ST_Sum4ma</a>,
                    <a class="xref" href="#RT_ST_Range4ma" title="ST_Range4ma">ST_Range4ma</a>,
                    <a class="xref" href="#RT_ST_StdDev4ma" title="ST_StdDev4ma">ST_StdDev4ma</a>
                </p></div></div><div class="refentry" title="ST_Range4ma"><div class="refentry.separator"><hr></div><a name="RT_ST_Range4ma"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Range4ma ? 近傍におけるピクセル値の範囲合計を計算するラスタ処理関数です。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float8 <b class="fsfunc">ST_Range4ma</b>(</code>float8[][] <var class="pdparam">matrix</var>, text <var class="pdparam">nodatamode</var>, text[] <var class="pdparam">VARIADIC args</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287151735"></a><h2>説明</h2><p>近傍におけるピクセル値の範囲を計算します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数は<a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a>に渡すのに特化したユーザ定義関数です。</p></td></tr></table></div><p>初出: 2.0.0</p></div><div class="refsection" title="例"><a name="id287151758"></a><h2>例</h2><pre class="programlisting">SELECT 
    rid,
    st_value(
        st_mapalgebrafctngb(rast, 1, NULL, 1, 1, 'st_range4ma(float[][],text,text[])'::regprocedure, 'ignore', NULL), 2, 2
    ) 
FROM dummy_rast 
WHERE rid = 2;
 rid | st_value
-----+----------
   2 |        4
(1 row)
				</pre></div><div class="refsection" title="関連情報"><a name="id287151769"></a><h2>関連情報</h2><p>
                    <a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a>,
                    <a class="xref" href="#RT_ST_Min4ma" title="ST_Min4ma">ST_Min4ma</a>,
                    <a class="xref" href="#RT_ST_Max4ma" title="ST_Max4ma">ST_Max4ma</a>,
                    <a class="xref" href="#RT_ST_Sum4ma" title="ST_Sum4ma">ST_Sum4ma</a>,
                    <a class="xref" href="#RT_ST_Mean4ma" title="ST_Mean4ma">ST_Mean4ma</a>,
                    <a class="xref" href="#RT_ST_Distinct4ma" title="ST_Distinct4ma">ST_Distinct4ma</a>
                    <a class="xref" href="#RT_ST_StdDev4ma" title="ST_StdDev4ma">ST_StdDev4ma</a>
                </p></div></div><div class="refentry" title="ST_Distinct4ma"><div class="refentry.separator"><hr></div><a name="RT_ST_Distinct4ma"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Distinct4ma ? 近傍における一意となるピクセル値の数を計算するラスタ処理関数です。

Raster processing function that calculates the number of unique pixel values in a neighborhood.</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float8 <b class="fsfunc">ST_Distinct4ma</b>(</code>float8[][] <var class="pdparam">matrix</var>, text <var class="pdparam">nodatamode</var>, text[] <var class="pdparam">VARIADIC args</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287151892"></a><h2>説明</h2><p>近傍における一意となるピクセル値の数を計算します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数は<a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a>に渡すのに特化したユーザ定義関数です。</p></td></tr></table></div><p>初出: 2.0.0</p></div><div class="refsection" title="例"><a name="id287151914"></a><h2>例</h2><pre class="programlisting">SELECT 
    rid,
    st_value(
        st_mapalgebrafctngb(rast, 1, NULL, 1, 1, 'st_distinct4ma(float[][],text,text[])'::regprocedure, 'ignore', NULL), 2, 2
    ) 
FROM dummy_rast 
WHERE rid = 2;
 rid | st_value
-----+----------
   2 |        3
(1 row)
				</pre></div><div class="refsection" title="関連情報"><a name="id287151926"></a><h2>関連情報</h2><p>
                    <a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a>,
                    <a class="xref" href="#RT_ST_Min4ma" title="ST_Min4ma">ST_Min4ma</a>,
                    <a class="xref" href="#RT_ST_Max4ma" title="ST_Max4ma">ST_Max4ma</a>,
                    <a class="xref" href="#RT_ST_Sum4ma" title="ST_Sum4ma">ST_Sum4ma</a>,
                    <a class="xref" href="#RT_ST_Mean4ma" title="ST_Mean4ma">ST_Mean4ma</a>,
                    <a class="xref" href="#RT_ST_Distinct4ma" title="ST_Distinct4ma">ST_Distinct4ma</a>
                    <a class="xref" href="#RT_ST_StdDev4ma" title="ST_StdDev4ma">ST_StdDev4ma</a>
                </p></div></div><div class="refentry" title="ST_StdDev4ma"><div class="refentry.separator"><hr></div><a name="RT_ST_StdDev4ma"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_StdDev4ma ? 近傍におけるピクセル値の標準偏差を計算するラスタ処理関数です。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float8 <b class="fsfunc">ST_StdDev4ma</b>(</code>float8[][] <var class="pdparam">matrix</var>, text  <var class="pdparam">nodatamode</var>, text[] <var class="pdparam">VARIADIC args</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287152014"></a><h2>説明</h2><p>近傍におけるピクセル値の標準偏差を計算します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数は<a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a>に渡すのに特化したユーザ定義関数です。</p></td></tr></table></div><p>初出: 2.0.0</p></div><div class="refsection" title="例"><a name="id287152037"></a><h2>例</h2><pre class="programlisting">SELECT 
    rid,
    st_value(
        st_mapalgebrafctngb(rast, 1, '32BF', 1, 1, 'st_stddev4ma(float[][],text,text[])'::regprocedure, 'ignore', NULL), 2, 2
    ) 
FROM dummy_rast 
WHERE rid = 2;
 rid |     st_value
-----+------------------
   2 | 1.30170822143555
(1 row)
				</pre></div><div class="refsection" title="関連情報"><a name="id287152048"></a><h2>関連情報</h2><p>
                    <a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a>,
                    <a class="xref" href="#RT_ST_Min4ma" title="ST_Min4ma">ST_Min4ma</a>,
                    <a class="xref" href="#RT_ST_Max4ma" title="ST_Max4ma">ST_Max4ma</a>,
                    <a class="xref" href="#RT_ST_Sum4ma" title="ST_Sum4ma">ST_Sum4ma</a>,
                    <a class="xref" href="#RT_ST_Mean4ma" title="ST_Mean4ma">ST_Mean4ma</a>,
                    <a class="xref" href="#RT_ST_Distinct4ma" title="ST_Distinct4ma">ST_Distinct4ma</a>
                    <a class="xref" href="#RT_ST_StdDev4ma" title="ST_StdDev4ma">ST_StdDev4ma</a>
                </p></div></div></div><div class="sect1" title="9.13. ラスタ演算子"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="RT_Operators"></a>9.13. ラスタ演算子</h2></div></div></div><div class="toc"><dl><dt><span class="refentrytitle"><a href="#RT_Raster_Overlap">&amp;&amp;</a></span><span class="refpurpose"> ? のバウンディングボックスがBのバウンディングボックスをオーバラップする場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_Raster_OverLeft">&amp;&lt;</a></span><span class="refpurpose"> ? AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの左にある場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_Raster_OverRight">&amp;&gt;</a></span><span class="refpurpose"> ? AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの右にある場合に<code class="varname">TRUE</code>を返します。</span></dt></dl></div><div class="refentry" title="&amp;&amp;"><a name="RT_Raster_Overlap"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>&amp;&amp; ? のバウンディングボックスがBのバウンディングボックスをオーバラップする場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">&amp;&amp;</b>(</code>
				  raster 

				  <var class="pdparam">A</var>
				, 
				  raster 

				  <var class="pdparam">B</var>
				<code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287152145"></a><h2>説明</h2><p><code class="varname">&amp;&amp;</code>演算子は、AのバウンディングボックスがBのバウンディングボックスをオーバラップする場合に<code class="varname">TRUE</code>を返します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この演算子はラスタで利用できるインデクスを使用します。</p></td></tr></table></div></div><div class="refsection" title="例"><a name="id287152164"></a><h2>例</h2><pre class="programlisting">SELECT A.rid As a_rid, B.rid As b_rid, A.rast &amp;&amp; B.rast As overlap
 FROM dummy_rast AS A CROSS JOIN dummy_rast AS B LIMIT 3;

 a_rid | b_rid | overlap
-------+-------+---------
     2 |     2 | t
     2 |     3 | f
     2 |     1 | f
</pre></div></div><div class="refentry" title="&amp;&lt;"><div class="refentry.separator"><hr></div><a name="RT_Raster_OverLeft"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>&amp;&lt; ? AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの左にある場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">&amp;&lt;</b>(</code>
				  raster 

				  <var class="pdparam">A</var>
				, 
				  raster 

				  <var class="pdparam">B</var>
				<code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287152264"></a><h2>説明</h2><p><code class="varname">&amp;&lt;</code>演算子は、AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの左にある場合に<code class="varname">TRUE</code>を返します。条件についてより詳細に言うと、BのバウンディングボックスをオーバラップするかBのバウンディングボックスの右に*ない*場合です。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この演算子はラスタで利用できるインデクスを使用します。</p></td></tr></table></div></div><div class="refsection" title="例"><a name="id287152283"></a><h2>例</h2><pre class="programlisting">SELECT A.rid As a_rid, B.rid As b_rid, A.rast &amp;&lt; B.rast As overleft
 FROM dummy_rast AS A CROSS JOIN dummy_rast AS B;

a_rid | b_rid | overleft
------+-------+----------
    2 |     2 | t
    2 |     3 | f
    2 |     1 | f
    3 |     2 | t
    3 |     3 | t
    3 |     1 | f
    1 |     2 | t
    1 |     3 | t
    1 |     1 | t
</pre></div></div><div class="refentry" title="&amp;&gt;"><div class="refentry.separator"><hr></div><a name="RT_Raster_OverRight"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>&amp;&gt; ? AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの右にある場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">&amp;&gt;</b>(</code>
				  raster 

				  <var class="pdparam">A</var>
				, 
				  raster 

				  <var class="pdparam">B</var>
				<code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287152349"></a><h2>説明</h2><p><code class="varname">&amp;&gt;</code>演算子は、AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの右にある場合に<code class="varname">TRUE</code>を返します。条件についてより詳細に言うと、BのバウンディングボックスをオーバラップするかBのバウンディングボックスの左に*ない*場合です。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この演算子はラスタで利用できるインデクスを使用します。</p></td></tr></table></div></div><div class="refsection" title="例"><a name="id287152370"></a><h2>例</h2><pre class="programlisting">SELECT A.rid As a_rid, B.rid As b_rid, A.rast &amp;&gt; B.rast As overright
 FROM dummy_rast AS A CROSS JOIN dummy_rast AS B;

 a_rid | b_rid | overright
-------+-------+----------
     2 |     2 | t
     2 |     3 | t
     2 |     1 | t
     3 |     2 | f
     3 |     3 | t
     3 |     1 | f
     1 |     2 | f
     1 |     3 | t
     1 |     1 | t
</pre></div></div></div><div class="sect1" title="9.14. ラスタ/ラスタバンドの空間関係関数"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Raster_Relationships"></a>9.14. ラスタ/ラスタバンドの空間関係関数</h2></div></div></div><div class="toc"><dl><dt><span class="refentrytitle"><a href="#RT_ST_Intersects">ST_Intersects</a></span><span class="refpurpose"> ? バンド番号が省略された場合はラスタの凸包を考慮するだけです。指定したバンドのNODATA値でない値を持つピクセルがインタセクトする場合のみTRUEを返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_SameAlignment">ST_SameAlignment</a></span><span class="refpurpose"> ? ラスタが同じスキュー、スケール、空間参照系を持つ場合にはTRUEを返し、そうでない場合は問題を詳述する通知とともにFALSEを返します。</span></dt></dl></div><div class="refentry" title="ST_Intersects"><a name="RT_ST_Intersects"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Intersects ? バンド番号が省略された場合はラスタの凸包を考慮するだけです。指定したバンドのNODATA値でない値を持つピクセルがインタセクトする場合のみTRUEを返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_Intersects</b>(</code>
				  raster 
				  <var class="pdparam">rast</var>
				, 
				  integer 
				  <var class="pdparam">band</var>
				, 
				  geometry 
				  <var class="pdparam">geommin</var>
				<code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">ST_Intersects</b>(</code>
				  geometry 
				  <var class="pdparam">geommin</var>
				, 
				  raster 
				  <var class="pdparam">rast</var>
				, 
				  integer 
				  <var class="pdparam">nband=NULL</var>
				<code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">ST_Intersects</b>(</code>
				  raster 
				  <var class="pdparam">rasta</var>
				, 
				  raster 
				  <var class="pdparam">rastb</var>
				<code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">ST_Intersects</b>(</code>
				  raster 
				  <var class="pdparam">rasta</var>
				, 
				  integer 
				  <var class="pdparam">nbanda</var>
				, 
				  raster 
				  <var class="pdparam">rastb</var>
				, 
				  integer 
				  <var class="pdparam">nbandb=1</var>
				<code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287152580"></a><h2>説明</h2><p>ジオメトリがラスタとインタセクトする場合にTRUEを返します。NODATA値は考慮に入れられるので、ジオメトリがNODATA値のみとインタセクトする場合には、FALSEを返します。バンドを指定しない場合は1番と仮定します。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ラスタ/ジオメトリとジオメトリ/ラスタの場合、
ST_Intersects(raster,nband,geometry)はラスタ空間で実行され(ジオメトリは最初にラスタに変換されます)、ST_Intersects(geometry, raster)はジオメトリ空間で実行されます(ラスタは最初にジオメトリに変換されます)。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この演算子はジオメトリ/ラスタで利用できるインデクスを使用します。</p></td></tr></table></div><p>機能強化: 2.0.0 ラスタとラスタを引数にとる形式が導入されました。</p></div><div class="refsection" title="例"><a name="id287152601"></a><h2>例</h2><pre class="programlisting">SELECT A.rid, g.gid , ST_Intersects(A.rast, g.geom) As inter
FROM dummy_rast AS A CROSS JOIN 
	(VALUES (1, ST_Point(3427928, 5793243.85) ) ,
		(2, ST_GeomFromText('LINESTRING(3427927.85 5793243.75,3427927.8 5793243.75,3427927.8 5793243.8)') ),
		(3, ST_GeomFromText('LINESTRING(1 2, 3 4)') )
		) As g(gid,geom)
WHERE A.rid =2 ;

 rid | gid | inter
-----+-----+-------
   2 |   1 | t
   2 |   2 | t
   2 |   3 | f
</pre></div><div class="refsection" title="関連情報"><a name="id287152612"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Intersection" title="ST_Intersection">ST_Intersection</a></p></div></div><div class="refentry" title="ST_SameAlignment"><div class="refentry.separator"><hr></div><a name="RT_ST_SameAlignment"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SameAlignment ? ラスタが同じスキュー、スケール、空間参照系を持つ場合にはTRUEを返し、そうでない場合は問題を詳述する通知とともにFALSEを返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_SameAlignment</b>(</code>
				  raster 
				  <var class="pdparam">rastA</var>
				, 
				  raster 
				  <var class="pdparam">rastB</var>
				<code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">ST_SameAlignment</b>(</code>
				  double precision 
				  <var class="pdparam">ulx1</var>
				, 
				  double precision 
				  <var class="pdparam">uly1</var>
				, 
				  double precision 
				  <var class="pdparam">scalex1</var>
				, 
				  double precision 
				  <var class="pdparam">scaley1</var>
				, 
				  double precision 
				  <var class="pdparam">skewx1</var>
				, 
				  double precision 
				  <var class="pdparam">skewy1</var>
				, 
				  double precision 
				  <var class="pdparam">ulx2</var>
				, 
				  double precision 
				  <var class="pdparam">uly2</var>
				, 
				  double precision 
				  <var class="pdparam">scalex2</var>
				, 
				  double precision 
				  <var class="pdparam">scaley2</var>
				, 
				  double precision 
				  <var class="pdparam">skewx2</var>
				, 
				  double precision 
				  <var class="pdparam">skewy2</var>
				<code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287152849"></a><h2>説明</h2><p>ラスタが同じスキュー、スケール等を持つ場合にはTRUEを返します。そうでない場合はアラインメントの問題を詳述する通知とともにFALSEを返します。</p><p>初出: 2.0.0</p></div><div class="refsection" title="例: Rasters"><a name="id287152861"></a><h2>例: Rasters</h2><pre class="programlisting">SELECT ST_SameAlignment(
	ST_MakeEmptyRaster(1, 1, 0, 0, 1, 1, 0, 0),
	ST_MakeEmptyRaster(1, 1, 0, 0, 1, 1, 0, 0)
) as sm;

sm
----
t
</pre><pre class="programlisting">
SELECT ST_SameAlignment(A.rast,b.rast)
 FROM dummy_rast AS A CROSS JOIN dummy_rast AS B;

 NOTICE:  The two rasters provided have different SRIDs
NOTICE:  The two rasters provided have different SRIDs
 st_samealignment
------------------
 t
 f
 f
 f
</pre></div><div class="refsection" title="関連情報"><a name="id287152876"></a><h2>関連情報</h2><p><a class="xref" href="#RT_Loading_Rasters" title="5.1. ラスタのロードと生成">「ラスタのロードと生成」</a>, <a class="xref" href="#RT_ST_MakeEmptyRaster" title="ST_MakeEmptyRaster">ST_MakeEmptyRaster</a></p></div></div></div></div><div class="chapter" title="第10章 PostGISラスタ よくある質問"><div class="titlepage"><div><div><h2 class="title"><a name="RT_FAQ"></a>第10章 PostGISラスタ よくある質問</h2></div></div></div><div class="qandaset" title="よくある質問"><a name="id287173388"></a><dl><dt>10.1. <a href="#id287173390">PostGISラスタプロジェクトに関するより多くの情報はどこにありますか?</a></dt><dt>10.2. <a href="#id287173410">この素晴らしいイノベーションを始めるための書籍やチュートリアルはありますか?</a></dt><dt>10.3. <a href="#id287173452">PostGISデータベースにラスタサポートをインストールするにはどうすればよいでしょうか?</a></dt><dt>10.4. <a href="#id287173603">"C:/Program Files/PostgreSQL/8.4/lib/rtpostgis.dll": The specified module could not be found. エラーがでました。また、Linux上でrtpostgis.sql実行時にライブラリのロードができませんでした。</a></dt><dt>10.5. <a href="#id287173622">ラスタデータをPostGISにロードするにはどうすればよいでしょうか?</a></dt><dt>10.6. <a href="#id287173649">ロード可能なラスタファイルの種類は何ですか?</a></dt><dt>10.7. <a href="#id287173677">PostGISラスタデータを他のラスタ形式に出力できますか?</a></dt><dt>10.8. <a href="#id287173761">GDALバイナリはPostGISラスタサポート付きでコンパイルされていますか?</a></dt><dt>10.9. <a href="#id287173796">PostGISラスタデータを見るのに使うことができるツールは何ですか?</a></dt><dt>10.10. <a href="#id287173820">MapServerの地図にPostGISラスタレイヤを追加するにはどうすればいいですか?</a></dt><dt>10.11. <a href="#id287173863">現在ラスタデータで使用できる関数は何ですか?</a></dt><dt>10.12. <a href="#qa_raster_function_not_unique">ERROR:  function st_intersects(raster, unknown) is not unique or st_union(geometry,text) is not unique. とのエラーが出ました。解消するにはどうすればいいでしょうか?</a></dt><dt>10.13. <a href="#id287173922">PostGISラスタとOracle GeoRaster (SDO_GEORATGER)およびSDO_RASTERとどの位違うのでしょうか?</a></dt></dl><table border="0" width="100%" summary="Q and A Set"><col align="left" width="1%"><col><tbody><tr class="question" title="10.1."><td align="left" valign="top"><a name="id287173390"></a><a name="id287173393"></a><p><b>10.1.</b></p></td><td align="left" valign="top"><p>PostGISラスタプロジェクトに関するより多くの情報はどこにありますか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p><a class="ulink" href="http://trac.osgeo.org/postgis/wiki/WKTRaster" target="_top">PostGIS Raster home page</a>を参照してください。</p></td></tr><tr class="question" title="10.2."><td align="left" valign="top"><a name="id287173410"></a><a name="id287173412"></a><p><b>10.2.</b></p></td><td align="left" valign="top"><p>この素晴らしいイノベーションを始めるための書籍やチュートリアルはありますか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>網羅的な初心者用チュートリアルは <a class="ulink" href="http://trac.osgeo.org/postgis/wiki/WKTRasterTutorial01" target="_top">Intersecting vector buffers with large raster coverage using PostGIS Raster</a>にあります。
PostGISラスタに関するJorgeさんの一連のブログに、ラスタデータのロード方法、Oracle GeoRasterのタスクとのクロス比較があります。<a class="ulink" href="http://gis4free.wordpress.com/category/postgis-raster/" target="_top">Jorge's PostGIS Raster / Oracle GeoRaster Series</a> をご覧ください。
<a class="ulink" href="http://www.postgis.us/chapter_13" target="_top">PostGIS in Action - Raster chapter</a>では、章全体(35ページ超)がPostGISラスタにささげられていて、フリーのコードとデータがついています。
Manningからハードコピー本の<a class="ulink" href="http://www.postgis.us/page_buy_book" target="_top">PostGIS in Actionを購入する</a>ことができます(大量発注によるかなりの割引があります)。
また、Amazon等書籍販売サイトで購入することも可能です。全てのハードコピー本は電子書籍版の無償ダウンロードのクーポンが付きます。
        </p><p>PostGISラスタユーザからのレビューが<a class="ulink" href="http://fuzzytolerance.info/code/postgis-raster-ftw/" target="_top">PostGIS raster applied to land classification urban forestry</a>にあります。</p></td></tr><tr class="question" title="10.3."><td align="left" valign="top"><a name="id287173452"></a><a name="id287173454"></a><p><b>10.3.</b></p></td><td align="left" valign="top"><p>PostGISデータベースにラスタサポートをインストールするにはどうすればよいでしょうか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>PostGISとラスタのバイナリをダウンロードするのが最も簡単です。Windows用と最新のMacOS X用とがあります。まずPostGIS 2.0.0以上とPostgreSQL 8.4, 9.0 または 9.1 が動作している必要があります。PostGIS 2.0ではPostGISラスタは完全に統合されていて、PostGISをコンパイルするときにPostGISラスタはコンパイルされます。</p><p>Windows下でのインストールと実行の説明は<a class="ulink" href="http://gis4free.wordpress.com/2011/03/10/how-to-install-and-configure-postgis-raster-on-windows/" target="_top">How to Install and Configure PostGIS raster on windows</a>にあります。</p><p>Windows下でコンパイルすることができますし、<a class="ulink" href="http://www.postgis.org/download/windows/experimental.php#wktraster" target="_top">コンパイル済みPostGISラスタのバイナリ</a>を使うこともできます。MacOS X LeopardまたはSnow Leopardでは、<a class="ulink" href="http://www.kyngchaos.com/software/postgres" target="_top">Kyng Chaos Mac OSX PostgreSQL/GISバイナリ</a>があります。</p><p>データベースでラスタサポートを有効にするにはrtpostgis.sqlファイルをデータベースで実行します。既存のラスタサポートのアップグレードではrtpostgis_upgrade_minor..sqlを実行します。</p><p>他のプラットフォームでは、一般的には、自分でコンパイルする必要があります。PostGISとGDALに依存します。ソースからのコンパイルの詳細については<a class="ulink" href="http://trac.osgeo.org/postgis/wiki/WKTRaster/Documentation01#a2.3-CompilingandInstallingfromSources" target="_top">Installing PostGIS Raster from source (in prior versions of PostGIS)</a>をご覧ください。</p></td></tr><tr class="question" title="10.4."><td align="left" valign="top"><a name="id287173603"></a><a name="id287173605"></a><p><b>10.4.</b></p></td><td align="left" valign="top"><p>"C:/Program Files/PostgreSQL/8.4/lib/rtpostgis.dll": The specified module could not be found. エラーがでました。また、Linux上でrtpostgis.sql実行時にライブラリのロードができませんでした。</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>rtpostgis.dll/soは、libgdal.dll/soに依存します。Windowsではlibgdal-1.dllがPostgreSQLインストール先のbinフォルダに置いてください。Linuxについてはlibgdalがパスまたはbinフォルダの中に置いて下さい。</p><p>また、PostGISをデータベースにインストールしていない場合には別のエラーが出ます。PostGISをまずデータベースにインストールしてから、ラスタサポートをインストールしてみてください。</p></td></tr><tr class="question" title="10.5."><td align="left" valign="top"><a name="id287173622"></a><a name="id287173624"></a><p><b>10.5.</b></p></td><td align="left" valign="top"><p>ラスタデータをPostGISにロードするにはどうすればよいでしょうか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>PostGIS最新版には、ラスタローダ<code class="varname">raster2pgsql</code>があります。多種のラスタのロードが可能で、低解像度のオーバビューを作成することが可能な実行可能ファイルで、他のソフトウェアを要しません。詳細情報については<a class="xref" href="#RT_Raster_Loader" title="5.1.1. raster2pgsqlを使ってラスタをロードする">「raster2pgsqlを使ってラスタをロードする」</a>を参照して下さい。2.0版以前では<code class="varname">raster2pgsql.py</code>がありましたが、numpyとGDALに対応したPythonが必要でしたが、現版では必要ありません。</p></td></tr><tr class="question" title="10.6."><td align="left" valign="top"><a name="id287173649"></a><a name="id287173651"></a><p><b>10.6.</b></p></td><td align="left" valign="top"><p>ロード可能なラスタファイルの種類は何ですか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>GDALライブラリがサポートするもの全てです。GDALがサポートする形式については<a class="ulink" href="http://www.gdal.org/formats_list.html" target="_top">GDAL File Formats</a>にあります。</p><p>インストールで、一部の形式がサポートされていない可能性があります。インストールしたGDALがサポートする形式を確認するには、次を実行してください。</p><pre class="programlisting">raster2pgsql -G</pre></td></tr><tr class="question" title="10.7."><td align="left" valign="top"><a name="id287173677"></a><a name="id287173680"></a><p><b>10.7.</b></p></td><td align="left" valign="top"><p>PostGISラスタデータを他のラスタ形式に出力できますか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>できます。</p><p>GDAL 1.7以上にはPostGISラスタのドライバがあります。ただしPostgreSQLサポートを付けてコンパイルするようにした場合に限ります。</p><p>PostGISラスタ型に不規則なブロックのラスタを格納できますが、GDALドライバは現在のところ不規則なブロックのラスタには対応していません。</p><p>ソースからコンパイルする場合、ドライバを有効にするには、コンフィギュアに</p><pre class="programlisting">--with-pg=path/to/pg_config</pre><p>を入れる必要があります。さまざまなプラットフォーム上でGDALをビルドする際の各種情報については、<a class="ulink" href="http://trac.osgeo.org/gdal/wiki/BuildHints" target="_top">GDAL Build Hints</a>を参照して下さい。</p><p>GDALをPostGISラスタドライバ付きでコンパイルすると、</p><pre class="programlisting">gdalinfo --formats</pre><p>のリストにPostGIS Rasterが現れます。</p><p>GDALからラスタに関する要約を得るには、gdalinfoを使います。</p><pre class="programlisting">gdalinfo  "PG:host=localhost port=5432 dbname='mygisdb' user='postgres' password='whatever' schema='someschema' table=sometable"</pre><p> となります。</p><p>他のラスタ書式へデータを出力するには、gdal_translateを使います。下で示すものは、テーブルからのデータ全体を10%のサイズのPNGファイルにして出力します。</p><p>ピクセルバンドタイプについて、出力書式がサポートしない場合は、変換が機能しないことがあります。たとえば、浮動小数点数と32ビット符号なし整数は、JPGや他の書式に簡単には変換しません。</p><p>次に単純な変換の例を示します。</p><pre class="programlisting">gdal_translate -of PNG -outsize 10% 10% "PG:host=localhost dbname='mygisdb' user='postgres' password=whatever' schema='someschema' table=sometable" C:\somefile.png</pre><p>また、ドライバ接続文字列内で where=... を使って、SQLのWHERE節を使うことができます。次に例を示します。</p><pre class="programlisting">gdal_translate -of PNG -outsize 10% 10% "PG:host=localhost dbname='mygisdb' user='postgres' password=whatever' schema='someschema' table=sometable where="owner='jimmy'" " C:\somefile.png</pre><pre class="programlisting">gdal_translate -of PNG -outsize 10% 10% "PG:host=localhost dbname='mygisdb' user='postgres' password=whatever' schema='someschema' table=sometable where='ST_Intersects(rast, ST_SetSRID(ST_Point(-71.032,42.3793),4326) )' " C:\intersectregion.png</pre><p>より多くの例、構文については<a class="ulink" href="http://trac.osgeo.org/gdal/wiki/frmts_wtkraster.html#a3.2-Readingrasterdatafromthedatabase" target="_top">Reading Raster Data of PostGIS Raster section</a>を参照してください。</p></td></tr><tr class="question" title="10.8."><td align="left" valign="top"><a name="id287173761"></a><a name="id287173763"></a><p><b>10.8.</b></p></td><td align="left" valign="top"><p>GDALバイナリはPostGISラスタサポート付きでコンパイルされていますか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>はい。<a class="ulink" href="http://trac.osgeo.org/gdal/wiki/DownloadingGdalBinaries" target="_top">GDAL Binaries</a>をご覧下さい。
PostgreSQLサポート付きでコンパイルされているものはPostGISラスタを持っています。</p><p>次のWindowsバイナリはPostGISラスタが組み込まれているのを確認しています。</p><p><a class="ulink" href="http://fwtools.maptools.org/" target="_top">Windows用 FWTools 最新の安定版はラスタサポート付きでコンパイルされています</a>。</p><p>PostGISラスタは多数の変更が行われているところです。Windows用の最新のナイトリビルドを得るには、Visual StudioでビルドしたTamas Szekeresナイトリビルドを見てみて下さい。GDALの開発途中版とPythonバインディングとMapServer実行ファイルが含まれ、とPostGISラスタドライバが組み込まれています。
SDKバッチファイルをクリックして、そこからコマンドを実行します。<a class="ulink" href="http://vbkto.dyndns.org/sdk/" target="_top">http://vbkto.dyndns.org/sdk/</a>にあります。Visual Studioプロジェクトファイルもあります。</p></td></tr><tr class="question" title="10.9."><td align="left" valign="top"><a name="id287173796"></a><a name="id287173798"></a><p><b>10.9.</b></p></td><td align="left" valign="top"><p>PostGISラスタデータを見るのに使うことができるツールは何ですか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>GDAL 1.7以上とPostGISラスタドライバサポートとを付けてコンパイルしたMapServerでラスタデータの閲覧に使うことが可能です。QuantumGIS (QGIS) では、現在は、PostGISラスタドライバをインストールすると、PostGISラスタの閲覧サポートします。</p><p>理論上、GDALを使用してデータをレンダリングするツールはPostGISラスタをサポートできるか、ごく小さな労力でサポートできます。ご自信でコンパイルする面倒を望まないなら、Windows用については、Tamasさんのバイナリ<a class="ulink" href="http://vbkto.dyndns.org/sdk/" target="_top">http://vbkto.dyndns.org/sdk/</a>が良い選択です。</p></td></tr><tr class="question" title="10.10."><td align="left" valign="top"><a name="id287173820"></a><a name="id287173822"></a><p><b>10.10.</b></p></td><td align="left" valign="top"><p>MapServerの地図にPostGISラスタレイヤを追加するにはどうすればいいですか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>まずGDAL 1.7以上をPostGISラスタサポート付きでコンパイルします。多数の問題が1.8で解消したので、GDAL 1.8以上が望ましいです。また、より多くのPostGISラスタの問題は開発中の版で解消しています。</p><p>他のラスタでできることと同じことができます。MapServerラスタレイヤで使うことができる様々な処理機能のリストを得るには<a class="ulink" href="http://mapserver.org/input/raster.html" target="_top">MapServer Raster processing options</a>を参照して下さい。</p><p>PostGISラスタデータを特に興味深くするのは、それぞれのタイルが様々な標準的なデータベースカラムを持ち得るので、データソースで分割することができる点です。</p><p>次に示す例は、PostGISラスタレイヤをMapServer内で定義する方法です。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>mode=2 では、タイル化されたラスタが求められるもので、PostGIS 2.0とGDAL 1.8ドライバで追加されています。これはGDAL 1,7ドライバにはありません。</p></td></tr></table></div><pre class="programlisting">
-- 標準的なラスタオプションでラスタを表示します
LAYER
	NAME coolwktraster
	TYPE raster
	STATUS ON
	DATA "PG:host=localhost port=5432 dbname='somedb' user='someuser' password='whatever' 
		schema='someschema' table='cooltable' mode='2'"	
	PROCESSING "NODATA=0"
	PROCESSING "SCALE=AUTO"
	#... 他の標準的なラスタ処理関数です
	#... CLASSは必須ではありませんが1バンドデータには便利です
	CLASS
		NAME "boring"
		EXPRESSION ([pixel] &lt; 20)
		COLOR 250 250 250
	END
	CLASS
		NAME "mildly interesting"
		EXPRESSION ([pixel] &gt; 20 AND [pixel] &lt; 1000)
		COLOR 255 0 0
	END
	CLASS
		NAME "very interesting"
		EXPRESSION ([pixel] &gt;= 1000)
		COLOR 0 255 0
	END
END
        </pre><pre class="programlisting">
-- 標準的なラスタオプションとWHERE節でラスタを表示します
LAYER
	NAME soil_survey2009
	TYPE raster
	STATUS ON
	DATA "PG:host=localhost port=5432 dbname='somedb' user='someuser' password='whatever' 
		schema='someschema' table='cooltable' where='survey_year=2009' mode='2'"	
	PROCESSING "NODATA=0"
	#... 他の標準的なラスタ処理関数です
	#... CLASSは必須ではありませんが1バンドデータには便利です
END
        </pre></td></tr><tr class="question" title="10.11."><td align="left" valign="top"><a name="id287173863"></a><a name="id287173865"></a><p><b>10.11.</b></p></td><td align="left" valign="top"><p>現在ラスタデータで使用できる関数は何ですか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p><a class="xref" href="#RT_reference" title="第9章 ラスタ リファレンス">9章<i>ラスタ リファレンス</i></a>のリストを参照して下さい。これよりも多くの関数がありますが、開発途中です。</p><p>将来的に期待できる関数の詳細情報は<a class="ulink" href="http://trac.osgeo.org/postgis/wiki/WKTRaster/PlanningAndFunding" target="_top">PostGIS Raster roadmap page</a>を参照してください。</p></td></tr><tr class="question" title="10.12."><td align="left" valign="top"><a name="qa_raster_function_not_unique"></a><a name="id287173893"></a><p><b>10.12.</b></p></td><td align="left" valign="top"><p>ERROR:  function st_intersects(raster, unknown) is not unique or st_union(geometry,text) is not unique. とのエラーが出ました。解消するにはどうすればいいでしょうか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>引数のひとつがジオメトリでなくジオメトリの文字列表現である場合、一意でない関数エラーが発生します。この場合、PostgreSQLは文字列表現を未知の型とします。そうすると st_intersects(raster, geometry) か st_intersects(raster,raster) かのどちらかになります。理論上両方の関数はリクエストに沿うので、一意でないことになります。これを回避するには、GEOMETRY型にキャストして下さい。</p><p>たとえば次のようにします。</p><pre class="programlisting">SELECT rast
 FROM my_raster
   WHERE ST_Intersects(rast, 'SRID=4326;POINT(-10 10)');</pre><p>Cast the textual geometry representation to a geometry by changing your code to this:</p><pre class="programlisting">SELECT rast
 FROM my_raster
   WHERE ST_Intersects(rast, 'SRID=4326;POINT(-10 10)'::geometry);</pre></td></tr><tr class="question" title="10.13."><td align="left" valign="top"><a name="id287173922"></a><a name="id287173924"></a><p><b>10.13.</b></p></td><td align="left" valign="top"><p>PostGISラスタとOracle GeoRaster (SDO_GEORATGER)およびSDO_RASTERとどの位違うのでしょうか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>この話題に関するより広範囲な議論については、Jorge Arevaloさんの<a class="ulink" href="http://gis4free.wordpress.com/2010/07/19/oracle-georaster-part-i/" target="_top">Oracle GeoRaster and PostGIS Raster: First impressions </a>をご覧ください。</p><p>ラスタごとのジオリファレンスがレイヤごとのジオリファレンスより優れいていることの主たるものは次の通りです。</p><p>* カバレッジが必ずしも長方形でなくてよいこと (この長方形はしばしば広範囲におよぶラスタカバレッジになります。この文書の可能なラスタの配置をご覧ください)</p><p>* オーバラップするラスタ (ベクタからラスタへの変換で欠損無く実装できる点で重要)</p><p>これらの配置はOracleでも可能ですが、多数のSDO_RASTERテーブルと関連付けられる複数のSDO_GEORASTERオブジェクトを格納することになります。複雑なカバレッジになると、データベース上の数百のテーブルにおよぶこともあります。PostGISラスタを使うと、似たようなラスタ配置を1つのテーブルで行うことができます。</p><p>PostGISがユーザに隙間やオーバラップの無い長方形ベクタカバレッジ (完全な長方形トポロジのレイヤ) を強制するのに少し似ています。これは、いくつかのアプリケーションにおいては非常に実際的ですが、実際に行うと、ほとんどのカバレッジにとって、現実的でなく望ましくもないことが分かりました。ベクタ構造には、不連続かつ非長方形のカバレッジを格納する柔軟性が必要です。ラスタ構造が同様に利益を受けることについて、私たちは大きな利点であると考えます。</p></td></tr></tbody></table></div></div><div class="chapter" title="第11章 トポロジ"><div class="titlepage"><div><div><h2 class="title"><a name="Topology"></a>第11章 トポロジ</h2></div></div></div><div class="toc"><p><b>目次</b></p><dl><dt><span class="sect1"><a href="#Topology_Types">11.1. トポロジ型</a></span></dt><dt><span class="sect1"><a href="#Topology_Domains">11.2. トポロジドメイン</a></span></dt><dt><span class="sect1"><a href="#Topology_ManagementFunctions">11.3. トポロジとTopoGeometryの管理</a></span></dt><dt><span class="sect1"><a href="#Topology_Constructors">11.4. トポロジコンストラクタ</a></span></dt><dt><span class="sect1"><a href="#Topology_Editing">11.5. トポロジエディタ</a></span></dt><dt><span class="sect1"><a href="#Topology_Accessors">11.6. トポロジアクセサ</a></span></dt><dt><span class="sect1"><a href="#Topology_Processing">11.7. トポロジ処理</a></span></dt><dt><span class="sect1"><a href="#TopoGeometry_Constructors">11.8. TopoGeometryコンストラクタ</a></span></dt><dt><span class="sect1"><a href="#TopoGeom_Accessors">11.9. TopoGeometryアクセサ</a></span></dt><dt><span class="sect1"><a href="#TopoGeometry_Outputs">11.10. TopoGeometry出力</a></span></dt></dl></div><p>PostGISトポロジ型と関数は、フェイス、エッジ、ノード等のトロポジオブジェクトを管理するために使います。</p><p>PostGIS Day Paris 2011におけるSandro Santilliさんの講演が、PostGISトポロジの概略説明として良いです。<a class="ulink" href="http://strk.keybit.net/projects/postgis/Paris2011_TopologyWithPostGIS_2_0.pdf" target="_top">Topology with PostGIS 2.0 slide deck</a> にあります。</p><p>Vincent Picavetさんはトポロジに関する説明とトポロジをサポートする各種FOSS4Gツールに関する、良い概略説明を<a class="ulink" href="http://2010.foss4g.org/presentations/3555.pdf" target="_top">State of the art of FOSS4G for topology and network analysis</a>で出しています。</p><p>トポロジベースのGISデータベースの例として<a class="ulink" href="http://www.census.gov/geo/www/tiger/overview.html" target="_top">US Census Topologically Integrated Geographic Encoding and Reference System (TIGER)</a>があります。PostGISトポロジの試験がしたくて、何らかのデータが必要なら<a class="xref" href="#Topology_Load_Tiger" title="Topology_Load_Tiger">Topology_Load_Tiger</a>をご覧下さい</p><p>PostGISトポロジモジュールは前の版にもありましたが、正式なPostGIS文書の中には入れていませんでした。PostGIS 2.0.0 では、全ての非推奨関数が無くし、知られていた使いやすさの問題を解決し、機能と関数の文書をより良くし、新しい関数を追加し、SQL-MM標準により準拠させるために、大整理を行っています。</p><p>このプロジェクトの詳細情報は <a class="ulink" href="http://trac.osgeo.org/postgis/wiki/UsersWikiPostgisTopology" target="_top">PostGIS Topology Wiki</a> にあります。</p><p>このモジュールに関する全ての関数とテーブルは、<code class="varname">topology</code>スキーマにインストールされます。</p><p>SQL/MM標準で定義される関数はST_プリフィクスを持ち、PostGIS特有の関数はこのプリフィクスを持ちません。</p><p>トポロジ機能を持つPostGIS 2.0をビルドするには、<a class="xref" href="#postgis_installation" title="第2章 インストール">2章<i>インストール</i></a>にもありますが--with-topologyオプションを付けてコンパイルします。GEOS 3.3以上に依存する関数があるため、完全にトポロジーをサポートするには GEOS 3.3以上でコンパイルします。</p><div class="sect1" title="11.1. トポロジ型"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Topology_Types"></a>11.1. トポロジ型</h2></div><div><div class="abstract" title="概要"><p class="title"><b>概要</b></p><p>本節では、PostGISトポロジでインストールされるPostgreSQLデータ型の一覧を挙げます。独自に関数をデザインする際に特に重要となる、キャストでの振る舞いを記述していることに、ご注意ください。
                </p></div></div></div></div><div class="toc"><dl><dt><span class="refentrytitle"><a href="#getfaceedges_returntype">getfaceedges_returntype</a></span><span class="refpurpose"> ? 順列番号とエッジ番号の複合型です。<code class="varname">ST_GetFaceEdges</code> が返す型です。</span></dt><dt><span class="refentrytitle"><a href="#topogeometry">topogeometry</a></span><span class="refpurpose"> ? 特定のトポロジ、レイヤ内の、識別番号の付いたトポロジジオメトリへの参照である複合型で、タイプ(1:[multi]point, 2:[multi]line, 3:[multi]poly, 4:collection)を持ちます。識別番号はトポロジ内のTopoGeometryについて一意に定義されます。</span></dt><dt><span class="refentrytitle"><a href="#validatetopology_returntype">validatetopology_returntype</a></span><span class="refpurpose"> ? 
エラーメッセージと、エラーの場所を示す、id1とid2からなる複合型です。これは<code class="varname">ValidateTopology</code>が返す型です。</span></dt></dl></div><div class="refentry" title="getfaceedges_returntype"><a name="getfaceedges_returntype"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>getfaceedges_returntype ? 順列番号とエッジ番号の複合型です。<code class="varname">ST_GetFaceEdges</code> が返す型です。</p></div><div class="refsection" title="説明"><a name="id287177097"></a><h2>説明</h2><p>順列番号とエッジ番号の複合型です。<code class="varname">ST_GetFaceEdges</code>関数が返す型です。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><code class="varname">sequence</code> (整数): トポロジスキーマとSRIDを定義するtopology.topologyテーブルで定義されるトポロジへの参照です</p></li><li class="listitem"><p><code class="varname">edge</code> (整数): エッジの識別番号です。</p></li></ol></div></div></div><div class="refentry" title="topogeometry"><div class="refentry.separator"><hr></div><a name="topogeometry"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>topogeometry ? 特定のトポロジ、レイヤ内の、識別番号の付いたトポロジジオメトリへの参照である複合型で、タイプ(1:[multi]point, 2:[multi]line, 3:[multi]poly, 4:collection)を持ちます。識別番号はトポロジ内のTopoGeometryについて一意に定義されます。</p></div><div class="refsection" title="説明"><a name="id287177147"></a><h2>説明</h2><p>
特定のトポロジ、レイヤ内の、識別番号の付いたトポロジジオメトリへの参照である複合型で、タイプ(1:[multi]point, 2:[multi]line, 3:[multi]poly, 4:collection)を持ちます。TopoGeometryの要素はtopology_id, layer_id, id integer, type integerの各属性です。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><code class="varname">topology_id</code> (整数): トポロジスキーマとSRIDを定義するtopology.topologyテーブルで定義されているトポロジへの参照です。</p></li><li class="listitem"><p><code class="varname">layer_id</code> (整数): TopoGeometryが属するlayersテーブルにおけるlayer_idです。topology_idとtopology_idとの組み合わせで、topology.layersテーブルを一意に参照できます。</p></li><li class="listitem"><p><code class="varname">type</code> 1から4までの整数で、ジオメトリタイプを定義します。1:[multi]point, 2:[multi]line, 3:[multi]poly, 4:collectionとなります。</p></li><li class="listitem"><p><code class="varname">id</code> (整数): それぞれのトポロジでTopoGeometryを一意にするための順序整数で、自動生成されます。</p></li></ol></div></div><div class="refsection" title="キャストの挙動"><a name="id287177197"></a><h2>キャストの挙動</h2><p>本節では、このデータ型で許容される明示的なキャストと自動キャストの一覧を挙げます。</p><div class="informaltable"><table border="1"><colgroup><col><col></colgroup><tbody><tr><td>キャスト先</td><td>挙動</td></tr><tr><td>geometry</td><td>automatic</td></tr></tbody></table></div></div><div class="refsection" title="関連情報"><a name="id287177242"></a><h2>関連情報</h2><p><a class="xref" href="#CreateTopoGeom" title="CreateTopoGeom">CreateTopoGeom</a></p></div></div><div class="refentry" title="validatetopology_returntype"><div class="refentry.separator"><hr></div><a name="validatetopology_returntype"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>validatetopology_returntype ? 
エラーメッセージと、エラーの場所を示す、id1とid2からなる複合型です。これは<code class="varname">ValidateTopology</code>が返す型です。</p></div><div class="refsection" title="説明"><a name="id287177271"></a><h2>説明</h2><p>エラーメッセージと2つの整数からなる複合型です。<a class="xref" href="#ValidateTopology" title="ValidateTopology">ValidateTopology</a>関数は、このセットを返します。評価エラーを示し、id1とid2でエラーを含むトポロジオブジェクトの識別番号を示します。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><code class="varname">error</code> (varchar): エラーのタイプを示します。</p><p>現在のエラー記述: coincident nodes (ノード重複), edge crosses node (エッジとノードのクロス), edge not simple (単純でないエッジ), edge end node geometry mis-match (終了ノードジオメトリの不整合), edge start node geometry mismatch (開始ノードジオメトリの不整合), face overlaps face (フェイス同士のオーバラップ), face within face (フェイス間の包含)</p></li><li class="listitem"><p><code class="varname">id1</code> (整数): エラーを持つエッジ/フェイス/ノードの識別番号を示します。</p></li><li class="listitem"><p><code class="varname">id2</code> (整数): 2オブジェクトでのエラーにおける2つめのエッジ/ノードの識別番号を示します。</p></li></ol></div></div><div class="refsection" title="関連情報"><a name="id287177389"></a><h2>関連情報</h2><p><a class="xref" href="#ValidateTopology" title="ValidateTopology">ValidateTopology</a></p></div></div></div><div class="sect1" title="11.2. トポロジドメイン"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Topology_Domains"></a>11.2. トポロジドメイン</h2></div><div><div class="abstract" title="概要"><p class="title"><b>概要</b></p><p>本節では、PostGISトポロジでインストールされるPostgreSQLドメインのリストを挙げます。ドメインは、オブジェクト型のように扱え、関数やテーブルカラムのオブジェクトを返します。ドメインは存在するチェック制約のある型である点で、型とは違います。
                </p></div></div></div></div><div class="toc"><dl><dt><span class="refentrytitle"><a href="#topoelement">TopoElement</a></span><span class="refpurpose"> ? 2つの整数の配列で、通常TopoGeometry要素を識別するために使われます。</span></dt><dt><span class="refentrytitle"><a href="#topoelementarray">topoelementarray</a></span><span class="refpurpose"> ? element_id値とelement_type値の配列です。{{id,type}, {id,type}, ...}となる整数の2次元配列です。</span></dt></dl></div><div class="refentry" title="TopoElement"><a name="topoelement"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>TopoElement ? 2つの整数の配列で、通常TopoGeometry要素を識別するために使われます。</p></div><div class="refsection" title="説明"><a name="id287177431"></a><h2>説明</h2><p>2つの整数の配列で、トポロジプリミティブの識別番号とタイプを表現するため、あるいは、識別番号とTopoGeometryのレイヤを表現するために使われます。このような組の集合は TopoGeometryオブジェクト(単純または階層的の両方)を定義するために使われます。</p></div><div class="refsection" title="例"><a name="id287177441"></a><h2>例</h2><pre class="programlisting">SELECT ARRAY[1,2]::topology.topoelement;
  te
-------
 {1,2}
                 </pre><pre class="programlisting">
-- 3要素配列をtopoelementに使った際に発生するエラーの例
-- ご注意: topoelementは、必ず2要素を持ちます。次元チェックにひっかかります。
SELECT ARRAY[1,2,3]::topology.topoelement;
ERROR:  value for domain topology.topoelement violates check constraint "dimensions"
                 </pre></div><div class="refsection" title="関連情報"><a name="id287177459"></a><h2>関連情報</h2><p><a class="xref" href="#GetTopoGeomElements" title="GetTopoGeomElements">GetTopoGeomElements</a></p></div></div><div class="refentry" title="topoelementarray"><div class="refentry.separator"><hr></div><a name="topoelementarray"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>topoelementarray ? element_id値とelement_type値の配列です。{{id,type}, {id,type}, ...}となる整数の2次元配列です。</p></div><div class="refsection" title="説明"><a name="id287177483"></a><h2>説明</h2><p>1つ以上のtopoelementの配列です。整数の2次元配列で、'{{id,type}, {id,type}, ...}'となります。つまり、2つの整数を持つ配列の、1つ以上の配列です。トポロジの関係の要素idと要素型のセットの配列を返すために使われます。</p><p>typeの値については、現時点では<code class="varname">node</code>=1, <code class="varname">edge</code>=2, <code class="varname">face</code>=3の、3つのタイプがサポートされています。</p></div><div class="refsection" title="例"><a name="id287177507"></a><h2>例</h2><pre class="programlisting">SELECT '{{1,2},{4,3}}'::topology.topoelementarray As tea;
  tea
-------
{{1,2},{4,3}}

-- より長く書いた同等のもの --
SELECT ARRAY[ARRAY[1,2], ARRAY[4,3]]::topology.topoelementarray As tea;

  tea
-------
{{1,2},{4,3}}

-- トポロジに入っている配列集計関数の使用 --
SELECT topology.TopoElementArray_Agg(ARRAY[e,t]) As tea
  FROM generate_series(1,4) As e CROSS JOIN generate_series(1,3) As t;
  tea
--------------------------------------------------------------------------
{{1,1},{1,2},{1,3},{2,1},{2,2},{2,3},{3,1},{3,2},{3,3},{4,1},{4,2},{4,3}}
                 </pre><pre class="programlisting">SELECT '{{1,2,4},{3,4,5}}'::topology.topoelementarray As tea;
ERROR:  value for domain topology.topoelementarray violates check constraint "dimensions"
                 </pre></div><div class="refsection" title="関連情報"><a name="id287177559"></a><h2>関連情報</h2><p><a class="xref" href="#GetTopoGeomElementArray" title="GetTopoGeomElementArray">GetTopoGeomElementArray</a>, <a class="xref" href="#TopoElementArray_Agg" title="TopoElementArray_Agg">TopoElementArray_Agg</a></p></div></div></div><div class="sect1" title="11.3. トポロジとTopoGeometryの管理"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Topology_ManagementFunctions"></a>11.3. トポロジとTopoGeometryの管理</h2></div><div><div class="abstract" title="概要"><p class="title"><b>概要</b></p><p>本節では、新しいトポロジスキーマの構築、トポロジの評価、TopoGeometryカラムの管理のためのトポロジ関数の一覧を挙げます。</p></div></div></div></div><div class="toc"><dl><dt><span class="refentrytitle"><a href="#AddTopoGeometryColumn">AddTopoGeometryColumn</a></span><span class="refpurpose"> ? 既存のテーブルにTopoGeometryカラムを追加し、topology.layer内に新しいレイヤとして新しいカラムを登録して、新しい layer_id を返します。</span></dt><dt><span class="refentrytitle"><a href="#DropTopology">DropTopology</a></span><span class="refpurpose"> ? 使用上の注意: この関数によって、トポロジスキーマが削除され、topology.topologyテーブルからの参照とgeometry_columnsテーブルからの削除対象スキーマ内のテーブルへの参照とが削除されます。</span></dt><dt><span class="refentrytitle"><a href="#DropTopoGeometryColumn">DropTopoGeometryColumn</a></span><span class="refpurpose"> ? <code class="varname">schema_name</code>で指定されたスキーマ内にある<code class="varname">table_name</code>で指定されたテーブルからTopoGeometryカラムを削除し、topology.layerテーブルにある登録を解除します。</span></dt><dt><span class="refentrytitle"><a href="#TopologySummary">TopologySummary</a></span><span class="refpurpose"> ? トポロジ名を取得し、トポロジ内のオブジェクトの型に関する概の全体を提供します。</span></dt><dt><span class="refentrytitle"><a href="#ValidateTopology">ValidateTopology</a></span><span class="refpurpose"> ? トポロジに関する問題を詳述するvalidatetopology_returntypeオブジェクトの集合を返します。</span></dt></dl></div><div class="refentry" title="AddTopoGeometryColumn"><a name="AddTopoGeometryColumn"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>AddTopoGeometryColumn ? 既存のテーブルにTopoGeometryカラムを追加し、topology.layer内に新しいレイヤとして新しいカラムを登録して、新しい layer_id を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">AddTopoGeometryColumn</b>(</code>varchar 
                        <var class="pdparam">topology_name</var>, varchar 
                        <var class="pdparam">schema_name</var>, varchar 
                        <var class="pdparam">table_name</var>, varchar 
                        <var class="pdparam">column_name</var>, varchar 
                        <var class="pdparam">feature_type</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">AddTopoGeometryColumn</b>(</code>varchar 
                        <var class="pdparam">topology_name</var>, varchar 
                        <var class="pdparam">schema_name</var>, varchar 
                        <var class="pdparam">table_name</var>, varchar 
                        <var class="pdparam">column_name</var>, varchar 
                        <var class="pdparam">feature_type</var>, integer 
                        <var class="pdparam">child_layer</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287177725"></a><h2>説明</h2><p>TopoGeometryオブジェクトは、それぞれ特定のトポロジの特定のレイヤに属します。TopoGeometryオブジェクト生成の前に、トポロジレイヤの生成が必要です。トポロジレイヤは地物テーブルとトポロジとで組織されます。また、タイプと階層の情報を持ちます。レイヤの生成にはAddTopoGeometryColumn()を使います。</p><p>この関数は、リクエストされたカラムをテーブルに追加し、topology.layerテーブルに、与えられた全ての情報のレコードを追加します。</p><p>[child_layer]を指定しない(またはNULLを指定する)場合、このレイヤは、基本的なTopoGeometry(プリミティブなトポロジ要素で構成)を含みます。指定する場合、このレイヤは階層的なTopoGeometry(child_layerからのTopoGeometryで構成)を持ちます。</p><p>レイヤが生成される(これの識別番号は、AddTopoGeometryColumn関数が返します)と、TopoGeometryオブジェクトをこの中に構築する準備ができます。</p><p>妥当な<code class="varname">feature_type</code>は、POINT, LINE, POLYGON, COLLECTIONです。</p><p>初出: 1.?</p></div><div class="refsection" title="例"><a name="id287177756"></a><h2>例</h2><pre class="programlisting">-- 本例ではma_topoスキーマに新しいテーブルを作ったことに注意して下さい。
-- 異なるスキーマに新しいテーブルを作ることができ、
-- この場合はtopology_nameとshcema_nameが異なります。
CREATE SCHEMA ma;
CREATE TABLE ma.parcels(gid serial, parcel_id varchar(20) PRIMARY KEY, address text);
SELECT topology.AddTopoGeometryColumn('ma_topo', 'ma', 'parcels', 'topo', 'POLYGON');</pre><pre class="programlisting">
CREATE SCHEMA ri;
CREATE TABLE ri.roads(gid serial PRIMARY KEY, road_name text);
SELECT topology.AddTopoGeometryColumn('ri_topo', 'ri', 'roads', 'topo', 'LINE');
</pre></div><div class="refsection" title="関連情報"><a name="id287174668"></a><h2>関連情報</h2><p><a class="xref" href="#CreateTopology" title="CreateTopology">CreateTopology</a>, <a class="xref" href="#CreateTopoGeom" title="CreateTopoGeom">CreateTopoGeom</a></p></div></div><div class="refentry" title="DropTopology"><div class="refentry.separator"><hr></div><a name="DropTopology"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>DropTopology ? 使用上の注意: この関数によって、トポロジスキーマが削除され、topology.topologyテーブルからの参照とgeometry_columnsテーブルからの削除対象スキーマ内のテーブルへの参照とが削除されます。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">DropTopology</b>(</code>varchar  <var class="pdparam">topology_schema_name</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287174721"></a><h2>説明</h2><p>トポロジスキーマを削除し、topology.topologyテーブルからの参照とgeometry_columnsテーブルからの削除対象スキーマ内のテーブルへの参照とを削除します。この関数は *十分に注意してご使用下さい*。残しておきたかったデータが破壊される可能性があります。スキーマが存在しない場合、スキーマへの参照に関するエントリの削除だけを行います。</p><p>初出: 1.?</p></div><div class="refsection" title="例"><a name="id287174737"></a><h2>例</h2><p>ma_topoスキーマをカスケード削除し、topology.topologyにある参照のうち関係するものを全て削除します。</p><pre class="programlisting">SELECT topology.DropTopology('ma_topo');</pre></div><div class="refsection" title="関連情報"><a name="id287174753"></a><h2>関連情報</h2><p></p></div></div><div class="refentry" title="DropTopoGeometryColumn"><div class="refentry.separator"><hr></div><a name="DropTopoGeometryColumn"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>DropTopoGeometryColumn ? <code class="varname">schema_name</code>で指定されたスキーマ内にある<code class="varname">table_name</code>で指定されたテーブルからTopoGeometryカラムを削除し、topology.layerテーブルにある登録を解除します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">DropTopoGeometryColumn</b>(</code>varchar  <var class="pdparam">schema_name</var>, varchar  <var class="pdparam">table_name</var>, varchar  <var class="pdparam">column_name</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287174823"></a><h2>説明</h2><p><code class="varname">schema_name</code>で指定されたスキーマ内にある<code class="varname">table_name</code>で指定されたテーブルからTopoGeometryカラムを削除し、topology.layerテーブルにある登録を解除します。削除状態の概要を返します。ご注意: この関数は、参照整合性チェックをすり抜けるために、まずNULL値に上書きしてから削除します。</p><p>初出: 1.?</p></div><div class="refsection" title="例"><a name="id287174843"></a><h2>例</h2><pre class="programlisting">SELECT topology.DropTopoGeometryColumn('ma_topo', 'parcel_topo', 'topo');</pre></div><div class="refsection" title="関連情報"><a name="id287174856"></a><h2>関連情報</h2><p><a class="xref" href="#AddTopoGeometryColumn" title="AddTopoGeometryColumn">AddTopoGeometryColumn</a></p></div></div><div class="refentry" title="TopologySummary"><div class="refentry.separator"><hr></div><a name="TopologySummary"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>TopologySummary ? トポロジ名を取得し、トポロジ内のオブジェクトの型に関する概の全体を提供します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">TopologySummary</b>(</code>varchar  <var class="pdparam">topology_schema_name</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287174907"></a><h2>説明</h2><p>トポロジ名を取得し、トポロジ内のオブジェクトの型に関する概の全体を提供します。</p><p>初出: 2.0.0</p></div><div class="refsection" title="例"><a name="id287174923"></a><h2>例</h2><pre class="programlisting">SELECT topology.topologysummary('city_data');
                    topologysummary                     
--------------------------------------------------------
 Topology city_data (329), SRID 4326, precision: 0
 22 nodes, 24 edges, 10 faces, 29 topogeoms in 5 layers
 Layer 1, type Polygonal (3), 9 topogeoms
  Deploy: features.land_parcels.feature
 Layer 2, type Puntal (1), 8 topogeoms
  Deploy: features.traffic_signs.feature
 Layer 3, type Lineal (2), 8 topogeoms
  Deploy: features.city_streets.feature
 Layer 4, type Polygonal (3), 3 topogeoms
  Hierarchy level 1, child layer 1
  Deploy: features.big_parcels.feature
 Layer 5, type Puntal (1), 1 topogeoms
  Hierarchy level 1, child layer 2
  Deploy: features.big_signs.feature</pre></div><div class="refsection" title="関連情報"><a name="id287175005"></a><h2>関連情報</h2><p><a class="xref" href="#Topology_Load_Tiger" title="Topology_Load_Tiger">Topology_Load_Tiger</a></p></div></div><div class="refentry" title="ValidateTopology"><div class="refentry.separator"><hr></div><a name="ValidateTopology"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ValidateTopology ? トポロジに関する問題を詳述するvalidatetopology_returntypeオブジェクトの集合を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">setof validatetopology_returntype <b class="fsfunc">ValidateTopology</b>(</code>varchar  <var class="pdparam">topology_schema_name</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287175056"></a><h2>説明</h2><p>トポロジに関する問題を詳述するvalidatetopology_returntypeオブジェクトの集合を返します。考えられるエラーの一覧については <a class="xref" href="#validatetopology_returntype" title="validatetopology_returntype">validatetopology_returntype</a> を参照してください。</p><p>初出: 1.?</p><p>機能強化: 2.0.0 で、エッジのクロス判定を効率化し、以前の版に出た偽陽性を解消しました。</p></div><div class="refsection" title="例"><a name="id287175115"></a><h2>例</h2><pre class="programlisting">SELECT * FROM  topology.ValidateTopology('ma_topo');
      error        | id1 | id2
-------------------+-----+-----
face without edges |   0 |				
				</pre></div><div class="refsection" title="関連情報"><a name="id287175128"></a><h2>関連情報</h2><p><a class="xref" href="#validatetopology_returntype" title="validatetopology_returntype">validatetopology_returntype</a>, <a class="xref" href="#Topology_Load_Tiger" title="Topology_Load_Tiger">Topology_Load_Tiger</a></p></div></div></div><div class="sect1" title="11.4. トポロジコンストラクタ"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Topology_Constructors"></a>11.4. トポロジコンストラクタ</h2></div><div><div class="abstract" title="概要"><p class="title"><b>概要</b></p><p>本節では、新しいトポロジを生成するトポロジ関数を挙げます。</p></div></div></div></div><div class="toc"><dl><dt><span class="refentrytitle"><a href="#CreateTopology">CreateTopology</a></span><span class="refpurpose"> ? 新しいトポロジスキーマを生成し、新しいスキーマをtopology.topologyテーブルに登録します。</span></dt><dt><span class="refentrytitle"><a href="#CopyTopology">CopyTopology</a></span><span class="refpurpose"> ? トポロジ構造(ノード、エッジ、フェイス、レイヤ、TopoGeometry)を複写します。</span></dt><dt><span class="refentrytitle"><a href="#ST_InitTopoGeo">ST_InitTopoGeo</a></span><span class="refpurpose"> ? 新しいトポロジスキーマを生成し、topology.topologyテーブルに新しいスキーマを登録し、処理の概要を表示します。</span></dt><dt><span class="refentrytitle"><a href="#ST_CreateTopoGeo">ST_CreateTopoGeo</a></span><span class="refpurpose"> ? 
空のトポロジにジオメトリのコレクションを追加し、成否を示すメッセージを返します。
				</span></dt><dt><span class="refentrytitle"><a href="#TopoGeo_AddPoint">TopoGeo_AddPoint</a></span><span class="refpurpose"> ? 
許容差を使って既存のトポロジにポイントを追加し、可能ならエッジを分割します。
				</span></dt><dt><span class="refentrytitle"><a href="#TopoGeo_AddLineString">TopoGeo_AddLineString</a></span><span class="refpurpose"> ? 
許容差を使って既存のトポロジにラインストリングを追加し、可能ならエッジ/フェイスを分割します。
				</span></dt><dt><span class="refentrytitle"><a href="#TopoGeo_AddPolygon">TopoGeo_AddPolygon</a></span><span class="refpurpose"> ? 
許容差を使って既存のトポロジにポリゴンを追加し、可能ならエッジ/フェイスを分割します。
				</span></dt></dl></div><div class="refentry" title="CreateTopology"><a name="CreateTopology"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>CreateTopology ? 新しいトポロジスキーマを生成し、新しいスキーマをtopology.topologyテーブルに登録します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">CreateTopology</b>(</code>varchar  <var class="pdparam">topology_schema_name</var><code>)</code>;</p><p><code class="funcdef">integer <b class="fsfunc">CreateTopology</b>(</code>varchar  <var class="pdparam">topology_schema_name</var>, integer  <var class="pdparam">srid</var><code>)</code>;</p><p><code class="funcdef">integer <b class="fsfunc">CreateTopology</b>(</code>varchar  <var class="pdparam">topology_schema_name</var>, integer  <var class="pdparam">srid</var>, double precision  <var class="pdparam">tolerance</var><code>)</code>;</p><p><code class="funcdef">integer <b class="fsfunc">CreateTopology</b>(</code>varchar  <var class="pdparam">topology_schema_name</var>, integer  <var class="pdparam">srid</var>, double precision  <var class="pdparam">tolerance</var>, boolean  <var class="pdparam">hasz</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287175307"></a><h2>説明</h2><p><code class="varname">topology_name</code>で指定したスキーマを生成し、テーブル(<code class="varname">edge_data</code>,<code class="varname">face</code>,<code class="varname">node</code>, <code class="varname">relation</code>)を生成し、topology.topologyテーブルに新しいトポロジを登録します。sridは空間参照系識別番号で、spatial_ref_sys テーブルで定義されています。トポロジの名称は一意でなければなりません。tolerance(許容差)は、空間参照系で規定される単位で、指定しない場合は 0 とされます。</p><p>SQL/MM の <a class="xref" href="#ST_InitTopoGeo" title="ST_InitTopoGeo">ST_InitTopoGeo</a> に似ていますが、少しだけこちらの方が機能追加されています。<code class="varname">hasz</code>は、指定されていない場合は false とされます。</p><p>初出: 1.?</p></div><div class="refsection" title="例"><a name="id287175347"></a><h2>例</h2><p>本例ではマサチューセッツ州平面のエッジ、フェイスとリレーションを保存するための、ma_topoという新しいスキーマを生成します。空間参照系はメートルを単位としているので、許容差 は 0.5メートルとなります。</p><pre class="programlisting">SELECT topology.CreateTopology('ma_topo',26986, 0.5);</pre><p>Create Rhode Island topology in State Plane ft</p><pre class="programlisting">SELECT topology.CreateTopology('ri_topo',3438) As topoid;
topoid
------
2</pre></div><div class="refsection" title="関連情報"><a name="id287175370"></a><h2>関連情報</h2><p><a class="xref" href="#spatial_ref_sys" title="4.3.1. SPATIAL_REF_SYSテーブルと空間参照系">「SPATIAL_REF_SYSテーブルと空間参照系」</a>, <a class="xref" href="#ST_InitTopoGeo" title="ST_InitTopoGeo">ST_InitTopoGeo</a>, <a class="xref" href="#Topology_Load_Tiger" title="Topology_Load_Tiger">Topology_Load_Tiger</a></p></div></div><div class="refentry" title="CopyTopology"><div class="refentry.separator"><hr></div><a name="CopyTopology"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>CopyTopology ? トポロジ構造(ノード、エッジ、フェイス、レイヤ、TopoGeometry)を複写します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">CopyTopology</b>(</code>varchar  <var class="pdparam">existing_topology_name</var>, varchar  <var class="pdparam">new_name</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287175435"></a><h2>説明</h2><p>
<code class="varname">new_topology_name</code>で指定した名前のトポロジを生成し、<code class="varname">existing_topology_name</code>から取得されるSRID、精度にし、ノード、エッジ、フェイス、レイヤ、TopoGeometryを複製します。
		</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>
topology.layerの新しい行には、schema_name, table_name, feature_columnの統合された値が入ります。TopoGeometryが定義には存在しても、どのユーザレベルのテーブルにも存在しないためです。
		</p></td></tr></table></div><p>初出: 2.0.0</p></div><div class="refsection" title="例"><a name="id287175462"></a><h2>例</h2><p>
本例では、ma_topoという名前のトポロジにバックアップをとっています。
				</p><pre class="programlisting">SELECT topology.CopyTopology('ma_topo', 'ma_topo_bakup');</pre></div><div class="refsection" title="関連情報"><a name="id287175478"></a><h2>関連情報</h2><p><a class="xref" href="#spatial_ref_sys" title="4.3.1. SPATIAL_REF_SYSテーブルと空間参照系">「SPATIAL_REF_SYSテーブルと空間参照系」</a>, <a class="xref" href="#CreateTopology" title="CreateTopology">CreateTopology</a></p></div></div><div class="refentry" title="ST_InitTopoGeo"><div class="refentry.separator"><hr></div><a name="ST_InitTopoGeo"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_InitTopoGeo ? 新しいトポロジスキーマを生成し、topology.topologyテーブルに新しいスキーマを登録し、処理の概要を表示します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_InitTopoGeo</b>(</code>varchar  <var class="pdparam">topology_schema_name</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287175531"></a><h2>説明</h2><p>これはCreateTopologyのSQL-MM互換ですが、CreateTopologyにある空間参照系とtoleranceオプションがありません。また、トポロジIDを返すのではなく、生成に関する記述を出力します。</p><p>初出: 1.?</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3 Topo-Geo and Topo-Net 3: Routine Details: X.3.17</p></div><div class="refsection" title="例"><a name="id287175559"></a><h2>例</h2><pre class="programlisting">SELECT topology.ST_InitTopoGeo('topo_schema_to_create') AS topocreation;
                      astopocreation
------------------------------------------------------------
 Topology-Geometry 'topo_schema_to_create' (id:7) created.
				</pre></div><div class="refsection" title="関連情報"><a name="id287175572"></a><h2>関連情報</h2><p><a class="xref" href="#CreateTopology" title="CreateTopology">CreateTopology</a></p></div></div><div class="refentry" title="ST_CreateTopoGeo"><div class="refentry.separator"><hr></div><a name="ST_CreateTopoGeo"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_CreateTopoGeo ? 
空のトポロジにジオメトリのコレクションを追加し、成否を示すメッセージを返します。
				</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_CreateTopoGeo</b>(</code>varchar  <var class="pdparam">atopology</var>, geometry  <var class="pdparam">acollection</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287175630"></a><h2>説明</h2><p>
空のトポロジにジオメトリのコレクションを追加し、成否を示すメッセージを返します。
                </p><p>空トポロジの追加に使われます。</p><p>初出: 2.0 </p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM: Topo-Geo and Topo-Net 3: Routine Details -- X.3.18</p></div><div class="refsection" title="例"><a name="id287175697"></a><h2>例</h2><pre class="programlisting">
-- Populate topology --
SELECT topology.ST_CreateTopoGeo('ri_topo', 
 ST_GeomFromText('MULTILINESTRING((384744 236928,384750 236923,384769 236911,384799 236895,384811 236890,384833 236884,
  384844 236882,384866 236881,384879 236883,384954 236898,385087 236932,385117 236938,
  385167 236938,385203 236941,385224 236946,385233 236950,385241 236956,385254 236971,
  385260 236979,385268 236999,385273 237018,385273 237037,385271 237047,385267 237057,
  385225 237125,385210 237144,385192 237161,385167 237192,385162 237202,385159 237214,
  385159 237227,385162 237241,385166 237256,385196 237324,385209 237345,385234 237375,
  385237 237383,385238 237399,385236 237407,385227 237419,385213 237430,385193 237439,
  385174 237451,385170 237455,385169 237460,385171 237475,385181 237503,385190 237521,
  385200 237533,385206 237538,385213 237541,385221 237542,385235 237540,385242 237541,
  385249 237544,385260 237555,385270 237570,385289 237584,385292 237589,385291 237596,385284 237630))',3438) 
  );

      st_createtopogeo
----------------------------
 Topology ri_topo populated
 
 
-- テーブルとTopoGeometryの生成 --
CREATE TABLE ri.roads(gid serial PRIMARY KEY, road_name text);

SELECT topology.AddTopoGeometryColumn('ri_topo', 'ri', 'roads', 'topo', 'LINE');
				</pre></div><div class="refsection" title="関連情報"><a name="id287175709"></a><h2>関連情報</h2><p><a class="xref" href="#AddTopoGeometryColumn" title="AddTopoGeometryColumn">AddTopoGeometryColumn</a>, <a class="xref" href="#CreateTopology" title="CreateTopology">CreateTopology</a>, <a class="xref" href="#DropTopology" title="DropTopology">DropTopology</a></p></div></div><div class="refentry" title="TopoGeo_AddPoint"><div class="refentry.separator"><hr></div><a name="TopoGeo_AddPoint"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>TopoGeo_AddPoint ? 
許容差を使って既存のトポロジにポイントを追加し、可能ならエッジを分割します。
				</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">TopoGeo_AddPoint</b>(</code>varchar  <var class="pdparam">toponame</var>, geometry  <var class="pdparam">apoint</var>, float8  <var class="pdparam">tolerance</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287175784"></a><h2>説明</h2><p>
既存のトポロジにポイントを追加し、その識別番号を返します。
指定されたポイントは、許容差の範囲内で既存のノードまたはエッジにスナップします。
既存のエッジはスナップされたポイントで分割されることがあります。
                </p><p>初出: 2.0.0</p></div><div class="refsection" title="関連情報"><a name="id287175801"></a><h2>関連情報</h2><p>
<a class="xref" href="#TopoGeo_AddLineString" title="TopoGeo_AddLineString">TopoGeo_AddLineString</a>,
<a class="xref" href="#TopoGeo_AddPolygon" title="TopoGeo_AddPolygon">TopoGeo_AddPolygon</a>,
<a class="xref" href="#AddNode" title="AddNode">AddNode</a>,
<a class="xref" href="#CreateTopology" title="CreateTopology">CreateTopology</a>
</p></div></div><div class="refentry" title="TopoGeo_AddLineString"><div class="refentry.separator"><hr></div><a name="TopoGeo_AddLineString"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>TopoGeo_AddLineString ? 
許容差を使って既存のトポロジにラインストリングを追加し、可能ならエッジ/フェイスを分割します。
				</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">TopoGeo_AddLineString</b>(</code>varchar  <var class="pdparam">toponame</var>, geometry  <var class="pdparam">aline</var>, float8  <var class="pdparam">tolerance</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287175881"></a><h2>説明</h2><p>
既存のトポロジにラインストリングを追加し、これを構成するエッジの識別番号の集合を返します。
指定されたラインは、許容差の範囲内で既存のノードまたはエッジにスナップします。
既存のエッジとフェイスはラインで分割されることがあります。
                </p><p>初出: 2.0.0</p></div><div class="refsection" title="関連情報"><a name="id287175899"></a><h2>関連情報</h2><p>
<a class="xref" href="#TopoGeo_AddPoint" title="TopoGeo_AddPoint">TopoGeo_AddPoint</a>,
<a class="xref" href="#TopoGeo_AddPolygon" title="TopoGeo_AddPolygon">TopoGeo_AddPolygon</a>,
<a class="xref" href="#AddEdge" title="AddEdge">AddEdge</a>,
<a class="xref" href="#CreateTopology" title="CreateTopology">CreateTopology</a>
				</p></div></div><div class="refentry" title="TopoGeo_AddPolygon"><div class="refentry.separator"><hr></div><a name="TopoGeo_AddPolygon"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>TopoGeo_AddPolygon ? 
許容差を使って既存のトポロジにポリゴンを追加し、可能ならエッジ/フェイスを分割します。
				</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">TopoGeo_AddPolygon</b>(</code>varchar  <var class="pdparam">atopology</var>, geometry  <var class="pdparam">aline</var>, float8  <var class="pdparam">atolerance</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287175979"></a><h2>説明</h2><p>
既存のトポロジにポリゴンを追加し、これを構成するフェイスの識別番号の集合を返します。
指定されたポリゴンの境界線は、許容差の範囲内で既存のノードまたはエッジにスナップします。
既存のエッジとフェイスはポリゴンの境界線で分割されることがあります。
                </p><p>初出: 2.0.0</p></div><div class="refsection" title="関連情報"><a name="id287175996"></a><h2>関連情報</h2><p>
<a class="xref" href="#TopoGeo_AddPoint" title="TopoGeo_AddPoint">TopoGeo_AddPoint</a>,
<a class="xref" href="#TopoGeo_AddLineString" title="TopoGeo_AddLineString">TopoGeo_AddLineString</a>,
<a class="xref" href="#AddFace" title="AddFace">AddFace</a>,
<a class="xref" href="#CreateTopology" title="CreateTopology">CreateTopology</a>
				</p></div></div></div><div class="sect1" title="11.5. トポロジエディタ"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Topology_Editing"></a>11.5. トポロジエディタ</h2></div><div><div class="abstract" title="概要"><p class="title"><b>概要</b></p><p>本節では、エッジ、フェイス、ノードの追加、移動、削除、分割に関する関数を挙げます。本節の関数はすべてISO SQL/MMで定義されています。</p></div></div></div></div><div class="toc"><dl><dt><span class="refentrytitle"><a href="#ST_AddIsoNode">ST_AddIsoNode</a></span><span class="refpurpose"> ? フェイスに孤立ノードを追加し、新しいノードの識別番号を返します。フェイスがNULLの場合でもノードは生成されます。</span></dt><dt><span class="refentrytitle"><a href="#ST_AddIsoEdge">ST_AddIsoEdge</a></span><span class="refpurpose"> ? <code class="varname">anode</code>と<code class="varname">anothernode</code>で指定される2つの既存孤立ノードを接続するトポロジに、ジオメトリ<code class="varname">aliestring</code>で定義される孤立エッジを追加し、新しいエッジの識別番号を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_AddEdgeNewFaces">ST_AddEdgeNewFaces</a></span><span class="refpurpose"> ? 新しいエッジを追加します。新しいエッジがフェイスを分割する場合には、もとのフェイスを削除して、分割した2つのフェイスに置き換えます。</span></dt><dt><span class="refentrytitle"><a href="#ST_AddEdgeModFace">ST_AddEdgeModFace</a></span><span class="refpurpose"> ? 新しいエッジを追加します。新しいエッジがフェイスを分割する場合には、もとのフェイスを編集し、1つのフェイスを追加します。</span></dt><dt><span class="refentrytitle"><a href="#ST_RemEdgeNewFace">ST_RemEdgeNewFace</a></span><span class="refpurpose"> ? 
エッジを削除し、消去対象エッジでフェイスが2つに分割されているなら、分割されているフェイスを削除し、1つのフェイスに置き換えます。
        </span></dt><dt><span class="refentrytitle"><a href="#ST_RemEdgeModFace">ST_RemEdgeModFace</a></span><span class="refpurpose"> ? 
エッジを削除し、削除対象エッジでフェイスが2つに分割されているなら、両方の空間をとるため、ひとつを削除して、もうひとつを編集します。
        </span></dt><dt><span class="refentrytitle"><a href="#ST_ChangeEdgeGeom">ST_ChangeEdgeGeom</a></span><span class="refpurpose"> ? 
Cトポロジ構造に影響を与えることなくエッジの形状を変更します。
				</span></dt><dt><span class="refentrytitle"><a href="#ST_ModEdgeSplit">ST_ModEdgeSplit</a></span><span class="refpurpose"> ? 既存のエッジに沿って新しいノードを生成してエッジを分割します。もとのエッジは変更され、エッジが1つ追加されます。</span></dt><dt><span class="refentrytitle"><a href="#ST_ModEdgeHeal">ST_ModEdgeHeal</a></span><span class="refpurpose"> ? 
2つのエッジについて、接続しているノードを削除して修復します。1番目のエッジを編集して、2番目のエッジを削除します。削除されたノードの識別番号を返します。
				</span></dt><dt><span class="refentrytitle"><a href="#ST_NewEdgeHeal">ST_NewEdgeHeal</a></span><span class="refpurpose"> ? 
2つのエッジについて、接続しているノードを削除して修復します。両方のエッジを削除し、1番目のエッジと同じ方向のエッジに置き換えます。
				</span></dt><dt><span class="refentrytitle"><a href="#ST_MoveIsoNode">ST_MoveIsoNode</a></span><span class="refpurpose"> ? トポロジ内の孤立ノードを別の位置に移動させます。新しい <code class="varname">apoint</code>ジオメトリがノードとして存在しているなら、エラーが投げられます。移動に関する記述を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_NewEdgesSplit">ST_NewEdgesSplit</a></span><span class="refpurpose"> ? 新しいノードを既存のエッジに沿って作成して、エッジを分割します。もとのエッジは削除され、2つのエッジに置き換えられます。2つの新しいエッジに接続する新しいノードの識別番号を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_RemoveIsoNode">ST_RemoveIsoNode</a></span><span class="refpurpose"> ? 孤立ノードを削除し、実行結果が返されます。ノードが孤立していない(エッジの始端または終端である)場合、例外が投げられます。</span></dt></dl></div><div class="refentry" title="ST_AddIsoNode"><a name="ST_AddIsoNode"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AddIsoNode ? フェイスに孤立ノードを追加し、新しいノードの識別番号を返します。フェイスがNULLの場合でもノードは生成されます。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_AddIsoNode</b>(</code>varchar  <var class="pdparam">atopology</var>, integer  <var class="pdparam">aface</var>, geometry  <var class="pdparam">apoint</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287176162"></a><h2>説明</h2><p><code class="varname">aface</code>の識別番号にあう既存のフェイスに対して、<code class="varname">apoint</code>で示された位置に孤立ノードを追加します。</p><p>ポイントジオメトリの空間参照系(SRID)がトポロジと同じでない場合、<code class="varname">apoint</code>がポイントジオメトリでない場合、ポイントがNULLである場合、または、ポイントが既存のエッジ(境界も含む)とインタセクトする場合には、例外が投げられます。また、ポイントが既にノードとして存在する場合、例外が投げられます。</p><p><code class="varname">aface</code> が NULL でなく、かつ <code class="varname">apoint</code> がフェイス内に無い場合、例外が投げられます。</p><p>初出: 1.? </p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM: Topo-Net Routines:  X+1.3.1</p></div><div class="refsection" title="例"><a name="id287176210"></a><h2>例</h2><p></p></div><div class="refsection" title="関連情報"><a name="id287176222"></a><h2>関連情報</h2><p><a class="xref" href="#AddNode" title="AddNode">AddNode</a>, <a class="xref" href="#CreateTopology" title="CreateTopology">CreateTopology</a>, <a class="xref" href="#DropTopology" title="DropTopology">DropTopology</a>, <a class="xref" href="#ST_Intersects" title="ST_Intersects">ST_Intersects</a></p></div></div><div class="refentry" title="ST_AddIsoEdge"><div class="refentry.separator"><hr></div><a name="ST_AddIsoEdge"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AddIsoEdge ? <code class="varname">anode</code>と<code class="varname">anothernode</code>で指定される2つの既存孤立ノードを接続するトポロジに、ジオメトリ<code class="varname">aliestring</code>で定義される孤立エッジを追加し、新しいエッジの識別番号を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_AddIsoEdge</b>(</code>varchar  <var class="pdparam">atopology</var>, integer  <var class="pdparam">anode</var>, integer  <var class="pdparam">anothernode</var>, geometry  <var class="pdparam">alinestring</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287176317"></a><h2>説明</h2><p><code class="varname">anode</code>と<code class="varname">anothernode</code>で指定される2つの既存孤立ノードを接続するトポロジに、ジオメトリ<code class="varname">aliestring</code>で定義される孤立エッジを追加し、新しいエッジの識別番号を返します。</p><p><code class="varname">alinestring</code>ジオメトリとトポロジとで空間参照系(SRID)が異なる場合、引数がNULLである場合、ノードが1つ以上のフェイスに含まれている場合、2つのノードが既存エッジの始端または終端である場合には、例外が投げられます。</p><p><code class="varname">alinestring</code>が<code class="varname">anode</code> と<code class="varname">anothernode</code>に属するフェイス内に無い場合、例外が投げられます。</p><p><code class="varname">anode</code>と<code class="varname">anothernode</code>が、<code class="varname">alinestring</code>の始端と終端でない場合は、例外が投げられます。</p><p>初出: 1.? </p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM: Topo-Geo and Topo-Net 3: Routine Details:  X.3.4</p></div><div class="refsection" title="例"><a name="id287176384"></a><h2>例</h2><p></p></div><div class="refsection" title="関連情報"><a name="id287176396"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AddIsoNode" title="ST_AddIsoNode">ST_AddIsoNode</a>,  <a class="xref" href="#ST_IsSimple" title="ST_IsSimple">ST_IsSimple</a>, <a class="xref" href="#ST_Within" title="ST_Within">ST_Within</a></p></div></div><div class="refentry" title="ST_AddEdgeNewFaces"><div class="refentry.separator"><hr></div><a name="ST_AddEdgeNewFaces"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AddEdgeNewFaces ? 新しいエッジを追加します。新しいエッジがフェイスを分割する場合には、もとのフェイスを削除して、分割した2つのフェイスに置き換えます。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_AddEdgeNewFaces</b>(</code>varchar  <var class="pdparam">atopology</var>, integer  <var class="pdparam">anode</var>, integer  <var class="pdparam">anothernode</var>, geometry  <var class="pdparam">acurve</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287176478"></a><h2>説明</h2><p>
新しいエッジを追加します。新しいエッジがフェイスを分割する場合には、もとのフェイスを削除して、分割した2つのフェイスに置き換えます。新しいエッジの識別番号を返します。
		</p><p>
この関数によって、既存の接続されているエッジとリレーションシップが更新されます。
		</p><p>引数がNULLの場合、与えられたノードが不明な場合(トポロジスキーマの<code class="varname">node</code>テーブル内に既に存在していなければなりません)、<code class="varname">acurve</code>が<code class="varname">LINESTRING</code>でない場合、<code class="varname">anode</code>と<code class="varname">anothernode</code>が始端、終端でない場合には、例外が投げられます。</p><p><code class="varname">acurve</code>ジオメトリの空間参照系 (SRID) がトポロジと同じでない場合、例外が投げられます。</p><p>初出: 2.0 </p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM: Topo-Geo and Topo-Net 3: Routine Details:  X.3.12</p></div><div class="refsection" title="例"><a name="id287176536"></a><h2>例</h2><p></p></div><div class="refsection" title="関連情報"><a name="id287176549"></a><h2>関連情報</h2><p><a class="xref" href="#ST_RemEdgeNewFace" title="ST_RemEdgeNewFace">ST_RemEdgeNewFace</a></p><p><a class="xref" href="#ST_AddEdgeModFace" title="ST_AddEdgeModFace">ST_AddEdgeModFace</a></p></div></div><div class="refentry" title="ST_AddEdgeModFace"><div class="refentry.separator"><hr></div><a name="ST_AddEdgeModFace"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AddEdgeModFace ? 新しいエッジを追加します。新しいエッジがフェイスを分割する場合には、もとのフェイスを編集し、1つのフェイスを追加します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_AddEdgeModFace</b>(</code>varchar  <var class="pdparam">atopology</var>, integer  <var class="pdparam">anode</var>, integer  <var class="pdparam">anothernode</var>, geometry  <var class="pdparam">acurve</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287176629"></a><h2>説明</h2><p>
新しいエッジを追加します。新しいエッジがフェイスを分割する場合には、もとのフェイスを編集し、1つのフェイスを追加します。分割されるフェイスがユニバーサルフェイスでないなら、追加されるフェイスは、追加されるエッジの右側にきます。新しく追加されたエッジの識別番号を返します。
		</p><p>
この関数によって、既存の接続されているエッジとリレーションシップが更新されます。
		</p><p>引数がNULLである場合、与えられたノードが不明である場合(トポロジスキーマの<code class="varname">node</code>テーブル内に既に存在していなければなりません)、<code class="varname">acurve</code>が<code class="varname">LINESTRING</code>でない場合、<code class="varname">anode</code>と<code class="varname">anothernode</code>が<code class="varname">acurve</code>の始端、終端でない場合、例外が投げられます。</p><p><code class="varname">acurve</code>ジオメトリの空間参照系(SRID)がトポロジと同じでない場合、例外が投げられます。</p><p>初出: 2.0 </p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM: Topo-Geo and Topo-Net 3: Routine Details:  X.3.13</p></div><div class="refsection" title="例"><a name="id287176689"></a><h2>例</h2><p></p></div><div class="refsection" title="関連情報"><a name="id287176701"></a><h2>関連情報</h2><p><a class="xref" href="#ST_RemEdgeModFace" title="ST_RemEdgeModFace">ST_RemEdgeModFace</a></p><p><a class="xref" href="#ST_AddEdgeNewFaces" title="ST_AddEdgeNewFaces">ST_AddEdgeNewFaces</a></p></div></div><div class="refentry" title="ST_RemEdgeNewFace"><div class="refentry.separator"><hr></div><a name="ST_RemEdgeNewFace"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_RemEdgeNewFace ? 
エッジを削除し、消去対象エッジでフェイスが2つに分割されているなら、分割されているフェイスを削除し、1つのフェイスに置き換えます。
        </p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_RemEdgeNewFace</b>(</code>varchar  <var class="pdparam">atopology</var>, integer  <var class="pdparam">anedge</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287176764"></a><h2>説明</h2><p>
エッジを削除し、消去対象エッジでフェイスが2つに分割されているなら、分割されているフェイスを削除し、1つのフェイスに置き換えます。
		            </p><p>
新しく作成されたフェイスの識別番号を返し、新しいフェイスが生成されない場合はNULLを返します。
削除対象エッジがダングルである(訳注: 「ぶらさがる」状態、すなわち一方の端が孤立ノードでなく、かつもう一方が孤立ノード)場合か、孤立している場合か、
ユニバースフェイスとの境界になっている(おそらく反対側のフェイスにユニバースが侵入します)場合には、フェイスは生成されません。
		            </p><p>
この関数によって、既存の接続されているエッジとリレーションシップが更新されます。
		            </p><p>
既存のTopoGeometryの定義に入り込んでいるエッジは削除を拒絶されます。TopoGeometryが2つのフェイスのうちひとつだけで定義されている(かつ他方は定義に使われていない)場合、2つのフェイスの修復は拒絶されます。
		            </p><p>
引数がNULLである場合、与えられたエッジが不明である場合(トポロジスキーマの<code class="varname">edge</code>テーブル内に既に存在していなければなりません)、トポロジ名が不正である場合、例外が投げられます。
                </p><p>初出: 2.0 </p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM: Topo-Geo and Topo-Net 3: Routine Details:  X.3.14</p></div><div class="refsection" title="例"><a name="id287176843"></a><h2>例</h2><p></p></div><div class="refsection" title="関連情報"><a name="id287176856"></a><h2>関連情報</h2><p><a class="xref" href="#ST_RemEdgeModFace" title="ST_RemEdgeModFace">ST_RemEdgeModFace</a></p><p><a class="xref" href="#ST_AddEdgeNewFaces" title="ST_AddEdgeNewFaces">ST_AddEdgeNewFaces</a></p></div></div><div class="refentry" title="ST_RemEdgeModFace"><div class="refentry.separator"><hr></div><a name="ST_RemEdgeModFace"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_RemEdgeModFace ? 
エッジを削除し、削除対象エッジでフェイスが2つに分割されているなら、両方の空間をとるため、ひとつを削除して、もうひとつを編集します。
        </p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_RemEdgeModFace</b>(</code>varchar  <var class="pdparam">atopology</var>, integer  <var class="pdparam">anedge</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287176919"></a><h2>説明</h2><p>
エッジを削除し、削除対象エッジでフェイスが2つに分割されているなら、両方の空間をとるため、ひとつを削除して、もうひとつを編集します。ST_AddEdgeModFaceと対称となるよう、右側のフェイスを優先して保持します。削除対象エッジの代わりに残存するフェイスの識別番号を返します。
		            </p><p>
この関数によって、既存の接続されているエッジとリレーションシップが更新されます。
		            </p><p>
既存のTopoGeometryの定義に入り込んでいるエッジは削除を拒絶されます。TopoGeometryが2つのフェイスのうちひとつだけで定義されている(かつ他方は定義に使われていない)場合、2つのフェイスの修復は拒絶されます。
		            </p><p>
引数がNULLである場合、与えられたエッジが不明である場合(トポロジスキーマの<code class="varname">edge</code>テーブル内に既に存在していなければなりません)、トポロジ名が不正である場合、例外が投げられます。
                </p><p>初出: 2.0 </p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM: Topo-Geo and Topo-Net 3: Routine Details:  X.3.15</p></div><div class="refsection" title="例"><a name="id287176961"></a><h2>例</h2><p></p></div><div class="refsection" title="関連情報"><a name="id287176973"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AddEdgeModFace" title="ST_AddEdgeModFace">ST_AddEdgeModFace</a></p><p><a class="xref" href="#ST_RemEdgeNewFace" title="ST_RemEdgeNewFace">ST_RemEdgeNewFace</a></p></div></div><div class="refentry" title="ST_ChangeEdgeGeom"><div class="refentry.separator"><hr></div><a name="ST_ChangeEdgeGeom"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ChangeEdgeGeom ? 
Cトポロジ構造に影響を与えることなくエッジの形状を変更します。
				</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_ChangeEdgeGeom</b>(</code>varchar  <var class="pdparam">atopology</var>, integer  <var class="pdparam">anedge</var>, geometry  <var class="pdparam">acurve</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287180390"></a><h2>説明</h2><p>
トポロジ構造に影響を与えることなくエッジの形状を変更します。
		</p><p>
引数がNULLである場合、与えられたエッジがトポロジスキーマの<code class="varname">node</code>テーブル内に既に存在していない場合、<code class="varname">acurve</code>が<code class="varname">LINESTRING</code>でない場合、<code class="varname">anode</code>と<code class="varname">anothernode</code>が<code class="varname">acurve</code>の始端と終端でない場合、更新によって下位にあるトポロジが変更される場合は、エラーが投げられます。
                </p><p><code class="varname">acurve</code> ジオメトリに空間参照系 (SRID) が、トポロジと違っている場合、例外が投げられます。</p><p>新しい <code class="varname">acurve</code> が単純でない場合、エラーが投げられます。</p><p>古い位置から新しい位置へのエッジ移動で障害物にあたった場合はエラーが投げられます。</p><p>初出: 1.1.0</p><p>
	機能強化: 2.0.0版で、トポロジ整合性の強制を追加しました。
		</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM: Topo-Geo and Topo-Net 3: Routine Details X.3.6</p></div><div class="refsection" title="例"><a name="id287180464"></a><h2>例</h2><pre class="programlisting">SELECT topology.ST_ChangeEdgeGeom('ma_topo', 1,  
		ST_GeomFromText('LINESTRING(227591.9 893900.4,227622.6 893844.3,227641.6 893816.6, 227704.5 893778.5)', 26986) );
 ----
 Edge 1 changed</pre></div><div class="refsection" title="関連情報"><a name="id287180476"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AddEdgeModFace" title="ST_AddEdgeModFace">ST_AddEdgeModFace</a></p><p><a class="xref" href="#ST_RemEdgeModFace" title="ST_RemEdgeModFace">ST_RemEdgeModFace</a></p><p><a class="xref" href="#ST_ModEdgeSplit" title="ST_ModEdgeSplit">ST_ModEdgeSplit</a></p></div></div><div class="refentry" title="ST_ModEdgeSplit"><div class="refentry.separator"><hr></div><a name="ST_ModEdgeSplit"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ModEdgeSplit ? 既存のエッジに沿って新しいノードを生成してエッジを分割します。もとのエッジは変更され、エッジが1つ追加されます。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_ModEdgeSplit</b>(</code>varchar  <var class="pdparam">atopology</var>, integer  <var class="pdparam">anedge</var>, geometry  <var class="pdparam">apoint</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287180552"></a><h2>説明</h2><p>
既存のエッジに沿って新しいノードを生成してエッジを分割します。もとのエッジは変更され、エッジが1つ追加されます。この関数によって、既存の接続されているエッジとリレーションシップが更新されます。
		</p><p>初出: 1.? </p><p>変更: 2.0 - 以前の版では名前を間違えてST_ModEdgesSplitになっていました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM: Topo-Geo and Topo-Net 3: Routine Details:  X.3.9</p></div><div class="refsection" title="例"><a name="id287180891"></a><h2>例</h2><pre class="programlisting">
-- エッジの追加 --
 SELECT topology.AddEdge('ma_topo', ST_GeomFromText('LINESTRING(227592 893910, 227600 893910)', 26986) ) As edgeid;
 
-- エッジ識別番号 --
3


-- エッジの分割 --
SELECT topology.ST_ModEdgeSplit('ma_topo',  3, ST_SetSRID(ST_Point(227594,893910),26986)  ) As result;
         result
-------------------------
7
</pre></div><div class="refsection" title="関連情報"><a name="id287180904"></a><h2>関連情報</h2><p>
				<a class="xref" href="#ST_NewEdgesSplit" title="ST_NewEdgesSplit">ST_NewEdgesSplit</a>,
				<a class="xref" href="#ST_ModEdgeHeal" title="ST_ModEdgeHeal">ST_ModEdgeHeal</a>,
				<a class="xref" href="#ST_NewEdgeHeal" title="ST_NewEdgeHeal">ST_NewEdgeHeal</a>,
				<a class="xref" href="#AddEdge" title="AddEdge">AddEdge</a>
				</p></div></div><div class="refentry" title="ST_ModEdgeHeal"><div class="refentry.separator"><hr></div><a name="ST_ModEdgeHeal"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ModEdgeHeal ? 
2つのエッジについて、接続しているノードを削除して修復します。1番目のエッジを編集して、2番目のエッジを削除します。削除されたノードの識別番号を返します。
				</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">int <b class="fsfunc">ST_ModEdgeHeal</b>(</code>varchar  <var class="pdparam">atopology</var>, integer  <var class="pdparam">anedge</var>, integer  <var class="pdparam">anotheredge</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287180983"></a><h2>説明</h2><p>
2つのエッジについて、接続しているノードを削除して修復します。1番目のエッジを編集して、2番目のエッジを削除します。削除されたノードの識別番号を返します。この関数によって、既存の接続されているエッジとリレーションシップが更新されます。
		</p><p>初出: 2.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM: Topo-Geo and Topo-Net 3: Routine Details:  X.3.9</p></div><div class="refsection" title="関連情報"><a name="id287181014"></a><h2>関連情報</h2><p>
				<a class="xref" href="#ST_ModEdgeSplit" title="ST_ModEdgeSplit">ST_ModEdgeSplit</a>
				<a class="xref" href="#ST_NewEdgesSplit" title="ST_NewEdgesSplit">ST_NewEdgesSplit</a>
				</p></div></div><div class="refentry" title="ST_NewEdgeHeal"><div class="refentry.separator"><hr></div><a name="ST_NewEdgeHeal"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_NewEdgeHeal ? 
2つのエッジについて、接続しているノードを削除して修復します。両方のエッジを削除し、1番目のエッジと同じ方向のエッジに置き換えます。
				</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">int <b class="fsfunc">ST_NewEdgeHeal</b>(</code>varchar  <var class="pdparam">atopology</var>, integer  <var class="pdparam">anedge</var>, integer  <var class="pdparam">anotheredge</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287181086"></a><h2>説明</h2><p>
2つのエッジについて、接続しているノードを削除して修復します。両方のエッジを削除し、1番目のエッジと同じ方向のエッジに置き換えます。
修復されたエッジに置き換えられた新しいエッジの識別番号を返します。
この関数によって、既存の接続されているエッジとリレーションシップが更新されます。
		</p><p>初出: 2.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM: Topo-Geo and Topo-Net 3: Routine Details:  X.3.9</p></div><div class="refsection" title="関連情報"><a name="id287181116"></a><h2>関連情報</h2><p>
				<a class="xref" href="#ST_ModEdgeHeal" title="ST_ModEdgeHeal">ST_ModEdgeHeal</a>
				<a class="xref" href="#ST_ModEdgeSplit" title="ST_ModEdgeSplit">ST_ModEdgeSplit</a>
				<a class="xref" href="#ST_NewEdgesSplit" title="ST_NewEdgesSplit">ST_NewEdgesSplit</a>
				</p></div></div><div class="refentry" title="ST_MoveIsoNode"><div class="refentry.separator"><hr></div><a name="ST_MoveIsoNode"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MoveIsoNode ? トポロジ内の孤立ノードを別の位置に移動させます。新しい <code class="varname">apoint</code>ジオメトリがノードとして存在しているなら、エラーが投げられます。移動に関する記述を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_MoveIsoNode</b>(</code>varchar  <var class="pdparam">atopology</var>, integer  <var class="pdparam">anedge</var>, geometry  <var class="pdparam">apoint</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287181264"></a><h2>説明</h2><p>トポロジ内の孤立ノードを別の位置に移動させます。新しい<code class="varname">apoint</code>ジオメトリがノードとして存在しているなら、エラーが投げられます。</p><p>引数が NULL である場合、<code class="varname">apoint</code>がポイントでない場合、既存のノードが孤立していない(既存エッジの始端または終端)場合、
新しいノード位置が既存のエッジとインタセクトする(終端も含む)場合、例外が投げられます。</p><p>ポイントジオメトリの空間参照系(SRID)がトポロジと異なる場合には、例外が投げられます。</p><p>初出: 1.? </p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM: Topo-Net Routines:  X.3.2</p></div><div class="refsection" title="例"><a name="id287181306"></a><h2>例</h2><pre class="programlisting">
-- フェイス指定のない孤立ノードを追加 --
SELECT topology.ST_AddIsoNode('ma_topo',  NULL, ST_GeomFromText('POINT(227579 893916)', 26986) ) As nodeid;
 nodeid
--------
      7
-- 新しいノードの移動 --
SELECT topology.ST_MoveIsoNode('ma_topo', 7,  ST_GeomFromText('POINT(227579.5 893916.5)', 26986) ) As descrip; 
                      descrip
----------------------------------------------------
Isolated Node 7 moved to location 227579.5,893916.5</pre></div><div class="refsection" title="関連情報"><a name="id287181319"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AddIsoNode" title="ST_AddIsoNode">ST_AddIsoNode</a></p></div></div><div class="refentry" title="ST_NewEdgesSplit"><div class="refentry.separator"><hr></div><a name="ST_NewEdgesSplit"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_NewEdgesSplit ? 新しいノードを既存のエッジに沿って作成して、エッジを分割します。もとのエッジは削除され、2つのエッジに置き換えられます。2つの新しいエッジに接続する新しいノードの識別番号を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_NewEdgesSplit</b>(</code>varchar  <var class="pdparam">atopology</var>, integer  <var class="pdparam">anedge</var>, geometry  <var class="pdparam">apoint</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287181386"></a><h2>説明</h2><p>
<code class="varname">anedge</code> で指定される既存のエッジに沿った <code class="varname">apoint</code> の位置に新しいノードを作成して、エッジを分割します。もとのエッジは削除され、2つのエッジに置き換えられます。2つの新しいエッジに接続する新しいノードの識別番号を返します。この関数によって、既存の接続されているエッジとリレーションシップが更新されます。
		</p><p>ポイントジオメトリの空間参照系(SRID)がトポロジと異なる場合、<code class="varname">apoint</code>がポイントジオメトリでない場合、ポイントがNULLの場合、ポイントが既にノードとして存在する場合、エッジが既存のエッジと一致しない場合、ポイントがエッジ内にない場合、例外が投げられます。</p><p>初出: 1.? </p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM: Topo-Net Routines:  X.3.8</p></div><div class="refsection" title="例"><a name="id287181428"></a><h2>例</h2><pre class="programlisting">
-- エッジの追加  --
SELECT topology.AddEdge('ma_topo', ST_GeomFromText('LINESTRING(227575 893917,227592 893900)', 26986) ) As edgeid;
-- 結果 --
edgeid
------
	2
-- 新しいエッジの分割 --
SELECT topology.ST_NewEdgesSplit('ma_topo', 2,  ST_GeomFromText('POINT(227578.5 893913.5)', 26986) ) As newnodeid; 
 newnodeid
---------
       6</pre></div><div class="refsection" title="関連情報"><a name="id287181441"></a><h2>関連情報</h2><p>
				<a class="xref" href="#ST_ModEdgeSplit" title="ST_ModEdgeSplit">ST_ModEdgeSplit</a>
				<a class="xref" href="#ST_ModEdgeHeal" title="ST_ModEdgeHeal">ST_ModEdgeHeal</a>
				<a class="xref" href="#ST_NewEdgeHeal" title="ST_NewEdgeHeal">ST_NewEdgeHeal</a>
				<a class="xref" href="#AddEdge" title="AddEdge">AddEdge</a>
				</p></div></div><div class="refentry" title="ST_RemoveIsoNode"><div class="refentry.separator"><hr></div><a name="ST_RemoveIsoNode"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_RemoveIsoNode ? 孤立ノードを削除し、実行結果が返されます。ノードが孤立していない(エッジの始端または終端である)場合、例外が投げられます。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_RemoveIsoNode</b>(</code>varchar  <var class="pdparam">atopology</var>, integer  <var class="pdparam">anode</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287181511"></a><h2>説明</h2><p>孤立ノードを削除し、実行結果が返されます。ノードが孤立していない(エッジの始端または終端である)場合、例外が投げられます。</p><p>初出: 1.? </p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM: Topo-Geo and Topo-Net 3: Routine Details:  X+1.3.3</p></div><div class="refsection" title="例"><a name="id287181539"></a><h2>例</h2><pre class="programlisting">
-- フェイス指定のない孤立ノードの追加 --
SELECT topology.ST_RemoveIsoNode('ma_topo',  7 ) As result;
         result
-------------------------
 Isolated node 7 removed
</pre></div><div class="refsection" title="関連情報"><a name="id287181553"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AddIsoNode" title="ST_AddIsoNode">ST_AddIsoNode</a></p></div></div></div><div class="sect1" title="11.6. トポロジアクセサ"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Topology_Accessors"></a>11.6. トポロジアクセサ</h2></div></div></div><div class="toc"><dl><dt><span class="refentrytitle"><a href="#GetEdgeByPoint">GetEdgeByPoint</a></span><span class="refpurpose"> ? 与えられたポイントにインタセクトするエッジの識別番号を探索します。</span></dt><dt><span class="refentrytitle"><a href="#GetFaceByPoint">GetFaceByPoint</a></span><span class="refpurpose"> ? 与えられたポイントにインタセクトするフェイスの識別番号を探索します。</span></dt><dt><span class="refentrytitle"><a href="#GetNodeByPoint">GetNodeByPoint</a></span><span class="refpurpose"> ? ポイント位置にあるノードの識別番号を探索します。</span></dt><dt><span class="refentrytitle"><a href="#GetTopologyID">GetTopologyID</a></span><span class="refpurpose"> ? トポロジ名からtopology.topologyテーブル内にあるトポロジの識別番号を返します。</span></dt><dt><span class="refentrytitle"><a href="#GetTopologySRID">GetTopologySRID</a></span><span class="refpurpose"> ? トポロジ名からtopology.topologyテーブル内にあるトポロジのSRIDを返します。</span></dt><dt><span class="refentrytitle"><a href="#GetTopologyName">GetTopologyName</a></span><span class="refpurpose"> ? 識別番号からトポロジ(スキーマ)の名前を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_GetFaceEdges">ST_GetFaceEdges</a></span><span class="refpurpose"> ? 順序番号を含む、<code class="varname">aface</code>の境界となる、整列したエッジの集合を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_GetFaceGeometry">ST_GetFaceGeometry</a></span><span class="refpurpose"> ? 指定されたトポロジの中の、フェイス識別番号で指定されたポリゴンを返します。</span></dt><dt><span class="refentrytitle"><a href="#GetRingEdges">GetRingEdges</a></span><span class="refpurpose"> ? 
与えられたエッジで環を形成するエッジの集合を整列して返します。
				</span></dt><dt><span class="refentrytitle"><a href="#GetNodeEdges">GetNodeEdges</a></span><span class="refpurpose"> ? 
与えられたノードへのエッジのインシデンスの集合を整列して返します。
				</span></dt></dl></div><div class="refentry" title="GetEdgeByPoint"><a name="GetEdgeByPoint"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>GetEdgeByPoint ? 与えられたポイントにインタセクトするエッジの識別番号を探索します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">GetEdgeByPoint</b>(</code>varchar  <var class="pdparam">atopology</var>, geometry  <var class="pdparam">apoint</var>, float8  <var class="pdparam">tol</var><code>)</code>;</p></div></div><div class="refsection"><a name="id287181661"></a><p>与えられたポイントにインタセクトするエッジの識別番号を探索します</p><p>この関数は、与えられたトポロジ、ポイント、許容差を引数にして、整数(エッジの識別番号)を返します。許容差が0の場合、ポイントはエッジとインタセクトしていなければなりません。</p><p>ポイントがノードの位置である場合、例外が投げられます。 これを避けるには、GetNodeByPoint関数を実行してください</p><p>ポイントがエッジにインタセクトしない場合には0を返します。</p><p>許容差を0より大きくして、ポイント付近のエッジが1つより多い場合、例外が投げられます。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>許容差が0の場合はST_Intersectsを使い、それ以外ではST_DWinthinを使います。</p></td></tr></table></div><p>初出: 2.0.0 - GEOS 3.3.0以上が必要 </p></div><div class="refsection" title="例"><a name="id287181696"></a><h2>例</h2><p>本例では<a class="xref" href="#AddEdge" title="AddEdge">AddEdge</a>で作ったエッジを使います。</p><pre class="programlisting">SELECT topology.GetEdgeByPoint('ma_topo',geom, 1) As with1mtol, topology.GetEdgeByPoint('ma_topo',geom,0) As withnotol
FROM ST_GeomFromEWKT('SRID=26986;POINT(227622.6 893843)') As geom;
 with1mtol | withnotol
-----------+-----------
         2 |         0
</pre><pre class="programlisting">SELECT topology.GetEdgeByPoint('ma_topo',geom, 1) As nearnode
FROM ST_GeomFromEWKT('SRID=26986;POINT(227591.9 893900.4)') As geom;

-- エラー発生 --
ERROR:  Two or more edges found</pre></div><div class="refsection" title="関連情報"><a name="id287181719"></a><h2>関連情報</h2><p><a class="xref" href="#AddEdge" title="AddEdge">AddEdge</a>, <a class="xref" href="#GetNodeByPoint" title="GetNodeByPoint">GetNodeByPoint</a></p></div></div><div class="refentry" title="GetFaceByPoint"><div class="refentry.separator"><hr></div><a name="GetFaceByPoint"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>GetFaceByPoint ? 与えられたポイントにインタセクトするフェイスの識別番号を探索します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">GetFaceByPoint</b>(</code>varchar  <var class="pdparam">atopology</var>, geometry  <var class="pdparam">apoint</var>, float8  <var class="pdparam">tol</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287181995"></a><h2>説明</h2><p>与えられたポイントにインタセクトするフェイスの識別番号を探索します。</p><p>この関数は、与えられたトポロジ、ポイント、許容差を引数にして、整数(フェイスの識別番号)を返します。許容差が0の場合、ポイントはフェイスとインタセクトしていなければなりません。</p><p>ポイントがノードの位置である場合、例外が投げられます。 これを避けるには、GetNodeByPoint関数を実行してください。</p><p>ポイントがフェイスにインタセクトしない場合には0を返します。</p><p>許容差を0より大きくして、ポイント付近のフェイスが1つより多い場合、例外が投げられます。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>許容差が0の場合はST_Intersectsを使い、それ以外ではST_DWinthinを使います。</p></td></tr></table></div><p>初出: 2.0.0 - GEOS 3.3.0以上が必要 </p></div><div class="refsection" title="例"><a name="id287182032"></a><h2>例</h2><p>本例では<a class="xref" href="#AddFace" title="AddFace">AddFace</a>で作ったフェイスを使います。</p><pre class="programlisting">SELECT topology.GetFaceByPoint('ma_topo',geom, 10) As with1mtol, topology.GetFaceByPoint('ma_topo',geom,0) As withnotol
	FROM ST_GeomFromEWKT('POINT(234604.6 899382.0)') As geom;
	
	 with1mtol | withnotol
	-----------+-----------
			 1 |         0</pre><pre class="programlisting">SELECT topology.GetFaceByPoint('ma_topo',geom, 1) As nearnode
	FROM ST_GeomFromEWKT('POINT(227591.9 893900.4)') As geom;
	
-- get error --
ERROR:  Two or more faces found</pre></div><div class="refsection" title="関連情報"><a name="id287182055"></a><h2>関連情報</h2><p><a class="xref" href="#AddFace" title="AddFace">AddFace</a>, <a class="xref" href="#GetNodeByPoint" title="GetNodeByPoint">GetNodeByPoint</a>, <a class="xref" href="#GetEdgeByPoint" title="GetEdgeByPoint">GetEdgeByPoint</a></p></div></div><div class="refentry" title="GetNodeByPoint"><div class="refentry.separator"><hr></div><a name="GetNodeByPoint"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>GetNodeByPoint ? ポイント位置にあるノードの識別番号を探索します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">GetNodeByPoint</b>(</code>varchar  <var class="pdparam">atopology</var>, geometry  <var class="pdparam">point</var>, float8  <var class="pdparam">tol</var><code>)</code>;</p></div></div><div class="refsection" title="ポイント位置にあるノードの識別番号を探索します。"><a name="id287182129"></a><h2>ポイント位置にあるノードの識別番号を探索します。</h2><p>この関数は、与えられたトポロジ、ポイント、許容差を引数にして、整数 (ノードの識別番号) を返します。許容差が0の場合は完全にインタセクトしているかで判断し、他の場合はある程度の間隔で探索します。</p><p>ポイントで指定した位置にノードが無い場合は0を返します。</p><p>許容差を0より大きくして、ポイント付近のノードが1つより多い場合、例外が投げられます。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>許容差が0の場合はST_Intersectsを使い、それ以外ではST_DWinthinを使います。</p></td></tr></table></div><p>初出: 2.0.0 - GEOS 3.3.0以上が必要 </p></div><div class="refsection" title="例"><a name="id287182161"></a><h2>例</h2><p>本例では<a class="xref" href="#AddEdge" title="AddEdge">AddEdge</a>で作ったエッジを使います。</p><pre class="programlisting">SELECT topology.GetNodeByPoint('ma_topo',geom, 1) As nearnode 
 FROM ST_GeomFromEWKT('SRID=26986;POINT(227591.9 893900.4)') As geom;
  nearnode
----------
        2
 </pre><pre class="programlisting">SELECT topology.GetNodeByPoint('ma_topo',geom, 1000) As too_much_tolerance
 FROM ST_GeomFromEWKT('SRID=26986;POINT(227591.9 893900.4)') As geom;
 
 ---- エラー発生 --
 ERROR:  Two or more nodes found
 </pre></div><div class="refsection" title="関連情報"><a name="id287182184"></a><h2>関連情報</h2><p><a class="xref" href="#AddEdge" title="AddEdge">AddEdge</a>, <a class="xref" href="#GetEdgeByPoint" title="GetEdgeByPoint">GetEdgeByPoint</a></p></div></div><div class="refentry" title="GetTopologyID"><div class="refentry.separator"><hr></div><a name="GetTopologyID"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>GetTopologyID ? トポロジ名からtopology.topologyテーブル内にあるトポロジの識別番号を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">GetTopologyID</b>(</code>varchar <var class="pdparam">toponame</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287182272"></a><h2>説明</h2><p>トポロジ名から topology.topology テーブル内にあるトポロジの識別番号を返します。</p><p>初出: 1.?</p></div><div class="refsection" title="例"><a name="id287182286"></a><h2>例</h2><pre class="programlisting">SELECT topology.GetTopologyID('ma_topo') As topo_id;
 topo_id
---------
       1</pre></div><div class="refsection" title="関連情報"><a name="id287182299"></a><h2>関連情報</h2><p>
	<a class="xref" href="#CreateTopology" title="CreateTopology">CreateTopology</a>,
	<a class="xref" href="#DropTopology" title="DropTopology">DropTopology</a>,
	<a class="xref" href="#GetTopologyName" title="GetTopologyName">GetTopologyName</a>,
	<a class="xref" href="#GetTopologySRID" title="GetTopologySRID">GetTopologySRID</a>
				</p></div></div><div class="refentry" title="GetTopologySRID"><div class="refentry.separator"><hr></div><a name="GetTopologySRID"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>GetTopologySRID ? トポロジ名からtopology.topologyテーブル内にあるトポロジのSRIDを返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">GetTopologyID</b>(</code>varchar <var class="pdparam">toponame</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287182361"></a><h2>説明</h2><p>与えられたトポロジ名からtopology.topologyテーブル内のトポロジの空間参照系識別番号を返します。</p><p>初出: 2.0.0</p></div><div class="refsection" title="例"><a name="id287182411"></a><h2>例</h2><pre class="programlisting">SELECT topology.GetTopologySRID('ma_topo') As SRID;
 SRID
-------
  4326</pre></div><div class="refsection" title="関連情報"><a name="id287182424"></a><h2>関連情報</h2><p>
	<a class="xref" href="#CreateTopology" title="CreateTopology">CreateTopology</a>,
	<a class="xref" href="#DropTopology" title="DropTopology">DropTopology</a>,
	<a class="xref" href="#GetTopologyName" title="GetTopologyName">GetTopologyName</a>,
	<a class="xref" href="#GetTopologyID" title="GetTopologyID">GetTopologyID</a>
				</p></div></div><div class="refentry" title="GetTopologyName"><div class="refentry.separator"><hr></div><a name="GetTopologyName"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>GetTopologyName ? 識別番号からトポロジ(スキーマ)の名前を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">varchar <b class="fsfunc">GetTopologyName</b>(</code>integer <var class="pdparam">topology_id</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287182486"></a><h2>説明</h2><p>識別番号からトポロジ(スキーマ)の名前を返します。</p><p>初出: 1.?</p></div><div class="refsection" title="例"><a name="id287182501"></a><h2>例</h2><pre class="programlisting">SELECT topology.GetTopologyName(1) As topo_name;
 topo_name
-----------
 ma_topo</pre></div><div class="refsection" title="関連情報"><a name="id287182514"></a><h2>関連情報</h2><p>
	<a class="xref" href="#CreateTopology" title="CreateTopology">CreateTopology</a>,
	<a class="xref" href="#DropTopology" title="DropTopology">DropTopology</a>,
	<a class="xref" href="#GetTopologyID" title="GetTopologyID">GetTopologyID</a>,
	<a class="xref" href="#GetTopologySRID" title="GetTopologySRID">GetTopologySRID</a>
				</p></div></div><div class="refentry" title="ST_GetFaceEdges"><div class="refentry.separator"><hr></div><a name="ST_GetFaceEdges"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_GetFaceEdges ? 順序番号を含む、<code class="varname">aface</code>の境界となる、整列したエッジの集合を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">getfaceedges_returntype <b class="fsfunc">ST_GetFaceEdges</b>(</code>varchar  <var class="pdparam">atopology</var>, integer  <var class="pdparam">aface</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287182587"></a><h2>説明</h2><p>順序番号を含む、<code class="varname">aface</code>の境界となる、整列したエッジの集合を返します。それぞれの出力は、順序番号とエッジ識別番号からなります。順序番号は1から始まります。</p><p>
それぞれの環エッジは最小の識別番号から始まります。
		</p><p>初出: 2.0 </p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3 Topo-Geo and Topo-Net 3: Routine Details: X.3.5</p></div><div class="refsection" title="例"><a name="id287182725"></a><h2>例</h2><pre class="programlisting">
-- 1番フェイスの境界を返します。
SELECT (topology.ST_GetFaceEdges('tt', 1)).*;
-- result --
 sequence | edge
----------+------
        1 |   -4
        2 |    5
        3 |    7
        4 |   -6
        5 |    1
        6 |    2
        7 |    3
(7 rows)
</pre><pre class="programlisting">
-- 1番フェイスの境界となるエッジの
-- 順序番号、識別番号とジオメトリが返ります。
-- ジオメトリと順序番号が欲しいだけならST_GetFaceGeometryを使います。
SELECT t.seq, t.edge, geom
FROM topology.ST_GetFaceEdges('tt',1) As t(seq,edge)
	INNER JOIN tt.edge AS e ON abs(t.edge) = e.edge_id;
</pre></div><div class="refsection" title="関連情報"><a name="id287182742"></a><h2>関連情報</h2><p>
<a class="xref" href="#GetRingEdges" title="GetRingEdges">GetRingEdges</a>,
<a class="xref" href="#AddFace" title="AddFace">AddFace</a>,
<a class="xref" href="#ST_GetFaceGeometry" title="ST_GetFaceGeometry">ST_GetFaceGeometry</a>
				</p></div></div><div class="refentry" title="ST_GetFaceGeometry"><div class="refentry.separator"><hr></div><a name="ST_GetFaceGeometry"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_GetFaceGeometry ? 指定されたトポロジの中の、フェイス識別番号で指定されたポリゴンを返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_GetFaceGeometry</b>(</code>varchar  <var class="pdparam">atopology</var>, integer  <var class="pdparam">aface</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287182843"></a><h2>説明</h2><p>指定されたトポロジの中の、フェイス識別番号で指定されたポリゴンを返します。フェイスを作るエッジからポリゴンを構築します。</p><p>初出: 1.? </p><p><span class="inlinemediaobject"><img src="images/check.png"></span> このメソッドはSQL/MM仕様の実装です。 SQL-MM 3 Topo-Geo and Topo-Net 3: Routine Details: X.3.16</p></div><div class="refsection" title="例"><a name="id287182871"></a><h2>例</h2><pre class="programlisting">
-- AddFaceで追加したポリゴンのWKTを返します。
SELECT ST_AsText(topology.ST_GetFaceGeometry('ma_topo', 1)) As facegeomwkt;
-- 結果 --
               facegeomwkt

--------------------------------------------------------------------------------
 POLYGON((234776.9 899563.7,234896.5 899456.7,234914 899436.4,234946.6 899356.9,
234872.5 899328.7,234891 899285.4,234992.5 899145,234890.6 899069,
234755.2 899255.4,234612.7 899379.4,234776.9 899563.7)) 
</pre></div><div class="refsection" title="関連情報"><a name="id287182885"></a><h2>関連情報</h2><p><a class="xref" href="#AddFace" title="AddFace">AddFace</a></p></div></div><div class="refentry" title="GetRingEdges"><div class="refentry.separator"><hr></div><a name="GetRingEdges"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>GetRingEdges ? 
与えられたエッジで環を形成するエッジの集合を整列して返します。
				</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">getfaceedges_returntype <b class="fsfunc">GetRingEdges</b>(</code>varchar  <var class="pdparam">atopology</var>, integer  <var class="pdparam">aring</var>, integer  <var class="pdparam">max_edges=null</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287183090"></a><h2>説明</h2><p>
与えられたエッジで環を形成するエッジの集合を整列して返します。
出力は、連続する、正負符号を持つエッジ識別番号からなります。
連続番号は1始まりです。
エッジ識別番号が負の場合、与えられたエッジは後方に向かうことを意味しています。
後ろ向きに歩きはじめるために負数のエッジを使うことができます。
		</p><p>
<code class="varname">max_edges</code>がNULLでないとき、返されるレコードを超えることはありません。これは、不正なトポロジを扱うときの安全確保のためのパラメータであることを意味します。
		</p><p>初出: 2.0 </p></div><div class="refsection" title="関連情報"><a name="id287183113"></a><h2>関連情報</h2><p>
<a class="xref" href="#ST_GetFaceEdges" title="ST_GetFaceEdges">ST_GetFaceEdges</a>,
<a class="xref" href="#GetNodeEdges" title="GetNodeEdges">GetNodeEdges</a>
				</p></div></div><div class="refentry" title="GetNodeEdges"><div class="refentry.separator"><hr></div><a name="GetNodeEdges"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>GetNodeEdges ? 
与えられたノードへのエッジのインシデンスの集合を整列して返します。
				</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">getfaceedges_returntype <b class="fsfunc">GetNodeEdges</b>(</code>varchar  <var class="pdparam">atopology</var>, integer  <var class="pdparam">anode</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287183177"></a><h2>説明</h2><p>
与えられたノードへのエッジのインシデンスの集合を整列して返します。
出力は、連続する、正負符号を持つエッジ識別番号からなります。
連続番号は1から始まります。
正のエッジは与えられたノードから始まるものです。
負のエッジは与えられたノードで終わるものです。
閉じたエッジは2回現れます(正と負になります)。
並び順は北側から時計回りになります。
		</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>
この関数は、並び順を計算していて、メタデータからのデータを使わないので、
連結しているエッジ環を構築するのに使えます。
		</p></td></tr></table></div><p>初出: 2.0 </p></div><div class="refsection" title="関連情報"><a name="id287183201"></a><h2>関連情報</h2><p>
<a class="xref" href="#GetRingEdges" title="GetRingEdges">GetRingEdges</a>,
<a class="xref" href="#ST_Azimuth" title="ST_Azimuth">ST_Azimuth</a>
				</p></div></div></div><div class="sect1" title="11.7. トポロジ処理"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Topology_Processing"></a>11.7. トポロジ処理</h2></div><div><div class="abstract" title="概要"><p class="title"><b>概要</b></p><p>本節では、非標準の手法でのトポロジ処理の関数を挙げます。</p></div></div></div></div><div class="toc"><dl><dt><span class="refentrytitle"><a href="#TopologyPolygonize">Polygonize</a></span><span class="refpurpose"> ? トポロジエッジで定義されるフェイスを探索し、追加します。</span></dt><dt><span class="refentrytitle"><a href="#AddNode">AddNode</a></span><span class="refpurpose"> ? 指定したトポロジスキーマのノードテーブルにポイントノードを追加し、新しいノードの識別番号を返します。指定したポイントに既にノードがある場合は既存のノード識別番号を返します。</span></dt><dt><span class="refentrytitle"><a href="#AddEdge">AddEdge</a></span><span class="refpurpose"> ? 指定したラインストリングジオメトリを使って指定したトポロジスキーマにおいて、ラインストリングエッジをエッジテーブルに追加し、関連する始点終点のノードをノードテーブルに追加し、新しい(または既存の)エッジの識別番号を返します。</span></dt><dt><span class="refentrytitle"><a href="#AddFace">AddFace</a></span><span class="refpurpose"> ? 
フェイスプリミティブをトポロジに登録し、その識別番号を得ます。
        </span></dt></dl></div><div class="refentry" title="Polygonize"><a name="TopologyPolygonize"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Polygonize ? トポロジエッジで定義されるフェイスを探索し、追加します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">Polygonize</b>(</code>varchar  <var class="pdparam">toponame</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287183307"></a><h2>説明</h2><p>トポロジエッジプリミティブが構築する全てのフェイスを登録します。</p><p>対象トポロジは自己インタセクトするエッジが無いと仮定しています。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>既に登録されているフェイスは認識されているので、同じトポロジに対してPolygonizeを複数回呼んでも問題ありません。</p></td></tr></table></div><p>初出: 2.0.0</p></div><div class="refsection" title="関連情報"><a name="id287183333"></a><h2>関連情報</h2><p><a class="xref" href="#AddFace" title="AddFace">AddFace</a>, <a class="xref" href="#ST_Polygonize" title="ST_Polygonize">ST_Polygonize</a></p></div></div><div class="refentry" title="AddNode"><div class="refentry.separator"><hr></div><a name="AddNode"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>AddNode ? 指定したトポロジスキーマのノードテーブルにポイントノードを追加し、新しいノードの識別番号を返します。指定したポイントに既にノードがある場合は既存のノード識別番号を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">AddNode</b>(</code>varchar  <var class="pdparam">toponame</var>, geometry  <var class="pdparam">apoint</var>, boolean  <var class="pdparam">allowEdgeSplitting=false</var>, boolean  <var class="pdparam">computeContainingFace=false</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287183414"></a><h2>説明</h2><p>
指定したトポロジスキーマのノードテーブルにポイントノードを追加します。<a class="xref" href="#AddEdge" title="AddEdge">AddEdge</a>関数は、呼ばれると自動的にエッジの始端と終端のポイントを追加するので、明示的にエッジのノードを追加する必要はあまりありません。
                </p><p>
ノードとクロスするエッジが発見された場合は、例外が発生するか、エッジが分割されます。<code class="varname">allowEdgeSplitting</code>パラメータの値に依存します。
	</p><p>
<code class="varname">computeContainingFace</code>がtrueなら、新しく追加されたノードによって、ノードを含む正しいフェイスが計算されます。
	</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">apoint</code>ジオメトリが既にノードとして存在する場合、ノードは追加されずに、既存ノードの識別番号を返します。</p></td></tr></table></div><p>初出: 2.0.0</p></div><div class="refsection" title="例"><a name="id287183451"></a><h2>例</h2><pre class="programlisting">SELECT topology.AddNode('ma_topo', ST_GeomFromText('POINT(227641.6 893816.5)', 26986) ) As nodeid;
-- result --
nodeid
--------
 4
 
</pre></div><div class="refsection" title="関連情報"><a name="id287183465"></a><h2>関連情報</h2><p><a class="xref" href="#AddEdge" title="AddEdge">AddEdge</a>, <a class="xref" href="#CreateTopology" title="CreateTopology">CreateTopology</a></p></div></div><div class="refentry" title="AddEdge"><div class="refentry.separator"><hr></div><a name="AddEdge"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>AddEdge ? 指定したラインストリングジオメトリを使って指定したトポロジスキーマにおいて、ラインストリングエッジをエッジテーブルに追加し、関連する始点終点のノードをノードテーブルに追加し、新しい(または既存の)エッジの識別番号を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">AddEdge</b>(</code>varchar  <var class="pdparam">toponame</var>, geometry  <var class="pdparam">aline</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287183526"></a><h2>説明</h2><p>指定したラインストリングジオメトリを使って<code class="varname">toponame</code>で指定したトポロジスキーマにおいて、ラインストリングエッジをエッジテーブルに追加し、関連する始点終点のノードをノードテーブルに追加し、新規または既存のレコードのエッジの識別番号を返します。
新しく追加されたエッジは、両側に「ユニバース」フェイスを持ち、自身に関連付けを行います(訳注: トポロジスキーマのedge_dataテーブルを見てみて下さい)。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">aline</code>ジオメトリが既存のラインストリングエッジとクロス、オーバラップ、包含、被包含している場合、エラーが投げられ、エッジは追加されません。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">aline</code>ジオメトリはトポロジと同じ<code class="varname">srid</code>である必要があり、異なる場合は不正な空間参照系エラーが投げられます。</p></td></tr></table></div><p>初出: 2.0.0 GEOS 3.3.0以上が必要</p></div><div class="refsection" title="例"><a name="id287183561"></a><h2>例</h2><pre class="programlisting">SELECT topology.AddEdge('ma_topo', ST_GeomFromText('LINESTRING(227575.8 893917.2,227591.9 893900.4)', 26986) ) As edgeid;
-- 結果 --
edgeid
--------
 1
				
SELECT topology.AddEdge('ma_topo', ST_GeomFromText('LINESTRING(227591.9 893900.4,227622.6 893844.2,227641.6 893816.5,
 227704.5 893778.5)', 26986) ) As edgeid;
-- 結果 --
edgeid
--------
 2
 
 SELECT topology.AddEdge('ma_topo', ST_GeomFromText('LINESTRING(227591.2 893900, 227591.9 893900.4,
  227704.5 893778.5)', 26986) ) As edgeid;
 -- エラー発生 --
 ERROR:  Edge intersects (not on endpoints) with existing edge 1
</pre></div><div class="refsection" title="関連情報"><a name="id287183574"></a><h2>関連情報</h2><p><a class="xref" href="#CreateTopology" title="CreateTopology">CreateTopology</a>, <a class="xref" href="#spatial_ref_sys" title="4.3.1. SPATIAL_REF_SYSテーブルと空間参照系">「SPATIAL_REF_SYSテーブルと空間参照系」</a></p></div></div><div class="refentry" title="AddFace"><div class="refentry.separator"><hr></div><a name="AddFace"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>AddFace ? 
フェイスプリミティブをトポロジに登録し、その識別番号を得ます。
        </p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">AddFace</b>(</code>varchar  <var class="pdparam">toponame</var>, geometry  <var class="pdparam">apolygon</var>, boolean  <var class="pdparam">force_new=false</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287184192"></a><h2>説明</h2><p>
フェイスプリミティブをトポロジに登録し、その識別番号を得ます。
                </p><p>
新しく追加されたフェイスのために、境界を形成するエッジとフェイスに含まれるエッジはleft_faceとright_faceフィールドに正しい値を持つよう更新されます。フェイスに含まれる孤立ノードも正しいcontaining_faceフィールド値を持つよう更新されます。
                </p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>
This function does not use nor set the next_left_edge and next_right_edge fields of the edge table.
                </p></td></tr></table></div><p>対象トポロジは妥当(自己インタセクトするエッジが無い)と仮定しています。ポリゴンの境界が既存のエッジでは完全には定義されない場合や、ポリゴンが既存のフェイスにオーバラップする場合には、例外が投げられます。</p><p>
<code class="varname">apolygon</code>ジオメトリがフェイスとして既に存在する場合には、<code class="varname">force_new</code>がfalse(デフォルト)なら既存のフェイス識別番号を返し、<code class="varname">force_new</code>がtrueなら新しくフェイスが登録されて新しい識別番号が確保されます。
                </p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>
既存フェイスの新規登録が実行される時(force_new=true)、そのエッジ内の既存のフェイスへの参照のダングルを解決しません。また、関連テーブルのノードと既存フェイスのレコードのMBR(訳注: 最小境界矩形)フィールドの更新も行いません。これに対応するのは、この関数を呼び出した側です。
                </p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">aline</code>ジオメトリはトポロジと同じ<code class="varname">srid</code>である必要があり、異なる場合は不正な空間参照系エラーが投げられます。</p></td></tr></table></div><p>初出: 2.0.0</p></div><div class="refsection" title="例"><a name="id287184247"></a><h2>例</h2><pre class="programlisting">
-- まずgenerate_seriesを使って繰り返しを発生させてエッジを追加します
-- (次に示すものは最大値10000ポイント以下のポリゴンでのみ動作します。
-- generate_seriesの上限になるためです)。
SELECT topology.AddEdge('ma_topo', ST_MakeLine(ST_PointN(geom,i), ST_PointN(geom, i + 1) )) As edgeid
    FROM (SELECT  ST_NPoints(geom) AS npt, geom
            FROM 
                (SELECT ST_Boundary(ST_GeomFromText('POLYGON((234896.5 899456.7,234914 899436.4,234946.6 899356.9,234872.5 899328.7,
                234891 899285.4,234992.5 899145, 234890.6 899069,234755.2 899255.4,
                234612.7 899379.4,234776.9 899563.7,234896.5 899456.7))', 26986) )  As geom
            )  As geoms) As facen CROSS JOIN generate_series(1,10000) As i
         WHERE i &lt; npt;
-- 結果 --
 edgeid
--------
      3
      4
      5
      6
      7
      8
      9
     10
     11
     12
(10 rows)
-- 次にフェイスの追加 -
				
SELECT topology.AddFace('ma_topo', 
    ST_GeomFromText('POLYGON((234896.5 899456.7,234914 899436.4,234946.6 899356.9,234872.5 899328.7,
    234891 899285.4,234992.5 899145, 234890.6 899069,234755.2 899255.4,
    234612.7 899379.4,234776.9 899563.7,234896.5 899456.7))', 26986) ) As faceid;
-- 結果 --
faceid
--------
 1
 
</pre></div><div class="refsection" title="関連情報"><a name="id287184260"></a><h2>関連情報</h2><p><a class="xref" href="#AddEdge" title="AddEdge">AddEdge</a>, <a class="xref" href="#CreateTopology" title="CreateTopology">CreateTopology</a>, <a class="xref" href="#spatial_ref_sys" title="4.3.1. SPATIAL_REF_SYSテーブルと空間参照系">「SPATIAL_REF_SYSテーブルと空間参照系」</a></p></div></div></div><div class="sect1" title="11.8. TopoGeometryコンストラクタ"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="TopoGeometry_Constructors"></a>11.8. TopoGeometryコンストラクタ</h2></div><div><div class="abstract" title="概要"><p class="title"><b>概要</b></p><p>本節では、新しいTopoGeometryを生成するトポロジ関数を挙げます。</p></div></div></div></div><div class="toc"><dl><dt><span class="refentrytitle"><a href="#CreateTopoGeom">CreateTopoGeom</a></span><span class="refpurpose"> ? 新しい TopoGeometryオブジェクトを topoエレメント配列から生成します - tg_type: 1:[multi]point, 2:[multi]line, 3:[multi]poly, 4:collection</span></dt><dt><span class="refentrytitle"><a href="#toTopoGeom">toTopoGeom</a></span><span class="refpurpose"> ? 単純なジオメトリからTopoGeometryを生成します。</span></dt><dt><span class="refentrytitle"><a href="#TopoElementArray_Agg">TopoElementArray_Agg</a></span><span class="refpurpose"> ? lement_idとタイプの配列(topoelements)からなる<code class="varname">topoelementarray</code>を返します。</span></dt></dl></div><div class="refentry" title="CreateTopoGeom"><a name="CreateTopoGeom"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>CreateTopoGeom ? 新しい TopoGeometryオブジェクトを topoエレメント配列から生成します - tg_type: 1:[multi]point, 2:[multi]line, 3:[multi]poly, 4:collection</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">topogeometry <b class="fsfunc">CreateTopoGeom</b>(</code>varchar  <var class="pdparam">toponame</var>, integer  <var class="pdparam">tg_type</var>, integer <var class="pdparam">layer_id</var>, topoelementarray <var class="pdparam">tg_objs</var><code>)</code>;</p><p><code class="funcdef">topogeometry <b class="fsfunc">CreateTopoGeom</b>(</code>varchar  <var class="pdparam">toponame</var>, integer  <var class="pdparam">tg_type</var>, integer <var class="pdparam">layer_id</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287184464"></a><h2>説明</h2><p>layer_idで示されたレイヤのためのTopoGeometryオブジェクトを生成し、<code class="varname">toponame</code>スキーマのrelationテーブルに登録します。</p><p>tg_typeは次の整数値とします: 1:[multi]point (punctal), 2:[multi]line (lineal), 3:[multi]poly (areal), 4:collection。layer_idは、topology.layerテーブル内のレイヤ識別番号です。</p><p>点レイヤはノードの集合から形成され、線レイヤはエッジの集合から形成され、面レイヤはフェイスの集合から形成され、コレクションはノード、エッジ、フェイスの混合から形成されます。</p><p>要素の配列を省略した場合、空のTopoGeometryオブジェクトが生成されます。</p><p>初出: 1.?</p></div><div class="refsection" title="例: 既存エッジからの形成"><a name="id287184492"></a><h2>例: 既存エッジからの形成</h2><p>ラインタイプ(整数値で2)の、layer_idが2のレイヤ(ri_roads)があるri_topoスキーマ内で最初のエッジ(<code class="varname">ST_CreateTopoGeo</code>でロードしてあります)からTopoGeometryを生成します。</p><pre class="programlisting">INSERT INTO ri.ri_roads(road_name, topo) VALUES('Unknown', topology.CreateTopoGeom('ri_topo',2,2,'{{1,2}}'::topology.topoelementarray);</pre></div><div class="refsection" title="例: 面ジオメトリから最善と推測されるTopoGeometryへの変換"><a name="id287184510"></a><h2>例: 面ジオメトリから最善と推測されるTopoGeometryへの変換</h2><p>フェイスのコレクションから形成されるジオメトリがあるとします。blockgroupsテーブルがあり、それぞれの区画群のTopoGeometryを知りたいとします。データが完全に整列しているなら、次のようにできます。</p><pre class="programlisting">
-- TopoGeometryカラムの生成 --
SELECT topology.AddTopoGeometryColumn(
	'topo_boston', 
	'boston', 'blockgroups', 'topo', 'POLYGON');
	
-- addtopgeometrycolumn --
1
	
-- 全てが完全にエッジに整列していると仮定している
-- カラムの更新
UPDATE boston.blockgroups AS bg
	SET topo = topology.CreateTopoGeom('topo_boston'
        ,3,1
        , foo.bfaces)
FROM (SELECT b.gid,  topology.TopoElementArray_Agg(ARRAY[f.face_id,3]) As bfaces
	FROM boston.blockgroups As b
            INNER JOIN topo_boston.face As f ON b.geom &amp;&amp; f.mbr
        WHERE ST_Covers(b.geom, topology.ST_GetFaceGeometry('topo_boston', f.face_id))
            GROUP BY b.gid) As foo
WHERE foo.gid = bg.gid; 
</pre><pre class="programlisting">
-- 世界はほとんど完全ではなく、ある程度の誤差は許容しなければなりません。
-- 各々のフェイスについてblockgroupの境界と思われるものの中に
-- 50%以上含まれているものを対象とします。
UPDATE boston.blockgroups AS bg
	SET topo = topology.CreateTopoGeom('topo_boston'
        ,3,1
        , foo.bfaces)
FROM (SELECT b.gid,  topology.TopoElementArray_Agg(ARRAY[f.face_id,3]) As bfaces
	FROM boston.blockgroups As b
            INNER JOIN topo_boston.face As f ON b.geom &amp;&amp; f.mbr
        WHERE ST_Covers(b.geom, topology.ST_GetFaceGeometry('topo_boston', f.face_id))
        	OR
 (  ST_Intersects(b.geom, topology.ST_GetFaceGeometry('topo_boston', f.face_id))
            AND ST_Area(ST_Intersection(b.geom, topology.ST_GetFaceGeometry('topo_boston', f.face_id) ) ) &gt; 
                ST_Area(topology.ST_GetFaceGeometry('topo_boston', f.face_id))*0.5
                )
            GROUP BY b.gid) As foo
WHERE foo.gid = bg.gid; 

-- そして、TopoGeometryをフェイスとエッジに整列された非正規ジオメトリに
-- 戻すには、トポロジをジオメトリにキャストします。
-- 新しいジオメトリはtigerのストリートのセンタラインに整列しているところが
-- 本当にクールなところです。
UPDATE boston.blockgroups SET new_geom = topo::geometry;
</pre></div><div class="refsection" title="関連情報"><a name="id287184531"></a><h2>関連情報</h2><p>
<a class="xref" href="#AddTopoGeometryColumn" title="AddTopoGeometryColumn">AddTopoGeometryColumn</a>,
<a class="xref" href="#toTopoGeom" title="toTopoGeom">toTopoGeom</a>  
<a class="xref" href="#ST_CreateTopoGeo" title="ST_CreateTopoGeo">ST_CreateTopoGeo</a>,
<a class="xref" href="#ST_GetFaceGeometry" title="ST_GetFaceGeometry">ST_GetFaceGeometry</a>,
<a class="xref" href="#topoelementarray" title="topoelementarray">topoelementarray</a>,
<a class="xref" href="#TopoElementArray_Agg" title="TopoElementArray_Agg">TopoElementArray_Agg</a>  
				</p></div></div><div class="refentry" title="toTopoGeom"><div class="refentry.separator"><hr></div><a name="toTopoGeom"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>toTopoGeom ? 単純なジオメトリからTopoGeometryを生成します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">topogeometry <b class="fsfunc">toTopoGeom</b>(</code>geometry  <var class="pdparam">geom</var>, varchar  <var class="pdparam">toponame</var>, integer <var class="pdparam">layer_id</var>, float8 <var class="pdparam">tolerance</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287184661"></a><h2>説明</h2><p>
layer_idで示されたレイヤのためのTopoGeometryオブジェクトを生成し、<code class="varname">toponame</code>内の関連テーブルに登録します。
                </p><p>
入力ジオメトリを表現しなければならないトポロジのプリミティブが追加されます。既存のものを分割することもあります。既存のTopoGeometryオブジェクトは形状を保持します。
                </p><p>
<code class="varname">tolerance</code>が与えられた場合は、入力ジオメトリは既存のプリミティブにスナップするために使われます。</p><p>初出: 2.0</p></div><div class="refsection" title="例"><a name="id287184689"></a><h2>例</h2><p>This is a full self-contained workflow</p><pre class="programlisting"> -- セットアップしたトポロジが無い場合に実行します
-- 許容差を認めないトポロジの生成
SELECT topology.CreateTopology('topo_boston_test', 2249);
-- 新規テーブル作成
CREATE TABLE nei_topo(gid serial primary key, nei varchar(30));
-- TopoGeometryカラムの追加
SELECT topology.AddTopoGeometryColumn('topo_boston_test', 'public', 'nei_topo', 'topo', 'MULTIPOLYGON') As new_layer_id;
new_layer_id
-----------
1

-- 新しいTopoGeometryカラムの追加で新しいレイヤ識別番号を使用
-- 新しいレイヤに許容差0でTopoGeometryを追加
INSERT INTO nei_topo(nei, topo)
SELECT nei,  topology.toTopoGeom(geom, 'topo_boston_test', 1)
FROM neighborhoods
WHERE gid BETWEEN 1 and 15;

-- 何が起こったかの確認に使用
SELECT * FROM 
    topology.TopologySummary('topo_boston_test'); 
    
-- 概要 --
Topology topo_boston_test (5), SRID 2249, precision 0
61 nodes, 87 edges, 35 faces, 15 topogeoms in 1 layers
Layer 1, type Polygonal (3), 15 topogeoms
 Deploy: public.nei_topo.topo</pre></div><div class="refsection" title="関連情報"><a name="id287184705"></a><h2>関連情報</h2><p> <a class="xref" href="#CreateTopology" title="CreateTopology">CreateTopology</a>,<a class="xref" href="#AddTopoGeometryColumn" title="AddTopoGeometryColumn">AddTopoGeometryColumn</a>,
<a class="xref" href="#CreateTopoGeom" title="CreateTopoGeom">CreateTopoGeom</a>, <a class="xref" href="#TopologySummary" title="TopologySummary">TopologySummary</a></p></div></div><div class="refentry" title="TopoElementArray_Agg"><div class="refentry.separator"><hr></div><a name="TopoElementArray_Agg"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>TopoElementArray_Agg ? lement_idとタイプの配列(topoelements)からなる<code class="varname">topoelementarray</code>を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">topoelementarray <b class="fsfunc">TopoElementArray_Agg</b>(</code>topoelement set <var class="pdparam">tefield</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287184770"></a><h2>説明</h2><p><a class="xref" href="#topoelementarray" title="topoelementarray">topoelementarray</a>を<a class="xref" href="#topoelement" title="TopoElement">TopoElement</a>の集合から生成するために使います。</p><p>初出: 2.0.0</p></div><div class="refsection" title="例"><a name="id287184790"></a><h2>例</h2><pre class="programlisting">SELECT topology.TopoElementArray_Agg(ARRAY[e,t]) As tea
  FROM generate_series(1,3) As e CROSS JOIN generate_series(1,4) As t;
  tea
--------------------------------------------------------------------------
{{1,1},{1,2},{1,3},{1,4},{2,1},{2,2},{2,3},{2,4},{3,1},{3,2},{3,3},{3,4}}</pre></div><div class="refsection" title="関連情報"><a name="id287184802"></a><h2>関連情報</h2><p><a class="xref" href="#topoelement" title="TopoElement">TopoElement</a>, <a class="xref" href="#topoelementarray" title="topoelementarray">topoelementarray</a></p></div></div></div><div class="sect1" title="11.9. TopoGeometryアクセサ"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="TopoGeom_Accessors"></a>11.9. TopoGeometryアクセサ</h2></div></div></div><div class="toc"><dl><dt><span class="refentrytitle"><a href="#GetTopoGeomElementArray">GetTopoGeomElementArray</a></span><span class="refpurpose"> ? トポロジ要素と与えられたTopoGeometryの型(プリミティブ要素)からなる<code class="varname">topoelementarray</code>(topoelementsの配列)を返します。</span></dt><dt><span class="refentrytitle"><a href="#GetTopoGeomElements">GetTopoGeomElements</a></span><span class="refpurpose"> ? 与えられたTopoGeometryオブジェクト(プリミティブ要素)のelement_id, element_typeを含む<code class="varname">topoelement</code>の集合を返します。</span></dt></dl></div><div class="refentry" title="GetTopoGeomElementArray"><a name="GetTopoGeomElementArray"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>GetTopoGeomElementArray ? トポロジ要素と与えられたTopoGeometryの型(プリミティブ要素)からなる<code class="varname">topoelementarray</code>(topoelementsの配列)を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">topoelementarray <b class="fsfunc">GetTopoGeomElementArray</b>(</code>varchar  <var class="pdparam">toponame</var>, integer  <var class="pdparam">layer_id</var>, integer <var class="pdparam">tg_id</var><code>)</code>;</p></div><div class="funcsynopsis"><p><code class="funcdef">topoelementarray topoelement <b class="fsfunc">GetTopoGeomElementArray</b>(</code>topogeometry  <var class="pdparam">tg</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287184938"></a><h2>説明</h2><p>トポロジ要素と与えられたTopoGeometryの型(プリミティブ要素)からなる<code class="varname">topoelementarray</code>(topoelementsの配列)を返します。これはGetTopoGeomElementsと似ていますが、要素をデータセットでなく配列で返す点が違います。</p><p>tg_idは、topology.layerテーブル内の<code class="varname">layer_id</code>で示されたレイヤのTopoGeometryオブジェクトの識別番号です。</p><p>初出: 1.?</p></div><div class="refsection" title="例"><a name="id287184963"></a><h2>例</h2><p></p></div><div class="refsection" title="関連情報"><a name="id287184977"></a><h2>関連情報</h2><p><a class="xref" href="#GetTopoGeomElements" title="GetTopoGeomElements">GetTopoGeomElements</a>, <a class="xref" href="#topoelementarray" title="topoelementarray">topoelementarray</a></p></div></div><div class="refentry" title="GetTopoGeomElements"><div class="refentry.separator"><hr></div><a name="GetTopoGeomElements"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>GetTopoGeomElements ? 与えられたTopoGeometryオブジェクト(プリミティブ要素)のelement_id, element_typeを含む<code class="varname">topoelement</code>の集合を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">setof topoelement <b class="fsfunc">GetTopoGeomElements</b>(</code>varchar  <var class="pdparam">toponame</var>, integer  <var class="pdparam">layer_id</var>, integer <var class="pdparam">tg_id</var><code>)</code>;</p></div><div class="funcsynopsis"><p><code class="funcdef">setof topoelement <b class="fsfunc">GetTopoGeomElements</b>(</code>topogeometry  <var class="pdparam">tg</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287185072"></a><h2>説明</h2><p><code class="varname">toponame</code>スキーマにおける、与えられたTopoGeometryオブジェクトのelement_id, element_type(topoelements)の集合を返します。</p><p>tg_idは、topology.layerテーブル内の<code class="varname">layer_id</code>で示されたレイヤのTopoGeometryオブジェクトの識別番号です。</p><p>初出: 1.?</p></div><div class="refsection" title="例"><a name="id287185095"></a><h2>例</h2><p></p></div><div class="refsection" title="関連情報"><a name="id287185109"></a><h2>関連情報</h2><p><a class="xref" href="#GetTopoGeomElementArray" title="GetTopoGeomElementArray">GetTopoGeomElementArray</a>, <a class="xref" href="#topoelement" title="TopoElement">TopoElement</a></p></div></div></div><div class="sect1" title="11.10. TopoGeometry出力"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="TopoGeometry_Outputs"></a>11.10. TopoGeometry出力</h2></div></div></div><div class="toc"><dl><dt><span class="refentrytitle"><a href="#AsGML">AsGML</a></span><span class="refpurpose"> ? TopoGeometryのGML表現を返します。</span></dt></dl></div><div class="refentry" title="AsGML"><a name="AsGML"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>AsGML ? TopoGeometryのGML表現を返します。</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">AsGML</b>(</code>topogeometry  <var class="pdparam">tg</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">AsGML</b>(</code>topogeometry  <var class="pdparam">tg</var>, text  <var class="pdparam">nsprefix_in</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">AsGML</b>(</code>topogeometry  <var class="pdparam">tg</var>, regclass  <var class="pdparam">visitedTable</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">AsGML</b>(</code>topogeometry  <var class="pdparam">tg</var>, regclass  <var class="pdparam">visitedTable</var>, text  <var class="pdparam">nsprefix</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">AsGML</b>(</code>topogeometry  <var class="pdparam">tg</var>, text  <var class="pdparam">nsprefix_in</var>, integer  <var class="pdparam">precision</var>, integer  <var class="pdparam">options</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">AsGML</b>(</code>topogeometry  <var class="pdparam">tg</var>, text  <var class="pdparam">nsprefix_in</var>, integer  <var class="pdparam">precision</var>, integer  <var class="pdparam">options</var>, regclass  <var class="pdparam">visitedTable</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">AsGML</b>(</code>topogeometry  <var class="pdparam">tg</var>, text  <var class="pdparam">nsprefix_in</var>, integer  <var class="pdparam">precision</var>, integer  <var class="pdparam">options</var>, regclass  <var class="pdparam">visitedTable</var>, text  <var class="pdparam">idprefix</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">AsGML</b>(</code>topogeometry  <var class="pdparam">tg</var>, text  <var class="pdparam">nsprefix_in</var>, integer  <var class="pdparam">precision</var>, integer  <var class="pdparam">options</var>, regclass  <var class="pdparam">visitedTable</var>, text  <var class="pdparam">idprefix</var>, int  <var class="pdparam">gmlversion</var><code>)</code>;</p></div></div><div class="refsection" title="説明"><a name="id287185523"></a><h2>説明</h2><p>TopoGeometryのGML表現を、GML 3形式で返します。<code class="varname">nsprefix_in</code>が指定されていない場合は<code class="varname">gml</code>が使われます。非指定名前空間を得るためにnsprefixには空文字列が渡されます。precision(精度, デフォルト: 15)とoption(デフォルト: 1)パラメータは、与えられた場合は、この関数が使用するST_AsGMLにそのまま渡ります。</p><p>
<code class="varname">visitedTable</code>パラメータは、与えられた場合は、重複定義でなく相互参照(xlink:xref)を使うために、訪問したノード要素とエッジ要素の追跡を保持するために使われます。
最善の効率のために、<code class="varname">element_type</code>と<code class="varname">element_id</code>に、この順序でインデクスを作成するべきです。
このインデクスは、一意性制約をフィールドに与えると自動的に生成されます。たとえば次のようになります。
</p><pre class="programlisting">
CREATE TABLE visited (
  element_type integer, element_id integer,
  unique(element_type, element_id)
);
</pre><p>
		</p><p><code class="varname">idprefix</code>パラメータは、与えられた場合は、EdgeタグとNodeタグの識別子に前置されます。</p><p><code class="varname">gmlver</code>パラメータは、与えられた場合は、この関数が使用するST_AsGMLに渡ります。デフォルトは3です。</p><p>初出: 2.0.0 </p></div><div class="refsection" title="例"><a name="id287185574"></a><h2>例</h2><p>本例では<a class="xref" href="#CreateTopoGeom" title="CreateTopoGeom">CreateTopoGeom</a>で生成したTopoGeometryを使います。</p><pre class="programlisting">SELECT topology.AsGML(topo) As rdgml 
  FROM ri.roads 
  WHERE road_name = 'Unknown';
  
-- rdgml--
&lt;gml:TopoCurve&gt;
    &lt;gml:directedEdge&gt;
        &lt;gml:Edge gml:id="E1"&gt;
            &lt;gml:directedNode orientation="-"&gt;
                &lt;gml:Node gml:id="N1"/&gt;
            &lt;/gml:directedNode&gt;
            &lt;gml:directedNode&gt;&lt;/gml:directedNode&gt;
            &lt;gml:curveProperty&gt;
                &lt;gml:Curve srsName="urn:ogc:def:crs:EPSG::3438"&gt;
                    &lt;gml:segments&gt;
                        &lt;gml:LineStringSegment&gt;
                            &lt;gml:posList srsDimension="2"&gt;384744 236928 384750 236923 384769 236911 384799 236895 384811 236890 
                            384833 236884 384844 236882 384866 236881 384879 236883 384954 236898 385087 236932 385117 236938 
                            385167 236938 385203 236941 385224 236946 385233 236950 385241 236956 385254 236971 
                            385260 236979 385268 236999 385273 237018 385273 237037 385271 237047 385267 237057 385225 237125 
                            385210 237144 385192 237161 385167 237192 385162 237202 385159 237214 385159 237227 385162 237241 
                            385166 237256 385196 237324 385209 237345 385234 237375 385237 237383 385238 237399 385236 237407 
                            385227 237419 385213 237430 385193 237439 385174 237451 385170 237455 385169 237460 385171 237475 
                            385181 237503 385190 237521 385200 237533 385206 237538 385213 237541 385221 237542 385235 237540 385242 237541 
                            385249 237544 385260 237555 385270 237570 385289 237584 385292 237589 385291 237596 385284 237630&lt;/gml:posList&gt;
                        &lt;/gml:LineStringSegment&gt;
                    &lt;/gml:segments&gt;
                &lt;/gml:Curve&gt;
            &lt;/gml:curveProperty&gt;
        &lt;/gml:Edge&gt;
    &lt;/gml:directedEdge&gt;
&lt;/gml:TopoCurve&gt;		
</pre><p>Same exercise as previous without namespace</p><pre class="programlisting">SELECT topology.AsGML(topo,'') As rdgml 
  FROM ri.roads 
  WHERE road_name = 'Unknown';
  
-- rdgml--
&lt;TopoCurve&gt;
    &lt;directedEdge&gt;
        &lt;Edge id="E1"&gt;
            &lt;directedNode orientation="-"&gt;
                &lt;Node id="N1"/&gt;
            &lt;/directedNode&gt;
            &lt;directedNode&gt;&lt;/directedNode&gt;
            &lt;curveProperty&gt;
                &lt;Curve srsName="urn:ogc:def:crs:EPSG::3438"&gt;
                    &lt;segments&gt;
                        &lt;LineStringSegment&gt;
                            &lt;posList srsDimension="2"&gt;384744 236928 384750 236923 384769 236911 384799 236895 384811 236890 
                            384833 236884 384844 236882 384866 236881 384879 236883 384954 236898 385087 236932 385117 236938 
                            385167 236938 385203 236941 385224 236946 385233 236950 385241 236956 385254 236971 
                            385260 236979 385268 236999 385273 237018 385273 237037 385271 237047 385267 237057 385225 237125 
                            385210 237144 385192 237161 385167 237192 385162 237202 385159 237214 385159 237227 385162 237241 
                            385166 237256 385196 237324 385209 237345 385234 237375 385237 237383 385238 237399 385236 237407 
                            385227 237419 385213 237430 385193 237439 385174 237451 385170 237455 385169 237460 385171 237475 
                            385181 237503 385190 237521 385200 237533 385206 237538 385213 237541 385221 237542 385235 237540 385242 237541 
                            385249 237544 385260 237555 385270 237570 385289 237584 385292 237589 385291 237596 385284 237630&lt;/posList&gt;
                         &lt;/LineStringSegment&gt;
                    &lt;/segments&gt;
                &lt;/Curve&gt;
            &lt;/curveProperty&gt;
        &lt;/Edge&gt;
    &lt;/directedEdge&gt;
&lt;/TopoCurve&gt;		
</pre></div><div class="refsection" title="関連情報"><a name="id287185601"></a><h2>関連情報</h2><p><a class="xref" href="#CreateTopoGeom" title="CreateTopoGeom">CreateTopoGeom</a>, <a class="xref" href="#ST_CreateTopoGeo" title="ST_CreateTopoGeo">ST_CreateTopoGeo</a></p></div></div></div></div><div class="chapter" title="第12章 PostGIS 追加機能"><div class="titlepage"><div><div><h2 class="title"><a name="Extras"></a>第12章 PostGIS 追加機能</h2></div></div></div><div class="toc"><p><b>目次</b></p><dl><dt><span class="sect1"><a href="#Tiger_Geocoder">12.1. Tiger Geocoder</a></span></dt></dl></div><p>本章では、PostGISのソースアーカイブとソースレポジトリのextrasフォルダにある機能を記述します。
これらは必ずPostGISバイナリ版に同梱されているものではありませんが、通常は実行可能なplpgsqlベースのものまたは標準的なシェルスクリプトです。</p><div class="sect1" title="12.1. Tiger Geocoder"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Tiger_Geocoder"></a>12.1. Tiger Geocoder</h2></div><div><div class="abstract" title="概要"><p class="title"><b>概要</b></p><p>A plpgsql based geocoder written to work with the <a class="ulink" href="http://www.census.gov/geo/www/tiger/" target="_top">TIGER (Topologically Integrated Geographic Encoding and Referencing system ) / Line and Master Address database export</a> released by the US Census Bureau.  In prior versions the TIGER files were
			released in ASCII format.  The older geocoder used to work with that format is in <code class="varname">extras/tiger_geocoder/tiger_2006andbefore</code>. </p><p>There are four components to the geocoder: the data loader functions, the address normalizer, the address geocoder, and the reverse geocoder. The latest version updated to use the TIGER 2010 census data is located in the <code class="varname">extras/tiger_geocoder/tiger_2010</code> folder.</p><p>Although it is designed specifically for the US, a lot of the concepts and functions are applicable and can be adapted to work with other country address and road networks.</p><p>The script builds a schema called <code class="varname">tiger</code> to house all the tiger related functions, reusable lookup data such as road type prefixes, suffixes, states, various control tables for managing data load, and skeleton base tables from which all the tiger loaded tables inherit from.</p><p>Another schema called <code class="varname">tiger_data</code> is also created which houses all the census data for each state that the loader downloads from Census site and loads into the database. In the current model, each set of state tables is
			    prefixed with the state code e.g ma_addr, ca_edges etc with constraints to enforce only that state data.  Each of these tables inherits from the base addr, faces, edges, etc located in the tiger schema. </p><p>All the geocode functions only reference the base tables, so there is no requirement that the data schema be called <code class="varname">tiger_data</code> or that data can't be further partitioned into other schemas -- e.g a different schema
			for each state, as long as all the tables inherit from the tables in the <code class="varname">tiger</code> schema.</p><p>
			  </p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>
If you are using a prerelease version of PostGIS 2.0.0 tiger geocoder,
you can upgrade the scripts using the accompanying upgrade_geocoder.bat
/ .sh scripts in tiger_2010.  We'll be refining the upgrade scripts
until release.
			  </p></td></tr></table></div><p>
			</p><p>Design:</p><p>The goal of this project is to build a fully functional geocoder that can process an arbitrary 
			address string and using normalized TIGER census data, produce a point geometry and rating reflecting the location of the given address and likeliness of the location.</p><p>The <code class="varname">reverse_geocode</code> function, introduced in PostGIS 2.0.0 is useful for deriving the street address and cross streets of a GPS location.</p><p>The geocoder should be simple for anyone familiar with PostGIS to install and use, and should be easily installable and usable on all platforms supported by PostGIS.</p><p>It should be robust enough to function properly despite formatting and spelling errors.</p><p>It should be extensible enough to be used with future data updates, or alternate data sources with a minimum of coding changes.</p><p>
		</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>The <code class="varname">tiger</code> schema must be added to the database search path for the functions to work properly.</p></td></tr></table></div><p>
			</p></div></div></div></div><div class="toc"><dl><dt><span class="refentrytitle"><a href="#Drop_Indexes_Generate_Script">Drop_Indexes_Generate_Script</a></span><span class="refpurpose"> ? Generates a script that drops all non-primary key and non-unique indexes on tiger schema and user specified schema.  Defaults schema to <code class="varname">tiger_data</code> if no schema is specified.</span></dt><dt><span class="refentrytitle"><a href="#Drop_State_Tables_Generate_Script">Drop_State_Tables_Generate_Script</a></span><span class="refpurpose"> ? Generates a script that drops all tables in the specified schema that are prefixed with the state abbreviation.  Defaults schema to <code class="varname">tiger_data</code> if no schema is specified.</span></dt><dt><span class="refentrytitle"><a href="#Geocode">Geocode</a></span><span class="refpurpose"> ? Takes in an address as a string (or other normalized address) and outputs a set of possible locations which include a point geometry in NAD 83 long lat, a normalized address for each, and the rating.  The lower the rating the more likely the match.  
			Results are sorted by lowest rating first. Can optionally pass in maximum results, defaults to 10, and restrict_region (defaults to NULL)</span></dt><dt><span class="refentrytitle"><a href="#Geocode_Intersection">Geocode_Intersection</a></span><span class="refpurpose"> ? Takes in 2 streets that intersect and a state, city, zip,  and outputs a set of possible locations on the first cross street that is at the intersection, also includes a point geometry in NAD 83 long lat, a normalized address for each location, and the rating.  The lower the rating the more likely the match.  
			Results are sorted by lowest rating first. Can optionally pass in maximum results, defaults to 10</span></dt><dt><span class="refentrytitle"><a href="#Get_Tract">Get_Tract</a></span><span class="refpurpose"> ? Returns census tract or field from tract table of where the geometry is located. Default to returning short name of tract.</span></dt><dt><span class="refentrytitle"><a href="#Install_Missing_Indexes">Install_Missing_Indexes</a></span><span class="refpurpose"> ? Finds all tables with key columns used in geocoder joins and filter conditions that are missing used indexes on those columns and will add them.</span></dt><dt><span class="refentrytitle"><a href="#Loader_Generate_Script">Loader_Generate_Script</a></span><span class="refpurpose"> ? Generates a shell script for the specified platform for the specified states that will download Tiger data, stage and load into <code class="varname">tiger_data</code> schema. Each state script is returned as a separate record. Latest version supports Tiger 2010 structural changes and also loads census tract, block groups, and blocks tables.</span></dt><dt><span class="refentrytitle"><a href="#Loader_Generate_Census_Script">Loader_Generate_Census_Script</a></span><span class="refpurpose"> ? Generates a shell script for the specified platform for the specified states that will download Tiger census state tract, bg, and tabblocks data tables, stage and load into <code class="varname">tiger_data</code> schema. Each state script is returned as a separate record.</span></dt><dt><span class="refentrytitle"><a href="#Missing_Indexes_Generate_Script">Missing_Indexes_Generate_Script</a></span><span class="refpurpose"> ? Finds all tables with key columns used in geocoder joins that are missing indexes on those columns and will output the SQL DDL to
		    define the index for those tables.</span></dt><dt><span class="refentrytitle"><a href="#Normalize_Address">Normalize_Address</a></span><span class="refpurpose"> ? Given a textual street address, returns a composite <code class="varname">norm_addy</code> type that has road suffix, prefix and type standardized, street, streetname etc. broken into separate fields.  This function 
		will work with just the lookup data packaged with the tiger_geocoder (no need for tiger census data).</span></dt><dt><span class="refentrytitle"><a href="#Pprint_Addy">Pprint_Addy</a></span><span class="refpurpose"> ? Given a <code class="varname">norm_addy</code> composite type object, returns a pretty print representation of it. Usually used in conjunction with normalize_address.</span></dt><dt><span class="refentrytitle"><a href="#Reverse_Geocode">Reverse_Geocode</a></span><span class="refpurpose"> ? Takes a geometry point in a known spatial ref sys and returns a record containing an array of theoretically possible addresses and an array of cross streets.  If include_strnum_range = true, includes the street range in the cross streets.</span></dt><dt><span class="refentrytitle"><a href="#Topology_Load_Tiger">Topology_Load_Tiger</a></span><span class="refpurpose"> ? Loads a defined region of tiger data into a PostGIS Topology and transforming the tiger data to spatial reference of the topology
        	and snapping to the precision tolerance of the topology.</span></dt></dl></div><p>There is another geocoder for PostGIS gaining in popularity and more suitable for international use.  It is called <a class="ulink" href="http://wiki.openstreetmap.org/wiki/Nominatim" target="_top">Nominatim</a>
     and uses OpenStreetMap gazeteer formatted data.  It requires osm2pgsql for loading the data, PostgreSQL 8.4+ and PostGIS 1.5+ to function.  It is packaged as a webservice interface and seems designed to be called as a webservice.
     Just like the tiger geocoder, it has both a geocoder and a reverse geocoder component.  From the documentation, it is unclear if it has a pure SQL interface like the tiger geocoder, or if a good deal of the logic is implemented in the web interface.</p><div class="refentry" title="Drop_Indexes_Generate_Script"><a name="Drop_Indexes_Generate_Script"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Drop_Indexes_Generate_Script ? Generates a script that drops all non-primary key and non-unique indexes on tiger schema and user specified schema.  Defaults schema to <code class="varname">tiger_data</code> if no schema is specified.</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">Drop_Indexes_Generate_Script</b>(</code>text  <var class="pdparam">param_schema=tiger_data</var><code>)</code>;</p></div></div><div class="refsection" title="Description"><a name="id287193312"></a><h2>Description</h2><p>Generates a script that drops all non-primary key and non-unique indexes on tiger schema and user specified schema.  Defaults schema to <code class="varname">tiger_data</code> if no schema is specified.</p><p>This is useful for minimizing index bloat that may confuse the query planner or take up unnecessary space.  Use in combination with <a class="xref" href="#Install_Missing_Indexes" title="Install_Missing_Indexes">Install_Missing_Indexes</a> to add just the indexes used by the geocoder.</p><p>Availability: 2.0.0</p></div><div class="refsection" title="Examples"><a name="id287193334"></a><h2>Examples</h2><pre class="programlisting">SELECT drop_indexes_generate_script() As actionsql;
actionsql
---------------------------------------------------------
DROP INDEX tiger.idx_tiger_countysub_lookup_lower_name;
DROP INDEX tiger.idx_tiger_edges_countyfp;
DROP INDEX tiger.idx_tiger_faces_countyfp;
DROP INDEX tiger.tiger_place_the_geom_gist;
DROP INDEX tiger.tiger_edges_the_geom_gist;
DROP INDEX tiger.tiger_state_the_geom_gist;
DROP INDEX tiger.idx_tiger_addr_least_address;
DROP INDEX tiger.idx_tiger_addr_tlid;
DROP INDEX tiger.idx_tiger_addr_zip;
DROP INDEX tiger.idx_tiger_county_countyfp;
DROP INDEX tiger.idx_tiger_county_lookup_lower_name;
DROP INDEX tiger.idx_tiger_county_lookup_snd_name;
DROP INDEX tiger.idx_tiger_county_lower_name;
DROP INDEX tiger.idx_tiger_county_snd_name;
DROP INDEX tiger.idx_tiger_county_the_geom_gist;
DROP INDEX tiger.idx_tiger_countysub_lookup_snd_name;
DROP INDEX tiger.idx_tiger_cousub_countyfp;
DROP INDEX tiger.idx_tiger_cousub_cousubfp;
DROP INDEX tiger.idx_tiger_cousub_lower_name;
DROP INDEX tiger.idx_tiger_cousub_snd_name;
DROP INDEX tiger.idx_tiger_cousub_the_geom_gist;
DROP INDEX tiger_data.idx_tiger_data_ma_addr_least_address;
DROP INDEX tiger_data.idx_tiger_data_ma_addr_tlid;
DROP INDEX tiger_data.idx_tiger_data_ma_addr_zip;
DROP INDEX tiger_data.idx_tiger_data_ma_county_countyfp;
DROP INDEX tiger_data.idx_tiger_data_ma_county_lookup_lower_name;
DROP INDEX tiger_data.idx_tiger_data_ma_county_lookup_snd_name;
DROP INDEX tiger_data.idx_tiger_data_ma_county_lower_name;
DROP INDEX tiger_data.idx_tiger_data_ma_county_snd_name;
:
:
</pre></div><div class="refsection" title="See Also"><a name="id287193347"></a><h2>See Also</h2><p><a class="xref" href="#Install_Missing_Indexes" title="Install_Missing_Indexes">Install_Missing_Indexes</a>, <a class="xref" href="#Missing_Indexes_Generate_Script" title="Missing_Indexes_Generate_Script">Missing_Indexes_Generate_Script</a></p></div></div><div class="refentry" title="Drop_State_Tables_Generate_Script"><div class="refentry.separator"><hr></div><a name="Drop_State_Tables_Generate_Script"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Drop_State_Tables_Generate_Script ? Generates a script that drops all tables in the specified schema that are prefixed with the state abbreviation.  Defaults schema to <code class="varname">tiger_data</code> if no schema is specified.</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">Drop_State_Tables_Generate_Script</b>(</code>text  <var class="pdparam">address</var>, text  <var class="pdparam">param_schema=tiger_data</var><code>)</code>;</p></div></div><div class="refsection" title="Description"><a name="id287193413"></a><h2>Description</h2><p>Generates a script that drops all tables in the specified schema that are prefixed with the state abbreviation.  Defaults schema to <code class="varname">tiger_data</code> if no schema is specified.
		This function is useful for dropping tables of a state just before you reload a state in case something went wrong during your previous load.</p><p>Availability: 2.0.0</p></div><div class="refsection" title="Examples"><a name="id287193430"></a><h2>Examples</h2><pre class="programlisting">SELECT drop_state_tables_generate_script('PA');
DROP TABLE tiger_data.pa_addr;
DROP TABLE tiger_data.pa_county;
DROP TABLE tiger_data.pa_county_lookup;
DROP TABLE tiger_data.pa_cousub;
DROP TABLE tiger_data.pa_edges;
DROP TABLE tiger_data.pa_faces;
DROP TABLE tiger_data.pa_featnames;
DROP TABLE tiger_data.pa_place;
DROP TABLE tiger_data.pa_state;
DROP TABLE tiger_data.pa_zip_lookup_base;
DROP TABLE tiger_data.pa_zip_state;
DROP TABLE tiger_data.pa_zip_state_loc;
		</pre></div><div class="refsection" title="See Also"><a name="id287193443"></a><h2>See Also</h2><p><a class="xref" href="#Loader_Generate_Script" title="Loader_Generate_Script">Loader_Generate_Script</a></p></div></div><div class="refentry" title="Geocode"><div class="refentry.separator"><hr></div><a name="Geocode"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Geocode ? Takes in an address as a string (or other normalized address) and outputs a set of possible locations which include a point geometry in NAD 83 long lat, a normalized address for each, and the rating.  The lower the rating the more likely the match.  
			Results are sorted by lowest rating first. Can optionally pass in maximum results, defaults to 10, and restrict_region (defaults to NULL)</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">setof record <b class="fsfunc">geocode</b>(</code>varchar  <var class="pdparam">address</var>, integer  <var class="pdparam">max_results=10</var>, geometry  <var class="pdparam">restrict_region=NULL</var>, norm_addy  <var class="pdparam">OUT addy</var>, geometry  <var class="pdparam">OUT geomout</var>, integer  <var class="pdparam">OUT rating</var><code>)</code>;</p><p><code class="funcdef">setof record <b class="fsfunc">geocode</b>(</code>norm_addy  <var class="pdparam">in_addy</var>, integer  <var class="pdparam">max_results=10</var>, geometry  <var class="pdparam">restrict_region=NULL</var>, norm_addy  <var class="pdparam">OUT addy</var>, geometry  <var class="pdparam">OUT geomout</var>, integer  <var class="pdparam">OUT rating</var><code>)</code>;</p></div></div><div class="refsection" title="Description"><a name="id287193602"></a><h2>Description</h2><p>Takes in an address as a string (or already normalized address) and outputs a set of possible locations which include a point geometry in NAD 83 long lat, a <code class="varname">normalized_address</code> (addy) for each, and the rating.  The lower the rating the more likely the match.  
			Results are sorted by lowest rating first.  Uses Tiger data (edges,faces,addr), PostgreSQL fuzzy string matching (soundex,levenshtein) and PostGIS line interpolation functions to interpolate address along the Tiger edges. The higher the rating the less likely the geocode is right.
			The geocoded point is defaulted to offset 10 meters from center-line off to side (L/R) of street address is located on.</p><p>Enhanced: 2.0.0 to support Tiger 2010 structured data and revised some logic to improve speed, accuracy of geocoding, and to offset point from centerline to side of street address is located on. New parameter max_results useful for specifying ot just return the best result.</p></div><div class="refsection" title="Examples: Basic"><a name="id287193618"></a><h2>Examples: Basic</h2><p>The below examples timings are on a 3.0 GHZ single processor Windows 7 machine with 2GB ram running PostgreSQL 9.1rc1/PostGIS 2.0 loaded with all of MA,MN,CA, RI state Tiger data loaded.</p><p>Exact matches are faster to compute (61ms)</p><pre class="programlisting">SELECT g.rating, ST_X(g.geomout) As lon, ST_Y(g.geomout) As lat, 
	(addy).address As stno, (addy).streetname As street, 
	(addy).streettypeabbrev As styp, (addy).location As city, (addy).stateabbrev As st,(addy).zip 
	FROM geocode('75 State Street, Boston MA 02109') As g;  
 rating |        lon        |       lat        | stno | street | styp |  city  | st |  zip  
--------+-------------------+------------------+------+--------+------+--------+----+-------
      0 | -71.0556722990239 | 42.3589914927049 |   75 | State  | St   | Boston | MA | 02109
</pre><p>Even if zip is not passed in the geocoder can guess (took about 122-150 ms)</p><pre class="programlisting">SELECT g.rating, ST_AsText(ST_SnapToGrid(g.geomout,0.00001)) As wktlonlat, 
	(addy).address As stno, (addy).streetname As street, 
	(addy).streettypeabbrev As styp, (addy).location As city, (addy).stateabbrev As st,(addy).zip 
	FROM geocode('226 Hanover Street, Boston, MA',1) As g;  
 rating |         wktlonlat         | stno | street  | styp |  city  | st |  zip  
--------+---------------------------+------+---------+------+--------+----+-------
      1 | POINT(-71.05528 42.36316) |  226 | Hanover | St   | Boston | MA | 02113
</pre><p>Can handle misspellings and provides more than one possible solution with ratings and takes longer (500ms).</p><pre class="programlisting">SELECT g.rating, ST_AsText(ST_SnapToGrid(g.geomout,0.00001)) As wktlonlat, 
    (addy).address As stno, (addy).streetname As street, 
	(addy).streettypeabbrev As styp, (addy).location As city, (addy).stateabbrev As st,(addy).zip 
	FROM geocode('31 - 37 Stewart Street, Boston, MA 02116') As g; 
 rating |         wktlonlat         | stno | street | styp |  city  | st |  zip  
--------+---------------------------+------+--------+------+--------+----+-------
     70 | POINT(-71.06459 42.35113) |   31 | Stuart | St   | Boston | MA | 02116
	</pre><p>Using to do a batch geocode of addresses. Easiest is to set <code class="varname">max_results=1</code>. Only process those not yet geocoded (have no rating).</p><pre class="programlisting">CREATE TABLE addresses_to_geocode(addid serial PRIMARY KEY, address text,
		lon numeric, lat numeric, new_address text, rating integer);

INSERT INTO addresses_to_geocode(address)
VALUES ('529 Main Street, Boston MA, 02129'),
 ('77 Massachusetts Avenue, Cambridge, MA 02139'),
 ('25 Wizard of Oz, Walaford, KS 99912323'),
 ('26 Capen Street, Medford, MA'),
 ('124 Mount Auburn St, Cambridge, Massachusetts 02138'),
 ('950 Main Street, Worcester, MA 01610');
 
-- only update the first 3 addresses (323-704 ms -  there are caching and shared memory effects so first geocode you do is always slower) --
-- for large numbers of addresses you don't want to update all at once
-- since the whole geocode must commit at once 
-- For this example we rejoin with LEFT JOIN 
-- and set to rating to -1 rating if no match 
-- to ensure we don't regeocode a bad address 
UPDATE addresses_to_geocode
  SET  (rating, new_address, lon, lat) 
	= ( COALESCE((g.geo).rating,-1), pprint_addy((g.geo).addy),
	   ST_X((g.geo).geomout)::numeric(8,5), ST_Y((g.geo).geomout)::numeric(8,5) )
FROM (SELECT addid 
	FROM addresses_to_geocode 
	WHERE rating IS NULL ORDER BY addid LIMIT 3) As a
	LEFT JOIN (SELECT addid, (geocode(address,1)) As geo
    FROM addresses_to_geocode As ag
	WHERE ag.rating IS NULL ORDER BY addid LIMIT 3) As g ON a.addid = g.addid
WHERE a.addid = addresses_to_geocode.addid;

result
-----
Query returned successfully: 3 rows affected, 480 ms execution time.

SELECT * FROM addresses_to_geocode WHERE rating is not null;

 addid |                   address                    |    lon    |   lat    |                new_address                | rating 
-------+----------------------------------------------+-----------+----------+-------------------------------------------+--------
     1 | 529 Main Street, Boston MA, 02129            | -71.07181 | 42.38359 | 529 Main St, Boston, MA 02129             |      0
     2 | 77 Massachusetts Avenue, Cambridge, MA 02139 | -71.09428 | 42.35988 | 77 Massachusetts Ave, Cambridge, MA 02139 |      0
     3 | 25 Wizard of Oz, Walaford, KS 99912323       |           |          |                                           |     -1
</pre></div><div class="refsection" title="Examples: Using Geometry filter"><a name="id287190794"></a><h2>Examples: Using Geometry filter</h2><pre class="programlisting">
SELECT g.rating, ST_AsText(ST_SnapToGrid(g.geomout,0.00001)) As wktlonlat, 
    (addy).address As stno, (addy).streetname As street, 
	(addy).streettypeabbrev As styp, 
	(addy).location As city, (addy).stateabbrev As st,(addy).zip 
  FROM geocode('100 Federal Street, MA',
		3, 
		(SELECT ST_Union(the_geom) 
			FROM place WHERE statefp = '25' AND name = 'Lynn')::geometry
		) As g;

 rating |        wktlonlat         | stno | street  | styp | city | st |  zip
--------+--------------------------+------+---------+------+------+----+-------
      8 | POINT(-70.96796 42.4659) |  100 | Federal | St   | Lynn | MA | 01905
Total query runtime: 245 ms.
	      </pre></div><div class="refsection" title="See Also"><a name="id287190807"></a><h2>See Also</h2><p><a class="xref" href="#Normalize_Address" title="Normalize_Address">Normalize_Address</a>, <a class="xref" href="#Pprint_Addy" title="Pprint_Addy">Pprint_Addy</a>, <a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a>, <a class="xref" href="#ST_SnapToGrid" title="ST_SnapToGrid">ST_SnapToGrid</a>, <a class="xref" href="#ST_X" title="ST_X">ST_X</a>, <a class="xref" href="#ST_Y" title="ST_Y">ST_Y</a></p></div></div><div class="refentry" title="Geocode_Intersection"><div class="refentry.separator"><hr></div><a name="Geocode_Intersection"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Geocode_Intersection ? Takes in 2 streets that intersect and a state, city, zip,  and outputs a set of possible locations on the first cross street that is at the intersection, also includes a point geometry in NAD 83 long lat, a normalized address for each location, and the rating.  The lower the rating the more likely the match.  
			Results are sorted by lowest rating first. Can optionally pass in maximum results, defaults to 10</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">setof record <b class="fsfunc">geocode_intersection</b>(</code>text  <var class="pdparam"> roadway1</var>, text  <var class="pdparam"> roadway2</var>, text  <var class="pdparam"> in_state</var>, text  <var class="pdparam"> in_city</var>, text  <var class="pdparam"> in_zip</var>, integer  <var class="pdparam">max_results=10</var>, norm_addy  <var class="pdparam">OUT addy</var>, geometry  <var class="pdparam">OUT geomout</var>, integer  <var class="pdparam">OUT rating</var><code>)</code>;</p></div></div><div class="refsection" title="Description"><a name="id287190946"></a><h2>Description</h2><p>Takes in 2 streets that intersect and a state, city, zip,  and outputs a set of possible locations on the first cross street that is at the intersection, also includes a point geometry in NAD 83 long lat, a normalized address for each location, and the rating.  The lower the rating the more likely the match.  
			Results are sorted by lowest rating first. Can optionally pass in maximum results, defaults to 10.
			Returns <code class="varname">normalized_address</code> (addy) for each, geomout as the point location in nad 83 long lat, and the rating.  The lower the rating the more likely the match.  
			Results are sorted by lowest rating first.  Uses Tiger data (edges,faces,addr), PostgreSQL fuzzy string matching (soundex,levenshtein) </p><p>Availability: 2.0.0</p></div><div class="refsection" title="Examples: Basic"><a name="id287190962"></a><h2>Examples: Basic</h2><p>The below examples timings are on a 3.0 GHZ single processor Windows 7 machine with 2GB ram running PostgreSQL 9.0/PostGIS 1.5 loaded with all of MA state Tiger data loaded.</p><p>Currently a bit slow (3000 ms)</p><pre class="programlisting">SELECT pprint_addy(addy), st_astext(geomout),rating 
			FROM geocode_intersection( 'Haverford St','Germania St', 'MA', 'Boston', '02130',1); 
           pprint_addy            |         st_astext          | rating
----------------------------------+----------------------------+--------
98 Haverford St, Boston, MA 02130 | POINT(-71.101375 42.31376) |      0
</pre><p>Even if zip is not passed in the geocoder can guess (took about 3500 ms)</p><pre class="programlisting">SELECT pprint_addy(addy), st_astext(geomout),rating 
				FROM geocode_intersection('Weld', 'School', 'MA', 'Boston');
          pprint_addy          |        st_astext         | rating
-------------------------------+--------------------------+--------
 98 Weld Ave, Boston, MA 02119 | POINT(-71.099 42.314234) |      3
 99 Weld Ave, Boston, MA 02119 | POINT(-71.099 42.314234) |      3
</pre></div><div class="refsection" title="See Also"><a name="id287190989"></a><h2>See Also</h2><p><a class="xref" href="#Geocode" title="Geocode">Geocode</a>, <a class="xref" href="#Pprint_Addy" title="Pprint_Addy">Pprint_Addy</a>, <a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a></p></div></div><div class="refentry" title="Get_Tract"><div class="refentry.separator"><hr></div><a name="Get_Tract"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Get_Tract ? Returns census tract or field from tract table of where the geometry is located. Default to returning short name of tract.</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">get_tract</b>(</code>geometry  <var class="pdparam"> loc_geom</var>, text  <var class="pdparam"> output_field='name'</var><code>)</code>;</p></div></div><div class="refsection" title="Description"><a name="id287191057"></a><h2>Description</h2><p>Given a geometry will return the census tract location of that geometry. NAD 83 long lat is assumed if no spatial ref sys is specified.</p><p>Availability: 2.0.0</p></div><div class="refsection" title="Examples: Basic"><a name="id287191069"></a><h2>Examples: Basic</h2><pre class="programlisting">SELECT get_tract(ST_Point(-71.101375, 42.31376) ) As tract_name;
tract_name
---------
1203.01
		</pre><pre class="programlisting">--this one returns the tiger geoid
SELECT get_tract(ST_Point(-71.101375, 42.31376), 'tract_id' ) As tract_id;
tract_id
---------
25025120301</pre></div><div class="refsection" title="See Also"><a name="id287191086"></a><h2>See Also</h2><p><a class="xref" href="#Geocode" title="Geocode">Geocode</a>&gt;</p></div></div><div class="refentry" title="Install_Missing_Indexes"><div class="refentry.separator"><hr></div><a name="Install_Missing_Indexes"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Install_Missing_Indexes ? Finds all tables with key columns used in geocoder joins and filter conditions that are missing used indexes on those columns and will add them.</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">Install_Missing_Indexes</b>(</code><code>)</code>;</p></div></div><div class="refsection" title="Description"><a name="id287191131"></a><h2>Description</h2><p>Finds all tables in <code class="varname">tiger</code> and <code class="varname">tiger_data</code> schemas with key columns used in geocoder joins and filters that are missing indexes on those columns and will output the SQL DDL to
		    define the index for those tables and then execute the generated script. This is a helper function that adds new indexes needed to make queries faster that may have been missing during the load process.
		   This function is a companion to <a class="xref" href="#Missing_Indexes_Generate_Script" title="Missing_Indexes_Generate_Script">Missing_Indexes_Generate_Script</a> that in addition to generating the create index script, also executes it.
		   It is called as part of the <code class="filename">update_geocode.sql</code> upgrade script.</p><p>Availability: 2.0.0</p></div><div class="refsection" title="Examples"><a name="id287191158"></a><h2>Examples</h2><pre class="programlisting">SELECT install_missing_indexes();
		 install_missing_indexes
-------------------------
 t
		</pre></div><div class="refsection" title="See Also"><a name="id287191171"></a><h2>See Also</h2><p><a class="xref" href="#Loader_Generate_Script" title="Loader_Generate_Script">Loader_Generate_Script</a>, <a class="xref" href="#Missing_Indexes_Generate_Script" title="Missing_Indexes_Generate_Script">Missing_Indexes_Generate_Script</a></p></div></div><div class="refentry" title="Loader_Generate_Script"><div class="refentry.separator"><hr></div><a name="Loader_Generate_Script"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Loader_Generate_Script ? Generates a shell script for the specified platform for the specified states that will download Tiger data, stage and load into <code class="varname">tiger_data</code> schema. Each state script is returned as a separate record. Latest version supports Tiger 2010 structural changes and also loads census tract, block groups, and blocks tables.</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">setof text <b class="fsfunc">loader_generate_script</b>(</code>text[] <var class="pdparam">param_states</var>, text <var class="pdparam">os</var><code>)</code>;</p></div></div><div class="refsection" title="Description"><a name="id287191304"></a><h2>Description</h2><p>Generates a shell script for the specified platform for the specified states that will download Tiger data, stage and load into <code class="varname">tiger_data</code> schema.  Each state script is returned as a separate record.</p><p>It uses unzip on Linux (7-zip on Windows by default) and wget to do the downloading. It uses <a class="xref" href="#shp2pgsql_usage" title="4.4.2. ローダを使う">「ローダを使う」</a> to load in the data. Note the smallest unit it does is a whole state, but you can overwrite this by downloading the files yourself.  It will only
		process the files in the staging and temp folders.</p><p>It uses the following control tables to control the process and different OS shell syntax variations.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><code class="varname">loader_variables</code> keeps track of various variables such as census site, year, data and staging schemas</p></li><li class="listitem"><p><code class="varname">loader_platform</code> profiles of various platforms and where the various executables are located.  Comes with windows and linux. More can be added.</p></li><li class="listitem"><p><code class="varname">loader_lookuptables</code> each record defines a kind of table (state, county), whether to process records in it and how to load them in.  Defines the steps to import data, stage data, add, removes columns, indexes, and constraints for each.  Each table is prefixed with the state and inherits from a table in the tiger schema. e.g. creates <code class="varname">tiger_data.ma_faces</code> which inherits from <code class="varname">tiger.faces</code></p></li></ol></div><p>Availability: 2.0.0 to support Tiger 2010 structured data and load census tract (tract), block groups (bg), and blocks (tabblocks) tables .</p></div><div class="refsection" title="Examples"><a name="id287191368"></a><h2>Examples</h2><p>Generate script to load up data for 2 states in Windows shell script format.</p><pre class="programlisting">SELECT loader_generate_script(ARRAY['MA','RI'], 'windows') AS result;
-- result --
set STATEDIR="\gisdata\www2.census.gov\geo\pvs\tiger2010st\44_Rhode_Island"
set TMPDIR=\gisdata\temp\
set UNZIPTOOL="C:\Program Files\7-Zip\7z.exe"
set WGETTOOL="C:\wget\wget.exe"
set PGBIN=C:\Program Files\PostgreSQL\8.4\bin\
set PGPORT=5432
set PGHOST=localhost
set PGUSER=postgres
set PGPASSWORD=yourpasswordhere
set PGDATABASE=geocoder
set PSQL="%PGBIN%psql"
set SHP2PGSQL="%PGBIN%shp2pgsql"

%WGETTOOL% http://www2.census.gov/geo/pvs/tiger2010st/44_Rhode_Island/ --no-parent --relative --recursive --level=2 --accept=zip,txt --mirror --reject=html
:
:</pre><p>Generate sh script</p><pre class="programlisting">SELECT loader_generate_script(ARRAY['MA','RI'], 'sh') AS result;
-- result --
STATEDIR="/gisdata/www2.census.gov/geo/pvs/tiger2010st/44_Rhode_Island" 
TMPDIR="/gisdata/temp/"
UNZIPTOOL=unzip
PGPORT=5432
PGHOST=localhost
PGUSER=postgres
PGPASSWORD=yourpasswordhere
PGDATABASE=geocoder
PSQL=psql
SHP2PGSQ=shp2pgsql

wget http://www2.census.gov/geo/pvs/tiger2010st/44_Rhode_Island/ --no-parent --relative --recursive --level=2 --accept=zip,txt --mirror --reject=html
:
:</pre></div><div class="refsection" title="See Also"><a name="id287191393"></a><h2>See Also</h2><p></p></div></div><div class="refentry" title="Loader_Generate_Census_Script"><div class="refentry.separator"><hr></div><a name="Loader_Generate_Census_Script"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Loader_Generate_Census_Script ? Generates a shell script for the specified platform for the specified states that will download Tiger census state tract, bg, and tabblocks data tables, stage and load into <code class="varname">tiger_data</code> schema. Each state script is returned as a separate record.</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">setof text <b class="fsfunc">loader_generate_census_script</b>(</code>text[] <var class="pdparam">param_states</var>, text <var class="pdparam">os</var><code>)</code>;</p></div></div><div class="refsection" title="Description"><a name="id287191452"></a><h2>Description</h2><p>Generates a shell script for the specified platform for the specified states that will download Tiger data census state <code class="varname">tract</code>, block groups <code class="varname">bg</code>, and <code class="varname">tabblocks</code> data tables, stage and load into <code class="varname">tiger_data</code> schema.  Each state script is returned as a separate record.</p><p>It uses unzip on Linux (7-zip on Windows by default) and wget to do the downloading. It uses <a class="xref" href="#shp2pgsql_usage" title="4.4.2. ローダを使う">「ローダを使う」</a> to load in the data. Note the smallest unit it does is a whole state.  It will only
		process the files in the staging and temp folders.</p><p>It uses the following control tables to control the process and different OS shell syntax variations.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><code class="varname">loader_variables</code> keeps track of various variables such as census site, year, data and staging schemas</p></li><li class="listitem"><p><code class="varname">loader_platform</code> profiles of various platforms and where the various executables are located.  Comes with windows and linux. More can be added.</p></li><li class="listitem"><p><code class="varname">loader_lookuptables</code> each record defines a kind of table (state, county), whether to process records in it and how to load them in.  Defines the steps to import data, stage data, add, removes columns, indexes, and constraints for each.  Each table is prefixed with the state and inherits from a table in the tiger schema. e.g. creates <code class="varname">tiger_data.ma_faces</code> which inherits from <code class="varname">tiger.faces</code></p></li></ol></div><p>Availability: 2.0.0 </p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><a class="xref" href="#Loader_Generate_Script" title="Loader_Generate_Script">Loader_Generate_Script</a> includes this logic, but if you installed tiger geocoder prior to PostGIS 2.0.0 alpha5, you'll need to run this on the states you have already done
			to get these additional tables.</p></td></tr></table></div></div><div class="refsection" title="Examples"><a name="id287191568"></a><h2>Examples</h2><p>Generate script to load up data for select states in Windows shell script format.</p><pre class="programlisting">SELECT loader_generate_census_script(ARRAY['MA'], 'windows');
-- result --
set STATEDIR="\gisdata\www2.census.gov\geo\pvs\tiger2010st\25_Massachusetts"
set TMPDIR=\gisdata\temp\
set UNZIPTOOL="C:\Program Files\7-Zip\7z.exe"
set WGETTOOL="C:\wget\wget.exe"
set PGBIN=C:\projects\pg\pg91win\bin\
set PGPORT=5432
set PGHOST=localhost
set PGUSER=postgres
set PGPASSWORD=yourpasswordhere
set PGDATABASE=tiger_postgis20
set PSQL="%PGBIN%psql"
set SHP2PGSQL="%PGBIN%shp2pgsql"
cd \gisdata

%WGETTOOL% http://www2.census.gov/geo/pvs/tiger2010st/25_Massachusetts/25/ --no-parent --relative --accept=*bg10.zip,*tract10.zip,*tabblock10.zip --mirror --reject=html
del %TMPDIR%\*.* /Q
%PSQL% -c "DROP SCHEMA tiger_staging CASCADE;"
%PSQL% -c "CREATE SCHEMA tiger_staging;"
cd %STATEDIR%
for /r %%z in (*.zip) do %UNZIPTOOL% e %%z  -o%TMPDIR% 
cd %TMPDIR%	
%PSQL% -c "CREATE TABLE tiger_data.MA_tract(CONSTRAINT pk_MA_tract PRIMARY KEY (tract_id) ) INHERITS(tiger.tract); " 
%SHP2PGSQL% -c -s 4269 -g the_geom   -W "latin1" tl_2010_25_tract10.dbf tiger_staging.ma_tract10 | %PSQL%
%PSQL% -c "ALTER TABLE tiger_staging.MA_tract10 RENAME geoid10 TO tract_id;  SELECT loader_load_staged_data(lower('MA_tract10'), lower('MA_tract')); "
%PSQL% -c "CREATE INDEX tiger_data_MA_tract_the_geom_gist ON tiger_data.MA_tract USING gist(the_geom);"
%PSQL% -c "VACUUM ANALYZE tiger_data.MA_tract;"
%PSQL% -c "ALTER TABLE tiger_data.MA_tract ADD CONSTRAINT chk_statefp CHECK (statefp = '25');"
: </pre><p>Generate sh script</p><pre class="programlisting">STATEDIR="/gisdata/www2.census.gov/geo/pvs/tiger2010st/25_Massachusetts" 
TMPDIR="/gisdata/temp/"
UNZIPTOOL=unzip
WGETTOOL="/usr/bin/wget"
export PGBIN=/usr/pgsql-9.0/bin
export PGPORT=5432
export PGHOST=localhost
export PGUSER=postgres
export PGPASSWORD=yourpasswordhere
export PGDATABASE=geocoder
PSQL=${PGBIN}/psql
SHP2PGSQL=${PGBIN}/shp2pgsql
cd /gisdata

wget http://www2.census.gov/geo/pvs/tiger2010st/25_Massachusetts/25/ --no-parent --relative --accept=*bg10.zip,*tract10.zip,*tabblock10.zip --mirror --reject=html
rm -f ${TMPDIR}/*.*
${PSQL} -c "DROP SCHEMA tiger_staging CASCADE;"
${PSQL} -c "CREATE SCHEMA tiger_staging;"
cd $STATEDIR
for z in *.zip; do $UNZIPTOOL -o -d $TMPDIR $z; done
:
: </pre></div><div class="refsection" title="See Also"><a name="id287191591"></a><h2>See Also</h2><p><a class="xref" href="#Loader_Generate_Script" title="Loader_Generate_Script">Loader_Generate_Script</a></p></div></div><div class="refentry" title="Missing_Indexes_Generate_Script"><div class="refentry.separator"><hr></div><a name="Missing_Indexes_Generate_Script"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Missing_Indexes_Generate_Script ? Finds all tables with key columns used in geocoder joins that are missing indexes on those columns and will output the SQL DDL to
		    define the index for those tables.</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">Missing_Indexes_Generate_Script</b>(</code><code>)</code>;</p></div></div><div class="refsection" title="Description"><a name="id287191635"></a><h2>Description</h2><p>Finds all tables in <code class="varname">tiger</code> and <code class="varname">tiger_data</code> schemas with key columns used in geocoder joins that are missing indexes on those columns and will output the SQL DDL to
		    define the index for those tables. This is a helper function that adds new indexes needed to make queries faster that may have been missing during the load process.
		    As the geocoder is improved, this function will be updated to accommodate new indexes being used. If this function outputs nothing, it means
		    all your tables have what we think are the key indexes already in place.</p><p>Availability: 2.0.0</p></div><div class="refsection" title="Examples"><a name="id287191654"></a><h2>Examples</h2><pre class="programlisting">SELECT missing_indexes_generate_script();
-- output: This was run on a database that was created before many corrections were made to the loading script ---
CREATE INDEX idx_tiger_county_countyfp ON tiger.county USING btree(countyfp);
CREATE INDEX idx_tiger_cousub_countyfp ON tiger.cousub USING btree(countyfp);
CREATE INDEX idx_tiger_edges_tfidr ON tiger.edges USING btree(tfidr);
CREATE INDEX idx_tiger_edges_tfidl ON tiger.edges USING btree(tfidl);
CREATE INDEX idx_tiger_zip_lookup_all_zip ON tiger.zip_lookup_all USING btree(zip);
CREATE INDEX idx_tiger_data_ma_county_countyfp ON tiger_data.ma_county USING btree(countyfp);
CREATE INDEX idx_tiger_data_ma_cousub_countyfp ON tiger_data.ma_cousub USING btree(countyfp);
CREATE INDEX idx_tiger_data_ma_edges_countyfp ON tiger_data.ma_edges USING btree(countyfp);
CREATE INDEX idx_tiger_data_ma_faces_countyfp ON tiger_data.ma_faces USING btree(countyfp);
		</pre></div><div class="refsection" title="See Also"><a name="id287191667"></a><h2>See Also</h2><p><a class="xref" href="#Loader_Generate_Script" title="Loader_Generate_Script">Loader_Generate_Script</a>, <a class="xref" href="#Install_Missing_Indexes" title="Install_Missing_Indexes">Install_Missing_Indexes</a></p></div></div><div class="refentry" title="Normalize_Address"><div class="refentry.separator"><hr></div><a name="Normalize_Address"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Normalize_Address ? Given a textual street address, returns a composite <code class="varname">norm_addy</code> type that has road suffix, prefix and type standardized, street, streetname etc. broken into separate fields.  This function 
		will work with just the lookup data packaged with the tiger_geocoder (no need for tiger census data).</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">norm_addy <b class="fsfunc">normalize_address</b>(</code>varchar  <var class="pdparam">in_address</var><code>)</code>;</p></div></div><div class="refsection" title="Description"><a name="id287191723"></a><h2>Description</h2><p>Given a textual street address, returns a composite <code class="varname">norm_addy</code> type that has road suffix, prefix and type standardized, street, streetname etc. broken into separate fields.  This is the first step in the geocoding process to 
		    get all addresses into normalized postal form. No other data is required aside from what is packaged with the geocoder.</p><p>This function just uses the various direction/state/suffix lookup tables preloaded with the tiger_geocoder and located in the <code class="varname">tiger</code> schema, so it doesn't need you to download tiger census data or any other additional data to make use of it.
		 You may find the need to add more abbreviations or alternative namings to the various lookup tables in the  <code class="varname">tiger</code> schema.</p><p>It uses various control lookup tables located in <code class="varname">tiger</code> schema to normalize the input address.</p><p>Fields in the <code class="varname">norm_addy</code> type object returned by this function in this order where  () indicates a field required by the geocoder, [] indicates an optional field:</p><p>(address) [predirAbbrev] (streetName) [streetTypeAbbrev] [postdirAbbrev] [internal] [location] [stateAbbrev] [zip]</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><code class="varname">address</code> is an integer:  The street number</p></li><li class="listitem"><p><code class="varname">predirAbbrev</code> is varchar: Directional prefix of road such as N, S, E, W etc.  These are controlled using the <code class="varname">direction_lookup</code> table.</p></li><li class="listitem"><p><code class="varname">streetName</code> varchar</p></li><li class="listitem"><p><code class="varname">streetTypeAbbrev</code> varchar abbreviated version of street type: e.g. St, Ave, Cir.  These are controlled using the <code class="varname">street_type_lookup</code> table.</p></li><li class="listitem"><p><code class="varname">postdirAbbrev</code> varchar abbreviated directional suffice of road N, S, E, W etc. These are controlled using the <code class="varname">direction_lookup</code> table.</p></li><li class="listitem"><p><code class="varname">internal</code> varchar internal address such as an apartment or suite number.</p></li><li class="listitem"><p><code class="varname">location</code> varchar usually a city or governing province.</p></li><li class="listitem"><p><code class="varname">stateAbbrev</code> varchar two character US State.  e.g MA, NY, MI.  These are controlled by the <code class="varname">state_lookup</code> table.</p></li><li class="listitem"><p><code class="varname">zip</code> varchar 5-digit zipcode. e.g. 02109.</p></li><li class="listitem"><p><code class="varname">parsed</code> boolean - denotes if addess was formed from normalize process. The normalize_address function sets this to true before returning the address.</p></li></ol></div></div><div class="refsection" title="Examples"><a name="id287191938"></a><h2>Examples</h2><p>Output select fields.  Use <a class="xref" href="#Pprint_Addy" title="Pprint_Addy">Pprint_Addy</a> if you want a pretty textual output.</p><pre class="programlisting">SELECT address As orig, (g.na).streetname, (g.na).streettypeabbrev
 FROM (SELECT address, normalize_address(address) As na
        FROM addresses_to_geocode) As g;
        
                        orig                         |  streetname   | streettypeabbrev 
-----------------------------------------------------+---------------+------------------
 28 Capen Street, Medford, MA                        | Capen         | St
 124 Mount Auburn St, Cambridge, Massachusetts 02138 | Mount Auburn  | St
 950 Main Street, Worcester, MA 01610                | Main          | St
 529 Main Street, Boston MA, 02129                   | Main          | St
 77 Massachusetts Avenue, Cambridge, MA 02139        | Massachusetts | Ave
 25 Wizard of Oz, Walaford, KS 99912323              | Wizard of Oz  | 
		</pre></div><div class="refsection" title="See Also"><a name="id287191957"></a><h2>See Also</h2><p><a class="xref" href="#Geocode" title="Geocode">Geocode</a>, <a class="xref" href="#Pprint_Addy" title="Pprint_Addy">Pprint_Addy</a></p></div></div><div class="refentry" title="Pprint_Addy"><div class="refentry.separator"><hr></div><a name="Pprint_Addy"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Pprint_Addy ? Given a <code class="varname">norm_addy</code> composite type object, returns a pretty print representation of it. Usually used in conjunction with normalize_address.</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">varchar <b class="fsfunc">pprint_addy</b>(</code>norm_addy  <var class="pdparam">in_addy</var><code>)</code>;</p></div></div><div class="refsection" title="Description"><a name="id287192049"></a><h2>Description</h2><p>Given a <code class="varname">norm_addy</code> composite type object, returns a pretty print representation of it. No other data is required aside from what is packaged with the geocoder.</p><p>Usually used in conjunction with <a class="xref" href="#Normalize_Address" title="Normalize_Address">Normalize_Address</a>.</p></div><div class="refsection" title="Examples"><a name="id287192069"></a><h2>Examples</h2><p>Pretty print a single address</p><pre class="programlisting">SELECT pprint_addy(normalize_address('202 East Fremont Street, Las Vegas, Nevada 89101')) As pretty_address;
            pretty_address
---------------------------------------
 202 E Fremont St, Las Vegas, NV 89101
		</pre><p>Pretty print address a table of addresses</p><pre class="programlisting">SELECT address As orig, pprint_addy(normalize_address(address)) As pretty_address
        FROM addresses_to_geocode;
        
                        orig                         |              pretty_address
-----------------------------------------------------+-------------------------------------------
 529 Main Street, Boston MA, 02129                   | 529 Main St, Boston MA, 02129
 77 Massachusetts Avenue, Cambridge, MA 02139        | 77 Massachusetts Ave, Cambridge, MA 02139
 28 Capen Street, Medford, MA                        | 28 Capen St, Medford, MA
 124 Mount Auburn St, Cambridge, Massachusetts 02138 | 124 Mount Auburn St, Cambridge, MA 02138
 950 Main Street, Worcester, MA 01610                | 950 Main St, Worcester, MA 01610</pre></div><div class="refsection" title="See Also"><a name="id287192092"></a><h2>See Also</h2><p><a class="xref" href="#Normalize_Address" title="Normalize_Address">Normalize_Address</a></p></div></div><div class="refentry" title="Reverse_Geocode"><div class="refentry.separator"><hr></div><a name="Reverse_Geocode"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Reverse_Geocode ? Takes a geometry point in a known spatial ref sys and returns a record containing an array of theoretically possible addresses and an array of cross streets.  If include_strnum_range = true, includes the street range in the cross streets.</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">record <b class="fsfunc">Reverse_Geocode</b>(</code>geometry  <var class="pdparam">pt</var>, boolean  <var class="pdparam">include_strnum_range=false</var>, geometry[]  <var class="pdparam">OUT intpt</var>, norm_addy[]  <var class="pdparam">OUT addy</var>, varchar[]  <var class="pdparam">OUT street</var><code>)</code>;</p></div></div><div class="refsection" title="Description"><a name="id287192212"></a><h2>Description</h2><p>Takes a geometry point in a known spatial ref and returns a record containing an array of theoretically possible addresses and an array of cross streets.  If include_strnum_range = true, includes the street range in the cross streets.
        include_strnum_range defaults to false if not passed in. Addresses are sorted according to which road a point is closest to so first address is most likely the right one.</p><p>Why do we say theoretical instead of actual addresses.  The Tiger data doesn't have real addresses, but just street ranges.  As such the theoretical address is an interpolated address based on the
        street ranges. Like for example interpolating one of my addresses returns a 26 Court St. and 26 Court Sq., though there is no such place as 26 Court Sq.  This is because a point may be at a corner of 2
        streets and thus the logic interpolates along both streets.  The logic also assumes addresses are equally spaced along a street, which of course is wrong since you can have a municipal building taking up
            a good chunk of the street range and the rest of the buildings are clustered at the end.</p><p>Note: Hmm this function relies on Tiger data.  If you have not loaded data covering the region of this point, then hmm you will get a record filled with NULLS.</p><p> Returned elements of the record are as follows:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><code class="varname">intpt</code> is an array of points:  These are the center line points on the street closest to the input point. There are as many points as there are addresses.</p></li><li class="listitem"><p><code class="varname">addy</code> is an array of norm_addy (normalized addresses):  These are an array of possible addresses that fit the input point.  The first one in the array is most likely.
            	Generally there should be only one, except in the case when a point is at the corner of 2 or 3 streets, or the point is somewhere on the road and not off to the side.</p></li><li class="listitem"><p><code class="varname">street</code> an array of varchar:  These are cross streets (or the street) (streets that intersect or are the street the point is projected to be on).</p></li></ol></div><p>Availability: 2.0.0 </p></div><div class="refsection" title="Examples"><a name="id287192268"></a><h2>Examples</h2><p>Example of a point at the corner of two streets, but closest to one.  This is approximate location of MIT: 77 Massachusetts Ave, Cambridge, MA 02139  
            Note that although we don't have 3 streets, PostgreSQL will just return null for entries above our upper bound so safe to use.  This includes street ranges</p><pre class="programlisting">SELECT pprint_addy(r.addy[1]) As st1, pprint_addy(r.addy[2]) As st2, pprint_addy(r.addy[3]) As st3, 
        	array_to_string(r.street, ',') As cross_streets 
        FROM reverse_geocode(ST_GeomFromText('POINT(-71.093902 42.359446)',4269),true) As r;
       
 result
 ------
      st1                                  | st2 | st3 |               cross_streets
-------------------------------------------+-----+-----+----------------------------------------------
 67 Massachusetts Ave, Cambridge, MA 02139 |     |     | 67 - 127 Massachusetts Ave,32 - 88 Vassar St</pre><p>Here we choose not to include the address ranges for the cross streets and picked a location 
really really close to a corner of 2 streets thus could be known by two different addresses.</p><pre class="programlisting">SELECT pprint_addy(r.addy[1]) As st1, pprint_addy(r.addy[2]) As st2, 
pprint_addy(r.addy[3]) As st3, array_to_string(r.street, ',') As cross_str
FROM reverse_geocode(ST_GeomFromText('POINT(-71.06941 42.34225)',4269)) As r;

result
--------
               st1               |               st2               | st3 | cross_str
---------------------------------+---------------------------------+-----+------------------------
 5 Bradford St, Boston, MA 02118 | 49 Waltham St, Boston, MA 02118 |     | Waltham St
</pre><p>For this one we reuse our geocoded example from <a class="xref" href="#Geocode" title="Geocode">Geocode</a> and we only want the primary address and at most 2 cross streets.</p><pre class="programlisting">SELECT actual_addr, lon, lat, pprint_addy((rg).addy[1]) As int_addr1, 
	(rg).street[1] As cross1, (rg).street[2] As cross2
FROM (SELECT address As actual_addr, lon, lat,
    reverse_geocode( ST_SetSRID(ST_Point(lon,lat),4326) ) As rg
    FROM addresses_to_geocode WHERE rating &gt; -1) As foo;

                     actual_addr                     |    lon    |   lat    |                 int_addr1                 |     cross1      |   cross2   
-----------------------------------------------------+-----------+----------+-------------------------------------------+-----------------+------------
 529 Main Street, Boston MA, 02129                   | -71.07181 | 42.38359 | 527 Main St, Boston, MA 02129             | Medford St      | 
 77 Massachusetts Avenue, Cambridge, MA 02139        | -71.09428 | 42.35988 | 77 Massachusetts Ave, Cambridge, MA 02139 | Vassar St       | 
 26 Capen Street, Medford, MA                        | -71.12377 | 42.41101 | 9 Edison Ave, Medford, MA 02155           | Capen St        | Tesla Ave
 124 Mount Auburn St, Cambridge, Massachusetts 02138 | -71.12304 | 42.37328 | 3 University Rd, Cambridge, MA 02138      | Mount Auburn St | 
 950 Main Street, Worcester, MA 01610                | -71.82368 | 42.24956 | 3 Maywood St, Worcester, MA 01603         | Main St         | Maywood Pl
</pre></div><div class="refsection" title="See Also"><a name="id287192304"></a><h2>See Also</h2><p><a class="xref" href="#Pprint_Addy" title="Pprint_Addy">Pprint_Addy</a>, <a class="xref" href="#Geocode" title="Geocode">Geocode</a></p></div></div><div class="refentry" title="Topology_Load_Tiger"><div class="refentry.separator"><hr></div><a name="Topology_Load_Tiger"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Topology_Load_Tiger ? Loads a defined region of tiger data into a PostGIS Topology and transforming the tiger data to spatial reference of the topology
        	and snapping to the precision tolerance of the topology.</p></div><div class="refsynopsisdiv" title="概要"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">Topology_Load_Tiger</b>(</code>varchar  <var class="pdparam">topo_name</var>, varchar  <var class="pdparam">region_type</var>, varchar  <var class="pdparam">region_id</var><code>)</code>;</p></div></div><div class="refsection" title="Description"><a name="id287192374"></a><h2>Description</h2><p>Loads a defined region of tiger data into a PostGIS Topology. The faces, nodes and edges are transformed to the spatial reference system of the target topology and points are snapped to the tolerance of the target topology. The created faces, nodes, edges maintain the same ids as the original Tiger data faces, nodes, edges
        so that datasets can be in the future be more easily reconciled with tiger data. Returns summary details about the process.</p><p>This would be useful for example for redistricting data where you require the newly formed polygons to follow the center lines of streets and for the resulting polygons not to overlap.</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>This function relies on Tiger data as well as the installation of the PostGIS topology module.  For more information, refer to <a class="xref" href="#Topology" title="第11章 トポロジ">11章<i>トポロジ</i></a> and <a class="xref" href="#installation_configuration" title="2.4.1. コンフィギュレーション">「コンフィギュレーション」</a>.  If you have not loaded data covering the region of interest, then no topology records will be created. This function will also fail if you have not created a topology using the topology functions.</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Most topology validation errors are a result of tolerance issues where after transformation the edges points don't quite line up or overlap. 
        To remedy the situation you may want to increase or lower the precision if you get topology validation failures.</p></td></tr></table></div><p> Required arguments:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><code class="varname">topo_name</code> The name of an existing PostGIS topology to load data into.</p></li><li class="listitem"><p><code class="varname">region_type</code> The type of bounding region. Currently only <code class="varname">place</code> and <code class="varname">county</code> are supported.  Plan is to have several more.  This is the table to look into to define the region bounds.  e.g <code class="varname">tiger.place</code>, <code class="varname">tiger.county</code></p></li><li class="listitem"><p><code class="varname">region_id</code> This is what TIGER calls the geoid.  It is the unique identifier of the region in the table.  For place it is the  <code class="varname">plcidfp</code> column in <code class="varname">tiger.place</code>.  For county it is the <code class="varname">cntyidfp</code> column in <code class="varname">tiger.county</code>
            </p></li></ol></div><p>Availability: 2.0.0 </p></div><div class="refsection" title="Example: Boston, Massachusetts Topology"><a name="id287192470"></a><h2>Example: Boston, Massachusetts Topology</h2><p>Create a topology for Boston, Massachusetts in Mass State Plane Feet (2249) 
      	with tolerance 0.25 feet and then load in Boston city tiger faces, edges, nodes.</p><pre class="programlisting">SELECT topology.CreateTopology('topo_boston', 2249, 0.25);
createtopology
--------------
   15
-- 60,902 ms ~ 1 minute on windows 7 desktop running 9.1 (with 5 states tiger data loaded) 
SELECT tiger.topology_load_tiger('topo_boston', 'place', '2507000'); 
-- topology_loader_tiger --
29722 edges holding in temporary. 11108 faces added. 1875 edges of faces added.  20576 nodes added.  
19962 nodes contained in a face.  0 edge start end corrected.  31597 edges added. 
 
-- 41 ms --
SELECT topology.TopologySummary('topo_boston');
 -- topologysummary--
Topology topo_boston (15), SRID 2249, precision 0.25
20576 nodes, 31597 edges, 11109 faces, 0 topogeoms in 0 layers

-- 28,797 ms to validate yeh returned no errors --
SELECT * FROM 
    topology.ValidateTopology('topo_boston'); 
    
       error       |   id1    |    id2
-------------------+----------+-----------
      </pre></div><div class="refsection" title="Example: Suffolk, Massachusetts Topology"><a name="id287192484"></a><h2>Example: Suffolk, Massachusetts Topology</h2><p>Create a topology for Suffolk, Massachusetts in Mass State Plane Meters (26986) 
      	with tolerance 0.25 meters and then load in Suffolk county tiger faces, edges, nodes.</p><pre class="programlisting">SELECT topology.CreateTopology('topo_suffolk', 26986, 0.25);
-- this took 56,275 ms ~ 1 minute on Windows 7 32-bit with 5 states of tiger loaded
-- must have been warmed up after loading boston
SELECT tiger.topology_load_tiger('topo_suffolk', 'county', '25025');  
-- topology_loader_tiger --
 36003 edges holding in temporary. 13518 faces added. 2172 edges of faces added. 
 24761 nodes added.  24075 nodes contained in a face.  0 edge start end corrected.  38175 edges added. 
-- 31 ms --
SELECT topology.TopologySummary('topo_suffolk');
 -- topologysummary--
 Topology topo_suffolk (14), SRID 26986, precision 0.25
24761 nodes, 38175 edges, 13519 faces, 0 topogeoms in 0 layers

-- 33,606 ms to validate --
SELECT * FROM 
    topology.ValidateTopology('topo_suffolk'); 
    
       error       |   id1    |    id2
-------------------+----------+-----------
 coincident nodes  | 81045651 |  81064553
 edge crosses node | 81045651 |  85737793
 edge crosses node | 81045651 |  85742215
 edge crosses node | 81045651 | 620628939
 edge crosses node | 81064553 |  85697815
 edge crosses node | 81064553 |  85728168
 edge crosses node | 81064553 |  85733413
      </pre></div><div class="refsection" title="See Also"><a name="id287192498"></a><h2>See Also</h2><p><a class="xref" href="#CreateTopology" title="CreateTopology">CreateTopology</a>, <a class="xref" href="#CreateTopoGeom" title="CreateTopoGeom">CreateTopoGeom</a>, <a class="xref" href="#TopologySummary" title="TopologySummary">TopologySummary</a>, <a class="xref" href="#ValidateTopology" title="ValidateTopology">ValidateTopology</a></p></div></div></div></div><div class="chapter" title="第13章 PostGIS空間関数索引"><div class="titlepage"><div><div><h2 class="title"><a name="PostGIS_Special_Functions_Index"></a>第13章 PostGIS空間関数索引</h2></div></div></div><div class="toc"><p><b>目次</b></p><dl><dt><span class="sect1"><a href="#PostGIS_Aggregate_Functions">13.1. PostGIS集計関数</a></span></dt><dt><span class="sect1"><a href="#PostGIS_SQLMM_Functions">13.2. PostGIS SQL-MM対応関数</a></span></dt><dt><span class="sect1"><a href="#PostGIS_GeographyFunctions">13.3. PostGISジオグラフィ対応関数</a></span></dt><dt><span class="sect1"><a href="#PostGIS_RasterFunctions">13.4. PostGISラスタ対応関数</a></span></dt><dt><span class="sect1"><a href="#PostGIS_Geometry_DumpFunctions">13.5. PostGISジオメトリ/ジオグラフィ/ラスタダンプ関数</a></span></dt><dt><span class="sect1"><a href="#PostGIS_BoxFunctions">13.6. PostGISボックス関数</a></span></dt><dt><span class="sect1"><a href="#PostGIS_3D_Functions">13.7. 3次元対応PostGIS関数</a></span></dt><dt><span class="sect1"><a href="#PostGIS_Curved_GeometryFunctions">13.8. PostGIS曲線ジオメトリ対応関数</a></span></dt><dt><span class="sect1"><a href="#PostGIS_PS_GeometryFunctions">13.9. PostGIS多面体サーフェス対応関数</a></span></dt><dt><span class="sect1"><a href="#PostGIS_TypeFunctionMatrix">13.10. PostGIS関数対応マトリクス</a></span></dt><dt><span class="sect1"><a href="#NewFunctions">13.11. 新規作成/機能強化/変更されたPostGIS関数</a></span></dt><dd><dl><dt><span class="sect2"><a href="#NewFunctions_2_0">13.11.1. PostGIS 2.0で新規作成/機能強化/変更された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_2_0_Changed">13.11.2. PostGIS 2.0での関数の挙動変更</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_1_5">13.11.3. PostGIS 1.5で新規作成/機能強化/挙動変更された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_1_4">13.11.4. PostGIS 1.4で新規作成/機能強化/挙動変更された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_1_3">13.11.5. PostGIS 1.3で新規作成された関数</a></span></dt></dl></dd></dl></div><div class="sect1" title="13.1. PostGIS集計関数"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="PostGIS_Aggregate_Functions"></a>13.1. PostGIS集計関数</h2></div></div></div><p>次に示す関数は、PostGISが提供する、sumやaverageのような他のSQL集計関数と同じような、空間集計関数です。</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><a class="link" href="#ST_3DExtent" title="ST_3DExtent">ST_3DExtent</a> - ジオメトリのbox3Dバウンディングボックスを返す集計関数です。</li><li class="listitem"><a class="link" href="#ST_Accum" title="ST_Accum">ST_Accum</a> - 集計関数です。ジオメトリの配列を生成します。</li><li class="listitem"><a class="link" href="#ST_Collect" title="ST_Collect">ST_Collect</a> - 他のジオメトリのコレクションから、指定したST_Geometry値を返します。</li><li class="listitem"><a class="link" href="#ST_Extent" title="ST_Extent">ST_Extent</a> - ジオメトリのバウンディングボックスを返す集計関数です。</li><li class="listitem"><a class="link" href="#ST_MakeLine" title="ST_MakeLine">ST_MakeLine</a> - ポイントまたはラインジオメトリからラインストリングを生成します。</li><li class="listitem"><a class="link" href="#ST_MemUnion" title="ST_MemUnion">ST_MemUnion</a> - ST_Unionと同じですが、メモリフレンドリ(少ないメモリ使用、多いCPU時間)です。</li><li class="listitem"><a class="link" href="#ST_Polygonize" title="ST_Polygonize">ST_Polygonize</a> - 集計関数。ジオメトリの集合のラインから形成されうるポリゴンを含むジオメトリコレクションを生成します。</li><li class="listitem"><a class="link" href="#ST_Union" title="ST_Union">ST_Union</a> - ジオメトリの結合の点集合を表現するジオメトリを返します。</li><li class="listitem"><a class="link" href="#RT_ST_Union" title="ST_Union">ST_Union</a> - ラスタタイルの集合を1バンドの単一のラスタに結合します。バンドを指定しない場合は1番と仮定します。結果ラスタの範囲は、集合全体の範囲となります。インタセクトする場合には、結果値はp_expressionで定義されます。p_expressionはLAST, MEAN, SUM, FIRST, MAX, MINで、デフォルトはLASTです。</li><li class="listitem"><a class="link" href="#RT_ST_Union" title="ST_Union">ST_Union</a> - ラスタタイルの集合を1バンドの単一のラスタに結合します。バンドを指定しない場合は1番と仮定します。結果ラスタの範囲は、集合全体の範囲となります。インタセクトする場合には、結果値はp_expressionで定義されます。p_expressionはLAST, MEAN, SUM, FIRST, MAX, MINで、デフォルトはLASTです。</li><li class="listitem"><a class="link" href="#RT_ST_Union" title="ST_Union">ST_Union</a> - ラスタタイルの集合を1バンドの単一のラスタに結合します。バンドを指定しない場合は1番と仮定します。結果ラスタの範囲は、集合全体の範囲となります。インタセクトする場合には、結果値はp_expressionで定義されます。p_expressionはLAST, MEAN, SUM, FIRST, MAX, MINで、デフォルトはLASTです。</li><li class="listitem"><a class="link" href="#TopoElementArray_Agg" title="TopoElementArray_Agg">TopoElementArray_Agg</a> - lement_idとタイプの配列(topoelements)からなるtopoelementarrayを返します。</li></ul></div></div><div class="sect1" title="13.2. PostGIS SQL-MM対応関数"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="PostGIS_SQLMM_Functions"></a>13.2. PostGIS SQL-MM対応関数</h2></div></div></div><p>次に示す関数は、SQL/MM 3標準に対応したPostGIS関数です。</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><a class="link" href="#ST_3DDWithin" title="ST_3DDWithin">ST_3DDWithin</a> - 3次元(XYZ)ジオメトリ型について、2つのジオメトリの3次元距離が指定した数の内にある場合にtrueを返します。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM ?</li><li class="listitem"><a class="link" href="#ST_3DDistance" title="ST_3DDistance">ST_3DDistance</a> - ジオメトリ型について、2つのジオメトリの、3次元の最小デカルト距離(空間参照系に基づきます)を、投影法の単位で返します。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM ?</li><li class="listitem"><a class="link" href="#ST_3DIntersects" title="ST_3DIntersects">ST_3DIntersects</a> - ジオメトリが3次元で「空間的にインタセクトする」場合にTRUEを返します。ポイントとラインストリングのみで動作します。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: ?</li><li class="listitem"><a class="link" href="#ST_AddEdgeModFace" title="ST_AddEdgeModFace">ST_AddEdgeModFace</a> - 新しいエッジを追加します。新しいエッジがフェイスを分割する場合には、もとのフェイスを編集し、1つのフェイスを追加します。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM: Topo-Geo and Topo-Net 3: Routine Details:  X.3.13</li><li class="listitem"><a class="link" href="#ST_AddEdgeNewFaces" title="ST_AddEdgeNewFaces">ST_AddEdgeNewFaces</a> - 新しいエッジを追加します。新しいエッジがフェイスを分割する場合には、もとのフェイスを削除して、分割した2つのフェイスに置き換えます。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM: Topo-Geo and Topo-Net 3: Routine Details:  X.3.12</li><li class="listitem"><a class="link" href="#ST_AddIsoEdge" title="ST_AddIsoEdge">ST_AddIsoEdge</a> - anodeとanothernodeで指定される2つの既存孤立ノードを接続するトポロジに、ジオメトリaliestringで定義される孤立エッジを追加し、新しいエッジの識別番号を返します。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM: Topo-Geo and Topo-Net 3: Routine Details:  X.3.4</li><li class="listitem"><a class="link" href="#ST_AddIsoNode" title="ST_AddIsoNode">ST_AddIsoNode</a> - フェイスに孤立ノードを追加し、新しいノードの識別番号を返します。フェイスがNULLの場合でもノードは生成されます。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM: Topo-Net Routines:  X+1.3.1</li><li class="listitem"><a class="link" href="#ST_Area" title="ST_Area">ST_Area</a> - ポリゴンまたはマルチポリゴンの場合にはサーフェスの面積を返します。ジオメトリ型の「面積」はSRIDに基づく単位で、ジオグラフィ型の面積は平方メートルです。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 8.1.2, 9.5.3</li><li class="listitem"><a class="link" href="#ST_AsBinary" title="ST_AsBinary">ST_AsBinary</a> - ジオメトリ/ジオグラフィのSRIDメタデータのないWell-Known Binary(WKB)表現を返します。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.37</li><li class="listitem"><a class="link" href="#ST_AsText" title="ST_AsText">ST_AsText</a> - ジオメトリ/ジオグラフィのSRIDメタデータのないWell-Known Text(WKT)表現を返します。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.25</li><li class="listitem"><a class="link" href="#ST_Boundary" title="ST_Boundary">ST_Boundary</a> - ジオメトリの組み合わせ境界の閉包を返します。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.14</li><li class="listitem"><a class="link" href="#ST_Buffer" title="ST_Buffer">ST_Buffer</a> - (T) ジオメトリ: このジオメトリからの距離が指定された距離以下となるポイント全てを表現するジオメトリを返します。計算は、ジオメトリの空間参照系で行われます。ジオグラフィ: 平面変換ラッパを使います。形状制御のために異なる終端キャップと継ぎ目の設定のサポートが1.5で導入されました。buffer_styleオプションは、quad_segs=#,endcap=round|flat|square,join=round|mitre|bevel,mitre_limit=#.# となります。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.17</li><li class="listitem"><a class="link" href="#ST_Centroid" title="ST_Centroid">ST_Centroid</a> - ジオメトリの幾何学的重心を返します。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 8.1.4, 9.5.5</li><li class="listitem"><a class="link" href="#ST_ChangeEdgeGeom" title="ST_ChangeEdgeGeom">ST_ChangeEdgeGeom</a> - Cトポロジ構造に影響を与えることなくエッジの形状を変更します。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM: Topo-Geo and Topo-Net 3: Routine Details X.3.6</li><li class="listitem"><a class="link" href="#ST_Contains" title="ST_Contains">ST_Contains</a> - BのポイントがAの外部に無く、かつBの内部の少なくとも1つの点がAの内部にある場合に限って、TRUEを返します。
   
     
   
  このメソッドはSQL/MM仕様の実装です。	SQL-MM 3: 5.1.31</li><li class="listitem"><a class="link" href="#ST_ConvexHull" title="ST_ConvexHull">ST_ConvexHull</a> - 凸包は与えられた集合の全てのジオメトリを含む最小の閉じた凸ジオメトリです。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.16</li><li class="listitem"><a class="link" href="#ST_CoordDim" title="ST_CoordDim">ST_CoordDim</a> - ST_Geometry値の座標次元を返します。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.3</li><li class="listitem"><a class="link" href="#ST_CreateTopoGeo" title="ST_CreateTopoGeo">ST_CreateTopoGeo</a> - 空のトポロジにジオメトリのコレクションを追加し、成否を示すメッセージを返します。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM: Topo-Geo and Topo-Net 3: Routine Details -- X.3.18</li><li class="listitem"><a class="link" href="#ST_Crosses" title="ST_Crosses">ST_Crosses</a> - 与えられたジオメトリが共通の内部の点を持ち、かつそうでない点を持つ場合に、TRUEを返します。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.29</li><li class="listitem"><a class="link" href="#ST_CurveToLine" title="ST_CurveToLine">ST_CurveToLine</a> - CIRCULARSTRING/CURVEPOLYGONをLINESTRING/POLYGONに変換します。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 7.1.7</li><li class="listitem"><a class="link" href="#ST_Difference" title="ST_Difference">ST_Difference</a> - ジオメトリBにインタセクトしないジオメトリAの部分を表現するジオメトリを返します。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.20</li><li class="listitem"><a class="link" href="#ST_Dimension" title="ST_Dimension">ST_Dimension</a> - ジオメトリの固有次元を返します。座標次元以下でなければなりません。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.2</li><li class="listitem"><a class="link" href="#ST_Disjoint" title="ST_Disjoint">ST_Disjoint</a> - ジオメトリが「空間的にインタセクトしていない」すなわち、空間を共有ししていない場合に、TRUEを返します。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.26</li><li class="listitem"><a class="link" href="#ST_Distance" title="ST_Distance">ST_Distance</a> - ジオメトリ型については、2つのジオメトリの、2次元の最小デカルト距離(空間参照系に基づきます)を、投影法の単位で返します。ジオグラフィ型については、デフォルトでは、2つのジオメトリ間の回転楕円体上の最小距離をメートル単位で返します。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.23</li><li class="listitem"><a class="link" href="#ST_EndPoint" title="ST_EndPoint">ST_EndPoint</a> - LINESTRINGの最後のポイントをPOINTで返します。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 7.1.4</li><li class="listitem"><a class="link" href="#ST_Envelope" title="ST_Envelope">ST_Envelope</a> - ジオメトリの浮動小数点数(float8)バウンディングボックスを表現するジオメトリを返します。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.15</li><li class="listitem"><a class="link" href="#ST_Equals" title="ST_Equals">ST_Equals</a> - 与えられたジオメトリ表現が同じ場合にはTRUEを返します。方向は無視されます。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.24</li><li class="listitem"><a class="link" href="#ST_ExteriorRing" title="ST_ExteriorRing">ST_ExteriorRing</a> - POLYGONの外環を表現するラインストリングを返します。ジオメトリがポリゴンでない場合はNULLを返します。マルチポリゴンでは動作しません。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 8.2.3, 8.3.3</li><li class="listitem"><a class="link" href="#ST_GMLToSQL" title="ST_GMLToSQL">ST_GMLToSQL</a> - GML表現から指定したST_Geometry値を返します。これはST_GeomFromGMLの別名です。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.50 (except for curves support).</li><li class="listitem"><a class="link" href="#ST_GeomCollFromText" title="ST_GeomCollFromText">ST_GeomCollFromText</a> - ジオメトリのコレクションをWKTのコレクションと与えられたSRIDから生成します。SRIDが与えられていない場合は-1とします。
   
     
   
  このメソッドはSQL/MM仕様の実装です。</li><li class="listitem"><a class="link" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a> - Well-Known Text表現(WKT)から指定したST_Geometryを返します。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.40</li><li class="listitem"><a class="link" href="#ST_GeomFromWKB" title="ST_GeomFromWKB">ST_GeomFromWKB</a> - Well-Knwon Binaryジオメトリ表現(WKB)と任意パラメタのSRIDからジオメトリインスタンスを生成します。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.41</li><li class="listitem"><a class="link" href="#ST_GeometryFromText" title="ST_GeometryFromText">ST_GeometryFromText</a> - Well-Knwon Text表現(WKT)から指定したST_Geometry値を返します。これはST_GeomFromTextの別名です。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.40</li><li class="listitem"><a class="link" href="#ST_GeometryN" title="ST_GeometryN">ST_GeometryN</a> - GEOMETRYCOLLECTION, MULTIPOINT, MULTILINESTRING, MULTICURVE, MULTIPOLYGONの場合には、1はじまりでN番目のジオメトリを返します。それ以外の場合にはNULLを返します。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 9.1.5</li><li class="listitem"><a class="link" href="#ST_GeometryType" title="ST_GeometryType">ST_GeometryType</a> - ST_Geometry値のジオメトリ型を返します。
   
     
   
  このメソッドはSQL/MM仕様の実装です。	SQL-MM 3: 5.1.4</li><li class="listitem"><a class="link" href="#ST_GetFaceEdges" title="ST_GetFaceEdges">ST_GetFaceEdges</a> - 順序番号を含む、afaceの境界となる、整列したエッジの集合を返します。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3 Topo-Geo and Topo-Net 3: Routine Details: X.3.5</li><li class="listitem"><a class="link" href="#ST_GetFaceGeometry" title="ST_GetFaceGeometry">ST_GetFaceGeometry</a> - 指定されたトポロジの中の、フェイス識別番号で指定されたポリゴンを返します。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3 Topo-Geo and Topo-Net 3: Routine Details: X.3.16</li><li class="listitem"><a class="link" href="#ST_InitTopoGeo" title="ST_InitTopoGeo">ST_InitTopoGeo</a> - 新しいトポロジスキーマを生成し、topology.topologyテーブルに新しいスキーマを登録し、処理の概要を表示します。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3 Topo-Geo and Topo-Net 3: Routine Details: X.3.17</li><li class="listitem"><a class="link" href="#ST_InteriorRingN" title="ST_InteriorRingN">ST_InteriorRingN</a> - ポリゴンのN番目の内環を返します。ジオメトリがポリゴンでないかNが範囲外の場合はNULLを返します。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 8.2.6, 8.3.5</li><li class="listitem"><a class="link" href="#ST_Intersection" title="ST_Intersection">ST_Intersection</a> - (T) geomAとgeomBの共有部分を表すジオメトリを返します。ジオグラフィ実装では、インタセクトするためにジオメトリに変換して、WGS84に戻します。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.18</li><li class="listitem"><a class="link" href="#ST_Intersects" title="ST_Intersects">ST_Intersects</a> - ジオメトリ/ジオグラフィが「2次元空間で空間的にインタセクトする」(空間に共有部分がある)場合には、TRUEを返します。そうでない(非接続)場合はFALSEを返します。ジオグラフィについては、許容量は0.00001メートルです(どの閉じた点でもインタセクトを考慮されます)。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.27</li><li class="listitem"><a class="link" href="#ST_IsClosed" title="ST_IsClosed">ST_IsClosed</a> - LINESTRINGの始点と終点が一致する場合にTRUEを返します。多面体サーフェスの場合は閉じています(ボリュームです)。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 7.1.5, 9.3.3</li><li class="listitem"><a class="link" href="#ST_IsEmpty" title="ST_IsEmpty">ST_IsEmpty</a> - ジオメトリが、空のジオメトリコレクション、ポリゴン、ポイント等の場合に、trueを返します。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.7</li><li class="listitem"><a class="link" href="#ST_IsRing" title="ST_IsRing">ST_IsRing</a> - LINESTRINGが閉じていて、かつ単純である場合にTRUEを返します。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 7.1.6</li><li class="listitem"><a class="link" href="#ST_IsSimple" title="ST_IsSimple">ST_IsSimple</a> - ジオメトリが自己インタセクションや自己接触のような異常な幾何学ポイントを持っていない場合にTRUEを返します。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.8</li><li class="listitem"><a class="link" href="#ST_IsValid" title="ST_IsValid">ST_IsValid</a> - ST_Geometryが整形されている場合にtrueを返します。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.9</li><li class="listitem"><a class="link" href="#ST_Length" title="ST_Length">ST_Length</a> - LINESTRINGまたはMULTILINESTRINGの場合に、ジオメトリの2次元長を返します。ジオメトリでは、単位は空間参照系の単位です。ジオグラフィでは、メートル単位です(回転楕円体がデフォルトです)。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 7.1.2, 9.3.4</li><li class="listitem"><a class="link" href="#ST_LineFromText" title="ST_LineFromText">ST_LineFromText</a> - WKT表現と与えられたSRIDからジオメトリを生成します。SRIDが与えられていない場合は-1(不明)となります。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 7.2.8</li><li class="listitem"><a class="link" href="#ST_LineFromWKB" title="ST_LineFromWKB">ST_LineFromWKB</a> - WKB表現と与えられたSRIDからLINESTRINGを生成します。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 7.2.9</li><li class="listitem"><a class="link" href="#ST_LinestringFromWKB" title="ST_LinestringFromWKB">ST_LinestringFromWKB</a> - WKB表現と与えられたSRIDからジオメトリを生成します。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 7.2.9</li><li class="listitem"><a class="link" href="#ST_M" title="ST_M">ST_M</a> - ポイントのM座標値を返し、有効でないならNULLを返します。入力はポイントでなければなりません。
   
     
   
  このメソッドはSQL/MM仕様の実装です。</li><li class="listitem"><a class="link" href="#ST_MLineFromText" title="ST_MLineFromText">ST_MLineFromText</a> - WKT表現から指定したST_MultiLineString値を返します。
   
     
   
  このメソッドはSQL/MM仕様の実装です。SQL-MM 3: 9.4.4</li><li class="listitem"><a class="link" href="#ST_MPointFromText" title="ST_MPointFromText">ST_MPointFromText</a> - Well-Known Text(WKT)表現と与えられたSRIDからジオメトリを生成します。SRIDを与えない場合は-1(不明)となります。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 9.2.4</li><li class="listitem"><a class="link" href="#ST_MPolyFromText" title="ST_MPolyFromText">ST_MPolyFromText</a> - Well-Known Text(WKT)表現と与えられたSRIDからマルチポリゴンを生成します。SRIDを与えない場合は-1(不明)となります。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 9.6.4</li><li class="listitem"><a class="link" href="#ST_ModEdgeHeal" title="ST_ModEdgeHeal">ST_ModEdgeHeal</a> - 2つのエッジについて、接続しているノードを削除して修復します。1番目のエッジを編集して、2番目のエッジを削除します。削除されたノードの識別番号を返します。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM: Topo-Geo and Topo-Net 3: Routine Details:  X.3.9</li><li class="listitem"><a class="link" href="#ST_ModEdgeSplit" title="ST_ModEdgeSplit">ST_ModEdgeSplit</a> - 既存のエッジに沿って新しいノードを生成してエッジを分割します。もとのエッジは変更され、エッジが1つ追加されます。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM: Topo-Geo and Topo-Net 3: Routine Details:  X.3.9</li><li class="listitem"><a class="link" href="#ST_MoveIsoNode" title="ST_MoveIsoNode">ST_MoveIsoNode</a> - トポロジ内の孤立ノードを別の位置に移動させます。新しい apointジオメトリがノードとして存在しているなら、エラーが投げられます。移動に関する記述を返します。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM: Topo-Net Routines:  X.3.2</li><li class="listitem"><a class="link" href="#ST_NewEdgeHeal" title="ST_NewEdgeHeal">ST_NewEdgeHeal</a> - 2つのエッジについて、接続しているノードを削除して修復します。両方のエッジを削除し、1番目のエッジと同じ方向のエッジに置き換えます。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM: Topo-Geo and Topo-Net 3: Routine Details:  X.3.9</li><li class="listitem"><a class="link" href="#ST_NewEdgesSplit" title="ST_NewEdgesSplit">ST_NewEdgesSplit</a> - 新しいノードを既存のエッジに沿って作成して、エッジを分割します。もとのエッジは削除され、2つのエッジに置き換えられます。2つの新しいエッジに接続する新しいノードの識別番号を返します。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM: Topo-Net Routines:  X.3.8</li><li class="listitem"><a class="link" href="#ST_NumGeometries" title="ST_NumGeometries">ST_NumGeometries</a> - ジオメトリがジオメトリコレクションまたはマルチ系の場合はジオメトリの数を、単一のジオメトリの場合は1を返し、それ以外の場合はNULLを返します。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 9.1.4</li><li class="listitem"><a class="link" href="#ST_NumInteriorRing" title="ST_NumInteriorRing">ST_NumInteriorRing</a> - ジオメトリの最初のポリゴンの内環の数を返します。ST_NumInteriorRingsと同義です。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 8.2.5</li><li class="listitem"><a class="link" href="#ST_NumInteriorRings" title="ST_NumInteriorRings">ST_NumInteriorRings</a> - ジオメトリの最初のポリゴンの内環数を返します。この関数はポリゴンとマルチポリゴンの両方で動作しますが、最初のポリゴンしか見ません。ジオメトリにポリゴンが存在しない場合はNULLを返します。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 8.2.5</li><li class="listitem"><a class="link" href="#ST_NumPatches" title="ST_NumPatches">ST_NumPatches</a> - 多面体サーフェスのフェイス数を返します。多面体でないジオメトリの場合にはNULLを返します。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: ?</li><li class="listitem"><a class="link" href="#ST_NumPoints" title="ST_NumPoints">ST_NumPoints</a> - ST_LineStringまたはST_CircularStringのポイント数を返します。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 7.2.4</li><li class="listitem"><a class="link" href="#ST_OrderingEquals" title="ST_OrderingEquals">ST_OrderingEquals</a> - 与えられたジオメトリが同じジオメトリを示し、ポイントの順序が同じである場合に、TRUEを返します。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.43</li><li class="listitem"><a class="link" href="#ST_Overlaps" title="ST_Overlaps">ST_Overlaps</a> - ジオメトリが共有空間を持ち、同じ次元で、かつ完全には一方に含まれていない場合に、TRUEを返します。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.32</li><li class="listitem"><a class="link" href="#ST_PatchN" title="ST_PatchN">ST_PatchN</a> - ジオメトリがPOLYHEDRALSURFACEかPOLYHEDRALSURFACEMの場合には、1はじまりでN番目のジオメトリ(フェイス)を返します。それ以外の場合には、NULLを返します。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: ?</li><li class="listitem"><a class="link" href="#ST_Perimeter" title="ST_Perimeter">ST_Perimeter</a> - ST_SrrfaceまたはST_MultiSurface(POLYGONまたはMULTIPOLYGON)の境界の長さの計測値を返します。ジオメトリの単位は空間参照系によります。ジオグラフィはメートル単位になります。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 8.1.3, 9.5.4</li><li class="listitem"><a class="link" href="#ST_Point" title="ST_Point">ST_Point</a> - 与えられた座標値のST_Pointを返します。ST_MakePointのOGC別名です。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 6.1.2</li><li class="listitem"><a class="link" href="#ST_PointFromText" title="ST_PointFromText">ST_PointFromText</a> - WKTと与えられたSRIDからポイントジオメトリを生成します。SRIDが与えられていない場合は-1(不明)とします。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 6.1.8</li><li class="listitem"><a class="link" href="#ST_PointFromWKB" title="ST_PointFromWKB">ST_PointFromWKB</a> - WKBと与えられたSRIDからジオメトリを生成します。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 6.1.9</li><li class="listitem"><a class="link" href="#ST_PointN" title="ST_PointN">ST_PointN</a> - ジオメトリの最初のラインストリングまたは曲線ストリングのN番目のポイントを返します。ラインストリングが存在しない場合はNULLを返します。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 7.2.5, 7.3.5</li><li class="listitem"><a class="link" href="#ST_PointOnSurface" title="ST_PointOnSurface">ST_PointOnSurface</a> - サーフェス上にあることを保障されたPOINTを返します。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 8.1.5, 9.5.6.
		 According to the specs, ST_PointOnSurface works for surface geometries (POLYGONs, MULTIPOLYGONS, CURVED POLYGONS).  So PostGIS seems to be extending what
		 the spec allows here.  Most databases Oracle,DB II, ESRI SDE seem to only support this function for surfaces.  SQL Server 2008 like PostGIS supports for all common geometries.</li><li class="listitem"><a class="link" href="#ST_Polygon" title="ST_Polygon">ST_Polygon</a> - 指定されたラインストリングとSRIDからポリゴンを生成します。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 8.3.2</li><li class="listitem"><a class="link" href="#ST_PolygonFromText" title="ST_PolygonFromText">ST_PolygonFromText</a> - WKTと与えられたSRIDからジオメトリを生成します。SRIDが与えられていない場合は-1(不明)とします。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 8.3.6</li><li class="listitem"><a class="link" href="#ST_Relate" title="ST_Relate">ST_Relate</a> - intersectionMatrixPatternの値について、2つのジオメトリの内部、境界、外部のインタセクションを見て、指定したジオメトリがもうひとつのジオメトリと空間的に関係している場合に、TRUEを返します。intersectionMatrixPatternが無い場合には、2ジオメトリについての最大のintersectionMatrixPatternを返します。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.25</li><li class="listitem"><a class="link" href="#ST_RemEdgeModFace" title="ST_RemEdgeModFace">ST_RemEdgeModFace</a> - エッジを削除し、削除対象エッジでフェイスが2つに分割されているなら、両方の空間をとるため、ひとつを削除して、もうひとつを編集します。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM: Topo-Geo and Topo-Net 3: Routine Details:  X.3.15</li><li class="listitem"><a class="link" href="#ST_RemEdgeNewFace" title="ST_RemEdgeNewFace">ST_RemEdgeNewFace</a> - エッジを削除し、消去対象エッジでフェイスが2つに分割されているなら、分割されているフェイスを削除し、1つのフェイスに置き換えます。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM: Topo-Geo and Topo-Net 3: Routine Details:  X.3.14</li><li class="listitem"><a class="link" href="#ST_RemoveIsoNode" title="ST_RemoveIsoNode">ST_RemoveIsoNode</a> - 孤立ノードを削除し、実行結果が返されます。ノードが孤立していない(エッジの始端または終端である)場合、例外が投げられます。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM: Topo-Geo and Topo-Net 3: Routine Details:  X+1.3.3</li><li class="listitem"><a class="link" href="#ST_SRID" title="ST_SRID">ST_SRID</a> - ST_Geometryのspatial_ref_sysテーブルで定義されている空間参照系の識別番号を返します。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.5</li><li class="listitem"><a class="link" href="#ST_StartPoint" title="ST_StartPoint">ST_StartPoint</a> - LINESTRINGの最初のポイントをPOINTとして返します。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 7.1.3</li><li class="listitem"><a class="link" href="#ST_SymDifference" title="ST_SymDifference">ST_SymDifference</a> - AとBの、インタセクトしていない部分を表現するジオメトリを返します。対称と呼ばれるのは、ST_SymDifference(A,B) = ST_SymDifference(B,A) となるからです。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.21</li><li class="listitem"><a class="link" href="#ST_Touches" title="ST_Touches">ST_Touches</a> - ジオメトリが共通のポイントを少なくとも1つ持ち、内部でインタセクトしない場合に、TRUEを返します。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.28</li><li class="listitem"><a class="link" href="#ST_Transform" title="ST_Transform">ST_Transform</a> - 整数パラメータで参照されるSRIDに座標変換し、新しいジオメトリを返します。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.6</li><li class="listitem"><a class="link" href="#ST_Union" title="ST_Union">ST_Union</a> - ジオメトリの結合の点集合を表現するジオメトリを返します。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.19
		the z-index (elevation) when polygons are involved.</li><li class="listitem"><a class="link" href="#ST_WKBToSQL" title="ST_WKBToSQL">ST_WKBToSQL</a> - Well-Known Binary表現(WKB)からST_Geometry値を生成します。これはSRIDを取らないST_GeomFromWKBの別名です。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.36</li><li class="listitem"><a class="link" href="#ST_WKTToSQL" title="ST_WKTToSQL">ST_WKTToSQL</a> - Well-Known Text表現(WKT)からST_Geometry値を生成します。これはSRIDを取らないST_GeomFromTextの別名です。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.34</li><li class="listitem"><a class="link" href="#ST_Within" title="ST_Within">ST_Within</a> - ジオメトリAが完全にジオメトリBの内側にある場合にTRUEを返します。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 5.1.30</li><li class="listitem"><a class="link" href="#ST_X" title="ST_X">ST_X</a> - ポイントのX座標値を返し、有効でないならNULLを返します。入力はポイントでなければなりません。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 6.1.3</li><li class="listitem"><a class="link" href="#ST_Y" title="ST_Y">ST_Y</a> - ポイントのY座標値を返し、有効でないならNULLを返します。入力はポイントでなければなりません。
   
     
   
  このメソッドはSQL/MM仕様の実装です。 SQL-MM 3: 6.1.4</li><li class="listitem"><a class="link" href="#ST_Z" title="ST_Z">ST_Z</a> - ポイントのZ座標値を返し、有効でないならNULLを返します。入力はポイントでなければなりません。
   
     
   
  このメソッドはSQL/MM仕様の実装です。</li></ul></div></div><div class="sect1" title="13.3. PostGISジオグラフィ対応関数"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="PostGIS_GeographyFunctions"></a>13.3. PostGISジオグラフィ対応関数</h2></div></div></div><p>次に示す関数と演算子は入力または出力に<a class="link" href="#PostGIS_Geography" title="4.2. PostGISジオグラフィ型">geography</a>データ型を扱うPostGIS関数/演算子です。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>(T)の付いた関数はネイティブなジオグラフィ関数ではなく、実行時にST_Transformを使ってジオメトリとの変換を行います。結果として、日付変更線や極を超えたり、ひとつのUTMゾーンではカバーできない巨大なジオメトリを使用する場合に、予期しない挙動になることがあります。基本的な変換としては、UTMが望ましいですが、ランベルト正積方位図法(北/南)、最悪のシナリオでメルカトルに頼ります。</p></td></tr></table></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><a class="link" href="#ST_Area" title="ST_Area">ST_Area</a> - ポリゴンまたはマルチポリゴンの場合にはサーフェスの面積を返します。ジオメトリ型の「面積」はSRIDに基づく単位で、ジオグラフィ型の面積は平方メートルです。</li><li class="listitem"><a class="link" href="#ST_AsBinary" title="ST_AsBinary">ST_AsBinary</a> - ジオメトリ/ジオグラフィのSRIDメタデータのないWell-Known Binary(WKB)表現を返します。</li><li class="listitem"><a class="link" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a> - ジオメトリのSRIDメタデータが付いたWell-Known Text(WKT)表現を返します。</li><li class="listitem"><a class="link" href="#ST_AsGML" title="ST_AsGML">ST_AsGML</a> - GML第2版または第3版としてジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_AsGeoJSON" title="ST_AsGeoJSON">ST_AsGeoJSON</a> - GeoJSON要素としてジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_AsKML" title="ST_AsKML">ST_AsKML</a> - ジオメトリをKML要素で返します。いくつかの形式があります。デフォルトはversion=2, precision=15です。</li><li class="listitem"><a class="link" href="#ST_AsSVG" title="ST_AsSVG">ST_AsSVG</a> - ジオメトリまたはジオグラフィで与えられたSVGパスデータによるジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_AsText" title="ST_AsText">ST_AsText</a> - ジオメトリ/ジオグラフィのSRIDメタデータのないWell-Known Text(WKT)表現を返します。</li><li class="listitem"><a class="link" href="#ST_Azimuth" title="ST_Azimuth">ST_Azimuth</a> - pointAとPointBで定義されるベクタの、水平面での方位をラジアン単位で返します。方位は時計回りで、前半は下向き方向で後半は上向き方向になります。時計でいうと12=0; 3=PI/2; 6=PI; 9=3PI/4となります。</li><li class="listitem"><a class="link" href="#ST_Buffer" title="ST_Buffer">ST_Buffer</a> - (T) ジオメトリ: このジオメトリからの距離が指定された距離以下となるポイント全てを表現するジオメトリを返します。計算は、ジオメトリの空間参照系で行われます。ジオグラフィ: 平面変換ラッパを使います。形状制御のために異なる終端キャップと継ぎ目の設定のサポートが1.5で導入されました。buffer_styleオプションは、quad_segs=#,endcap=round|flat|square,join=round|mitre|bevel,mitre_limit=#.# となります。</li><li class="listitem"><a class="link" href="#ST_CoveredBy" title="ST_CoveredBy">ST_CoveredBy</a> - オメトリ/ジオグラフィAの点がジオメトリ/ジオグラフィBの外に無い場合に、1(TRUE)を返します。</li><li class="listitem"><a class="link" href="#ST_Covers" title="ST_Covers">ST_Covers</a> - ジオメトリBにジオメトリAの外となるポイントが無い場合には、1(TRUE)を返します。</li><li class="listitem"><a class="link" href="#ST_DWithin" title="ST_DWithin">ST_DWithin</a> - ジオメトリが、指定したジオメトリから指定した距離内にある場合に、TRUEを返します。ジオメトリについては、距離は空間参照系で定義されている単位になります。ジオグラフィについては、メートル単位で、デフォルトではuse_spheroid=true(回転楕円体を使った計算)となり、速いチェックをするにはuse_spheroid=falseとして球面を使って計算します。</li><li class="listitem"><a class="link" href="#ST_Distance" title="ST_Distance">ST_Distance</a> - ジオメトリ型については、2つのジオメトリの、2次元の最小デカルト距離(空間参照系に基づきます)を、投影法の単位で返します。ジオグラフィ型については、デフォルトでは、2つのジオメトリ間の回転楕円体上の最小距離をメートル単位で返します。</li><li class="listitem"><a class="link" href="#ST_GeogFromText" title="ST_GeogFromText">ST_GeogFromText</a> - Well-Known Text表現または拡張WKTから指定したジオグラフィ値を返します。</li><li class="listitem"><a class="link" href="#ST_GeogFromWKB" title="ST_GeogFromWKB">ST_GeogFromWKB</a> - Well-Known Binaryジオメトリ表現(WKB)または拡張WKB(EWKB)からジオグラフィインスタンスを生成します。</li><li class="listitem"><a class="link" href="#ST_GeographyFromText" title="ST_GeographyFromText">ST_GeographyFromText</a> - Well-Known Text表現または拡張WKTから指定したジオグラフィ値を返します。</li><li class="listitem"><a class="link" href="#ST_Geometry_EQ" title="=">=</a> - Aのバウンダリボックスが、Bのバウンダリボックスと同じ場合にTRUEを返します。バウンディングボックスには倍精度浮動小数点数を使います。</li><li class="listitem"><a class="link" href="#ST_Intersection" title="ST_Intersection">ST_Intersection</a> - (T) geomAとgeomBの共有部分を表すジオメトリを返します。ジオグラフィ実装では、インタセクトするためにジオメトリに変換して、WGS84に戻します。</li><li class="listitem"><a class="link" href="#ST_Intersects" title="ST_Intersects">ST_Intersects</a> - ジオメトリ/ジオグラフィが「2次元空間で空間的にインタセクトする」(空間に共有部分がある)場合には、TRUEを返します。そうでない(非接続)場合はFALSEを返します。ジオグラフィについては、許容量は0.00001メートルです(どの閉じた点でもインタセクトを考慮されます)。</li><li class="listitem"><a class="link" href="#ST_Length" title="ST_Length">ST_Length</a> - LINESTRINGまたはMULTILINESTRINGの場合に、ジオメトリの2次元長を返します。ジオメトリでは、単位は空間参照系の単位です。ジオグラフィでは、メートル単位です(回転楕円体がデフォルトです)。</li><li class="listitem"><a class="link" href="#ST_Project" title="ST_Project">ST_Project</a> - 方位と距離を使って始点から算出されたPOINTを返します。</li><li class="listitem"><a class="link" href="#ST_Summary" title="ST_Summary">ST_Summary</a> - ジオメトリについての要約文を返します。</li><li class="listitem"><a class="link" href="#geometry_overlaps" title="&amp;&amp;">&amp;&amp;</a> - AのバウンディングボックスがBのバウンディングボックスをオーバラップする場合にTRUEを返します。</li></ul></div></div><div class="sect1" title="13.4. PostGISラスタ対応関数"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="PostGIS_RasterFunctions"></a>13.4. PostGISラスタ対応関数</h2></div></div></div><p>次に示す関数と演算子は、<a class="xref" href="#raster" title="raster">raster</a>データ型を入力に取ったり、返り値にしたりする、PostGIS関数/演算子です。アルファベット順に示します。</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><a class="link" href="#RT_Box3D" title="Box3D">Box3D</a> - ラスタを囲むボックスのbox3d表現を返します。</li><li class="listitem"><a class="link" href="#RT_Raster_OverLeft" title="&amp;&lt;">&amp;&lt;</a> - AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの左にある場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#RT_Raster_OverRight" title="&amp;&gt;">&amp;&gt;</a> - AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの右にある場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#RT_Raster_Overlap" title="&amp;&amp;">&amp;&amp;</a> - のバウンディングボックスがBのバウンディングボックスをオーバラップする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#RT_ST_AddBand" title="ST_AddBand">ST_AddBand</a> - 与えられたタイプで、与えられた初期値にした新しいバンドを、与えられたインデクス位置に付けたラスタを返します。インデクス位置を指定していない場合には、バンドは末尾に追加されます。</li><li class="listitem"><a class="link" href="#RT_ST_AsBinary" title="ST_AsBinary">ST_AsBinary</a> - SRIDメタデータを持たないラスタのWell-Known Binary(WKB)表現を返します。</li><li class="listitem"><a class="link" href="#RT_ST_AsGDALRaster" title="ST_AsGDALRaster">ST_AsGDALRaster</a> - 指定されたGDALラスタ書式でラスタタイルを返します。ラスタ書式はコンパイルしたライブラリが対応するものです。ライブラリが対応する書式の一覧を得るにはST_GDALRasters()を使います。</li><li class="listitem"><a class="link" href="#RT_ST_AsJPEG" title="ST_AsJPEG">ST_AsJPEG</a> - ラスタの選択されたバンドを、単一のJoint Photographic Exports Group (JPEG)画像としてバイト配列で返します。バンドを指定せず、1バンドか3以上のバンドがある場合には、1番バンドを使用します。3バンドのみ指定した場合には、3バンドを使用し、RGBに対応付けます。</li><li class="listitem"><a class="link" href="#RT_ST_AsPNG" title="ST_AsPNG">ST_AsPNG</a> - ラスタの選択されたバンドを、単一のportable network graphics(PNG)画像としてバイト配列で返します。バンドを指定せず、1バンドか3バンド化4バンドある場合には、全てのバンドを使用します。バンドを指定せず、2バンドか4以上のバンドがある場合には、1番バンドを使用します。対象バンドはRGBまたはRGBAに対応付けられます。</li><li class="listitem"><a class="link" href="#RT_ST_AsRaster" title="ST_AsRaster">ST_AsRaster</a> - PostGISジオメトリをPostGISラスタに変換します。</li><li class="listitem"><a class="link" href="#RT_ST_AsTIFF" title="ST_AsTIFF">ST_AsTIFF</a> - ラスタの選択されたバンドを、単一のTIFF画像として返します。バンドを指定しない場合には、全てのバンドの使用を試みます。</li><li class="listitem"><a class="link" href="#RT_ST_Aspect" title="ST_Aspect">ST_Aspect</a> - 標高ラスタバンドの斜面方位を返します。地形解析に使います。</li><li class="listitem"><a class="link" href="#RT_ST_Band" title="ST_Band">ST_Band</a> - 既存のラスタの1つ以上のバンドを新しいラスタとして返します。既存のラスタから新しいラスタを構築する際に使います。</li><li class="listitem"><a class="link" href="#RT_ST_BandIsNoData" title="ST_BandIsNoData">ST_BandIsNoData</a> - 指定したバンドがNODATA値で満たされている場合にはTRUEを返します。</li><li class="listitem"><a class="link" href="#RT_ST_BandMetaData" title="ST_BandMetaData">ST_BandMetaData</a> - 指定したラスタバンドの基本的なメタデータを返します。バンド番号を指定しない場合には、1番と仮定します。</li><li class="listitem"><a class="link" href="#RT_ST_BandNoDataValue" title="ST_BandNoDataValue">ST_BandNoDataValue</a> - 指定されたバンドについてデータが無いことを表現する値を返します。バンド番号を指定しない場合には、1番と仮定します。</li><li class="listitem"><a class="link" href="#RT_ST_BandPath" title="ST_BandPath">ST_BandPath</a> - ファイルシステムに格納されているバンドのシステムファイルパスを返します。バンド番号が指定されていない場合には1番と仮定します。</li><li class="listitem"><a class="link" href="#RT_ST_BandPixelType" title="ST_BandPixelType">ST_BandPixelType</a> - 指定したバンドのピクセルタイプを返します。バンド番号が指定されていない場合には、1番と仮定します。</li><li class="listitem"><a class="link" href="#RT_ST_Clip" title="ST_Clip">ST_Clip</a> - 入力ジオメトリで切り取ったラスタを返します。バンドが指定されていない場合には、全てのバンドが返されます。cropが指定されていない場合はTRUEと仮定され、出力ラスタをクロップします。</li><li class="listitem"><a class="link" href="#RT_ST_ConvexHull" title="ST_ConvexHull">ST_ConvexHull</a> - BandNoDataValueと等しいピクセル値を含むラスタの凸包ジオメトリを返します。一般的な形状で回転していないラスタでは、ST_Envelopeと同じ結果になります。不規則な形状をしているか回転しているラスタでのみ使います。</li><li class="listitem"><a class="link" href="#RT_ST_Count" title="ST_Count">ST_Count</a> - ラスタまたはラスタカバレッジの指定したバンドのピクセル数を返します。バンドを指定しない場合は1番と仮定します。exclude_nodata_valueをTRUEに設定している場合には、NODATA値と等しくないピクセルのみを数えます。</li><li class="listitem"><a class="link" href="#RT_ST_DumpAsPolygons" title="ST_DumpAsPolygons">ST_DumpAsPolygons</a> - 指定されたラスタバンドからgeomval(geom,val)行の集合を返します。バンドを指定しない場合のデフォルトは1番です。</li><li class="listitem"><a class="link" href="#RT_ST_Envelope" title="ST_Envelope">ST_Envelope</a> - ラスタの範囲のポリゴン表現を返します。</li><li class="listitem"><a class="link" href="#RT_ST_GeoReference" title="ST_GeoReference">ST_GeoReference</a> - 一般的にワールドファイルでみられるGDALまたはESRI書式の地理参照メタデータを返します。デフォルトはGDALです。</li><li class="listitem"><a class="link" href="#RT_ST_HasNoBand" title="ST_HasNoBand">ST_HasNoBand</a> - 指定したバンド番号のバンドが無い場合にTRUEを返します。バンド番号を指定していない場合には、1番と仮定します。</li><li class="listitem"><a class="link" href="#RT_ST_Height" title="ST_Height">ST_Height</a> - ラスタの高さをピクセル単位で返します。</li><li class="listitem"><a class="link" href="#RT_ST_HillShade" title="ST_HillShade">ST_HillShade</a> - 方位、高度、輝度、標高スケールの入力を使って、標高ラスタバンドの仮定的な光による明暗を返します。地形の視覚化に使用します。</li><li class="listitem"><a class="link" href="#RT_ST_Histogram" title="ST_Histogram">ST_Histogram</a> - ラスタまたはラスタカバレッジのビン範囲で分割したデータ分布をまとめるヒストグラムの集合を返します。ビン数を指定しない場合には自動計算されます。</li><li class="listitem"><a class="link" href="#RT_ST_Intersection" title="ST_Intersection">ST_Intersection</a> - 2つのラスタの共有部分またはベクタ化したラスタとジオメトリとのインタセクションを表現する、ラスタまたはジオメトリとピクセル値のペアの集合を返します。</li><li class="listitem"><a class="link" href="#RT_ST_Intersects" title="ST_Intersects">ST_Intersects</a> - バンド番号が省略された場合はラスタの凸包を考慮するだけです。指定したバンドのNODATA値でない値を持つピクセルがインタセクトする場合のみTRUEを返します。</li><li class="listitem"><a class="link" href="#RT_ST_IsEmpty" title="ST_IsEmpty">ST_IsEmpty</a> - ラスタが空(width = 0かつheight = 0)の場合にはTRUEを返します。他の場合にはFALSEを返します。</li><li class="listitem"><a class="link" href="#RT_ST_MakeEmptyRaster" title="ST_MakeEmptyRaster">ST_MakeEmptyRaster</a> - 与えられたピクセル範囲(width, height)、左上のX,Y、ピクセルサイズ、回転(scalex, scaley, skewx, skewy)と空間参照系(SRID)が指定された空ラスタ(バンドを持たないラスタ)を返します。ラスタが渡されると、新しいラスタは渡されたラスタと同じサイズ、アラインメント、SRIDになります。SRIDが指定されていない場合には、空間参照系は不明(0)とされます。</li><li class="listitem"><a class="link" href="#RT_ST_MapAlgebraExpr" title="ST_MapAlgebraExpr">ST_MapAlgebraExpr</a> - 1バンド版: 入力バンドに対する妥当なPostgreSQL代数演算で形成された、指定したピクセルタイプの1バンドのラスタを生成します。バンドを指定しない場合は1番と仮定します。</li><li class="listitem"><a class="link" href="#RT_ST_MapAlgebraExpr2" title="ST_MapAlgebraExpr">ST_MapAlgebraExpr</a> - 2バンド版: 2つの入力バンドに対する妥当なPostgreSQL代数演算で形成された、指定したピクセルタイプの1バンドのラスタを生成します。バンドを指定しない場合はどちらも1番と仮定します。結果ラスタは、ひとつめのラスタのアラインメント(スケール、スキュー、ピクセル角位置)にあわされます。範囲は"extenttype"引数で定義されます。取りうる"extenttype"の値はINTERSECTION, UNION, FIRST, SECONDです。</li><li class="listitem"><a class="link" href="#RT_ST_MapAlgebraFct" title="ST_MapAlgebraFct">ST_MapAlgebraFct</a> - 1バンド版 - 入力バンドに対する妥当なPostgreSQL関数で形成された、指定したピクセルタイプの1バンドのラスタを生成します。バンドを指定しない場合は1番と仮定します。</li><li class="listitem"><a class="link" href="#RT_ST_MapAlgebraFct2" title="ST_MapAlgebraFct">ST_MapAlgebraFct</a> - 2ラスタ版 - 2つの入力バンドに対する妥当なPostgreSQL関数で形成された、指定したピクセルタイプの1バンドのラスタを生成します。バンドを指定しない場合は1番と仮定します。"extenttype"のデフォルトはINTERSECTIONです。</li><li class="listitem"><a class="link" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a> - 1バンド版: ユーザ定義PostgreSQL関数を使用する最近傍地図代数関数です。入力ラスタバンドの近傍の値を与えたPL/pgSQLユーザ定義関数の結果からなるラスタを返します。</li><li class="listitem"><a class="link" href="#RT_ST_MetaData" title="ST_MetaData">ST_MetaData</a> - ピクセルサイズ、回転(skew)、左上隅位置等のラスタオブジェクトに関する基本的なメタデータを返します。</li><li class="listitem"><a class="link" href="#RT_ST_NumBands" title="ST_NumBands">ST_NumBands</a> - ラスタオブジェクトのバンド数を返します。</li><li class="listitem"><a class="link" href="#RT_ST_PixelAsPolygon" title="ST_PixelAsPolygon">ST_PixelAsPolygon</a> - 指定した行と列のピクセルの境界となるジオメトリを返します。</li><li class="listitem"><a class="link" href="#RT_ST_PixelAsPolygons" title="ST_PixelAsPolygons">ST_PixelAsPolygons</a> - 全てのピクセルについて境界となるジオメトリを、ピクセルごとのピクセル値とラスタ座標系のXとYとを付けて返します。</li><li class="listitem"><a class="link" href="#RT_ST_PixelHeight" title="ST_PixelHeight">ST_PixelHeight</a> - 空間参照系の単位での地理的なピクセルの高さを返します。</li><li class="listitem"><a class="link" href="#RT_ST_PixelWidth" title="ST_PixelWidth">ST_PixelWidth</a> - 空間参照系の単位での地理的なピクセルの幅を返します。</li><li class="listitem"><a class="link" href="#RT_ST_Polygon" title="ST_Polygon">ST_Polygon</a> - NODATA値でないピクセル値を持つピクセルの結合で形成されるポリゴンジオメトリを返します。バンド番号を設定しない場合には、デフォルトは1番バンドです。</li><li class="listitem"><a class="link" href="#RT_ST_Quantile" title="ST_Quantile">ST_Quantile</a> - ラスタまたはラスタテーブルカバレッジのサンプルまたは母集団の分位数を計算します。値がラスタの25%,50%,75%にあるかを調べることができます。</li><li class="listitem"><a class="link" href="#RT_ST_Raster2WorldCoordX" title="ST_Raster2WorldCoordX">ST_Raster2WorldCoordX</a> - ラスタの指定した列と行における左上隅の地理座標X値を返します。列と行の番号は1始まりです。</li><li class="listitem"><a class="link" href="#RT_ST_Raster2WorldCoordY" title="ST_Raster2WorldCoordY">ST_Raster2WorldCoordY</a> - ラスタの指定した列と行における左上隅の地理座標Y値を返します。列と行の番号は1始まりです。</li><li class="listitem"><a class="link" href="#RT_ST_Reclass" title="ST_Reclass">ST_Reclass</a> - 元のラスタから再分類したバンドタイプからなるラスタを生成します。nbandは変更するバンドです。nbandが指定されていない場合は1番と仮定します。他の全てのバンドは変更せずに返します。可視画像の書式としてより単純な描画を行うために、16BUIバンドを8BUIバンドに変換する、等のために使います。</li><li class="listitem"><a class="link" href="#RT_ST_Resample" title="ST_Resample">ST_Resample</a> - 指定したリサンプリングアルゴリズム、新しいピクセル範囲、グリッドの角、定義するか他のラスタから借りてきた地理参照属性を使ってリサンプリングを行います。新しいピクセル値は、最近傍補間('NearestNeighbor')、双線形補間('Bilinear')、3次補完('Cubic')、3次スプライン補完('CubicSpline')、ランツォシュ補完('Lanczos')、のいずれかのアルゴリズムを使います。デフォルトは最近傍補完です。</li><li class="listitem"><a class="link" href="#RT_ST_Rescale" title="ST_Rescale">ST_Rescale</a> - スケール(ピクセルサイズ)だけを調整するリサンプリングを行います。新しいピクセル値は、最近傍補間('NearestNeighbor')、双線形補間('Bilinear')、3次補完('Cubic')、3次スプライン補完('CubicSpline')、ランツォシュ補完('Lanczos')、のいずれかのアルゴリズムを使います。デフォルトは最近傍補完です。</li><li class="listitem"><a class="link" href="#RT_ST_Reskew" title="ST_Reskew">ST_Reskew</a> - スキュー(回転パラメタ)の調整によるリサンプリングを行います。新しいピクセル値は、最近傍補間('NearestNeighbor')、双線形補間('Bilinear')、3次補完('Cubic')、3次スプライン補完('CubicSpline')、ランツォシュ補完('Lanczos')、のいずれかのアルゴリズムを使います。デフォルトは最近傍補完です。</li><li class="listitem"><a class="link" href="#RT_ST_Rotation" title="ST_Rotation">ST_Rotation</a> - ラスタの回転をラジアンで返します。</li><li class="listitem"><a class="link" href="#RT_ST_SRID" title="ST_SRID">ST_SRID</a> - ラスタのspatial_ref_sysテーブルで定義されている空間参照系識別番号を返します。</li><li class="listitem"><a class="link" href="#RT_ST_SameAlignment" title="ST_SameAlignment">ST_SameAlignment</a> - ラスタが同じスキュー、スケール、空間参照系を持つ場合にはTRUEを返し、そうでない場合は問題を詳述する通知とともにFALSEを返します。</li><li class="listitem"><a class="link" href="#RT_ST_ScaleX" title="ST_ScaleX">ST_ScaleX</a> - 空間参照系の単位での地理的なピクセル幅のX成分を返します。</li><li class="listitem"><a class="link" href="#RT_ST_ScaleY" title="ST_ScaleY">ST_ScaleY</a> - 空間参照系の単位での地理的なピクセルの高さのY成分を返します。</li><li class="listitem"><a class="link" href="#RT_ST_SetBandIsNoData" title="ST_SetBandIsNoData">ST_SetBandIsNoData</a> - バンドのisnodataフラグをTRUEにします。ST_BandIsNoData(rast, band) != ST_BandIsNodata(rast, band, TRUE)となり、isnodataフラグが汚れている場合に使用することがあります。バンドを指定しない場合は1番バンドと仮定します。</li><li class="listitem"><a class="link" href="#RT_ST_SetBandNoDataValue" title="ST_SetBandNoDataValue">ST_SetBandNoDataValue</a> - 指定したバンドにNODATAを表現する値を設定します。バンドを指定しない場合は1番と仮定します。NODATA値を持たないようにするには、nodatavalue = NULLとします。</li><li class="listitem"><a class="link" href="#RT_ST_SetGeoReference" title="ST_SetGeoReference">ST_SetGeoReference</a> - 1回の関数呼び出しで6つの地理参照パラメータを設定します。値は空白区切りです。GDALまたはESRI書式の入力を受け付けます。デフォルトはGDALです。</li><li class="listitem"><a class="link" href="#RT_ST_SetRotation" title="ST_SetRotation">ST_SetRotation</a> - ラスタの回転をラジアン単位で設定します。</li><li class="listitem"><a class="link" href="#RT_ST_SetSRID" title="ST_SetSRID">ST_SetSRID</a> - ラスタのSRIDを、指定した整数でspatial_ref_sysテーブルで定義されているSRIDに設定します。</li><li class="listitem"><a class="link" href="#RT_ST_SetScale" title="ST_SetScale">ST_SetScale</a> - ピクセルのXとYのサイズを空間参照系の単位で設定します。数値はunits/pixelで、幅、高さの順です。</li><li class="listitem"><a class="link" href="#RT_ST_SetSkew" title="ST_SetSkew">ST_SetSkew</a> - XとYのスキュー(回転パラメータ)を設定します。引数を1つだけ渡した場合には、XとYは同じ値に設定されます。</li><li class="listitem"><a class="link" href="#RT_ST_SetUpperLeft" title="ST_SetUpperLeft">ST_SetUpperLeft</a> - ラスタの左上隅の地理参照のX,Y座標値を設定します。</li><li class="listitem"><a class="link" href="#RT_ST_SetValue" title="ST_SetValue">ST_SetValue</a> - 指定したバンドの指定した列Xと行Yのピクセルまたは指定したジオメトリポイントとインタセクトするピクセルの値を設定することから得られた変更結果を返します。バンド番号は1始まりで、指定しない場合には1と仮定します。</li><li class="listitem"><a class="link" href="#RT_ST_SkewX" title="ST_SkewX">ST_SkewX</a> - 空間参照のXスキュー(回転パラメータ)を返します。</li><li class="listitem"><a class="link" href="#RT_ST_SkewY" title="ST_SkewY">ST_SkewY</a> - 空間参照のYスキュー(回転パラメータ)を返します。</li><li class="listitem"><a class="link" href="#RT_ST_Slope" title="ST_Slope">ST_Slope</a> - 標高ラスタバンドの傾斜角を返します。地形解析に使います。</li><li class="listitem"><a class="link" href="#RT_ST_SnapToGrid" title="ST_SnapToGrid">ST_SnapToGrid</a> - グリッドにスナップさせるリサンプリングを行います。新しいピクセル値は、最近傍補間('NearestNeighbor')、双線形補間('Bilinear')、3次補完('Cubic')、3次スプライン補完('CubicSpline')、ランツォシュ補完('Lanczos')、のいずれかのアルゴリズムを使います。デフォルトは最近傍補完です。</li><li class="listitem"><a class="link" href="#RT_ST_SummaryStats" title="ST_SummaryStats">ST_SummaryStats</a> - ラスタまたはラスタカバレッジの指定したバンドについて、ピクセル数、合計値、平均値、標準偏差、最小値、最大値からなる統計情報の概要を返します。バンドを指定しない場合は1番と仮定します。</li><li class="listitem"><a class="link" href="#RT_ST_Transform" title="ST_Transform">ST_Transform</a> - ラスタを既知の空間参照系から他の既知の空間参照系に、指定したリサンプリングアルゴリズムで投影変換します。選択肢は、最近傍補間('NearestNeighbor')、双線形補間('Bilinear')、3次補完('Cubic')、3次スプライン補完('CubicSpline')、ランツォシュ補完('Lanczos')、があります。デフォルトは最近傍補完です。</li><li class="listitem"><a class="link" href="#RT_ST_Union" title="ST_Union">ST_Union</a> - ラスタタイルの集合を1バンドの単一のラスタに結合します。バンドを指定しない場合は1番と仮定します。結果ラスタの範囲は、集合全体の範囲となります。インタセクトする場合には、結果値はp_expressionで定義されます。p_expressionはLAST, MEAN, SUM, FIRST, MAX, MINで、デフォルトはLASTです。</li><li class="listitem"><a class="link" href="#RT_ST_UpperLeftX" title="ST_UpperLeftX">ST_UpperLeftX</a> - 適用されている空間参照系でのラスタの左上隅のX座標値を返します。</li><li class="listitem"><a class="link" href="#RT_ST_UpperLeftY" title="ST_UpperLeftY">ST_UpperLeftY</a> - 適用されている空間参照系でのラスタの左上隅のY座標値を返します。</li><li class="listitem"><a class="link" href="#RT_ST_Value" title="ST_Value">ST_Value</a> - 指定したバンドの指定した列Xと行Yまたはジオメトリポイントに対応するピクセルの値を返します。バンド番号は1始まりで、指定しない場合には1と仮定します。exclude_nodata_valueがFALSEに設定された場合には、nodataピクセルを含む全てのピクセルがインタセクトするかが考慮され、値を返します。exclude_nodata_valueを渡さない場合には、ラスタのメタデータから読みます。</li><li class="listitem"><a class="link" href="#RT_ST_ValueCount" title="ST_ValueCount">ST_ValueCount</a> - ラスタ(またはラスタカバレッジの)指定されたバンドで、指定した値を持つピクセルを対象として、ピクセルバンド値とピクセル数からなるレコードの集合を返します。バンドを指定しない場合は1番と仮定します。デフォルトではNODATA値のピクセルは数えられず、ピクセルの他の値は出力され、ピクセルバンド値は最も近い整数に丸められます。</li><li class="listitem"><a class="link" href="#RT_ST_Width" title="ST_Width">ST_Width</a> - ラスタの幅をピクセル単位で返します。</li><li class="listitem"><a class="link" href="#RT_ST_World2RasterCoordX" title="ST_World2RasterCoordX">ST_World2RasterCoordX</a> - ラスタのワールド空間参照系に基づくポイントジオメトリ(pt)またはX,Y座標値(xw,yw)に対応するラスタの列を返します。</li><li class="listitem"><a class="link" href="#RT_ST_World2RasterCoordY" title="ST_World2RasterCoordY">ST_World2RasterCoordY</a> - ラスタのワールド空間参照系に基づくポイントジオメトリ(pt)またはX,Y座標値(xw,yw)に対応するラスタの行を返します。</li></ul></div></div><div class="sect1" title="13.5. PostGISジオメトリ/ジオグラフィ/ラスタダンプ関数"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="PostGIS_Geometry_DumpFunctions"></a>13.5. PostGISジオメトリ/ジオグラフィ/ラスタダンプ関数</h2></div></div></div><p>次に示す関数は単一の<a class="link" href="#geometry_dump" title="geometry_dump">geometry_dump</a>データ型または<a class="link" href="#geomval" title="geomval">geomval</a>データ型のオブジェクトを扱うPostGIS関数です。</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><a class="link" href="#RT_ST_DumpAsPolygons" title="ST_DumpAsPolygons">ST_DumpAsPolygons</a> - 指定されたラスタバンドからgeomval(geom,val)行の集合を返します。バンドを指定しない場合のデフォルトは1番です。</li><li class="listitem"><a class="link" href="#RT_ST_Intersection" title="ST_Intersection">ST_Intersection</a> - 2つのラスタの共有部分またはベクタ化したラスタとジオメトリとのインタセクションを表現する、ラスタまたはジオメトリとピクセル値のペアの集合を返します。</li><li class="listitem"><a class="link" href="#ST_Dump" title="ST_Dump">ST_Dump</a> - ジオメトリg1から作られたgeometry_dump(geom, path)行の集合を返します。</li><li class="listitem"><a class="link" href="#ST_DumpPoints" title="ST_DumpPoints">ST_DumpPoints</a> - ジオメトリを作る全ての点のgometry_dump(geom,path)行の集合を返します。</li><li class="listitem"><a class="link" href="#ST_DumpRings" title="ST_DumpRings">ST_DumpRings</a> - ポリゴンの外環と内環を表すgeometry_dump行の集合を返します。</li></ul></div></div><div class="sect1" title="13.6. PostGISボックス関数"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="PostGIS_BoxFunctions"></a>13.6. PostGISボックス関数</h2></div></div></div><p>次に示す関数は、PostGIS空間型の中のbox系を型を入力に取ったり、返り値にしたりする、PostGIS関数です。ボックス系には<a class="link" href="#box2d_type" title="box2d">box2d</a>, and <a class="link" href="#box3d_type" title="box3d">box3d</a>があります。</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><a class="link" href="#Box2D" title="Box2D">Box2D</a> - ジオメトリの最大範囲を表すBOX2Dを返します。</li><li class="listitem"><a class="link" href="#Box3D" title="Box3D">Box3D</a> - ジオメトリの最大範囲を表すBOX3Dを返します。</li><li class="listitem"><a class="link" href="#RT_Box3D" title="Box3D">Box3D</a> - ラスタを囲むボックスのbox3d表現を返します。</li><li class="listitem"><a class="link" href="#ST_3DExtent" title="ST_3DExtent">ST_3DExtent</a> - ジオメトリのbox3Dバウンディングボックスを返す集計関数です。</li><li class="listitem"><a class="link" href="#ST_3DMakeBox" title="ST_3DMakeBox">ST_3DMakeBox</a> - 与えられた3次元ポイントジオメトリから定義されるBOX3Dを生成します。</li><li class="listitem"><a class="link" href="#ST_Estimated_Extent" title="ST_Estimated_Extent">ST_Estimated_Extent</a> - 与えられた空間テーブルの「見積もられた」範囲を返します。ジオメトリカラムの統計情報から見積もります。指定されていない場合は現在のスキーマが使われます。</li><li class="listitem"><a class="link" href="#ST_Expand" title="ST_Expand">ST_Expand</a> - 入力ジオメトリのバウンディングボックスから全ての方向に拡張されたバウンディングボックスを返します。倍精度浮動小数点数を使います。</li><li class="listitem"><a class="link" href="#ST_Extent" title="ST_Extent">ST_Extent</a> - ジオメトリのバウンディングボックスを返す集計関数です。</li><li class="listitem"><a class="link" href="#ST_MakeBox2D" title="ST_MakeBox2D">ST_MakeBox2D</a> - 与えられたポイントジオメトリから定義されるBOX2Dを生成します。</li><li class="listitem"><a class="link" href="#ST_XMax" title="ST_XMax">ST_XMax</a> - 2次元,3次元バウンディングボックスまたはジオメトリにおけるXの最大値を返します。</li><li class="listitem"><a class="link" href="#ST_XMin" title="ST_XMin">ST_XMin</a> - 2次元,3次元バウンディングボックスまたはジオメトリにおけるXの最小値を返します。</li><li class="listitem"><a class="link" href="#ST_YMax" title="ST_YMax">ST_YMax</a> - 2次元,3次元バウンディングボックスまたはジオメトリにおけるYの最大値を返します。</li><li class="listitem"><a class="link" href="#ST_YMin" title="ST_YMin">ST_YMin</a> - 2次元,3次元バウンディングボックスまたはジオメトリにおけるYの最小値を返します。</li><li class="listitem"><a class="link" href="#ST_ZMax" title="ST_ZMax">ST_ZMax</a> - 2次元,3次元バウンディングボックスまたはジオメトリにおけるZの最大値を返します。</li><li class="listitem"><a class="link" href="#ST_ZMin" title="ST_ZMin">ST_ZMin</a> - 2次元または3次元ジオメトリのバウンディングボックスにおけるZの最小値を返します。</li></ul></div></div><div class="sect1" title="13.7. 3次元対応PostGIS関数"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="PostGIS_3D_Functions"></a>13.7. 3次元対応PostGIS関数</h2></div></div></div><p>次に示す関数は、Zインデクスを放り出さないPostGIS関数です。</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><a class="link" href="#AddGeometryColumn" title="AddGeometryColumn">AddGeometryColumn</a> - ジオメトリカラムを既存の属性テーブルに追加します。デフォルトでは、制約の定義でなく型の変更を使います。use_typmodパラメタをfalseで渡すと制約ベースの古い挙動で動作します。</li><li class="listitem"><a class="link" href="#Box3D" title="Box3D">Box3D</a> - ジオメトリの最大範囲を表すBOX3Dを返します。</li><li class="listitem"><a class="link" href="#DropGeometryColumn" title="DropGeometryColumn">DropGeometryColumn</a> - ジオメトリカラムを空間テーブルから除去します。</li><li class="listitem"><a class="link" href="#GeometryType" title="GeometryType">GeometryType</a> - ジオメトリ型を'LINESTRING', 'POLYGON', 'MULTIPOINT'などの文字列で返します。</li><li class="listitem"><a class="link" href="#ST_3DClosestPoint" title="ST_3DClosestPoint">ST_3DClosestPoint</a> - g1上の、g2に最も近い3次元ポイントを返します。3次元最短線のひとつめのポイントです。</li><li class="listitem"><a class="link" href="#ST_3DDFullyWithin" title="ST_3DDFullyWithin">ST_3DDFullyWithin</a> - 3次元ジオメトリが他のジオメトリとの距離が指定した範囲内ならtrueを返します。</li><li class="listitem"><a class="link" href="#ST_3DDWithin" title="ST_3DDWithin">ST_3DDWithin</a> - 3次元(XYZ)ジオメトリ型について、2つのジオメトリの3次元距離が指定した数の内にある場合にtrueを返します。</li><li class="listitem"><a class="link" href="#ST_3DDistance" title="ST_3DDistance">ST_3DDistance</a> - ジオメトリ型について、2つのジオメトリの、3次元の最小デカルト距離(空間参照系に基づきます)を、投影法の単位で返します。</li><li class="listitem"><a class="link" href="#ST_3DExtent" title="ST_3DExtent">ST_3DExtent</a> - ジオメトリのbox3Dバウンディングボックスを返す集計関数です。</li><li class="listitem"><a class="link" href="#ST_3DIntersects" title="ST_3DIntersects">ST_3DIntersects</a> - ジオメトリが3次元で「空間的にインタセクトする」場合にTRUEを返します。ポイントとラインストリングのみで動作します。</li><li class="listitem"><a class="link" href="#ST_3DLength" title="ST_3DLength">ST_3DLength</a> - LINESTRINGまたはMULTILINESTRINGに対して、ジオメトリの3次元長または2次元長を返します。</li><li class="listitem"><a class="link" href="#ST_3DLength_Spheroid" title="ST_3DLength_Spheroid">ST_3DLength_Spheroid</a> - 標高を考慮に入れて回転楕円体上の長さを計算します。これはST_Length_Spheroidの別名です。</li><li class="listitem"><a class="link" href="#ST_3DLongestLine" title="ST_3DLongestLine">ST_3DLongestLine</a> - 2つのジオメトリの3次元長が最長となるラインを返します。</li><li class="listitem"><a class="link" href="#ST_3DMakeBox" title="ST_3DMakeBox">ST_3DMakeBox</a> - 与えられた3次元ポイントジオメトリから定義されるBOX3Dを生成します。</li><li class="listitem"><a class="link" href="#ST_3DMaxDistance" title="ST_3DMaxDistance">ST_3DMaxDistance</a> - ジオメトリ型について、2つのジオメトリの、3次元の最大デカルト距離(空間参照系に基づきます)を、投影法の単位で返します。</li><li class="listitem"><a class="link" href="#ST_3DPerimeter" title="ST_3DPerimeter">ST_3DPerimeter</a> - POLYGONまたはMULTIPOLYGONジオメトリの場合に、3次元周囲長を返します。</li><li class="listitem"><a class="link" href="#ST_3DShortestLine" title="ST_3DShortestLine">ST_3DShortestLine</a> - 2つのジオメトリの3次元長が最短となるラインを返します。</li><li class="listitem"><a class="link" href="#ST_Accum" title="ST_Accum">ST_Accum</a> - 集計関数です。ジオメトリの配列を生成します。</li><li class="listitem"><a class="link" href="#ST_AddMeasure" title="ST_AddMeasure">ST_AddMeasure</a> - 開始点と終了点の間の線型的にM値を内挿した派生ジオメトリを返します。ジオメトリがM軸を持たない場合は追加されます。ジオメトリがM軸を持つ場合は新しい値に上書きされます。LINESTRINGSとMULTILINESTRINGSのみサポートされます。</li><li class="listitem"><a class="link" href="#ST_AddPoint" title="ST_AddPoint">ST_AddPoint</a> - ラインストリングに対して指定した&lt;position&gt;(0はじまり)の前にポイントを追加します。</li><li class="listitem"><a class="link" href="#ST_Affine" title="ST_Affine">ST_Affine</a> - 3次元アフィン変換をジオメトリに適用して移動、回転、拡大縮小を一度に行います。</li><li class="listitem"><a class="link" href="#ST_AsBinary" title="ST_AsBinary">ST_AsBinary</a> - ジオメトリ/ジオグラフィのSRIDメタデータのないWell-Known Binary(WKB)表現を返します。</li><li class="listitem"><a class="link" href="#ST_AsEWKB" title="ST_AsEWKB">ST_AsEWKB</a> - ジオメトリのSRIDメタデータが付いたWell-Known Binary(WKB)表現を返します。</li><li class="listitem"><a class="link" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a> - ジオメトリのSRIDメタデータが付いたWell-Known Text(WKT)表現を返します。</li><li class="listitem"><a class="link" href="#ST_AsGML" title="ST_AsGML">ST_AsGML</a> - GML第2版または第3版としてジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_AsGeoJSON" title="ST_AsGeoJSON">ST_AsGeoJSON</a> - GeoJSON要素としてジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_AsHEXEWKB" title="ST_AsHEXEWKB">ST_AsHEXEWKB</a> - ジオメトリのHEXEWKB表現(文字列)を返します。リトルエンディアン(NDS)またはビッグエンディアン(XDR)のどちらかのエンコーディングを使います。</li><li class="listitem"><a class="link" href="#ST_AsKML" title="ST_AsKML">ST_AsKML</a> - ジオメトリをKML要素で返します。いくつかの形式があります。デフォルトはversion=2, precision=15です。</li><li class="listitem"><a class="link" href="#ST_AsX3D" title="ST_AsX3D">ST_AsX3D</a> - ジオメトリをX3Dノード要素書式(ISO-IEC-19776-1.2-X3DEncodings-XML)で返します。</li><li class="listitem"><a class="link" href="#ST_Boundary" title="ST_Boundary">ST_Boundary</a> - ジオメトリの組み合わせ境界の閉包を返します。</li><li class="listitem"><a class="link" href="#ST_Collect" title="ST_Collect">ST_Collect</a> - 他のジオメトリのコレクションから、指定したST_Geometry値を返します。</li><li class="listitem"><a class="link" href="#ST_ConvexHull" title="ST_ConvexHull">ST_ConvexHull</a> - 凸包は与えられた集合の全てのジオメトリを含む最小の閉じた凸ジオメトリです。</li><li class="listitem"><a class="link" href="#ST_CoordDim" title="ST_CoordDim">ST_CoordDim</a> - ST_Geometry値の座標次元を返します。</li><li class="listitem"><a class="link" href="#ST_CurveToLine" title="ST_CurveToLine">ST_CurveToLine</a> - CIRCULARSTRING/CURVEPOLYGONをLINESTRING/POLYGONに変換します。</li><li class="listitem"><a class="link" href="#ST_Difference" title="ST_Difference">ST_Difference</a> - ジオメトリBにインタセクトしないジオメトリAの部分を表現するジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_Dump" title="ST_Dump">ST_Dump</a> - ジオメトリg1から作られたgeometry_dump(geom, path)行の集合を返します。</li><li class="listitem"><a class="link" href="#ST_DumpPoints" title="ST_DumpPoints">ST_DumpPoints</a> - ジオメトリを作る全ての点のgometry_dump(geom,path)行の集合を返します。</li><li class="listitem"><a class="link" href="#ST_DumpRings" title="ST_DumpRings">ST_DumpRings</a> - ポリゴンの外環と内環を表すgeometry_dump行の集合を返します。</li><li class="listitem"><a class="link" href="#ST_EndPoint" title="ST_EndPoint">ST_EndPoint</a> - LINESTRINGの最後のポイントをPOINTで返します。</li><li class="listitem"><a class="link" href="#ST_ExteriorRing" title="ST_ExteriorRing">ST_ExteriorRing</a> - POLYGONの外環を表現するラインストリングを返します。ジオメトリがポリゴンでない場合はNULLを返します。マルチポリゴンでは動作しません。</li><li class="listitem"><a class="link" href="#ST_FlipCoordinates" title="ST_FlipCoordinates">ST_FlipCoordinates</a> - 与えられたジオメトリのX軸とY軸とを入れ替えたものを返します。緯度/経度の地物を構築して、これを訂正したい場合に使います。</li><li class="listitem"><a class="link" href="#ST_ForceRHR" title="ST_ForceRHR">ST_ForceRHR</a> - ポリゴンの頂点の方向を右回りに強制します。</li><li class="listitem"><a class="link" href="#ST_Force_2D" title="ST_Force_2D">ST_Force_2D</a> - ジオメトリを「2次元モード」に強制させます。全ての出力表現はXY座標値のみを持つことになります。</li><li class="listitem"><a class="link" href="#ST_Force_3D" title="ST_Force_3D">ST_Force_3D</a> - ジオメトリをXYZモードに強制します。これはST_Force_3DZの別名です。</li><li class="listitem"><a class="link" href="#ST_Force_3DZ" title="ST_Force_3DZ">ST_Force_3DZ</a> - ジオメトリをXYZモードに強制します。これはST_Force_3Dと同義です。</li><li class="listitem"><a class="link" href="#ST_Force_4D" title="ST_Force_4D">ST_Force_4D</a> - ジオメトリをXYZMモードに強制します。</li><li class="listitem"><a class="link" href="#ST_Force_Collection" title="ST_Force_Collection">ST_Force_Collection</a> - ジオメトリをGEOMETRYCOLLECTIONに変換します。</li><li class="listitem"><a class="link" href="#ST_GeomFromEWKB" title="ST_GeomFromEWKB">ST_GeomFromEWKB</a> - 拡張Well-Known Binary表現(EWKB)から指定したST_Geometry値を返します。</li><li class="listitem"><a class="link" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a> - 拡張Well-Known Text表現(EWKT)から指定されたST_Geometry値を返します。</li><li class="listitem"><a class="link" href="#ST_GeomFromGML" title="ST_GeomFromGML">ST_GeomFromGML</a> - ジオメトリのGML表現を入力とし、PostGISジオメトリオブジェクトを出力します。</li><li class="listitem"><a class="link" href="#ST_GeomFromGeoJSON" title="ST_GeomFromGeoJSON">ST_GeomFromGeoJSON</a> - ジオメトリのGeoJSON表現を入力として、PostGISジオメトリオブジェクトを出力します。</li><li class="listitem"><a class="link" href="#ST_GeomFromKML" title="ST_GeomFromKML">ST_GeomFromKML</a> - ジオメトリのKML表現の入力をとり、PostGISジオメトリオブジェクトを出力します。</li><li class="listitem"><a class="link" href="#ST_GeometryN" title="ST_GeometryN">ST_GeometryN</a> - GEOMETRYCOLLECTION, MULTIPOINT, MULTILINESTRING, MULTICURVE, MULTIPOLYGONの場合には、1はじまりでN番目のジオメトリを返します。それ以外の場合にはNULLを返します。</li><li class="listitem"><a class="link" href="#ST_GeometryType" title="ST_GeometryType">ST_GeometryType</a> - ST_Geometry値のジオメトリ型を返します。</li><li class="listitem"><a class="link" href="#ST_HasArc" title="ST_HasArc">ST_HasArc</a> - ジオメトリまたはジオメトリコレクションが曲線ストリングを含む場合に、TRUEを返します。</li><li class="listitem"><a class="link" href="#ST_InteriorRingN" title="ST_InteriorRingN">ST_InteriorRingN</a> - ポリゴンのN番目の内環を返します。ジオメトリがポリゴンでないかNが範囲外の場合はNULLを返します。</li><li class="listitem"><a class="link" href="#ST_InterpolatePoint" title="ST_InterpolatePoint">ST_InterpolatePoint</a> - ジオメトリの、指定したポイントに近いポイントにおけるM値を返します。</li><li class="listitem"><a class="link" href="#ST_IsClosed" title="ST_IsClosed">ST_IsClosed</a> - LINESTRINGの始点と終点が一致する場合にTRUEを返します。多面体サーフェスの場合は閉じています(ボリュームです)。</li><li class="listitem"><a class="link" href="#ST_IsCollection" title="ST_IsCollection">ST_IsCollection</a> - 引数がコレクション(MULTI*, GEOMETRYCOLLECTION, ...)の場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#ST_IsSimple" title="ST_IsSimple">ST_IsSimple</a> - ジオメトリが自己インタセクションや自己接触のような異常な幾何学ポイントを持っていない場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#ST_Length_Spheroid" title="ST_Length_Spheroid">ST_Length_Spheroid</a> - LINESTRINGまたはMULTILINESTRINGに対して、回転楕円体上の2次元長または3次元長を返します。ジオメトリの座標が経度/緯度で、投影変換なしに距離を求める場合に使います。</li><li class="listitem"><a class="link" href="#ST_LineFromMultiPoint" title="ST_LineFromMultiPoint">ST_LineFromMultiPoint</a> - MULTIPOINTジオメトリからLINESTRINGを生成します。</li><li class="listitem"><a class="link" href="#ST_LineToCurve" title="ST_LineToCurve">ST_LineToCurve</a> - LINESTRING/POLYGONをCIRCULARSTRINGとCURVED POLYGONに変換します。</li><li class="listitem"><a class="link" href="#ST_Line_Interpolate_Point" title="ST_Line_Interpolate_Point">ST_Line_Interpolate_Point</a> - 線に沿った内挿点を返します。第2引数はfloat8で0から1の区間で、そのポイントが位置するラインストリングの総延長についての割合です。</li><li class="listitem"><a class="link" href="#ST_Line_Substring" title="ST_Line_Substring">ST_Line_Substring</a> - 2次元長に対する割合で示された開始位置と終了位置で切り取られた部分ラインストリングを返します。第2引数と第3引数は、float8で0から1の区間です。</li><li class="listitem"><a class="link" href="#ST_LocateBetweenElevations" title="ST_LocateBetweenElevations">ST_LocateBetweenElevations</a> - 指定したZ値の範囲内にある要素からなる、派生ジオメトリ(コレクション)値を返します。3次元、4次元のLINESTRINGSとMULTILINESTRINGSのみをサポートします。</li><li class="listitem"><a class="link" href="#ST_M" title="ST_M">ST_M</a> - ポイントのM座標値を返し、有効でないならNULLを返します。入力はポイントでなければなりません。</li><li class="listitem"><a class="link" href="#ST_MakeLine" title="ST_MakeLine">ST_MakeLine</a> - ポイントまたはラインジオメトリからラインストリングを生成します。</li><li class="listitem"><a class="link" href="#ST_MakePoint" title="ST_MakePoint">ST_MakePoint</a> - 2次元、XYZの3次元、4次元のポイントジオメトリを生成します。</li><li class="listitem"><a class="link" href="#ST_MakePolygon" title="ST_MakePolygon">ST_MakePolygon</a> - 与えられた外環で形成されるポリゴンを生成します。入力ジオメトリは閉じたラインストリングでなければなりません。</li><li class="listitem"><a class="link" href="#ST_MakeValid" title="ST_MakeValid">ST_MakeValid</a> - 頂点を失うことなしに不正なジオメトリを妥当なジオメトリにしようと試みます。</li><li class="listitem"><a class="link" href="#ST_MemUnion" title="ST_MemUnion">ST_MemUnion</a> - ST_Unionと同じですが、メモリフレンドリ(少ないメモリ使用、多いCPU時間)です。</li><li class="listitem"><a class="link" href="#ST_Mem_Size" title="ST_Mem_Size">ST_Mem_Size</a> - ジオメトリが取る容量(バイト単位)を返します。</li><li class="listitem"><a class="link" href="#ST_NDims" title="ST_NDims">ST_NDims</a> - オメトリの座標次元をsmall intで返します。値は2, 3, 4のいずれかです。</li><li class="listitem"><a class="link" href="#ST_NPoints" title="ST_NPoints">ST_NPoints</a> - ジオメトリのポイント(バーテック)数を返します。</li><li class="listitem"><a class="link" href="#ST_NRings" title="ST_NRings">ST_NRings</a> - ジオメトリがポリゴンまたはマルチポリゴンの場合、リング数を返します。</li><li class="listitem"><a class="link" href="#ST_Node" title="ST_Node">ST_Node</a> - ラインストリングの集合にノードを作成します。</li><li class="listitem"><a class="link" href="#ST_NumGeometries" title="ST_NumGeometries">ST_NumGeometries</a> - ジオメトリがジオメトリコレクションまたはマルチ系の場合はジオメトリの数を、単一のジオメトリの場合は1を返し、それ以外の場合はNULLを返します。</li><li class="listitem"><a class="link" href="#ST_NumPatches" title="ST_NumPatches">ST_NumPatches</a> - 多面体サーフェスのフェイス数を返します。多面体でないジオメトリの場合にはNULLを返します。</li><li class="listitem"><a class="link" href="#ST_PatchN" title="ST_PatchN">ST_PatchN</a> - ジオメトリがPOLYHEDRALSURFACEかPOLYHEDRALSURFACEMの場合には、1はじまりでN番目のジオメトリ(フェイス)を返します。それ以外の場合には、NULLを返します。</li><li class="listitem"><a class="link" href="#ST_PointFromWKB" title="ST_PointFromWKB">ST_PointFromWKB</a> - WKBと与えられたSRIDからジオメトリを生成します。</li><li class="listitem"><a class="link" href="#ST_PointN" title="ST_PointN">ST_PointN</a> - ジオメトリの最初のラインストリングまたは曲線ストリングのN番目のポイントを返します。ラインストリングが存在しない場合はNULLを返します。</li><li class="listitem"><a class="link" href="#ST_PointOnSurface" title="ST_PointOnSurface">ST_PointOnSurface</a> - サーフェス上にあることを保障されたPOINTを返します。</li><li class="listitem"><a class="link" href="#ST_Polygon" title="ST_Polygon">ST_Polygon</a> - 指定されたラインストリングとSRIDからポリゴンを生成します。</li><li class="listitem"><a class="link" href="#ST_RemovePoint" title="ST_RemovePoint">ST_RemovePoint</a> - ラインストリングからポイントを削除します。オフセットは0はじまりです。</li><li class="listitem"><a class="link" href="#ST_RemoveRepeatedPoints" title="ST_RemoveRepeatedPoints">ST_RemoveRepeatedPoints</a> - 入力ジオメトリから重複ポイントを除いたものを返します。</li><li class="listitem"><a class="link" href="#ST_Rotate" title="ST_Rotate">ST_Rotate</a> - ジオメトリを、原点について反時計回りにrotRadiasnぶん回転させます。</li><li class="listitem"><a class="link" href="#ST_RotateX" title="ST_RotateX">ST_RotateX</a> - ジオメトリをX軸についてrotRadians回転させます。</li><li class="listitem"><a class="link" href="#ST_RotateY" title="ST_RotateY">ST_RotateY</a> - ジオメトリgeomAをY軸についてrotRadians回転させます。</li><li class="listitem"><a class="link" href="#ST_RotateZ" title="ST_RotateZ">ST_RotateZ</a> - ジオメトリをZ軸についてrotRadians回転させます。</li><li class="listitem"><a class="link" href="#ST_Scale" title="ST_Scale">ST_Scale</a> - パラメータで軸を乗算してジオメトリを新しいサイズに拡大縮小します。ST_Scale(geom, Xfactor, Yfactor, Zfactor)となります。</li><li class="listitem"><a class="link" href="#ST_SetPoint" title="ST_SetPoint">ST_SetPoint</a> - ラインストリングのN番目を与えられたポイントに置き換えます。インデクスは0はじまりです。</li><li class="listitem"><a class="link" href="#ST_Shift_Longitude" title="ST_Shift_Longitude">ST_Shift_Longitude</a> - ジオメトリの全ての地物の全ての構成要素の全てのポイント/頂点を読み、経度が0未満なら360を足します。結果は、180度を中心とした地図にプロットされる0度から360度の間にあるデータとなります。</li><li class="listitem"><a class="link" href="#ST_SnapToGrid" title="ST_SnapToGrid">ST_SnapToGrid</a> - 入力ジオメトリの全ての点を規則的なグリッドにスナップします。</li><li class="listitem"><a class="link" href="#ST_StartPoint" title="ST_StartPoint">ST_StartPoint</a> - LINESTRINGの最初のポイントをPOINTとして返します。</li><li class="listitem"><a class="link" href="#ST_SymDifference" title="ST_SymDifference">ST_SymDifference</a> - AとBの、インタセクトしていない部分を表現するジオメトリを返します。対称と呼ばれるのは、ST_SymDifference(A,B) = ST_SymDifference(B,A) となるからです。</li><li class="listitem"><a class="link" href="#ST_TransScale" title="ST_TransScale">ST_TransScale</a> - deltaXとdeltaY引数を使ってジオメトリを移動させ、XFactor,YFactor引数で拡大縮小させます。2次元でのみ動作します。</li><li class="listitem"><a class="link" href="#ST_Translate" title="ST_Translate">ST_Translate</a> - 整数パラメータをオフセットにして新しい位置にジオメトリを移動させます。ST_Translate(geom, X, Y)またはST_Translate(geom, X, Y, Z)になります。</li><li class="listitem"><a class="link" href="#ST_UnaryUnion" title="ST_UnaryUnion">ST_UnaryUnion</a> - ST_Unionに似ていますが、ジオメトリ要素レベルで動作します。</li><li class="listitem"><a class="link" href="#ST_X" title="ST_X">ST_X</a> - ポイントのX座標値を返し、有効でないならNULLを返します。入力はポイントでなければなりません。</li><li class="listitem"><a class="link" href="#ST_XMax" title="ST_XMax">ST_XMax</a> - 2次元,3次元バウンディングボックスまたはジオメトリにおけるXの最大値を返します。</li><li class="listitem"><a class="link" href="#ST_XMin" title="ST_XMin">ST_XMin</a> - 2次元,3次元バウンディングボックスまたはジオメトリにおけるXの最小値を返します。</li><li class="listitem"><a class="link" href="#ST_Y" title="ST_Y">ST_Y</a> - ポイントのY座標値を返し、有効でないならNULLを返します。入力はポイントでなければなりません。</li><li class="listitem"><a class="link" href="#ST_YMax" title="ST_YMax">ST_YMax</a> - 2次元,3次元バウンディングボックスまたはジオメトリにおけるYの最大値を返します。</li><li class="listitem"><a class="link" href="#ST_YMin" title="ST_YMin">ST_YMin</a> - 2次元,3次元バウンディングボックスまたはジオメトリにおけるYの最小値を返します。</li><li class="listitem"><a class="link" href="#ST_Z" title="ST_Z">ST_Z</a> - ポイントのZ座標値を返し、有効でないならNULLを返します。入力はポイントでなければなりません。</li><li class="listitem"><a class="link" href="#ST_ZMax" title="ST_ZMax">ST_ZMax</a> - 2次元,3次元バウンディングボックスまたはジオメトリにおけるZの最大値を返します。</li><li class="listitem"><a class="link" href="#ST_ZMin" title="ST_ZMin">ST_ZMin</a> - 2次元または3次元ジオメトリのバウンディングボックスにおけるZの最小値を返します。</li><li class="listitem"><a class="link" href="#ST_Zmflag" title="ST_Zmflag">ST_Zmflag</a> - ポイントのZM(次元の意味)フラグをsmall intで返します。値は 0=XY, 1=XYM, 2=XYZ, 3=XYZMとなります。</li><li class="listitem"><a class="link" href="#UpdateGeometrySRID" title="UpdateGeometrySRID">UpdateGeometrySRID</a> - ジオメトリカラムの全てのフィーチャーのSRID、geometry_columnsメタデータとSRIDテーブル制約を更新します。</li><li class="listitem"><a class="link" href="#geometry_overlaps_nd" title="&amp;&amp;&amp;">geometry_overlaps_nd</a> - 3次元バウンディングボックスがBの3次元バウンディングボックスにインタセクトする場合にTRUEを返します。</li></ul></div></div><div class="sect1" title="13.8. PostGIS曲線ジオメトリ対応関数"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="PostGIS_Curved_GeometryFunctions"></a>13.8. PostGIS曲線ジオメトリ対応関数</h2></div></div></div><p>次に示す関数は、CIRCULARSTRING, CURVEDPOLYGON等の曲線ジオメトリ型が使えるPostGIS関数です。</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><a class="link" href="#AddGeometryColumn" title="AddGeometryColumn">AddGeometryColumn</a> - ジオメトリカラムを既存の属性テーブルに追加します。デフォルトでは、制約の定義でなく型の変更を使います。use_typmodパラメタをfalseで渡すと制約ベースの古い挙動で動作します。</li><li class="listitem"><a class="link" href="#Box2D" title="Box2D">Box2D</a> - ジオメトリの最大範囲を表すBOX2Dを返します。</li><li class="listitem"><a class="link" href="#Box3D" title="Box3D">Box3D</a> - ジオメトリの最大範囲を表すBOX3Dを返します。</li><li class="listitem"><a class="link" href="#DropGeometryColumn" title="DropGeometryColumn">DropGeometryColumn</a> - ジオメトリカラムを空間テーブルから除去します。</li><li class="listitem"><a class="link" href="#GeometryType" title="GeometryType">GeometryType</a> - ジオメトリ型を'LINESTRING', 'POLYGON', 'MULTIPOINT'などの文字列で返します。</li><li class="listitem"><a class="link" href="#PostGIS_AddBBox" title="PostGIS_AddBBox">PostGIS_AddBBox</a> - ジオメトリにバウンディングボックスを追加します。</li><li class="listitem"><a class="link" href="#PostGIS_DropBBox" title="PostGIS_DropBBox">PostGIS_DropBBox</a> - バウンディングボックスのキャッシュをジオメトリから削除します。</li><li class="listitem"><a class="link" href="#PostGIS_HasBBox" title="PostGIS_HasBBox">PostGIS_HasBBox</a> - このジオメトリのバウンディングボックスがキャッシュされているならTRUEを、それ以外ならFALSEを返します。</li><li class="listitem"><a class="link" href="#ST_3DExtent" title="ST_3DExtent">ST_3DExtent</a> - ジオメトリのbox3Dバウンディングボックスを返す集計関数です。</li><li class="listitem"><a class="link" href="#ST_Accum" title="ST_Accum">ST_Accum</a> - 集計関数です。ジオメトリの配列を生成します。</li><li class="listitem"><a class="link" href="#ST_Affine" title="ST_Affine">ST_Affine</a> - 3次元アフィン変換をジオメトリに適用して移動、回転、拡大縮小を一度に行います。</li><li class="listitem"><a class="link" href="#ST_AsBinary" title="ST_AsBinary">ST_AsBinary</a> - ジオメトリ/ジオグラフィのSRIDメタデータのないWell-Known Binary(WKB)表現を返します。</li><li class="listitem"><a class="link" href="#ST_AsEWKB" title="ST_AsEWKB">ST_AsEWKB</a> - ジオメトリのSRIDメタデータが付いたWell-Known Binary(WKB)表現を返します。</li><li class="listitem"><a class="link" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a> - ジオメトリのSRIDメタデータが付いたWell-Known Text(WKT)表現を返します。</li><li class="listitem"><a class="link" href="#ST_AsHEXEWKB" title="ST_AsHEXEWKB">ST_AsHEXEWKB</a> - ジオメトリのHEXEWKB表現(文字列)を返します。リトルエンディアン(NDS)またはビッグエンディアン(XDR)のどちらかのエンコーディングを使います。</li><li class="listitem"><a class="link" href="#ST_AsText" title="ST_AsText">ST_AsText</a> - ジオメトリ/ジオグラフィのSRIDメタデータのないWell-Known Text(WKT)表現を返します。</li><li class="listitem"><a class="link" href="#ST_Collect" title="ST_Collect">ST_Collect</a> - 他のジオメトリのコレクションから、指定したST_Geometry値を返します。</li><li class="listitem"><a class="link" href="#ST_CoordDim" title="ST_CoordDim">ST_CoordDim</a> - ST_Geometry値の座標次元を返します。</li><li class="listitem"><a class="link" href="#ST_CurveToLine" title="ST_CurveToLine">ST_CurveToLine</a> - CIRCULARSTRING/CURVEPOLYGONをLINESTRING/POLYGONに変換します。</li><li class="listitem"><a class="link" href="#ST_Dump" title="ST_Dump">ST_Dump</a> - ジオメトリg1から作られたgeometry_dump(geom, path)行の集合を返します。</li><li class="listitem"><a class="link" href="#ST_DumpPoints" title="ST_DumpPoints">ST_DumpPoints</a> - ジオメトリを作る全ての点のgometry_dump(geom,path)行の集合を返します。</li><li class="listitem"><a class="link" href="#ST_Estimated_Extent" title="ST_Estimated_Extent">ST_Estimated_Extent</a> - 与えられた空間テーブルの「見積もられた」範囲を返します。ジオメトリカラムの統計情報から見積もります。指定されていない場合は現在のスキーマが使われます。</li><li class="listitem"><a class="link" href="#ST_FlipCoordinates" title="ST_FlipCoordinates">ST_FlipCoordinates</a> - 与えられたジオメトリのX軸とY軸とを入れ替えたものを返します。緯度/経度の地物を構築して、これを訂正したい場合に使います。</li><li class="listitem"><a class="link" href="#ST_Force_2D" title="ST_Force_2D">ST_Force_2D</a> - ジオメトリを「2次元モード」に強制させます。全ての出力表現はXY座標値のみを持つことになります。</li><li class="listitem"><a class="link" href="#ST_Force_3D" title="ST_Force_3D">ST_Force_3D</a> - ジオメトリをXYZモードに強制します。これはST_Force_3DZの別名です。</li><li class="listitem"><a class="link" href="#ST_Force_3DM" title="ST_Force_3DM">ST_Force_3DM</a> - ジオメトリをXYMモードに強制します。</li><li class="listitem"><a class="link" href="#ST_Force_3DZ" title="ST_Force_3DZ">ST_Force_3DZ</a> - ジオメトリをXYZモードに強制します。これはST_Force_3Dと同義です。</li><li class="listitem"><a class="link" href="#ST_Force_4D" title="ST_Force_4D">ST_Force_4D</a> - ジオメトリをXYZMモードに強制します。</li><li class="listitem"><a class="link" href="#ST_Force_Collection" title="ST_Force_Collection">ST_Force_Collection</a> - ジオメトリをGEOMETRYCOLLECTIONに変換します。</li><li class="listitem"><a class="link" href="#ST_GeoHash" title="ST_GeoHash">ST_GeoHash</a> - ジオメトリのGeoHash表現(geohash.org)を返します。</li><li class="listitem"><a class="link" href="#ST_GeogFromWKB" title="ST_GeogFromWKB">ST_GeogFromWKB</a> - Well-Known Binaryジオメトリ表現(WKB)または拡張WKB(EWKB)からジオグラフィインスタンスを生成します。</li><li class="listitem"><a class="link" href="#ST_GeomFromEWKB" title="ST_GeomFromEWKB">ST_GeomFromEWKB</a> - 拡張Well-Known Binary表現(EWKB)から指定したST_Geometry値を返します。</li><li class="listitem"><a class="link" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a> - 拡張Well-Known Text表現(EWKT)から指定されたST_Geometry値を返します。</li><li class="listitem"><a class="link" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a> - Well-Known Text表現(WKT)から指定したST_Geometryを返します。</li><li class="listitem"><a class="link" href="#ST_GeomFromWKB" title="ST_GeomFromWKB">ST_GeomFromWKB</a> - Well-Knwon Binaryジオメトリ表現(WKB)と任意パラメタのSRIDからジオメトリインスタンスを生成します。</li><li class="listitem"><a class="link" href="#ST_GeometryN" title="ST_GeometryN">ST_GeometryN</a> - GEOMETRYCOLLECTION, MULTIPOINT, MULTILINESTRING, MULTICURVE, MULTIPOLYGONの場合には、1はじまりでN番目のジオメトリを返します。それ以外の場合にはNULLを返します。</li><li class="listitem"><a class="link" href="#ST_Geometry_EQ" title="=">=</a> - Aのバウンダリボックスが、Bのバウンダリボックスと同じ場合にTRUEを返します。バウンディングボックスには倍精度浮動小数点数を使います。</li><li class="listitem"><a class="link" href="#ST_Geometry_Overbelow" title="&amp;&lt;|">&amp;&lt;|</a> - AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの下にある場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#ST_HasArc" title="ST_HasArc">ST_HasArc</a> - ジオメトリまたはジオメトリコレクションが曲線ストリングを含む場合に、TRUEを返します。</li><li class="listitem"><a class="link" href="#ST_IsClosed" title="ST_IsClosed">ST_IsClosed</a> - LINESTRINGの始点と終点が一致する場合にTRUEを返します。多面体サーフェスの場合は閉じています(ボリュームです)。</li><li class="listitem"><a class="link" href="#ST_IsCollection" title="ST_IsCollection">ST_IsCollection</a> - 引数がコレクション(MULTI*, GEOMETRYCOLLECTION, ...)の場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#ST_IsEmpty" title="ST_IsEmpty">ST_IsEmpty</a> - ジオメトリが、空のジオメトリコレクション、ポリゴン、ポイント等の場合に、trueを返します。</li><li class="listitem"><a class="link" href="#ST_LineToCurve" title="ST_LineToCurve">ST_LineToCurve</a> - LINESTRING/POLYGONをCIRCULARSTRINGとCURVED POLYGONに変換します。</li><li class="listitem"><a class="link" href="#ST_Mem_Size" title="ST_Mem_Size">ST_Mem_Size</a> - ジオメトリが取る容量(バイト単位)を返します。</li><li class="listitem"><a class="link" href="#ST_NPoints" title="ST_NPoints">ST_NPoints</a> - ジオメトリのポイント(バーテック)数を返します。</li><li class="listitem"><a class="link" href="#ST_NRings" title="ST_NRings">ST_NRings</a> - ジオメトリがポリゴンまたはマルチポリゴンの場合、リング数を返します。</li><li class="listitem"><a class="link" href="#ST_PointFromWKB" title="ST_PointFromWKB">ST_PointFromWKB</a> - WKBと与えられたSRIDからジオメトリを生成します。</li><li class="listitem"><a class="link" href="#ST_PointN" title="ST_PointN">ST_PointN</a> - ジオメトリの最初のラインストリングまたは曲線ストリングのN番目のポイントを返します。ラインストリングが存在しない場合はNULLを返します。</li><li class="listitem"><a class="link" href="#ST_Rotate" title="ST_Rotate">ST_Rotate</a> - ジオメトリを、原点について反時計回りにrotRadiasnぶん回転させます。</li><li class="listitem"><a class="link" href="#ST_RotateZ" title="ST_RotateZ">ST_RotateZ</a> - ジオメトリをZ軸についてrotRadians回転させます。</li><li class="listitem"><a class="link" href="#ST_SRID" title="ST_SRID">ST_SRID</a> - ST_Geometryのspatial_ref_sysテーブルで定義されている空間参照系の識別番号を返します。</li><li class="listitem"><a class="link" href="#ST_Scale" title="ST_Scale">ST_Scale</a> - パラメータで軸を乗算してジオメトリを新しいサイズに拡大縮小します。ST_Scale(geom, Xfactor, Yfactor, Zfactor)となります。</li><li class="listitem"><a class="link" href="#ST_SetSRID" title="ST_SetSRID">ST_SetSRID</a> - ジオメトリのSRIDを特定の整数値に設定します。</li><li class="listitem"><a class="link" href="#ST_TransScale" title="ST_TransScale">ST_TransScale</a> - deltaXとdeltaY引数を使ってジオメトリを移動させ、XFactor,YFactor引数で拡大縮小させます。2次元でのみ動作します。</li><li class="listitem"><a class="link" href="#ST_Transform" title="ST_Transform">ST_Transform</a> - 整数パラメータで参照されるSRIDに座標変換し、新しいジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_Translate" title="ST_Translate">ST_Translate</a> - 整数パラメータをオフセットにして新しい位置にジオメトリを移動させます。ST_Translate(geom, X, Y)またはST_Translate(geom, X, Y, Z)になります。</li><li class="listitem"><a class="link" href="#ST_XMax" title="ST_XMax">ST_XMax</a> - 2次元,3次元バウンディングボックスまたはジオメトリにおけるXの最大値を返します。</li><li class="listitem"><a class="link" href="#ST_XMin" title="ST_XMin">ST_XMin</a> - 2次元,3次元バウンディングボックスまたはジオメトリにおけるXの最小値を返します。</li><li class="listitem"><a class="link" href="#ST_YMax" title="ST_YMax">ST_YMax</a> - 2次元,3次元バウンディングボックスまたはジオメトリにおけるYの最大値を返します。</li><li class="listitem"><a class="link" href="#ST_YMin" title="ST_YMin">ST_YMin</a> - 2次元,3次元バウンディングボックスまたはジオメトリにおけるYの最小値を返します。</li><li class="listitem"><a class="link" href="#ST_ZMax" title="ST_ZMax">ST_ZMax</a> - 2次元,3次元バウンディングボックスまたはジオメトリにおけるZの最大値を返します。</li><li class="listitem"><a class="link" href="#ST_ZMin" title="ST_ZMin">ST_ZMin</a> - 2次元または3次元ジオメトリのバウンディングボックスにおけるZの最小値を返します。</li><li class="listitem"><a class="link" href="#ST_Zmflag" title="ST_Zmflag">ST_Zmflag</a> - ポイントのZM(次元の意味)フラグをsmall intで返します。値は 0=XY, 1=XYM, 2=XYZ, 3=XYZMとなります。</li><li class="listitem"><a class="link" href="#UpdateGeometrySRID" title="UpdateGeometrySRID">UpdateGeometrySRID</a> - ジオメトリカラムの全てのフィーチャーのSRID、geometry_columnsメタデータとSRIDテーブル制約を更新します。</li><li class="listitem"><a class="link" href="#geometry_overlaps" title="&amp;&amp;">&amp;&amp;</a> - AのバウンディングボックスがBのバウンディングボックスをオーバラップする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#geometry_overlaps_nd" title="&amp;&amp;&amp;">&amp;&amp;&amp;</a> - 3次元バウンディングボックスがBの3次元バウンディングボックスにインタセクトする場合にTRUEを返します。</li></ul></div></div><div class="sect1" title="13.9. PostGIS多面体サーフェス対応関数"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="PostGIS_PS_GeometryFunctions"></a>13.9. PostGIS多面体サーフェス対応関数</h2></div></div></div><p>次に示す関数は、POLYHEDRALSURFACE, POLYHEDRALSURFACEMジオメトリが使えるPostGIS関数です。</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><a class="link" href="#Box2D" title="Box2D">Box2D</a> - ジオメトリの最大範囲を表すBOX2Dを返します。</li><li class="listitem"><a class="link" href="#Box3D" title="Box3D">Box3D</a> - ジオメトリの最大範囲を表すBOX3Dを返します。</li><li class="listitem"><a class="link" href="#GeometryType" title="GeometryType">GeometryType</a> - ジオメトリ型を'LINESTRING', 'POLYGON', 'MULTIPOINT'などの文字列で返します。</li><li class="listitem"><a class="link" href="#ST_3DClosestPoint" title="ST_3DClosestPoint">ST_3DClosestPoint</a> - g1上の、g2に最も近い3次元ポイントを返します。3次元最短線のひとつめのポイントです。</li><li class="listitem"><a class="link" href="#ST_3DDFullyWithin" title="ST_3DDFullyWithin">ST_3DDFullyWithin</a> - 3次元ジオメトリが他のジオメトリとの距離が指定した範囲内ならtrueを返します。</li><li class="listitem"><a class="link" href="#ST_3DDWithin" title="ST_3DDWithin">ST_3DDWithin</a> - 3次元(XYZ)ジオメトリ型について、2つのジオメトリの3次元距離が指定した数の内にある場合にtrueを返します。</li><li class="listitem"><a class="link" href="#ST_3DDistance" title="ST_3DDistance">ST_3DDistance</a> - ジオメトリ型について、2つのジオメトリの、3次元の最小デカルト距離(空間参照系に基づきます)を、投影法の単位で返します。</li><li class="listitem"><a class="link" href="#ST_3DExtent" title="ST_3DExtent">ST_3DExtent</a> - ジオメトリのbox3Dバウンディングボックスを返す集計関数です。</li><li class="listitem"><a class="link" href="#ST_3DIntersects" title="ST_3DIntersects">ST_3DIntersects</a> - ジオメトリが3次元で「空間的にインタセクトする」場合にTRUEを返します。ポイントとラインストリングのみで動作します。</li><li class="listitem"><a class="link" href="#ST_3DLongestLine" title="ST_3DLongestLine">ST_3DLongestLine</a> - 2つのジオメトリの3次元長が最長となるラインを返します。</li><li class="listitem"><a class="link" href="#ST_3DMaxDistance" title="ST_3DMaxDistance">ST_3DMaxDistance</a> - ジオメトリ型について、2つのジオメトリの、3次元の最大デカルト距離(空間参照系に基づきます)を、投影法の単位で返します。</li><li class="listitem"><a class="link" href="#ST_3DShortestLine" title="ST_3DShortestLine">ST_3DShortestLine</a> - 2つのジオメトリの3次元長が最短となるラインを返します。</li><li class="listitem"><a class="link" href="#ST_Accum" title="ST_Accum">ST_Accum</a> - 集計関数です。ジオメトリの配列を生成します。</li><li class="listitem"><a class="link" href="#ST_Affine" title="ST_Affine">ST_Affine</a> - 3次元アフィン変換をジオメトリに適用して移動、回転、拡大縮小を一度に行います。</li><li class="listitem"><a class="link" href="#ST_Area" title="ST_Area">ST_Area</a> - ポリゴンまたはマルチポリゴンの場合にはサーフェスの面積を返します。ジオメトリ型の「面積」はSRIDに基づく単位で、ジオグラフィ型の面積は平方メートルです。</li><li class="listitem"><a class="link" href="#ST_AsBinary" title="ST_AsBinary">ST_AsBinary</a> - ジオメトリ/ジオグラフィのSRIDメタデータのないWell-Known Binary(WKB)表現を返します。</li><li class="listitem"><a class="link" href="#ST_AsEWKB" title="ST_AsEWKB">ST_AsEWKB</a> - ジオメトリのSRIDメタデータが付いたWell-Known Binary(WKB)表現を返します。</li><li class="listitem"><a class="link" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a> - ジオメトリのSRIDメタデータが付いたWell-Known Text(WKT)表現を返します。</li><li class="listitem"><a class="link" href="#ST_AsGML" title="ST_AsGML">ST_AsGML</a> - GML第2版または第3版としてジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_AsX3D" title="ST_AsX3D">ST_AsX3D</a> - ジオメトリをX3Dノード要素書式(ISO-IEC-19776-1.2-X3DEncodings-XML)で返します。</li><li class="listitem"><a class="link" href="#ST_CoordDim" title="ST_CoordDim">ST_CoordDim</a> - ST_Geometry値の座標次元を返します。</li><li class="listitem"><a class="link" href="#ST_Dimension" title="ST_Dimension">ST_Dimension</a> - ジオメトリの固有次元を返します。座標次元以下でなければなりません。</li><li class="listitem"><a class="link" href="#ST_Dump" title="ST_Dump">ST_Dump</a> - ジオメトリg1から作られたgeometry_dump(geom, path)行の集合を返します。</li><li class="listitem"><a class="link" href="#ST_DumpPoints" title="ST_DumpPoints">ST_DumpPoints</a> - ジオメトリを作る全ての点のgometry_dump(geom,path)行の集合を返します。</li><li class="listitem"><a class="link" href="#ST_Expand" title="ST_Expand">ST_Expand</a> - 入力ジオメトリのバウンディングボックスから全ての方向に拡張されたバウンディングボックスを返します。倍精度浮動小数点数を使います。</li><li class="listitem"><a class="link" href="#ST_Extent" title="ST_Extent">ST_Extent</a> - ジオメトリのバウンディングボックスを返す集計関数です。</li><li class="listitem"><a class="link" href="#ST_FlipCoordinates" title="ST_FlipCoordinates">ST_FlipCoordinates</a> - 与えられたジオメトリのX軸とY軸とを入れ替えたものを返します。緯度/経度の地物を構築して、これを訂正したい場合に使います。</li><li class="listitem"><a class="link" href="#ST_ForceRHR" title="ST_ForceRHR">ST_ForceRHR</a> - ポリゴンの頂点の方向を右回りに強制します。</li><li class="listitem"><a class="link" href="#ST_Force_2D" title="ST_Force_2D">ST_Force_2D</a> - ジオメトリを「2次元モード」に強制させます。全ての出力表現はXY座標値のみを持つことになります。</li><li class="listitem"><a class="link" href="#ST_Force_3D" title="ST_Force_3D">ST_Force_3D</a> - ジオメトリをXYZモードに強制します。これはST_Force_3DZの別名です。</li><li class="listitem"><a class="link" href="#ST_Force_3DZ" title="ST_Force_3DZ">ST_Force_3DZ</a> - ジオメトリをXYZモードに強制します。これはST_Force_3Dと同義です。</li><li class="listitem"><a class="link" href="#ST_Force_Collection" title="ST_Force_Collection">ST_Force_Collection</a> - ジオメトリをGEOMETRYCOLLECTIONに変換します。</li><li class="listitem"><a class="link" href="#ST_GeomFromEWKB" title="ST_GeomFromEWKB">ST_GeomFromEWKB</a> - 拡張Well-Known Binary表現(EWKB)から指定したST_Geometry値を返します。</li><li class="listitem"><a class="link" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a> - 拡張Well-Known Text表現(EWKT)から指定されたST_Geometry値を返します。</li><li class="listitem"><a class="link" href="#ST_GeomFromGML" title="ST_GeomFromGML">ST_GeomFromGML</a> - ジオメトリのGML表現を入力とし、PostGISジオメトリオブジェクトを出力します。</li><li class="listitem"><a class="link" href="#ST_GeometryN" title="ST_GeometryN">ST_GeometryN</a> - GEOMETRYCOLLECTION, MULTIPOINT, MULTILINESTRING, MULTICURVE, MULTIPOLYGONの場合には、1はじまりでN番目のジオメトリを返します。それ以外の場合にはNULLを返します。</li><li class="listitem"><a class="link" href="#ST_GeometryType" title="ST_GeometryType">ST_GeometryType</a> - ST_Geometry値のジオメトリ型を返します。</li><li class="listitem"><a class="link" href="#ST_Geometry_EQ" title="=">=</a> - Aのバウンダリボックスが、Bのバウンダリボックスと同じ場合にTRUEを返します。バウンディングボックスには倍精度浮動小数点数を使います。</li><li class="listitem"><a class="link" href="#ST_Geometry_Overbelow" title="&amp;&lt;|">&amp;&lt;|</a> - AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの下にある場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#ST_Geometry_Same" title="~=">~=</a> - AのバウンディングボックスがBのバウンディングボックスと同じ場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#ST_IsClosed" title="ST_IsClosed">ST_IsClosed</a> - LINESTRINGの始点と終点が一致する場合にTRUEを返します。多面体サーフェスの場合は閉じています(ボリュームです)。</li><li class="listitem"><a class="link" href="#ST_Mem_Size" title="ST_Mem_Size">ST_Mem_Size</a> - ジオメトリが取る容量(バイト単位)を返します。</li><li class="listitem"><a class="link" href="#ST_NPoints" title="ST_NPoints">ST_NPoints</a> - ジオメトリのポイント(バーテック)数を返します。</li><li class="listitem"><a class="link" href="#ST_NumGeometries" title="ST_NumGeometries">ST_NumGeometries</a> - ジオメトリがジオメトリコレクションまたはマルチ系の場合はジオメトリの数を、単一のジオメトリの場合は1を返し、それ以外の場合はNULLを返します。</li><li class="listitem"><a class="link" href="#ST_NumPatches" title="ST_NumPatches">ST_NumPatches</a> - 多面体サーフェスのフェイス数を返します。多面体でないジオメトリの場合にはNULLを返します。</li><li class="listitem"><a class="link" href="#ST_PatchN" title="ST_PatchN">ST_PatchN</a> - ジオメトリがPOLYHEDRALSURFACEかPOLYHEDRALSURFACEMの場合には、1はじまりでN番目のジオメトリ(フェイス)を返します。それ以外の場合には、NULLを返します。</li><li class="listitem"><a class="link" href="#ST_RemoveRepeatedPoints" title="ST_RemoveRepeatedPoints">ST_RemoveRepeatedPoints</a> - 入力ジオメトリから重複ポイントを除いたものを返します。</li><li class="listitem"><a class="link" href="#ST_Rotate" title="ST_Rotate">ST_Rotate</a> - ジオメトリを、原点について反時計回りにrotRadiasnぶん回転させます。</li><li class="listitem"><a class="link" href="#ST_RotateX" title="ST_RotateX">ST_RotateX</a> - ジオメトリをX軸についてrotRadians回転させます。</li><li class="listitem"><a class="link" href="#ST_RotateY" title="ST_RotateY">ST_RotateY</a> - ジオメトリgeomAをY軸についてrotRadians回転させます。</li><li class="listitem"><a class="link" href="#ST_RotateZ" title="ST_RotateZ">ST_RotateZ</a> - ジオメトリをZ軸についてrotRadians回転させます。</li><li class="listitem"><a class="link" href="#ST_Scale" title="ST_Scale">ST_Scale</a> - パラメータで軸を乗算してジオメトリを新しいサイズに拡大縮小します。ST_Scale(geom, Xfactor, Yfactor, Zfactor)となります。</li><li class="listitem"><a class="link" href="#ST_Shift_Longitude" title="ST_Shift_Longitude">ST_Shift_Longitude</a> - ジオメトリの全ての地物の全ての構成要素の全てのポイント/頂点を読み、経度が0未満なら360を足します。結果は、180度を中心とした地図にプロットされる0度から360度の間にあるデータとなります。</li><li class="listitem"><a class="link" href="#ST_Transform" title="ST_Transform">ST_Transform</a> - 整数パラメータで参照されるSRIDに座標変換し、新しいジオメトリを返します。</li><li class="listitem"><a class="link" href="#geometry_overlaps" title="&amp;&amp;">&amp;&amp;</a> - AのバウンディングボックスがBのバウンディングボックスをオーバラップする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#geometry_overlaps_nd" title="&amp;&amp;&amp;">&amp;&amp;&amp;</a> - 3次元バウンディングボックスがBの3次元バウンディングボックスにインタセクトする場合にTRUEを返します。</li></ul></div></div><div class="sect1" title="13.10. PostGIS関数対応マトリクス"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="PostGIS_TypeFunctionMatrix"></a>13.10. PostGIS関数対応マトリクス</h2></div></div></div><p>次に示すのは、アルファベット順に並べたPostGIS空間関数と、動作する空間タイプの種類、対応しようとしてOGC/SQL準拠を示しています。</p><p>
      </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span>は、ネイティブで、その型と派生型とに対応しています。</li><li class="listitem"><span class="inlinemediaobject"><img src="images/matrix_transform.png"></span>は、動作しますが、ジオメトリにキャストして「最善のSRID」に投影変換したうえでジオグラフィに戻す、組み込み変換キャストを使います。大きな面積の領域や、極にある領域については、予期しない結果になることがありますし、浮動小数点数のごみを蓄積することがあります。</li><li class="listitem"><span class="inlinemediaobject"><img src="images/matrix_autocast.png"></span>は、直接的な対応でなくbox3dへの変換といった他からの自動キャストで動作します。</li><li class="listitem">geom - 基本的な2次元ジオメトリ(x,y)に対応しています。</li><li class="listitem">geog - 基本的な2次元ジオグラフィ(x,y)に対応しています。</li><li class="listitem">2.5D - 3次元/4次元(ZまたはM座標を持つ)空間内の基本的な2次元ジオメトリに対応しています。</li><li class="listitem">PS - 多面体サーフェス(Polyhedral Surface)に対応しています。</li><li class="listitem">T - 三角形と不規則三角網(TIN)に対応しています。</li></ul></div><p>
    </p><p>
      </p><div class="informaltable"><table border="1"><colgroup><col align="left" class="function"><col align="center" class="geometry"><col align="center" class="geography"><col align="center" class="25D"><col align="center" class="Curves"><col align="center" class="SQLMM"><col align="center" class="PS"><col align="center" class="T"></colgroup><thead><tr><th align="left">関数</th><th align="center">geom</th><th align="center">geog</th><th align="center">2.5D</th><th align="center">Curves</th><th align="center">SQL MM</th><th align="center">PS</th><th align="center">T</th></tr></thead><tbody><tr><td align="left">
                <a class="link" href="#Box2D" title="Box2D">Box2D</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#Box3D" title="Box3D">Box3D</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#Find_SRID" title="Find_SRID">Find_SRID</a>
              </td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#GeometryType" title="GeometryType">GeometryType</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_3DClosestPoint" title="ST_3DClosestPoint">ST_3DClosestPoint</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_3DDFullyWithin" title="ST_3DDFullyWithin">ST_3DDFullyWithin</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_3DDWithin" title="ST_3DDWithin">ST_3DDWithin</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_3DDistance" title="ST_3DDistance">ST_3DDistance</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_3DExtent" title="ST_3DExtent">ST_3DExtent</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_3DIntersects" title="ST_3DIntersects">ST_3DIntersects</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_3DLength" title="ST_3DLength">ST_3DLength</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_3DLength_Spheroid" title="ST_3DLength_Spheroid">ST_3DLength_Spheroid</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_3DLongestLine" title="ST_3DLongestLine">ST_3DLongestLine</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_3DMakeBox" title="ST_3DMakeBox">ST_3DMakeBox</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_3DMaxDistance" title="ST_3DMaxDistance">ST_3DMaxDistance</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_3DPerimeter" title="ST_3DPerimeter">ST_3DPerimeter</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_3DShortestLine" title="ST_3DShortestLine">ST_3DShortestLine</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Accum" title="ST_Accum">ST_Accum</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_AddMeasure" title="ST_AddMeasure">ST_AddMeasure</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_AddPoint" title="ST_AddPoint">ST_AddPoint</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Affine" title="ST_Affine">ST_Affine</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_Area" title="ST_Area">ST_Area</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_AsBinary" title="ST_AsBinary">ST_AsBinary</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_AsEWKB" title="ST_AsEWKB">ST_AsEWKB</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_AsGML" title="ST_AsGML">ST_AsGML</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_AsGeoJSON" title="ST_AsGeoJSON">ST_AsGeoJSON</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_AsHEXEWKB" title="ST_AsHEXEWKB">ST_AsHEXEWKB</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_AsKML" title="ST_AsKML">ST_AsKML</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_AsLatLonText" title="ST_AsLatLonText">ST_AsLatLonText</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_AsSVG" title="ST_AsSVG">ST_AsSVG</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_AsText" title="ST_AsText">ST_AsText</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_AsX3D" title="ST_AsX3D">ST_AsX3D</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_Azimuth" title="ST_Azimuth">ST_Azimuth</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_BdMPolyFromText" title="ST_BdMPolyFromText">ST_BdMPolyFromText</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_BdPolyFromText" title="ST_BdPolyFromText">ST_BdPolyFromText</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Boundary" title="ST_Boundary">ST_Boundary</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Buffer" title="ST_Buffer">ST_Buffer</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_transform.png"></span></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_BuildArea" title="ST_BuildArea">ST_BuildArea</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Centroid" title="ST_Centroid">ST_Centroid</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_ClosestPoint" title="ST_ClosestPoint">ST_ClosestPoint</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Collect" title="ST_Collect">ST_Collect</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_CollectionExtract" title="ST_CollectionExtract">ST_CollectionExtract</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_CollectionHomogenize" title="ST_CollectionHomogenize">ST_CollectionHomogenize</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_ConcaveHull" title="ST_ConcaveHull">ST_ConcaveHull</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Contains" title="ST_Contains">ST_Contains</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_ContainsProperly" title="ST_ContainsProperly">ST_ContainsProperly</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_ConvexHull" title="ST_ConvexHull">ST_ConvexHull</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_CoordDim" title="ST_CoordDim">ST_CoordDim</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_CoveredBy" title="ST_CoveredBy">ST_CoveredBy</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Covers" title="ST_Covers">ST_Covers</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Crosses" title="ST_Crosses">ST_Crosses</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_CurveToLine" title="ST_CurveToLine">ST_CurveToLine</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_DFullyWithin" title="ST_DFullyWithin">ST_DFullyWithin</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_DWithin" title="ST_DWithin">ST_DWithin</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Difference" title="ST_Difference">ST_Difference</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Dimension" title="ST_Dimension">ST_Dimension</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_Disjoint" title="ST_Disjoint">ST_Disjoint</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Distance" title="ST_Distance">ST_Distance</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Distance_Sphere" title="ST_Distance_Sphere">ST_Distance_Sphere</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Distance_Spheroid" title="ST_Distance_Spheroid">ST_Distance_Spheroid</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Dump" title="ST_Dump">ST_Dump</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_DumpPoints" title="ST_DumpPoints">ST_DumpPoints</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_DumpRings" title="ST_DumpRings">ST_DumpRings</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_EndPoint" title="ST_EndPoint">ST_EndPoint</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Envelope" title="ST_Envelope">ST_Envelope</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Equals" title="ST_Equals">ST_Equals</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Estimated_Extent" title="ST_Estimated_Extent">ST_Estimated_Extent</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_autocast.png"></span></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Expand" title="ST_Expand">ST_Expand</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_Extent" title="ST_Extent">ST_Extent</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_ExteriorRing" title="ST_ExteriorRing">ST_ExteriorRing</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_FlipCoordinates" title="ST_FlipCoordinates">ST_FlipCoordinates</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_ForceRHR" title="ST_ForceRHR">ST_ForceRHR</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Force_2D" title="ST_Force_2D">ST_Force_2D</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Force_3D" title="ST_Force_3D">ST_Force_3D</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Force_3DM" title="ST_Force_3DM">ST_Force_3DM</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Force_3DZ" title="ST_Force_3DZ">ST_Force_3DZ</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Force_4D" title="ST_Force_4D">ST_Force_4D</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Force_Collection" title="ST_Force_Collection">ST_Force_Collection</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_GMLToSQL" title="ST_GMLToSQL">ST_GMLToSQL</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_GeoHash" title="ST_GeoHash">ST_GeoHash</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_GeogFromText" title="ST_GeogFromText">ST_GeogFromText</a>
              </td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_GeogFromWKB" title="ST_GeogFromWKB">ST_GeogFromWKB</a>
              </td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_GeographyFromText" title="ST_GeographyFromText">ST_GeographyFromText</a>
              </td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_GeomCollFromText" title="ST_GeomCollFromText">ST_GeomCollFromText</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_GeomFromEWKB" title="ST_GeomFromEWKB">ST_GeomFromEWKB</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_GeomFromGML" title="ST_GeomFromGML">ST_GeomFromGML</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_GeomFromGeoJSON" title="ST_GeomFromGeoJSON">ST_GeomFromGeoJSON</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_GeomFromKML" title="ST_GeomFromKML">ST_GeomFromKML</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_GeomFromWKB" title="ST_GeomFromWKB">ST_GeomFromWKB</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_GeometryFromText" title="ST_GeometryFromText">ST_GeometryFromText</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_GeometryN" title="ST_GeometryN">ST_GeometryN</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_GeometryType" title="ST_GeometryType">ST_GeometryType</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Geometry_Above" title="|&gt;&gt;">|&gt;&gt;</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Geometry_Below" title="&lt;&lt;|">&lt;&lt;|</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Geometry_Contain" title="~">~</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Geometry_Contained" title="@">@</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Geometry_EQ" title="=">=</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Geometry_Left" title="&lt;&lt;">&lt;&lt;</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Geometry_Overabove" title="|&amp;&gt;">|&amp;&gt;</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Geometry_Overbelow" title="&amp;&lt;|">&amp;&lt;|</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Geometry_Overleft" title="&amp;&lt;">&amp;&lt;</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Geometry_Overright" title="&amp;&gt;">&amp;&gt;</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Geometry_Right" title="&gt;&gt;">&gt;&gt;</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Geometry_Same" title="~=">~=</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_HasArc" title="ST_HasArc">ST_HasArc</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_HausdorffDistance" title="ST_HausdorffDistance">ST_HausdorffDistance</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_InteriorRingN" title="ST_InteriorRingN">ST_InteriorRingN</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_InterpolatePoint" title="ST_InterpolatePoint">ST_InterpolatePoint</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Intersection" title="ST_Intersection">ST_Intersection</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_transform.png"></span></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Intersects" title="ST_Intersects">ST_Intersects</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_IsClosed" title="ST_IsClosed">ST_IsClosed</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_IsCollection" title="ST_IsCollection">ST_IsCollection</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_IsEmpty" title="ST_IsEmpty">ST_IsEmpty</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_IsRing" title="ST_IsRing">ST_IsRing</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_IsSimple" title="ST_IsSimple">ST_IsSimple</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_IsValid" title="ST_IsValid">ST_IsValid</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_IsValidDetail" title="ST_IsValidDetail">ST_IsValidDetail</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_IsValidReason" title="ST_IsValidReason">ST_IsValidReason</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Length" title="ST_Length">ST_Length</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Length2D" title="ST_Length2D">ST_Length2D</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Length2D_Spheroid" title="ST_Length2D_Spheroid">ST_Length2D_Spheroid</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Length_Spheroid" title="ST_Length_Spheroid">ST_Length_Spheroid</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_LineCrossingDirection" title="ST_LineCrossingDirection">ST_LineCrossingDirection</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_LineFromMultiPoint" title="ST_LineFromMultiPoint">ST_LineFromMultiPoint</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_LineFromText" title="ST_LineFromText">ST_LineFromText</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_LineFromWKB" title="ST_LineFromWKB">ST_LineFromWKB</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_LineMerge" title="ST_LineMerge">ST_LineMerge</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_LineToCurve" title="ST_LineToCurve">ST_LineToCurve</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Line_Interpolate_Point" title="ST_Line_Interpolate_Point">ST_Line_Interpolate_Point</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Line_Locate_Point" title="ST_Line_Locate_Point">ST_Line_Locate_Point</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Line_Substring" title="ST_Line_Substring">ST_Line_Substring</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_LinestringFromWKB" title="ST_LinestringFromWKB">ST_LinestringFromWKB</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_LocateAlong" title="ST_LocateAlong">ST_LocateAlong</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_LocateBetween" title="ST_LocateBetween">ST_LocateBetween</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_LocateBetweenElevations" title="ST_LocateBetweenElevations">ST_LocateBetweenElevations</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_LongestLine" title="ST_LongestLine">ST_LongestLine</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_M" title="ST_M">ST_M</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_MLineFromText" title="ST_MLineFromText">ST_MLineFromText</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_MPointFromText" title="ST_MPointFromText">ST_MPointFromText</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_MPolyFromText" title="ST_MPolyFromText">ST_MPolyFromText</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_MakeBox2D" title="ST_MakeBox2D">ST_MakeBox2D</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_MakeEnvelope" title="ST_MakeEnvelope">ST_MakeEnvelope</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_MakeLine" title="ST_MakeLine">ST_MakeLine</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_MakePoint" title="ST_MakePoint">ST_MakePoint</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_MakePointM" title="ST_MakePointM">ST_MakePointM</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_MakePolygon" title="ST_MakePolygon">ST_MakePolygon</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_MakeValid" title="ST_MakeValid">ST_MakeValid</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_MaxDistance" title="ST_MaxDistance">ST_MaxDistance</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_MemUnion" title="ST_MemUnion">ST_MemUnion</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Mem_Size" title="ST_Mem_Size">ST_Mem_Size</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_MinimumBoundingCircle" title="ST_MinimumBoundingCircle">ST_MinimumBoundingCircle</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Multi" title="ST_Multi">ST_Multi</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_NDims" title="ST_NDims">ST_NDims</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_NPoints" title="ST_NPoints">ST_NPoints</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_NRings" title="ST_NRings">ST_NRings</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Node" title="ST_Node">ST_Node</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_NumGeometries" title="ST_NumGeometries">ST_NumGeometries</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_NumInteriorRing" title="ST_NumInteriorRing">ST_NumInteriorRing</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_NumInteriorRings" title="ST_NumInteriorRings">ST_NumInteriorRings</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_NumPatches" title="ST_NumPatches">ST_NumPatches</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_NumPoints" title="ST_NumPoints">ST_NumPoints</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_OffsetCurve" title="ST_OffsetCurve">ST_OffsetCurve</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_OrderingEquals" title="ST_OrderingEquals">ST_OrderingEquals</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Overlaps" title="ST_Overlaps">ST_Overlaps</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_PatchN" title="ST_PatchN">ST_PatchN</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Perimeter" title="ST_Perimeter">ST_Perimeter</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Perimeter2D" title="ST_Perimeter2D">ST_Perimeter2D</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Point" title="ST_Point">ST_Point</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_PointFromText" title="ST_PointFromText">ST_PointFromText</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_PointFromWKB" title="ST_PointFromWKB">ST_PointFromWKB</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_PointN" title="ST_PointN">ST_PointN</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_PointOnSurface" title="ST_PointOnSurface">ST_PointOnSurface</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Point_Inside_Circle" title="ST_Point_Inside_Circle">ST_Point_Inside_Circle</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Polygon" title="ST_Polygon">ST_Polygon</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_PolygonFromText" title="ST_PolygonFromText">ST_PolygonFromText</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Polygonize" title="ST_Polygonize">ST_Polygonize</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Project" title="ST_Project">ST_Project</a>
              </td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Relate" title="ST_Relate">ST_Relate</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_RelateMatch" title="ST_RelateMatch">ST_RelateMatch</a>
              </td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_RemovePoint" title="ST_RemovePoint">ST_RemovePoint</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_RemoveRepeatedPoints" title="ST_RemoveRepeatedPoints">ST_RemoveRepeatedPoints</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Reverse" title="ST_Reverse">ST_Reverse</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Rotate" title="ST_Rotate">ST_Rotate</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_RotateX" title="ST_RotateX">ST_RotateX</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_RotateY" title="ST_RotateY">ST_RotateY</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_RotateZ" title="ST_RotateZ">ST_RotateZ</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_SRID" title="ST_SRID">ST_SRID</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Scale" title="ST_Scale">ST_Scale</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_Segmentize" title="ST_Segmentize">ST_Segmentize</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_SetPoint" title="ST_SetPoint">ST_SetPoint</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_SetSRID" title="ST_SetSRID">ST_SetSRID</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_SharedPaths" title="ST_SharedPaths">ST_SharedPaths</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Shift_Longitude" title="ST_Shift_Longitude">ST_Shift_Longitude</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_ShortestLine" title="ST_ShortestLine">ST_ShortestLine</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Simplify" title="ST_Simplify">ST_Simplify</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_SimplifyPreserveTopology" title="ST_SimplifyPreserveTopology">ST_SimplifyPreserveTopology</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Snap" title="ST_Snap">ST_Snap</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_SnapToGrid" title="ST_SnapToGrid">ST_SnapToGrid</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Split" title="ST_Split">ST_Split</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_StartPoint" title="ST_StartPoint">ST_StartPoint</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Summary" title="ST_Summary">ST_Summary</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_SymDifference" title="ST_SymDifference">ST_SymDifference</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Touches" title="ST_Touches">ST_Touches</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_TransScale" title="ST_TransScale">ST_TransScale</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Transform" title="ST_Transform">ST_Transform</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Translate" title="ST_Translate">ST_Translate</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_UnaryUnion" title="ST_UnaryUnion">ST_UnaryUnion</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Union" title="ST_Union">ST_Union</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_WKBToSQL" title="ST_WKBToSQL">ST_WKBToSQL</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_WKTToSQL" title="ST_WKTToSQL">ST_WKTToSQL</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Within" title="ST_Within">ST_Within</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_X" title="ST_X">ST_X</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_XMax" title="ST_XMax">ST_XMax</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_autocast.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_XMin" title="ST_XMin">ST_XMin</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_autocast.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Y" title="ST_Y">ST_Y</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_YMax" title="ST_YMax">ST_YMax</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_autocast.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_YMin" title="ST_YMin">ST_YMin</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_autocast.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Z" title="ST_Z">ST_Z</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_ZMax" title="ST_ZMax">ST_ZMax</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_autocast.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_ZMin" title="ST_ZMin">ST_ZMin</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_autocast.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#ST_Zmflag" title="ST_Zmflag">ST_Zmflag</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#geometry_distance_box" title="&lt;#&gt;">&lt;#&gt;</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#geometry_distance_centroid" title="&lt;-&gt;">&lt;-&gt;</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#geometry_overlaps" title="&amp;&amp;">&amp;&amp;</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td></tr><tr><td align="left">
                <a class="link" href="#geometry_overlaps_nd" title="&amp;&amp;&amp;">&amp;&amp;&amp;</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr></tbody></table></div><p>
    </p></div><div class="sect1" title="13.11. 新規作成/機能強化/変更されたPostGIS関数"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="NewFunctions"></a>13.11. 新規作成/機能強化/変更されたPostGIS関数</h2></div></div></div><div class="toc"><dl><dt><span class="sect2"><a href="#NewFunctions_2_0">13.11.1. PostGIS 2.0で新規作成/機能強化/変更された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_2_0_Changed">13.11.2. PostGIS 2.0での関数の挙動変更</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_1_5">13.11.3. PostGIS 1.5で新規作成/機能強化/挙動変更された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_1_4">13.11.4. PostGIS 1.4で新規作成/機能強化/挙動変更された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_1_3">13.11.5. PostGIS 1.3で新規作成された関数</a></span></dt></dl></div><div class="sect2" title="13.11.1. PostGIS 2.0で新規作成/機能強化/変更された関数"><div class="titlepage"><div><div><h3 class="title"><a name="NewFunctions_2_0"></a>13.11.1. PostGIS 2.0で新規作成/機能強化/変更された関数</h3></div></div></div><p>次に示す関数は、2.0リリースで新規作成/機能強化/変更(<a class="xref" href="#NewFunctions_2_0_Changed" title="13.11.2. PostGIS 2.0での関数の挙動変更">「PostGIS 2.0での関数の挙動変更」</a>)されたPostGIS関数です。</p><p>新ジオメトリタイプ: TINと多面体サーフェスが2.0で導入されました。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>トポロジ機能の大幅な改良がありました。詳細情報については<a class="xref" href="#Topology" title="第11章 トポロジ">11章<i>トポロジ</i></a>を参照して下さい。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>PostGIS 2.0では、ラスタ型とラスタ機能がPostGISに統合されました。ここに一覧を出すには、新しいラスタ関数はあまりに多く、全ての関数が新しいので、有効なラスタ関数の詳細については<a class="xref" href="#RT_reference" title="第9章 ラスタ リファレンス">9章<i>ラスタ リファレンス</i></a>を参照して下さい。2.0より前では、raster_columnsとraster_overviewsは実際のテーブルでした。2.0リリースでビューに変更されました。<code class="varname">ST_AddRasterColumn</code>等の関数は削除され、<a class="xref" href="#RT_AddRasterConstraints" title="AddRasterConstraints">AddRasterConstraints</a>, <a class="xref" href="#RT_DropRasterConstraints" title="DropRasterConstraints">DropRasterConstraints</a>に置き換えられました。結果として、ラスタテーブルを生成するアプリケーションは変更が必要になるかも知れなくなりました。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>
Tiger GeocoderはTIGER 2010センサスデータで動作するよう更新され、
現在はPostGIS文書の中心的な文書に取り込まれています(訳注: 訳していません)。
逆ジオコーダ関数も追加されました。
詳細については<a class="xref" href="#Tiger_Geocoder" title="12.1. Tiger Geocoder">「Tiger Geocoder」</a>を参照して下さい。</p></td></tr></table></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><a class="link" href="#geometry_overlaps_nd" title="&amp;&amp;&amp;">&amp;&amp;&amp;</a> - 初出: 2.0.0 3次元バウンディングボックスがBの3次元バウンディングボックスにインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#geometry_distance_box" title="&lt;#&gt;">&lt;#&gt;</a> - 初出: 2.0.0 PostgreSQL 9.1以上でのみ有効です。 2ジオメトリのバウンディングボックス間の距離を返します。ポイントの場合は、距離とほとんど同じ(バウンディングボックスは単精度であり、ジオメトリは倍精度なので異なる)かを調べます。KNN GiST機能を使った距離による並べ替えと近傍の制限とに使います。</li><li class="listitem"><a class="link" href="#geometry_distance_centroid" title="&lt;-&gt;">&lt;-&gt;</a> - 初出: 2.0.0 PostgreSQL 9.1以上でのみ有効です。 2つのポイントの間の距離を返します。ポイントでは、ポイントは単精度(元となるポイントジオメトリが倍精度ですが)を使って調べます。他のジオメトリタイプでは、バウンディングボックスの重心どうしの距離を返します。KNN GiST機能を使った距離による並べ替えや近傍の制限に使います。</li><li class="listitem"><a class="link" href="#AddEdge" title="AddEdge">AddEdge</a> - 初出: 2.0.0 GEOS 3.3.0以上が必要 指定したラインストリングジオメトリを使って指定したトポロジスキーマにおいて、ラインストリングエッジをエッジテーブルに追加し、関連する始点終点のノードをノードテーブルに追加し、新しい(または既存の)エッジの識別番号を返します。</li><li class="listitem"><a class="link" href="#AddFace" title="AddFace">AddFace</a> - 初出: 2.0.0 フェイスプリミティブをトポロジに登録し、その識別番号を得ます。</li><li class="listitem"><a class="link" href="#AddNode" title="AddNode">AddNode</a> - 初出: 2.0.0 指定したトポロジスキーマのノードテーブルにポイントノードを追加し、新しいノードの識別番号を返します。指定したポイントに既にノードがある場合は既存のノード識別番号を返します。</li><li class="listitem"><a class="link" href="#RT_AddRasterConstraints" title="AddRasterConstraints">AddRasterConstraints</a> - 初出: 2.0.0 ロードされたラスタテーブルの特定のカラムにラスタ制約を追加します。制約には空間参照系、スケール、ブロックサイズ、アラインメント、バンド、バンド型、ラスタカラムが規則正しいブロックかどうかを示すフラグがあります。テーブルは制約が推論されるためのデータがロードされなければなりません。制約の設定が完了するとtrueを返し、問題があると通知を返します。</li><li class="listitem"><a class="link" href="#AsGML" title="AsGML">AsGML</a> - 初出: 2.0.0  TopoGeometryのGML表現を返します。</li><li class="listitem"><a class="link" href="#CopyTopology" title="CopyTopology">CopyTopology</a> - 初出: 2.0.0 トポロジ構造(ノード、エッジ、フェイス、レイヤ、TopoGeometry)を複写します。</li><li class="listitem"><a class="link" href="#RT_DropRasterConstraints" title="DropRasterConstraints">DropRasterConstraints</a> - 初出: 2.0.0 ラスタテーブルカラムへの参照であるPostGISラスタ制約を削除します。データの再読み込みやラスタカラムデータの更新の際に使います。</li><li class="listitem"><a class="link" href="#GetEdgeByPoint" title="GetEdgeByPoint">GetEdgeByPoint</a> - 初出: 2.0.0 - GEOS 3.3.0以上が必要  与えられたポイントにインタセクトするエッジの識別番号を探索します。</li><li class="listitem"><a class="link" href="#GetFaceByPoint" title="GetFaceByPoint">GetFaceByPoint</a> - 初出: 2.0.0 - GEOS 3.3.0以上が必要  与えられたポイントにインタセクトするフェイスの識別番号を探索します。</li><li class="listitem"><a class="link" href="#GetNodeByPoint" title="GetNodeByPoint">GetNodeByPoint</a> - 初出: 2.0.0 - GEOS 3.3.0以上が必要  ポイント位置にあるノードの識別番号を探索します。</li><li class="listitem"><a class="link" href="#GetNodeEdges" title="GetNodeEdges">GetNodeEdges</a> - 初出: 2.0  与えられたノードへのエッジのインシデンスの集合を整列して返します。</li><li class="listitem"><a class="link" href="#GetRingEdges" title="GetRingEdges">GetRingEdges</a> - 初出: 2.0  与えられたエッジで環を形成するエッジの集合を整列して返します。</li><li class="listitem"><a class="link" href="#GetTopologySRID" title="GetTopologySRID">GetTopologySRID</a> - 初出: 2.0.0 トポロジ名からtopology.topologyテーブル内にあるトポロジのSRIDを返します。</li><li class="listitem"><a class="link" href="#TopologyPolygonize" title="Polygonize">Polygonize</a> - 初出: 2.0.0 トポロジエッジで定義されるフェイスを探索し、追加します。</li><li class="listitem"><a class="link" href="#ST_3DClosestPoint" title="ST_3DClosestPoint">ST_3DClosestPoint</a> - 初出: 2.0.0 g1上の、g2に最も近い3次元ポイントを返します。3次元最短線のひとつめのポイントです。</li><li class="listitem"><a class="link" href="#ST_3DDFullyWithin" title="ST_3DDFullyWithin">ST_3DDFullyWithin</a> - 初出: 2.0.0 3次元ジオメトリが他のジオメトリとの距離が指定した範囲内ならtrueを返します。</li><li class="listitem"><a class="link" href="#ST_3DDWithin" title="ST_3DDWithin">ST_3DDWithin</a> - 初出: 2.0.0 3次元(XYZ)ジオメトリ型について、2つのジオメトリの3次元距離が指定した数の内にある場合にtrueを返します。</li><li class="listitem"><a class="link" href="#ST_3DDistance" title="ST_3DDistance">ST_3DDistance</a> - 初出: 2.0.0 ジオメトリ型について、2つのジオメトリの、3次元の最小デカルト距離(空間参照系に基づきます)を、投影法の単位で返します。</li><li class="listitem"><a class="link" href="#ST_3DIntersects" title="ST_3DIntersects">ST_3DIntersects</a> - 初出: 2.0.0 ジオメトリが3次元で「空間的にインタセクトする」場合にTRUEを返します。ポイントとラインストリングのみで動作します。</li><li class="listitem"><a class="link" href="#ST_3DLongestLine" title="ST_3DLongestLine">ST_3DLongestLine</a> - 初出: 2.0.0 2つのジオメトリの3次元長が最長となるラインを返します。</li><li class="listitem"><a class="link" href="#ST_3DMaxDistance" title="ST_3DMaxDistance">ST_3DMaxDistance</a> - 初出: 2.0.0 ジオメトリ型について、2つのジオメトリの、3次元の最大デカルト距離(空間参照系に基づきます)を、投影法の単位で返します。</li><li class="listitem"><a class="link" href="#ST_3DShortestLine" title="ST_3DShortestLine">ST_3DShortestLine</a> - 初出: 2.0.0 2つのジオメトリの3次元長が最短となるラインを返します。</li><li class="listitem"><a class="link" href="#ST_AddEdgeModFace" title="ST_AddEdgeModFace">ST_AddEdgeModFace</a> - 初出: 2.0  新しいエッジを追加します。新しいエッジがフェイスを分割する場合には、もとのフェイスを編集し、1つのフェイスを追加します。</li><li class="listitem"><a class="link" href="#ST_AddEdgeNewFaces" title="ST_AddEdgeNewFaces">ST_AddEdgeNewFaces</a> - 初出: 2.0  新しいエッジを追加します。新しいエッジがフェイスを分割する場合には、もとのフェイスを削除して、分割した2つのフェイスに置き換えます。</li><li class="listitem"><a class="link" href="#RT_ST_AsGDALRaster" title="ST_AsGDALRaster">ST_AsGDALRaster</a> - 初出: 2.0.0 - GDAL 1.6.0以上が必要です。 指定されたGDALラスタ書式でラスタタイルを返します。ラスタ書式はコンパイルしたライブラリが対応するものです。ライブラリが対応する書式の一覧を得るにはST_GDALRasters()を使います。</li><li class="listitem"><a class="link" href="#RT_ST_AsJPEG" title="ST_AsJPEG">ST_AsJPEG</a> - 初出: 2.0.0 - GDAL 1.6.0以上が必要です。 ラスタの選択されたバンドを、単一のJoint Photographic Exports Group (JPEG)画像としてバイト配列で返します。バンドを指定せず、1バンドか3以上のバンドがある場合には、1番バンドを使用します。3バンドのみ指定した場合には、3バンドを使用し、RGBに対応付けます。</li><li class="listitem"><a class="link" href="#ST_AsLatLonText" title="ST_AsLatLonText">ST_AsLatLonText</a> - 初出: 2.0 与えられたポイントの度・分・秒表現を返します。</li><li class="listitem"><a class="link" href="#RT_ST_AsPNG" title="ST_AsPNG">ST_AsPNG</a> - 初出: 2.0.0 - GDAL 1.6.0以上が必要です。 ラスタの選択されたバンドを、単一のportable network graphics(PNG)画像としてバイト配列で返します。バンドを指定せず、1バンドか3バンド化4バンドある場合には、全てのバンドを使用します。バンドを指定せず、2バンドか4以上のバンドがある場合には、1番バンドを使用します。対象バンドはRGBまたはRGBAに対応付けられます。</li><li class="listitem"><a class="link" href="#RT_ST_AsRaster" title="ST_AsRaster">ST_AsRaster</a> - 初出: 2.0.0 - GDAL 1.6.0以上が必要です。 PostGISジオメトリをPostGISラスタに変換します。</li><li class="listitem"><a class="link" href="#RT_ST_AsTIFF" title="ST_AsTIFF">ST_AsTIFF</a> - 初出: 2.0.0 - GDAL 1.6.0以上が必要です。 ラスタの選択されたバンドを、単一のTIFF画像として返します。バンドを指定しない場合には、全てのバンドの使用を試みます。</li><li class="listitem"><a class="link" href="#ST_AsX3D" title="ST_AsX3D">ST_AsX3D</a> - 初出: 2.0.0: ISO-IEC-19776-1.2-X3DEncodings-XML ジオメトリをX3Dノード要素書式(ISO-IEC-19776-1.2-X3DEncodings-XML)で返します。</li><li class="listitem"><a class="link" href="#RT_ST_Aspect" title="ST_Aspect">ST_Aspect</a> - 初出: 2.0.0  標高ラスタバンドの斜面方位を返します。地形解析に使います。</li><li class="listitem"><a class="link" href="#RT_ST_Band" title="ST_Band">ST_Band</a> - 初出: 2.0.0 既存のラスタの1つ以上のバンドを新しいラスタとして返します。既存のラスタから新しいラスタを構築する際に使います。</li><li class="listitem"><a class="link" href="#RT_ST_BandIsNoData" title="ST_BandIsNoData">ST_BandIsNoData</a> - 初出: 2.0.0 指定したバンドがNODATA値で満たされている場合にはTRUEを返します。</li><li class="listitem"><a class="link" href="#RT_ST_Clip" title="ST_Clip">ST_Clip</a> - 初出: 2.0.0  入力ジオメトリで切り取ったラスタを返します。バンドが指定されていない場合には、全てのバンドが返されます。cropが指定されていない場合はTRUEと仮定され、出力ラスタをクロップします。</li><li class="listitem"><a class="link" href="#ST_CollectionHomogenize" title="ST_CollectionHomogenize">ST_CollectionHomogenize</a> - 初出: 2.0.0 ジオメトリコレクションを与えると、「最も単純な」表現を返します。</li><li class="listitem"><a class="link" href="#ST_ConcaveHull" title="ST_ConcaveHull">ST_ConcaveHull</a> - 初出: 2.0.0 凹包は、集合の範囲内におけるすべてのジオメトリーを囲む、できる限り凹となるジオメトリを表現するものです。収縮包装とみることができます。</li><li class="listitem"><a class="link" href="#RT_ST_Count" title="ST_Count">ST_Count</a> - 初出: 2.0.0  ラスタまたはラスタカバレッジの指定したバンドのピクセル数を返します。バンドを指定しない場合は1番と仮定します。exclude_nodata_valueをTRUEに設定している場合には、NODATA値と等しくないピクセルのみを数えます。</li><li class="listitem"><a class="link" href="#ST_CreateTopoGeo" title="ST_CreateTopoGeo">ST_CreateTopoGeo</a> - 初出: 2.0  空のトポロジにジオメトリのコレクションを追加し、成否を示すメッセージを返します。</li><li class="listitem"><a class="link" href="#RT_ST_Distinct4ma" title="ST_Distinct4ma">ST_Distinct4ma</a> - 初出: 2.0.0 近傍における一意となるピクセル値の数を計算するラスタ処理関数です。Raster processing function that calculates the number of unique pixel values in a neighborhood.</li><li class="listitem"><a class="link" href="#ST_FlipCoordinates" title="ST_FlipCoordinates">ST_FlipCoordinates</a> - 初出: 2.0.0 与えられたジオメトリのX軸とY軸とを入れ替えたものを返します。緯度/経度の地物を構築して、これを訂正したい場合に使います。</li><li class="listitem"><a class="link" href="#RT_ST_GDALDrivers" title="ST_GDALDrivers">ST_GDALDrivers</a> - 初出: 2.0.0 - GDAL 1.6.0以上が必要です。 使用しているGDALライブラリが対応するラスタ書式の一覧を返します。ST_AsGDALRasterを使って出力できるラスタの書式です。</li><li class="listitem"><a class="link" href="#ST_GeomFromGeoJSON" title="ST_GeomFromGeoJSON">ST_GeomFromGeoJSON</a> - 初出: 2.0.0 JSON-C 0.9以上が必要です。 ジオメトリのGeoJSON表現を入力として、PostGISジオメトリオブジェクトを出力します。</li><li class="listitem"><a class="link" href="#ST_GetFaceEdges" title="ST_GetFaceEdges">ST_GetFaceEdges</a> - 初出: 2.0  順序番号を含む、afaceの境界となる、整列したエッジの集合を返します。</li><li class="listitem"><a class="link" href="#RT_ST_HasNoBand" title="ST_HasNoBand">ST_HasNoBand</a> - 初出: 2.0.0 指定したバンド番号のバンドが無い場合にTRUEを返します。バンド番号を指定していない場合には、1番と仮定します。</li><li class="listitem"><a class="link" href="#RT_ST_HillShade" title="ST_HillShade">ST_HillShade</a> - 初出: 2.0.0  方位、高度、輝度、標高スケールの入力を使って、標高ラスタバンドの仮定的な光による明暗を返します。地形の視覚化に使用します。</li><li class="listitem"><a class="link" href="#RT_ST_Histogram" title="ST_Histogram">ST_Histogram</a> - 初出: 2.0.0  ラスタまたはラスタカバレッジのビン範囲で分割したデータ分布をまとめるヒストグラムの集合を返します。ビン数を指定しない場合には自動計算されます。</li><li class="listitem"><a class="link" href="#ST_InterpolatePoint" title="ST_InterpolatePoint">ST_InterpolatePoint</a> - 初出: 2.0.0 ジオメトリの、指定したポイントに近いポイントにおけるM値を返します。</li><li class="listitem"><a class="link" href="#ST_IsValidDetail" title="ST_IsValidDetail">ST_IsValidDetail</a> - 初出: 2.0.0 - GEOS 3.3.0以上が必要です。 ジオメトリが妥当か否かを示すvalid_detail (valid,reason,location)行を返します。不正である場合には、理由と位置を示します。</li><li class="listitem"><a class="link" href="#ST_IsValidReason" title="ST_IsValidReason">ST_IsValidReason</a> - 初出: 2.0 - requires GEOS &gt;= 3.3.0 flagsを受け付ける版 ジオメトリが妥当か否かを示すテキストを返し、不正な場合は理由を返します。</li><li class="listitem"><a class="link" href="#ST_MakeLine" title="ST_MakeLine">ST_MakeLine</a> - 初出: 2.0.0 - ラインストリング入力要素が導入されました。 ポイントまたはラインジオメトリからラインストリングを生成します。</li><li class="listitem"><a class="link" href="#ST_MakeValid" title="ST_MakeValid">ST_MakeValid</a> - 初出: 2.0.0, GEOS 3.3.0以上が必要です。 頂点を失うことなしに不正なジオメトリを妥当なジオメトリにしようと試みます。</li><li class="listitem"><a class="link" href="#RT_ST_MapAlgebraExpr" title="ST_MapAlgebraExpr">ST_MapAlgebraExpr</a> - 初出: 2.0.0  1バンド版: 入力バンドに対する妥当なPostgreSQL代数演算で形成された、指定したピクセルタイプの1バンドのラスタを生成します。バンドを指定しない場合は1番と仮定します。</li><li class="listitem"><a class="link" href="#RT_ST_MapAlgebraExpr2" title="ST_MapAlgebraExpr">ST_MapAlgebraExpr</a> - 初出: 2.0.0  2バンド版: 2つの入力バンドに対する妥当なPostgreSQL代数演算で形成された、指定したピクセルタイプの1バンドのラスタを生成します。バンドを指定しない場合はどちらも1番と仮定します。結果ラスタは、ひとつめのラスタのアラインメント(スケール、スキュー、ピクセル角位置)にあわされます。範囲は"extenttype"引数で定義されます。取りうる"extenttype"の値はINTERSECTION, UNION, FIRST, SECONDです。</li><li class="listitem"><a class="link" href="#RT_ST_MapAlgebraFct" title="ST_MapAlgebraFct">ST_MapAlgebraFct</a> - 初出: 2.0.0 1バンド版 - 入力バンドに対する妥当なPostgreSQL関数で形成された、指定したピクセルタイプの1バンドのラスタを生成します。バンドを指定しない場合は1番と仮定します。</li><li class="listitem"><a class="link" href="#RT_ST_MapAlgebraFct2" title="ST_MapAlgebraFct">ST_MapAlgebraFct</a> - 初出: 2.0.0 2ラスタ版 - 2つの入力バンドに対する妥当なPostgreSQL関数で形成された、指定したピクセルタイプの1バンドのラスタを生成します。バンドを指定しない場合は1番と仮定します。"extenttype"のデフォルトはINTERSECTIONです。</li><li class="listitem"><a class="link" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a> - 初出: 2.0.0  1バンド版: ユーザ定義PostgreSQL関数を使用する最近傍地図代数関数です。入力ラスタバンドの近傍の値を与えたPL/pgSQLユーザ定義関数の結果からなるラスタを返します。</li><li class="listitem"><a class="link" href="#RT_ST_Max4ma" title="ST_Max4ma">ST_Max4ma</a> - 初出: 2.0.0 近傍における最大ピクセル値を計算するラスタ処理関数です。</li><li class="listitem"><a class="link" href="#RT_ST_Mean4ma" title="ST_Mean4ma">ST_Mean4ma</a> - 初出: 2.0.0 近傍におけるピクセル値の平均を計算するラスタ処理関数です。</li><li class="listitem"><a class="link" href="#RT_ST_Min4ma" title="ST_Min4ma">ST_Min4ma</a> - 初出: 2.0.0 近傍における最小ピクセル値を計算するラスタ処理関数です。</li><li class="listitem"><a class="link" href="#ST_ModEdgeHeal" title="ST_ModEdgeHeal">ST_ModEdgeHeal</a> - 初出: 2.0 2つのエッジについて、接続しているノードを削除して修復します。1番目のエッジを編集して、2番目のエッジを削除します。削除されたノードの識別番号を返します。</li><li class="listitem"><a class="link" href="#ST_NewEdgeHeal" title="ST_NewEdgeHeal">ST_NewEdgeHeal</a> - 初出: 2.0 2つのエッジについて、接続しているノードを削除して修復します。両方のエッジを削除し、1番目のエッジと同じ方向のエッジに置き換えます。</li><li class="listitem"><a class="link" href="#ST_Node" title="ST_Node">ST_Node</a> - 初出: 2.0.0 - GEOS 3.3.0以上が必要です。 ラインストリングの集合にノードを作成します。</li><li class="listitem"><a class="link" href="#ST_NumPatches" title="ST_NumPatches">ST_NumPatches</a> - 初出: 2.0.0 多面体サーフェスのフェイス数を返します。多面体でないジオメトリの場合にはNULLを返します。</li><li class="listitem"><a class="link" href="#ST_OffsetCurve" title="ST_OffsetCurve">ST_OffsetCurve</a> - 初出: 2.0 - GEOS 3.2以上、GEOS 3.3以上で改善されました。 与えられた距離と方面に入力ラインをずらしたラインを返します。中心線と平行する線を引く際に使用します。</li><li class="listitem"><a class="link" href="#ST_PatchN" title="ST_PatchN">ST_PatchN</a> - 初出: 2.0.0 ジオメトリがPOLYHEDRALSURFACEかPOLYHEDRALSURFACEMの場合には、1はじまりでN番目のジオメトリ(フェイス)を返します。それ以外の場合には、NULLを返します。</li><li class="listitem"><a class="link" href="#ST_Perimeter" title="ST_Perimeter">ST_Perimeter</a> - 初出: 2.0.0 ジオグラフィが導入されました。 ST_SrrfaceまたはST_MultiSurface(POLYGONまたはMULTIPOLYGON)の境界の長さの計測値を返します。ジオメトリの単位は空間参照系によります。ジオグラフィはメートル単位になります。</li><li class="listitem"><a class="link" href="#RT_ST_Quantile" title="ST_Quantile">ST_Quantile</a> - 初出: 2.0.0  ラスタまたはラスタテーブルカバレッジのサンプルまたは母集団の分位数を計算します。値がラスタの25%,50%,75%にあるかを調べることができます。</li><li class="listitem"><a class="link" href="#RT_ST_Range4ma" title="ST_Range4ma">ST_Range4ma</a> - 初出: 2.0.0 近傍におけるピクセル値の範囲合計を計算するラスタ処理関数です。</li><li class="listitem"><a class="link" href="#RT_ST_Reclass" title="ST_Reclass">ST_Reclass</a> - 初出: 2.0.0  元のラスタから再分類したバンドタイプからなるラスタを生成します。nbandは変更するバンドです。nbandが指定されていない場合は1番と仮定します。他の全てのバンドは変更せずに返します。可視画像の書式としてより単純な描画を行うために、16BUIバンドを8BUIバンドに変換する、等のために使います。</li><li class="listitem"><a class="link" href="#ST_RelateMatch" title="ST_RelateMatch">ST_RelateMatch</a> - 初出: 2.0.0 - GEOS 3.3.0以上が必要です。 intersectionMattrixPattern1がintersectionMatrixPattern2を含む場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#ST_RemEdgeModFace" title="ST_RemEdgeModFace">ST_RemEdgeModFace</a> - 初出: 2.0  エッジを削除し、削除対象エッジでフェイスが2つに分割されているなら、両方の空間をとるため、ひとつを削除して、もうひとつを編集します。</li><li class="listitem"><a class="link" href="#ST_RemEdgeNewFace" title="ST_RemEdgeNewFace">ST_RemEdgeNewFace</a> - 初出: 2.0  エッジを削除し、消去対象エッジでフェイスが2つに分割されているなら、分割されているフェイスを削除し、1つのフェイスに置き換えます。</li><li class="listitem"><a class="link" href="#ST_RemoveRepeatedPoints" title="ST_RemoveRepeatedPoints">ST_RemoveRepeatedPoints</a> - 初出: 2.0.0 入力ジオメトリから重複ポイントを除いたものを返します。</li><li class="listitem"><a class="link" href="#RT_ST_Resample" title="ST_Resample">ST_Resample</a> - 初出: 2.0.0 GDAL 1.6.1以上が必要です。 指定したリサンプリングアルゴリズム、新しいピクセル範囲、グリッドの角、定義するか他のラスタから借りてきた地理参照属性を使ってリサンプリングを行います。新しいピクセル値は、最近傍補間('NearestNeighbor')、双線形補間('Bilinear')、3次補完('Cubic')、3次スプライン補完('CubicSpline')、ランツォシュ補完('Lanczos')、のいずれかのアルゴリズムを使います。デフォルトは最近傍補完です。</li><li class="listitem"><a class="link" href="#RT_ST_Rescale" title="ST_Rescale">ST_Rescale</a> - 初出: 2.0.0 GDAL 1.6.1以上が必要です。 スケール(ピクセルサイズ)だけを調整するリサンプリングを行います。新しいピクセル値は、最近傍補間('NearestNeighbor')、双線形補間('Bilinear')、3次補完('Cubic')、3次スプライン補完('CubicSpline')、ランツォシュ補完('Lanczos')、のいずれかのアルゴリズムを使います。デフォルトは最近傍補完です。</li><li class="listitem"><a class="link" href="#RT_ST_Reskew" title="ST_Reskew">ST_Reskew</a> - 初出: 2.0.0 GDAL 1.6.1以上が必要です。 スキュー(回転パラメタ)の調整によるリサンプリングを行います。新しいピクセル値は、最近傍補間('NearestNeighbor')、双線形補間('Bilinear')、3次補完('Cubic')、3次スプライン補完('CubicSpline')、ランツォシュ補完('Lanczos')、のいずれかのアルゴリズムを使います。デフォルトは最近傍補完です。</li><li class="listitem"><a class="link" href="#RT_ST_SameAlignment" title="ST_SameAlignment">ST_SameAlignment</a> - 初出: 2.0.0 ラスタが同じスキュー、スケール、空間参照系を持つ場合にはTRUEを返し、そうでない場合は問題を詳述する通知とともにFALSEを返します。</li><li class="listitem"><a class="link" href="#RT_ST_SetBandIsNoData" title="ST_SetBandIsNoData">ST_SetBandIsNoData</a> - 初出: 2.0.0 バンドのisnodataフラグをTRUEにします。ST_BandIsNoData(rast, band) != ST_BandIsNodata(rast, band, TRUE)となり、isnodataフラグが汚れている場合に使用することがあります。バンドを指定しない場合は1番バンドと仮定します。</li><li class="listitem"><a class="link" href="#ST_SharedPaths" title="ST_SharedPaths">ST_SharedPaths</a> - 初出: 2.0.0 GEOS 3.3.0以上が必要です。 2つの入力LINESTRING/MULTILINESTRINGが共有するパスのコレクションを返します。</li><li class="listitem"><a class="link" href="#RT_ST_Slope" title="ST_Slope">ST_Slope</a> - 初出: 2.0.0  標高ラスタバンドの傾斜角を返します。地形解析に使います。</li><li class="listitem"><a class="link" href="#ST_Snap" title="ST_Snap">ST_Snap</a> - 初出: 2.0.0 GEOS 3.3.0以降が必要です。 入力ジオメトリの辺と頂点を参照ジオメトリの頂点にスナップします。</li><li class="listitem"><a class="link" href="#RT_ST_SnapToGrid" title="ST_SnapToGrid">ST_SnapToGrid</a> - 初出: 2.0.0 GDAL 1.6.1以上が必要です。 グリッドにスナップさせるリサンプリングを行います。新しいピクセル値は、最近傍補間('NearestNeighbor')、双線形補間('Bilinear')、3次補完('Cubic')、3次スプライン補完('CubicSpline')、ランツォシュ補完('Lanczos')、のいずれかのアルゴリズムを使います。デフォルトは最近傍補完です。</li><li class="listitem"><a class="link" href="#ST_Split" title="ST_Split">ST_Split</a> - 初出: 2.0.0 ジオメトリを分割したジオメトリのコレクションを返します。</li><li class="listitem"><a class="link" href="#RT_ST_StdDev4ma" title="ST_StdDev4ma">ST_StdDev4ma</a> - 初出: 2.0.0 近傍におけるピクセル値の標準偏差を計算するラスタ処理関数です。</li><li class="listitem"><a class="link" href="#RT_ST_Sum4ma" title="ST_Sum4ma">ST_Sum4ma</a> - 初出: 2.0.0 近傍におけるピクセル値の合計を計算するラスタ処理関数です。</li><li class="listitem"><a class="link" href="#RT_ST_SummaryStats" title="ST_SummaryStats">ST_SummaryStats</a> - 初出: 2.0.0  ラスタまたはラスタカバレッジの指定したバンドについて、ピクセル数、合計値、平均値、標準偏差、最小値、最大値からなる統計情報の概要を返します。バンドを指定しない場合は1番と仮定します。</li><li class="listitem"><a class="link" href="#RT_ST_Transform" title="ST_Transform">ST_Transform</a> - 初出: 2.0.0 GDAL 1.6.1以上が必要です。 ラスタを既知の空間参照系から他の既知の空間参照系に、指定したリサンプリングアルゴリズムで投影変換します。選択肢は、最近傍補間('NearestNeighbor')、双線形補間('Bilinear')、3次補完('Cubic')、3次スプライン補完('CubicSpline')、ランツォシュ補完('Lanczos')、があります。デフォルトは最近傍補完です。</li><li class="listitem"><a class="link" href="#ST_UnaryUnion" title="ST_UnaryUnion">ST_UnaryUnion</a> - 初出: 2.0.0 - GEOS 3.3.0以上が必要です。 ST_Unionに似ていますが、ジオメトリ要素レベルで動作します。</li><li class="listitem"><a class="link" href="#RT_ST_Union" title="ST_Union">ST_Union</a> - 初出: 2.0.0  ラスタタイルの集合を1バンドの単一のラスタに結合します。バンドを指定しない場合は1番と仮定します。結果ラスタの範囲は、集合全体の範囲となります。インタセクトする場合には、結果値はp_expressionで定義されます。p_expressionはLAST, MEAN, SUM, FIRST, MAX, MINで、デフォルトはLASTです。</li><li class="listitem"><a class="link" href="#RT_ST_ValueCount" title="ST_ValueCount">ST_ValueCount</a> - 初出: 2.0.0  ラスタ(またはラスタカバレッジの)指定されたバンドで、指定した値を持つピクセルを対象として、ピクセルバンド値とピクセル数からなるレコードの集合を返します。バンドを指定しない場合は1番と仮定します。デフォルトではNODATA値のピクセルは数えられず、ピクセルの他の値は出力され、ピクセルバンド値は最も近い整数に丸められます。</li><li class="listitem"><a class="link" href="#TopoElementArray_Agg" title="TopoElementArray_Agg">TopoElementArray_Agg</a> - 初出: 2.0.0 lement_idとタイプの配列(topoelements)からなるtopoelementarrayを返します。</li><li class="listitem"><a class="link" href="#TopoGeo_AddLineString" title="TopoGeo_AddLineString">TopoGeo_AddLineString</a> - 初出: 2.0.0 許容差を使って既存のトポロジにラインストリングを追加し、可能ならエッジ/フェイスを分割します。</li><li class="listitem"><a class="link" href="#TopoGeo_AddPoint" title="TopoGeo_AddPoint">TopoGeo_AddPoint</a> - 初出: 2.0.0 許容差を使って既存のトポロジにポイントを追加し、可能ならエッジを分割します。</li><li class="listitem"><a class="link" href="#TopoGeo_AddPolygon" title="TopoGeo_AddPolygon">TopoGeo_AddPolygon</a> - 初出: 2.0.0 許容差を使って既存のトポロジにポリゴンを追加し、可能ならエッジ/フェイスを分割します。</li><li class="listitem"><a class="link" href="#TopologySummary" title="TopologySummary">TopologySummary</a> - 初出: 2.0.0 トポロジ名を取得し、トポロジ内のオブジェクトの型に関する概の全体を提供します。</li><li class="listitem"><a class="link" href="#toTopoGeom" title="toTopoGeom">toTopoGeom</a> - 初出: 2.0 単純なジオメトリからTopoGeometryを生成します。</li></ul></div><p>次に示す関数は、PostGIS 2.0で機能強化された関数です。</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><a class="link" href="#AddGeometryColumn" title="AddGeometryColumn">AddGeometryColumn</a> - 機能強化: 2.0.0では、use_typmod引数が導入されました。デフォルトでは制約を基にしたものでなくtypmodジオメトリカラムが生成されます。</li><li class="listitem"><a class="link" href="#Box2D" title="Box2D">Box2D</a> - 機能強化: 2.0.0では、多面体サーフェス、三角形、TINが導入されました。</li><li class="listitem"><a class="link" href="#Box3D" title="Box3D">Box3D</a> - 機能強化: 2.0.0では、多面体サーフェス、三角形、TINが導入されました。</li><li class="listitem"><a class="link" href="#GeometryType" title="GeometryType">GeometryType</a> - 機能強化: 2.0.0で多面体サーフェス、三角、TINが導入されました。</li><li class="listitem"><a class="link" href="#Populate_Geometry_Columns" title="Populate_Geometry_Columns">Populate_Geometry_Columns</a> - 機能強化: 2.0.0では、use_typmod引数が導入されました。カラムが型修飾子で作られるか制約チェックで作られるかの制御ができます。</li><li class="listitem"><a class="link" href="#RT_ST_Intersection" title="ST_Intersection">ST_Intersection</a> - 機能強化: 2.0.0 - ラスタ空間のインタセクションが導入されました。2.0.0より前の版では、ベクタ空間でのインタセクションの計算のみに対応していました。</li><li class="listitem"><a class="link" href="#RT_ST_Intersects" title="ST_Intersects">ST_Intersects</a> - 機能強化: 2.0.0 ラスタとラスタを引数にとる形式が導入されました。</li><li class="listitem"><a class="link" href="#RT_ST_Value" title="ST_Value">ST_Value</a> - 機能強化: 2.0.0 exclude_nodata_value optional argument was added.</li><li class="listitem"><a class="link" href="#ST_3DExtent" title="ST_3DExtent">ST_3DExtent</a> - 機能強化: 2.0.0では、多面体サーフェス、三角形、TINが導入されました。</li><li class="listitem"><a class="link" href="#ST_Accum" title="ST_Accum">ST_Accum</a> - 機能強化: 2.0.0では、多面体サーフェス、三角形、TINが導入されました。</li><li class="listitem"><a class="link" href="#ST_Affine" title="ST_Affine">ST_Affine</a> - 機能強化: 2.0.0では、多面体サーフェス、三角形、TINが導入されました。</li><li class="listitem"><a class="link" href="#ST_Area" title="ST_Area">ST_Area</a> - 機能強化: 2.0.0 - 2次元多面体サーフェスが導入されました。</li><li class="listitem"><a class="link" href="#ST_AsBinary" title="ST_AsBinary">ST_AsBinary</a> - 機能強化: 2.0.0では、多角形サーフェス、三角形、TINが導入されました。</li><li class="listitem"><a class="link" href="#ST_AsBinary" title="ST_AsBinary">ST_AsBinary</a> - 機能強化: 2.0.0では、高次元が導入されました。</li><li class="listitem"><a class="link" href="#ST_AsBinary" title="ST_AsBinary">ST_AsBinary</a> - 機能強化: 2.0.0では、ジオグラフィでのエンディアン指定が導入されました。</li><li class="listitem"><a class="link" href="#ST_AsEWKB" title="ST_AsEWKB">ST_AsEWKB</a> - 機能強化: 2.0.0では、多角形サーフェス、三角形、TINが導入されました。</li><li class="listitem"><a class="link" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a> - 機能強化: 2.0.0では、ジオグラフィ、多面体サーフェス、三角形、TINが導入されました。</li><li class="listitem"><a class="link" href="#ST_AsGML" title="ST_AsGML">ST_AsGML</a> - 機能強化: 2.0.0では、プレフィクスが導入されました。
GML 3用であるoptionsの4は、曲線のかわりにラインストリングを使えるようにするためのものです。GML 3の多面体サーフェスとTINが導入されました。optionsの32はボックスを出力するために導入されました。</li><li class="listitem"><a class="link" href="#ST_AsKML" title="ST_AsKML">ST_AsKML</a> - 機能強化: 2.0.0 - プレフィクス名前空間を追加しました。デフォルトではプリフィクス無しです。</li><li class="listitem"><a class="link" href="#ST_Azimuth" title="ST_Azimuth">ST_Azimuth</a> - 機能強化: 2.0.0では、ジオグラフィが導入されました。</li><li class="listitem"><a class="link" href="#ST_ChangeEdgeGeom" title="ST_ChangeEdgeGeom">ST_ChangeEdgeGeom</a> - 
	機能強化: 2.0.0版で、トポロジ整合性の強制を追加しました。
		</li><li class="listitem"><a class="link" href="#ST_Dimension" title="ST_Dimension">ST_Dimension</a> - 機能強化: 2.0.0で多面体サーフェスとTINが導入されました。空ジオメトリを与えた場合に例外を投げなくなりました。</li><li class="listitem"><a class="link" href="#ST_Dump" title="ST_Dump">ST_Dump</a> - 機能強化: 2.0.0では、多角形サーフェス、三角形、TINが導入されました。</li><li class="listitem"><a class="link" href="#ST_DumpPoints" title="ST_DumpPoints">ST_DumpPoints</a> - 機能強化: 2.0.0では、多角形サーフェス、三角形、TINが導入されました。</li><li class="listitem"><a class="link" href="#ST_Expand" title="ST_Expand">ST_Expand</a> - 機能強化: 2.0.0では、多面体サーフェス、三角形、TINが導入されました。</li><li class="listitem"><a class="link" href="#ST_Extent" title="ST_Extent">ST_Extent</a> - 機能強化: 2.0.0では、多面体サーフェス、三角形、TINが導入されました。</li><li class="listitem"><a class="link" href="#ST_ForceRHR" title="ST_ForceRHR">ST_ForceRHR</a> - 機能強化: 2.0.0では、多面体サーフェスが導入されました。</li><li class="listitem"><a class="link" href="#ST_Force_2D" title="ST_Force_2D">ST_Force_2D</a> - 機能強化: 2.0.0では、多面体サーフェスが導入されました。</li><li class="listitem"><a class="link" href="#ST_Force_3D" title="ST_Force_3D">ST_Force_3D</a> - 機能強化: 2.0.0では、多面体サーフェスが導入されました。</li><li class="listitem"><a class="link" href="#ST_Force_3DZ" title="ST_Force_3DZ">ST_Force_3DZ</a> - 機能強化: 2.0.0では、多面体サーフェスが導入されました。</li><li class="listitem"><a class="link" href="#ST_Force_Collection" title="ST_Force_Collection">ST_Force_Collection</a> - 機能強化: 2.0.0では、多面体サーフェスが導入されました。</li><li class="listitem"><a class="link" href="#ST_GMLToSQL" title="ST_GMLToSQL">ST_GMLToSQL</a> - 機能強化: 2.0.0で、多面体サーフェスとTINが導入されました。</li><li class="listitem"><a class="link" href="#ST_GMLToSQL" title="ST_GMLToSQL">ST_GMLToSQL</a> - 機能強化: 2.0.0で、任意パラメタにデフォルトのSRIDが追加されました。</li><li class="listitem"><a class="link" href="#ST_GeomFromEWKB" title="ST_GeomFromEWKB">ST_GeomFromEWKB</a> - 機能強化: 2.0.0で、多面体サーフェスとTINが導入されました。</li><li class="listitem"><a class="link" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a> - 機能強化: 2.0.0で、多面体サーフェスとTINが導入されました。</li><li class="listitem"><a class="link" href="#ST_GeomFromGML" title="ST_GeomFromGML">ST_GeomFromGML</a> - 機能強化: 2.0.0で、多面体サーフェスとTINが導入されました。</li><li class="listitem"><a class="link" href="#ST_GeomFromGML" title="ST_GeomFromGML">ST_GeomFromGML</a> - 機能強化: 2.0.0で、任意パラメタにデフォルトのSRIDが追加されました。</li><li class="listitem"><a class="link" href="#ST_GeometryN" title="ST_GeometryN">ST_GeometryN</a> - 機能強化: 2.0.0で、多面体サーフェス、三角形、TINが導入されました。</li><li class="listitem"><a class="link" href="#ST_GeometryType" title="ST_GeometryType">ST_GeometryType</a> - 機能強化: 2.0.0で、多面体サーフェスが導入されました。</li><li class="listitem"><a class="link" href="#ST_IsClosed" title="ST_IsClosed">ST_IsClosed</a> - 機能強化: 2.0.0で、多面体サーフェスが導入されました。</li><li class="listitem"><a class="link" href="#ST_MakeEnvelope" title="ST_MakeEnvelope">ST_MakeEnvelope</a> - 機能強化: 2.0: SRID指定なしでエンベロープを指定できるようになりました。</li><li class="listitem"><a class="link" href="#ST_NPoints" title="ST_NPoints">ST_NPoints</a> - 機能強化: 2.0.0で、多面体サーフェスが導入されました。</li><li class="listitem"><a class="link" href="#ST_NumGeometries" title="ST_NumGeometries">ST_NumGeometries</a> - 機能強化: 2.0.0で、多面体サーフェス、三角形、TINが導入されました。</li><li class="listitem"><a class="link" href="#ST_Relate" title="ST_Relate">ST_Relate</a> - 機能強化: 2.0.0 - 境界ノード規則が追加されました(GEOS 3,0以上が必要です)。</li><li class="listitem"><a class="link" href="#ST_Rotate" title="ST_Rotate">ST_Rotate</a> - 機能強化: 2.0.0では、多面体サーフェス、三角形、TINが導入されました。</li><li class="listitem"><a class="link" href="#ST_Rotate" title="ST_Rotate">ST_Rotate</a> - 機能強化: 2.0.0で、回転の原点を指定するパラメタを追加しました。</li><li class="listitem"><a class="link" href="#ST_RotateX" title="ST_RotateX">ST_RotateX</a> - 機能強化: 2.0.0では、多面体サーフェス、三角形、TINが導入されました。</li><li class="listitem"><a class="link" href="#ST_RotateY" title="ST_RotateY">ST_RotateY</a> - 機能強化: 2.0.0では、多面体サーフェス、三角形、TINが導入されました。</li><li class="listitem"><a class="link" href="#ST_RotateZ" title="ST_RotateZ">ST_RotateZ</a> - 機能強化: 2.0.0では、多面体サーフェス、三角形、TINが導入されました。</li><li class="listitem"><a class="link" href="#ST_Scale" title="ST_Scale">ST_Scale</a> - 機能強化: 2.0.0では、多面体サーフェス、三角形、TINが導入されました。</li><li class="listitem"><a class="link" href="#ST_Shift_Longitude" title="ST_Shift_Longitude">ST_Shift_Longitude</a> - 機能強化: 2.0.0では、多面体サーフェスとTINが導入されました。</li><li class="listitem"><a class="link" href="#ST_Transform" title="ST_Transform">ST_Transform</a> - 機能強化: 2.0.0では、多面体サーフェスが導入されました。</li><li class="listitem"><a class="link" href="#ValidateTopology" title="ValidateTopology">ValidateTopology</a> - 機能強化: 2.0.0 で、エッジのクロス判定を効率化し、以前の版に出た偽陽性を解消しました。</li><li class="listitem"><a class="link" href="#geometry_overlaps" title="&amp;&amp;">&amp;&amp;</a> - 機能強化: 2.0.0では、多面体サーフェスを導入しました。</li></ul></div></div><div class="sect2" title="13.11.2. PostGIS 2.0での関数の挙動変更"><div class="titlepage"><div><div><h3 class="title"><a name="NewFunctions_2_0_Changed"></a>13.11.2. PostGIS 2.0での関数の挙動変更</h3></div></div></div><p>次に示す関数は、PostGIS2.0で挙動変更したもので、アプリケーションの変更が必要になる場合があります。</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ほとんどの非推奨関数は削除されました。これらは、1.2から文書には出ていないか、絶対に文書化されない内部関数です。文書に無い関数を使用している場合には、非推奨関数になっているか、非推奨になろうとしているか、内部関数の可能性があります。これらは避けるべきです。非推奨関数を使っているアプリケーションやツールの対応に関する詳細情報については<a class="link" href="#legacy_faq" title="3.1.">???</a>を参照して下さい。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ジオメトリのバウンディングボックスはfloat4から倍精度浮動小数点数(float8)に変わりました。バウンディングボックス演算子を使う場合とバウンディングボックスからジオメトリへのキャストに影響が出ます。たとえば、ST_SetSRID(abbox)では、しばしば、PostGIS 2.0以上でのビューポートクエリの答をわずかに変更するかもしれない以前の版より、精度の良い異なる答が得られます。</p></td></tr></table></div><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>hasnodata引数は、同じ意味ですがより目的がはっきり分かるexclude_nodata_valueに置き換えられました。</p></td></tr></table></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><a class="link" href="#AddGeometryColumn" title="AddGeometryColumn">AddGeometryColumn</a> - 変更: 2.0.0では、geometry_columnsがシステムカタログを読むビューになったため、geometry_columnsを更新しないようになりました。デフォルトでは制約を生成せず、PostgreSQLの型変更を使います。この関数でWGS 84のPOINTカラムを構築するのとALTER TABLE some_table ADD COLUMN geom geometry(Point,4326);とは等価です。</li><li class="listitem"><a class="link" href="#AddGeometryColumn" title="AddGeometryColumn">AddGeometryColumn</a> - 変更: 2.0.0では、制約を使う必要がある場合には、use_typmodをfalseにします。</li><li class="listitem"><a class="link" href="#AddGeometryColumn" title="AddGeometryColumn">AddGeometryColumn</a> - 変更: 2.0.0では、

ビューについては、geometry_columnsへの手動登録はできなくなりました。しかし、tyomodテーブルジオメトリに対して構築されていて、かつラッパ関数が無いビューは、親テーブルカラムのtypmodの挙動を継承するので、正しく登録されます。他のジオメトリを出力するジオメトリ関数を使うビューについては、ビューのジオメトリカラムが正しく登録されるようにするため、typmodジオメトリへのキャストが必要です。を参照して下さい。
			</li><li class="listitem"><a class="link" href="#DropGeometryColumn" title="DropGeometryColumn">DropGeometryColumn</a> - 変更: 2.0.0では、この関数は後方互換のためのものです。geometry_columnsは現在はシステムカタログに対するビューですので、他のテーブルのカラムと同じようにALTER TABLEを使った削除が可能です。</li><li class="listitem"><a class="link" href="#DropGeometryTable" title="DropGeometryTable">DropGeometryTable</a> - 変更: 2.0.0では、この関数は後方互換のためのものです。geometry_columnsは現在はシステムカタログに対するビューですので、他のテーブルのカラムと同じようにDROP TABLEを使った削除が可能です。</li><li class="listitem"><a class="link" href="#Populate_Geometry_Columns" title="Populate_Geometry_Columns">Populate_Geometry_Columns</a> - 変更: 2.0.0では、ジオメトリタイプへの制約をチェックする替りに型修飾子を使用しています。use_typmodをfalseに設定して使うことで、制約をチェックすることができます。</li><li class="listitem"><a class="link" href="#RT_Box3D" title="Box3D">Box3D</a> - 変更: 2.0.0 2.0より前の版では、box3dの代わりにbox2dが使われていました。box2dは非推奨の型となり、box3dに変更しました。</li><li class="listitem"><a class="link" href="#RT_ST_ScaleX" title="ST_ScaleX">ST_ScaleX</a> - 変更: 2.0.0. WKTRaster版ではST_PixelSizeXと呼ばれていました。</li><li class="listitem"><a class="link" href="#RT_ST_ScaleY" title="ST_ScaleY">ST_ScaleY</a> - 変更: 2.0.0. In  WKTRaster版ではST_PixelSizeYと呼ばれていました。</li><li class="listitem"><a class="link" href="#RT_ST_SetScale" title="ST_SetScale">ST_SetScale</a> - 変更: 2.0.0 WKTRaster版ではこれはST_SetPixelSizeと呼ばれていました。2.0.0で変更されました。</li><li class="listitem"><a class="link" href="#ST_3DExtent" title="ST_3DExtent">ST_3DExtent</a> - 変更: 2.0.0 In prior versions this used to be called ST_Extent3D</li><li class="listitem"><a class="link" href="#ST_3DLength" title="ST_3DLength">ST_3DLength</a> - 変更: 2.0.0 以前の版ではST_Length3Dと呼ばれていました。</li><li class="listitem"><a class="link" href="#ST_3DLength_Spheroid" title="ST_3DLength_Spheroid">ST_3DLength_Spheroid</a> - 変更: 2.0.0 以前の版では、ST_LengthSpheroid3Dと呼ばれていました。</li><li class="listitem"><a class="link" href="#ST_3DMakeBox" title="ST_3DMakeBox">ST_3DMakeBox</a> - 変更: 2.0.0以前の版ではST_MakeBox3Dと呼ばれていました。</li><li class="listitem"><a class="link" href="#ST_3DPerimeter" title="ST_3DPerimeter">ST_3DPerimeter</a> - 変更: 2.0.0 以前の版ではST_Perimeter3Dと呼ばれていました。</li><li class="listitem"><a class="link" href="#ST_AsGML" title="ST_AsGML">ST_AsGML</a> - 変更: 2.0.0では、デフォルトの名前付き引数を使います。</li><li class="listitem"><a class="link" href="#ST_AsGeoJSON" title="ST_AsGeoJSON">ST_AsGeoJSON</a> - 変更: 2.0.0では、デフォルト引数と名前付き引数に対応しました。</li><li class="listitem"><a class="link" href="#ST_AsKML" title="ST_AsKML">ST_AsKML</a> - 変更: 2.0.0 - デフォルト引数と名前付き引数に対応しました。</li><li class="listitem"><a class="link" href="#ST_AsSVG" title="ST_AsSVG">ST_AsSVG</a> - 変更: 2.0.0では、デフォルト引数と名前付き引数に対応しました。</li><li class="listitem"><a class="link" href="#ST_EndPoint" title="ST_EndPoint">ST_EndPoint</a> - 変更: 2.0.0では単一ジオメトリのMULTILINESTRINGで動作しなくなりました。単一のラインストリングからなるMULTILINESTRINGについては幸運にも動いていて、最初のポイントを返していました。2.0.0では他のMULTILINESTRINGと同様にNULLを返すようになりました。古い振る舞いは記載されていませんでしたが、LINESTRINGとして格納されているデータを持っていると思われる人々は2.0でNULLが返って来ることを経験することでしょう。</li><li class="listitem"><a class="link" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a> - 変更: 2.0.0以前ではST_GeomFromText('GEOMETRYCOLLECTION(EMPTY)')が許されていました。SQL/MM標準への適合のためPostGIS 2.0.0では不正とされます。今はST_GeomFromText('GEOMETRYCOLLECTION EMPTY')となります。</li><li class="listitem"><a class="link" href="#ST_GeometryN" title="ST_GeometryN">ST_GeometryN</a> - 変更: 2.0.0以前の版では非マルチのジオメトリではNULLが返りました。ST_GeometryN(..,1)の場合にはジオメトリを返すよう変更されました。</li><li class="listitem"><a class="link" href="#ST_Geometry_EQ" title="=">=</a> - 変更: 2.0.0では、
ジオメトリのバウンディングボックスをfloat4使用から倍精度使用に変更しました。ほんの少し違う位置にある特定のポイントについて、float4でのバウンディングボックスなら同じになるのにfloat8(倍精度)でのバウンディングボックスでは異なるため、以前の版ではtrueが返ったのが2.0以上ではfalseが返る、という副作用があります。</li><li class="listitem"><a class="link" href="#ST_IsEmpty" title="ST_IsEmpty">ST_IsEmpty</a> - 変更: 2.0.0以前の版のPostGISではST_GeomFromText('GEOMETRYCOLLECTION(EMPTY)')を許しました。PostGIS 2.0.0では、SQL/MM標準により準拠させるため、これは不正となります。</li><li class="listitem"><a class="link" href="#ST_Length" title="ST_Length">ST_Length</a> - 変更: 2.0.0 仕様変更 -- 以前の版では、ジオグラフィ型のPOLYGON/MULTIPOLYGONに対して周囲長を返していましたが、2.0.0では、ジオメトリでの0を返すように変更されました。ポリゴンの周囲長を求めるにはST_Perimeterを使用して下さい。</li><li class="listitem"><a class="link" href="#ST_LocateAlong" title="ST_LocateAlong">ST_LocateAlong</a> - 変更: 2.0.0 - 以前の版ではST_Locate_Along_Measureと呼ばれていましたが、古い名前は非推奨となり、将来的には削除しますが現時点では有効です。</li><li class="listitem"><a class="link" href="#ST_LocateBetween" title="ST_LocateBetween">ST_LocateBetween</a> - 変更: 2.0.0 - 以前の版でST_Locate_Between_Measuresと呼ばれていましたが、古い名前は非推奨となり、将来的には削除しますが現時点では後方互換のため有効になっています。</li><li class="listitem"><a class="link" href="#ST_ModEdgeSplit" title="ST_ModEdgeSplit">ST_ModEdgeSplit</a> - 変更: 2.0 - 以前の版では名前を間違えてST_ModEdgesSplitになっていました。</li><li class="listitem"><a class="link" href="#ST_NumGeometries" title="ST_NumGeometries">ST_NumGeometries</a> - 変更: 2.0.0より前の版では、ジオメトリがコレクション/マルチ系でない場合にはNULLを返しました。2.0.0以上では、POLYGON, LINESTRING, POINTといった単一ジオメトリについては1を返します。</li><li class="listitem"><a class="link" href="#ST_StartPoint" title="ST_StartPoint">ST_StartPoint</a> - 変更: 2.0.0では単一ジオメトリのMULTILINESTRINGで動作しなくなりました。単一のラインストリングからなるMULTILINESTRINGについては幸運にも動いていて、最初のポイントを返していました。2.0.0では他のMULTILINESTRINGと同様にNULLを返すようになりました。古い振る舞いは記載されていませんでしたが、LINESTRINGとして格納されているデータを持っていると思われる人々は2.0でNULLが返って来ることを経験することでしょう。</li></ul></div></div><div class="sect2" title="13.11.3. PostGIS 1.5で新規作成/機能強化/挙動変更された関数"><div class="titlepage"><div><div><h3 class="title"><a name="NewFunctions_1_5"></a>13.11.3. PostGIS 1.5で新規作成/機能強化/挙動変更された関数</h3></div></div></div><p>次に示す関数は、本マイナーリリースで新規作成/機能強化/挙動変更されたPostGIS関数です。</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><a class="link" href="#PostGIS_LibXML_Version" title="PostGIS_LibXML_Version">PostGIS_LibXML_Version</a> - 初出: 1.5 LibXML2ライブラリのバージョン番号を返します。</li><li class="listitem"><a class="link" href="#ST_AddMeasure" title="ST_AddMeasure">ST_AddMeasure</a> - 初出: 1.5.0 開始点と終了点の間の線型的にM値を内挿した派生ジオメトリを返します。ジオメトリがM軸を持たない場合は追加されます。ジオメトリがM軸を持つ場合は新しい値に上書きされます。LINESTRINGSとMULTILINESTRINGSのみサポートされます。</li><li class="listitem"><a class="link" href="#ST_AsBinary" title="ST_AsBinary">ST_AsBinary</a> - 初出: 1.5.0では、ジオグラフィが導入されました。 ジオメトリ/ジオグラフィのSRIDメタデータのないWell-Known Binary(WKB)表現を返します。</li><li class="listitem"><a class="link" href="#ST_AsGML" title="ST_AsGML">ST_AsGML</a> - 初出: 1.5.0では、ジオグラフィが導入されました。 GML第2版または第3版としてジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_AsGeoJSON" title="ST_AsGeoJSON">ST_AsGeoJSON</a> - 初出: 1.5.0では、ジオグラフィが導入されました。 GeoJSON要素としてジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_AsText" title="ST_AsText">ST_AsText</a> - 初出: 1.5 - ジオグラフィが導入されました。 ジオメトリ/ジオグラフィのSRIDメタデータのないWell-Known Text(WKT)表現を返します。</li><li class="listitem"><a class="link" href="#ST_Buffer" title="ST_Buffer">ST_Buffer</a> - 初出: 1.5 - ST_Bufferが異なる終端と継ぎ目の型に対応するよう強化されました。たとえば、道路ラインストリングを、丸の代わりに平坦や四角形の終端を持つ道路ポリゴンに変換するのに使います。ジオグラフィ用の薄いラッパが追加されました。最新のジオメトリ機能の利点を得るにはGEOS 3.2以上が必要です。 (T) ジオメトリ: このジオメトリからの距離が指定された距離以下となるポイント全てを表現するジオメトリを返します。計算は、ジオメトリの空間参照系で行われます。ジオグラフィ: 平面変換ラッパを使います。形状制御のために異なる終端キャップと継ぎ目の設定のサポートが1.5で導入されました。buffer_styleオプションは、quad_segs=#,endcap=round|flat|square,join=round|mitre|bevel,mitre_limit=#.# となります。</li><li class="listitem"><a class="link" href="#ST_ClosestPoint" title="ST_ClosestPoint">ST_ClosestPoint</a> - 初出: 1.5.0 g1上の、g2に最も近い3次元ポイントを返します。2次元最短線のひとつめのポイントです。</li><li class="listitem"><a class="link" href="#ST_CollectionExtract" title="ST_CollectionExtract">ST_CollectionExtract</a> - 初出: 1.5.0 (マルチ)ジオメトリを与えると、指定したタイプの要素でのみ構成される(マルチ)ジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_Covers" title="ST_Covers">ST_Covers</a> - 初出: 1.5 - ジオグラフィが導入されました。 ジオメトリBにジオメトリAの外となるポイントが無い場合には、1(TRUE)を返します。</li><li class="listitem"><a class="link" href="#ST_DFullyWithin" title="ST_DFullyWithin">ST_DFullyWithin</a> - 初出: 1.5.0 全てのジオメトリが、指定したジオメトリから指定した距離内にある場合に、TRUEを返します。</li><li class="listitem"><a class="link" href="#ST_DWithin" title="ST_DWithin">ST_DWithin</a> - 初出: 1.5.0 ジオグラフィが導入されました。  ジオメトリが、指定したジオメトリから指定した距離内にある場合に、TRUEを返します。ジオメトリについては、距離は空間参照系で定義されている単位になります。ジオグラフィについては、メートル単位で、デフォルトではuse_spheroid=true(回転楕円体を使った計算)となり、速いチェックをするにはuse_spheroid=falseとして球面を使って計算します。</li><li class="listitem"><a class="link" href="#ST_Distance" title="ST_Distance">ST_Distance</a> - 初出: 1.5.0 1.5でジオグラフィが導入されました。大きいジオメトリや頂点の多いジオメトリについての速度が改善しました。 ジオメトリ型については、2つのジオメトリの、2次元の最小デカルト距離(空間参照系に基づきます)を、投影法の単位で返します。ジオグラフィ型については、デフォルトでは、2つのジオメトリ間の回転楕円体上の最小距離をメートル単位で返します。</li><li class="listitem"><a class="link" href="#ST_Distance_Sphere" title="ST_Distance_Sphere">ST_Distance_Sphere</a> - 初出: 1.5 - ポイント以外のジオメトリが導入されました。以前の版ではポイントでのみ動作しました。 2つの経度緯度ジオメトリ間の最小距離をメートル単位で返します。半径6370986メートルの球面を用います。xref linkend="ST_Distance_Spheroid" /&gt;より早いですが精度が低くなります。PostGIS 1.5より前では、ポイントについてのみ実装されていました。</li><li class="listitem"><a class="link" href="#ST_Distance_Spheroid" title="ST_Distance_Spheroid">ST_Distance_Spheroid</a> - 初出: 1.5 - ポイント以外のジオメトリ型が導入されました。以前の版ではポイントでのみ動作しました。 指定した回転楕円体による、2つのジオメトリ間の最小距離を返します。PostGIS 1.5より前ではポイントのみサポートされていました。</li><li class="listitem"><a class="link" href="#ST_DumpPoints" title="ST_DumpPoints">ST_DumpPoints</a> - 初出: 1.5.0 ジオメトリを作る全ての点のgometry_dump(geom,path)行の集合を返します。</li><li class="listitem"><a class="link" href="#ST_Envelope" title="ST_Envelope">ST_Envelope</a> - 初出: 1.5.0で振る舞いが変更され出力がfloat4からfloat8になりました。 ジオメトリの浮動小数点数(float8)バウンディングボックスを表現するジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_GMLToSQL" title="ST_GMLToSQL">ST_GMLToSQL</a> - 初出: 1.5, requires libxml2 1.6+ GML表現から指定したST_Geometry値を返します。これはST_GeomFromGMLの別名です。</li><li class="listitem"><a class="link" href="#ST_GeomFromGML" title="ST_GeomFromGML">ST_GeomFromGML</a> - 初出: 1.5, libxml2 1.6+が必要です。 ジオメトリのGML表現を入力とし、PostGISジオメトリオブジェクトを出力します。</li><li class="listitem"><a class="link" href="#ST_GeomFromKML" title="ST_GeomFromKML">ST_GeomFromKML</a> - 初出: 1.5, libxml2 2.6以上が必要です。 ジオメトリのKML表現の入力をとり、PostGISジオメトリオブジェクトを出力します。</li><li class="listitem"><a class="link" href="#ST_Geometry_Same" title="~=">~=</a> - 初出: 1.5.0では、挙動を変更しました。 AのバウンディングボックスがBのバウンディングボックスと同じ場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#ST_HausdorffDistance" title="ST_HausdorffDistance">ST_HausdorffDistance</a> - 初出: 1.5.0 - GEOS 3.2.0以上が必要です。 2つのジオメトリ間のハウスドルフ距離を返します。基本的にジオメトリが似ているかどうかを計測するものです。単位はジオメトリの空間参照系の単位です。</li><li class="listitem"><a class="link" href="#ST_Intersection" title="ST_Intersection">ST_Intersection</a> - 初出: 1.5 では、ジオグラフィ型が導入されました。 (T) geomAとgeomBの共有部分を表すジオメトリを返します。ジオグラフィ実装では、インタセクトするためにジオメトリに変換して、WGS84に戻します。</li><li class="listitem"><a class="link" href="#ST_Intersects" title="ST_Intersects">ST_Intersects</a> - 初出: 1.5 ジオメトリが導入されました。 ジオメトリ/ジオグラフィが「2次元空間で空間的にインタセクトする」(空間に共有部分がある)場合には、TRUEを返します。そうでない(非接続)場合はFALSEを返します。ジオグラフィについては、許容量は0.00001メートルです(どの閉じた点でもインタセクトを考慮されます)。</li><li class="listitem"><a class="link" href="#ST_Length" title="ST_Length">ST_Length</a> - 初出: 1.5.0 ジオグラフィが導入されました。 LINESTRINGまたはMULTILINESTRINGの場合に、ジオメトリの2次元長を返します。ジオメトリでは、単位は空間参照系の単位です。ジオグラフィでは、メートル単位です(回転楕円体がデフォルトです)。</li><li class="listitem"><a class="link" href="#ST_LongestLine" title="ST_LongestLine">ST_LongestLine</a> - 初出: 1.5.0 2つのジオメトリの2次元長が最長となるポイントを返します。見つかった最長線が複数ある場合は、最初のもののみ返します。返されるラインは常にg1側を始点、g2側を終点とします。この関数が返すラインの長さは、常に始点をg1に終点をg2にそれぞれ指定した場合のST_MaxDistanceが返す値と同じになります。</li><li class="listitem"><a class="link" href="#ST_MakeEnvelope" title="ST_MakeEnvelope">ST_MakeEnvelope</a> - 初出: 1.5 与えられた最小値と最大値から長方形ポリゴンを生成します。入力値はSRIDで指定された空間参照系でなければなりません。</li><li class="listitem"><a class="link" href="#ST_MaxDistance" title="ST_MaxDistance">ST_MaxDistance</a> - 初出: 1.5.0 2つのジオメトリ間の2次元距離の最大値を、投影法の単位で返します。</li><li class="listitem"><a class="link" href="#ST_ShortestLine" title="ST_ShortestLine">ST_ShortestLine</a> - 初出: 1.5.0 2つのジオメトリの2次元長が最短となるラインを返します。</li><li class="listitem"><a class="link" href="#geometry_overlaps" title="&amp;&amp;">&amp;&amp;</a> - 初出: 1.5.0では、ジオグラフィを導入しました。 AのバウンディングボックスがBのバウンディングボックスをオーバラップする場合にTRUEを返します。</li></ul></div></div><div class="sect2" title="13.11.4. PostGIS 1.4で新規作成/機能強化/挙動変更された関数"><div class="titlepage"><div><div><h3 class="title"><a name="NewFunctions_1_4"></a>13.11.4. PostGIS 1.4で新規作成/機能強化/挙動変更された関数</h3></div></div></div><p>次に示す関数は、1.4リリースで新規作成/機能強化/挙動変更されたPostGIS関数です。</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><a class="link" href="#Populate_Geometry_Columns" title="Populate_Geometry_Columns">Populate_Geometry_Columns</a> - ジオメトリカラムが型修飾子で定義されるか、適切な制約を持つことを確実にします。ジオメトリカラムがgeometry_columnsに正しく登録されることを確実にします。デフォルトでは、型修飾子によらないジオメトリカラムを型修飾子によるジオメトリカラムに変換します。以前の挙動にするにはuse_typmod=falseとします。 初出: 1.4.0</li><li class="listitem"><a class="link" href="#ST_AsSVG" title="ST_AsSVG">ST_AsSVG</a> - ジオメトリまたはジオグラフィで与えられたSVGパスデータによるジオメトリを返します。 
		  初出: 1.2.2. 初出: 1.4.0 PostGIS 1.4.0でhttp://www.w3.org/TR/SVG/paths.html#PathDataBNFに従うため、絶対パスにLコマンドが入りました。
		</li><li class="listitem"><a class="link" href="#ST_Collect" title="ST_Collect">ST_Collect</a> - 他のジオメトリのコレクションから、指定したST_Geometry値を返します。 初出: 1.4.0 - ST_Collect(geometry)が導入されました。ST_Collectがより多くのジオメトリをより早く扱えるよう強化されました。</li><li class="listitem"><a class="link" href="#ST_ContainsProperly" title="ST_ContainsProperly">ST_ContainsProperly</a> - BがAの内部にインタセクトするが境界(または外部)にインタセクトしない場合に、TRUEを返します。Aは自身には、ContainsProperlyではありませんが、Containsです。 初出: 1.4.0 - GEOS 3.1.0以上が必要です。</li><li class="listitem"><a class="link" href="#ST_Extent" title="ST_Extent">ST_Extent</a> - ジオメトリのバウンディングボックスを返す集計関数です。 
		  初出: 1.4.0
		</li><li class="listitem"><a class="link" href="#ST_GeoHash" title="ST_GeoHash">ST_GeoHash</a> - ジオメトリのGeoHash表現(geohash.org)を返します。 初出: 1.4.0</li><li class="listitem"><a class="link" href="#ST_IsValidReason" title="ST_IsValidReason">ST_IsValidReason</a> - ジオメトリが妥当か否かを示すテキストを返し、不正な場合は理由を返します。 初出: 1.4 - requires GEOS &gt;= 3.1.0.</li><li class="listitem"><a class="link" href="#ST_LineCrossingDirection" title="ST_LineCrossingDirection">ST_LineCrossingDirection</a> - 2つのラインストリングが与えられ、クロスの種類を-3から3の区間の数で返します。0の場合はクロスしていません。 初出: 1.4</li><li class="listitem"><a class="link" href="#ST_LocateBetweenElevations" title="ST_LocateBetweenElevations">ST_LocateBetweenElevations</a> - 指定したZ値の範囲内にある要素からなる、派生ジオメトリ(コレクション)値を返します。3次元、4次元のLINESTRINGSとMULTILINESTRINGSのみをサポートします。 初出: 1.4.0</li><li class="listitem"><a class="link" href="#ST_MakeLine" title="ST_MakeLine">ST_MakeLine</a> - ポイントまたはラインジオメトリからラインストリングを生成します。 初出: 1.4.0 - ST_MakeLine(geomarray)が導入されました。ST_MakeLine集計関数はより多くのポイントをより早く扱うための強化が施されています。</li><li class="listitem"><a class="link" href="#ST_MinimumBoundingCircle" title="ST_MinimumBoundingCircle">ST_MinimumBoundingCircle</a> - ジオメトリを完全に含む最小の円ポリゴンを返します。デフォルトでは、4分の1円に対して48区分を使用します。 初出: 1.4.0 - GEOSが必要です。</li><li class="listitem"><a class="link" href="#ST_Union" title="ST_Union">ST_Union</a> - ジオメトリの結合の点集合を表現するジオメトリを返します。 初出: 1.4.0 - ST_Unionが強化されました。ST_Union(geomarray)が導入され、また、PostgreSQL内での集計が速くなりました。GEOS 3.1.0以上を使用している場合は、ST_Unionは、http://blog.cleverelephant.ca/2009/01/must-faster-unions-in-postgis-14.htmlに記述がある、Cascaded Unionアルゴリズムを使います。</li></ul></div></div><div class="sect2" title="13.11.5. PostGIS 1.3で新規作成された関数"><div class="titlepage"><div><div><h3 class="title"><a name="NewFunctions_1_3"></a>13.11.5. PostGIS 1.3で新規作成された関数</h3></div></div></div><p>次に示す関数は、1.3リリースで新規作成されたPostGIS関数です。</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><a class="link" href="#ST_AsGML" title="ST_AsGML">ST_AsGML</a> - GML第2版または第3版としてジオメトリを返します。 初出: 1.3.2。</li><li class="listitem"><a class="link" href="#ST_AsGeoJSON" title="ST_AsGeoJSON">ST_AsGeoJSON</a> - GeoJSON要素としてジオメトリを返します。 初出: 1.3.4</li><li class="listitem"><a class="link" href="#ST_SimplifyPreserveTopology" title="ST_SimplifyPreserveTopology">ST_SimplifyPreserveTopology</a> - 与えられたジオメトリを「簡略化」したものを返します。Douglas-Peukerアルゴリズムを使用します。不正な派生ジオメトリ(特にポリゴン)の生成を回避します。 初出: 1.3.3</li></ul></div></div></div></div><div class="chapter" title="第14章 問題を報告する"><div class="titlepage"><div><div><h2 class="title"><a name="id287246629"></a>第14章 問題を報告する</h2></div></div></div><div class="toc"><p><b>目次</b></p><dl><dt><span class="sect1"><a href="#id287246634">14.1. ソフトウェアのバグを報告する</a></span></dt><dt><span class="sect1"><a href="#id287246775">14.2. 文書の問題を報告する</a></span></dt></dl></div><div class="sect1" title="14.1. ソフトウェアのバグを報告する"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id287246634"></a>14.1. ソフトウェアのバグを報告する</h2></div></div></div><p>効率的なバグの報告は PostGIS の開発を助ける本質的な方法です。最も効率的なバグ報告は、PostGIS 開発者がそれを再現できるようにすることで、それの引き金となったスクリプトと検出された環境に沿った全ての情報を含んでいるのが理想です。<code class="code">SELECT postgis_full_version()</code> [PostGIS]と<code class="code">SELECT version()</code> [PostgreSQL]とを実行することで十分に良い情報を得ることができます。</p><p>最新版を使っていない場合は <a class="ulink" href="http://svn.osgeo.org/postgis/trunk/NEWS" target="_top">release changelog</a> をまず見て、既にバグフィクスされていないかを探すのは価値のあることです。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/" target="_top">PostGIS bug tracker</a> を使うと、レポートが捨てられず、それの対応プロセスが通知されることを保証します。新しいバグを報告する前にデータベースに問い合わせて、既知のバグかどうかを見て下さい。既知のものでしたら、それに関して持っているあらゆる新しい情報を追加して下さい。</p><p>新しいレポートを記入する前にSimon Tathamさんの<a class="ulink" href="http://www.chiark.greenend.org.uk/~sgtatham/bugs.html" target="_top">How to Report Bugs Effectively</a>に関するページを読むと良いでしょう。</p></div><div class="sect1" title="14.2. 文書の問題を報告する"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id287246775"></a>14.2. 文書の問題を報告する</h2></div></div></div><p>文書は、ソフトウェアの機能と振る舞いを正確に反映するべきものです。正確でない場合は、ソフトウェアのバグがあるか、または文書に誤り若しくは不十分な箇所があることが考えられます。</p><p>文書の問題も <a class="ulink" href="http://trac.osgeo.org/postgis" target="_top">PostGIS bug tracker</a>に報告することができます。</p><p>訂正が小さいものなら、バグトラッカの新しい問題の中に、文書内の位置を特定して記述して下さい。</p><p>変更が大きい場合は、Subversion パッチが確実に好まれます。Unix上で次の4ステップの処理を行います (既に <a class="ulink" href="http://subversion.apache.org/" target="_top">Subversion</a>をインストールしていると仮定します)。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>PostGISのSubversionトランクをチェックアウトします。Unix上で次のように入力します。</p><p><span class="command"><strong>svn checkout
        http://svn.osgeo.org/postgis/trunk/</strong></span></p><p>これで./trunkディレクトリに格納されます。</p></li><li class="listitem"><p>お使いのテキストエディタで文書に変更を加えます。Unixでは、たとえば次のようにします。</p><p><span class="command"><strong>vim trunk/doc/postgis.xml</strong></span></p><p>文書はHTMLでなくDocBook XMLで書かれていますので、慣れていないなら、残りの文書の例にならって下さい。</p></li><li class="listitem"><p>文書のマスタコピーからパッチファイルを作成します。Unixで次のように入力します。</p><p><span class="command"><strong>svn diff trunk/doc/postgis.xml &gt;
        doc.patch</strong></span></p></li><li class="listitem"><p>バグトラッカ内の新しい問題にパッチが取り付けられます。</p></li></ol></div></div></div><div class="appendix" title="付録A Appendix"><div class="titlepage"><div><div><h2 class="title"><a name="release_notes"></a>付録A Appendix</h2></div><div><h3 class="subtitle"><i>Release Notes</i></h3></div></div></div><div class="toc"><p><b>目次</b></p><dl><dt><span class="sect1"><a href="#id287247000">A.1. Release 2.0.0</a></span></dt><dt><span class="sect1"><a href="#id287247252">A.2. Release 1.5.3</a></span></dt><dt><span class="sect1"><a href="#id287247330">A.3. Release 1.5.2</a></span></dt><dt><span class="sect1"><a href="#id287247417">A.4. Release 1.5.1</a></span></dt><dt><span class="sect1"><a href="#id287247534">A.5. Release 1.5.0</a></span></dt><dt><span class="sect1"><a href="#id287247718">A.6. Release 1.4.0</a></span></dt><dt><span class="sect1"><a href="#id287247892">A.7. Release 1.3.6</a></span></dt><dt><span class="sect1"><a href="#id287247905">A.8. Release 1.3.5</a></span></dt><dt><span class="sect1"><a href="#id287250547">A.9. Release 1.3.4</a></span></dt><dt><span class="sect1"><a href="#id287250563">A.10. Release 1.3.3</a></span></dt><dt><span class="sect1"><a href="#id287250576">A.11. Release 1.3.2</a></span></dt><dt><span class="sect1"><a href="#id287250588">A.12. Release 1.3.1</a></span></dt><dt><span class="sect1"><a href="#id287250603">A.13. Release 1.3.0</a></span></dt><dt><span class="sect1"><a href="#id287250664">A.14. Release 1.2.1</a></span></dt><dt><span class="sect1"><a href="#id287250700">A.15. Release 1.2.0</a></span></dt><dt><span class="sect1"><a href="#id287250727">A.16. Release 1.1.6</a></span></dt><dt><span class="sect1"><a href="#id287250816">A.17. Release 1.1.5</a></span></dt><dt><span class="sect1"><a href="#id287250901">A.18. Release 1.1.4</a></span></dt><dt><span class="sect1"><a href="#id287250995">A.19. Release 1.1.3</a></span></dt><dt><span class="sect1"><a href="#id287251126">A.20. Release 1.1.2</a></span></dt><dt><span class="sect1"><a href="#id287251333">A.21. Release 1.1.1</a></span></dt><dt><span class="sect1"><a href="#id287251431">A.22. Release 1.1.0</a></span></dt><dt><span class="sect1"><a href="#id287251684">A.23. Release 1.0.6</a></span></dt><dt><span class="sect1"><a href="#id287251770">A.24. Release 1.0.5</a></span></dt><dt><span class="sect1"><a href="#id287251912">A.25. Release 1.0.4</a></span></dt><dt><span class="sect1"><a href="#rel_1.0.3_upgrading">A.26. Release 1.0.3</a></span></dt><dt><span class="sect1"><a href="#id287252101">A.27. Release 1.0.2</a></span></dt><dt><span class="sect1"><a href="#id287252167">A.28. Release 1.0.1</a></span></dt><dt><span class="sect1"><a href="#id287252284">A.29. Release 1.0.0</a></span></dt><dt><span class="sect1"><a href="#id287252363">A.30. Release 1.0.0RC6</a></span></dt><dt><span class="sect1"><a href="#id287252426">A.31. Release 1.0.0RC5</a></span></dt><dt><span class="sect1"><a href="#id287252486">A.32. Release 1.0.0RC4</a></span></dt><dt><span class="sect1"><a href="#id287252587">A.33. Release 1.0.0RC3</a></span></dt><dt><span class="sect1"><a href="#id287252726">A.34. Release 1.0.0RC2</a></span></dt><dt><span class="sect1"><a href="#id287252808">A.35. Release 1.0.0RC1</a></span></dt></dl></div><div class="sect1" title="A.1. Release 2.0.0"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id287247000"></a>A.1. Release 2.0.0</h2></div></div></div><p>Release date: 2012/04/03</p><p>This is a major release.  A hard upgrade is required.  Yes this means a full dump reload and some special preparations if you are using obsolete functions. Refer
        to <a class="xref" href="#hard_upgrade" title="2.9.2. ハードアップグレード">「ハードアップグレード」</a> for details on upgrading.
        Refer to <a class="xref" href="#NewFunctions_2_0" title="13.11.1. PostGIS 2.0で新規作成/機能強化/変更された関数">「PostGIS 2.0で新規作成/機能強化/変更された関数」</a> for more details and changed/new functions.</p><div class="simplesect" title="Testers - Our unsung heroes"><div class="titlepage"><div><div><h3 class="title"><a name="id287247019"></a>Testers - Our unsung heroes</h3></div></div></div><p>We are most indebted to the numerous members in the PostGIS community 
 	who were brave enough to test out the new features in this release.  
 	No major release can be successful without these folk.</p><p>Below are those who have been most valiant, provided very detailed
			and thorough bug reports,
			and detailed analysis.</p><table border="0" summary="Simple list" class="simplelist"><tr><td>Andrea Peri - Lots of testing on topology, checking for correctness</td></tr><tr><td>Andreas For・Tollefsen - raster testing</td></tr><tr><td>Chris English - topology stress testing loader functions</td></tr><tr><td>Salvatore Larosa - topology robustness testing</td></tr><tr><td>Brian Hamlin - Benchmarking 
				(also experimental experimental branches 
					before they are folded into core)
				, general testing of various pieces 
			   including Tiger and Topology. Testing on various server VMs</td></tr><tr><td>Mike Pease -  Tiger geocoder testing - very detailed reports of issues</td></tr><tr><td>Tom van Tilburg - raster testing</td></tr></table></div><div class="simplesect" title="Important / Breaking Changes"><div class="titlepage"><div><div><h3 class="title"><a name="id287247060"></a>Important / Breaking Changes</h3></div></div></div><p>#722, #302, Most deprecated functions removed (over 250 functions) (Regina Obe, Paul Ramsey)</p><p>Unknown SRID changed from -1 to 0. (Paul Ramsey)</p><p> -- (most deprecated in 1.2) removed non-ST variants buffer, length, intersects 
        	 (and internal functions renamed) etc. </p><p>-- If you have been using deprecated functions CHANGE your apps or suffer the consequences.
     If you don't see a function documented -- it ain't supported or it is an internal function.
     Some constraints in older tables were built with deprecated functions.
     If you restore you may need to rebuild table constraints with populate_geometry_columns().  If you have applications or tools
					that rely on deprecated functions, please refer to <a class="link" href="#legacy_faq" title="3.1.">???</a> for more details.</p><p>#944 geometry_columns is now a view instead of a table 
    (Paul Ramsey, Regina Obe)
    for tables created the old way reads (srid, type, dims) constraints
    for geometry columns created with type modifiers 
    reads rom column definition</p><p>#1081, #1082, #1084, #1088 - Mangement functions support typmod 
    geometry column creation functions now default to typmod creation
    (Regina Obe)</p><p>#1083 probe_geometry_columns(), rename_geometry_table_constraints(),
        fix_geometry_columns(); removed
    - now obsolete with geometry_column view
    (Regina Obe)</p><p>#817 Renaming old 3D functions to the convention ST_3D (Nicklas Av駭)</p><p>#548 (sorta), ST_NumGeometries,ST_GeometryN now returns 1 (or the geometry) instead of null 
     for single geometries (Sandro Santilli, Maxime van Noppen)</p></div><div class="simplesect" title="New Features"><div class="titlepage"><div><div><h3 class="title"><a name="id287247099"></a>New Features</h3></div></div></div><p><a class="ulink" href="http://blog.opengeo.org/2011/09/28/indexed-nearest-neighbour-search-in-postgis/" target="_top">KNN Gist index based centroid (&lt;-&gt;) and box (&lt;#&gt;) distance operators (Paul Ramsey / funded by Vizzuality)</a></p><p>Support for TIN and PolyHedralSurface and enhancement of many functions to support 3D (Olivier Courtin / Oslandia)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/wiki/WKTRaster/PlanningAndFunding" target="_top">Raster support integrated and documented</a>
          		(Pierre Racine, Jorge Ar騅alo, Mateusz Loskot, Sandro Santilli, David Zwarg, Regina Obe, Bborie Park)
          		(Company developer and funding: University Laval, Deimos Space, CadCorp,  Michigan Tech Research Institute, Azavea, Paragon Corporation, UC Davis Center for Vectorborne Diseases)</p><p>Making spatial indexes 3D aware - in progress (Paul Ramsey, Mark Cave-Ayland)</p><p>Topology support improved (more functions), documented, testing (Sandro Santilli / Faunalia for RT-SIGTA), Andrea Peri, Regina Obe, Jose Carlos Martinez Llari</p><p>3D relationship and measurement support functions  (Nicklas Av駭)</p><p>   ST_3DDistance, ST_3DClosestPoint, ST_3DIntersects, ST_3DShortestLine and more...</p><p>N-Dimensional spatial indexes (Paul Ramsey / OpenGeo)</p><p>ST_Split (Sandro Santilli / Faunalia for RT-SIGTA)</p><p>ST_IsValidDetail (Sandro Santilli / Faunalia for RT-SIGTA)</p><p>ST_MakeValid (Sandro Santilli / Faunalia for RT-SIGTA)</p><p>ST_RemoveRepeatedPoints (Sandro Santilli / Faunalia for RT-SIGTA)</p><p>ST_GeometryN and ST_NumGeometries support for non-collections (Sandro Santilli)</p><p>ST_IsCollection (Sandro Santilli, Maxime van Noppen)</p><p>ST_SharedPaths (Sandro Santilli / Faunalia for RT-SIGTA)</p><p>ST_Snap (Sandro Santilli)</p><p>ST_RelateMatch (Sandro Santilli / Faunalia for RT-SIGTA)</p><p>ST_ConcaveHull (Regina Obe and Leo Hsu / Paragon Corporation)</p><p>ST_UnaryUnion (Sandro Santilli / Faunalia for RT-SIGTA)</p><p>ST_AsX3D (Regina Obe / Arrival 3D funding)</p><p>ST_OffsetCurve (Sandro Santilli, Rafal Magda)</p><p><a class="ulink" href="http://blog.opengeo.org/2011/11/21/st_geomfromgeojson/" target="_top">ST_GeomFromGeoJSON (Kashif Rasul, Paul Ramsey / Vizzuality funding)</a></p></div><div class="simplesect" title="Enhancements"><div class="titlepage"><div><div><h3 class="title"><a name="id287247186"></a>Enhancements</h3></div></div></div><p>Made shape file loader tolerant of truncated multibyte values found in some free worldwide shapefiles (Sandro Santilli)</p><p>Lots of bug fixes and enhancements to shp2pgsql
        	       Beefing up regression tests for loaders 
        	       Reproject support for both geometry and geography during import
        	       (Jeff Adams / Azavea, Mark Cave-Ayland)</p><p>pgsql2shp conversion from predefined list 
        	       (Loic Dachary / Mark Cave-Ayland)</p><p>Shp-pgsql GUI loader - support loading multiple files at a time.  (Mark Leslie)</p><p>Extras - upgraded tiger_geocoder from using old TIGER format to use new TIGER shp and file structure format (Stephen Frost)</p><p>Extras - revised tiger_geocoder to work with TIGER census 2010 data, addition of reverse geocoder function, various bug fixes, accuracy enhancements, 
        	     limit max result return, speed improvements, loading routines. 
        	   (Regina Obe, Leo Hsu / Paragon Corporation / funding provided by Hunter Systems Group)</p><p>Overall Documentation proofreading and corrections. (Kasif Rasul)</p><p>Cleanup PostGIS JDBC classes, revise to use Maven build. (Maria Arias de Reyna, Sandro Santilli)</p></div><div class="simplesect" title="Bug Fixes"><div class="titlepage"><div><div><h3 class="title"><a name="id287247220"></a>Bug Fixes</h3></div></div></div><p>#1335 ST_AddPoint returns incorrect result on Linux (Even Rouault)</p></div><div class="simplesect" title="Release specific credits"><div class="titlepage"><div><div><h3 class="title"><a name="id287247230"></a>Release specific credits</h3></div></div></div><p>We thank <a class="ulink" href="http://blog.opengeo.org/2012/02/01/it-goes-up-to-2-0/" target="_top">U.S Department of State Human Information Unit (HIU)</a> and <a class="ulink" href="http://blog.cartodb.com/post/17318840209/postgis-core-committer-sandro-santilli-joins-cartodb" target="_top">Vizzuality</a> for general monetary support to get PostGIS 2.0 out the door.</p></div></div><div class="sect1" title="A.2. Release 1.5.3"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id287247252"></a>A.2. Release 1.5.3</h2></div></div></div><p>Release date: 2011/06/25</p><p>This is a bug fix release, addressing issues that have been filed since the 1.5.2 release. If you are running PostGIS 1.3+, a soft upgrade is sufficient
        	otherwise a hard upgrade is recommended.</p><div class="simplesect" title="Bug Fixes"><div class="titlepage"><div><div><h3 class="title"><a name="id287247264"></a>Bug Fixes</h3></div></div></div><p>#1056, produce correct bboxes for arc geometries, fixes index errors
                    (Paul Ramsey)</p><p>#1007, ST_IsValid crash fix requires GEOS 3.3.0+ or 3.2.3+ 
				 (Sandro Santilli, reported by Birgit Laggner)</p><p>#940, support for PostgreSQL 9.1 beta 1 
				 (Regina Obe, Paul Ramsey, patch submitted by stl)</p><p>#845, ST_Intersects precision error (Sandro Santilli, Nicklas Av駭)
				 Reported by cdestigter</p><p>#884, Unstable results with ST_Within, ST_Intersects (Chris Hodgson)</p><p>#779, shp2pgsql -S option seems to fail on points (Jeff Adams)</p><p>#666, ST_DumpPoints is not null safe (Regina Obe)</p><p>#631, Update NZ projections for grid transformation support (jpalmer)</p><p>#630, Peculiar Null treatment in arrays in ST_Collect (Chris Hodgson)
				 Reported by David Bitner</p><p>#624, Memory leak in ST_GeogFromText (ryang, Paul Ramsey)</p><p>#609, Bad source code in manual section 5.2 Java Clients (simoc, Regina Obe)</p><p>#604, shp2pgsql usage touchups (Mike Toews, Paul Ramsey)</p><p>#573 ST_Union fails on a group of linestrings 
				 Not a PostGIS bug, fixed in GEOS 3.3.0</p><p>#457 ST_CollectionExtract returns non-requested type
				(Nicklas Av駭, Paul Ramsey)</p><p>#441 ST_AsGeoJson Bbox on GeometryCollection error (Olivier Courtin)</p><p>#411 Ability to backup invalid geometries (Sando Santilli)
				 Reported by Regione Toscana</p><p>#409 ST_AsSVG - degraded (Olivier Courtin)
				 Reported by Sdikiy</p><p>#373 Documentation syntax error in hard upgrade (Paul Ramsey)
				 Reported by psvensso</p></div></div><div class="sect1" title="A.3. Release 1.5.2"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id287247330"></a>A.3. Release 1.5.2</h2></div></div></div><p>Release date: 2010/09/27</p><p>This is a bug fix release, addressing issues that have been filed since the 1.5.1 release. If you are running PostGIS 1.3+, a soft upgrade is sufficient
        	otherwise a hard upgrade is recommended.</p><div class="simplesect" title="Bug Fixes"><div class="titlepage"><div><div><h3 class="title"><a name="id287247341"></a>Bug Fixes</h3></div></div></div><p>Loader: fix handling of empty (0-verticed) geometries in shapefiles. (Sandro Santilli)</p><p>#536, Geography ST_Intersects, ST_Covers, ST_CoveredBy and Geometry ST_Equals not using spatial index (Regina Obe, Nicklas Aven)</p><p>#573, Improvement to ST_Contains geography (Paul Ramsey)</p><p>Loader: Add support for command-q shutdown in Mac GTK build (Paul Ramsey)</p><p>#393, Loader: Add temporary patch for large DBF files (Maxime Guillaud, Paul Ramsey)</p><p>#507, Fix wrong OGC URN in GeoJSON and GML output (Olivier Courtin)</p><p>spatial_ref_sys.sql Add datum conversion for projection SRID 3021 (Paul Ramsey)</p><p>Geography - remove crash for case when all geographies are out of the estimate (Paul Ramsey)</p><p>#469, Fix for array_aggregation error (Greg Stark, Paul Ramsey)</p><p>#532, Temporary geography tables showing up in other user sessions (Paul Ramsey)</p><p>#562, ST_Dwithin errors for large geographies (Paul Ramsey)</p><p>#513, shape loading GUI tries to make spatial index when loading DBF only mode (Paul Ramsey)</p><p>#527, shape loading GUI should always append log messages (Mark Cave-Ayland)</p><p>#504, shp2pgsql should rename xmin/xmax fields (Sandro Santilli)</p><p>#458, postgis_comments being installed in contrib instead of version folder (Mark Cave-Ayland)</p><p>#474, Analyzing a table with geography column crashes server (Paul Ramsey)</p><p>#581, LWGEOM-expand produces inconsistent results (Mark Cave-Ayland)</p><p>#513, Add dbf filter to shp2pgsql-gui and allow uploading dbf only (Paul Ramsey)</p><p>Fix further build issues against PostgreSQL 9.0 (Mark Cave-Ayland)</p><p>#572, Password whitespace for Shape File (Mark Cave-Ayland)</p><p>#603, shp2pgsql: "-w" produces invalid WKT for MULTI* objects. (Mark Cave-Ayland)</p></div></div><div class="sect1" title="A.4. Release 1.5.1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id287247417"></a>A.4. Release 1.5.1</h2></div></div></div><p>Release date: 2010/03/11</p><p>This is a bug fix release, addressing issues that have been filed since the 1.4.1 release. If you are running PostGIS 1.3+, a soft upgrade is sufficient
        	otherwise a hard upgrade is recommended.</p><div class="simplesect" title="Bug Fixes"><div class="titlepage"><div><div><h3 class="title"><a name="id287247498"></a>Bug Fixes</h3></div></div></div><p>#410, update embedded bbox when applying ST_SetPoint, ST_AddPoint ST_RemovePoint to a linestring (Paul Ramsey)</p><p>#411, allow dumping tables with invalid geometries (Sandro Santilli, for Regione Toscana-SIGTA)</p><p>#414, include geography_columns view when running upgrade scripts (Paul Ramsey)</p><p>#419, allow support for multilinestring in ST_Line_Substring (Paul Ramsey, for Lidwala Consulting Engineers)</p><p>#421, fix computed string length in ST_AsGML() (Olivier Courtin)</p><p>#441, fix GML generation with heterogeneous collections (Olivier Courtin)</p><p>#443, incorrect coordinate reversal in GML 3 generation (Olivier Courtin)</p><p>#450, #451, wrong area calculation for geography features that  cross the date line (Paul Ramsey)</p><p>Ensure support for upcoming 9.0 PgSQL release (Paul Ramsey)</p></div></div><div class="sect1" title="A.5. Release 1.5.0"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id287247534"></a>A.5. Release 1.5.0</h2></div></div></div><p>Release date: 2010/02/04</p><p>This release provides support for geographic coordinates (lat/lon) via a new GEOGRAPHY type. Also performance enhancements, new input format support (GML,KML) and general upkeep.</p><div class="simplesect" title="API Stability"><div class="titlepage"><div><div><h3 class="title"><a name="id287247546"></a>API Stability</h3></div></div></div><p>The public API of PostGIS will not change during minor (0.0.X) releases.</p><p>The definition of the =~ operator has changed from an exact geometric equality check to a bounding box equality check.</p></div><div class="simplesect" title="Compatibility"><div class="titlepage"><div><div><h3 class="title"><a name="id287247560"></a>Compatibility</h3></div></div></div><p>GEOS, Proj4, and LibXML2 are now mandatory dependencies</p><p>The library versions below are the minimum requirements for PostGIS 1.5</p><p>PostgreSQL 8.3 and higher on all platforms</p><p>GEOS 3.1 and higher only (GEOS 3.2+ to take advantage of all features)</p><p>LibXML2 2.5+ related to new ST_GeomFromGML/KML functionality</p><p>Proj4 4.5 and higher only</p></div><div class="simplesect" title="New Features"><div class="titlepage"><div><div><h3 class="title"><a name="id287247587"></a>New Features</h3></div></div></div><p><a class="xref" href="#NewFunctions_1_5" title="13.11.3. PostGIS 1.5で新規作成/機能強化/挙動変更された関数">「PostGIS 1.5で新規作成/機能強化/挙動変更された関数」</a></p><p>Added Hausdorff distance calculations (#209) (Vincent Picavet)</p><p>Added parameters argument to ST_Buffer operation to support one-sided buffering and other buffering styles (Sandro Santilli)</p><p>Addition of other Distance related visualization and analysis functions (Nicklas Aven)</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>ST_ClosestPoint</p></li><li class="listitem"><p>ST_DFullyWithin</p></li><li class="listitem"><p>ST_LongestLine</p></li><li class="listitem"><p>ST_MaxDistance</p></li><li class="listitem"><p>ST_ShortestLine</p></li></ul></div><p>ST_DumpPoints (Maxime van Noppen)</p><p>KML, GML input via ST_GeomFromGML and ST_GeomFromKML (Olivier Courtin)</p><p>Extract homogeneous collection with ST_CollectionExtract (Paul Ramsey)</p><p>Add measure values to an existing linestring with ST_AddMeasure (Paul Ramsey)</p><p>History table implementation in utils (George Silva)</p><p>Geography type and supporting functions</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Spherical algorithms (Dave Skea)</p></li><li class="listitem"><p>Object/index implementation (Paul Ramsey)</p></li><li class="listitem"><p>Selectivity implementation (Mark Cave-Ayland)</p></li><li class="listitem"><p>Serializations to KML, GML and JSON (Olivier Courtin)</p></li><li class="listitem"><p>ST_Area, ST_Distance, ST_DWithin, ST_GeogFromText, ST_GeogFromWKB, ST_Intersects, ST_Covers, ST_Buffer (Paul Ramsey)</p></li></ul></div></div><div class="simplesect" title="Enhancements"><div class="titlepage"><div><div><h3 class="title"><a name="id287247678"></a>Enhancements</h3></div></div></div><p>Performance improvements to ST_Distance (Nicklas Aven)</p><p>Documentation updates and improvements (Regina Obe, Kevin Neufeld)</p><p>Testing and quality control (Regina Obe)</p><p>PostGIS 1.5 support PostgreSQL 8.5 trunk (Guillaume Lelarge)</p><p>Win32 support and improvement of core shp2pgsql-gui (Mark Cave-Ayland)</p><p>In place 'make check' support (Paul Ramsey)</p></div><div class="simplesect" title="Bug fixes"><div class="titlepage"><div><div><h3 class="title"><a name="id287247705"></a>Bug fixes</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/query?status=closed&amp;milestone=PostGIS+1.5.0&amp;order=priority" target="_top">http://trac.osgeo.org/postgis/query?status=closed&amp;milestone=PostGIS+1.5.0&amp;order=priority</a></p></div></div><div class="sect1" title="A.6. Release 1.4.0"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id287247718"></a>A.6. Release 1.4.0</h2></div></div></div><p>Release date: 2009/07/24</p><p>This release provides performance enhancements, improved internal structures and testing, new features, and upgraded documentation.
        If you are running PostGIS 1.1+, a soft upgrade is sufficient
        	otherwise a hard upgrade is recommended.</p><div class="simplesect" title="API Stability"><div class="titlepage"><div><div><h3 class="title"><a name="id287247730"></a>API Stability</h3></div></div></div><p>As of the 1.4 release series, the public API of PostGIS will not change during minor releases.</p></div><div class="simplesect" title="Compatibility"><div class="titlepage"><div><div><h3 class="title"><a name="id287247739"></a>Compatibility</h3></div></div></div><p>The versions below are the *minimum* requirements for PostGIS 1.4</p><p>PostgreSQL 8.2 and higher on all platforms</p><p>GEOS 3.0 and higher only</p><p>PROJ4 4.5 and higher only</p></div><div class="simplesect" title="New Features"><div class="titlepage"><div><div><h3 class="title"><a name="id287247758"></a>New Features</h3></div></div></div><p>ST_Union() uses high-speed cascaded union when compiled against
         GEOS 3.1+ (Paul Ramsey)</p><p>ST_ContainsProperly() requires GEOS 3.1+</p><p>ST_Intersects(), ST_Contains(), ST_Within() use high-speed cached prepared geometry against GEOS 3.1+ (Paul Ramsey / funded by Zonar Systems)</p><p>Vastly improved documentation and reference manual (Regina Obe &amp; Kevin Neufeld)</p><p>Figures and diagram examples in the reference manual (Kevin Neufeld)</p><p>ST_IsValidReason() returns readable explanations for validity failures (Paul Ramsey)</p><p>ST_GeoHash() returns a geohash.org signature for geometries (Paul Ramsey)</p><p>GTK+ multi-platform GUI for shape file loading (Paul Ramsey)</p><p>ST_LineCrossingDirection() returns crossing directions (Paul Ramsey)</p><p>ST_LocateBetweenElevations() returns sub-string based on Z-ordinate. (Paul Ramsey)</p><p>Geometry parser returns explicit error message about location of syntax errors (Mark Cave-Ayland)</p><p>ST_AsGeoJSON() return JSON formatted geometry (Olivier Courtin)</p><p>Populate_Geometry_Columns() -- automatically add records to geometry_columns for TABLES and VIEWS (Kevin Neufeld)</p><p>ST_MinimumBoundingCircle() -- returns the smallest circle polygon that can encompass a geometry (Bruce Rindahl)</p></div><div class="simplesect" title="Enhancements"><div class="titlepage"><div><div><h3 class="title"><a name="id287247812"></a>Enhancements</h3></div></div></div><p>Core geometry system moved into independent library, liblwgeom. (Mark Cave-Ayland)</p><p>New build system uses PostgreSQL "pgxs" build bootstrapper. (Mark Cave-Ayland)</p><p>Debugging framework formalized and simplified. (Mark Cave-Ayland)</p><p>All build-time #defines generated at configure time and placed in headers for easier cross-platform support (Mark Cave-Ayland)</p><p>Logging framework formalized and simplified (Mark Cave-Ayland)</p><p>Expanded and more stable support for CIRCULARSTRING, COMPOUNDCURVE and CURVEPOLYGON, better parsing, wider support in functions (Mark Leslie &amp; Mark Cave-Ayland)</p><p>Improved support for OpenSolaris builds (Paul Ramsey)</p><p>Improved support for MSVC builds (Mateusz Loskot)</p><p>Updated KML support (Olivier Courtin)</p><p>Unit testing framework for liblwgeom (Paul Ramsey)</p><p>New testing framework to comprehensively exercise every PostGIS function (Regine Obe)</p><p>Performance improvements to all geometry aggregate functions (Paul Ramsey)</p><p>Support for the upcoming PostgreSQL 8.4 (Mark Cave-Ayland, Talha Bin Rizwan)</p><p>Shp2pgsql and pgsql2shp re-worked to depend on the common parsing/unparsing code in liblwgeom (Mark Cave-Ayland)</p><p>Use of PDF DbLatex to build PDF docs and preliminary instructions for build (Jean David Techer)</p><p>Automated User documentation build (PDF and HTML) and Developer Doxygen Documentation (Kevin Neufeld)</p><p>Automated build of document images using ImageMagick from WKT geometry text files (Kevin Neufeld)</p><p>More attractive CSS for HTML documentation (Dane Springmeyer)</p></div><div class="simplesect" title="Bug fixes"><div class="titlepage"><div><div><h3 class="title"><a name="id287247879"></a>Bug fixes</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/query?status=closed&amp;milestone=PostGIS+1.4.0&amp;order=priority" target="_top">http://trac.osgeo.org/postgis/query?status=closed&amp;milestone=PostGIS+1.4.0&amp;order=priority</a></p></div></div><div class="sect1" title="A.7. Release 1.3.6"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id287247892"></a>A.7. Release 1.3.6</h2></div></div></div><p>Release date: 2009/05/04</p><p>If you are running PostGIS 1.1+, a soft upgrade is sufficient
        	otherwise a hard upgrade is recommended. This release adds support for PostgreSQL 8.4, exporting
        prj files from the database with shape data, some crash fixes for shp2pgsql, and several small
        bug fixes in the handling of "curve" types, logical error importing dbf only files, improved error handling of AddGeometryColumns.</p></div><div class="sect1" title="A.8. Release 1.3.5"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id287247905"></a>A.8. Release 1.3.5</h2></div></div></div><p>Release date: 2008/12/15</p><p>If you are running PostGIS 1.1+, a soft upgrade is sufficient
        	otherwise a hard upgrade is recommended. This release is a bug fix release to address a failure
        in ST_Force_Collection and related functions that critically
        affects using MapServer with LINE layers.</p></div><div class="sect1" title="A.9. Release 1.3.4"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id287250547"></a>A.9. Release 1.3.4</h2></div></div></div><p>Release date: 2008/11/24</p><p>This release adds support for GeoJSON output, building
      with PostgreSQL 8.4, improves documentation quality and 
      output aesthetics, adds function-level SQL documentation,
      and improves performance for some spatial predicates
      (point-in-polygon tests).</p><p>Bug fixes include removal of crashers in handling
      circular strings for many functions, some memory leaks
      removed, a linear referencing failure for measures on vertices,
      and more. See the NEWS file for details.</p></div><div class="sect1" title="A.10. Release 1.3.3"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id287250563"></a>A.10. Release 1.3.3</h2></div></div></div><p>Release date: 2008/04/12</p><p>This release fixes bugs shp2pgsql, adds enhancements to SVG and
      KML support, adds a ST_SimplifyPreserveTopology function, makes the
      build more sensitive to GEOS versions, and fixes a handful of severe but
      rare failure cases.</p></div><div class="sect1" title="A.11. Release 1.3.2"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id287250576"></a>A.11. Release 1.3.2</h2></div></div></div><p>Release date: 2007/12/01</p><p>This release fixes bugs in ST_EndPoint() and ST_Envelope, improves
      support for JDBC building and OS/X, and adds better support for GML
      output with ST_AsGML(), including GML3 output.</p></div><div class="sect1" title="A.12. Release 1.3.1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id287250588"></a>A.12. Release 1.3.1</h2></div></div></div><p>Release date: 2007/08/13</p><p>This release fixes some oversights in the previous release around
      version numbering, documentation, and tagging.</p></div><div class="sect1" title="A.13. Release 1.3.0"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id287250603"></a>A.13. Release 1.3.0</h2></div></div></div><p>Release date: 2007/08/09</p><p>This release provides performance enhancements to the relational
      functions, adds new relational functions and begins the migration of our
      function names to the SQL-MM convention, using the spatial type (SP)
      prefix.</p><div class="simplesect" title="Added Functionality"><div class="titlepage"><div><div><h3 class="title"><a name="id287250615"></a>Added Functionality</h3></div></div></div><p>JDBC: Added Hibernate Dialect (thanks to Norman Barker)</p><p>Added ST_Covers and ST_CoveredBy relational functions.
        Description and justification of these functions can be found at
        <a class="ulink" href="http://lin-ear-th-inking.blogspot.com/2007/06/subtleties-of-ogc-covers-spatial.html" target="_top">http://lin-ear-th-inking.blogspot.com/2007/06/subtleties-of-ogc-covers-spatial.html</a></p><p>Added ST_DWithin relational function.</p></div><div class="simplesect" title="Performance Enhancements"><div class="titlepage"><div><div><h3 class="title"><a name="id287250634"></a>Performance Enhancements</h3></div></div></div><p>Added cached and indexed point-in-polygon short-circuits for the
        functions ST_Contains, ST_Intersects, ST_Within and ST_Disjoint</p><p>Added inline index support for relational functions (except
        ST_Disjoint)</p></div><div class="simplesect" title="Other Changes"><div class="titlepage"><div><div><h3 class="title"><a name="id287250647"></a>Other Changes</h3></div></div></div><p>Extended curved geometry support into the geometry accessor and
        some processing functions</p><p>Began migration of functions to the SQL-MM naming convention;
        using a spatial type (ST) prefix.</p><p>Added initial support for PostgreSQL 8.3</p></div></div><div class="sect1" title="A.14. Release 1.2.1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id287250664"></a>A.14. Release 1.2.1</h2></div></div></div><p>Release date: 2007/01/11</p><p>This release provides bug fixes in PostgreSQL 8.2 support and some
      small performance enhancements.</p><div class="simplesect" title="Changes"><div class="titlepage"><div><div><h3 class="title"><a name="id287250677"></a>Changes</h3></div></div></div><p>Fixed point-in-polygon shortcut bug in Within().</p><p>Fixed PostgreSQL 8.2 NULL handling for indexes.</p><p>Updated RPM spec files.</p><p>Added short-circuit for Transform() in no-op case.</p><p>JDBC: Fixed JTS handling for multi-dimensional geometries
        (thanks to Thomas Marti for hint and partial patch). Additionally, now
        JavaDoc is compiled and packaged. Fixed classpath problems with GCJ.
        Fixed pgjdbc 8.2 compatibility, losing support for jdk 1.3 and
        older.</p></div></div><div class="sect1" title="A.15. Release 1.2.0"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id287250700"></a>A.15. Release 1.2.0</h2></div></div></div><p>Release date: 2006/12/08</p><p>This release provides type definitions along with
      serialization/deserialization capabilities for SQL-MM defined curved
      geometries, as well as performance enhancements.</p><div class="simplesect" title="Changes"><div class="titlepage"><div><div><h3 class="title"><a name="id287250712"></a>Changes</h3></div></div></div><p>Added curved geometry type support for
        serialization/deserialization</p><p>Added point-in-polygon shortcircuit to the Contains and Within
        functions to improve performance for these cases.</p></div></div><div class="sect1" title="A.16. Release 1.1.6"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id287250727"></a>A.16. Release 1.1.6</h2></div></div></div><p>Release date: 2006/11/02</p><p>This is a bugfix release, in particular fixing a critical error
      with GEOS interface in 64bit systems. Includes an updated of the SRS
      parameters and an improvement in reprojections (take Z in
      consideration). Upgrade is <span class="emphasis"><em>encouraged</em></span>.</p><div class="simplesect" title="Upgrading"><div class="titlepage"><div><div><h3 class="title"><a name="id287250743"></a>Upgrading</h3></div></div></div><p>If you are upgrading from release 1.0.3 or later follow the
        <a class="link" href="#soft_upgrade" title="2.9.1. ソフトアップグレード">soft upgrade</a> procedure.</p><p>If you are upgrading from a release <span class="emphasis"><em>between 1.0.0RC6
        and 1.0.2</em></span> (inclusive) and really want a live upgrade read
        the <a class="link" href="#rel_1.0.3_upgrading" title="A.26. Release 1.0.3">upgrade section</a> of the
        1.0.3 release notes chapter.</p><p>Upgrade from any release prior to 1.0.0RC6 requires an <a class="link" href="#hard_upgrade" title="2.9.2. ハードアップグレード">hard upgrade</a>.</p></div><div class="simplesect" title="Bug fixes"><div class="titlepage"><div><div><h3 class="title"><a name="id287250775"></a>Bug fixes</h3></div></div></div><p>fixed CAPI change that broke 64-bit platforms</p><p>loader/dumper: fixed regression tests and usage output</p><p>Fixed setSRID() bug in JDBC, thanks to Thomas Marti</p></div><div class="simplesect" title="Other changes"><div class="titlepage"><div><div><h3 class="title"><a name="id287250791"></a>Other changes</h3></div></div></div><p>use Z ordinate in reprojections</p><p>spatial_ref_sys.sql updated to EPSG 6.11.1</p><p>Simplified Version.config infrastructure to use a single pack of
        version variables for everything.</p><p>Include the Version.config in loader/dumper USAGE
        messages</p><p>Replace hand-made, fragile JDBC version parser with
        Properties</p></div></div><div class="sect1" title="A.17. Release 1.1.5"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id287250816"></a>A.17. Release 1.1.5</h2></div></div></div><p>Release date: 2006/10/13</p><p>This is an bugfix release, including a critical segfault on win32.
      Upgrade is <span class="emphasis"><em>encouraged</em></span>.</p><div class="simplesect" title="Upgrading"><div class="titlepage"><div><div><h3 class="title"><a name="id287250830"></a>Upgrading</h3></div></div></div><p>If you are upgrading from release 1.0.3 or later follow the
        <a class="link" href="#soft_upgrade" title="2.9.1. ソフトアップグレード">soft upgrade</a> procedure.</p><p>If you are upgrading from a release <span class="emphasis"><em>between 1.0.0RC6
        and 1.0.2</em></span> (inclusive) and really want a live upgrade read
        the <a class="link" href="#rel_1.0.3_upgrading" title="A.26. Release 1.0.3">upgrade section</a> of the
        1.0.3 release notes chapter.</p><p>Upgrade from any release prior to 1.0.0RC6 requires an <a class="link" href="#hard_upgrade" title="2.9.2. ハードアップグレード">hard upgrade</a>.</p></div><div class="simplesect" title="Bug fixes"><div class="titlepage"><div><div><h3 class="title"><a name="id287250862"></a>Bug fixes</h3></div></div></div><p>Fixed MingW link error that was causing pgsql2shp to segfault on
        Win32 when compiled for PostgreSQL 8.2</p><p>fixed nullpointer Exception in Geometry.equals() method in
        Java</p><p>Added EJB3Spatial.odt to fulfill the GPL requirement of
        distributing the "preferred form of modification"</p><p>Removed obsolete synchronization from JDBC Jts code.</p><p>Updated heavily outdated README files for shp2pgsql/pgsql2shp by
        merging them with the manpages.</p><p>Fixed version tag in jdbc code that still said "1.1.3" in the
        "1.1.4" release.</p></div><div class="simplesect" title="New Features"><div class="titlepage"><div><div><h3 class="title"><a name="id287250890"></a>New Features</h3></div></div></div><p>Added -S option for non-multi geometries to shp2pgsql</p></div></div><div class="sect1" title="A.18. Release 1.1.4"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id287250901"></a>A.18. Release 1.1.4</h2></div></div></div><p>Release date: 2006/09/27</p><p>This is an bugfix release including some improvements in the Java
      interface. Upgrade is <span class="emphasis"><em>encouraged</em></span>.</p><div class="simplesect" title="Upgrading"><div class="titlepage"><div><div><h3 class="title"><a name="id287250916"></a>Upgrading</h3></div></div></div><p>If you are upgrading from release 1.0.3 or later follow the
        <a class="link" href="#soft_upgrade" title="2.9.1. ソフトアップグレード">soft upgrade</a> procedure.</p><p>If you are upgrading from a release <span class="emphasis"><em>between 1.0.0RC6
        and 1.0.2</em></span> (inclusive) and really want a live upgrade read
        the <a class="link" href="#rel_1.0.3_upgrading" title="A.26. Release 1.0.3">upgrade section</a> of the
        1.0.3 release notes chapter.</p><p>Upgrade from any release prior to 1.0.0RC6 requires an <a class="link" href="#hard_upgrade" title="2.9.2. ハードアップグレード">hard upgrade</a>.</p></div><div class="simplesect" title="Bug fixes"><div class="titlepage"><div><div><h3 class="title"><a name="id287250949"></a>Bug fixes</h3></div></div></div><p>Fixed support for PostgreSQL 8.2</p><p>Fixed bug in collect() function discarding SRID of input</p><p>Added SRID match check in MakeBox2d and MakeBox3d</p><p>Fixed regress tests to pass with GEOS-3.0.0</p><p>Improved pgsql2shp run concurrency.</p></div><div class="simplesect" title="Java changes"><div class="titlepage"><div><div><h3 class="title"><a name="id287250971"></a>Java changes</h3></div></div></div><p>reworked JTS support to reflect new upstream JTS developers'
        attitude to SRID handling. Simplifies code and drops build depend on
        GNU trove.</p><p>Added EJB2 support generously donated by the "Geodetix s.r.l.
        Company" <a class="ulink" href="http://www.geodetix.it/" target="_top">http://www.geodetix.it/</a></p><p>Added EJB3 tutorial / examples donated by Norman Barker
        &lt;nbarker@ittvis.com&gt;</p><p>Reorganized java directory layout a little.</p></div></div><div class="sect1" title="A.19. Release 1.1.3"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id287250995"></a>A.19. Release 1.1.3</h2></div></div></div><p>Release date: 2006/06/30</p><p>This is an bugfix release including also some new functionalities
      (most notably long transaction support) and portability enhancements.
      Upgrade is <span class="emphasis"><em>encouraged</em></span>.</p><div class="simplesect" title="Upgrading"><div class="titlepage"><div><div><h3 class="title"><a name="id287251010"></a>Upgrading</h3></div></div></div><p>If you are upgrading from release 1.0.3 or later follow the
        <a class="link" href="#soft_upgrade" title="2.9.1. ソフトアップグレード">soft upgrade</a> procedure.</p><p>If you are upgrading from a release <span class="emphasis"><em>between 1.0.0RC6
        and 1.0.2</em></span> (inclusive) and really want a live upgrade read
        the <a class="link" href="#rel_1.0.3_upgrading" title="A.26. Release 1.0.3">upgrade section</a> of the
        1.0.3 release notes chapter.</p><p>Upgrade from any release prior to 1.0.0RC6 requires an <a class="link" href="#hard_upgrade" title="2.9.2. ハードアップグレード">hard upgrade</a>.</p></div><div class="simplesect" title="Bug fixes / correctness"><div class="titlepage"><div><div><h3 class="title"><a name="id287251043"></a>Bug fixes / correctness</h3></div></div></div><p>BUGFIX in distance(poly,poly) giving wrong results.</p><p>BUGFIX in pgsql2shp successful return code.</p><p>BUGFIX in shp2pgsql handling of MultiLine WKT.</p><p>BUGFIX in affine() failing to update bounding box.</p><p>WKT parser: forbidden construction of multigeometries with EMPTY
        elements (still supported for GEOMETRYCOLLECTION).</p></div><div class="simplesect" title="New functionalities"><div class="titlepage"><div><div><h3 class="title"><a name="id287251066"></a>New functionalities</h3></div></div></div><p>NEW Long Transactions support.</p><p>NEW DumpRings() function.</p><p>NEW AsHEXEWKB(geom, XDR|NDR) function.</p></div><div class="simplesect" title="JDBC changes"><div class="titlepage"><div><div><h3 class="title"><a name="id287251083"></a>JDBC changes</h3></div></div></div><p>Improved regression tests: MultiPoint and scientific
        ordinates</p><p>Fixed some minor bugs in jdbc code</p><p>Added proper accessor functions for all fields in preparation of
        making those fields private later</p></div><div class="simplesect" title="Other changes"><div class="titlepage"><div><div><h3 class="title"><a name="id287251099"></a>Other changes</h3></div></div></div><p>NEW regress test support for loader/dumper.</p><p>Added --with-proj-libdir and --with-geos-libdir configure
        switches.</p><p>Support for build Tru64 build.</p><p>Use Jade for generating documentation.</p><p>Don't link pgsql2shp to more libs then required.</p><p>Initial support for PostgreSQL 8.2.</p></div></div><div class="sect1" title="A.20. Release 1.1.2"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id287251126"></a>A.20. Release 1.1.2</h2></div></div></div><p>Release date: 2006/03/30</p><p>This is an bugfix release including some new functions and
      portability enhancements. Upgrade is
      <span class="emphasis"><em>encouraged</em></span>.</p><div class="simplesect" title="Upgrading"><div class="titlepage"><div><div><h3 class="title"><a name="id287251141"></a>Upgrading</h3></div></div></div><p>If you are upgrading from release 1.0.3 or later follow the
        <a class="link" href="#soft_upgrade" title="2.9.1. ソフトアップグレード">soft upgrade</a> procedure.</p><p>If you are upgrading from a release <span class="emphasis"><em>between 1.0.0RC6
        and 1.0.2</em></span> (inclusive) and really want a live upgrade read
        the <a class="link" href="#rel_1.0.3_upgrading" title="A.26. Release 1.0.3">upgrade section</a> of the
        1.0.3 release notes chapter.</p><p>Upgrade from any release prior to 1.0.0RC6 requires an <a class="link" href="#hard_upgrade" title="2.9.2. ハードアップグレード">hard upgrade</a>.</p></div><div class="simplesect" title="Bug fixes"><div class="titlepage"><div><div><h3 class="title"><a name="id287251174"></a>Bug fixes</h3></div></div></div><p>BUGFIX in SnapToGrid() computation of output bounding box</p><p>BUGFIX in EnforceRHR()</p><p>jdbc2 SRID handling fixes in JTS code</p><p>Fixed support for 64bit archs</p></div><div class="simplesect" title="New functionalities"><div class="titlepage"><div><div><h3 class="title"><a name="id287251193"></a>New functionalities</h3></div></div></div><p>Regress tests can now be run *before* postgis
        installation</p><p>New affine() matrix transformation functions</p><p>New rotate{,X,Y,Z}() function</p><p>Old translating and scaling functions now use affine()
        internally</p><p>Embedded access control in estimated_extent() for builds against
        pgsql &gt;= 8.0.0</p></div><div class="simplesect" title="Other changes"><div class="titlepage"><div><div><h3 class="title"><a name="id287251216"></a>Other changes</h3></div></div></div><p>More portable ./configure script</p><p>Changed ./run_test script to have more sane default
        behaviour</p></div></div><div class="sect1" title="A.21. Release 1.1.1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id287251333"></a>A.21. Release 1.1.1</h2></div></div></div><p>Release date: 2006/01/23</p><p>This is an important Bugfix release, upgrade is <span class="emphasis"><em>highly
      recommended</em></span>. Previous version contained a bug in
      postgis_restore.pl preventing <a class="link" href="#hard_upgrade" title="2.9.2. ハードアップグレード">hard
      upgrade</a> procedure to complete and a bug in GEOS-2.2+ connector
      preventing GeometryCollection objects to be used in topological
      operations.</p><div class="simplesect" title="Upgrading"><div class="titlepage"><div><div><h3 class="title"><a name="id287251352"></a>Upgrading</h3></div></div></div><p>If you are upgrading from release 1.0.3 or later follow the
        <a class="link" href="#soft_upgrade" title="2.9.1. ソフトアップグレード">soft upgrade</a> procedure.</p><p>If you are upgrading from a release <span class="emphasis"><em>between 1.0.0RC6
        and 1.0.2</em></span> (inclusive) and really want a live upgrade read
        the <a class="link" href="#rel_1.0.3_upgrading" title="A.26. Release 1.0.3">upgrade section</a> of the
        1.0.3 release notes chapter.</p><p>Upgrade from any release prior to 1.0.0RC6 requires an <a class="link" href="#hard_upgrade" title="2.9.2. ハードアップグレード">hard upgrade</a>.</p></div><div class="simplesect" title="Bug fixes"><div class="titlepage"><div><div><h3 class="title"><a name="id287251384"></a>Bug fixes</h3></div></div></div><p>Fixed a premature exit in postgis_restore.pl</p><p>BUGFIX in geometrycollection handling of GEOS-CAPI
        connector</p><p>Solaris 2.7 and MingW support improvements</p><p>BUGFIX in line_locate_point()</p><p>Fixed handling of postgresql paths</p><p>BUGFIX in line_substring()</p><p>Added support for localized cluster in regress tester</p></div><div class="simplesect" title="New functionalities"><div class="titlepage"><div><div><h3 class="title"><a name="id287251414"></a>New functionalities</h3></div></div></div><p>New Z and M interpolation in line_substring()</p><p>New Z and M interpolation in line_interpolate_point()</p><p>added NumInteriorRing() alias due to OpenGIS ambiguity</p></div></div><div class="sect1" title="A.22. Release 1.1.0"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id287251431"></a>A.22. Release 1.1.0</h2></div></div></div><p>Release date: 2005/12/21</p><p>This is a Minor release, containing many improvements and new
      things. Most notably: build procedure greatly simplified; transform()
      performance drastically improved; more stable GEOS connectivity (CAPI
      support); lots of new functions; draft topology support.</p><p>It is <span class="emphasis"><em>highly recommended</em></span> that you upgrade to
      GEOS-2.2.x before installing PostGIS, this will ensure future GEOS
      upgrades won't require a rebuild of the PostGIS library.</p><div class="simplesect" title="Credits"><div class="titlepage"><div><div><h3 class="title"><a name="id287251449"></a>Credits</h3></div></div></div><p>This release includes code from Mark Cave Ayland for caching of
        proj4 objects. Markus Schaber added many improvements in his JDBC2
        code. Alex Bodnaru helped with PostgreSQL source dependency relief and
        provided Debian specfiles. Michael Fuhr tested new things on Solaris
        arch. David Techer and Gerald Fenoy helped testing GEOS C-API
        connector. Hartmut Tschauner provided code for the azimuth() function.
        Devrim GUNDUZ provided RPM specfiles. Carl Anderson helped with the
        new area building functions. See the <a class="link" href="#credits" title="1.2. 過去と現在の貢献者">credits</a> section for more names.</p></div><div class="simplesect" title="Upgrading"><div class="titlepage"><div><div><h3 class="title"><a name="id287251464"></a>Upgrading</h3></div></div></div><p>If you are upgrading from release 1.0.3 or later you
        <span class="emphasis"><em>DO NOT</em></span> need a dump/reload. Simply sourcing the
        new lwpostgis_upgrade.sql script in all your existing databases will
        work. See the <a class="link" href="#soft_upgrade" title="2.9.1. ソフトアップグレード">soft upgrade</a> chapter
        for more information.</p><p>If you are upgrading from a release <span class="emphasis"><em>between 1.0.0RC6
        and 1.0.2</em></span> (inclusive) and really want a live upgrade read
        the <a class="link" href="#rel_1.0.3_upgrading" title="A.26. Release 1.0.3">upgrade section</a> of the
        1.0.3 release notes chapter.</p><p>Upgrade from any release prior to 1.0.0RC6 requires an <a class="link" href="#hard_upgrade" title="2.9.2. ハードアップグレード">hard upgrade</a>.</p></div><div class="simplesect" title="New functions"><div class="titlepage"><div><div><h3 class="title"><a name="id287251499"></a>New functions</h3></div></div></div><p>scale() and transscale() companion methods to translate()</p><p>line_substring()</p><p>line_locate_point()</p><p>M(point)</p><p>LineMerge(geometry)</p><p>shift_longitude(geometry)</p><p>azimuth(geometry)</p><p>locate_along_measure(geometry, float8)</p><p>locate_between_measures(geometry, float8, float8)</p><p>SnapToGrid by point offset (up to 4d support)</p><p>BuildArea(any_geometry)</p><p>OGC BdPolyFromText(linestring_wkt, srid)</p><p>OGC BdMPolyFromText(linestring_wkt, srid)</p><p>RemovePoint(linestring, offset)</p><p>ReplacePoint(linestring, offset, point)</p></div><div class="simplesect" title="Bug fixes"><div class="titlepage"><div><div><h3 class="title"><a name="id287251555"></a>Bug fixes</h3></div></div></div><p>Fixed memory leak in polygonize()</p><p>Fixed bug in lwgeom_as_anytype cast functions</p><p>Fixed USE_GEOS, USE_PROJ and USE_STATS elements of
        postgis_version() output to always reflect library state.</p></div><div class="simplesect" title="Function semantic changes"><div class="titlepage"><div><div><h3 class="title"><a name="id287251572"></a>Function semantic changes</h3></div></div></div><p>SnapToGrid doesn't discard higher dimensions</p><p>Changed Z() function to return NULL if requested dimension is
        not available</p></div><div class="simplesect" title="Performance improvements"><div class="titlepage"><div><div><h3 class="title"><a name="id287251585"></a>Performance improvements</h3></div></div></div><p>Much faster transform() function, caching proj4 objects</p><p>Removed automatic call to fix_geometry_columns() in
        AddGeometryColumns() and update_geometry_stats()</p></div><div class="simplesect" title="JDBC2 works"><div class="titlepage"><div><div><h3 class="title"><a name="id287251598"></a>JDBC2 works</h3></div></div></div><p>Makefile improvements</p><p>JTS support improvements</p><p>Improved regression test system</p><p>Basic consistency check method for geometry collections</p><p>Support for (Hex)(E)wkb</p><p>Autoprobing DriverWrapper for HexWKB / EWKT switching</p><p>fix compile problems in ValueSetter for ancient jdk
        releases.</p><p>fix EWKT constructors to accept SRID=4711; representation</p><p>added preliminary read-only support for java2d geometries</p></div><div class="simplesect" title="Other new things"><div class="titlepage"><div><div><h3 class="title"><a name="id287251634"></a>Other new things</h3></div></div></div><p>Full autoconf-based configuration, with PostgreSQL source
        dependency relief</p><p>GEOS C-API support (2.2.0 and higher)</p><p>Initial support for topology modelling</p><p>Debian and RPM specfiles</p><p>New lwpostgis_upgrade.sql script</p></div><div class="simplesect" title="Other changes"><div class="titlepage"><div><div><h3 class="title"><a name="id287251656"></a>Other changes</h3></div></div></div><p>JTS support improvements</p><p>Stricter mapping between DBF and SQL integer and string
        attributes</p><p>Wider and cleaner regression test suite</p><p>old jdbc code removed from release</p><p>obsoleted direct use of postgis_proc_upgrade.pl</p><p>scripts version unified with release version</p></div></div><div class="sect1" title="A.23. Release 1.0.6"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id287251684"></a>A.23. Release 1.0.6</h2></div></div></div><p>Release date: 2005/12/06</p><p>Contains a few bug fixes and improvements.</p><div class="simplesect" title="Upgrading"><div class="titlepage"><div><div><h3 class="title"><a name="id287251696"></a>Upgrading</h3></div></div></div><p>If you are upgrading from release 1.0.3 or later you
        <span class="emphasis"><em>DO NOT</em></span> need a dump/reload.</p><p>If you are upgrading from a release <span class="emphasis"><em>between 1.0.0RC6
        and 1.0.2</em></span> (inclusive) and really want a live upgrade read
        the <a class="link" href="#rel_1.0.3_upgrading" title="A.26. Release 1.0.3">upgrade section</a> of the
        1.0.3 release notes chapter.</p><p>Upgrade from any release prior to 1.0.0RC6 requires an <a class="link" href="#hard_upgrade" title="2.9.2. ハードアップグレード">hard upgrade</a>.</p></div><div class="simplesect" title="Bug fixes"><div class="titlepage"><div><div><h3 class="title"><a name="id287251726"></a>Bug fixes</h3></div></div></div><p>Fixed palloc(0) call in collection deserializer (only gives
        problem with --enable-cassert)</p><p>Fixed bbox cache handling bugs</p><p>Fixed geom_accum(NULL, NULL) segfault</p><p>Fixed segfault in addPoint()</p><p>Fixed short-allocation in lwcollection_clone()</p><p>Fixed bug in segmentize()</p><p>Fixed bbox computation of SnapToGrid output</p></div><div class="simplesect" title="Improvements"><div class="titlepage"><div><div><h3 class="title"><a name="id287251756"></a>Improvements</h3></div></div></div><p>Initial support for postgresql 8.2</p><p>Added missing SRID mismatch checks in GEOS ops</p></div></div><div class="sect1" title="A.24. Release 1.0.5"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id287251770"></a>A.24. Release 1.0.5</h2></div></div></div><p>Release date: 2005/11/25</p><p>Contains memory-alignment fixes in the library, a segfault fix in
      loader's handling of UTF8 attributes and a few improvements and
      cleanups.</p><div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Return code of shp2pgsql changed from previous releases to
        conform to unix standards (return 0 on success).</p></td></tr></table></div><div class="simplesect" title="Upgrading"><div class="titlepage"><div><div><h3 class="title"><a name="id287251789"></a>Upgrading</h3></div></div></div><p>If you are upgrading from release 1.0.3 or later you
        <span class="emphasis"><em>DO NOT</em></span> need a dump/reload.</p><p>If you are upgrading from a release <span class="emphasis"><em>between 1.0.0RC6
        and 1.0.2</em></span> (inclusive) and really want a live upgrade read
        the <a class="link" href="#rel_1.0.3_upgrading" title="A.26. Release 1.0.3">upgrade section</a> of the
        1.0.3 release notes chapter.</p><p>Upgrade from any release prior to 1.0.0RC6 requires an <a class="link" href="#hard_upgrade" title="2.9.2. ハードアップグレード">hard upgrade</a>.</p></div><div class="simplesect" title="Library changes"><div class="titlepage"><div><div><h3 class="title"><a name="id287251821"></a>Library changes</h3></div></div></div><p>Fixed memory alignment problems</p><p>Fixed computation of null values fraction in analyzer</p><p>Fixed a small bug in the getPoint4d_p() low-level
        function</p><p>Speedup of serializer functions</p><p>Fixed a bug in force_3dm(), force_3dz() and force_4d()</p></div><div class="simplesect" title="Loader changes"><div class="titlepage"><div><div><h3 class="title"><a name="id287251844"></a>Loader changes</h3></div></div></div><p>Fixed return code of shp2pgsql</p><p>Fixed back-compatibility issue in loader (load of null
        shapefiles)</p><p>Fixed handling of trailing dots in dbf numerical
        attributes</p><p>Segfault fix in shp2pgsql (utf8 encoding)</p></div><div class="simplesect" title="Other changes"><div class="titlepage"><div><div><h3 class="title"><a name="id287251863"></a>Other changes</h3></div></div></div><p>Schema aware postgis_proc_upgrade.pl, support for pgsql
        7.2+</p><p>New "Reporting Bugs" chapter in manual</p></div></div><div class="sect1" title="A.25. Release 1.0.4"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id287251912"></a>A.25. Release 1.0.4</h2></div></div></div><p>Release date: 2005/09/09</p><p>Contains important bug fixes and a few improvements. In
      particular, it fixes a memory leak preventing successful build of GiST
      indexes for large spatial tables.</p><div class="simplesect" title="Upgrading"><div class="titlepage"><div><div><h3 class="title"><a name="id287251924"></a>Upgrading</h3></div></div></div><p>If you are upgrading from release 1.0.3 you <span class="emphasis"><em>DO
        NOT</em></span> need a dump/reload.</p><p>If you are upgrading from a release <span class="emphasis"><em>between 1.0.0RC6
        and 1.0.2</em></span> (inclusive) and really want a live upgrade read
        the <a class="link" href="#rel_1.0.3_upgrading" title="A.26. Release 1.0.3">upgrade section</a> of the
        1.0.3 release notes chapter.</p><p>Upgrade from any release prior to 1.0.0RC6 requires an <a class="link" href="#hard_upgrade" title="2.9.2. ハードアップグレード">hard upgrade</a>.</p></div><div class="simplesect" title="Bug fixes"><div class="titlepage"><div><div><h3 class="title"><a name="id287251955"></a>Bug fixes</h3></div></div></div><p>Memory leak plugged in GiST indexing</p><p>Segfault fix in transform() handling of proj4 errors</p><p>Fixed some proj4 texts in spatial_ref_sys (missing +proj)</p><p>Loader: fixed string functions usage, reworked NULL objects
        check, fixed segfault on MULTILINESTRING input.</p><p>Fixed bug in MakeLine dimension handling</p><p>Fixed bug in translate() corrupting output bounding box</p></div><div class="simplesect" title="Improvements"><div class="titlepage"><div><div><h3 class="title"><a name="id287251982"></a>Improvements</h3></div></div></div><p>Documentation improvements</p><p>More robust selectivity estimator</p><p>Minor speedup in distance()</p><p>Minor cleanups</p><p>GiST indexing cleanup</p><p>Looser syntax acceptance in box3d parser</p></div></div><div class="sect1" title="A.26. Release 1.0.3"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="rel_1.0.3_upgrading"></a>A.26. Release 1.0.3</h2></div></div></div><p>Release date: 2005/08/08</p><p>Contains some bug fixes - <span class="emphasis"><em>including a severe one
      affecting correctness of stored geometries</em></span> - and a few
      improvements.</p><div class="simplesect" title="Upgrading"><div class="titlepage"><div><div><h3 class="title"><a name="id287252025"></a>Upgrading</h3></div></div></div><p>Due to a bug in a bounding box computation routine, the upgrade
        procedure requires special attention, as bounding boxes cached in the
        database could be incorrect.</p><p>An <a class="link" href="#hard_upgrade" title="2.9.2. ハードアップグレード">hard upgrade</a> procedure
        (dump/reload) will force recomputation of all bounding boxes (not
        included in dumps). This is <span class="emphasis"><em>required</em></span> if upgrading
        from releases prior to 1.0.0RC6.</p><p>If you are upgrading from versions 1.0.0RC6 or up, this release
        includes a perl script (utils/rebuild_bbox_caches.pl) to force
        recomputation of geometries' bounding boxes and invoke all operations
        required to propagate eventual changes in them (geometry statistics
        update, reindexing). Invoke the script after a make install (run with
        no args for syntax help). Optionally run utils/postgis_proc_upgrade.pl
        to refresh postgis procedures and functions signatures (see <a class="link" href="#soft_upgrade" title="2.9.1. ソフトアップグレード">Soft upgrade</a>).</p></div><div class="simplesect" title="Bug fixes"><div class="titlepage"><div><div><h3 class="title"><a name="id287252055"></a>Bug fixes</h3></div></div></div><p>Severe bugfix in lwgeom's 2d bounding box computation</p><p>Bugfix in WKT (-w) POINT handling in loader</p><p>Bugfix in dumper on 64bit machines</p><p>Bugfix in dumper handling of user-defined queries</p><p>Bugfix in create_undef.pl script</p></div><div class="simplesect" title="Improvements"><div class="titlepage"><div><div><h3 class="title"><a name="id287252077"></a>Improvements</h3></div></div></div><p>Small performance improvement in canonical input function</p><p>Minor cleanups in loader</p><p>Support for multibyte field names in loader</p><p>Improvement in the postgis_restore.pl script</p><p>New rebuild_bbox_caches.pl util script</p></div></div><div class="sect1" title="A.27. Release 1.0.2"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id287252101"></a>A.27. Release 1.0.2</h2></div></div></div><p>Release date: 2005/07/04</p><p>Contains a few bug fixes and improvements.</p><div class="simplesect" title="Upgrading"><div class="titlepage"><div><div><h3 class="title"><a name="id287252114"></a>Upgrading</h3></div></div></div><p>If you are upgrading from release 1.0.0RC6 or up you
        <span class="emphasis"><em>DO NOT</em></span> need a dump/reload.</p><p>Upgrading from older releases requires a dump/reload. See the
        <a class="link" href="#upgrading" title="2.9. アップグレード">upgrading</a> chapter for more
        informations.</p></div><div class="simplesect" title="Bug fixes"><div class="titlepage"><div><div><h3 class="title"><a name="id287252134"></a>Bug fixes</h3></div></div></div><p>Fault tolerant btree ops</p><p>Memory leak plugged in pg_error</p><p>Rtree index fix</p><p>Cleaner build scripts (avoided mix of CFLAGS and
        CXXFLAGS)</p></div><div class="simplesect" title="Improvements"><div class="titlepage"><div><div><h3 class="title"><a name="id287252153"></a>Improvements</h3></div></div></div><p>New index creation capabilities in loader (-I switch)</p><p>Initial support for postgresql 8.1dev</p></div></div><div class="sect1" title="A.28. Release 1.0.1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id287252167"></a>A.28. Release 1.0.1</h2></div></div></div><p>Release date: 2005/05/24</p><p>Contains a few bug fixes and some improvements.</p><div class="simplesect" title="Upgrading"><div class="titlepage"><div><div><h3 class="title"><a name="id287252180"></a>Upgrading</h3></div></div></div><p>If you are upgrading from release 1.0.0RC6 or up you
        <span class="emphasis"><em>DO NOT</em></span> need a dump/reload.</p><p>Upgrading from older releases requires a dump/reload. See the
        <a class="link" href="#upgrading" title="2.9. アップグレード">upgrading</a> chapter for more
        informations.</p></div><div class="simplesect" title="Library changes"><div class="titlepage"><div><div><h3 class="title"><a name="id287252200"></a>Library changes</h3></div></div></div><p>BUGFIX in 3d computation of length_spheroid()</p><p>BUGFIX in join selectivity estimator</p></div><div class="simplesect" title="Other changes/additions"><div class="titlepage"><div><div><h3 class="title"><a name="id287252213"></a>Other changes/additions</h3></div></div></div><p>BUGFIX in shp2pgsql escape functions</p><p>better support for concurrent postgis in multiple schemas</p><p>documentation fixes</p><p>jdbc2: compile with "-target 1.2 -source 1.2" by default</p><p>NEW -k switch for pgsql2shp</p><p>NEW support for custom createdb options in
        postgis_restore.pl</p><p>BUGFIX in pgsql2shp attribute names unicity enforcement</p><p>BUGFIX in Paris projections definitions</p><p>postgis_restore.pl cleanups</p></div></div><div class="sect1" title="A.29. Release 1.0.0"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id287252284"></a>A.29. Release 1.0.0</h2></div></div></div><p>Release date: 2005/04/19</p><p>Final 1.0.0 release. Contains a few bug fixes, some improvements
      in the loader (most notably support for older postgis versions), and
      more docs.</p><div class="simplesect" title="Upgrading"><div class="titlepage"><div><div><h3 class="title"><a name="id287252296"></a>Upgrading</h3></div></div></div><p>If you are upgrading from release 1.0.0RC6 you <span class="emphasis"><em>DO
        NOT</em></span> need a dump/reload.</p><p>Upgrading from any other precedent release requires a
        dump/reload. See the <a class="link" href="#upgrading" title="2.9. アップグレード">upgrading</a>
        chapter for more informations.</p></div><div class="simplesect" title="Library changes"><div class="titlepage"><div><div><h3 class="title"><a name="id287252316"></a>Library changes</h3></div></div></div><p>BUGFIX in transform() releasing random memory address</p><p>BUGFIX in force_3dm() allocating less memory then
        required</p><p>BUGFIX in join selectivity estimator (defaults, leaks,
        tuplecount, sd)</p></div><div class="simplesect" title="Other changes/additions"><div class="titlepage"><div><div><h3 class="title"><a name="id287252332"></a>Other changes/additions</h3></div></div></div><p>BUGFIX in shp2pgsql escape of values starting with tab or
        single-quote</p><p>NEW manual pages for loader/dumper</p><p>NEW shp2pgsql support for old (HWGEOM) postgis versions</p><p>NEW -p (prepare) flag for shp2pgsql</p><p>NEW manual chapter about OGC compliancy enforcement</p><p>NEW autoconf support for JTS lib</p><p>BUGFIX in estimator testers (support for LWGEOM and schema
        parsing)</p></div></div><div class="sect1" title="A.30. Release 1.0.0RC6"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id287252363"></a>A.30. Release 1.0.0RC6</h2></div></div></div><p>Release date: 2005/03/30</p><p>Sixth release candidate for 1.0.0. Contains a few bug fixes and
      cleanups.</p><div class="simplesect" title="Upgrading"><div class="titlepage"><div><div><h3 class="title"><a name="id287252375"></a>Upgrading</h3></div></div></div><p>You need a dump/reload to upgrade from precedent releases. See
        the <a class="link" href="#upgrading" title="2.9. アップグレード">upgrading</a> chapter for more
        informations.</p></div><div class="simplesect" title="Library changes"><div class="titlepage"><div><div><h3 class="title"><a name="id287252389"></a>Library changes</h3></div></div></div><p>BUGFIX in multi()</p><p>early return [when noop] from multi()</p></div><div class="simplesect" title="Scripts changes"><div class="titlepage"><div><div><h3 class="title"><a name="id287252402"></a>Scripts changes</h3></div></div></div><p>dropped {x,y}{min,max}(box2d) functions</p></div><div class="simplesect" title="Other changes"><div class="titlepage"><div><div><h3 class="title"><a name="id287252412"></a>Other changes</h3></div></div></div><p>BUGFIX in postgis_restore.pl scrip</p><p>BUGFIX in dumper's 64bit support</p></div></div><div class="sect1" title="A.31. Release 1.0.0RC5"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id287252426"></a>A.31. Release 1.0.0RC5</h2></div></div></div><p>Release date: 2005/03/25</p><p>Fifth release candidate for 1.0.0. Contains a few bug fixes and a
      improvements.</p><div class="simplesect" title="Upgrading"><div class="titlepage"><div><div><h3 class="title"><a name="id287252438"></a>Upgrading</h3></div></div></div><p>If you are upgrading from release 1.0.0RC4 you <span class="emphasis"><em>DO
        NOT</em></span> need a dump/reload.</p><p>Upgrading from any other precedent release requires a
        dump/reload. See the <a class="link" href="#upgrading" title="2.9. アップグレード">upgrading</a>
        chapter for more informations.</p></div><div class="simplesect" title="Library changes"><div class="titlepage"><div><div><h3 class="title"><a name="id287252458"></a>Library changes</h3></div></div></div><p>BUGFIX (segfaulting) in box3d computation (yes,
        another!).</p><p>BUGFIX (segfaulting) in estimated_extent().</p></div><div class="simplesect" title="Other changes"><div class="titlepage"><div><div><h3 class="title"><a name="id287252471"></a>Other changes</h3></div></div></div><p>Small build scripts and utilities refinements.</p><p>Additional performance tips documented.</p></div></div><div class="sect1" title="A.32. Release 1.0.0RC4"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id287252486"></a>A.32. Release 1.0.0RC4</h2></div></div></div><p>Release date: 2005/03/18</p><p>Fourth release candidate for 1.0.0. Contains bug fixes and a few
      improvements.</p><div class="simplesect" title="Upgrading"><div class="titlepage"><div><div><h3 class="title"><a name="id287252498"></a>Upgrading</h3></div></div></div><p>You need a dump/reload to upgrade from precedent releases. See
        the <a class="link" href="#upgrading" title="2.9. アップグレード">upgrading</a> chapter for more
        informations.</p></div><div class="simplesect" title="Library changes"><div class="titlepage"><div><div><h3 class="title"><a name="id287252512"></a>Library changes</h3></div></div></div><p>BUGFIX (segfaulting) in geom_accum().</p><p>BUGFIX in 64bit architectures support.</p><p>BUGFIX in box3d computation function with collections.</p><p>NEW subselects support in selectivity estimator.</p><p>Early return from force_collection.</p><p>Consistency check fix in SnapToGrid().</p><p>Box2d output changed back to 15 significant digits.</p></div><div class="simplesect" title="Scripts changes"><div class="titlepage"><div><div><h3 class="title"><a name="id287252540"></a>Scripts changes</h3></div></div></div><p>NEW distance_sphere() function.</p><p>Changed get_proj4_from_srid implementation to use PL/PGSQL
        instead of SQL.</p></div><div class="simplesect" title="Other changes"><div class="titlepage"><div><div><h3 class="title"><a name="id287252554"></a>Other changes</h3></div></div></div><p>BUGFIX in loader and dumper handling of MultiLine shapes</p><p>BUGFIX in loader, skipping all but first hole of
        polygons.</p><p>jdbc2: code cleanups, Makefile improvements</p><p>FLEX and YACC variables set *after* pgsql Makefile.global is
        included and only if the pgsql *stripped* version evaluates to the
        empty string</p><p>Added already generated parser in release</p><p>Build scripts refinements</p><p>improved version handling, central Version.config</p><p>improvements in postgis_restore.pl</p></div></div><div class="sect1" title="A.33. Release 1.0.0RC3"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id287252587"></a>A.33. Release 1.0.0RC3</h2></div></div></div><p>Release date: 2005/02/24</p><p>Third release candidate for 1.0.0. Contains many bug fixes and
      improvements.</p><div class="simplesect" title="Upgrading"><div class="titlepage"><div><div><h3 class="title"><a name="id287252599"></a>Upgrading</h3></div></div></div><p>You need a dump/reload to upgrade from precedent releases. See
        the <a class="link" href="#upgrading" title="2.9. アップグレード">upgrading</a> chapter for more
        informations.</p></div><div class="simplesect" title="Library changes"><div class="titlepage"><div><div><h3 class="title"><a name="id287252613"></a>Library changes</h3></div></div></div><p>BUGFIX in transform(): missing SRID, better error
        handling.</p><p>BUGFIX in memory alignment handling</p><p>BUGFIX in force_collection() causing mapserver connector
        failures on simple (single) geometry types.</p><p>BUGFIX in GeometryFromText() missing to add a bbox cache.</p><p>reduced precision of box2d output.</p><p>prefixed DEBUG macros with PGIS_ to avoid clash with pgsql
        one</p><p>plugged a leak in GEOS2POSTGIS converter</p><p>Reduced memory usage by early releasing query-context palloced
        one.</p></div><div class="simplesect" title="Scripts changes"><div class="titlepage"><div><div><h3 class="title"><a name="id287252646"></a>Scripts changes</h3></div></div></div><p>BUGFIX in 72 index bindings.</p><p>BUGFIX in probe_geometry_columns() to work with PG72 and support
        multiple geometry columns in a single table</p><p>NEW bool::text cast</p><p>Some functions made IMMUTABLE from STABLE, for performance
        improvement.</p></div><div class="simplesect" title="JDBC changes"><div class="titlepage"><div><div><h3 class="title"><a name="id287252666"></a>JDBC changes</h3></div></div></div><p>jdbc2: small patches, box2d/3d tests, revised docs and
        license.</p><p>jdbc2: bug fix and testcase in for pgjdbc 8.0 type
        autoregistration</p><p>jdbc2: Removed use of jdk1.4 only features to enable build with
        older jdk releases.</p><p>jdbc2: Added support for building against pg72jdbc2.jar</p><p>jdbc2: updated and cleaned makefile</p><p>jdbc2: added BETA support for jts geometry classes</p><p>jdbc2: Skip known-to-fail tests against older PostGIS
        servers.</p><p>jdbc2: Fixed handling of measured geometries in EWKT.</p></div><div class="simplesect" title="Other changes"><div class="titlepage"><div><div><h3 class="title"><a name="id287252699"></a>Other changes</h3></div></div></div><p>new performance tips chapter in manual</p><p>documentation updates: pgsql72 requirement, lwpostgis.sql</p><p>few changes in autoconf</p><p>BUILDDATE extraction made more portable</p><p>fixed spatial_ref_sys.sql to avoid vacuuming the whole
        database.</p><p>spatial_ref_sys: changed Paris entries to match the ones
        distributed with 0.x.</p></div></div><div class="sect1" title="A.34. Release 1.0.0RC2"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id287252726"></a>A.34. Release 1.0.0RC2</h2></div></div></div><p>Release date: 2005/01/26</p><p>Second release candidate for 1.0.0 containing bug fixes and a few
      improvements.</p><div class="simplesect" title="Upgrading"><div class="titlepage"><div><div><h3 class="title"><a name="id287252738"></a>Upgrading</h3></div></div></div><p>You need a dump/reload to upgrade from precedent releases. See
        the <a class="link" href="#upgrading" title="2.9. アップグレード">upgrading</a> chapter for more
        informations.</p></div><div class="simplesect" title="Library changes"><div class="titlepage"><div><div><h3 class="title"><a name="id287252752"></a>Library changes</h3></div></div></div><p>BUGFIX in pointarray box3d computation</p><p>BUGFIX in distance_spheroid definition</p><p>BUGFIX in transform() missing to update bbox cache</p><p>NEW jdbc driver (jdbc2)</p><p>GEOMETRYCOLLECTION(EMPTY) syntax support for backward
        compatibility</p><p>Faster binary outputs</p><p>Stricter OGC WKB/WKT constructors</p></div><div class="simplesect" title="Scripts changes"><div class="titlepage"><div><div><h3 class="title"><a name="id287252781"></a>Scripts changes</h3></div></div></div><p>More correct STABLE, IMMUTABLE, STRICT uses in
        lwpostgis.sql</p><p>stricter OGC WKB/WKT constructors</p></div><div class="simplesect" title="Other changes"><div class="titlepage"><div><div><h3 class="title"><a name="id287252794"></a>Other changes</h3></div></div></div><p>Faster and more robust loader (both i18n and not)</p><p>Initial autoconf script</p></div></div><div class="sect1" title="A.35. Release 1.0.0RC1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id287252808"></a>A.35. Release 1.0.0RC1</h2></div></div></div><p>Release date: 2005/01/13</p><p>This is the first candidate of a major postgis release, with
      internal storage of postgis types redesigned to be smaller and faster on
      indexed queries.</p><div class="simplesect" title="Upgrading"><div class="titlepage"><div><div><h3 class="title"><a name="id287252820"></a>Upgrading</h3></div></div></div><p>You need a dump/reload to upgrade from precedent releases. See
        the <a class="link" href="#upgrading" title="2.9. アップグレード">upgrading</a> chapter for more
        informations.</p></div><div class="simplesect" title="Changes"><div class="titlepage"><div><div><h3 class="title"><a name="id287253005"></a>Changes</h3></div></div></div><p>Faster canonical input parsing.</p><p>Lossless canonical output.</p><p>EWKB Canonical binary IO with PG&gt;73.</p><p>Support for up to 4d coordinates, providing lossless
        shapefile-&gt;postgis-&gt;shapefile conversion.</p><p>New function: UpdateGeometrySRID(), AsGML(), SnapToGrid(),
        ForceRHR(), estimated_extent(), accum().</p><p>Vertical positioning indexed operators.</p><p>JOIN selectivity function.</p><p>More geometry constructors / editors.</p><p>PostGIS extension API.</p><p>UTF8 support in loader.</p></div></div></div><div class="appendix" title="付録B 日本語訳に関する追加情報"><div class="titlepage"><div><div><h2 class="title"><a name="japanese_appendix"></a>付録B 日本語訳に関する追加情報</h2></div></div></div><div class="toc"><p><b>目次</b></p><dl><dt><span class="sect1"><a href="#intersects_and_crosses">B.1. 「インタセクト」と「クロス」</a></span></dt><dt><span class="sect1"><a href="#srs_in_japan">B.2. 空間参照系等について</a></span></dt><dd><dl><dt><span class="sect2"><a href="#wellused_srs_in_japan">B.2.1. わが国でよく使われる空間参照系</a></span></dt><dt><span class="sect2"><a href="#geod_in_japan">B.2.2. 測地系</a></span></dt><dt><span class="sect2"><a href="#utm_in_japan">B.2.3. UTM</a></span></dt><dt><span class="sect2"><a href="#jpr">B.2.4. 平面直角座標系</a></span></dt></dl></dd><dt><span class="sect1"><a href="#problem_tokyodatum">B.3. 日本測地系から投影変換する場合の問題点</a></span></dt><dd><dl><dt><span class="sect2"><a href="#id287254425">B.3.1. Proj.4で問題点を見る</a></span></dt><dt><span class="sect2"><a href="#id287254461">B.3.2. PostGISでの問題回避</a></span></dt></dl></dd><dt><span class="sect1"><a href="#with_sjis">B.4. Shift JIS系文字コードについて</a></span></dt></dl></div><div class="sect1" title="B.1. 「インタセクト」と「クロス」"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="intersects_and_crosses"></a>B.1. 「インタセクト」と「クロス」</h2></div></div></div><p>intersectとcrossは、両方とも日本語では「交差」と言われます。違いを明確にするために、インタセクト(動詞)またはインタセクション(名詞)、クロス(動詞/名詞)と表現しています。</p><p>インタセクト(intersect)は「共有部分を持つ」もので、次元等は関係ありません。</p><p>クロス(cross)は、「共通部分を持ち、共通部分の次元は引数ジオメトリの最大次元より低い」ものです。なお、ここで言う次元は、面、線、点の区別です。</p><p>たとえば、面/面のクロスは線または点です。共通部分が面の場合は、クロスしているとは言いません。</p><p>また、線/線のクロスは必ず点です。共通部分が線の場合は、クロスしているとは言いません。</p></div><div class="sect1" title="B.2. 空間参照系等について"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="srs_in_japan"></a>B.2. 空間参照系等について</h2></div></div></div><div class="toc"><dl><dt><span class="sect2"><a href="#wellused_srs_in_japan">B.2.1. わが国でよく使われる空間参照系</a></span></dt><dt><span class="sect2"><a href="#geod_in_japan">B.2.2. 測地系</a></span></dt><dt><span class="sect2"><a href="#utm_in_japan">B.2.3. UTM</a></span></dt><dt><span class="sect2"><a href="#jpr">B.2.4. 平面直角座標系</a></span></dt></dl></div><p>しばしば「マサチューセッツ州」の空間参照系が出てきますが、わが国では使われません。わが国でよく使われる空間参照系および若干の説明を以下に記載します。</p><div class="sect2" title="B.2.1. わが国でよく使われる空間参照系"><div class="titlepage"><div><div><h3 class="title"><a name="wellused_srs_in_japan"></a>B.2.1. わが国でよく使われる空間参照系</h3></div></div></div><p>わが国では、次の空間参照系がよく使われます。</p><p>
            </p><div class="informaltable"><table border="1"><colgroup><col><col></colgroup><thead><tr><th>EPSGコード</th><th>名称等</th></tr></thead><tbody><tr><td>4326</td><td>WGS84 経度緯度</td></tr><tr><td>4612</td><td>世界測地系 経度緯度</td></tr><tr><td>2443-2461</td><td>世界測地系 平面直角座標系(I系-XIX系)</td></tr><tr><td>3097-3101</td><td>世界測地系 UTM(ゾーン51-55)</td></tr><tr><td>4301</td><td>日本測地系 経度緯度</td></tr><tr><td>30161-30179</td><td>日本測地系 平面直角座標系(I系-XIX系)</td></tr><tr><td>3092-3096</td><td>日本測地系 UTM(ゾーン51-55)</td></tr></tbody></table></div><p>
          </p></div><div class="sect2" title="B.2.2. 測地系"><div class="titlepage"><div><div><h3 class="title"><a name="geod_in_japan"></a>B.2.2. 測地系</h3></div></div></div><p>日本測地系は2002年3月31日まで使用されていたものです。世界測地系は現在使用されているものです。WGS84は米軍がGPS用に管理している測地系です。</p><p>世界測地系とWGS84とはあまり差がなく、メートル単位の誤差を許容する場合には、そのまま使用しても差し支えない程度です。</p><p>世界測地系と日本測地系は、投影変換を要します。</p></div><div class="sect2" title="B.2.3. UTM"><div class="titlepage"><div><div><h3 class="title"><a name="utm_in_japan"></a>B.2.3. UTM</h3></div></div></div><p>UTMは、1万分の1 から 20万分の1 の地形図に用いられます。ゾーンは地球全体を経度6度ごとにゾーンを定めています。よってゾーン番号は経度で決まります。ゾーン番号と経度範囲の関係は次の通りです。</p><p>
            </p><div class="informaltable"><table border="1"><colgroup><col><col></colgroup><thead><tr><th>ゾーン番号</th><th>経度範囲</th></tr></thead><tbody><tr><td>51</td><td>東経120度 から 東経126度</td></tr><tr><td>52</td><td>東経126度 から 東経132度</td></tr><tr><td>53</td><td>東経132度 から 東経138度</td></tr><tr><td>54</td><td>東経138度 から 東経144度</td></tr><tr><td>55</td><td>東経144度 から 東経150度</td></tr></tbody></table></div><p>
          </p><p>ゾーンをまたぐ場合は、通常は、より広くインタセクトしている方のゾーンを用います。</p></div><div class="sect2" title="B.2.4. 平面直角座標系"><div class="titlepage"><div><div><h3 class="title"><a name="jpr"></a>B.2.4. 平面直角座標系</h3></div></div></div><p>平面直角座標系は、1万分の1 よりも大縮尺(詳細)の地図に用いられます。国内陸域を19個の系に分けています。概ね1つの系に対して複数の都府県が対応し、都府県が複数の系に分かれることは少ないですが、離島部を持つ都県は複数の系をまたぎますし、北海道は3つの系に分かれています。</p><p>詳細については<a class="ulink" href="http://www.gsi.go.jp/LAW/heimencho.html" target="_top">平面直角座標系(平成14年国土交通省告示第9号)</a>(国土地理院サイト)をご覧ください。</p><p>また、<a class="ulink" href="http://www.finds.jp/pinfo/index.html" target="_top">地図関連情報ガジェット</a>(Finds.jp)にて、系番号を簡易的に確認できます。</p></div></div><div class="sect1" title="B.3. 日本測地系から投影変換する場合の問題点"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="problem_tokyodatum"></a>B.3. 日本測地系から投影変換する場合の問題点</h2></div></div></div><div class="toc"><dl><dt><span class="sect2"><a href="#id287254425">B.3.1. Proj.4で問題点を見る</a></span></dt><dt><span class="sect2"><a href="#id287254461">B.3.2. PostGISでの問題回避</a></span></dt></dl></div><p>日本測地系と他の測地系を一緒に扱う必要がある場合には、日本測地系に関連する投影変換パラメータに問題があるので、注意が必要です。</p><p>日本測地系からWGS84や世界測地系等に変換するに際には、準拠回転楕円体情報のほか、中心位置のシフトや回転等のパラメータを渡す必要があります。Proj.4のパラメータファイルには、シフトや回転等については指定されていません。 PostGISを含む、Proj.4をもとにして作成されているソフトウェアは、基本的にこの問題の影響を受けます。また、PostGISの<code class="varname">spatial_ref_sys</code>テーブルは、Proj.4の設定ファイルを基にしています。 </p><div class="sect2" title="B.3.1. Proj.4で問題点を見る"><div class="titlepage"><div><div><h3 class="title"><a name="id287254425"></a>B.3.1. Proj.4で問題点を見る</h3></div></div></div><p>ご注意: PostGISで投影変換を行う場合には、空間データベースにある<code class="varname">spatial_ref_sys</code>を更新しなければなりません。 </p><pre class="programlisting"># Tokyo
&lt;4301&gt; +proj=longlat +ellps=bessel +no_defs &lt;&gt;</pre><p>なお、+no_defsは、デフォルトファイルを読み込まないことを指示しています。このエントリの記述通りに動作することを保障するために必要です。
          </p><p>&lt;&gt;(終端文字列)より前に、たとえば、+towgs84=-146.336,506.832,680.254,0,0,0,0を挿入します。 次のようになります。</p>

<div class="note" title="注記" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top">
<p>(2013年5月24日 追記) 2.xでは -148,507,685,0,0,0,0 が既に入れられています。</p>
<p>パラメータには、いくつかのバリエーションがあります。</p>
</td></tr></table></div>

<pre class="programlisting"># Tokyo
&lt;4301&gt; +proj=longlat +ellps=bessel +towgs84=-146.336,506.832,680.254,0,0,0,0 +no_defs &lt;&gt;</pre><p>4301のほか、30161-30179, 3092-3096についても同じように改訂することで、数メートル程度の誤差に収まるようになります。ただし、なお誤差を含みますので、十分にご注意ください。</p></div><div class="sect2" title="B.3.2. PostGISでの問題回避"><div class="titlepage"><div><div><h3 class="title"><a name="id287254461"></a>B.3.2. PostGISでの問題回避</h3></div></div></div><p><code class="varname">spatial_ref_sys</code>の中身を見てみましょう。</p><pre class="programlisting">select ST_AsEWKT(ST_Transform('SRID=4612;POINT(135 35)'::geometry,4301));
        st_asewkt        
-------------------------
 SRID=4301;POINT(135 35)
(1 row)</pre><p>proj4textを更新すると、変換結果が変わります。</p><pre class="programlisting">db=# UPDATE spatial_ref_sys SET proj4text='+proj=longlat +ellps=bessel +towgs84=-146.336,506.832,680.254,0,0,0,0 +no_defs' WHERE srid=4301;
UPDATE 1

db=# select ST_AsEWKT(ST_Transform('SRID=4612;POINT(135 35)'::geometry,4301));
                     st_asewkt                      
----------------------------------------------------
 SRID=4301;POINT(135.002792603664 34.9968021008188)
(1 row)</pre></div></div><div class="sect1" title="B.4. Shift JIS系文字コードについて"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="with_sjis"></a>B.4. Shift JIS系文字コードについて</h2></div></div></div><p>コンフィギュレーション時にlibiconvを使用するようにした場合には，shp2pgsqlコマンドで-Wオプションを使用できるようになります．このオプションよって，SQLデータに変換する際に，文字コード変換を併せて行うことができます(<a class="xref" href="#shp2pgsql_usage" title="4.4.2. ローダを使う">「ローダを使う」</a>を参照して下さい)．</p><p>国内の地理空間データでは，伝統的にShift JIS系の文字セットがよく使われています．ただし，Shift JISそのものでは，地名に使用される文字で対応し切れず，適正なSQLが出力されないことがあります．</p><p>実際には，Shift JISをもとにして独自文字を持つ"cp932"が主に使われています．cp932とShift JISとは，iconvでは異なるものとされています．iconvコマンドがインストールされているなら，次のように文字コード一覧を表示させてみて下さい．</p><pre class="programlisting">% iconv --list
...
MS_KANJI SHIFT-JIS SHIFT_JIS SJIS CSSHIFTJIS
CP932
...</pre><p>shp2pgsqlは，たとえば次のように使用します．</p><pre class="programlisting">% shp2pgsql -W cp932 -D -i -I foo.shp tablename &gt; foo.sql</pre></div></div></div></body></html>
