<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>ST_Subdivide</title><link rel="stylesheet" type="text/css" href="docbook.css"><link rel="stylesheet" type="text/css" href="style.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><link rel="home" href="index.html" title="PostGIS 3.3.0 マニュアル"><link rel="up" href="reference.html#Overlay_Functions" title="8.13. 重ね合わせ関数"><link rel="prev" href="ST_Split.html" title="ST_Split"><link rel="next" href="ST_SymDifference.html" title="ST_SymDifference"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">ST_Subdivide</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ST_Split.html">Prev</a> </td><th width="60%" align="center">8.13. 重ね合わせ関数</th><td width="20%" align="right"> <a accesskey="n" href="ST_SymDifference.html">Next</a></td></tr></table></div><div class="refentry"><a name="ST_Subdivide"></a><div class="titlepage"></div><div class="refnamediv"><h2>Name</h2><p>ST_Subdivide — ジオメトリの線の分割を計算します。</p></div><div class="refsynopsisdiv"><h2>Synopsis</h2><div class="funcsynopsis"><p><code class="funcdef">setof geometry <b class="fsfunc">ST_Subdivide</b>(</code>geometry <var class="pdparam">geom</var>, integer <var class="pdparam">max_vertices=256</var>, float8 <var class="pdparam">gridSize = -1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp65536464"></a><h2>説明</h2><p><code class="varname">geom</code>を直線で分割したジオメトリの集合を返します。個々の部分は<code class="code">max_vertices</code>以下の頂点になります。 </p><p><code class="code">max_vertices</code>は5以上でなければなりません。5点が閉じたボックスに必要だからです。<code class="code">gridSize</code>は固定精度空間での切り出しに指定できます (GEOS 3.9.0以上が必要)。 </p><p>ポリゴン内のポイントと他の空間演算は、通常ではインデックスが付いた細分化されたデータセットの方が速くなります。通常は分割したジオメトリのバウンディングボックスは元ジオメトリのものよりも小さい領域になるので、インデックスのクエリで「当たり」となる場合が少なくなります。インデックスの再チェックによって実行される空間演算で処理されるポイント数が少なくなるので、「当たり」の場合は速度が速くなります。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これは<a class="ulink" href="https://www.postgresql.org/docs/current/queries-table-expressions.html#QUERIES-TABLEFUNCTIONS" target="_top">集合を返す関数</a> (SRF)です。単一ジオメトリ値を含む行の集合を返します。SELECTリストまたはFROM節で、結果ジオメトリごとに一つのレコードとなる結果集合を生成できます。 </p></td></tr></table></div><p>GEOSモジュールで実現しています。</p><p>Availability: 2.2.0</p><p>Enhanced: 2.5.0 ポリゴン分割で存在するポイントを再利用して頂点数の最小値を8から5に変更。</p><p>Enhanced: 3.1.0 gridSizeパラメータを受け付けます。新機能を使うにはGEOS 3.9.0以上が必要です。</p></div><div class="refsection"><a name="idp65542224"></a><h2>例</h2><p><span class="bold"><strong>例:</strong></span> 個々のポリゴンが10頂点とならないようなポリゴンの分割と、個々に一意のIDの割り当て。 </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_subdivide01.png"><div class="caption"><p>最大10頂点での分割</p></div></div></div><pre class="programlisting">SELECT row_number() OVER() As rn, ST_AsText(geom) As wkt
    FROM (SELECT ST_SubDivide(
        'POLYGON((132 10,119 23,85 35,68 29,66 28,49 42,32 56,22 64,32 110,40 119,36 150,
        57 158,75 171,92 182,114 184,132 186,146 178,176 184,179 162,184 141,190 122,
        190 100,185 79,186 56,186 52,178 34,168 18,147 13,132 10))'::geometry,10))  AS f(geom);
</pre><pre class="screen">rn │                                                      wkt
────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────
  1 │ POLYGON((119 23,85 35,68 29,66 28,32 56,22 64,29.8260869565217 100,119 100,119 23))
  2 │ POLYGON((132 10,119 23,119 56,186 56,186 52,178 34,168 18,147 13,132 10))
  3 │ POLYGON((119 56,119 100,190 100,185 79,186 56,119 56))
  4 │ POLYGON((29.8260869565217 100,32 110,40 119,36 150,57 158,75 171,92 182,114 184,114 100,29.8260869565217 100))
  5 │ POLYGON((114 184,132 186,146 178,176 184,179 162,184 141,190 122,190 100,114 100,114 184))
  </pre><p><span class="bold"><strong>例:</strong></span> 長いジオグラフィのラインのST_Segmentize(geography, distance)による緻密化と、ST_Subdivideによるラインを8頂点の分割線への分割を行います。 </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_subdivide02.png"><div class="caption"><p>ラインの緻密化と分割。</p></div></div></div><pre class="programlisting">SELECT ST_AsText( ST_Subdivide(
            ST_Segmentize('LINESTRING(0 0, 85 85)'::geography,
                          1200000)::geometry,    8));
</pre><pre class="screen">LINESTRING(0 0,0.487578359029357 5.57659056746196,0.984542144675897 11.1527721155093,1.50101059639722 16.7281035483571,1.94532113630331 21.25)
LINESTRING(1.94532113630331 21.25,2.04869538062779 22.3020741387339,2.64204641967673 27.8740533545155,3.29994062412787 33.443216802941,4.04836719489742 39.0084282520239,4.59890468420694 42.5)
LINESTRING(4.59890468420694 42.5,4.92498503922732 44.5680389206321,5.98737409390639 50.1195229244701,7.3290919767674 55.6587646879025,8.79638749938413 60.1969505994924)
LINESTRING(8.79638749938413 60.1969505994924,9.11375579533779 61.1785363177625,11.6558166691368 66.6648504160202,15.642041247655 72.0867690601745,22.8716627200212 77.3609628116894,24.6991785131552 77.8939011989848)
LINESTRING(24.6991785131552 77.8939011989848,39.4046096622744 82.1822848017636,44.7994523421035 82.5156766227011)
LINESTRING(44.7994523421035 82.5156766227011,85 85)
</pre><p><span class="bold"><strong>例:</strong></span> テーブルの適切な位置での複雑なジオメトリの分割。元のジオメトリのレコードはソーステーブルから削除され、分割された結果ジオメトリが代わりの新しいレコードになります。 </p><pre class="programlisting">WITH complex_areas_to_subdivide AS (
    DELETE from polygons_table
    WHERE ST_NPoints(geom) 
&gt; 255
    RETURNING id, column1, column2, column3, geom
)
INSERT INTO polygons_table (fid, column1, column2, column3, geom)
    SELECT fid, column1, column2, column3,
           ST_Subdivide(geom, 255) as geom
    FROM complex_areas_to_subdivide;
</pre><p><span class="bold"><strong>例:</strong></span> 分割されたジオメトリを持つ新しいテーブルを作ります。元のジオメトリのキーを保持して、新しいテーブルは元のテーブルと結合できます。ST_Subdivideは集合を返す関数で、行は単一の値を持つものですので、この構文で、結果の部分ごとに一つの行となるテーブルが自動的に生成されます。 </p><pre class="programlisting">CREATE TABLE subdivided_geoms AS
    SELECT pkey, ST_Subdivide(geom) AS geom
    FROM original_geoms;
</pre></div><div class="refsection"><a name="idp65582160"></a><h2>関連情報</h2><p><a class="xref" href="ST_AsText.html" title="ST_AsText">ST_AsText</a>, <a class="xref" href="ST_ClipByBox2D.html" title="ST_ClipByBox2D">ST_ClipByBox2D</a>, <a class="xref" href="ST_Segmentize.html" title="ST_Segmentize">ST_Segmentize</a>, <a class="xref" href="ST_Split.html" title="ST_Split">ST_Split</a>, <a class="xref" href="ST_NPoints.html" title="ST_NPoints">ST_NPoints</a> </p></div></div><div class="navfooter"><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ST_Split.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="reference.html#Overlay_Functions">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="ST_SymDifference.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">ST_Split </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> ST_SymDifference</td></tr></table></div></body></html>
