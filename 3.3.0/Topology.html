<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Chapter 10. トポロジ</title><link rel="stylesheet" type="text/css" href="docbook.css"><link rel="stylesheet" type="text/css" href="style.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><link rel="home" href="index.html" title="PostGIS 3.3.0 マニュアル"><link rel="up" href="index.html" title="PostGIS 3.3.0 マニュアル"><link rel="prev" href="PostGIS_FAQ.html" title="Chapter 9. PostGIS よくある質問"><link rel="next" href="getfaceedges_returntype.html" title="getfaceedges_returntype"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 10. トポロジ</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="PostGIS_FAQ.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="getfaceedges_returntype.html">Next</a></td></tr></table></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="Topology"></a>Chapter 10. トポロジ</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="sect1"><a href="Topology.html#Topology_Types">10.1. トポロジ型</a></span></dt><dt><span class="sect1"><a href="Topology.html#Topology_Domains">10.2. トポロジドメイン</a></span></dt><dt><span class="sect1"><a href="Topology.html#Topology_ManagementFunctions">10.3. トポロジ管理とTopoGeometry管理</a></span></dt><dt><span class="sect1"><a href="Topology.html#Topology_StatsManagement">10.4. トポロジ統計管理</a></span></dt><dt><span class="sect1"><a href="Topology.html#Topology_Constructors">10.5. トポロジコンストラクタ</a></span></dt><dt><span class="sect1"><a href="Topology.html#Topology_Editing">10.6. トポロジエディタ</a></span></dt><dt><span class="sect1"><a href="Topology.html#Topology_Accessors">10.7. トポロジアクセサ</a></span></dt><dt><span class="sect1"><a href="Topology.html#Topology_Processing">10.8. トポロジ処理</a></span></dt><dt><span class="sect1"><a href="Topology.html#TopoGeometry_Constructors">10.9. TopoGeometryコンストラクタ</a></span></dt><dt><span class="sect1"><a href="Topology.html#TopoGeometry_Editors">10.10. TopoGeometryエディタ</a></span></dt><dt><span class="sect1"><a href="Topology.html#TopoGeom_Accessors">10.11. TopoGeometryアクセサ</a></span></dt><dt><span class="sect1"><a href="Topology.html#TopoGeometry_Outputs">10.12. TopoGeometry出力</a></span></dt><dt><span class="sect1"><a href="Topology.html#Topology_Relationships">10.13. トポロジ空間関係関数</a></span></dt><dt><span class="sect1"><a href="Topology.html#Topology_Import_Export">10.14. トポロジのインポートとエクスポート</a></span></dt><dd><dl><dt><span class="sect2"><a href="Topology.html#pgtopo_export">10.14.1. トポロジエクスポータの使用</a></span></dt><dt><span class="sect2"><a href="Topology.html#pgtopo_import">10.14.2. トポロジインポータの使用</a></span></dt></dl></dd></dl></div><p>PostGISトポロジ型と関数は、フェイス、エッジ、ノード等のトロポジオブジェクトを管理するために使います。 </p><p>PostGIS Day Paris 2011におけるSandro Santilliさんの講演が、PostGISトポロジの概略説明として良いです。<a class="ulink" href="http://strk.keybit.net/projects/postgis/Paris2011_TopologyWithPostGIS_2_0.pdf" target="_top">Topology with PostGIS 2.0 slide deck</a>にあります。</p><p>Vincent Picavetさんはトポロジとは何か、どのように使われるか、および、対応するFOSS4Gツールに関する良い概略説明を<a class="ulink" href="https://gitlab.com/Oslandia/documentation/presentations/-/blob/master/2012/pgconf_eu_2012/pgconfeu2012_vincent_picavet_postgis_topology.pdf" target="_top">PostGIS Topology PGConf EU 2012</a>で出しています。 </p><p>トポロジベースのGISデータベースの例として<a class="ulink" href="https://www.census.gov/geo/maps-data/data/tiger.html" target="_top">US Census Topologically Integrated Geographic Encoding and Referencing System (TIGER)</a>があります。PostGISトポロジの試験がしたくて、何らかのデータが必要なら<a class="xref" href="Topology_Load_Tiger.html" title="Topology_Load_Tiger">Topology_Load_Tiger</a>をご覧下さい。</p><p>PostGISトポロジモジュールは前の版にもありましたが、正式なPostGIS文書の中には入れていませんでした。PostGIS 2.0.0 では、全ての非推奨関数を無くし、知られていた使いやすさの問題を解決し、機能と関数の文書をより良くし、新しい関数を追加し、SQL-MM標準により準拠させるために、大整理を行っています。</p><p>このプロジェクトの詳細情報は<a class="ulink" href="http://trac.osgeo.org/postgis/wiki/UsersWikiPostgisTopology" target="_top">PostGIS Topology Wiki</a>にあります。</p><p>このモジュールに関する全ての関数とテーブルは、<code class="varname">topology</code>スキーマにインストールされます。</p><p>SQL/MM標準で定義される関数はST_プリフィクスを持ち、PostGIS特有の関数はこのプリフィクスを持ちません。</p><p>PostGIS 2.0以降では、トポロジ機能はデフォルトでビルドされます。<a class="xref" href="postgis_installation.html" title="Chapter 2. PostGISインストール">Chapter 2, <i>PostGISインストール</i></a>で説明されている通り、ビルド時のコンフィギュアオプション --without-topology を指定することで、無効にできます。</p><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Topology_Types"></a>10.1. トポロジ型</h2></div><div><div class="abstract"><div class="abstract-title">Abstract</div><p>本節では、PostGISトポロジでインストールされるPostgreSQLデータ型の一覧を挙げます。独自に関数をデザインする際に特に重要となる、キャストでの挙動を記述していることにご注意ください。 </p></div></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="getfaceedges_returntype.html">getfaceedges_returntype</a></span><span class="refpurpose"> — 順序番号とエッジ番号で構成される複合型。 </span></dt><dt><span class="refentrytitle"><a href="topogeometry.html">TopoGeometry</a></span><span class="refpurpose"> — トポロジとして定義されたジオメトリを表現する型です。</span></dt><dt><span class="refentrytitle"><a href="validatetopology_returntype.html">validatetopology_returntype</a></span><span class="refpurpose"> — エラーメッセージとエラーの場所を示すid1とid2からなる複合型です。これは<code class="varname">ValidateTopology</code>が返す型です。</span></dt></dl></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Topology_Domains"></a>10.2. トポロジドメイン</h2></div><div><div class="abstract"><div class="abstract-title">Abstract</div><p>本節では、PostGISトポロジでインストールされるPostgreSQLドメインの一覧を挙げます。ドメインは、オブジェクト型のように扱え、関数やテーブルカラムのオブジェクトを返します。ドメインは存在するチェック制約を持つ既存の型である点で、型とは違います。 </p></div></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="topoelement.html">TopoElement</a></span><span class="refpurpose"> — 二つの整数の配列で、通常TopoGeometry要素を識別するために使われます。</span></dt><dt><span class="refentrytitle"><a href="topoelementarray.html">TopoElementArray</a></span><span class="refpurpose"> — TopoElementオブジェクトの配列。</span></dt></dl></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Topology_ManagementFunctions"></a>10.3. トポロジ管理とTopoGeometry管理</h2></div><div><div class="abstract"><div class="abstract-title">Abstract</div><p>本節では、新しいトポロジスキーマの構築、トポロジの評価、TopoGeometryカラムの管理のためのトポロジ関数の一覧を挙げます。</p></div></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="AddTopoGeometryColumn.html">AddTopoGeometryColumn</a></span><span class="refpurpose"> — 既存のテーブルにTopoGeometryカラムを追加し、topology.layer内に新しいレイヤとして新しいカラムを登録して、新しい layer_id を返します。</span></dt><dt><span class="refentrytitle"><a href="DropTopology.html">DropTopology</a></span><span class="refpurpose"> — 使用上の注意: この関数によって、トポロジスキーマが削除され、topology.topologyテーブルからの参照が削除され、geometry_columnsテーブルから削除対象スキーマ内のテーブルへの参照が削除されます。</span></dt><dt><span class="refentrytitle"><a href="DropTopoGeometryColumn.html">DropTopoGeometryColumn</a></span><span class="refpurpose"> — <code class="varname">schema_name</code>で指定されたスキーマ内にある<code class="varname">table_name</code>で指定されたテーブルからTopoGeometryカラムを削除し、topology.layerテーブルにある登録を解除します。</span></dt><dt><span class="refentrytitle"><a href="Populate_Topology_Layer.html">Populate_Topology_Layer</a></span><span class="refpurpose"> — テーブルからメタデータを読み、topology.layerテーブルに不足しているものを追加します。</span></dt><dt><span class="refentrytitle"><a href="TopologySummary.html">TopologySummary</a></span><span class="refpurpose"> — トポロジ名を取り、トポロジ内のオブジェクトの型に関する概要の全体を提供します。</span></dt><dt><span class="refentrytitle"><a href="ValidateTopology.html">ValidateTopology</a></span><span class="refpurpose"> — トポロジの問題についての詳細を示すvalidatetopology_returntypeの集合を返します。</span></dt><dt><span class="refentrytitle"><a href="ValidateTopologyRelation.html">ValidateTopologyRelation</a></span><span class="refpurpose"> — 不正なトポロジ関係の行に関する情報を返します。</span></dt><dt><span class="refentrytitle"><a href="FindTopology.html">FindTopology</a></span><span class="refpurpose"> — 異なる方法でトポロジ行を返します。</span></dt><dt><span class="refentrytitle"><a href="FindLayer.html">FindLayer</a></span><span class="refpurpose"> — 様々な方法でtopology.layer行を返します。</span></dt></dl></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Topology_StatsManagement"></a>10.4. トポロジ統計管理</h2></div><div><div class="abstract"><div class="abstract-title">Abstract</div><p>本節では、トポロジ構築時のデータベース統計の管理について説明します。 </p></div></div></div></div><p>トポロジに要素を追加すると、そのトリガとして、分割されることになる既存のエッジを探索し、ノードを追加し、新しいラインでノードを作成するエッジを更新するために多数のデータベースクエリが発生します。このため、トポロジテーブル内のデータに関する統計情報が最新の状態になっているなら、統計情報を使うと便利です。 </p><p>PostGISトポロジーの追加や編集の関数は、自動的に統計情報を更新することはありません。トポロジにおいて逐次変更していては、統計情報の更新が過剰になるためです。処理は呼び出し元の義務となっています。 </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>autovacuumで更新された統計情報は、autovacuumプロセス完了前に始まったトランザクションからは見えないので、更新した統計情報を使うには、実行時間の長いトランザクションではANALYZE自体を実行する必要があります。 </p></td></tr></table></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Topology_Constructors"></a>10.5. トポロジコンストラクタ</h2></div><div><div class="abstract"><div class="abstract-title">Abstract</div><p>本節では、新しいトポロジを生成するトポロジ関数を挙げます。</p></div></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="CreateTopology.html">CreateTopology</a></span><span class="refpurpose"> — 新しいトポロジスキーマを生成し、新しいスキーマをtopology.topologyテーブルに登録します。</span></dt><dt><span class="refentrytitle"><a href="CopyTopology.html">CopyTopology</a></span><span class="refpurpose"> — トポロジ構造 (ノード、エッジ、フェイス、レイヤ、TopoGeometry)を複写します。</span></dt><dt><span class="refentrytitle"><a href="ST_InitTopoGeo.html">ST_InitTopoGeo</a></span><span class="refpurpose"> — 新しいトポロジスキーマを生成し、topology.topologyテーブルに新しいスキーマを登録し、処理の概要を表示します。</span></dt><dt><span class="refentrytitle"><a href="ST_CreateTopoGeo.html">ST_CreateTopoGeo</a></span><span class="refpurpose"> — 空のトポロジにジオメトリのコレクションを追加し、成否を示すメッセージを返します。  </span></dt><dt><span class="refentrytitle"><a href="TopoGeo_AddPoint.html">TopoGeo_AddPoint</a></span><span class="refpurpose"> — 許容差を使って既存のトポロジにポイントを追加し、可能ならエッジを分割します。 </span></dt><dt><span class="refentrytitle"><a href="TopoGeo_AddLineString.html">TopoGeo_AddLineString</a></span><span class="refpurpose"> — 許容差を使って既存のトポロジにラインストリングを追加し、可能ならエッジ/フェイスを分割します。エッジ識別番号を返します。</span></dt><dt><span class="refentrytitle"><a href="TopoGeo_AddPolygon.html">TopoGeo_AddPolygon</a></span><span class="refpurpose"> — 許容差を使って既存のトポロジにラインストリングを追加し、可能ならエッジ/フェイスを分割します。エッジ識別番号を返します。</span></dt></dl></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Topology_Editing"></a>10.6. トポロジエディタ</h2></div><div><div class="abstract"><div class="abstract-title">Abstract</div><p>本節では、エッジ、フェイス、ノードの追加、移動、削除、分割に関する関数を挙げます。本節の関数はすべてISO SQL/MMで定義されています。</p></div></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="ST_AddIsoNode.html">ST_AddIsoNode</a></span><span class="refpurpose"> — フェイスに孤立ノードを追加し、新しいノードの識別番号を返します。フェイスがNULLの場合でもノードは生成されます。</span></dt><dt><span class="refentrytitle"><a href="ST_AddIsoEdge.html">ST_AddIsoEdge</a></span><span class="refpurpose"> — <code class="varname">anode</code>と<code class="varname">anothernode</code>で指定される二つの既存孤立ノードを接続するトポロジに、ジオメトリ<code class="varname">alinestring</code>で定義される孤立エッジを追加し、新しいエッジの識別番号を返します。</span></dt><dt><span class="refentrytitle"><a href="ST_AddEdgeNewFaces.html">ST_AddEdgeNewFaces</a></span><span class="refpurpose"> — 新しいエッジを追加します。新しいエッジがフェイスを分割する場合には、もとのフェイスを削除して、分割した二つのフェイスに置き換えます。</span></dt><dt><span class="refentrytitle"><a href="ST_AddEdgeModFace.html">ST_AddEdgeModFace</a></span><span class="refpurpose"> — 新しいエッジを追加します。新しいエッジがフェイスを分割する場合には、もとのフェイスを編集し、一つのフェイスを追加します。</span></dt><dt><span class="refentrytitle"><a href="ST_RemEdgeNewFace.html">ST_RemEdgeNewFace</a></span><span class="refpurpose"> — エッジを削除し、消去対象エッジでフェイスが二つに分割されているなら元の二つのフェイスを削除し、一つの新しいフェイスに置き換えます。 </span></dt><dt><span class="refentrytitle"><a href="ST_RemEdgeModFace.html">ST_RemEdgeModFace</a></span><span class="refpurpose"> — エッジを削除し、削除対象エッジでフェイスが二つに分割されているなら、両方の空間をとるため、一つを削除して、もう一つを編集します。 </span></dt><dt><span class="refentrytitle"><a href="ST_ChangeEdgeGeom.html">ST_ChangeEdgeGeom</a></span><span class="refpurpose"> — トポロジ構造に影響を与えることなくエッジの形状を変更します。 </span></dt><dt><span class="refentrytitle"><a href="ST_ModEdgeSplit.html">ST_ModEdgeSplit</a></span><span class="refpurpose"> — 既存のエッジに沿って新しいノードを生成してエッジを分割します。もとのエッジは変更され、新しいエッジが一つ追加されます。</span></dt><dt><span class="refentrytitle"><a href="ST_ModEdgeHeal.html">ST_ModEdgeHeal</a></span><span class="refpurpose"> — 二つのエッジについて、接続しているノードを削除して修復します。1番目のエッジを編集して、2番目のエッジを削除します。削除されたノードの識別番号を返します。 </span></dt><dt><span class="refentrytitle"><a href="ST_NewEdgeHeal.html">ST_NewEdgeHeal</a></span><span class="refpurpose"> — 二つのエッジについて、接続しているノードを削除して修復します。両方のエッジを削除し、1番目のエッジと同じ方向のエッジに置き換えます。 </span></dt><dt><span class="refentrytitle"><a href="ST_MoveIsoNode.html">ST_MoveIsoNode</a></span><span class="refpurpose"> — トポロジ内の孤立ノードを別の位置に移動させます。新しい<code class="varname">apoint</code>ジオメトリがノードとして存在しているなら、エラーが投げられます。移動に関する説明を返します。</span></dt><dt><span class="refentrytitle"><a href="ST_NewEdgesSplit.html">ST_NewEdgesSplit</a></span><span class="refpurpose"> — 新しいノードを既存のエッジに沿って作成して、エッジを分割します。もとのエッジは削除され、二つのエッジに置き換えられます。二つの新しいエッジに接続する新しいノードの識別番号を返します。</span></dt><dt><span class="refentrytitle"><a href="ST_RemoveIsoNode.html">ST_RemoveIsoNode</a></span><span class="refpurpose"> — 孤立ノードを削除し、実行結果が返されます。ノードが孤立していない (エッジの始端または終端である)場合には、例外が投げられます。</span></dt><dt><span class="refentrytitle"><a href="ST_RemoveIsoEdge.html">ST_RemoveIsoEdge</a></span><span class="refpurpose"> — 孤立エッジを削除し、実行結果の記述を返します。エッジが孤立していない場合には、例外が投げられます。</span></dt></dl></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Topology_Accessors"></a>10.7. トポロジアクセサ</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="GetEdgeByPoint.html">GetEdgeByPoint</a></span><span class="refpurpose"> — 与えられたポイントにインタセクトするエッジの識別番号を探索します。</span></dt><dt><span class="refentrytitle"><a href="GetFaceByPoint.html">GetFaceByPoint</a></span><span class="refpurpose"> — 与えたポイントとインタセクトするフェイスを見つけます。</span></dt><dt><span class="refentrytitle"><a href="GetFaceContainingPoint.html">GetFaceContainingPoint</a></span><span class="refpurpose"> — ポイントを含むフェイスを見つけます。</span></dt><dt><span class="refentrytitle"><a href="GetNodeByPoint.html">GetNodeByPoint</a></span><span class="refpurpose"> — ポイント位置にあるノードの識別番号を探索します。</span></dt><dt><span class="refentrytitle"><a href="GetTopologyID.html">GetTopologyID</a></span><span class="refpurpose"> — トポロジ名からtopology.topologyテーブル内にあるトポロジの識別番号を返します。</span></dt><dt><span class="refentrytitle"><a href="GetTopologySRID.html">GetTopologySRID</a></span><span class="refpurpose"> — トポロジ名からtopology.topologyテーブル内にあるトポロジのSRIDを返します。</span></dt><dt><span class="refentrytitle"><a href="GetTopologyName.html">GetTopologyName</a></span><span class="refpurpose"> — 識別番号からトポロジ (スキーマ)の名前を返します。</span></dt><dt><span class="refentrytitle"><a href="ST_GetFaceEdges.html">ST_GetFaceEdges</a></span><span class="refpurpose"> — 順序番号を含む、<code class="varname">aface</code>の境界となる、整列したエッジの集合を返します。</span></dt><dt><span class="refentrytitle"><a href="ST_GetFaceGeometry.html">ST_GetFaceGeometry</a></span><span class="refpurpose"> — 指定されたトポロジの中の、フェイス識別番号で指定されたポリゴンを返します。</span></dt><dt><span class="refentrytitle"><a href="GetRingEdges.html">GetRingEdges</a></span><span class="refpurpose"> — 与えられた側を歩いて得られた、正負符号付きエッジ識別番号の集合を、順序通りに返します。 </span></dt><dt><span class="refentrytitle"><a href="GetNodeEdges.html">GetNodeEdges</a></span><span class="refpurpose"> — 与えられたノードに付随するエッジの集合を整列して返します。 </span></dt></dl></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Topology_Processing"></a>10.8. トポロジ処理</h2></div><div><div class="abstract"><div class="abstract-title">Abstract</div><p>本節では、非標準の手法でのトポロジ処理の関数を挙げます。</p></div></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="TopologyPolygonize.html">ポリゴン化</a></span><span class="refpurpose"> — トポロジエッジで定義される全てのフェイスを探索し、追加します。</span></dt><dt><span class="refentrytitle"><a href="AddNode.html">AddNode</a></span><span class="refpurpose"> — 指定したトポロジスキーマのノードテーブルにポイントノードを追加し、新しいノードの識別番号を返します。指定したポイントに既にノードがある場合は既存のノード識別番号を返します。</span></dt><dt><span class="refentrytitle"><a href="AddEdge.html">AddEdge</a></span><span class="refpurpose"> — 指定したラインストリングジオメトリを使って、ラインストリングエッジをエッジテーブルに追加し、指定したトポロジスキーマの始点終点をポイントノードテーブルに追加し、新しい (または既存の)エッジの識別番号を返します。</span></dt><dt><span class="refentrytitle"><a href="AddFace.html">AddFace</a></span><span class="refpurpose"> — フェイスプリミティブをトポロジに登録し、その識別番号を得ます。 </span></dt><dt><span class="refentrytitle"><a href="TP_ST_Simplify.html">ST_Simplify</a></span><span class="refpurpose"> — 与えたTopoGeometryを「シンプル化した」ジオメトリを返します。ダグラス-ポーカーのアルゴリズムを使います。</span></dt><dt><span class="refentrytitle"><a href="TP_RemoveUnusedPrimitives.html">RemoveUnusedPrimitives</a></span><span class="refpurpose"> — 存在するTopoGeometryオブジェクトを定義するのに必要でないトポロジプリミティブを削除します。</span></dt></dl></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="TopoGeometry_Constructors"></a>10.9. TopoGeometryコンストラクタ</h2></div><div><div class="abstract"><div class="abstract-title">Abstract</div><p>本節では、新しいTopoGeometryを生成するトポロジ関数を挙げます。</p></div></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="CreateTopoGeom.html">CreateTopoGeom</a></span><span class="refpurpose"> — 新しいTopoGeometryオブジェクトをtopoエレメント配列から生成します - tg_type: 1:[multi]point, 2:[multi]line, 3:[multi]poly, 4:collection</span></dt><dt><span class="refentrytitle"><a href="toTopoGeom.html">toTopoGeom</a></span><span class="refpurpose"> — 単純なジオメトリからTopoGeometryを生成します。</span></dt><dt><span class="refentrytitle"><a href="TopoElementArray_Agg.html">TopoElementArray_Agg</a></span><span class="refpurpose"> — element_idとタイプの配列 (topoelements)からなる<code class="varname">topoelementarray</code>を返します。</span></dt></dl></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="TopoGeometry_Editors"></a>10.10. TopoGeometryエディタ</h2></div><div><div class="abstract"><div class="abstract-title">Abstract</div><p>本節では、既存のTopoGeometryを編集する関数を挙げます。</p></div></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="clearTopoGeom.html">clearTopoGeom</a></span><span class="refpurpose"> — TopoGeometryの中身を消去します。</span></dt><dt><span class="refentrytitle"><a href="TopoGeom_addElement.html">TopoGeom_addElement</a></span><span class="refpurpose"> — TopoGeometryの定義に要素を追加します。</span></dt><dt><span class="refentrytitle"><a href="TopoGeom_remElement.html">TopoGeom_remElement</a></span><span class="refpurpose"> — TopoGeometryの定義から要素を削除します。</span></dt><dt><span class="refentrytitle"><a href="TopoGeom_addTopoGeom.html">TopoGeom_addTopoGeom</a></span><span class="refpurpose"> — TopoGeometryの要素を他のTopoGeometryの定義に追加します。</span></dt><dt><span class="refentrytitle"><a href="toTopoGeom_editor_proxy.html">toTopoGeom</a></span><span class="refpurpose"> — ジオメトリの形状を既存のTopoGeometryに追加します。</span></dt></dl></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="TopoGeom_Accessors"></a>10.11. TopoGeometryアクセサ</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="GetTopoGeomElementArray.html">GetTopoGeomElementArray</a></span><span class="refpurpose"> — 与えられたTopoGeometry (プリミティブ要素)のトポロジ要素とタイプを含む<code class="varname">topoelementarray</code> (topoelementの配列)を返します。</span></dt><dt><span class="refentrytitle"><a href="GetTopoGeomElements.html">GetTopoGeomElements</a></span><span class="refpurpose"> — 与えられたTopoGeometry (プリミティブ要素)の、トポロジのelement_idとelement_typeを含む<code class="varname">topoelement</code>オブジェクトの集合を返します。</span></dt><dt><span class="refentrytitle"><a href="TG_ST_SRID.html">ST_SRID</a></span><span class="refpurpose"> — TopoGeometryの空間参照識別子を返します。</span></dt></dl></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="TopoGeometry_Outputs"></a>10.12. TopoGeometry出力</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="AsGML.html">AsGML</a></span><span class="refpurpose"> — TopoGeometryのGML表現を返します。</span></dt><dt><span class="refentrytitle"><a href="AsTopoJSON.html">AsTopoJSON</a></span><span class="refpurpose"> — opoGeometryのTopoJSON表現を返します。</span></dt></dl></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Topology_Relationships"></a>10.13. トポロジ空間関係関数</h2></div><div><div class="abstract"><div class="abstract-title">Abstract</div><p>本節ではTopoGeometryとトポロジプリミティブとの間の関係を見るトポロジ関数の一覧を挙げます。</p></div></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="TG_Equals.html">Equals</a></span><span class="refpurpose"> — 二つのTopoGeometryが同じトポロジプリミティブで成っている場合にtrueを返します。</span></dt><dt><span class="refentrytitle"><a href="TG_Intersects.html">Intersects</a></span><span class="refpurpose"> — 二つのTopoGeometryからのプリミティブの組がインタセクトする場合にtrueを返します。</span></dt></dl></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Topology_Import_Export"></a>10.14. トポロジのインポートとエクスポート</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="Topology.html#pgtopo_export">10.14.1. トポロジエクスポータの使用</a></span></dt><dt><span class="sect2"><a href="Topology.html#pgtopo_import">10.14.2. トポロジインポータの使用</a></span></dt></dl></div><p>トポロジを生成したり、場合によってはトポロジレイヤに関連付けると、バックアップや他のデータベースへの転送のために、ファイルに出力するフォーマットでエクスポートした方がいいでしょう。 </p><p>トポロジはテーブルの集合 (プリミティブで4テーブル、レイヤで任意数)と、メタデータテーブルのレコード (topology.topologyとtopology.layer)になっているため、PostgreSQLの標準的なダンプ/レストアのツールでは問題があります。さらに、トポロジの識別子はデータベース間で同じではないため、トポロジのパラメータはレストア時に変更する必要があります。 </p><p>トポロジのエクスポート/レストアを簡単化するために、二つの実行可能ファイルが提供されています。<code class="filename">pgtopo_export</code>と<code class="filename">pgtopo_import</code>です。使用例は次の通りです。 </p><pre class="programlisting">pgtopo_export dev_db topo1 | pgtopo_import topo1 | psql staging_db
</pre><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="pgtopo_export"></a>10.14.1. トポロジエクスポータの使用</h3></div></div></div><p><code class="filename">pgtopo_export</code>スクリプトはデータベース名とトポロジ名を取り、トポロジ (と関連するレイヤ)を新しいデータベースにインポートするために使うことができるダンプファイルを出力します。 </p><p>デフォルトでは<code class="filename">pgtopo_export</code>はダンプファイルを標準出力に書くので、<code class="filename">pgtopo_import</code>にパイプで繋げたり、ファイルにリダイレクトする (端末への出力を止める)ことができます。出力ファイル名をコマンドラインスイッチ<code class="code">-f</code>で指定することもできます。 </p><p>デフォルトでは<code class="filename">pgtopo_export</code>は、指定されたトポロジに対して定義されたレイヤの全てのダンプが含まれます。これは、必要なデータより多い場合もありますし、動作しない場合もあり (レイヤテーブルが複雑な依存関係を持っている場合)、この場合には<code class="code">--skip-layers</code>スイッチでレイヤをスキップし、別々に処理することができます。 </p><p><code class="filename">pgtopo_export</code>を<code class="code">--help</code> (または短縮の<code class="code">-h</code>)スイッチで実行すると、常に短い使用法文字列を印字します。 </p><p>ダンプファイルフォーマットは、少なくともフォーマットバージョン情報を持つ<code class="filename">pgtopo_dump_version</code>ファイルを含む<code class="filename">pgtopo_export</code>ディレクトリの圧縮されたtarアーカイブです。バージョン<code class="code">1</code>では、ディレクトリにはトポロジのプリミティブテーブル (node, edge_data, face, relation)、トポロジと関連レイヤのデータを持つタブ区切りCSVファイルが含まれ、任意で(<code class="code">--skip-layers</code>が与えられない場合)与えられたトポロジのレイヤとして報告されたテーブルのPostgrfeSQLダンプのカスタムフォーマットも含まれます。 </p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="pgtopo_import"></a>10.14.2. トポロジインポータの使用</h3></div></div></div><p><code class="filename">pgtopo_import</code>スクリプトは<code class="code">pgtopo_export</code>書式のトポロジのダンプと、生成するトポロジに与える名前とを取り、そこからトポロジと関連するレイヤを再構築するSQLスクリプトを出力します。 </p><p>生成されたSQLには、与えられた名前でトポロジを生成し、プリミティブなデータをロードし、格納して、TopoGeometry値を確実に正しいトポロジに関連付けることで全てのトポロジレイヤを登録する手続きが含まれます。 </p><p>デフォルトでは<code class="filename">pgtopo_import</code>は標準入力からダンプを読むので、<code class="filename">pgtopo_export</code>をパイプで繋げて併用することができます。入力ファイル名をコマンドラインスイッチ<code class="code">-f</code>で指定することもできます。 </p><p>デフォルトでは<code class="filename">pgtopo_import</code>のSQLファイル出力には、ダンプで発見された全てのレイヤを格納するためのコードが含まれます。 </p><p>これらは、ダンプ内にあるテーブル名が既に対象データベース内のテーブル名で使われている場合には、望ましくないようになるか動作しない可能性があります。この場合には、レイヤをスキップする<code class="code">--skip-layers</code>スイッチを使い、別に (または後で)処理することができます。 </p><p>ロードして、レイヤを名前付きトポロジにリンクするSQLは<code class="code">--only-layers</code>スイッチで生成できます。これは、名前の競合を解決した*後に*レイヤをロードしたり、異なるトポロジのレイヤ (開始トポロジで空間的に単純化されたもの等が挙げられます)にリンクするのに使えます。 </p></div></div></div><div class="navfooter"><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="PostGIS_FAQ.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="getfaceedges_returntype.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter 9. PostGIS よくある質問 </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> getfaceedges_returntype</td></tr></table></div></body></html>
