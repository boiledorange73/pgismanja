<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Chapter 12. ラスタ リファレンス</title><link rel="stylesheet" type="text/css" href="docbook.css"><link rel="stylesheet" type="text/css" href="style.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><link rel="home" href="index.html" title="PostGIS 3.3.0 マニュアル"><link rel="up" href="index.html" title="PostGIS 3.3.0 マニュアル"><link rel="prev" href="using_raster_dataman.html" title="Chapter 11. ラスタデータの管理、クエリ、アプリケーション"><link rel="next" href="geomval.html" title="geomval"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 12. ラスタ リファレンス</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="using_raster_dataman.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="geomval.html">Next</a></td></tr></table></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="RT_reference"></a>Chapter 12. ラスタ リファレンス</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="sect1"><a href="RT_reference.html#Raster_Types">12.1. ラスタサポートデータ型</a></span></dt><dt><span class="sect1"><a href="RT_reference.html#Raster_Management_Functions">12.2. ラスタ管理</a></span></dt><dt><span class="sect1"><a href="RT_reference.html#Raster_Constructors">12.3. ラスタコンストラクタ</a></span></dt><dt><span class="sect1"><a href="RT_reference.html#Raster_Accessors">12.4. ラスタアクセサ</a></span></dt><dt><span class="sect1"><a href="RT_reference.html#RasterBand_Accessors">12.5. ラスタバンドアクセサ</a></span></dt><dt><span class="sect1"><a href="RT_reference.html#Raster_Pixel_Accessors">12.6. ラスタピクセルアクセサとセッター</a></span></dt><dt><span class="sect1"><a href="RT_reference.html#Raster_Editors">12.7. ラスタエディタ</a></span></dt><dt><span class="sect1"><a href="RT_reference.html#RasterBand_Editors">12.8. ラスタバンドエディタ</a></span></dt><dt><span class="sect1"><a href="RT_reference.html#RasterBand_Stats">12.9. ラスタバンド統計情報と解析</a></span></dt><dt><span class="sect1"><a href="RT_reference.html#Raster_Inputs">12.10. ラスタ入力</a></span></dt><dt><span class="sect1"><a href="RT_reference.html#Raster_Outputs">12.11. 出力</a></span></dt><dt><span class="sect1"><a href="RT_reference.html#Raster_Processing_MapAlgebra">12.12. ラスタ処理: 地図代数</a></span></dt><dt><span class="sect1"><a href="RT_reference.html#Raster_Processing_MapAlgebra_Callbacks">12.13. 組み込み地図代数コールバック関数</a></span></dt><dt><span class="sect1"><a href="RT_reference.html#Raster_Processing_DEM">12.14. ラスタ処理: DEM (標高)</a></span></dt><dt><span class="sect1"><a href="RT_reference.html#Raster_Processing_Geometry">12.15. ラスタ処理: ラスタからジオメトリ</a></span></dt><dt><span class="sect1"><a href="RT_reference.html#RT_Operators">12.16. ラスタ演算子</a></span></dt><dt><span class="sect1"><a href="RT_reference.html#Raster_Relationships">12.17. ラスタとラスタバンドの空間関係関数</a></span></dt><dt><span class="sect1"><a href="RT_reference.html#Raster_Tips">12.18. ラスタに関する技法</a></span></dt><dd><dl><dt><span class="sect2"><a href="RT_reference.html#outdb">12.18.1. データベース外ラスタ</a></span></dt></dl></dd></dl></div><p>ここで挙げる関数は、PostGISラスタにとって必要と思われるもので、現在PostGISラスタで有効なものです。他に、一般的なユーザが利用しない、ラスタオブジェクトに対して求められるサポート関数があります。</p><p><code class="varname">raster</code>は、ラスタデータの格納と分析のための新しいPostGIS型です。 </p><p>ラスタファイルからラスタをロードするには<a class="xref" href="using_raster_dataman.html#RT_Loading_Rasters" title="11.1. ラスタのロードと生成">Section 11.1, “ラスタのロードと生成”</a>を参照して下さい。</p><p>このリファレンスにおける例ではダミーラスタのラスタテーブルを使っています。ラスタは次のようなコードで形成しています。 </p><pre class="programlisting">CREATE TABLE dummy_rast(rid integer, rast raster);
INSERT INTO dummy_rast(rid, rast)
VALUES (1,
('01' -- little endian - リトルエンディアン (uint8 ndr)
||
'0000' -- version - 版 (uint16 0)
||
'0000' -- nBands - バンド数 (uint16 0)
||
'0000000000000040' -- scaleX - X方向セルサイズ (float64 2)
||
'0000000000000840' -- scaleY - Y方向セルサイズ (float64 3)
||
'000000000000E03F' -- ipX - 左上隅X値 (float64 0.5)
||
'000000000000E03F' -- ipY - 左上隅Y値 (float64 0.5)
||
'0000000000000000' -- skewX - スキューX (float64 0)
||
'0000000000000000' -- skewY - スキューY (float64 0)
||
'00000000' -- SRID (int32 0)
||
'0A00' -- width - 横セル数 (uint16 10)
||
'1400' -- height - 縦セル数 (uint16 20)
)::raster
),
-- Raster: 5 x 5 pixels, 3 bands, PT_8BUI pixel type, NODATA = 0
(2,  ('01000003009A9999999999A93F9A9999999999A9BF000000E02B274A' ||
'41000000007719564100000000000000000000000000000000FFFFFFFF050005000400FDFEFDFEFEFDFEFEFDF9FAFEF' ||
'EFCF9FBFDFEFEFDFCFAFEFEFE04004E627AADD16076B4F9FE6370A9F5FE59637AB0E54F58617087040046566487A1506CA2E3FA5A6CAFFBFE4D566DA4CB3E454C5665')::raster);</pre><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Raster_Types"></a>12.1. ラスタサポートデータ型</h2></div><div><div class="abstract"><div class="abstract-title">Abstract</div><p>本節では、ラスタ機能をサポートするために作られたPostgreSQLデータ型の一覧を挙げます。</p></div></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="geomval.html">geomval</a></span><span class="refpurpose"> — geom (ジオメトリオブジェクトを保持)とval (ラスタバンドからのピクセル値を倍精度浮動小数点数で保持)の2フィールドからなるデータ型。</span></dt><dt><span class="refentrytitle"><a href="addbandarg.html">addbandarg</a></span><span class="refpurpose"> — ST_AddBandの入力に使われる複合型で、新しいバンドの属性と初期値からなります。</span></dt><dt><span class="refentrytitle"><a href="rastbandarg.html">rastbandarg</a></span><span class="refpurpose"> — ラスタとそのバンドインデクスを表現する必要がある時に使われる複合型。</span></dt><dt><span class="refentrytitle"><a href="raster.html">raster</a></span><span class="refpurpose"> — ラスタ空間データ型。</span></dt><dt><span class="refentrytitle"><a href="reclassarg.html">reclassarg</a></span><span class="refpurpose"> — ST_Reclass関数への入力として使用する複合型です。再分類の挙動を定義します。</span></dt><dt><span class="refentrytitle"><a href="summarystats.html">summarystats</a></span><span class="refpurpose"> — ST_SummaryStats関数とST_SummaryStatsAgg関数の出力として使う複合型です。</span></dt><dt><span class="refentrytitle"><a href="unionarg.html">unionarg</a></span><span class="refpurpose"> — ST_Union関数の入力に使う複合型です。処理するバンドと結合処理の挙動を定義します。</span></dt></dl></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Raster_Management_Functions"></a>12.2. ラスタ管理</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="RT_AddRasterConstraints.html">AddRasterConstraints</a></span><span class="refpurpose"> — ロードされたラスタテーブルの特定のカラムにラスタ制約を追加します。制約には空間参照系、スケール、ブロックサイズ、アラインメント、バンド数、バンド型、ラスタカラムが規則正しいブロックかどうかを示すフラグがあります。テーブルは制約が推論されるためのデータがロードされなければなりません。制約の設定が完了するとtrueを返し、問題があると通知を返します。</span></dt><dt><span class="refentrytitle"><a href="RT_DropRasterConstraints.html">DropRasterConstraints</a></span><span class="refpurpose"> — ラスタテーブルカラムを参照するPostGISラスタ制約を削除します。データの再読み込みやラスタカラムデータの更新の際に使えます。</span></dt><dt><span class="refentrytitle"><a href="RT_AddOverviewConstraints.html">AddOverviewConstraints</a></span><span class="refpurpose"> — ラスタカラムに対して、他のオーバビューであることをタグ付けします。</span></dt><dt><span class="refentrytitle"><a href="RT_DropOverviewConstraints.html">DropOverviewConstraints</a></span><span class="refpurpose"> — ラスタカラムに対して他のオーバビューであることをタグ付けしているのを解除します。</span></dt><dt><span class="refentrytitle"><a href="RT_PostGIS_GDAL_Version.html">PostGIS_GDAL_Version</a></span><span class="refpurpose"> — PostGISで使っているGDALライブラリの版を報告します。</span></dt><dt><span class="refentrytitle"><a href="RT_PostGIS_Raster_Lib_Build_Date.html">PostGIS_Raster_Lib_Build_Date</a></span><span class="refpurpose"> — 完全なラスタライブラリをビルドした日付を報告します。</span></dt><dt><span class="refentrytitle"><a href="RT_PostGIS_Raster_Lib_Version.html">PostGIS_Raster_Lib_Version</a></span><span class="refpurpose"> — 完全なラスタの版とビルドコンフィギュレーション情報を報告します。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_GDALDrivers.html">ST_GDALDrivers</a></span><span class="refpurpose"> — 使用しているGDALライブラリが対応するラスタ書式の一覧を返します。この一覧でcan_write=TrueとなっているものだけがST_AsGDALRasterで使えます。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_Contour.html">ST_Contour</a></span><span class="refpurpose"> — 与えられたラスタバンドから等高線ベクタを生成します。GDAL等高線生成アルゴリズムを使います。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_InterpolateRaster.html">ST_InterpolateRaster</a></span><span class="refpurpose"> — X値とY値を使用してグリッド上のポイントを配置し、ポイントのZ値をサーフェス標高として配置し、3次元ポイントの入力セットに基づいてグリッドサーフェスを補間します。 </span></dt><dt><span class="refentrytitle"><a href="RT_UpdateRasterSRID.html">UpdateRasterSRID</a></span><span class="refpurpose"> — ユーザが指定したカラムとテーブルにあるラスタの全てについてSRIDを変更します。 </span></dt><dt><span class="refentrytitle"><a href="RT_CreateOverview.html">ST_CreateOverview</a></span><span class="refpurpose"> — 与えられたラスタカバレッジから解像度を落としたものを生成します。 </span></dt></dl></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Raster_Constructors"></a>12.3. ラスタコンストラクタ</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="RT_ST_AddBand.html">ST_AddBand</a></span><span class="refpurpose"> — 与えられたタイプで、与えられた初期値にした新しいバンドを、与えられたインデクス位置に追加したラスタを返します。インデクス位置を指定していない場合には、バンドは末尾に追加されます。 </span></dt><dt><span class="refentrytitle"><a href="RT_ST_AsRaster.html">ST_AsRaster</a></span><span class="refpurpose"> — PostGISジオメトリをPostGISラスタに変換します。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_Band.html">ST_Band</a></span><span class="refpurpose"> — 既存のラスタの、一つ以上のバンドを新しいラスタとして返します。既存のラスタから新しいラスタを構築する際に使えます。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_MakeEmptyCoverage.html">ST_MakeEmptyCoverage</a></span><span class="refpurpose"> — 空のラスタタイルのグリッドでジオリファレンスを施されている領域を生成します。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_MakeEmptyRaster.html">ST_MakeEmptyRaster</a></span><span class="refpurpose"> — 与えられたピクセル範囲 (width &amp; height)、左上のX,Y、ピクセルサイズ、回転 (scalex, scaley, skewx, skewy)と空間参照系 (srid)が指定された空ラスタ (バンドを持たないラスタ)を返します。ラスタが渡されると、新しいラスタは渡されたラスタと同じサイズ、アラインメント、SRIDになります。SRIDが指定されていない場合には、空間参照系は不明 (0)とされます。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_Tile.html">ST_Tile</a></span><span class="refpurpose"> — 求められた出力ラスタのピクセル数に基づいて入力ラスタを分割した結果のラスタ集合を返します。</span></dt><dt><span class="refentrytitle"><a href="RT_Retile.html">ST_Retile</a></span><span class="refpurpose"> — 任意のタイル化されたラスタカバレッジから構成されたタイルの集合を返します。 </span></dt><dt><span class="refentrytitle"><a href="RT_ST_FromGDALRaster.html">ST_FromGDALRaster</a></span><span class="refpurpose"> — 対応するGDALラスタファイルからラスタを返します。</span></dt></dl></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Raster_Accessors"></a>12.4. ラスタアクセサ</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="RT_ST_GeoReference.html">ST_GeoReference</a></span><span class="refpurpose"> — GDAL書式または一般的にワールドファイルでみられるESRI書式の地理参照メタデータを返します。デフォルトはGDALです。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_Height.html">ST_Height</a></span><span class="refpurpose"> — ラスタの高さをピクセル単位で返します。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_IsEmpty.html">ST_IsEmpty</a></span><span class="refpurpose"> — ラスタが空 (幅が0で高さが0)の場合にはTRUEを返します。他の場合には、FALSEを返します。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_MemSize.html">ST_MemSize</a></span><span class="refpurpose"> — ラスタが取る領域の合計をバイト単位で返します。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_MetaData.html">ST_MetaData</a></span><span class="refpurpose"> — ピクセル数、回転 (スキュー)、左上隅位置等のラスタオブジェクトに関する基本的なメタデータを返します。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_NumBands.html">ST_NumBands</a></span><span class="refpurpose"> — ラスタオブジェクトのバンド数を返します。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_PixelHeight.html">ST_PixelHeight</a></span><span class="refpurpose"> — 空間参照系の地理的な単位でのピクセルの高さを返します。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_PixelWidth.html">ST_PixelWidth</a></span><span class="refpurpose"> — 空間参照系の地理的な単位でのピクセルの幅を返します。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_ScaleX.html">ST_ScaleX</a></span><span class="refpurpose"> — 空間参照系の地理的な単位でのピクセル幅のX成分を返します。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_ScaleY.html">ST_ScaleY</a></span><span class="refpurpose"> — 空間参照系の地理的な単位でのピクセル幅のY成分を返します。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_RasterToWorldCoord.html">ST_RasterToWorldCoord</a></span><span class="refpurpose"> — ラスタの指定した列と行における左上隅の地理座標X値とY値 (経度と緯度)を返します。列と行の番号は1始まりです。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_RasterToWorldCoordX.html">ST_RasterToWorldCoordX</a></span><span class="refpurpose"> — ラスタの指定した列と行における左上隅の地理座標のX値を返します。列と行の番号は1始まりです。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_RasterToWorldCoordY.html">ST_RasterToWorldCoordY</a></span><span class="refpurpose"> — ラスタの指定した列と行における左上隅の地理座標のY値を返します。列と行の番号は1始まりです。 </span></dt><dt><span class="refentrytitle"><a href="RT_ST_Rotation.html">ST_Rotation</a></span><span class="refpurpose"> — ラスタの回転をラジアンで返します。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_SkewX.html">ST_SkewX</a></span><span class="refpurpose"> — 空間参照のXスキュー (回転パラメータ)を返します。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_SkewY.html">ST_SkewY</a></span><span class="refpurpose"> — 空間参照のYスキュー (回転パラメータ)を返します。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_SRID.html">ST_SRID</a></span><span class="refpurpose"> — ラスタのspatial_ref_sysテーブルで定義されている空間参照系識別番号を返します。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_Summary.html">ST_Summary</a></span><span class="refpurpose"> — ラスタの中身の概要が文字列で返されます。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_UpperLeftX.html">ST_UpperLeftX</a></span><span class="refpurpose"> — 適用されている空間参照系でのラスタの左上隅のX座標値を返します。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_UpperLeftY.html">ST_UpperLeftY</a></span><span class="refpurpose"> — 適用されている空間参照系でのラスタの左上隅のY座標値を返します。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_Width.html">ST_Width</a></span><span class="refpurpose"> — ラスタの幅をピクセル単位で返します。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_WorldToRasterCoord.html">ST_WorldToRasterCoord</a></span><span class="refpurpose"> — ラスタの空間参照系による地理座標のX値とY値 (経度と緯度)またはポイントジオメトリに対応するピクセルの左上隅を返します。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_WorldToRasterCoordX.html">ST_WorldToRasterCoordX</a></span><span class="refpurpose"> — ラスタの空間参照系に基づくポイントジオメトリ (pt)またはX,Y座標値 (xw,yw)に対応するラスタの列を返します。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_WorldToRasterCoordY.html">ST_WorldToRasterCoordY</a></span><span class="refpurpose"> — ラスタの空間参照系に基づくポイントジオメトリ (pt)またはX,Y座標値 (xw,yw)に対応するラスタの行を返します。</span></dt></dl></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="RasterBand_Accessors"></a>12.5. ラスタバンドアクセサ</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="RT_ST_BandMetaData.html">ST_BandMetaData</a></span><span class="refpurpose"> — 指定したラスタバンドの基本的なメタデータを返します。バンド番号を指定しない場合には、1番と仮定します。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_BandNoDataValue.html">ST_BandNoDataValue</a></span><span class="refpurpose"> — 指定されたバンドについてデータが無いことを表現する値を返します。バンド番号を指定しない場合には、1番と仮定します。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_BandIsNoData.html">ST_BandIsNoData</a></span><span class="refpurpose"> — 指定したバンドがNODATA値だけで満たされている場合には、TRUEを返します。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_BandPath.html">ST_BandPath</a></span><span class="refpurpose"> — ファイルシステムに格納されているバンドのシステムファイルパスを返します。バンド番号が指定されていない場合には、1番と仮定します。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_BandFileSize.html">ST_BandFileSize</a></span><span class="refpurpose"> — ファイルシステムに格納されているバンドのファイルサイズを返します。バンド番号が指定されていない場合には、1番と仮定します。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_BandFileTimestamp.html">ST_BandFileTimestamp</a></span><span class="refpurpose"> — ファイルシステムに格納されているバンドのファイルタイムスタンプ返します。バンド番号が指定されていない場合には、1番と仮定します。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_BandPixelType.html">ST_BandPixelType</a></span><span class="refpurpose"> — 指定したバンドのピクセルタイプを返します。バンド番号が指定されていない場合には、1番と仮定します。</span></dt><dt><span class="refentrytitle"><a href="ST_MinPossibleValue.html">ST_MinPossibleValue</a></span><span class="refpurpose"> — このピクセルタイプが格納できる最小値を返します。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_HasNoBand.html">ST_HasNoBand</a></span><span class="refpurpose"> — 指定したバンド番号のバンドが無い場合には、TRUEを返します。バンド番号を指定していない場合には、1番と仮定します。</span></dt></dl></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Raster_Pixel_Accessors"></a>12.6. ラスタピクセルアクセサとセッター</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="RT_ST_PixelAsPolygon.html">ST_PixelAsPolygon</a></span><span class="refpurpose"> — 指定した行と列のピクセルの境界となるジオメトリを返します。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_PixelAsPolygons.html">ST_PixelAsPolygons</a></span><span class="refpurpose"> — 全てのピクセルについて境界となるジオメトリを、ピクセルごとのピクセル値とラスタ座標系のXとYとを付けて返します。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_PixelAsPoint.html">ST_PixelAsPoint</a></span><span class="refpurpose"> — ピクセルの左上隅のポイントジオメトリを返します。 </span></dt><dt><span class="refentrytitle"><a href="RT_ST_PixelAsPoints.html">ST_PixelAsPoints</a></span><span class="refpurpose"> — 全てのピクセルについてポイントジオメトリを、ピクセルごとのピクセル値とラスタ座標系のXとYとを付けて返します。ポイントジオメトリの座標はピクセルの左上隅です。 </span></dt><dt><span class="refentrytitle"><a href="RT_ST_PixelAsCentroid.html">ST_PixelAsCentroid</a></span><span class="refpurpose"> — ピクセルで表現される面の重心 (ポイントジオメトリ)を返します。 </span></dt><dt><span class="refentrytitle"><a href="RT_ST_PixelAsCentroids.html">ST_PixelAsCentroids</a></span><span class="refpurpose"> — 全てのピクセルについて重心 (ポイントジオメト)リを、ピクセルごとのピクセル値とラスタ座標系のXとYとを付けて返します。ポイントジオメトリの座標はピクセルで表現される面の重心です。 </span></dt><dt><span class="refentrytitle"><a href="RT_ST_Value.html">ST_Value</a></span><span class="refpurpose"> — 指定したバンドにおけるcolumnx, rowyで指定したピクセルまたは指定したジオメトリポイントに対応するピクセルの値を返します。 バンド番号は1始まりで、指定しない場合には、1番と仮定します。<code class="varname">exclude_nodata_value</code>がFALSEに設定された場合には、NODATAピクセルを含む全てのピクセルがインタセクトするかが考慮され、値を返します。<code class="varname">exclude_nodata_value</code>を渡さない場合には、ラスタのメタデータから読みます。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_NearestValue.html">ST_NearestValue</a></span><span class="refpurpose"> — 与えられたバンドの、columnxとrowyで指定されるか、またはラスタと同じ空間参照系で表現されたポイントで指定されたピクセルに最も近い<code class="varname">NODATA</code>でない値を返します。 </span></dt><dt><span class="refentrytitle"><a href="RT_ST_SetZ.html">ST_SetZ</a></span><span class="refpurpose"> — 入力ジオメトリと同じX/y座標値と、指定されたリサンプリングアルゴリズムを使ってラスタから複写されたZ値とを持つジオメトリを返します。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_SetM.html">ST_SetM</a></span><span class="refpurpose"> — 入力ジオメトリと同じX/y座標値と、指定されたリサンプリングアルゴリズムを使ってラスタから複写されたZ値とを持つジオメトリを返します。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_Neighborhood.html">ST_Neighborhood</a></span><span class="refpurpose"> — 与えられたバンドのcolumnX, columnYか、ラスタと同じ空間参照系のジオメトリポイントで指定されたピクセルの周囲にある、<code class="varname">NODATA</code>でない2次元倍精度浮動小数点数配列を返します。 </span></dt><dt><span class="refentrytitle"><a href="RT_ST_SetValue.html">ST_SetValue</a></span><span class="refpurpose"> — 与えられたバンドのcolumnX, columnYか、ラスタと同じ空間参照系のジオメトリポイントで指定されたピクセルの値または指定したジオメトリとインタセクトするピクセル群の値を設定することから得られる、変更されたラスタを返します。バンド番号は1始まりで、指定しない場合には、1番と仮定します。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_SetValues.html">ST_SetValues</a></span><span class="refpurpose"> — 与えられたバンドに複数の値を設定して、変更されたラスタを返します。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_DumpValues.html">ST_DumpValues</a></span><span class="refpurpose"> — 指定したバンドの値を2次元で得ます。 </span></dt><dt><span class="refentrytitle"><a href="RT_ST_PixelOfValue.html">ST_PixelOfValue</a></span><span class="refpurpose"> — 検索値と同じ値を持つピクセルのcolumnx, rowyピクセル座標を得ます。 </span></dt></dl></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Raster_Editors"></a>12.7. ラスタエディタ</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="RT_ST_SetGeoReference.html">ST_SetGeoReference</a></span><span class="refpurpose"> — 地理参照6パラメタを一度に設定します。数値は空白で区切ります。GDALまたはESRI書式の入力を受け付けます。デフォルトはGDALです。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_SetRotation.html">ST_SetRotation</a></span><span class="refpurpose"> — ラスタの回転をラジアン単位で設定します。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_SetScale.html">ST_SetScale</a></span><span class="refpurpose"> — ピクセルサイズのX値とY値を空間参照系の単位で設定します。数値は単位/ピクセルの幅または高さです。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_SetSkew.html">ST_SetSkew</a></span><span class="refpurpose"> — 地理参照のスキュー (回転パラメタ)のX値とY値を設定します。一つだけ渡した場合には、X値とY値は同じ値に設定されます。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_SetSRID.html">ST_SetSRID</a></span><span class="refpurpose"> — スタのSRIDをspatial_ref_sysに定義されている特定の整数値に設定します。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_SetUpperLeft.html">ST_SetUpperLeft</a></span><span class="refpurpose"> — ラスタの左上隅の投影座標系のX値とY値を設定します。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_Resample.html">ST_Resample</a></span><span class="refpurpose"> — 指定したリサンプリングアルゴリズム、新しいピクセル範囲、グリッドの隅、定義するか他のラスタから借りてきた地理参照属性を使ってリサンプリングを行います。 </span></dt><dt><span class="refentrytitle"><a href="RT_ST_Rescale.html">ST_Rescale</a></span><span class="refpurpose"> — スケール (ピクセルサイズ)だけを調整するリサンプリングを行います。新しいピクセル値のリサンプリングアルゴリズムとして最近傍補間 ('NearestNeighbor' (米式綴り方))、双線形補間 ('Bilinear')、3次補間 ('Cubic')、3次スプライン補間 ('CubicSpline')、ランチョス補間 ('Lanczos')を用います。デフォルトは最近傍補間です。 </span></dt><dt><span class="refentrytitle"><a href="RT_ST_Reskew.html">ST_Reskew</a></span><span class="refpurpose"> — キュー (回転パラメタ)だけを調整するリサンプリングを行います。新しいピクセル値のリサンプリングアルゴリズムとして最近傍補間 ('NearestNeighbor' (米式綴り方))、双線形補間 ('Bilinear')、3次補間 ('Cubic')、3次スプライン補間 ('CubicSpline')、ランチョス補間 ('Lanczos')を用います。デフォルトは最近傍補間です。 </span></dt><dt><span class="refentrytitle"><a href="RT_ST_SnapToGrid.html">ST_SnapToGrid</a></span><span class="refpurpose"> — グリッドにスナップすることでラスタをリサンプリングします。新しいピクセル値のリサンプリングアルゴリズムとして最近傍補間 ('NearestNeighbor' (米式綴り方))、双線形補間 ('Bilinear')、3次補間 ('Cubic')、3次スプライン補間 ('CubicSpline')、ランチョス補間('Lanczos')を用います。デフォルトは最近傍補間です。 </span></dt><dt><span class="refentrytitle"><a href="RT_ST_Resize.html">ST_Resize</a></span><span class="refpurpose"> — ラスタを新しい幅、高さにサイズ再設定を行います。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_Transform.html">ST_Transform</a></span><span class="refpurpose"> — ラスタを既知の空間参照系から他の既知の空間参照系に、指定したリサンプリングアルゴリズムで投影変換します。新しいピクセル値のリサンプリングアルゴリズムとして最近傍補間 ('NearestNeighbor' (米式綴り方))、双線形補間 ('Bilinear')、3次補間 ('Cubic')、3次スプライン補間 ('CubicSpline')、ランチョス補間 ('Lanczos')を用います。デフォルトは最近傍補間です。</span></dt></dl></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="RasterBand_Editors"></a>12.8. ラスタバンドエディタ</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="RT_ST_SetBandNoDataValue.html">ST_SetBandNoDataValue</a></span><span class="refpurpose"> — 指定したバンドにNODATAを表現する値を設定します。バンドを指定しない場合には、1番と仮定します。NODATA値を持たないようにするには、nodatavalueにNULLを指定します。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_SetBandIsNoData.html">ST_SetBandIsNoData</a></span><span class="refpurpose"> — バンドのisnodataフラグをTRUEにします。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_SetBandPath.html">ST_SetBandPath</a></span><span class="refpurpose"> — データベース外バンドの外部パスとバンド番号を更新します。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_SetBandIndex.html">ST_SetBandIndex</a></span><span class="refpurpose"> — データベース外バンドの外部バンド番号の更新</span></dt></dl></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="RasterBand_Stats"></a>12.9. ラスタバンド統計情報と解析</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="RT_ST_Count.html">ST_Count</a></span><span class="refpurpose"> — ラスタまたはラスタカバレッジの指定したバンドのピクセル数を返します。バンドを指定しない場合には、1番と仮定します。exclude_nodata_valueをTRUEに設定している場合には、NODATA値と等しくないピクセルのみを数えます。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_CountAgg.html">ST_CountAgg</a></span><span class="refpurpose"> — 集約関数です。ラスタ集合の与えられたバンドのピクセル数を返します。バンドが指定されていない場合には、1番と仮定します。exclude_nodata_valueをTRUEに設定している場合には、NODATA値と等しくないピクセルのみを数えます。 </span></dt><dt><span class="refentrytitle"><a href="RT_ST_Histogram.html">ST_Histogram</a></span><span class="refpurpose"> — ラスタまたはラスタカバレッジのビン範囲で分割したデータ分布をまとめるヒストグラムの集合を返します。ビン数を指定しない場合には自動計算されます。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_Quantile.html">ST_Quantile</a></span><span class="refpurpose"> — ラスタまたはラスタテーブルカバレッジのサンプルまたは母集団の分位数を計算します。値がラスタの25%,50%,75%にあるかを調べることができます。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_SummaryStats.html">ST_SummaryStats</a></span><span class="refpurpose"> — ラスタまたはラスタカバレッジの指定したバンドについて、ピクセル数、合計値、平均値、標準偏差、最小値、最大値からなる統計情報の概要を返します。バンドを指定しない場合には、1番と仮定します。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_SummaryStatsAgg.html">ST_SummaryStatsAgg</a></span><span class="refpurpose"> — 集約関数です。ラスタ集合の指定したバンドについて、ピクセル数、合計値、平均値、標準偏差、最小値、最大値からなる統計情報の概要を返します。バンドを指定しない場合には、1番と仮定します。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_ValueCount.html">ST_ValueCount</a></span><span class="refpurpose"> — ラスタ　(またはラスタカバレッジ)の指定されたバンドで、指定した値を持つピクセルを対象として、ピクセルバンド値とピクセル数からなるレコードの集合を返します。バンドを指定しない場合には、1番と仮定します。デフォルトではNODATA値のピクセルは数えられず、ピクセルの他の値は出力され、ピクセルバンド値は最も近い整数に丸められます。</span></dt></dl></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Raster_Inputs"></a>12.10. ラスタ入力</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="RT_ST_RastFromWKB.html">ST_RastFromWKB</a></span><span class="refpurpose"> — Well-Known Binary (WKB)ラスタからラスタ値を返します。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_RastFromHexWKB.html">ST_RastFromHexWKB</a></span><span class="refpurpose"> — Well-Knownバイナリ (WKB)ラスタの16進数表現からラスタを返します。</span></dt></dl></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Raster_Outputs"></a>12.11. 出力</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="RT_ST_AsBinary.html">ST_AsBinary/ST_AsWKB</a></span><span class="refpurpose"> — ラスタのWell-Known Binary (WKB)表現を返します。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_AsHexWKB.html">ST_AsHexWKB</a></span><span class="refpurpose"> — Well-Known Binary (WKB)ラスタを16進数表現で返します。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_AsGDALRaster.html">ST_AsGDALRaster</a></span><span class="refpurpose"> — 指定されたGDALラスタ書式でラスタタイルを返します。ラスタ書式はコンパイルしたライブラリが対応するものです。ライブラリが対応する書式の一覧を得るにはST_GDALRasters()を使います。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_AsJPEG.html">ST_AsJPEG</a></span><span class="refpurpose"> — ラスタの選択されたバンドを、単一のJoint Photographic Exports Group (JPEG)画像としてバイト配列で返します。バンドを指定せず、1バンドか3より多いバンドがある場合には、1番バンドを使用します。3バンドのみ指定した場合には、3バンドを使用し、RGBに対応付けます。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_AsPNG.html">ST_AsPNG</a></span><span class="refpurpose"> — ラスタの選択されたバンドを、単一のportable network graphics (PNG)画像としてバイト配列で返します。バンドを指定せず、1バンドか3バンドか4バンドある場合には、全てのバンドを使用します。バンドを指定せず、2バンドか4より多いバンドがある場合には、1番バンドを使用します。対象バンドはRGBまたはRGBAに対応付けられます。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_AsTIFF.html">ST_AsTIFF</a></span><span class="refpurpose"> — ラスタの選択されたバンドを、単一のTIFF画像 (バイト配列)として返します。バンドを指定しないか指定したバンドがラスタ内に無い場合には、全てのバンドの使用を試みます。</span></dt></dl></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Raster_Processing_MapAlgebra"></a>12.12. ラスタ処理: 地図代数</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="RT_ST_Clip.html">ST_Clip</a></span><span class="refpurpose"> — 入力ジオメトリで切り取ったラスタを返します。バンドが指定されていない場合には、全てのバンドが返されます。<code class="varname">crop</code>が指定されていない場合には、TRUEと仮定され、出力ラスタをクロップします。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_ColorMap.html">ST_ColorMap</a></span><span class="refpurpose"> — 元のラスタと指定したバンドから4個までの8BUIバンド (grayscale, RGB, RGBA)からなる新しいラスタを生成します。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_Grayscale.html">ST_Grayscale</a></span><span class="refpurpose"> — 元のラスタと指定したバンドを赤、緑、青バンドとして一つの8BUIバンドを持つラスタを生成します。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_Intersection.html">ST_Intersection</a></span><span class="refpurpose"> — 二つのラスタの共有部分またはベクタ化したラスタとジオメトリとのインタセクトした部分を表現する、ラスタまたはジオメトリとピクセル値の組の集合を返します。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_MapAlgebra.html">ST_MapAlgebra (コールバック関数版)</a></span><span class="refpurpose"> — コールバック関数版 - 一つ以上の入力ラスタ、バンドインデクスと一つのユーザ定義コールバック関数から、一つのバンドからなるラスタを返します。 </span></dt><dt><span class="refentrytitle"><a href="RT_ST_MapAlgebra_expr.html">ST_MapAlgebra (数式版)</a></span><span class="refpurpose"> — 数式版 - 一つか二つの入力ラスタ、バンド番号、一つ以上のユーザ定義SQL式から一つのバンドを持つラスタを返します。 </span></dt><dt><span class="refentrytitle"><a href="RT_ST_MapAlgebraExpr.html">ST_MapAlgebraExpr</a></span><span class="refpurpose"> — 1バンド版: 入力バンドに対する妥当なPostgreSQL代数演算で形成された、指定したピクセルタイプとなる1バンドラスタを生成します。バンドを指定しない場合には、1番を仮定します。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_MapAlgebraExpr2.html">ST_MapAlgebraExpr</a></span><span class="refpurpose"> — 2バンド版: 二つの入力バンドに対する妥当なPostgreSQL代数演算で形成された、指定したピクセルタイプとなる1バンドラスタを生成します。バンドを指定しない場合には、どちらも1番と仮定します。結果ラスタは、一つ目のラスタのアラインメント (スケール、スキュー、ピクセル角位置)にあわされます。範囲は"extenttype"引数で定義されます。取りうる"extenttype"の値はINTERSECTION, UNION, FIRST, SECONDです。 </span></dt><dt><span class="refentrytitle"><a href="RT_ST_MapAlgebraFct.html">ST_MapAlgebraFct</a></span><span class="refpurpose"> — 1バンド版 - 入力バンドに対する妥当なPostgreSQL関数で形成された、指定したピクセルタイプとなる1バンドラスタを生成します。バンドを指定しない場合には、1番と仮定します。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_MapAlgebraFct2.html">ST_MapAlgebraFct</a></span><span class="refpurpose"> — 2バンド版 - 二つの入力バンドに対する妥当なPostgreSQL関数で形成された、指定したピクセルタイプとなる1バンドラスタを生成します。バンドを指定しない場合には、1番と仮定します。"extenttype"のデフォルトはINTERSECTIONです。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_MapAlgebraFctNgb.html">ST_MapAlgebraFctNgb</a></span><span class="refpurpose"> — 1バンド版: ユーザ定義PostgreSQL関数を使用する最近傍地図代数関数です。入力ラスタバンドの近傍の値を与えたPL/pgSQLユーザ定義関数の結果からなるラスタを返します。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_Reclass.html">ST_Reclass</a></span><span class="refpurpose"> — 元のラスタから再分類したバンドタイプからなるラスタを生成します。nbandは変更するバンドです。nbandが指定されていない場合には、1と仮定します。他の全てのバンドは変更せずに返します。可視画像の書式としてより単純な描画を行うために、16BUIバンドを8BUIバンドに変換する、等のために使います。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_Union.html">ST_Union</a></span><span class="refpurpose"> — ラスタタイルの集合を結合して1以上のバンドからなる単一ラスタを返します。</span></dt></dl></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Raster_Processing_MapAlgebra_Callbacks"></a>12.13. 組み込み地図代数コールバック関数</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="RT_ST_Distinct4ma.html">ST_Distinct4ma</a></span><span class="refpurpose"> — 近隣のピクセル値のうち一意となるものを数えるラスタ処理関数です。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_InvDistWeight4ma.html">ST_InvDistWeight4ma</a></span><span class="refpurpose"> — 近隣のピクセル値の内挿補間を行うラスタ処理関数です。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_Max4ma.html">ST_Max4ma</a></span><span class="refpurpose"> — 近隣のピクセル値の最大値を計算するラスタ処理関数です。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_Mean4ma.html">ST_Mean4ma</a></span><span class="refpurpose"> — 近隣のピクセル値の平均値を計算するラスタ処理関数です。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_Min4ma.html">ST_Min4ma</a></span><span class="refpurpose"> — 近隣のピクセル値の最小値を計算するラスタ処理関数です。 </span></dt><dt><span class="refentrytitle"><a href="RT_ST_MinDist4ma.html">ST_MinDist4ma</a></span><span class="refpurpose"> — 対象ピクセルと値を持つ近隣ピクセルとの最短距離をピクセル単位で返すラスタ処理関数です。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_Range4ma.html">ST_Range4ma</a></span><span class="refpurpose"> — 近隣のピクセル値の範囲を計算するラスタ処理関数です。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_StdDev4ma.html">ST_StdDev4ma</a></span><span class="refpurpose"> — 近隣のピクセル値の標準偏差を計算するラスタ処理関数です。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_Sum4ma.html">ST_Sum4ma</a></span><span class="refpurpose"> — 近隣のピクセル値の合計を計算するラスタ処理関数です。</span></dt></dl></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Raster_Processing_DEM"></a>12.14. ラスタ処理: DEM (標高)</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="RT_ST_Aspect.html">ST_Aspect</a></span><span class="refpurpose"> — 標高ラスタバンドの傾斜方向 (デフォルトの単位は度)を返します。地形解析に使えます。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_HillShade.html">ST_HillShade</a></span><span class="refpurpose"> — 与えられた方位、高度、明度、スケールの入力を使って標高ラスタバンドの仮想照明を返します。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_Roughness.html">ST_Roughness</a></span><span class="refpurpose"> — DEMの「粗度」を計算したラスタを返します。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_Slope.html">ST_Slope</a></span><span class="refpurpose"> — 標高ラスタバンドの傾斜角 (デフォルトでは度単位)を返します。地形解析に使えます。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_TPI.html">ST_TPI</a></span><span class="refpurpose"> — 地形的位置指数を計算したラスタを返します。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_TRI.html">ST_TRI</a></span><span class="refpurpose"> — 起伏指標を計算したラスタを返します。</span></dt></dl></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Raster_Processing_Geometry"></a>12.15. ラスタ処理: ラスタからジオメトリ</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="RT_Box3D.html">Box3D</a></span><span class="refpurpose"> — ラスタを囲むボックスのbox3d表現を返します。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_ConvexHull.html">ST_ConvexHull</a></span><span class="refpurpose"> — BandNoDataValueと等しいピクセル値を含むラスタの凸包ジオメトリを返します。一般的な形状でスキューのないラスタでは、ST_Envelopeと同じ結果になります。不規則な形状をしているか回転しているラスタでのみ使います。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_DumpAsPolygons.html">ST_DumpAsPolygons</a></span><span class="refpurpose"> — 指定されたラスタバンドからgeomval (geom,val)行の集合を返します。バンドを指定しない場合のデフォルトは1です。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_Envelope.html">ST_Envelope</a></span><span class="refpurpose"> — ラスタの範囲のポリゴン表現を返します。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_MinConvexHull.html">ST_MinConvexHull</a></span><span class="refpurpose"> — NODATA値を除いたラスタの凸包ジオメトリを返します。 </span></dt><dt><span class="refentrytitle"><a href="RT_ST_Polygon.html">ST_Polygon</a></span><span class="refpurpose"> — NODATA値でないピクセル値を持つピクセルの結合で形成されるマルチポリゴンジオメトリを返します。バンドを指定しない場合のデフォルトは1です。</span></dt></dl></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="RT_Operators"></a>12.16. ラスタ演算子</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="RT_Raster_Intersect.html">&amp;&amp;</a></span><span class="refpurpose"> — AのバウンディングボックスがBのバウンディングボックスとインタセクトする場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="RT_Raster_OverLeft.html">&amp;&lt;</a></span><span class="refpurpose"> — AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの左にある場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="RT_Raster_OverRight.html">&amp;&gt;</a></span><span class="refpurpose"> — AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの右にある場合に <code class="varname">TRUE</code> を返します。</span></dt><dt><span class="refentrytitle"><a href="RT_Raster_EQ.html">=</a></span><span class="refpurpose"> — AのバウンディングボックスがBのバウンディングボックスと同じ場合に<code class="varname">TRUE</code>を返します。倍精度浮動小数点数のバウンディングボックスを使います。</span></dt><dt><span class="refentrytitle"><a href="RT_Raster_Contained.html">@</a></span><span class="refpurpose"> — AのバウンディングボックスがBのバウンディングボックスに含まれる場合に<code class="varname">TRUE</code>を返します。倍精度浮動小数点数のバウンディングボックスを使います。</span></dt><dt><span class="refentrytitle"><a href="RT_Raster_Same.html">~=</a></span><span class="refpurpose"> — AのバウンディングボックスがBのバウンディングボックスと同じ場合にTRUEを返します。</span></dt><dt><span class="refentrytitle"><a href="RT_Raster_Contains.html">~</a></span><span class="refpurpose"> — AのバウンディングボックスがBのバウンディングボックスを含む場合に<code class="varname">TRUE</code>を返します。倍精度浮動小数点数のバウンディングボックスを使います。</span></dt></dl></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Raster_Relationships"></a>12.17. ラスタとラスタバンドの空間関係関数</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="RT_ST_Contains.html">ST_Contains</a></span><span class="refpurpose"> — rastAの外にrastBの点が無く、rastAの内部にrastBの内部の点が一つ以上ある場合にTRUEを返します。 </span></dt><dt><span class="refentrytitle"><a href="RT_ST_ContainsProperly.html">ST_ContainsProperly</a></span><span class="refpurpose"> — rastBがrastAの内部でインタセクトし、かつrastAの境界とも外部ともインタセクトしない場合にTRUEを返します。 </span></dt><dt><span class="refentrytitle"><a href="RT_ST_Covers.html">ST_Covers</a></span><span class="refpurpose"> — rastBがrastAの外部に点を持たない場合にTRUEを返します。 </span></dt><dt><span class="refentrytitle"><a href="RT_ST_CoveredBy.html">ST_CoveredBy</a></span><span class="refpurpose"> — rastAがrastBの外部に点を持たない場合にTRUEを返します。 </span></dt><dt><span class="refentrytitle"><a href="RT_ST_Disjoint.html">ST_Disjoint</a></span><span class="refpurpose"> — rastAがrastBとインタセクトしない場合にTRUEを返します。 </span></dt><dt><span class="refentrytitle"><a href="RT_ST_Intersects.html">ST_Intersects</a></span><span class="refpurpose"> — rastAがrastBとインタセクトする場合にTRUEを返します。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_Overlaps.html">ST_Overlaps</a></span><span class="refpurpose"> — rastAとrastBがインタセクトして、かつ一方がもう一方に完全には包含されない場合にはTRUEを返します。 </span></dt><dt><span class="refentrytitle"><a href="RT_ST_Touches.html">ST_Touches</a></span><span class="refpurpose"> — rastAとrastBが少なくとも一つの共通の点を持ち、かつ二つのラスタの内部同士がインタセクトしない場合にTRUEを返します。 </span></dt><dt><span class="refentrytitle"><a href="RT_ST_SameAlignment.html">ST_SameAlignment</a></span><span class="refpurpose"> — ラスタが同じスキュー、スケール、空間参照系、オフセットを持つ (ピクセルが分割されることなく同じグリッドに置かれている)場合にTRUEを返し、そうでない場合は問題を詳述する通知とともにFALSEを返します。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_NotSameAlignmentReason.html">ST_NotSameAlignmentReason</a></span><span class="refpurpose"> — ラスタが同じアラインメントを持つかどうか、また、持たない場合にはその理由を示す文字列を返します。</span></dt><dt><span class="refentrytitle"><a href="RT_ST_Within.html">ST_Within</a></span><span class="refpurpose"> — rastAがrastBの外部に点を持たず、rastAの内部の少なくとも一つの点がrastBの内部にある場合にTRUEを返します。 </span></dt><dt><span class="refentrytitle"><a href="RT_ST_DWithin.html">ST_DWithin</a></span><span class="refpurpose"> — rastAとrastBが指定した距離内にある場合にTRUEを返します。 </span></dt><dt><span class="refentrytitle"><a href="RT_ST_DFullyWithin.html">ST_DFullyWithin</a></span><span class="refpurpose"> — rastAとrastBが指定した距離内に完全に収まる場合にTRUEを返します。 </span></dt></dl></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Raster_Tips"></a>12.18. ラスタに関する技法</h2></div><div><div class="abstract"><div class="abstract-title">Abstract</div><p>本節では、PostGISラスタに関連する様々な落とし穴や技法について説明します。</p></div></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="RT_reference.html#outdb">12.18.1. データベース外ラスタ</a></span></dt></dl></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="outdb"></a>12.18.1. データベース外ラスタ</h3></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect3"><a href="RT_reference.html#gdal_readdir">12.18.1.1. 多数のファイルを持つディレクトリ</a></span></dt><dt><span class="sect3"><a href="RT_reference.html#max_open_files">12.18.1.2. 開くことができるファイルの最大数</a></span></dt></dl></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="gdal_readdir"></a>12.18.1.1. 多数のファイルを持つディレクトリ</h4></div></div></div><p>GDALはファイルを開く時に、そのファイルのディレクトリを熱心にスキャンして、他のファイルのカタログを構築します。このディレクトリに多数のファイル (千とか万とか)あるとします。一つのファイルを開くと動作が非常に遅くなります (特にNFSのようなネットワークドライブの場合)。 </p><p>この振る舞いを制御するために、GDALには<a class="ulink" href="https://trac.osgeo.org/gdal/wiki/ConfigOptions#GDAL_DISABLE_READDIR_ON_OPEN" target="_top">GDAL_DISABLE_READDIR_ON_OPEN</a>という環境変数があります。<code class="varname">GDAL_DISABLE_READDIR_ON_OPEN</code>を<code class="varname">TRUE</code>に設定すると、ディレクトリのスキャンを無効にします。 </p><p>Ubuntuでは (Ubuntu用PostgreSQLのパッケージを使っていると仮定します)、<code class="varname">GDAL_DISABLE_READDIR_ON_OPEN</code>が<span class="emphasis"><em>/etc/postgresql/POSTGRESQL_VERSION/CLUSTER_NAME/environment</em></span>内で設定できます (POSTGRESQL_VERSIONは9.6等のPostgreSQLのバージョンで、CLUSTER_NAMEはmaindb等のクラスタ名です)。PostGIS環境変数もここで同じく設定できます。 </p><pre class="programlisting"># postmasterプロセスの環境変数
# このファイルはpostgresql.confと同じ文法で、次のように書きます。
#  VARIABLE = simple_value
#  VARIABLE2 = 'any value!'
# 例えば、英数文字と'-', '_', '.' (のシングルクォート内)以外の文字を含む値を囲む必要があります。
# シェルコマンドは評価されません。
POSTGIS_GDAL_ENABLED_DRIVERS = 'ENABLE_ALL'

POSTGIS_ENABLE_OUTDB_RASTERS = 1

<span class="strong"><strong>GDAL_DISABLE_READDIR_ON_OPEN = 'TRUE'</strong></span>
                    </pre><p>
                </p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="max_open_files"></a>12.18.1.2. 開くことができるファイルの最大数</h4></div></div></div><p>LinuxとPostgreSQLが許している、開くことができるファイルの最大数は、通常は増加していません (通常、プロセスあたり1024ファイルです)。システムは人間のユーザが使用するという仮定に立っているからです。データベース外ラスタは、一つの妥当なクエリで簡単に制限超過させることができます (例えば、10年分のラスタからなるデータセットで、個々のラスタは日別最低気温、最大気温を持っていて、データセット内の最大値と最小値を得たい場合などです)。 </p><p>最も簡単な変更方法は、PostgreSQL設定<a class="ulink" href="https://www.postgresql.org/docs/current/static/runtime-config-resource.html#GUC-MAX-FILES-PER-PROCESS" target="_top">max_files_per_process</a>です。デフォルトとして1000が設定されていますが、データベース外ラスタとしては非常に低い値です。安全な開始値は65536でしょう。ただし、実際には、これはデータベースとデータベースに対して実行されるクエリに依存します。サーバ開始時のみ、かつPostgreSQLコンフィギュレーションファイル (例: Ubuntu環境では<span class="emphasis"><em>/etc/postgresql/POSTGRESQL_VERSION/CLUSTER_NAME/postgresql.conf</em></span>)内のみで設定できます。 </p><pre class="programlisting">...
# - カーネルリソースの使用状況 -

<span class="strong"><strong>max_files_per_process = 65536</strong></span>           # min 25
                                        # (change requires restart)
...
                    </pre><p>
                </p><p>主な変更はLinuxカーネルのファイルを開く制限です。次の通り、二つに分かれます。 </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>システム全体で開くことができるファイルの最大数</p></li><li class="listitem"><p>プロセスごとに開くことができるファイルの最大数</p></li></ul></div><p>
                </p><div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a name="max_open_files_per_system"></a>12.18.1.2.1. システム全体で開くことができるファイルの最大数</h5></div></div></div><p>次の例で、システム全体の、現在の開くことができるファイルの最大値を調べることができます。 </p><pre class="programlisting">$ sysctl -a | grep fs.file-max
fs.file-max = 131072
                    </pre><p>返された値が十分には大きくない場合には、次に示す例に従って、<span class="emphasis"><em>/etc/sysctl.d/</em></span>にファイルを追加します。 </p><pre class="programlisting">$ echo "fs.file-max = 6145324" 
&gt;
&gt; /etc/sysctl.d/fs.conf

$ cat /etc/sysctl.d/fs.conf
fs.file-max = 6145324

$ sysctl -p --system
* Applying /etc/sysctl.d/fs.conf ...
fs.file-max = 2097152
* Applying /etc/sysctl.conf ...

$ sysctl -a | grep fs.file-max
fs.file-max = 6145324
                    </pre></div><div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a name="max_open_files_per_process"></a>12.18.1.2.2. プロセスごとの開けるファイルの最大数</h5></div></div></div><p>PostgreSQLのサーバプロセスごとに開けるファイルの最大数を増やす必要があります。 </p><p>現在のPostgreSQLサービスのプロセスは開くことができるファイルの最大数を使っていて、次の例のようになっています (PostgreSQLが実行されていることを確認して下さい)。 </p><pre class="programlisting">$ ps aux | grep postgres
postgres 31713  0.0  0.4 179012 17564 pts/0    S    Dec26   0:03 /home/dustymugs/devel/postgresql/sandbox/10/usr/local/bin/postgres -D /home/dustymugs/devel/postgresql/sandbox/10/pgdata
postgres 31716  0.0  0.8 179776 33632 ?        Ss   Dec26   0:01 postgres: checkpointer process
postgres 31717  0.0  0.2 179144  9416 ?        Ss   Dec26   0:05 postgres: writer process
postgres 31718  0.0  0.2 179012  8708 ?        Ss   Dec26   0:06 postgres: wal writer process
postgres 31719  0.0  0.1 179568  7252 ?        Ss   Dec26   0:03 postgres: autovacuum launcher process
postgres 31720  0.0  0.1  34228  4124 ?        Ss   Dec26   0:09 postgres: stats collector process
postgres 31721  0.0  0.1 179308  6052 ?        Ss   Dec26   0:00 postgres: bgworker: logical replication launcher

$ cat /proc/31718/limits
Limit                     Soft Limit           Hard Limit           Units
Max cpu time              unlimited            unlimited            seconds
Max file size             unlimited            unlimited            bytes
Max data size             unlimited            unlimited            bytes
Max stack size            8388608              unlimited            bytes
Max core file size        0                    unlimited            bytes
Max resident set          unlimited            unlimited            bytes
Max processes             15738                15738                processes
<span class="strong"><strong>Max open files            1024                 4096                 files</strong></span>
Max locked memory         65536                65536                bytes
Max address space         unlimited            unlimited            bytes
Max file locks            unlimited            unlimited            locks
Max pending signals       15738                15738                signals
Max msgqueue size         819200               819200               bytes
Max nice priority         0                    0
Max realtime priority     0                    0
Max realtime timeout      unlimited            unlimited            us
                    </pre><p>上の例では、プロセスに対する開くことができるファイルの制限が31718になっています。どのプロセスがどうするかは問題ではありません。関心を持っている応答は<span class="emphasis"><em>Max open files</em></span>です。 </p><p><span class="emphasis"><em>Max open files</em></span>の<span class="emphasis"><em>Soft Limit</em></span>と<span class="emphasis"><em>Hard Limit</em></span>をPostgreSQLの設定で指定した<code class="varname">max_files_per_process</code>よりも多くなるようにしたいと思っています。この例では、<code class="varname">max_files_per_process</code>を65536にしています。 </p><p>Ubuntu (かつ、Ubuntu用PostgreSQLパッケージを使用しているものとします)では、<span class="emphasis"><em>Soft Limit</em></span>と<span class="emphasis"><em>Hard Limit</em></span>の変更については、<span class="strong"><strong>/etc/init.d/postgresql</strong></span> (SysV)または<span class="strong"><strong>/lib/systemd/system/postgresql*.service</strong></span> (systemd)を編集するのが簡単な方法です。 </p><p>まず、SysV Ubuntuを扱います。<span class="strong"><strong>ulimit -H -n 262144</strong></span>と<span class="strong"><strong>ulimit -n 131072</strong></span>を<span class="strong"><strong>/etc/init.d/postgresql</strong></span>に追加します。 </p><pre class="programlisting">...
case "$1" in
    start|stop|restart|reload)
        if [ "$1" = "start" ]; then
            create_socket_directory
        fi
    if [ -z "`pg_lsclusters -h`" ]; then
        log_warning_msg 'No PostgreSQL clusters exist; see "man pg_createcluster"'
        exit 0
    fi
<span class="strong"><strong>
    ulimit -H -n 262144
    ulimit -n 131072
</strong></span>
    for v in $versions; do
        $1 $v || EXIT=$?
    done
    exit ${EXIT:-0}
        ;;
    status)
...
</pre><p>Ubuntuのsystemdを扱います。<span class="strong"><strong>LimitNOFILE=131072</strong></span>を<span class="strong"><strong>/lib/systemd/system/postgresql*.service</strong></span>の各ファイルの<span class="strong"><strong>[Service]</strong></span>セクション内に記述します。 </p><pre class="programlisting">...
[Service]
<span class="strong"><strong>
LimitNOFILE=131072
</strong></span>
...

[Install]
WantedBy=multi-user.target
...
</pre><p>必要なシステムの変更を行った後、デーモンのリロードを必ず行ってください。 </p><pre class="programlisting">systemctl daemon-reload
</pre></div></div></div></div></div><div class="navfooter"><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="using_raster_dataman.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="geomval.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter 11. ラスタデータの管理、クエリ、アプリケーション </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> geomval</td></tr></table></div></body></html>
