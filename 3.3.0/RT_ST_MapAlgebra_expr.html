<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>ST_MapAlgebra (数式版)</title><link rel="stylesheet" type="text/css" href="docbook.css"><link rel="stylesheet" type="text/css" href="style.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><link rel="home" href="index.html" title="PostGIS 3.3.0 マニュアル"><link rel="up" href="RT_reference.html#Raster_Processing_MapAlgebra" title="12.12. ラスタ処理: 地図代数"><link rel="prev" href="RT_ST_MapAlgebra.html" title="ST_MapAlgebra (コールバック関数版)"><link rel="next" href="RT_ST_MapAlgebraExpr.html" title="ST_MapAlgebraExpr"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">ST_MapAlgebra (数式版)</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="RT_ST_MapAlgebra.html">Prev</a> </td><th width="60%" align="center">12.12. ラスタ処理: 地図代数</th><td width="20%" align="right"> <a accesskey="n" href="RT_ST_MapAlgebraExpr.html">Next</a></td></tr></table></div><div class="refentry"><a name="RT_ST_MapAlgebra_expr"></a><div class="titlepage"></div><div class="refnamediv"><h2>Name</h2><p>ST_MapAlgebra (数式版) — 数式版 - 一つか二つの入力ラスタ、バンド番号、一つ以上のユーザ定義SQL式から一つのバンドを持つラスタを返します。 </p></div><div class="refsynopsisdiv"><h2>Synopsis</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebra</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, text  <var class="pdparam">pixeltype</var>, text  <var class="pdparam">expression</var>, double precision  <var class="pdparam">nodataval=NULL</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebra</b>(</code>raster  <var class="pdparam">rast</var>, text  <var class="pdparam">pixeltype</var>, text  <var class="pdparam">expression</var>, double precision  <var class="pdparam">nodataval=NULL</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebra</b>(</code>raster  <var class="pdparam">rast1</var>, integer  <var class="pdparam">nband1</var>, raster  <var class="pdparam">rast2</var>, integer  <var class="pdparam">nband2</var>, text  <var class="pdparam">expression</var>, text  <var class="pdparam">pixeltype=NULL</var>, text  <var class="pdparam">extenttype=INTERSECTION</var>, text  <var class="pdparam">nodata1expr=NULL</var>, text  <var class="pdparam">nodata2expr=NULL</var>, double precision  <var class="pdparam">nodatanodataval=NULL</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebra</b>(</code>raster  <var class="pdparam">rast1</var>, raster  <var class="pdparam">rast2</var>, text  <var class="pdparam">expression</var>, text  <var class="pdparam">pixeltype=NULL</var>, text  <var class="pdparam">extenttype=INTERSECTION</var>, text  <var class="pdparam">nodata1expr=NULL</var>, text  <var class="pdparam">nodata2expr=NULL</var>, double precision  <var class="pdparam">nodatanodataval=NULL</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp84700752"></a><h2>説明</h2><p>数式版 - 一つか二つの入力ラスタ、バンド番号、一つ以上のユーザ定義SQL式から一つのバンドを持つラスタを返します。 </p><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp84702288"></a><h2>説明: 一つ目の形式と二つ目の形式 (一つのラスタ)</h2><p><code class="varname">expression</code>で定義された妥当なPostgreSQL代数演算を入力ラスタ (<code class="varname">rast</code>)に適用して、一つのバンドを持つラスタを生成します。<code class="varname">nband</code>が指定されない場合には、1番バンドと仮定します。新しいラスタは、元のラスタと同じ地理参照、幅、高さになりますが、バンドは一つだけとなります。 </p><p><code class="varname">pixeltype</code>が渡された場合には、新しいラスタのバンドは、そのピクセルタイプになります。pixeltypeにNULLが渡された場合には、新しいラスタは入力<code class="varname">rast</code>のバンドのピクセルタイプと同じになります。 </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="varname">expression</code>のキーワードは次の通りです。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><code class="varname">[rast]</code> - 演算対象ピクセルの値</p></li><li class="listitem"><p><code class="varname">[rast.val]</code> - 演算対象ピクセルの値</p></li><li class="listitem"><p><code class="varname">[rast.x]</code> - 演算対象ピクセルの列 (1始まり)</p></li><li class="listitem"><p><code class="varname">[rast.y]</code> - 演算対象ピクセルの行 (1始まり)</p></li></ol></div></li></ul></div></div><div class="refsection"><a name="idp84711504"></a><h2>説明: 三つ目と四つ目の形式 (二つのラスタ)</h2><p><code class="varname">expression</code>で定義された妥当な二つのバンドへのPostgreSQL代数演算を入力ラスタ (rast1, rast2)に適用して、一つのバンドを持つラスタを生成します。nband1, nband2が指定されない場合には、1番バンドと仮定します。新しいラスタは、一つ目のラスタと同じアラインメント (スケール、スキュー、ピクセル隅)を持ちます。新しいラスタは、<code class="varname">extenttype</code>引数で定義される範囲になります。 </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">expression</span></dt><dd><p>二つのラスタとPostgreSQL定義済み関数/演算子を含むPostgreSQL代数式です。関数と演算子は、二つのピクセルがインタセクトするピクセルの値を定めます。たとえば(([rast1] + [rast2])/2.0)::integerといったふうになります。 </p></dd><dt><span class="term">pixeltype</span></dt><dd><p>出力ラスタのピクセルタイプです。必ず<a class="xref" href="RT_ST_BandPixelType.html" title="ST_BandPixelType">ST_BandPixelType</a>に挙げられたものの一つになるか、省略されるか、NULLに設定されます。引数として渡されないかNULLが渡された場合には、一つ目のラスタのピクセルタイプになります。 </p></dd><dt><span class="term">extenttype</span></dt><dd><p>新しいラスタの範囲を制御します。 </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><code class="varname">INTERSECTION</code> - 新しいラスタの範囲は二つのラスタのインタセクトした領域です。これがデフォルトです。 </p></li><li class="listitem"><p><code class="varname">UNION</code> - 新しいラスタの範囲は二つのラスタの結合です。 </p></li><li class="listitem"><p><code class="varname">FIRST</code> - 新しいラスタの範囲は一つ目のラスタと同じです。 </p></li><li class="listitem"><p><code class="varname">SECOND</code> - 新しいラスタの範囲は二つ目のラスタと同じです。 </p></li></ol></div></dd><dt><span class="term">nodata1expr</span></dt><dd><p><code class="varname">rast1</code>がNODATA値で、特にrast2ピクセルに値がある時に、<code class="varname">rast2</code>だけを返すか返すべき値を定義する定数を含む代数式です。 </p></dd><dt><span class="term">nodata2expr</span></dt><dd><p><code class="varname">rast2</code>がNODATA値で、特にrast2ピクセルに値がある時に、<code class="varname">rast1</code>だけを返すか返すべき値を定義する定数を含む代数式です。 </p></dd><dt><span class="term">nodatanodataval</span></dt><dd><p>rast1とrast2のピクセルの両方がNOADTA値になる場合に返すべき定数です。 </p></dd></dl></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>有効な<code class="varname">expression</code>, <code class="varname">nodata1expr</code>, <code class="varname">nodata2expr</code>のキーワードは次の通りです。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><code class="varname">[rast1]</code> - <code class="varname">rast1</code>の演算対象ピクセルの値</p></li><li class="listitem"><p><code class="varname">[rast1.val]</code> - <code class="varname">rast1</code>の演算対象ピクセルの値</p></li><li class="listitem"><p><code class="varname">[rast1.x]</code> - <code class="varname">rast1</code>の演算対象ピクセルの列 (1始まり)</p></li><li class="listitem"><p><code class="varname">[rast1.y]</code> - <code class="varname">rast1</code>の演算対象ピクセルの行 (1始まり)</p></li><li class="listitem"><p><code class="varname">[rast2]</code> - <code class="varname">rast2</code>の演算対象ピクセルの値</p></li><li class="listitem"><p><code class="varname">[rast2.val]</code> - <code class="varname">rast2</code>の演算対象ピクセルの値</p></li><li class="listitem"><p><code class="varname">[rast2.x]</code> - <code class="varname">rast2</code>の演算対象ピクセルの列 (1始まり)</p></li><li class="listitem"><p><code class="varname">[rast2.y]</code> - <code class="varname">rast2</code>の演算対象ピクセルの行 (1始まり)</p></li></ol></div></li></ul></div></div><div class="refsection"><a name="idp85849296"></a><h2>例: 一つ目の形式と二つ目の形式</h2><pre class="programlisting">WITH foo AS (
    SELECT ST_AddBand(ST_MakeEmptyRaster(10, 10, 0, 0, 1, 1, 0, 0, 0), '32BF'::text, 1, -1) AS rast
)
SELECT
    ST_MapAlgebra(rast, 1, NULL, 'ceil([rast]*[rast.x]/[rast.y]+[rast.val])')
FROM foo;
                    </pre></div><div class="refsection"><a name="idp85850576"></a><h2>例: 三つ目の形式と四つ目の形式</h2><pre class="programlisting">WITH foo AS (
    SELECT 1 AS rid, ST_AddBand(ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(2, 2, 0, 0, 1, -1, 0, 0, 0), 1, '16BUI', 1, 0), 2, '8BUI', 10, 0), 3, '32BUI'::text, 100, 0) AS rast UNION ALL
    SELECT 2 AS rid, ST_AddBand(ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(2, 2, 0, 1, 1, -1, 0, 0, 0), 1, '16BUI', 2, 0), 2, '8BUI', 20, 0), 3, '32BUI'::text, 300, 0) AS rast
)
SELECT
    ST_MapAlgebra(
        t1.rast, 2,
        t2.rast, 1,
        '([rast2] + [rast1.val]) / 2'
    ) AS rast
FROM foo t1
CROSS JOIN foo t2
WHERE t1.rid = 1
    AND t2.rid = 2;
                    </pre></div><div class="refsection"><a name="idp85851856"></a><h2>関連情報</h2><p><a class="xref" href="rastbandarg.html" title="rastbandarg">rastbandarg</a>, <a class="xref" href="RT_ST_Union.html" title="ST_Union">ST_Union</a>, <a class="xref" href="RT_ST_MapAlgebra.html" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a> </p></div></div><div class="navfooter"><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="RT_ST_MapAlgebra.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="RT_reference.html#Raster_Processing_MapAlgebra">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="RT_ST_MapAlgebraExpr.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">ST_MapAlgebra (コールバック関数版) </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> ST_MapAlgebraExpr</td></tr></table></div></body></html>
