<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>PostGIS 2.5.0 マニュアル</title><link rel="stylesheet" type="text/css" href="style.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><meta name="description" content="PostGISは、オブジェクトRDBであるPostgreSQLの拡張で、GIS (地理情報システム)オブジェクトを格納することができます。PostGISは、GiSTベースのR木空間インデクスをサポートし、GISオブジェクトの解析および処理を行う機能を持ちます。  本マニュアルは、2.5.0版のマニュアルです。 この作品はクリエイティブ・コモンズ 表示 - 継承 3.0 非移植 ライセンスの下に提供されています。好きなようにこの材料を使うことができますが、PostGIS Project のクレジット提示を求めます。また可能な限りhttp://postgis.netへのリンクを求めます。"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div lang="ja" class="book"><div class="titlepage"><div><div><h1 class="title"><a name="idp64456136"></a>PostGIS 2.5.0 マニュアル</h1></div><div><h3 class="corpauthor">PostGIS開発グループ</h3></div><div><div class="abstract"><p class="title"><b>概要</b></p><p>PostGISは、オブジェクトRDBであるPostgreSQLの拡張で、GIS (地理情報システム)オブジェクトを格納することができます。PostGISは、GiSTベースのR木空間インデクスをサポートし、GISオブジェクトの解析および処理を行う機能を持ちます。</p><p><span class="inlinemediaobject"><img src="images/PostGIS_logo.png"></span>
            <span class="inlinemediaobject"><img src="images/osgeo_logo.png"></span>
      </p><p>本マニュアルは、2.5.0版のマニュアルです。</p><p><span class="inlinemediaobject"><img src="images/ccbysa.png"></span> この作品は<a class="ulink" href="http://creativecommons.org/licenses/by-sa/3.0/deed.ja" target="_top">クリエイティブ・コモンズ 表示 - 継承 3.0 非移植 ライセンス</a>の下に提供されています。好きなようにこの材料を使うことができますが、PostGIS Project のクレジット提示を求めます。また可能な限り<a class="ulink" href="http://postgis.net" target="_top">http://postgis.net</a>へのリンクを求めます。</p></div></div></div><hr></div><div class="toc"><p><b>目次</b></p><dl class="toc"><dt><span class="chapter"><a href="#postgis_introduction">1. 導入</a></span></dt><dd><dl><dt><span class="sect1"><a href="#psc">1.1. プロジェクト運営委員会</a></span></dt><dt><span class="sect1"><a href="#credits_core_present">1.2. 現在の中核貢献者</a></span></dt><dt><span class="sect1"><a href="#credits_core_past">1.3. 過去の中核貢献者</a></span></dt><dt><span class="sect1"><a href="#credits_other_contributors">1.4. 他の貢献者</a></span></dt><dt><span class="sect1"><a href="#idp64587848">1.5. 追加情報 </a></span></dt></dl></dd><dt><span class="chapter"><a href="#postgis_installation">2. PostGISインストール</a></span></dt><dd><dl><dt><span class="sect1"><a href="#install_short_version">2.1. 簡略版</a></span></dt><dt><span class="sect1"><a href="#install_requirements">2.2. インストール要件</a></span></dt><dt><span class="sect1"><a href="#install_getting_source">2.3. ソースの取得</a></span></dt><dt><span class="sect1"><a href="#PGInstall">2.4. ソースからのコンパイルとインストール: 詳細</a></span></dt><dd><dl><dt><span class="sect2"><a href="#installation_configuration">2.4.1. コンフィギュレーション</a></span></dt><dt><span class="sect2"><a href="#idp64883912">2.4.2. ビルド</a></span></dt><dt><span class="sect2"><a href="#make_install_postgis_extensions">2.4.3. PostGISエクステンションのビルドとデプロイ</a></span></dt><dt><span class="sect2"><a href="#idp64917576">2.4.4. テスト</a></span></dt><dt><span class="sect2"><a href="#idp64990152">2.4.5. インストール</a></span></dt></dl></dd><dt><span class="sect1"><a href="#create_new_db_extensions">2.5. エクステンションを使った空間データベースの生成</a></span></dt><dt><span class="sect1"><a href="#create_new_db">2.6. 空間データベースをエクステンションを使わずに生成する</a></span></dt><dt><span class="sect1"><a href="#installing_pagc_address_standardizer">2.7. PAGC住所標準化ツールのインストールと使用</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp65048136">2.7.1. Regex::Assembleのインストール</a></span></dt></dl></dd><dt><span class="sect1"><a href="#loading_extras_tiger_geocoder">2.8. Tigerジオコーダのインストールとアップグレードとデータロード</a></span></dt><dd><dl><dt><span class="sect2"><a href="#install_tiger_geocoder_extension">2.8.1. TigerジオコーダをPostGISデータベースで有効にする: エクステンションを使用</a></span></dt><dt><span class="sect2"><a href="#install_tiger_geocoder">2.8.2. TigerジオコーダをPostGISデータベースで有効にする: エクステンション不使用</a></span></dt><dt><span class="sect2"><a href="#tiger_pagc_address_standardizing">2.8.3. TigerジオコーダをPostGISデータベースで有効にする: エクステンションを使用</a></span></dt><dt><span class="sect2"><a href="#tiger_geocoder_loading_data">2.8.4. Tigerデータのロード</a></span></dt><dt><span class="sect2"><a href="#upgrade_tiger_geocoder">2.8.5. Tigerジオコーダのアップグレード</a></span></dt></dl></dd><dt><span class="sect1"><a href="#templatepostgis">2.9. 空間データベースをテンプレートから生成する</a></span></dt><dt><span class="sect1"><a href="#upgrading">2.10. アップグレード</a></span></dt><dd><dl><dt><span class="sect2"><a href="#soft_upgrade">2.10.1. ソフトアップグレード </a></span></dt><dt><span class="sect2"><a href="#hard_upgrade">2.10.2. ハードアップグレード</a></span></dt></dl></dd><dt><span class="sect1"><a href="#idp65278536">2.11. 共通の問題</a></span></dt><dt><span class="sect1"><a href="#idp65308232">2.12. ローダ/ダンパ </a></span></dt></dl></dd><dt><span class="chapter"><a href="#PostGIS_FAQ">3. PostGIS よくある質問</a></span></dt><dt><span class="chapter"><a href="#using_postgis_dbmanagement">4. PostGISを使う: データ管理とクエリ</a></span></dt><dd><dl><dt><span class="sect1"><a href="#RefObject">4.1. GISオブジェクト</a></span></dt><dd><dl><dt><span class="sect2"><a href="#OpenGISWKBWKT">4.1.1. OpenGIS WKBとWKT</a></span></dt><dt><span class="sect2"><a href="#EWKB_EWKT">4.1.2. PostGIS EWKB, EWKTと標準形式</a></span></dt><dt><span class="sect2"><a href="#SQL_MM_Part3">4.1.3. SQL-MM第3部</a></span></dt></dl></dd><dt><span class="sect1"><a href="#PostGIS_Geography">4.2. PostGISジオグラフィ型</a></span></dt><dd><dl><dt><span class="sect2"><a href="#Geography_Basics">4.2.1. ジオグラフィ基礎</a></span></dt><dt><span class="sect2"><a href="#PostGIS_GeographyVSGeometry">4.2.2. ジオグラフィ型をジオメトリ型にして使用すべき時</a></span></dt><dt><span class="sect2"><a href="#PostGIS_Geography_AdvancedFAQ">4.2.3. ジオグラフィに関する高度なよくある質問</a></span></dt></dl></dd><dt><span class="sect1"><a href="#idp66152008">4.3. OpenGIS標準を使う</a></span></dt><dd><dl><dt><span class="sect2"><a href="#spatial_ref_sys">4.3.1. SPATIAL_REF_SYSテーブルと空間参照系</a></span></dt><dt><span class="sect2"><a href="#geometry_columns">4.3.2. GEOMETRY_COLUMNSビュー</a></span></dt><dt><span class="sect2"><a href="#Create_Spatial_Table">4.3.3. 空間テーブルを作る</a></span></dt><dt><span class="sect2"><a href="#Manual_Register_Spatial_Column">4.3.4. 手動でジオメトリカラムをgeometry_columnsに登録する</a></span></dt><dt><span class="sect2"><a href="#OGC_Validity">4.3.5. ジオメトリのOpenGIS準拠を確実にする</a></span></dt><dt><span class="sect2"><a href="#DE-9IM">4.3.6. ここで、Dimensionally Extended 9 Intersection Modelまたは略してDE-9IMを見てみましょう。</a></span></dt></dl></dd><dt><span class="sect1"><a href="#loading_geometry_data">4.4. GIS (ベクタ)データをロードする</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp66435400">4.4.1. SQLを使ってロードする</a></span></dt><dt><span class="sect2"><a href="#shp2pgsql_usage">4.4.2. shp2pgsql: ESRIシェープファイルローダを使う</a></span></dt></dl></dd><dt><span class="sect1"><a href="#retrieving_vector-data">4.5. GISデータを検索する</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp66506056">4.5.1. SQLを使ってデータを検索する</a></span></dt><dt><span class="sect2"><a href="#idp66516552">4.5.2. ダンパを使う</a></span></dt></dl></dd><dt><span class="sect1"><a href="#idp66534472">4.6. インデクスを構築する</a></span></dt><dd><dl><dt><span class="sect2"><a href="#gist_indexes">4.6.1. GiSTインデクス</a></span></dt><dt><span class="sect2"><a href="#brin_indexes">4.6.2. BRINインデックス</a></span></dt><dt><span class="sect2"><a href="#spgist_indexes">4.6.3. SP-GiSTインデクス</a></span></dt><dt><span class="sect2"><a href="#idp66594120">4.6.4. インデクスを使う</a></span></dt></dl></dd><dt><span class="sect1"><a href="#idp66612296">4.7. 複雑なクエリ</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp66615752">4.7.1. インデクスの利点を使う</a></span></dt><dt><span class="sect2"><a href="#examples_spatial_sql">4.7.2. 空間SQLの例</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#using_raster_dataman">5. ラスタデータの管理、クエリ、アプリケーション</a></span></dt><dd><dl><dt><span class="sect1"><a href="#RT_Loading_Rasters">5.1. ラスタのロードと生成</a></span></dt><dd><dl><dt><span class="sect2"><a href="#RT_Raster_Loader">5.1.1. raster2pgsqlを使ってラスタをロードする</a></span></dt><dt><span class="sect2"><a href="#RT_Creating_Rasters">5.1.2. PostGISラスタ関数を用いたラスタの生成</a></span></dt></dl></dd><dt><span class="sect1"><a href="#RT_Raster_Catalog">5.2. ラスタカタログ</a></span></dt><dd><dl><dt><span class="sect2"><a href="#RT_Raster_Columns">5.2.1. ラスタカラムカタログ</a></span></dt><dt><span class="sect2"><a href="#RT_Raster_Overviews">5.2.2. ラスタオーバビュー</a></span></dt></dl></dd><dt><span class="sect1"><a href="#RT_Raster_Applications">5.3. PostGISラスタを使ったカスタムアプリケーションの構築</a></span></dt><dd><dl><dt><span class="sect2"><a href="#RT_PHP_Output">5.3.1. ST_AsPNG を他の関数とあわせて使った PHP 出力例</a></span></dt><dt><span class="sect2"><a href="#RT_Net_Output_CS">5.3.2. ST_AsPNGを他の関数とあわせて使ったASP.NET C#出力例</a></span></dt><dt><span class="sect2"><a href="#RT_Java_Console_App">5.3.3. rasterクエリを画像ファイルで出力するJavaコンソールアプリケーション</a></span></dt><dt><span class="sect2"><a href="#RT_PLPython">5.3.4. PLPython を使って SQL を介して画像をダンプする</a></span></dt><dt><span class="sect2"><a href="#RasterOutput_PSQL">5.3.5. PSQLでラスタを出力する</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#idp67757512">6. PostGISを使う: アプリケーションを構築する</a></span></dt><dd><dl><dt><span class="sect1"><a href="#Using_MapServer">6.1. MapServerを使う</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp67766600">6.1.1. 基本的な使い方</a></span></dt><dt><span class="sect2"><a href="#idp67802696">6.1.2. よくある質問</a></span></dt><dt><span class="sect2"><a href="#idp67818696">6.1.3. 踏み込んだ使用法</a></span></dt><dt><span class="sect2"><a href="#idp67827144">6.1.4. 例</a></span></dt></dl></dd><dt><span class="sect1"><a href="#idp67833672">6.2. Javaクライアント (JDBC)</a></span></dt><dt><span class="sect1"><a href="#idp67836616">6.3. Cクライアント (libpq)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp67837640">6.3.1. テキストカーソル</a></span></dt><dt><span class="sect2"><a href="#idp67838792">6.3.2. バイナリカーソル</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#performance_tips">7. 性能向上に関する技法</a></span></dt><dd><dl><dt><span class="sect1"><a href="#small_tables_large_objects">7.1. 大きなジオメトリを持つ小さなテーブル</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp67965640">7.1.1. 問題の説明</a></span></dt><dt><span class="sect2"><a href="#idp67969864">7.1.2. 応急処置</a></span></dt></dl></dd><dt><span class="sect1"><a href="#database_clustering">7.2. ジオメトリインデクスでCLUSTERを実行する</a></span></dt><dt><span class="sect1"><a href="#avoiding_dimension_conversion">7.3. 次元変換の回避</a></span></dt><dt><span class="sect1"><a href="#database_tuning_configuration">7.4. コンフィギュレーションのチューン</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp67988168">7.4.1. 起動時</a></span></dt><dt><span class="sect2"><a href="#idp67997640">7.4.2. 実行時</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#reference">8. PostGISリファレンス</a></span></dt><dd><dl><dt><span class="sect1"><a href="#PostGIS_Types">8.1. PostgreSQL PostGIS Geometry/Geography/Box型</a></span></dt><dt><span class="sect1"><a href="#PostGIS_GUC">8.2. PostGIS GUC (Grand Unified Custom)変数</a></span></dt><dt><span class="sect1"><a href="#Management_Functions">8.3. 管理関数</a></span></dt><dt><span class="sect1"><a href="#Geometry_Constructors">8.4. ジオメトリ コンストラクタ</a></span></dt><dt><span class="sect1"><a href="#Geometry_Accessors">8.5. ジオメトリアクセサ</a></span></dt><dt><span class="sect1"><a href="#Geometry_Editors">8.6. ジオメトリエディタ</a></span></dt><dt><span class="sect1"><a href="#Geometry_Outputs">8.7. ジオメトリ出力</a></span></dt><dt><span class="sect1"><a href="#Operators">8.8. 演算子</a></span></dt><dt><span class="sect1"><a href="#Spatial_Relationships_Measurements">8.9. 空間関係関数と空間計測関数 </a></span></dt><dt><span class="sect1"><a href="#reference_sfcgal">8.10. SFCGAL関数</a></span></dt><dt><span class="sect1"><a href="#Geometry_Processing">8.11. ジオメトリ処理関数</a></span></dt><dt><span class="sect1"><a href="#Linear_Referencing">8.12. 線型参照</a></span></dt><dt><span class="sect1"><a href="#Temporal">8.13. 時間機能</a></span></dt><dt><span class="sect1"><a href="#Long_Transactions_Support">8.14. ロングトランザクション機能</a></span></dt><dt><span class="sect1"><a href="#Miscellaneous_Functions">8.15. その他の関数</a></span></dt><dt><span class="sect1"><a href="#Exceptional_Functions">8.16. 例外的関数</a></span></dt></dl></dd><dt><span class="chapter"><a href="#RT_reference">9. ラスタ リファレンス</a></span></dt><dd><dl><dt><span class="sect1"><a href="#Raster_Types">9.1. ラスタサポートデータ型</a></span></dt><dt><span class="sect1"><a href="#Raster_Management_Functions">9.2. ラスタ管理</a></span></dt><dt><span class="sect1"><a href="#Raster_Constructors">9.3. ラスタコンストラクタ</a></span></dt><dt><span class="sect1"><a href="#Raster_Accessors">9.4. ラスタアクセサ</a></span></dt><dt><span class="sect1"><a href="#RasterBand_Accessors">9.5. ラスタバンドアクセサ</a></span></dt><dt><span class="sect1"><a href="#Raster_Pixel_Accessors">9.6. ラスタピクセルアクセサとセッター</a></span></dt><dt><span class="sect1"><a href="#Raster_Editors">9.7. ラスタエディタ</a></span></dt><dt><span class="sect1"><a href="#RasterBand_Editors">9.8. ラスタバンドエディタ</a></span></dt><dt><span class="sect1"><a href="#RasterBand_Stats">9.9. ラスタバンド統計情報と解析</a></span></dt><dt><span class="sect1"><a href="#Raster_Inputs">9.10. ラスタ入力</a></span></dt><dt><span class="sect1"><a href="#Raster_Outputs">9.11. 出力</a></span></dt><dt><span class="sect1"><a href="#Raster_Processing">9.12. ラスタ処理</a></span></dt><dd><dl><dt><span class="sect2"><a href="#Raster_Processing_MapAlgebra">9.12.1. 地図代数</a></span></dt><dt><span class="sect2"><a href="#Raster_Processing_MapAlgebra_Callbacks">9.12.2. 組み込み地図代数コールバック関数</a></span></dt><dt><span class="sect2"><a href="#Raster_Processing_DEM">9.12.3. DEM (標高)</a></span></dt><dt><span class="sect2"><a href="#Raster_Processing_Geometry">9.12.4. ラスタからジオメトリ</a></span></dt></dl></dd><dt><span class="sect1"><a href="#RT_Operators">9.13. ラスタ演算子</a></span></dt><dt><span class="sect1"><a href="#Raster_Relationships">9.14. ラスタとラスタバンドの空間関係関数</a></span></dt><dt><span class="sect1"><a href="#Raster_Tips">9.15. ラスタに関する技法</a></span></dt><dd><dl><dt><span class="sect2"><a href="#outdb">9.15.1. データベース外ラスタ</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#RT_FAQ">10. PostGISラスタ よくある質問</a></span></dt><dt><span class="chapter"><a href="#Topology">11. トポロジ</a></span></dt><dd><dl><dt><span class="sect1"><a href="#Topology_Types">11.1. トポロジ型</a></span></dt><dt><span class="sect1"><a href="#Topology_Domains">11.2. トポロジドメイン</a></span></dt><dt><span class="sect1"><a href="#Topology_ManagementFunctions">11.3. トポロジ管理とTopoGeometry管理</a></span></dt><dt><span class="sect1"><a href="#Topology_Constructors">11.4. トポロジコンストラクタ</a></span></dt><dt><span class="sect1"><a href="#Topology_Editing">11.5. トポロジエディタ</a></span></dt><dt><span class="sect1"><a href="#Topology_Accessors">11.6. トポロジアクセサ</a></span></dt><dt><span class="sect1"><a href="#Topology_Processing">11.7. トポロジ処理</a></span></dt><dt><span class="sect1"><a href="#TopoGeometry_Constructors">11.8. TopoGeometryコンストラクタ</a></span></dt><dt><span class="sect1"><a href="#TopoGeometry_Editors">11.9. TopoGeometryエディタ</a></span></dt><dt><span class="sect1"><a href="#TopoGeom_Accessors">11.10. TopoGeometryアクセサ</a></span></dt><dt><span class="sect1"><a href="#TopoGeometry_Outputs">11.11. TopoGeometry出力</a></span></dt><dt><span class="sect1"><a href="#Topology_Relationships">11.12. トポロジ空間関係関数</a></span></dt></dl></dd><dt><span class="chapter"><a href="#Address_Standardizer">12. 住所標準化</a></span></dt><dd><dl><dt><span class="sect1"><a href="#Address_Standardizer_Basics">12.1. パーサの動作</a></span></dt><dt><span class="sect1"><a href="#Address_Standardizer_Types">12.2. 住所標準化の型</a></span></dt><dt><span class="sect1"><a href="#Address_Standardizer_Tables">12.3. 住所標準化テーブル</a></span></dt><dt><span class="sect1"><a href="#Address_Standardizer_Functions">12.4. 住所標準化関数</a></span></dt></dl></dd><dt><span class="chapter"><a href="#Extras">13. PostGIS追加機能</a></span></dt><dd><dl><dt><span class="sect1"><a href="#Tiger_Geocoder">13.1. Tigerジオコーダ</a></span></dt></dl></dd><dt><span class="chapter"><a href="#PostGIS_Special_Functions_Index">14. PostGIS関数索引</a></span></dt><dd><dl><dt><span class="sect1"><a href="#PostGIS_Aggregate_Functions">14.1. PostGIS集約関数</a></span></dt><dt><span class="sect1"><a href="#PostGIS_Window_Functions">14.2. PostGISウィンドウ関数</a></span></dt><dt><span class="sect1"><a href="#PostGIS_SQLMM_Functions">14.3. PostGIS SQL-MM準拠関数</a></span></dt><dt><span class="sect1"><a href="#PostGIS_GeographyFunctions">14.4. PostGISジオグラフィ対応関数</a></span></dt><dt><span class="sect1"><a href="#PostGIS_RasterFunctions">14.5. PostGISラスタ対応関数</a></span></dt><dt><span class="sect1"><a href="#PostGIS_Geometry_DumpFunctions">14.6. PostGISジオメトリ/ジオグラフィ/ラスタのダンプ関数</a></span></dt><dt><span class="sect1"><a href="#PostGIS_BoxFunctions">14.7. PostGISボックス関数</a></span></dt><dt><span class="sect1"><a href="#PostGIS_3D_Functions">14.8. 3次元対応PostGIS関数</a></span></dt><dt><span class="sect1"><a href="#PostGIS_Curved_GeometryFunctions">14.9. PostGIS曲線ジオメトリ対応関数</a></span></dt><dt><span class="sect1"><a href="#PostGIS_PS_GeometryFunctions">14.10. PostGIS多面体サーフェス対応関数</a></span></dt><dt><span class="sect1"><a href="#PostGIS_TypeFunctionMatrix">14.11. PostGIS関数対応マトリクス</a></span></dt><dt><span class="sect1"><a href="#NewFunctions">14.12. 新規作成/機能強化/変更されたPostGIS関数</a></span></dt><dd><dl><dt><span class="sect2"><a href="#NewFunctions_2_5">14.12.1. PostGIS 2.5で新規作成/機能強化された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_2_4">14.12.2. PostGIS 2.4で新規作成/機能強化された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_2_3">14.12.3. PostGIS 2.3で新規作成/機能強化された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_2_2">14.12.4. PostGIS 2.2で新規作成/機能強化された関数</a></span></dt><dt><span class="sect2"><a href="#ChangedFunctions_2_2">14.12.5. PostGIS 2.2で大幅に変更された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_2_1">14.12.6. PostGIS 2.1で新規作成/機能強化された関数</a></span></dt><dt><span class="sect2"><a href="#ChangedFunctions_2_1">14.12.7. PostGIS 2.1で大幅に変更された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_2_0">14.12.8. PostGIS 2.0で新規作成/機能強化/変更された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_2_0_Changed">14.12.9. PostGIS 2.0で変更された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_1_5">14.12.10. PostGIS 1.5で新規作成/機能強化/変更された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_1_4">14.12.11. PostGIS 1.4で新規作成/機能強化/変更された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_1_3">14.12.12. PostGIS 1.3で新規作成された関数</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#idp111106632">15. 問題を報告する</a></span></dt><dd><dl><dt><span class="sect1"><a href="#idp111107272">15.1. ソフトウェアのバグを報告する</a></span></dt><dt><span class="sect1"><a href="#idp111119944">15.2. 文書の問題を報告する</a></span></dt></dl></dd><dt><span class="appendix"><a href="#release_notes">A. 付録</a></span></dt><dd><dl><dt><span class="sect1"><a href="#idp111187528">A.1. Release 2.5.0</a></span></dt><dt><span class="sect1"><a href="#idp111209416">A.2. リリース 2.4.4</a></span></dt><dt><span class="sect1"><a href="#idp111217992">A.3. リリース 2.4.3</a></span></dt><dt><span class="sect1"><a href="#idp111222984">A.4. リリース 2.4.2</a></span></dt><dt><span class="sect1"><a href="#idp111226568">A.5. リリース 2.4.1</a></span></dt><dt><span class="sect1"><a href="#idp111263432">A.6. リリース 2.4.0</a></span></dt><dt><span class="sect1"><a href="#idp111281096">A.7. リリース 2.3.3</a></span></dt><dt><span class="sect1"><a href="#idp111287368">A.8. リリース 2.3.2</a></span></dt><dt><span class="sect1"><a href="#idp111291592">A.9. リリース 2.3.1</a></span></dt><dt><span class="sect1"><a href="#idp111297992">A.10. リリース 2.3.0</a></span></dt><dt><span class="sect1"><a href="#idp111333064">A.11. リリース 2.2.2</a></span></dt><dt><span class="sect1"><a href="#idp111339976">A.12. リリース 2.2.1</a></span></dt><dt><span class="sect1"><a href="#idp111351112">A.13. リリース 2.2.0</a></span></dt><dt><span class="sect1"><a href="#idp111429576">A.14. リリース 2.1.8</a></span></dt><dt><span class="sect1"><a href="#idp111434952">A.15. リリース 2.1.7</a></span></dt><dt><span class="sect1"><a href="#idp111438408">A.16. リリース 2.1.6</a></span></dt><dt><span class="sect1"><a href="#idp111459272">A.17. リリース 2.1.5</a></span></dt><dt><span class="sect1"><a href="#idp111469512">A.18. リリース 2.1.4</a></span></dt><dt><span class="sect1"><a href="#idp111517896">A.19. リリース 2.1.3</a></span></dt><dt><span class="sect1"><a href="#idp111524808">A.20. リリース 2.1.2</a></span></dt><dt><span class="sect1"><a href="#idp111561928">A.21. リリース 2.1.1</a></span></dt><dt><span class="sect1"><a href="#idp111576264">A.22. リリース 2.1.0</a></span></dt><dt><span class="sect1"><a href="#idp111699272">A.23. リリース 2.0.5</a></span></dt><dt><span class="sect1"><a href="#idp111717704">A.24. リリース 2.0.4</a></span></dt><dt><span class="sect1"><a href="#idp111742664">A.25. リリース 2.0.3</a></span></dt><dt><span class="sect1"><a href="#idp111755080">A.26. リリース 2.0.2</a></span></dt><dt><span class="sect1"><a href="#idp111826632">A.27. リリース 2.0.1</a></span></dt><dt><span class="sect1"><a href="#idp111866440">A.28. リリース 2.0.0</a></span></dt><dt><span class="sect1"><a href="#idp111926216">A.29. リリース 1.5.4</a></span></dt><dt><span class="sect1"><a href="#idp111949512">A.30. リリース 1.5.3</a></span></dt><dt><span class="sect1"><a href="#idp111978056">A.31. リリース 1.5.2</a></span></dt><dt><span class="sect1"><a href="#idp111994696">A.32. リリース 1.5.1</a></span></dt><dt><span class="sect1"><a href="#idp112004168">A.33. リリース 1.5.0</a></span></dt><dt><span class="sect1"><a href="#idp112026056">A.34. リリース 1.4.0</a></span></dt><dt><span class="sect1"><a href="#idp112070984">A.35. リリース 1.3.6</a></span></dt><dt><span class="sect1"><a href="#idp112072520">A.36. リリース 1.3.5</a></span></dt><dt><span class="sect1"><a href="#idp112074056">A.37. リリース 1.3.4</a></span></dt><dt><span class="sect1"><a href="#idp112075976">A.38. リリース 1.3.3</a></span></dt><dt><span class="sect1"><a href="#idp112077512">A.39. リリース 1.3.2</a></span></dt><dt><span class="sect1"><a href="#idp112079048">A.40. リリース 1.3.1</a></span></dt><dt><span class="sect1"><a href="#idp112080584">A.41. リリース 1.3.0</a></span></dt><dt><span class="sect1"><a href="#idp112088136">A.42. リリース 1.2.1</a></span></dt><dt><span class="sect1"><a href="#idp112092488">A.43. リリース 1.2.0</a></span></dt><dt><span class="sect1"><a href="#idp112095688">A.44. リリース 1.1.6</a></span></dt><dt><span class="sect1"><a href="#idp112118344">A.45. リリース 1.1.5</a></span></dt><dt><span class="sect1"><a href="#idp112128456">A.46. リリース 1.1.4</a></span></dt><dt><span class="sect1"><a href="#idp112159816">A.47. リリース 1.1.3</a></span></dt><dt><span class="sect1"><a href="#idp112179400">A.48. リリース 1.1.2</a></span></dt><dt><span class="sect1"><a href="#idp112191816">A.49. リリース 1.1.1</a></span></dt><dt><span class="sect1"><a href="#idp112203720">A.50. リリース 1.1.0</a></span></dt><dt><span class="sect1"><a href="#idp112233288">A.51. リリース 1.0.6</a></span></dt><dt><span class="sect1"><a href="#idp112247752">A.52. リリース 1.0.5</a></span></dt><dt><span class="sect1"><a href="#idp112260168">A.53. リリース 1.0.4</a></span></dt><dt><span class="sect1"><a href="#rel_1.0.3_upgrading">A.54. リリース 1.0.3</a></span></dt><dt><span class="sect1"><a href="#idp112286280">A.55. リリース 1.0.2</a></span></dt><dt><span class="sect1"><a href="#idp112294088">A.56. リリース 1.0.1</a></span></dt><dt><span class="sect1"><a href="#idp112303816">A.57. リリース 1.0.0</a></span></dt><dt><span class="sect1"><a href="#idp112313160">A.58. リリース 1.0.0RC6</a></span></dt><dt><span class="sect1"><a href="#idp112320712">A.59. リリース 1.0.0RC5</a></span></dt><dt><span class="sect1"><a href="#idp112327752">A.60. リリース 1.0.0RC4</a></span></dt><dt><span class="sect1"><a href="#idp112340168">A.61. リリース 1.0.0RC3</a></span></dt><dt><span class="sect1"><a href="#idp112356808">A.62. リリース 1.0.0RC2</a></span></dt><dt><span class="sect1"><a href="#idp112391368">A.63. リリース 1.0.0RC1</a></span></dt></dl></dd></dl></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="postgis_introduction"></a>第1章 導入</h1></div></div></div><div class="toc"><p><b>目次</b></p><dl class="toc"><dt><span class="sect1"><a href="#psc">1.1. プロジェクト運営委員会</a></span></dt><dt><span class="sect1"><a href="#credits_core_present">1.2. 現在の中核貢献者</a></span></dt><dt><span class="sect1"><a href="#credits_core_past">1.3. 過去の中核貢献者</a></span></dt><dt><span class="sect1"><a href="#credits_other_contributors">1.4. 他の貢献者</a></span></dt><dt><span class="sect1"><a href="#idp64587848">1.5. 追加情報 </a></span></dt></dl></div><p>PostGISは、PostgreSQLリレーショナルデータベースに空間拡張を施すものです。Refractions Research Incが、空間データベース技術の研究プロジェクトとして開発しました。Refractionsはカナダ・ブリティッシュコロンビア州・ビクトリアにある、データインテグレーションとカスタムソフトウェア開発に特化した、GISとデータベースのコンサルティング会社です。</p><p>PostGISはOSGeo財団のプロジェクトです。PostGISは、多数のFOSS4G開発者と、PostGISの機能と多彩さから大きな利益を得る世界中の企業によって継続的に改善され、資金を得ています。</p><p>PostGISプロジェクトの開発グループは、PostGISが、OpenGISとSQL/MM空間標準の領域における重要なGIS機能、高度なトポロジ構築 (カバレッジ、サーフェス、ネットワーク)、GISデータの表示と編集を行うデスクトップユーザインタフェースツール、およびウェブベースのアクセスツールのためのデータソースに、より良く対応するよう、サポートと機能強化を行う予定です。</p><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="psc"></a>1.1. プロジェクト運営委員会</h2></div></div></div><p>PostGISプロジェクト運営委員会 (PostGIS Project Steering Committee, PSC)は、総合的な指示、リリースサイクル、ドキュメンテーション、支援活動に関する調整を行っています。また、委員会は、全体的なユーザサポート、PostGISコミュニティからのパッチの受け付けと適用、 開発者のコミットのアクセス、新しい委員、APIの重要な変更といった、PostGISを含む雑多な問題に関する投票を行っています。 </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Mark Cave-Ayland</span></dt><dd><p>誤り修正とメンテナンスの調整、空間インデクスの選択とバインディング、ローダ/ダンパ、シェープファイルGUIローダ、新機能の統合と強化。</p></dd><dt><span class="term">Regina Obe</span></dt><dd><p>Buildbotのメンテナンス、Windows版と試験版のビルド、ドキュメンテーション、PostgreSQLとの調整、PostGISニュースグループの一般的なユーザサポート、X3D対応、Tiger Geocoder機能、関数管理、新機能と大きなコード変更のスモークテスト。</p></dd><dt><span class="term">Bborie Park</span></dt><dd><p>ラスタ開発、GDALとの統合、ラスタローダ、ユーザサポート、一般的なバグフィクス、様々なOS (Slackware, Mac, Windows他)での試験。</p></dd><dt><span class="term">Paul Ramsey (委員長)</span></dt><dd><p>PostGISプロジェクトの副創始者。総合的なバグフィクス、ジオグラフィ機能、ジオグラフィとジオメトリのインデクス機能 (2次元,、3次元、n次元インデクスとあらゆる空間インデクス)、ジオメトリ内部構造、PointCloud (開発中)、GEOS機能の統合とGEOSリリースとの調整、PostgreSQLのリリースとの調整、ローダ/ダンパ、シェープファイルGUIローダ。</p></dd><dt><span class="term">Sandro Santilli</span></dt><dd><p>誤り修正とメンテナンス、gitミラーの管理、新しいGEOS機能のメンテナンス、GEOSリリースとの調整、トポロジ機能、ラスタフレームワークと低水準API関数。</p></dd></dl></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="credits_core_present"></a>1.2. 現在の中核貢献者</h2></div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Jorge Arévalo</span></dt><dd><p>ラスタ開発、GDALドライバ機能、ローダ。</p></dd><dt><span class="term">Nicklas Avén</span></dt><dd><p>距離関数の強化 (3次元距離、関係関数を含む)と追加、Tiny WKB出力書式（TWKB, 開発中）と一般的なユーザサポート。</p></dd><dt><span class="term">Dan Baston</span></dt><dd><p>ジオメトリクラスタリング関数の追加、他のジオメトリアルゴリズムの強化、GEOSの強化、および全体のユーザ対応</p></dd><dt><span class="term">Olivier Courtin</span></dt><dd><p>XML (KML, GML)/GeoJSON入出力関数と3次元サポートとバグフィクス。</p></dd><dt><span class="term">Björn Harrtell</span></dt><dd><p>MapBox Vector Tile関数とGeoBuf関数、Gogsの試験とGitLabの実験。</p></dd><dt><span class="term">Mateusz Loskot</span></dt><dd><p>PostGISのCMakeサポート。オリジナルのPython版ラスタローダ低水準ラスタAPI関数の以前の開発。</p></dd><dt><span class="term">Raúl Marín Rodríguez</span></dt><dd><p>誤り修正</p></dd><dt><span class="term">Darafei Praliaskouski</span></dt><dd><p>インデクス改善、誤り修正とジオメトリ/ジオグラフィ関数の改善、GitHub担当、Travis Botのメンテナンス。</p></dd><dt><span class="term">Pierre Racine</span></dt><dd><p>ラスタ全体のアーキテクチャ、プロトタイピング、プログラミング支援。</p></dd></dl></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="credits_core_past"></a>1.3. 過去の中核貢献者</h2></div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Chris Hodgson</span></dt><dd><p>以前のPSCメンバ。一般的な開発、サイトとBuildbotのメンテナンス、OSGeoインキュベーション管理。</p></dd><dt><span class="term">Kevin Neufeld</span></dt><dd><p>以前のPSCメンバ。文書と文書補助ツール、Buildbotのメンテナンス、PostGISニュースグループでの高度なユーザサポート、PostGISメンテナンス機能の強化。</p></dd><dt><span class="term">Dave Blasby</span></dt><dd><p>PostGISのオリジナルの開発/副創始者。サーバサイドのオブジェクト、インデクスのバインディングや多数のサーバサイドの解析機能を記述。</p></dd><dt><span class="term">Jeff Lounsbury</span></dt><dd><p>シェープファイルのローダ/ダンパのオリジナルの開発者。現在のPostGISプロジェクトオーナーの代表。</p></dd><dt><span class="term">Mark Leslie</span></dt><dd><p>中核機能の、継続的なメンテナンスと開発。曲線機能の強化。シェープファイルGUIローダ。</p></dd><dt><span class="term">David Zwarg</span></dt><dd><p>ラスタ開発 (ほとんど地図代数解析関数)。</p></dd></dl></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="credits_other_contributors"></a>1.4. 他の貢献者</h2></div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">個人</span></dt><dd><p>アルファベット順: Alex Bodnaru, Alex Mayrhofer, Andrea Peri, Andreas Forø Tollefsen, Andreas Neumann, Anne Ghisla, Barbara Phillipot, Ben Jubb, Bernhard Reiter, Brian Hamlin, Bruce Rindahl, Bruno Wolff III, Bryce L. Nordgren, Carl Anderson, Charlie Savage, Dane Springmeyer, David Skea, David Techer, Eduin Carrillo, Even Rouault, Frank Warmerdam, George Silva, Gerald Fenoy, Gino Lucrezi, Guillaume Lelarge, IIDA Tetsushi, Ingvild Nystuen, Jason Smith, Jeff Adams, Jose Carlos Martinez Llari, Julien Rouhaud, Kashif Rasul, Klaus Foerster, Kris Jurka, Leo Hsu, Loic Dachary, Luca S. Percich, Maria Arias de Reyna, Mark Sondheim, Markus Schaber, Maxime Guillaud, Maxime van Noppen, Michael Fuhr, Mike Toews, Nathan Wagner, Nathaniel Clay, Nikita Shulga, Norman Vine, Rafal Magda, Ralph Mason, Rémi Cura, Richard Greenwood, Silvio Grosso, Steffen Macke, Stephen Frost, Tom van Tilburg, Vincent Mora, Vincent Picavet </p></dd><dt><span class="term">企業</span></dt><dd><p>PostGISプロジェクトへの開発時間、ホスティング、直接的な金銭提供の貢献を行った企業です。</p><p>アルファベット順: Arrival 3D, Associazione Italiana per l'Informazione Geografica Libera (GFOSS.it), AusVet, Avencia, Azavea, Cadcorp, CampToCamp, CartoDB, City of Boston (DND), Clever Elephant Solutions, Cooperativa Alveo, Deimos Space, Faunalia, Geographic Data BC, Hunter Systems Group, Lidwala Consulting Engineers, LisaSoft, Logical Tracking &amp; Tracing International AG, Maponics, Michigan Tech Research Institute, Natural Resources Canada, Norwegian Forest and Landscape Institute, Boundless (former OpenGeo), OSGeo, Oslandia, Palantir Technologies, Paragon Corporation, R3 GIS, Refractions Research, Regione Toscana - SITA, Safe Software, Sirius Corporation plc, Stadt Uster, UC Davis Center for Vectorborne Diseases, University of Laval, U.S Department of State (HIU), Zonar Systems</p></dd><dt><span class="term">クラウドファンディングキャンペーン</span></dt><dd><p>クラウドファンディングキャンペーンは、PostGIS開発チームが走らせているキャンペーンです。欲しくて仕方ない機能に資金を与えて、多数の人々にサービスを提供できるようにするためのものです。それぞれのキャンペーンでは、特定の機能または機能の集合に焦点があてられます。それぞれのスポンサーは、必要な資金提供のうち少しだけを提供し、十分な人/組織の寄付で、たくさんの助けになる作業に支払う基金を持ちます。他の多くの人が寄付に協力してくれそうな機能に関するアイデアがありましたら、<a class="ulink" href="https://lists.osgeo.org/mailman/listinfo/postgis-users" target="_top">PostGIS newsgroup</a>に、その考えを投稿して下さい。一緒に実現できます。 </p><p>PostGIS 2.0.0はこの戦略を実施する最初のリリースです。<a class="ulink" href="http://www.pledgebank.com" target="_top">PledgeBank</a>を使い、2件のキャンペーンが成功しました。</p><p><a class="ulink" href="http://www.pledgebank.com/postgistopology" target="_top"><span class="bold"><strong>postgistopology</strong></span></a> - 10以上のスポンサーがTopoGeometry機能の構築と2.0.0でのトポロジ対応強化とのために、それぞれ250米ドルを寄付しました。</p><p><a class="ulink" href="http://www.pledgebank.com/postgis64windows" target="_top"><span class="bold"><strong>postgis64windows</strong></span></a>  - 20のスポンサーが, Windows上でのPostGIS 64ビット版に必要な作業のために、それぞれ100米ドルを寄付しました。64ビット用PostGIS 2.0.1ができ、PostgreSQLスタックビルダで使用可能なリリースを予定している最終版ができました。</p></dd><dt><span class="term">重要なサポートライブラリ </span></dt><dd><p>ジオメトリ演算ライブラリ<a class="ulink" href="http://trac.osgeo.org/geos/" target="_top">GEOS</a>は、Martin Davisがアルゴリズムを作成し、Mateusz Loskot, Sandro Santilli (strk), Paul Ramseyらで動作するようにし、メンテナンスとサポートの進行を行っています。</p><p>地理空間データ抽出ライブラリ<a class="ulink" href="http://trac.osgeo.org/gdal/" target="_top">GDAL</a>はFrank Warmerdamらによります。PostGIS 2.0.0で導入されたラスタ機能で、非常によく使われています。 同じように、PostGISサポートに関するGDALの必要な改善でGDALプロジェクトに貢献しています。</p><p>地図投影ライブラリ<a class="ulink" href="http://trac.osgeo.org/proj/" target="_top">Proj4</a>は、Gerald EvendenとFrank Warmerdamによって作成とメンテナンスがされています。</p><p>最後ですがおろそかにできないのが<a class="ulink" href="http://www.postgresql.org/" target="_top">PostgreSQL DBMS</a>です。PostGISはこの巨人の肩に乗っています。PostGISの速度と柔軟性はPostgreSQLが提供する拡張性、偉大なクエリプランナ、GiSTインデクス、多数のSQL機能がないと成り立ちません。</p></dd></dl></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp64587848"></a>1.5. 追加情報 </h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>最新のソフトウェア、ドキュメントおよびニュースについてはPostGISウェブサイト<a class="ulink" href="http://postgis.net/" target="_top">http://postgis.net/</a>をご覧下さい。</p></li><li class="listitem"><p>ジオメトリ演算ライブラリGEOSに関する詳細情報は<a class="ulink" href="http://trac.osgeo.org/geos/" target="_top">http://trac.osgeo.org/geos/</a>をご覧下さい。</p></li><li class="listitem"><p>投影変換ライブラリProj4に関する詳細情報は<a class="ulink" href="http://trac.osgeo.org/proj/" target="_top">http://trac.osgeo.org/proj/</a>をご覧下さい。</p></li><li class="listitem"><p>データベースサーバPostgreSQLに関する詳細情報は、 PostgreSQLメインサイト<a class="ulink" href="http://www.postgresql.org/" target="_top">http://www.postgresql.org/</a>をご覧下さい。</p></li><li class="listitem"><p>GiSTインデクスに関する詳細情報は、PostgreSQL GiST開発サイト<a class="ulink" href="http://www.sai.msu.su/~megera/postgres/gist/" target="_top">http://www.sai.msu.su/~megera/postgres/gist/</a>をご覧下さい。</p></li><li class="listitem"><p>インターネットマップサーバMapServerに関する詳細情報は <a class="ulink" href="http://mapserver.org/" target="_top">http://mapserver.org/</a>をご覧下さい。</p></li><li class="listitem"><p>"<a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">Simple Features for Specification for SQL</a>"は、OpenGISコンソーシアムウェブサイト<a class="ulink" href="http://www.opengeospatial.org/" target="_top">http://www.opengeospatial.org/</a>にあります。</p></li></ul></div></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="postgis_installation"></a>第2章 PostGISインストール</h1></div></div></div><div class="toc"><p><b>目次</b></p><dl class="toc"><dt><span class="sect1"><a href="#install_short_version">2.1. 簡略版</a></span></dt><dt><span class="sect1"><a href="#install_requirements">2.2. インストール要件</a></span></dt><dt><span class="sect1"><a href="#install_getting_source">2.3. ソースの取得</a></span></dt><dt><span class="sect1"><a href="#PGInstall">2.4. ソースからのコンパイルとインストール: 詳細</a></span></dt><dd><dl><dt><span class="sect2"><a href="#installation_configuration">2.4.1. コンフィギュレーション</a></span></dt><dt><span class="sect2"><a href="#idp64883912">2.4.2. ビルド</a></span></dt><dt><span class="sect2"><a href="#make_install_postgis_extensions">2.4.3. PostGISエクステンションのビルドとデプロイ</a></span></dt><dt><span class="sect2"><a href="#idp64917576">2.4.4. テスト</a></span></dt><dt><span class="sect2"><a href="#idp64990152">2.4.5. インストール</a></span></dt></dl></dd><dt><span class="sect1"><a href="#create_new_db_extensions">2.5. エクステンションを使った空間データベースの生成</a></span></dt><dt><span class="sect1"><a href="#create_new_db">2.6. 空間データベースをエクステンションを使わずに生成する</a></span></dt><dt><span class="sect1"><a href="#installing_pagc_address_standardizer">2.7. PAGC住所標準化ツールのインストールと使用</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp65048136">2.7.1. Regex::Assembleのインストール</a></span></dt></dl></dd><dt><span class="sect1"><a href="#loading_extras_tiger_geocoder">2.8. Tigerジオコーダのインストールとアップグレードとデータロード</a></span></dt><dd><dl><dt><span class="sect2"><a href="#install_tiger_geocoder_extension">2.8.1. TigerジオコーダをPostGISデータベースで有効にする: エクステンションを使用</a></span></dt><dt><span class="sect2"><a href="#install_tiger_geocoder">2.8.2. TigerジオコーダをPostGISデータベースで有効にする: エクステンション不使用</a></span></dt><dt><span class="sect2"><a href="#tiger_pagc_address_standardizing">2.8.3. TigerジオコーダをPostGISデータベースで有効にする: エクステンションを使用</a></span></dt><dt><span class="sect2"><a href="#tiger_geocoder_loading_data">2.8.4. Tigerデータのロード</a></span></dt><dt><span class="sect2"><a href="#upgrade_tiger_geocoder">2.8.5. Tigerジオコーダのアップグレード</a></span></dt></dl></dd><dt><span class="sect1"><a href="#templatepostgis">2.9. 空間データベースをテンプレートから生成する</a></span></dt><dt><span class="sect1"><a href="#upgrading">2.10. アップグレード</a></span></dt><dd><dl><dt><span class="sect2"><a href="#soft_upgrade">2.10.1. ソフトアップグレード </a></span></dt><dt><span class="sect2"><a href="#hard_upgrade">2.10.2. ハードアップグレード</a></span></dt></dl></dd><dt><span class="sect1"><a href="#idp65278536">2.11. 共通の問題</a></span></dt><dt><span class="sect1"><a href="#idp65308232">2.12. ローダ/ダンパ </a></span></dt></dl></div><p>本章では、PostGISのインストールに必要な手順について説明します。 </p><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="install_short_version"></a>2.1. 簡略版</h2></div></div></div><p>全ての依存がパスに入っているとする場合、次のようにコンパイルします。</p><pre class="programlisting">tar xvfz postgis-2.5.0.tar.gz
cd postgis-2.5.0
./configure
make
make install</pre><p>PostGISをインストールした後は、利用したいデータベース個々内で利用可能にする必要があります。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ラスタ機能は現在はオプションですが、デフォルトではインストールされます。PostgreSQL 9.1以上のエクステンションモデルを使ってインストールするには必須です。エクステンションを有効にする処理の方がよりよく、かつユーザフレンドリです。空間データベースを有効にするには、次のようにします。</p></td></tr></table></div><pre class="programlisting">psql -d yourdatabase -c "CREATE EXTENSION postgis;"
psql -d yourdatabase -c "CREATE EXTENSION postgis_topology;"
-- SFCGAL対応でビルドした場合は次を実行 --
psql -d yourdatabase -c "CREATE EXTENSION postgis_sfcgal;"

-- Tigerジオコーダをインストールしたい場合は次の二つを実行 --
psql -d yourdatabase -c "CREATE EXTENSION fuzzystrmatch"
psql -d yourdatabase -c "CREATE EXTENSION postgis_tiger_geocoder;"

-- PCRE付きでインストールした場合は
-- 住所標準化エクステンションも持つべきです
psql -d yourdatabase -c "CREATE EXTENSION address_standardizer;"
</pre><p>インストールされて有効になっているEXTENSIONのクエリやEXTENSIONのアップグレード、EXTENSIONを使わずにインストールした場合のEXTENSIONへの切り替えに関する詳細情報については、<a class="xref" href="#make_install_postgis_extensions" title="2.4.3. PostGISエクステンションのビルドとデプロイ">「PostGISエクステンションのビルドとデプロイ」</a>を参照して下さい。</p><p>なんらかの理由で、ラスタ機能なしでコンパイルするか古いやり方でインストールする場合には、より長く、より苦痛を伴いますが、やり方はあります。</p><p>インストールされた.sqlファイルは全てPostgreSQLがインストールされているフォルダ内のshare/contrib/postgis-2.4の中にあります。</p><pre class="programlisting">createdb yourdatabase
createlang plpgsql yourdatabase
psql -d yourdatabase -f postgis.sql
psql -d yourdatabase -f postgis_comments.sql
psql -d yourdatabase -f spatial_ref_sys.sql
psql -d yourdatabase -f topology.sql
psql -d yourdatabase -f topology_comments.sql

-- raster (GDAL)付きでコンパイルした場合のみ
psql -d yourdatabase -f rtpostgis.sql
psql -d yourdatabase -f raster_comments.sql

-- SFCGAL対応でビルドした場合 --
psql -d yourdatabase -f sfcgal.sql
psql -d yourdatabase -f sfcgal_comments.sql
</pre><p>本章の残りでは、上記のインストール手順の個々の詳細を見ていきます。 </p><p>PostGIS 2.1.3では、データベース外ラスタと全てのラスタドライバは、デフォルトでは無効になっています。これらを有効にするには、サーバ上で、環境変数<code class="varname">POSTGIS_GDAL_ENABLED_DRIVERS</code>と<code class="varname">POSTGIS_ENABLE_OUTDB_RASTERS</code>を設定します。PostGIS 2.2では、<a class="xref" href="#PostGIS_GUC" title="8.2. PostGIS GUC (Grand Unified Custom)変数">「PostGIS GUC (Grand Unified Custom)変数」</a>に従って設定する、クロスプラットフォームな手法があります。</p><p>データベース外ラスタを有効にするには次のようにします。</p><pre class="programlisting">POSTGIS_ENABLE_OUTDB_RASTERS=1</pre><p>他の値を入れたり、値を入れない場合には、データベース外ラスタは無効になります。</p><p>インストールしたGDALのドライバを有効にするには、次の環境変数を設定します。</p><pre class="programlisting">POSTGIS_GDAL_ENABLED_DRIVERS=ENABLE_ALL</pre><p>一部のドライバのみ有効にしたい場合には、環境変数を次のように設定します。</p><pre class="programlisting">POSTGIS_GDAL_ENABLED_DRIVERS="GTiff PNG JPEG GIF XYZ"</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Windows上の場合は、ドライバリストに引用符をつけないで下さい。</p></td></tr></table></div><p>環境変数の設定はOSによって変わります。UbuntuやDebian上でapt-postgresqlからインストールしたPostgreSQLの場合には、<code class="filename">/etc/postgresql/<em class="replaceable"><code>10</code></em>/<em class="replaceable"><code>main</code></em>/environment</code>を編集するのが好まれます。なお、10はPostgreSQLの版を指し、mainはクラスタを示します。</p><p>Windowsでサービスとして実行している場合には、システム変数で設定します。Windows 7では、コンピュータを右クリックしてプロパティをクリックするか、エクスプローラの検索バーに<code class="varname">コントロール パネル\すべてのコントロール パネル項目\システム</code>を指定します。<span class="emphasis"><em>システムの詳細設定 -&gt; 詳細設定 -&gt; 環境変数</em></span>を順にクリックして、新しいシステム環境変数を追加します。</p><p>環境変数を設定した後は、設定を反映させるために、PostgreSQLサービスの再起動が必要です。</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="install_requirements"></a>2.2. インストール要件</h2></div></div></div><p>PostGISのビルドと利用のために、次のものが必要です。 </p><p>
	  <span class="bold"><strong>必須</strong></span>
	</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>PostgreSQL 9.4以上。PostgreSQLの完全なインストール (サーバヘッダを含む)が必要です。PostgreSQLは<a class="ulink" href="http://www.postgresql.org/" target="_top"> http://www.postgresql.org/</a>にあります。 </p><p>完全なPosgreSQL/PostGIS対応表とPostGIS/GEOS対応表については<a class="ulink" href="http://trac.osgeo.org/postgis/wiki/UsersWikiPostgreSQLPostGIS" target="_top">http://trac.osgeo.org/postgis/wiki/UsersWikiPostgreSQLPostGIS</a>をご覧ください。 </p></li><li class="listitem"><p>GNU Cコンパイラ (<code class="filename">gcc</code>)。ANSI Cコンパイラの中には、PostGISをコンパイルできるものもありますが、<code class="filename">gcc</code>でコンパイルするのが最も問題が少ないと見ています。 </p></li><li class="listitem"><p>GNU Make (<code class="filename">gmake</code>または<code class="filename">make</code>)。多くのシステムで、GNU makeがデフォルトのmakeになっています。<code class="filename">make -v</code>を実行して版を確認して下さい。他版の<code class="filename">make</code>では、PostGISの<code class="filename">Makefile</code>を完全に処理しきれないかもしれません。 </p></li><li class="listitem"><p>投影変換ライブラリ Proj4 の 4.9.0版以上。地理座標系の改善の利点を得るには、Proj4 4.9以上が必要です。Proj4ライブラリは、PostGISの座標系投影変換機能に使われます。Proj4は、<a class="ulink" href="http://trac.osgeo.org/proj/" target="_top">http://trac.osgeo.org/proj/</a>からダウンロードできます。 </p></li><li class="listitem"><p>ジオメトリライブラリGEOSの3.５版以上。新しい関数や機能の全てを得るために、GEOS 3.7以上を推奨します。少なくともGEOS 3.5は持つべきで、<a class="xref" href="#ST_ClipByBox2D" title="ST_ClipByBox2D">ST_ClipByBox2D</a>や<a class="xref" href="#ST_Subdivide" title="ST_Subdivide">ST_Subdivide</a>のような機能強化が使えません。GEOSは<a class="ulink" href="http://trac.osgeo.org/geos/" target="_top">http://trac.osgeo.org/geos/</a>からダウンロードできます。3.5以上は古い版との後方互換があり、アップグレードがかなり安全です。 </p></li><li class="listitem"><p>LibXML2の2.5.x以上。LibXML2は現在取り込み関数 (ST_GeomFromGMLとST_GeomFromKML)で使っています。LibXML2は<a class="ulink" href="http://xmlsoft.org/downloads.html" target="_top">http://xmlsoft.org/downloads.html</a>からダウンロード可能です。 </p></li><li class="listitem"><p>JSON-C 0.9以上。JSON-Cは現在、ST_GeomFromGeoJsonによるGeoJSONの取り込みに使われます。JSON-Cは<a class="ulink" href="https://github.com/json-c/json-c/releases/" target="_top">https://github.com/json-c/json-c/releases/</a>からダウンロード可能です。 </p></li><li class="listitem"><p>GDAL 1.8以上 (古い版では一部機能が働かなかったり挙動が異なるので1.9以上を強く推奨します)。ラスタ機能に必要で、<code class="code">CREATE EXTENSION postgis</code>でのインストールに必要となります。このため、PostgreSQL 9.1以上での使用では非常に推奨されます<a class="ulink" href="http://trac.osgeo.org/gdal/wiki/DownloadSource/" target="_top">http://trac.osgeo.org/gdal/wiki/DownloadSource/</a>からダウンロード可能です。 </p></li><li class="listitem"><p>このパラメータは現在のところ壊れていて、PostgreSQLのインストール先にしかインストールされません。このバグのトラックについては<a class="ulink" href="http://trac.osgeo.org/postgis/ticket/635" target="_top">http://trac.osgeo.org/postgis/ticket/635</a>をご覧ください。 </p></li></ul></div><p>
	  <span class="bold"><strong>オプション</strong></span>
	</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>GDAL (実質必須)。ラスタを求めておらず、かつ<code class="code">CREATE EXTENSION postgis</code>によるインストールを気にしない場合に限って放置できます。他のEXTENSIONで、PostGISをEXTENSIONとしてインストールしないと、インストールできないものがあるかも知れないことを心にとどめておいて下さい。このため、GDAL対応でのコンパイルは、非常に望まれます。 </p><p>ドライバを有効にするには<a class="xref" href="#install_short_version" title="2.1. 簡略版">「簡略版」</a>を参照してください。</p></li><li class="listitem"><p>GTK (GTK+2.0, 2.8+が必要)。シェープファイルのローダであるshp2pgsql-guiのコンパイル用です。<a class="ulink" href="http://www.gtk.org/" target="_top">http://www.gtk.org/</a>にあります。 </p></li><li class="listitem"><p>SFCGAL 1.1版以上。追加的な2次元や3次元の高度な解析関数をPostGISで使うために使用するものです。<a class="xref" href="#reference_sfcgal" title="8.10. SFCGAL関数">「SFCGAL関数」</a>をご覧下さい。また、GEOSを使う2次元関数のうちいくつか (たとえばST_IntersectionやST_Area)は、GEOSでなくSFCGALを使用することができます。PostgreSQLコンフィギュレーション変数<code class="code">postgis.backend</code>によって、SFCGALがインストールされている場合にはエンドユーザがバックエンドを制御することができます (デフォルトではGEOS)。SFCGAL 1.2は少なくともCGAL 4.3とBoost 1.54 (<a class="ulink" href="http://oslandia.github.io/SFCGAL/installation.html" target="_top">http://oslandia.github.io/SFCGAL/installation.html</a>をご覧下さい)が必要ですのでご注意下さい。<a class="ulink" href="https://github.com/Oslandia/SFCGAL" target="_top">https://github.com/Oslandia/SFCGAL</a>にあります。 </p></li><li class="listitem"><p><a class="xref" href="#Address_Standardizer" title="第12章 住所標準化">12章<i>住所標準化</i></a>をビルドするには、PCRE <a class="ulink" href="http://www.pcre.org" target="_top">http://www.pcre.org</a> (Unix系システムには通常はインストール済みです)も必要です。<code class="filename">parseaddress-stcities.h</code>内のエンコードしたデータを再構築したい場合には、Perl CPANの<code class="code">Regex::Assemble</code>パッケージのみ必要です。<a class="xref" href="#Address_Standardizer" title="第12章 住所標準化">12章<i>住所標準化</i></a>は、PCREライブラリを検出するか、コンフィギュレーションで適切に<code class="varname">--with-pcre-dir=/path/to/pcre</code>を指定すると、自動的にビルドされます。 </p></li><li class="listitem"><p>ST_AsMVTを有効にするには、protobuf-cライブラリ (実行時)とprotoc-cコンパイラ (ビルド時)が必要です。protobuf-cの正しい最小版を確認するには、pkg-configが必要です。<a class="ulink" href="https://github.com/protobuf-c/protobuf-c" target="_top">protobuf-c</a>をご覧下さい。 </p></li><li class="listitem"><p>CUnit (<code class="filename">CUnit</code>)。レグレッションテストに必要です。<a class="ulink" href="http://cunit.sourceforge.net/" target="_top">http://cunit.sourceforge.net/</a>にあります。 </p></li><li class="listitem"><p>DocBook (<code class="filename">xsltproc</code>)。文書のビルドに必要です。<a class="ulink" href="http://www.docbook.org/" target="_top">http://www.docbook.org/</a>にあります。 </p></li><li class="listitem"><p>DBLatex (<code class="filename">dblatex</code>)。文書をPDFでビルドするのに必要です。<a class="ulink" href="http://dblatex.sourceforge.net/" target="_top">http://dblatex.sourcforge.net/</a>にあります。 </p></li><li class="listitem"><p>ImageMagick (<code class="filename">convert</code>)。文書で使う画像を生成するのに必要です。<a class="ulink" href="http://www.imagemagick.org/" target="_top">http://www.imagemagick.org/</a>にあります。 </p></li></ul></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="install_getting_source"></a>2.3. ソースの取得</h2></div></div></div><p>ダウンロードサイト<a class="ulink" href="http://download.osgeo.org/postgis/source/postgis-2.5.0.tar.gz" target="_top">http://download.osgeo.org/postgis/source/postgis-2.5.0.tar.gz</a>からソースのアーカイブを入手します。 </p><pre class="programlisting">wget http://download.osgeo.org/postgis/source/postgis-2.5.0.tar.gz
tar -xvzf postgis-2.5.0.tar.gz</pre><p>これで、カレントディレクトリの下に<code class="varname">postgis-2.5.0</code>ができます。 </p><p>もしくは<a class="ulink" href="http://subversion.apache.org/" target="_top">svn</a>レポジトリ<a class="ulink" href="http://svn.osgeo.org/postgis/trunk/" target="_top">http://svn.osgeo.org/postgis/trunk/</a>からチェックアウトします。 </p><pre class="programlisting">svn checkout http://svn.osgeo.org/postgis/trunk/ postgis-2.5.0</pre><p>新しく作られた<code class="varname">postgis-2.5.0</code>ディレクトトリに移動して、インストールを続けます。 </p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="PGInstall"></a>2.4. ソースからのコンパイルとインストール: 詳細</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="#installation_configuration">2.4.1. コンフィギュレーション</a></span></dt><dt><span class="sect2"><a href="#idp64883912">2.4.2. ビルド</a></span></dt><dt><span class="sect2"><a href="#make_install_postgis_extensions">2.4.3. PostGISエクステンションのビルドとデプロイ</a></span></dt><dt><span class="sect2"><a href="#idp64917576">2.4.4. テスト</a></span></dt><dt><span class="sect2"><a href="#idp64990152">2.4.5. インストール</a></span></dt></dl></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>多くのOSで、ビルドされたPostgreSQL/PostGISパッケージがあります。多くの場合、コンパイルが必要なのは、最もひどい最先端の版が欲しい場合やパッケージメンテナンスを行う人ぐらいです。 </p><p>本節では、一般的なコンパイル手順を示します。Windows用や他のOS用等にコンパイルするなら、<a class="ulink" href="http://trac.osgeo.org/postgis/wiki/UsersWikiInstall" target="_top">PostGIS User contributed compile guides</a>や<a class="ulink" href="http://trac.osgeo.org/postgis/wiki/DevWikiMain" target="_top">PostGIS Dev Wiki</a>で、より詳細な助けが見つかるかも知れません。</p><p>多くのOS用のビルド済みパッケージの一覧は<a class="ulink" href="http://trac.osgeo.org/postgis/wiki/UsersWikiPackages" target="_top">PostGIS Pre-built Packages</a>にあります。</p><p>Windowsユーザの場合は、スタックビルダか、<a class="ulink" href="http://www.postgis.org/download/windows/" target="_top">PostGIS Windows download site</a>から安定版を得ることができます。また、週に1回か2回、刺激的なことがあれば随時ビルドを行っている<a class="ulink" href="http://www.postgis.org/download/windows/experimental.php" target="_top">very bleeding-edge windows experimental builds</a>もあります。これらはPostGISの進行中のリリースでの試験に使用します。</p></td></tr></table></div><p>PostGISモジュールは、PostgreSQLバックエンドサーバの拡張です。PostGIS 2.5.0では、コンパイルのために、完全なPostgreSQLサーバヘッダが<span class="emphasis"><em>必要です</em></span>。PostgreSQL 2.5.0以上でビルドできます。古い版のPostgreSQLは<span class="emphasis"><em>サポートされません</em></span>。 </p><p>PostgreSQLをインストールしていないならPostgreSQLインストールガイドを参照して下さい。<a class="ulink" href="http://www.postgresql.org/" target="_top">http://www.postgresql.org/</a>にあります。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>GEOS機能を有効にするために、PostgreSQLをインストール時に明示的に標準C++ライブラリに対する明示的なリンクが必要になる場合があります。 </p><pre class="programlisting">LDFLAGS=-lstdc++ ./configure [コンフィギュアオプション]</pre><p>これは、古い開発ツールとインチキC++例外との対話のための応急処置です。怪しい問題 (望んでいないのにバックエンドが閉じたりそれに近い挙動を起こす)を経験したなら、このトリックを試してみて下さい。もちろん、これを行うにはPostgreSQLをはじめからコンパイルし直す必要があります。 </p></td></tr></table></div><p>次のステップでは、PostGISソースのコンフィギュレーションとコンパイルに概要を記述します。これらは、Linuxユーザ用に書いてありますので、WindowsやMacでは動作しません。 </p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="installation_configuration"></a>2.4.1. コンフィギュレーション</h3></div></div></div><p>ほとんどのLinuxのインストールと同様に、最初のステップでは、ソースコードのビルドに使われるMakefileを生成します。これは、シェルスクリプトが行います。 </p><p>
		<span class="command"><strong>./configure</strong></span>
	  </p><p>パラメータを付けない場合には、このコマンドは自動で、PostGISのソースコードのビルドを行うのに必要なコンポーネントやライブラリをシステム上で探します。<span class="command"><strong>./configure</strong></span>とするのが一般的な使い方ですが、標準的でない位置に必要なライブラリやプログラムを置いてある場合のために、いくつかのパラメータを受け付けます。 </p><p>次のリストで、共通して使われるパラメータを示します。 完全なリストについては、<span class="command"><strong>--help</strong></span>または<span class="command"><strong>--help=short</strong></span>パラメータを使って下さい。 </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="command"><strong>--prefix=PREFIX</strong></span></span></dt><dd><p>PostGISライブラリとSQLスクリプトのインストール先を指定します。デフォルトでは、検出されたPostgreSQLのインストール先と同じになります。 </p><div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Caution"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注意]" src="images/caution.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>このパラメータは現在のところ壊れていて、PostgreSQLのインストール先にしかインストールされません。このバグのトラックについては<a class="ulink" href="http://trac.osgeo.org/postgis/ticket/635" target="_top">http://trac.osgeo.org/postgis/ticket/635</a>をご覧ください。 </p></td></tr></table></div></dd><dt><span class="term"><span class="command"><strong>--with-pgconfig=FILE</strong></span></span></dt><dd><p>PostgreSQLは、PostGISなどの拡張に対してPostgreSQLのインストール先ディレクトリを伝える<span class="command"><strong>pg_config</strong></span>というユーティリティを持っています。PostGISの対象とする特定のPostgreSQLのインストール先を手動で指定する場合に、このパラメータ(<span class="command"><strong>--with-pgconfig=/path/to/pg_config</strong></span>)を使います。 </p></dd><dt><span class="term"><span class="command"><strong>--with-gdalconfig=FILE</strong></span></span></dt><dd><p>必須ライブラリであるGDALは、ラスタ機能に必要な機能を提供します。GDALには、インストール先ディレクトリをインストールスクリプトに伝える<span class="command"><strong>gdal-config</strong></span>があります。PostGISのビルドに使う特定のGDALを手動で指定する場合に、このパラメータ (<span class="command"><strong>--with-gdalconfig=/path/to/gdal-config</strong></span>)を使います。 </p></dd><dt><span class="term"><span class="command"><strong>--with-geosconfig=FILE</strong></span></span></dt><dd><p>必須のジオメトリライブラリであるGEOSには、ソフトウェアのインストール時にGEOSのインストール先ディレクトリを伝える<span class="command"><strong>geos-config</strong></span>というユーティリティがあります。PostGISのビルドに使う特定のGEOSを手動で指定する場合に、このパラメータ (<span class="command"><strong>--with-geosconfig=/path/to/geos-config</strong></span>)を使います。 </p></dd><dt><span class="term"><span class="command"><strong>--with-xml2config=FILE</strong></span></span></dt><dd><p>LibXMLはGeomFromKML/GML処理を行うのに必須のライブラリです。通常はlibxmlをインストールしているなら発見されますが、発見できない場合や特定の版を使用したい場合は、<code class="filename">xml2-config</code>を指定してインストールスクリプトにLibXMLのインストール先ディレクトリを伝えます。PostGISのビルドに使う特定のLibXMLを手動で指定する場合に、このパラメータ (<span class="command"><strong>
&gt;--with-xml2config=/path/to/xml2-config</strong></span>)を使います。 </p></dd><dt><span class="term"><span class="command"><strong>--with-projdir=DIR</strong></span></span></dt><dd><p>Proj4はPostGISに必須の投影変換ライブラリです。PostGISのビルドに使う特定のProj4のディレクトリを手動で指定する場合は、このパラメータ (<span class="command"><strong>--with-projdir=/path/to/projdir</strong></span>)を使います。 </p></dd><dt><span class="term"><span class="command"><strong>--with-libiconv=DIR</strong></span></span></dt><dd><p>iconvのインストール先ディレクトリを指定します。 </p></dd><dt><span class="term"><span class="command"><strong>--with-jsondir=DIR</strong></span></span></dt><dd><p><a class="ulink" href="http://oss.metaparadigm.com/json-c/" target="_top">JSON-C</a>は、MITライセンスのJSONライブラリで、PostGISのST_GeomFromJSONに必須です。PostGISのビルドに使う特定のJSON-Cを手動で指定する場合に、このパラメータ (<span class="command"><strong>--with-jsondir=/path/to/jsondir</strong></span>)を使います。 </p></dd><dt><span class="term"><span class="command"><strong>--with-pcredir=DIR</strong></span></span></dt><dd><p><a class="ulink" href="http://www.pcre.org/" target="_top">PCRE</a>は、BSDライセンスのPerl互換正規表現ライブラリです。住所標準化エクステンションに必須です。PostGISのビルド対象としている特定のPCREを手動で指定する場合に、このパラメータ (<span class="command"><strong>--with-pcredir=/path/to/pcredir</strong></span>)を使います。 </p></dd><dt><span class="term"><span class="command"><strong>--with-gui</strong></span></span></dt><dd><p>データインポートGUI (GTK+2.0が必要)をコンパイルします。このパラメータによって、shp2pgsql-guiという、shp2pgsqlのグラフィカルユーザインタフェースが作成されます。 </p></dd><dt><span class="term"><span class="command"><strong>--with-raster</strong></span></span></dt><dd><p>ラスタ機能付きでコンパイルします。これによりrtpostgis-2.5.0ライブラリとrtpostgis.sqlファイルが生成されます。最終リリースでは、デフォルトでラスタ機能付きにする予定ですので、このパラメータ自体は不要になる可能性があります。 </p></dd><dt><span class="term"><span class="command"><strong>--without-topology</strong></span></span></dt><dd><p>トポロジ対応を無くしてコンパイルします。トポロジに必要なロジックは全てpostgis-2.5.0ライブラリ内に作られるので、関連ライブラリはありません。 </p></dd><dt><span class="term"><span class="command"><strong>--with-gettext=no</strong></span></span></dt><dd><p>デフォルトでは、gettextの検出とこれを用いたコンパイルを試みますが、ローダ破損を引き起こす非互換性問題のもとで実行する場合には、このコマンドで無効にできます。これを使ったコンフィギュレーションによって解決する問題の例は<a class="ulink" href="http://trac.osgeo.org/postgis/ticket/748" target="_top">http://trac.osgeo.org/postgis/ticket/748</a>にあります。ご注意: これを切ることで多くの機能がなくなるわけではありません。まだ文書化されていなくて試験段階であるGUIローダにおける内部のヘルプ/ラベル機能に使われています。 </p></dd><dt><span class="term"><span class="command"><strong>--with-sfcgal=PATH</strong></span></span></dt><dd><p>デフォルトでは、このスイッチなしではSFCGAL対応でインストールされません。<code class="varname">PATH</code>は、sfcgal-configへのパスを指定することができる追加的な引数です。 </p></dd></dl></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>PostGISをSVN<a class="ulink" href="http://svn.osgeo.org/postgis/trunk/" target="_top">レポジトリ</a>から得る場合には、はじめに次のスクリプトを実行します。 </p><p>
		  <span class="command"><strong>./autogen.sh</strong></span>
		</p><p>このスクリプトによって<span class="command"><strong>configure</strong></span>スクリプトが生成されます。これはPostGISのインストールに関するカスタマイズに使われます。 </p><p>PostGISをアーカイブファイルで入手する場合には、<span class="command"><strong>configure</strong></span>が既に生成されているので<span class="command"><strong>./autogen.sh</strong></span>は不要です。 </p></td></tr></table></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idp64883912"></a>2.4.2. ビルド</h3></div></div></div><p>Makefileが生成されたら、PostGISのビルドは、次のコマンドを実行するだけです。 </p><p>
		<span class="command"><strong>make</strong></span>
	  </p><p>出力の最後の行に"<code class="code">PostGIS was built successfully. Ready to install.</code>"と出れば終わりです。 </p><p>PostGIS 1.4.0版からは、全ての関数に文書から生成されるコメントが付きます。これらのコメントを後からインストールするには、次のコマンドを実行しますが、docbookが必要です。アーカイブファイルからインストールする場合は、postgis_comments.sql, raster_comments.sql, topology_comments.sqlは、docフォルダにあるので、コメントを作成する必要はありません。コメントはCREATE EXTENSIONによるインストールの一部として取り込まれます。 </p><p>
		<span class="command"><strong>make comments</strong></span>
	  </p><p>PostGIS 2.0で導入されました。早見表に、または学習中の方のハンドアウトに適しているHTMLチートシートを生成します。xsltprocが必要で、<code class="filename">topology_cheatsheet.html</code>, <code class="filename">tiger_geocoder_cheatsheet.html</code>, <code class="filename">raster_cheatsheet.html</code>, <code class="filename">postgis_cheatsheet.html</code>の4ファイルが生成されます。 </p><p>HTMLとPDFのビルド済みのものは<a class="ulink" href="http://www.postgis.us/study_guides" target="_top">PostGIS / PostgreSQL Study Guides</a>にあります。</p><p>
		<span class="command"><strong>make cheatsheets</strong></span>
	  </p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="make_install_postgis_extensions"></a>2.4.3. PostGISエクステンションのビルドとデプロイ</h3></div></div></div><p>PostgreSQL 9.1以上を使用している場合は、PostGISエクステンションが自動的にビルド、インストールされます。 </p><p>ソースレポジトリからビルドしている場合は、関数の記述を最初にビルドする必要があります。これらは、docbookがインストールされている時にビルドされます。手動でインストールするには次のようにします。 </p><p>
	  <span class="command"><strong>make comments</strong></span>
    </p><p>アーカイブファイルからのビルドの場合は、ビルド済みのものがあるので、コメントのビルドは必須ではありません。</p><p>PostgreSQL 9.1を対象にビルドしている場合は、extensionsは自動的にmake install処理の一部としてビルドするべきです。必要ならextensionsフォルダからビルドできますし、他のサーバで必要ならファイルの複製ができます。 </p><pre class="programlisting">cd extensions
cd postgis
make clean
make
make install
cd ..
cd postgis_topology
make clean
make
make install
cd ..
cd postgis_sfcgal
make clean
make
make install

cd ..
cd address_standardizer
make clean
make
make install
make installcheck

cd ..
cd postgis_tiger_geocoder
make clean
make
make install
make installcheck
          </pre><p>エクステンションファイルは、OSに関係なく、常に同じ版のPostGISと同じです。PostGISバイナリを既にインストールしている限りは、エクステンションファイルをあるOSから別のものに複写して大丈夫です。 </p><p>開発用と異なる別のサーバでエクステンションを手動でインストールしたい場合は、サーバにない時に必要となる通常のPostGISのバイナリだけでなく、次のファイルをextensionsフォルダからPostgreSQLインストール先の<code class="filename">PostgreSQL / share / extension</code>フォルダに複写します。 </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>指定されていない場合のインストールするエクステンションの版等の情報を示す制御ファイ<code class="filename">postgis.control, postgis_topology.control</code>。 </p></li><li class="listitem"><p>エクステンションごとの/sqlフォルダにあるファイル全て。<code class="filename">extensions/postgis/sql/*.sql</code>, <code class="filename">extensions/postgis_topology/sql/*.sql</code>はPostgreSQL share/extensionフォルダの最上位に複写する必要があることに注意して下さい。 </p></li></ul></div><p>以上を実行すると、PgAdmin -&gt; extensionで<code class="varname">postgis</code>, <code class="varname">postgis_topology</code>が有効なエクステンションとして見えます。</p><p>psqlを使う場合は、次のクエリを実行してエクステンションがインストールされていることを確認できます。</p><pre class="programlisting">SELECT name, default_version,installed_version
FROM pg_available_extensions WHERE name LIKE 'postgis%' or name LIKE 'address%';

             name             | default_version | installed_version
------------------------------+-----------------+-------------------
 address_standardizer         | 2.5.0         | 2.5.0
 address_standardizer_data_us | 2.5.0         | 2.5.0
 postgis                      | 2.5.0         | 2.5.0
 postgis_sfcgal               | 2.5.0         |
 postgis_tiger_geocoder       | 2.5.0         | 2.5.0
 postgis_topology             | 2.5.0         |
(6 rows)</pre><p>クエリを行ったデータベースにエクステンションがインストールされている場合は、<code class="varname">installed_version</code>カラムに記載が見えます。レコードが返ってこない場合は、PostGIS EXTENSIONがインストールされていないことになります。PgAdmin III 1.14以上では、データベースブラウザツリーの<code class="varname">extensions</code>セクションで提供されていて、右クリックでアップグレードまたアンインストールできます。</p><p>有効なエクステンションがある場合、pgAdminエクステンションインタフェースまたは次のSQLの実行によって、選択したデータベースにPostGISエクステンションをインストールできます。</p><pre class="programlisting">CREATE EXTENSION postgis;
CREATE EXTENSION postgis_sfcgal;
CREATE EXTENSION fuzzystrmatch; -- postgis_tiger_geocoderに必要
-- postgis_tiger_geocoderで使用されるか単独で使われます
CREATE EXTENSION address_standardizer;
CREATE EXTENSION address_standardizer_data_us;
CREATE EXTENSION postgis_tiger_geocoder;
CREATE EXTENSION postgis_topology;</pre><p>psqlでは、どの版が、どのスキーマにインストールされているかを見ることができます。 </p><pre class="programlisting">\connect mygisdb
\x
\dx postgis*</pre><pre class="screen">List of installed extensions
-[ RECORD 1 ]-------------------------------------------------
-
Name        | postgis
Version     | 2.5.0
Schema      | public
Description | PostGIS geometry, geography, and raster spat..
-[ RECORD 2 ]-------------------------------------------------
-
Name        | postgis_tiger_geocoder
Version     | 2.5.0
Schema      | tiger
Description | PostGIS tiger geocoder and reverse geocoder
-[ RECORD 3 ]-------------------------------------------------
-
Name        | postgis_topology
Version     | 2.5.0
Schema      | topology
Description | PostGIS topology spatial types and functions</pre><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>エクステンションのテーブル<code class="varname">spatial_ref_sys</code>, <code class="varname">layer</code>, <code class="varname">topology</code>は、明示的にバックアップできません。それぞれの<code class="varname">postgis</code>または<code class="varname">postgis_topology</code>エクステンションがバックアップされる時のみバックアップできます。これは、データベース全体のバックアップの時のみ行われます。PostGIS 2.0.1の時点では、データベースがバックアップされる際に、PostGISでパッケージ化されていないsridレコードのみバックアップされます。パッケージに入っているsridの変更は巡回せず、変更はそこにあるものと期待されます。PostGIS 2.0.1の時点では、データベースがバックアップされるときにPostGISに入っていないsridのレコードだけがバックアップされます。PostGISに入っていて後に変更されたsridの変更については巡回しません。問題が見られたら、チケットを発行して下さい。エクステンションテーブルの構造は<code class="code">CREATE EXTENSION</code>で生成されるので、バックアップを行いません。エクステンションの与えられた版と同じものであると仮定されます。この挙動は現在のPostgreSQL エクステンションモデルに組み込まれているため、これについては何もできません。</p></td></tr></table></div><p>この素晴らしいエクステンション機能を使わずに2.5.0をインストールした場合でもエクステンションベースに変更することができます。まず<code class="filename">postgis_upgrade_22_minor.sql</code>,<code class="filename">raster_upgrade_22_minor.sql</code>,<code class="filename">topology_upgrade_22_minor.sql</code>のアップグレードスクリプトを実行して最新版にアップグレードします</p><p>ラスタ機能無しでPostGISをインストールした場合には、最初にラスタ機能をインストールする必要があります (<code class="filename">rtpostgis.sql</code>を使います)。</p><p>それから、次のコマンドを実行して、個々のエクステンションについて、関数をパッケージ化します。</p><pre class="programlisting">CREATE EXTENSION postgis FROM unpackaged;
CREATE EXTENSION postgis_topology FROM unpackaged;
CREATE EXTENSION postgis_tiger_geocoder FROM unpackaged;</pre></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idp64917576"></a>2.4.4. テスト</h3></div></div></div><p>PostGISのテストを行うには、次のコマンドを実行します。 </p><p>
		<span class="command"><strong>make check</strong></span>
	  </p><p>このコマンドで、実際のPostgreSQLデータベースに対して生成したライブラリを使用した、様々なチェックとレグレッションテストを行います。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>PostgreSQL, GEOS または Proj4 を標準の位置にインストールしていない場合には、環境変数LD_LIBRARY_PATHに、ライブラリの位置を追加する必要があるかも知れません。 </p></td></tr></table></div><div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Caution"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注意]" src="images/caution.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>現在のところ<span class="command"><strong>make check</strong></span>は、チェックを行う際に 環境変数<code class="code">PATH</code>と<code class="code">PGPORT</code>によっています。コンフィギュレーションパラメータ<span class="command"><strong>--with-pgconfig</strong></span>を使って特定したPostgreSQLでは<span class="emphasis"><em>ありません</em></span>。PATHを編集して、コンフィギュレーションの際に検出したPostgreSQLと一致するようにして下さい。もしくは、間もなく襲ってくる頭痛の準備をしておいて下さい。 </p></td></tr></table></div><p>成功した場合は、テストの出力は次のようなかんじになります。 </p><pre class="programlisting">CUnit - A unit testing framework for C - Version 2.1-2
     http://cunit.sourceforge.net/


Suite: computational_geometry
  Test: test_lw_segment_side ...passed
  Test: test_lw_segment_intersects ...passed
  Test: test_lwline_crossing_short_lines ...passed
  Test: test_lwline_crossing_long_lines ...passed
  Test: test_lwline_crossing_bugs ...passed
  Test: test_lwpoint_set_ordinate ...passed
  Test: test_lwpoint_get_ordinate ...passed
  Test: test_point_interpolate ...passed
  Test: test_lwline_clip ...passed
  Test: test_lwline_clip_big ...passed
  Test: test_lwmline_clip ...passed
  Test: test_geohash_point ...passed
  Test: test_geohash_precision ...passed
  Test: test_geohash ...passed
  Test: test_geohash_point_as_int ...passed
  Test: test_isclosed ...passed
  Test: test_lwgeom_simplify ...passed
Suite: buildarea
  Test: buildarea1 ...passed
  Test: buildarea2 ...passed
  Test: buildarea3 ...passed
  Test: buildarea4 ...passed
  Test: buildarea4b ...passed
  Test: buildarea5 ...passed
  Test: buildarea6 ...passed
  Test: buildarea7 ...passed
Suite: geometry_clean
  Test: test_lwgeom_make_valid ...passed
Suite: clip_by_rectangle
  Test: test_lwgeom_clip_by_rect ...passed
Suite: force_sfs
  Test: test_sfs_11 ...passed
  Test: test_sfs_12 ...passed
  Test: test_sqlmm ...passed
Suite: geodetic
  Test: test_sphere_direction ...passed
  Test: test_sphere_project ...passed
  Test: test_lwgeom_area_sphere ...passed
  Test: test_signum ...passed
  Test: test_gbox_from_spherical_coordinates ...passed
  Test: test_gserialized_get_gbox_geocentric ...passed
  Test: test_clairaut ...passed
  Test: test_edge_intersection ...passed
  Test: test_edge_intersects ...passed
  Test: test_edge_distance_to_point ...passed
  Test: test_edge_distance_to_edge ...passed
  Test: test_lwgeom_distance_sphere ...passed
  Test: test_lwgeom_check_geodetic ...passed
  Test: test_gserialized_from_lwgeom ...passed
  Test: test_spheroid_distance ...passed
  Test: test_spheroid_area ...passed
  Test: test_lwpoly_covers_point2d ...passed
  Test: test_gbox_utils ...passed
  Test: test_vector_angle ...passed
  Test: test_vector_rotate ...passed
  Test: test_lwgeom_segmentize_sphere ...passed
  Test: test_ptarray_contains_point_sphere ...passed
  Test: test_ptarray_contains_point_sphere_iowa ...passed
Suite: GEOS
  Test: test_geos_noop ...passed
  Test: test_geos_subdivide ...passed
  Test: test_geos_linemerge ...passed
Suite: Clustering
  Test: basic_test ...passed
  Test: nonsequential_test ...passed
  Test: basic_distance_test ...passed
  Test: single_input_test ...passed
  Test: empty_inputs_test ...passed
Suite: Clustering Union-Find
  Test: test_unionfind_create ...passed
  Test: test_unionfind_union ...passed
  Test: test_unionfind_ordered_by_cluster ...passed
Suite: homogenize
  Test: test_coll_point ...passed
  Test: test_coll_line ...passed
  Test: test_coll_poly ...passed
  Test: test_coll_coll ...passed
  Test: test_geom ...passed
  Test: test_coll_curve ...passed
Suite: encoded_polyline_input
  Test: in_encoded_polyline_test_geoms ...passed
  Test: in_encoded_polyline_test_precision ...passed
Suite: geojson_input
  Test: in_geojson_test_srid ...passed
  Test: in_geojson_test_bbox ...passed
  Test: in_geojson_test_geoms ...passed
Suite: twkb_input
  Test: test_twkb_in_point ...passed
  Test: test_twkb_in_linestring ...passed
  Test: test_twkb_in_polygon ...passed
  Test: test_twkb_in_multipoint ...passed
  Test: test_twkb_in_multilinestring ...passed
  Test: test_twkb_in_multipolygon ...passed
  Test: test_twkb_in_collection ...passed
  Test: test_twkb_in_precision ...passed
Suite: serialization/deserialization
  Test: test_typmod_macros ...passed
  Test: test_flags_macros ...passed
  Test: test_serialized_srid ...passed
  Test: test_gserialized_from_lwgeom_size ...passed
  Test: test_gbox_serialized_size ...passed
  Test: test_lwgeom_from_gserialized ...passed
  Test: test_lwgeom_count_vertices ...passed
  Test: test_on_gser_lwgeom_count_vertices ...passed
  Test: test_geometry_type_from_string ...passed
  Test: test_lwcollection_extract ...passed
  Test: test_lwgeom_free ...passed
  Test: test_lwgeom_flip_coordinates ...passed
  Test: test_f2d ...passed
  Test: test_lwgeom_clone ...passed
  Test: test_lwgeom_force_clockwise ...passed
  Test: test_lwgeom_calculate_gbox ...passed
  Test: test_lwgeom_is_empty ...passed
  Test: test_lwgeom_same ...passed
  Test: test_lwline_from_lwmpoint ...passed
  Test: test_lwgeom_as_curve ...passed
  Test: test_lwgeom_scale ...passed
  Test: test_gserialized_is_empty ...passed
  Test: test_gbox_same_2d ...passed
Suite: measures
  Test: test_mindistance2d_tolerance ...passed
  Test: test_rect_tree_contains_point ...passed
  Test: test_rect_tree_intersects_tree ...passed
  Test: test_lwgeom_segmentize2d ...passed
  Test: test_lwgeom_locate_along ...passed
  Test: test_lw_dist2d_pt_arc ...passed
  Test: test_lw_dist2d_seg_arc ...passed
  Test: test_lw_dist2d_arc_arc ...passed
  Test: test_lw_arc_length ...passed
  Test: test_lw_dist2d_pt_ptarrayarc ...passed
  Test: test_lw_dist2d_ptarray_ptarrayarc ...passed
  Test: test_lwgeom_tcpa ...passed
  Test: test_lwgeom_is_trajectory ...passed
Suite: effectivearea
  Test: do_test_lwgeom_effectivearea_lines ...passed
  Test: do_test_lwgeom_effectivearea_polys ...passed
Suite: miscellaneous
  Test: test_misc_force_2d ...passed
  Test: test_misc_simplify ...passed
  Test: test_misc_count_vertices ...passed
  Test: test_misc_area ...passed
  Test: test_misc_wkb ...passed
  Test: test_grid ...passed
Suite: noding
  Test: test_lwgeom_node ...passed
Suite: encoded_polyline_output
  Test: out_encoded_polyline_test_geoms ...passed
  Test: out_encoded_polyline_test_srid ...passed
  Test: out_encoded_polyline_test_precision ...passed
Suite: geojson_output
  Test: out_geojson_test_precision ...passed
  Test: out_geojson_test_dims ...passed
  Test: out_geojson_test_srid ...passed
  Test: out_geojson_test_bbox ...passed
  Test: out_geojson_test_geoms ...passed
Suite: gml_output
  Test: out_gml_test_precision ...passed
  Test: out_gml_test_srid ...passed
  Test: out_gml_test_dims ...passed
  Test: out_gml_test_geodetic ...passed
  Test: out_gml_test_geoms ...passed
  Test: out_gml_test_geoms_prefix ...passed
  Test: out_gml_test_geoms_nodims ...passed
  Test: out_gml2_extent ...passed
  Test: out_gml3_extent ...passed
Suite: kml_output
  Test: out_kml_test_precision ...passed
  Test: out_kml_test_dims ...passed
  Test: out_kml_test_geoms ...passed
  Test: out_kml_test_prefix ...passed
Suite: svg_output
  Test: out_svg_test_precision ...passed
  Test: out_svg_test_dims ...passed
  Test: out_svg_test_relative ...passed
  Test: out_svg_test_geoms ...passed
  Test: out_svg_test_srid ...passed
Suite: x3d_output
  Test: out_x3d3_test_precision ...passed
  Test: out_x3d3_test_geoms ...passed
  Test: out_x3d3_test_option ...passed
Suite: ptarray
  Test: test_ptarray_append_point ...passed
  Test: test_ptarray_append_ptarray ...passed
  Test: test_ptarray_locate_point ...passed
  Test: test_ptarray_isccw ...passed
  Test: test_ptarray_signed_area ...passed
  Test: test_ptarray_unstroke ...passed
  Test: test_ptarray_insert_point ...passed
  Test: test_ptarray_contains_point ...passed
  Test: test_ptarrayarc_contains_point ...passed
  Test: test_ptarray_scale ...passed
Suite: printing
  Test: test_lwprint_default_format ...passed
  Test: test_lwprint_format_orders ...passed
  Test: test_lwprint_optional_format ...passed
  Test: test_lwprint_oddball_formats ...passed
  Test: test_lwprint_bad_formats ...passed
Suite: SFCGAL
  Test: test_sfcgal_noop ...passed
Suite: split
  Test: test_lwline_split_by_point_to ...passed
  Test: test_lwgeom_split ...passed
Suite: stringbuffer
  Test: test_stringbuffer_append ...passed
  Test: test_stringbuffer_aprintf ...passed
Suite: surface
  Test: triangle_parse ...passed
  Test: tin_parse ...passed
  Test: polyhedralsurface_parse ...passed
  Test: surface_dimension ...passed
Suite: Internal Spatial Trees
  Test: test_tree_circ_create ...passed
  Test: test_tree_circ_pip ...passed
  Test: test_tree_circ_pip2 ...passed
  Test: test_tree_circ_distance ...passed
  Test: test_tree_circ_distance_threshold ...passed
Suite: triangulate
  Test: test_lwgeom_delaunay_triangulation ...passed
Suite: twkb_output
  Test: test_twkb_out_point ...passed
  Test: test_twkb_out_linestring ...passed
  Test: test_twkb_out_polygon ...passed
  Test: test_twkb_out_multipoint ...passed
  Test: test_twkb_out_multilinestring ...passed
  Test: test_twkb_out_multipolygon ...passed
  Test: test_twkb_out_collection ...passed
  Test: test_twkb_out_idlist ...passed
Suite: varint
  Test: test_zigzag ...passed
  Test: test_varint ...passed
  Test: test_varint_roundtrip ...passed
Suite: wkb_input
  Test: test_wkb_in_point ...passed
  Test: test_wkb_in_linestring ...passed
  Test: test_wkb_in_polygon ...passed
  Test: test_wkb_in_multipoint ...passed
  Test: test_wkb_in_multilinestring ...passed
  Test: test_wkb_in_multipolygon ...passed
  Test: test_wkb_in_collection ...passed
  Test: test_wkb_in_circularstring ...passed
  Test: test_wkb_in_compoundcurve ...passed
  Test: test_wkb_in_curvpolygon ...passed
  Test: test_wkb_in_multicurve ...passed
  Test: test_wkb_in_multisurface ...passed
  Test: test_wkb_in_malformed ...passed
Suite: wkb_output
  Test: test_wkb_out_point ...passed
  Test: test_wkb_out_linestring ...passed
  Test: test_wkb_out_polygon ...passed
  Test: test_wkb_out_multipoint ...passed
  Test: test_wkb_out_multilinestring ...passed
  Test: test_wkb_out_multipolygon ...passed
  Test: test_wkb_out_collection ...passed
  Test: test_wkb_out_circularstring ...passed
  Test: test_wkb_out_compoundcurve ...passed
  Test: test_wkb_out_curvpolygon ...passed
  Test: test_wkb_out_multicurve ...passed
  Test: test_wkb_out_multisurface ...passed
  Test: test_wkb_out_polyhedralsurface ...passed
Suite: wkt_input
  Test: test_wkt_in_point ...passed
  Test: test_wkt_in_linestring ...passed
  Test: test_wkt_in_polygon ...passed
  Test: test_wkt_in_multipoint ...passed
  Test: test_wkt_in_multilinestring ...passed
  Test: test_wkt_in_multipolygon ...passed
  Test: test_wkt_in_collection ...passed
  Test: test_wkt_in_circularstring ...passed
  Test: test_wkt_in_compoundcurve ...passed
  Test: test_wkt_in_curvpolygon ...passed
  Test: test_wkt_in_multicurve ...passed
  Test: test_wkt_in_multisurface ...passed
  Test: test_wkt_in_tin ...passed
  Test: test_wkt_in_polyhedralsurface ...passed
  Test: test_wkt_in_errlocation ...passed
Suite: wkt_output
  Test: test_wkt_out_point ...passed
  Test: test_wkt_out_linestring ...passed
  Test: test_wkt_out_polygon ...passed
  Test: test_wkt_out_multipoint ...passed
  Test: test_wkt_out_multilinestring ...passed
  Test: test_wkt_out_multipolygon ...passed
  Test: test_wkt_out_collection ...passed
  Test: test_wkt_out_circularstring ...passed
  Test: test_wkt_out_compoundcurve ...passed
  Test: test_wkt_out_curvpolygon ...passed
  Test: test_wkt_out_multicurve ...passed
  Test: test_wkt_out_multisurface ...passed

Run Summary:    Type  Total    Ran Passed Failed Inactive
              suites     38     38    n/a      0        0
               tests    251    251    251      0        0
             asserts   2468   2468   2468      0      n/a

Elapsed time =    0.298 seconds

Creating database 'postgis_reg'
Loading PostGIS into 'postgis_reg'
  /projects/postgis/branches/2.2/regress/00-regress-install/share/contrib/postgis/postgis.sql
  /projects/postgis/branches/2.2/regress/00-regress-install/share/contrib/postgis/postgis_comments.sql
Loading SFCGAL into 'postgis_reg'
  /projects/postgis/branches/2.2/regress/00-regress-install/share/contrib/postgis/sfcgal.sql
  /projects/postgis/branches/2.2/regress/00-regress-install/share/contrib/postgis/sfcgal_comments.sql
PostgreSQL 9.4.4, compiled by Visual C++ build 1800, 32-bit
  Postgis 2.2.0dev - r13980 - 2015-08-23 06:13:07
  scripts 2.2.0dev r13980
  GEOS: 3.5.0-CAPI-1.9.0 r4088
  PROJ: Rel. 4.9.1, 04 March 2015
  SFCGAL: 1.1.0

Running tests

 loader/Point .............. ok
 loader/PointM .............. ok
 loader/PointZ .............. ok
 loader/MultiPoint .............. ok
 loader/MultiPointM .............. ok
 loader/MultiPointZ .............. ok
 loader/Arc .............. ok
 loader/ArcM .............. ok
 loader/ArcZ .............. ok
 loader/Polygon .............. ok
 loader/PolygonM .............. ok
 loader/PolygonZ .............. ok
 loader/TSTPolygon ......... ok
 loader/TSIPolygon ......... ok
 loader/TSTIPolygon ......... ok
 loader/PointWithSchema ..... ok
 loader/NoTransPoint ......... ok
 loader/NotReallyMultiPoint ......... ok
 loader/MultiToSinglePoint ......... ok
 loader/ReprojectPts ........ ok
 loader/ReprojectPtsGeog ........ ok
 loader/Latin1 .... ok
 loader/Latin1-implicit .... ok
 loader/mfile .... ok
 dumper/literalsrid ....... ok
 dumper/realtable ....... ok
 affine .. ok
 bestsrid .. ok
 binary .. ok
 boundary .. ok
 cluster .. ok
 concave_hull .. ok
 ctors .. ok
 dump .. ok
 dumppoints .. ok
 empty .. ok
 forcecurve .. ok
 geography .. ok
 in_geohash .. ok
 in_gml .. ok
 in_kml .. ok
 in_encodedpolyline .. ok
 iscollection .. ok
 legacy .. ok
 long_xact .. ok
 lwgeom_regress .. ok
 measures .. ok
 operators .. ok
 out_geometry .. ok
 out_geography .. ok
 polygonize .. ok
 polyhedralsurface .. ok
 postgis_type_name .. ok
 regress .. ok
 regress_bdpoly .. ok
 regress_index .. ok
 regress_index_nulls .. ok
 regress_management .. ok
 regress_selectivity .. ok
 regress_lrs .. ok
 regress_ogc .. ok
 regress_ogc_cover .. ok
 regress_ogc_prep .. ok
 regress_proj .. ok
 relate .. ok
 remove_repeated_points .. ok
 removepoint .. ok
 setpoint .. ok
 simplify .. ok
 simplifyvw .. ok
 size .. ok
 snaptogrid .. ok
 split .. ok
 sql-mm-serialize .. ok
 sql-mm-circularstring .. ok
 sql-mm-compoundcurve .. ok
 sql-mm-curvepoly .. ok
 sql-mm-general .. ok
 sql-mm-multicurve .. ok
 sql-mm-multisurface .. ok
 swapordinates .. ok
 summary .. ok
 temporal .. ok
 tickets .. ok
 twkb .. ok
 typmod .. ok
 wkb .. ok
 wkt .. ok
 wmsservers .. ok
 knn .. ok
 hausdorff .. ok
 regress_buffer_params .. ok
 offsetcurve .. ok
 relatematch .. ok
 isvaliddetail .. ok
 sharedpaths .. ok
 snap .. ok
 node .. ok
 unaryunion .. ok
 clean .. ok
 relate_bnr .. ok
 delaunaytriangles .. ok
 clipbybox2d .. ok
 subdivide .. ok
 in_geojson .. ok
 regress_sfcgal .. ok
 sfcgal/empty .. ok
 sfcgal/geography .. ok
 sfcgal/legacy .. ok
 sfcgal/measures .. ok
 sfcgal/regress_ogc_prep .. ok
 sfcgal/regress_ogc .. ok
 sfcgal/regress .. ok
 sfcgal/tickets .. ok
 sfcgal/concave_hull .. ok
 sfcgal/wmsservers .. ok
 sfcgal/approximatemedialaxis .. ok
 uninstall .  /projects/postgis/branches/2.2/regress/00-regress-install/share/contrib/postgis/uninstall_sfcgal.sql
  /projects/postgis/branches/2.2/regress/00-regress-install/share/contrib/postgis/uninstall_postgis.sql
. ok (4336)

Run tests: 118
Failed: 0

-- if you built --with-gui, you should see this too

     CUnit - A unit testing framework for C - Version 2.1-2
     http://cunit.sourceforge.net/


Suite: Shapefile Loader File shp2pgsql Test
  Test: test_ShpLoaderCreate() ...passed
  Test: test_ShpLoaderDestroy() ...passed
Suite: Shapefile Loader File pgsql2shp Test
  Test: test_ShpDumperCreate() ...passed
  Test: test_ShpDumperDestroy() ...passed

Run Summary:    Type  Total    Ran Passed Failed Inactive
              suites      2      2    n/a      0        0
               tests      4      4      4      0        0
             asserts      4      4      4      0      n/a</pre><p><code class="varname">postgis_tiger_geocoder</code>と<code class="varname">address_standardizer</code>は、現在は、標準的なPostgreSQLインストールチェックにのみ対応しています。これらをテストするには、次のようにします。ご注意: PostGISコードフォルダのルートでmake installを既に行っている場合には、make installは重要ではありません。</p><p>address_standardizer用: </p><pre class="programlisting">cd extensions/address_standardizer
make install
make installcheck
          </pre><p>出力は次のようなかんじになります。 </p><pre class="screen">============== dropping database "contrib_regression" ==============
DROP DATABASE
============== creating database "contrib_regression" ==============
CREATE DATABASE
ALTER DATABASE
============== running regression test queries        ==============
test test-init-extensions     ... ok
test test-parseaddress        ... ok
test test-standardize_address_1 ... ok
test test-standardize_address_2 ... ok

=====================
 All 4 tests passed.
=====================</pre><p>Tiger Geocodeを使う場合には、使用するPostgreSQLインスタンス内にPostGISとfuzzystrmatchのエクステンションが必要です。PostGISをaddress_standardizer機能付きでビルドした場合は、address_standardizerのテストも行います。 </p><pre class="programlisting">cd extensions/postgis_tiger_geocoder
make install
make installcheck
          </pre><p>出力は次のようなかんじになります。 </p><pre class="screen">============== dropping database "contrib_regression" ==============
DROP DATABASE
============== creating database "contrib_regression" ==============
CREATE DATABASE
ALTER DATABASE
============== installing fuzzystrmatch               ==============
CREATE EXTENSION
============== installing postgis                     ==============
CREATE EXTENSION
============== installing postgis_tiger_geocoder      ==============
CREATE EXTENSION
============== installing address_standardizer        ==============
CREATE EXTENSION
============== running regression test queries        ==============
test test-normalize_address   ... ok
test test-pagc_normalize_address ... ok

=====================
All 2 tests passed.
=====================</pre></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idp64990152"></a>2.4.5. インストール</h3></div></div></div><p>PostGISをインストールするには、次のコマンドを実行します。 </p><p>
		<span class="command"><strong>make install</strong></span>
	  </p><p>これにより、PostGISのインストールファイルが、<span class="command"><strong>--prefix</strong></span>パラメータで指定した、適切なサブディレクトリに複写されます。次に特筆すべきサブディレクトリを示します。 </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>ローダとダンパのバイナリのインストール先は<code class="filename">[prefix]/bin</code>です。 </p></li><li class="listitem"><p><code class="filename">postgis.sql</code>などのSQLファイルのインストール先は<code class="filename">[prefix]/share/contrib</code>です。 </p></li><li class="listitem"><p>PostGISライブラリのインストール先は<code class="filename">[prefix]/lib</code>です。 </p></li></ul></div><p>先に<span class="command"><strong>make comments</strong></span>を実行して<code class="filename">postgis_comments.sql</code>, <code class="filename">raster_comments.sql</code>を生成していた場合は、次のコマンドを実行すると、これらのSQLファイルがインストールされます。 </p><p>
		<span class="command"><strong>make comments-install</strong></span>
	  </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="filename">postgis_comments.sql</code>, <code class="filename">raster_comments.sql</code>, <code class="filename">topology_comments.sql</code>は、<span class="command"><strong>xsltproc</strong></span>の外部依存ができたので、通常のビルドとインストールから切り離されました。 </p></td></tr></table></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="create_new_db_extensions"></a>2.5. エクステンションを使った空間データベースの生成</h2></div></div></div><p>PostgreSQL 9.1以上を使っていて、extensions/postgisモジュールをコンパイルとインストールを行っている場合は、新しい方法で空間データベースを生成できます。 </p><p>
	  <span class="command"><strong>createdb [データベース名]</strong></span>
	</p><p>PostGISエクステンションの中核によって、ジオメトリ、ジオグラフィ、ラスタ、spatial_ref_sysおよび全ての関数とコメントがインストールされます。次のコマンドを実行するだけです。</p><pre class="programlisting">CREATE EXTENSION postgis;</pre><p> </p><p>
	  <span class="command"><strong>psql -d [データベース名] -c "CREATE EXTENSION postgis;"</strong></span>
	</p><p>トポロジは別のエクステンションとして用意されています。次のコマンドでインストールします。 </p><p>
	  <span class="command"><strong>psql -d [データベース名] -c "CREATE EXTENSION postgis_topology;"</strong></span>
	</p><p>以前の版の古いバックアップを新しいデータベースにリストアする予定の場合には、次を実行します。</p><p><span class="command"><strong>psql -d [データベース名] -f legacy.sql</strong></span></p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>レガシー関数が必要なら、PostGISのマイナーバージョンのアップグレードならいつでも、legacy.sqlスクリプトの再インストールが必要です。例えば、2.4.3から2.5.0にアップグレードした場合には、2.5.0のlegacy.sqlの再インストールが必要です。関数の中にライブラリへの参照を作るものがあり、ライブラリ名にマイナー版番号を含むためです。</p></td></tr></table></div><p>リストアとクリーンアップを行った後で非推奨関数を消すために<code class="filename">uninstall_legacy.sql</code>を実行できます。</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="create_new_db"></a>2.6. 空間データベースをエクステンションを使わずに生成する</h2></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この情報は、一般的には、PostGISをラスタ対応なしでビルドした場合のみ必要となります。ラスタ関数はPostGISエクステンションの一部であり、ラスタ対応無しでPostGISをビルドする場合には、エクステンション対応が無効になるためです。</p></td></tr></table></div><p>PostGISデータベースを作る最初のステップは、単純なPostgreSQLデータベースの作成です。 </p><p>
	  <span class="command"><strong>createdb [データベース名]</strong></span>
	</p><p>多くのPostGIS関数は、PL/pgSQL手続き言語で書かれています。次のステップは、PL/pgSQL言語を新たに作成したデータベースで有効にすることです。次のコマンドを実行します。PostgreSQL 8.4以上では、通常は既にインストールされています。 </p><p>
	  <span class="command"><strong>createlang plpgsql [データベース名]</strong></span>
	</p><p>次に、PostGISオブジェクトと関数定義をデータベースにロードします。定義ファイル<code class="filename">postgis.sql</code>(コンフィギュレーション段階で指定した<code class="filename">[prefix]/share/contrib</code>にあります)をロードします。 </p><p>
	  <span class="command"><strong>psql -d [データベース名] -f postgis.sql</strong></span>
	</p><p>完全なEPSG座標系定義IDセットについては、<code class="filename">spatial_ref_sys.sql</code>定義ファイルをロードして<code class="varname">spatial_ref_sys</code>テーブルを生成して下さい。これによりジオメトリ関数ST_Transform()が実行できるようになります。 </p><p>
	  <span class="command"><strong>psql -d [データベース名] -f spatial_ref_sys.sql</strong></span>
	</p><p>PostGISが持つ関数についての助けとなるコメントを求めるなら、<code class="filename">postgis_comments.sql</code>を、データベースにロードします。コメントは、<span class="command"><strong>psql</strong></span>ターミナルウィンドウで単に<span class="command"><strong>\dd [function_name]</strong></span>とすれば見ることができます。ロードは次のようにします。 </p><p>
	  <span class="command"><strong>psql -d [データベース名] -f postgis_comments.sql</strong></span>
	</p><p>ラスタ機能をインストールします。 </p><p>
	  <span class="command"><strong>psql -d [データベース名] -f rtpostgis.sql</strong></span>
	</p><p>ラスタ機能のコメントをインストールします。ラスタ関数ごとの簡易説明が提供されます。psqlまたはpgAdmin等の関数コメントを表示できるPostgreSQLツールで使えます。 </p><p>
	  <span class="command"><strong>psql -d [データベース名] -f raster_comments.sql</strong></span>
	</p><p>トポロジ機能をインストールします。 </p><p>
	  <span class="command"><strong>psql -d [データベース名] -f topology/topology.sql</strong></span>
	</p><p>トポロジ機能のコメントをインストールします。トポロジ関数/型ごとの簡易説明が提供されます。psqlまたはpgAdmin等の関数コメントを表示できるPostgreSQLツールで使えます。 </p><p>
	  <span class="command"><strong>psql -d [データベース名] -f topology/topology_comments.sql</strong></span>
	</p><p>以前の版の古いバックアップを新しいデータベースにリストアする予定の場合には、次を実行します。</p><p><span class="command"><strong>psql -d [データベース名] -f legacy.sql</strong></span></p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>テーブルを回復し、MapServerやGeoServerのようなアプリケーションで動作させるのに必要な最低限をインストールするには<code class="filename">legacy_minimal.sql</code>という選択肢があります。distance/length等のようなものを使うビューがあるなら、完全な<code class="filename">legacy.sql</code>が必要になります。</p></td></tr></table></div><p>リストアとクリーンアップを行った後で非推奨関数を消すために<code class="filename">uninstall_legacy.sql</code>を実行できます。</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="installing_pagc_address_standardizer"></a>2.7. PAGC住所標準化ツールのインストールと使用</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="#idp65048136">2.7.1. Regex::Assembleのインストール</a></span></dt></dl></div><p><code class="code">address_standardizer</code>エクステンションは、別途ダウンロードする必要がある別パッケージとしていました。PostGIS 2.2からは同梱されています。address_standardizeの追加情報、できること、および、コンフィギュレーション方法については、<a class="xref" href="#Address_Standardizer" title="第12章 住所標準化">12章<i>住所標準化</i></a>をご覧下さい。</p><p>標準化エクステンションは、<a class="xref" href="#Normalize_Address" title="Normalize_Address">Normalize_Address</a>の後継で、PostGISに入っているTigerジオコーダエクステンションに使うことができます。この場合の使い方については<a class="xref" href="#tiger_pagc_address_standardizing" title="2.8.3. TigerジオコーダをPostGISデータベースで有効にする: エクステンションを使用">「TigerジオコーダをPostGISデータベースで有効にする: エクステンションを使用」</a>を参照して下さい。また、ユーザ自身がつくるジオコーダの要素として使用したり、住所の比較を簡単にするために住所を標準化するために使うことができます。</p><p>住所標準化エクステンションはPCREに依存しています。PCREは多くのUNIX系システムにインストールされていますが、<a class="ulink" href="http://www.pcre.org" target="_top">http://www.pcre.org</a>から最新版をダウンロードできます。<a class="xref" href="#installation_configuration" title="2.4.1. コンフィギュレーション">「コンフィギュレーション」</a>の際にPCREを発見すると、住所標準化エクステンションが自動的にビルドされます。使用したいPCREのインストールが独自なものである場合は、configureに<code class="code">--with-pcredir=/path/to/pcre</code>を渡します。<code class="filename">/path/to/pcre</code>は、PCREのincludeとlibのあるルートフォルダです。</p><p>Windowsでは、PostGIS 2.1以上に住所標準化エクステンションが同梱されているので、コンパイルを行わずに、すぐに<code class="code">CREATE EXTENSION</code>に行くことができます。</p><p>インストールしたら、対象データベースに接続して次のSQLが実行できます。</p><pre class="programlisting">CREATE EXTENSION address_standardizer;</pre><p>次のテストでは、rules, gaz, lexテーブルは必要ありません。</p><pre class="programlisting">SELECT num, street, city, state, zip
 FROM parse_address('1 Devonshire Place PH301, Boston, MA 02109');</pre><p>出力は次のようになります。</p><pre class="screen">num |         street         |  city  | state |  zip
-----+------------------------+--------+-------+-------
 1   | Devonshire Place PH301 | Boston | MA    | 02109</pre><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idp65048136"></a>2.7.1. Regex::Assembleのインストール</h3></div></div></div><p>PerlのRegex::Assembleは、ソースツリーの一部がこれで作られていますが、住所標準化エクステンションではもはや不要です。ただし、<code class="filename">usps-st-city-orig.txt</code>または<code class="filename">usps-st-city-orig.txt usps-st-city-adds.tx</code>を編集する必要がある場合は、<code class="filename">parseaddress-stcities.h</code>のリビルドでRegex:Assembleが必要です。</p><pre class="programlisting">cpan Regexp::Assemble</pre><p>Ubuntu / Degianの場合には、次のようにしなければならないかも知れません。</p><pre class="programlisting">sudo perl -MCPAN -e "install Regexp::Assemble"</pre></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="loading_extras_tiger_geocoder"></a>2.8. Tigerジオコーダのインストールとアップグレードとデータロード</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="#install_tiger_geocoder_extension">2.8.1. TigerジオコーダをPostGISデータベースで有効にする: エクステンションを使用</a></span></dt><dt><span class="sect2"><a href="#install_tiger_geocoder">2.8.2. TigerジオコーダをPostGISデータベースで有効にする: エクステンション不使用</a></span></dt><dt><span class="sect2"><a href="#tiger_pagc_address_standardizing">2.8.3. TigerジオコーダをPostGISデータベースで有効にする: エクステンションを使用</a></span></dt><dt><span class="sect2"><a href="#tiger_geocoder_loading_data">2.8.4. Tigerデータのロード</a></span></dt><dt><span class="sect2"><a href="#upgrade_tiger_geocoder">2.8.5. Tigerジオコーダのアップグレード</a></span></dt></dl></div><p>Tigerジオコーダのような拡張機能はPostGISディストリビューションに同梱されていません。Tigerジオコーダエクステンションが無かったり、インストールしているものより新しい版のものが欲しい場合には、<a class="ulink" href="http://postgis.net/windows_downloads/" target="_top">Windows Unreleased Versions</a>節でPostgreSQLの版に合ったパッケージにある<code class="filename">share/extension/postgis_tiger_geocoder.*</code>ファイルを使います。これらのパッケージはWindows用ですが、postgis_tige_geocoderエクステンションファイルは、SQLとPL/pgSQLだけですので、他のOSでも動作します。</p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="install_tiger_geocoder_extension"></a>2.8.1. TigerジオコーダをPostGISデータベースで有効にする: エクステンションを使用</h3></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect3"><a href="#convert_tiger_geocoder_extension">2.8.1.1. Tigerジオコーダ通常インストールのエクステンションモデルへの変換</a></span></dt></dl></div><p>PostgreSQL 9.1以上とPostGIS 2.1.0を使用している場合は、Tigerジオコーダのインストールで、新しいエクステンションモデルの利点を得ることができます。次のようにします。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>まず、通常の方法で、PostGIS 2.1.0のバイナリを取得するか、コンパイルしてインストールします。これにより重要なエクステンションファイルとTigerジオコーダのファイルがインストールされます。</p></li><li class="listitem"><p>psql、pgAdminまたは他のツールでデータベースに接続して、次のSQLコマンドを実行します。既にPostGISを持っているデータベースにインストールする場合は、一つ目の手順は不要です。<code class="varname">fuzzystrmatch</code>エクステンションが既にインストールされている場合は、二つ目の手順は不要です。</p><pre class="programlisting">CREATE EXTENSION postgis;
CREATE EXTENSION fuzzystrmatch;
CREATE EXTENSION postgis_tiger_geocoder;
-- 規則を基にした住所標準化 (pagc_normalize_address)を使いたい場合の任意実行
CREATE EXTENSION address_standardizer;</pre><p>既にpostgis_tiger_geocoderエクステンションをインストールしていて、最新版に更新するだけの場合には、次を実行します。</p><pre class="programlisting">ALTER EXTENSION postgis UPDATE;
ALTER EXTENSION postgis_tiger_geocoder UPDATE;</pre><p>独自のエントリを生成した場合や、<code class="varname">tiger.loader_platform</code>と<code class="varname">tiger.loader_variables</code>に変更を加えた場合には、これらをアップデートしなければならないことがあります。</p></li><li class="listitem"><p>正しくインストールされたかを確認するために、インストール対象データベース内で次のSQLを実行します。</p><pre class="programlisting">SELECT na.address, na.streetname,na.streettypeabbrev, na.zip
        FROM normalize_address('1 Devonshire Place, Boston, MA 02109') AS na;</pre><p>出力は次のようになります。</p><pre class="screen">address | streetname | streettypeabbrev |  zip
---------+------------+------------------+-------
           1 | Devonshire | Pl               | 02109</pre></li><li class="listitem"><p><code class="varname">tiger.loader_platform</code>テーブルの、実行ファイルやサーバのパスを持つ新しいレコードを生成します。 </p><p><code class="code">sh</code>コンベンションのあとにdebbieというプロファイルを生成する例として、次のコマンドを実行します。</p><pre class="programlisting">INSERT INTO tiger.loader_platform(os, declare_sect, pgbin, wget, unzip_command, psql, path_sep,
                   loader, environ_set_command, county_process_command)
SELECT 'debbie', declare_sect, pgbin, wget, unzip_command, psql, path_sep,
           loader, environ_set_command, county_process_command
  FROM tiger.loader_platform
  WHERE os = 'sh';</pre><p>それから、<span class="emphasis"><em>declare_sect</em></span>カラム内のパスを編集して、Debbieのpg, unzip, shp2pgsql, psql他のパス位置に適応するようにします。</p><p><code class="varname">loader_platform</code>テーブルを編集しない場合は、一般的なアイテムの位置を持っているので、スクリプトが生成された後で、スクリプトを編集しなければなりません。</p></li><li class="listitem"><p>PostGIS 2.4.1からは、<code class="varname">ZTCA5</code> (Zip Code 5 digit Tabulation Area)のロード手順が変更され、有効になった時に<a class="xref" href="#Loader_Generate_Nation_Script" title="Loader_Generate_Nation_Script">Loader_Generate_Nation_Script</a>の一部として現在のZCTA5データをロードするようになりました。デフォルトでは切られています。ロードにかなりの時間 (20から60分)が取られ、かなりのディスクスペースを占有するのに、そんなに頻繁には使わないためです。</p><p>有効にするには、次のようにします。</p><pre class="programlisting">UPDATE tiger.loader_lookuptables SET load = true WHERE table_name = 'zcta510';</pre><p>境界のフィルタが追加され、ちょうど境界内のZIPに制限された場合に、<a class="xref" href="#Geocode" title="Geocode">Geocode</a>関数は、ZCTA5が存在するなら使います。<a class="xref" href="#Reverse_Geocode" title="Reverse_Geocode">Reverse_Geocode</a>関数は、返された住所にZIPコードが無い場合に (しばしば高速道路での逆ジオコーディングで発生します)、これを使います。</p></li><li class="listitem"><p>サーバまたはローカル (サーバへのネットワーク接続が早い場合)のルートに<code class="filename">gisdata</code>というフォルダを作成します。このフォルダはTigerファイルがダウンロードされ、処理される場所です。サーバのルートにフォルダを作ると不幸になる場合や、単に他のフォルダに移したい場合には、<code class="varname">tiger.loader_variables</code>テーブルの<code class="varname">staging_fold</code>フィールドを編集します。</p></li><li class="listitem"><p><code class="filename">gisdata</code>フォルダ内にtempというフォルダを作成します。もしくは、<code class="varname">staging_fold</code>で示されたフォルダを作成します。ローダがダウンロードしたTigerデータを展開する場所です。</p></li><li class="listitem"><p>そして、SQL関数<a class="xref" href="#Loader_Generate_Nation_Script" title="Loader_Generate_Nation_Script">Loader_Generate_Nation_Script</a>を実行して、独自のプロファイルの名前を使うか確認し、.shまたは.batファイルにスクリプトを複写します。たとえば、新しいプロファイルで国のロードを行う場合には、次のようにします。</p><pre class="programlisting">psql -c "SELECT Loader_Generate_Nation_Script('debbie')" -d geocoder -tA 
&gt; /gisdata/nation_script_load.sh</pre></li><li class="listitem"><p>生成された国データをロードするコマンドラインスクリプトを実行します。</p><pre class="programlisting">cd /gisdata
sh nation_script_load.sh</pre></li><li class="listitem"><p>国スクリプトを実行した後、<code class="code">tiger_data</code>スキーマに三つのテーブルが作られ、データが格納されています。次のクエリをpsqlかpgAdminから実行して、確認します。</p><pre class="programlisting">SELECT count(*) FROM tiger_data.county_all;</pre><pre class="screen">count
-------
  3233
(1 row)</pre><pre class="programlisting">SELECT count(*) FROM tiger_data.state_all;</pre><pre class="screen">count
-------
    56
(1 row)
</pre></li><li class="listitem"><p>デフォルトでは<code class="varname">bg</code>, <code class="varname">tract</code>, <code class="varname">tabblock</code>に対応するテーブルはロードされません。ジオコーダはこれらのテーブルを使いませんが、一般に、人口統計に使います。州データのロードの一部としてロードするには、次の手続きを実行して有効にします。</p><pre class="programlisting">UPDATE tiger.loader_lookuptables SET load = true WHERE load = false AND lookup_name IN('tract', 'bg', 'tabblock');</pre><p>もしくは、<a class="xref" href="#Loader_Generate_Census_Script" title="Loader_Generate_Census_Script">Loader_Generate_Census_Script</a>を使って州のデータをロードした後に、これらのテーブルだけをロードできます。</p></li><li class="listitem"><p>データをロードしたい州ごとに、<a class="xref" href="#Loader_Generate_Script" title="Loader_Generate_Script">Loader_Generate_Script</a>で州スクリプトを作ります。</p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>国データのロードを完了する前に*州スクリプトを作ってはなりません*。州スクリプトは国スクリプトでロードされる国リストを利用するためです。</p></td></tr></table></div></li><li class="listitem"><pre class="programlisting">psql -c "SELECT Loader_Generate_Script(ARRAY['MA'], 'debbie')" -d geocoder -tA 
&gt; /gisdata/ma_load.sh</pre></li><li class="listitem"><p>生成されたコマンドラインスクリプトを実行します。</p><pre class="programlisting">cd /gisdata
sh ma_load.sh</pre></li><li class="listitem"><p>全てのデータのロードが完了するか中断ポイントに達した後に、全てのtigerテーブルに対してanalyzeを実行して、(継承されたものも含めて)状態を更新するのは良いことです。</p><pre class="programlisting">SELECT install_missing_indexes();
vacuum analyze verbose tiger.addr;
vacuum analyze verbose tiger.edges;
vacuum analyze verbose tiger.faces;
vacuum analyze verbose tiger.featnames;
vacuum analyze verbose tiger.place;
vacuum analyze verbose tiger.cousub;
vacuum analyze verbose tiger.county;
vacuum analyze verbose tiger.state;
vacuum analyze verbose tiger.zip_lookup_base;
vacuum analyze verbose tiger.zip_state;
vacuum analyze verbose tiger.zip_state_loc;</pre></li></ol></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="convert_tiger_geocoder_extension"></a>2.8.1.1. Tigerジオコーダ通常インストールのエクステンションモデルへの変換</h4></div></div></div><p>エクステンションモデルを使わずにTigerジオコーダをインストールしている場合に、次のようにして、エクステンションモデルに変換できます。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><a class="xref" href="#upgrade_tiger_geocoder" title="2.8.5. Tigerジオコーダのアップグレード">「Tigerジオコーダのアップグレード」</a>の指示に従って非エクステンションモデルのアップグレードを行います。</p></li><li class="listitem"><p>psqlまたはpgAdminでデータベースに接続して、次のコマンドを実行します。</p><pre class="programlisting">CREATE EXTENSION postgis_tiger_geocoder FROM unpackaged;</pre></li></ol></div></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="install_tiger_geocoder"></a>2.8.2. TigerジオコーダをPostGISデータベースで有効にする: エクステンション不使用</h3></div></div></div><p>まず、上述の手順でPostGISをインストールします。 </p><p>extrasフォルダが無い場合、<a class="ulink" href="http://download.osgeo.org/postgis/source/postgis-2.5.0.tar.gz" target="_top">http://download.osgeo.org/postgis/source/postgis-2.5.0.tar.gz</a>をダウンロードします。 </p><p>
		  <span class="command"><strong>tar xvfz postgis-2.5.0.tar.gz</strong></span>
		</p><p>
		  <span class="command"><strong>cd postgis-2.5.0/extras/tiger_geocoder</strong></span>
		</p><p><code class="filename">tiger_loader_2015.sql</code> (違う年のものをロードしたくないならば最新のローダファイル)をあなたの実行サーバ等のパスに編集します。もしくは<code class="varname">loader_platform</code>がインストールされた後に一度これを更新します。このファイルも<code class="varname">loader_platform</code>も編集しない場合には、一般的なアイテムの位置を持っているだけなので、<a class="xref" href="#Loader_Generate_Nation_Script" title="Loader_Generate_Nation_Script">Loader_Generate_Nation_Script</a>と<a class="xref" href="#Loader_Generate_Script" title="Loader_Generate_Script">Loader_Generate_Script</a>を実行した後に、生成されたスクリプトを編集しなければなりません。 </p><p>初めてTigerジオコーダをインストールする場合は、Windowsでは<code class="filename">create_geocode.bat</code>を、またLinux/Unix/Mac OSXでは<code class="filename">create_geocode.sh</code>を、使用するPostgreSQLにとって独自の設定に変更したうえで、コマンドラインから対応するスクリプトを実行します。 </p><p>データベースに<code class="varname">tiger</code>スキーマがあることを確認します。もし無い場合は、次の行を参考に、コマンドを実行します。 </p><pre class="programlisting">ALTER DATABASE geocoder SET search_path=public, tiger;</pre><p>住所正規化機能は、トリッキーな住所を除いて、大体データなしで動作します。テストを実行して次のように見えることを確認して下さい。 </p><pre class="programlisting">SELECT pprint_addy(normalize_address('202 East Fremont Street, Las Vegas, Nevada 89101')) As pretty_address;
pretty_address
---------------------------------------
202 E Fremont St, Las Vegas, NV 89101
                        </pre><p>
		</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="tiger_pagc_address_standardizing"></a>2.8.3. TigerジオコーダをPostGISデータベースで有効にする: エクステンションを使用</h3></div></div></div><p>皆さんが問題と思われるの多くのことのひとつに、ジオコーディング前の準備に住所を正規化する関数<a class="xref" href="#Normalize_Address" title="Normalize_Address">Normalize_Address</a>があります。住所正規化は万全と言うにはほど遠く、パッチをあてようとすると膨大な資源を費やします。よって、より良い住所標準化エンジンを持つ他のプロジェクトに統合しました。この新しい住所標準化を使うには、<a class="xref" href="#installing_pagc_address_standardizer" title="2.7. PAGC住所標準化ツールのインストールと使用">「PAGC住所標準化ツールのインストールと使用」</a>で記述するようにエクステンションをコンパイルし、使用するデータベースにインストールします。</p><p>このエクステンションを<code class="code">postgis_tiger_geocoder</code>をインストールしているデータベースにインストールすると、<a class="xref" href="#Pagc_Normalize_Address" title="Pagc_Normalize_Address文字列のストリート住所を与えると、道路後置辞、前置辞、標準タイプ、番地、ストリート名等を複数フィールドに分解して持つnorm_addy複合型を返します。この関数は、tiger_geocoder同梱のルックアップテーブルだけを使います (Tigerデータは不要です)。住所標準化エクステンションが必要です。">Pagc_Normalize_Address文字列のストリート住所を与えると、道路後置辞、前置辞、標準タイプ、番地、ストリート名等を複数フィールドに分解して持つ<code class="varname">norm_addy</code>複合型を返します。この関数は、tiger_geocoder同梱のルックアップテーブルだけを使います (Tigerデータは不要です)。住所標準化エクステンションが必要です。</a>を、<a class="xref" href="#Normalize_Address" title="Normalize_Address">Normalize_Address</a>の代わりに使うことができます。このエクステンションはTigerジオコーダからは見えないので、国際的な住所といった他のデータソースでも使えます。Tigerジオコーダエクステンションは、その版の<a class="xref" href="#rulestab" title="規則テーブル">規則テーブル</a> (<code class="code">tiger.pagc_rules</code>), <a class="xref" href="#gaztab" title="gaz table">gaz table</a> (<code class="code">tiger.pagc_gaz</code>), <a class="xref" href="#lextab" title="lexテーブル">lexテーブル</a> (<code class="code">tiger.pagc_lex</code>)を同梱しています。これらは、必要に応じて標準化の改善のために追加や更新ができます。</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="tiger_geocoder_loading_data"></a>2.8.4. Tigerデータのロード</h3></div></div></div><p>データロードの説明の詳細は<code class="filename">extras/tiger_geocoder/tiger_2011/README</code>にあります。これは一般的な手順を示しています。</p><p>ロードプロセスによって、米センサスウェブサイトから個々の国ファイル、リクエストされた州のデータをダウンロードし、ファイルを展開し、個別の州をそれぞれの州テーブルの集合にロードします。各州のテーブルは、<code class="varname">tiger</code>スキーマで定義されたテーブルを継承しているので、これらのテーブルに対して全てのデータにアクセスするためのクエリを出すことができますし、州の再読み込みが必要となったり、州が必要ない場合には、<a class="xref" href="#Drop_State_Tables_Generate_Script" title="Drop_State_Tables_Generate_Script">Drop_State_Tables_Generate_Script</a>で、いつでも州テーブルの集合を削除するクエリを出すことができます。</p><p>データのロードを可能にするためには次のツールが必要です。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>センサスウェブサイトから取得するZIPファイルを展開するツール。</p><p>Unix系システムでは、<code class="varname">unzip</code>実行ファイルです。通常は、ほとんどのUnix系プラットフォームで既にインストールされています。</p><p>Windowsでは7-zipです。<a class="ulink" href="http://www.7-zip.org/" target="_top">http://www.7-zip.org/</a>からダウンロードできる無償の圧縮解答ツールです。 </p></li><li class="listitem"><p><code class="filename">shp2pgsql</code>コマンド。PostGISインストール時にデフォルトでインストールされます。</p></li><li class="listitem"><p><code class="filename">wget</code>コマンド。通常はほとんどのUnix/Linuxシステムにインストールされている、ウェブ取得ツールです。</p><p>Windows用については、コンパイル済みのバイナリを<a class="ulink" href="http://gnuwin32.sourceforge.net/packages/wget.htm" target="_top">http://gnuwin32.sourceforge.net/packages/wget.htm</a>から取得できます。 </p></li></ul></div><p>tiger_2010からアップグレードする場合には、最初に<a class="xref" href="#Drop_Nation_Tables_Generate_Script" title="Drop_Nation_Tables_Generate_Script">Drop_Nation_Tables_Generate_Script</a>を生成、実行する必要があります。州データをロードする前に、<a class="xref" href="#Loader_Generate_Nation_Script" title="Loader_Generate_Nation_Script">Loader_Generate_Nation_Script</a>で国データをロードする必要があります。これによって、環境に合ったローダスクリプトが生成されます。<a class="xref" href="#Loader_Generate_Nation_Script" title="Loader_Generate_Nation_Script">Loader_Generate_Nation_Script</a>は、一度の操作で、(2010からの)アップグレードと、新しいインストールが行われます。</p><p>州データをロードするには、<a class="xref" href="#Loader_Generate_Script" title="Loader_Generate_Script">Loader_Generate_Script</a>を参照して、手持ちのプラットフォームで動作する、求める州データをロードするデータロードスクリプトを生成します。州データはひとつずつダウンロードできることに注意して下さい。一度に必要な州の全てについてデータをロードする必要はありません。必要なだけダウンロードできます。</p><p>求める州データをロードした後は、<a class="xref" href="#Install_Missing_Indexes" title="Install_Missing_Indexes">Install_Missing_Indexes</a>に示すように、</p><pre class="programlisting">SELECT install_missing_indexes();</pre><p>を実行するようにして下さい。</p><p>行うべきことができたかをテストするために、<a class="xref" href="#Geocode" title="Geocode">Geocode</a>を使用する州の中の住所についてジオコーダを実行してみます。 </p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="upgrade_tiger_geocoder"></a>2.8.5. Tigerジオコーダのアップグレード</h3></div></div></div><p>2.0以上に含まれるTigerジオコーダがインストールされている場合には、どうしても必要な訂正があるときは、いつでも臨時のアーカイブファイルからでも機能のアップグレードができます。 これは、エクステンションでインストールされていないTigerジオコーダで動作します。 </p><p>extrasフォルダが無い場合、<a class="ulink" href="http://download.osgeo.org/postgis/source/postgis-2.5.0.tar.gz" target="_top">http://download.osgeo.org/postgis/source/postgis-2.5.0.tar.gz</a>をダウンロードします。 </p><p>
		  <span class="command"><strong>tar xvfz postgis-2.5.0.tar.gz</strong></span>
		</p><p>
		  <span class="command"><strong>cd postgis-2.5.0/extras/tiger_geocoder/tiger_2011</strong></span>
		</p><p>Windowsの場合は<code class="filename">upgrade_geocoder.bat</code>スクリプト、Linux/Unix/MacOS Xの場合は<code class="filename">upgrade_geocoder.sh</code>スクリプトの位置を特定します。 PostGISデータベースの資格情報を持つように編集します。</p><p>2010または2011からアップグレードする場合には、確実にローダスクリプトのコメントアウトを消すと、2012データのロードのための最新のスクリプトを得ます。</p><p>対応するスクリプトをコマンドラインから実行します。 </p><p>次に、全ての国テーブルを削除し、新しい国テーブルをロードします。<a class="xref" href="#Drop_Nation_Tables_Generate_Script" title="Drop_Nation_Tables_Generate_Script">Drop_Nation_Tables_Generate_Script</a>に詳細がある通り、このSQLステートメントを使った削除スクリプトを生成します。</p><pre class="programlisting">SELECT drop_nation_tables_generate_script();</pre><p>生成した削除SQLステートメントを実行します。</p><p><a class="xref" href="#Loader_Generate_Nation_Script" title="Loader_Generate_Nation_Script">Loader_Generate_Nation_Script</a>に詳細がある通り、このSELECTステートメントを使った削除スクリプトを生成します。</p><p><span class="bold"><strong>Windows向け</strong></span></p><pre class="programlisting">SELECT loader_generate_nation_script('windows'); </pre><p><span class="bold"><strong>Unix/Linux向け</strong></span></p><pre class="programlisting">SELECT loader_generate_nation_script('sh');</pre><p>生成したスクリプトの実行方法に関する説明は、<a class="xref" href="#tiger_geocoder_loading_data" title="2.8.4. Tigerデータのロード">「Tigerデータのロード」</a>を参照して下さい。これは一度だけ実行する必要があります。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>2010/2011州テーブルを混在させることができ、それぞれの州について個別にアップグレードできます。2011にアップグレードする前に、まず、<a class="xref" href="#Drop_State_Tables_Generate_Script" title="Drop_State_Tables_Generate_Script">Drop_State_Tables_Generate_Script</a>を使って、2010州テーブルを削除します。</p></td></tr></table></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="templatepostgis"></a>2.9. 空間データベースをテンプレートから生成する</h2></div></div></div><p>PostGISのディストリビューション (特にPostGIS &gt;= 1.1.5のWin32インストーラ)の中には、<code class="varname">template_postgis</code>というテンプレートにPostGIS関数をロードしていることがあります。PostgreSQLに<code class="varname">template_postgis</code>データベースが存在するなら、ユーザやアプリケーションは、空間データベースの生成をコマンドひとつで済ませられます。この2種類のやり方のどちらを使うににしても、データベースユーザは、新しいデータベースを作成する権限を与えられている必要があります。 </p><p>シェルからの実行は次の通りです。 </p><pre class="programlisting"># createdb -T template_postgis my_spatial_db</pre><p>SQLからの実行は次の通りです。 </p><pre class="programlisting">postgres=# CREATE DATABASE my_spatial_db TEMPLATE=template_postgis</pre></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="upgrading"></a>2.10. アップグレード</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="#soft_upgrade">2.10.1. ソフトアップグレード </a></span></dt><dt><span class="sect2"><a href="#hard_upgrade">2.10.2. ハードアップグレード</a></span></dt></dl></div><p>既存の空間データベースのアップグレードは、新しいPostGISオブジェクト定義の置き換えや導入を必要とするとき、慎重を要することがあります。 </p><p>不幸なことに、定義の全てが実行中のデータベース内で簡単には置き換えられるわけではないので、ダンプ/リロードが最善策となることがあります。 </p><p>PostGISには、マイナーバージョンアップやバグフィクスリリースの場合に使うソフトアップグレードと、メジャーアップグレードで使うハードアップグレードが用意されています。 </p><p>PostGISをアップグレードしようとする前にデータのバックアップを取ることは、常に価値のあるものです。pg_dumpで -Fc フラグを使うと、ハードアップグレードによってダンプを常にリストアすることができます。 </p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="soft_upgrade"></a>2.10.1. ソフトアップグレード </h3></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect3"><a href="#soft_upgrade_sql_script">2.10.1.1. 9.1より前またはエクステンションを使わないソフトアップグレード</a></span></dt><dt><span class="sect3"><a href="#soft_upgrade_extensions">2.10.1.2. 9.1以上でエクステンションを使ったソフトアップグレード</a></span></dt></dl></div><p>エクステンションを使ってインストールした場合は、エクステンションモデルでアップグレードしなければなりません。 古いSQLスクリプトを使ってインストールした場合は、SQLスクリプトでアップグレードすべきです。適切な方を参照して下さい。</p><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="soft_upgrade_sql_script"></a>2.10.1.1. 9.1より前またはエクステンションを使わないソフトアップグレード</h4></div></div></div><p>PostGISをエクステンションを使わずにインストールした人向けです。エクステンションを使っていてこの方法を使うと、次のようなメッセージが現れます。</p><pre class="programlisting">can't drop ... because postgis extension depends on it</pre><p>コンパイルとインストールの後に<code class="filename">postgis_upgrade.sql</code>と<code class="filename">rtpostgis_upgrade.sql</code>を探して下さい。たとえば<code class="filename">/usr/share/postgresql/9.3/contrib/postgis_upgrade.sql</code>です。<code class="filename">postgis_upgrade.sql</code>をインストールして下さい。ラスタ機能をインストールしている場合には、<code class="filename">/usr/share/postgresql/9.3/contrib/rtpostgis_upgrade.sql</code>もインストールします。PostGIS 1.*から2.*に移動したり、2.*からr7409以前に落とす場合は、ハードアップグレードして下さい。 </p><pre class="programlisting">psql -f postgis_upgrade.sql -d [データベース名]</pre><p>ラスタ機能とトポロジ機能についても同じ手続きです。それぞれ<code class="filename">rtpostgis_upgrade*.sql</code>と<code class="filename">topology_upgrade*.sql</code>とになります。次のようにします。 </p><pre class="programlisting">psql -f rtpostgis_upgrade.sql -d [データベース名]</pre><pre class="programlisting">psql -f topology_upgrade.sql -d [データベース名]</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>アップグレードのための特定の版の<code class="filename">postgis_upgrade*.sql</code>が見つからない場合は、非常に古い版を使っています。ハードアップグレードが必要です。 </p></td></tr></table></div><p><a class="xref" href="#PostGIS_Full_Version" title="PostGIS_Full_Version">PostGIS_Full_Version</a>関数の"procs need upgrade"というメッセージで、この種のアップグレードを実行する必要性についての情報が得られます。 </p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="soft_upgrade_extensions"></a>2.10.1.2. 9.1以上でエクステンションを使ったソフトアップグレード</h4></div></div></div><p>エクステンションを使ってPostGISをインストールした場合には、エクステンションを使ってアップグレードする必要があります。エクステンションを使ったマイナーアップグレードはかなり楽です。</p><pre class="programlisting">ALTER EXTENSION postgis UPDATE TO "2.5.0";
ALTER EXTENSION postgis_topology UPDATE TO "2.5.0";</pre><p>次のようなエラー通知が表示されることがあります。</p><pre class="programlisting">No migration path defined for ... to 2.5.0</pre><p>この場合は、データベースをバックアップして、<a class="xref" href="#create_new_db_extensions" title="2.5. エクステンションを使った空間データベースの生成">「エクステンションを使った空間データベースの生成」</a>に記述されているように新しいデータベースを生成し、バックアップを新しいデータベースにリストアしなければなりません。</p><p>次のようなメッセージを得ることがあります。</p><pre class="programlisting">Version "2.5.0" of extension "postgis" is already installed</pre><p>この場合は、全てアップデートされていて、安全に無視できます。SVN版から次版(新しい版番号を得ていないもの)にアップグレード<span class="bold"><strong>しようとしない限り</strong></span>、"next"を版文字列に追加できます。ただし、次回に"next"を削除する必要があります。 </p><pre class="programlisting">ALTER EXTENSION postgis UPDATE TO "2.5.0next";
ALTER EXTENSION postgis_topology UPDATE TO "2.5.0next";</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>PostGISをバージョン指定なしにインストールした場合には、 しばしばリストアの前のPostGIS EXTENSIONの再インストールをとばすことができます。 バックアップは<code class="code">CREATE EXTENSION postgis</code>だけで、リストアの間に最新版になります。</p></td></tr></table></div></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="hard_upgrade"></a>2.10.2. ハードアップグレード</h3></div></div></div><p>ハードアップグレードとは、PostGISで利用可能なデータの完全なダンプ/リロードを意味します。PostGISオブジェクトの内部格納状態が変更される場合や、ソフトアップグレードができない場合に、ハードアップグレードが必要です。付録の<a class="link" href="#release_notes" title="付録A 付録">リリースノート</a>に、版ごとについて、ダンプ/リロード (ハードアップグレード)の要否を記載しています。 </p><p>ダンプ/リロード作業はpostgis_restore.plスクリプトが補助します。このスクリプトは、PostGIS (古いものを含む)に属する定義を全て飛ばすように注意します。また、重複シンボルエラーや非推奨オブジェクトを持越すことなく、スキーマとデータをPostGISをインストールしたデータベースにリストアできます 。 </p><p>Windows用に関する追加情報は<a class="ulink" href="http://trac.osgeo.org/postgis/wiki/UsersWikiWinUpgrade" target="_top">Windows Hard upgrade</a>にあります。</p><p>手続きは次の通りです。  </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>アップグレードしたデータベース (<code class="varname">olddb</code>と呼ぶことにしましょう)の「カスタム書式」のダンプを、バイナリBLOBデータを含めたダンプを指定して (-b)、verboseモード (-v)で生成します。ユーザはデータベースのオーナーになることができ、PostgreSQLのスーパーユーザである必要はありません。 </p><pre class="programlisting">pg_dump -h localhost -p 5432 -U postgres -Fc -b -v -f "/somepath/olddb.backup" olddb</pre></li><li class="listitem"><p>新しいデータベースにPostGISを、PostGISが無い状態からインストールします。このデータベースを<code class="varname">newdb</code>と呼ぶことにします。この作業に関する説明については<a class="xref" href="#create_new_db" title="2.6. 空間データベースをエクステンションを使わずに生成する">「空間データベースをエクステンションを使わずに生成する」</a>と<a class="xref" href="#create_new_db_extensions" title="2.5. エクステンションを使った空間データベースの生成">「エクステンションを使った空間データベースの生成」</a>とを参照して下さい。 </p><p>ダンプにあるspatial_ref_sysは、リストアされますが、既にあるspatial_ref_sysを上書きしません。リストア対象のデータベースに公式データセットの訂正が確実に伝わるようにするためです。標準のエントリを上書きしたい場合は、newdbを生成する際にspaltial_ref_sys.sqlファイルをロードしないだけです。 </p><p>データベースが本当に古く、ビューや関数に、長く非推奨になっている関数があるような場合には、関数やビューを使えるようにするlegacy.sqlをロードする必要があるでしょう。ただし、本当に必要な場合に限ります。可能なら、ビューや関数をダンプせずにアップグレードすることを検討して下さい。非推奨関数は、<code class="filename">uninstall_legacy.sql</code>で後から削除することができます。 </p></li><li class="listitem"><p>バックアップを新しい<code class="varname">newdb</code>データベースにリストアするには、postgis_restore.plを使います。psqlが予期せぬエラーを標準エラー出力に出すことがあります。これらのログを保存しておいて下さい。 </p><pre class="programlisting">perl utils/postgis_restore.pl "/somepath/olddb.backup" | psql -h localhost -p 5432 -U postgres newdb 2
&gt; errors.txt</pre></li></ol></div><p>エラーは次の場合に起こりえます。 </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>ビューまたは関数の中に非推奨のPostGISオブジェクトを使っているものがある場合。これの訂正には、リストア前に<code class="filename">legacy.sql</code>スクリプトのロードを試してみることができます。非推奨オブジェクトをまだ持っている版のPostGISにリストアして、コードを作り替えた後に再び移動させることもできます。 <code class="filename">legacy.sql</code>を利用する場合は、非推奨関数を使うのをやめたコードに訂正して、<code class="filename">uninstall_legacy.sql</code>をロードするのを忘れないでください。 </p></li><li class="listitem"><p>ダンプファイル内のspatial_ref_sysにあるカスタムレコードが不正なSRIDになっていることがあります。妥当なSRID値は0より大きく999000より小さくなります。999000から999999の間は内部利用のための予約領域ですが、999999より大きい値は一切使用できません。全ての不正なSRIDを持つ独自レコードは、予約領域に移動しても保持されます。しかし、spatial_ref_sysテーブルから、値が保持されるように設定されているチェック制約が外れます。場合によっては (複数の不正なSRIDが同じ予約領域のSRID値に変換されるとき)、主キーも外れます。 </p><p>これの訂正には、カスタムSRSを妥当値 (多分91000から910999の間になります)に複写して、全てのテーブルを新しいSRIDに変換して(<a class="xref" href="#UpdateGeometrySRID" title="UpdateGeometrySRID">UpdateGeometrySRID</a>を参照して下さい)、不正なエントリをspatial_ref_sysから削除して、次を実行してチェック制約を再構築します。 </p><pre class="programlisting">ALTER TABLE spatial_ref_sys ADD CONSTRAINT spatial_ref_sys_srid_check check (srid &gt; 0 AND srid &lt; 999000 );</pre><p>

		</p><pre class="programlisting">ALTER TABLE spatial_ref_sys ADD PRIMARY KEY(srid));</pre><p>

	</p></li></ol></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp65278536"></a>2.11. 共通の問題</h2></div></div></div><p>インストールやアップグレードが思うようにいかない時にチェックすることがいくつかあります。 </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>PostgreSQL 9.4以上をインストールしているか、実行中のPostgreSQLと同じ版のソースでコンパイルしているか、をチェックします。(Linuxの)ディストリビューションによって既にPostgreSQLがインストールされている時や、 PostgreSQLを以前にインストールして忘れた場合に、 混乱が発生することがあります。PostGISはPostgreSQL 9.4以上で動作します。古い版のものを使った場合には、おかしな予想外のエラーメッセージが表示されます。実行中のPostgreSQLの版をチェックするには、psqlを使ってデータベースを接続して、次のクエリを実行して下さい。 </p><pre class="programlisting">SELECT version();</pre><p>RPMベースのディストリビューションを実行している場合、 プリインストールされたパッケージが存在するかのチェックは、<span class="command"><strong>rpm</strong></span> コマンドを使って<span class="command"><strong>rpm -qa | grep postgresql</strong></span>でチェックできます。 </p></li><li class="listitem"><p>アップグレードに失敗する場合、既にPostGISがインストールされているデータベースにリストアしているか確認して下さい。</p><pre class="programlisting">SELECT postgis_full_version();</pre></li></ol></div><p>また、コンフィギュアが正しくPostgreSQL、Proj4ライブラリ、GEOSライブラリのインストール先を検出したかチェックして下さい。 </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>コンフィギュアからの出力で<code class="filename">postgis_config.h</code>ファイルが作られます。<code class="varname">POSTGIS_PGSQL_VERSION</code>、<code class="varname">POSTGIS_PROJ_VERSION</code>および<code class="varname">POSTGIS_GEOS_VERSION</code>変数が正しくセットされたかをチェックして下さい。 </p></li></ol></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp65308232"></a>2.12. ローダ/ダンパ </h2></div></div></div><p>データのローダとダンパは、PostGISのビルドの一部として、自動的にビルド、インストールされます。手動でビルド、インストールするには、次を実行します。 </p><pre class="programlisting"># cd postgis-2.5.0/loader
# make
# make install</pre><p>ローダは<code class="filename">shp2pgsql</code>と呼ばれ、ESRIシェープファイルをPostGIS/PostgreSQLにロードするのに適したSQLに変換します。ダンパは<code class="filename">pgsql2shp</code>と呼ばれ、PostGISのテーブル(またはクエリ)からESRIシェープファイルに変換します。より詳しいドキュメントをご覧になるには、オンラインヘルプとマニュアルページをご覧ください。 </p></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="PostGIS_FAQ"></a>第3章 PostGIS よくある質問</h1></div></div></div><div class="qandaset"><a name="idp65818824"></a><dl><dt>3.1. <a href="#faq_where_tutorials">PostGISでの作業に関するチュートリアル、ガイド、ワークショップはどこにありますか?</a></dt><dt>3.2. <a href="#legacy_faq">PostGIS 1.5で動作していたアプリケーションやデスクトップツールがPostGIS 2.0では動作しなくなりました。解消するにはどうすればよいでしょうか?</a></dt><dt>3.3. <a href="#legacy_faq_gist">osm2pgsqlを使ってOpenStreetMapデータをロードするときに、failed: ERROR: operator class "gist_geometry_ops" does not exist for access method "gist"というエラーが発生しました。PostGIS 1.5では正しく動作していました。</a></dt><dt>3.4. <a href="#legacy_faq_read_view">PostgreSQL 9.0を使っていますが、OpenJump、Safe FME等のツールでジオメトリの読み取りや表示ができなくなってしまいましたが?</a></dt><dt>3.5. <a href="#pgadmin_shows_no_data_in_geom">pgAdminを使ってジオメトリカラムを表示しようとしたら空っぽでした。何か方法はありませんか?</a></dt><dt>3.6. <a href="#idp65860936">どの種類のジオメトリオブジェクトを格納できますか?</a></dt><dt>3.7. <a href="#idp65863624">たいへん混乱しました。ジオメトリとジオグラフィのどちらを使うべきでしょうか?</a></dt><dt>3.8. <a href="#idp65867848">もっとジオグラフィについて聞きたいです。 たとえば、ジオグラフィカラムにデータを入れて合理的な答えが得られる領域範囲はどれぐらいでしょうか、とか。極、全データが半球上になければならないのでしょうか(SQL Server 2008はそう)、速度等の制限はあるのでしょうか、とか。</a></dt><dt>3.9. <a href="#faq_how_to_define_geometry_table">GISオブジェクトをデータベースに挿入するにはどうしますか?</a></dt><dt>3.10. <a href="#idp65882184">空間クエリを作成するにはどうするのですか?</a></dt><dt>3.11. <a href="#idp65886280">大きなテーブルでの空間クエリの速度向上はどうするのですか?</a></dt><dt>3.12. <a href="#idp65893064">なぜPostgreSQLのR木インデクス機能を持たないのですか?</a></dt><dt>3.13. <a href="#idp65897288">なぜ AddGeometryColumn()関数と他のOpsnGIS関数を使うべきなのですか?</a></dt><dt>3.14. <a href="#idp65913544">半径内にあるオブジェクトを全て検索する最善の方法は何ですか?</a></dt><dt>3.15. <a href="#idp65917000">クエリの一部として投影変換を実現するにはどうしますか?</a></dt><dt>3.16. <a href="#idp65919432">ST_AsEWKTとST_AsTextとを、かなり大きいジオメトリで実行すると、空のフィールドが返りました。どうしたら良いですか?</a></dt><dt>3.17. <a href="#idp65921864">ST_Intersectsを使うと、二つのジオメトリがインタセクトしているのが分かっているのに、インタセクトしていないと言います。どうしたら良いですか?</a></dt><dt>3.18. <a href="#license_faq">PostGISを用いたソフトウェアをリリースしています。PostGISのようにGPLライセンスを使う必要があるのでしょうか?PostGISを使うとコードを全て公開しなければならないのでしょうか?</a></dt></dl><table border="0" style="width: 100%;"><colgroup><col align="left" width="1%"><col></colgroup><tbody><tr class="question"><td align="left" valign="top"><a name="faq_where_tutorials"></a><a name="idp65819464"></a><p><b>3.1.</b></p></td><td align="left" valign="top"><p>PostGISでの作業に関するチュートリアル、ガイド、ワークショップはどこにありますか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>OpenGeoが手順ごとのチュートリアルガイドワークショップ<a class="ulink" href="http://workshops.boundlessgeo.com/postgis-intro/" target="_top">Introduction to PostGIS</a>を出しています。OpenGeo Suiteでの作業の入門編だけでなく梱包されたデータもあります。PostGISの最善のチュートリアルかも知れません。</p><p>BostonGISにも<a class="ulink" href="http://www.bostongis.com/PrinterFriendly.aspx?content_name=postgis_tut01" target="_top">PostGIS almost idiot's guide on getting started</a>があります。Windowsユーザに、より軸足を置いています。</p></td></tr><tr class="question"><td align="left" valign="top"><a name="legacy_faq"></a><a name="idp65843400"></a><p><b>3.2.</b></p></td><td align="left" valign="top"><p>PostGIS 1.5で動作していたアプリケーションやデスクトップツールがPostGIS 2.0では動作しなくなりました。解消するにはどうすればよいでしょうか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>PostGIS 2.0で、多数の非推奨関数がPostGISコードから削除されました。これは、GeoServer, MapServer, QuantumGIS, OpenJump等のサードバーティツールに加えて、アプリケーションにも影響が出ます。これを解決する方法が二つあります。サードパーティアプリケーションの場合は、これらの問題の多くが解決されている最新版にアップグレードしてみることで対応できます。 ご自身のコードの場合は、削除された関数を使わないようにソースを変更することで対応できます。 削除された関数のほとんどは、ST_Unino, ST_Length等のエイリアスで、ST_を取ったものです。最後の手段として<code class="varname">legacy.sql</code>の全体または<code class="varname">legacy.sql</code>の必要な部分をインストールします。</p><p> <code class="varname">legacy.sql</code>ファイルはpostgis.sqlのインストール先と同じフォルダにあります。postgis.sqlとspatial_ref_sys.sqlをインストールした後、このファイルをインストールすると、削除した200余の関数を復帰させられます。</p></td></tr><tr class="question"><td align="left" valign="top"><a name="legacy_faq_gist"></a><a name="idp65846984"></a><p><b>3.3.</b></p></td><td align="left" valign="top"><p>osm2pgsqlを使ってOpenStreetMapデータをロードするときに、failed: ERROR: operator class "gist_geometry_ops" does not exist for access method "gist"というエラーが発生しました。PostGIS 1.5では正しく動作していました。</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>PostGIS 2では、デフォルトのジオメトリ演算子クラスがgist_geometry_opsからgist_geometry_ops_2dに変更され、gist_geometry_opsは完全に削除されました。PostGIS 2は3次元対応のためN次元空間インデクスを導入しました。古い名前は混乱させるものであり、誤称であると考えました。</p><p>古いアプリケーションには、処理の一部として、テーブルやインデクスを生成する際に、明示的に演算子クラス名を参照しているものがありました。デフォルトの2次元インデクスが欲しい場合には重要ではありません。エラーが内容に管理するために、インデクス生成を次に示す悪い例から良い例に変えて下さい。</p><p>悪い例</p><pre class="programlisting">CREATE INDEX idx_my_table_geom ON my_table USING gist(geom gist_geometry_ops);</pre><p>良い例</p><pre class="programlisting">CREATE INDEX idx_my_table_geom ON my_table USING gist(geom);</pre><p>演算子クラスを指定する必要が出るのは、3次元空間が求められる場合です。次のようにします。</p><pre class="programlisting">CREATE INDEX idx_my_super3d_geom ON my_super3d USING gist(geom gist_geometry_ops_nd);</pre><p>不幸にもgist_geometry_opsがハードコーディングされていて変更不可なコンパイルされたコードを突きつけられているなら、PostGIS 2.0.2以上に同梱されている<code class="filename">legacy_gist.sql</code>を使用して、古いクラスを生成することができます。しかしながら、この方法を使う場合は、後ほどインデクスを削除して、演算子クラスを指定せずに再生成させるべきです。将来再びアップデートする必要がある時に泣いてしまうことを抑制します。</p></td></tr><tr class="question"><td align="left" valign="top"><a name="legacy_faq_read_view"></a><a name="idp65853000"></a><p><b>3.4.</b></p></td><td align="left" valign="top"><p>PostgreSQL 9.0を使っていますが、OpenJump、Safe FME等のツールでジオメトリの読み取りや表示ができなくなってしまいましたが?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>PostgreSQL 9.0以上では、byteaデータのデフォルトのエンコーディングがhexに変更されました。古いJDBCドライバはエスケープ形式を仮定しています。古いJDBCドライバを使ったJavaアプリケーションや古いNpgsqlドライバを使った.Netアプリケーションといった、ST_AsBinaryの古い挙動を期待するアプリケーションが影響を受けます。再び動作させるには二つの方法があります。</p><p>JDBCドライバを最新のPostgreSQL 9.0版にアップグレードします。<a class="ulink" href="http://jdbc.postgresql.org/download.html" target="_top">http://jdbc.postgresql.org/download.html</a>からダウンロードできます。</p><p>.Netアプリケーションについては、Npgsql 2.0.11以上を使います。<a class="ulink" href="http://pgfoundry.org/frs/?group_id=1000140" target="_top">http://pgfoundry.org/frs/?group_id=1000140</a>からダウンロードできます。また、<a class="ulink" href="http://fxjr.blogspot.com/2010/11/npgsql-2011-released.html" target="_top">Francisco Figueiredo's NpgSQL 2.0.11 released blog entry</a>に説明があります。</p><p>PostgreSQLドライバのアップグレードが選択できないなら、デフォルトで古い挙動をするようにします。次のようにします。</p><pre class="programlisting">ALTER DATABASE mypostgisdb SET bytea_output='escape';</pre></td></tr><tr class="question"><td align="left" valign="top"><a name="pgadmin_shows_no_data_in_geom"></a><a name="idp65858248"></a><p><b>3.5.</b></p></td><td align="left" valign="top"><p>pgAdminを使ってジオメトリカラムを表示しようとしたら空っぽでした。何か方法はありませんか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>pgAdminは大きなジオメトリを表示しません。ジオメトリカラムがそうなっていないかを確かめる最善の方法は次の通りです。</p><pre class="programlisting">-- 全てのgeomカラムに値が入っている場合にはレコードが返りません
SELECT somefield FROM mytable WHERE geom IS NULL;</pre><pre class="programlisting">-- ジオメトリがどれぐらい大きいかを調べるには
-- ジオメトリカラムの中でジオメトリごとに、それが持つポイントの数を
-- 尋ねるかたちのクエリを実行します
SELECT MAX(ST_NPoints(geom)) FROM sometable;</pre></td></tr><tr class="question"><td align="left" valign="top"><a name="idp65860936"></a><a name="idp65861192"></a><p><b>3.6.</b></p></td><td align="left" valign="top"><p>どの種類のジオメトリオブジェクトを格納できますか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>ポイント、ラインストリング、ポリゴン、マルチポイント、マルチラインストリング、マルチポリゴン、ジオメトリコレクションです。PostGIS 2.0以上では、基本ジオメトリタイプとしてTINと多面体サーフェスも格納できます。これらはOpen GIS Well Known Text形式(XYZ, XYM, XYZM拡張付き)で指定されます。現在サポートされているのは3つのデータ型です。計測に平面座標系を使う標準OGCジオメトリデータ型があります。また、地理座標系を使い、球面または回転楕円体面上の計算を行うジオグラフィデータ型があります。最新のPostGIS空間型群に追加されたのが、ラスタデータの格納と解析に使われるラスタ型です。ラスタ型単独で「よくある質問」を用意しています。詳細については<a class="xref" href="#RT_FAQ" title="第10章 PostGISラスタ よくある質問">10章<i>PostGISラスタ よくある質問</i></a>と<a class="xref" href="#RT_reference" title="第9章 ラスタ リファレンス">9章<i>ラスタ リファレンス</i></a>をご覧ください。</p></td></tr><tr class="question"><td align="left" valign="top"><a name="idp65863624"></a><a name="idp65863880"></a><p><b>3.7.</b></p></td><td align="left" valign="top"><p>たいへん混乱しました。ジオメトリとジオグラフィのどちらを使うべきでしょうか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>短い答: ジオグラフィは長距離の測定をサポートする新しいデータ型ですが、計算速度は現在のところジオメトリの計算より遅いです。ジオグラフィを使う場合は、平面座標系についてあまり多く学習する必要がありません。行うことが距離や長さの計測に限定され、かつ世界中からのデータを持っている場合は、一般的にジオグラフィが最善です。ジオメトリは古いデータ型で、サポートする関数が多く、サードパーティからの多大なサポートが得られます。計算速度も早く、大きなジオメトリでは10倍違います。空間参照系に慣れているか、<a class="link" href="#spatial_ref_sys" title="4.3.1. SPATIAL_REF_SYSテーブルと空間参照系">空間参照系 (SRID)</a>が単一で済むような局所的なデータを扱っているか、あるいは、空間処理を多く行う必要がある場合には、ジオメトリが最善です。ご注意: 簡単に二つの型の相互変換を行ってそれぞれの利点を得ることができます。現在サポートされているもの、サポートされていないものについては<a class="xref" href="#PostGIS_TypeFunctionMatrix" title="14.11. PostGIS関数対応マトリクス">「PostGIS関数対応マトリクス」</a>を参照して下さい。 </p><p> 長い答: <a class="xref" href="#PostGIS_GeographyVSGeometry" title="4.2.2. ジオグラフィ型をジオメトリ型にして使用すべき時">「ジオグラフィ型をジオメトリ型にして使用すべき時」</a>と<a class="link" href="#PostGIS_TypeFunctionMatrix" title="14.11. PostGIS関数対応マトリクス">function type matrix</a>とを参照して下さい。 </p></td></tr><tr class="question"><td align="left" valign="top"><a name="idp65867848"></a><a name="idp65868104"></a><p><b>3.8.</b></p></td><td align="left" valign="top"><p>もっとジオグラフィについて聞きたいです。 たとえば、ジオグラフィカラムにデータを入れて合理的な答えが得られる領域範囲はどれぐらいでしょうか、とか。極、全データが半球上になければならないのでしょうか(SQL Server 2008はそう)、速度等の制限はあるのでしょうか、とか。</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>その質問は相当深く複雑で、このセクションで十分に答えられません。<a class="xref" href="#PostGIS_Geography_AdvancedFAQ" title="4.2.3. ジオグラフィに関する高度なよくある質問">「ジオグラフィに関する高度なよくある質問」</a>を参照して下さい。</p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq_how_to_define_geometry_table"></a><a name="idp65870536"></a><p><b>3.9.</b></p></td><td align="left" valign="top"><p>GISオブジェクトをデータベースに挿入するにはどうしますか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>まず、GISデータを保持するために"geometry"または"geogprahy"カラムを持つテーブルを作成します。ジオグラフィデータ型の格納は、ジオメトリデータ型とは若干異なります。ジオグラフィの格納については<a class="xref" href="#Geography_Basics" title="4.2.1. ジオグラフィ基礎">「ジオグラフィ基礎」</a>を参照して下さい。 </p><p>ジオメトリについては、psqlでデータベースに接続して、次のSQLを試してみて下さい。</p><pre class="programlisting">CREATE TABLE gtest (id serial primary key, name varchar(20), geom geometry(LINESTRING));</pre><p>ジオメトリカラムの追加に失敗する場合は、もしかしたらPostGISの関数とオブジェクトをデータベースにロードしていないか、2.0より前の版のPostGISなのかも知れません。<a class="xref" href="#PGInstall" title="2.4. ソースからのコンパイルとインストール: 詳細">「ソースからのコンパイルとインストール: 詳細」</a>を参照して下さい。</p><p>これで、SQLのINSERTステートメントを使って、ジオメトリをテーブルに挿入することができます。GISオブジェクト自体は、OpenGISコンソーシアムの"well-known text"形式を使っています。</p><pre class="programlisting">INSERT INTO gtest (ID, NAME, GEOM)
VALUES (
  1,
  'First Geometry',
  ST_GeomFromText('LINESTRING(2 3,4 5,6 5,7 8)')
);</pre><p>他のGISオブジェクトの詳細については<a class="link" href="#RefObject" title="4.1. GISオブジェクト">object reference</a>をご覧ください。</p><p>テーブル内にあるGISデータを表示するには、次のようにします。</p><pre class="programlisting">SELECT id, name, ST_AsText(geom) AS geom FROM gtest;</pre><p>返り値は次のようなかんじになります。</p><pre class="programlisting">id | name           | geom
----+----------------+-----------------------------
  1 | First Geometry | LINESTRING(2 3,4 5,6 5,7 8)
(1 row)</pre></td></tr><tr class="question"><td align="left" valign="top"><a name="idp65882184"></a><a name="idp65882440"></a><p><b>3.10.</b></p></td><td align="left" valign="top"><p>空間クエリを作成するにはどうするのですか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>他のデータベースクエリを作るのと同じで、返り値、関数、テストのSQLの組み合わせです。</p><p>空間クエリでは、クエリを作成する際に心を平静に保つための重要な二つの問題があります。 一つは、使用することができる空間インデクスがあるか、です。もう一つは、多数のジオメトリを相手に計算量の多い計算を行っているか、です。</p><p>一般的に、フィーチャーのバウンディングボックスがインタセクト (交差)しているかをテストするインタセクト演算子 (&amp;&amp;)を使います。&amp;&amp;演算子が便利な理由は、速度向上のために空間インデクスが付けられているなら、&amp;&amp;演算子は空間インデクスを使うからです。これによって、クエリの速度はとてもとても速くなります。</p><p>また、検索結果をより狭めるために、Distance(), ST_Intersects(), ST_Contains(), ST_Within() などといった空間関数を使うことでしょう。ほとんどの空間クエリは、インデクスのテストと空間関数のテストを含みます。インデクスのテストで返ってくるタプルを、求める条件に<span class="emphasis"><em>合致するかもしれない</em></span>タプルのみとして、タプルの数を制限します。それから、空間関数で確実な条件のテストを行います。</p><pre class="programlisting">SELECT id, the_geom
FROM thetable
WHERE
  ST_Contains(the_geom,'POLYGON((0 0, 0 10, 10 10, 10 0, 0 0))');</pre></td></tr><tr class="question"><td align="left" valign="top"><a name="idp65886280"></a><a name="idp65886536"></a><p><b>3.11.</b></p></td><td align="left" valign="top"><p>大きなテーブルでの空間クエリの速度向上はどうするのですか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>大きなテーブルの速いクエリは、空間データベースの<span class="emphasis"><em>レゾンデートル</em></span> (トランザクションサポートもそうですが)で、良いインデクスは重要です。</p><p><code class="varname">geometry</code>カラムを持つテーブルでの空間インデクスの構築は、"CREATE INDEX"を使って、次のようにします。</p><pre class="programlisting">CREATE INDEX [インデクス名] ON [テーブル名] USING GIST ( [ジオメトリカラム] );</pre><p>"USING GIST"オプションによって、サーバにGiST (Generalized Search Tree)インデクスを作るよう指示が渡ります。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>GiSTインデクスは、不可逆であると仮定します。不可逆インデクスの構築には、代理オブジェクト (空間インデクスの場合はバウンディングボックス)を使います。</p></td></tr></table></div><p>PostgreSQLのクエリプランナがインデクスを作るべきかについて合理的な決定を行うよう、十分な情報を確実に持てるようにすべきです。そのために、ジオメトリテーブル上で"gather statistics"を実行しなければなりません。</p><p>PostgreSQL 8.0.x以上では、<span class="command"><strong>VACUUM ANALYZE</strong></span>コマンドを実行するだけです。</p><p>PostgreSQL 7.4.x以下では、<span class="command"><strong>SELECT UPDATE_GEOMETRY_STATS()</strong></span>を実行します。</p></td></tr><tr class="question"><td align="left" valign="top"><a name="idp65893064"></a><a name="idp65893320"></a><p><b>3.12.</b></p></td><td align="left" valign="top"><p>なぜPostgreSQLのR木インデクス機能を持たないのですか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>PostGISの、かつての版では、PostgreSQLのR木インデクスを使っていましたが、0.6版でPostgreSQLのR木は完全に捨てて、R-Tree-over-GiSTスキームによる空間インデクスを提供しています。</p><p>私たちの試験では、R木とGiSTの検索速度は同程度であることが示されています。PostgreSQLのR木には、GISフィーチャーで使うためには好ましくない二つの制限があります (これらの制限は現在のPostgreSQLネイティブのR木実装についてであって、R木一般の話ではありません)。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>PostgreSQLのR木インデクスは、8K以上のサイズのフィーチャーは扱えません。GiSTインデクスはフィーチャー自体の代わりにバウンディングボックスを用いる「不可逆」トリックを使っているので扱うことができます。</p></li><li class="listitem"><p>PostgreSQLのR木インデクスは「NULLセーフ」ではなく、NULLジオメトリを含むジオメトリカラムではインデクス作成に失敗します。</p></li></ul></div></td></tr><tr class="question"><td align="left" valign="top"><a name="idp65897288"></a><a name="idp65897544"></a><p><b>3.13.</b></p></td><td align="left" valign="top"><p>なぜ <code class="varname">AddGeometryColumn()</code>関数と他のOpsnGIS関数を使うべきなのですか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>OpenGIS関数を使いたくないのでしたら、使う必要はありません。単純にジオメトリカラムをCREATEステートメントで定義する古いやり方で作成して下さい。全てのジオメトリはSRIDが-1になり、OpenGISメタデータテーブルは適切に<span class="emphasis"><em>書き込まれません</em></span>。これによって、ほとんどのPostGISベースのアプリケーションでは失敗します。一般的には<code class="varname">AddGeometryColumn()</code>を用いることをお勧めします。</p><p>MapServerは<code class="varname">geometry_columns</code>メタデータを使うアプリケーションのひとつです。踏み込んでいえば、MpaServerはジオメトリカラムのSRIDを使って、正しい地図投影へのフィーチャーの自動投影変換を行います。</p></td></tr><tr class="question"><td align="left" valign="top"><a name="idp65913544"></a><a name="idp65913800"></a><p><b>3.14.</b></p></td><td align="left" valign="top"><p>半径内にあるオブジェクトを全て検索する最善の方法は何ですか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>データベースを最も効果的に使うには、半径検索とバウンディングボックス検索を組み合わせた半径検索を行うのが最も良いです。バウンディングボックス検索で空間インデクスを使用するので、半径検索が適用されるサブセットへのアクセスが早くなります。</p><p><code class="varname">ST_DWithin(geometry, geometry, distance)</code>関数は、インデクス付きの距離検索を実行する手軽な方法です。この関数は、距離半径を十分に含む大きさの検索矩形を作成して、 インデクス付きの結果サブセットに対して確実な距離検索を行います。</p><p>たとえば、POINT(1000 1000)から100メートル内の全てのオブジェクトを見つけるためには、次のクエリで動作します。</p><pre class="programlisting">SELECT * FROM geotable
WHERE ST_DWithin(geocolumn, 'POINT(1000 1000)', 100.0);</pre></td></tr><tr class="question"><td align="left" valign="top"><a name="idp65917000"></a><a name="idp65917256"></a><p><b>3.15.</b></p></td><td align="left" valign="top"><p>クエリの一部として投影変換を実現するにはどうしますか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>投影変換を行うには、変換元と変換先双方の座標系がSPATIAL_REF_SYSテーブルに定義されていて、 かつ投影変換されるジオメトリがそのSRIDを持っている必要があります。これが行われていると、投影変換は求める変換先SRIDを参照するのと同じぐらい簡単です。次のクエリは、ジオメトリをNAD 83経度緯度に投影しています。このクエリはthe_geomが-1 (空間参照系が定義されていない)でない場合のみ動作します。</p><pre class="programlisting">SELECT ST_Transform(the_geom,4269) FROM geotable;</pre></td></tr><tr class="question"><td align="left" valign="top"><a name="idp65919432"></a><a name="idp65919688"></a><p><b>3.16.</b></p></td><td align="left" valign="top"><p>ST_AsEWKTとST_AsTextとを、かなり大きいジオメトリで実行すると、空のフィールドが返りました。どうしたら良いですか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>pgAdminまたは大きなテキストを表示しないその他のツールを使用しているのかも知れません。 ジオメトリが十分に大きい場合、ツールには空として表示されます。本当にWKTで見たり出力したりしなければならない場合は、PSQLを使用して下さい。</p><pre class="programlisting">-- 本当に空のジオメトリの数を検索します
                                SELECT count(gid) FROM geotable WHERE the_geom IS NULL;</pre></td></tr><tr class="question"><td align="left" valign="top"><a name="idp65921864"></a><a name="idp65922120"></a><p><b>3.17.</b></p></td><td align="left" valign="top"><p>ST_Intersectsを使うと、二つのジオメトリがインタセクトしているのが分かっているのに、インタセクトしていないと言います。どうしたら良いですか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>二つの場合がよくあります。一つは、ジオメトリが不正な場合です。<a class="xref" href="#ST_IsValid" title="ST_IsValid">ST_IsValid</a>で確認できます。もう一つは、ST_AsTextで数字を切り捨てていて、表示されている分より後にたくさんの小数が付いている場合です。</p></td></tr><tr class="question"><td align="left" valign="top"><a name="license_faq"></a><a name="idp65924552"></a><p><b>3.18.</b></p></td><td align="left" valign="top"><p>PostGISを用いたソフトウェアをリリースしています。PostGISのようにGPLライセンスを使う必要があるのでしょうか?PostGISを使うとコードを全て公開しなければならないのでしょうか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>ほぼ確実に違います。 例として、Linux上で動作するOracleを考えてみます。 LinuxはGPLでOracleは違いますが、Linuxで動作するOracleはGPLで配布しなければならないでしょうか?違います。あなたのソフトウェアはPostgreSQL/PostGISデータベースを好きなだけ使うことができ、ライセンスは好きなようにできます。</p><p>PostGISソースコードに変更を加えて、変更したPostGISを配布したときだけは例外です。この場合、変更したPostGISのコードを共有しなければなりません (PostGIS上で動作するアプリケーションのコードではありません)。この限られた場合でも、ソースコードはバイナリの配布相手にだけ配布します。GPLはソースコードの<span class="emphasis"><em>公開</em></span>までは求めておらず、バイナリを配布した相手との共有を求めています。</p><p>CGALを使った関数とともにPostGISを使ってでも、このことに違いはありません。CGALのライセンスの一つにGPLがありますが、PostGISの全てが既にGPLですので、CGALによってPostGISの元々のライセンスよりも厳しくなることはありません。</p></td></tr></tbody></table></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="using_postgis_dbmanagement"></a>第4章 PostGISを使う: データ管理とクエリ</h1></div></div></div><div class="toc"><p><b>目次</b></p><dl class="toc"><dt><span class="sect1"><a href="#RefObject">4.1. GISオブジェクト</a></span></dt><dd><dl><dt><span class="sect2"><a href="#OpenGISWKBWKT">4.1.1. OpenGIS WKBとWKT</a></span></dt><dt><span class="sect2"><a href="#EWKB_EWKT">4.1.2. PostGIS EWKB, EWKTと標準形式</a></span></dt><dt><span class="sect2"><a href="#SQL_MM_Part3">4.1.3. SQL-MM第3部</a></span></dt></dl></dd><dt><span class="sect1"><a href="#PostGIS_Geography">4.2. PostGISジオグラフィ型</a></span></dt><dd><dl><dt><span class="sect2"><a href="#Geography_Basics">4.2.1. ジオグラフィ基礎</a></span></dt><dt><span class="sect2"><a href="#PostGIS_GeographyVSGeometry">4.2.2. ジオグラフィ型をジオメトリ型にして使用すべき時</a></span></dt><dt><span class="sect2"><a href="#PostGIS_Geography_AdvancedFAQ">4.2.3. ジオグラフィに関する高度なよくある質問</a></span></dt></dl></dd><dt><span class="sect1"><a href="#idp66152008">4.3. OpenGIS標準を使う</a></span></dt><dd><dl><dt><span class="sect2"><a href="#spatial_ref_sys">4.3.1. SPATIAL_REF_SYSテーブルと空間参照系</a></span></dt><dt><span class="sect2"><a href="#geometry_columns">4.3.2. GEOMETRY_COLUMNSビュー</a></span></dt><dt><span class="sect2"><a href="#Create_Spatial_Table">4.3.3. 空間テーブルを作る</a></span></dt><dt><span class="sect2"><a href="#Manual_Register_Spatial_Column">4.3.4. 手動でジオメトリカラムをgeometry_columnsに登録する</a></span></dt><dt><span class="sect2"><a href="#OGC_Validity">4.3.5. ジオメトリのOpenGIS準拠を確実にする</a></span></dt><dt><span class="sect2"><a href="#DE-9IM">4.3.6. ここで、Dimensionally Extended 9 Intersection Modelまたは略してDE-9IMを見てみましょう。</a></span></dt></dl></dd><dt><span class="sect1"><a href="#loading_geometry_data">4.4. GIS (ベクタ)データをロードする</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp66435400">4.4.1. SQLを使ってロードする</a></span></dt><dt><span class="sect2"><a href="#shp2pgsql_usage">4.4.2. shp2pgsql: ESRIシェープファイルローダを使う</a></span></dt></dl></dd><dt><span class="sect1"><a href="#retrieving_vector-data">4.5. GISデータを検索する</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp66506056">4.5.1. SQLを使ってデータを検索する</a></span></dt><dt><span class="sect2"><a href="#idp66516552">4.5.2. ダンパを使う</a></span></dt></dl></dd><dt><span class="sect1"><a href="#idp66534472">4.6. インデクスを構築する</a></span></dt><dd><dl><dt><span class="sect2"><a href="#gist_indexes">4.6.1. GiSTインデクス</a></span></dt><dt><span class="sect2"><a href="#brin_indexes">4.6.2. BRINインデックス</a></span></dt><dt><span class="sect2"><a href="#spgist_indexes">4.6.3. SP-GiSTインデクス</a></span></dt><dt><span class="sect2"><a href="#idp66594120">4.6.4. インデクスを使う</a></span></dt></dl></dd><dt><span class="sect1"><a href="#idp66612296">4.7. 複雑なクエリ</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp66615752">4.7.1. インデクスの利点を使う</a></span></dt><dt><span class="sect2"><a href="#examples_spatial_sql">4.7.2. 空間SQLの例</a></span></dt></dl></dd></dl></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="RefObject"></a>4.1. GISオブジェクト</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="#OpenGISWKBWKT">4.1.1. OpenGIS WKBとWKT</a></span></dt><dt><span class="sect2"><a href="#EWKB_EWKT">4.1.2. PostGIS EWKB, EWKTと標準形式</a></span></dt><dt><span class="sect2"><a href="#SQL_MM_Part3">4.1.3. SQL-MM第3部</a></span></dt></dl></div><p>PostGISでサポートされるGISオブジェクトは、OpenGIS Consortium (OGC)が定義する"Simple Features" のスーパーセットです。 PostGISはOGCの"Simple Features for SQL"仕様で定められた全てのオブジェクトと関数をサポートしています。</p><p>PostGISは標準から拡張して 3DZ, 3DM, 4D 座標 (訳注: それぞれXYZ, XYM, XYZM)をサポートしています。</p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="OpenGISWKBWKT"></a>4.1.1. OpenGIS WKBとWKT</h3></div></div></div><p>OpenGIS仕様は空間オブジェクトの表現について二つの標準を定義しています。Well-Knownテキスト (WKT)形式とWell-Knownバイナリ (WKB)形式です。WKTもWKBも、オブジェクトの型とオブジェクトを形成する座標に関する情報を持っています。</p><p>フィーチャーの空間オブジェクトのテキスト表現 (WKT)の例は、次の通りです。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>POINT(0 0)</p></li><li class="listitem"><p>LINESTRING(0 0,1 1,1 2)</p></li><li class="listitem"><p>POLYGON((0 0,4 0,4 4,0 4,0 0),(1 1, 2 1, 2 2, 1 2,1 1))</p></li><li class="listitem"><p>MULTIPOINT((0 0),(1 2))</p></li><li class="listitem"><p>MULTILINESTRING((0 0,1 1,1 2),(2 3,3 2,5 4))</p></li><li class="listitem"><p>MULTIPOLYGON(((0 0,4 0,4 4,0 4,0 0),(1 1,2 1,2 2,1 2,1 1)), ((-1 -1,-1 -2,-2 -2,-2 -1,-1 -1)))</p></li><li class="listitem"><p>GEOMETRYCOLLECTION(POINT(2 3),LINESTRING(2 3,3 4))</p></li></ul></div><p>OpenGIS仕様では、空間オブジェクトの内部保存書式は空間参照系識別子 (Spatial Referencing System IDentifier, SRID)を含むことも求められます。SRIDはデータベースへの挿入のために空間オブジェクトが生成される時に求められます。</p><p>これらの書式の入出力は次のインタフェースを用いて実現できます。</p><pre class="programlisting">バイト配列 WKB = ST_AsBinary(geometry);
テキスト WKT = ST_AsText(geometry);
ジオメトリ = ST_GeomFromWKB (bytea WKB、SRID);
ジオメトリ = ST_GeometryFromText (テキスト WKT、SRID);</pre><p>たとえば、OGC空間オブジェクトを生成して挿入する妥当なINSERTステートメントは次の通りです。</p><pre class="programlisting">INSERT INTO geotable ( the_geom, the_name )
  VALUES ( ST_GeomFromText('POINT(-126.4 45.32)', 312), 'A Place');</pre></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="EWKB_EWKT"></a>4.1.2. PostGIS EWKB, EWKTと標準形式</h3></div></div></div><p>OGC書式は2次元ジオメトリしかサポートされておらず、また、入出力の表現においてSRIDは*決して*埋め込まれません。</p><p>PostGIS拡張書式は現在のところOGC書式のスーパーセットとなっています (全ての妥当なWKB/WKTは妥当なEWKB/EWKTです)。しかし、特にもしOGCがPostGIS拡張と矛盾する新しい書式を出すことがあるなら、これは将来変更されるかも知れません。ゆえにこの機能に頼るべきではありません。</p><p>PostGIS EWKB/EWKT では 3DM, 3DZ, 4D の座標サポートが追加され、SRID情報が埋め込まれます。</p><p>拡張された空間オブジェクトのテキスト表現 (EWKT)の例は、次の通りです。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>POINT(0 0 0) -- XYZ</p></li><li class="listitem"><p>SRID=32632;POINT(0 0) -- SRID付きXY</p></li><li class="listitem"><p>POINTM(0 0 0) -- XYM</p></li><li class="listitem"><p>POINT(0 0 0 0) -- XYZM</p></li><li class="listitem"><p>SRID=4326;MULTIPOINTM(0 0 0,1 2 1) -- SRID付きXYM</p></li><li class="listitem"><p>MULTILINESTRING((0 0 0,1 1 0,1 2 1),(2 3 1,3 2 1,5 4 1))</p></li><li class="listitem"><p>POLYGON((0 0 0,4 0 0,4 4 0,0 4 0,0 0 0),(1 1 0,2 1 0,2 2 0,1 2 0,1 1 0))</p></li><li class="listitem"><p>MULTIPOLYGON(((0 0 0,4 0 0,4 4 0,0 4 0,0 0 0),(1 1 0,2 1 0,2 2 0,1 2 0,1 1 0)),((-1 -1 0,-1 -2 0,-2 -2 0,-2 -1 0,-1 -1 0)))</p></li><li class="listitem"><p>GEOMETRYCOLLECTIONM( POINTM(2 3 9), LINESTRINGM(2 3 4, 3 4 5) )</p></li><li class="listitem"><p>MULTICURVE( (0 0, 5 5), CIRCULARSTRING(4 0, 4 4, 8 4) )</p></li><li class="listitem"><p>POLYHEDRALSURFACE( ((0 0 0, 0 0 1, 0 1 1, 0 1 0, 0 0 0)), ((0 0 0, 0 1 0, 1 1 0, 1 0 0, 0 0 0)), ((0 0 0, 1 0 0, 1 0 1, 0 0 1, 0 0 0)), ((1 1 0, 1 1 1, 1 0 1, 1 0 0, 1 1 0)), ((0 1 0, 0 1 1, 1 1 1, 1 1 0, 0 1 0)), ((0 0 1, 1 0 1, 1 1 1, 0 1 1, 0 0 1)) )</p></li><li class="listitem"><p>TRIANGLE ((0 0, 0 9, 9 0, 0 0))</p></li><li class="listitem"><p>TIN( ((0 0 0, 0 0 1, 0 1 0, 0 0 0)), ((0 0 0, 0 1 0, 1 1 0, 0 0 0)) )</p></li></ul></div><p>これらの書式の変換は次のインタフェースを用いて実現できます。</p><pre class="programlisting">バイト配列 EWKB = ST_AsEWKB(geometry);
テキスト EWKT = ST_AsEWKT(geometry);
ジオメトリ = ST_GeomFromEWKB(bytea EWKB);
ジオメトリ = ST_GeomFromEWKT(text EWKT);</pre><p>たとえば、PostGISの空間オブジェクトを作成し挿入する妥当なINSERTステートメントは次の通りです。</p><pre class="programlisting">INSERT INTO geotable ( the_geom, the_name )
  VALUES ( ST_GeomFromEWKT('SRID=312;POINTM(-126.4 45.32 15)'), 'A Place' )</pre><p>PostgreSQLの「標準的な形式」は単純なクエリ (全く関数呼び出しが無い)で得る表現であり、単純なINSERT, UPDATE, COPYで受け付けられることが保障されるものです。PostGISの"geometory"型の場合は次の通りです。 </p><pre class="programlisting">- 出力
  - バイナリ: EWKB
        ascii: HEXEWKB (EWKBのHEX表現)
- 入力
  - バイナリ: EWKB
        ascii: HEXEWKB|EWKT </pre><p>たとえば、次のステートメントは、標準的なASCII文字列による入出力の処理でEWKTを読み、HEXEWKBを返すものです。</p><pre class="programlisting">=# SELECT 'SRID=4;POINT(0 0)'::geometry;

geometry
----------------------------------------------------
01010000200400000000000000000000000000000000000000
(1 row)</pre></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="SQL_MM_Part3"></a>4.1.3. SQL-MM第3部</h3></div></div></div><p>SQLマルチメディア・アプリケーション空間仕様は、円弧補完曲線を定義したSQL仕様の拡張です。</p><p>SQL-MMの定義では、3DM、3DZと4Dの座標を含みますが、SRID情報の埋め込みはできません。</p><p>Well-Known Text拡張はまだ完全にはサポートされていません。単純な曲線ジオメトリの例を次に示します。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>CIRCULARSTRING(0 0, 1 1, 1 0)</p><p>CIRCULARSTRING(0 0, 4 0, 4 4, 0 4, 0 0)</p><p>CIRCULARSTRINGは基本的な曲線型で、線型のLINESTRINGに似ています。一つの辺で、始点、終点 (一つめと三つめ)と弧上の任意の点、の3点が必要です。例外として、始点と終点が同じとなる閉曲線があります。閉曲線では二つ目の点が弧の中心、すなわち円の反対側にならなければなりません。弧の連結では、LINESTRINGと同じように、前の弧の最後の点が次の弧の最初の点となります。よって、妥当なCIRCULARSTRINGは1以上の奇数になります。</p></li><li class="listitem"><p>COMPOUNDCURVE(CIRCULARSTRING(0 0, 1 1, 1 0),(1 0, 0 1))</p><p>複合曲線は、曲線 (円弧)セグメントと線型セグメントの両方を持つ、単一の連続した曲線です。 よって、要素が的確である必要があることに加え、各要素 (最終要素は除く)の終点は次の要素の始点と同じになる必要があります。</p></li><li class="listitem"><p>CURVEPOLYGON(CIRCULARSTRING(0 0, 4 0, 4 4, 0 4, 0 0),(1 1, 3 3, 3 1, 1 1))</p><p>曲線ポリゴンの中に複合ポリゴンがある例は次の通りです。 CURVEPOLYGON(COMPOUNDCURVE(CIRCULARSTRING(0 0,2 0, 2 1, 2 3, 4 3),(4 3, 4 5, 1 4, 0 0)), CIRCULARSTRING(1.7 1, 1.4 0.4, 1.6 0.4, 1.6 0.5, 1.7 1) ) </p><p>CURVEPOLYGONは外環と0以上の内環とを持つ点でPOLYGONと似ています。 異なる点は、環に曲線ストリング、線型ストリング、複合ストリングのいずれも取れる点です。</p><p>PostGIS 1.4から、PostGISで曲線ポリゴンで複合曲線をサポートするようになりました。</p></li><li class="listitem"><p>MULTICURVE((0 0, 5 5),CIRCULARSTRING(4 0, 4 4, 8 4))</p><p>MULTICURVEは曲線のコレクションで、線型ストリング、曲線ストリング、複合ストリングを取れます。</p></li><li class="listitem"><p>MULTISURFACE(CURVEPOLYGON(CIRCULARSTRING(0 0, 4 0, 4 4, 0 4, 0 0),(1 1, 3 3, 3 1, 1 1)),((10 10, 14 12, 11 10, 10 10),(11 11, 11.5 11, 11 11.5, 11 11)))</p><p>サーフェスのコレクションです。(線型)ポリゴンか曲線ポリゴンを取れます。</p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>SQL-MM実装での全ての浮動小数点数の比較では、所定の丸め誤差があります。現在は1E-8です。</p></td></tr></table></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="PostGIS_Geography"></a>4.2. PostGISジオグラフィ型</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="#Geography_Basics">4.2.1. ジオグラフィ基礎</a></span></dt><dt><span class="sect2"><a href="#PostGIS_GeographyVSGeometry">4.2.2. ジオグラフィ型をジオメトリ型にして使用すべき時</a></span></dt><dt><span class="sect2"><a href="#PostGIS_Geography_AdvancedFAQ">4.2.3. ジオグラフィに関する高度なよくある質問</a></span></dt></dl></div><p>ジオグラフィ型は、「地理」座標 (しばしば「測地」座標、"lat/lon"、"lon/lat"、緯度経度, 経度緯度などとも呼ばれます)上で表現された空間フィーチャーのネイティブサポートするためのものです。地理座標は角度の単位 (度)で表現される球面座標です。 </p><p>PostGISジオメトリ型の基礎は平面です。平面上の二点間の最短コースは直線になります。よって、ジオメトリ上の計算 (面積、距離、長さ、インタセクション等)は、デカルト座標と線型ベクトルを使用することができます。</p><p>PostGISのジオグラフィ型の基礎は球面です。球面上での二点間の最短距離は大圏の弧です。よって、ジオグラフィ上の計算 (面積、距離、長さ、インタセクション等)は、球面上で計算しなければならず、複雑な計算が必要となります。より正確な計測のためには、世界の実際の回転楕円体の形を考慮に入れなければならず、非常に複雑です。</p><p>基礎となる数学が大変に複雑なので、ジオグラフィ型用に定義された関数は、ジオメトリ型よりも少ないです。時間とともに、新しいアルゴリズムが追加されて、ジオグラフィ型の能力は拡大していくでしょう。</p><p><code class="varname">geography</code>と呼ばれるデータ型を使用します。GEOS関数は<code class="varname">geography</code>型に対応していません。回避策として、ジオメトリとジオグラフィの型変換を行うことができます。</p><p>PostGIS 2.2より前は、ジオグラフィ型はWGS84経度緯度 (SRID:4326)だけに対応していました。PostGIS 2.2以降は、<code class="varname">spatial_ref_sys</code>で定義されている経度緯度ベースの空間参照系の全てが使えます。<a class="ulink" href="http://www.bostongis.com/blog/index.php?/archives/266-geography-type-is-not-limited-to-earth.html" target="_top">geography type is not limited to earth</a>の記述にある通り、独自の回転楕円体の空間参照系を追加することもできます。</p><p>どの空間参照系を使用しても、計測関数 (<a class="xref" href="#ST_Distance" title="ST_Distance">ST_Distance</a>, <a class="xref" href="#ST_Length" title="ST_Length">ST_Length</a>, <a class="xref" href="#ST_Perimeter" title="ST_Perimeter">ST_Perimeter</a>, <a class="xref" href="#ST_Area" title="ST_Area">ST_Area</a>)の返り値の単位と、<a class="xref" href="#ST_DWithin" title="ST_DWithin">ST_DWithin</a>の入力の単位はメートルです。</p><p>ジオグラフィ型はPostgreSQLのtypmod定義書式を使います。ジオグラフィカラムを持つテーブルに1ステップで追加できます。標準OGC書式は曲線を除いてサポートします。</p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="Geography_Basics"></a>4.2.1. ジオグラフィ基礎</h3></div></div></div><p>ジオグラフィ型はシンプルフィーチャーの最も簡単なもののみサポートします。標準的なジオメトリ型データで、SRIDが4326の場合は、ジオグラフィに自動でキャストされます。またデータ挿入においてEWKTとEWKBの取り決めを使うこともできます。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>POINT: SRID指定なしでの2次元ポイントジオグラフィのテーブル生成は次の通りです。デフォルトは4326 WGS84経度緯度となります。</p><pre class="programlisting">CREATE TABLE ptgeogwgs(gid serial PRIMARY KEY, geog geography(POINT) );</pre><p>POINT: NAD83経度緯度での2次元ポイントジオグラフィのテーブル生成は次の通りです。</p><pre class="programlisting">CREATE TABLE ptgeognad83(gid serial PRIMARY KEY, geog geography(POINT,4269) );</pre><p>Z値を持ち、明示的にSRIDを指定したポイントのテーブル生成は次の通りです。</p><pre class="programlisting">CREATE TABLE ptzgeogwgs84(gid serial PRIMARY KEY, geog geography(POINTZ,4326) );</pre></li><li class="listitem"><p>LINESTRING</p><pre class="programlisting">CREATE TABLE lgeog(gid serial PRIMARY KEY, geog geography(LINESTRING) );</pre></li><li class="listitem"><p>POLYGON</p><pre class="programlisting">-- polygon NAD 1927経度緯度
CREATE TABLE lgeognad27(gid serial PRIMARY KEY, geog geography(POLYGON,4267) );</pre></li><li class="listitem"><p>MULTIPOINT</p></li><li class="listitem"><p>MULTILINESTRING</p></li><li class="listitem"><p>MULTIPOLYGON</p></li><li class="listitem"><p>GEOMETRYCOLLECTION</p></li></ul></div><p>ジオグラフィ型のフィールドは<code class="varname">geography_columns</code>システムビューに登録されます。</p><p>"geography_columns"ビューをチェックして、テーブルが一覧にあるか見て下さい。</p><p>CREATE TABLEの文法でジオグラフィカラムを持つテーブルを新規に生成できます。</p><p>
</p><pre class="programlisting">CREATE TABLE global_points (
    id SERIAL PRIMARY KEY,
    name VARCHAR(64),
    location GEOGRAPHY(POINT,4326)
  );</pre><p>
		</p><p>locationカラムはジオグラフィ型で、二つのオプション修飾子をサポートすることにご注意ください。一つは、そのカラムで使用できる形状と次元を限定する型修飾子です。もう一つは、座標参照IDを特定の数に限定するSRID修飾子です。</p><p>型修飾子として受け付ける値は、POINT, LINESTRING, POLYGON, MULTIPOINT, MULTILINESTRING, MULTIPOLYGONです。型修飾子は、Z, M, ZMの後置子を付けることで次元制限にも対応します。たとえば、'LINESTRINGM'という型修飾子で、三つ目の次元をMとする3次元のラインストリングのみ受け付けることになります。同じように'POINTZM'で、4次元データを期待します。</p><p>SRIDを指定していない場合には、SRIDは4326 WGS84経度緯度が使われ、全ての計算はWGS 84を使って行われます。</p><p>テーブルを作ったら、次のようにしてGEOGRAPHY_COLUMNSを見ることができます。</p><pre class="programlisting">-- メタデータビューの中身を見る
SELECT * FROM geography_columns;</pre><p>ジオメトリカラムを使うのと同じようにテーブルへのデータの挿入ができます。</p><pre class="programlisting">-- testテーブルにデータを追加する
INSERT INTO global_points (name, location) VALUES ('Town', 'SRID=4326;POINT(-110 30)');
INSERT INTO global_points (name, location) VALUES ('Forest', 'SRID=4326;POINT(-109 29)');
INSERT INTO global_points (name, location) VALUES ('London', 'SRID=4326;POINT(0 49)');</pre><p>ジオメトリと同じ操作でインデクスを作成します。PostGISは、カラム型がジオグラフィであるかを見て、ジオメトリで使われる平面用インデクスの代わりに球面ベースのインデクスを作成します。</p><pre class="programlisting">-- testテーブルに球面インデクスを作成
  CREATE INDEX global_points_gix ON global_points USING GIST ( location );</pre><p>
</p><p>クエリと計測関数はメートル単位となります。そのため距離パラメータはメートル (面積の場合は平方メートル)単位となります。</p><pre class="programlisting">-- 距離クエリの表示。ロンドンは1000km範囲外です
  SELECT name FROM global_points WHERE ST_DWithin(location, 'SRID=4326;POINT(-110 29)'::geography, 1000000);</pre><p>
</p><p>ジオグラフィの威力については、シアトルからロンドンまで (LINESTRING(-122.33 47.606, 0.0 51.5))の飛行機がレイキャビク (POINT(-21.96 64.15))に最も近くなるときの距離を求めてみると分かります。</p><pre class="programlisting">-- ジオグラフィを使った距離計算 (122.2km)
  SELECT ST_Distance('LINESTRING(-122.33 47.606, 0.0 51.5)'::geography, 'POINT(-21.96 64.15)'::geography);</pre><p>
</p><pre class="programlisting">-- ジオメトリを使った計算 (13.3 "度")
  SELECT ST_Distance('LINESTRING(-122.33 47.606, 0.0 51.5)'::geometry, 'POINT(-21.96 64.15)'::geometry);</pre><p>
</p><p>異なる経度緯度座標系を試します。<code class="varname">spatial_ref_sys</code>テーブルで挙げられている経度緯度の空間参照系なら全て可能です。</p><p>	</p><pre class="programlisting">-- NAD 83経度緯度
SELECT 'SRID=4269;POINT(-123 34)'::geography;
                    geography
----------------------------------------------------
 0101000020AD1000000000000000C05EC00000000000004140
(1 row)</pre><p>

</p><pre class="programlisting">-- NAD27経度緯度
SELECT 'SRID=4267;POINT(-123 34)'::geography;

                    geography
----------------------------------------------------
 0101000020AB1000000000000000C05EC00000000000004140
(1 row)</pre><p>

</p><pre class="programlisting">-- メートル単位のNAD83 UTM、メートル単位の投影法ですのでエラーが出ます
SELECT 'SRID=26910;POINT(-123 34)'::geography;

ERROR:  Only lon/lat coordinate systems are supported in geography.
LINE 1: SELECT 'SRID=26910;POINT(-123 34)'::geography;</pre><p>ジオグラフィ型は、レイキャビクとシアトル-ロンドン間の飛行機の大圏コースとの間の、球面上での本当に最も近い距離を計算します。</p><p><a class="ulink" href="http://gc.kls2.com/cgi-bin/gc?PATH=SEA-LHR" target="_top">大圏コースマップ</a> ジオメトリ型は、平面の世界地図上にプロットされたレイキャビクとシアトル-ロンドン間の直線とのデカルト距離という意味のない値を出します。結果の名目上の単位は「度」ですが、点間の本当の角度差にあっていませんので、「度」と言うこと自体不正確です。</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="PostGIS_GeographyVSGeometry"></a>4.2.2. ジオグラフィ型をジオメトリ型にして使用すべき時</h3></div></div></div><p>ジオグラフィ型によって、経度緯度座標でデータを格納できるようになりましたが、ジオグラフィで定義されている関数が、ジオメトリより少ないのと、実行にCPU時間がかかる、というところが犠牲になっています。</p><p>選択した型が、期待する領域から出ないことを、ジオメトリ型にして使用する条件とすべきです。使用するデータは地球全体か、大陸か、州か、自治体か? </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>データが小さいエリア内におさまるなら、適切な投影を選択してジオメトリを使うのが、効率面でも機能面でも最も良い方法です。</p></li><li class="listitem"><p>データが地球全体か大陸なら、ジオグラフィで投影法の細かい問題を気にせずにシステムを構築できるでしょう。経度/緯度のデータを保存して、ジオグラフィで定義された関数使います。</p></li><li class="listitem"><p>投影法を理解していなくて、学習したくもなくて、かつ、ジオグラフィで使える関数が限られていることを受け入れるのなら、ジオグラフィを使った方が簡単です。単純にデータを経度/緯度でロードして、そこから進めて下さい。</p></li></ul></div><p>ジオグラフィとジオメトリ間のサポート状況の比較については<a class="xref" href="#PostGIS_TypeFunctionMatrix" title="14.11. PostGIS関数対応マトリクス">「PostGIS関数対応マトリクス」</a>をご覧下さい。ジオグラフィ関数の簡潔なリストと説明については<a class="xref" href="#PostGIS_GeographyFunctions" title="14.4. PostGISジオグラフィ対応関数">「PostGISジオグラフィ対応関数」</a>をご覧下さい。 </p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="PostGIS_Geography_AdvancedFAQ"></a>4.2.3. ジオグラフィに関する高度なよくある質問</h3></div></div></div><div class="qandaset"><a name="idp66142536"></a><dl><dt>4.2.3.1. <a href="#idp66142792">球または回転楕円体のどちらで計算するのでしょうか?</a></dt><dt>4.2.3.2. <a href="#idp66145096">日付変更線や極に関してはどうなっていますか?</a></dt><dt>4.2.3.3. <a href="#idp66147016">処理できる最も長い弧はどうなりますか?</a></dt><dt>4.2.3.4. <a href="#idp66148936">なぜヨーロッパやロシアといった大きな範囲の面積計算はとても遅いのですか?</a></dt></dl><table border="0" style="width: 100%;"><colgroup><col align="left" width="1%"><col></colgroup><tbody><tr class="question"><td align="left" valign="top"><a name="idp66142792"></a><a name="idp66143048"></a><p><b>4.2.3.1.</b></p></td><td align="left" valign="top"><p>球または回転楕円体のどちらで計算するのでしょうか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>デフォルトでは、全ての距離と面積の計算は回転楕円体で行います。局所的なエリアでの計算結果と良好な投影を施した平面での結果と比較して下さい。大きなエリアの場合は、回転楕円体計算は、投影平面上でのどの計算よりも精度が高くなります。 </p><p>全てのジオグラフィ関数には、最後の真偽パラメータを'FALSE'にすると球面を使った計算を行うというオプションがあります。これは、特にジオメトリが非常に単純である場合に計算を速くするためのものです。</p></td></tr><tr class="question"><td align="left" valign="top"><a name="idp66145096"></a><a name="idp66145352"></a><p><b>4.2.3.2.</b></p></td><td align="left" valign="top"><p>日付変更線や極に関してはどうなっていますか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>全ての計算に日付変更線や極の概念がありません。座標は球 (経度/緯度)であるので、日付変更線とクロスする形状は、計算の観点からは、他のものと変わりありません。 </p></td></tr><tr class="question"><td align="left" valign="top"><a name="idp66147016"></a><a name="idp66147272"></a><p><b>4.2.3.3.</b></p></td><td align="left" valign="top"><p>処理できる最も長い弧はどうなりますか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>大圏の弧を2点の「補完線」として使用しています。任意の2点は、実際には2方向につながっていて、どちらの方向に行くかに依存します。PostGISの全てのコードは、大圏コースの2コースのうち*短い*方でつながっていると仮定しています。結果として、180度以上の弧を持つ形状は正しくモデル化されません。</p></td></tr><tr class="question"><td align="left" valign="top"><a name="idp66148936"></a><a name="idp66149192"></a><p><b>4.2.3.4.</b></p></td><td align="left" valign="top"><p>なぜヨーロッパやロシアといった大きな範囲の面積計算はとても遅いのですか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>ポリゴンがとんでもなく大きいからです。二つの理由から、大きなエリアは悪いです。一つは、バウンダリボックスが大きいため、どのようなクエリを走らせても、インデクスがフィーチャーを引っ張ってくる傾向にあるためです。もう一つは、頂点数が巨大で、テスト (距離、包含)関数では、少なくとも1回、通常はN (Nは、もう一方のフィーチャーの頂点数)回、頂点を横断しなければならないためです。 </p><p>ジオメトリでは、大きなポリゴンを持っているけれども小さな範囲のクエリを実行する時、ジオメトリデータ情報を小片に「非正規化」します。これにより、インデックスが効果的にオブジェクトの一部を問い合わせるようになり、またクエリが常にオブジェクト全体を引っ張りこむようなことがないようになります。<a class="xref" href="#ST_Subdivide" title="ST_Subdivide">ST_Subdivide</a>を参照して下さい。ヨーロッパ全体を一つのポリゴンに*格納できる*からといって、*そうすべき*だというわけではありません。</p></td></tr></tbody></table></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp66152008"></a>4.3. OpenGIS標準を使う</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="#spatial_ref_sys">4.3.1. SPATIAL_REF_SYSテーブルと空間参照系</a></span></dt><dt><span class="sect2"><a href="#geometry_columns">4.3.2. GEOMETRY_COLUMNSビュー</a></span></dt><dt><span class="sect2"><a href="#Create_Spatial_Table">4.3.3. 空間テーブルを作る</a></span></dt><dt><span class="sect2"><a href="#Manual_Register_Spatial_Column">4.3.4. 手動でジオメトリカラムをgeometry_columnsに登録する</a></span></dt><dt><span class="sect2"><a href="#OGC_Validity">4.3.5. ジオメトリのOpenGIS準拠を確実にする</a></span></dt><dt><span class="sect2"><a href="#DE-9IM">4.3.6. ここで、Dimensionally Extended 9 Intersection Modelまたは略してDE-9IMを見てみましょう。</a></span></dt></dl></div><p>OpenGISの「SQL用シンプルフィーチャー仕様」では、標準GISオブジェクト型とこれらを操作するために必要な関数、メタデータテーブルのセットが定義されています。メタデータが一貫性を維持していることを保証するために、空間カラムの生成、消去といった操作はOpenGISで定義されている空間プロシージャを通して実行されます。</p><p>OpenGISメタデータテーブルには<code class="varname">SPATIAL_REF_SYS</code>と<code class="varname">GEOMETRY_COLUMNS</code>の二つがあります。<code class="varname">SPATIAL_REF_SYS</code>テーブルは空間データベースで用いられる座標系の、数字によるIDと文字による説明を持っています。</p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="spatial_ref_sys"></a>4.3.1. SPATIAL_REF_SYSテーブルと空間参照系</h3></div></div></div><p>spatial_ref_sysテーブルは、PostGISに含まれるもので、3000以上の<a class="ulink" href="http://www.sharpgis.net/post/2007/05/Spatial-references2c-coordinate-systems2c-projections2c-datums2c-ellipsoids-e28093-confusing.aspx" target="_top">空間参照系</a>と、座標変換/投影変換を行うのに必要な詳細情報との一覧を持つ、OGC準拠のデータベーステーブルです。</p><p>PostGISのspatial_ref_sysテーブルには、projライブラリで使われる3000以上の一般に使われる空間参照系定義がありますが、全てを持っているわけではなく、proj4の構築に慣れているならカスタム投影を定義することができます。ほとんどの空間参照系は地域限定のもので、想定されている範囲の外で使うと意味が無いことに注意して下さい。</p><p>PostGISのコアセットに入っていない空間参照系を探すための素晴らしい資料が<a class="ulink" href="http://spatialreference.org/" target="_top">http://spatialreference.org/</a>にあります。</p><p>よく共通的に使われる空間参照系は次の通りです (訳注: 日本では状況が異なります)。<a class="ulink" href="http://spatialreference.org/ref/epsg/4326/" target="_top">4326 - WGS 84 経度緯度</a>、<a class="ulink" href="http://spatialreference.org/ref/epsg/4269/" target="_top">4269 - NAD 83 経度緯度</a>、<a class="ulink" href="http://spatialreference.org/ref/epsg/3395/" target="_top">3395 - WGS 84 メルカトル図法</a>、<a class="ulink" href="http://spatialreference.org/ref/epsg/2163/" target="_top">2163 - 米国ナショナルアトラス正積図法</a>、NAD83とWGS84のUTM空間参照系 - UTMゾーンは計測に最も理想的なものの一つですが6度 (訳注: 経度)の領域しかカバーしません。 </p><p>まざまな米国の州の平面空間参照系 (メートルまたはフィート単位) - 通常は州ごとに一つか二つあります。メートル単位のもののほとんどがPostGISのコアセットに入っていますが、多数のフィート単位のものやESRIが作ったものについては<a class="ulink" href="http://spatialreference.org" target="_top">spatialreference.org</a>から取得して下さい。 </p><p>対象領域がどのUTMゾーンになるかを決めるには、<a class="ulink" href="http://trac.osgeo.org/postgis/wiki/UsersWikiplpgsqlfunctionsDistance" target="_top">utmzone PostGIS plpgsql helper function</a>を参照して下さい。 </p><p><code class="varname">SPATIAL_REF_SYS</code>テーブル定義は次の通りです。</p><pre class="programlisting">CREATE TABLE spatial_ref_sys (
  srid       INTEGER NOT NULL PRIMARY KEY,
  auth_name  VARCHAR(256),
  auth_srid  INTEGER,
  srtext     VARCHAR(2048),
  proj4text  VARCHAR(2048)
)</pre><p><code class="varname">SPATIAL_REF_SYS</code>のカラムは次の通りです。</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><a class="ulink" href="http://en.wikipedia.org/wiki/SRID" target="_top">SRID</a></span></dt><dd><p>一意に定められた整数値で、データベースで空間参照系 (SRS)を識別するものです。</p></dd><dt><span class="term">AUTH_NAME</span></dt><dd><p>その参照系の引用元である標準の名前です。たとえば「EPSG」は妥当な<code class="varname">AUTH_NAME</code>です。</p></dd><dt><span class="term">AUTH_SRID</span></dt><dd><p><code class="varname">AUTH_NAME</code>で引用される団体によって定義された空間参照系のIDです。EPSGの場合、EPSG投影コードが入ります。</p></dd><dt><span class="term">SRTEXT</span></dt><dd><p>空間参照系のWell-Knownテキスト表現です。たとえば、WKT SRSの表現は、次のようになります。</p><pre class="programlisting">PROJCS["NAD83 / UTM Zone 10N",
  GEOGCS["NAD83",
        DATUM["North_American_Datum_1983",
          SPHEROID["GRS 1980",6378137,298.257222101]
        ],
        PRIMEM["Greenwich",0],
        UNIT["degree",0.0174532925199433]
  ],
  PROJECTION["Transverse_Mercator"],
  PARAMETER["latitude_of_origin",0],
  PARAMETER["central_meridian",-123],
  PARAMETER["scale_factor",0.9996],
  PARAMETER["false_easting",500000],
  PARAMETER["false_northing",0],
  UNIT["metre",1]
]</pre><p>EPSG投影コードと対応するWKT表現の一覧については、<a class="ulink" href="http://www.opengeospatial.org/" target="_top">http://www.opengeospatial.org/</a>をご覧下さい。WKTの一般的な議論については、OpenGISの<a class="ulink" href="http://www.opengeospatial.org/standards" target="_top">http://www.opengeospatial.org/standards</a>にある「座標変換サービス実装仕様」をご覧下さい。欧州石油調査グループ(European Petroleum Survey Group, EPSG)とEPSG空間参照系のデータベースに関する情報は、<a class="ulink" href="http://www.epsg.org/" target="_top">http://www.epsg.org/</a>をご覧下さい。</p></dd><dt><span class="term">PROJ4TEXT</span></dt><dd><p>PostGISは座標変換機能を提供するためにProj4ライブラリを用いています。 <code class="varname">PROJ4TEXT</code>カラムには、特定のSRIDを示すProj4座標定義文字列が入ります。たとえば次のようになります。</p><pre class="programlisting">+proj=utm +zone=10 +ellps=clrk66 +datum=NAD27 +units=m</pre><p>詳細情報については、Proj4ウェブサイト<a class="ulink" href="http://trac.osgeo.org/proj/" target="_top">http://trac.osgeo.org/proj/</a>をご覧下さい。<code class="filename">spatial_ref_sys.sql</code>は、全てのEPSG投影法のための<code class="varname">SRTEXT</code>と<code class="varname">PROJ4TEXT</code>とを持っています。</p></dd></dl></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="geometry_columns"></a>4.3.2. GEOMETRY_COLUMNSビュー</h3></div></div></div><p><code class="varname">GEOMETRY_COLUMNS</code>は、データベースのシステムカタログから読み取るビューです。構造は次の通りです。</p><pre class="programlisting">\d geometry_columns</pre><pre class="screen">View "public.geometry_columns"
      Column       |          Type          | Modifiers
-------------------+------------------------+-----------
 f_table_catalog   | character varying(256) |
 f_table_schema    | character varying(256) |
 f_table_name      | character varying(256) |
 f_geometry_column | character varying(256) |
 coord_dimension   | integer                |
 srid              | integer                |
 type              | character varying(30)  |</pre><p>カラムの意味は次の通りです。</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">F_TABLE_CATALOG, F_TABLE_SCHEMA, F_TABLE_NAME</span></dt><dd><p>ジオメトリカラムを持つフィーチャーテーブルの完全修飾名。"catalog"および"schema"の語はOracle風であることに注意して下さい。"catalog"に類似するものはPostgreSQLになく、このカラムは空白にされます。"schema"についてはPostgreSQLスキーマ名が使われています (<code class="varname">public</code>がデフォルトです)。</p></dd><dt><span class="term">F_GEOMETRY_COLUMN</span></dt><dd><p>フィーチャーテーブル内のジオメトリカラムの名前。</p></dd><dt><span class="term">COORD_DIMENSION</span></dt><dd><p>そのカラムの空間の次元 (2, 3 または 4)。</p></dd><dt><span class="term">SRID</span></dt><dd><p>このテーブルの座標ジオメトリのために使われる空間参照系のID。<code class="varname">SPATIAL_REF_SYS</code>への外部キーになっています。</p></dd><dt><span class="term">TYPE</span></dt><dd><p>空間オブジェクトの型。空間カラムを単一型に制限するには、POINT、LINESTRING、POLYGON、MULTIPOINT、MULTILINESTRING、MULTIPOLYGON、GEOMETRYCOLLECTIONのうちのいずれかを、また、XYMで使う場合には、LINESTRINGM、POLYGONM、MULTIPOINTM、MULTILINESTRINGM、MULTIPOLYGONM、GEOMETRYCOLLECTIONMのうちのいずれかを使います。複数の型が混合するコレクションの場合は"GEOMETRY"を型とすることができます。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この属性は (おそらく)OpenGIS仕様に入っていませんが、型の同一性を保証するために必要です。</p></td></tr></table></div></dd></dl></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="Create_Spatial_Table"></a>4.3.3. 空間テーブルを作る</h3></div></div></div><p>空間データを持つテーブルの生成は、1段階でできます。2次元ラインストリングでWGS84経度緯度のジオメトリカラムを持つroadsテーブルの生成の例を次に示します。</p><pre class="programlisting">CREATE TABLE ROADS (ID serial, ROAD_NAME text, geom geometry(LINESTRING,4326) );</pre><p>次の、3次元ラインストリングを追加する例で示す通り、標準的なALTER TABLEコマンドを使ってカラムを追加できます。</p><pre class="programlisting">ALTER TABLE roads ADD COLUMN geom2 geometry(LINESTRINGZ,4326);</pre></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="Manual_Register_Spatial_Column"></a>4.3.4. 手動でジオメトリカラムをgeometry_columnsに登録する</h3></div></div></div><p>これが必要になる事例に、SQLビューとバルクインサートの二つがあります。バルクインサートの場合には、カラムに制約を与えるか、ALTER TABLEを実行することで、geometry_columnsテーブル内の登録を訂正することができます。ビューの場合には、CASE演算を使用します。カラムが型修飾子に基づく場合には、生成処理によって正しく登録されるので、何も行う必要がありません。ジオメトリを適用する空間関数を持たないビューも、基礎となるテーブルのジオメトリカラムと同じように登録されます。</p><pre class="programlisting">-- 次のようなビューがあるとします
CREATE VIEW public.vwmytablemercator AS
        SELECT gid, ST_Transform(geom, 3395) As geom, f_name
        FROM public.mytable;

-- 正しく登録するには、
-- ジオメトリをキャストします。
--
DROP VIEW public.vwmytablemercator;
CREATE VIEW  public.vwmytablemercator AS
        SELECT gid, ST_Transform(geom, 3395)::geometry(Geometry, 3395) As geom, f_name
        FROM public.mytable;

-- ジオメトリタイプが確実に2次元ポリゴンだと知っているなら
-- 次のようにできます。
DROP VIEW public.vwmytablemercator;
CREATE VIEW  public.vwmytablemercator AS
        SELECT gid, ST_Transform(geom,3395)::geometry(Polygon, 3395) As geom, f_name
        FROM public.mytable;</pre><pre class="programlisting">-- 次のように、バルクインサートで派生テーブルを生成したとしましょう
SELECT poi.gid, poi.geom, citybounds.city_name
INTO myschema.my_special_pois
FROM poi INNER JOIN citybounds ON ST_Intersects(citybounds.geom, poi.geom);

-- 新しいテーブルに2次元インデックスを作ります
CREATE INDEX idx_myschema_myspecialpois_geom_gist
  ON myschema.my_special_pois USING gist(geom);

-- ポイントが3次元ポイントであったり、XYMポイントであったりした場合には、
-- 次のように、2次元インデックスでなくN次元インデックスを作るかも知れません。
CREATE INDEX my_special_pois_geom_gist_nd
        ON my_special_pois USING gist(geom gist_geometry_ops_nd);

-- 新しいテーブルのジオメトリカラムをgeometry_columnsに手動登録するには、
-- 次のようにします。
-- カラムを型修飾子ベースにするために、基礎となるテーブル構造も変更することに
-- 注意して下さい。
SELECT populate_geometry_columns('myschema.my_special_pois'::regclass);

-- PostGIS 2.0を使っていて、何らかの理由で古い制約をもとにした定義を行う
-- (派生テーブルが同じタイプやSRIDを持たないといった場合)ことが必要な場合には、
-- 新しい任意変数use_typemodをfalseにします。
SELECT populate_geometry_columns('myschema.my_special_pois'::regclass, false); </pre><p>古い制約を基にした手法は現在も対応していますが、制約を基にしたジオメトリカラムで直接的にビューで使われている場合は、型修飾子のようには正しくgeometry_columnsに登録されません。次の例では、型修飾子を使ったカラム定義と、制約に基づくカラムの定義とを行っています。</p><pre class="programlisting">CREATE TABLE pois_ny(gid SERIAL PRIMARY KEY, poi_name text, cat text, geom geometry(POINT,4326));
SELECT AddGeometryColumn('pois_ny', 'geom_2160', 2160, 'POINT', 2, false);</pre><p>psqlで次を実行します。</p><pre class="programlisting">\d pois_ny;</pre><p>型修飾子と制約に基づくのとでは異なった定義になっているのが見えます。</p><pre class="screen">Table "public.pois_ny"
  Column   |         Type          |                       Modifiers

-----------+-----------------------+------------------------------------------------------
 gid       | integer               | not null default nextval('pois_ny_gid_seq'::regclass)
 poi_name  | text                  |
 cat       | character varying(20) |
 geom      | geometry(Point,4326)  |
 geom_2160 | geometry              |
Indexes:
    "pois_ny_pkey" PRIMARY KEY, btree (gid)
Check constraints:
    "enforce_dims_geom_2160" CHECK (st_ndims(geom_2160) = 2)
    "enforce_geotype_geom_2160" CHECK (geometrytype(geom_2160) = 'POINT'::text
        OR geom_2160 IS NULL)
    "enforce_srid_geom_2160" CHECK (st_srid(geom_2160) = 2160)</pre><p>geometry_columnsでは、両方とも正しく登録されています。</p><pre class="programlisting">SELECT f_table_name, f_geometry_column, srid, type
        FROM geometry_columns
        WHERE f_table_name = 'pois_ny';</pre><pre class="screen">f_table_name | f_geometry_column | srid | type
-------------+-------------------+------+-------
pois_ny      | geom              | 4326 | POINT
pois_ny      | geom_2160         | 2160 | POINT</pre><p>しかし、次のようにビューを作ろうとします。</p><pre class="programlisting">CREATE VIEW vw_pois_ny_parks AS
SELECT *
  FROM pois_ny
  WHERE cat='park';

SELECT f_table_name, f_geometry_column, srid, type
        FROM geometry_columns
        WHERE f_table_name = 'vw_pois_ny_parks';</pre><p>型修飾子によるgeomのビューカラムは正しく登録されますが、制約に基づくものは正しく登録されません。</p><pre class="screen">f_table_name   | f_geometry_column | srid |   type
------------------+-------------------+------+----------
 vw_pois_ny_parks | geom              | 4326 | POINT
 vw_pois_ny_parks | geom_2160         |    0 | GEOMETRY</pre><p>これは、将来的にPostGISの版で変更されるかもしれませんが、今のところは、制約に基づくビューカラムを正しく登録させるには、次のようにします。</p><pre class="programlisting">DROP VIEW vw_pois_ny_parks;
CREATE VIEW vw_pois_ny_parks AS
SELECT gid, poi_name, cat,
  geom,
  geom_2160::geometry(POINT,2160) As geom_2160
  FROM pois_ny
  WHERE cat = 'park';
SELECT f_table_name, f_geometry_column, srid, type
        FROM geometry_columns
        WHERE f_table_name = 'vw_pois_ny_parks';</pre><pre class="screen">f_table_name   | f_geometry_column | srid | type
------------------+-------------------+------+-------
 vw_pois_ny_parks | geom              | 4326 | POINT
 vw_pois_ny_parks | geom_2160         | 2160 | POINT</pre></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="OGC_Validity"></a>4.3.5. ジオメトリのOpenGIS準拠を確実にする</h3></div></div></div><p>PostGISはOpen Geospatial Consortium (OGC)のOpenGIS仕様に準拠しています。多くのPostGISメソッドは、操作対象のジオメトリが単純かつ妥当であることが求められます (正確に言うとそう仮定します)。たとえば、ポリゴンの外に穴があるようなものの面積を計算したり、単純でない境界線を持つポリゴンを作ったりするのは、意味がありません。</p><p>OGS仕様に沿うと、<span class="emphasis"><em>単純な</em></span>ジオメトリとは、自己インタセクトや自己接触のような、異常な幾何点を持たないことです。主に0次元または1次元のジオメトリ (<code class="varname">[MULTI]POINT, [MULTI]LINESTRING</code>))に適用します。 他方、ジオメトリの妥当性は、主に2次元ジオメトリ (<code class="varname">[MULTI]POLYGON</code>)に適用し、妥当なポリゴンを特徴づける位置指定子の集合を定義します。個々のジオメトリクラスには、単純性と妥当性をさらに詳細に述べる特定の条件があります。</p><p><code class="varname">POINT</code>は0次元ジオメトリオブジェクトとして常に<span class="emphasis"><em>単純</em></span>です。</p><p><code class="varname">MULTIPOINT</code>は、二つの座標値 (<code class="varname">POINT</code>)が同じでないなら<span class="emphasis"><em>単純</em></span>です。</p><p><code class="varname">LINESTRING</code>は、2度同じ<code class="varname">POINT</code>を通らない (終点は除きます。この場合は線型環と呼ばれ、さらに言うと閉じていると思われます)なら<span class="emphasis"><em>単純</em></span>です。</p><div class="informaltable"><table class="informaltable" border="0"><colgroup><col><col></colgroup><tbody><tr><td align="center"><div class="informalfigure"><div class="mediaobject"><img src="images/st_issimple01.png"><div class="caption"><p><span class="bold"><strong>(a)</strong></span></p></div></div></div></td><td align="center"><div class="informalfigure"><div class="mediaobject"><img src="images/st_issimple02.png"><div class="caption"><p><span class="bold"><strong>(b)</strong></span></p></div></div></div></td></tr><tr><td align="center"><div class="informalfigure"><div class="mediaobject"><img src="images/st_issimple03.png"><div class="caption"><p><span class="bold"><strong>(c)</strong></span></p></div></div></div></td><td align="center"><div class="informalfigure"><div class="mediaobject"><img src="images/st_issimple04.png"><div class="caption"><p><span class="bold"><strong>(d)</strong></span></p></div></div></div></td></tr></tbody></table><table class="informaltable" border="0"><colgroup><col></colgroup><tbody><tr><td><p><span class="bold"><strong>(a)</strong></span>と<span class="bold"><strong>(c)</strong></span>は単純な<code class="varname">LINESTRING</code>です。<span class="bold"><strong>(b)</strong></span>と<span class="bold"><strong>(d)</strong></span>は単純ではありません。</p></td></tr></tbody></table></div><p><code class="varname">MULTILINESTRING</code>は、 全ての要素が単純で、かつ任意の2要素のインタセクトが要素の境界である<code class="varname">POINT</code>でだけ発生する場合に限って<span class="emphasis"><em>単純</em></span>です。 </p><div class="informaltable"><table class="informaltable" border="0"><colgroup><col><col><col></colgroup><tbody><tr><td align="center"><div class="informalfigure"><div class="mediaobject"><img src="images/st_issimple05.png"><div class="caption"><p><span class="bold"><strong>(e)</strong></span></p></div></div></div></td><td align="center"><div class="informalfigure"><div class="mediaobject"><img src="images/st_issimple06.png"><div class="caption"><p><span class="bold"><strong>(f)</strong></span></p></div></div></div></td><td align="center"><div class="informalfigure"><div class="mediaobject"><img src="images/st_issimple07.png"><div class="caption"><p><span class="bold"><strong>(g)</strong></span></p></div></div></div></td></tr></tbody></table><table class="informaltable" border="0"><colgroup><col></colgroup><tbody><tr><td><p><span class="bold"><strong>(e)</strong></span>と<span class="bold"><strong>(f)</strong></span>は単純な<code class="varname">MULTILINESTRING</code>です。<span class="bold"><strong>(g)</strong></span>は単純ではありません。</p></td></tr></tbody></table></div><p>定義から<code class="varname">POLYGON</code>は常に単純です。バウンダリ内の環 (外環と内環からなる)のうち二つがクロスしていないなら<span class="emphasis"><em>妥当</em></span>です。<code class="varname">POLYGON</code>の境界は、<code class="varname">POINT</code>とインタセクトするかも知れませんが、接点にしかなりません (すなわち線上にない)。<code class="varname">POLYGON</code>はカットラインまたはスパイクを持たなくても良く、内環は外環の中に完全に含まれていなければなりません。</p><div class="informaltable"><table class="informaltable" border="0"><colgroup><col><col><col></colgroup><tbody><tr><td align="center"><div class="informalfigure"><div class="mediaobject"><img src="images/st_isvalid01.png"><div class="caption"><p><span class="bold"><strong>(h)</strong></span></p></div></div></div></td><td align="center"><div class="informalfigure"><div class="mediaobject"><img src="images/st_isvalid02.png"><div class="caption"><p><span class="bold"><strong>(i)</strong></span></p></div></div></div></td><td align="center"><div class="informalfigure"><div class="mediaobject"><img src="images/st_isvalid03.png"><div class="caption"><p><span class="bold"><strong>(j)</strong></span></p></div></div></div></td></tr><tr><td align="center"><div class="informalfigure"><div class="mediaobject"><img src="images/st_isvalid04.png"><div class="caption"><p><span class="bold"><strong>(k)</strong></span></p></div></div></div></td><td align="center"><div class="informalfigure"><div class="mediaobject"><img src="images/st_isvalid05.png"><div class="caption"><p><span class="bold"><strong>(l)</strong></span></p></div></div></div></td><td align="center"><div class="informalfigure"><div class="mediaobject"><img src="images/st_isvalid06.png"><div class="caption"><p><span class="bold"><strong>(m)</strong></span></p></div></div></div></td></tr></tbody></table><table class="informaltable" border="0"><colgroup><col></colgroup><tbody><tr><td><p><span class="bold"><strong>(h)</strong></span>と<span class="bold"><strong>(i)</strong></span>は妥当な<code class="varname">POLYGON</code>です。<span class="bold"><strong>(jからm)</strong></span>は単一の<code class="varname">POLYGON</code>としては表現できませんが、<span class="bold"><strong>(j)</strong></span>と<span class="bold"><strong>(m)</strong></span>は妥当な<code class="varname">MULTIPOLYGON</code>として表現できます。 </p></td></tr></tbody></table></div><p><code class="varname">MULTIPOLYGON</code>は、全ての要素が妥当で、二つのポリゴン要素について内側がインタセクトしていない場合は<span class="emphasis"><em>妥当</em></span>です。ポリゴン要素の任意の二つの境界は接触してもよいですが、有限な数の<code class="varname">POINT</code>でなければなりません。</p><div class="informaltable"><table class="informaltable" border="0"><colgroup><col><col></colgroup><tbody><tr><td align="center"><div class="informalfigure"><div class="mediaobject"><img src="images/st_isvalid07.png"><div class="caption"><p><span class="bold"><strong>(n)</strong></span></p></div></div></div></td><td align="center"><div class="informalfigure"><div class="mediaobject"><img src="images/st_isvalid08.png"><div class="caption"><p><span class="bold"><strong>(o)</strong></span></p></div></div></div></td><td align="center"><div class="informalfigure"><div class="mediaobject"><img src="images/st_isvalid09.png"><div class="caption"><p><span class="bold"><strong>(p)</strong></span></p></div></div></div></td></tr></tbody></table><table class="informaltable" border="0"><colgroup><col></colgroup><tbody><tr><td><p><span class="bold"><strong>(n)</strong></span>と<span class="bold"><strong>(o)</strong></span>は妥当でない<code class="varname">MULTIPOLYGON</code>です。<span class="bold"><strong>(p)</strong></span>は妥当です。</p></td></tr></tbody></table></div><p>GEOSライブラリを使って実装されている関数のほとんどは、ジオメトリがOpenGISシンプルフィーチャー仕様で定義されているように妥当であると仮定しています。ジオメトリが単純であるか、また妥当であるか、のチェックとして<a class="link" href="#ST_IsSimple" title="ST_IsSimple">ST_IsSimple()</a>と<a class="link" href="#ST_IsValid" title="ST_IsValid">ST_IsValid()</a>が使えます。</p><pre class="programlisting">-- 一般的に、線フィーチャーの妥当性のチェックは
-- 常にTRUEを返すので意味がありません
-- しかし、この例では、PostGISがOGCのIsValidの定義を拡張して
-- *一意な頂点*が2より少ないラインストリングについてFALSEを
-- 返すようにしています
gisdb=# SELECT
   ST_IsValid('LINESTRING(0 0, 1 1)'),
   ST_IsValid('LINESTRING(0 0, 0 0, 0 0)');

 st_isvalid | st_isvalid
------------+-----------
      t     |     f</pre><p>デフォルトでは、PostGISはジオメトリ入力に関するこの妥当性チェックを適用しません。複雑なジオメトリの妥当性のチェックはCPU時間を多く必要とするためです。データソースが信用できない場合は、手動でこのチェックを強制するための制約を付けることができます。</p><pre class="programlisting">ALTER TABLE mytable
  ADD CONSTRAINT geometry_valid_check
        CHECK (ST_IsValid(the_geom));</pre><p>妥当な入力ジオメトリでPostGIS関数を呼んだのに「GEOS Intersection()がエラーを投げました!」というようなエラーメッセージに遭遇したなら、PostGISまたは使用しているライブラリの中のエラーを発見しました。PostGIS開発者に連絡するべきです。PostGIS関数が妥当である入力ジオメトリから妥当でないジオメトリが返る場合も同じです。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>厳格にOGCジオメトリに準拠すると、Z値やM値を持てません。<a class="link" href="#ST_IsValid" title="ST_IsValid">ST_IsValid()</a>は高次を考慮に入れません。<a class="link" href="#AddGeometryColumn" title="AddGeometryColumn">AddGeometryColumn()</a>を実行するとジオメトリの次元をチェックする制約が加わるので、そこで2を指定すれば十分です。</p></td></tr></table></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="DE-9IM"></a>4.3.6. ここで、Dimensionally Extended 9 Intersection Modelまたは略してDE-9IMを見てみましょう。</h3></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect3"><a href="#idp66343880">4.3.6.1. 理論</a></span></dt></dl></div><p>代表的な空間述語 (<a class="xref" href="#ST_Intersects" title="ST_Intersects">ST_Intersects</a>, <a class="xref" href="#ST_Contains" title="ST_Contains">ST_Contains</a>, <a class="xref" href="#ST_Crosses" title="ST_Crosses">ST_Crosses</a>, <a class="xref" href="#ST_Touches" title="ST_Touches">ST_Touches</a>, ...)は、求められる空間フィルタを適切に提供するには十分でないことが時々あります。</p><div class="informaltable"><table class="informaltable" border="0"><colgroup><col></colgroup><tbody><tr><td><div class="informalfigure-float" style="float: left;"><div class="informalfigure"><div align="left"><img src="images/de9im01.png" align="left"></div></div></div><p>たとえば、道路網を表現する線型のデータセットがあるとします。ビジネスルールを無視しているかも知れませんが、点で交差するだけでなく線上で交差する道路区間を全て判別することがGIS解析者の仕事となるかも知れません。この場合、 <a class="xref" href="#ST_Crosses" title="ST_Crosses">ST_Crosses</a>では重要な空間フィルタとして十分ではありません。線型のフィーチャーでは、点でクロス (訳注: インタセクトより厳しい条件です)している場合のみ<code class="varname">true</code>が返ります。</p> <p>空間的にインタセクトしている (<a class="xref" href="#ST_Intersects" title="ST_Intersects">ST_Intersects</a>)と判別された二つの区間の組み合わせについて、実際のインタセクト (<a class="xref" href="#ST_Intersection" title="ST_Intersection">ST_Intersection</a>)を取り、 インタセクトの<a class="xref" href="#ST_GeometryType" title="ST_GeometryType">ST_GeometryType</a>が''<code class="varname">LINESTRING</code>'であるかを見る (<code class="varname">[MULTI]POINT</code>や<code class="varname">[MULTI]LINESTRING</code>等からなる<code class="varname">GEOMETRYCOLLECTION</code>が帰ってくる場合にしっかり対応するため)、という2段階の方法で解くことはできます。</p> <p>よりエレガントかつ速い解法が本当に望ましいでしょう。</p></td></tr></tbody></table></div><div class="informaltable"><table class="informaltable" border="0"><colgroup><col></colgroup><tbody><tr><td><p> </p><div class="informalfigure-float" style="float: right;"><div class="informalfigure"><div align="right"><img src="images/de9im02.png" align="right"></div></div></div> <p>二つ目の[理論的な]例として、GIS解析者が全ての湖の境界に線でインタセクトする波止場やドックの全ての位置を特定しようとするとします。ここで、波止場の一端だけ陸にあるとします。言いかえると、波止場が湖の中にあるが完全に中に入りきってはいなくて、湖と線でインタセクトして、波止場の一方の端が完全に湖に入っていて、かつもう一方の端点が境界線上にあります。解析者は空間述語の組み合わせで、非常に望まれるフィーチャーを引き出す必要があるかも知れません。</p> <div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="#ST_Contains" title="ST_Contains">ST_Contains</a>(lake, wharf) = TRUE</p></li><li class="listitem"><p><a class="xref" href="#ST_ContainsProperly" title="ST_ContainsProperly">ST_ContainsProperly</a>(lake, wharf) = FALSE</p></li><li class="listitem"><p><a class="xref" href="#ST_GeometryType" title="ST_GeometryType">ST_GeometryType</a>(<a class="xref" href="#ST_Intersection" title="ST_Intersection">ST_Intersection</a>(wharf, lake)) = 'LINESTRING'</p></li><li class="listitem"><p><a class="xref" href="#ST_NumGeometries" title="ST_NumGeometries">ST_NumGeometries</a>(<a class="xref" href="#ST_Multi" title="ST_Multi">ST_Multi</a>(<a class="xref" href="#ST_Intersection" title="ST_Intersection">ST_Intersection</a>(<a class="xref" href="#ST_Boundary" title="ST_Boundary">ST_Boundary</a>(wharf), <a class="xref" href="#ST_Boundary" title="ST_Boundary">ST_Boundary</a>(lake)))) = 1</p><p>…(複雑なので以下略)</p></li></ul></div></td></tr></tbody></table></div><p>ここで、Dimensionally Extended 9 Intersection Mode、略してDE-9IMを見てみましょう。</p><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="idp66343880"></a>4.3.6.1. 理論</h4></div></div></div><p><a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features Implementation Specification for SQL</a>によると「二つのジオメトリの比較の基本的なアプローチは、二つのジオメトリの内部、境界、外部のインタセクションの比較と、『インタセクション行列』の要素に基づく2ジオメトリの関係の分類です」。</p><div class="glosslist"><dl><dt><span class="glossterm">境界 (Boundary)</span></dt><dd class="glossdef"><p>ジオメトリの境界は一つ低い次元のジオメトリの集合です。0次元の<code class="varname">POINT</code>の境界は空集合です。<code class="varname">LINESTRING</code>の境界は二つの端点です。 <code class="varname">POLYGON</code>の境界は外環と内環を形成する線です。</p></dd><dt><span class="glossterm">内部 (Interior)</span></dt><dd class="glossdef"><p>ジオメトリの内部は境界を取り去った際に残るジオメトリです。<code class="varname">POINT</code>の内部は<code class="varname">POINT</code>自身です。<code class="varname">LINESTRING</code>の内部は二つの端点の間の実際の点の集合です。<code class="varname">POLYGON</code>の内部はポリゴンの内側の範囲であるサーフェスです。</p></dd><dt><span class="glossterm">外部 (Exterior)</span></dt><dd class="glossdef"><p>ジオメトリの外部は、内部と境界を除いた全領域のサーフェスです。</p></dd></dl></div><p>ジオメトリ<span class="emphasis"><em>a</em></span>があり、aの内部、境界、外部をそれぞれ<span class="emphasis"><em>I(a)</em></span>、<span class="emphasis"><em>B(a)</em></span>、<span class="emphasis"><em>E(a)</em></span>とします。数学的な行列表現は次のようになります。</p><div class="styledtable"><table class="styledtable" border="1"><colgroup><col><col><col><col></colgroup><thead><tr><th align="center"> </th><th align="center"><span class="bold"><strong>内部 (Interior)</strong></span></th><th align="center"><span class="bold"><strong>境界 (Boundary)</strong></span></th><th align="center"><span class="bold"><strong>外部 (Exterior)</strong></span></th></tr></thead><tbody><tr><td align="center"><span class="bold"><strong>内部 (Interior)</strong></span></td><td align="center"><span class="emphasis"><em>dim( I(a) ∩ I(b) )</em></span></td><td align="center"><span class="emphasis"><em>dim( I(a) ∩ B(b) )</em></span></td><td align="center"><span class="emphasis"><em>dim( I(a) ∩ E(b) )</em></span></td></tr><tr><td align="center"><span class="bold"><strong>境界 (Boundary)</strong></span></td><td align="center"><span class="emphasis"><em>dim( B(a) ∩ I(b) )</em></span></td><td align="center"><span class="emphasis"><em>dim( B(a) ∩ B(b) )</em></span></td><td align="center"><span class="emphasis"><em>dim( B(a) ∩ E(b) )</em></span></td></tr><tr><td align="center"><span class="bold"><strong>外部 (Exterior)</strong></span></td><td align="center"><span class="emphasis"><em>dim( E(a) ∩ I(b) )</em></span></td><td align="center"><span class="emphasis"><em>dim( E(a) ∩ B(b) )</em></span></td><td align="center"><span class="emphasis"><em>dim( E(a) ∩ E(b) )</em></span></td></tr></tbody></table></div><p>ここで、<span class="emphasis"><em>dim(a)</em></span>は<span class="emphasis"><em>a</em></span>の次元で、<a class="xref" href="#ST_Dimension" title="ST_Dimension">ST_Dimension</a>で規定されますが、{0,1,2,T,F,*}の値域を持ちます。</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">0</code> =&gt; 点</p></li><li class="listitem"><p><code class="literal">1</code> =&gt; 線</p></li><li class="listitem"><p><code class="literal">2</code> =&gt; 面</p></li><li class="listitem"><p><code class="literal">T</code> =&gt; <code class="literal">{0,1,2}</code></p></li><li class="listitem"><p><code class="literal">F</code> =&gt; 空集合</p></li><li class="listitem"><p><code class="literal">*</code> =&gt; 何でも良い</p></li></ul></div><p>二つのオーバラップするポリゴンについて可視化すると、次のようになります。</p><div class="informaltable"><table class="informaltable" border="0"><colgroup><col width="80pt"><col></colgroup><tbody><tr><td> </td><td align="center"><div class="informalfigure"><div align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;"><tr><td align="center" valign="middle"><img src="images/de9im04.png" align="middle"></td></tr></table></div></div></td></tr><tr><td align="center" valign="middle"><div class="informalfigure"><div align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;"><tr><td align="center" valign="middle"><img src="images/de9im03.png" align="middle"></td></tr></table></div></div></td><td><p> </p><div class="styledtable"><table class="styledtable" border="1"><colgroup><col><col><col><col></colgroup><thead valign="middle"><tr><th align="center" valign="middle"> </th><th align="center" valign="middle"><span class="bold"><strong>内部 (Interior)</strong></span></th><th align="center" valign="middle"><span class="bold"><strong>境界 (Boundary)</strong></span></th><th align="center" valign="middle"><span class="bold"><strong>外部 (Exterior)</strong></span></th></tr></thead><tbody valign="middle"><tr><td align="center" valign="middle"><span class="bold"><strong>内部 (Interior)</strong></span></td><td align="center" valign="middle"><div class="informalfigure"><div><img src="images/de9im05.png"></div></div><p><span class="emphasis"><em>dim(...) = </em></span><span class="bold"><strong>2</strong></span></p></td><td align="center" valign="middle"><div class="informalfigure"><div><img src="images/de9im06.png"></div></div><p><span class="emphasis"><em>dim(...) = </em></span><span class="bold"><strong>1</strong></span></p></td><td align="center" valign="middle"><div class="informalfigure"><div><img src="images/de9im07.png"></div></div><p><span class="emphasis"><em>dim(...) = </em></span><span class="bold"><strong>2</strong></span></p></td></tr><tr><td align="center" valign="middle"><span class="bold"><strong>境界 (Boundary)</strong></span></td><td align="center" valign="middle"><div class="informalfigure"><div><img src="images/de9im08.png"></div></div><p><span class="emphasis"><em>dim(...) = </em></span><span class="bold"><strong>1</strong></span></p></td><td align="center" valign="middle"><div class="informalfigure"><div><img src="images/de9im09.png"></div></div><p><span class="emphasis"><em>dim(...) = </em></span><span class="bold"><strong>0</strong></span></p></td><td align="center" valign="middle"><div class="informalfigure"><div><img src="images/de9im10.png"></div></div><p><span class="emphasis"><em>dim(...) = </em></span><span class="bold"><strong>1</strong></span></p></td></tr><tr><td align="center" valign="middle"><span class="bold"><strong>外部 (Exterior)</strong></span></td><td align="center" valign="middle"><div class="informalfigure"><div><img src="images/de9im11.png"></div></div><p><span class="emphasis"><em>dim(...) = </em></span><span class="bold"><strong>2</strong></span></p></td><td align="center" valign="middle"><div class="informalfigure"><div><img src="images/de9im12.png"></div></div><p><span class="emphasis"><em>dim(...) = </em></span><span class="bold"><strong>1</strong></span></p></td><td align="center" valign="middle"><div class="informalfigure"><div><img src="images/de9im13.png"></div></div><p><span class="emphasis"><em>dim(...) = </em></span><span class="bold"><strong>2</strong></span></p></td></tr></tbody></table></div></td></tr></tbody></table></div><p>左から右、上から下に読むと、次元行列は'<span class="bold"><strong>212101212</strong></span>'と表現されます。</p><p>一つ目の例である、2線が線上でインタセクトする場合の関係行列は'<span class="bold"><strong>1*1***1**</strong></span>'となります。</p><pre class="programlisting">-- 線上でクロスする道路区間の判別
SELECT a.id
FROM roads a, roads b
WHERE a.id != b.id
AND a.geom &amp;&amp; b.geom
AND ST_Relate(a.geom, b.geom, '1*1***1**');</pre><p>二つ目の例である、一部が湖の水涯線上にある波止場についての関係行列は'<span class="bold"><strong>102101FF2</strong></span>'となります。</p><pre class="programlisting">-- 一部が湖の水涯線上にある波止場の判別
SELECT a.lake_id, b.wharf_id
FROM lakes a, wharfs b
WHERE a.geom &amp;&amp; b.geom
AND ST_Relate(a.geom, b.geom, '102101FF2');</pre><p>詳細情報ついては、次のページをご覧ください。</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p><a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features Implementation Specification for SQL</a> (1.1版, 2.1.13.2節)</p></li><li class="listitem"><p><a class="ulink" href="https://en.wikipedia.org/wiki/DE-9IM" target="_top">Dimensionally Extended Nine-Intersection Model (DE-9IM)</a></p></li><li class="listitem"><p><a class="ulink" href="http://docs.geotools.org/latest/userguide/library/jts/dim9.html" target="_top">GeoTools: Point Set Theory and the DE-9IM Matrix</a></p></li><li class="listitem"><p>Hui Xiongさんによる<span class="emphasis"><em>Encyclopedia of GIS</em></span></p></li></ul></div></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="loading_geometry_data"></a>4.4. GIS (ベクタ)データをロードする</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="#idp66435400">4.4.1. SQLを使ってロードする</a></span></dt><dt><span class="sect2"><a href="#shp2pgsql_usage">4.4.2. shp2pgsql: ESRIシェープファイルローダを使う</a></span></dt></dl></div><p>空間テーブルを作成したら、これでGISデータをデータベースにアップロードする準備ができたことになります。現在、PostGIS/PostgreSQLデータベースにデータをロードするには、SQLステートメントを使う、またはシェープファイルのローダ/ダンパを使う、二つの方法があります。</p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idp66435400"></a>4.4.1. SQLを使ってロードする</h3></div></div></div><p>データをテキスト表現に変換できるなら、フォーマットされたSQLを使うのがデータをPostGISに入れる最も簡単な方法です。Oracleや他のSQLデータベースを使うように、SQL端末モニタにSQLの"INSERT"ステートメントで一杯になった大きなテキストファイルをパイプで送ることで、大量のデータをロードできます。</p><p>データアップロードファイル (たとえば<code class="filename">roads.sql</code>)は次のようになるでしょう。</p><pre class="programlisting">BEGIN;
INSERT INTO roads (road_id, roads_geom, road_name)
  VALUES (1,'LINESTRING(191232 243118,191108 243242)','Jeff Rd');
INSERT INTO roads (road_id, roads_geom, road_name)
  VALUES (2,'LINESTRING(189141 244158,189265 244817)','Geordie Rd');
INSERT INTO roads (road_id, roads_geom, road_name)
  VALUES (3,'LINESTRING(192783 228138,192612 229814)','Paul St');
INSERT INTO roads (road_id, roads_geom, road_name)
  VALUES (4,'LINESTRING(189412 252431,189631 259122)','Graeme Ave');
INSERT INTO roads (road_id, roads_geom, road_name)
  VALUES (5,'LINESTRING(190131 224148,190871 228134)','Phil Tce');
INSERT INTO roads (road_id, roads_geom, road_name)
  VALUES (6,'LINESTRING(198231 263418,198213 268322)','Dave Cres');
COMMIT;</pre><p>データファイルは、次に示す"psql"というSQL端末モニタを使って、簡単にPostgreSQLにパイプで送ることができます。</p><pre class="programlisting">psql -d [データベース名] -f roads.sql</pre></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="shp2pgsql_usage"></a>4.4.2. shp2pgsql: ESRIシェープファイルローダを使う</h3></div></div></div><p><code class="filename">shp2pgsql</code>データローダは、ESRIシェープファイルをPostGIS/PostgreSQLデータベースに、ジオメトリまたはジオグラフィとして挿入するための適切なSQLに変換します。ローダには、次に示すコマンドラインフラグによって区別される、いくつかの操作モードがあります。 </p><p>また、コマンドラインローダのほとんどのオプションに対応する<code class="filename">shp2pgsql-gui</code>グラフィカルユーザインタフェースがあります。一度限りのロードしか行わずスクリプト化しない場合やPostGISに不慣れな方にとって便利になるかもしれません。これはpgAdminIIIのプラグインとして構築することもできます。 </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">(c|a|d|p) 相互に排他的なオプションです</span></dt><dd><p>
          </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">-c</span></dt><dd><p>新しいテーブルの作成とシェープファイルからのデータの読み込みを行います。<span class="emphasis"><em>これがデフォルトモードです</em></span>。 </p></dd><dt><span class="term">-a</span></dt><dd><p>シェープファイルからデータベーステーブルにデータを追加します。複数のファイルをロードするためにこのオプションを使う場合は、これらのファイルは同じ属性と同じデータ型を持つ必要があります。 </p></dd><dt><span class="term">-d</span></dt><dd><p>シェープファイルにあるデータを持つ新しいテーブルを作成する前にデータベーステーブルを削除します。 </p></dd><dt><span class="term">-p</span></dt><dd><p>テーブル作成のSQLコードを生成するだけで、実際のデータは追加しません。このモードは、テーブル作成とデータロードとを完全に分けたい場合に使用します。 </p></dd></dl></div><p>
        </p></dd><dt><span class="term">-?</span></dt><dd><p>ヘルプ画面を表示します。 </p></dd><dt><span class="term">-D</span></dt><dd><p>出力データにPostgreSQLのダンプ書式を用います。このモードは-a, -c, -dと組み合わせて利用します。デフォルトの"insert"によるSQL書式よりも、大変早くロードできます。大きなデータセットではこちらを使用して下さい。 </p></dd><dt><span class="term">-s [&lt;FROM_SRID&gt;:]&lt;SRID&gt;</span></dt><dd><p>指定したSRIDでジオメトリデーブルの作成とデータの読み込みを行います。 入力シェープファイルが使っているFROM_SRIDの指定が可能で、この場合は対象SRIDに投影変換を行います。FROM_SRIDは-Dと一緒には指定できません。 </p></dd><dt><span class="term">-k</span></dt><dd><p>識別子 (カラム、スキーマおよび属性)の大文字小文字を保持します。シェープファイルの属性は全て大文字であることに注意して下さい。 </p></dd><dt><span class="term">-i</span></dt><dd><p>全ての整数を標準の32ビット整数に強制します。DBFヘッダではそれが正当であったとしても、64ビットのbigintを生成しません。 </p></dd><dt><span class="term">-I</span></dt><dd><p>ジオメトリカラムにGiSTインデクスを生成します。 </p></dd><dt><span class="term">-m</span></dt><dd><p>-m <code class="filename">a_file_name</code>で、長いカラム名を10文字のDBFカラム名に対応付けるファイルを指定します。ファイルは、1以上の行を持ちます。各行は空白区切りで二つの名前を持ち、行頭行末に空白を入れません。例を次に示します。 </p><pre class="programlisting">COLUMNNAME DBFFIELD1
AVERYLONGCOLUMNNAME DBFFIELD2</pre><p>
        </p></dd><dt><span class="term">-S </span></dt><dd><p>マルチ系ジオメトリの替りに単一ジオメトリを生成します。全てのジオメトリが実際に単一である (たとえば単一の外環でなるMULTIPOLYGONや単一の頂点でなるMULTIPOINT)場合にのみ成功します。 </p></dd><dt><span class="term">-t &lt;次元&gt;</span></dt><dd><p>出力ジオメトリが特定の次元を持つよう強制します。次元は、2D, 3DZ, 3DM, 4Dの文字列を使います。 </p><p>入力の次元が出力より小さい場合には、出力では0が入ります。入力の次元が大きい場合には、外されます。 </p></dd><dt><span class="term">-w</span></dt><dd><p>出力書式をWKBでなくWKTにします。精度が低下して、座標変動が発生しうることに注意が必要です。 </p></dd><dt><span class="term">-e</span></dt><dd><p>トランザクションを使わずに、ステートメントごとに実行するようにします。エラーの元となる不良なジオメトリがいくつか含んでいる時に、大半の良好なデータのロードが可能にするものです。ダンプ書式ではトランザクションを常に使うので、-Dフラグを指定している場合には使えません。 </p></dd><dt><span class="term">-W &lt;エンコーディング&gt;</span></dt><dd><p>入力データ (dbfファイル)のエンコーディングを指定します。全てのdbfの属性は指定されたエンコーディングからUTF8に変換されます。SQL出力結果には <code class="code">SET CLIENT_ENCODING to UTF8</code>が含まれるようになり、バックエンドはUTF-8からデータベースが内部利用のために設定したエンコーディングに再変換できます。 </p></dd><dt><span class="term">-N &lt;方針&gt;</span></dt><dd><p>NULLジオメトリ操作方針(insert*=挿入, skip=スキップ, abort=強制終了)を選択します。 </p></dd><dt><span class="term">-n</span></dt><dd><p>DBFファイルのみインポートします。対応するシェープファイルを持っていない場合、 自動的にこのモードになり、DBFファイルのみロードします。 このフラグは、完全なシェープファイル群を持っていて、属性データだけが欲しくてジオメトリが欲しくない時のみ使用します。 </p></dd><dt><span class="term">-G</span></dt><dd><p>ジオメトリ型のかわりに、ジオグラフィ型で、WGS84経度緯度 (SRID=4326)を使用します (経度緯度データが必要です)。 </p></dd><dt><span class="term">-T &lt;tablespace&gt;</span></dt><dd><p>新しいテーブルのテーブル空間を指定します。 -Xパラメータが使われない場合には、インデクスはデフォルトのテーブル空間を使用します。PostgreSQL文書には、テーブル空間を用いるべき時に関する良い文書があります。 </p></dd><dt><span class="term">-X &lt;tablespace&gt;</span></dt><dd><p>新しいテーブルのインデクスで使われるテーブル空間を指定します。 主キーインデクスに適用され、-Iが合わせて使われている場合にはGiST空間インデクスにも適用されます。 </p></dd></dl></div><p>ローダを使って入力ファイルを生成してアップロードするセッション例は次の通りです。 </p><pre class="programlisting"># shp2pgsql -c -D -s 4269 -i -I shaperoads.shp myschema.roadstable &gt; roads.sql
# psql -d roadsdb -f roads.sql</pre><p>変換とアップロードはUNIXのパイプを使うと一回で実行できます。 </p><pre class="programlisting"># shp2pgsql shaperoads.shp myschema.roadstable | psql -d roadsdb</pre></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="retrieving_vector-data"></a>4.5. GISデータを検索する</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="#idp66506056">4.5.1. SQLを使ってデータを検索する</a></span></dt><dt><span class="sect2"><a href="#idp66516552">4.5.2. ダンパを使う</a></span></dt></dl></div><p>データは、SQLまたはシェープファイルローダ/ダンパを使ってデータベースから抜き出すことができます。SQLに関する節において、空間テーブルでの比較とクエリを行うために用いることができる演算子のいくつかを議論します。</p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idp66506056"></a>4.5.1. SQLを使ってデータを検索する</h3></div></div></div><p>データベースからデータを引き出す最も直接的な手段は、次のように、SQLのSELECTクエリを使って返ってくるレコードとカラムの数を減らし、結果のカラムを可読テキストファイルにダンプするやり方です。</p><pre class="programlisting">db=# SELECT road_id, ST_AsText(road_geom) AS geom, road_name FROM roads;

road_id | geom                                    | road_name
--------+-----------------------------------------+-----------
          1 | LINESTRING(191232 243118,191108 243242) | Jeff Rd
          2 | LINESTRING(189141 244158,189265 244817) | Geordie Rd
          3 | LINESTRING(192783 228138,192612 229814) | Paul St
          4 | LINESTRING(189412 252431,189631 259122) | Graeme Ave
          5 | LINESTRING(190131 224148,190871 228134) | Phil Tce
          6 | LINESTRING(198231 263418,198213 268322) | Dave Cres
          7 | LINESTRING(218421 284121,224123 241231) | Chris Way
(6 rows)</pre><p>しかし、返ってくる結果の数を削るために、なんらかの制限をかけることが重要となるときがあるでしょう。属性ベースの制限の場合、非空間テーブルで使う通常の文法と同じSQLを使うだけです。空間ベースの制限の場合、次の演算子が使用可能であり、便利です。</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">ST_Intersects</span></dt><dd><p>この関数は、二つのジオメトリが空間を共有しているかどうかをテストします。</p></dd><dt><span class="term">=</span></dt><dd><p>この関数で、二つのジオメトリが幾何的に同一であるかを見ることができます。たとえば、'POLYGON((0 0,1 1,1 0,0 0))' は 'POLYGON((0 0,1 1,1 0,0 0))' と同じかを見ることができます (これは同じとなります)。 </p><p>ご注意: PostGIS 2.4より前では、これはジオメトリのボックスでの比較でした。</p></dd></dl></div><p>次に、これらの演算子をクエリで使うことができます。SQLコマンドラインからジオメトリとボックスの指定を行うときは、明示的に文字列表現をジオメトリに変換しなければならないことに注意して下さい。たとえば、次のようになります。ただし312は架空の空間参照系番号で、ここでのデータに合致しています。</p><pre class="programlisting">SELECT road_id, road_name
  FROM roads
  WHERE roads_geom='SRID=312;LINESTRING(191232 243118,191108 243242)'::geometry;</pre><p>上のクエリは"ROADS_GEOM"テーブルから、その値と等価である単一のレコードを返します。</p><p>道路がポリゴンで定義した面を通過するかどうかをチェックするには次のようにします。</p><pre class="programlisting">SELECT road_id, road_name
FROM roads
WHERE ST_Intersects(roads_geom, 'SRID=312;POLYGON((...))');</pre><p>最も一般的な空間クエリは「フレームベース」のクエリでしょう。これは、表示するためのデータの価値のある「マップフレーム」を取得するために、データブラウザやウェブマッパのようなクライアントソフトウェアに使われます。 </p><p>"&amp;&amp;"演算子を使うとき、比較フィーチャーをBOX3DかGEOMETRYかに指定することができます。ただし、GEOMETRYを指定すると、それのバウンディングボックスが比較に使われます。</p><p>次に示すクエリのように、フレームにBOX3Dオブジェクトを使います。</p><pre class="programlisting">SELECT ST_AsText(roads_geom) AS geom
FROM roads
WHERE
  roads_geom &amp;&amp; ST_MakeEnvelope(191232, 243117,191232, 243119,312);</pre><p>エンベロープの投影を指定するためにSRID 312を使っていることに注意して下さい。</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idp66516552"></a>4.5.2. ダンパを使う</h3></div></div></div><p><code class="filename">pgsql2shp</code>テーブルダンパは、データベースに直接接続して、テーブル (あるいはクエリによって定義されたもの)をシェープファイルに変換するものです。基本的な文法は次の通りです。</p><pre class="programlisting">pgsql2shp [&lt;オプション&gt;] &lt;database&gt; [&lt;スキーマ&gt;.]&lt;table&gt;</pre><pre class="programlisting">pgsql2shp [&lt;オプション&gt;] &lt;データベース&gt; &lt;クエリ&gt;</pre><p>コマンドラインオプションは次の通りです。</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">-f &lt;ファイル名&gt;</span></dt><dd><p>特定のファイル名に出力を書きこみます。</p></dd><dt><span class="term">-h &lt;ホスト&gt;</span></dt><dd><p>接続先データベースのホスト名。</p></dd><dt><span class="term">-p &lt;ポート&gt;</span></dt><dd><p>接続先データベースのポート。</p></dd><dt><span class="term">-P &lt;パスワード&gt;</span></dt><dd><p>データベースに接続するためのパスワード。</p></dd><dt><span class="term">-u &lt;ユーザ名&gt;</span></dt><dd><p>データベースに接続する際のユーザ名。</p></dd><dt><span class="term">-g &lt;ジオメトリカラム&gt;</span></dt><dd><p>複数のジオメトリカラムを持つテーブルの場合の、シェープファイルの出力に使用するジオメトリカラム。</p></dd><dt><span class="term">-b</span></dt><dd><p>バイナリカーソルを使います。これは、実行時間を短くしますが、テーブルの非ジオメトリ属性がテキストへのキャストを持っていない場合には、動作しません。</p></dd><dt><span class="term">-r</span></dt><dd><p>Rawモード。<code class="varname">gid</code>フィールドを落としたり、カラム名をエスケープしてはいけません。</p></dd><dt><span class="term">-m <code class="varname">ファイル名</code></span></dt><dd><p>識別名を10文字名に再割り当てします。 ファイルの中身は、一つの空白で区切られ、前と後に空白が無い二つのシンボルの行からなります。VERYLONGSYMBOL SHORTONE ANOTHERVERYLONGSYMBOL SHORTER等となります。</p></dd></dl></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp66534472"></a>4.6. インデクスを構築する</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="#gist_indexes">4.6.1. GiSTインデクス</a></span></dt><dt><span class="sect2"><a href="#brin_indexes">4.6.2. BRINインデックス</a></span></dt><dt><span class="sect2"><a href="#spgist_indexes">4.6.3. SP-GiSTインデクス</a></span></dt><dt><span class="sect2"><a href="#idp66594120">4.6.4. インデクスを使う</a></span></dt></dl></div><p>インデックスは大きなデータセットを持つ空間データベースの利用を可能にするものです。インデックスなしでは、地物の検索でデータベースの全レコードを「シーケンシャルスキャン」する必要があります。インデックスをつけることで、データを検索木に組織化して、特定のレコードを発見するための検索をより早くすることができます。 PostgreSQLは、B木、SP-GiST、GiSTの3種類のインデックスにデフォルトで対応しています。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>B木は、数字、文字、日付といった、一つの軸に沿ってソートできるデータに使用します。 空間データは空間充填曲線、Z階数曲線またはヒルベルト曲線に沿ってソートされます。しかし、この表現は一般的な演算子の速度向上を許しません。 </p></li><li class="listitem"><p>GiST (Generalized Search Trees)インデクスはデータを「一方へのもの」 (訳注: 「左側にあるもの」「上側にあるもの」など)、「オーバラップするもの」、「中にあるもの」に分割して、GISデータを含む幅広いデータ型で使えるようにしたものです。PostGISではGISデータにインデクスを付けるためにGiSTの上でR木インデクス実装を使用しています。</p></li></ul></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="gist_indexes"></a>4.6.1. GiSTインデクス</h3></div></div></div><p>GiSTは「汎用的な検索木 (Generalized Search Tree)」の意味で、インデクスの一般化された形式です。GISインデクスに加えて、GiSTは通常のB木インデクスに従わない全ての種類の不規則なデータ構造 (整数配列, スペクトラルデータ等)の検索速度を向上させるために使います。</p><p>ひとたびGISデータテーブルが数千行を超えたら、空間検索の速度向上のためインデクスを構築したくなるでしょう (これは属性検索でない場合です。属性でしたら通常のインデクスを属性フィールドに追加します)。</p><p>GiSTインデクスをジオメトリカラムに追加するための文は次の通りです。</p><pre class="programlisting">CREATE INDEX [インデクス名] ON [テーブル名] USING GIST ( [ジオメトリカラム名] ); </pre><p>上の文では常に2次元インデックスを構築します。n次元インデックスをジオメトリ型で使うには、次の文でインデックスを生成できます。</p><pre class="programlisting">CREATE INDEX [インデクス名] ON [テーブル名] USING GIST ( [ジオメトリカラム名] gist_geometry_ops_nd);</pre><p>空間インデックスの構築は、計算量を集中させて行われます。また、この時には、テーブルへの書き込みアクセスがブロックされます。そのため、本番システムではより遅いCONCURRENTLYを選択するかも知れません。次のようにします。</p><pre class="programlisting">CREATE INDEX CONCURRENTLY [インデックス名] ON [テーブル名] USING GIST ( [ジオメトリカラム名] ); </pre><p>インデックス構築後に、時々PostgreSQLにテーブルの統計情報を集めさせると助かります。クエリプランの最適化に使われます。</p><pre class="programlisting">VACUUM ANALYZE [テーブル名] [(カラム名)];</pre></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="brin_indexes"></a>4.6.2. BRINインデックス</h3></div></div></div><p>BRINは"Block Range Index"のことで、PostgreSQL 9.5で導入された一般性のあるインデックスの形式です。BRINは不可逆インデックスで、主に読み取り効率と書き込み効率とを妥協させるために使われます。主要な目標は、非常に大きなテーブルの取り扱いで、そのテーブルのために、テーブル内の物理的な位置との自然な相関があるカラムを一部に持ちます。GISインデックスだけでなく、BRINは規則的だったりそうでない多種多様なデータ構造 (整数、配列等)における検索速度の向上のために使われます。</p><p>ひとたびGISデータテーブルが数千行を超えたら、空間検索の速度向上のためインデックスを構築したくなるでしょう (これは属性検索でない場合です。属性でしたら通常のインデックスを属性フィールドに追加します)。GiSTインデックスは、サイズがデータベースに割り当てられているRAM容量を超えずに、ストレージサイズが十分であり、かつ書き込みワークロードのペナルティに余裕がある限りは、本当に高性能です。その他の場合にはBRINインデックスが他の選択肢として考えられます。 </p><p>BRINインデックスの原理は、テーブルブロックの集合の全ての行に含まれる全てのジオメトリを余すところなく取り込んだバウンディングボックスだけを格納することです。明らかに、このインデックス手法は、ブロックレンジの結果バウンディングボックスが相互に排他的になるように、データが物理的に並ぶ場合にだけ効率が良くなります。結果インデックスは本当に小さいのですが、多くの場合で、GiSTインデックスより効率が落ちます。</p><p>BRINインデックスの構築はGiSTインデックスの構築より少ない資源集約で済みます。BRINインデックスがGiSTインデックスが求めるよりも十分の一以下であるのが本当に一般的です。BRINインデックスは、多数のテーブルブロックに対して一つのバウンディングボックスを格納するだけなので、この手の他のインデックスよりもディスク使用量が数千分の一程度で済むのが一般的です。</p><p>レンジ内で要約するブロック数を選択できます。この数字を減らすと、インデックスは大きくなりますが、効率向上の助けになる可能性があります。</p><p>BRINインデックスを「ジオメトリ」カラムに追加するための文は次の通りです。</p><pre class="programlisting">CREATE INDEX [インデックス名] ON [テーブル名] USING BRIN ( [ジオメトリカラム名] ); </pre><p>上の文では常に2次元インデックスを構築します。3次元インデックスは次の文で生成できます。</p><pre class="programlisting">CREATE INDEX [インデックス名] ON [テーブル名] USING BRIN ( [ジオメトリカラム名] brin_geometry_inclusion_ops_3d);</pre><p>また、4次元演算子クラスを使う4次元インデックスを使うこともできます。</p><pre class="programlisting">CREATE INDEX [インデックス名] ON [テーブル名] USING BRIN ( [ジオメトリカラム名] brin_geometry_inclusion_ops_4d);</pre><p>上の書式では、デフォルトの数値やレンジ内ブロック数を使っていますが、値は128です。ブロック数を指定するには、レンジ内の要約をすることになります。次の文のようにして作ります。</p><pre class="programlisting">CREATE INDEX [インデックス名] ON [テーブル名] USING BRIN ( [ジオメトリカラム名] ) WITH (pages_per_range = [数字]); </pre><p>また、BRINインデックスは、多数の行で一つのインデックス値を格納することを心に留めておいて下さい。テーブルに違う次元のジオメトリを格納する場合には、インデックスの効率が悪くなります。この効率欠落を回避するには、格納したジオメトリの次元数の最小値となる演算子クラスを選択します。 </p><p>「ジオグラフィ」型もまたBRINインデックスに対応しています。BRINインデックスを「ジオグラフィ」カラムに構築するための文は次の通りです。</p><pre class="programlisting">CREATE INDEX [インデックス名] ON [テーブル名] USING BRIN ( [ジオグラフィカラム名] ); </pre><p>上の書式では常に回転楕円対面上の地理空間オブジェクトの2次元インデックスを構築します。 </p><p>現在のところは「包括対応」だけをここで考えています。これは、<code class="varname">&amp;&amp;</code>、<code class="varname">~</code>と<code class="varname">@</code>演算子だけが2次元の場合に使われることを意味します (「ジオメトリ」「ジオグラフィ」の両方)。<code class="varname">&amp;&amp;&amp;</code>演算子は3次元ジオメトリで使えます。しばらくはKNN検索に対応しません。</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="spgist_indexes"></a>4.6.3. SP-GiSTインデクス</h3></div></div></div><p>SP-GiSTは、「空間分割された一般探索木」を表します。四分木、k次元木、基数木 (トライ木)のような分割探索木に対応するインデックスの総称的な形式です。このデータ構造の一般的な機能は、検索空間を反復して分割することですが、分割は等しいサイズである必要はありません。SP-GiSTは、GISインデックスだけでなく、電話回線のルーティングや、IPルーティング、部分文字列検索等といった、様々な種類のデータを探索する速度の向上に使われます。 </p><p>GiSTインデックスのためのケースですので、空間オブジェクトを覆うバウンディングボックスを保存するという意味で、SP-GiSTインデックスは不可逆です。SP-GiSTインデックスは、GiSTインデックスの選択肢の一つとして考えることができます。能率試験によって、SP-GiSTインデックスは,、多数のオーバラップするオブジェクトがある「スパゲッティデータ」と呼ばれる状態のときに、特に有利であることが分かりました。</p><p>一度GISデータテーブルが数千行を超えると、データの空間探索の速度向上にSP-GiSTインデックスを使うと良いかも知れません。「ジオメトリ」カラムにSP-GiSTインデックスを構築するための文は次の通りです。</p><pre class="programlisting">CREATE INDEX [インデックス名] ON [テーブル名] USING SPGIST ( [ジオメトリカラム名] ); </pre><p>上の文では、2次元インデックスを構築します。ジオメトリ型の3次元インデックスは、次のように、3次元演算子クラスを使用して生成します。</p><pre class="programlisting">CREATE INDEX [インデックス名] ON [テーブル名] USING SPGIST ([ジオメトリカラム名] spgist_geometry_ops_3d);</pre><p>空間インデックスの構築は、計算量を集中させて行われます。また、この時には、テーブルへの書き込みアクセスがブロックされます。そのため、本番システムでは、より遅いCONCURRENTLYを選択するかも知れません。次のようにします。</p><pre class="programlisting">CREATE INDEX CONCURRENTLY [インデックス名] ON [テーブル名] USING SPGIST ( [ジオメトリカラム名] ); </pre><p>インデックス構築後に、時々PostgreSQLにテーブルの統計情報を集めさせると助かります。クエリプランの最適化に使われます。</p><pre class="programlisting">VACUUM ANALYZE [テーブル名] [(カラム名)];</pre><p>SP-GiSTインデックスは次の演算子を含むクエリの実行速度を向上させられます。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>2次元インデックスについては &lt;&lt;, &amp;&lt;, &amp;&gt;, &gt;&gt;, &lt;&lt;|, &amp;&lt;|, |&amp;&gt;, |&gt;&gt;, &amp;&amp;, @&gt;, &lt;@, and ~= 。</p></li><li class="listitem"><p>3次元インデックスについては &amp;/&amp;, ~==, @&gt;&gt;, and &lt;&lt;@ 。</p></li></ul></div><p>現時点ではkNN探索に対応していません。</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idp66594120"></a>4.6.4. インデクスを使う</h3></div></div></div><p>通常、インデックスは見えないところでデータアクセスの速度向上を行います。すなわち、ひとたびインデックスが構築されたら、クエリプランナは透過的に、クエリプランの速度を向上させるためにインデックス情報を使うべき時を判断します。残念なことに、PostgreSQLクエリプランナは、GiSTインデックスの使用について十分に最適化できず、時々、検索で空間インデックスを使用すべきなのに、テーブル全体を順に走査することがあります。</p><p>空間インデクスが使用されていない (または属性インデクスがその問題のために使用されていない)場合、次の二つのことができます。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>まず、クエリプランを読んで、クエリが実際に必要な計算をしようとしているか確認します。JOIN条件を忘れていたり、間違ったテーブルに付けていたりすることで、暴走することがあり、予期せずに何度もテーブル全体を得ることになります。クエリプランを取得するには、クエリの前にEXPLAINキーワードを追加します。</p></li><li class="listitem"><p>次に、テーブル内の値の数量と分布に関する統計情報を収集するとともに、クエリプランナにインデックス使用にかかる意思決定のための、より良い情報を与えるようにします。<span class="command"><strong>VACUUM ANALYZE</strong></span>は両方を計算します。</p><p>データベースに対する定期的なvacuumは常に実行するべきです。多くのPostgreSQLデータベースエージェントは、閑散時のcronジョブとして定期的に<span class="command"><strong>VACUUM</strong></span>を実行します。</p></li><li class="listitem"><p>vacuumが働かないなら、<span class="command"><strong>set enable_seqscan to off;</strong></span>コマンドで、一時的にプランナに対してインデックス情報の使用を強制することができます。この方法で、プランナがインデックスを使用するプランを生成できるかどうか確認できます。このコマンドはデバッグにのみ使用すべきです。一般的に言うと、プランナはあなたよりインデックスを使うべき時を知っています。クエリを実行したら、<code class="varname">ENABLE_SEQSCAN</code>設定を戻して、他のクエリでは通常通りプランナを使用します。</p></li><li class="listitem"><p>もし、<span class="command"><strong>set enable_seqscan to off;</strong></span>がクエリの実行に役立っているなら、お使いのPostgreSQLはハードウェアにあわせた調整をしていないようです。順に走査する際のコストとインデックスを使う際のコストとを比較してプランナが間違っていることに気付いたら、postgresql.confで<code class="varname">random_page_cost</code>の値を減らしてみるか、<span class="command"><strong>set random_page_cost to 1.1;</strong></span>を使ってみてください。このパラメータのデフォルト値は4ですが、それを1 (SSDの場合)または2 (高速磁気ディスクの場合)にして下さい。値を減らすことで、プランナがよりインデックススキャンを行う傾向になります。</p></li><li class="listitem"><p><span class="command"><strong>set enable_seqscan to off;</strong></span>がクエリの役に立たない場合には、PostgreSQLがまだ解決できない構文を使ってしまっているのかもしれません。インラインSELECTのサブクエリが一つの例です。プランナが最適化できるように書き直す必要があります。LATERAL JOINと呼びます。</p></li></ul></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp66612296"></a>4.7. 複雑なクエリ</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="#idp66615752">4.7.1. インデクスの利点を使う</a></span></dt><dt><span class="sect2"><a href="#examples_spatial_sql">4.7.2. 空間SQLの例</a></span></dt></dl></div><p>空間データベース機能の<span class="emphasis"><em>レゾンデートル</em></span>は、通常はデスクトップGISに求める機能を、データベース内部のクエリで実現してすることです。PostGISを効果的に使用するには、どの空間関数が有効かを知り、また、良好なパフォーマンスを提供する所に適切にインデックスがあることが保証されていることが求められます。なお、本例ではSRID 312を使っていますが、これは純粋に例として出しているだけです。spatial_ref_sysテーブルにあり、データの投影法に合致している、本当のSRIDを使ってください。空間参照系を持たないデータについては、なぜ持っていないのか、持つべきなのかも知れないのか、をじっくり*考えてください*。 たとえば分子内部や火星旅行の到達位置といった、定義された空間参照系を持たない場合には、単にSRIDを無視するか、一つ作成して<code class="varname">spatial_ref_sys</code>テーブルに追加して下さい。</p><p>分子の内部構造や開発前の遊園地の間取り図といった、空間参照系を持たないものを扱うためだったら、問題ありません。ただし、遊園地の位置が決まっている場合だと、遊園地が既存構造の上に入り込まないようにするためだけでも、その位置に適切な平面座標系を使うようにします。</p><p>核戦争時に人類を輸送するための火星遠征を計画し、火星居住用の地図を作成する場合であったとしても、<a class="ulink" href="http://spatialreference.org/ref/iau2000/mars-2000/" target="_top">Mars 2000</a>といった地球以外の座標系を作成し、<code class="varname">spatial_ref_sys</code>に挿入して使うことができます。この火星座標系は非平面 (回転楕円体面の度)ですが、ジオグラフィ型で長さや、計測近似値を、度単位でなくメートル単位で得ることができます。</p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idp66615752"></a>4.7.1. インデクスの利点を使う</h3></div></div></div><p>クエリを作成するとき、&amp;&amp;のようなバウンディングボックスを基準とした演算子によってのみGiST空間インデクスの利点が出てくることだけは覚えておくことが重要です。<code class="varname">ST_Distance()</code>のような関数では演算の最適化を行うためにインデクスを使うことができません。たとえば、次のクエリでは、大きなテーブルでは本当に遅くなります。</p><pre class="programlisting">SELECT the_geom
FROM geom_table
WHERE ST_Distance(the_geom, 'SRID=312;POINT(100000 200000)') &lt; 100</pre><p>このクエリは、geom_tableにおける (100000, 200000)の点から距離が100単位以内にある全てのジオメトリを選択します。このクエリは、テーブル内にあるそれぞれの点と指定した点との距離を計算する、すなわち、それぞれの行で一つの<code class="varname">ST_Distance()</code>計算を行うため、遅くなります。1ステップでインデックスを利用するST_DWithin関数を使って、求められる距離計算の量を減らすことで回避できます。次のようにします。</p><pre class="programlisting">SELECT the_geom
FROM geom_table
WHERE ST_DWithin(the_geom, 'SRID=312;POINT(100000 200000)', 100)
</pre><p>このクエリは、同じジオメトリを選択しますが、より効果的な方法で行われます。the_geomにGiSTインデックスがあると仮定すると、クエリプランナは<code class="varname">ST_Distance()</code>関数の結果を計算する前にインデックスを使って行を減らせると認識します。 &amp;&amp;演算子で使われる<code class="varname">ST_MakeEnvelope</code>ジオメトリは、元のポイントに中央寄せした200単位の正方形です。これは「クエリボックス」です。&amp;&amp;演算子は、結果セットを「クエリボックス」にオーバラップするバウンディングボックスを持つジオメトリだけに素早く減らすためにインデックスを使います。「クエリボックス」がジオメトリテーブル全体の範囲より十分に小さいと仮定すると、行われなければならない距離計算の量は劇的に減少します。</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="examples_spatial_sql"></a>4.7.2. 空間SQLの例</h3></div></div></div><p>本節の例では、線型の道、ポリゴンの自治体境界、の二つのテーブルを使います。テーブルの定義をしまします。<code class="varname">bc_roads</code>については次の通りです。</p><pre class="programlisting">Column      | Type              | Description
------------+-------------------+-------------------
gid         | integer           | Unique ID
name        | character varying | Road Name
the_geom    | geometry          | Location Geometry (Linestring)</pre><p><code class="varname">bc_municipality</code>テーブルの定義については次の通りです。</p><pre class="programlisting">Column     | Type              | Description
-----------+-------------------+-------------------
gid        | integer           | Unique ID
code       | integer           | Unique ID
name       | character varying | City / Town Name
the_geom   | geometry          | Location Geometry (Polygon)</pre><div class="qandaset"><a name="idp66623432"></a><dl><dt>4.7.2.1. <a href="#qa_total_length_roads">道路の総延長はkm表記でいくらになるでしょう?</a></dt><dt>4.7.2.2. <a href="#idp66626376">プリンスジョージ市の大きさはha表記でいくらになるでしょう?</a></dt><dt>4.7.2.3. <a href="#idp66628936">県内で最も大きな面積となる自治体はどこでしょう?</a></dt><dt>4.7.2.4. <a href="#idp66631752">各自治体内に含まれる道路の総延長はいくらでしょう?</a></dt><dt>4.7.2.5. <a href="#idp66634568">プリンスジョージ市内の全ての道路からなるテーブルを作る</a></dt><dt>4.7.2.6. <a href="#idp66637000">ビクトリア州の「ダグラス通り」の長さはkm表記でいくらになるでしょう?</a></dt><dt>4.7.2.7. <a href="#idp66639048">穴を持つ自治体ポリゴンのうち最も大きいのはどれでしょう?</a></dt></dl><table border="0" style="width: 100%;"><colgroup><col align="left" width="1%"><col></colgroup><tbody><tr class="question"><td align="left" valign="top"><a name="qa_total_length_roads"></a><a name="idp66624072"></a><p><b>4.7.2.1.</b></p></td><td align="left" valign="top"><p>道路の総延長はkm表記でいくらになるでしょう?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>この問題は、次のようなとても単純なSQLで答えを得ることができます。</p><pre class="programlisting">SELECT sum(ST_Length(the_geom))/1000 AS km_roads FROM bc_roads;

km_roads
------------------
70842.1243039643
(1 row)</pre></td></tr><tr class="question"><td align="left" valign="top"><a name="idp66626376"></a><a name="idp66626632"></a><p><b>4.7.2.2.</b></p></td><td align="left" valign="top"><p>プリンスジョージ市の大きさはha表記でいくらになるでしょう?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>このクエリでは、属性条件 (municipality name, 自治体名)に空間計算 (面積)を併用しています。</p><pre class="programlisting">SELECT
  ST_Area(the_geom)/10000 AS hectares
FROM bc_municipality
WHERE name = 'PRINCE GEORGE';

hectares
------------------
32657.9103824927
(1 row)</pre></td></tr><tr class="question"><td align="left" valign="top"><a name="idp66628936"></a><a name="idp66629192"></a><p><b>4.7.2.3.</b></p></td><td align="left" valign="top"><p>県内で最も大きな面積となる自治体はどこでしょう?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>このクエリは、空間計測をクエリ条件に持ってきています。この問題へのアプローチの方法はいくつかありますが、最も効率的なのは次の通りです。</p><pre class="programlisting">SELECT
  name,
  ST_Area(the_geom)/10000 AS hectares
FROM
  bc_municipality
ORDER BY hectares DESC
LIMIT 1;

name           | hectares
---------------+-----------------
TUMBLER RIDGE  | 155020.02556131
(1 row)</pre><p>このクエリの答えを出すためには、全てのポリゴンの面積を求める必要があることに注意して下さい。このクエリを多く実行する場合、性能向上のためにテーブルにareaカラムを追加して、別のインデクスを追加することができるようにするのは、意義のあることです。結果を距離について降順に並べ替え、PostgreSQLの"LIMIT"コマンドを用いることで、max()のような集約関数を使わずに、簡単に最も大きい値を集約関数を得ることができます。</p></td></tr><tr class="question"><td align="left" valign="top"><a name="idp66631752"></a><a name="idp66632008"></a><p><b>4.7.2.4.</b></p></td><td align="left" valign="top"><p>各自治体内に含まれる道路の総延長はいくらでしょう?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>これは、二つのテーブルからデータを持ち込んで (結合して)いるので「空間結合」の例です。しかし、結合の条件として共通キーの上で接続するという普通のリレーションのやり方でなく空間インタラクション条件 (「含む」)を使っています。</p><pre class="programlisting">SELECT
  m.name,
  sum(ST_Length(r.the_geom))/1000 as roads_km
FROM
  bc_roads AS r,
  bc_municipality AS m
WHERE
  ST_Contains(m.the_geom, r.the_geom)
GROUP BY m.name
ORDER BY roads_km;

name                        | roads_km
----------------------------+------------------
SURREY                      | 1539.47553551242
VANCOUVER                   | 1450.33093486576
LANGLEY DISTRICT            | 833.793392535662
BURNABY                     | 773.769091404338
PRINCE GEORGE               | 694.37554369147
...</pre><p>このクエリは、テーブル内の全ての道路の合計を最終結果 (この例での話ですが約250Kmの道です)にまとめられるので、少し時間がかかります。より小さいオーバレイ (数百の道路で数千のレコード)の場合、応答はもっと早くなりえます。</p></td></tr><tr class="question"><td align="left" valign="top"><a name="idp66634568"></a><a name="idp66634824"></a><p><b>4.7.2.5.</b></p></td><td align="left" valign="top"><p>プリンスジョージ市内の全ての道路からなるテーブルを作る</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>これは「オーバレイ」の例です。つまり、二つのテーブルを取得して、空間的に切り取られた結果からなる新しいテーブルを出力します。上で示した「空間結合」と違い、このクエリは実際に新しいジオメトリを生成します。生成されたオーバレイはターボのかかった空間結合みたいなもので、より確かな解析作業に便利です。</p><pre class="programlisting">CREATE TABLE pg_roads as
SELECT
  ST_Intersection(r.the_geom, m.the_geom) AS intersection_geom,
  ST_Length(r.the_geom) AS rd_orig_length,
  r.*
FROM
  bc_roads AS r,
  bc_municipality AS m
WHERE
  m.name = 'PRINCE GEORGE'
        AND ST_Intersects(r.the_geom, m.the_geom);</pre></td></tr><tr class="question"><td align="left" valign="top"><a name="idp66637000"></a><a name="idp66637256"></a><p><b>4.7.2.6.</b></p></td><td align="left" valign="top"><p>ビクトリア州の「ダグラス通り」の長さはkm表記でいくらになるでしょう?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><pre class="programlisting">SELECT
  sum(ST_Length(r.the_geom))/1000 AS kilometers
FROM
  bc_roads r,
  bc_municipality m
WHERE
        r.name = 'Douglas St'
        AND m.name = 'VICTORIA'
        AND ST_Intersects(m.the_geom, r.the_geom);

kilometers
------------------
4.89151904172838
(1 row)</pre></td></tr><tr class="question"><td align="left" valign="top"><a name="idp66639048"></a><a name="idp66639304"></a><p><b>4.7.2.7.</b></p></td><td align="left" valign="top"><p>穴を持つ自治体ポリゴンのうち最も大きいのはどれでしょう?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><pre class="programlisting">SELECT gid, name, ST_Area(the_geom) AS area
FROM bc_municipality
WHERE ST_NRings(the_geom) &gt; 1
ORDER BY area DESC LIMIT 1;

gid  | name         | area
-----+--------------+------------------
12   | SPALLUMCHEEN | 257374619.430216
(1 row)</pre></td></tr></tbody></table></div></div></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="using_raster_dataman"></a>第5章 ラスタデータの管理、クエリ、アプリケーション</h1></div></div></div><div class="toc"><p><b>目次</b></p><dl class="toc"><dt><span class="sect1"><a href="#RT_Loading_Rasters">5.1. ラスタのロードと生成</a></span></dt><dd><dl><dt><span class="sect2"><a href="#RT_Raster_Loader">5.1.1. raster2pgsqlを使ってラスタをロードする</a></span></dt><dt><span class="sect2"><a href="#RT_Creating_Rasters">5.1.2. PostGISラスタ関数を用いたラスタの生成</a></span></dt></dl></dd><dt><span class="sect1"><a href="#RT_Raster_Catalog">5.2. ラスタカタログ</a></span></dt><dd><dl><dt><span class="sect2"><a href="#RT_Raster_Columns">5.2.1. ラスタカラムカタログ</a></span></dt><dt><span class="sect2"><a href="#RT_Raster_Overviews">5.2.2. ラスタオーバビュー</a></span></dt></dl></dd><dt><span class="sect1"><a href="#RT_Raster_Applications">5.3. PostGISラスタを使ったカスタムアプリケーションの構築</a></span></dt><dd><dl><dt><span class="sect2"><a href="#RT_PHP_Output">5.3.1. ST_AsPNG を他の関数とあわせて使った PHP 出力例</a></span></dt><dt><span class="sect2"><a href="#RT_Net_Output_CS">5.3.2. ST_AsPNGを他の関数とあわせて使ったASP.NET C#出力例</a></span></dt><dt><span class="sect2"><a href="#RT_Java_Console_App">5.3.3. rasterクエリを画像ファイルで出力するJavaコンソールアプリケーション</a></span></dt><dt><span class="sect2"><a href="#RT_PLPython">5.3.4. PLPython を使って SQL を介して画像をダンプする</a></span></dt><dt><span class="sect2"><a href="#RasterOutput_PSQL">5.3.5. PSQLでラスタを出力する</a></span></dt></dl></dd></dl></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="RT_Loading_Rasters"></a>5.1. ラスタのロードと生成</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="#RT_Raster_Loader">5.1.1. raster2pgsqlを使ってラスタをロードする</a></span></dt><dt><span class="sect2"><a href="#RT_Creating_Rasters">5.1.2. PostGISラスタ関数を用いたラスタの生成</a></span></dt></dl></div><p><code class="varname">raster2pgsql</code>ラスタローダを使ってPostGISラスタを既存のラスタファイルからロードするのは、最もよく行われます。</p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="RT_Raster_Loader"></a>5.1.1. raster2pgsqlを使ってラスタをロードする</h3></div></div></div><p><code class="varname">raster2pgsql</code>は、GDALがサポートするラスタ書式をPostGISラスタテーブルにロードするのに適切なSQLにするバイナリファイルです。ラスタのオーバビューの生成だけでなく、ラスタファイルのフォルダのロードも可能です。 </p><p>raster2pgsqlは、ほとんどの場合、PostGISの一部としてコンパイルされます (GDALライブラリをコンパイルしている場合)が、バイナリファイルによってサポートされるラスタタイプは、GDALでコンパイルされたのと同じです。raster2pgsqlがサポートするラスタタイプの一覧を得るには、<code class="varname">-G</code>スイッチを使います。この一覧は、インストールした PostGIS が提供する<a class="xref" href="#RT_ST_GDALDrivers" title="ST_GDALDrivers">ST_GDALDrivers</a>と同じになるはずです。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>このツールの古い版では、Pythonスクリプトでした。実行ファイルに置き換えられています。Pythonスクリプトが必要な場合は、 <a class="ulink" href="http://trac.osgeo.org/gdal/wiki/frmts_wtkraster.html" target="_top">GDAL PostGIS Raster Driver Usage</a>に、Pythonの例があります。raster2pgsqlのPythonスクリプトは、今後のPostGIS rasterでは動作しないかも知れませんし、サポートされませんので、ご注意ください。 </p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>同じアラインメントを持つラスタの集合から特定の要素のオーバビューを生成する時、オーバビューが同じアラインメントを持たないことがあります。オーバビューが同じアラインメントを持たない例については<a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1764" target="_top">http://trac.osgeo.org/postgis/ticket/1764</a>をご覧下さい。</p></td></tr></table></div><p>使用例: </p><pre class="programlisting">raster2pgsql <code class="varname">raster_options_go_here</code> <code class="varname">raster_file</code> <code class="varname">someschema</code>.<code class="varname">sometable</code> &gt; out.sql</pre><p>
    </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">-?</span></dt><dd><p>ヘルプを表示します。引数を全く指定しない場合にも表示されます。 </p></dd><dt><span class="term">-G</span></dt><dd><p>サポートされているラスタ書式を印字します。 </p></dd><dt><span class="term">(c|a|d|p) 相互に排他的なオプションです</span></dt><dd><p>
              </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">-c</span></dt><dd><p>新しいテーブルを生成し、ラスタを入れます。<span class="emphasis"><em>これがデフォルトモードです</em></span>。 </p></dd><dt><span class="term">-a</span></dt><dd><p>既存のテーブルにラスタを追加します。  </p></dd><dt><span class="term">-d</span></dt><dd><p>テーブルを削除し、新しいテーブルを生成し、ラスタを入れます。 </p></dd><dt><span class="term">-p</span></dt><dd><p>準備モード、テーブルを作るだけです。 </p></dd></dl></div><p>
            </p></dd><dt><span class="term">ラスタ処理: ラスタカタログに適切に登録するための制約の適用</span></dt><dd><p>
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">-C </span></dt><dd><p>SRIDやピクセルサイズ等のラスタ制約を適用して、<code class="varname">raster_columns</code>ビューで適切な登録ができるようにします。 </p></dd><dt><span class="term">-x </span></dt><dd><p>制約の最大範囲を無効にします。-Cフラグが使われている場合のみ適用されます。 </p></dd><dt><span class="term">-r </span></dt><dd><p>正規ブロック制約 (空間的に一意で網羅タイル)を適用します。-Cフラグが使用されている場合のみ適用されます。 </p></dd></dl></div><p>
				</p></dd><dt><span class="term">ラスタ処理: 入力ラスタデータセットの操作に使われる追加的なパラメータ</span></dt><dd><p>
            </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">-s &lt;SRID&gt;</span></dt><dd><p>出力ラスタを指定されたSRIDにします。 指定しないか0を指定した場合、ラスタのメタデータに対して、適切なSRIDを決定するためのチェックを行います。 </p></dd><dt><span class="term">-b BAND</span></dt><dd><p>ラスタから抽出するバンドのインデクス (1始まり)。1より多いバンドを抽出するには、コンマ(,)で区切ります。指定しない場合、全てのバンドが抽出されます。 </p></dd><dt><span class="term">-t TILE_SIZE</span></dt><dd><p>行毎に挿入するラスタを切断します。<code class="varname">TILE_SIZE</code>は、「幅x高さ」で表現しますが、"auto"を指定すると、最初のラスタを使って適切なタイルサイズが計算され、全てのラスタに適用されます。 </p></dd><dt><span class="term">-P</span></dt><dd><p>全てのタイルが同じ幅と高さを持つことを保証するために、右端、下端のタイルに詰め物を施します。 </p></dd><dt><span class="term">-R, --register</span></dt><dd><p>ファイルシステム (データベース外)ラスタとして、ラスタを登録します。</p><p>データベースには、ラスタのメタデータとラスタのファイルパスのみ格納されます (ピクセルは格納されません)。</p></dd><dt><span class="term">-l <code class="varname">OVERVIEW_FACTOR</code></span></dt><dd><p>ラスタのオーバビューを生成します。一つより多い係数を用いる場合は、コンマ (,) で区切ります。オーバビューのテーブル名はo_<code class="varname">overview factor</code>_<code class="varname">table</code>となります。<code class="varname">overview factor</code>にはオーバビュー係数が入り、<code class="varname">table</code>には基底テーブル名が入ります。生成されるオーバビューはデータベースに格納され、-Rは無視されます。生成されたSQLファイルは元データのテーブルとオーバビューテーブルの両方を含むことに注意して下さい。</p></dd><dt><span class="term">-N <code class="varname">NODATA</code></span></dt><dd><p>NODATA値を持たないバンドで使用するNODATA値を設定します。 </p></dd></dl></div><p>
            </p></dd><dt><span class="term">テータベースオブジェクトの操作に使われる追加的なパラメータ</span></dt><dd><p>
              </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">-q </span></dt><dd><p>PostgreSQL識別子に引用符を付けます。 </p></dd><dt><span class="term">-f COLUMN</span></dt><dd><p>出力先ラスタカラムの名前を指定します。デフォルトは'rast'です。 </p></dd><dt><span class="term">-F</span></dt><dd><p>ファイル名でカラムを追加します。</p></dd><dt><span class="term">-n COLUMN</span></dt><dd><p>ファイル名カラムの名前を指定します。-Fを暗に含みます。</p></dd><dt><span class="term">-q</span></dt><dd><p>PostgreSQL識別子に引用符を付けます。</p></dd><dt><span class="term">-I</span></dt><dd><p>ラスタカラムにGiSTインデクスを生成します。 </p></dd><dt><span class="term">-M</span></dt><dd><p>ラスタテーブルにvacuum analyzeを行います。 </p></dd><dt><span class="term">-k</span></dt><dd><p>バンドごとのNODATA値のチェックを省略します。 </p></dd><dt><span class="term">-T <code class="varname">tablespace</code></span></dt><dd><p>生成されるテーブルのテーブルスペースを指定します。-Xフラグを併用しない場合には、インデクス (主キーを含む)はデフォルトのテーブルスペースを使用することにご注意ください。 </p></dd><dt><span class="term">-X <code class="varname">tablespace</code></span></dt><dd><p>テーブルの新しいインデクスに使うテーブル空間を指定します。主キーに適用され、-Iフラグがある場合においては空間インデクスにも適用されます。 </p></dd><dt><span class="term">-Y</span></dt><dd><p>INSERTステートメントでなくCOPYステートメントを使います。</p></dd></dl></div><p>
            </p></dd><dt><span class="term">-e</span></dt><dd><p>ステートメント毎に実行して、トランザクションを使用しないようにします。</p></dd><dt><span class="term">-E ENDIAN</span></dt><dd><p>生成されるラスタのバイナリ出力のエンディアンを制御します。XDR (訳注: ビッグエンディアン)の場合は0を、NDR (訳注:リトルエンディアン)の場合は1を、それぞれ指定します。デフォルトは1です。現時点ではNDR出力のみサポートします。</p></dd><dt><span class="term">-V <code class="varname">version</code></span></dt><dd><p>出力書式の版を指定します。デフォルトは0です。現時点では0のみサポートします。</p></dd></dl></div><p>ローダを用いて入力ファイルを100x100のタイルで生成して、データベースにアップロードする例は、次の通りです。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">public.demelevation</code>でなく<code class="varname">demelevation</code> というようにスキーマ名を外すことができます。この場合、ラスタテーブルはデータベースまたユーザの指定するデフォルトのスキーマに生成されます。</p></td></tr></table></div><pre class="programlisting">raster2pgsql -s 4326 -I -C -M *.tif -F -t 100x100 public.demelevation 
&gt; elev.sql
psql -d gisdb -f elev.sql</pre><p>変換とアップロードはUNIXのパイプを使うと一回で実行できます。</p><pre class="programlisting">raster2pgsql -s 4326 -I -C -M *.tif -F -t 100x100 public.demelevation | psql -d gisdb</pre><p>マサチューセッツ州平面のメートル単位の空中写真タイルを<code class="varname">aerial</code>という名前のスキーマにロードします。 元の画像と2, 4レベルのオーバビューのテーブルとを生成します。 データ格納にCOPYを使用し (データベースに仲介ファイルなくまっすぐ入ります)、-eでトランザクションを指定しないようにします (待たずにテーブルのデータを見たい場合には良いです)。ラスタを128x128ピクセルのタイルに分解してラスタ制約を適用します。INSERTモードでなくCOPYモードを使用します。-Fで、カラム名をタイル切り出し元ファイルのファイル名にします。</p><pre class="programlisting">raster2pgsql -I -C -e -Y -F -s 26986 -t 128x128  -l 2,4 bostonaerials2008/*.jpg aerials.boston | psql -U postgres -d gisdb -h localhost -p 5432</pre><pre class="programlisting">-- サポートされているラスタタイプの一覧:
raster2pgsql -G</pre><p>-Gコマンドの出力は次のようになります。 </p><pre class="screen">Available GDAL raster formats:
  Virtual Raster
  GeoTIFF
  National Imagery Transmission Format
  Raster Product Format TOC format
  ECRG TOC format
  Erdas Imagine Images (.img)
  CEOS SAR Image
  CEOS Image
  JAXA PALSAR Product Reader (Level 1.1/1.5)
  Ground-based SAR Applications Testbed File Format (.gff)
  ELAS
  Arc/Info Binary Grid
  Arc/Info ASCII Grid
  GRASS ASCII Grid
  SDTS Raster
  DTED Elevation Raster
  Portable Network Graphics
  JPEG JFIF
  In Memory Raster
  Japanese DEM (.mem)
  Graphics Interchange Format (.gif)
  Graphics Interchange Format (.gif)
  Envisat Image Format
  Maptech BSB Nautical Charts
  X11 PixMap Format
  MS Windows Device Independent Bitmap
  SPOT DIMAP
  AirSAR Polarimetric Image
  RadarSat 2 XML Product
  PCIDSK Database File
  PCRaster Raster File
  ILWIS Raster Map
  SGI Image File Format 1.0
  SRTMHGT File Format
  Leveller heightfield
  Terragen heightfield
  USGS Astrogeology ISIS cube (Version 3)
  USGS Astrogeology ISIS cube (Version 2)
  NASA Planetary Data System
  EarthWatch .TIL
  ERMapper .ers Labelled
  NOAA Polar Orbiter Level 1b Data Set
  FIT Image
  GRIdded Binary (.grb)
  Raster Matrix Format
  EUMETSAT Archive native (.nat)
  Idrisi Raster A.1
  Intergraph Raster
  Golden Software ASCII Grid (.grd)
  Golden Software Binary Grid (.grd)
  Golden Software 7 Binary Grid (.grd)
  COSAR Annotated Binary Matrix (TerraSAR-X)
  TerraSAR-X Product
  DRDC COASP SAR Processor Raster
  R Object Data Store
  Portable Pixmap Format (netpbm)
  USGS DOQ (Old Style)
  USGS DOQ (New Style)
  ENVI .hdr Labelled
  ESRI .hdr Labelled
  Generic Binary (.hdr Labelled)
  PCI .aux Labelled
  Vexcel MFF Raster
  Vexcel MFF2 (HKV) Raster
  Fuji BAS Scanner Image
  GSC Geogrid
  EOSAT FAST Format
  VTP .bt (Binary Terrain) 1.3 Format
  Erdas .LAN/.GIS
  Convair PolGASP
  Image Data and Analysis
  NLAPS Data Format
  Erdas Imagine Raw
  DIPEx
  FARSITE v.4 Landscape File (.lcp)
  NOAA Vertical Datum .GTX
  NADCON .los/.las Datum Grid Shift
  NTv2 Datum Grid Shift
  ACE2
  Snow Data Assimilation System
  Swedish Grid RIK (.rik)
  USGS Optional ASCII DEM (and CDED)
  GeoSoft Grid Exchange Format
  Northwood Numeric Grid Format .grd/.tab
  Northwood Classified Grid Format .grc/.tab
  ARC Digitized Raster Graphics
  Standard Raster Product (ASRP/USRP)
  Magellan topo (.blx)
  SAGA GIS Binary Grid (.sdat)
  Kml Super Overlay
  ASCII Gridded XYZ
  HF2/HFZ heightfield raster
  OziExplorer Image File
  USGS LULC Composite Theme Grid
  Arc/Info Export E00 GRID
  ZMap Plus Grid
  NOAA NGS Geoid Height Grids</pre></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="RT_Creating_Rasters"></a>5.1.2. PostGISラスタ関数を用いたラスタの生成</h3></div></div></div><p>データベース内でラスタやラスタテーブルを生成したい場合が多くあります。これを行うための関数が多数あります。一般的な手順は次の通りです。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>新しいラスタ行を保持するためのラスタカラムを持つテーブルを生成します。次を実行します。</p><pre class="programlisting">CREATE TABLE myrasters(rid serial primary key, rast raster);</pre></li><li class="listitem"><p>この目標で助けとなる関数は多数あります。他のラスタの派生でないラスタを生成する場合、<a class="xref" href="#RT_ST_MakeEmptyRaster" title="ST_MakeEmptyRaster">ST_MakeEmptyRaster</a>と<a class="xref" href="#RT_ST_AddBand" title="ST_AddBand">ST_AddBand</a>を順次実行して作業を開始します。</p><p>ジオメトリからラスタを生成することもできます。<a class="xref" href="#RT_ST_AsRaster" title="ST_AsRaster">ST_AsRaster</a>を使います。<a class="xref" href="#RT_ST_Union" title="ST_Union">ST_Union</a>や<a class="xref" href="#RT_ST_MapAlgebraFct2" title="ST_MapAlgebraFct">ST_MapAlgebraFct</a>や、地図解析関数群等といった、他の関数を組み合わせる場合もあります。</p><p>既存テーブルから新しいラスタテーブルを生成するための多数の選択肢があります。たとえば、<a class="xref" href="#RT_ST_Transform" title="ST_Transform">ST_Transform</a>を使って、既存テーブルから異なる投影法のラスタテーブルを生成します。 </p></li><li class="listitem"><p>はじめにテーブルにデータを入れたら、ラスタカラムに空間インデクスを生成したくなるでしょう。次のようにします。</p><pre class="programlisting">CREATE INDEX myrasters_rast_st_convexhull_idx ON myrasters USING gist( ST_ConvexHull(rast) );</pre><p><a class="xref" href="#RT_ST_ConvexHull" title="ST_ConvexHull">ST_ConvexHull</a>を使用していることに注意して下さい。多くのラスタ演算子はラスタの凸包を元にしています。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>2.0より前の PostGIS ラスタは、エンベロープを基本にして、凸包ではありませんでした。空間インデクスを適切に働かせるには、エンベロープを基本にしたインデクスを削除して、凸包を元にしたインデクスに置き換えます。</p></td></tr></table></div></li><li class="listitem"><p><a class="xref" href="#RT_AddRasterConstraints" title="AddRasterConstraints">AddRasterConstraints</a>を用いてラスタ制約を適用します。</p></li></ol></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="RT_Raster_Catalog"></a>5.2. ラスタカタログ</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="#RT_Raster_Columns">5.2.1. ラスタカラムカタログ</a></span></dt><dt><span class="sect2"><a href="#RT_Raster_Overviews">5.2.2. ラスタオーバビュー</a></span></dt></dl></div><p>PostGISが生成する、二つのラスタカタログのビューがあります。両方ともラスタテーブルの制約の中に埋め込まれる情報を用いています。結果として、カタログビューは、テーブル内のラスタデータに制約が働くため、常にラスタデータとの矛盾がありません。 </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><code class="varname">raster_columns</code> ラスタタイプのデータベースにおける全てのラスタテーブルカラムのカタログです。</p></li><li class="listitem"><p><code class="varname">raster_overviews</code> データベース内の、より詳細なテーブルのためのオーバビューを提供するラスタテーブルのカラム全てのカタログです。この種のテーブルは、ロード時に<code class="varname">-l</code>を指定した時に生成されます。</p></li></ol></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="RT_Raster_Columns"></a>5.2.1. ラスタカラムカタログ</h3></div></div></div><p><code class="varname">raster_columns</code>は、ラスタタイプのデータベースにおける全てのラスタテーブルカラムのカタログです。テーブルの制約を使ったビューなので、他のデータベースのバックアップからラスタテーブルをリストアしたとしても、情報は常に矛盾がありません。<code class="varname">raster_columns</code>カタログには次のカラムがあります。</p><p>ローダを使わずにテーブルを生成したり、ロード時に<code class="varname">-C</code> フラグを忘れたりした場合には、事後に<a class="xref" href="#RT_AddRasterConstraints" title="AddRasterConstraints">AddRasterConstraints</a>で制約を強制でき、<code class="varname">raster_columns</code>カタログは、ラスタタイルの共通の情報を登録します。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="varname">r_table_catalog</code> テーブルが存在するデータベースです。これは常に現在のデータベースを読みます。</p></li><li class="listitem"><p><code class="varname">r_table_schema</code> ラスタテーブルが属するデータベーススキーマです。</p></li><li class="listitem"><p><code class="varname">r_table_name</code> ラスタテーブルです。</p></li><li class="listitem"><p><code class="varname">r_raster_column</code> ラスタタイプである<code class="varname">r_table_name</code>テーブルのカラムです。PostGISには、一つのテーブルに複数のラスタカラムを持つことを妨げません。異なるラスタカラムを持つラスタテーブルが、ラスタカラム毎に複数回出現するテーブルを持つことができます。</p></li><li class="listitem"><p><code class="varname">srid</code> ラスタの空間参照系識別番号です。<a class="xref" href="#spatial_ref_sys" title="4.3.1. SPATIAL_REF_SYSテーブルと空間参照系">「SPATIAL_REF_SYSテーブルと空間参照系」</a>にあるエントリであるべきです。</p></li><li class="listitem"><p><code class="varname">scale_x</code> 地理空間座標とピクセルの間の拡大縮小係数です。これは、ラスタカラムのすべてのタイルが同じ<code class="varname">scale_x</code>を持ち、制約が適用されている場合のみ出現します。詳細情報については<a class="xref" href="#RT_ST_ScaleX" title="ST_ScaleX">ST_ScaleX</a>を参照してください。</p></li><li class="listitem"><p><code class="varname">scale_y</code> 地理空間座標とピクセルの間の拡大縮小係数です。これは、ラスタカラムのすべてのタイルが同じ<code class="varname">scale_y</code>を持ち、制約が適用されている場合のみ出現します。詳細情報については<a class="xref" href="#RT_ST_ScaleY" title="ST_ScaleY">ST_ScaleY</a>を参照してください。</p></li><li class="listitem"><p><code class="varname">blocksize_x</code> ラスタタイルごとの幅 (横方向のピクセル数)です。詳細情報については<a class="xref" href="#RT_ST_Width" title="ST_Width">ST_Width</a>を参照してください。</p></li><li class="listitem"><p><code class="varname">blocksize_y</code> ラスタタイルごとの高さ (縦方向のピクセル数)です。詳細情報については<a class="xref" href="#RT_ST_Height" title="ST_Height">ST_Height</a>を参照してください。</p></li><li class="listitem"><p><code class="varname">same_alignment</code> 全てのラスタタイルが同じアラインメントを持っているかを示す真偽値です。詳細情報については<a class="xref" href="#RT_ST_SameAlignment" title="ST_SameAlignment">ST_SameAlignment</a>を参照してください。</p></li><li class="listitem"><p><code class="varname">regular_blocking</code> ラスタカラムが空間的に一意かつカバレッジタイルの制約を持つなら、TRUEとなります。その他の場合はFALSEになります。。</p></li><li class="listitem"><p><code class="varname">num_bands</code> ラスタ集合のタイルごとのバンド数。 <a class="xref" href="#RT_ST_NumBands" title="ST_NumBands">ST_NumBands</a></p></li><li class="listitem"><p><code class="varname">pixel_types</code> バンドごとのピクセルタイプを定義する配列です。この配列の要素数はバンド数と同じです。pixel_typesは、<a class="xref" href="#RT_ST_BandPixelType" title="ST_BandPixelType">ST_BandPixelType</a>で定義されるピクセルタイプの一つを取ります。</p></li><li class="listitem"><p><code class="varname">nodata_values</code> バンド毎の<code class="varname">nodata_value</code>を示す倍精度浮動小数点数の配列です。バンド数と同じ配列数となります。これらの値は、バンド毎のほとんどの処理で無視されるべきピクセル値の定義です。これは<a class="xref" href="#RT_ST_BandNoDataValue" title="ST_BandNoDataValue">ST_BandNoDataValue</a>で得られる情報と似ています。</p></li><li class="listitem"><p><code class="varname">out_db</code> ラスタバンドデータがデータベース外で維持されているかを示す真偽値の配列です。この配列の添え字はバンド番号と同じです。</p></li><li class="listitem"><p><code class="varname">extent</code> ラスタ集合における全てのラスタ行の範囲です。集合の範囲を変更するデータを別途ロードする予定である場合、ロード前に<a class="xref" href="#RT_DropRasterConstraints" title="DropRasterConstraints">DropRasterConstraints</a>関数を実行して、ロード後に<a class="xref" href="#RT_AddRasterConstraints" title="AddRasterConstraints">AddRasterConstraints</a>で制約を再適用します。 </p></li><li class="listitem"><p><code class="varname">spatial_index</code> 空間インデクスを持っているかどうかを示す真偽値です。</p></li></ul></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="RT_Raster_Overviews"></a>5.2.2. ラスタオーバビュー</h3></div></div></div><p><code class="varname">raster_overviews</code>は、オーバビューで使われるラスタテーブルカラムに関する情報のカタログで、オーバビューを用いる際に知っておくと便利な情報も持ちます。オーバビューテーブルは<code class="varname">raster_columns</code>と<code class="varname">raster_overviews</code>の両方のカタログに入れられます。オーバビューもラスタの一つであるのは確かですが、より高い解像度テーブルの解像度を落としたカリカチュアになるという特殊な目的を満たすためでもあるからです。ラスタをロードする際に<code class="varname">-l</code>スイッチを使うと、オーバビューが主ラスタテーブルと一緒に生成されます。もしくは、<a class="xref" href="#RT_AddOverviewConstraints" title="AddOverviewConstraints">AddOverviewConstraints</a>を使うと手動で生成できます。</p><p>オーバビューテーブルには、他のラスタテーブルと同じ制約と、オーバビュー特有の制約となる追加情報があります。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">raster_overviews</code>の情報は<code class="varname">raster_columns</code>とは重複しません。<code class="varname">raster_columns</code>にあるオーバビューテーブルに関する情報が必要な場合は、<code class="varname">raster_overviews</code>と<code class="varname">raster_columns</code>とを結合すると、必要な情報の集合を完全に取得することができます。</p></td></tr></table></div><p>オーバビューの主たる理由は次の二つです。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>ズームアウトした際の地図表示を早くするために、元のテーブルの低解像度表現が一般的に使われます。</p></li><li class="listitem"><p>レコード数が少なく、ピクセル毎の適用範囲が広いため、高解像度の元テーブルより計算が一般的に早くなります。計算は高解像度テーブルより精度は落ちますが、大まかな計算には十分でありえます。</p></li></ol></div><p><code class="varname">raster_overviews</code>カタログには、次の情報のカラムがあります。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="varname">o_table_catalog</code> オーバビューテーブルが存在するデータベースです。常に現在のデータベースを読みます。</p></li><li class="listitem"><p><code class="varname">o_table_schema</code> オーバビューラスタテーブルが属するデータベーススキーマです。</p></li><li class="listitem"><p><code class="varname">o_table_name</code> ラスタオーバビューテーブル名です。</p></li><li class="listitem"><p><code class="varname">o_raster_column</code> オーバビューテーブル内のラスタカラムです。</p></li><li class="listitem"><p><code class="varname">r_table_catalog</code> このオーバビューの元となるラスタテーブルのデータベースです。常に現在のデータベースを読みます。</p></li><li class="listitem"><p><code class="varname">r_table_schema</code> このオーバビューの元となるラスタテーブルが属するデータベーススキーマです。</p></li><li class="listitem"><p><code class="varname">r_table_name</code> このオーバビューの元となるラスタテーブルです。</p></li><li class="listitem"><p><code class="varname">r_raster_column</code> このオーバビューの元となるラスタカラムです。</p></li><li class="listitem"><p><code class="varname">overview_factor</code> - オーバビューテーブルのピラミッドレベルです。高い数字ほど解像度が低くなります。raster2pgsqlは、画像のフォルダを渡された場合は、分割して、イメージファイルのオーバビューの計算とロードを行います。レベル1は元ファイルと同じです。レベル2は、元ファイルの4分の1になります。たとえば、5000x5000ピクセルの画像ファイルのフォルダがあるとして、125x125に分ける場合、画像ファイルごとに(5000*5000)/(125*125) = 1600行のレコードを持ち、<code class="varname">o_2</code>テーブル (レベル2)はceiling(1600/Power(2,2)) = 400行、<code class="varname">o_3</code>(レベル3)ではceiling(1600/Power(2,3) ) = 200行のレコードを持ちます。ピクセルがタイルサイズで割り切れない場合、スクラップタイル (完全には値が入っていない)が得られます。raster2pgsqlによって生成される個々のオーバビュータイルは、元となるラスタと同じピクセル数を持ち、個々のピクセルの表現範囲 (オリジナルの Power(2,overview_factor)ピクセル分)が低い解像度になっている点に注意して下さい。</p></li></ul></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="RT_Raster_Applications"></a>5.3. PostGISラスタを使ったカスタムアプリケーションの構築</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="#RT_PHP_Output">5.3.1. ST_AsPNG を他の関数とあわせて使った PHP 出力例</a></span></dt><dt><span class="sect2"><a href="#RT_Net_Output_CS">5.3.2. ST_AsPNGを他の関数とあわせて使ったASP.NET C#出力例</a></span></dt><dt><span class="sect2"><a href="#RT_Java_Console_App">5.3.3. rasterクエリを画像ファイルで出力するJavaコンソールアプリケーション</a></span></dt><dt><span class="sect2"><a href="#RT_PLPython">5.3.4. PLPython を使って SQL を介して画像をダンプする</a></span></dt><dt><span class="sect2"><a href="#RasterOutput_PSQL">5.3.5. PSQLでラスタを出力する</a></span></dt></dl></div><p>PostGISラスタには、対応イメージ書式のラスタをレンダリングするSQL関数があり、レンダリングを行うための多数の選択肢があります。たとえば、<a class="ulink" href="http://www.postgresonline.com/journal/archives/244-Rendering-PostGIS-Raster-graphics-with-LibreOffice-Base-Reports.html" target="_top">Rendering PostGIS Raster graphics with LibreOffice Base Reports</a>で例を挙げている通り、OpenOffice/LibreOfficeを使うことができます。さらに、ここで示すように、幅広い言語で使うことができます。</p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="RT_PHP_Output"></a>5.3.1. ST_AsPNG を他の関数とあわせて使った PHP 出力例</h3></div></div></div><p>本節では、PHPのPostgreSQLドライバと<a class="xref" href="#RT_ST_AsGDALRaster" title="ST_AsGDALRaster">ST_AsGDALRaster</a>等の関数を使って、HTML imgタグに埋め込むことができるPHPリクエストストリームにラスタの1、2、3バンドを出力する方法を示します。</p><p>サンプルクエリでは、 指定したWGS84バウンディングボックスにインタセクトするタイルを取って、 <a class="xref" href="#RT_ST_Union" title="ST_Union">ST_Union</a>でインタセクトしたタイルを結合して全てのバンドを返し、<a class="xref" href="#RT_ST_Transform" title="ST_Transform">ST_Transform</a>でユーザ指定投影法に変換し、<a class="xref" href="#RT_ST_AsPNG" title="ST_AsPNG">ST_AsPNG</a>を使ってPNGで結果を出力するためのラスタ関数群全体をまとめる方法を示します。</p><p>次で示すスクリプトは、</p><pre class="programlisting">http://mywebserver/test_raster.php?srid=2249</pre><p>で、マサチューセッツ州平面 (フィート単位)のラスタ画像を取得するものです。</p><pre class="programlisting">&lt;?php
/** test_raster.phpのコンテンツ **/
$conn_str ='dbname=mydb host=localhost port=5432 user=myuser password=mypwd';
$dbconn = pg_connect($conn_str);
header('Content-Type: image/png');
/** 特定の投影法が要求された場合にはそれを使い、それ以外ではメートル単位マサチューセッツ州平面を使います **/
if (!empty( $_REQUEST['srid'] ) &amp;&amp; is_numeric( $_REQUEST['srid']) ){
                $input_srid = intval($_REQUEST['srid']);
}
else { $input_srid = 26986; }
/** set bytea_outputは、PostgreSQL 9.0以上で必要になるかも知れませんが、8.4では不要です **/
$sql = "set bytea_output='escape';
SELECT ST_AsPNG(ST_Transform(
                        ST_AddBand(ST_Union(rast,1), ARRAY[ST_Union(rast,2),ST_Union(rast,3)])
                                ,$input_srid) ) As new_rast
 FROM aerials.boston
        WHERE
         ST_Intersects(rast, ST_Transform(ST_MakeEnvelope(-71.1217, 42.227, -71.1210, 42.218,4326),26986) )";
$result = pg_query($sql);
$row = pg_fetch_row($result);
pg_free_result($result);
if ($row === false) return;
echo pg_unescape_bytea($row[0]);
?&gt;</pre></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="RT_Net_Output_CS"></a>5.3.2. ST_AsPNGを他の関数とあわせて使ったASP.NET C#出力例</h3></div></div></div><p>本節では、Npgsql PostgreSQL .NETドライバと<a class="xref" href="#RT_ST_AsGDALRaster" title="ST_AsGDALRaster">ST_AsGDALRaster</a>等の関数を使って、HTML imgタグに埋め込むことができるように、ラスタの1、2、3バンドを出力する方法を示します。</p><p>この例ではNpgsql .NET PostgreSQLドライバが必要です。最新版は<a class="ulink" href="http://npgsql.projects.postgresql.org/" target="_top">http://npgsql.projects.postgresql.org/</a>にあります。最新版をダウンロードして、ASP.NET の binフォルダに入れるだけでうまくいきます。</p><p>サンプルクエリでは、 指定したWGS84バウンディングボックスにインタセクトするタイルを取って、 <a class="xref" href="#RT_ST_Union" title="ST_Union">ST_Union</a>でインタセクトしたタイルを結合して全てのバンドを返し、<a class="xref" href="#RT_ST_Transform" title="ST_Transform">ST_Transform</a>でユーザ指定投影法に変換し、<a class="xref" href="#RT_ST_AsPNG" title="ST_AsPNG">ST_AsPNG</a>を使ってPNGで結果を出力するためのラスタ関数群全体をまとめる方法を示します。</p><p>この例はC#で実装している点を除いては<a class="xref" href="#RT_PHP_Output" title="5.3.1. ST_AsPNG を他の関数とあわせて使った PHP 出力例">「ST_AsPNG を他の関数とあわせて使った PHP 出力例」</a>と同じです。</p><p>次で示すスクリプトは、</p><pre class="programlisting">http://mywebserver/TestRaster.ashx?srid=2249</pre><p>で、マサチューセッツ州平面 (フィート単位)のラスタ画像を取得します。</p><pre class="programlisting">-- web.config 接続文字列部 --
&lt;connectionStrings&gt;
    &lt;add name="DSN"
        connectionString="server=localhost;database=mydb;Port=5432;User Id=myuser;password=mypwd"/&gt;
&lt;/connectionStrings
&gt;</pre><pre class="programlisting">// TestRaster.ashxのコード
&lt;%@ WebHandler Language="C#" Class="TestRaster" %&gt;
using System;
using System.Data;
using System.Web;
using Npgsql;

public class TestRaster : IHttpHandler
{
        public void ProcessRequest(HttpContext context)
        {

                context.Response.ContentType = "image/png";
                context.Response.BinaryWrite(GetResults(context));

        }

        public bool IsReusable {
                get { return false; }
        }

        public byte[] GetResults(HttpContext context)
        {
                byte[] result = null;
                NpgsqlCommand command;
                string sql = null;
                int input_srid = 26986;
        try {
                    using (NpgsqlConnection conn = new NpgsqlConnection(System.Configuration.ConfigurationManager.ConnectionStrings["DSN"].ConnectionString)) {
                            conn.Open();

                if (context.Request["srid"] != null)
                {
                    input_srid = Convert.ToInt32(context.Request["srid"]);
                }
                sql = @"SELECT ST_AsPNG(
                            ST_Transform(
                                        ST_AddBand(
                                ST_Union(rast,1), ARRAY[ST_Union(rast,2),ST_Union(rast,3)])
                                                    ,:input_srid) ) As new_rast
                        FROM aerials.boston
                                WHERE
                                    ST_Intersects(rast,
                                    ST_Transform(ST_MakeEnvelope(-71.1217, 42.227, -71.1210, 42.218,4326),26986) )";
                            command = new NpgsqlCommand(sql, conn);
                command.Parameters.Add(new NpgsqlParameter("input_srid", input_srid));


                            result = (byte[]) command.ExecuteScalar();
                conn.Close();
                        }

                }
        catch (Exception ex)
        {
            result = null;
            context.Response.Write(ex.Message.Trim());
        }
                return result;
        }
}</pre></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="RT_Java_Console_App"></a>5.3.3. rasterクエリを画像ファイルで出力するJavaコンソールアプリケーション</h3></div></div></div><p>これは、一つの画像を返すクエリを取り、指定したファイルに出力する、簡単なJavaコンソールアプリケーションです。</p><p>最新のPostgreSQL JDBCドライバは<a class="ulink" href="http://jdbc.postgresql.org/download.html" target="_top">http://jdbc.postgresql.org/download.html</a>からダウンロードできます。 </p><p>あとで示すコードをコンパイルします。コマンドは次の通りです。</p><pre class="programlisting">set env CLASSPATH .:..\postgresql-9.0-801.jdbc4.jar
javac SaveQueryImage.java
jar cfm SaveQueryImage.jar Manifest.txt *.class</pre><p>次のようにコマンドラインから呼び出します。</p><pre class="programlisting">java -jar SaveQueryImage.jar "SELECT ST_AsPNG(ST_AsRaster(ST_Buffer(ST_Point(1,5),10, 'quad_segs=2'),150, 150, '8BUI',100));" "test.png" </pre><pre class="programlisting">-- Manifest.txt --
Class-Path: postgresql-9.0-801.jdbc4.jar
Main-Class: SaveQueryImage</pre><pre class="programlisting">// SaveQueryImage.javaのコード
import java.sql.Connection;
import java.sql.SQLException;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.io.*;

public class SaveQueryImage {
  public static void main(String[] argv) {
      System.out.println("Checking if Driver is registered with DriverManager.");

      try {
        //java.sql.DriverManager.registerDriver (new org.postgresql.Driver());
        Class.forName("org.postgresql.Driver");
      }
      catch (ClassNotFoundException cnfe) {
        System.out.println("Couldn't find the driver!");
        cnfe.printStackTrace();
        System.exit(1);
      }

      Connection conn = null;

      try {
        conn = DriverManager.getConnection("jdbc:postgresql://localhost:5432/mydb","myuser", "mypwd");
        conn.setAutoCommit(false);

        PreparedStatement sGetImg = conn.prepareStatement(argv[0]);

        ResultSet rs = sGetImg.executeQuery();

                FileOutputStream fout;
                try
                {
                        rs.next();
                        /** Output to file name requested by user **/
                        fout = new FileOutputStream(new File(argv[1]) );
                        fout.write(rs.getBytes(1));
                        fout.close();
                }
                catch(Exception e)
                {
                        System.out.println("Can't create file");
                        e.printStackTrace();
                }

        rs.close();
                sGetImg.close();
        conn.close();
      }
      catch (SQLException se) {
        System.out.println("Couldn't connect: print out a stack trace and exit.");
        se.printStackTrace();
        System.exit(1);
      }
  }
}</pre></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="RT_PLPython"></a>5.3.4. PLPython を使って SQL を介して画像をダンプする</h3></div></div></div><p>これは、サーバディレクトリ内でレコードごとにファイルを生成するPythonストアド関数です。plpythonが必要です。plpythonuとplpython3uの両方が正しく動作します。</p><pre class="programlisting">CREATE OR REPLACE FUNCTION write_file (param_bytes bytea, param_filepath text)
RETURNS text
AS $$
f = open(param_filepath, 'wb+')
f.write(param_bytes)
return param_filepath
$$ LANGUAGE plpythonu;</pre><pre class="programlisting">-- 5つの画像をPostgreSQLサーバに可変サイズで描きます。
-- PostgreSQLデーモンのアカウントにフォルダへの書き込み権限が必要ですので
-- ご注意ください。
-- 生成されたファイル名をエコーバックします。
 SELECT write_file(ST_AsPNG(
        ST_AsRaster(ST_Buffer(ST_Point(1,5),j*5, 'quad_segs=2'),150*j, 150*j, '8BUI',100)),
         'C:/temp/slices'|| j || '.png')
         FROM generate_series(1,5) As j;

     write_file
---------------------
 C:/temp/slices1.png
 C:/temp/slices2.png
 C:/temp/slices3.png
 C:/temp/slices4.png
 C:/temp/slices5.png
</pre></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="RasterOutput_PSQL"></a>5.3.5. PSQLでラスタを出力する</h3></div></div></div><p>PSQLから組み込み機能を用いてバイナリを出力するのは簡単ではありません。ここで紹介する方法は、レガシーなラージオブジェクトをサポートするPostgreSQL上に乗っかる、ちょっとしたハックです。まずは、psqlを起動して、データベースに接続します。 </p><p>この方法はPythonの場合と違い、ローカル機にファイルが生成されます</p><pre class="screen">SELECT oid, lowrite(lo_open(oid, 131072), png) As num_bytes
 FROM
 ( VALUES (lo_create(0),
   ST_AsPNG( (SELECT rast FROM aerials.boston WHERE rid=1) )
  ) ) As v(oid,png);
-- 次のような出力が得られます --
   oid   | num_bytes
---------+-----------
 2630819 |     74860

-- 続いて、oidを書き留めて、'C:/temp/aerial_smap.png'を
-- ローカルのコンピュータ上のファイルパスに置き換えたうえで、
-- 次を実行します。
 \lo_export 2630819 'C:/temp/aerial_samp.png'

-- db上のラージオブジェクトストレージからファイルを削除します
SELECT lo_unlink(2630819);
                        </pre></div></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="idp67757512"></a>第6章 PostGISを使う: アプリケーションを構築する</h1></div></div></div><div class="toc"><p><b>目次</b></p><dl class="toc"><dt><span class="sect1"><a href="#Using_MapServer">6.1. MapServerを使う</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp67766600">6.1.1. 基本的な使い方</a></span></dt><dt><span class="sect2"><a href="#idp67802696">6.1.2. よくある質問</a></span></dt><dt><span class="sect2"><a href="#idp67818696">6.1.3. 踏み込んだ使用法</a></span></dt><dt><span class="sect2"><a href="#idp67827144">6.1.4. 例</a></span></dt></dl></dd><dt><span class="sect1"><a href="#idp67833672">6.2. Javaクライアント (JDBC)</a></span></dt><dt><span class="sect1"><a href="#idp67836616">6.3. Cクライアント (libpq)</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp67837640">6.3.1. テキストカーソル</a></span></dt><dt><span class="sect2"><a href="#idp67838792">6.3.2. バイナリカーソル</a></span></dt></dl></dd></dl></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Using_MapServer"></a>6.1. MapServerを使う</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="#idp67766600">6.1.1. 基本的な使い方</a></span></dt><dt><span class="sect2"><a href="#idp67802696">6.1.2. よくある質問</a></span></dt><dt><span class="sect2"><a href="#idp67818696">6.1.3. 踏み込んだ使用法</a></span></dt><dt><span class="sect2"><a href="#idp67827144">6.1.4. 例</a></span></dt></dl></div><p>Minnesota MapServerはOpenGIS Web Mapping Server仕様を満たすウェブマッピングサーバです。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>MapServerのウェブサイトは<a class="ulink" href="http://mapserver.org/" target="_top">http://mapserver.org/</a>です。</p></li><li class="listitem"><p>The OpenGIS Web Map Specificationは<a class="ulink" href="http://www.opengeospatial.org/standards/wms" target="_top">http://www.opengeospatial.org/standards/wms</a>にあります。</p></li></ul></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idp67766600"></a>6.1.1. 基本的な使い方</h3></div></div></div><p>MapServerでPostGISを使うには、MapServerのコンフィギュレーション方法についての知識が必要ですが、この文書の範囲外です。この節では、PostGIS特有の問題とコンフィギュレーション詳細について記載します。</p><p>PostGISをMapServerで使うには、次のものが必要です。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>PostGIS 0.6以上</p></li><li class="listitem"><p>MapServer 3.5以上</p></li></ul></div><p>MapServerは、他のクライアントのように、<code class="filename">libpq</code>インタフェースを使って、PostGIS/PostgreSQLデータにアクセスします。よってMapServerはPostGISサーバにアクセスするネットワークを持つ計算機にインストールでき、PostGISをデータソースとして使用することができます。システム間の接続は速いほど良いです。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>"--with-postgis"と好きなconfigureオプションを付けてMpaServerのコンパイルとインストールを行います。</p></li><li class="listitem"><p>Mapserverのmapファイルの中に、PostGISレイヤを追加します。たとえば次のようになります。</p><pre class="programlisting">LAYER
  CONNECTIONTYPE postgis
  NAME "widehighways"
  # リモートの空間データベースに接続します
  CONNECTION "user=dbuser dbname=gisdatabase host=bigserver"
  PROCESSING "CLOSE_CONNECTION=DEFER"
  # 'roads'テーブルの'geom'カラムからラインを取得します
  DATA "geom from roads using srid=4326 using unique gid"
  STATUS ON
  TYPE LINE
  # 範囲内のラインのうち、広い高速道路のみ描画します
  FILTER "type = 'highway' and numlanes &gt;= 4"
  CLASS
    # Make the superhighways brighter and 2 pixels wide
    EXPRESSION ([numlanes] &gt;= 6)
    STYLE
      COLOR 255 22 22
      WIDTH 2
    END
  END
  CLASS
    # 残りは、暗い色かつ1ピクセル幅です
    EXPRESSION ([numlanes] &lt; 6)
    STYLE
      COLOR 205 92 82
    END
  END
END</pre><p>上の例におけるPostGIS特有のディれ句ティ部は次の通りです。</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">CONNECTIONTYPE</span></dt><dd><p>PostGISレイヤでは常に"postgis"とします。</p></dd><dt><span class="term">CONNECTION</span></dt><dd><p>データベース接続は「接続文字列」によって制御されます。接続文字列は、次に示すような標準的なキーと値からなります(&lt;&gt;内はデフォルト値)。</p><p>user=&lt;ユーザ名&gt; password=&lt;パスワード&gt; dbname=&lt;ユーザ名&gt; hostname=&lt;サーバ&gt; port=&lt;5432&gt;</p><p>空の接続文字列も妥当とされますし、あらゆるキーと値のペアは省略できます。接続するためには一般的にはdbnameとusernameとが最少で与えるものとなります。</p></dd><dt><span class="term">DATA</span></dt><dd><p>このパラメータの形式は "&lt;カラム名&gt; from &lt;テーブル名&gt; using srid=&lt;SRID&gt; using unique &lt;主キー&gt;"となります。ここで、カラム名は地図に描画したい空間カラムを指し、SRIDはそのカラムで使われるSRIDで、主キーはそのテーブルの主キー (またはインデクスを伴う一意の値を持つカラム)です。</p><p>"using srid"と"using unique"節は省略できます。MapServerは可能なら自動的に正しい値を判断しますが、地図を描画するサーバ上で余分なクエリを若干実行するコストがかかります。</p></dd><dt><span class="term">PROCESSING</span></dt><dd><p>接続を閉じずに複数のレイヤで再利用する場合にCLOSE_CONNECTION=DEFERとします。速度が改善します。詳細な説明については<a class="ulink" href="http://blog.cleverelephant.ca/2008/10/mapserverpostgis-performance-tips.html" target="_top">MapServer PostGIS Performance Tips</a>を参照して下さい。 </p></dd><dt><span class="term">FILTER</span></dt><dd><p>フィルタは、妥当なSQL文字列でなければなりません。この文字列は、通常はSQLクエリにおける"WHERE"に続く論理式に対応します。たとえば、6レーン以上の道路だけを描画する場合には、"num_lanes &gt;= 6"というフィルタを使います。</p></dd></dl></div></li><li class="listitem"><p>空間データベースにおいては、空間 (GiST)インデクスを、マップに描かれるレイヤ全てに構築していることを保証して下さい。</p><pre class="programlisting">CREATE INDEX [インデクス名] ON [テーブル名] USING GIST ( [ジオメトリカラム] );</pre></li><li class="listitem"><p>MapServerを使用するレイヤのクエリを実行する場合には、"using unique"節もDATAステートメントに追加しなければなりません。</p><p>MapServerでは、クエリ実行の際には、それぞれの空間レコードを識別するための一意な識別子が必要です。MapServerのPostGISモジュールは、一意な識別子を提供するために、ユーザ指定の一意な値を使います。テーブルの主キーを使うのが最も良い方法です。</p></li></ol></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idp67802696"></a>6.1.2. よくある質問</h3></div></div></div><div class="qandaset"><a name="idp67803336"></a><dl><dt>6.1.2.1. <a href="#idp67803592">EXPRESSIONをマップファイルで使う時に、値がテーブルにあるのを確認しているのに条件がtrueになりません。</a></dt><dt>6.1.2.2. <a href="#idp67806664">シェープファイルで使っているFILTERが、同じデータを持つPostGISテーブルでは動作しません。</a></dt><dt>6.1.2.3. <a href="#idp67809224">PostGISレイヤの描画がシェープファイルより遅くなりますが、これが普通なのでしょうか?</a></dt><dt>6.1.2.4. <a href="#idp67812040">PostGISレイヤはちゃんと描けましたが、クエリが本当に遅いです。何が問題なのですか?</a></dt><dt>6.1.2.5. <a href="#idp67815496">ジオグラフィカラム (PostGIS 1.5で機能追加)をMapServerのレイヤのソースとして使用できますか?</a></dt></dl><table border="0" style="width: 100%;"><colgroup><col align="left" width="1%"><col></colgroup><tbody><tr class="question"><td align="left" valign="top"><a name="idp67803592"></a><a name="idp67803848"></a><p><b>6.1.2.1.</b></p></td><td align="left" valign="top"><p><code class="varname">EXPRESSION</code>をマップファイルで使う時に、値がテーブルにあるのを確認しているのに条件がtrueになりません。</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>EXPRESIONで使うフィールド名は、シェープファイルと違ってPostGISの場合<span class="emphasis"><em>小文字</em></span>になります。</p><pre class="programlisting">EXPRESSION ([numlanes] &gt;= 6)</pre></td></tr><tr class="question"><td align="left" valign="top"><a name="idp67806664"></a><a name="idp67806920"></a><p><b>6.1.2.2.</b></p></td><td align="left" valign="top"><p>シェープファイルで使っているFILTERが、同じデータを持つPostGISテーブルでは動作しません。</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>シェープファイルと違い、PostGISレイヤのフィルタはSQL構文を使います (PostGISコネクタがMapServerでレイヤを描画するために生成するSQLステートメントに追加されます)。</p><pre class="programlisting">FILTER "type = 'highway' and numlanes &gt;= 4"</pre></td></tr><tr class="question"><td align="left" valign="top"><a name="idp67809224"></a><a name="idp67809480"></a><p><b>6.1.2.3.</b></p></td><td align="left" valign="top"><p>PostGISレイヤの描画がシェープファイルより遅くなりますが、これが普通なのでしょうか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>一般的に、地図に描画されるフィーチャーが多くなると、PostGISはシェープファイルより遅くなります。比較的少ないフィーチャー (100件台)ではPostGISの方が早く、フィーチャー密度が高くなる (1000件台)と、PostGISの方が遅くなります。 </p><p>重大な描画性能の問題があるようでしたら、テーブルにある空間インデクスを構築していないというのがありそうです。</p><pre class="programlisting">postgis# CREATE INDEX geotable_gix ON geotable USING GIST ( geocolumn );
postgis# VACUUM ANALYZE;</pre></td></tr><tr class="question"><td align="left" valign="top"><a name="idp67812040"></a><a name="idp67812296"></a><p><b>6.1.2.4.</b></p></td><td align="left" valign="top"><p>PostGISレイヤはちゃんと描けましたが、クエリが本当に遅いです。何が問題なのですか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>クエリを早くするには、空間テーブルに一意なキーを持たせ、そのキーにインデクスを持たせなければなりません。</p><p><code class="varname">DATA</code>行の<code class="varname">USING UNIQUE</code>節で、MapServerで使用する一意なキーをどれにするか指定することができます。</p><pre class="programlisting">DATA "geom FROM geotable USING UNIQUE gid"</pre></td></tr><tr class="question"><td align="left" valign="top"><a name="idp67815496"></a><a name="idp67815752"></a><p><b>6.1.2.5.</b></p></td><td align="left" valign="top"><p>ジオグラフィカラム (PostGIS 1.5で機能追加)をMapServerのレイヤのソースとして使用できますか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>できます!MapServerはジオグラフィカラムをジオメトリカラムと同じに認識します。しかし、常にSRIDを4326とします。"using srid=4326"節を<code class="varname">DATA</code>ステートメントに入れて下さい。他の部分はジオメトリの場合と同じです。</p><pre class="programlisting">DATA "geog FROM geogtable USING SRID=4326 USING UNIQUE gid"</pre></td></tr></tbody></table></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idp67818696"></a>6.1.3. 踏み込んだ使用法</h3></div></div></div><p><code class="varname">USING</code>疑似SQL節を使ってMapServerがより複雑なクエリの結果を理解できるようにするための情報を追加します。より詳しく言うと、ビューまたは副問い合わせが元テーブル (<code class="varname">DATA</code>定義で"FROM"の右にあるもの)として使われる時、MapServerが自動的に一意な識別子がそれぞれの行にあるか、また、SRIDがテーブルにあるかを判別するのは困難です。<code class="varname">USING</code>節によって、MapServerがこれらの情報を得ることができます。例を次に挙げます。</p><pre class="programlisting">DATA "geom FROM (
  SELECT
    table1.geom AS geom,
    table1.gid AS gid,
    table2.data AS data
  FROM table1
  LEFT JOIN table2
  ON table1.id = table2.id
) AS new_table USING UNIQUE gid USING SRID=4326"</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term">USING UNIQUE &lt;uniqueid&gt;</span></dt><dd><p>MapServerは、マップクエリを実行する際、行識別のために、それぞれの行に一意な識別子を求めます。通常ならシステムテーブルから主キーを識別しますが、ビューや副問い合わせでは、一意性のあるカラムを自動的に知ることができません。MapServerのクエリ機能を使いたいなら、一意性のあるカラムをビューまたは副問い合わせに追加する必要があり、<code class="varname">USING UNIQUE</code>宣言を付ける必要があります。たとえば、この目的のための主キー値のテーブルでのカラム名や、結果セットで一意性が保障されたカラムを明示的にSELECTに入れることができます。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>「マップクエリ」はマップ上でクリックして、その場所におけるフィーチャーに関する情報を問い合わせる動作です。「マップクエリ」と<code class="varname">DATA</code>定義におけるSQLクエリと混同しないで下さい。</p></td></tr></table></div></dd><dt><span class="term">USING SRID=&lt;srid&gt;</span></dt><dd><p>PostGISは、MapServerに正しいデータを返すために、ジオメトリがどの空間参照系を使っているかを知る必要があります。通常は、この情報はPostGISデータベースの"geometry_columns"テーブルから得ることができます。しかし、副問い合わせやビューのような一時テーブルでは、この方法は不可能です。そこで、 <code class="varname">USING SRID=</code>オプションを使って、正しいSRIDが<code class="varname">DATA</code>定義で使われるように指定します。</p></dd></dl></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idp67827144"></a>6.1.4. 例</h3></div></div></div><p>簡単な例から始めて、ステップアップしていきましょう。次のMapServerレイヤ定義を考えて下さい。</p><pre class="programlisting">LAYER
  CONNECTIONTYPE postgis
  NAME "roads"
  CONNECTION "user=theuser password=thepass dbname=thedb host=theserver"
  DATA "geom from roads"
  STATUS ON
  TYPE LINE
  CLASS
    STYLE
      COLOR 0 0 0
    END
  END
END</pre><p>このレイヤは"roads"テーブルにある道路ジオメトリの全部を黒線で表示するものです。</p><p>では、少なくとも1:100000にズームするまでは高速道路だけを表示したい、としましょう。次の二つのレイヤで、その効果が実現できます。</p><pre class="programlisting">LAYER
  CONNECTIONTYPE postgis
  CONNECTION "user=theuser password=thepass dbname=thedb host=theserver"
  PROCESSING "CLOSE_CONNECTION=DEFER"
  DATA "geom from roads"
  MINSCALE 100000
  STATUS ON
  TYPE LINE
  FILTER "road_type = 'highway'"
  CLASS
    COLOR 0 0 0
  END
END
LAYER
  CONNECTIONTYPE postgis
  CONNECTION "user=theuser password=thepass dbname=thedb host=theserver"
  PROCESSING "CLOSE_CONNECTION=DEFER"
  DATA "geom from roads"
  MAXSCALE 100000
  STATUS ON
  TYPE LINE
  CLASSITEM road_type
  CLASS
    EXPRESSION "highway"
    STYLE
      WIDTH 2
      COLOR 255 0 0
    END
  END
  CLASS
    STYLE
      COLOR 0 0 0
    END
  END
END</pre><p>一つ目のレイヤはスケールが1:100000以上であるときに使われ、道路タイプが"highway"である道路のみ黒線で表示されます。<code class="varname">FILTER</code>オプションによって、道路タイプが"highway"の場合のみ表示することになります。</p><p>二つ目のレイヤはスケールが1:100000未満である時に使われ、"highway"は赤い二重細線で表示され、他の道路は黒線で表示されます。</p><p>さて、MapServerの機能を使うだけで、二つのおもしろいことを実行しました。しかし、<code class="varname">DATA</code>のSQLステートメントは、単純なままです。道路名が (どういう理由かは知りませんが)他のテーブルに収められていて、それのデータを取得するためにテーブルを連結して、道路のラベルを取る必要がある、とします。</p><pre class="programlisting">LAYER
  CONNECTIONTYPE postgis
  CONNECTION "user=theuser password=thepass dbname=thedb host=theserver"
  DATA "geom FROM (SELECT roads.gid AS gid, roads.geom AS geom,
        road_names.name as name FROM roads LEFT JOIN road_names ON
        roads.road_name_id = road_names.road_name_id)
        AS named_roads USING UNIQUE gid USING SRID=4326"
  MAXSCALE 20000
  STATUS ON
  TYPE ANNOTATION
  LABELITEM name
  CLASS
    LABEL
      ANGLE auto
      SIZE 8
      COLOR 0 192 0
      TYPE truetype
      FONT arial
    END
  END
END</pre><p>このANNOTAIONレイヤでは、縮尺が1:20000以下のときに、全ての道路に緑色のラベルを表示します。また、この例は、 <code class="varname">DATA</code>定義で、SQLのJOINを使用する方法も示しています。</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp67833672"></a>6.2. Javaクライアント (JDBC)</h2></div></div></div><p>Javaクライアントは、直接的にテキスト表現として、またはPostGISにバンドルされているJDBC拡張オブジェクトを使用して、PostgreSQLデータベース内にある、PostGISの"geometry"オブジェクトにアクセスできます。JDBC拡張オブジェクトを使うためには、"postgis.jar"ファイルを、JDBCドライバパッケージの"postgresql.jar"とともに、 CLASSPATHに置く必要があります。</p><pre class="programlisting">import java.sql.*;
import java.util.*;
import java.lang.*;
import org.postgis.*;

public class JavaGIS {

public static void main(String[] args) {

  java.sql.Connection conn;

  try {
    /* 
    * JDBCドライバをロードして接続を確立します。
    */
    Class.forName("org.postgresql.Driver");
    String url = "jdbc:postgresql://localhost:5432/database";
    conn = DriverManager.getConnection(url, "postgres", "");
    /*
    * ジオメトリ型を接続に追加します。
    * ご注意 : addDateType()を呼ぶ前に
    *   接続をpgsql特有の接続実装にキャストしなければなりません。
    */
    ((org.postgresql.PGConnection)conn).addDataType("geometry",Class.forName("org.postgis.PGgeometry"));
    ((org.postgresql.PGConnection)conn).addDataType("box3d",Class.forName("org.postgis.PGbox3d"));
    /*
    * Create a statement and execute a select query.
    */
    Statement s = conn.createStatement();
    ResultSet r = s.executeQuery("select geom,id from geomtable");
    while( r.next() ) {
      /*
      * Retrieve the geometry as an object then cast it to the geometry type.
      * Print things out.
      */
      PGgeometry geom = (PGgeometry)r.getObject(1);
      int id = r.getInt(2);
      System.out.println("Row " + id + ":");
      System.out.println(geom.toString());
    }
    s.close();
    conn.close();
  }
catch( Exception e ) {
  e.printStackTrace();
  }
}
}</pre><p>"PGeometry"オブジェクトは、Point、LineString、Polygon、MultiPoint、MultiLineString、MultiPolygonの各型に依存する、特定のトポロジカルジオメトリオブジェクト ("Geometory"抽象クラスの子クラス)を持つラッパオブジェクトです。</p><pre class="programlisting">PGgeometry geom = (PGgeometry)r.getObject(1);
if( geom.getType() == Geometry.POLYGON ) {
  Polygon pl = (Polygon)geom.getGeometry();
  for( int r = 0; r &lt; pl.numRings(); r++) {
    LinearRing rng = pl.getRing(r);
    System.out.println("Ring: " + r);
    for( int p = 0; p &lt; rng.numPoints(); p++ ) {
      Point pt = rng.getPoint(p);
      System.out.println("Point: " + p);
      System.out.println(pt.toString());
    }
  }
}</pre><p>幾何オブジェクトのさまざまなデータアクセサ関数に関する参照情報については、拡張オブジェクトのJavaDocをご覧下さい。</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp67836616"></a>6.3. Cクライアント (libpq)</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="#idp67837640">6.3.1. テキストカーソル</a></span></dt><dt><span class="sect2"><a href="#idp67838792">6.3.2. バイナリカーソル</a></span></dt></dl></div><p>...</p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idp67837640"></a>6.3.1. テキストカーソル</h3></div></div></div><p>...</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idp67838792"></a>6.3.2. バイナリカーソル</h3></div></div></div><p>...</p></div></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="performance_tips"></a>第7章 性能向上に関する技法</h1></div></div></div><div class="toc"><p><b>目次</b></p><dl class="toc"><dt><span class="sect1"><a href="#small_tables_large_objects">7.1. 大きなジオメトリを持つ小さなテーブル</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp67965640">7.1.1. 問題の説明</a></span></dt><dt><span class="sect2"><a href="#idp67969864">7.1.2. 応急処置</a></span></dt></dl></dd><dt><span class="sect1"><a href="#database_clustering">7.2. ジオメトリインデクスでCLUSTERを実行する</a></span></dt><dt><span class="sect1"><a href="#avoiding_dimension_conversion">7.3. 次元変換の回避</a></span></dt><dt><span class="sect1"><a href="#database_tuning_configuration">7.4. コンフィギュレーションのチューン</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idp67988168">7.4.1. 起動時</a></span></dt><dt><span class="sect2"><a href="#idp67997640">7.4.2. 実行時</a></span></dt></dl></dd></dl></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="small_tables_large_objects"></a>7.1. 大きなジオメトリを持つ小さなテーブル</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="#idp67965640">7.1.1. 問題の説明</a></span></dt><dt><span class="sect2"><a href="#idp67969864">7.1.2. 応急処置</a></span></dt></dl></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idp67965640"></a>7.1.1. 問題の説明</h3></div></div></div><p>現版のPostgreSQL (9.6を含む)では、TOASTテーブルに従うクエリオプティマイザの弱さに苦しみます。 TOASTテーブルは、(長いテキスト、イメージ、多数の頂点を持つ複合ジオメトリといった)通常のデータページに適合しない、(データサイズという意味では)巨大な値を納めるための「拡張部屋」の一種です。詳細情報は <a class="ulink" href="http://www.postgresql.org/docs/current/static/storage-toast.html" target="_top">the PostgreSQL Documentation for TOAST</a>をご覧ください。</p><p>(高解像度で全てのヨーロッパの国の境界を含むテーブルのような)大きなジオメトリがあるうえ、行がそう多くないテーブルを持つようになると、この問題が出てきます。テーブル自体は小さいのですが、多くのTOASTスペースを使います。例として、テーブル自体は概ね80行で3データページしか使わなくてもTOASTテーブルで8225ページを使うとします。</p><p>ここで、ジオメトリ演算子の&amp;&amp;を使って、ほとんどマッチしないようなバウンダリボックスを検索するクエリを出してみます。クエリオプティマイザにはテーブルは3ページ80行しかないように見えます。オプティマイザは、小さなテーブルを順に走査する方がインデクスを使うよりも早いと見積もります。そして、GiSTインデクスは無視すると決めます。通常なら、この見積もりは正しいです。しかし、この場合は&amp;&amp;演算子が全てのジオメトリをディスクから呼び出してバウンディングボックスと比較しなければならなくなり、ゆえに、全てのTOASTページもまた呼び出す必要があります。</p><p>この問題に苦しむかどうかを見るには、PostgreSQLの"EXPLAIN ANALYZE"コマンドを使います。詳細情報と技術情報については、PostgreSQL性能メーリングリストのスレッド<a class="ulink" href="http://archives.postgresql.org/pgsql-performance/2005-02/msg00030.php" target="_top">http://archives.postgresql.org/pgsql-performance/2005-02/msg00030.php</a>をご覧下さい。</p><p>また、PostGISの新しいスレッド<a class="ulink" href="https://lists.osgeo.org/pipermail/postgis-devel/2017-June/026209.html" target="_top">https://lists.osgeo.org/pipermail/postgis-devel/2017-June/026209.html</a>もご覧下さい。</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idp67969864"></a>7.1.2. 応急処置</h3></div></div></div><p>PostgreSQLコミュニティでは、TOASTを意識したクエリ見積もりを作ることで、この問題を解決しようとしています。今のところは、二つの応急処置があります。</p><p>一つは、クエリプランナにインデクスの使用を強制することです。クエリを発行する前に"SET enable_seqscan TO off;"をサーバに送信します。これは基本的にクエリプランナに対して可能な限り順に走査することを避けるよう強制します。そのためGiSTインデクスを通常使うようになります。しかし、このフラグは接続するたびに設定しなければならず、他のケースにおいてはクエリプランナに誤った見積もりをさせることになるので、 "SET enable_seqscan TO on;"をクエリの後に送信すべきです。</p><p>もう一つは、順に走査することをクエリプランナが考える程度に早くすることです。これは、バウンダリボックスの「キャッシュ」を行う追加カラムを作成し、このカラムにマッチさせるようにすることで達成することができます。ここでの例では次のようになります。</p><pre class="programlisting">SELECT AddGeometryColumn('myschema','mytable','bbox','4326','GEOMETRY','2');
UPDATE mytable SET bbox = ST_Envelope(ST_Force2D(the_geom));</pre><p>そして、次のように、&amp;&amp;演算子をgeom_columnに対して行っていたものをbboxに変更します。</p><pre class="programlisting">SELECT geom_column
FROM mytable
WHERE bbox &amp;&amp; ST_SetSRID('BOX3D(0 0,1 1)'::box3d,4326);</pre><p>もちろん、mytableの行を変更または追加したら、bboxを「同期」するようにしなければなりません。最もすっきりした方法はトリガです。もしくは、アプリケーションを変更してbboxカラムの現状を保持するか、テーブル更新後にいつもUPDATEクエリを実行するかでも対応できます。</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="database_clustering"></a>7.2. ジオメトリインデクスでCLUSTERを実行する</h2></div></div></div><p>読み込むことがほとんどで、かつほとんどのクエリでひとつのインデクスを使うようなテーブルのために、PostgreSQLはCLUSTERコマンドを提供しています。このコマンドは、全てのデータ行を、インデクス基準にあわせて物理的に再整理するので、二つの性能の利点を生みます。一つは、インデクスの範囲走査のために、データテーブルのシーク回数が劇的に減少することです。もう一つは、いくつかの小さなインデクス間隔に集中する場合には、データ行が分布するデータページがより少なくなるので、より効率的なキャッシュを持つことです (この点で、PostgreSQLマニュアルのCLUSTERコマンドのドキュメントを読むように仕向けられていると感じて下さい)。</p><p>しかし、GiSTインデクスは単純にNULL値を無視するため現在のところPostGISのGiSTインデクスのクラスタリングはできず、次のようなエラーメッセージを得ます。</p><pre class="programlisting">lwgeom=# CLUSTER my_geom_index ON my_table;
ERROR: cannot cluster when index access method does not handle null values
(エラー: インデクスアクセスメソッドがNULL値を扱わない場合クラスタ化できません)
HINT: You may be able to work around this by marking column "the_geom" NOT NULL.
(ヒント: 列"the_geom"をNOT NULLとすることで、これを回避できるかもしれません)</pre><p>ヒントメッセージにある通り、テーブルに"not null"制限を追加することで、この欠陥にとりあえず対応できます。例を示します。</p><pre class="programlisting">lwgeom=# ALTER TABLE my_table ALTER COLUMN the_geom SET not null;
ALTER TABLE</pre><p>もちろん、ジオメトリカラムで実際にNULL値が必要な場合、この対応はできません。さらには、制限を追加するには上の方法を使わなければならず、"ALTER TABLE blubb ADD CHECK (geometry is not null);"のようなCHECK制限は使えません。</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="avoiding_dimension_conversion"></a>7.3. 次元変換の回避</h2></div></div></div><p>ときどき、テーブルで3次元、4次元のデータを持つのに、常にOpenGIS準拠のST_AsText()またはST_AsBinary()関数を使ってアクセスして 2次元ジオメトリを出力させるようなことが起きます。内部でST_Force_2d()関数を呼んでいるために発生しますが、これは、大きなジオメトリでは重大なオーバヘッドを誘引することになります。このオーバヘッドを回避するには、一度追加された次元を前もって落とし、かつこれを永続化するのが適当かも知れません。</p><pre class="programlisting">UPDATE mytable SET the_geom = ST_Force2D(the_geom);
VACUUM FULL ANALYZE mytable;</pre><p>AddGeometryColumn()を使ってジオメトリカラムを追加した場合、ジオメトリの次元に関する制限があることに注意してください。この制限を迂回するには、制限の削除が必要になります。geometry_columnsテーブル内のエントリを更新して、その後で制限を再作成することを忘れないで下さい。</p><p>大きなテーブルの場合、WHERE節、およびプライマリキー若しくは他の適切な基準によってテーブルの一部へのUPDATEを制限させて、UPDATEの実行の間に単に"VACUUM;"と実行することで、UPDATEをより小さい塊に分割するのが賢いやり方かもしれません。これにより、テンポラリディスクスペースが劇的に減少します。さらに、次元混合のジオメトリを持つ場合、"WHERE dimension(the_geom)&gt;2"によってUPDATEを制限することで、2次元で書かれているジオメトリの再書き込みをスキップさせることができます。</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="database_tuning_configuration"></a>7.4. コンフィギュレーションのチューン</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="#idp67988168">7.4.1. 起動時</a></span></dt><dt><span class="sect2"><a href="#idp67997640">7.4.2. 実行時</a></span></dt></dl></div><p>PostGISの調整はPostgreSQLの作業量の調整と非常に似ています。ジオメトリとラスタは重く、メモリ関連の最適化は他のPostgreSQLクエリと比べて影響が大きい点だけは留意して下さい。</p><p>PostgreSQLの最適化に関する一般的な詳細は、<a class="ulink" href="https://wiki.postgresql.org/wiki/Tuning_Your_PostgreSQL_Server" target="_top">Tuning your PostgreSQL Server</a>をご覧ください。</p><p>PostgreSQL 9.4以上では、<code class="code">ALTER SYSTEM..</code>を使うことで、postgresql.confやpostgresql.auto.confを触ることなくサーバレベルで設定できます。</p><pre class="programlisting">ALTER SYSTEM SET work_mem = '256MB';
-- 起動時設定でない設定を強制します。新規接続に影響を与えます。
SELECT pg_reload_conf();
-- 現在の設定値を表示
-- 全ての設定を見るにはSHOW ALLを使います
SHOW work_mem;</pre><p>この設定に追加して、PostGISには、<a class="xref" href="#PostGIS_GUC" title="8.2. PostGIS GUC (Grand Unified Custom)変数">「PostGIS GUC (Grand Unified Custom)変数」</a>で示している、いくつかの独特の設定があります。</p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idp67988168"></a>7.4.1. 起動時</h3></div></div></div><p>これらの設定はpostgresql.conf内にあります。 </p><p>
           <a class="ulink" href="http://www.postgresql.org/docs/current/static/runtime-config-query.html#GUC-CONSTRAINT-EXCLUSION" target="_top">constraint_exclusion</a>
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>デフォルト: partition </p></li><li class="listitem"><p>一般的にテーブルのパーティショニングに使われます。デフォルトとして"partition"に設定されています。継承階層内にあり、プランナにペナルティ以外を払わないなら、クエリプランナにテーブルの制約条件の解析だけを行わせるので、PostgreSQL 8.4以上ではこれが理想的です。 </p></li></ul></div><p>
           <a class="ulink" href="http://www.postgresql.org/docs/current/static/runtime-config-resource.html#GUC-SHARED-BUFFERS" target="_top">shared_buffers</a>
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>デフォルト: PostgreSQL 9.6では128MB以下 </p></li><li class="listitem"><p>利用可能なRAMの25%から40%を設定します。Windowsでは高く設定することができないかも知れません。 </p></li></ul></div><p><a class="ulink" href="https://www.postgresql.org/docs/current/static/runtime-config-resource.html#GUC-MAX-WORKER-PROCESSES" target="_top">max_worker_processes</a> これは、PostgreSQL 9.4以上で有効です。PostgreSQL 9.6以上では、パラレルクエリ処理に使うプロセス数の最大値の制御で、さらに重要なものとなっています。 </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>デフォルト: 8 </p></li><li class="listitem"><p>システムが対応できるバックグラウンドプロセスの最大値を設定します。このパラメータはサーバ起動時のみ設定できます。 </p></li></ul></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idp67997640"></a>7.4.2. 実行時</h3></div></div></div><p><a class="ulink" href="http://www.postgresql.org/docs/current/static/runtime-config-resource.html#GUC-WORK-MEM" target="_top">work_mem</a> (並べ替えや複雑なクエリに使われるメモリ) </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>デフォルト: 1-4MB </p></li><li class="listitem"><p>大きなデータベースの場合や、複雑なクエリの場合、RAMが多い場合は値を大きくするように調整します。 </p></li><li class="listitem"><p>同時接続ユーザ数が多い場合や、RAMが少ない場合には値を小さくするように調整します。 </p></li><li class="listitem"><p>たくさんのRAMを持ち、少数の開発者しかいない場合は次のようにします。 </p><pre class="programlisting">SET work_mem TO '256MB';
                </pre><p>
            </p></li></ul></div><p><a class="ulink" href="http://www.postgresql.org/docs/current/static/runtime-config-resource.html#GUC-MAINTENANCE-WORK-MEM" target="_top">maintenance_work_mem</a> (VACUUM, CREATE INDEX等で使われるメモリ) </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>デフォルト: 16-64MB </p></li><li class="listitem"><p>一般的には低すぎます - メモリスワップの間、入出力が拘束され、オブジェクトがロックされます。 </p></li><li class="listitem"><p>たくさんのRAMを持つ本番サーバでは32MBから1GBが推奨ですが、同時接続ユーザ数に依存します。たくさんのRAMを持ち、少数の開発者しかいない場合は次のようにします。 </p><pre class="programlisting">SET maintenance_work_mem TO '1GB';
                </pre><p>
            </p></li></ul></div><p><a class="ulink" href="https://www.postgresql.org/docs/current/static/runtime-config-resource.html#GUC-MAX-PARALLEL-WORKERS-PER-GATHER" target="_top">max_parallel_workers_per_gather</a> PostgreSQL 9.6以上で有効です。また、パラレルクエリに対応しているPostGIS 2.3以上でのみ影響が出ます。0より大きい値にすると、<code class="code">ST_Intersects</code>等の関係関数が複数のプロセスを使えるようになり、2倍以上高速になります。多数のプロセッサを予備に持っているなら、この値を、持っているプロセッサ数にあわせるべきです。また、<code class="code">max_worker_processes</code>を少なくともこの値より大きくするようにして下さい。 </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>デフォルト: 0 </p></li><li class="listitem"><p>単一の<code class="varname">Gather</code>ノードが開始できるワーカの最大数を設定します。並列ワーカは、<code class="varname">max_worker_processes</code>で確立されたプロセスのプールから取得されます。要求したワーカ数は、実際には実行可能になっていない場合があることに注意して下さい。これが発生する場合には、想定より少ないワーカでプランが実行され、非効率になります。これの値を0 (デフォルト値)にすると、パラレルクエリ実行が無効になります。 </p></li></ul></div></div></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="reference"></a>第8章 PostGISリファレンス</h1></div></div></div><div class="toc"><p><b>目次</b></p><dl class="toc"><dt><span class="sect1"><a href="#PostGIS_Types">8.1. PostgreSQL PostGIS Geometry/Geography/Box型</a></span></dt><dt><span class="sect1"><a href="#PostGIS_GUC">8.2. PostGIS GUC (Grand Unified Custom)変数</a></span></dt><dt><span class="sect1"><a href="#Management_Functions">8.3. 管理関数</a></span></dt><dt><span class="sect1"><a href="#Geometry_Constructors">8.4. ジオメトリ コンストラクタ</a></span></dt><dt><span class="sect1"><a href="#Geometry_Accessors">8.5. ジオメトリアクセサ</a></span></dt><dt><span class="sect1"><a href="#Geometry_Editors">8.6. ジオメトリエディタ</a></span></dt><dt><span class="sect1"><a href="#Geometry_Outputs">8.7. ジオメトリ出力</a></span></dt><dt><span class="sect1"><a href="#Operators">8.8. 演算子</a></span></dt><dt><span class="sect1"><a href="#Spatial_Relationships_Measurements">8.9. 空間関係関数と空間計測関数 </a></span></dt><dt><span class="sect1"><a href="#reference_sfcgal">8.10. SFCGAL関数</a></span></dt><dt><span class="sect1"><a href="#Geometry_Processing">8.11. ジオメトリ処理関数</a></span></dt><dt><span class="sect1"><a href="#Linear_Referencing">8.12. 線型参照</a></span></dt><dt><span class="sect1"><a href="#Temporal">8.13. 時間機能</a></span></dt><dt><span class="sect1"><a href="#Long_Transactions_Support">8.14. ロングトランザクション機能</a></span></dt><dt><span class="sect1"><a href="#Miscellaneous_Functions">8.15. その他の関数</a></span></dt><dt><span class="sect1"><a href="#Exceptional_Functions">8.16. 例外的関数</a></span></dt></dl></div><p>ここで示す関数はPostGISユーザが必要とすると思われる関数です。この他に、一般的なユーザが使わないPostGISオブジェクトに対して求められるサポート関数があります。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>PostGISは、既存の名前付け方針からSQL-MM中心の方針への切り替えを開始しています。結果として、ユーザが知っていて愛用している関数の多くが標準空間型 (ST) プレフィクスを使うように名前変更されました。以前の関数はまだ有効ですが、更新された等価な関数があるものについては、この文書の一覧から外しています (訳注: 非推奨関数はPostGIS 2.0では基本的に外れています)。これらの関数は非推奨であり、将来のリリースでは削除されますので、*使わないでください*。</p></td></tr></table></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="PostGIS_Types"></a>8.1. PostgreSQL PostGIS Geometry/Geography/Box型</h2></div><div><div class="abstract"><p class="title"><b>概要</b></p><p>本節では、PostGISによってインストールされるPostgreSQLデータ型を挙げます。特にユーザ定義関数をデザインする際に大変重要なキャストの挙動を記載しています。 </p><p>ある型が他の型に強制されることをキャストといいます。PostgreSQLは、ほとんどのデータベースと異なり、カスタム型のキャストの挙動と、キャストのために使われる関数を定義することができます。キャストは自動的に指定することができます。この場合は、otherfootypeでしか動作しない関数にmyfooを渡す場合で、自動キャストがある場合には、CAST(myfoo AS otherfootype)やmyfoo::otherfootypeというものを必要としません。 </p><p>自動キャストの挙動に頼る危険性は、関数をオーバロードするときに出てきます。たとえば、box2dを取るものとbox3dとを取るものがあるけれどもジオメトリをとるものが無いとします。どちらの関数とも、ジオメトリは両方に自動キャストするので、ジオメトリを使って良いことになります。-- しかし、あいまいな関数エラーで終わります。PostgreSQLに強制的に選択させるために、CAST(mygeom As box3d)またはmygeom::box3dを実行します。</p><p><span class="emphasis"><em>少なくともPostgreSQL 8.3では</em></span>、全て文字列にキャストできます (おそらく、不思議な未知の型のためです)。オブジェクトを文字列にキャストするために表現するキャストの定義は必要ありません。</p></div></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#box2d_type">box2d</a></span><span class="refpurpose"> — xmin, ymin, xmax, ymaxで作られるボックス。しばしばジオメトリを囲む2次元のボックスを返すために使われます。 </span></dt><dt><span class="refentrytitle"><a href="#box3d_type">box3d</a></span><span class="refpurpose"> — xmin, ymin, zmin, xmax, ymax, zmaxで作られるボックス。しばしばジオメトリやジオメトリのコレクションの3次元範囲を返すために使われます。 </span></dt><dt><span class="refentrytitle"><a href="#geometry">geometry</a></span><span class="refpurpose"> — 平面空間データ型。</span></dt><dt><span class="refentrytitle"><a href="#geometry_dump">geometry_dump</a></span><span class="refpurpose"> — geom (ジオメトリオブジェクトを保持)とpath[] (ダンプされたオブジェクト内のジオメトリの位置を保持する1次元配列)とからなる二つのフィールドを持つ空間データ型。</span></dt><dt><span class="refentrytitle"><a href="#geography">geography</a></span><span class="refpurpose"> — 回転楕円体空間データ型。</span></dt></dl></div><div class="refentry"><a name="box2d_type"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>box2d — xmin, ymin, xmax, ymaxで作られるボックス。しばしばジオメトリを囲む2次元のボックスを返すために使われます。 </p></div><div class="refsection"><a name="idp68095304"></a><h2>説明</h2><p>box2dは、ジオメトリまたはジオメトリ集合を囲むボックスを表現するPostGIS空間データ型です。PostGIS 1.4より前のST_Extentはbox2dを返しました。</p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="box3d_type"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>box3d — xmin, ymin, zmin, xmax, ymax, zmaxで作られるボックス。しばしばジオメトリやジオメトリのコレクションの3次元範囲を返すために使われます。 </p></div><div class="refsection"><a name="idp68098120"></a><h2>説明</h2><p>box3dは、ジオメトリまたはジオメトリ集合を囲むボックスを表現するPostGIS空間データ型です。ST_3DExtentはbox3dオブジェクトを返します。</p></div><div class="refsection"><a name="idp68099272"></a><h2>キャストの挙動</h2><p>本節では、このデータ型で許容される明示的なキャストと自動キャストの一覧を挙げます。</p><div class="informaltable"><table class="informaltable" border="1"><colgroup><col><col></colgroup><tbody><tr><td>キャスト先</td><td>挙動</td></tr><tr><td>box</td><td>自動</td></tr><tr><td>box2d</td><td>自動</td></tr><tr><td>geometry</td><td>自動</td></tr></tbody></table></div></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="geometry"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>geometry — 平面空間データ型。</p></div><div class="refsection"><a name="idp68108360"></a><h2>説明</h2><p>geometryは基礎的なPostGIS空間データ型です。ユークリッド座標系上の地物を表現するために使われます。</p><p>ジオメトリに関する全ての空間演算は、ジオメトリの空間参照系の単位を使います。</p></div><div class="refsection"><a name="idp68110024"></a><h2>キャストの挙動</h2><p>本節では、このデータ型で許容される明示的なキャストと自動キャストの一覧を挙げます。</p><div class="informaltable"><table class="informaltable" border="1"><colgroup><col><col></colgroup><tbody><tr><td>キャスト先</td><td>挙動</td></tr><tr><td>box</td><td>自動</td></tr><tr><td>box2d</td><td>自動</td></tr><tr><td>box3d</td><td>自動</td></tr><tr><td>bytea</td><td>自動</td></tr><tr><td>geography</td><td>自動</td></tr><tr><td>text</td><td>自動</td></tr></tbody></table></div></div><div class="refsection"><a name="idp68120904"></a><h2>関連情報</h2><p><a class="xref" href="#RefObject" title="4.1. GISオブジェクト">「GISオブジェクト」</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="geometry_dump"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>geometry_dump — geom (ジオメトリオブジェクトを保持)とpath[] (ダンプされたオブジェクト内のジオメトリの位置を保持する1次元配列)とからなる二つのフィールドを持つ空間データ型。</p></div><div class="refsection"><a name="idp68123848"></a><h2>説明</h2><p>geometry_dumpは、geomフィールドで参照するジオメトリオブジェクトと1次元整数配列のpath[] (1始まりで、path[1]が最初の要素)からなる複合データ型です。 ST_Dump*関数群に使われます。これらの関数は複雑なジオメトリを複数の要素とその位置に分解します。</p></div><div class="refsection"><a name="idp68125000"></a><h2>関連情報</h2><p><a class="xref" href="#PostGIS_Geometry_DumpFunctions" title="14.6. PostGISジオメトリ/ジオグラフィ/ラスタのダンプ関数">「PostGISジオメトリ/ジオグラフィ/ラスタのダンプ関数」</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="geography"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>geography — 回転楕円体空間データ型。</p></div><div class="refsection"><a name="idp68128072"></a><h2>説明</h2><p>geographyは球面座標系での地物表現に使われる空間データ型です。</p></div><div class="refsection"><a name="idp68129224"></a><h2>キャストの挙動</h2><p>本節では、このデータ型で許容される明示的なキャストと自動キャストの一覧を挙げます。</p><div class="informaltable"><table class="informaltable" border="1"><colgroup><col><col></colgroup><tbody><tr><td>キャスト先</td><td>挙動</td></tr><tr><td>geometry</td><td>明示的なキャスト</td></tr></tbody></table></div></div><div class="refsection"><a name="idp68134344"></a><h2>関連情報</h2><p><a class="xref" href="#PostGIS_GeographyFunctions" title="14.4. PostGISジオグラフィ対応関数">「PostGISジオグラフィ対応関数」</a>, <a class="xref" href="#PostGIS_Geography" title="4.2. PostGISジオグラフィ型">「PostGISジオグラフィ型」</a></p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="PostGIS_GUC"></a>8.2. PostGIS GUC (Grand Unified Custom)変数</h2></div><div><div class="abstract"><p class="title"><b>概要</b></p><p>本節では、PostGIS GUC (Grand Unified Custom)変数の一覧を上げます。これらは、グローバル、データベースごと、セッションごと、またはトランザクションごとに設定できます。グローバルまたはデータベースごとの設定が最善です。</p></div></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#postgis_backend">postgis.backend</a></span><span class="refpurpose"> — GEOSとSFCGALで重複する関数を提供するバックエンドです。GEOSまたはSFCGALを選択します。デフォルトはGEOSです。</span></dt><dt><span class="refentrytitle"><a href="#postgis_gdal_datapath">postgis.gdal_datapath</a></span><span class="refpurpose"> — GDALのGDAL_DATAオプションの値を設定するためのコンフィギュレーションオプションです。設定しない場合には、GDAL_DATA環境変数が使われます。 </span></dt><dt><span class="refentrytitle"><a href="#postgis_gdal_enabled_drivers">postgis.gdal_enabled_drivers</a></span><span class="refpurpose"> — PostGIS環境でGDALドライバを有効にするコンフィギュレーションオプションです。GDALコンフィギュレーション変数GDAL_SKIPに影響を与えます。 </span></dt><dt><span class="refentrytitle"><a href="#postgis_enable_outdb_rasters">postgis.enable_outdb_rasters</a></span><span class="refpurpose"> — データベース外ラスタのバンドにアクセスできるようにする、真偽型のコンフィギュレーションオプション。 </span></dt></dl></div><div class="refentry"><a name="postgis_backend"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>postgis.backend — GEOSとSFCGALで重複する関数を提供するバックエンドです。GEOSまたはSFCGALを選択します。デフォルトはGEOSです。</p></div><div class="refsection"><a name="idp68185672"></a><h2>説明</h2><p>このGUCはSFCGALサポートでPostGISをコンパイルした場合にのみ適切なものとなります。デフォルトでは、<code class="varname">geos</code>バックエンドはGEOSとSFCGALが同じ名前の関数を持つ関数で使われます。この変数によって、SFCGALをリクエストを提供するバックエンドにすることができます。</p><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp68187592"></a><h2>例</h2><p>バックエンドを接続時にだけ設定します。</p><pre class="programlisting">set postgis.backend = sfcgal;</pre><p>データベースへの新規接続にバックエンドを設定します。</p><pre class="programlisting">ALTER DATABASE mygisdb SET postgis.backend = sfcgal;</pre></div><div class="refsection"><a name="idp68190152"></a><h2>関連情報</h2><p><a class="xref" href="#reference_sfcgal" title="8.10. SFCGAL関数">「SFCGAL関数」</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="postgis_gdal_datapath"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>postgis.gdal_datapath — GDALのGDAL_DATAオプションの値を設定するためのコンフィギュレーションオプションです。設定しない場合には、GDAL_DATA環境変数が使われます。 </p></div><div class="refsection"><a name="idp68193096"></a><h2>説明</h2><p>GDALのGDAL_DATAオプションの値の設定に使うPostgreSQL GUC変数です。<code class="varname">postgis.gdal_datapath</code>値は完全にGDALのデータファイルへの物理的なパスになるべきものです。 </p><p>コンフィギュレーションオプションは、GDALのデータファイルパスがハードコーディングされていないWindowsプラットフォームのためにほとんど使われます。このオプションは、GDALのデータファイルがGDALの期待されているパスに無いときに設定します。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>このオプションは、PostgreSQLのコンフィギュレーションファイルpostgresql.confで設定できます。コネクションまたはトランザクションでも設定できます。 </p></td></tr></table></div><p>Availability: 2.2.0</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>GDAL_DATAに関する追加情報報は、GDALの<a class="ulink" href="http://trac.osgeo.org/gdal/wiki/ConfigOptions" target="_top">Configuration Options</a>にあります。 </p></td></tr></table></div></div><div class="refsection"><a name="idp68197448"></a><h2>例</h2><p><code class="varname">postgis.gdal_datapath</code>の設定とリセット。</p><pre class="programlisting">SET postgis.gdal_datapath TO '/usr/local/share/gdal.hidden';
SET postgis.gdal_datapath TO default;
                                </pre><p>Windows上における特定のデータベース上で設定する場合は次の通りです。</p><pre class="programlisting">ALTER DATABASE gisdb
SET postgis.gdal_datapath = 'C:/Program Files/PostgreSQL/9.3/gdal-data';</pre></div><div class="refsection"><a name="idp68200264"></a><h2>関連情報</h2><p><a class="xref" href="#RT_PostGIS_GDAL_Version" title="PostGIS_GDAL_Version">PostGIS_GDAL_Version</a>, <a class="xref" href="#RT_ST_Transform" title="ST_Transform">ST_Transform</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="postgis_gdal_enabled_drivers"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>postgis.gdal_enabled_drivers — PostGIS環境でGDALドライバを有効にするコンフィギュレーションオプションです。GDALコンフィギュレーション変数GDAL_SKIPに影響を与えます。 </p></div><div class="refsection"><a name="idp68203720"></a><h2>説明</h2><p>PostGIS環境でGDALドライバを有効にするコンフィギュレーションオプションです。GDALコンフィギュレーション変数GDAL_SKIPに影響を与えます。このオプションは、PostgreSQLのコンフィギュレーションファイルpostgresql.confで設定できます。コネクションまたはトランザクションでも設定できます。 </p><p><code class="varname">postgis.gdal_enabled_drivers</code>の初期値は、PostgreSQL開始プロセスに渡される、有効とするドライバの一覧からなる環境変数<code class="varname">POSTGIS_GDAL_ENABLED_DRIVERS</code>によって設定されます。 </p><p>有効にするGDALドライバは、ドライバの短縮名またはコードで指定します。ドライバの短縮名またはコードは<a class="ulink" href="http://www.gdal.org/formats_list.html" target="_top">GDAL Raster Formats</a>にあります。複数のドライバを指定するには、ドライバの間に一つの空白を置きます。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">postgis.gdal_enabled_drivers</code>には三つの特別なコードがあります。大文字小文字を区別します。 </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="varname">DISABLE_ALL</code> 全てのGDALドライバを無効にします。これが出現すると、 <code class="varname">postgis.gdal_enabled_drivers</code>にある他の全ての値を上書きします。</p></li><li class="listitem"><p><code class="varname">ENABLE_ALL</code> 全てのGDALドライバを有効にします。</p></li><li class="listitem"><p><code class="varname">VSICURL</code> GDALの仮想ファイルシステム<code class="varname">/vsicurl/</code>を有効にします。</p></li></ul></div><p>
					</p><p><code class="varname">postgis.gdal_enabled_drivers</code>がDISABLE_ALLにっていされると、データベース外ラスタ, ST_FromGDALRaster(), ST_AsGDALRaster(), ST_AsTIFF(), ST_AsJPEG(), ST_AsPNG()を使おうとすると、エラーメッセージが返されます。 </p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>標準的なPostGISのインストールでは、 <code class="varname">postgis.gdal_enabled_drivers</code>はDISALBE_ALLに設定されます。 </p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>GDAL_SKIPに関する追加情報は、GDALの<a class="ulink" href="http://trac.osgeo.org/gdal/wiki/ConfigOptions" target="_top">Configuration Options</a>にあります。 </p></td></tr></table></div><p>Availability: 2.2.0</p></div><div class="refsection"><a name="idp68215752"></a><h2>例</h2><p> <code class="varname">postgis.gdal_enabled_drivers</code>の設定とリセット。</p><p>データベースへの新規接続にバックエンドを設定します。</p><pre class="programlisting">ALTER DATABASE mygisdb SET postgis.gdal_enabled_drivers TO 'GTiff PNG JPEG';</pre><p>サーバへの全ての新規接続のための、有効なドライバのデフォルトを設定します。スーパーユーザ権限とPostgreSQL 9.4以上が必要です。データベース、セッション、ユーザ設定によって上書きされます。</p><pre class="programlisting">ALTER SYSTEM SET postgis.gdal_enabled_drivers TO 'GTiff PNG JPEG';
SELECT pg_reload_conf();
                                </pre><pre class="programlisting">SET postgis.gdal_enabled_drivers TO 'GTiff PNG JPEG';
SET postgis.gdal_enabled_drivers = default;
                                </pre><p>全てのGDALドライバを有効にします。</p><pre class="programlisting">SET postgis.gdal_enabled_drivers = 'ENABLE_ALL';
                                </pre><p>全てのGDALドライバを無効にします。</p><pre class="programlisting">SET postgis.gdal_enabled_drivers = 'DISABLE_ALL';
                                </pre></div><div class="refsection"><a name="idp68221512"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_FromGDALRaster" title="ST_FromGDALRaster">ST_FromGDALRaster</a>, <a class="xref" href="#RT_ST_AsGDALRaster" title="ST_AsGDALRaster">ST_AsGDALRaster</a>, <a class="xref" href="#RT_ST_AsTIFF" title="ST_AsTIFF">ST_AsTIFF</a>, <a class="xref" href="#RT_ST_AsPNG" title="ST_AsPNG">ST_AsPNG</a>, <a class="xref" href="#RT_ST_AsJPEG" title="ST_AsJPEG">ST_AsJPEG</a>, <a class="xref" href="#postgis_enable_outdb_rasters" title="postgis.enable_outdb_rasters">postgis.enable_outdb_rasters</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="postgis_enable_outdb_rasters"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>postgis.enable_outdb_rasters — データベース外ラスタのバンドにアクセスできるようにする、真偽型のコンフィギュレーションオプション。 </p></div><div class="refsection"><a name="idp68242888"></a><h2>説明</h2><p>データベース外ラスタのバンドにアクセスできるようにする、真偽型のコンフィギュレーションオプションです。このオプションは、PostgreSQLのコンフィギュレーションファイルpostgresql.confで設定できます。コネクションまたはトランザクションでも設定できます。 </p><p><code class="varname">postgis.enable_outdb_rasters</code>の初期値は、環境変数<code class="varname">POSTGIS_ENABLE_OUTDB_RASTERS</code>が0でない値で、PostgreSQL開始プロセスに渡されることでで設定されます。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">postgis.enable_outdb_rasters</code>がTrueであってでも、GUC <code class="varname">postgis.enable_outdb_rasters</code>は、アクセス可能なラスタ書式を判定します。 </p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>標準的なPostGISのインストールでは、<code class="varname">postgis.enable_outdb_rasters</code>はFALSEに設定されています。 </p></td></tr></table></div><p>Availability: 2.2.0</p></div><div class="refsection"><a name="idp68248008"></a><h2>例</h2><p><code class="varname">postgis.enable_outdb_rasters</code>の設定とリセット。</p><pre class="programlisting">SET postgis.enable_outdb_rasters TO True;
SET postgis.enable_outdb_rasters = default;
SET postgis.enable_outdb_rasters = True;
SET postgis.enable_outdb_rasters = False;
                                </pre></div><div class="refsection"><a name="idp68249928"></a><h2>関連情報</h2><p>
					<a class="xref" href="#postgis_gdal_enabled_drivers" title="postgis.gdal_enabled_drivers">postgis.gdal_enabled_drivers</a>
				</p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Management_Functions"></a>8.3. 管理関数</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#AddGeometryColumn">AddGeometryColumn</a></span><span class="refpurpose"> — ジオメトリカラムを既存の属性テーブルに追加します。デフォルトでは、制約の定義でなく型の変更を使います。use_typmodにfalseを渡すと制約ベースの古い挙動で動作します。</span></dt><dt><span class="refentrytitle"><a href="#DropGeometryColumn">DropGeometryColumn</a></span><span class="refpurpose"> — ジオメトリカラムを空間テーブルから除去します。</span></dt><dt><span class="refentrytitle"><a href="#DropGeometryTable">DropGeometryTable</a></span><span class="refpurpose"> — テーブルとgeometry_columnsの当該テーブルへの参照の全てを削除します。</span></dt><dt><span class="refentrytitle"><a href="#PostGIS_Extensions_Upgrade">PostGIS_Extensions_Upgrade</a></span><span class="refpurpose"> — インストールされたPostGISエクステンション (例: postgis_sfcgal, postgis_topology, postgis_tiger_geocoder)について、インストールされている最新版にアップグレードします。その後、完全なPostGISの版とビルド時のコンフィギュレーション情報を報告します。</span></dt><dt><span class="refentrytitle"><a href="#PostGIS_Full_Version">PostGIS_Full_Version</a></span><span class="refpurpose"> — 完全なPostGISのバージョン情報とコンフィギュレーション情報を報告します。</span></dt><dt><span class="refentrytitle"><a href="#PostGIS_GEOS_Version">PostGIS_GEOS_Version</a></span><span class="refpurpose"> — GEOSライブラリのバージョン番号を返します。</span></dt><dt><span class="refentrytitle"><a href="#PostGIS_Liblwgeom_Version">PostGIS_Liblwgeom_Version</a></span><span class="refpurpose"> — liblwgeomライブラリの版番号を返します。PostGISの版と同じになるべきものです。</span></dt><dt><span class="refentrytitle"><a href="#PostGIS_LibXML_Version">PostGIS_LibXML_Version</a></span><span class="refpurpose"> — LibXML2ライブラリのバージョン番号を返します。</span></dt><dt><span class="refentrytitle"><a href="#PostGIS_Lib_Build_Date">PostGIS_Lib_Build_Date</a></span><span class="refpurpose"> — PostGISライブラリのビルド日付を返します。</span></dt><dt><span class="refentrytitle"><a href="#PostGIS_Lib_Version">PostGIS_Lib_Version</a></span><span class="refpurpose"> — PostGISのバージョン番号を返します。</span></dt><dt><span class="refentrytitle"><a href="#PostGIS_PROJ_Version">PostGIS_PROJ_Version</a></span><span class="refpurpose"> — PROJ4のバージョン番号を返します。</span></dt><dt><span class="refentrytitle"><a href="#PostGIS_Scripts_Build_Date">PostGIS_Scripts_Build_Date</a></span><span class="refpurpose"> — PostGISスクリプトのビルド日付を返します。</span></dt><dt><span class="refentrytitle"><a href="#PostGIS_Scripts_Installed">PostGIS_Scripts_Installed</a></span><span class="refpurpose"> — このデータベースにインストールしたPostGISスクリプトの版を返します。</span></dt><dt><span class="refentrytitle"><a href="#PostGIS_Scripts_Released">PostGIS_Scripts_Released</a></span><span class="refpurpose"> — インストールしたPostGISライブラリとともにリリースされたpostgis.sqlスクリプトのバージョン番号を返します。</span></dt><dt><span class="refentrytitle"><a href="#PostGIS_Version">PostGIS_Version</a></span><span class="refpurpose"> — PostGISバージョン番号とコンパイルオプションを返します。</span></dt><dt><span class="refentrytitle"><a href="#Populate_Geometry_Columns">Populate_Geometry_Columns</a></span><span class="refpurpose"> — ジオメトリカラムが型修飾子で定義されるか、適切な制約を持つことを確実にします。ジオメトリカラムが<code class="varname">geometry_columns</code>に正しく登録されることを確実にします。デフォルトでは、型修飾子によらないジオメトリカラムを型修飾子によるジオメトリカラムに変換します。以前の挙動にするには<code class="varname">use_typmod=false</code>とします。</span></dt><dt><span class="refentrytitle"><a href="#UpdateGeometrySRID">UpdateGeometrySRID</a></span><span class="refpurpose"> — ジオメトリカラムの全てのフィーチャーのSRID、geometry_columnsメタデータとSRIDテーブル制約を更新します。制約付きの場合には、制約が新しいSRID制約に更新されます。型定義付きの場合は、型定義が変更されます。</span></dt></dl></div><div class="refentry"><a name="AddGeometryColumn"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>AddGeometryColumn — ジオメトリカラムを既存の属性テーブルに追加します。デフォルトでは、制約の定義でなく型の変更を使います。use_typmodにfalseを渡すと制約ベースの古い挙動で動作します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">AddGeometryColumn</b>(</code>varchar  <var class="pdparam">table_name</var>, varchar  <var class="pdparam">column_name</var>, integer  <var class="pdparam">srid</var>, varchar  <var class="pdparam">type</var>, integer  <var class="pdparam">dimension</var>, boolean  <var class="pdparam">use_typmod=true</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">AddGeometryColumn</b>(</code>varchar  <var class="pdparam">schema_name</var>, varchar  <var class="pdparam">table_name</var>, varchar  <var class="pdparam">column_name</var>, integer  <var class="pdparam">srid</var>, varchar  <var class="pdparam">type</var>, integer  <var class="pdparam">dimension</var>, boolean  <var class="pdparam">use_typmod=true</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">AddGeometryColumn</b>(</code>varchar  <var class="pdparam">catalog_name</var>, varchar  <var class="pdparam">schema_name</var>, varchar  <var class="pdparam">table_name</var>, varchar  <var class="pdparam">column_name</var>, integer  <var class="pdparam">srid</var>, varchar  <var class="pdparam">type</var>, integer  <var class="pdparam">dimension</var>, boolean  <var class="pdparam">use_typmod=true</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp68337352"></a><h2>説明</h2><p>ジオメトリカラムを既存の属性テーブルに追加します。<code class="varname">schema_name</code>はスキーマ名です。<code class="varname">srid</code>はSPATIAL_REF_SYSテーブルのエントリを参照する整数でなければなりません。<code class="varname">type</code>は'POLYGON'や'MULTILINESTRING'といった、ジオメトリタイプを示す文字でなければなりません。指定したスキーマが存在しない (または現在のsearch_pathからは見えない)場合、または指定したSRID、ジオメトリタイプもしくは次元が不正である場合はエラーが投げられます。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Changed: 2.0.0 geometry_columnsがシステムカタログを読むビューになったため、geometry_columnsを更新しないようになりました。デフォルトでは制約を生成せず、PostgreSQLの型修飾子を使います。この関数によるWGS 84のPOINTカラムの構築と<code class="code">ALTER TABLE some_table ADD COLUMN geom geometry(Point,4326);</code>とは等価です。 </p><p>Changed: 2.0.0 制約を使う必要がある場合には、<code class="varname">use_typmod</code>をFALSEにします。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Changed: 2.0.0 ビューについては、geometry_columnsへの手動登録はできなくなりました。しかし、typmodテーブルジオメトリに対して構築されていて、かつラッパ関数が無いビューは、親テーブルカラムのtypmodの挙動を継承するので、正しく登録されます。他のジオメトリを出力するジオメトリ関数を使うビューについては、ビューのジオメトリカラムが正しく登録されるようにするため、typmodジオメトリへのキャストが必要です。<a class="xref" href="#Manual_Register_Spatial_Column" title="4.3.4. 手動でジオメトリカラムをgeometry_columnsに登録する">「手動でジオメトリカラムをgeometry_columnsに登録する」</a>を参照して下さい。 </p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a></p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p>Enhanced: 2.0.0 use_typmod引数が導入されました。デフォルトでは制約を基にしたものでなくtypmodジオメトリカラムが生成されます。</p></div><div class="refsection"><a name="idp68371144"></a><h2>例</h2><pre class="programlisting">-- データを保持するスキーマの生成
CREATE SCHEMA my_schema;
-- 新しい単純なPostgreSQLテーブルの生成
CREATE TABLE my_schema.my_spatial_table (id serial);

-- "id"カラムのみを持つ単純なテーブルの説明
postgis=# \d my_schema.my_spatial_table
                                                         Table "my_schema.my_spatial_table"
 Column |  Type   |                                Modifiers
--------+---------+-------------------------------------------------------------------------
 id     | integer | not null default nextval('my_schema.my_spatial_table_id_seq'::regclass)

-- テーブルにジオメトリカラムを追加\
SELECT AddGeometryColumn ('my_schema','my_spatial_table','geom',4326,'POINT',2);

-- 制約を基にした古い方法でPOINTカラムを追加
SELECT AddGeometryColumn ('my_schema','my_spatial_table','geom_c',4326,'POINT',2, false);

-- 制約を基にした古い方法でCURVEPOLYGONカラムを追加
SELECT AddGeometryColumn ('my_schema','my_spatial_table','geomcp_c',4326,'CURVEPOLYGON',2, false);

-- 再度説明を表示し、新しいジオメトリカラムの追加を明らかにする
\d my_schema.my_spatial_table
                            addgeometrycolumn
-------------------------------------------------------------------------
 my_schema.my_spatial_table.geomcp_c SRID:4326 TYPE:CURVEPOLYGON DIMS:2
(1 row)

                                    Table "my_schema.my_spatial_table"
  Column  |         Type         |                                Modifiers
----------+----------------------+-------------------------------------------------------------------------
 id       | integer              | not null default nextval('my_schema.my_spatial_table_id_seq'::regclass)
 geom     | geometry(Point,4326) |
 geom_c   | geometry             |
 geomcp_c | geometry             |
Check constraints:
    "enforce_dims_geom_c" CHECK (st_ndims(geom_c) = 2)
    "enforce_dims_geomcp_c" CHECK (st_ndims(geomcp_c) = 2)
    "enforce_geotype_geom_c" CHECK (geometrytype(geom_c) = 'POINT'::text OR geom_c IS NULL)
    "enforce_geotype_geomcp_c" CHECK (geometrytype(geomcp_c) = 'CURVEPOLYGON'::text OR geomcp_c IS NULL)
    "enforce_srid_geom_c" CHECK (st_srid(geom_c) = 4326)
    "enforce_srid_geomcp_c" CHECK (st_srid(geomcp_c) = 4326)

-- geometry_columnsビューにも新しいカラムが登録されています --
SELECT f_geometry_column As col_name, type, srid, coord_dimension As ndims
    FROM geometry_columns
    WHERE f_table_name = 'my_spatial_table' AND f_table_schema = 'my_schema';

 col_name |     type     | srid | ndims
----------+--------------+------+-------
 geom     | Point        | 4326 |     2
 geom_c   | Point        | 4326 |     2
 geomcp_c | CurvePolygon | 4326 |     2
</pre></div><div class="refsection"><a name="idp68372424"></a><h2>関連情報</h2><p><a class="xref" href="#DropGeometryColumn" title="DropGeometryColumn">DropGeometryColumn</a>, <a class="xref" href="#DropGeometryTable" title="DropGeometryTable">DropGeometryTable</a>, <a class="xref" href="#geometry_columns" title="4.3.2. GEOMETRY_COLUMNSビュー">「GEOMETRY_COLUMNSビュー」</a>, <a class="xref" href="#Manual_Register_Spatial_Column" title="4.3.4. 手動でジオメトリカラムをgeometry_columnsに登録する">「手動でジオメトリカラムをgeometry_columnsに登録する」</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="DropGeometryColumn"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>DropGeometryColumn — ジオメトリカラムを空間テーブルから除去します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">DropGeometryColumn</b>(</code>varchar  <var class="pdparam">table_name</var>, varchar  <var class="pdparam">column_name</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">DropGeometryColumn</b>(</code>varchar  <var class="pdparam">schema_name</var>, varchar  <var class="pdparam">table_name</var>, varchar  <var class="pdparam">column_name</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">DropGeometryColumn</b>(</code>varchar  <var class="pdparam">catalog_name</var>, varchar  <var class="pdparam">schema_name</var>, varchar  <var class="pdparam">table_name</var>, varchar  <var class="pdparam">column_name</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp68398024"></a><h2>説明</h2><p>ジオメトリカラムを空間テーブルから除去します。schema_nameはgeometry_columnsテーブルの該当行のf_table_schemaフィールドと一致しなければならないことにご注意ください。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a></p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Changed: 2.0.0 この関数は後方互換のためのものです。geometry_columnsは現在はシステムカタログに対するビューですので、他のテーブルのカラムと同じように<code class="code">ALTER TABLE</code>を使った削除が可能です。</p></td></tr></table></div></div><div class="refsection"><a name="idp68408520"></a><h2>例</h2><pre class="programlisting">SELECT DropGeometryColumn ('my_schema','my_spatial_table','geom');
                        ---- 結果出力 ----
                                          dropgeometrycolumn
------------------------------------------------------
 my_schema.my_spatial_table.geom effectively removed.

-- PostGIS 2.0以上では標準的なALTER TABLEと上の例とは等価です
-- 両方ともgeometry_columnsの登録を抹消します
ALTER TABLE my_schema.my_spatial_table DROP column geom;
                </pre></div><div class="refsection"><a name="idp68409800"></a><h2>関連情報</h2><p><a class="xref" href="#AddGeometryColumn" title="AddGeometryColumn">AddGeometryColumn</a>, <a class="xref" href="#DropGeometryTable" title="DropGeometryTable">DropGeometryTable</a>, <a class="xref" href="#geometry_columns" title="4.3.2. GEOMETRY_COLUMNSビュー">「GEOMETRY_COLUMNSビュー」</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="DropGeometryTable"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>DropGeometryTable — テーブルとgeometry_columnsの当該テーブルへの参照の全てを削除します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">DropGeometryTable</b>(</code>varchar  <var class="pdparam">table_name</var><code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">DropGeometryTable</b>(</code>varchar  <var class="pdparam">schema_name</var>, varchar  <var class="pdparam">table_name</var><code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">DropGeometryTable</b>(</code>varchar  <var class="pdparam">catalog_name</var>, varchar  <var class="pdparam">schema_name</var>, varchar  <var class="pdparam">table_name</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp68423752"></a><h2>説明</h2><p>テーブルとgeometry_columnsの当該テーブルへの参照の全てを削除します。スキーマ対応版PostgreSQLではスキーマが与えられない場合はcurrent_schema()を使います。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Changed: 2.0.0で この関数は後方互換のためのものです。geometry_columnsは現在はシステムカタログに対するビューですので、他のテーブルのカラムと同じように<code class="code">DROP TABLE</code>を使った削除が可能です。</p></td></tr></table></div></div><div class="refsection"><a name="idp68426056"></a><h2>例</h2><pre class="programlisting">SELECT DropGeometryTable ('my_schema','my_spatial_table');
---- 結果出力 ----
my_schema.my_spatial_table dropped.

-- 上の例は次の例と等価です --
DROP TABLE my_schema.my_spatial_table;
                </pre></div><div class="refsection"><a name="idp68427336"></a><h2>関連情報</h2><p><a class="xref" href="#AddGeometryColumn" title="AddGeometryColumn">AddGeometryColumn</a>, <a class="xref" href="#DropGeometryColumn" title="DropGeometryColumn">DropGeometryColumn</a>, <a class="xref" href="#geometry_columns" title="4.3.2. GEOMETRY_COLUMNSビュー">「GEOMETRY_COLUMNSビュー」</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="PostGIS_Extensions_Upgrade"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>PostGIS_Extensions_Upgrade — インストールされたPostGISエクステンション (例: postgis_sfcgal, postgis_topology, postgis_tiger_geocoder)について、インストールされている最新版にアップグレードします。その後、完全なPostGISの版とビルド時のコンフィギュレーション情報を報告します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">PostGIS_Extensions_Upgrade</b>(</code><code>)</code>;</p></div></div><div class="refsection"><a name="idp68433096"></a><h2>説明</h2><p>インストールされたPostGISエクステンションについて、インストールされている最新版にアップグレードします。データベースにインストールされているエクステンションだけがアップグレードされます。既に最新版がインストールされているなら、アップグレードされません。その後、完全なPostGISの版とビルド時のコンフィギュレーション情報を報告します。これは、各エクステンションに施すALTER EXTENSIONとUPDATEの省略版です。現在のところ、アップグレードを試みるエクステンションは、postgis, postgis_sfcgal, postgis_topologyおよびpostgis_tiger_geocoderです。</p><p>Availability: 2.5.0</p></div><div class="refsection"><a name="idp68434632"></a><h2>例</h2><pre class="programlisting">SELECT PostGIS_Extensions_Upgrade();</pre><pre class="screen">NOTICE:  ALTER EXTENSION postgis_tiger_geocoder UPDATE TO "2.5.0dev";
CONTEXT:  PL/pgSQL function postgis_extensions_upgrade() line 10 at RAISE
NOTICE:  ALTER EXTENSION postgis_topology UPDATE TO "2.5.0dev";
CONTEXT:  PL/pgSQL function postgis_extensions_upgrade() line 10 at RAISE

                                                           postgis_extensions_upgrade
----------------------------------------------------------------------------------
POSTGIS="2.5.0dev r15966" [EXTENSION] PGSQL="100"
GEOS="3.7.0dev-CAPI-1.11.0 8fe2ce6" SFCGAL="1.3.1"
PROJ="Rel. 4.9.3, 15 August 2016" GDAL="GDAL 2.2.2, released 2017/09/15"
LIBXML="2.7.8" LIBJSON="0.12" LIBPROTOBUF="1.2.1" TOPOLOGY RASTER
(1 row)</pre></div><div class="refsection"><a name="idp68436424"></a><h2>関連情報</h2><p><a class="xref" href="#upgrading" title="2.10. アップグレード">「アップグレード」</a>, <a class="xref" href="#PostGIS_GEOS_Version" title="PostGIS_GEOS_Version">PostGIS_GEOS_Version</a>, <a class="xref" href="#PostGIS_Lib_Version" title="PostGIS_Lib_Version">PostGIS_Lib_Version</a>, <a class="xref" href="#PostGIS_LibXML_Version" title="PostGIS_LibXML_Version">PostGIS_LibXML_Version</a>, <a class="xref" href="#PostGIS_PROJ_Version" title="PostGIS_PROJ_Version">PostGIS_PROJ_Version</a>, <a class="xref" href="#PostGIS_Version" title="PostGIS_Version">PostGIS_Version</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="PostGIS_Full_Version"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>PostGIS_Full_Version — 完全なPostGISのバージョン情報とコンフィギュレーション情報を報告します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">PostGIS_Full_Version</b>(</code><code>)</code>;</p></div></div><div class="refsection"><a name="idp68443464"></a><h2>説明</h2><p>完全なPostGISのバージョン情報とコンフィギュレーション情報を報告します。ライブラリとスクリプトとの間の同期について情報を提供して、必要に応じてアップグレードの提案に関する情報を提供します。</p></div><div class="refsection"><a name="idp68444616"></a><h2>例</h2><pre class="programlisting">SELECT PostGIS_Full_Version();
                                                           postgis_full_version
----------------------------------------------------------------------------------
POSTGIS="2.2.0dev r12699" GEOS="3.5.0dev-CAPI-1.9.0 r3989" SFCGAL="1.0.4" PROJ="Rel. 4.8.0, 6 March 2012"
GDAL="GDAL 1.11.0, released 2014/04/16" LIBXML="2.7.8" LIBJSON="0.12" RASTER
(1 row)</pre></div><div class="refsection"><a name="idp68445896"></a><h2>関連情報</h2><p><a class="xref" href="#upgrading" title="2.10. アップグレード">「アップグレード」</a>, <a class="xref" href="#PostGIS_GEOS_Version" title="PostGIS_GEOS_Version">PostGIS_GEOS_Version</a>, <a class="xref" href="#PostGIS_Lib_Version" title="PostGIS_Lib_Version">PostGIS_Lib_Version</a>, <a class="xref" href="#PostGIS_LibXML_Version" title="PostGIS_LibXML_Version">PostGIS_LibXML_Version</a>, <a class="xref" href="#PostGIS_PROJ_Version" title="PostGIS_PROJ_Version">PostGIS_PROJ_Version</a>, <a class="xref" href="#PostGIS_Version" title="PostGIS_Version">PostGIS_Version</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="PostGIS_GEOS_Version"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>PostGIS_GEOS_Version — GEOSライブラリのバージョン番号を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">PostGIS_GEOS_Version</b>(</code><code>)</code>;</p></div></div><div class="refsection"><a name="idp68457160"></a><h2>説明</h2><p>GEOSライブラリのバージョン番号を返します。GEOS対応が有効でない場合は<code class="varname">NULL</code>を返します。</p></div><div class="refsection"><a name="idp68458696"></a><h2>例</h2><pre class="programlisting">SELECT PostGIS_GEOS_Version();
 postgis_geos_version
----------------------
 3.1.0-CAPI-1.5.0
(1 row)</pre></div><div class="refsection"><a name="idp68459976"></a><h2>関連情報</h2><p><a class="xref" href="#PostGIS_Full_Version" title="PostGIS_Full_Version">PostGIS_Full_Version</a>, <a class="xref" href="#PostGIS_Lib_Version" title="PostGIS_Lib_Version">PostGIS_Lib_Version</a>, <a class="xref" href="#PostGIS_LibXML_Version" title="PostGIS_LibXML_Version">PostGIS_LibXML_Version</a>, <a class="xref" href="#PostGIS_PROJ_Version" title="PostGIS_PROJ_Version">PostGIS_PROJ_Version</a>, <a class="xref" href="#PostGIS_Version" title="PostGIS_Version">PostGIS_Version</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="PostGIS_Liblwgeom_Version"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>PostGIS_Liblwgeom_Version — liblwgeomライブラリの版番号を返します。PostGISの版と同じになるべきものです。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">PostGIS_Liblwgeom_Version</b>(</code><code>)</code>;</p></div></div><div class="refsection"><a name="idp68466504"></a><h2>説明</h2><p>liblwgeomライブラリの版番号を返します。</p></div><div class="refsection"><a name="idp68467656"></a><h2>例</h2><pre class="programlisting">SELECT PostGIS_Liblwgeom_Version();
postgis_liblwgeom_version
--------------------------
2.3.3 r15473
(1 row)</pre></div><div class="refsection"><a name="idp68468936"></a><h2>関連情報</h2><p><a class="xref" href="#PostGIS_Full_Version" title="PostGIS_Full_Version">PostGIS_Full_Version</a>, <a class="xref" href="#PostGIS_Lib_Version" title="PostGIS_Lib_Version">PostGIS_Lib_Version</a>, <a class="xref" href="#PostGIS_LibXML_Version" title="PostGIS_LibXML_Version">PostGIS_LibXML_Version</a>, <a class="xref" href="#PostGIS_PROJ_Version" title="PostGIS_PROJ_Version">PostGIS_PROJ_Version</a>, <a class="xref" href="#PostGIS_Version" title="PostGIS_Version">PostGIS_Version</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="PostGIS_LibXML_Version"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>PostGIS_LibXML_Version — LibXML2ライブラリのバージョン番号を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">PostGIS_LibXML_Version</b>(</code><code>)</code>;</p></div></div><div class="refsection"><a name="idp68475464"></a><h2>説明</h2><p>LibXML2ライブラリのバージョン番号を返します。</p><p>Availability: 1.5</p></div><div class="refsection"><a name="idp68477000"></a><h2>例</h2><pre class="programlisting">SELECT PostGIS_LibXML_Version();
 postgis_libxml_version
----------------------
 2.7.6
(1 row)</pre></div><div class="refsection"><a name="idp68478280"></a><h2>関連情報</h2><p><a class="xref" href="#PostGIS_Full_Version" title="PostGIS_Full_Version">PostGIS_Full_Version</a>, <a class="xref" href="#PostGIS_Lib_Version" title="PostGIS_Lib_Version">PostGIS_Lib_Version</a>, <a class="xref" href="#PostGIS_PROJ_Version" title="PostGIS_PROJ_Version">PostGIS_PROJ_Version</a>, <a class="xref" href="#PostGIS_GEOS_Version" title="PostGIS_GEOS_Version">PostGIS_GEOS_Version</a>, <a class="xref" href="#PostGIS_Version" title="PostGIS_Version">PostGIS_Version</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="PostGIS_Lib_Build_Date"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>PostGIS_Lib_Build_Date — PostGISライブラリのビルド日付を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">PostGIS_Lib_Build_Date</b>(</code><code>)</code>;</p></div></div><div class="refsection"><a name="idp68484936"></a><h2>説明</h2><p>PostGISライブラリのビルド日付を返します。</p></div><div class="refsection"><a name="idp68486216"></a><h2>例</h2><pre class="programlisting">SELECT PostGIS_Lib_Build_Date();
 postgis_lib_build_date
------------------------
 2008-06-21 17:53:21
(1 row)</pre></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="PostGIS_Lib_Version"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>PostGIS_Lib_Version — PostGISのバージョン番号を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">PostGIS_Lib_Version</b>(</code><code>)</code>;</p></div></div><div class="refsection"><a name="idp68491208"></a><h2>説明</h2><p>PostGISのバージョン番号を返します。</p></div><div class="refsection"><a name="idp68492360"></a><h2>例</h2><pre class="programlisting">SELECT PostGIS_Lib_Version();
 postgis_lib_version
---------------------
 1.3.3
(1 row)</pre></div><div class="refsection"><a name="idp68493640"></a><h2>関連情報</h2><p><a class="xref" href="#PostGIS_Full_Version" title="PostGIS_Full_Version">PostGIS_Full_Version</a>, <a class="xref" href="#PostGIS_GEOS_Version" title="PostGIS_GEOS_Version">PostGIS_GEOS_Version</a>, <a class="xref" href="#PostGIS_LibXML_Version" title="PostGIS_LibXML_Version">PostGIS_LibXML_Version</a>, <a class="xref" href="#PostGIS_PROJ_Version" title="PostGIS_PROJ_Version">PostGIS_PROJ_Version</a>, <a class="xref" href="#PostGIS_Version" title="PostGIS_Version">PostGIS_Version</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="PostGIS_PROJ_Version"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>PostGIS_PROJ_Version — PROJ4のバージョン番号を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">PostGIS_PROJ_Version</b>(</code><code>)</code>;</p></div></div><div class="refsection"><a name="idp68500168"></a><h2>説明</h2><p>PROJ4のバージョン番号を返します。PROJ4対応が有効でない場合は<code class="varname">NULL</code>を返します。</p></div><div class="refsection"><a name="idp68501704"></a><h2>例</h2><pre class="programlisting">SELECT PostGIS_PROJ_Version();
  postgis_proj_version
-------------------------
 Rel. 4.4.9, 29 Oct 2004
(1 row)</pre></div><div class="refsection"><a name="idp68503112"></a><h2>関連情報</h2><p><a class="xref" href="#PostGIS_Full_Version" title="PostGIS_Full_Version">PostGIS_Full_Version</a>, <a class="xref" href="#PostGIS_GEOS_Version" title="PostGIS_GEOS_Version">PostGIS_GEOS_Version</a>, <a class="xref" href="#PostGIS_Lib_Version" title="PostGIS_Lib_Version">PostGIS_Lib_Version</a>, <a class="xref" href="#PostGIS_LibXML_Version" title="PostGIS_LibXML_Version">PostGIS_LibXML_Version</a>, <a class="xref" href="#PostGIS_Version" title="PostGIS_Version">PostGIS_Version</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="PostGIS_Scripts_Build_Date"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>PostGIS_Scripts_Build_Date — PostGISスクリプトのビルド日付を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">PostGIS_Scripts_Build_Date</b>(</code><code>)</code>;</p></div></div><div class="refsection"><a name="idp68509768"></a><h2>説明</h2><p>PostGISスクリプトのビルド日付を返します。</p><p>Availability: 1.0.0RC1</p></div><div class="refsection"><a name="idp68511432"></a><h2>例</h2><pre class="programlisting">SELECT PostGIS_Scripts_Build_Date();
  postgis_scripts_build_date
-------------------------
 2007-08-18 09:09:26
(1 row)</pre></div><div class="refsection"><a name="idp68512840"></a><h2>関連情報</h2><p><a class="xref" href="#PostGIS_Full_Version" title="PostGIS_Full_Version">PostGIS_Full_Version</a>, <a class="xref" href="#PostGIS_GEOS_Version" title="PostGIS_GEOS_Version">PostGIS_GEOS_Version</a>, <a class="xref" href="#PostGIS_Lib_Version" title="PostGIS_Lib_Version">PostGIS_Lib_Version</a>, <a class="xref" href="#PostGIS_LibXML_Version" title="PostGIS_LibXML_Version">PostGIS_LibXML_Version</a>, <a class="xref" href="#PostGIS_Version" title="PostGIS_Version">PostGIS_Version</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="PostGIS_Scripts_Installed"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>PostGIS_Scripts_Installed — このデータベースにインストールしたPostGISスクリプトの版を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">PostGIS_Scripts_Installed</b>(</code><code>)</code>;</p></div></div><div class="refsection"><a name="idp68519368"></a><h2>説明</h2><p>このデータベースにインストールしたPostGISスクリプトの版を返します。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数の出力と<a class="xref" href="#PostGIS_Scripts_Released" title="PostGIS_Scripts_Released">PostGIS_Scripts_Released</a>とが合わない場合、既存のデータベースの確実なアップグレードに失敗しているかも知れません。詳細情報については<a class="link" href="#upgrading" title="2.10. アップグレード">Upgrading</a>をご覧ください。</p></td></tr></table></div><p>Availability: 0.9.0</p></div><div class="refsection"><a name="idp68522568"></a><h2>例</h2><pre class="programlisting">SELECT PostGIS_Scripts_Installed();
  postgis_scripts_installed
-------------------------
 1.5.0SVN
(1 row)</pre></div><div class="refsection"><a name="idp68523848"></a><h2>関連情報</h2><p><a class="xref" href="#PostGIS_Full_Version" title="PostGIS_Full_Version">PostGIS_Full_Version</a>, <a class="xref" href="#PostGIS_Scripts_Released" title="PostGIS_Scripts_Released">PostGIS_Scripts_Released</a>, <a class="xref" href="#PostGIS_Version" title="PostGIS_Version">PostGIS_Version</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="PostGIS_Scripts_Released"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>PostGIS_Scripts_Released — インストールしたPostGISライブラリとともにリリースされたpostgis.sqlスクリプトのバージョン番号を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">PostGIS_Scripts_Released</b>(</code><code>)</code>;</p></div></div><div class="refsection"><a name="idp68541896"></a><h2>説明</h2><p>インストールしたPostGISライブラリとともにリリースされたpostgis.sqlスクリプトのバージョン番号を返します。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>1.1.0からこの関数は<a class="xref" href="#PostGIS_Lib_Version" title="PostGIS_Lib_Version">PostGIS_Lib_Version</a>と同じ値を返すようになりました。後方互換のためです。</p></td></tr></table></div><p>Availability: 0.9.0</p></div><div class="refsection"><a name="idp68544584"></a><h2>例</h2><pre class="programlisting">SELECT PostGIS_Scripts_Released();
  postgis_scripts_released
-------------------------
 1.3.4SVN
(1 row)</pre></div><div class="refsection"><a name="idp68545864"></a><h2>関連情報</h2><p><a class="xref" href="#PostGIS_Full_Version" title="PostGIS_Full_Version">PostGIS_Full_Version</a>, <a class="xref" href="#PostGIS_Scripts_Installed" title="PostGIS_Scripts_Installed">PostGIS_Scripts_Installed</a>, <a class="xref" href="#PostGIS_Lib_Version" title="PostGIS_Lib_Version">PostGIS_Lib_Version</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="PostGIS_Version"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>PostGIS_Version — PostGISバージョン番号とコンパイルオプションを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">PostGIS_Version</b>(</code><code>)</code>;</p></div></div><div class="refsection"><a name="idp68551624"></a><h2>説明</h2><p>PostGISバージョン番号とコンパイルオプションを返します。</p></div><div class="refsection"><a name="idp68552776"></a><h2>例</h2><pre class="programlisting">SELECT PostGIS_Version();
                        postgis_version
---------------------------------------
 1.3 USE_GEOS=1 USE_PROJ=1 USE_STATS=1
(1 row)</pre></div><div class="refsection"><a name="idp68554056"></a><h2>関連情報</h2><p><a class="xref" href="#PostGIS_Full_Version" title="PostGIS_Full_Version">PostGIS_Full_Version</a>, <a class="xref" href="#PostGIS_GEOS_Version" title="PostGIS_GEOS_Version">PostGIS_GEOS_Version</a>, <a class="xref" href="#PostGIS_Lib_Version" title="PostGIS_Lib_Version">PostGIS_Lib_Version</a>, <a class="xref" href="#PostGIS_LibXML_Version" title="PostGIS_LibXML_Version">PostGIS_LibXML_Version</a>, <a class="xref" href="#PostGIS_PROJ_Version" title="PostGIS_PROJ_Version">PostGIS_PROJ_Version</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="Populate_Geometry_Columns"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Populate_Geometry_Columns — ジオメトリカラムが型修飾子で定義されるか、適切な制約を持つことを確実にします。ジオメトリカラムが<code class="varname">geometry_columns</code>に正しく登録されることを確実にします。デフォルトでは、型修飾子によらないジオメトリカラムを型修飾子によるジオメトリカラムに変換します。以前の挙動にするには<code class="varname">use_typmod=false</code>とします。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">Populate_Geometry_Columns</b>(</code>boolean  <var class="pdparam">use_typmod=true</var><code>)</code>;</p><p><code class="funcdef">int <b class="fsfunc">Populate_Geometry_Columns</b>(</code>oid <var class="pdparam">relation_oid</var>, boolean  <var class="pdparam">use_typmod=true</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp68565320"></a><h2>説明</h2><p>ジオメトリカラムが<code class="varname">geometry_columns</code>に正しく登録されるために、ジオメトリカラムが型修飾子で定義されるか、適切な制約を持つことを確実にします。</p><p>後方互換のためと、それぞれの子テーブルが異なるジオメトリタイプを持つテーブル継承といった空間テーブルにとって必要があるためとの二つの理由から、古いCHECK制約の挙動がなお有効になっています。古い挙動が必要な場合には、新しいオプション引数で<code class="varname">use_typmod=false</code>を渡す必要があります。これが実行されると、型修飾子なしのジオメトリカラムが生成され、三つの制約が定義されます。特に、これは、テーブルに属するすべてのジオメトリカラムが少なくとも三つの制約を持つことを意味します。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="varname">enforce_dims_the_geom</code> - あらゆるジオメトリが同じ次元を持つことを確実にします (<a class="xref" href="#ST_NDims" title="ST_NDims">ST_NDims</a>をご覧下さい)</p></li><li class="listitem"><p><code class="varname">enforce_geotype_the_geom</code> - あらゆるジオメトリが同じ型を持つことを確実にします (<a class="xref" href="#GeometryType" title="GeometryType">GeometryType</a>をご覧下さい)</p></li><li class="listitem"><p><code class="varname">enforce_srid_the_geom</code> - あらゆるジオメトリが同じ投影法になることを確実にします (<a class="xref" href="#ST_SRID" title="ST_SRID">ST_SRID</a>をご覧下さい)</p></li></ul></div><p>テーブルに<code class="varname">oid</code>がある場合には、この関数はテーブルのジオメトリカラム全てについて、SRIDと次元とジオメトリタイプを判定して、必要に応じて制約を追加しようとします。 成功した場合には、<code class="varname">geometry_columns</code>に適切な行が追加され、その他の場合には、例外が捕まえられ、問題を記述したエラーが通知されます。</p><p>ビューの<code class="varname">oid</code>がある場合、テーブルの場合と同じで、SIRDと次元とジオメトリタイプを判定して、適切なエントリを<code class="varname">geometry_columns</code>テーブルに挿入しますが、制約の追加はされません。</p><p>パラメタの無い形式は、<code class="varname">geometry_columns</code>の行を削除したうえで、全ての空間テーブルと空間ビューについて再挿入し、適切な空間制約をテーブルに追加する、パラメタ付きの形式の単純なラッパです。パラメタが無い形式は、検出したジオメトリカラムの数の要約と<code class="varname">geometry_columns</code>に挿入された行の数とを返します。パラメタ付きの形式は単純に<code class="varname">geometry_columns</code>に挿入された行の数を返します。</p><p>Availability: 1.4.0</p><p>Changed: 2.0.0 デフォルトでは、ジオメトリタイプの制限について、制約を確認する代わりに型修飾子を使います。新しい<code class="varname">use_typmod</code>をFALSEに設定して使うことで、制約確認を使用することができます。</p><p>Enhanced: 2.0.0 <code class="varname">use_typmod</code>任意引数が導入されました。カラムが型修飾子で生成されるか制約チェックで作られるかの制御ができます。</p></div><div class="refsection"><a name="idp68582088"></a><h2>例</h2><pre class="programlisting">CREATE TABLE public.myspatial_table(gid serial, geom geometry);
INSERT INTO myspatial_table(geom) VALUES(ST_GeomFromText('LINESTRING(1 2, 3 4)',4326) );
-- 型修飾子を使います
-- 動作するにはデータが存在していなければなりません
SELECT Populate_Geometry_Columns('public.myspatial_table'::regclass);

populate_geometry_columns
--------------------------
                        1


\d myspatial_table

                                   Table "public.myspatial_table"
 Column |           Type            |                           Modifiers
--------+---------------------------+---------------------------------------------------------------
 gid    | integer                   | not null default nextval('myspatial_table_gid_seq'::regclass)
 geom   | geometry(LineString,4326) |
</pre><pre class="programlisting">-- カラムが型修飾子でないか、既に制約が存在している場合には制約を使います
-- 動作するにはデータが存在していなければなりません
CREATE TABLE public.myspatial_table_cs(gid serial, geom geometry);
INSERT INTO myspatial_table_cs(geom) VALUES(ST_GeomFromText('LINESTRING(1 2, 3 4)',4326) );
SELECT Populate_Geometry_Columns('public.myspatial_table_cs'::regclass, false);
populate_geometry_columns
--------------------------
                        1
\d myspatial_table_cs

                          Table "public.myspatial_table_cs"
 Column |   Type   |                            Modifiers
--------+----------+------------------------------------------------------------------
 gid    | integer  | not null default nextval('myspatial_table_cs_gid_seq'::regclass)
 geom   | geometry |
Check constraints:
    "enforce_dims_geom" CHECK (st_ndims(geom) = 2)
    "enforce_geotype_geom" CHECK (geometrytype(geom) = 'LINESTRING'::text OR geom IS NULL)
    "enforce_srid_geom" CHECK (st_srid(geom) = 4326)</pre></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="UpdateGeometrySRID"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>UpdateGeometrySRID — ジオメトリカラムの全てのフィーチャーのSRID、geometry_columnsメタデータとSRIDテーブル制約を更新します。制約付きの場合には、制約が新しいSRID制約に更新されます。型定義付きの場合は、型定義が変更されます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">UpdateGeometrySRID</b>(</code>varchar  <var class="pdparam">table_name</var>, varchar  <var class="pdparam">column_name</var>, integer  <var class="pdparam">srid</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">UpdateGeometrySRID</b>(</code>varchar  <var class="pdparam">schema_name</var>, varchar  <var class="pdparam">table_name</var>, varchar  <var class="pdparam">column_name</var>, integer  <var class="pdparam">srid</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">UpdateGeometrySRID</b>(</code>varchar  <var class="pdparam">catalog_name</var>, varchar  <var class="pdparam">schema_name</var>, varchar  <var class="pdparam">table_name</var>, varchar  <var class="pdparam">column_name</var>, integer  <var class="pdparam">srid</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp68602312"></a><h2>説明</h2><p>ジオメトリカラムの全てのフィーチャーのSRID、geometry_columnsメタデータとSRIDテーブル制約を更新します。スキーマ対応版pgsqlでは、スキーマが提供されていない場合には、この関数はcurrent_schema()を使うことにご注意下さい。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p></div><div class="refsection"><a name="idp68606024"></a><h2>例</h2><p>この関数は、以前のSRIDに関係なく、道路テーブルのSRIDを4326に変更します。</p><pre class="programlisting">SELECT UpdateGeometrySRID('roads','geom',4326);</pre><p>上述の例と、このDDL手続き (訳注: DDLはData Definition Languageの略で、データ構造の操作を行う言語を指し、この場合は CREATE TABLEやALTER TABLE等が該当します)とは同じです。</p><pre class="programlisting">ALTER TABLE roads
  ALTER COLUMN geom TYPE geometry(MULTILINESTRING, 4326)
    USING ST_SetSRID(geom,4326);</pre><p>ロードデータの変換座標系が誤りである (またはunknownになっている)けれどもWebメルカトルに一度の処理で変換したい場合、DDLで実行可能ですが、PostGIS管理関数では一度の処理ですむ等価なものはありません。</p><pre class="programlisting">ALTER TABLE roads
 ALTER COLUMN geom TYPE geometry(MULTILINESTRING, 3857) USING ST_Transform(ST_SetSRID(geom,4326),3857) ;</pre></div><div class="refsection"><a name="idp68609608"></a><h2>関連情報</h2><p><a class="xref" href="#RT_UpdateRasterSRID" title="UpdateRasterSRID">UpdateRasterSRID</a>, <a class="xref" href="#ST_SetSRID" title="ST_SetSRID">ST_SetSRID</a>, <a class="xref" href="#ST_Transform" title="ST_Transform">ST_Transform</a> </p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Geometry_Constructors"></a>8.4. ジオメトリ コンストラクタ</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#ST_BdPolyFromText">ST_BdPolyFromText</a></span><span class="refpurpose"> — マルチラインストリングのWell-Known Text表現による、閉じたラインストリングの任意のコレクションからポリゴンを生成します。</span></dt><dt><span class="refentrytitle"><a href="#ST_BdMPolyFromText">ST_BdMPolyFromText</a></span><span class="refpurpose"> — マルチラインストリングのWell-Known Text表現による、閉じたラインストリングの任意のコレクションからマルチポリゴンを構築します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Box2dFromGeoHash">ST_Box2dFromGeoHash</a></span><span class="refpurpose"> — GeoHash文字列からBOX2Dを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_GeogFromText">ST_GeogFromText</a></span><span class="refpurpose"> — Well-Known Text表現または拡張WKTから指定したジオグラフィ値を返します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_GeographyFromText">ST_GeographyFromText</a></span><span class="refpurpose"> — Well-Known Text表現または拡張WKTから指定したジオグラフィ値を返します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_GeogFromWKB">ST_GeogFromWKB</a></span><span class="refpurpose"> — Well-Known Binaryジオメトリ表現(WKB)または拡張WKB(EWKB)からジオグラフィインスタンスを生成します。</span></dt><dt><span class="refentrytitle"><a href="#ST_GeomFromTWKB">ST_GeomFromTWKB</a></span><span class="refpurpose"> — TWKB ("Tiny Well-Known Binary")ジオメトリ表現からジオメトリインスタンスを生成します。</span></dt><dt><span class="refentrytitle"><a href="#ST_GeomCollFromText">ST_GeomCollFromText</a></span><span class="refpurpose"> — WKT表現と与えられたSRIDからジオメトリのコレクションを生成します。SRIDが与えられていない場合は0とします。</span></dt><dt><span class="refentrytitle"><a href="#ST_GeomFromEWKB">ST_GeomFromEWKB</a></span><span class="refpurpose"> — 拡張Well-Known Binary表現 (EWKB)から指定したST_Geometry値を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_GeomFromEWKT">ST_GeomFromEWKT</a></span><span class="refpurpose"> — 拡張Well-Known Text表現 (EWKT)から指定されたST_Geometry値を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_GeometryFromText">ST_GeometryFromText</a></span><span class="refpurpose"> — Well-Knwon Text表現 (WKT)から指定したST_Geometry値を返します。これはST_GeomFromTextの別名です。</span></dt><dt><span class="refentrytitle"><a href="#ST_GeomFromGeoHash">ST_GeomFromGeoHash</a></span><span class="refpurpose"> — GeoHash文字列からジオメトリを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_GeomFromGML">ST_GeomFromGML</a></span><span class="refpurpose"> — GML表現からPostGISジオメトリオブジェクトを出力します。</span></dt><dt><span class="refentrytitle"><a href="#ST_GeomFromGeoJSON">ST_GeomFromGeoJSON</a></span><span class="refpurpose"> — ジオメトリのGeoJSON表現を入力として、PostGISジオメトリオブジェクトを出力します。</span></dt><dt><span class="refentrytitle"><a href="#ST_GeomFromKML">ST_GeomFromKML</a></span><span class="refpurpose"> — ジオメトリのKML表現の入力をとり、PostGISジオメトリオブジェクトを出力します。</span></dt><dt><span class="refentrytitle"><a href="#ST_GMLToSQL">ST_GMLToSQL</a></span><span class="refpurpose"> — GML表現から指定したST_Geometry値を返します。これはST_GeomFromGMLの別名です。</span></dt><dt><span class="refentrytitle"><a href="#ST_GeomFromText">ST_GeomFromText</a></span><span class="refpurpose"> — Well-Known Text表現 (WKT)から指定したST_Geometryを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_GeomFromWKB">ST_GeomFromWKB</a></span><span class="refpurpose"> — Well-Knwon Binaryジオメトリ表現 (WKB)と任意パラメタのSRIDからジオメトリインスタンスを生成します。</span></dt><dt><span class="refentrytitle"><a href="#ST_LineFromEncodedPolyline">ST_LineFromEncodedPolyline</a></span><span class="refpurpose"> — エンコード化ポリラインからラインストリングを生成します。</span></dt><dt><span class="refentrytitle"><a href="#ST_LineFromMultiPoint">ST_LineFromMultiPoint</a></span><span class="refpurpose"> — マルチポイントジオメトリからラインストリングを生成します。</span></dt><dt><span class="refentrytitle"><a href="#ST_LineFromText">ST_LineFromText</a></span><span class="refpurpose"> — WKT表現と与えられたSRIDからジオメトリを生成します。SRIDが与えられていない場合は0 (不明)となります。</span></dt><dt><span class="refentrytitle"><a href="#ST_LineFromWKB">ST_LineFromWKB</a></span><span class="refpurpose"> — WKB表現と与えられたSRIDから<code class="varname">LINESTRING</code>を生成します。</span></dt><dt><span class="refentrytitle"><a href="#ST_LinestringFromWKB">ST_LinestringFromWKB</a></span><span class="refpurpose"> — WKB表現と与えられたSRIDからジオメトリを生成します。</span></dt><dt><span class="refentrytitle"><a href="#ST_MakeBox2D">ST_MakeBox2D</a></span><span class="refpurpose"> — 与えられたポイントジオメトリから定義されるBOX2Dを生成します。</span></dt><dt><span class="refentrytitle"><a href="#ST_3DMakeBox">ST_3DMakeBox</a></span><span class="refpurpose"> — 与えられた3次元ポイントジオメトリから定義されるBOX3Dを生成します。</span></dt><dt><span class="refentrytitle"><a href="#ST_MakeLine">ST_MakeLine</a></span><span class="refpurpose"> — ポイント、マルチポイント、ラインジオメトリからラインストリングを生成します。</span></dt><dt><span class="refentrytitle"><a href="#ST_MakeEnvelope">ST_MakeEnvelope</a></span><span class="refpurpose"> — 与えられた最小値と最大値から長方形ポリゴンを生成します。入力値はSRIDで指定された空間参照系でなければなりません。</span></dt><dt><span class="refentrytitle"><a href="#ST_MakePolygon">ST_MakePolygon</a></span><span class="refpurpose"> — 与えられた外環で形成されるポリゴンを生成します。入力ジオメトリは閉じたラインストリングでなければなりません。</span></dt><dt><span class="refentrytitle"><a href="#ST_MakePoint">ST_MakePoint</a></span><span class="refpurpose"> — 2次元、XYZの3次元または4次元のポイントジオメトリを生成します。</span></dt><dt><span class="refentrytitle"><a href="#ST_MakePointM">ST_MakePointM</a></span><span class="refpurpose"> — X, Y, M座標を持つポイントジオメトリを生成します。</span></dt><dt><span class="refentrytitle"><a href="#ST_MLineFromText">ST_MLineFromText</a></span><span class="refpurpose"> — WKT表現から指定したST_MultiLineString値を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_MPointFromText">ST_MPointFromText</a></span><span class="refpurpose"> — Well-Known Text (WKT)表現と与えられたSRIDからジオメトリを生成します。SRIDを与えない場合は0 (不明)となります。</span></dt><dt><span class="refentrytitle"><a href="#ST_MPolyFromText">ST_MPolyFromText</a></span><span class="refpurpose"> — Well-Known Text (WKT)表現と与えられたSRIDからマルチポリゴンを生成します。SRIDが与えられていない場合は0 (不明)となります。</span></dt><dt><span class="refentrytitle"><a href="#ST_Point">ST_Point</a></span><span class="refpurpose"> — 与えられた座標値のST_Pointを返します。ST_MakePointのOGC別名です。</span></dt><dt><span class="refentrytitle"><a href="#ST_PointFromGeoHash">ST_PointFromGeoHash</a></span><span class="refpurpose"> — GeoHash文字列からポイントを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_PointFromText">ST_PointFromText</a></span><span class="refpurpose"> — WKTと与えられたSRIDからポイントジオメトリを生成します。SRIDが与えられていない場合は0 (不明)とします。</span></dt><dt><span class="refentrytitle"><a href="#ST_PointFromWKB">ST_PointFromWKB</a></span><span class="refpurpose"> — WKBと与えられたSRIDからジオメトリを生成します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Polygon">ST_Polygon</a></span><span class="refpurpose"> — 指定されたラインストリングとSRIDからポリゴンを生成します。</span></dt><dt><span class="refentrytitle"><a href="#ST_PolygonFromText">ST_PolygonFromText</a></span><span class="refpurpose"> — Well-Known Text (WKT)表現と与えられたSRIDからジオメトリを生成します。SRIDを与えない場合は0 (不明)となります。</span></dt><dt><span class="refentrytitle"><a href="#ST_WKBToSQL">ST_WKBToSQL</a></span><span class="refpurpose"> — Well-Known Binary表現 (WKB)からST_Geometry値を生成します。これはSRIDを取らないST_GeomFromWKBの別名です。</span></dt><dt><span class="refentrytitle"><a href="#ST_WKTToSQL">ST_WKTToSQL</a></span><span class="refpurpose"> — Well-Knwon Text表現 (WKT)から指定したST_Geometry値を返します。これはST_GeomFromTextの別名です。</span></dt></dl></div><div class="refentry"><a name="ST_BdPolyFromText"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_BdPolyFromText — マルチラインストリングのWell-Known Text表現による、閉じたラインストリングの任意のコレクションからポリゴンを生成します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_BdPolyFromText</b>(</code>text  <var class="pdparam">WKT</var>, integer  <var class="pdparam">srid</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69003208"></a><h2>説明</h2><p>マルチラインストリングのWell-Known Text表現による、閉じたラインストリングの任意のコレクションからポリゴンを構築します。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>WKTがMULTILINESTRINGでない場合には、エラーが投げられます。出力がMULTIPOLYGONになる場合には、エラーが投げられますが、この場合はST_BdMPolyFromTextを使うかPostGIS独特のアプローチとして<a class="link" href="#ST_BuildArea" title="ST_BuildArea">ST_BuildArea()</a>をご覧ください。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a> s3.2.6.2</p><p>Availability: 1.1.0 - GEOS 2.1.0以上が必要です。</p></div><div class="refsection"><a name="idp69008072"></a><h2>例</h2><pre class="programlisting">近日登場</pre></div><div class="refsection"><a name="idp69009352"></a><h2>関連情報</h2><p><a class="xref" href="#ST_BuildArea" title="ST_BuildArea">ST_BuildArea</a>, <a class="xref" href="#ST_BdMPolyFromText" title="ST_BdMPolyFromText">ST_BdMPolyFromText</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_BdMPolyFromText"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_BdMPolyFromText — マルチラインストリングのWell-Known Text表現による、閉じたラインストリングの任意のコレクションからマルチポリゴンを構築します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_BdMPolyFromText</b>(</code>text  <var class="pdparam">WKT</var>, integer  <var class="pdparam">srid</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69020616"></a><h2>説明</h2><p>マルチラインストリングのWell-Known Text表現による、閉じたラインストリングの任意のコレクションからマルチポリゴンを構築します。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>WKTがMULTILINESTRINGでない場合には、エラーが投げられます。出力が単一のポリゴンであってもマルチポリゴンに強制されます。単一のポリゴンが返って欲しい場合はST_BdPolyFromTextを使うかPostGIS独特のアプローチとして<a class="link" href="#ST_BuildArea" title="ST_BuildArea">ST_BuildArea()</a>をご覧ください。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a> s3.2.6.2</p><p>Availability: 1.1.0 - GEOS 2.1.0以上が必要です。</p></div><div class="refsection"><a name="idp69025480"></a><h2>例</h2><pre class="programlisting">近日登場</pre></div><div class="refsection"><a name="idp69026760"></a><h2>関連情報</h2><p><a class="xref" href="#ST_BuildArea" title="ST_BuildArea">ST_BuildArea</a>, <a class="xref" href="#ST_BdPolyFromText" title="ST_BdPolyFromText">ST_BdPolyFromText</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Box2dFromGeoHash"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Box2dFromGeoHash — GeoHash文字列からBOX2Dを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">box2d <b class="fsfunc">ST_Box2dFromGeoHash</b>(</code>text  <var class="pdparam">geohash</var>, integer  <var class="pdparam">precision=full_precision_of_geohash</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69034056"></a><h2>説明</h2><p>GeoHash文字列からBOX2Dを返します。</p><p><code class="varname">precision</code>が指定されていない場合には、ST_Box2dFromGeoHashは、入力GeoHash文字列の完全な精度でBOX2Dを返します。</p><p><code class="varname">precision</code>が指定されている場合には、ST_Box2dFromGeoHashは、BOX2Dを生成するために、GeoHashからの多数の文字を使用します。低い精度の値では大きなBOX2Dを返し、値が大きいほど精度が増します。</p><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp69036872"></a><h2>例</h2><pre class="programlisting">SELECT ST_Box2dFromGeoHash('9qqj7nmxncgyy4d0dbxqz0');

                st_geomfromgeohash
--------------------------------------------------
 BOX(-115.172816 36.114646,-115.172816 36.114646)

SELECT ST_Box2dFromGeoHash('9qqj7nmxncgyy4d0dbxqz0', 0);

 st_box2dfromgeohash
----------------------
 BOX(-180 -90,180 90)

 SELECT ST_Box2dFromGeoHash('9qqj7nmxncgyy4d0dbxqz0', 10);
                            st_box2dfromgeohash
---------------------------------------------------------------------------
 BOX(-115.17282128334 36.1146408319473,-115.172810554504 36.1146461963654)
                
                </pre></div><div class="refsection"><a name="idp69038152"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeoHash" title="ST_GeoHash">ST_GeoHash</a>, <a class="xref" href="#ST_GeomFromGeoHash" title="ST_GeomFromGeoHash">ST_GeomFromGeoHash</a>, <a class="xref" href="#ST_PointFromGeoHash" title="ST_PointFromGeoHash">ST_PointFromGeoHash</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_GeogFromText"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_GeogFromText — Well-Known Text表現または拡張WKTから指定したジオグラフィ値を返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geography <b class="fsfunc">ST_GeogFromText</b>(</code>text  <var class="pdparam">EWKT</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69073352"></a><h2>説明</h2><p>Well-Known Text表現または拡張WKTから指定したジオグラフィ値を返します。SRID 4326を仮定します。この関数はST_GeographyFromTextの別名です。ポイントは常に経度緯度形式で表現されます。</p></div><div class="refsection"><a name="idp69074504"></a><h2>例</h2><pre class="programlisting">--- 経度緯度座標値からジオグラフィへの変換
ALTER TABLE sometable ADD COLUMN geog geography(POINT,4326);
UPDATE sometable SET geog = ST_GeogFromText('SRID=4326;POINT(' || lon || ' ' || lat || ')');

--- EPSG:4267 (NAD27)を使ったジオグラフィ型のポイントを指定
SELECT ST_AsEWKT(ST_GeogFromText('SRID=4267;POINT(-77.0092 38.889588)'));
                        </pre></div><div class="refsection"><a name="idp69075784"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a>, <a class="xref" href="#ST_GeographyFromText" title="ST_GeographyFromText">ST_GeographyFromText</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_GeographyFromText"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_GeographyFromText — Well-Known Text表現または拡張WKTから指定したジオグラフィ値を返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geography <b class="fsfunc">ST_GeographyFromText</b>(</code>text  <var class="pdparam">EWKT</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69081928"></a><h2>説明</h2><p>Well-Known Text表現から指定したジオグラフィ値を返します。SRID 4326を仮定します。</p></div><div class="refsection"><a name="idp69083336"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeogFromText" title="ST_GeogFromText">ST_GeogFromText</a>, <a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_GeogFromWKB"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_GeogFromWKB — Well-Known Binaryジオメトリ表現(WKB)または拡張WKB(EWKB)からジオグラフィインスタンスを生成します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geography <b class="fsfunc">ST_GeogFromWKB</b>(</code>bytea  <var class="pdparam">wkb</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69089480"></a><h2>説明</h2><p><code class="varname">ST_GeogFromWKB</code>は、ジオメトリのWell-Known Binary表現 (WKB)またはPostGIS拡張WKBを得て、適切なジオグラフィ型のインスタンスを生成します。この関数はSQLのジオメトリファクトリの役割を果たします。 </p><p>SRIDが指定されていない場合には、デフォルトは4326 (WGS 84経度緯度)となります。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p></div><div class="refsection"><a name="idp69092424"></a><h2>例</h2><pre class="programlisting">--  bytea表現では一つの\がありますが、
-- テーブル挿入時にエスケープする必要があるので二つになります。
SELECT ST_AsText(
ST_GeogFromWKB(E'\\001\\002\\000\\000\\000\\002\\000\\000\\000\\037\\205\\353Q\\270~\\\\\\300\\323Mb\\020X\\231C@\\020X9\\264\\310~\\\\\\300)\\\\\\217\\302\\365\\230C@')
);
                                          st_astext
------------------------------------------------------
 LINESTRING(-113.98 39.198,-113.981 39.195)
(1 row)

</pre></div><div class="refsection"><a name="idp69093704"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeogFromText" title="ST_GeogFromText">ST_GeogFromText</a>, <a class="xref" href="#ST_AsBinary" title="ST_AsBinary">ST_AsBinary</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_GeomFromTWKB"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_GeomFromTWKB — TWKB ("<a class="ulink" href="https://github.com/TWKB/Specification/blob/master/twkb.md" target="_top">Tiny Well-Known Binary</a>")ジオメトリ表現からジオメトリインスタンスを生成します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_GeomFromTWKB</b>(</code>bytea  <var class="pdparam">twkb</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69100360"></a><h2>説明</h2><p><code class="varname">ST_GeomFromTWKB</code>は、TWKB ("<a class="ulink" href="https://github.com/TWKB/Specification/blob/master/twkb.md" target="_top">Tiny Well-Known Binary</a>")ジオメトリ表現を取り、適切なジオメトリタイプとなるインスタンスを生成します。</p></div><div class="refsection"><a name="idp69102280"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(ST_GeomFromTWKB(ST_AsTWKB('LINESTRING(126 34, 127 35)'::geometry)));

         st_astext
-----------------------------
 LINESTRING(126 34, 127 35)
(1 row)


SELECT ST_AsEWKT(
  ST_GeomFromTWKB(E'\\x620002f7f40dbce4040105')
);
                                          st_asewkt
------------------------------------------------------
LINESTRING(-113.98 39.198,-113.981 39.195)
(1 row)
</pre></div><div class="refsection"><a name="idp69103560"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsTWKB" title="ST_AsTWKB">ST_AsTWKB</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_GeomCollFromText"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_GeomCollFromText — WKT表現と与えられたSRIDからジオメトリのコレクションを生成します。SRIDが与えられていない場合は0とします。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_GeomCollFromText</b>(</code>text  <var class="pdparam">WKT</var>, integer  <var class="pdparam">srid</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_GeomCollFromText</b>(</code>text  <var class="pdparam">WKT</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69112520"></a><h2>説明</h2><p>Well-Kown-Text (WKT)表現のコレクションと与えられたSRIDからジオメトリのコレクションを生成します。SRIDが与えられていない場合は0とします。</p><p>OGC SPEC 3.2.6.2 - 任意引数SRIDは仕様適合のためです。</p><p>WKTがGEOMETRYCOLLECTIONでない場合には、NULLを返します。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>全てのWKTジオメトリがジオメトリコレクションであると絶対的な確信を持てる場合は、この関数は使わないでください。付加的な評価ステップが追加されるのでST_GeomFromTextより遅いです。 </p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a> s3.2.6.2</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification.</p></div><div class="refsection"><a name="idp69119432"></a><h2>例</h2><pre class="programlisting">SELECT ST_GeomCollFromText('GEOMETRYCOLLECTION(POINT(1 2),LINESTRING(1 2, 3 4))');
</pre></div><div class="refsection"><a name="idp69120968"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a>, <a class="xref" href="#ST_SRID" title="ST_SRID">ST_SRID</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_GeomFromEWKB"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_GeomFromEWKB — 拡張Well-Known Binary表現 (EWKB)から指定したST_Geometry値を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_GeomFromEWKB</b>(</code>bytea  <var class="pdparam">EWKB</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69127112"></a><h2>説明</h2><p>拡張Well-Known Binary表現 (EWKB)からPostGISのST_Geometryオブジェクトを構築します。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>EWKB書式はOGC標準ではなくPostGIS独特の書式で、空間参照系識別番号 (SRID)を含みます。</p></td></tr></table></div><p>Enhanced: 2.0.0 多面体サーフェス対応とTIN対応が導入されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div><div class="refsection"><a name="idp69137096"></a><h2>例</h2><p>NAD83経度緯度 (4269)のLINESTRING(-71.160281 42.258729,-71.160837 42.259113,-71.161144 42.25932)のバイナリ表現です。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ご注意: byte配列は、\で区切られ、'を持ちますが、standard_conforming_stringsが切られている場合には、\と''でエスケープします。正確にはAsEWKB表現とはあいません。</p></td></tr></table></div><pre class="programlisting">SELECT ST_GeomFromEWKB(E'\\001\\002\\000\\000 \\255\\020\\000\\000\\003\\000\\000\\000\\344J=
\\013B\\312Q\\300n\\303(\\010\\036!E@''\\277E''K
\\312Q\\300\\366{b\\235*!E@\\225|\\354.P\\312Q
\\300p\\231\\323e1!E@');</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>PostgreSQL 9.1より前では、standard_conforming_stringsは切られていましたが、9.1以上では、デフォルトで入っていることになりました。必要に応じて、クエリ1回で、データベースまたはサーバレベルでのデフォルトを変更できます。standard_conforming_strings = on使った場合を次に示します。この場合、'を標準ANSIの'でエスケープしますが、バックスラッシュはエスケープしていません。</p></td></tr></table></div><pre class="programlisting">set standard_conforming_strings = on;
SELECT ST_GeomFromEWKB('\001\002\000\000 \255\020\000\000\003\000\000\000\344J=\012\013B
    \312Q\300n\303(\010\036!E@''\277E''K\012\312Q\300\366{b\235*!E@\225|\354.P\312Q\012\300p\231\323e1')</pre></div><div class="refsection"><a name="idp69140296"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsBinary" title="ST_AsBinary">ST_AsBinary</a>, <a class="xref" href="#ST_AsEWKB" title="ST_AsEWKB">ST_AsEWKB</a>, <a class="xref" href="#ST_GeomFromWKB" title="ST_GeomFromWKB">ST_GeomFromWKB</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_GeomFromEWKT"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_GeomFromEWKT — 拡張Well-Known Text表現 (EWKT)から指定されたST_Geometry値を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_GeomFromEWKT</b>(</code>text  <var class="pdparam">EWKT</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69146824"></a><h2>説明</h2><p>拡張Well-Known Text表現 (EWKT)からPostGIS ST_Geometryオブジェクトを生成します。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>EWKT書式はOGC標準ではなくPostGIS独特の書式で、空間参照系ID (SRID)を含みます。</p></td></tr></table></div><p>Enhanced: 2.0.0 多面体サーフェス対応とTIN対応が導入されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div><div class="refsection"><a name="idp69154504"></a><h2>例</h2><pre class="programlisting">SELECT ST_GeomFromEWKT('SRID=4269;LINESTRING(-71.160281 42.258729,-71.160837 42.259113,-71.161144 42.25932)');
SELECT ST_GeomFromEWKT('SRID=4269;MULTILINESTRING((-71.160281 42.258729,-71.160837 42.259113,-71.161144 42.25932))');

SELECT ST_GeomFromEWKT('SRID=4269;POINT(-71.064544 42.28787)');

SELECT ST_GeomFromEWKT('SRID=4269;POLYGON((-71.1776585052917 42.3902909739571,-71.1776820268866 42.3903701743239,
-71.1776063012595 42.3903825660754,-71.1775826583081 42.3903033653531,-71.1776585052917 42.3902909739571))');

SELECT ST_GeomFromEWKT('SRID=4269;MULTIPOLYGON(((-71.1031880899493 42.3152774590236,
-71.1031627617667 42.3152960829043,-71.102923838298 42.3149156848307,
-71.1023097974109 42.3151969047397,-71.1019285062273 42.3147384934248,
-71.102505233663 42.3144722937587,-71.10277487471 42.3141658254797,
-71.103113945163 42.3142739188902,-71.10324876416 42.31402489987,
-71.1033002961013 42.3140393340215,-71.1033488797549 42.3139495090772,
-71.103396240451 42.3138632439557,-71.1041521907712 42.3141153348029,
-71.1041411411543 42.3141545014533,-71.1041287795912 42.3142114839058,
-71.1041188134329 42.3142693656241,-71.1041112482575 42.3143272556118,
-71.1041072845732 42.3143851580048,-71.1041057218871 42.3144430686681,
-71.1041065602059 42.3145009876017,-71.1041097995362 42.3145589148055,
-71.1041166403905 42.3146168544148,-71.1041258822717 42.3146748022936,
-71.1041375307579 42.3147318674446,-71.1041492906949 42.3147711126569,
-71.1041598612795 42.314808571739,-71.1042515013869 42.3151287620809,
-71.1041173835118 42.3150739481917,-71.1040809891419 42.3151344119048,
-71.1040438678912 42.3151191367447,-71.1040194562988 42.3151832057859,
-71.1038734225584 42.3151140942995,-71.1038446938243 42.3151006300338,
-71.1038315271889 42.315094347535,-71.1037393329282 42.315054824985,
-71.1035447555574 42.3152608696313,-71.1033436658644 42.3151648370544,
-71.1032580383161 42.3152269126061,-71.103223066939 42.3152517403219,
-71.1031880899493 42.3152774590236)),
((-71.1043632495873 42.315113108546,-71.1043583974082 42.3151211109857,
-71.1043443253471 42.3150676015829,-71.1043850704575 42.3150793250568,-71.1043632495873 42.315113108546)))');
</pre><pre class="programlisting">-- 3次元曲線
SELECT ST_GeomFromEWKT('CIRCULARSTRING(220268 150415 1,220227 150505 2,220227 150406 3)');
</pre><pre class="programlisting">-- 多面体サーフェスの例
SELECT ST_GeomFromEWKT('POLYHEDRALSURFACE(
        ((0 0 0, 0 0 1, 0 1 1, 0 1 0, 0 0 0)),
        ((0 0 0, 0 1 0, 1 1 0, 1 0 0, 0 0 0)),
        ((0 0 0, 1 0 0, 1 0 1, 0 0 1, 0 0 0)),
        ((1 1 0, 1 1 1, 1 0 1, 1 0 0, 1 1 0)),
        ((0 1 0, 0 1 1, 1 1 1, 1 1 0, 0 1 0)),
        ((0 0 1, 1 0 1, 1 1 1, 0 1 1, 0 0 1))
)');
</pre></div><div class="refsection"><a name="idp69156808"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a>, <a class="xref" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a>, <a class="xref" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_GeometryFromText"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_GeometryFromText — Well-Knwon Text表現 (WKT)から指定したST_Geometry値を返します。これはST_GeomFromTextの別名です。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_GeometryFromText</b>(</code>text  <var class="pdparam">WKT</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_GeometryFromText</b>(</code>text  <var class="pdparam">WKT</var>, integer  <var class="pdparam">srid</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69187016"></a><h2>説明</h2><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a></p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 5.1.40</p></div><div class="refsection"><a name="idp69190728"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_GeomFromGeoHash"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_GeomFromGeoHash — GeoHash文字列からジオメトリを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_GeomFromGeoHash</b>(</code>text  <var class="pdparam">geohash</var>, integer  <var class="pdparam">precision=full_precision_of_geohash</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69197640"></a><h2>説明</h2><p>GeoHash文字列からジオメトリを返します。ジオメトリはGeoHashバウンディングボックスのポリゴン表現となります。</p><p><code class="varname">precision</code>を指定しない場合には、ST_GeomFromGeoHashは、入力GeoHash文字列の最大精度に基づくポリゴンを返します。</p><p><code class="varname">precision</code>が指定されると、ST_GeomFromGeoHashは、ポリゴンを生成するためGeoHashからの多数の文字を使います。</p><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp69200456"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(ST_GeomFromGeoHash('9qqj7nmxncgyy4d0dbxqz0'));
                                                        st_astext
--------------------------------------------------------------------------------------------------------------------------
 POLYGON((-115.172816 36.114646,-115.172816 36.114646,-115.172816 36.114646,-115.172816 36.114646,-115.172816 36.114646))

SELECT ST_AsText(ST_GeomFromGeoHash('9qqj7nmxncgyy4d0dbxqz0', 4));
                                                          st_astext
------------------------------------------------------------------------------------------------------------------------------
 POLYGON((-115.3125 36.03515625,-115.3125 36.2109375,-114.9609375 36.2109375,-114.9609375 36.03515625,-115.3125 36.03515625))

SELECT ST_AsText(ST_GeomFromGeoHash('9qqj7nmxncgyy4d0dbxqz0', 10));
                                                                                       st_astext
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 POLYGON((-115.17282128334 36.1146408319473,-115.17282128334 36.1146461963654,-115.172810554504 36.1146461963654,-115.172810554504 36.1146408319473,-115.17282128334 36.1146408319473))
                
                </pre></div><div class="refsection"><a name="idp69201736"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeoHash" title="ST_GeoHash">ST_GeoHash</a>,<a class="xref" href="#ST_Box2dFromGeoHash" title="ST_Box2dFromGeoHash">ST_Box2dFromGeoHash</a>, <a class="xref" href="#ST_PointFromGeoHash" title="ST_PointFromGeoHash">ST_PointFromGeoHash</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_GeomFromGML"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_GeomFromGML — GML表現からPostGISジオメトリオブジェクトを出力します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_GeomFromGML</b>(</code>text  <var class="pdparam">geomgml</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_GeomFromGML</b>(</code>text  <var class="pdparam">geomgml</var>, integer  <var class="pdparam">srid</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69236040"></a><h2>説明</h2><p>OGC GML表現からPostGIS ST_Geometryオブジェクトを生成します。</p><p>ST_GeomFromGMLは、GMLのうちジオメトリ部分でのみ動作します。GML文書全体に使用しようとするとエラーが投げられます。</p><p>サポートされているOGC GMLの版は次のとおりです。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>GML 3.2.1 Namespace</p></li><li class="listitem"><p>GML 3.1.1 Simple Features profile SF-2 (GML 3.1.0と3.0.0の後方互換)</p></li><li class="listitem"><p>GML 2.1.2</p></li></ul></div><p> OGC GML標準については、<a class="ulink" href="http://www.opengeospatial.org/standards/gml" target="_top">http://www.opengeospatial.org/standards/gml</a>をご覧下さい。 </p><p>Availability: 1.5 libxml2 1.6+が必要です。</p><p>Enhanced: 2.0.0 多面体サーフェス対応とTIN対応が導入されました。</p><p>Enhanced: 2.0.0 SRID任意引数が追加されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p><p>GMLは、複合次元 (たとえば、2次元と3次元が同じMultiGeometry内にある)を許します。PostGISジオメトリは許さないので、ST_GeomFromGMLは、Z次元が無いジオメトリを一つでも発見すると、ジオメトリ全体を2次元に変換します。</p><p>GMLは同じMultiGeometry内での複合SRSをサポートします。PostGISではサポートしないので、ST_GeomFromGMLは、この場合には、全てのサブジオメトリをルートノードのSRSに投影変換します。GMLのルートノードにsrsName属性が無い場合、関数はエラーを投げます。</p><p>ST_GeomFromGML関数は、明示的なGML名前空間について杓子定規ではありません。共通使用で名前空間の明示を避けることができます。ただし、GML内でXLink機能を使いたい場合は必要です。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_GeomFromGMLはSQL/MM曲線ジオメトリに対応していません。</p></td></tr></table></div></div><div class="refsection"><a name="idp69248584"></a><h2>例 - srsName属性を持つ単一のジオメトリ</h2><pre class="programlisting">SELECT ST_GeomFromGML('
                &lt;gml:LineString srsName="EPSG:4269"&gt;
                        &lt;gml:coordinates&gt;
                                -71.16028,42.258729 -71.160837,42.259112 -71.161143,42.25932
                        &lt;/gml:coordinates&gt;
                &lt;/gml:LineString
&gt;');
                </pre></div><div class="refsection"><a name="idp69266248"></a><h2>例 - XLink使用法</h2><pre class="programlisting">SELECT ST_GeomFromGML('
                &lt;gml:LineString xmlns:gml="http://www.opengis.net/gml"
                                xmlns:xlink="http://www.w3.org/1999/xlink"
                                srsName="urn:ogc:def:crs:EPSG::4269"&gt;
                        &lt;gml:pointProperty&gt;
                                &lt;gml:Point gml:id="p1"
&gt;&lt;gml:pos
&gt;42.258729 -71.16028&lt;/gml:pos
&gt;&lt;/gml:Point&gt;
                        &lt;/gml:pointProperty&gt;
                        &lt;gml:pos
&gt;42.259112 -71.160837&lt;/gml:pos&gt;
                        &lt;gml:pointProperty&gt;
                                &lt;gml:Point xlink:type="simple" xlink:href="#p1"/&gt;
                        &lt;/gml:pointProperty&gt;
                &lt;/gml:LineString
&gt;'););
                </pre></div><div class="refsection"><a name="idp69267528"></a><h2>例 - 多面体サーフェス</h2><pre class="programlisting">SELECT ST_AsEWKT(ST_GeomFromGML('
&lt;gml:PolyhedralSurface&gt;
&lt;gml:polygonPatches&gt;
  &lt;gml:PolygonPatch&gt;
    &lt;gml:exterior&gt;
      &lt;gml:LinearRing
&gt;&lt;gml:posList srsDimension="3"
&gt;0 0 0 0 0 1 0 1 1 0 1 0 0 0 0&lt;/gml:posList
&gt;&lt;/gml:LinearRing&gt;
    &lt;/gml:exterior&gt;
  &lt;/gml:PolygonPatch&gt;
  &lt;gml:PolygonPatch&gt;
    &lt;gml:exterior&gt;
        &lt;gml:LinearRing
&gt;&lt;gml:posList srsDimension="3"
&gt;0 0 0 0 1 0 1 1 0 1 0 0 0 0 0&lt;/gml:posList
&gt;&lt;/gml:LinearRing&gt;
    &lt;/gml:exterior&gt;
  &lt;/gml:PolygonPatch&gt;
  &lt;gml:PolygonPatch&gt;
    &lt;gml:exterior&gt;
        &lt;gml:LinearRing
&gt;&lt;gml:posList srsDimension="3"
&gt;0 0 0 1 0 0 1 0 1 0 0 1 0 0 0&lt;/gml:posList
&gt;&lt;/gml:LinearRing&gt;
    &lt;/gml:exterior&gt;
  &lt;/gml:PolygonPatch&gt;
  &lt;gml:PolygonPatch&gt;
    &lt;gml:exterior&gt;
        &lt;gml:LinearRing
&gt;&lt;gml:posList srsDimension="3"
&gt;1 1 0 1 1 1 1 0 1 1 0 0 1 1 0&lt;/gml:posList
&gt;&lt;/gml:LinearRing&gt;
    &lt;/gml:exterior&gt;
  &lt;/gml:PolygonPatch&gt;
  &lt;gml:PolygonPatch&gt;
    &lt;gml:exterior&gt;
        &lt;gml:LinearRing
&gt;&lt;gml:posList srsDimension="3"
&gt;0 1 0 0 1 1 1 1 1 1 1 0 0 1 0&lt;/gml:posList
&gt;&lt;/gml:LinearRing&gt;
    &lt;/gml:exterior&gt;
  &lt;/gml:PolygonPatch&gt;
  &lt;gml:PolygonPatch&gt;
    &lt;gml:exterior&gt;
        &lt;gml:LinearRing
&gt;&lt;gml:posList srsDimension="3"
&gt;0 0 1 1 0 1 1 1 1 0 1 1 0 0 1&lt;/gml:posList
&gt;&lt;/gml:LinearRing&gt;
    &lt;/gml:exterior&gt;
  &lt;/gml:PolygonPatch&gt;
&lt;/gml:polygonPatches&gt;
&lt;/gml:PolyhedralSurface
&gt;'));

-- 結果--
 POLYHEDRALSURFACE(((0 0 0,0 0 1,0 1 1,0 1 0,0 0 0)),
 ((0 0 0,0 1 0,1 1 0,1 0 0,0 0 0)),
 ((0 0 0,1 0 0,1 0 1,0 0 1,0 0 0)),
 ((1 1 0,1 1 1,1 0 1,1 0 0,1 1 0)),
 ((0 1 0,0 1 1,1 1 1,1 1 0,0 1 0)),
 ((0 0 1,1 0 1,1 1 1,0 1 1,0 0 1)))
                </pre></div><div class="refsection"><a name="idp69268808"></a><h2>関連情報</h2><p><a class="xref" href="#installation_configuration" title="2.4.1. コンフィギュレーション">「コンフィギュレーション」</a>, <a class="xref" href="#ST_AsGML" title="ST_AsGML">ST_AsGML</a>, <a class="xref" href="#ST_GMLToSQL" title="ST_GMLToSQL">ST_GMLToSQL</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_GeomFromGeoJSON"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_GeomFromGeoJSON — ジオメトリのGeoJSON表現を入力として、PostGISジオメトリオブジェクトを出力します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_GeomFromGeoJSON</b>(</code>text  <var class="pdparam">geomjson</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_GeomFromGeoJSON</b>(</code>json  <var class="pdparam">geomjson</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_GeomFromGeoJSON</b>(</code>jsonb  <var class="pdparam">geomjson</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69279816"></a><h2>説明</h2><p>GeoJSON表現からPostGISジオメトリオブジェクトを生成します。</p><p>ST_GeomFromGeoJSONは、JSONのうちジオメトリ部分でのみ動作します。JSON文書全体を使おうとするとエラーが投げられます。</p><p>Enhanced: 2.5.0 JSONとJSONBの入力を受け付けるようになりました。</p><p>Availability: 2.0.0 JSON-C 0.9以上が必要です。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>有効なJSON-Cが無い場合には、出力の替りに、エラー通知を得ます。JSON-Cを有効にするには--with-jsondir=/path/to/json-cをコンフィギュアで指定します。詳細については<a class="xref" href="#installation_configuration" title="2.4.1. コンフィギュレーション">「コンフィギュレーション」</a>をご覧下さい。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp69284424"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(ST_GeomFromGeoJSON('{"type":"Point","coordinates":[-48.23456,20.12345]}')) As wkt;
wkt
------
POINT(-48.23456 20.12345)
</pre><pre class="programlisting">-- 3次元ラインストリング
SELECT ST_AsText(ST_GeomFromGeoJSON('{"type":"LineString","coordinates":[[1,2,3],[4,5,6],[7,8,9]]}')) As wkt;

wkt
-------------------
LINESTRING(1 2,4 5,7 8)
</pre></div><div class="refsection"><a name="idp69286216"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a>, <a class="xref" href="#ST_AsGeoJSON" title="ST_AsGeoJSON">ST_AsGeoJSON</a>, <a class="xref" href="#installation_configuration" title="2.4.1. コンフィギュレーション">「コンフィギュレーション」</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_GeomFromKML"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_GeomFromKML — ジオメトリのKML表現の入力をとり、PostGISジオメトリオブジェクトを出力します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_GeomFromKML</b>(</code>text  <var class="pdparam">geomkml</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69292744"></a><h2>説明</h2><p>OGC KML表現からPostGIS ST_Geometryオブジェクトを生成します。</p><p>ST_GeomFromKMLは、KMLのうちジオメトリ部分でのみ動作します。KML文書全体に使用しようとするとエラーが投げられます。</p><p>対応するOGC KMLの版は次の通りです。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>KML 2.2.0 Namespace</p></li></ul></div><p>OGC KML標準については<a class="ulink" href="http://www.opengeospatial.org/standards/kml" target="_top">http://www.opengeospatial.org/standards/kml</a>をご覧ください。 </p><p>Availability: 1.5 libxml2 2.6以上が必要です。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_GeomFromKML関数はSQL/MM曲線ジオメトリに対応していません。</p></td></tr></table></div></div><div class="refsection"><a name="idp69298888"></a><h2>例 - srsName属性を持つ単一のジオメトリ</h2><pre class="programlisting">SELECT ST_GeomFromKML('
                &lt;LineString&gt;
                        &lt;coordinates
&gt;-71.1663,42.2614
                                -71.1667,42.2616&lt;/coordinates&gt;
                &lt;/LineString
&gt;');
                </pre></div><div class="refsection"><a name="idp69300168"></a><h2>関連情報</h2><p><a class="xref" href="#installation_configuration" title="2.4.1. コンフィギュレーション">「コンフィギュレーション」</a>, <a class="xref" href="#ST_AsKML" title="ST_AsKML">ST_AsKML</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_GMLToSQL"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_GMLToSQL — GML表現から指定したST_Geometry値を返します。これはST_GeomFromGMLの別名です。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_GMLToSQL</b>(</code>text  <var class="pdparam">geomgml</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_GMLToSQL</b>(</code>text  <var class="pdparam">geomgml</var>, integer  <var class="pdparam">srid</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69309512"></a><h2>説明</h2><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 5.1.50 (曲線対応を除く)</p><p>Availability: 1.5 libxml2 1.6+が必要です。</p><p>Enhanced: 2.0.0 多面体サーフェス対応とTIN対応が導入されました。</p><p>Enhanced: 2.0.0 SRID任意引数が追加されました。</p></div><div class="refsection"><a name="idp69312968"></a><h2>関連情報</h2><p><a class="xref" href="#installation_configuration" title="2.4.1. コンフィギュレーション">「コンフィギュレーション」</a>, <a class="xref" href="#ST_GeomFromGML" title="ST_GeomFromGML">ST_GeomFromGML</a>, <a class="xref" href="#ST_AsGML" title="ST_AsGML">ST_AsGML</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_GeomFromText"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_GeomFromText — Well-Known Text表現 (WKT)から指定したST_Geometryを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_GeomFromText</b>(</code>text  <var class="pdparam">WKT</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_GeomFromText</b>(</code>text  <var class="pdparam">WKT</var>, integer  <var class="pdparam">srid</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69326792"></a><h2>説明</h2><p>OGC Well-Known Text表現からPostGIS ST_Geometryオブジェクトを生成します。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_GeomFromText関数には二つの形式があります。一つ目は、SRIDを取らず、空間参照系を持たない (SRID=0)ジオメトリを返すものです。二つ目は、SRIDを第2引数に取り、メタデータの一部としてSRIDを含むジオメトリを返すものです。 </p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a> s3.2.6.2 - 任意引数SRIDは仕様適合のためです。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 5.1.40</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Changed: 2.0.0 前の版ではST_GeomFromText('GEOMETRYCOLLECTION(EMPTY)')が許されていました。SQL/MM標準への適合のためPostGIS 2.0.0では不正とされます。今はST_GeomFromText('GEOMETRYCOLLECTION EMPTY')となります。</p></td></tr></table></div></div><div class="refsection"><a name="idp69337928"></a><h2>例</h2><pre class="programlisting">SELECT ST_GeomFromText('LINESTRING(-71.160281 42.258729,-71.160837 42.259113,-71.161144 42.25932)');
SELECT ST_GeomFromText('LINESTRING(-71.160281 42.258729,-71.160837 42.259113,-71.161144 42.25932)',4269);

SELECT ST_GeomFromText('MULTILINESTRING((-71.160281 42.258729,-71.160837 42.259113,-71.161144 42.25932))');

SELECT ST_GeomFromText('POINT(-71.064544 42.28787)');

SELECT ST_GeomFromText('POLYGON((-71.1776585052917 42.3902909739571,-71.1776820268866 42.3903701743239,
-71.1776063012595 42.3903825660754,-71.1775826583081 42.3903033653531,-71.1776585052917 42.3902909739571))');

SELECT ST_GeomFromText('MULTIPOLYGON(((-71.1031880899493 42.3152774590236,
-71.1031627617667 42.3152960829043,-71.102923838298 42.3149156848307,
-71.1023097974109 42.3151969047397,-71.1019285062273 42.3147384934248,
-71.102505233663 42.3144722937587,-71.10277487471 42.3141658254797,
-71.103113945163 42.3142739188902,-71.10324876416 42.31402489987,
-71.1033002961013 42.3140393340215,-71.1033488797549 42.3139495090772,
-71.103396240451 42.3138632439557,-71.1041521907712 42.3141153348029,
-71.1041411411543 42.3141545014533,-71.1041287795912 42.3142114839058,
-71.1041188134329 42.3142693656241,-71.1041112482575 42.3143272556118,
-71.1041072845732 42.3143851580048,-71.1041057218871 42.3144430686681,
-71.1041065602059 42.3145009876017,-71.1041097995362 42.3145589148055,
-71.1041166403905 42.3146168544148,-71.1041258822717 42.3146748022936,
-71.1041375307579 42.3147318674446,-71.1041492906949 42.3147711126569,
-71.1041598612795 42.314808571739,-71.1042515013869 42.3151287620809,
-71.1041173835118 42.3150739481917,-71.1040809891419 42.3151344119048,
-71.1040438678912 42.3151191367447,-71.1040194562988 42.3151832057859,
-71.1038734225584 42.3151140942995,-71.1038446938243 42.3151006300338,
-71.1038315271889 42.315094347535,-71.1037393329282 42.315054824985,
-71.1035447555574 42.3152608696313,-71.1033436658644 42.3151648370544,
-71.1032580383161 42.3152269126061,-71.103223066939 42.3152517403219,
-71.1031880899493 42.3152774590236)),
((-71.1043632495873 42.315113108546,-71.1043583974082 42.3151211109857,
-71.1043443253471 42.3150676015829,-71.1043850704575 42.3150793250568,-71.1043632495873 42.315113108546)))',4326);

SELECT ST_GeomFromText('CIRCULARSTRING(220268 150415,220227 150505,220227 150406)');
        </pre></div><div class="refsection"><a name="idp69339208"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a>, <a class="xref" href="#ST_GeomFromWKB" title="ST_GeomFromWKB">ST_GeomFromWKB</a>, <a class="xref" href="#ST_SRID" title="ST_SRID">ST_SRID</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_GeomFromWKB"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_GeomFromWKB — Well-Knwon Binaryジオメトリ表現 (WKB)と任意パラメタのSRIDからジオメトリインスタンスを生成します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_GeomFromWKB</b>(</code>bytea  <var class="pdparam">geom</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_GeomFromWKB</b>(</code>bytea  <var class="pdparam">geom</var>, integer  <var class="pdparam">srid</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69393992"></a><h2>説明</h2><p><code class="varname">ST_GeomFromWKB</code>は、ジオメトリのWell-Known Binary表現と空間参照系識別番号 (<code class="varname">SRID</code>)を取り、適切なジオメトリタイプのインスタンスを生成します。この関数は、SQLのジオメトリファクトリの役割を果たします。これは、ST_WKBToSQLの代替名です。</p><p>SRIDが指定されていない場合、0 (不明)となります。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a> s3.2.7.2 - 任意引数SRIDは仕様適合のためです。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 5.1.41</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p></div><div class="refsection"><a name="idp69400520"></a><h2>例</h2><pre class="programlisting">-- bytea表現では\は一つですが、
-- standard_conforming_stringsがONでない限りは、
-- tableに挿入するときにエスケープしなければなりません。
SELECT ST_AsEWKT(
ST_GeomFromWKB(E'\\001\\002\\000\\000\\000\\002\\000\\000\\000\\037\\205\\353Q\\270~\\\\\\300\\323Mb\\020X\\231C@\\020X9\\264\\310~\\\\\\300)\\\\\\217\\302\\365\\230C@',4326)
);
                                          st_asewkt
------------------------------------------------------
 SRID=4326;LINESTRING(-113.98 39.198,-113.981 39.195)
(1 row)

SELECT
  ST_AsText(
        ST_GeomFromWKB(
          ST_AsEWKB('POINT(2 5)'::geometry)
        )
  );
 st_astext
------------
 POINT(2 5)
(1 row)</pre></div><div class="refsection"><a name="idp69402056"></a><h2>関連情報</h2><p><a class="xref" href="#ST_WKBToSQL" title="ST_WKBToSQL">ST_WKBToSQL</a>, <a class="xref" href="#ST_AsBinary" title="ST_AsBinary">ST_AsBinary</a>, <a class="xref" href="#ST_GeomFromEWKB" title="ST_GeomFromEWKB">ST_GeomFromEWKB</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_LineFromEncodedPolyline"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_LineFromEncodedPolyline — エンコード化ポリラインからラインストリングを生成します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_LineFromEncodedPolyline</b>(</code>text  <var class="pdparam">polyline</var>, integer  <var class="pdparam">precision=5</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69409736"></a><h2>説明</h2><p>エンコード化ポリラインからラインストリングを生成します。</p><p>任意パラメータ<code class="varname">precision</code>は、ポリライン符号化の際の桁数を決定するものです。符号化と復号とで同じ値であるべきで、異なる場合には座標が正しくなりません。</p><p>http://developers.google.com/maps/documentation/utilities/polylinealgorithmを参照して下さい。</p><p>Availability: 2.2.0</p></div><div class="refsection"><a name="idp69412424"></a><h2>例</h2><pre class="programlisting">-- ポリラインからラインストリングを生成
SELECT ST_AsEWKT(ST_LineFromEncodedPolyline('_p~iF~ps|U_ulLnnqC_mqNvxq`@'));
-- 結果 --
SRID=4326;LINESTRING(-120.2 38.5,-120.95 40.7,-126.453 43.252)

-- ポリラインの符号化に使われたのと違う精度を選択
SELECT ST_AsEWKT(ST_LineFromEncodedPolyline('_p~iF~ps|U_ulLnnqC_mqNvxq`@',6));
-- 結果 --
SRID=4326;LINESTRING(-12.02 3.85,-12.095 4.07,-12.6453 4.3252)

    </pre></div><div class="refsection"><a name="idp69413960"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsEncodedPolyline" title="ST_AsEncodedPolyline">ST_AsEncodedPolyline</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_LineFromMultiPoint"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_LineFromMultiPoint — マルチポイントジオメトリからラインストリングを生成します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_LineFromMultiPoint</b>(</code>geometry  <var class="pdparam">aMultiPoint</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69419720"></a><h2>説明</h2><p>マルチポイントジオメトリからラインストリングを生成します。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp69422280"></a><h2>例</h2><pre class="programlisting">-- 3次元マルチポイントから3次元ラインストリングを生成します
SELECT ST_AsEWKT(ST_LineFromMultiPoint(ST_GeomFromEWKT('MULTIPOINT(1 2 3, 4 5 6, 7 8 9)')));
-- 結果 --
LINESTRING(1 2 3,4 5 6,7 8 9)
                </pre></div><div class="refsection"><a name="idp69423816"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a>, <a class="xref" href="#ST_Collect" title="ST_Collect">ST_Collect</a>, <a class="xref" href="#ST_MakeLine" title="ST_MakeLine">ST_MakeLine</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_LineFromText"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_LineFromText — WKT表現と与えられたSRIDからジオメトリを生成します。SRIDが与えられていない場合は0 (不明)となります。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_LineFromText</b>(</code>text  <var class="pdparam">WKT</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_LineFromText</b>(</code>text  <var class="pdparam">WKT</var>, integer  <var class="pdparam">srid</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69433544"></a><h2>説明</h2><p>WKT表現と与えられたSRIDからジオメトリを生成します。SRIDが与えられていない場合は0 (不明)となります。渡されたWKTがLINESTRINGでない場合にはNULLが返ります。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>OGC SPEC 3.2.6.2 - 任意引数SRIDは仕様適合のためです。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>全てのジオメトリがLINESTRINGであると知っている場合は、ST_GeomFromTextを使う方が効率的です。 この関数はST_GeomFromTextの呼び出しと、LINESTRINGを返すかどうかの評価とを行います。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a> s3.2.6.2</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 7.2.8</p></div><div class="refsection"><a name="idp69439304"></a><h2>例</h2><pre class="programlisting">SELECT ST_LineFromText('LINESTRING(1 2, 3 4)') AS aline, ST_LineFromText('POINT(1 2)') AS null_return;
aline                            | null_return
------------------------------------------------
010200000002000000000000000000F ... | t
                </pre></div><div class="refsection"><a name="idp69440840"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_LineFromWKB"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_LineFromWKB — WKB表現と与えられたSRIDから<code class="varname">LINESTRING</code>を生成します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_LineFromWKB</b>(</code>bytea  <var class="pdparam">WKB</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_LineFromWKB</b>(</code>bytea  <var class="pdparam">WKB</var>, integer  <var class="pdparam">srid</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69462472"></a><h2>説明</h2><p><code class="varname">ST_LineFromWKB</code>は、ジオメトリのWell-Known Binary表現と空間参照系識別番号 (SRID)を取り、適切なジオメトリタイプを返します。この場合はLINESTRINGジオメトリです。この関数はSQLのジオメトリファクトリの役割を果たします。</p><p>SRIDが指定されていない場合は0 (不明)となります。入力<code class="varname">bytea</code>が<code class="varname">LINESTRING</code>を表現していない場合は<code class="varname">NULL</code>を返します。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>OGC SPEC 3.2.6.2 - 任意引数SRIDは仕様適合のためです。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>全てのジオメトリが<code class="varname">LINESTRING</code>であると知っている場合は、<a class="xref" href="#ST_GeomFromWKB" title="ST_GeomFromWKB">ST_GeomFromWKB</a>を使う方が効率的です。 この関数は<a class="xref" href="#ST_GeomFromWKB" title="ST_GeomFromWKB">ST_GeomFromWKB</a>の呼び出しと、LINESTRINGを返すかどうかの評価とを行います。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a> s3.2.6.2</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 7.2.9</p></div><div class="refsection"><a name="idp69471176"></a><h2>例</h2><pre class="programlisting">SELECT ST_LineFromWKB(ST_AsBinary(ST_GeomFromText('LINESTRING(1 2, 3 4)'))) AS aline,
                ST_LineFromWKB(ST_AsBinary(ST_GeomFromText('POINT(1 2)'))) IS NULL AS null_return;
aline                            | null_return
------------------------------------------------
010200000002000000000000000000F ... | t
                </pre></div><div class="refsection"><a name="idp69472712"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeomFromWKB" title="ST_GeomFromWKB">ST_GeomFromWKB</a>, <a class="xref" href="#ST_LinestringFromWKB" title="ST_LinestringFromWKB">ST_LinestringFromWKB</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_LinestringFromWKB"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_LinestringFromWKB — WKB表現と与えられたSRIDからジオメトリを生成します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_LinestringFromWKB</b>(</code>bytea  <var class="pdparam">WKB</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_LinestringFromWKB</b>(</code>bytea  <var class="pdparam">WKB</var>, integer  <var class="pdparam">srid</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69482056"></a><h2>説明</h2><p><code class="varname">ST_LinestringFromWKB</code>は、ジオメトリのWell-Known Binary表現と空間参照系識別番号 (<code class="varname">SRID</code>を取り、適切なジオメトリタイプのインスタンスを生成します。この場合、LINESTRINGジオメトリです。この関数はSQLのジオメトリファクトリの役割を果たします。</p><p>SRIDが指定されていない場合は0 (不明)となります。入力<code class="varname">bytea</code>が<code class="varname">LINESTRING</code>を表現していない場合は<code class="varname">NULL</code>を返します。これは<a class="xref" href="#ST_LineFromWKB" title="ST_LineFromWKB">ST_LineFromWKB</a>の別名です。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>OGC SPEC 3.2.6.2 - 任意引数SRIDは仕様適合のためです。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>全てのジオメトリが<code class="varname">LINESTRING</code>であると知っている場合は、<a class="xref" href="#ST_GeomFromWKB" title="ST_GeomFromWKB">ST_GeomFromWKB</a>を使う方が効率的です。この関数は<a class="xref" href="#ST_GeomFromWKB" title="ST_GeomFromWKB">ST_GeomFromWKB</a>の呼び出しと、<code class="varname">LINESTRING</code>を返すかどうかの評価とを行います。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a> s3.2.6.2</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 7.2.9</p></div><div class="refsection"><a name="idp69487816"></a><h2>例</h2><pre class="programlisting">SELECT
  ST_LineStringFromWKB(
        ST_AsBinary(ST_GeomFromText('LINESTRING(1 2, 3 4)'))
  ) AS aline,
  ST_LinestringFromWKB(
        ST_AsBinary(ST_GeomFromText('POINT(1 2)'))
  ) IS NULL AS null_return;
   aline                            | null_return
------------------------------------------------
010200000002000000000000000000F ... | t</pre></div><div class="refsection"><a name="idp69489352"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeomFromWKB" title="ST_GeomFromWKB">ST_GeomFromWKB</a>, <a class="xref" href="#ST_LineFromWKB" title="ST_LineFromWKB">ST_LineFromWKB</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_MakeBox2D"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MakeBox2D — 与えられたポイントジオメトリから定義されるBOX2Dを生成します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">box2d <b class="fsfunc">ST_MakeBox2D</b>(</code>geometry  <var class="pdparam">pointLowLeft</var>, geometry  <var class="pdparam">pointUpRight</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69496520"></a><h2>説明</h2><p>与えられた二つのポイントジオメトリから定義されるBOX2Dを生成します。これは範囲クエリを実行する際に使われます。</p></div><div class="refsection"><a name="idp69497672"></a><h2>例</h2><pre class="programlisting">-- 米国ナショナルアトラス座標のバウンディングボックスに
-- 完全に属するか一部属するフィーチャーの全てを返します。
-- ここでは、ジオメトリはSRID = 2163 (米国ナショナルアトラス正積図法)
-- で保存していると仮定します。
SELECT feature_id, feature_name, the_geom
FROM features
WHERE the_geom &amp;&amp; ST_SetSRID(ST_MakeBox2D(ST_Point(-989502.1875, 528439.5625),
        ST_Point(-987121.375 ,529933.1875)),2163)</pre></div><div class="refsection"><a name="idp69499208"></a><h2>関連情報</h2><p><a class="xref" href="#ST_MakePoint" title="ST_MakePoint">ST_MakePoint</a>, <a class="xref" href="#ST_Point" title="ST_Point">ST_Point</a>, <a class="xref" href="#ST_SetSRID" title="ST_SetSRID">ST_SetSRID</a>, <a class="xref" href="#ST_SRID" title="ST_SRID">ST_SRID</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_3DMakeBox"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_3DMakeBox — 与えられた3次元ポイントジオメトリから定義されるBOX3Dを生成します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">box3d <b class="fsfunc">ST_3DMakeBox</b>(</code>geometry  <var class="pdparam">point3DLowLeftBottom</var>, geometry  <var class="pdparam">point3DUpRightTop</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69507144"></a><h2>説明</h2><p>与えられた二つの3次元ポイントジオメトリから定義されるBOX3Dを生成します。 </p><p><span class="inlinemediaobject"><img src="images/check.png"></span> この関数は3次元に対応し、Zインデクスを削除しません。</p><p>Changed: 2.0.0以前の版ではST_MakeBox3Dと呼ばれていました。</p></div><div class="refsection"><a name="idp69510344"></a><h2>例</h2><pre class="programlisting">SELECT ST_3DMakeBox(ST_MakePoint(-989502.1875, 528439.5625, 10),
        ST_MakePoint(-987121.375 ,529933.1875, 10)) As abb3d

--bb3d--
--------
BOX3D(-989502.1875 528439.5625 10,-987121.375 529933.1875 10)
        </pre></div><div class="refsection"><a name="idp69515976"></a><h2>関連情報</h2><p><a class="xref" href="#ST_MakePoint" title="ST_MakePoint">ST_MakePoint</a>, <a class="xref" href="#ST_SetSRID" title="ST_SetSRID">ST_SetSRID</a>, <a class="xref" href="#ST_SRID" title="ST_SRID">ST_SRID</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_MakeLine"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MakeLine — ポイント、マルチポイント、ラインジオメトリからラインストリングを生成します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_MakeLine</b>(</code>geometry set <var class="pdparam">geoms</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_MakeLine</b>(</code>geometry <var class="pdparam">geom1</var>, geometry <var class="pdparam">geom2</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_MakeLine</b>(</code>geometry[] <var class="pdparam">geoms_array</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69528008"></a><h2>説明</h2><p>ST_MakeLineには三つの形式があります。一つ目は、ポイント、マルチポイントまたはラインジオメトリの行を取り、一つのラインストリングを返す空間集約関数です。二つ目は、イント、マルチポイントまたはラインジオメトリの配列を取る関数です。三つめは、二つのポイント、マルチポイントまたはラインジオメトリを取る通常巻数です。集約関数の形式を使う場合で、関数に渡す前にポイントの順序を整理するには、副問い合わせを使います。</p><p>ポイント、マルチポイント、ラインジオメトリのいずれでもない入力は無視されます。</p><p>ライン要素を追加する時には、共通ノードは出力から削除されます。ポイントとマルチポイントの入力にある共通ノードは削除されません。 </p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p>Availability: 2.3.0 - マルチポイントの入力要素に対応するようになりました。</p><p>Availability: 2.0.0 - ラインストリング入力要素が導入されました。</p><p>Availability: 1.4.0 - ST_MakeLine(geomarray)が導入されました。ST_MakeLine集約関数はより多くのポイントをより早く扱うための強化が施されています。</p></div><div class="refsection"><a name="idp69532616"></a><h2>例: 空間集計版</h2><p>この例では、GPS位置の順列を取り、ジオメトリフィールドがGPSポイントからなるラインストリングで行程順になるよう、行程ごとに一つのレコードを生成します。</p><pre class="programlisting">-- PostgreSQL 9.0より前の版 - これは普通に動きますが、
-- プランナが副問い合わせの並び順を尊重しない選択を発生させることがあります。
SELECT gps.gps_track, ST_MakeLine(gps.the_geom) As newgeom
        FROM (SELECT gps_track, gps_time, the_geom
                        FROM gps_points ORDER BY gps_track, gps_time) As gps
        GROUP BY gps.gps_track;</pre><pre class="programlisting">-- PostgreSQL 9.0以上 (集約関数用の新しいORDER BY機能があります)では、
-- これは、正しく整列したラインストリングが得られることが保証されている方法です。
-- 必要ならORDER BYは複数のカラムで利用できます。
SELECT gps.gps_track, ST_MakeLine(gps.the_geom ORDER BY gps_time) As newgeom
        FROM gps_points As gps
        GROUP BY gps.gps_track;</pre></div><div class="refsection"><a name="idp69534792"></a><h2>例: 非空間集計版</h2><p>一つ目の例は二つのポイントからなる使い捨てのラインストリングです。二つ目は、ユーザが描いた二つのポイントからラインストリングを生成しています。三つ目は、二つの3次元ポイントを接続した使い捨ての3次元ラインを生成しています。</p><pre class="programlisting">SELECT ST_AsText(ST_MakeLine(ST_MakePoint(1,2), ST_MakePoint(3,4)));
          st_astext
---------------------
 LINESTRING(1 2,3 4)

SELECT userpoints.id, ST_MakeLine(startpoint, endpoint) As drawn_line
        FROM userpoints ;

SELECT ST_AsEWKT(ST_MakeLine(ST_MakePoint(1,2,3), ST_MakePoint(3,4,5)));
                st_asewkt
-------------------------
 LINESTRING(1 2 3,3 4 5)
                        </pre></div><div class="refsection"><a name="idp69536456"></a><h2>例: 配列使用版</h2><pre class="programlisting">SELECT ST_MakeLine(ARRAY(SELECT ST_Centroid(the_geom) FROM visit_locations ORDER BY visit_time));

-- 三つの3次元ポイントから3次元ラインを生成
SELECT ST_AsEWKT(ST_MakeLine(ARRAY[ST_MakePoint(1,2,3),
                                ST_MakePoint(3,4,5), ST_MakePoint(6,6,6)]));
                st_asewkt
-------------------------
LINESTRING(1 2 3,3 4 5,6 6 6)
                        </pre></div><div class="refsection"><a name="idp69537992"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a>, <a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a>, <a class="xref" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a>, <a class="xref" href="#ST_MakePoint" title="ST_MakePoint">ST_MakePoint</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_MakeEnvelope"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MakeEnvelope — 与えられた最小値と最大値から長方形ポリゴンを生成します。入力値はSRIDで指定された空間参照系でなければなりません。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_MakeEnvelope</b>(</code>double precision <var class="pdparam">xmin</var>, double precision <var class="pdparam">ymin</var>, double precision <var class="pdparam">xmax</var>, double precision <var class="pdparam">ymax</var>, integer  <var class="pdparam">srid=unknown</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69549128"></a><h2>説明</h2><p>与えられた最小値と最大値から長方形ポリゴンを生成します。入力値はSRIDで指定された空間参照系でなければなりません。SRIDが指定されない場合には、不明な空間参照系と仮定します。</p><p>Availability: 1.5</p><p>Enhanced: 2.0 SRID指定なしでエンベロープを指定できるようになりました。</p></div><div class="refsection"><a name="idp69551048"></a><h2>例: バウンディングボックスポリゴンの生成</h2><pre class="programlisting">SELECT ST_AsText(ST_MakeEnvelope(10, 10, 11, 11, 4326));

st_asewkt
-----------
POLYGON((10 10, 10 11, 11 11, 11 10, 10 10))
                          </pre></div><div class="refsection"><a name="idp69552328"></a><h2>関連情報</h2><p><a class="xref" href="#ST_MakePoint" title="ST_MakePoint">ST_MakePoint</a>, <a class="xref" href="#ST_MakeLine" title="ST_MakeLine">ST_MakeLine</a>, <a class="xref" href="#ST_MakePolygon" title="ST_MakePolygon">ST_MakePolygon</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_MakePolygon"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MakePolygon — 与えられた外環で形成されるポリゴンを生成します。入力ジオメトリは閉じたラインストリングでなければなりません。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_MakePolygon</b>(</code>geometry <var class="pdparam">linestring</var><code>)</code>;</p></div><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_MakePolygon</b>(</code>geometry <var class="pdparam">outerlinestring</var>, geometry[] <var class="pdparam">interiorlinestrings</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69562312"></a><h2>説明</h2><p>与えられた外環で形成されるポリゴンを生成します。入力ジオメトリは閉じたラインストリングでなければなりません。二つの形式があります。</p><p>形式1: 一つの閉じたラインストリングを取るものです。</p><p>形式2: 外環と内環配列を取るものです。ST_AccumまたはPostgreSQLのARRAY[]やARRAY()コンストラクタを使用してジオメトリ配列を生成できます。入力ジオメトリは閉じたラインストリングでなければなりません。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はマルチラインストリングを受け付けません。<a class="xref" href="#ST_LineMerge" title="ST_LineMerge">ST_LineMerge</a>または<a class="xref" href="#ST_Dump" title="ST_Dump">ST_Dump</a>でラインストリングを生成して下さい。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp69567176"></a><h2>例: 単一の閉じたラインストリング</h2><pre class="programlisting">-- 2次元ライン
SELECT ST_MakePolygon(ST_GeomFromText('LINESTRING(75.15 29.53,77 29,77.6 29.5, 75.15 29.53)'));
--If linestring is not closed
--you can add the start point to close it
SELECT ST_MakePolygon(ST_AddPoint(foo.open_line, ST_StartPoint(foo.open_line)))
FROM (
SELECT ST_GeomFromText('LINESTRING(75.15 29.53,77 29,77.6 29.5)') As open_line) As foo;

-- 3次元の閉じたライン
SELECT ST_MakePolygon(ST_GeomFromText('LINESTRING(75.15 29.53 1,77 29 1,77.6 29.5 1, 75.15 29.53 1)'));

st_asewkt
-----------
POLYGON((75.15 29.53 1,77 29 1,77.6 29.5 1,75.15 29.53 1))

-- M値を持つライン --
SELECT ST_MakePolygon(ST_GeomFromText('LINESTRINGM(75.15 29.53 1,77 29 1,77.6 29.5 2, 75.15 29.53 2)'));

st_asewkt
----------
POLYGONM((75.15 29.53 1,77 29 1,77.6 29.5 2,75.15 29.53 2))
                          </pre></div><div class="refsection"><a name="idp69568456"></a><h2>例: 外側の殻と内側の殻</h2><p>蟻の穴を持つドーナツの生成です。</p><pre class="programlisting">SELECT ST_MakePolygon(
                ST_ExteriorRing(ST_Buffer(foo.line,10)),
        ARRAY[ST_Translate(foo.line,1,1),
                ST_ExteriorRing(ST_Buffer(ST_MakePoint(20,20),1)) ]
        )
FROM
        (SELECT ST_ExteriorRing(ST_Buffer(ST_MakePoint(10,10),10,10))
                As line )
                As foo;
                </pre><p>県ポリゴン/マルチポリゴンと水涯線から、湖を表現する穴を持つ県の境界を構築します。PostGISのST_Accumを使う例です。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>NULL配列をST_MakePolygonに渡すとNULLを返すのでCASEを使います。</p></td></tr></table></div><p>
		</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>湖がない県も含めて全ての県が返るのを保障するためにLEFT JOINを使います。</p></td></tr></table></div><pre class="programlisting">SELECT p.gid, p.province_name,
                CASE WHEN
                        ST_Accum(w.the_geom) IS NULL THEN p.the_geom
                ELSE  ST_MakePolygon(ST_LineMerge(ST_Boundary(p.the_geom)), ST_Accum(w.the_geom)) END
        FROM
                provinces p LEFT JOIN waterlines w
                        ON (ST_Within(w.the_geom, p.the_geom) AND ST_IsClosed(w.the_geom))
        GROUP BY p.gid, p.province_name, p.the_geom;

        -- 上と同じ例ですが、相関副問い合わせと行集合を
        -- 配列に変換するPostgreSQL組み込み関数ARRAY()を使っています。


        SELECT p.gid,  p.province_name, CASE WHEN
                EXISTS(SELECT w.the_geom
                        FROM waterlines w
                        WHERE ST_Within(w.the_geom, p.the_geom)
                        AND ST_IsClosed(w.the_geom))
                THEN
                ST_MakePolygon(ST_LineMerge(ST_Boundary(p.the_geom)),
                        ARRAY(SELECT w.the_geom
                                FROM waterlines w
                                WHERE ST_Within(w.the_geom, p.the_geom)
                                AND ST_IsClosed(w.the_geom)))
                ELSE p.the_geom END As the_geom
        FROM
                provinces p;
                          </pre></div><div class="refsection"><a name="idp69571912"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Boundary" title="ST_Boundary">ST_Boundary</a>, <a class="xref" href="#ST_Accum" title="ST_Accum">ST_Accum</a>, <a class="xref" href="#ST_AddPoint" title="ST_AddPoint">ST_AddPoint</a>, <a class="xref" href="#ST_GeometryType" title="ST_GeometryType">ST_GeometryType</a>, <a class="xref" href="#ST_IsClosed" title="ST_IsClosed">ST_IsClosed</a>, <a class="xref" href="#ST_LineMerge" title="ST_LineMerge">ST_LineMerge</a>, <a class="xref" href="#ST_BuildArea" title="ST_BuildArea">ST_BuildArea</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_MakePoint"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MakePoint — 2次元、XYZの3次元または4次元のポイントジオメトリを生成します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_MakePoint</b>(</code>double precision <var class="pdparam">x</var>, double precision <var class="pdparam">y</var><code>)</code>;</p></div><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_MakePoint</b>(</code>double precision <var class="pdparam">x</var>, double precision <var class="pdparam">y</var>, double precision <var class="pdparam">z</var><code>)</code>;</p></div><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_MakePoint</b>(</code>double precision <var class="pdparam">x</var>, double precision <var class="pdparam">y</var>, double precision <var class="pdparam">z</var>, double precision <var class="pdparam">m</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69607496"></a><h2>説明</h2><p>2次元、XYZの3次元、4次元 (M値を持つジオメトリ)のポイントジオメトリを生成します。<code class="varname">ST_MakePoint</code>はOGC準拠ではありませんが、一般的に<a class="xref" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a>や<a class="xref" href="#ST_PointFromText" title="ST_PointFromText">ST_PointFromText</a>より速く、高精度です。また、WKTでなく生の座標値を持っている場合は扱いやすいです。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Xが経度でYが緯度ですのでご注意ください。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>X, Y, Mのポイントを生成する必要がある場合には、<a class="xref" href="#ST_MakePointM" title="ST_MakePointM">ST_MakePointM</a>を使います。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp69612872"></a><h2>例</h2><pre class="programlisting">-- SRID不明のポイントを返します
SELECT ST_MakePoint(-71.1043443253471, 42.3150676015829);

-- WGS 84経度緯度とするポイントを返します。
SELECT ST_SetSRID(ST_MakePoint(-71.1043443253471, 42.3150676015829),4326);

-- 3次元ポイント (たとえば標高を持つ)を返します
SELECT ST_MakePoint(1, 2,1.5);

-- ポイントのZ値を得ます
SELECT ST_Z(ST_MakePoint(1, 2,1.5));
result
-------
1.5</pre></div><div class="refsection"><a name="idp69614152"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a>, <a class="xref" href="#ST_PointFromText" title="ST_PointFromText">ST_PointFromText</a>, <a class="xref" href="#ST_SetSRID" title="ST_SetSRID">ST_SetSRID</a>, <a class="xref" href="#ST_MakePointM" title="ST_MakePointM">ST_MakePointM</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_MakePointM"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MakePointM — X, Y, M座標を持つポイントジオメトリを生成します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_MakePointM</b>(</code>float <var class="pdparam">x</var>, float <var class="pdparam">y</var>, float <var class="pdparam">m</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69623112"></a><h2>説明</h2><p>X, Y, M座標を持つポイントジオメトリを生成します。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Xが経度でYが緯度ですのでご注意ください。</p></td></tr></table></div></div><div class="refsection"><a name="idp69624904"></a><h2>例</h2><p>この例では、文字列表現にST_AsTextでなくST_AsEWKTを使っています。ST_AsTextはM値に対応していないためです。</p><pre class="programlisting">-- SRID不明のポイントのEWKT表現を返します
SELECT ST_AsEWKT(ST_MakePointM(-71.1043443253471, 42.3150676015829, 10));

-- 結果
                                   st_asewkt
-----------------------------------------------
 POINTM(-71.1043443253471 42.3150676015829 10)

-- WGS 84経度緯度とするポイントのEWKT表現を返します
SELECT ST_AsEWKT(ST_SetSRID(ST_MakePointM(-71.1043443253471, 42.3150676015829,10),4326));

                                                st_asewkt
---------------------------------------------------------
SRID=4326;POINTM(-71.1043443253471 42.3150676015829 10)

-- 3次元ポイント (たとえば標高を持つ)を返します
SELECT ST_MakePoint(1, 2,1.5);

-- ポイントのZ値を得ます
SELECT ST_M(ST_MakePointM(-71.1043443253471, 42.3150676015829,10));
result
-------
10
                          </pre></div><div class="refsection"><a name="idp69626568"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a>, <a class="xref" href="#ST_MakePoint" title="ST_MakePoint">ST_MakePoint</a>, <a class="xref" href="#ST_SetSRID" title="ST_SetSRID">ST_SetSRID</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_MLineFromText"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MLineFromText — WKT表現から指定したST_MultiLineString値を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_MLineFromText</b>(</code>text  <var class="pdparam">WKT</var>, integer  <var class="pdparam">srid</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_MLineFromText</b>(</code>text  <var class="pdparam">WKT</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69636296"></a><h2>説明</h2><p>Well-Kown-Text (WKT)表現のコレクションと与えられたSRIDからジオメトリを生成します。SRIDが与えられていない場合は0 (不明)とします。</p><p>OGC SPEC 3.2.6.2 - 任意引数SRIDは仕様適合のためです。</p><p>WKTがMULTILINESTRINGでない場合はNULLを返します。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>全てのWKTジオメトリがマルチラインストリングであると絶対的な確信を持てる場合は、この関数は使わないでください。付加的な評価ステップが追加されるのでST_GeomFromTextより遅いです。 </p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a> s3.2.6.2</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification.SQL-MM 3: 9.4.4</p></div><div class="refsection"><a name="idp69642184"></a><h2>例</h2><pre class="programlisting">SELECT ST_MLineFromText('MULTILINESTRING((1 2, 3 4), (4 5, 6 7))');</pre></div><div class="refsection"><a name="idp69643720"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_MPointFromText"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MPointFromText — Well-Known Text (WKT)表現と与えられたSRIDからジオメトリを生成します。SRIDを与えない場合は0 (不明)となります。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_MPointFromText</b>(</code>text  <var class="pdparam">WKT</var>, integer  <var class="pdparam">srid</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_MPointFromText</b>(</code>text  <var class="pdparam">WKT</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69652680"></a><h2>説明</h2><p>Well-Known Text (WKT)表現と与えられたSRIDからジオメトリを生成します。SRIDが与えられていない場合は0 (不明)となります。</p><p>OGC SPEC 3.2.6.2 - 任意引数SRIDは仕様適合のためです。</p><p>WKTがMULTIPOINTでない場合はNULLを返します。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>全てのWKTジオメトリがマルチラインストリングであると絶対的な確信を持てる場合は、この関数は使わないでください。付加的な評価ステップが追加されるのでST_GeomFromTextより遅いです。 </p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a> 3.2.6.2</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 9.2.4</p></div><div class="refsection"><a name="idp69658568"></a><h2>例</h2><pre class="programlisting">SELECT ST_MPointFromText('MULTIPOINT(1 2, 3 4)');
SELECT ST_MPointFromText('MULTIPOINT(-70.9590 42.1180, -70.9611 42.1223)', 4326);</pre></div><div class="refsection"><a name="idp69660104"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_MPolyFromText"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MPolyFromText — Well-Known Text (WKT)表現と与えられたSRIDからマルチポリゴンを生成します。SRIDが与えられていない場合は0 (不明)となります。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_MPolyFromText</b>(</code>text  <var class="pdparam">WKT</var>, integer  <var class="pdparam">srid</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_MPolyFromText</b>(</code>text  <var class="pdparam">WKT</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69673160"></a><h2>説明</h2><p>Well-Known Text (WKT)表現と与えられたSRIDからマルチポリゴンを生成します。SRIDが与えられていない場合は0 (不明)となります。</p><p>OGC SPEC 3.2.6.2 - 任意引数SRIDは仕様適合のためです。</p><p>WKTがMULTIPOLYGONでない場合はエラーを投げます。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>全てのWKTジオメトリがマルチポリゴンであると絶対的な確信を持てる場合は、この関数は使わないでください。付加的な評価ステップが追加されるのでST_GeomFromTextより遅いです。 </p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a> s3.2.6.2</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 9.6.4</p></div><div class="refsection"><a name="idp69679048"></a><h2>例</h2><pre class="programlisting">SELECT ST_MPolyFromText('MULTIPOLYGON(((0 0 1,20 0 1,20 20 1,0 20 1,0 0 1),(5 5 3,5 7 3,7 7 3,7 5 3,5 5 3)))');
SELECt ST_MPolyFromText('MULTIPOLYGON(((-70.916 42.1002,-70.9468 42.0946,-70.9765 42.0872,-70.9754 42.0875,-70.9749 42.0879,-70.9752 42.0881,-70.9754 42.0891,-70.9758 42.0894,-70.9759 42.0897,-70.9759 42.0899,-70.9754 42.0902,-70.9756 42.0906,-70.9753 42.0907,-70.9753 42.0917,-70.9757 42.0924,-70.9755 42.0928,-70.9755 42.0942,-70.9751 42.0948,-70.9755 42.0953,-70.9751 42.0958,-70.9751 42.0962,-70.9759 42.0983,-70.9767 42.0987,-70.9768 42.0991,-70.9771 42.0997,-70.9771 42.1003,-70.9768 42.1005,-70.977 42.1011,-70.9766 42.1019,-70.9768 42.1026,-70.9769 42.1033,-70.9775 42.1042,-70.9773 42.1043,-70.9776 42.1043,-70.9778 42.1048,-70.9773 42.1058,-70.9774 42.1061,-70.9779 42.1065,-70.9782 42.1078,-70.9788 42.1085,-70.9798 42.1087,-70.9806 42.109,-70.9807 42.1093,-70.9806 42.1099,-70.9809 42.1109,-70.9808 42.1112,-70.9798 42.1116,-70.9792 42.1127,-70.979 42.1129,-70.9787 42.1134,-70.979 42.1139,-70.9791 42.1141,-70.9987 42.1116,-71.0022 42.1273,
        -70.9408 42.1513,-70.9315 42.1165,-70.916 42.1002)))',4326);
</pre></div><div class="refsection"><a name="idp69684680"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a>, <a class="xref" href="#ST_SRID" title="ST_SRID">ST_SRID</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Point"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Point — 与えられた座標値のST_Pointを返します。ST_MakePointのOGC別名です。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Point</b>(</code>float  <var class="pdparam">x_lon</var>, float  <var class="pdparam">y_lat</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69712328"></a><h2>説明</h2><p>与えられた座標値のST_Pointを返します。XとYを取るST_MakePointのMM対応の別名です。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 6.1.2</p></div><div class="refsection"><a name="idp69714888"></a><h2>例: ジオメトリ</h2><pre class="programlisting">SELECT ST_SetSRID(ST_Point(-71.1043443253471, 42.3150676015829),4326)</pre></div><div class="refsection"><a name="idp69716168"></a><h2>例: ジオグラフィ</h2><pre class="programlisting">SELECT CAST(ST_SetSRID(ST_Point(-71.1043443253471, 42.3150676015829),4326) As geography);</pre><pre class="programlisting">-- "::"はPostgreSQLのキャストの簡略表現です。
SELECT ST_SetSRID(ST_Point(-71.1043443253471, 42.3150676015829),4326)::geography;</pre><pre class="programlisting">-- ポイント座標がWGS 84経度緯度と異なる座標系の場合には、
-- キャスト前に投影変換が必要です。
-- この例では、ペンシルベニア州平面 (フィート)からWGS 84に投影変換したうえで
-- ジオグラフィに変換しています。
SELECT ST_Transform(ST_SetSRID(ST_Point(3637510, 3014852),2273),4326)::geography;</pre></div><div class="refsection"><a name="idp69718728"></a><h2>関連情報</h2><p><a class="xref" href="#Geography_Basics" title="4.2.1. ジオグラフィ基礎">「ジオグラフィ基礎」</a>, <a class="xref" href="#ST_MakePoint" title="ST_MakePoint">ST_MakePoint</a>, <a class="xref" href="#ST_SetSRID" title="ST_SetSRID">ST_SetSRID</a>, <a class="xref" href="#ST_Transform" title="ST_Transform">ST_Transform</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_PointFromGeoHash"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_PointFromGeoHash — GeoHash文字列からポイントを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">point <b class="fsfunc">ST_PointFromGeoHash</b>(</code>text  <var class="pdparam">geohash</var>, integer  <var class="pdparam">precision=full_precision_of_geohash</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69726792"></a><h2>説明</h2><p>GeoHash文字列からポイントを返します。ポイントはGeoHashの中心点を表します。</p><p><code class="varname">precision</code>を指定しない場合には、ST_PointFromGeoHashは、入力GeoHash文字列の最大精度に基づくポイントを返します。</p><p><code class="varname">precision</code>を指定した場合には、ST_PointFromGeoHashは、ポイント生成のために、GeoHasoから多数の文字を使用します。</p><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp69729608"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(ST_PointFromGeoHash('9qqj7nmxncgyy4d0dbxqz0'));
          st_astext
------------------------------
 POINT(-115.172816 36.114646)

SELECT ST_AsText(ST_PointFromGeoHash('9qqj7nmxncgyy4d0dbxqz0', 4));
             st_astext
-----------------------------------
 POINT(-115.13671875 36.123046875)

SELECT ST_AsText(ST_PointFromGeoHash('9qqj7nmxncgyy4d0dbxqz0', 10));
                 st_astext
-------------------------------------------
 POINT(-115.172815918922 36.1146435141563)
                
                </pre></div><div class="refsection"><a name="idp69730888"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeoHash" title="ST_GeoHash">ST_GeoHash</a>, <a class="xref" href="#ST_Box2dFromGeoHash" title="ST_Box2dFromGeoHash">ST_Box2dFromGeoHash</a>, <a class="xref" href="#ST_GeomFromGeoHash" title="ST_GeomFromGeoHash">ST_GeomFromGeoHash</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_PointFromText"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_PointFromText — WKTと与えられたSRIDからポイントジオメトリを生成します。SRIDが与えられていない場合は0 (不明)とします。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_PointFromText</b>(</code>text  <var class="pdparam">WKT</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_PointFromText</b>(</code>text  <var class="pdparam">WKT</var>, integer  <var class="pdparam">srid</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69740616"></a><h2>説明</h2><p>OGC Well-Known Text表現からPostGISのST_Geometryポイントオブジェクトを生成します。SRIDが与えられていない場合は不明 (現在は0)とします。ジオメトリがWKTポイント表現でない場合はNULLを返します。完全に不正なWKTならエラーが投げられます。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_PointFromTextには二つの形式があります。 一つ目は、SRIDを取らずに空間参照系を定義していないジオメトリを返すものです。 二つ目は、空間参照系識別番号を第2引数に取り、SRIDをメタデータの一部として含むST_Geometryを返すものです。SRIDはspatial_ref_sysテーブルで定義されていなければなりません。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>全てのWKTジオメトリがジオメトリコレクションであると絶対的な確信を持てる場合は、この関数は使わないでください。付加的な評価ステップが追加されるのでST_GeomFromTextより遅いです。 経度緯度座標からポイントを生成していて、OGC対応よりもパフォーマンスと精度を重視する場合は、<a class="xref" href="#ST_MakePoint" title="ST_MakePoint">ST_MakePoint</a>か、OGC対応の別名である<a class="xref" href="#ST_Point" title="ST_Point">ST_Point</a>を使用して下さい。 </p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a> s3.2.6.2 - 任意引数SRIDは仕様適合のためです。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 6.1.8</p></div><div class="refsection"><a name="idp69747528"></a><h2>例</h2><pre class="programlisting">SELECT ST_PointFromText('POINT(-71.064544 42.28787)');
SELECT ST_PointFromText('POINT(-71.064544 42.28787)', 4326);
        </pre></div><div class="refsection"><a name="idp69748936"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a>, <a class="xref" href="#ST_MakePoint" title="ST_MakePoint">ST_MakePoint</a>, <a class="xref" href="#ST_Point" title="ST_Point">ST_Point</a>, <a class="xref" href="#ST_SRID" title="ST_SRID">ST_SRID</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_PointFromWKB"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_PointFromWKB — WKBと与えられたSRIDからジオメトリを生成します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_GeomFromWKB</b>(</code>bytea  <var class="pdparam">geom</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_GeomFromWKB</b>(</code>bytea  <var class="pdparam">geom</var>, integer  <var class="pdparam">srid</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69771336"></a><h2>説明</h2><p><code class="varname">ST_PointFromWKB</code>は、ジオメトリのWell-Known Binary表現と空間参照系識別番号 (<code class="varname">SRID</code>)を取り、適切なジオメトリタイプのインスタンスを生成します。この場合、<code class="varname">POINT</code>ジオメトリです。この関数はSQLのジオメトリファクトリの役割を果たします。</p><p>SRIDが指定されていない場合は0 (不明)となります。入力<code class="varname">bytea</code>がPOINTジオメトリを表現しないなら<code class="varname">NULL</code>が返されます。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a> s3.2.7.2</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 6.1.9</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p></div><div class="refsection"><a name="idp69780296"></a><h2>例</h2><pre class="programlisting">SELECT
  ST_AsText(
        ST_PointFromWKB(
          ST_AsEWKB('POINT(2 5)'::geometry)
        )
  );
 st_astext
------------
 POINT(2 5)
(1 row)

SELECT
  ST_AsText(
        ST_PointFromWKB(
          ST_AsEWKB('LINESTRING(2 5, 2 6)'::geometry)
        )
  );
 st_astext
-----------

(1 row)</pre></div><div class="refsection"><a name="idp69781832"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeomFromWKB" title="ST_GeomFromWKB">ST_GeomFromWKB</a>, <a class="xref" href="#ST_LineFromWKB" title="ST_LineFromWKB">ST_LineFromWKB</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Polygon"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Polygon — 指定されたラインストリングとSRIDからポリゴンを生成します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Polygon</b>(</code>geometry  <var class="pdparam">aLineString</var>, integer  <var class="pdparam">srid</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69789000"></a><h2>説明</h2><p>指定されたラインストリングとSRIDからポリゴンを生成します。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_PolygonはST_MakePolygonの一つ目の形式に似ていますが、ポリゴンの空間参照系識別番号 (SRID)を渡す点が異なります。MULTILINESTRINGでは動作しません。LineMergeでマルチラインをマージして下さい。また、内環をもつポリゴンを生成しません。ST_MakePolygonを使用して下さい。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a></p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 8.3.2</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp69795528"></a><h2>例</h2><pre class="programlisting">-- 2次元ポリゴン
SELECT ST_Polygon(ST_GeomFromText('LINESTRING(75.15 29.53,77 29,77.6 29.5, 75.15 29.53)'), 4326);

-- 結果 --
POLYGON((75.15 29.53,77 29,77.6 29.5,75.15 29.53))
-- 3次元ポリゴン
SELECT ST_AsEWKT(ST_Polygon(ST_GeomFromEWKT('LINESTRING(75.15 29.53 1,77 29 1,77.6 29.5 1, 75.15 29.53 1)'), 4326));

result
------
SRID=4326;POLYGON((75.15 29.53 1,77 29 1,77.6 29.5 1,75.15 29.53 1))
                        </pre></div><div class="refsection"><a name="idp69797064"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a>, <a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a>, <a class="xref" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a>, <a class="xref" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a>, <a class="xref" href="#ST_LineMerge" title="ST_LineMerge">ST_LineMerge</a>, <a class="xref" href="#ST_MakePolygon" title="ST_MakePolygon">ST_MakePolygon</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_PolygonFromText"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_PolygonFromText — Well-Known Text (WKT)表現と与えられたSRIDからジオメトリを生成します。SRIDを与えない場合は0 (不明)となります。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_PolygonFromText</b>(</code>text  <var class="pdparam">WKT</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_PolygonFromText</b>(</code>text  <var class="pdparam">WKT</var>, integer  <var class="pdparam">srid</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69807944"></a><h2>説明</h2><p>WKT表現と与えられたSRIDからジオメトリを生成します。SRIDが与えられていない場合は0 (不明)とします。WKTがポリゴンでない場合はNULLを返します。</p><p>OGC SPEC 3.2.6.2 - 任意引数SRIDは仕様適合のためです。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>全てのWKTジオメトリがポリゴンであると絶対的な確信を持てる場合は、この関数は使わないでください。付加的な評価ステップが追加されるのでST_GeomFromTextより遅いです。 </p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a> s3.2.6.2</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 8.3.6</p></div><div class="refsection"><a name="idp69813064"></a><h2>例</h2><pre class="programlisting">SELECT ST_PolygonFromText('POLYGON((-71.1776585052917 42.3902909739571,-71.1776820268866 42.3903701743239,
-71.1776063012595 42.3903825660754,-71.1775826583081 42.3903033653531,-71.1776585052917 42.3902909739571))');
st_polygonfromtext
------------------
010300000001000000050000006...


SELECT ST_PolygonFromText('POINT(1 2)') IS NULL as point_is_notpoly;

point_is_not_poly
----------
t
</pre></div><div class="refsection"><a name="idp69814600"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_WKBToSQL"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_WKBToSQL — Well-Known Binary表現 (WKB)からST_Geometry値を生成します。これはSRIDを取らないST_GeomFromWKBの別名です。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_WKBToSQL</b>(</code>bytea  <var class="pdparam">WKB</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69820360"></a><h2>説明</h2><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 5.1.36</p></div><div class="refsection"><a name="idp69822536"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeomFromWKB" title="ST_GeomFromWKB">ST_GeomFromWKB</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_WKTToSQL"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_WKTToSQL — Well-Knwon Text表現 (WKT)から指定したST_Geometry値を返します。これはST_GeomFromTextの別名です。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_WKTToSQL</b>(</code>text  <var class="pdparam">WKT</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp69828296"></a><h2>説明</h2><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 5.1.34</p></div><div class="refsection"><a name="idp69830472"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a></p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Geometry_Accessors"></a>8.5. ジオメトリアクセサ</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#GeometryType">GeometryType</a></span><span class="refpurpose"> — ジオメトリ型を'LINESTRING', 'POLYGON', 'MULTIPOINT'などの文字列で返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Boundary">ST_Boundary</a></span><span class="refpurpose"> — ジオメトリの組み合わせ境界の閉包を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_CoordDim">ST_CoordDim</a></span><span class="refpurpose"> — ST_Geometry値の座標次元を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Dimension">ST_Dimension</a></span><span class="refpurpose"> — ジオメトリの固有次元を返します。ジオメトリは座標次元以下でなければなりません。 </span></dt><dt><span class="refentrytitle"><a href="#ST_EndPoint">ST_EndPoint</a></span><span class="refpurpose"> — <code class="varname">LINESTRING</code>の最後のポイントを<code class="varname">POINT</code>で返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Envelope">ST_Envelope</a></span><span class="refpurpose"> — ジオメトリの浮動小数点数 (float8)バウンディングボックスを表現するジオメトリを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_BoundingDiagonal">ST_BoundingDiagonal</a></span><span class="refpurpose"> — 与えられたジオメトリのバウンディングボックスの対角線を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_ExteriorRing">ST_ExteriorRing</a></span><span class="refpurpose"> — <code class="varname">POLYGON</code>の外環を表現するラインストリングを返します。ジオメトリがポリゴンでない場合はNULLを返します。マルチポリゴンでは動作しません。</span></dt><dt><span class="refentrytitle"><a href="#ST_GeometryN">ST_GeometryN</a></span><span class="refpurpose"> — GEOMETRYCOLLECTION, (MULTI)POINT, (MULTI)LINESTRING, MULTICURVE, (MULTI)POLYGON, POLYHEDRALSURFACEの場合には、1始まりでN番目のジオメトリを返します。それ以外の場合にはNULLを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_GeometryType">ST_GeometryType</a></span><span class="refpurpose"> — ST_Geometry値のジオメトリ型を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_InteriorRingN">ST_InteriorRingN</a></span><span class="refpurpose"> — ポリゴンのN番目の内環を返します。ジオメトリがポリゴンでないかNが範囲外の場合はNULLを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_IsPolygonCCW">ST_IsPolygonCCW </a></span><span class="refpurpose"> — 全ての外環が反時計回りで、全ての内環が時計回りならTRUEを返します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_IsPolygonCW">ST_IsPolygonCW </a></span><span class="refpurpose"> — 入力ジオメトリの全てのポリゴン要素の外環については時計回りで、全ての内環については反時計回りである場合には、TRUEを返します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_IsClosed">ST_IsClosed</a></span><span class="refpurpose"> — <code class="varname">LINESTRING</code>の始点と終点が一致する場合に<code class="varname">TRUE</code>を返します。多面体サーフェスの場合は閉じているかどうか (ボリュームであるかどうか)を返します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_IsCollection">ST_IsCollection</a></span><span class="refpurpose"> — 引数がコレクション(<code class="varname">MULTI*</code>, <code class="varname">GEOMETRYCOLLECTION</code>, ...)の場合に<code class="varname">TRUE</code>を返します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_IsEmpty">ST_IsEmpty</a></span><span class="refpurpose"> — ジオメトリが、空のジオメトリコレクション、ポリゴン、ポイント等の場合に、trueを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_IsRing">ST_IsRing</a></span><span class="refpurpose"> — <code class="varname">LINESTRING</code>が閉じていて、かつ単純である場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_IsSimple">ST_IsSimple</a></span><span class="refpurpose"> — ジオメトリが自己インタセクションや自己接触のような異常な幾何学ポイントを持っていない場合にTRUEを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_IsValid">ST_IsValid</a></span><span class="refpurpose"> — ST_Geometryが整形されている場合には、<code class="varname">true</code>を返します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_IsValidReason">ST_IsValidReason</a></span><span class="refpurpose"> — ジオメトリが妥当か否かを示す文字列を返し、不正な場合は理由を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_IsValidDetail">ST_IsValidDetail</a></span><span class="refpurpose"> — ジオメトリが妥当か否かを示すvalid_detail (valid,reason,location)行を返します。不正である場合には、理由と位置を示します。</span></dt><dt><span class="refentrytitle"><a href="#ST_M">ST_M</a></span><span class="refpurpose"> — ポイントのM座標値を返し、有効でないならNULLを返します。入力はポイントでなければなりません。</span></dt><dt><span class="refentrytitle"><a href="#ST_NDims">ST_NDims</a></span><span class="refpurpose"> — ジオメトリの座標次元をsmall intで返します。値は2, 3, 4のいずれかです。</span></dt><dt><span class="refentrytitle"><a href="#ST_NPoints">ST_NPoints</a></span><span class="refpurpose"> — ジオメトリのポイント (頂点)数を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_NRings">ST_NRings</a></span><span class="refpurpose"> — ジオメトリがポリゴンまたはマルチポリゴンの場合、リング数を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_NumGeometries">ST_NumGeometries</a></span><span class="refpurpose"> — ジオメトリがジオメトリコレクションまたはマルチ系の場合はジオメトリの数を、単一のジオメトリの場合は1を返し、それ以外の場合はNULLを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_NumInteriorRings">ST_NumInteriorRings</a></span><span class="refpurpose"> — ポリゴンジオメトリの内環の数を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_NumInteriorRing">ST_NumInteriorRing</a></span><span class="refpurpose"> — ジオメトリ内のポリゴンの内環の数を返します。ST_NumInteriorRingsと同義です。 </span></dt><dt><span class="refentrytitle"><a href="#ST_NumPatches">ST_NumPatches</a></span><span class="refpurpose"> — 多面体サーフェスのフェイス数を返します。多面体でないジオメトリの場合にはNULLを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_NumPoints">ST_NumPoints</a></span><span class="refpurpose"> — ST_LineStringまたはST_CircularStringのポイント数を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_PatchN">ST_PatchN</a></span><span class="refpurpose"> — ジオメトリがPOLYHEDRALSURFACEかPOLYHEDRALSURFACEMの場合には、1始まりでN番目のジオメトリ (フェイス)を返します。それ以外の場合には、NULLを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_PointN">ST_PointN</a></span><span class="refpurpose"> — ラインストリングまたは曲線ストリングのN番目の点を返します。負数はラインストリングの終端から逆方向に遡って数えます。ジオメトリにラインストリングが無い場合には、NULLを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Points">ST_Points</a></span><span class="refpurpose"> — ジオメトリの全ての座標値からなるマルチポイントを返します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_SRID">ST_SRID</a></span><span class="refpurpose"> — ST_Geometryのspatial_ref_sysテーブルで定義されている空間参照系の識別番号を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_StartPoint">ST_StartPoint</a></span><span class="refpurpose"> — <code class="varname">LINESTRING</code>の最初のポイントを<code class="varname">POINT</code>として返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Summary">ST_Summary</a></span><span class="refpurpose"> — ジオメトリについての要約文を返します。  </span></dt><dt><span class="refentrytitle"><a href="#ST_X">ST_X</a></span><span class="refpurpose"> — ポイントのX座標値を返し、有効でないならNULLを返します。入力はポイントでなければなりません。</span></dt><dt><span class="refentrytitle"><a href="#ST_XMax">ST_XMax</a></span><span class="refpurpose"> — 2次元、3次元バウンディングボックスまたはジオメトリにおけるXの最大値を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_XMin">ST_XMin</a></span><span class="refpurpose"> — 2次元、3次元バウンディングボックスまたはジオメトリにおけるXの最小値を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Y">ST_Y</a></span><span class="refpurpose"> — ポイントのY座標値を返し、有効でないならNULLを返します。入力はポイントでなければなりません。</span></dt><dt><span class="refentrytitle"><a href="#ST_YMax">ST_YMax</a></span><span class="refpurpose"> — 2次元、3次元バウンディングボックスまたはジオメトリにおけるYの最大値を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_YMin">ST_YMin</a></span><span class="refpurpose"> — 2次元、3次元バウンディングボックスまたはジオメトリにおけるYの最小値を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Z">ST_Z</a></span><span class="refpurpose"> — ポイントのZ座標値を返し、有効でないならNULLを返します。入力はポイントでなければなりません。</span></dt><dt><span class="refentrytitle"><a href="#ST_ZMax">ST_ZMax</a></span><span class="refpurpose"> — 2次元、3次元バウンディングボックスまたはジオメトリにおけるZの最大値を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Zmflag">ST_Zmflag</a></span><span class="refpurpose"> — ポイントのZM (次元の意味)フラグをsmall intで返します。値は 0=XY, 1=XYM, 2=XYZ, 3=XYZMとなります。</span></dt><dt><span class="refentrytitle"><a href="#ST_ZMin">ST_ZMin</a></span><span class="refpurpose"> — 2次元、3次元バウンディングボックスまたはジオメトリにおけるZの最大値を返します。</span></dt></dl></div><div class="refentry"><a name="GeometryType"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>GeometryType — ジオメトリ型を'LINESTRING', 'POLYGON', 'MULTIPOINT'などの文字列で返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">GeometryType</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp70446664"></a><h2>説明</h2><p>ジオメトリ型を'LINESTRING', 'POLYGON', 'MULTIPOINT'などの文字列で返します。</p><p>OGC SPEC s2.1.1.1 - このジオメトリインスタンスがメンバーになっているジオメトリのインスタンス化可能な派生タイプの名前を返します。インスタンス化可能な派生タイプの名前は、文字列として返されます。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数は、'POINTM'等が返るので、ジオメトリがM値を持っているかどうかも示します。</p></td></tr></table></div><p>Enhanced: 2.0.0 多面体サーフェス対応、三角対応、TIN対応が導入されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a></p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div><div class="refsection"><a name="idp70456392"></a><h2>例</h2><pre class="programlisting">SELECT GeometryType(ST_GeomFromText('LINESTRING(77.29 29.07,77.42 29.26,77.27 29.31,77.29 29.07)'));
 geometrytype
--------------
 LINESTRING
</pre><pre class="programlisting">SELECT ST_GeometryType(ST_GeomFromEWKT('POLYHEDRALSURFACE( ((0 0 0, 0 0 1, 0 1 1, 0 1 0, 0 0 0)),
                ((0 0 0, 0 1 0, 1 1 0, 1 0 0, 0 0 0)), ((0 0 0, 1 0 0, 1 0 1, 0 0 1, 0 0 0)),
                ((1 1 0, 1 1 1, 1 0 1, 1 0 0, 1 1 0)),
                ((0 1 0, 0 1 1, 1 1 1, 1 1 0, 0 1 0)), ((0 0 1, 1 0 1, 1 1 1, 0 1 1, 0 0 1)) )'));
                        -- 結果 --
                        POLYHEDRALSURFACE
                        </pre><pre class="programlisting">SELECT GeometryType(geom) as result
  FROM
    (SELECT
       ST_GeomFromEWKT('TIN (((
                0 0 0,
                0 0 1,
                0 1 0,
                0 0 0
            )), ((
                0 0 0,
                0 1 0,
                1 1 0,
                0 0 0
            ))
            )')  AS geom
    ) AS g;
 result
--------
 TIN    </pre></div><div class="refsection"><a name="idp70458952"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeometryType" title="ST_GeometryType">ST_GeometryType</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Boundary"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Boundary — ジオメトリの組み合わせ境界の閉包を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Boundary</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp70468808"></a><h2>説明</h2><p>ジオメトリの組み合わせ境界の閉包を返します (訳注: ラインストリングは端点、ポリゴンはエッジ、複合オブジェクトは境界のうち奇数番)。組み合わせ境界はOGC仕様の3.12.3.2節に記述されています。結果として出てくる境界は、OGC SPEC 3.12.2で議論されているように、ジオメトリプリミティブを使って表現できます。</p><p>GEOSモジュールによって実現しています。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>2.0.0より前の版では、この関数は<code class="varname">GEOMETRYCOLLECTION</code>.を与えると例外を投げました。2.0.0以上では代わりにNULLが返ります (非対応入力)。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a> OGC SPEC s2.1.1.1</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 5.1.14</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p>Enhanced: 2.1.0で三角対応が導入されました。</p></div><div class="refsection"><a name="idp70480456"></a><h2>例</h2><div class="informaltable"><table class="informaltable" border="1"><colgroup><col><col></colgroup><tbody><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_boundary01.png"><div class="caption"><p>境界ポイントを重ねたラインストリング</p></div></div></div><p>
				</p><pre class="programlisting">SELECT ST_Boundary(geom)
FROM (SELECT 'LINESTRING(100 150,50 60, 70 80, 160 170)'::geometry As geom) As f;
                                </pre><p>
</p><pre class="screen">-- ST_AsText 出力
MULTIPOINT(100 150,160 170)
</pre><p>
						  </p></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_boundary02.png"><div class="caption"><p>境界マルチラインストリングを重ねたポリゴンの穴</p></div></div></div><p>
				</p><pre class="programlisting">SELECT ST_Boundary(geom)
FROM (SELECT
'POLYGON (( 10 130, 50 190, 110 190, 140 150, 150 80, 100 10, 20 40, 10 130 ),
        ( 70 40, 100 50, 120 80, 80 110, 50 90, 70 40 ))'::geometry As geom) As f;
                                </pre><p>
</p><pre class="screen">-- ST_AsText 出力 --
MULTILINESTRING((10 130,50 190,110 190,140 150,150 80,100 10,20 40,10 130),
        (70 40,100 50,120 80,80 110,50 90,70 40))
</pre><p>
						</p></td></tr></tbody></table></div><pre class="programlisting">SELECT ST_AsText(ST_Boundary(ST_GeomFromText('LINESTRING(1 1,0 0, -1 1)')));
st_astext
-----------
MULTIPOINT(1 1,-1 1)

SELECT ST_AsText(ST_Boundary(ST_GeomFromText('POLYGON((1 1,0 0, -1 1, 1 1))')));
st_astext
----------
LINESTRING(1 1,0 0,-1 1,1 1)

-- 3次元ポリゴンを使用
SELECT ST_AsEWKT(ST_Boundary(ST_GeomFromEWKT('POLYGON((1 1 1,0 0 1, -1 1 1, 1 1 1))')));

st_asewkt
-----------------------------------
LINESTRING(1 1 1,0 0 1,-1 1 1,1 1 1)

-- 3次元マルチラインストリングを使用
SELECT ST_AsEWKT(ST_Boundary(ST_GeomFromEWKT('MULTILINESTRING((1 1 1,0 0 0.5, -1 1 1),(1 1 0.5,0 0 0.5, -1 1 0.5, 1 1 0.5) )')));

st_asewkt
----------
MULTIPOINT(-1 1 1,1 1 0.75)
</pre></div><div class="refsection"><a name="idp70490568"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a>, <a class="xref" href="#ST_ExteriorRing" title="ST_ExteriorRing">ST_ExteriorRing</a>, <a class="xref" href="#ST_MakePolygon" title="ST_MakePolygon">ST_MakePolygon</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_CoordDim"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_CoordDim — ST_Geometry値の座標次元を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_CoordDim</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp70497096"></a><h2>説明</h2><p>ST_Geometry値の座標次元を返します。</p><p>この関数は<a class="xref" href="#ST_NDims" title="ST_NDims">ST_NDims</a>のMM対応の別名です。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a></p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 5.1.3</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div><div class="refsection"><a name="idp70507336"></a><h2>例</h2><pre class="programlisting">SELECT ST_CoordDim('CIRCULARSTRING(1 2 3, 1 3 4, 5 6 7, 8 9 10, 11 12 13)');
                        -- 結果 --
                                3

                                SELECT ST_CoordDim(ST_Point(1,2));
                        -- 結果 --
                                2

                </pre></div><div class="refsection"><a name="idp70508872"></a><h2>関連情報</h2><p><a class="xref" href="#ST_NDims" title="ST_NDims">ST_NDims</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Dimension"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Dimension — ジオメトリの固有次元を返します。ジオメトリは座標次元以下でなければなりません。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_Dimension</b>(</code>geometry  <var class="pdparam">g</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp70535240"></a><h2>説明</h2><p>ジオメトリの固有次元を返します。ジオメトリは座標次元以下でなければなりません。OGC SPEC s2.1.1.1 - 0なら<code class="varname">POINT</code>、1なら<code class="varname">LINESTRING</code>、2なら<code class="varname">POLYGON</code>で、<code class="varname">GEOMETRYCOLLECTION</code>の場合は要素ごとの次元の最大値です。不明なジオメトリ (空ジオメトリ)の場合はNULLが返ります。 </p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 5.1.2</p><p>Enhanced: 2.0.0 多面体サーフェス対応とTIN対応が導入されました。空ジオメトリを与えた場合に例外を投げなくなりました。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>2.0.0より前では、空ジオメトリを与えると例外を投げていました。 </p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div><div class="refsection"><a name="idp70543176"></a><h2>例</h2><pre class="programlisting">SELECT ST_Dimension('GEOMETRYCOLLECTION(LINESTRING(1 1,0 0),POINT(0 0))');
ST_Dimension
-----------
1
</pre></div><div class="refsection"><a name="idp70556744"></a><h2>関連情報</h2><p><a class="xref" href="#ST_NDims" title="ST_NDims">ST_NDims</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_EndPoint"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_EndPoint — <code class="varname">LINESTRING</code>の最後のポイントを<code class="varname">POINT</code>で返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_EndPoint</b>(</code>geometry  <var class="pdparam">g</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp70563144"></a><h2>説明</h2><p><code class="varname">LINESTRING</code>の最後のポイントを<code class="varname">POINT</code>で返します。パラメタが<code class="varname">LINESTRING</code>でない場合は<code class="varname">NULL</code>を返します。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 7.1.4</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Changed: 2.0.0では単一ジオメトリのMULTILINESTRINGで動作しなくなりました。単一のラインストリングからなるMULTILINESTRINGについては幸運にも動いていて、最初のポイントを返していました。2.0.0では他のMULTILINESTRINGと同様にNULLを返すようになりました。古い挙動は記載されていませんでしたが、LINESTRINGとして格納されているデータを持っていると思われる人々は2.0でNULLが返って来ることを経験することでしょう。</p></td></tr></table></div></div><div class="refsection"><a name="idp70570440"></a><h2>例</h2><pre class="programlisting">postgis=# SELECT ST_AsText(ST_EndPoint('LINESTRING(1 1, 2 2, 3 3)'::geometry));
 st_astext
------------
 POINT(3 3)
(1 row)

postgis=# SELECT ST_EndPoint('POINT(1 1)'::geometry) IS NULL AS is_null;
  is_null
----------
 t
(1 row)

-- 3次元の最後のポイント
SELECT ST_AsEWKT(ST_EndPoint('LINESTRING(1 1 2, 1 2 3, 0 0 5)'));
  st_asewkt
--------------
 POINT(0 0 5)
(1 row)</pre></div><div class="refsection"><a name="idp70571720"></a><h2>関連情報</h2><p><a class="xref" href="#ST_PointN" title="ST_PointN">ST_PointN</a>, <a class="xref" href="#ST_StartPoint" title="ST_StartPoint">ST_StartPoint</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Envelope"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Envelope — ジオメトリの浮動小数点数 (float8)バウンディングボックスを表現するジオメトリを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Envelope</b>(</code>geometry  <var class="pdparam">g1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp70577992"></a><h2>説明</h2><p>ジオメトリのfloat8数の最小バウンディングボックスをジオメトリとして返します。バウンディングボックスの角で定義されたポリゴンで、 ((<code class="varname">MINX</code>, <code class="varname">MINY</code>), (<code class="varname">MINX</code>, <code class="varname">MAXY</code>), (<code class="varname">MAXX</code>, <code class="varname">MAXY</code>), (<code class="varname">MAXX</code>, <code class="varname">MINY</code>), (<code class="varname">MINX</code>, <code class="varname">MINY</code>))となります。可能なら<code class="varname">ZMIN</code>/<code class="varname">ZMAX</code>座標が追加されます。</p><p>縮退する場合 (縦のライン、ポイント)は<code class="varname">POLYGON</code>より低い次元のジオメトリ、すなわち<code class="varname">POINT</code>または<code class="varname">LINESTRING</code>を返します。</p><p>Availability: 1.5.0 挙動が変更され出力がfloat4からfloat8になりました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a> s2.1.1.1</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 5.1.15</p></div><div class="refsection"><a name="idp70588744"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(ST_Envelope('POINT(1 3)'::geometry));
 st_astext
------------
 POINT(1 3)
(1 row)


SELECT ST_AsText(ST_Envelope('LINESTRING(0 0, 1 3)'::geometry));
                   st_astext
--------------------------------
 POLYGON((0 0,0 3,1 3,1 0,0 0))
(1 row)


SELECT ST_AsText(ST_Envelope('POLYGON((0 0, 0 1, 1.0000001 1, 1.0000001 0, 0 0))'::geometry));
                                                  st_astext
--------------------------------------------------------------
 POLYGON((0 0,0 1,1.00000011920929 1,1.00000011920929 0,0 0))
(1 row)
SELECT ST_AsText(ST_Envelope('POLYGON((0 0, 0 1, 1.0000000001 1, 1.0000000001 0, 0 0))'::geometry));
                                                  st_astext
--------------------------------------------------------------
 POLYGON((0 0,0 1,1.00000011920929 1,1.00000011920929 0,0 0))
(1 row)

SELECT Box3D(geom), Box2D(geom), ST_AsText(ST_Envelope(geom)) As envelopewkt
        FROM (SELECT 'POLYGON((0 0, 0 1000012333334.34545678, 1.0000001 1, 1.0000001 0, 0 0))'::geometry As geom) As foo;


        </pre><div class="informalfigure"><div class="mediaobject"><img src="images/st_envelope01.png"><div class="caption"><p>ポイントとラインストリングの最小バウンディングボックス</p></div></div></div><pre class="programlisting">SELECT ST_AsText(ST_Envelope(
                ST_Collect(
                        ST_GeomFromText('LINESTRING(55 75,125 150)'),
                                ST_Point(20, 80))
                                )) As wktenv;
wktenv
-----------
POLYGON((20 75,20 150,125 150,125 75,20 75))</pre></div><div class="refsection"><a name="idp70592968"></a><h2>関連情報</h2><p><a class="xref" href="#Box2D" title="Box2D">Box2D</a>, <a class="xref" href="#Box3D" title="Box3D">Box3D</a>, <a class="xref" href="#ST_OrientedEnvelope" title="ST_OrientedEnvelope">ST_OrientedEnvelope</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_BoundingDiagonal"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_BoundingDiagonal — 与えられたジオメトリのバウンディングボックスの対角線を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_BoundingDiagonal</b>(</code>geometry  <var class="pdparam">geom</var>, boolean  <var class="pdparam">fits=false</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp70600648"></a><h2>説明</h2><p>与えられたジオメトリのバウンディングボックスの対角線をラインストリングで返します。入力ジオメトリが空の場合には、対角線も空になります。その他の場合には、最小値のポイントを始点とし、最大値のポイントを終点とする、二つのポイントからなるラインストリングになります。 </p><p>返されるラインストリングは常に、入力ジオメトリのSRIDと次元 (ZとMがあること)を維持します。 </p><p><code class="varname">fits</code>パラメータは、最良適合が必要かどうかを指定するものです。FALSEの場合には、幾分大きめなバウンディングボックスの対角線を受け付けることができます (多数の頂点からなるジオメトリの取得が早くなります)。いずれにしても返された対角線のバウンディングボックスは常に入力ジオメトリを含みます。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>縮退した (入力の頂点が一つ)場合、返されるラインストリングはトポロジ的に不正です (内部が無い)。返り値を意味的な不正にはしません。 </p></td></tr></table></div><p>Availability: 2.2.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports M coordinates.</p></div><div class="refsection"><a name="idp70636360"></a><h2>例</h2><pre class="programlisting">-- ポイントまわりのバッファのXの最小値を得ます
SELECT ST_X(ST_StartPoint(ST_BoundingDiagonal(
  ST_Buffer(ST_MakePoint(0,0),10)
)));
 st_x
------
  -10
                </pre></div><div class="refsection"><a name="idp70637640"></a><h2>関連情報</h2><p><a class="xref" href="#ST_StartPoint" title="ST_StartPoint">ST_StartPoint</a>, <a class="xref" href="#ST_EndPoint" title="ST_EndPoint">ST_EndPoint</a>, <a class="xref" href="#ST_X" title="ST_X">ST_X</a>, <a class="xref" href="#ST_Y" title="ST_Y">ST_Y</a>, <a class="xref" href="#ST_Z" title="ST_Z">ST_Z</a>, <a class="xref" href="#ST_M" title="ST_M">ST_M</a>, <a class="xref" href="#geometry_overlaps_nd" title="&amp;&amp;&amp;">&amp;&amp;&amp;</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_ExteriorRing"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ExteriorRing — <code class="varname">POLYGON</code>の外環を表現するラインストリングを返します。ジオメトリがポリゴンでない場合はNULLを返します。マルチポリゴンでは動作しません。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_ExteriorRing</b>(</code>geometry  <var class="pdparam">a_polygon</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp70666568"></a><h2>説明</h2><p><code class="varname">POLYGON</code>の外環を表現するラインストリングを返します。ジオメトリがポリゴンでない場合はNULLを返します。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>POLYGONタイプでのみ動作します。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a> 2.1.5.1</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 8.2.3, 8.3.3</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp70677064"></a><h2>例</h2><pre class="programlisting">-- ポリゴンのテーブルを持っているとします
SELECT gid, ST_ExteriorRing(the_geom) AS ering
FROM sometable;

-- マルチポリゴンのテーブルを持っていて、
-- それぞれのポリゴンの外環からなるマルチラインストリングを返させたいとします。
SELECT gid, ST_Collect(ST_ExteriorRing(the_geom)) AS erings
        FROM (SELECT gid, (ST_Dump(the_geom)).geom As the_geom
                        FROM sometable) As foo
GROUP BY gid;

--3次元の例
SELECT ST_AsEWKT(
        ST_ExteriorRing(
        ST_GeomFromEWKT('POLYGON((0 0 1, 1 1 1, 1 2 1, 1 1 1, 0 0 1))')
        )
);

st_asewkt
---------
LINESTRING(0 0 1,1 1 1,1 2 1,1 1 1,0 0 1)
</pre></div><div class="refsection"><a name="idp70678344"></a><h2>関連情報</h2><p><a class="xref" href="#ST_InteriorRingN" title="ST_InteriorRingN">ST_InteriorRingN</a>, <a class="xref" href="#ST_Boundary" title="ST_Boundary">ST_Boundary</a>, <a class="xref" href="#ST_NumInteriorRings" title="ST_NumInteriorRings">ST_NumInteriorRings</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_GeometryN"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_GeometryN — GEOMETRYCOLLECTION, (MULTI)POINT, (MULTI)LINESTRING, MULTICURVE, (MULTI)POLYGON, POLYHEDRALSURFACEの場合には、1始まりでN番目のジオメトリを返します。それ以外の場合にはNULLを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_GeometryN</b>(</code>geometry  <var class="pdparam">geomA</var>, integer  <var class="pdparam">n</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp70686024"></a><h2>説明</h2><p>GEOMETRYCOLLECTION, (MULTI)POINT, (MULTI)LINESTRING, MULTICURVE, (MULTI)POLYGON, POLYHEDRALSURFACEの場合には、1始まりでN番目のジオメトリを返します。それ以外の場合にはNULLを返します。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>OGC仕様のため0.8.0版からインデクスを1始まりにしています。これより前の版では0始まりになっています。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>一つのジオメトリから全てのジオメトリを抽出したい場合は、ST_Dumpを使う方が効果的ですし、単一ジオメトリにも対応しています。</p></td></tr></table></div><p>Enhanced: 2.0.0 多面体サーフェス対応、三角対応、TIN対応が導入されました。</p><p>Changed: 2.0.0 以前の版では非マルチのジオメトリではNULLが返りました。ST_GeometryN(..,1)の場合にはジオメトリを返すよう変更されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a></p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 9.1.5</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div><div class="refsection"><a name="idp70697800"></a><h2>標準的な例</h2><pre class="programlisting">-- 3次元マルチポイントから部分集合を抽出
SELECT n, ST_AsEWKT(ST_GeometryN(the_geom, n)) As geomewkt
FROM (
VALUES (ST_GeomFromEWKT('MULTIPOINT(1 2 7, 3 4 7, 5 6 7, 8 9 10)') ),
( ST_GeomFromEWKT('MULTICURVE(CIRCULARSTRING(2.5 2.5,4.5 2.5, 3.5 3.5), (10 11, 12 11))') )
        )As foo(the_geom)
        CROSS JOIN generate_series(1,100) n
WHERE n &lt;= ST_NumGeometries(the_geom);

 n |               geomewkt
---+-----------------------------------------
 1 | POINT(1 2 7)
 2 | POINT(3 4 7)
 3 | POINT(5 6 7)
 4 | POINT(8 9 10)
 1 | CIRCULARSTRING(2.5 2.5,4.5 2.5,3.5 3.5)
 2 | LINESTRING(10 11,12 11)


-- 全てのジオメトリを抽出(idを付けたい場合に便利です)
SELECT gid, n, ST_GeometryN(the_geom, n)
FROM sometable CROSS JOIN generate_series(1,100) n
WHERE n &lt;= ST_NumGeometries(the_geom);</pre></div><div class="refsection"><a name="idp70699080"></a><h2>多面体サーフェス、TIN、三角形の例</h2><pre class="programlisting">-- 多面体サーフェスの例
-- 多面体サーフェスをフェイスに分解します。
SELECT ST_AsEWKT(ST_GeometryN(p_geom,3)) As geom_ewkt
  FROM (SELECT ST_GeomFromEWKT('POLYHEDRALSURFACE(
((0 0 0, 0 0 1, 0 1 1, 0 1 0, 0 0 0)),
((0 0 0, 0 1 0, 1 1 0, 1 0 0, 0 0 0)),
((0 0 0, 1 0 0, 1 0 1, 0 0 1, 0 0 0)),
((1 1 0, 1 1 1, 1 0 1, 1 0 0, 1 1 0)),
((0 1 0, 0 1 1, 1 1 1, 1 1 0, 0 1 0)),
((0 0 1, 1 0 1, 1 1 1, 0 1 1, 0 0 1))
)')  AS p_geom )  AS a;

                geom_ewkt
------------------------------------------
 POLYGON((0 0 0,1 0 0,1 0 1,0 0 1,0 0 0))</pre><pre class="programlisting">-- TIN --
SELECT ST_AsEWKT(ST_GeometryN(geom,2)) as wkt
  FROM
    (SELECT
       ST_GeomFromEWKT('TIN (((
                0 0 0,
                0 0 1,
                0 1 0,
                0 0 0
            )), ((
                0 0 0,
                0 1 0,
                1 1 0,
                0 0 0
            ))
            )')  AS geom
    ) AS g;
-- 結果--
                 wkt
-------------------------------------
 TRIANGLE((0 0 0,0 1 0,1 1 0,0 0 0))</pre></div><div class="refsection"><a name="idp70701000"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Dump" title="ST_Dump">ST_Dump</a>, <a class="xref" href="#ST_NumGeometries" title="ST_NumGeometries">ST_NumGeometries</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_GeometryType"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_GeometryType — ST_Geometry値のジオメトリ型を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_GeometryType</b>(</code>geometry  <var class="pdparam">g1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp70707144"></a><h2>説明</h2><p>ジオメトリ型を'ST_Linestring', 'ST_Polygon', 'ST_MultiPolygon'等の文字列で返します。この関数はGeometryType(geometry)とは異なり、先頭に'ST'が付き、M値を持っているかを示しません。</p><p>Enhanced: 2.0.0 多面体サーフェス対応が導入されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 5.1.4</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p></div><div class="refsection"><a name="idp70712904"></a><h2>例</h2><pre class="programlisting">SELECT ST_GeometryType(ST_GeomFromText('LINESTRING(77.29 29.07,77.42 29.26,77.27 29.31,77.29 29.07)'));
                        -- 結果
                        ST_LineString</pre><pre class="programlisting">SELECT ST_GeometryType(ST_GeomFromEWKT('POLYHEDRALSURFACE( ((0 0 0, 0 0 1, 0 1 1, 0 1 0, 0 0 0)),
                ((0 0 0, 0 1 0, 1 1 0, 1 0 0, 0 0 0)), ((0 0 0, 1 0 0, 1 0 1, 0 0 1, 0 0 0)),
                ((1 1 0, 1 1 1, 1 0 1, 1 0 0, 1 1 0)),
                ((0 1 0, 0 1 1, 1 1 1, 1 1 0, 0 1 0)), ((0 0 1, 1 0 1, 1 1 1, 0 1 1, 0 0 1)) )'));
                        --結果 --
                        ST_PolyhedralSurface</pre><pre class="programlisting">SELECT ST_GeometryType(ST_GeomFromEWKT('POLYHEDRALSURFACE( ((0 0 0, 0 0 1, 0 1 1, 0 1 0, 0 0 0)),
                ((0 0 0, 0 1 0, 1 1 0, 1 0 0, 0 0 0)), ((0 0 0, 1 0 0, 1 0 1, 0 0 1, 0 0 0)),
                ((1 1 0, 1 1 1, 1 0 1, 1 0 0, 1 1 0)),
                ((0 1 0, 0 1 1, 1 1 1, 1 1 0, 0 1 0)), ((0 0 1, 1 0 1, 1 1 1, 0 1 1, 0 0 1)) )'));
                        --結果 --
                        ST_PolyhedralSurface</pre><pre class="programlisting">SELECT ST_GeometryType(geom) as result
  FROM
    (SELECT
       ST_GeomFromEWKT('TIN (((
                0 0 0,
                0 0 1,
                0 1 0,
                0 0 0
            )), ((
                0 0 0,
                0 1 0,
                1 1 0,
                0 0 0
            ))
            )')  AS geom
    ) AS g;
 result
--------
 ST_Tin    </pre></div><div class="refsection"><a name="idp70715720"></a><h2>関連情報</h2><p><a class="xref" href="#GeometryType" title="GeometryType">GeometryType</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_InteriorRingN"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_InteriorRingN — ポリゴンのN番目の内環を返します。ジオメトリがポリゴンでないかNが範囲外の場合はNULLを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_InteriorRingN</b>(</code>geometry  <var class="pdparam">a_polygon</var>, integer  <var class="pdparam">n</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp70734792"></a><h2>説明</h2><p>ポリゴンのN番目の内環となるラインストリングを返します。ジオメトリがポリゴンでないかNが範囲外の場合はNULLを返します。1始まりです。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はマルチポリゴンでは動作しません。マルチポリゴンに対してはST_Dumpを併用して下さい。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a></p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 8.2.6, 8.3.5</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp70753608"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(ST_InteriorRingN(the_geom, 1)) As the_geom
FROM (SELECT ST_BuildArea(
                ST_Collect(ST_Buffer(ST_Point(1,2), 20,3),
                        ST_Buffer(ST_Point(1, 2), 10,3))) As the_geom
                )  as foo
                </pre></div><div class="refsection"><a name="idp70755144"></a><h2>関連情報</h2><p><a class="xref" href="#ST_ExteriorRing" title="ST_ExteriorRing">ST_ExteriorRing</a> <a class="xref" href="#ST_BuildArea" title="ST_BuildArea">ST_BuildArea</a>, <a class="xref" href="#ST_Collect" title="ST_Collect">ST_Collect</a>, <a class="xref" href="#ST_Dump" title="ST_Dump">ST_Dump</a>, <a class="xref" href="#ST_NumInteriorRing" title="ST_NumInteriorRing">ST_NumInteriorRing</a>, <a class="xref" href="#ST_NumInteriorRings" title="ST_NumInteriorRings">ST_NumInteriorRings</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_IsPolygonCCW"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_IsPolygonCCW  — 全ての外環が反時計回りで、全ての内環が時計回りならTRUEを返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef"> boolean <b class="fsfunc">ST_IsPolygonCCW</b> (</code> geometry <var class="pdparam">geom</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp70763336"></a><h2>説明</h2><p>入力ジオメトリの全てのポリゴン要素の外環については反時計回りで、全ての内環については時計回りである場合には、TRUEを返します。 </p><p>ジオメトリがポリゴン要素を持っていない場合にはTRUEを返します。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>閉じたラインストリングはポリゴン要素とみなされません。単一の閉じたラインストリングを渡すと、右回り左回りにかかわらずTRUEが得られます。 </p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ポリゴン要素の内環が逆回りになっていない (すなわち外環と同じ方向で回る内環が1個以上ある)場合には、ST_IsPolygonCWとST_IsPolygonCCW の両方ともにFALSEを返します。 </p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports M coordinates.</p></div><div class="refsection"><a name="idp70781512"></a><h2>関連情報</h2><p><a class="xref" href="#ST_ForcePolygonCW" title="ST_ForcePolygonCW">ST_ForcePolygonCW </a>, <a class="xref" href="#ST_ForcePolygonCCW" title="ST_ForcePolygonCCW">ST_ForcePolygonCCW </a>, <a class="xref" href="#ST_IsPolygonCW" title="ST_IsPolygonCW">ST_IsPolygonCW </a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_IsPolygonCW"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_IsPolygonCW  — 入力ジオメトリの全てのポリゴン要素の外環については時計回りで、全ての内環については反時計回りである場合には、TRUEを返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef"> boolean <b class="fsfunc">ST_IsPolygonCW</b> (</code> geometry <var class="pdparam">geom</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp70788552"></a><h2>説明</h2><p>入力ジオメトリの全てのポリゴン要素の外環については時計回りで、全ての内環については反時計回りである場合には、TRUEを返します。 </p><p>ジオメトリがポリゴン要素を持っていない場合にはTRUEを返します。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>閉じたラインストリングはポリゴン要素とみなされません。単一の閉じたラインストリングを渡すと、右回り左回りにかかわらずTRUEが得られます。 </p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ポリゴン要素の内環が逆回りになっていない (すなわち外環と同じ方向で回る内環が1個以上ある)場合には、ST_IsPolygonCWとST_IsPolygonCCW の両方ともにFALSEを返します。 </p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports M coordinates.</p></div><div class="refsection"><a name="idp70794440"></a><h2>関連情報</h2><p><a class="xref" href="#ST_ForcePolygonCW" title="ST_ForcePolygonCW">ST_ForcePolygonCW </a>, <a class="xref" href="#ST_ForcePolygonCCW" title="ST_ForcePolygonCCW">ST_ForcePolygonCCW </a>, <a class="xref" href="#ST_IsPolygonCW" title="ST_IsPolygonCW">ST_IsPolygonCW </a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_IsClosed"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_IsClosed — <code class="varname">LINESTRING</code>の始点と終点が一致する場合に<code class="varname">TRUE</code>を返します。多面体サーフェスの場合は閉じているかどうか (ボリュームであるかどうか)を返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_IsClosed</b>(</code>geometry  <var class="pdparam">g</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp70801736"></a><h2>説明</h2><p><code class="varname">LINESTRING</code>の始点と終点が一致する場合に<code class="varname">TRUE</code>を返します。多面体サーフェスの場合は面であるか (開いているか)、またはボリュームであるか (閉じているか)を返します。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a></p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 7.1.5, 9.3.3</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>SQL-MMでは<code class="function">ST_IsClosed(<code class="varname">NULL</code>)</code>は0を返しますが、PostGISでは<code class="varname">NULL</code>を返します。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p>Enhanced: 2.0.0 多面体サーフェス対応が導入されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p></div><div class="refsection"><a name="idp70812872"></a><h2>ラインストリングとポイントの例</h2><pre class="programlisting">postgis=# SELECT ST_IsClosed('LINESTRING(0 0, 1 1)'::geometry);
 st_isclosed
-------------
 f
(1 row)

postgis=# SELECT ST_IsClosed('LINESTRING(0 0, 0 1, 1 1, 0 0)'::geometry);
 st_isclosed
-------------
 t
(1 row)

postgis=# SELECT ST_IsClosed('MULTILINESTRING((0 0, 0 1, 1 1, 0 0),(0 0, 1 1))'::geometry);
 st_isclosed
-------------
 f
(1 row)

postgis=# SELECT ST_IsClosed('POINT(0 0)'::geometry);
 st_isclosed
-------------
 t
(1 row)

postgis=# SELECT ST_IsClosed('MULTIPOINT((0 0), (1 1))'::geometry);
 st_isclosed
-------------
 t
(1 row)</pre></div><div class="refsection"><a name="idp70818248"></a><h2>多面体サーフェスの例</h2><pre class="programlisting">-- 立方体 --
                SELECT ST_IsClosed(ST_GeomFromEWKT('POLYHEDRALSURFACE( ((0 0 0, 0 0 1, 0 1 1, 0 1 0, 0 0 0)),
                ((0 0 0, 0 1 0, 1 1 0, 1 0 0, 0 0 0)), ((0 0 0, 1 0 0, 1 0 1, 0 0 1, 0 0 0)),
                ((1 1 0, 1 1 1, 1 0 1, 1 0 0, 1 1 0)),
                ((0 1 0, 0 1 1, 1 1 1, 1 1 0, 0 1 0)), ((0 0 1, 1 0 1, 1 1 1, 0 1 1, 0 0 1)) )'));

 st_isclosed
-------------
 t


 -- 立方体のようなものだけれども側面が一つ無いもの--
 SELECT ST_IsClosed(ST_GeomFromEWKT('POLYHEDRALSURFACE( ((0 0 0, 0 0 1, 0 1 1, 0 1 0, 0 0 0)),
                ((0 0 0, 0 1 0, 1 1 0, 1 0 0, 0 0 0)), ((0 0 0, 1 0 0, 1 0 1, 0 0 1, 0 0 0)),
                ((1 1 0, 1 1 1, 1 0 1, 1 0 0, 1 1 0)),
                ((0 1 0, 0 1 1, 1 1 1, 1 1 0, 0 1 0)) )'));

 st_isclosed
-------------
 f

</pre></div><div class="refsection"><a name="idp70819528"></a><h2>関連情報</h2><p><a class="xref" href="#ST_IsRing" title="ST_IsRing">ST_IsRing</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_IsCollection"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_IsCollection — 引数がコレクション(<code class="varname">MULTI*</code>, <code class="varname">GEOMETRYCOLLECTION</code>, ...)の場合に<code class="varname">TRUE</code>を返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_IsCollection</b>(</code>geometry  <var class="pdparam">g</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp70826440"></a><h2>説明</h2><p>引数が次のいずれかの場合には<code class="varname">TRUE</code>を返します。 </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>ジオメトリコレクション</p></li><li class="listitem"><p>マルチポイント、マルチポリゴン、マルチラインストリング、マルチ曲線、マルチサーフェス</p></li><li class="listitem"><p>複合曲線</p></li></ul></div><p>
                </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はジオメトリのタイプを解析します。これは、空のコレクションである場合、または一つのエレメントを持つコレクションである場合には<code class="varname">TRUE</code>を返すことを意味します。 </p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p></div><div class="refsection"><a name="idp70833736"></a><h2>例</h2><pre class="programlisting">postgis=# SELECT ST_IsCollection('LINESTRING(0 0, 1 1)'::geometry);
 st_iscollection
-------------
 f
(1 row)

postgis=# SELECT ST_IsCollection('MULTIPOINT EMPTY'::geometry);
 st_iscollection
-------------
 t
(1 row)

postgis=# SELECT ST_IsCollection('MULTIPOINT((0 0))'::geometry);
 st_iscollection
-------------
 t
(1 row)

postgis=# SELECT ST_IsCollection('MULTIPOINT((0 0), (42 42))'::geometry);
 st_iscollection
-------------
 t
(1 row)

postgis=# SELECT ST_IsCollection('GEOMETRYCOLLECTION(POINT(0 0))'::geometry);
 st_iscollection
-------------
 t
(1 row)</pre></div><div class="refsection"><a name="idp70835016"></a><h2>関連情報</h2><p><a class="xref" href="#ST_NumGeometries" title="ST_NumGeometries">ST_NumGeometries</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_IsEmpty"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_IsEmpty — ジオメトリが、空のジオメトリコレクション、ポリゴン、ポイント等の場合に、trueを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_IsEmpty</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp70844872"></a><h2>説明</h2><p>ジオメトリが空ジオメトリの場合にtrueを返します。 trueの場合には、このジオメトリは、空のジオメトリコレクション、ポリゴン、ポイント等です。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>SQL-MMでは、ST_IsEmpty(NULL)は0を返しますが、PostGISではNULLを返します。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a> s2.1.1.1</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 5.1.7</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Changed: 2.0.0 以前の版のPostGISではST_GeomFromText('GEOMETRYCOLLECTION(EMPTY)')を許しました。PostGIS 2.0.0では、SQL/MM標準により準拠させるため、これは不正となります。</p></td></tr></table></div></div><div class="refsection"><a name="idp70851528"></a><h2>例</h2><pre class="programlisting">SELECT ST_IsEmpty(ST_GeomFromText('GEOMETRYCOLLECTION EMPTY'));
 st_isempty
------------
 t
(1 row)

 SELECT ST_IsEmpty(ST_GeomFromText('POLYGON EMPTY'));
 st_isempty
------------
 t
(1 row)

SELECT ST_IsEmpty(ST_GeomFromText('POLYGON((1 2, 3 4, 5 6, 1 2))'));

 st_isempty
------------
 f
(1 row)

 SELECT ST_IsEmpty(ST_GeomFromText('POLYGON((1 2, 3 4, 5 6, 1 2))')) = false;
 ?column?
----------
 t
(1 row)

 SELECT ST_IsEmpty(ST_GeomFromText('CIRCULARSTRING EMPTY'));
  st_isempty
------------
 t
(1 row)


                </pre></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_IsRing"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_IsRing — <code class="varname">LINESTRING</code>が閉じていて、かつ単純である場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_IsRing</b>(</code>geometry  <var class="pdparam">g</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp70857928"></a><h2>説明</h2><p><code class="varname">LINESTRING</code>が<a class="xref" href="#ST_IsClosed" title="ST_IsClosed">ST_IsClosed</a> (<code class="function">ST_StartPoint(<em class="parameter"><code>g</code></em>)</code> <code class="function">~=</code> <code class="function">ST_Endpoint(<em class="parameter"><code>g</code></em>)</code>)で、かつ<a class="xref" href="#ST_IsSimple" title="ST_IsSimple">ST_IsSimple</a> (自己インタセクションが無い)場合に<code class="varname">TRUE</code>を返します。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a> 2.1.5.1</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 7.1.6</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>SQL-MMでは、<code class="function">ST_IsRing(<code class="varname">NULL</code>)</code>は0を返しますが、PostGISでは<code class="varname">NULL</code>を返します。</p></td></tr></table></div></div><div class="refsection"><a name="idp70868168"></a><h2>例</h2><pre class="programlisting">SELECT ST_IsRing(the_geom), ST_IsClosed(the_geom), ST_IsSimple(the_geom)
FROM (SELECT 'LINESTRING(0 0, 0 1, 1 1, 1 0, 0 0)'::geometry AS the_geom) AS foo;
 st_isring | st_isclosed | st_issimple
-----------+-------------+-------------
 t         | t           | t
(1 row)

SELECT ST_IsRing(the_geom), ST_IsClosed(the_geom), ST_IsSimple(the_geom)
FROM (SELECT 'LINESTRING(0 0, 0 1, 1 0, 1 1, 0 0)'::geometry AS the_geom) AS foo;
 st_isring | st_isclosed | st_issimple
-----------+-------------+-------------
 f         | t           | f
(1 row)</pre></div><div class="refsection"><a name="idp70869448"></a><h2>関連情報</h2><p><a class="xref" href="#ST_IsClosed" title="ST_IsClosed">ST_IsClosed</a>, <a class="xref" href="#ST_IsSimple" title="ST_IsSimple">ST_IsSimple</a>, <a class="xref" href="#ST_StartPoint" title="ST_StartPoint">ST_StartPoint</a>, <a class="xref" href="#ST_EndPoint" title="ST_EndPoint">ST_EndPoint</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_IsSimple"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_IsSimple — ジオメトリが自己インタセクションや自己接触のような異常な幾何学ポイントを持っていない場合にTRUEを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_IsSimple</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp70876360"></a><h2>説明</h2><p>ジオメトリが自己インタセクションや自己接触のような異常な幾何学ポイントを持っていない場合にTRUEを返します。OGCのジオメトリ単純性と妥当性の定義に関する詳細情報については<a class="link" href="#OGC_Validity" title="4.3.5. ジオメトリのOpenGIS準拠を確実にする">「ジオメトリのOpenGIS準拠を確実にする」</a>をご覧ください。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>SQL-MMでは、ST_IsSimple(NULL)は0を返しますが、PostGISではNULLを返します。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a> s2.1.1.1</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 5.1.8</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp70887368"></a><h2>例</h2><pre class="programlisting">SELECT ST_IsSimple(ST_GeomFromText('POLYGON((1 2, 3 4, 5 6, 1 2))'));
 st_issimple
-------------
 t
(1 row)

 SELECT ST_IsSimple(ST_GeomFromText('LINESTRING(1 1,2 2,2 3.5,1 3,1 2,2 1)'));
 st_issimple
-------------
 f
(1 row)</pre></div><div class="refsection"><a name="idp70888648"></a><h2>関連情報</h2><p><a class="xref" href="#ST_IsValid" title="ST_IsValid">ST_IsValid</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_IsValid"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_IsValid — ST_Geometryが整形されている場合には、<code class="varname">true</code>を返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_IsValid</b>(</code>geometry  <var class="pdparam">g</var><code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">ST_IsValid</b>(</code>geometry  <var class="pdparam">g</var>, integer  <var class="pdparam">flags</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp70897992"></a><h2>説明</h2><p>ST_Geometry値が整形されているかを見ます。不正なジオメトリに対しては、その理由の詳細をPostgreSQLのNOTICEで提供します。OGCのジオメトリ単純性と妥当性の定義に関する詳細情報については<a class="link" href="#OGC_Validity" title="4.3.5. ジオメトリのOpenGIS準拠を確実にする">「ジオメトリのOpenGIS準拠を確実にする」</a>をご覧ください。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>SQL-MMでは、ST_IsValid(NULL)は0を返しますが、PostGISではNULLを返します。</p></td></tr></table></div><p>flagsを受け付ける形式が2.0.0で追加されました。GEOS 3.3.0以上が必要です。不正の説明をPostgreSQLのNOTICEで印字しません。許される<code class="varname">flags</code>については<a class="xref" href="#ST_IsValidDetail" title="ST_IsValidDetail">ST_IsValidDetail</a>をご覧ください。 </p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a></p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 5.1.9</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>OGC-SFSもSQL-MMもST_IsValidでフラグ引数を含む仕様になっていません。フラグはPostGIS独自拡張です。 </p></td></tr></table></div></div><div class="refsection"><a name="idp70958536"></a><h2>例</h2><pre class="programlisting">SELECT ST_IsValid(ST_GeomFromText('LINESTRING(0 0, 1 1)')) As good_line,
        ST_IsValid(ST_GeomFromText('POLYGON((0 0, 1 1, 1 2, 1 1, 0 0))')) As bad_poly
-- 結果
NOTICE:  Self-intersection at or near point 0 0
 good_line | bad_poly
-----------+----------
 t         | f
</pre></div><div class="refsection"><a name="idp70959816"></a><h2>関連情報</h2><p><a class="xref" href="#ST_IsSimple" title="ST_IsSimple">ST_IsSimple</a>, <a class="xref" href="#ST_IsValidReason" title="ST_IsValidReason">ST_IsValidReason</a>, <a class="xref" href="#ST_IsValidDetail" title="ST_IsValidDetail">ST_IsValidDetail</a>, <a class="xref" href="#ST_Summary" title="ST_Summary">ST_Summary</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_IsValidReason"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_IsValidReason — ジオメトリが妥当か否かを示す文字列を返し、不正な場合は理由を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_IsValidReason</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">ST_IsValidReason</b>(</code>geometry  <var class="pdparam">geomA</var>, integer  <var class="pdparam">flags</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp70990536"></a><h2>説明</h2><p>ジオメトリが妥当か否かを示す文字列を返し、不正な場合は理由を返します。</p><p>ST_IsValidと併用して、不正なジオメトリとその理由の細かい報告を生成するのに便利です。</p><p>許される<code class="varname">flags</code>は、 <a class="xref" href="#ST_IsValidDetail" title="ST_IsValidDetail">ST_IsValidDetail</a>にあります。 </p><p>Availability: 1.4 - GEOS 3.1.0以上が必要です</p><p>Availability: 2.0 - flagsを受け付ける形式はGEOS 3.3.0以上が必要です。</p></div><div class="refsection"><a name="idp70993992"></a><h2>例</h2><pre class="programlisting">-- 試験に成功した5レコードを除いた最初の3レコード
SELECT gid, ST_IsValidReason(the_geom) as validity_info
FROM
(SELECT ST_MakePolygon(ST_ExteriorRing(e.buff), ST_Accum(f.line)) As the_geom, gid
FROM (SELECT ST_Buffer(ST_MakePoint(x1*10,y1), z1) As buff, x1*10 + y1*100 + z1*1000 As gid
        FROM generate_series(-4,6) x1
        CROSS JOIN generate_series(2,5) y1
        CROSS JOIN generate_series(1,8) z1
        WHERE x1 &gt; y1*0.5 AND z1 &lt; x1*y1) As e
        INNER JOIN (SELECT ST_Translate(ST_ExteriorRing(ST_Buffer(ST_MakePoint(x1*10,y1), z1)),y1*1, z1*2) As line
        FROM generate_series(-3,6) x1
        CROSS JOIN generate_series(2,5) y1
        CROSS JOIN generate_series(1,10) z1
        WHERE x1 &gt; y1*0.75 AND z1 &lt; x1*y1) As f
ON (ST_Area(e.buff) &gt; 78 AND ST_Contains(e.buff, f.line))
GROUP BY gid, e.buff) As quintuplet_experiment
WHERE ST_IsValid(the_geom) = false
ORDER BY gid
LIMIT 3;

 gid  |      validity_info
------+--------------------------
 5330 | Self-intersection [32 5]
 5340 | Self-intersection [42 5]
 5350 | Self-intersection [52 5]

-- 単純なものの例
SELECT ST_IsValidReason('LINESTRING(220227 150406,2220227 150407,222020 150410)');

 st_isvalidreason
------------------
 Valid Geometry

                </pre></div><div class="refsection"><a name="idp70995528"></a><h2>関連情報</h2><p><a class="xref" href="#ST_IsValid" title="ST_IsValid">ST_IsValid</a>, <a class="xref" href="#ST_Summary" title="ST_Summary">ST_Summary</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_IsValidDetail"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_IsValidDetail — ジオメトリが妥当か否かを示すvalid_detail (valid,reason,location)行を返します。不正である場合には、理由と位置を示します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">valid_detail <b class="fsfunc">ST_IsValidDetail</b>(</code>geometry  <var class="pdparam">geom</var><code>)</code>;</p><p><code class="funcdef">valid_detail <b class="fsfunc">ST_IsValidDetail</b>(</code>geometry  <var class="pdparam">geom</var>, integer  <var class="pdparam">flags</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp71045832"></a><h2>説明</h2><p>valid_detail行を返します。validはboolean型で、ジオメトリが妥当かを示します。reasonはvarchar型で、不正の理由を示します。locationはジオメトリ型で、不正になっている位置を示します。</p><p>不正なジオメトリの詳細報告を生成するためのST_IsValidとST_IsValidReasonの組み合わせを代替し、かつ改良するものとして使われます。</p><p>引数'flags'はビットフィールドです。次の値を取ることができます。 </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>1: 穴を形成する自己インタセクトする環を妥当と考慮します。「ESRIフラグ」とも言われます。これはOGCモデルと対立します。 </p></li></ul></div><p>
		</p><p>Availability: 2.0.0 - GEOS 3.3.0以上が必要 </p></div><div class="refsection"><a name="idp71049288"></a><h2>例</h2><pre class="programlisting">-- 成功した五つの実験から不合格となったもののうち最初の三つ
SELECT gid, reason(ST_IsValidDetail(the_geom)), ST_AsText(location(ST_IsValidDetail(the_geom))) as location
FROM
(SELECT ST_MakePolygon(ST_ExteriorRing(e.buff), ST_Accum(f.line)) As the_geom, gid
FROM (SELECT ST_Buffer(ST_MakePoint(x1*10,y1), z1) As buff, x1*10 + y1*100 + z1*1000 As gid
        FROM generate_series(-4,6) x1
        CROSS JOIN generate_series(2,5) y1
        CROSS JOIN generate_series(1,8) z1
        WHERE x1 &gt; y1*0.5 AND z1 &lt; x1*y1) As e
        INNER JOIN (SELECT ST_Translate(ST_ExteriorRing(ST_Buffer(ST_MakePoint(x1*10,y1), z1)),y1*1, z1*2) As line
        FROM generate_series(-3,6) x1
        CROSS JOIN generate_series(2,5) y1
        CROSS JOIN generate_series(1,10) z1
        WHERE x1 &gt; y1*0.75 AND z1 &lt; x1*y1) As f
ON (ST_Area(e.buff) &gt; 78 AND ST_Contains(e.buff, f.line))
GROUP BY gid, e.buff) As quintuplet_experiment
WHERE ST_IsValid(the_geom) = false
ORDER BY gid
LIMIT 3;

 gid  |      reason       |  location
------+-------------------+-------------
 5330 | Self-intersection | POINT(32 5)
 5340 | Self-intersection | POINT(42 5)
 5350 | Self-intersection | POINT(52 5)

 -- 単純な例
SELECT * FROM ST_IsValidDetail('LINESTRING(220227 150406,2220227 150407,222020 150410)');

 valid | reason | location
-------+--------+----------
 t     |        |

                </pre></div><div class="refsection"><a name="idp71050824"></a><h2>関連情報</h2><p><a class="xref" href="#ST_IsValid" title="ST_IsValid">ST_IsValid</a>, <a class="xref" href="#ST_IsValidReason" title="ST_IsValidReason">ST_IsValidReason</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_M"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_M — ポイントのM座標値を返し、有効でないならNULLを返します。入力はポイントでなければなりません。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_M</b>(</code>geometry  <var class="pdparam">a_point</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp71057096"></a><h2>説明</h2><p>ポイントのM座標値を返し、有効でないならNULLを返します。入力はポイントでなければなりません。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これは (いまだに)OGC仕様に入っていませんが、ポイント座標抽出関数のリストを完全にするために挙げています。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a></p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp71063368"></a><h2>例</h2><pre class="programlisting">SELECT ST_M(ST_GeomFromEWKT('POINT(1 2 3 4)'));
 st_m
------
        4
(1 row)

                </pre></div><div class="refsection"><a name="idp71064904"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a>, <a class="xref" href="#ST_X" title="ST_X">ST_X</a>, <a class="xref" href="#ST_Y" title="ST_Y">ST_Y</a>, <a class="xref" href="#ST_Z" title="ST_Z">ST_Z</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_NDims"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_NDims — ジオメトリの座標次元をsmall intで返します。値は2, 3, 4のいずれかです。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_NDims</b>(</code>geometry  <var class="pdparam">g1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp71071816"></a><h2>説明</h2><p>ジオメトリの座標次元返します。PostGISでは、2 - (X,Y), 3 - (X,Y,Z), (X,Y,M), 4 - (X,Y,Z,M)に対応しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp71074376"></a><h2>例</h2><pre class="programlisting">SELECT ST_NDims(ST_GeomFromText('POINT(1 1)')) As d2point,
        ST_NDims(ST_GeomFromEWKT('POINT(1 1 2)')) As d3point,
        ST_NDims(ST_GeomFromEWKT('POINTM(1 1 0.5)')) As d2pointm;

         d2point | d3point | d2pointm
---------+---------+----------
           2 |       3 |        3
                        </pre></div><div class="refsection"><a name="idp71075656"></a><h2>関連情報</h2><p><a class="xref" href="#ST_CoordDim" title="ST_CoordDim">ST_CoordDim</a>, <a class="xref" href="#ST_Dimension" title="ST_Dimension">ST_Dimension</a>, <a class="xref" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_NPoints"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_NPoints — ジオメトリのポイント (頂点)数を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_NPoints</b>(</code>geometry  <var class="pdparam">g1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp71082184"></a><h2>説明</h2><p>ジオメトリのポイントの数を返します。全てのジオメトリに対して動作します。</p><p>Enhanced: 2.0.0 多面体サーフェス対応が導入されました。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>1.3.4より前では、曲線を含むジオメトリで使用すると、この関数はクラッシュします。これは1.3.4以上で訂正されています。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p></div><div class="refsection"><a name="idp71092296"></a><h2>例</h2><pre class="programlisting">SELECT ST_NPoints(ST_GeomFromText('LINESTRING(77.29 29.07,77.42 29.26,77.27 29.31,77.29 29.07)'));
-- 結果
4

-- 3次元空間上のポリゴン
SELECT ST_NPoints(ST_GeomFromEWKT('LINESTRING(77.29 29.07 1,77.42 29.26 0,77.27 29.31 -1,77.29 29.07 3)'))
-- 結果
4</pre></div><div class="refsection"><a name="idp71093576"></a><h2>関連情報</h2><p><a class="xref" href="#ST_NumPoints" title="ST_NumPoints">ST_NumPoints</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_NRings"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_NRings — ジオメトリがポリゴンまたはマルチポリゴンの場合、リング数を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_NRings</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp71099336"></a><h2>説明</h2><p>ジオメトリがポリゴンまたはマルチポリゴンの場合、リング数を返します。NumInteriorRingsと違い、外環も数えます。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p></div><div class="refsection"><a name="idp71103048"></a><h2>例</h2><pre class="programlisting">SELECT ST_NRings(the_geom) As Nrings, ST_NumInteriorRings(the_geom) As ninterrings
                                        FROM (SELECT ST_GeomFromText('POLYGON((1 2, 3 4, 5 6, 1 2))') As the_geom) As foo;
         nrings | ninterrings
--------+-------------
          1 |           0
(1 row)
</pre></div><div class="refsection"><a name="idp71104584"></a><h2>関連情報</h2><p><a class="xref" href="#ST_NumInteriorRings" title="ST_NumInteriorRings">ST_NumInteriorRings</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_NumGeometries"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_NumGeometries — ジオメトリがジオメトリコレクションまたはマルチ系の場合はジオメトリの数を、単一のジオメトリの場合は1を返し、それ以外の場合はNULLを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_NumGeometries</b>(</code>geometry  <var class="pdparam">geom</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp71110344"></a><h2>説明</h2><p>ジオメトリの数を返します。ジオメトリがジオメトリコレクションまたはマルチ系の場合は、ジオメトリの数を返し、単一のジオメトリの場合は1を返し、それ以外の場合はNULLを返します。</p><p>Enhanced: 2.0.0 多面体サーフェス対応、三角対応、TIN対応が導入されました。</p><p>Changed: 2.0.0 前の版では、ジオメトリがコレクション/マルチ系でない場合にはNULLを返しました。2.0.0以上では、POLYGON, LINESTRING, POINTといった単一ジオメトリについては1を返します。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 9.1.4</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div><div class="refsection"><a name="idp71121992"></a><h2>例</h2><pre class="programlisting">-- 以前の版ではNULLが返りました
-- 2.0.0から1が返ります
SELECT ST_NumGeometries(ST_GeomFromText('LINESTRING(77.29 29.07,77.42 29.26,77.27 29.31,77.29 29.07)'));
-- 結果
1

-- ジオメトリコレクションの例
-- - マルチ系はコレクションで一つのジオメトリと数えます。
SELECT ST_NumGeometries(ST_GeomFromEWKT('GEOMETRYCOLLECTION(MULTIPOINT(-2 3 , -2 2),
LINESTRING(5 5 ,10 10),
POLYGON((-7 4.2,-7.1 5,-7.1 4.3,-7 4.2)))'));
-- 結果
3
</pre></div><div class="refsection"><a name="idp71123272"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeometryN" title="ST_GeometryN">ST_GeometryN</a>, <a class="xref" href="#ST_Multi" title="ST_Multi">ST_Multi</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_NumInteriorRings"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_NumInteriorRings — ポリゴンジオメトリの内環の数を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_NumInteriorRings</b>(</code>geometry  <var class="pdparam">a_polygon</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp71129416"></a><h2>説明</h2><p>ポリゴンジオメトリの内環の数を返します。ジオメトリがポリゴンでない場合には、NULLを返します。 </p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 8.2.5</p><p>Changed: 2.0.0 - 以前の版では、MULTIPOLYGONを渡して最初のPOLYGONの内環の数を返すことができました。</p></div><div class="refsection"><a name="idp71132360"></a><h2>例</h2><pre class="programlisting">-- 通常のポリゴンの場合
SELECT gid, field1, field2, ST_NumInteriorRings(the_geom) AS numholes
FROM sometable;

-- マルチポリゴンの内環の総数を知りたい場合
SELECT gid, field1, field2, SUM(ST_NumInteriorRings(the_geom)) AS numholes
FROM (SELECT gid, field1, field2, (ST_Dump(the_geom)).geom As the_geom
        FROM sometable) As foo
GROUP BY gid, field1,field2;
                        </pre></div><div class="refsection"><a name="idp71133640"></a><h2>関連情報</h2><p><a class="xref" href="#ST_NumInteriorRing" title="ST_NumInteriorRing">ST_NumInteriorRing</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_NumInteriorRing"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_NumInteriorRing — ジオメトリ内のポリゴンの内環の数を返します。ST_NumInteriorRingsと同義です。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_NumInteriorRing</b>(</code>geometry  <var class="pdparam">a_polygon</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp71139400"></a><h2>関連情報</h2><p><a class="xref" href="#ST_NumInteriorRings" title="ST_NumInteriorRings">ST_NumInteriorRings</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_NumPatches"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_NumPatches — 多面体サーフェスのフェイス数を返します。多面体でないジオメトリの場合にはNULLを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_NumPatches</b>(</code>geometry  <var class="pdparam">g1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp71145160"></a><h2>説明</h2><p>多面体サーフェスのフェイス数を返します。多面体でないジオメトリの場合にはNULLを返します。ST_NumGeometriesの別名で、MMの名前付けに対応するためのものです。MM規約を気にしない場合はST_NumGeometriesの方が速いです。</p><p>Availability: 2.0.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a></p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: ?</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p></div><div class="refsection"><a name="idp71152456"></a><h2>例</h2><pre class="programlisting">SELECT ST_NumPatches(ST_GeomFromEWKT('POLYHEDRALSURFACE( ((0 0 0, 0 0 1, 0 1 1, 0 1 0, 0 0 0)),
                ((0 0 0, 0 1 0, 1 1 0, 1 0 0, 0 0 0)), ((0 0 0, 1 0 0, 1 0 1, 0 0 1, 0 0 0)),
                ((1 1 0, 1 1 1, 1 0 1, 1 0 0, 1 1 0)),
                ((0 1 0, 0 1 1, 1 1 1, 1 1 0, 0 1 0)), ((0 0 1, 1 0 1, 1 1 1, 0 1 1, 0 0 1)) )'));
                -- 結果 --
                6
                </pre></div><div class="refsection"><a name="idp71153736"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a>, <a class="xref" href="#ST_NumGeometries" title="ST_NumGeometries">ST_NumGeometries</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_NumPoints"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_NumPoints — ST_LineStringまたはST_CircularStringのポイント数を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_NumPoints</b>(</code>geometry  <var class="pdparam">g1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp71159880"></a><h2>説明</h2><p>ST_LineStringまたはST_CircularStringのポイント数を返します。1.4より前は仕様通りにラインストリングにのみ対応していました。1.4以上ではラインストリングだけでなく頂点数を返すST_NPointsの別名です。多目的で多数のジオメトリタイプで動作するST_NPointsを使うことを考えて下さい。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a></p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 7.2.4</p></div><div class="refsection"><a name="idp71163976"></a><h2>例</h2><pre class="programlisting">SELECT ST_NumPoints(ST_GeomFromText('LINESTRING(77.29 29.07,77.42 29.26,77.27 29.31,77.29 29.07)'));
                -- 結果
                4
                </pre></div><div class="refsection"><a name="idp71165256"></a><h2>関連情報</h2><p><a class="xref" href="#ST_NPoints" title="ST_NPoints">ST_NPoints</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_PatchN"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_PatchN — ジオメトリがPOLYHEDRALSURFACEかPOLYHEDRALSURFACEMの場合には、1始まりでN番目のジオメトリ (フェイス)を返します。それ以外の場合には、NULLを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_PatchN</b>(</code>geometry  <var class="pdparam">geomA</var>, integer  <var class="pdparam">n</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp71172040"></a><h2>説明</h2><p>
&gt;ジオメトリがPOLYHEDRALSURFACEかPOLYHEDRALSURFACEMの場合には、1始まりでN番目のジオメトリ (フェイス)を返します。それ以外の場合には、NULLを返します。多面体サーフェスを引数にとるST_GeometryNと同じ答えが返ります。ST_GeometryNの方が速いです。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>インデクスは1始まりです。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>一つのジオメトリから全てのジオメトリを抽出したい場合は、ST_Dumpを使う方が効率的です。</p></td></tr></table></div><p>Availability: 2.0.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: ?</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p></div><div class="refsection"><a name="idp71179464"></a><h2>例</h2><pre class="programlisting">-- 多面体サーフェスの2番目のフェイスを抽出
SELECT ST_AsEWKT(ST_PatchN(geom, 2)) As geomewkt
FROM (
VALUES (ST_GeomFromEWKT('POLYHEDRALSURFACE( ((0 0 0, 0 0 1, 0 1 1, 0 1 0, 0 0 0)),
        ((0 0 0, 0 1 0, 1 1 0, 1 0 0, 0 0 0)), ((0 0 0, 1 0 0, 1 0 1, 0 0 1, 0 0 0)),
        ((1 1 0, 1 1 1, 1 0 1, 1 0 0, 1 1 0)),
        ((0 1 0, 0 1 1, 1 1 1, 1 1 0, 0 1 0)), ((0 0 1, 1 0 1, 1 1 1, 0 1 1, 0 0 1)) )')) ) As foo(geom);

              geomewkt
---+-----------------------------------------
 POLYGON((0 0 0,0 1 0,1 1 0,1 0 0,0 0 0))
</pre></div><div class="refsection"><a name="idp71181000"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a>, <a class="xref" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a>, <a class="xref" href="#ST_Dump" title="ST_Dump">ST_Dump</a>, <a class="xref" href="#ST_GeometryN" title="ST_GeometryN">ST_GeometryN</a>, <a class="xref" href="#ST_NumGeometries" title="ST_NumGeometries">ST_NumGeometries</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_PointN"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_PointN — ラインストリングまたは曲線ストリングのN番目の点を返します。負数はラインストリングの終端から逆方向に遡って数えます。ジオメトリにラインストリングが無い場合には、NULLを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_PointN</b>(</code>geometry  <var class="pdparam">a_linestring</var>, integer  <var class="pdparam">n</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp71189320"></a><h2>説明</h2><p>ラインストリングまたは曲線ストリングのN番目の点を返します。負数はラインストリングの終端から逆方向に遡って数えます。-1は終端を指します。ジオメトリにラインストリングが無い場合には、NULLを返します。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>OGC仕様のため0.8.0版からインデックスを1始まりにしています。これより前の版では0はじまりになっています。後方インデックス (負数インデックス)はOGC仕様ではありません。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>マルチラインストリングからN番目のポイントを得たい場合には、ST_Dumpを併用して下さい。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a></p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 7.2.5, 7.3.5</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Changed: 2.0.0 単一ジオメトリのMULTILINESTRINGで動作しなくなりました。単一のラインストリングからなるMULTILINESTRINGについては幸運にも動いていて、最初のポイントを返していました。2.0.0では他のMULTILINESTRINGと同様にNULLを返すようになりました。</p><p>Changed: 2.3.0 : 負数インデックスが有効になりました (-1は終端を指します) </p></td></tr></table></div></div><div class="refsection"><a name="idp71210952"></a><h2>例</h2><pre class="programlisting">-- LINESTRINGから全てのPOINTを抽出
SELECT ST_AsText(
   ST_PointN(
          column1,
          generate_series(1, ST_NPoints(column1))
   ))
FROM ( VALUES ('LINESTRING(0 0, 1 1, 2 2)'::geometry) ) AS foo;

 st_astext
------------
 POINT(0 0)
 POINT(1 1)
 POINT(2 2)
(3 rows)

-- CIRCULARSTRINGの例
SELECT ST_AsText(ST_PointN(ST_GeomFromText('CIRCULARSTRING(1 2, 3 2, 1 2)'),2));

st_astext
----------
POINT(3 2)

SELECT st_astext(f)
FROM ST_GeometryFromtext('LINESTRING(0 0 0, 1 1 1, 2 2 2)') as g
        ,ST_PointN(g, -2) AS f -- 1 based index

st_astext
----------
"POINT Z (1 1 1)"

</pre></div><div class="refsection"><a name="idp71212232"></a><h2>関連情報</h2><p><a class="xref" href="#ST_NPoints" title="ST_NPoints">ST_NPoints</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Points"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Points — ジオメトリの全ての座標値からなるマルチポイントを返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Points</b>(</code> geometry <var class="pdparam">geom</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp71218248"></a><h2>説明</h2><p>ジオメトリの全ての座標値からなるマルチポイントを返します。入力ジオメトリの重複ポイントを削除せず、環ジオメトリの開始点と終了点も削除しません (この挙動を望まない場合には<a class="xref" href="#ST_RemoveRepeatedPoints" title="ST_RemoveRepeatedPoints">ST_RemoveRepeatedPoints</a>を使って消します)。 </p><p>M値とZ値は、存在する場合には保存されます。 </p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p>Availability: 2.3.0</p></div><div class="refsection"><a name="idp71223240"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(ST_Points('POLYGON Z ((30 10 4,10 30 5,40 40 6, 30 10))'));

-- 結果
MULTIPOINT Z (30 10 4,10 30 5,40 40 6, 30 10 4)
                        </pre></div><div class="refsection"><a name="idp71224520"></a><h2>関連情報</h2><p><a class="xref" href="#ST_RemoveRepeatedPoints" title="ST_RemoveRepeatedPoints">ST_RemoveRepeatedPoints</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_SRID"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SRID — ST_Geometryのspatial_ref_sysテーブルで定義されている空間参照系の識別番号を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_SRID</b>(</code>geometry  <var class="pdparam">g1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp71230280"></a><h2>説明</h2><p>ST_Geometryのspatial_ref_sysテーブルで定義されている空間参照系の識別番号を返します。<a class="xref" href="#spatial_ref_sys" title="4.3.1. SPATIAL_REF_SYSテーブルと空間参照系">「SPATIAL_REF_SYSテーブルと空間参照系」</a>を参照して下さい。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>spatial_ref_sysテーブルはPostGISが知る参照系の全てのカタログを作っていて、ある空間参照系から他の空間参照系に変換するために使われます。ジオメトリの変換を予定している場合は正しい空間参照系の識別番号を持っているか確認することは重要です。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a> s2.1.1.1</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 5.1.5</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p></div><div class="refsection"><a name="idp71257160"></a><h2>例</h2><pre class="programlisting">SELECT ST_SRID(ST_GeomFromText('POINT(-71.1043 42.315)',4326));
                -- 結果
                4326
                </pre></div><div class="refsection"><a name="idp71258440"></a><h2>関連情報</h2><p><a class="xref" href="#spatial_ref_sys" title="4.3.1. SPATIAL_REF_SYSテーブルと空間参照系">「SPATIAL_REF_SYSテーブルと空間参照系」</a>, <a class="xref" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a>, <a class="xref" href="#ST_SetSRID" title="ST_SetSRID">ST_SetSRID</a>, <a class="xref" href="#ST_Transform" title="ST_Transform">ST_Transform</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_StartPoint"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_StartPoint — <code class="varname">LINESTRING</code>の最初のポイントを<code class="varname">POINT</code>として返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_StartPoint</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp71265992"></a><h2>説明</h2><p><code class="varname">LINESTRING</code>または<code class="varname">CIRCULARLINESTRING</code>ジオメトリの、最初のポイントを<code class="varname">POINT</code>で返します。入力パラメータが<code class="varname">LINESTRING</code>でも<code class="varname">CIRCULARLINESTRING</code>でもない場合には、<code class="varname">NULL</code>を返します。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 7.1.3</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Changed: 2.0.0では単一ジオメトリのMULTILINESTRINGで動作しなくなりました。単一のラインストリングからなるMULTILINESTRINGについては幸運にも動いていて、最初のポイントを返していました。2.0.0では他のMULTILINESTRINGと同様にNULLを返すようになりました。古い挙動は記載されていませんでしたが、LINESTRINGとして格納されているデータを持っていると思われる人々は2.0でNULLが返って来ることを経験することでしょう。</p></td></tr></table></div></div><div class="refsection"><a name="idp71274056"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(ST_StartPoint('LINESTRING(0 1, 0 2)'::geometry));
 st_astext
------------
 POINT(0 1)
(1 row)

SELECT ST_StartPoint('POINT(0 1)'::geometry) IS NULL AS is_null;
  is_null
----------
 t
(1 row)

-- 3次元ライン --
SELECT ST_AsEWKT(ST_StartPoint('LINESTRING(0 1 1, 0 2 2)'::geometry));
 st_asewkt
------------
 POINT(0 1 1)
(1 row)

-- 曲線ストリング --
SELECT ST_AsText(ST_StartPoint('CIRCULARSTRING(5 2,-3 1.999999, -2 1, -4 2, 5 2)'::geometry));
 st_astext
------------
 POINT(5 2)
</pre></div><div class="refsection"><a name="idp71275336"></a><h2>関連情報</h2><p><a class="xref" href="#ST_EndPoint" title="ST_EndPoint">ST_EndPoint</a>, <a class="xref" href="#ST_PointN" title="ST_PointN">ST_PointN</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Summary"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Summary — ジオメトリについての要約文を返します。  </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_Summary</b>(</code>geometry  <var class="pdparam">g</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">ST_Summary</b>(</code>geography  <var class="pdparam">g</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp71283656"></a><h2>説明</h2><p>ジオメトリについての要約文を返します。</p><p>ジオメトリ型の後の角括弧で示されたフラグには次の意味があります。 </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>M: M軸を持ちます</p></li><li class="listitem"><p>Z: Z軸を持ちます</p></li><li class="listitem"><p>B: バウンディングボックスを持ちます</p></li><li class="listitem"><p>G: 測地座標系 (ジオグラフィ)です</p></li><li class="listitem"><p>S: 空間参照系を持ちます</p></li></ul></div><p>
                </p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p><p>Availability: 1.2.2</p><p>Enhanced: 2.0.0でジオグラフィ対応が追加されました。</p><p>Enhanced: 2.1.0 空間参照系を持つかを示すSフラグが追加されました。</p><p>Enhanced: 2.2.0 TINと曲線の対応が追加されました。</p></div><div class="refsection"><a name="idp71294408"></a><h2>例</h2><pre class="programlisting">=# SELECT ST_Summary(ST_GeomFromText('LINESTRING(0 0, 1 1)')) as geom,
        ST_Summary(ST_GeogFromText('POLYGON((0 0, 1 1, 1 2, 1 1, 0 0))')) geog;
            geom             |          geog
-----------------------------+--------------------------
 LineString[B] with 2 points | Polygon[BGS] with 1 rings
                             | ring 0 has 5 points
                             :
(1 row)


=# SELECT ST_Summary(ST_GeogFromText('LINESTRING(0 0 1, 1 1 1)')) As geog_line,
        ST_Summary(ST_GeomFromText('SRID=4326;POLYGON((0 0 1, 1 1 2, 1 2 3, 1 1 1, 0 0 1))')) As geom_poly;
;
           geog_line             |        geom_poly
-------------------------------- +--------------------------
 LineString[ZBGS] with 2 points | Polygon[ZBS] with 1 rings
                                :    ring 0 has 5 points
                                :
(1 row)

</pre></div><div class="refsection"><a name="idp71295688"></a><h2>関連情報</h2><p><a class="xref" href="#PostGIS_DropBBox" title="PostGIS_DropBBox">PostGIS_DropBBox</a>, <a class="xref" href="#PostGIS_AddBBox" title="PostGIS_AddBBox">PostGIS_AddBBox</a>, <a class="xref" href="#ST_Force_3DM" title="ST_Force3DM">ST_Force3DM</a>, <a class="xref" href="#ST_Force_3DZ" title="ST_Force3DZ">ST_Force3DZ</a>, <a class="xref" href="#ST_Force2D" title="ST_Force2D">ST_Force2D</a>, <a class="xref" href="#geography" title="geography">geography</a> </p><p><a class="xref" href="#ST_IsValid" title="ST_IsValid">ST_IsValid</a>, <a class="xref" href="#ST_IsValid" title="ST_IsValid">ST_IsValid</a>, <a class="xref" href="#ST_IsValidReason" title="ST_IsValidReason">ST_IsValidReason</a>, <a class="xref" href="#ST_IsValidDetail" title="ST_IsValidDetail">ST_IsValidDetail</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_X"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_X — ポイントのX座標値を返し、有効でないならNULLを返します。入力はポイントでなければなりません。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_X</b>(</code>geometry  <var class="pdparam">a_point</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp71309384"></a><h2>説明</h2><p>ポイントのX座標値を返し、有効でないならNULLを返します。入力はポイントでなければなりません。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ジオメトリのX座標値の最大値、最小値を得たい場合には、ST_XMin, ST_XMax関数をご覧ください。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 6.1.3</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp71313992"></a><h2>例</h2><pre class="programlisting">SELECT ST_X(ST_GeomFromEWKT('POINT(1 2 3 4)'));
 st_x
------
        1
(1 row)

SELECT ST_Y(ST_Centroid(ST_GeomFromEWKT('LINESTRING(1 2 3 4, 1 1 1 1)')));
 st_y
------
  1.5
(1 row)

                </pre></div><div class="refsection"><a name="idp71315528"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Centroid" title="ST_Centroid">ST_Centroid</a>, <a class="xref" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a>, <a class="xref" href="#ST_M" title="ST_M">ST_M</a>, <a class="xref" href="#ST_XMax" title="ST_XMax">ST_XMax</a>, <a class="xref" href="#ST_XMin" title="ST_XMin">ST_XMin</a>, <a class="xref" href="#ST_Y" title="ST_Y">ST_Y</a>, <a class="xref" href="#ST_Z" title="ST_Z">ST_Z</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_XMax"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_XMax — 2次元、3次元バウンディングボックスまたはジオメトリにおけるXの最大値を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_XMax</b>(</code>box3d  <var class="pdparam">aGeomorBox2DorBox3D</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp71323592"></a><h2>説明</h2><p>2次元、3次元バウンディングボックスまたはジオメトリにおけるXの最大値を返します。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はbox3dのみ定義していますが、ジオメトリとbox2dに定義されている自動キャストの挙動によって、box2dとジオメトリでも動作します。ジオメトリまたはbox2dの文字列表現については、自動キャストしないため、与えることはできません。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p></div><div class="refsection"><a name="idp71328072"></a><h2>例</h2><pre class="programlisting">SELECT ST_XMax('BOX3D(1 2 3, 4 5 6)');
st_xmax
-------
4

SELECT ST_XMax(ST_GeomFromText('LINESTRING(1 3 4, 5 6 7)'));
st_xmax
-------
5

SELECT ST_XMax(CAST('BOX(-3 2, 3 4)' As box2d));
st_xmax
-------
3
-- *これが動作しない*ことを見てみます
-- 文字列表現をBOX3Dに自動キャストしようとするためです
SELECT ST_XMax('LINESTRING(1 3, 5 6)');

-- エラー: BOX3Dパーサ - BOX3D(で開始されていません
-- ERROR:  BOX3D parser - doesn't start with BOX3D(

SELECT ST_XMax(ST_GeomFromEWKT('CIRCULARSTRING(220268 150415 1,220227 150505 2,220227 150406 3)'));
st_xmax
--------
220288.248780547
                </pre></div><div class="refsection"><a name="idp71329608"></a><h2>関連情報</h2><p><a class="xref" href="#ST_XMin" title="ST_XMin">ST_XMin</a>, <a class="xref" href="#ST_YMax" title="ST_YMax">ST_YMax</a>, <a class="xref" href="#ST_YMin" title="ST_YMin">ST_YMin</a>, <a class="xref" href="#ST_ZMax" title="ST_ZMax">ST_ZMax</a>, <a class="xref" href="#ST_ZMin" title="ST_ZMin">ST_ZMin</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_XMin"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_XMin — 2次元、3次元バウンディングボックスまたはジオメトリにおけるXの最小値を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_XMin</b>(</code>box3d  <var class="pdparam">aGeomorBox2DorBox3D</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp71336904"></a><h2>説明</h2><p>2次元、3次元バウンディングボックスまたはジオメトリにおけるXの最小値を返します。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はbox3dのみ定義していますが、ジオメトリとbox2dに定義されている自動キャストの挙動によって、box2dとジオメトリでも動作します。ジオメトリまたはbox2dの文字列表現については、自動キャストしないため、与えることはできません。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p></div><div class="refsection"><a name="idp71345480"></a><h2>例</h2><pre class="programlisting">SELECT ST_XMin('BOX3D(1 2 3, 4 5 6)');
st_xmin
-------
1

SELECT ST_XMin(ST_GeomFromText('LINESTRING(1 3 4, 5 6 7)'));
st_xmin
-------
1

SELECT ST_XMin(CAST('BOX(-3 2, 3 4)' As box2d));
st_xmin
-------
-3
-- *これが動作しない*ことを見てみます
-- 文字列表現をBOX3Dに自動キャストしようとするためです
SELECT ST_XMin('LINESTRING(1 3, 5 6)');

-- エラー: BOX3Dパーサ - BOX3D(で開始されていません
-- ERROR:  BOX3D parser - doesn't start with BOX3D(

SELECT ST_XMin(ST_GeomFromEWKT('CIRCULARSTRING(220268 150415 1,220227 150505 2,220227 150406 3)'));
st_xmin
--------
220186.995121892
                </pre></div><div class="refsection"><a name="idp71347016"></a><h2>関連情報</h2><p><a class="xref" href="#ST_XMax" title="ST_XMax">ST_XMax</a>, <a class="xref" href="#ST_YMax" title="ST_YMax">ST_YMax</a>, <a class="xref" href="#ST_YMin" title="ST_YMin">ST_YMin</a>, <a class="xref" href="#ST_ZMax" title="ST_ZMax">ST_ZMax</a>, <a class="xref" href="#ST_ZMin" title="ST_ZMin">ST_ZMin</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Y"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Y — ポイントのY座標値を返し、有効でないならNULLを返します。入力はポイントでなければなりません。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_Y</b>(</code>geometry  <var class="pdparam">a_point</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp71354312"></a><h2>説明</h2><p>ポイントのY座標値を返し、有効でないならNULLを返します。入力はポイントでなければなりません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a></p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 6.1.4</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp71359816"></a><h2>例</h2><pre class="programlisting">SELECT ST_Y(ST_GeomFromEWKT('POINT(1 2 3 4)'));
 st_y
------
        2
(1 row)

SELECT ST_Y(ST_Centroid(ST_GeomFromEWKT('LINESTRING(1 2 3 4, 1 1 1 1)')));
 st_y
------
  1.5
(1 row)


                </pre></div><div class="refsection"><a name="idp71361352"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Centroid" title="ST_Centroid">ST_Centroid</a>, <a class="xref" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a>, <a class="xref" href="#ST_M" title="ST_M">ST_M</a>, <a class="xref" href="#ST_X" title="ST_X">ST_X</a>, <a class="xref" href="#ST_YMax" title="ST_YMax">ST_YMax</a>, <a class="xref" href="#ST_YMin" title="ST_YMin">ST_YMin</a>, <a class="xref" href="#ST_Z" title="ST_Z">ST_Z</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_YMax"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_YMax — 2次元、3次元バウンディングボックスまたはジオメトリにおけるYの最大値を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_YMax</b>(</code>box3d  <var class="pdparam">aGeomorBox2DorBox3D</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp71369416"></a><h2>説明</h2><p>2次元、3次元バウンディングボックスまたはジオメトリにおけるYの最大値を返します。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はbox3dのみ定義していますが、ジオメトリとbox2dに定義されている自動キャストの挙動によって、box2dとジオメトリでも動作します。ジオメトリまたはbox2dの文字列表現については、自動キャストしないため、与えることはできません。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p></div><div class="refsection"><a name="idp71373896"></a><h2>例</h2><pre class="programlisting">SELECT ST_YMax('BOX3D(1 2 3, 4 5 6)');
st_ymax
-------
5

SELECT ST_YMax(ST_GeomFromText('LINESTRING(1 3 4, 5 6 7)'));
st_ymax
-------
6

SELECT ST_YMax(CAST('BOX(-3 2, 3 4)' As box2d));
st_ymax
-------
4
--Observe THIS DOES NOT WORK because it will try to autocast the string representation to a BOX3D
SELECT ST_YMax('LINESTRING(1 3, 5 6)');

--ERROR:  BOX3D parser - doesn't start with BOX3D(

SELECT ST_YMax(ST_GeomFromEWKT('CIRCULARSTRING(220268 150415 1,220227 150505 2,220227 150406 3)'));
st_ymax
--------
150506.126829327
                </pre></div><div class="refsection"><a name="idp71375432"></a><h2>関連情報</h2><p><a class="xref" href="#ST_XMin" title="ST_XMin">ST_XMin</a>, <a class="xref" href="#ST_XMax" title="ST_XMax">ST_XMax</a>, <a class="xref" href="#ST_YMin" title="ST_YMin">ST_YMin</a>, <a class="xref" href="#ST_ZMax" title="ST_ZMax">ST_ZMax</a>, <a class="xref" href="#ST_ZMin" title="ST_ZMin">ST_ZMin</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_YMin"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_YMin — 2次元、3次元バウンディングボックスまたはジオメトリにおけるYの最小値を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_YMin</b>(</code>box3d  <var class="pdparam">aGeomorBox2DorBox3D</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp71382728"></a><h2>説明</h2><p>2次元、3次元バウンディングボックスまたはジオメトリにおけるYの最小値を返します。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はbox3dのみ定義していますが、ジオメトリとbox2dに定義されている自動キャストの挙動によって、box2dとジオメトリでも動作します。ジオメトリまたはbox2dの文字列表現については、自動キャストしないため、与えることはできません。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p></div><div class="refsection"><a name="idp71387208"></a><h2>例</h2><pre class="programlisting">SELECT ST_YMin('BOX3D(1 2 3, 4 5 6)');
st_ymin
-------
2

SELECT ST_YMin(ST_GeomFromText('LINESTRING(1 3 4, 5 6 7)'));
st_ymin
-------
3

SELECT ST_YMin(CAST('BOX(-3 2, 3 4)' As box2d));
st_ymin
-------
2
-- *これが動作しない*ことを見てみます
-- 文字列表現をBOX3Dに自動キャストしようとするためです
SELECT ST_YMin('LINESTRING(1 3, 5 6)');

-- エラー: BOX3Dパーサ - BOX3D(で開始されていません
-- ERROR:  BOX3D parser - doesn't start with BOX3D(

SELECT ST_YMin(ST_GeomFromEWKT('CIRCULARSTRING(220268 150415 1,220227 150505 2,220227 150406 3)'));
st_ymin
--------
150406
                </pre></div><div class="refsection"><a name="idp71388744"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a>, <a class="xref" href="#ST_XMin" title="ST_XMin">ST_XMin</a>, <a class="xref" href="#ST_XMax" title="ST_XMax">ST_XMax</a>, <a class="xref" href="#ST_YMax" title="ST_YMax">ST_YMax</a>, <a class="xref" href="#ST_ZMax" title="ST_ZMax">ST_ZMax</a>, <a class="xref" href="#ST_ZMin" title="ST_ZMin">ST_ZMin</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Z"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Z — ポイントのZ座標値を返し、有効でないならNULLを返します。入力はポイントでなければなりません。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_Z</b>(</code>geometry  <var class="pdparam">a_point</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp71408712"></a><h2>説明</h2><p>ポイントのZ座標値を返し、有効でないならNULLを返します。入力はポイントでなければなりません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp71412680"></a><h2>例</h2><pre class="programlisting">SELECT ST_Z(ST_GeomFromEWKT('POINT(1 2 3 4)'));
 st_z
------
        3
(1 row)

                </pre></div><div class="refsection"><a name="idp71414216"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a>, <a class="xref" href="#ST_M" title="ST_M">ST_M</a>, <a class="xref" href="#ST_X" title="ST_X">ST_X</a>, <a class="xref" href="#ST_Y" title="ST_Y">ST_Y</a>, <a class="xref" href="#ST_ZMax" title="ST_ZMax">ST_ZMax</a>, <a class="xref" href="#ST_ZMin" title="ST_ZMin">ST_ZMin</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_ZMax"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ZMax — 2次元、3次元バウンディングボックスまたはジオメトリにおけるZの最大値を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_ZMax</b>(</code>box3d  <var class="pdparam">aGeomorBox2DorBox3D</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp71422024"></a><h2>説明</h2><p>2次元、3次元バウンディングボックスまたはジオメトリにおけるZの最大値を返します。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はbox3dのみ定義していますが、ジオメトリとbox2dに定義されている自動キャストの挙動によって、box2dとジオメトリでも動作します。ジオメトリまたはbox2dの文字列表現については、自動キャストしないため、与えることはできません。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p></div><div class="refsection"><a name="idp71426504"></a><h2>例</h2><pre class="programlisting">SELECT ST_ZMax('BOX3D(1 2 3, 4 5 6)');
st_zmax
-------
6

SELECT ST_ZMax(ST_GeomFromEWKT('LINESTRING(1 3 4, 5 6 7)'));
st_zmax
-------
7

SELECT ST_ZMax('BOX3D(-3 2 1, 3 4 1)' );
st_zmax
-------
1
-- *これが動作しない*ことを見てみます
-- 文字列表現をBOX3Dに自動キャストしようとするためです
SELECT ST_ZMax('LINESTRING(1 3 4, 5 6 7)');

-- エラー: BOX3Dパーサ - BOX3D(で開始されていません
-- ERROR:  BOX3D parser - doesn't start with BOX3D(

SELECT ST_ZMax(ST_GeomFromEWKT('CIRCULARSTRING(220268 150415 1,220227 150505 2,220227 150406 3)'));
st_zmax
--------
3
                </pre></div><div class="refsection"><a name="idp71428040"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a>, <a class="xref" href="#ST_XMin" title="ST_XMin">ST_XMin</a>, <a class="xref" href="#ST_XMax" title="ST_XMax">ST_XMax</a>, <a class="xref" href="#ST_YMax" title="ST_YMax">ST_YMax</a>, <a class="xref" href="#ST_YMin" title="ST_YMin">ST_YMin</a>, <a class="xref" href="#ST_ZMax" title="ST_ZMax">ST_ZMax</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Zmflag"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Zmflag — ポイントのZM (次元の意味)フラグをsmall intで返します。値は 0=XY, 1=XYM, 2=XYZ, 3=XYZMとなります。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">smallint <b class="fsfunc">ST_Zmflag</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp71435848"></a><h2>説明</h2><p>ポイントのZM (次元の意味)フラグをsmall intで返します。値は 0=XY, 1=XYM, 2=XYZ, 3=XYZMとなります。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p></div><div class="refsection"><a name="idp71439688"></a><h2>例</h2><pre class="programlisting">SELECT ST_Zmflag(ST_GeomFromEWKT('LINESTRING(1 2, 3 4)'));
 st_zmflag
-----------
                 0

SELECT ST_Zmflag(ST_GeomFromEWKT('LINESTRINGM(1 2 3, 3 4 3)'));
 st_zmflag
-----------
                 1

SELECT ST_Zmflag(ST_GeomFromEWKT('CIRCULARSTRING(1 2 3, 3 4 3, 5 6 3)'));
 st_zmflag
-----------
                 2
SELECT ST_Zmflag(ST_GeomFromEWKT('POINT(1 2 3 4)'));
 st_zmflag
-----------
                 3
</pre></div><div class="refsection"><a name="idp71441224"></a><h2>関連情報</h2><p><a class="xref" href="#ST_CoordDim" title="ST_CoordDim">ST_CoordDim</a>, <a class="xref" href="#ST_NDims" title="ST_NDims">ST_NDims</a>, <a class="xref" href="#ST_Dimension" title="ST_Dimension">ST_Dimension</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_ZMin"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ZMin — 2次元、3次元バウンディングボックスまたはジオメトリにおけるZの最大値を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_ZMin</b>(</code>box3d  <var class="pdparam">aGeomorBox2DorBox3D</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp71447752"></a><h2>説明</h2><p>2次元または3次元ジオメトリのバウンディングボックスにおけるZの最小値を返します。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はbox3dのみ定義していますが、ジオメトリとbox2dに定義されている自動キャストの挙動によって、box2dとジオメトリでも動作します。ジオメトリまたはbox2dの文字列表現については、自動キャストしないため、与えることはできません。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p></div><div class="refsection"><a name="idp71452232"></a><h2>例</h2><pre class="programlisting">SELECT ST_ZMin('BOX3D(1 2 3, 4 5 6)');
st_zmin
-------
3

SELECT ST_ZMin(ST_GeomFromEWKT('LINESTRING(1 3 4, 5 6 7)'));
st_zmin
-------
4

SELECT ST_ZMin('BOX3D(-3 2 1, 3 4 1)' );
st_zmin
-------
1
-- *これが動作しない*ことを見てみます
-- 文字列表現をBOX3Dに自動キャストしようとするためです
tation to a BOX3D
SELECT ST_ZMin('LINESTRING(1 3 4, 5 6 7)');

-- エラー: BOX3Dパーサ - BOX3D(で開始されていません
-- ERROR:  BOX3D parser - doesn't start with BOX3D(

SELECT ST_ZMin(ST_GeomFromEWKT('CIRCULARSTRING(220268 150415 1,220227 150505 2,220227 150406 3)'));
st_zmin
--------
1
                </pre></div><div class="refsection"><a name="idp71453768"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a>, <a class="xref" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a>, <a class="xref" href="#ST_XMin" title="ST_XMin">ST_XMin</a>, <a class="xref" href="#ST_XMax" title="ST_XMax">ST_XMax</a>, <a class="xref" href="#ST_YMax" title="ST_YMax">ST_YMax</a>, <a class="xref" href="#ST_YMin" title="ST_YMin">ST_YMin</a>, <a class="xref" href="#ST_ZMax" title="ST_ZMax">ST_ZMax</a></p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Geometry_Editors"></a>8.6. ジオメトリエディタ</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#ST_AddPoint">ST_AddPoint</a></span><span class="refpurpose"> — ラインストリングにポイントを追加します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Affine">ST_Affine</a></span><span class="refpurpose"> — 3次元アフィン変換をジオメトリに適用します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Force2D">ST_Force2D</a></span><span class="refpurpose"> — ジオメトリを2次元モードに強制します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Force_3D">ST_Force3D</a></span><span class="refpurpose"> — ジオメトリをXYZモードに強制します。これはST_Force3DZの別名です。</span></dt><dt><span class="refentrytitle"><a href="#ST_Force_3DZ">ST_Force3DZ</a></span><span class="refpurpose"> — ジオメトリをXYZモードに強制します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Force_3DM">ST_Force3DM</a></span><span class="refpurpose"> — ジオメトリをXYMモードに強制します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Force_4D">ST_Force4D</a></span><span class="refpurpose"> — ジオメトリをXYZMモードに強制します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_ForcePolygonCCW">ST_ForcePolygonCCW </a></span><span class="refpurpose"> — 全ての外環を反時計回りに、全ての内環を時計回りに、それぞれ強制します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_Force_Collection">ST_ForceCollection</a></span><span class="refpurpose"> — ジオメトリをジオメトリコレクションに変換します。</span></dt><dt><span class="refentrytitle"><a href="#ST_ForcePolygonCW">ST_ForcePolygonCW </a></span><span class="refpurpose"> — 全ての外環を時計回りに、全ての内環を反時計回りに、それぞれ強制します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_ForceSFS">ST_ForceSFS</a></span><span class="refpurpose"> — SFS 1.1ジオメトリタイプのみ使うようジオメトリに強制します。</span></dt><dt><span class="refentrytitle"><a href="#ST_ForceRHR">ST_ForceRHR</a></span><span class="refpurpose"> — ポリゴンの頂点の方向を右回りに強制します。</span></dt><dt><span class="refentrytitle"><a href="#ST_ForceCurve">ST_ForceCurve</a></span><span class="refpurpose"> — 該当する場合は、ジオメトリを曲線タイプに変換します。</span></dt><dt><span class="refentrytitle"><a href="#ST_LineMerge">ST_LineMerge</a></span><span class="refpurpose"> — MULTILINESTRINGをまとめ合わせて形成されるラインストリング (またはその集合)を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_CollectionExtract">ST_CollectionExtract</a></span><span class="refpurpose"> — (マルチ)ジオメトリを与えると、指定したタイプの要素でのみ構成される (マルチ)ジオメトリを返します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_CollectionHomogenize">ST_CollectionHomogenize</a></span><span class="refpurpose"> — ジオメトリコレクションを与えると、「最も単純な」表現を返します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_Multi">ST_Multi</a></span><span class="refpurpose"> — マルチ系ジオメトリを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Normalize">ST_Normalize</a></span><span class="refpurpose"> — 標準的な形式に変えたジオメトリを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_QuantizeCoordinates">ST_QuantizeCoordinates </a></span><span class="refpurpose"> — 座標値の最下位ビットを0にします。 </span></dt><dt><span class="refentrytitle"><a href="#ST_RemovePoint">ST_RemovePoint</a></span><span class="refpurpose"> — ラインストリングからポイントを削除します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Reverse">ST_Reverse</a></span><span class="refpurpose"> — 頂点の順序を逆にしたジオメトリを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Rotate">ST_Rotate</a></span><span class="refpurpose"> — ジオメトリを、原点について反時計回りにrotRadiasnぶん回転させます。</span></dt><dt><span class="refentrytitle"><a href="#ST_RotateX">ST_RotateX</a></span><span class="refpurpose"> — ジオメトリをX軸についてrotRadiansぶん回転させます。</span></dt><dt><span class="refentrytitle"><a href="#ST_RotateY">ST_RotateY</a></span><span class="refpurpose"> — ジオメトリgeomAをY軸についてrotRadiansぶん回転させます。</span></dt><dt><span class="refentrytitle"><a href="#ST_RotateZ">ST_RotateZ</a></span><span class="refpurpose"> — ジオメトリをZ軸についてrotRadiansぶん回転させます。</span></dt><dt><span class="refentrytitle"><a href="#ST_Scale">ST_Scale</a></span><span class="refpurpose"> — 与えた係数でジオメトリを拡大縮小します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Segmentize">ST_Segmentize</a></span><span class="refpurpose"> — 与えた距離を超える線分を持たないよう変更したジオメトリ/ジオグラフィを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_SetPoint">ST_SetPoint</a></span><span class="refpurpose"> — ラインストリングのポイントを与えられたポイントに置き換えます。</span></dt><dt><span class="refentrytitle"><a href="#ST_SetSRID">ST_SetSRID</a></span><span class="refpurpose"> — ジオメトリのSRIDを特定の整数値に設定します。</span></dt><dt><span class="refentrytitle"><a href="#ST_SnapToGrid">ST_SnapToGrid</a></span><span class="refpurpose"> — 入力ジオメトリの全ての点を規則的なグリッドにスナップします。 </span></dt><dt><span class="refentrytitle"><a href="#ST_Snap">ST_Snap</a></span><span class="refpurpose"> — 入力ジオメトリの辺と頂点を参照ジオメトリの頂点にスナップします。 </span></dt><dt><span class="refentrytitle"><a href="#ST_Transform">ST_Transform</a></span><span class="refpurpose"> — 異なる空間参照系に投影変換された新しいジオメトリを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Translate">ST_Translate</a></span><span class="refpurpose"> — 与えられたオフセットでジオメトリを変換します。</span></dt><dt><span class="refentrytitle"><a href="#ST_TransScale">ST_TransScale</a></span><span class="refpurpose"> — 与えられた係数とオフセットでジオメトリを変換します。</span></dt></dl></div><div class="refentry"><a name="ST_AddPoint"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AddPoint — ラインストリングにポイントを追加します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_AddPoint</b>(</code>geometry <var class="pdparam">linestring</var>, geometry <var class="pdparam">point</var><code>)</code>;</p></div><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_AddPoint</b>(</code>geometry <var class="pdparam">linestring</var>, geometry <var class="pdparam">point</var>, integer <var class="pdparam">position</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72276296"></a><h2>説明</h2><p>ラインストリングに対して指定した&lt;position&gt; (0はじまり)の前にポイントを追加します。第3引数に-1を指定すると末尾に追加できます。</p><p>Availability: 1.1.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp72279240"></a><h2>例</h2><pre class="programlisting">-- テーブル内の全てのラインストリングのうち閉じていないものについて、
-- 最初のポイントを末尾に追加することで、
-- 全てのラインストリングが閉じていることを保証します
                UPDATE sometable
                SET the_geom = ST_AddPoint(the_geom, ST_StartPoint(the_geom))
                FROM sometable
                WHERE ST_IsClosed(the_geom) = false;

                --Adding point to a 3-d line
                SELECT ST_AsEWKT(ST_AddPoint(ST_GeomFromEWKT('LINESTRING(0 0 1, 1 1 1)'), ST_MakePoint(1, 2, 3)));

                --result
                st_asewkt
                ----------
                LINESTRING(0 0 1,1 1 1,1 2 3)
                        </pre></div><div class="refsection"><a name="idp72280520"></a><h2>関連情報</h2><p><a class="xref" href="#ST_RemovePoint" title="ST_RemovePoint">ST_RemovePoint</a>, <a class="xref" href="#ST_SetPoint" title="ST_SetPoint">ST_SetPoint</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Affine"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Affine — 3次元アフィン変換をジオメトリに適用します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Affine</b>(</code>geometry  <var class="pdparam">geomA</var>, float  <var class="pdparam">a</var>, float  <var class="pdparam">b</var>, float  <var class="pdparam">c</var>, float  <var class="pdparam">d</var>, float  <var class="pdparam">e</var>, float  <var class="pdparam">f</var>, float  <var class="pdparam">g</var>, float  <var class="pdparam">h</var>, float  <var class="pdparam">i</var>, float  <var class="pdparam">xoff</var>, float  <var class="pdparam">yoff</var>, float  <var class="pdparam">zoff</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_Affine</b>(</code>geometry  <var class="pdparam">geomA</var>, float  <var class="pdparam">a</var>, float  <var class="pdparam">b</var>, float  <var class="pdparam">d</var>, float  <var class="pdparam">e</var>, float  <var class="pdparam">xoff</var>, float  <var class="pdparam">yoff</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72307272"></a><h2>説明</h2><p>3次元アフィン変換をジオメトリに適用して移動、回転、拡大縮小を一度に行います。</p><p>一つ目の形式では、次のように関数を呼んでいます。</p><pre class="programlisting">ST_Affine(geom, a, b, c, d, e, f, g, h, i, xoff, yoff, zoff) </pre><p> これは次のような変換行列を表現しています。</p><pre class="programlisting">/ a  b  c  xoff \
| d  e  f  yoff |
| g  h  i  zoff |
\ 0  0  0     1 /</pre><p>次のようにも表現できます。</p><pre class="programlisting">x' = a*x + b*y + c*z + xoff
y' = d*x + e*y + f*z + yoff
z' = g*x + h*y + i*z + zoff</pre><p>全ての移動/拡大縮小関数はこのようなアフィン変換を経由しています。</p><p>二つ目の形式では、2次元アフィン変換をジオメトリに適用します。次のように関数を呼んでいます。</p><pre class="programlisting">ST_Affine(geom, a, b, d, e, xoff, yoff)</pre><p>これは次のような変換行列を表現しています。</p><pre class="programlisting">/  a  b  0  xoff  \       /  a  b  xoff  \
|  d  e  0  yoff  | rsp.  |  d  e  yoff  |
|  0  0  1     0  |       \  0  0     1  /
\  0  0  0     1  /</pre><p>頂点は次のように変換されます。</p><pre class="programlisting">x' = a*x + b*y + xoff
y' = d*x + e*y + yoff
z' = z </pre><p>このメソッドは上述の3次元メソッドの特異ケースです。</p><p>Enhanced: 2.0.0 多面体サーフェス対応、三角対応、TIN対応が導入されました。</p><p>Availability: 1.1.2 AffineからST_Affineに名称変更しました。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>1.3.4より前では、曲線を含むジオメトリで使用すると、この関数はクラッシュします。これは1.3.4以上で訂正されています。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p></div><div class="refsection"><a name="idp72318920"></a><h2>例</h2><pre class="programlisting">-- 3次元ラインストリングをZ軸で180度回転させます。
-- ST_RotateZ()を冗長にしたものです。
 SELECT ST_AsEWKT(ST_Affine(the_geom,  cos(pi()), -sin(pi()), 0,  sin(pi()), cos(pi()), 0,  0, 0, 1,  0, 0, 0)) As using_affine,
         ST_AsEWKT(ST_Rotate(the_geom, pi())) As using_rotate
        FROM (SELECT ST_GeomFromEWKT('LINESTRING(1 2 3, 1 4 3)') As the_geom) As foo;
        using_affine         |        using_rotate
-----------------------------+-----------------------------
 LINESTRING(-1 -2 3,-1 -4 3) | LINESTRING(-1 -2 3,-1 -4 3)
(1 row)

-- 3次元ラインストリングをX軸とZ軸で180度回転させます。
SELECT ST_AsEWKT(ST_Affine(the_geom, cos(pi()), -sin(pi()), 0, sin(pi()), cos(pi()), -sin(pi()), 0, sin(pi()), cos(pi()), 0, 0, 0))
        FROM (SELECT ST_GeomFromEWKT('LINESTRING(1 2 3, 1 4 3)') As the_geom) As foo;
           st_asewkt
-------------------------------
 LINESTRING(-1 -2 -3,-1 -4 -3)
(1 row)
                </pre></div><div class="refsection"><a name="idp72320456"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Rotate" title="ST_Rotate">ST_Rotate</a>, <a class="xref" href="#ST_Scale" title="ST_Scale">ST_Scale</a>, <a class="xref" href="#ST_Translate" title="ST_Translate">ST_Translate</a>, <a class="xref" href="#ST_TransScale" title="ST_TransScale">ST_TransScale</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Force2D"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Force2D — ジオメトリを2次元モードに強制します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Force2D</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72331464"></a><h2>説明</h2><p>ジオメトリを「2次元モード」に強制させます。全ての出力表現はXY座標値のみを持つことになります。OGC準拠の出力 (OGCは2次元ジオメトリのみ策定しています)に強制するために使われます。</p><p>Enhanced: 2.0.0 多面体サーフェス対応が導入されました。</p><p>Changed: 2.1.0 2.0.xの間はST_Force_2Dと呼ばれていました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp72337352"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsEWKT(ST_Force2D(ST_GeomFromEWKT('CIRCULARSTRING(1 1 2, 2 3 2, 4 5 2, 6 7 2, 5 6 2)')));
                st_asewkt
-------------------------------------
CIRCULARSTRING(1 1,2 3,4 5,6 7,5 6)

SELECT  ST_AsEWKT(ST_Force2D('POLYGON((0 0 2,0 5 2,5 0 2,0 0 2),(1 1 2,3 1 2,1 3 2,1 1 2))'));

                                  st_asewkt
----------------------------------------------
 POLYGON((0 0,0 5,5 0,0 0),(1 1,3 1,1 3,1 1))

                </pre></div><div class="refsection"><a name="idp72338888"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Force_3D" title="ST_Force3D">ST_Force3D</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Force_3D"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Force3D — ジオメトリをXYZモードに強制します。これはST_Force3DZの別名です。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Force3D</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72344648"></a><h2>説明</h2><p>ジオメトリをXYZモードに強制します。これはST_Force_3DZの別名です。ジオメトリがZ値を持っていない場合は0のZ値を追加します。</p><p>Enhanced: 2.0.0 多面体サーフェス対応が導入されました。</p><p>Changed: 2.1.0 2.0.xの間はST_Force_3Dと呼ばれていました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp72350536"></a><h2>例</h2><pre class="programlisting">-- 既に3次元ジオメトリになっている場合は何も起きません
                SELECT ST_AsEWKT(ST_Force3D(ST_GeomFromEWKT('CIRCULARSTRING(1 1 2, 2 3 2, 4 5 2, 6 7 2, 5 6 2)')));
                                   st_asewkt
-----------------------------------------------
 CIRCULARSTRING(1 1 2,2 3 2,4 5 2,6 7 2,5 6 2)


SELECT  ST_AsEWKT(ST_Force3D('POLYGON((0 0,0 5,5 0,0 0),(1 1,3 1,1 3,1 1))'));

                                                 st_asewkt
--------------------------------------------------------------
 POLYGON((0 0 0,0 5 0,5 0 0,0 0 0),(1 1 0,3 1 0,1 3 0,1 1 0))
                </pre></div><div class="refsection"><a name="idp72352072"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a>, <a class="xref" href="#ST_Force2D" title="ST_Force2D">ST_Force2D</a>, <a class="xref" href="#ST_Force_3DM" title="ST_Force3DM">ST_Force3DM</a>, <a class="xref" href="#ST_Force_3DZ" title="ST_Force3DZ">ST_Force3DZ</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Force_3DZ"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Force3DZ — ジオメトリをXYZモードに強制します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Force3DZ</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72358984"></a><h2>説明</h2><p>ジオメトリをXYZモードに強制します。これはST_Force3Dと同義です。ジオメトリがZ値を持っていない場合は0のZ値を追加します。</p><p>Enhanced: 2.0.0 多面体サーフェス対応が導入されました。</p><p>Changed: 2.1.0 2.0.xの間はST_Force_3DZと呼ばれていました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p></div><div class="refsection"><a name="idp72364872"></a><h2>例</h2><pre class="programlisting">-- 既に3次元ジオメトリになっている場合は何も起きません
SELECT ST_AsEWKT(ST_Force3DZ(ST_GeomFromEWKT('CIRCULARSTRING(1 1 2, 2 3 2, 4 5 2, 6 7 2, 5 6 2)')));
                                   st_asewkt
-----------------------------------------------
 CIRCULARSTRING(1 1 2,2 3 2,4 5 2,6 7 2,5 6 2)


SELECT  ST_AsEWKT(ST_Force3DZ('POLYGON((0 0,0 5,5 0,0 0),(1 1,3 1,1 3,1 1))'));

                                                 st_asewkt
--------------------------------------------------------------
 POLYGON((0 0 0,0 5 0,5 0 0,0 0 0),(1 1 0,3 1 0,1 3 0,1 1 0))
                </pre></div><div class="refsection"><a name="idp72366408"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a>, <a class="xref" href="#ST_Force2D" title="ST_Force2D">ST_Force2D</a>, <a class="xref" href="#ST_Force_3DM" title="ST_Force3DM">ST_Force3DM</a>, <a class="xref" href="#ST_Force_3D" title="ST_Force3D">ST_Force3D</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Force_3DM"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Force3DM — ジオメトリをXYMモードに強制します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Force3DM</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72385608"></a><h2>説明</h2><p>ジオメトリをXYMモードに強制します。ジオメトリがM値を持っていない場合は0のM値を追加します。Z値を持っている場合はZ値は除去されます。</p><p>Changed: 2.1.0 2.0.xの間はST_Force_3DMと呼ばれていました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p></div><div class="refsection"><a name="idp72388296"></a><h2>例</h2><pre class="programlisting">-- 既に3次元ジオメトリになっている場合は何も起きません
SELECT ST_AsEWKT(ST_Force3DM(ST_GeomFromEWKT('CIRCULARSTRING(1 1 2, 2 3 2, 4 5 2, 6 7 2, 5 6 2)')));
                                   st_asewkt
------------------------------------------------
 CIRCULARSTRINGM(1 1 0,2 3 0,4 5 0,6 7 0,5 6 0)


SELECT  ST_AsEWKT(ST_Force3DM('POLYGON((0 0 1,0 5 1,5 0 1,0 0 1),(1 1 1,3 1 1,1 3 1,1 1 1))'));

                                                  st_asewkt
---------------------------------------------------------------
 POLYGONM((0 0 0,0 5 0,5 0 0,0 0 0),(1 1 0,3 1 0,1 3 0,1 1 0))

                </pre></div><div class="refsection"><a name="idp72389832"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a>, <a class="xref" href="#ST_Force2D" title="ST_Force2D">ST_Force2D</a>, <a class="xref" href="#ST_Force_3DM" title="ST_Force3DM">ST_Force3DM</a>, <a class="xref" href="#ST_Force_3D" title="ST_Force3D">ST_Force3D</a>, <a class="xref" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Force_4D"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Force4D — ジオメトリをXYZMモードに強制します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Force4D</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72417608"></a><h2>説明</h2><p>ジオメトリをXYZMモードに強制します。Z値やM値が無い場合は0を追加します。 </p><p>Changed: 2.1.0 2.0.xの間はST_Force_4Dと呼ばれていました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p></div><div class="refsection"><a name="idp72421704"></a><h2>例</h2><pre class="programlisting">-- 既に3次元ジオメトリになっている場合は何も起きません
SELECT ST_AsEWKT(ST_Force4D(ST_GeomFromEWKT('CIRCULARSTRING(1 1 2, 2 3 2, 4 5 2, 6 7 2, 5 6 2)')));
                                                st_asewkt
---------------------------------------------------------
 CIRCULARSTRING(1 1 2 0,2 3 2 0,4 5 2 0,6 7 2 0,5 6 2 0)



SELECT  ST_AsEWKT(ST_Force4D('MULTILINESTRINGM((0 0 1,0 5 2,5 0 3,0 0 4),(1 1 1,3 1 1,1 3 1,1 1 1))'));

                                                                          st_asewkt
--------------------------------------------------------------------------------------
 MULTILINESTRING((0 0 0 1,0 5 0 2,5 0 0 3,0 0 0 4),(1 1 0 1,3 1 0 1,1 3 0 1,1 1 0 1))

                </pre></div><div class="refsection"><a name="idp72423240"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a>, <a class="xref" href="#ST_Force2D" title="ST_Force2D">ST_Force2D</a>, <a class="xref" href="#ST_Force_3DM" title="ST_Force3DM">ST_Force3DM</a>, <a class="xref" href="#ST_Force_3D" title="ST_Force3D">ST_Force3D</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_ForcePolygonCCW"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ForcePolygonCCW  — 全ての外環を反時計回りに、全ての内環を時計回りに、それぞれ強制します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef"> geometry <b class="fsfunc">ST_ForcePolygonCCW</b> (</code> geometry <var class="pdparam">geom</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp72430536"></a><h2>説明</h2><p>(マルチ)ポリゴンに対して、外環を反時計回りに、内環を時計回りに強制します。ポリゴンでないジオメトリは、変更されずに返されます。 </p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports M coordinates.</p></div><div class="refsection"><a name="idp72434504"></a><h2>関連情報</h2><p><a class="xref" href="#ST_ForcePolygonCW" title="ST_ForcePolygonCW">ST_ForcePolygonCW </a>, <a class="xref" href="#ST_IsPolygonCCW" title="ST_IsPolygonCCW">ST_IsPolygonCCW </a>, <a class="xref" href="#ST_IsPolygonCW" title="ST_IsPolygonCW">ST_IsPolygonCW </a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Force_Collection"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ForceCollection — ジオメトリをジオメトリコレクションに変換します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_ForceCollection</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72441160"></a><h2>説明</h2><p>ジオメトリをジオメトリコレクションに変換します。これはWKB表現を単純化するのに便利です。</p><p>Enhanced: 2.0.0 多面体サーフェス対応が導入されました。</p><p>Availability: 1.2.2 1.3.4より前は、曲線を含むジオメトリで使うとクラッシュしました。これは1.3.4以上では訂正されています。</p><p>Changed: 2.1.0 2.0.xの間はST_Force_Collectionと呼ばれていました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p></div><div class="refsection"><a name="idp72447432"></a><h2>例</h2><pre class="programlisting">SELECT  ST_AsEWKT(ST_ForceCollection('POLYGON((0 0 1,0 5 1,5 0 1,0 0 1),(1 1 1,3 1 1,1 3 1,1 1 1))'));

                                                                   st_asewkt
----------------------------------------------------------------------------------
 GEOMETRYCOLLECTION(POLYGON((0 0 1,0 5 1,5 0 1,0 0 1),(1 1 1,3 1 1,1 3 1,1 1 1)))


  SELECT ST_AsText(ST_ForceCollection('CIRCULARSTRING(220227 150406,2220227 150407,220227 150406)'));
                                                                   st_astext
--------------------------------------------------------------------------------
 GEOMETRYCOLLECTION(CIRCULARSTRING(220227 150406,2220227 150407,220227 150406))
(1 row)

                </pre><pre class="programlisting">-- 多面体の例 --
SELECT ST_AsEWKT(ST_ForceCollection('POLYHEDRALSURFACE(((0 0 0,0 0 1,0 1 1,0 1 0,0 0 0)),
 ((0 0 0,0 1 0,1 1 0,1 0 0,0 0 0)),
 ((0 0 0,1 0 0,1 0 1,0 0 1,0 0 0)),
 ((1 1 0,1 1 1,1 0 1,1 0 0,1 1 0)),
 ((0 1 0,0 1 1,1 1 1,1 1 0,0 1 0)),
 ((0 0 1,1 0 1,1 1 1,0 1 1,0 0 1)))'))

                                                                   st_asewkt
----------------------------------------------------------------------------------
GEOMETRYCOLLECTION(
  POLYGON((0 0 0,0 0 1,0 1 1,0 1 0,0 0 0)),
  POLYGON((0 0 0,0 1 0,1 1 0,1 0 0,0 0 0)),
  POLYGON((0 0 0,1 0 0,1 0 1,0 0 1,0 0 0)),
  POLYGON((1 1 0,1 1 1,1 0 1,1 0 0,1 1 0)),
  POLYGON((0 1 0,0 1 1,1 1 1,1 1 0,0 1 0)),
  POLYGON((0 0 1,1 0 1,1 1 1,0 1 1,0 0 1))
)
                </pre></div><div class="refsection"><a name="idp72449480"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a>, <a class="xref" href="#ST_Force2D" title="ST_Force2D">ST_Force2D</a>, <a class="xref" href="#ST_Force_3DM" title="ST_Force3DM">ST_Force3DM</a>, <a class="xref" href="#ST_Force_3D" title="ST_Force3D">ST_Force3D</a>, <a class="xref" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_ForcePolygonCW"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ForcePolygonCW  — 全ての外環を時計回りに、全ての内環を反時計回りに、それぞれ強制します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef"> geometry <b class="fsfunc">ST_ForcePolygonCW</b> (</code> geometry <var class="pdparam">geom</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp72461256"></a><h2>説明</h2><p>(マルチ)ポリゴンに対して、外環を時計回りに、内環を反時計回りに強制します。ポリゴンでないジオメトリは、変更されずに返されます。 </p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports M coordinates.</p></div><div class="refsection"><a name="idp72469320"></a><h2>関連情報</h2><p><a class="xref" href="#ST_ForcePolygonCCW" title="ST_ForcePolygonCCW">ST_ForcePolygonCCW </a>, <a class="xref" href="#ST_IsPolygonCCW" title="ST_IsPolygonCCW">ST_IsPolygonCCW </a>, <a class="xref" href="#ST_IsPolygonCW" title="ST_IsPolygonCW">ST_IsPolygonCW </a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_ForceSFS"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ForceSFS — SFS 1.1ジオメトリタイプのみ使うようジオメトリに強制します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_ForceSFS</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_ForceSFS</b>(</code>geometry  <var class="pdparam">geomA</var>, text  <var class="pdparam">version</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72483272"></a><h2>説明</h2><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_ForceRHR"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ForceRHR — ポリゴンの頂点の方向を右回りに強制します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_ForceRHR</b>(</code>geometry <var class="pdparam">g</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72493896"></a><h2>説明</h2><p>ポリゴンの頂点の方向はRight-Hand-Ruleに従います。この際、ポリゴンの領域は、境界線の右側になります。特に、外環は時計回りに強制され、内環は反時計回りに強制されます。この関数は<a class="xref" href="#ST_ForcePolygonCW" title="ST_ForcePolygonCW">ST_ForcePolygonCW </a>の別名です。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>上のRHRの定義は、他の文脈で使われる場合の定義と矛盾します。これを解消するには、ST_ForcePolygonCWを使うことを推奨します。 </p></td></tr></table></div><p>Enhanced: 2.0.0 多面体サーフェス対応が導入されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p></div><div class="refsection"><a name="idp72499400"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsEWKT(
  ST_ForceRHR(
        'POLYGON((0 0 2, 5 0 2, 0 5 2, 0 0 2),(1 1 2, 1 3 2, 3 1 2, 1 1 2))'
  )
);
                                                  st_asewkt
--------------------------------------------------------------
 POLYGON((0 0 2,0 5 2,5 0 2,0 0 2),(1 1 2,3 1 2,1 3 2,1 1 2))
(1 row)</pre></div><div class="refsection"><a name="idp72500680"></a><h2>関連情報</h2><p><a class="xref" href="#ST_ForcePolygonCCW" title="ST_ForcePolygonCCW">ST_ForcePolygonCCW </a>, <a class="xref" href="#ST_ForcePolygonCW" title="ST_ForcePolygonCW">ST_ForcePolygonCW </a>, <a class="xref" href="#ST_IsPolygonCCW" title="ST_IsPolygonCCW">ST_IsPolygonCCW </a>, <a class="xref" href="#ST_IsPolygonCW" title="ST_IsPolygonCW">ST_IsPolygonCW </a>, <a class="xref" href="#ST_BuildArea" title="ST_BuildArea">ST_BuildArea</a>, <a class="xref" href="#ST_Polygonize" title="ST_Polygonize">ST_Polygonize</a>, <a class="xref" href="#ST_Reverse" title="ST_Reverse">ST_Reverse</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_ForceCurve"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ForceCurve — 該当する場合は、ジオメトリを曲線タイプに変換します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_ForceCurve</b>(</code>geometry <var class="pdparam">g</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72508744"></a><h2>説明</h2><p>可能ならジオメトリを曲線表現に変更します。ラインは複合曲線になり、マルチラインはマルチ曲線になり、ポリゴンは曲線ポリゴンになり、マルチポリゴンはマルチサーフェスになります。入力ジオメトリが既に曲線表現であるなら、入力と同じ値が返されます。 </p><p>Availability: 2.2.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p></div><div class="refsection"><a name="idp72513096"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(
  ST_ForceCurve(
        'POLYGON((0 0 2, 5 0 2, 0 5 2, 0 0 2),(1 1 2, 1 3 2, 3 1 2, 1 1 2))'::geometry
  )
);
                              st_astext
----------------------------------------------------------------------
 CURVEPOLYGON Z ((0 0 2,5 0 2,0 5 2,0 0 2),(1 1 2,1 3 2,3 1 2,1 1 2))
(1 row)</pre></div><div class="refsection"><a name="idp72514376"></a><h2>関連情報</h2><p><a class="xref" href="#ST_LineToCurve" title="ST_LineToCurve">ST_LineToCurve</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_LineMerge"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_LineMerge — MULTILINESTRINGをまとめ合わせて形成されるラインストリング (またはその集合)を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_LineMerge</b>(</code>geometry  <var class="pdparam">amultilinestring</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72520136"></a><h2>説明</h2><p>MULTILINESTRINGをまとめ合わせて形成されるラインストリング (またはその集合)を返します。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>MULTILINESTRING/LINESTRINGに対してのみ使用して下さい。ポリゴンやジオメトリコレクションに対してこの関数を使うと、空のGEOMETRYCOLLECTIONが返ります。</p></td></tr></table></div><p>Availability: 1.1.0</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>GEOS 2.1.0以上が必須です。</p></td></tr></table></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>M値は除かれます。</p></td></tr></table></div></div><div class="refsection"><a name="idp72523208"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(ST_LineMerge(
ST_GeomFromText('MULTILINESTRING((-29 -27,-30 -29.7,-36 -31,-45 -33),(-45 -33,-46 -32))')
                )
);
st_astext
--------------------------------------------------------------------------------------------------
LINESTRING(-29 -27,-30 -29.7,-36 -31,-45 -33,-46 -32)
(1 row)

-- まとめられない場合 - 元のマルチラインストリングが返されます
SELECT ST_AsText(ST_LineMerge(
ST_GeomFromText('MULTILINESTRING((-29 -27,-30 -29.7,-36 -31,-45 -33),(-45.2 -33.2,-46 -32))')
)
);
st_astext
----------------
MULTILINESTRING((-45.2 -33.2,-46 -32),(-29 -27,-30 -29.7,-36 -31,-45 -33))

-- Z値を持つ例
SELECT ST_AsText(ST_LineMerge(
ST_GeomFromText('MULTILINESTRING((-29 -27 11,-30 -29.7 10,-36 -31 5,-45 -33 6), (-29 -27 12,-30 -29.7 5), (-45 -33 1,-46 -32 11))')
                )
);
st_astext
--------------------------------------------------------------------------------------------------
LINESTRING Z (-30 -29.7 5,-29 -27 11,-30 -29.7 10,-36 -31 5,-45 -33 1,-46 -32 11)
(1 row)
                        </pre></div><div class="refsection"><a name="idp72524488"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Segmentize" title="ST_Segmentize">ST_Segmentize</a>, <a class="xref" href="#ST_LineSubstring" title="ST_LineSubstring">ST_LineSubstring</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_CollectionExtract"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_CollectionExtract — (マルチ)ジオメトリを与えると、指定したタイプの要素でのみ構成される (マルチ)ジオメトリを返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_CollectionExtract</b>(</code>geometry  <var class="pdparam">collection</var>, integer  <var class="pdparam">type</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72531656"></a><h2>説明</h2><p>(マルチ)ジオメトリを与えると、指定したタイプの要素でのみ構成される (マルチ)ジオメトリを返します。指定したタイプでないジオメトリ要素は無視されます。正しいタイプのジオメトリ要素が無い場合はEMPTYジオメトリが返ります。ポイント、ラインストリング、ポリゴンのみをサポートします。番号は、1==ポイント, 2==ラインストリング, 3==ポリゴンです。 </p><p>Availability: 1.5.0</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>1.5.3より前では、この関数は、非コクレションの入力については手を付けずに問題のないタイプで返しました。1.5.3では、適合しない単一ジオメトリについてはNULLを返しました。2.0.0では、適合するジオメトリが無い場合は常にEMPTYを返すようになりました。 </p></td></tr></table></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>3 == POLYGONを指定すると、エッジが共有されていたとしてもマルチポリゴンが返ります。この関数を<a class="xref" href="#ST_Split" title="ST_Split">ST_Split</a>の結果への適用の多くの場合に不正なマルチポリゴンとなります。</p></td></tr></table></div></div><div class="refsection"><a name="idp72534600"></a><h2>例</h2><pre class="programlisting">-- 定数: 1 == ポイント, 2 == ラインストリング, 3 == ポリゴン
SELECT ST_AsText(ST_CollectionExtract(ST_GeomFromText('GEOMETRYCOLLECTION(GEOMETRYCOLLECTION(POINT(0 0)))'),1));
st_astext
---------------
MULTIPOINT(0 0)
(1 row)

SELECT ST_AsText(ST_CollectionExtract(ST_GeomFromText('GEOMETRYCOLLECTION(GEOMETRYCOLLECTION(LINESTRING(0 0, 1 1)),LINESTRING(2 2, 3 3))'),2));
st_astext
---------------
MULTILINESTRING((0 0, 1 1), (2 2, 3 3))
(1 row)
                        </pre></div><div class="refsection"><a name="idp72535880"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Multi" title="ST_Multi">ST_Multi</a>, <a class="xref" href="#ST_Dump" title="ST_Dump">ST_Dump</a>, <a class="xref" href="#ST_CollectionHomogenize" title="ST_CollectionHomogenize">ST_CollectionHomogenize</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_CollectionHomogenize"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_CollectionHomogenize — ジオメトリコレクションを与えると、「最も単純な」表現を返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_CollectionHomogenize</b>(</code>geometry  <var class="pdparam">collection</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72542408"></a><h2>説明</h2><p>ジオメトリコレクションを与えると、「最も単純な」表現を返します。非マルチなタイプは非マルチのタイプを返します。同質なコレクションは適切なマルチ系タイプを返します。 </p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>3 == POLYGONを指定すると、エッジが共有されていたとしてもマルチポリゴンが返ります。この関数を<a class="xref" href="#ST_Split" title="ST_Split">ST_Split</a>の結果への適用の多くの場合に不正なマルチポリゴンとなります。</p></td></tr></table></div><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp72557128"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(ST_CollectionHomogenize('GEOMETRYCOLLECTION(POINT(0 0))'));

        st_astext
        ------------
         POINT(0 0)
        (1 row)

  SELECT ST_AsText(ST_CollectionHomogenize('GEOMETRYCOLLECTION(POINT(0 0),POINT(1 1))'));

        st_astext
        ---------------------
         MULTIPOINT(0 0,1 1)
        (1 row)

                                </pre></div><div class="refsection"><a name="idp72558408"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Multi" title="ST_Multi">ST_Multi</a>, <a class="xref" href="#ST_CollectionExtract" title="ST_CollectionExtract">ST_CollectionExtract</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Multi"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Multi — マルチ系ジオメトリを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Multi</b>(</code>geometry  <var class="pdparam">g1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72564552"></a><h2>説明</h2><p>マルチ系ジオメトリを返します。ジオメトリが既にマルチ系なら変更せずに返します。</p></div><div class="refsection"><a name="idp72565832"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(ST_Multi(ST_GeomFromText('POLYGON((743238 2967416,743238 2967450,
                        743265 2967450,743265.625 2967416,743238 2967416))')));
                        st_astext
                        --------------------------------------------------------------------------------------------------
                        MULTIPOLYGON(((743238 2967416,743238 2967450,743265 2967450,743265.625 2967416,
                        743238 2967416)))
                        (1 row)
                        </pre></div><div class="refsection"><a name="idp72567112"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Normalize"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Normalize — 標準的な形式に変えたジオメトリを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Normalize</b>(</code>geometry  <var class="pdparam">geom</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72572872"></a><h2>説明</h2><p>正規化/標準化された形式のジオメトリを返します。ポリゴンの環における頂点の順序、ポリゴンにおける環の順序、複合ジオメトリにおける要素の順序が変更されることがあります。 </p><p>ほとんどの場合、試験目的 (期待した結果と実際に得た結果との比較)でのみ使用します。 </p><p>Availability: 2.3.0</p></div><div class="refsection"><a name="idp72574920"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(ST_Normalize(ST_GeomFromText(
  'GEOMETRYCOLLECTION(
    POINT(2 3),
    MULTILINESTRING((0 0, 1 1),(2 2, 3 3)),
    POLYGON(
      (0 10,0 0,10 0,10 10,0 10),
      (4 2,2 2,2 4,4 4,4 2),
      (6 8,8 8,8 6,6 6,6 8)
    )
  )'
)));
                                                                     st_astext
----------------------------------------------------------------------------------------------------------------------------------------------------
 GEOMETRYCOLLECTION(POLYGON((0 0,0 10,10 10,10 0,0 0),(6 6,8 6,8 8,6 8,6 6),(2 2,4 2,4 4,2 4,2 2)),MULTILINESTRING((2 2,3 3),(0 0,1 1)),POINT(2 3))
(1 row)
                        </pre></div><div class="refsection"><a name="idp72576200"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Equals" title="ST_Equals">ST_Equals</a>, </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_QuantizeCoordinates"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_QuantizeCoordinates  — 座標値の最下位ビットを0にします。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef"> geometry <b class="fsfunc">ST_QuantizeCoordinates</b> (</code> geometry <var class="pdparam">g</var> ,  int <var class="pdparam">prec_x</var> ,  int <var class="pdparam">prec_y</var> ,  int <var class="pdparam">prec_z</var> ,  int <var class="pdparam">prec_m</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp72587592"></a><h2>説明</h2><p><code class="code">ST_QuantizeCoordinates</code>は、指定した小数点以下の桁数での座標値表現に必要なビット数 (<code class="code">N</code>)を決定し、最大の有効ビット数<code class="code">N</code>以外を0にします。結果の座標値は元の値を丸めますが、圧縮性が改善されます。これにより、ジオメトリカラムが<a class="ulink" href="https://www.postgresql.org/docs/current/static/storage-toast.html#STORAGE-TOAST-ONDISK" target="_top"> compressible storage type</a>を使って、ディスク使用を劇的に減少させることができます。この関数によって、小数点以下の桁数の異なる指定が可能になります。指定されていない次元は<code class="code">x</code>次元の精度を持つものとします。負の桁数は、小数点以上の桁数の参照に置き換えられます (例: <code class="code">prec_x=-2</code>は100付近の座標値を保存します)。 </p><p><code class="code">ST_QuantizeCoordinates</code>が生成する座標は、これらの座標を含むジオメトリや、ジオメトリ内のこれらの相対的な位置から独立しています。結果として、ジオメトリ間に存在するトポロジ関係は、この関数の使用によって影響を受けることはありません。この関数は、ジオメトリの内在的な精度より低い桁数では不正なジオメトリを生成する可能性があります。 </p><p>Availability: 2.5.0</p></div><div class="refsection"><a name="idp72592072"></a><h2>技術背景</h2><p>PostGIS はすべての座標値を倍精度浮動小数点数として格納し、15桁の有効桁数を確実に表すことができます。ただし、PostGISでは、本質的に15桁未満のデータの管理ができます。例としては、小数点以下6桁の精度の地理座標として提供されるTigerデータがあります (故に、必要な有効桁数は、経度は9桁、緯度は8桁です)。 </p><p>有効桁数が15の時、多数のありえる9桁の表現があります。倍精度浮動小数点数は52の明示的なビット数を座標の仮数部に使っています。有効桁数9桁では仮数部は30ビットだけ必要で、22ビットは有効ではありません。これらの値を好きなものにすることができ、結局は入力値を丸める数字となります。例えば、100.123456という値は100.123456000000, 100.123456000001および100.123456432199に近い数として表現されます。全ては等しく妥当で、これらの入力では<code class="code">ST_AsText(geom, 6)</code>は同じ結果を返します。これらのビット数をあらゆる値にセットすることができるので、<code class="code">ST_QuantizeCoordinates</code>は無効ビットとなる22ビットに0をセットします。長い座標値のビット列では、連続的な0のブロックから、PostgreSQLによって効率的に圧縮されたパターンを生成します。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ジオメトリのディスク上のサイズだけが<code class="code">ST_QuantizeCoordinates</code>の影響を潜在的に受けます。ジオメトリのメモリ利用を報告する<a class="xref" href="#ST_MemSize" title="ST_MemSize">ST_MemSize</a>は、ジオメトリに使われるディスク上のサイズにかかわらず同じ値を返します。 </p></td></tr></table></div></div><div class="refsection"><a name="idp72596040"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(ST_QuantizeCoordinates('POINT (100.123456 0)'::geometry, 4));
st_astext
-------------------------
POINT(100.123455047607 0)
                        </pre><pre class="programlisting">WITH test AS (SELECT 'POINT (123.456789123456 123.456789123456)'::geometry AS geom)
SELECT
  digits,
  encode(ST_QuantizeCoordinates(geom, digits), 'hex'),
  ST_AsText(ST_QuantizeCoordinates(geom, digits))
FROM test, generate_series(15, -15, -1) AS digits;

digits  |                   encode                   |                st_astext
--------+--------------------------------------------+------------------------------------------
15      | 01010000005f9a72083cdd5e405f9a72083cdd5e40 | POINT(123.456789123456 123.456789123456)
14      | 01010000005f9a72083cdd5e405f9a72083cdd5e40 | POINT(123.456789123456 123.456789123456)
13      | 01010000005f9a72083cdd5e405f9a72083cdd5e40 | POINT(123.456789123456 123.456789123456)
12      | 01010000005c9a72083cdd5e405c9a72083cdd5e40 | POINT(123.456789123456 123.456789123456)
11      | 0101000000409a72083cdd5e40409a72083cdd5e40 | POINT(123.456789123456 123.456789123456)
10      | 0101000000009a72083cdd5e40009a72083cdd5e40 | POINT(123.456789123455 123.456789123455)
9       | 0101000000009072083cdd5e40009072083cdd5e40 | POINT(123.456789123418 123.456789123418)
8       | 0101000000008072083cdd5e40008072083cdd5e40 | POINT(123.45678912336 123.45678912336)
7       | 0101000000000070083cdd5e40000070083cdd5e40 | POINT(123.456789121032 123.456789121032)
6       | 0101000000000040083cdd5e40000040083cdd5e40 | POINT(123.456789076328 123.456789076328)
5       | 0101000000000000083cdd5e40000000083cdd5e40 | POINT(123.456789016724 123.456789016724)
4       | 0101000000000000003cdd5e40000000003cdd5e40 | POINT(123.456787109375 123.456787109375)
3       | 0101000000000000003cdd5e40000000003cdd5e40 | POINT(123.456787109375 123.456787109375)
2       | 01010000000000000038dd5e400000000038dd5e40 | POINT(123.45654296875 123.45654296875)
1       | 01010000000000000000dd5e400000000000dd5e40 | POINT(123.453125 123.453125)
0       | 01010000000000000000dc5e400000000000dc5e40 | POINT(123.4375 123.4375)
-1      | 01010000000000000000c05e400000000000c05e40 | POINT(123 123)
-2      | 01010000000000000000005e400000000000005e40 | POINT(120 120)
-3      | 010100000000000000000058400000000000005840 | POINT(96 96)
-4      | 010100000000000000000058400000000000005840 | POINT(96 96)
-5      | 010100000000000000000058400000000000005840 | POINT(96 96)
-6      | 010100000000000000000058400000000000005840 | POINT(96 96)
-7      | 010100000000000000000058400000000000005840 | POINT(96 96)
-8      | 010100000000000000000058400000000000005840 | POINT(96 96)
-9      | 010100000000000000000058400000000000005840 | POINT(96 96)
-10     | 010100000000000000000058400000000000005840 | POINT(96 96)
-11     | 010100000000000000000058400000000000005840 | POINT(96 96)
-12     | 010100000000000000000058400000000000005840 | POINT(96 96)
-13     | 010100000000000000000058400000000000005840 | POINT(96 96)
-14     | 010100000000000000000058400000000000005840 | POINT(96 96)
-15     | 010100000000000000000058400000000000005840 | POINT(96 96)
</pre></div><div class="refsection"><a name="idp72597832"></a><h2>関連情報</h2><p><a class="xref" href="#ST_SnapToGrid" title="ST_SnapToGrid">ST_SnapToGrid</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_RemovePoint"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_RemovePoint — ラインストリングからポイントを削除します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_RemovePoint</b>(</code>geometry <var class="pdparam">linestring</var>, integer <var class="pdparam">offset</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72633288"></a><h2>説明</h2><p>ラインストリングからポイントを削除します。インデックスは0始まりです。閉じたリングを開いたラインストリングに変えるのに使います。</p><p>Availability: 1.1.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp72636232"></a><h2>例</h2><pre class="programlisting">-- 終点を削除して閉じたラインストリングが無いこを保障します。
-- 下の例ではthe_geomはラインストリングであると仮定しています。
UPDATE sometable
        SET the_geom = ST_RemovePoint(the_geom, ST_NPoints(the_geom) - 1)
        FROM sometable
        WHERE ST_IsClosed(the_geom) = true;
                </pre></div><div class="refsection"><a name="idp72637512"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AddPoint" title="ST_AddPoint">ST_AddPoint</a>, <a class="xref" href="#ST_NPoints" title="ST_NPoints">ST_NPoints</a>, <a class="xref" href="#ST_NumPoints" title="ST_NumPoints">ST_NumPoints</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Reverse"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Reverse — 頂点の順序を逆にしたジオメトリを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Reverse</b>(</code>geometry  <var class="pdparam">g1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72644040"></a><h2>説明</h2><p>どのジオメトリでも使用可能です。頂点の順序を逆にします。</p><p>Enhanced: 2.4.0 曲線対応が導入されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p></div><div class="refsection"><a name="idp72648392"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(the_geom) as line, ST_AsText(ST_Reverse(the_geom)) As reverseline
FROM
(SELECT ST_MakeLine(ST_MakePoint(1,2),
                ST_MakePoint(1,10)) As the_geom) as foo;
-- 結果
                line         |     reverseline
---------------------+----------------------
LINESTRING(1 2,1 10) | LINESTRING(1 10,1 2)
</pre></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Rotate"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Rotate — ジオメトリを、原点について反時計回りにrotRadiasnぶん回転させます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Rotate</b>(</code>geometry <var class="pdparam">geomA</var>, float <var class="pdparam">rotRadians</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_Rotate</b>(</code>geometry <var class="pdparam">geomA</var>, float <var class="pdparam">rotRadians</var>, float <var class="pdparam">x0</var>, float <var class="pdparam">y0</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_Rotate</b>(</code>geometry <var class="pdparam">geomA</var>, float <var class="pdparam">rotRadians</var>, geometry <var class="pdparam">pointOrigin</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72664648"></a><h2>説明</h2><p>ジオメトリを、原点について反時計回りにrotRadiasnぶん回転させます。原点はPOINTジオメトリか、xとyの座標値を指定します。原点を指定しない場合にはPOINT(0,0)について回転させます。</p><p>Enhanced: 2.0.0 多面体サーフェス対応、三角対応、TIN対応が導入されました。</p><p>Enhanced: 2.0.0 回転の原点を指定するパラメタを追加しました。</p><p>Availability: 1.1.2 RotateからST_Rotateに名称変更しました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div><div class="refsection"><a name="idp72672328"></a><h2>例</h2><pre class="programlisting">-- 180度回転
SELECT ST_AsEWKT(ST_Rotate('LINESTRING (50 160, 50 50, 100 50)', pi()));
               st_asewkt
---------------------------------------
 LINESTRING(-50 -160,-50 -50,-100 -50)
(1 row)

-- x=50,y=160で反時計回りに30度回転
SELECT ST_AsEWKT(ST_Rotate('LINESTRING (50 160, 50 50, 100 50)', pi()/6, 50, 160));
                                 st_asewkt
---------------------------------------------------------------------------
 LINESTRING(50 160,105 64.7372055837117,148.301270189222 89.7372055837117)
(1 row)

-- 重心位置で時計回りに60度回転
SELECT ST_AsEWKT(ST_Rotate(geom, -pi()/3, ST_Centroid(geom)))
FROM (SELECT 'LINESTRING (50 160, 50 50, 100 50)'::geometry AS geom) AS foo;
                           st_asewkt
--------------------------------------------------------------
 LINESTRING(116.4225 130.6721,21.1597 75.6721,46.1597 32.3708)
(1 row)
                </pre></div><div class="refsection"><a name="idp72673864"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Affine" title="ST_Affine">ST_Affine</a>, <a class="xref" href="#ST_RotateX" title="ST_RotateX">ST_RotateX</a>, <a class="xref" href="#ST_RotateY" title="ST_RotateY">ST_RotateY</a>, <a class="xref" href="#ST_RotateZ" title="ST_RotateZ">ST_RotateZ</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_RotateX"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_RotateX — ジオメトリをX軸についてrotRadiansぶん回転させます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_RotateX</b>(</code>geometry <var class="pdparam">geomA</var>, float <var class="pdparam">rotRadians</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72685896"></a><h2>説明</h2><p>ジオメトリgeomAをX軸についてrotRadiansぶん回転させます。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="code">ST_RotateX(geomA, rotRadians)</code>は<code class="code">ST_Affine(geomA, 1, 0, 0, 0, cos(rotRadians), -sin(rotRadians), 0, sin(rotRadians), cos(rotRadians), 0, 0, 0)</code>の短縮版です。</p></td></tr></table></div><p>Enhanced: 2.0.0 多面体サーフェス対応、三角対応、TIN対応が導入されました。</p><p>Availability: 1.1.2 1.2.2でRotateXからST_RotateXに名称変更しました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div><div class="refsection"><a name="idp71243208"></a><h2>例</h2><pre class="programlisting">-- ラインをX軸について90度回転
SELECT ST_AsEWKT(ST_RotateX(ST_GeomFromEWKT('LINESTRING(1 2 3, 1 1 1)'), pi()/2));
                 st_asewkt
---------------------------
 LINESTRING(1 -3 2,1 -1 1)
</pre></div><div class="refsection"><a name="idp71244744"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Affine" title="ST_Affine">ST_Affine</a>, <a class="xref" href="#ST_RotateY" title="ST_RotateY">ST_RotateY</a>, <a class="xref" href="#ST_RotateZ" title="ST_RotateZ">ST_RotateZ</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_RotateY"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_RotateY — ジオメトリgeomAをY軸についてrotRadiansぶん回転させます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_RotateY</b>(</code>geometry <var class="pdparam">geomA</var>, float <var class="pdparam">rotRadians</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp71252296"></a><h2>説明</h2><p>ジオメトリgeomAをY軸についてrotRadiansぶん回転させます。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="code">ST_RotateY(geomA, rotRadians)</code> is short-hand for <code class="code">ST_Affine(geomA, cos(rotRadians), 0, sin(rotRadians), 0, 1, 0, -sin(rotRadians), 0, cos(rotRadians), 0, 0, 0)</code>.</p></td></tr></table></div><p>Availability: 1.1.2 1.2.2でRotateYからST_RotateYに名称変更しました。</p><p>Enhanced: 2.0.0 多面体サーフェス対応、三角対応、TIN対応が導入されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div><div class="refsection"><a name="idp72689096"></a><h2>例</h2><pre class="programlisting">-- ラインをY軸について90度回転
 SELECT ST_AsEWKT(ST_RotateY(ST_GeomFromEWKT('LINESTRING(1 2 3, 1 1 1)'), pi()/2));
                 st_asewkt
---------------------------
 LINESTRING(3 2 -1,1 1 -1)
</pre></div><div class="refsection"><a name="idp72690632"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Affine" title="ST_Affine">ST_Affine</a>, <a class="xref" href="#ST_RotateX" title="ST_RotateX">ST_RotateX</a>, <a class="xref" href="#ST_RotateZ" title="ST_RotateZ">ST_RotateZ</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_RotateZ"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_RotateZ — ジオメトリをZ軸についてrotRadiansぶん回転させます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_RotateZ</b>(</code>geometry <var class="pdparam">geomA</var>, float <var class="pdparam">rotRadians</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72698184"></a><h2>説明</h2><p>ジオメトリをZ軸についてrotRadiansぶん回転させます。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はST_Rotateと同じです。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="code">ST_RotateZ(geomA, rotRadians)</code>は<code class="code">SELECT ST_Affine(geomA, cos(rotRadians), -sin(rotRadians), 0, sin(rotRadians), cos(rotRadians), 0, 0, 0, 1, 0, 0, 0)</code>の短縮版です。</p></td></tr></table></div><p>Enhanced: 2.0.0 多面体サーフェス対応、三角対応、TIN対応が導入されました。</p><p>Availability: 1.1.2 1.2.2でRotateZからST_RotateZに名称変更しました。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>1.3.4より前では、曲線を含むジオメトリで使用すると、この関数はクラッシュします。これは1.3.4以上で訂正されています。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div><div class="refsection"><a name="idp72711880"></a><h2>例</h2><pre class="programlisting">-- ラインをZ軸について90度回転
SELECT ST_AsEWKT(ST_RotateZ(ST_GeomFromEWKT('LINESTRING(1 2 3, 1 1 1)'), pi()/2));
                 st_asewkt
---------------------------
 LINESTRING(-2 1 3,-1 1 1)

-- 曲線化した円をZ軸について回転
SELECT ST_AsEWKT(ST_RotateZ(the_geom, pi()/2))
FROM (SELECT ST_LineToCurve(ST_Buffer(ST_GeomFromText('POINT(234 567)'), 3)) As the_geom) As foo;

                                                                                                           st_asewkt
----------------------------------------------------------------------------------------------------------------------------
 CURVEPOLYGON(CIRCULARSTRING(-567 237,-564.87867965644 236.12132034356,-564 234,-569.12132034356 231.87867965644,-567 237))

</pre></div><div class="refsection"><a name="idp72713416"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Affine" title="ST_Affine">ST_Affine</a>, <a class="xref" href="#ST_RotateX" title="ST_RotateX">ST_RotateX</a>, <a class="xref" href="#ST_RotateY" title="ST_RotateY">ST_RotateY</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Scale"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Scale — 与えた係数でジオメトリを拡大縮小します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Scale</b>(</code>geometry  <var class="pdparam">geomA</var>, float <var class="pdparam">XFactor</var>, float <var class="pdparam">YFactor</var>, float <var class="pdparam">ZFactor</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_Scale</b>(</code>geometry  <var class="pdparam">geomA</var>, float <var class="pdparam">XFactor</var>, float <var class="pdparam">YFactor</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_Scale</b>(</code>geometry  <var class="pdparam">geom</var>, geometry <var class="pdparam">factor</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_Scale</b>(</code>geometry  <var class="pdparam">geom</var>, geometry <var class="pdparam">factor</var>, geometry <var class="pdparam">origin</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72730568"></a><h2>説明</h2><p>対応するパラメータで軸を乗算してジオメトリを新しいサイズに拡大縮小します。 </p><p><code class="varname">factor</code>パラメータでジオメトリを取る形式では、2次元、3次元 (XYZ. XYM)、4次元のポイントで、全ての対応する次元のスケーリングの乗数を設定することができます。<code class="varname">factor</code>ポイントの欠けた次元については、対応する次元は拡大縮小をしないのと等価になります。 </p><p>三つのジオメトリを与える形式では、拡大縮小に「仮原点」を渡すことができます。これにより、たとえば、仮原点としてジオメトリの重心を使うといった、「適切な位置での拡大縮小」が可能となります。仮原点を使わない場合には、拡大縮小は実際の原点からの位置で行われるので、全ての座標は拡大縮小係数との積になります。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>1.3.4より前では、曲線を含むジオメトリで使用すると、この関数はクラッシュします。これは1.3.4以上で訂正されています。</p></td></tr></table></div><p>Availability: 1.1.0</p><p>Enhanced: 2.0.0 多面体サーフェス対応、三角対応、TIN対応が導入されました。</p><p>Enhanced: 2.2.0 全ての次元の拡大縮小の対応 (ジオメトリによる引数指定)を導入しました</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports M coordinates.</p></div><div class="refsection"><a name="idp72741832"></a><h2>例</h2><pre class="programlisting">-- 一つ目: X, Y, Zの拡大縮小
SELECT ST_AsEWKT(ST_Scale(ST_GeomFromEWKT('LINESTRING(1 2 3, 1 1 1)'), 0.5, 0.75, 0.8));
                          st_asewkt
--------------------------------------
 LINESTRING(0.5 1.5 2.4,0.5 0.75 0.8)

-- 二つ目: X, Yの拡大縮小
 SELECT ST_AsEWKT(ST_Scale(ST_GeomFromEWKT('LINESTRING(1 2 3, 1 1 1)'), 0.5, 0.75));
                        st_asewkt
----------------------------------
 LINESTRING(0.5 1.5 3,0.5 0.75 1)

-- 三つ目: X, Y, Z, Mの拡大縮小
 SELECT ST_AsEWKT(ST_Scale(ST_GeomFromEWKT('LINESTRING(1 2 3 4, 1 1 1 1)'),
   ST_MakePoint(0.5, 0.75, 2, -1)));
                               st_asewkt
----------------------------------------
 LINESTRING(0.5 1.5 6 -4,0.5 0.75 2 -1)

-- 四つ目: 仮原点を使ったX, Yの拡大縮小
SELECT ST_AsText(ST_Scale('LINESTRING(1 1, 2 2)', 'POINT(2 2)', 'POINT(1 1)'::geometry));
      st_astext
---------------------
 LINESTRING(1 1,3 3)

</pre></div><div class="refsection"><a name="idp72743368"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Affine" title="ST_Affine">ST_Affine</a>, <a class="xref" href="#ST_TransScale" title="ST_TransScale">ST_TransScale</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Segmentize"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Segmentize — 与えた距離を超える線分を持たないよう変更したジオメトリ/ジオグラフィを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Segmentize</b>(</code>geometry  <var class="pdparam">geom</var>, float  <var class="pdparam">max_segment_length</var><code>)</code>;</p><p><code class="funcdef">geography <b class="fsfunc">ST_Segmentize</b>(</code>geography  <var class="pdparam">geog</var>, float  <var class="pdparam">max_segment_length</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72753864"></a><h2>説明</h2><p><code class="varname">max_segment_length</code>より長い辺を持たないジオメトリ/ジオグラフィに編集して返します。距離計算は2次元のみで行います。ジオメトリの場合、距離の単位は空間参照系の単位です。ジオグラフィの場合、メートル単位となります。</p><p>Availability: 1.2.2</p><p>Enhanced: 3.0.0 ジオグラフィの分割において、現在は、同じ長さに分割しています。</p><p>Enhanced: 2.3.0 ジオグラフィの分割において、現在は、同じ長さに分割しています。</p><p>Enhanced: 2.1.0 ジオグラフィ対応が導入されました。</p><p>Changed: 2.1.0 ジオグラフィ対応導入の結果として、<code class="code">SELECT ST_Segmentize('LINESTRING(1 2, 3 4)',0.5);</code>では、あいまいな関数呼び出しエラーとなります。確実にタイプを指定したオブジェクトを持たせる必要があります。たとえば、ジオメトリ/ジオグラフィカラムであったり、ST_GeomFromText, ST_GeogFromTextを使ったり、<code class="code">SELECT ST_Segmentize('LINESTRING(1 2, 3 4)'::geometry,0.5);</code>としたりします。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数によって辺の数が増えるだけです。最大長より短い辺の長さを伸ばすことはしません。</p></td></tr></table></div></div><div class="refsection"><a name="idp72758472"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(ST_Segmentize(
ST_GeomFromText('MULTILINESTRING((-29 -27,-30 -29.7,-36 -31,-45 -33),(-45 -33,-46 -32))')
                ,5)
);
st_astext
--------------------------------------------------------------------------------------------------
MULTILINESTRING((-29 -27,-30 -29.7,-34.886615700134 -30.758766735029,-36 -31,
-40.8809353009198 -32.0846522890933,-45 -33),
(-45 -33,-46 -32))
(1 row)

SELECT ST_AsText(ST_Segmentize(ST_GeomFromText('POLYGON((-29 28, -30 40, -29 28))'),10));
st_astext
-----------------------
POLYGON((-29 28,-29.8304547985374 37.9654575824488,-30 40,-29.1695452014626 30.0345424175512,-29 28))
(1 row)

                        </pre></div><div class="refsection"><a name="idp72759752"></a><h2>関連情報</h2><p><a class="xref" href="#ST_LineSubstring" title="ST_LineSubstring">ST_LineSubstring</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_SetPoint"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SetPoint — ラインストリングのポイントを与えられたポイントに置き換えます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_SetPoint</b>(</code>geometry <var class="pdparam">linestring</var>, integer <var class="pdparam">zerobasedposition</var>, geometry <var class="pdparam">point</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72767560"></a><h2>説明</h2><p>ラインストリングのN番目を与えられたポイントに置き換えます。インデクスは0はじまりです。負のインデックス値を与えると末尾から数えます。-1は末尾のポイントを指します。これは、頂点が一つ動いた時に接続のリレーションシップを維持しようとする場合のトリガに特に便利です。</p><p>Availability: 1.1.0</p><p>Updated 2.3.0 : 添え字の負数</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp72770888"></a><h2>例</h2><pre class="programlisting">-- ラインストリング先頭のポイントを-1 3から-1 1に変更
SELECT ST_AsText(ST_SetPoint('LINESTRING(-1 2,-1 3)', 0, 'POINT(-1 1)'));
           st_astext
-----------------------
 LINESTRING(-1 1,-1 3)

-- ラインストリング末尾のポイントを変更 (3次元ラインストリングでやってみます)
SELECT ST_AsEWKT(ST_SetPoint(foo.the_geom, ST_NumPoints(foo.the_geom) - 1, ST_GeomFromEWKT('POINT(-1 1 3)')))
FROM (SELECT ST_GeomFromEWKT('LINESTRING(-1 2 3,-1 3 4, 5 6 7)') As the_geom) As foo;
           st_asewkt
-----------------------
LINESTRING(-1 2 3,-1 3 4,-1 1 3)

SELECT ST_AsText(ST_SetPoint(g, -3, p))
FROM ST_GEomFromText('LINESTRING(0 0, 1 1, 2 2, 3 3, 4 4)') AS g
        , ST_PointN(g,1) as p;
           st_astext
-----------------------
LINESTRING(0 0,1 1,0 0,3 3,4 4)

                        </pre></div><div class="refsection"><a name="idp72772168"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AddPoint" title="ST_AddPoint">ST_AddPoint</a>, <a class="xref" href="#ST_NPoints" title="ST_NPoints">ST_NPoints</a>, <a class="xref" href="#ST_NumPoints" title="ST_NumPoints">ST_NumPoints</a>, <a class="xref" href="#ST_PointN" title="ST_PointN">ST_PointN</a>, <a class="xref" href="#ST_RemovePoint" title="ST_RemovePoint">ST_RemovePoint</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_SetSRID"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SetSRID — ジオメトリのSRIDを特定の整数値に設定します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_SetSRID</b>(</code>geometry  <var class="pdparam">geom</var>, integer  <var class="pdparam">srid</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72809160"></a><h2>説明</h2><p>ジオメトリのSRIDを特定の整数値に設定します。クエリのためのバウンディングボックスを生成する際に使います。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はジオメトリを変換せず、ジオメトリが仮定する空間参照系を定義するメタデータを設定するだけです。ジオメトリを新しい投影法に変換したい場合は<a class="xref" href="#ST_Transform" title="ST_Transform">ST_Transform</a>を使います。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a></p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p></div><div class="refsection"><a name="idp72814152"></a><h2>例</h2><p>-- ポイントをWGS84経度緯度に設定 --</p><pre class="programlisting">SELECT ST_SetSRID(ST_Point(-123.365556, 48.428611),4326) As wgs84long_lat;
-- EWKT表現 (ST_AsEWKTでラップして表示します) --
SRID=4326;POINT(-123.365556 48.428611)
                        </pre><p>-- ポイントをWGS84経度緯度に設定したうえで、WEBメルカトル(球面メルカトル)に変換 --</p><pre class="programlisting">SELECT ST_Transform(ST_SetSRID(ST_Point(-123.365556, 48.428611),4326),3785) As spere_merc;
-- EWKT表現 (ST_AsEWKTでラップします) --
SRID=3785;POINT(-13732990.8753491 6178458.96425423)
                        </pre></div><div class="refsection"><a name="idp72816712"></a><h2>関連情報</h2><p><a class="xref" href="#spatial_ref_sys" title="4.3.1. SPATIAL_REF_SYSテーブルと空間参照系">「SPATIAL_REF_SYSテーブルと空間参照系」</a>, <a class="xref" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a>, <a class="xref" href="#ST_Point" title="ST_Point">ST_Point</a>, <a class="xref" href="#ST_SRID" title="ST_SRID">ST_SRID</a>, <a class="xref" href="#ST_Transform" title="ST_Transform">ST_Transform</a>, <a class="xref" href="#UpdateGeometrySRID" title="UpdateGeometrySRID">UpdateGeometrySRID</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_SnapToGrid"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SnapToGrid — 入力ジオメトリの全ての点を規則的なグリッドにスナップします。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_SnapToGrid</b>(</code>geometry  <var class="pdparam">geomA</var>, float  <var class="pdparam">originX</var>, float  <var class="pdparam">originY</var>, float  <var class="pdparam">sizeX</var>, float  <var class="pdparam">sizeY</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_SnapToGrid</b>(</code>geometry  <var class="pdparam">geomA</var>, float  <var class="pdparam">sizeX</var>, float  <var class="pdparam">sizeY</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_SnapToGrid</b>(</code>geometry  <var class="pdparam">geomA</var>, float  <var class="pdparam">size</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_SnapToGrid</b>(</code>geometry  <var class="pdparam">geomA</var>, geometry  <var class="pdparam">pointOrigin</var>, float  <var class="pdparam">sizeX</var>, float  <var class="pdparam">sizeY</var>, float  <var class="pdparam">sizeZ</var>, float  <var class="pdparam">sizeM</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72843208"></a><h2>説明</h2><p>1, 2, 3番目の形式では、入力ジオメトリの全てのポイントを原点とセルサイズを定めたグリッドにスナップします。同じセルに落ちた、連続するポイントを削除します。引数ジオメトリのジオメトリタイプを定義できないポイントしか残らなかった場合は、NULLを返します。コレクション内で崩壊したジオメトリはそこから削除されます。精度を落とすのに使います。 </p><p>4番目の形式は、1.1.0で導入されました。入力ジオメトリの全てのポイントを原点 (第2引数で指定するもので、ポイントでなければなりません)とセルサイズを定めたグリッドにスナップします。グリッドにスナップしたくない次元についてはサイズに0を指定します。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>返されるジオメトリは単純性が失われているかも知れません (<a class="xref" href="#ST_IsSimple" title="ST_IsSimple">ST_IsSimple</a>を参照してください)。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>1.1.0版より前では、この関数は常に2次元ジオメトリを返しました。1.1.0版からは、返されるジオメトリの次元数は、入力値のうちで手のつけられていない最大の次元と同じになります。全てのグリッドの次元を定義するには、第2引数にジオメトリを取る形式を使って下さい。</p></td></tr></table></div><p>Availability: 1.0.0RC1</p><p>Availability: 1.1.0 - Z値とM値に対応しました</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp72848840"></a><h2>例</h2><pre class="programlisting">-- 10^-3のグリッドに基づく精度にジオメトリをスナップさせます
UPDATE mytable
   SET the_geom = ST_SnapToGrid(the_geom, 0.001);

SELECT ST_AsText(ST_SnapToGrid(
                        ST_GeomFromText('LINESTRING(1.1115678 2.123, 4.111111 3.2374897, 4.11112 3.23748667)'),
                        0.001)
                );
                          st_astext
-------------------------------------
 LINESTRING(1.112 2.123,4.111 3.237)
 --Snap a 4d geometry
SELECT ST_AsEWKT(ST_SnapToGrid(
        ST_GeomFromEWKT('LINESTRING(-1.1115678 2.123 2.3456 1.11111,
                4.111111 3.2374897 3.1234 1.1111, -1.11111112 2.123 2.3456 1.1111112)'),
 ST_GeomFromEWKT('POINT(1.12 2.22 3.2 4.4444)'),
 0.1, 0.1, 0.1, 0.01) );
                                                                  st_asewkt
------------------------------------------------------------------------------
 LINESTRING(-1.08 2.12 2.3 1.1144,4.12 3.22 3.1 1.1144,-1.08 2.12 2.3 1.1144)


-- 4次元ジオメトリ - ST_SnapToGrid(geom, size)は、X座標とY座標のみ変更します
-- M値とZ値は同じになります
SELECT ST_AsEWKT(ST_SnapToGrid(ST_GeomFromEWKT('LINESTRING(-1.1115678 2.123 3 2.3456,
                4.111111 3.2374897 3.1234 1.1111)'),
           0.01)      );
                                                st_asewkt
---------------------------------------------------------
 LINESTRING(-1.11 2.12 3 2.3456,4.11 3.24 3.1234 1.1111)

                </pre></div><div class="refsection"><a name="idp72850376"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Snap" title="ST_Snap">ST_Snap</a>, <a class="xref" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a>, <a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a>, <a class="xref" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a>, <a class="xref" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a>, <a class="xref" href="#ST_Simplify" title="ST_Simplify">ST_Simplify</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Snap"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Snap — 入力ジオメトリの辺と頂点を参照ジオメトリの頂点にスナップします。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Snap</b>(</code>geometry  <var class="pdparam">input</var>, geometry  <var class="pdparam">reference</var>, float  <var class="pdparam">tolerance</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72909384"></a><h2>説明</h2><p>ジオメトリの頂点と辺を、もう一つのジオメトリの頂点にスナップします。スナップが実行される位置を制御するにはスナップ距離許容値を使います。結果ジオメトリはスナップされた頂点を持つ入力ジオメトリです。スナップが発生しなかった場合には、入力ジオメトリが変更されずに返されます。 </p><p>一つのジオメトリからもう一つへの変換によって、近傍エッジ (ノード生成とインタセクション計算で問題を引き起こします)を除くことになり、オーバレイ演算のロバスト性が改善されます。 </p><p>あまりに多数のスナップを行った場合には、生成されるトポロジが不正になる可能性があります。いつスナップが安全かを判定するために、ヒューリスティックにスナップされた頂点の数と位置が決めるしかありません。しかし、省略された潜在的なスナップになりえます。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>返されるジオメトリは単純性が失われているかも知れません (<a class="xref" href="#ST_IsSimple" title="ST_IsSimple">ST_IsSimple</a>を参照してください)し、妥当性が失われているかも知れません (<a class="xref" href="#ST_IsValid" title="ST_IsValid">ST_IsValid</a>を参照して下さい)。 </p></td></tr></table></div><p>Availability: 2.0.0 GEOS 3.3.0以降が必要です。</p></div><div class="refsection"><a name="idp72913224"></a><h2>例</h2><div class="informaltable"><table class="informaltable" border="1"><colgroup><col class="column1"><col class="column2"></colgroup><tbody><tr><td colspan="2" align="center"><div class="informalfigure"><div class="mediaobject"><img src="images/st_snap01.png"><div class="caption"><p>マルチポリゴンとラインストリング (スナップ前)</p></div></div></div>
					   </td></tr><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_snap02.png"><div class="caption"><p>ラインストリングに1.01の許容距離でマルチポリゴンをスナップします。新しいマルチポリゴンはラインストリングにつながります。</p></div></div></div><p>
				</p><pre class="programlisting">SELECT ST_AsText(ST_Snap(poly,line, ST_Distance(poly,line)*1.01)) AS polysnapped
FROM (SELECT
   ST_GeomFromText('MULTIPOLYGON(
     ((26 125, 26 200, 126 200, 126 125, 26 125 ),
      ( 51 150, 101 150, 76 175, 51 150 )),
      (( 151 100, 151 200, 176 175, 151 100 )))') As poly,
       ST_GeomFromText('LINESTRING (5 107, 54 84, 101 100)') As line

        ) As foo;

                             polysnapped
---------------------------------------------------------------------
 MULTIPOLYGON(((26 125,26 200,126 200,126 125,101 100,26 125),
 (51 150,101 150,76 175,51 150)),((151 100,151 200,176 175,151 100)))
                                </pre>
					</td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_snap04.png"><div class="caption"><p>マルチラインストリングに1.25の許容距離でマルチポリゴンをスナップします。新しいマルチポリゴンはラインストリングにつながります。</p></div></div></div><p>
				</p><pre class="programlisting">SELECT ST_AsText(
    ST_Snap(poly,line, ST_Distance(poly,line)*1.25)
  ) AS polysnapped
FROM (SELECT
  ST_GeomFromText('MULTIPOLYGON(
    (( 26 125, 26 200, 126 200, 126 125, 26 125 ),
      ( 51 150, 101 150, 76 175, 51 150 )),
      (( 151 100, 151 200, 176 175, 151 100 )))') As poly,
       ST_GeomFromText('LINESTRING (5 107, 54 84, 101 100)') As line

        ) As foo;

                             polysnapped
---------------------------------------------------------------------
MULTIPOLYGON(((5 107,26 200,126 200,126 125,101 100,54 84,5 107),
(51 150,101 150,76 175,51 150)),((151 100,151 200,176 175,151 100)))
                                </pre>
						</td></tr><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_snap03.png"><div class="caption"><p>元のマルチポリゴンに1.01の許容距離でラインストリングをスナップします。新しいラインストリングはマルチポリゴンにつながります。</p></div></div></div><p>
				</p><pre class="programlisting">SELECT ST_AsText(
   ST_Snap(line, poly, ST_Distance(poly,line)*1.01)
  ) AS linesnapped
FROM (SELECT
  ST_GeomFromText('MULTIPOLYGON(
     ((26 125, 26 200, 126 200, 126 125, 26 125),
      (51 150, 101 150, 76 175, 51 150 )),
      ((151 100, 151 200, 176 175, 151 100)))') As poly,
       ST_GeomFromText('LINESTRING (5 107, 54 84, 101 100)') As line
        ) As foo;

              linesnapped
----------------------------------------
 LINESTRING(5 107,26 125,54 84,101 100)
                                </pre><p>
						  </p>
					</td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_snap05.png"><div class="caption"><p>元のマルチポリゴンに1.25の許容距離でラインストリングをスナップします。新しいラインストリングはマルチポリゴンにつながります。</p></div></div></div><p>
				</p><pre class="programlisting">SELECT ST_AsText(
 ST_Snap(line, poly, ST_Distance(poly,line)*1.25)
  ) AS linesnapped
FROM (SELECT
  ST_GeomFromText('MULTIPOLYGON(
     (( 26 125, 26 200, 126 200, 126 125, 26 125 ),
      (51 150, 101 150, 76 175, 51 150 )),
      ((151 100, 151 200, 176 175, 151 100 )))') As poly,
       ST_GeomFromText('LINESTRING (5 107, 54 84, 101 100)') As line
        ) As foo;
              linesnapped
---------------------------------------
LINESTRING(26 125,54 84,101 100)
                                </pre>
					</td></tr></tbody></table></div></div><div class="refsection"><a name="idp72933320"></a><h2>関連情報</h2><p>
		<a class="xref" href="#ST_SnapToGrid" title="ST_SnapToGrid">ST_SnapToGrid</a>
		</p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Transform"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Transform — 異なる空間参照系に投影変換された新しいジオメトリを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Transform</b>(</code>geometry  <var class="pdparam">g1</var>, integer  <var class="pdparam">srid</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_Transform</b>(</code>geometry  <var class="pdparam">geom</var>, text  <var class="pdparam">to_proj</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_Transform</b>(</code>geometry  <var class="pdparam">geom</var>, text  <var class="pdparam">from_proj</var>, text  <var class="pdparam">to_proj</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_Transform</b>(</code>geometry  <var class="pdparam">geom</var>, text  <var class="pdparam">from_proj</var>, integer  <var class="pdparam">to_srid</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72952008"></a><h2>説明</h2><p>異なる空間参照系に投影変換された新しいジオメトリを返します。変換先空間参照系である<code class="varname">to_srid</code>は、妥当なSRID整数パラメータ (<code class="varname">spatial_ref_sys</code>にあるということ)です。他にも、<code class="varname">to_proj</code>と<code class="varname">from_proj</code>にPROJ.4文字列で定義された空間参照系を指定することができますが、最適化されません。変換先空間参照系がSRIDの代わりにPROJ.4文字列で表現されている場合には、出力ジオメトリのSRIDは0になります。<code class="varname">from_proj</code>を使う場合には、入力ジオメトリは定義されたSRIDを持っていなければなりません。 </p><p>ST_TransformはしばしばST_SetSRIDと混同されます。ST_Transformは実際にジオメトリの座標を、ある空間参照系から他のものに変換します。ST_SetSRIDは単にジオメトリのSRIDを変更するだけです。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>PostGISがProj対応でコンパイルされている必要があります。<a class="xref" href="#PostGIS_Full_Version" title="PostGIS_Full_Version">PostGIS_Full_Version</a>を使ってProj対応でコンパイルされているか確認して下さい。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>一つ以上の変換を行う場合は、インデクスの利点を得るために、使用する変換に関する関数インデクスを持つと便利です。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>1.3.4より前では、曲線を含むジオメトリで使用すると、この関数はクラッシュします。これは1.3.4以上で訂正されています。</p></td></tr></table></div><p>Enhanced: 2.0.0 多面体サーフェス対応が導入されました。</p><p>Enhanced: 2.3.0 直接のPROJ.4文字列への対応が導入されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 5.1.6</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p></div><div class="refsection"><a name="idp72962888"></a><h2>例</h2><p>マサチューセッツ州平面座標系 (アメリカ測量フィート)をWGS84経度緯度に変更します。</p><pre class="programlisting">SELECT ST_AsText(ST_Transform(ST_GeomFromText('POLYGON((743238 2967416,743238 2967450,
        743265 2967450,743265.625 2967416,743238 2967416))',2249),4326)) As wgs_geom;

 wgs_geom
---------------------------
 POLYGON((-71.1776848522251 42.3902896512902,-71.1776843766326 42.3903829478009,
-71.1775844305465 42.3903826677917,-71.1775825927231 42.3902893647987,-71.177684
8522251 42.3902896512902));
(1 row)

-- 3次元曲線ストリングの例
SELECT ST_AsEWKT(ST_Transform(ST_GeomFromEWKT('SRID=2249;CIRCULARSTRING(743238 2967416 1,743238 2967450 2,743265 2967450 3,743265.625 2967416 3,743238 2967416 4)'),4326));

                                 st_asewkt
--------------------------------------------------------------------------------------
 SRID=4326;CIRCULARSTRING(-71.1776848522251 42.3902896512902 1,-71.1776843766326 42.3903829478009 2,
 -71.1775844305465 42.3903826677917 3,
 -71.1775825927231 42.3902893647987 3,-71.1776848522251 42.3902896512902 4)

                </pre><p>部分関数インデクスを作る例です。全てのジオメトリが入っているとは確信できないテーブルのためには、スペースの節約とインデクスを小さく効率的にするために、NULLジオメトリを無視する部分インデクスを使うのが最善です。</p><pre class="programlisting">CREATE INDEX idx_the_geom_26986_parcels
  ON parcels
  USING gist
  (ST_Transform(the_geom, 26986))
  WHERE the_geom IS NOT NULL;
                </pre><p>PROJ.4テキストを使って、独自の空間参照系に投影変換する例です。</p><pre class="programlisting">-- 独自の心射方位図法を使って北極付近の二つのポリゴンのインタセクションを探します
-- http://boundlessgeo.com/2012/02/flattening-the-peel/ を参照して下さい。
 WITH data AS (
   SELECT
     ST_GeomFromText('POLYGON((170 50,170 72,-130 72,-130 50,170 50))', 4326) AS p1,
     ST_GeomFromText('POLYGON((-170 68,-170 90,-141 90,-141 68,-170 68))', 4326) AS p2,
     '+proj=gnom +ellps=WGS84 +lat_0=70 +lon_0=-160 +no_defs'::text AS gnom
 )
 SELECT ST_AsText(
   ST_Transform(
     ST_Intersection(ST_Transform(p1, gnom), ST_Transform(p2, gnom)),
   gnom, 4326))
 FROM data;
                                          st_astext
 --------------------------------------------------------------------------------
  POLYGON((-170 74.053793645338,-141 73.4268621378904,-141 68,-170 68,-170 74.053793645338))
                </pre></div><div class="refsection"><a name="idp72966472"></a><h2>変換の挙動の設定</h2><p>グリッドシフトを含む座標変換は、ときどき失敗します。たとえば、PROJ.4にグリッドシフトファイルを付けてビルドされていなかった場合や、座標がグリッドシフト定義の範囲内に無い、といった場合です。デフォルトでは、PostGISはグリッドシフトファイルが無い場合はエラーを投げますが、この挙動は、<code class="varname">spatial_ref_sys</code>テーブルの<code class="varname">proj4text</code>値を変更することで、SRID毎の原則を設定することができます。 </p><p>たとえば、proj4textパラメータ +datum=NAD87 は次に示す+nadgridsパラメータの短縮形です。</p><pre class="programlisting">+nadgrids=@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat</pre><p>接頭辞@は、ファイルが無くてもエラー報告をしないという意味ですが、適切だった (発見されてオーバラップした)ファイルがないままリストの終わりに達した場合はエラーが出ます。</p><p>逆に、少なくとも標準的なファイルが確実にあって欲しいけれども、該当が無いまま全てのファイルが走査された場合に、NULL変換としたいなら、次が使えます。</p><pre class="programlisting">+nadgrids=@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat,null</pre><p>NULLグリッドシフトファイルは、世界全体をカバーして、シフトを行わない、妥当なグリッドシフトファイルです。 完全な例のために、正しい範囲にないSRID 4267への変換でエラーが投げられないようPostGISを変えたいなら、次のようにします。</p><pre class="programlisting">UPDATE spatial_ref_sys SET proj4text = '+proj=longlat +ellps=clrk66 +nadgrids=@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat,null +no_defs' WHERE srid = 4267;</pre></div><div class="refsection"><a name="idp72971848"></a><h2>関連情報</h2><p><a class="xref" href="#PostGIS_Full_Version" title="PostGIS_Full_Version">PostGIS_Full_Version</a>, <a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a>, <a class="xref" href="#ST_SetSRID" title="ST_SetSRID">ST_SetSRID</a>, <a class="xref" href="#UpdateGeometrySRID" title="UpdateGeometrySRID">UpdateGeometrySRID</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Translate"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Translate — 与えられたオフセットでジオメトリを変換します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Translate</b>(</code>geometry  <var class="pdparam">g1</var>, float  <var class="pdparam">deltax</var>, float  <var class="pdparam">deltay</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_Translate</b>(</code>geometry  <var class="pdparam">g1</var>, float  <var class="pdparam">deltax</var>, float  <var class="pdparam">deltay</var>, float  <var class="pdparam">deltaz</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72986056"></a><h2>説明</h2><p>deltax, deltay, deltazぶん移動した新しいジオメトリを返します。単位は、このジオメトリの空間参照系 (SRID)で定義された単位です。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>1.3.4より前では、曲線を含むジオメトリで使用すると、この関数はクラッシュします。これは1.3.4以上で訂正されています。</p></td></tr></table></div><p>Availability: 1.2.2</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p></div><div class="refsection"><a name="idp72990664"></a><h2>例</h2><p>ポイントを経度1度ぶん移動させます。</p><pre class="programlisting">SELECT ST_AsText(ST_Translate(ST_GeomFromText('POINT(-71.01 42.37)',4326),1,0)) As wgs_transgeomtxt;

        wgs_transgeomtxt
        ---------------------
        POINT(-70.01 42.37)
                </pre><p>ラインストリングを緯度1度ぶん、経度1/2度ぶん移動させます。</p><pre class="programlisting">SELECT ST_AsText(ST_Translate(ST_GeomFromText('LINESTRING(-71.01 42.37,-71.11 42.38)',4326),1,0.5)) As wgs_transgeomtxt;
                   wgs_transgeomtxt
        ---------------------------------------
        LINESTRING(-70.01 42.87,-70.11 42.88)
                </pre><p>3次元ポイントを移動させます。</p><pre class="programlisting">SELECT ST_AsEWKT(ST_Translate(CAST('POINT(0 0 0)' As geometry), 5, 12,3));
        st_asewkt
        ---------
        POINT(5 12 3)
                </pre><p>曲線とポイントを移動させます。</p><pre class="programlisting">SELECT ST_AsText(ST_Translate(ST_Collect('CURVEPOLYGON(CIRCULARSTRING(4 3,3.12 0.878,1 0,-1.121 5.1213,6 7, 8 9,4 3))','POINT(1 3)'),1,2));
                                                                                                                 st_astext
------------------------------------------------------------------------------------------------------------
 GEOMETRYCOLLECTION(CURVEPOLYGON(CIRCULARSTRING(5 5,4.12 2.878,2 2,-0.121 7.1213,7 9,9 11,5 5)),POINT(2 5))
</pre></div><div class="refsection"><a name="idp72995272"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Affine" title="ST_Affine">ST_Affine</a>, <a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a>, <a class="xref" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_TransScale"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_TransScale — 与えられた係数とオフセットでジオメトリを変換します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_TransScale</b>(</code>geometry  <var class="pdparam">geomA</var>, float <var class="pdparam">deltaX</var>, float <var class="pdparam">deltaY</var>, float <var class="pdparam">XFactor</var>, float <var class="pdparam">YFactor</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp73059144"></a><h2>説明</h2><p>deltaXとdeltaY引数を使ってジオメトリを移動させ、XFactor,YFactor引数で拡大縮小させます。2次元でのみ動作します。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="code">ST_TransScale(geomA, deltaX, deltaY, XFactor, YFactor)</code>は<code class="code">ST_Affine(geomA, XFactor, 0, 0, 0, YFactor, 0, 0, 0, 1, deltaX*XFactor, deltaY*YFactor, 0)</code>の短縮版です。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>1.3.4より前では、曲線を含むジオメトリで使用すると、この関数はクラッシュします。これは1.3.4以上で訂正されています。</p></td></tr></table></div><p>Availability: 1.1.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p></div><div class="refsection"><a name="idp73069000"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsEWKT(ST_TransScale(ST_GeomFromEWKT('LINESTRING(1 2 3, 1 1 1)'), 0.5, 1, 1, 2));
                  st_asewkt
-----------------------------
 LINESTRING(1.5 6 3,1.5 4 1)


-- ポイントのバッファから得た近似円を曲線に変換したうえで
-- (1, 2)だけ移動させ、(3, 4)倍に拡大します
  SELECT ST_AsText(ST_Transscale(ST_LineToCurve(ST_Buffer('POINT(234 567)', 3)),1,2,3,4));
                                                                                                                  st_astext
------------------------------------------------------------------------------------------------------------------------------
 CURVEPOLYGON(CIRCULARSTRING(714 2276,711.363961030679 2267.51471862576,705 2264,698.636038969321 2284.48528137424,714 2276))

</pre></div><div class="refsection"><a name="idp73070536"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Affine" title="ST_Affine">ST_Affine</a>, <a class="xref" href="#ST_Translate" title="ST_Translate">ST_Translate</a></p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Geometry_Outputs"></a>8.7. ジオメトリ出力</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#ST_AsBinary">ST_AsBinary</a></span><span class="refpurpose"> — ジオメトリ/ジオグラフィのSRIDメタデータのないWell-Known Binary (WKB)表現を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_AsEncodedPolyline">ST_AsEncodedPolyline</a></span><span class="refpurpose"> — ラインストリングジオメトリから符号化したポリラインを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_AsEWKB">ST_AsEWKB</a></span><span class="refpurpose"> — ジオメトリのSRIDメタデータが付いたWell-Known Binary (WKB)表現を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_AsEWKT">ST_AsEWKT</a></span><span class="refpurpose"> — ジオメトリのSRIDメタデータが付いたWell-Known Text (WKT)表現を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_AsGeoJSON">ST_AsGeoJSON</a></span><span class="refpurpose"> — GeoJSON要素としてジオメトリを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_AsGML">ST_AsGML</a></span><span class="refpurpose"> — GML第2版または第3版としてジオメトリを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_AsHEXEWKB">ST_AsHEXEWKB</a></span><span class="refpurpose"> — ジオメトリのHEXEWKB表現を (文字列として)返します。リトルエンディアン (NDR)またはビッグエンディアン (XDR)のどちらかのエンコーディングを使います。</span></dt><dt><span class="refentrytitle"><a href="#ST_AsKML">ST_AsKML</a></span><span class="refpurpose"> — ジオメトリをKML要素で返します。いくつかの形式があります。デフォルトはversion=2, maxdecimaldigits=15です。</span></dt><dt><span class="refentrytitle"><a href="#ST_AsLatLonText">ST_AsLatLonText</a></span><span class="refpurpose"> — 与えられたポイントの度・分・秒表現を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_AsSVG">ST_AsSVG</a></span><span class="refpurpose"> — ジオメトリまたはジオグラフィで与えられたSVGパスデータによるジオメトリを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_AsText">ST_AsText</a></span><span class="refpurpose"> — ジオメトリ/ジオグラフィのSRIDメタデータのないWell-Known Text (WKT)表現を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_AsTWKB">ST_AsTWKB</a></span><span class="refpurpose"> — TWKB (Tiny Well-Known Binary)としてジオメトリを出力します。</span></dt><dt><span class="refentrytitle"><a href="#ST_AsX3D">ST_AsX3D</a></span><span class="refpurpose"> — ジオメトリをX3Dノード要素書式　(ISO-IEC-19776-1.2-X3DEncodings-XML)で返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_GeoHash">ST_GeoHash</a></span><span class="refpurpose"> — ジオメトリのGeoHash表現を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_AsGeobuf">ST_AsGeobuf</a></span><span class="refpurpose"> — 行集合のGeobuf表現を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_AsMVTGeom">ST_AsMVTGeom</a></span><span class="refpurpose"> — ジオメトリをMapbox Vector Tileの座標空間に変換します。</span></dt><dt><span class="refentrytitle"><a href="#ST_AsMVT">ST_AsMVT</a></span><span class="refpurpose"> — 行集合のMapbox Vector Tile表現を返します。</span></dt></dl></div><div class="refentry"><a name="ST_AsBinary"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsBinary — ジオメトリ/ジオグラフィのSRIDメタデータのないWell-Known Binary (WKB)表現を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">bytea <b class="fsfunc">ST_AsBinary</b>(</code>geometry  <var class="pdparam">g1</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsBinary</b>(</code>geometry  <var class="pdparam">g1</var>, text <var class="pdparam">NDR_or_XDR</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsBinary</b>(</code>geography  <var class="pdparam">g1</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsBinary</b>(</code>geography  <var class="pdparam">g1</var>, text <var class="pdparam">NDR_or_XDR</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp73778888"></a><h2>説明</h2><p>ジオメトリのWell-Knwon Binary表現を返します。二つの形式があります。一つ目の形式では、エンディアンエンコーディングのパラメータを取らずにサーバ機のエンディアンとします。二つ目の形式では、第2引数にリトルエンディアン ('NDR')かビッグエンディアン ('XDR')を使ってエンコーディングを明示します。</p><p>データを文字列表現に変換せずにデータベース外に引き出すためのバイナリカーソルに使えます。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>WKB仕様ではSRIDは入りません。SRIDを持つOGC WKBの書式を得るにはST_AsEWKBを使用します。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_AsBinaryはジオメトリに対する<a class="xref" href="#ST_GeomFromWKB" title="ST_GeomFromWKB">ST_GeomFromWKB</a>の逆です。PostGISジオメトリをST_AsBinary表現から変換するには<a class="xref" href="#ST_GeomFromWKB" title="ST_GeomFromWKB">ST_GeomFromWKB</a>を使います。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>PostgreSQL 9.0でのデフォルトの挙動が、16進数エンコーディングに変わりました。ST_AsBinaryはジオメトリに対する<a class="xref" href="#ST_GeomFromWKB" title="ST_GeomFromWKB">ST_GeomFromWKB</a>の反対です。GUIツールが古い挙動を求める場合には、データベースでSET bytea_output='escape'を実行して下さい。</p></td></tr></table></div><p>Enhanced: 2.0.0 多面体サーフェス対応、三角対応、TIN対応が導入されました。</p><p>Enhanced: 2.0.0 高次元が導入されました。</p><p>Enhanced: 2.0.0 ジオグラフィでのエンディアン指定が導入されました。</p><p>Availability: 1.5.0 ジオグラフィが導入されました。</p><p>Changed: 2.0.0 この関数への入力は不明な型にすることができなくなり、必ずジオメトリでなければなりません。<code class="code">ST_AsBinary('POINT(1 2)')</code>といった構築ではもはや妥当ではなく、<code class="code">n st_asbinary(unknown) is not unique error</code>が得られます。このようなコードは<code class="code">ST_AsBinary('POINT(1 2)'::geometry);</code>に変更する必要があります。これが不可能な場合には<code class="filename">legacy.sql</code>をインストールして下さい。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a> s2.1.1.1</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 5.1.37</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp73832776"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsBinary(ST_GeomFromText('POLYGON((0 0,0 1,1 1,1 0,0 0))',4326));

                   st_asbinary
--------------------------------
\001\003\000\000\000\001\000\000\000\005
\000\000\000\000\000\000\000\000\000\000
\000\000\000\000\000\000\000\000\000\000
\000\000\000\000\000\000\000\000\000\000
\000\000\000\360?\000\000\000\000\000\000
\360?\000\000\000\000\000\000\360?\000\000
\000\000\000\000\360?\000\000\000\000\000
\000\000\000\000\000\000\000\000\000\000\000
\000\000\000\000\000\000\000\000
(1 row)</pre><pre class="programlisting">SELECT ST_AsBinary(ST_GeomFromText('POLYGON((0 0,0 1,1 1,1 0,0 0))',4326), 'XDR');
                   st_asbinary
--------------------------------
\000\000\000\000\003\000\000\000\001\000\000\000\005\000\000\000\000\000
\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000
\000?\360\000\000\000\000\000\000?\360\000\000\000\000\000\000?\360\000\000
\000\000\000\000?\360\000\000\000\000\000\000\000\000\000\000\000\000\000\000
\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000
(1 row)</pre></div><div class="refsection"><a name="idp73834824"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeomFromWKB" title="ST_GeomFromWKB">ST_GeomFromWKB</a>, <a class="xref" href="#ST_AsEWKB" title="ST_AsEWKB">ST_AsEWKB</a>, <a class="xref" href="#ST_AsTWKB" title="ST_AsTWKB">ST_AsTWKB</a>, <a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a>, </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_AsEncodedPolyline"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsEncodedPolyline — ラインストリングジオメトリから符号化したポリラインを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_AsEncodedPolyline</b>(</code>geometry <var class="pdparam">geom</var>, integer  <var class="pdparam">precision=5</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp72622408"></a><h2>説明</h2><p>符号化したポリラインを返します。Google Mapsではprecision=5 を使い、Open Source Routing Machineではprecision=5および6を使います。</p><p>任意パラメータ<code class="varname">precision</code>は、ポリライン符号化の際の桁数を決定するものです。符号化と復号とで同じ値であるべきで、異なる場合には座標が正しくなりません。</p><p>Availability: 2.2.0</p></div><div class="refsection"><a name="idp72624712"></a><h2>例</h2><p>基本 </p><pre class="programlisting">SELECT ST_AsEncodedPolyline(GeomFromEWKT('SRID=4326;LINESTRING(-120.2 38.5,-120.95 40.7,-126.453 43.252)'));
        --結果--
        |_p~iF~ps|U_ulLnnqC_mqNvxq`@
        </pre><p>ジオグラフィ型のラインストリングとジオグラフィ型のセグメント化したラインストリングを結合してGoogle Mapsに置きます。</p><pre class="programlisting">-- ボストンからサンフランシスコまでの線を100kmでセグメント化するSQL
        SELECT ST_AsEncodedPolyline(
                ST_Segmentize(
                        ST_GeogFromText('LINESTRING(-71.0519 42.4935,-122.4483 37.64)'),
                                100000)::geometry) As encodedFlightPath;</pre><p>JavaScriptコードは、クエリの結果を$変数と置き換えると次のようになります。</p><pre class="programlisting">&lt;script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?libraries=geometry"
&gt;&lt;/script&gt;
&lt;script type="text/javascript"&gt;
         flightPath = new google.maps.Polyline({
                        path:  google.maps.geometry.encoding.decodePath("$encodedFlightPath"),
                        map: map,
                        strokeColor: '#0000CC',
                        strokeOpacity: 1.0,
                        strokeWeight: 4
                });
&lt;/script&gt;
        </pre></div><div class="refsection"><a name="idp72628424"></a><h2>関連情報</h2><p><a class="xref" href="#ST_LineFromEncodedPolyline" title="ST_LineFromEncodedPolyline">ST_LineFromEncodedPolyline</a>, <a class="xref" href="#ST_Segmentize" title="ST_Segmentize">ST_Segmentize</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_AsEWKB"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsEWKB — ジオメトリのSRIDメタデータが付いたWell-Known Binary (WKB)表現を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">bytea <b class="fsfunc">ST_AsEWKB</b>(</code>geometry  <var class="pdparam">g1</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsEWKB</b>(</code>geometry  <var class="pdparam">g1</var>, text <var class="pdparam">NDR_or_XDR</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp73845960"></a><h2>説明</h2><p>ジオメトリのSRIDメタデータが付いWell-Knwon Binary表現を返します。二つの形式があります。一つ目の形式では、エンディアンエンコーディングのパラメータを取らずにサーバ機のエンディアンとします。二つ目の形式では、第2引数にリトルエンディアン ('NDR')かビッグエンディアン ('XDR')を使ってエンコーディングを明示します。</p><p>データを文字列表現に変換せずにデータベース外に引き出すためのバイナリカーソルに使えます。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>WKB仕様ではSRIDは入りません。SRIDを持たないOGC WKBの書式を得るにはST_AsBinaryを使用します。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_AsEWKBはジオメトリに対するST_GeomFromEWKBの逆です。PostGISジオメトリをST_AsEWKB表現から変換するにはST_GeomFromEWKBを使います。</p></td></tr></table></div><p>Enhanced: 2.0.0 多面体サーフェス対応、三角対応、TIN対応が導入されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div><div class="refsection"><a name="idp73854792"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsEWKB(ST_GeomFromText('POLYGON((0 0,0 1,1 1,1 0,0 0))',4326));

                   st_asewkb
--------------------------------
\001\003\000\000 \346\020\000\000\001\000
\000\000\005\000\000\000\000
\000\000\000\000\000\000\000\000
\000\000\000\000\000\000\000\000\000
\000\000\000\000\000\000\000\000\000\000
\000\000\360?\000\000\000\000\000\000\360?
\000\000\000\000\000\000\360?\000\000\000\000\000
\000\360?\000\000\000\000\000\000\000\000\000\000\000
\000\000\000\000\000\000\000\000\000\000\000\000\000
(1 row)</pre><pre class="programlisting">SELECT ST_AsEWKB(ST_GeomFromText('POLYGON((0 0,0 1,1 1,1 0,0 0))',4326), 'XDR');
                   st_asewkb
--------------------------------
\000 \000\000\003\000\000\020\346\000\000\000\001\000\000\000\005\000\000\000\000\
000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000?
\360\000\000\000\000\000\000?\360\000\000\000\000\000\000?\360\000\000\000\000
\000\000?\360\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000
\000\000\000\000\000\000\000\000\000\000\000\000\000
                </pre></div><div class="refsection"><a name="idp73856840"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsBinary" title="ST_AsBinary">ST_AsBinary</a>, <a class="xref" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a>, <a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a>, <a class="xref" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a>, <a class="xref" href="#ST_SRID" title="ST_SRID">ST_SRID</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_AsEWKT"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsEWKT — ジオメトリのSRIDメタデータが付いたWell-Known Text (WKT)表現を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_AsEWKT</b>(</code>geometry  <var class="pdparam">g1</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">ST_AsEWKT</b>(</code>geography  <var class="pdparam">g1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp73866312"></a><h2>説明</h2><p>ジオメトリのSRIDメタデータが前に付いたWell-Known Text (WKT)表現を返します。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>WKT仕様ではSRIDは入りません。SRIDを持たないOGC WKTの書式を得るにはST_AsTextを使用します。</p></td></tr></table></div><p><img src="images/warning.png"> WKT書式は精度はあまり維持しませんので、浮動小数点数の打ち切りをさせないために、ST_AsBinaryかST_AsEWKB書式を使用して運んで下さい。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_AsEWKTは<a class="xref" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a>の逆です。ST_AsEWKT表現をPostGISジオメトリに変換するには<a class="xref" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a>を使います。</p></td></tr></table></div><p>Enhanced: 2.0.0 ジオグラフィ対応、多面体サーフェス対応、三角形対応、TIN対応が導入されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div><div class="refsection"><a name="idp73876168"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsEWKT('0103000020E61000000100000005000000000000
                        000000000000000000000000000000000000000000000000000000
                        F03F000000000000F03F000000000000F03F000000000000F03
                        F000000000000000000000000000000000000000000000000'::geometry);

                   st_asewkt
--------------------------------
SRID=4326;POLYGON((0 0,0 1,1 1,1 0,0 0))
(1 row)

SELECT ST_AsEWKT('0108000080030000000000000060E30A4100000000785C0241000000000000F03F0000000018
E20A4100000000485F024100000000000000400000000018
E20A4100000000305C02410000000000000840')

--st_asewkt---
CIRCULARSTRING(220268 150415 1,220227 150505 2,220227 150406 3)
</pre></div><div class="refsection"><a name="idp73877704"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsBinary" title="ST_AsBinary">ST_AsBinary</a>, <a class="xref" href="#ST_AsEWKB" title="ST_AsEWKB">ST_AsEWKB</a>, <a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a>, <a class="xref" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_AsGeoJSON"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsGeoJSON — GeoJSON要素としてジオメトリを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_AsGeoJSON</b>(</code>geometry  <var class="pdparam">geom</var>, integer  <var class="pdparam">maxdecimaldigits=15</var>, integer  <var class="pdparam">options=0</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">ST_AsGeoJSON</b>(</code>geography  <var class="pdparam">geog</var>, integer  <var class="pdparam">maxdecimaldigits=15</var>, integer  <var class="pdparam">options=0</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">ST_AsGeoJSON</b>(</code>integer  <var class="pdparam">gj_version</var>, geometry  <var class="pdparam">geom</var>, integer  <var class="pdparam">maxdecimaldigits=15</var>, integer  <var class="pdparam">options=0</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">ST_AsGeoJSON</b>(</code>integer  <var class="pdparam">gj_version</var>, geography  <var class="pdparam">geog</var>, integer  <var class="pdparam">maxdecimaldigits=15</var>, integer  <var class="pdparam">options=0</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp73902408"></a><h2>説明</h2><p>Geometry JavaScript Object Noation (GeoJSON)要素としてジオメトリを返します (<a class="ulink" href="http://geojson.org/geojson-spec.html" target="_top">GeoJSON specifications 1.0</a>参照)。2次元と3次元のジオメトリの両方に対応しています。GeoJSONはSFS 1.1ジオメトリタイプのみ対応します (たとえば曲線は対応していません)。</p><p>gj_versionパラメタはGeoJSON仕様のメジャーバージョンです。指定した場合1でなければなりません。これはGeoJSONの仕様の版を表現します。</p><p>第3引数は、出力の最大有効桁数を減らすために使われることがあります (デフォルトは15です)。</p><p>最後の'options'引数は、GeoJSON出力の中にBboxまたはCrsを追加するために使います。与える値は次の通りです。 </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>0: オプションなし (デフォルト値)</p></li><li class="listitem"><p>1: GeoJSON Bbox</p></li><li class="listitem"><p>2: GeoJSON Short CRS (たとえば EPSG:4326)</p></li><li class="listitem"><p>4: GeoJSON Long CRS (たとえば urn:ogc:def:crs:EPSG:4326)</p></li></ul></div><p>
			</p><p>一つ目の形式: ST_AsGeoJSON(geom) / maxdecimaldigits=15 version=1 options=0</p><p>二つ目の形式: ST_AsGeoJSON(geom, maxdecimaldigits) / version=1 options=0</p><p>三つ目の形式: ST_AsGeoJSON(geom, maxdecimaldigits, options) / version=1</p><p>四つ目の形式: ST_AsGeoJSON(gj_version, geom) / maxdecimaldigits=15 options=0</p><p>五つ目の形式: ST_AsGeoJSON(gj_version, geom, maxdecimaldigits) / options=0</p><p>六つ目の形式: ST_AsGeoJSON(gj_version, geom, maxdecimaldigits, options)</p><p>Availability: 1.3.4</p><p>Availability: 1.5.0 ジオグラフィが導入されました。</p><p>Changed: 2.0.0 デフォルト引数と名前付き引数に対応しました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp73925960"></a><h2>例</h2><p>GeoJSON書式は一般的にAjaxマッピングでの使用に効果的です。OpenLayersはこれをサポートする有名なJavaSciprクライアントです。使用例が<a class="ulink" href="http://openlayers.org/en/v3.10.1/examples/geojson.html" target="_top">OpenLayers GeoJSON Example</a>にあります。 </p><pre class="programlisting">SELECT ST_AsGeoJSON(the_geom) from fe_edges limit 1;
                                           st_asgeojson
-----------------------------------------------------------------------------------------------------------

{"type":"MultiLineString","coordinates":[[[-89.734634999999997,31.492072000000000],
[-89.734955999999997,31.492237999999997]]]}
(1 row)
--3d point
SELECT ST_AsGeoJSON('LINESTRING(1 2 3, 4 5 6)');

st_asgeojson
-----------------------------------------------------------------------------------------
 {"type":"LineString","coordinates":[[1,2,3],[4,5,6]]}

</pre></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_AsGML"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsGML — GML第2版または第3版としてジオメトリを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_AsGML</b>(</code>geometry  <var class="pdparam">geom</var>, integer  <var class="pdparam">maxdecimaldigits=15</var>, integer  <var class="pdparam">options=0</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">ST_AsGML</b>(</code>geography  <var class="pdparam">geog</var>, integer  <var class="pdparam">maxdecimaldigits=15</var>, integer  <var class="pdparam">options=0</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">ST_AsGML</b>(</code>integer  <var class="pdparam">version</var>, geometry  <var class="pdparam">geom</var>, integer  <var class="pdparam">maxdecimaldigits=15</var>, integer  <var class="pdparam">options=0</var>, text  <var class="pdparam">nprefix=null</var>, text  <var class="pdparam">id=null</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">ST_AsGML</b>(</code>integer  <var class="pdparam">version</var>, geography  <var class="pdparam">geog</var>, integer  <var class="pdparam">maxdecimaldigits=15</var>, integer  <var class="pdparam">options=0</var>, text  <var class="pdparam">nprefix=null</var>, text  <var class="pdparam">id=null</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp73955016"></a><h2>説明</h2><p>Geography Markup Language (GML)要素としてジオメトリを返します。 versionパラメータは、指定した場合には、2または3となります。version引数が無い場合は、2と仮定します。 <code class="varname">maxdecimaldigits</code>引数は出力で使用する最大有効桁数最大数を減らすために使われます (デフォルトは15です)。</p><p>GML2では2.1.2版を参照し、GML3では3.1.1を参照します。</p><p>最後の'options'引数はビットフィールドです。GML出力のCRS出力型を定義するために、また緯度/経度でデータを宣言するために使います。 </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>0: GML Short CRS (たとえば EPSG:4326)、デフォルト値</p></li><li class="listitem"><p>1: GML Long CRS (たとえば urn:ogc:def:crs:EPSG:4326)</p></li><li class="listitem"><p>2: GML 3のみ対応。srsDimension属性を出力から削除します。</p></li><li class="listitem"><p>4: GML 3のみ対応。線について&lt;Curve&gt;でなく&lt;LineString&gt;要素を使います。</p></li><li class="listitem"><p>16: データは緯度/経度 (すなわち SRID=4326)です。デフォルトではデータは平面上にあると仮定します。このオプションはGML 3.1.1による出力でのみ使われ、軸のオーダに関連します。これを設定すると、座標の順序を入れ替えるので、データベースの経度/緯度の順でなく緯度/経度の順になります。</p></li><li class="listitem"><p>32: ジオメトリのボックス (エンベロープ)を出力します。</p></li></ul></div><p>
						</p><p>'namespace prefix'引数は、カスタム名前空間のプリフィクスを指定したり、名前空間プリフィクスを指定しない (空にした場合)ために使用します。NULLを指定するか省略した場合には、'gml'プレフィクスを使用します。</p><p>Availability: 1.3.2</p><p>Availability: 1.5.0 ジオグラフィが導入されました。</p><p>Enhanced: 2.0.0 プレフィクスが導入されました。 GML 3用であるoptionsの4は、曲線のかわりにラインストリングを使えるようにするためのものです。GML 3の多面体サーフェスとTINが導入されました。optionsの32はボックスを出力するために導入されました。</p><p>Changed: 2.0.0 デフォルトの名前付き引数を使います。</p><p>Enhanced: 2.1.0 GML 3用にidが導入されました。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_AsGMLのGML 3版以上では多面体サーフェスとTINに対応しています。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div><div class="refsection"><a name="idp73990344"></a><h2>例: 2版</h2><pre class="programlisting">SELECT ST_AsGML(ST_GeomFromText('POLYGON((0 0,0 1,1 1,1 0,0 0))',4326));
                st_asgml
                --------
                &lt;gml:Polygon srsName="EPSG:4326"
&gt;&lt;gml:outerBoundaryIs
&gt;&lt;gml:LinearRing
&gt;&lt;gml:coordinates
&gt;0,0 0,1 1,1 1,0 0,0&lt;/gml:coordinates
&gt;&lt;/gml:LinearRing
&gt;&lt;/gml:outerBoundaryIs
&gt;&lt;/gml:Polygon
&gt;
                        </pre></div><div class="refsection"><a name="idp73991624"></a><h2>例: 3版</h2><pre class="programlisting">-- 座標を入れ替え、拡張EPSGで出力 (16 | 1)--
SELECT ST_AsGML(3, ST_GeomFromText('POINT(5.234234233242 6.34534534534)',4326), 5, 17);
                        st_asgml
                        --------
                &lt;gml:Point srsName="urn:ogc:def:crs:EPSG::4326"
&gt;&lt;gml:pos
&gt;6.34535 5.23423&lt;/gml:pos
&gt;&lt;/gml:Point
&gt;
                        </pre><pre class="programlisting">-- エンベロープ出力 (32) --
SELECT ST_AsGML(3, ST_GeomFromText('LINESTRING(1 2, 3 4, 10 20)',4326), 5, 32);
                st_asgml
                --------
        &lt;gml:Envelope srsName="EPSG:4326"&gt;
                &lt;gml:lowerCorner
&gt;1 2&lt;/gml:lowerCorner&gt;
                &lt;gml:upperCorner
&gt;10 20&lt;/gml:upperCorner&gt;
        &lt;/gml:Envelope
&gt;
                        </pre><pre class="programlisting">-- エンベロープ出力 (32)、座標入れ替え (経度緯度を緯度経度に)、Long CRS(1)
 = 32 | 16 | 1 = 49 --
SELECT ST_AsGML(3, ST_GeomFromText('LINESTRING(1 2, 3 4, 10 20)',4326), 5, 49);
        st_asgml
        --------
&lt;gml:Envelope srsName="urn:ogc:def:crs:EPSG::4326"&gt;
        &lt;gml:lowerCorner
&gt;2 1&lt;/gml:lowerCorner&gt;
        &lt;gml:upperCorner
&gt;20 10&lt;/gml:upperCorner&gt;
&lt;/gml:Envelope
&gt;
                        </pre><pre class="programlisting">-- 多面体サーフェスの例 --
SELECT ST_AsGML(3, ST_GeomFromEWKT('POLYHEDRALSURFACE( ((0 0 0, 0 0 1, 0 1 1, 0 1 0, 0 0 0)),
((0 0 0, 0 1 0, 1 1 0, 1 0 0, 0 0 0)), ((0 0 0, 1 0 0, 1 0 1, 0 0 1, 0 0 0)),
((1 1 0, 1 1 1, 1 0 1, 1 0 0, 1 1 0)),
((0 1 0, 0 1 1, 1 1 1, 1 1 0, 0 1 0)), ((0 0 1, 1 0 1, 1 1 1, 0 1 1, 0 0 1)) )'));
        st_asgml
        --------
 &lt;gml:PolyhedralSurface&gt;
&lt;gml:polygonPatches&gt;
   &lt;gml:PolygonPatch&gt;
                &lt;gml:exterior&gt;
                          &lt;gml:LinearRing&gt;
                                   &lt;gml:posList srsDimension="3"
&gt;0 0 0 0 0 1 0 1 1 0 1 0 0 0 0&lt;/gml:posList&gt;
                          &lt;/gml:LinearRing&gt;
                &lt;/gml:exterior&gt;
   &lt;/gml:PolygonPatch&gt;
   &lt;gml:PolygonPatch&gt;
                &lt;gml:exterior&gt;
                          &lt;gml:LinearRing&gt;
                                   &lt;gml:posList srsDimension="3"
&gt;0 0 0 0 1 0 1 1 0 1 0 0 0 0 0&lt;/gml:posList&gt;
                          &lt;/gml:LinearRing&gt;
                &lt;/gml:exterior&gt;
   &lt;/gml:PolygonPatch&gt;
   &lt;gml:PolygonPatch&gt;
                &lt;gml:exterior&gt;
                          &lt;gml:LinearRing&gt;
                                   &lt;gml:posList srsDimension="3"
&gt;0 0 0 1 0 0 1 0 1 0 0 1 0 0 0&lt;/gml:posList&gt;
                          &lt;/gml:LinearRing&gt;
                &lt;/gml:exterior&gt;
   &lt;/gml:PolygonPatch&gt;
   &lt;gml:PolygonPatch&gt;
                &lt;gml:exterior&gt;
                          &lt;gml:LinearRing&gt;
                                   &lt;gml:posList srsDimension="3"
&gt;1 1 0 1 1 1 1 0 1 1 0 0 1 1 0&lt;/gml:posList&gt;
                          &lt;/gml:LinearRing&gt;
                &lt;/gml:exterior&gt;
   &lt;/gml:PolygonPatch&gt;
   &lt;gml:PolygonPatch&gt;
                &lt;gml:exterior&gt;
                          &lt;gml:LinearRing&gt;
                                   &lt;gml:posList srsDimension="3"
&gt;0 1 0 0 1 1 1 1 1 1 1 0 0 1 0&lt;/gml:posList&gt;
                          &lt;/gml:LinearRing&gt;
                &lt;/gml:exterior&gt;
   &lt;/gml:PolygonPatch&gt;
   &lt;gml:PolygonPatch&gt;
                &lt;gml:exterior&gt;
                          &lt;gml:LinearRing&gt;
                                   &lt;gml:posList srsDimension="3"
&gt;0 0 1 1 0 1 1 1 1 0 1 1 0 0 1&lt;/gml:posList&gt;
                          &lt;/gml:LinearRing&gt;
                &lt;/gml:exterior&gt;
   &lt;/gml:PolygonPatch&gt;
&lt;/gml:polygonPatches&gt;
&lt;/gml:PolyhedralSurface
&gt;
                        </pre></div><div class="refsection"><a name="idp73998536"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeomFromGML" title="ST_GeomFromGML">ST_GeomFromGML</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_AsHEXEWKB"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsHEXEWKB — ジオメトリのHEXEWKB表現を (文字列として)返します。リトルエンディアン (NDR)またはビッグエンディアン (XDR)のどちらかのエンコーディングを使います。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_AsHEXEWKB</b>(</code>geometry  <var class="pdparam">g1</var>, text  <var class="pdparam">NDRorXDR</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">ST_AsHEXEWKB</b>(</code>geometry  <var class="pdparam">g1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp74007496"></a><h2>説明</h2><p>ジオメトリのHEXEWKB表現を (文字列として)返します。リトルエンディアン (NDR)またはビッグエンディアン (XDR)のどちらかのエンコーディングを使います。エンコーディングを指定しない場合はNDRを使います。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Availability: 1.2.2</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p></div><div class="refsection"><a name="idp74011976"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsHEXEWKB(ST_GeomFromText('POLYGON((0 0,0 1,1 1,1 0,0 0))',4326));
                which gives same answer as

                SELECT ST_GeomFromText('POLYGON((0 0,0 1,1 1,1 0,0 0))',4326)::text;

                st_ashexewkb
                --------
                0103000020E6100000010000000500
                00000000000000000000000000000000
                00000000000000000000000000000000F03F
                000000000000F03F000000000000F03F000000000000F03
                F000000000000000000000000000000000000000000000000</pre></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_AsKML"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsKML — ジオメトリをKML要素で返します。いくつかの形式があります。デフォルトはversion=2, maxdecimaldigits=15です。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_AsKML</b>(</code>geometry  <var class="pdparam">geom</var>, integer  <var class="pdparam">maxdecimaldigits=15</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">ST_AsKML</b>(</code>geography  <var class="pdparam">geog</var>, integer  <var class="pdparam">maxdecimaldigits=15</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">ST_AsKML</b>(</code>integer  <var class="pdparam">version</var>, geometry  <var class="pdparam">geom</var>, integer  <var class="pdparam">maxdecimaldigits=15</var>, text  <var class="pdparam">nprefix=NULL</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">ST_AsKML</b>(</code>integer  <var class="pdparam">version</var>, geography  <var class="pdparam">geog</var>, integer  <var class="pdparam">maxdecimaldigits=15</var>, text  <var class="pdparam">nprefix=NULL</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp74033224"></a><h2>説明</h2><p>ジオメトリをKeyhole Markup Language (KML)要素で返します。この関数にはいくつかの形式があります。出力に使われる小数位の最大数のデフォルトは15で、デフォルトのバージョンは2で、デフォルトの名前空間はプリフィクス無しです。</p><p>一つ目の形式: ST_AsKML(geom_or_geog, maxdecimaldigits) / version=2 / maxdecimaldigits=15  </p><p>二つ目の形式: ST_AsKML(version, geom_or_geog, maxdecimaldigits, nprefix) maxdecimaldigits=15 / nprefix=NULL </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>PostGISがProj対応でコンパイルされている必要があります。<a class="xref" href="#PostGIS_Full_Version" title="PostGIS_Full_Version">PostGIS_Full_Version</a>を使ってProj対応でコンパイルされているか確認して下さい。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Availability: 1.2.2 - versionパラメータが付く形式は1.3.2からです。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Enhanced: 2.0.0 - プレフィクス名前空間を追加しました。デフォルトではプリフィクス無しです。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Changed: 2.0.0 - デフォルト引数と名前付き引数に対応しました。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>AsKML出力はSRIDを持たないジオメトリでは動作しません。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp74040904"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsKML(ST_GeomFromText('POLYGON((0 0,0 1,1 1,1 0,0 0))',4326));

                st_askml
                --------
                &lt;Polygon
&gt;&lt;outerBoundaryIs
&gt;&lt;LinearRing
&gt;&lt;coordinates
&gt;0,0 0,1 1,1 1,0 0,0&lt;/coordinates
&gt;&lt;/LinearRing
&gt;&lt;/outerBoundaryIs
&gt;&lt;/Polygon&gt;

                -- 3次元ラインストリング
                SELECT ST_AsKML('SRID=4326;LINESTRING(1 2 3, 4 5 6)');
                &lt;LineString
&gt;&lt;coordinates
&gt;1,2,3 4,5,6&lt;/coordinates
&gt;&lt;/LineString&gt;
                
                </pre></div><div class="refsection"><a name="idp74042184"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsSVG" title="ST_AsSVG">ST_AsSVG</a>, <a class="xref" href="#ST_AsGML" title="ST_AsGML">ST_AsGML</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_AsLatLonText"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsLatLonText — 与えられたポイントの度・分・秒表現を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_AsLatLonText</b>(</code>geometry  <var class="pdparam">pt</var>, text  <var class="pdparam">format=''</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp74069832"></a><h2>説明</h2><p>ポイントの度・分・秒表現を返します。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>緯度/経度座標系のポイントを前提としています。X(経度)とY(緯度)座標系は「正常な」範囲 (経度は-180から180、緯度は-90から90)に正常化されます。</p></td></tr></table></div><p>text引数は結果文字列のための書式を含む書式文字列です。日付書式文字列に近いものです。妥当なトークンは"D"が度、"M"が分、"S"が秒、"C" (cardinal direction)が4方位 (NSEW)です。DMSトークンは、求める幅と精度で示すために、繰り返せます ("SSS.SSSS"では" 1.0023"になります)。 </p><p>"M"と"S"と"C"は必須ではありません。"C"が省略された場合には、南または西の場合には"-"符号がついたうえで、指定した精度で、度が表示されます。"M"も省略された場合には、指定した精度の桁数で十進の度が表示されます。 </p><p>書式文字列が省略された (または長さが0の)場合には、デフォルトの書式が使われます。 </p><p>Availability: 2.0</p></div><div class="refsection"><a name="idp74073416"></a><h2>例</h2><p>デフォルト書式。</p><pre class="programlisting">SELECT (ST_AsLatLonText('POINT (-3.2342342 -2.32498)'));
      st_aslatlontext
----------------------------
 2°19'29.928"S 3°14'3.243"W
</pre><p>書式を指定 (デフォルトと同じ)。</p><pre class="programlisting">SELECT (ST_AsLatLonText('POINT (-3.2342342 -2.32498)', 'D°M''S.SSS"C'));
      st_aslatlontext
----------------------------
 2°19'29.928"S 3°14'3.243"W
</pre><p>D, M, S, C以外の文字は通過するだけです。</p><pre class="programlisting">SELECT (ST_AsLatLonText('POINT (-3.2342342 -2.32498)', 'D degrees, M minutes, S seconds to the C'));
                                   st_aslatlontext
--------------------------------------------------------------------------------------
 2 degrees, 19 minutes, 30 seconds to the S 3 degrees, 14 minutes, 3 seconds to the W
</pre><p>4方位文字でなく符号で示された度。</p><pre class="programlisting">SELECT (ST_AsLatLonText('POINT (-3.2342342 -2.32498)', 'D°M''S.SSS"'));
      st_aslatlontext
----------------------------
 -2°19'29.928" -3°14'3.243"
</pre><p>十進の度。</p><pre class="programlisting">SELECT (ST_AsLatLonText('POINT (-3.2342342 -2.32498)', 'D.DDDD degrees C'));
          st_aslatlontext
-----------------------------------
 2.3250 degrees S 3.2342 degrees W
</pre><p>過大な値が正常化されます。</p><pre class="programlisting">SELECT (ST_AsLatLonText('POINT (-302.2342342 -792.32498)'));
        st_aslatlontext
-------------------------------
 72°19'29.928"S 57°45'56.757"E
</pre></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_AsSVG"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsSVG — ジオメトリまたはジオグラフィで与えられたSVGパスデータによるジオメトリを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_AsSVG</b>(</code>geometry  <var class="pdparam">geom</var>, integer  <var class="pdparam">rel=0</var>, integer  <var class="pdparam">maxdecimaldigits=15</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">ST_AsSVG</b>(</code>geography  <var class="pdparam">geog</var>, integer  <var class="pdparam">rel=0</var>, integer  <var class="pdparam">maxdecimaldigits=15</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp74091208"></a><h2>説明</h2><p>Scalar Vector Graphics (SVG)としてジオメトリを返します。 第2引数に1を指定すると、相対移動によるパスデータ実装を返し、絶対移動の場合はデフォルト (または0)とします。第3引数は、出力の十進数の最大桁数を減らすために使います (デフォルトは15です)。ポイントジオメトリは、'rel'が0のときはポイントはcx/cyに、'rel'が1のときはx/yに、それぞれ出力されます。マルチポイントはコンマ (",")で区切られ、ジオメトリコレクションはセミコロン (";")で区切られます。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Availability: 1.2.2. Availability: 1.4.0 PostGIS 1.4.0で<a class="ulink" href="http://www.w3.org/TR/SVG/paths.html#PathDataBNF" target="_top">http://www.w3.org/TR/SVG/paths.html#PathDataBNF</a>に従うため、絶対パスにLコマンドが入りました。</p></td></tr></table></div><p>Changed: 2.0.0 - デフォルト引数と名前付き引数に対応しました。</p></div><div class="refsection"><a name="idp74094152"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsSVG(ST_GeomFromText('POLYGON((0 0,0 1,1 1,1 0,0 0))',4326));

                st_assvg
                --------
                M 0 0 L 0 -1 1 -1 1 0 Z</pre></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_AsText"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsText — ジオメトリ/ジオグラフィのSRIDメタデータのないWell-Known Text (WKT)表現を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_AsText</b>(</code>geometry  <var class="pdparam">g1</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">ST_AsText</b>(</code>geometry  <var class="pdparam">g1</var>, integer  <var class="pdparam">maxdecimaldigits=15</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">ST_AsText</b>(</code>geography  <var class="pdparam">g1</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">ST_AsText</b>(</code>geography  <var class="pdparam">g1</var>, integer  <var class="pdparam">maxdecimaldigits=15</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp74108744"></a><h2>説明</h2><p>ジオメトリ/ジオグラフィのWell-Known Text表現を返します。任意引数は、出力における小数点以下の最大有効桁数を減らすのに使います (デフォルトは15です)。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>WKT仕様ではSRIDは入りません。SRIDを持つOGC WKTの書式を得るには、OGC標準ではないPostGIS <a class="xref" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a>を使用します。</p></td></tr></table></div><p><img src="images/warning.png"> WKT書式は精度はあまり維持しませんので、浮動小数点数の打ち切りをさせないために、ST_AsBinaryかST_AsEWKB書式を使用して運んで下さい。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_AsTextは<a class="xref" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a>の逆です。ST_AsText表現をPostGISジオメトリに変換するには<a class="xref" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a>を使います。</p></td></tr></table></div><p>Availability: 1.5 - ジオグラフィ対応が導入されました。</p><p>Enhanced: 2.5 - 任意パラメータprecisionが導入されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a> s2.1.1.1</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 5.1.25</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p></div><div class="refsection"><a name="idp74118216"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText('01030000000100000005000000000000000000
000000000000000000000000000000000000000000000000
F03F000000000000F03F000000000000F03F000000000000F03
F000000000000000000000000000000000000000000000000');

                   st_astext
--------------------------------
 POLYGON((0 0,0 1,1 1,1 0,0 0))
(1 row)</pre><p>精度の指定は任意です。</p><pre class="programlisting">SELECT ST_AsText(GeomFromEWKT('SRID=4326;POINT(111.1111111 1.1111111)'))
          st_astext
------------------------------
 POINT(111.1111111 1.1111111)
(1 row)</pre><pre class="programlisting">SELECT ST_AsText(GeomFromEWKT('SRID=4326;POINT(111.1111111 1.1111111)'),2)
st_astext
--------------------
POINT(111.11 1.11)
(1 row)</pre></div><div class="refsection"><a name="idp74121160"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsBinary" title="ST_AsBinary">ST_AsBinary</a>, <a class="xref" href="#ST_AsEWKB" title="ST_AsEWKB">ST_AsEWKB</a>, <a class="xref" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a>, <a class="xref" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_AsTWKB"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsTWKB — TWKB (Tiny Well-Known Binary)としてジオメトリを出力します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">bytea <b class="fsfunc">ST_AsTWKB</b>(</code>geometry  <var class="pdparam">g1</var>, integer  <var class="pdparam">decimaldigits_xy=0</var>, integer  <var class="pdparam">decimaldigits_z=0</var>, integer  <var class="pdparam">decimaldigits_m=0</var>, boolean  <var class="pdparam">include_sizes=false</var>, boolean  <var class="pdparam">include_bounding boxes=false</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsTWKB</b>(</code>geometry[]  <var class="pdparam">geometries</var>, bigint[]  <var class="pdparam">unique_ids</var>, integer  <var class="pdparam">decimaldigits_xy=0</var>, integer  <var class="pdparam">decimaldigits_z=0</var>, integer  <var class="pdparam">decimaldigits_m=0</var>, boolean  <var class="pdparam">include_sizes=false</var>, boolean  <var class="pdparam">include_bounding_boxes=false</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp74145608"></a><h2>説明</h2><p>TWKB (Tiny Well-Known Binary) 書式としてジオメトリを返します。
TWKBは、出力サイズを最小化することに焦点を当てた<a class="ulink" href="https://github.com/TWKB/Specification/blob/master/twkb.md" target="_top">compressed binary format</a> (圧縮バイナリ書式)です。 </p><p>decimaldigitsパラメータによって、出力に持たせる精度を制御できます。デフォルトでは、符号化前に値は単位上の最近値に丸められます。精度が高いものを転送したいなら、これの数字を大きくします。たとえば、1の値は小数点の右に1桁の数字が保存されます。</p><p>include_sizesとinclude_bounding_boxesパラメータによって、符号化オブジェクトの長さに関する任意情報の有無やオブジェクトの境界の有無を制御できます。デフォルトでは、無しです。クライアントソフトウェアが、これらの情報を使用しないなら、このパラメータを有効にしないで下さい。空白が増える (しかも空白の抑制がTWKBのポイントである)ためです。</p><p>配列入力の形式は、ジオメトリのコレクションを変換して、一意の識別子をTWKBコレクションに持たせるためのものです。これは、コレクションを展開して、オブジェクト内部に関する情報にさらにアクセスするのに使えます。<a class="ulink" href="http://www.postgresql.org/docs/9.4/static/functions-aggregate.html" target="_top">array_agg</a>関数を使用して配列を生成できます。他のパラメータは、単純な形式のものと同じです。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>書式仕様は<a class="ulink" href="https://github.com/TWKB/Specification" target="_top">https://github.com/TWKB/Specification</a>にあります。JavaScriptクライアントを構築するプログラムは<a class="ulink" href="https://github.com/TWKB/twkb.js" target="_top">https://github.com/TWKB/twkb.js</a>にあります。</p></td></tr></table></div><p>Enhanced: 2.4.0 メモリと実行速度の改善</p><p>Availability: 2.2.0</p></div><div class="refsection"><a name="idp74151624"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsTWKB('LINESTRING(1 1,5 5)'::geometry);
                 st_astwkb
--------------------------------------------
\x02000202020808

</pre><p> 識別子を含むTWKBオブジェクトの集計を生成するには、まず、"array_agg()"を使って求めるジオメトリとオブジェクトを集計して、その後に適切なTWKB関数を呼んでいます。 </p><pre class="programlisting">SELECT ST_AsTWKB(array_agg(geom), array_agg(gid)) FROM mytable;
                 st_astwkb
--------------------------------------------
\x040402020400000202
</pre></div><div class="refsection"><a name="idp74153800"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeomFromTWKB" title="ST_GeomFromTWKB">ST_GeomFromTWKB</a>, <a class="xref" href="#ST_AsBinary" title="ST_AsBinary">ST_AsBinary</a>, <a class="xref" href="#ST_AsEWKB" title="ST_AsEWKB">ST_AsEWKB</a>, <a class="xref" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a>, <a class="xref" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_AsX3D"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsX3D — ジオメトリをX3Dノード要素書式　(ISO-IEC-19776-1.2-X3DEncodings-XML)で返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_AsX3D</b>(</code>geometry  <var class="pdparam">g1</var>, integer  <var class="pdparam">maxdecimaldigits=15</var>, integer  <var class="pdparam">options=0</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp74163400"></a><h2>説明</h2><p>X3D XMLで表されたノード要素 <a class="ulink" href="http://www.web3d.org/standards/number/19776-1" target="_top">http://www.web3d.org/standards/number/19776-1</a>としたジオメトリを返します。<code class="varname">maxdecimaldigits</code> (精度)を指定しない場合には、デフォルトは15です。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>PostGISジオメトリをX3Dに変換するための任意引数が様々あります。X3Dジオメトリ型は、PostGISジオメトリタイプに対応付けされていないためです。また、より良い対応付けになると思われるものの、ほとんどのレンダリングツールが今のところは対応していないため、開発者が避けてきた新しいX3Dタイプに対応付けをしていないためでもあります。これらは開発者が決定した対応付けです。開発者が皆さんにより好まれる対応付けを示せるようなアイデアや方法に関する考えを持っているなら、お気軽にバグチケットを出して下さい。</p><p>次に現時点のPostGIS 2次元/3次元型からX3D型への対応付けを示します。</p></td></tr></table></div><p>'options'引数はビットフィールドです。PostGIS 2.2以上では、これはX3D GeoCoordinates Geospatialノードを表現するかどうか、また、X/Y軸を反対にするかどうかで使います。<code class="code">ST_AsX3D</code>は、デフォルトではデータベースの形式(経度, 緯度またはX, Y)で出力しますが、X3Dのlat/lon, y/xのデフォルトが好まれるでしょう。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>0: データベース内のX/Y順 (経度/緯度=X, Yが標準です)とします。デフォルト値です。非空間座標 (一般的な古いCoordinate要素です)です。</p></li><li class="listitem"><p>1: XとYを反対にします。GeoCoordinate任意スイッチと併せて使用されると、出力は"latitude_first" (緯度が先)となり、座標が同じように反対になります。</p></li><li class="listitem"><p>2: GeoSpatial GeoCoordinates内への座標出力。WGS 84経度緯度 (SRID: 4326)でない場合にエラーが投げられます。現在はGeoCoordinate型のみ対応します。
<a class="ulink" href="http://www.web3d.org/documents/specifications/19775-1/V3.2/Part01/components/geodata.html#Specifyingaspatialreference" target="_top">X3D specs specifying a spatial reference system.</a>を参照して下さい。デフォルト出力は<code class="code">GeoCoordinate geoSystem='"GD" "WE" "longitude_first"'</code>となります。X3Dのデフォルトである<code class="code">GeoCoordinate geoSystem='"GD" "WE" "latitude_first"'</code>とするには、<code class="code">(2 + 1)</code> = <code class="code">3</code>とします。 </p></li></ul></div><div class="informaltable"><table class="informaltable" border="1"><colgroup><col><col><col></colgroup><thead><tr><th>PostGISタイプ</th><th>2次元X3Dタイプ</th><th>3次元X3Dタイプ</th></tr></thead><tbody><tr><td>LINESTRING</td><td>未実装 - PolyLine2Dの予定</td><td>LineSet</td></tr><tr><td>MULTILINESTRING</td><td>未実装 - PolyLine2Dの予定</td><td>IndexedLineSet</td></tr><tr><td>MULTIPOINT</td><td>Polypoint2D</td><td>PointSet</td></tr><tr><td>POINT</td><td>空白区切り座標値を出力</td><td>空白区切り座標値を出力</td></tr><tr><td>(MULTI) POLYGON, POLYHEDRALSURFACE</td><td>不正なX3Dマークアップ</td><td>IndexedFaceSet (内環は現在は他のfacesetとして出力)</td></tr><tr><td>TIN</td><td>TriangleSet2D (未実装)</td><td>IndexedTriangleSet</td></tr></tbody></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>2次元ジオメトリ対応はまだ不完全です。 内環は現在は分けられたポリゴンとして描画されるだけです。作業中です。</p></td></tr></table></div><p>3次元空間については、特に<a class="ulink" href="http://www.web3d.org/x3d/wiki/index.php/X3D_and_HTML5#Goals:_X3D_and_HTML5" target="_top">X3D Integration with HTML5</a>によって、よく進展しています。</p><p>また、描画されたジオメトリを閲覧するための素晴らしいオープンソースのX3Dビューアがあります。Free Wrl <a class="ulink" href="http://freewrl.sourceforge.net/" target="_top">http://freewrl.sourceforge.net/</a>のバイナリがMac, Linux, Windows用であります。ジオメトリを見るためのパッケージであるFreeWRL_Launcherを使います。</p><p>また、この関数と<a class="ulink" href="http://www.x3dom.org/" target="_top">x3dDom html/js open source toolkit</a>を用いる<a class="ulink" href="https://github.com/robe2/postgis_x3d_viewer" target="_top">PostGIS minimalist X3D viewer</a>をチェックアウトしてみて下さい。</p><p>Availability: 2.0.0: ISO-IEC-19776-1.2-X3DEncodings-XML</p><p>Enhanced: 2.2.0: GeoCoordinatesと軸 (x/y, 経度/緯度)の反転に対応しました。詳細はoptionsを見て下さい。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div><div class="refsection"><a name="idp74194248"></a><h2>例: 完全に機能するX3D文書の作成 - FreeWrlや他のX3Dビューアで見ることができる立方体を生成しています。</h2><pre class="programlisting">SELECT '&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE X3D PUBLIC "ISO//Web3D//DTD X3D 3.0//EN" "http://www.web3d.org/specifications/x3d-3.0.dtd"&gt;
&lt;X3D&gt;
  &lt;Scene&gt;
    &lt;Transform&gt;
      &lt;Shape&gt;
       &lt;Appearance&gt;
            &lt;Material emissiveColor=''0 0 1''/&gt;
       &lt;/Appearance
&gt; ' ||
       ST_AsX3D( ST_GeomFromEWKT('POLYHEDRALSURFACE( ((0 0 0, 0 0 1, 0 1 1, 0 1 0, 0 0 0)),
((0 0 0, 0 1 0, 1 1 0, 1 0 0, 0 0 0)), ((0 0 0, 1 0 0, 1 0 1, 0 0 1, 0 0 0)),
((1 1 0, 1 1 1, 1 0 1, 1 0 0, 1 1 0)),
((0 1 0, 0 1 1, 1 1 1, 1 1 0, 0 1 0)), ((0 0 1, 1 0 1, 1 1 1, 0 1 1, 0 0 1)) )')) ||
      '&lt;/Shape&gt;
    &lt;/Transform&gt;
  &lt;/Scene&gt;
&lt;/X3D
&gt;' As x3ddoc;

                x3ddoc
                --------
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE X3D PUBLIC "ISO//Web3D//DTD X3D 3.0//EN" "http://www.web3d.org/specifications/x3d-3.0.dtd"&gt;
&lt;X3D&gt;
  &lt;Scene&gt;
    &lt;Transform&gt;
      &lt;Shape&gt;
       &lt;Appearance&gt;
            &lt;Material emissiveColor='0 0 1'/&gt;
       &lt;/Appearance&gt;
       &lt;IndexedFaceSet  coordIndex='0 1 2 3 -1 4 5 6 7 -1 8 9 10 11 -1 12 13 14 15 -1 16 17 18 19 -1 20 21 22 23'&gt;
            &lt;Coordinate point='0 0 0 0 0 1 0 1 1 0 1 0 0 0 0 0 1 0 1 1 0 1 0 0 0 0 0 1 0 0 1 0 1 0 0 1 1 1 0 1 1 1 1 0 1 1 0 0 0 1 0 0 1 1 1 1 1 1 1 0 0 0 1 1 0 1 1 1 1 0 1 1' /&gt;
      &lt;/IndexedFaceSet&gt;
      &lt;/Shape&gt;
    &lt;/Transform&gt;
  &lt;/Scene&gt;
&lt;/X3D
&gt;</pre></div><div class="refsection"><a name="idp74195528"></a><h2>例: 高さ3単位で精度が6桁の八角柱</h2><pre class="programlisting">SELECT ST_AsX3D(
ST_Translate(
    ST_Force_3d(
        ST_Buffer(ST_Point(10,10),5, 'quad_segs=2')), 0,0,
    3)
  ,6) As x3dfrag;

x3dfrag
--------
&lt;IndexedFaceSet coordIndex="0 1 2 3 4 5 6 7"&gt;
    &lt;Coordinate point="15 10 3 13.535534 6.464466 3 10 5 3 6.464466 6.464466 3 5 10 3 6.464466 13.535534 3 10 15 3 13.535534 13.535534 3 " /&gt;
&lt;/IndexedFaceSet
&gt;</pre></div><div class="refsection"><a name="idp74196808"></a><h2>例: TIN</h2><pre class="programlisting">SELECT ST_AsX3D(ST_GeomFromEWKT('TIN (((
                0 0 0,
                0 0 1,
                0 1 0,
                0 0 0
            )), ((
                0 0 0,
                0 1 0,
                1 1 0,
                0 0 0
            ))
            )')) As x3dfrag;

                x3dfrag
                --------
&lt;IndexedTriangleSet  index='0 1 2 3 4 5'
&gt;&lt;Coordinate point='0 0 0 0 0 1 0 1 0 0 0 0 0 1 0 1 1 0'/&gt;&lt;/IndexedTriangleSet
&gt;</pre></div><div class="refsection"><a name="idp74198088"></a><h2>例: 閉じたラインストリング (穴のあるポリゴンの境界)</h2><pre class="programlisting">SELECT ST_AsX3D(
                    ST_GeomFromEWKT('MULTILINESTRING((20 0 10,16 -12 10,0 -16 10,-12 -12 10,-20 0 10,-12 16 10,0 24 10,16 16 10,20 0 10),
  (12 0 10,8 8 10,0 12 10,-8 8 10,-8 0 10,-8 -4 10,0 -8 10,8 -4 10,12 0 10))')
) As x3dfrag;

                x3dfrag
                --------
&lt;IndexedLineSet  coordIndex='0 1 2 3 4 5 6 7 0 -1 8 9 10 11 12 13 14 15 8'&gt;
    &lt;Coordinate point='20 0 10 16 -12 10 0 -16 10 -12 -12 10 -20 0 10 -12 16 10 0 24 10 16 16 10 12 0 10 8 8 10 0 12 10 -8 8 10 -8 0 10 -8 -4 10 0 -8 10 8 -4 10 ' /&gt;
 &lt;/IndexedLineSet
&gt;</pre></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_GeoHash"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_GeoHash — ジオメトリのGeoHash表現を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_GeoHash</b>(</code>geometry  <var class="pdparam">geom</var>, integer  <var class="pdparam">maxchars=full_precision_of_point</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp74205000"></a><h2>説明</h2><p>ジオメトリのGeoHash表現 (<a class="ulink" href="http://en.wikipedia.org/wiki/Geohash" target="_top">http://en.wikipedia.org/wiki/Geohash</a>)を返します。GeoHashによって、ポイントは、prefixingに基づいてソートと検索が可能なテキスト形式にエンコードされます。短いGeoHashは低精度のポイント表現です。実際の点を含むボックスとも考えられます。</p><p><code class="varname">maxchars</code>を指定しない場合には、ST_GeoHashは、入力ジオメトリタイプの、完全な精度に基づくGeoHashを返します。ポイントについては20文字の精度を持つGeoHashを返します (入力の倍精度を完全に保持するのに概ね十分です)。他のタイプでは、フィーチャーのサイズをもとに、可変的な精度量を持つGeoHashを返します。大きなフィーチャーは低精度で表現され、小さいフィーチャーは高精度で表現されます。GeoHashが含むボックスは常に入力フィーチャーを含むようにしています。</p><p><code class="varname">maxchars</code>を指定した場合には、ST_GeoHashは、最高でもその文字数によるGeoHashを返し、入力ジオメトリはおそらく低精度表現となります。ポイント以外では、計算の開始点はジオメトリのバウンディングボックスの中心となります。</p><p>Availability: 1.4.0</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_GeoHashはジオグラフィ (経度緯度)座標系では動作しません。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p></div><div class="refsection"><a name="idp74222536"></a><h2>例</h2><pre class="programlisting">SELECT ST_GeoHash(ST_SetSRID(ST_MakePoint(-126,48),4326));

         st_geohash
----------------------
 c0w3hf1s70w3hf1s70w3

SELECT ST_GeoHash(ST_SetSRID(ST_MakePoint(-126,48),4326),5);

 st_geohash
------------
 c0w3h
                
                </pre></div><div class="refsection"><a name="idp74223816"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeomFromGeoHash" title="ST_GeomFromGeoHash">ST_GeomFromGeoHash</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_AsGeobuf"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsGeobuf — 行集合のGeobuf表現を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">bytea <b class="fsfunc">ST_AsGeobuf</b>(</code>anyelement set  <var class="pdparam">row</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsGeobuf</b>(</code>anyelement  <var class="pdparam">row</var>, text  <var class="pdparam">geom_name</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp74232776"></a><h2>説明</h2><p>FeatureCollectionに対応する行集合のGeobuf表現 (<a class="ulink" href="https://github.com/mapbox/geobuf" target="_top">https://github.com/mapbox/geobuf</a>)を返します。最適な格納のために最大精度を決定しますが、そのために全ての入力ジオメトリは解析されます。現在の形式でのGeobufはストリーム化できないので、完全な出力はメモリ内で組み立てられることに注意して下さい。 </p><p><code class="varname">row</code> 少なくとも一つのジオメトリカラムを持つ行データ</p><p><code class="varname">geom_name</code> 行データにおけるジオメトリカラムのカラム名。NULLの場合には、最初に見つけたジオメトリカラムとします。</p><p>Availability: 2.4.0</p></div><div class="refsection"><a name="idp74236232"></a><h2>例</h2><pre class="programlisting">SELECT encode(ST_AsGeobuf(q, 'geom'), 'base64')
    FROM (SELECT ST_GeomFromText('POLYGON((0 0,0 1,1 1,1 0,0 0))') AS geom) AS q;
 st_asgeobuf
----------------------------------
 GAAiEAoOCgwIBBoIAAAAAgIAAAE=

                
                </pre></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_AsMVTGeom"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsMVTGeom — ジオメトリを<a class="ulink" href="https://www.mapbox.com/vector-tiles/" target="_top">Mapbox Vector Tile</a>の座標空間に変換します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_AsMVTGeom</b>(</code>geometry  <var class="pdparam">geom</var>, box2d  <var class="pdparam">bounds</var>, integer  <var class="pdparam">extent=4096</var>, integer  <var class="pdparam">buffer=256</var>, boolean  <var class="pdparam">clip_geom=true</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp74246984"></a><h2>説明</h2><p>ジオメトリをレイヤに対応する行集合の<a class="ulink" href="https://www.mapbox.com/vector-tiles/" target="_top">Mapbox Vector Tile</a>の座標空間に変換します。妥当性の維持と訂正のための最善の努力をしますが、ジオメトリを低い次元にすることがあります。 </p><p><code class="varname">geom</code>は、変換するジオメトリです。</p><p><code class="varname">bounds</code>は、バッファの無いタイルコンテンツの幾何的な境界です。</p><p><code class="varname">extent</code>は、<a class="ulink" href="https://www.mapbox.com/vector-tiles/specification/" target="_top">specification</a>で定義されているタイル座標空間内のタイル範囲です。NULLの場合には4096をデフォルト値とします。</p><p><code class="varname">buffer</code>は、随意でジオメトリを切り取るためのタイル座標空間内のバッファ距離です。NULLの場合には、256をデフォルト値とします。</p><p><code class="varname">clip_geom</code>は、ジオメトリを切り抜くか、そのままエンコードするか、を制御するための真偽値です。NULLの場合には、TRUEをデフォルト値とします。</p><p>Availability: 2.4.0</p></div><div class="refsection"><a name="idp74252744"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(ST_AsMVTGeom(
        ST_GeomFromText('POLYGON ((0 0, 10 0, 10 5, 0 -5, 0 0))'),
        ST_MakeBox2D(ST_Point(0, 0), ST_Point(4096, 4096)),
        4096, 0, false));
                              st_astext
--------------------------------------------------------------------
 MULTIPOLYGON(((5 4096,10 4096,10 4091,5 4096)),((5 4096,0 4096,0 4101,5 4096)))

                
                </pre></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_AsMVT"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsMVT — 行集合の<a class="ulink" href="https://www.mapbox.com/vector-tiles/" target="_top">Mapbox Vector Tile</a>表現を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">bytea <b class="fsfunc">ST_AsMVT</b>(</code>anyelement set  <var class="pdparam">row</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsMVT</b>(</code>anyelement  <var class="pdparam">row</var>, text  <var class="pdparam">name</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsMVT</b>(</code>anyelement  <var class="pdparam">row</var>, text  <var class="pdparam">name</var>, integer  <var class="pdparam">extent</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsMVT</b>(</code>anyelement  <var class="pdparam">row</var>, text  <var class="pdparam">name</var>, integer  <var class="pdparam">extent</var>, text  <var class="pdparam">geom_name</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp74275784"></a><h2>説明</h2><p>レイヤに対応する行集合の<a class="ulink" href="https://www.mapbox.com/vector-tiles/" target="_top">Mapbox Vector Tile</a>表現を返します。複数回呼び出しで複数レイヤの接続が可能です。ジオメトリはタイル座標空間にあり、<a class="ulink" href="https://www.mapbox.com/vector-tiles/specification/" target="_top">specification</a>につき妥当であると仮定します。一般的には<a class="xref" href="#ST_AsMVTGeom" title="ST_AsMVTGeom">ST_AsMVTGeom</a>はジオメトリのタイル座標空間への変換に使います。他の行データは属性としてエンコードされます。 </p><p><a class="ulink" href="https://www.mapbox.com/vector-tiles/" target="_top">Mapbox Vector Tile</a>書式は、異なる地物ごとに異なる属性集合を持つ地物を格納できます。この機能を使うには、JSONオブジェクトを含む行データ内のJSONBカラムを一段深くします。オブジェクトのキーと値は地物の属性にパースされます。 </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[重要]" src="images/important.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">GEOMETRYCOLLECTION</code>を行の要素として渡さないで下さい。しかしながら、ジオメトリコレクションを含ませるための準備として、<a class="xref" href="#ST_AsMVTGeom" title="ST_AsMVTGeom">ST_AsMVTGeom</a>を使うことができます。</p></td></tr></table></div><p><code class="varname">row</code> 少なくとも一つのジオメトリカラムを持つ行データ</p><p><code class="varname">name</code>は、レイヤ名です。NULLの場合には、"default"という文字列を使います。</p><p><code class="varname">extent</code>は、仕様で定義されている画面空間内のタイル範囲です。NULLの場合には、4096をデフォルト値とします。</p><p><code class="varname">geom_name</code> 行データにおけるジオメトリカラムのカラム名。NULLの場合には、最初に見つけたジオメトリカラムとします。</p><p>Enhanced: 2.5.0 - パラレルクエリ対応が追加されました。</p><p>Availability: 2.4.0</p></div><div class="refsection"><a name="idp74283848"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsMVT(q, 'test', 4096, 'geom') FROM (SELECT 1 AS c1,
    ST_AsMVTGeom(ST_GeomFromText('POLYGON ((35 10, 45 45, 15 40, 10 20, 35 10), (20 30, 35 35, 30 20, 20 30))'),
    ST_MakeBox2D(ST_Point(0, 0), ST_Point(4096, 4096)), 4096, 0, false) AS geom) AS q;
                              st_asmvt
--------------------------------------------------------------------
 \x1a320a0474657374121d12020000180322150946ec3f1a14453b0a09280f091413121e09091e0f1a026331220228012880207802

                
                </pre></div><div class="refsection"><a name="idp74285128"></a><h2>関連情報</h2><p>
					<a class="xref" href="#ST_AsMVTGeom" title="ST_AsMVTGeom">ST_AsMVTGeom</a>
				</p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Operators"></a>8.8. 演算子</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#geometry_overlaps">&amp;&amp;</a></span><span class="refpurpose"> — Aの2次元バウンディングボックスがBの2次元バウンディングボックスとインタセクトする場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#overlaps_geometry_box2df">&amp;&amp;(geometry,box2df)</a></span><span class="refpurpose"> — ジオメトリの (キャッシュされている)2次元バウンディングボックスが単精度浮動小数点数による2次元バウンディングボックスとインタセクトする場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#overlaps_box2df_geometry">&amp;&amp;(box2df,geometry)</a></span><span class="refpurpose"> — 単精度浮動小数点数による2次元バウンディングボックスがジオメトリの (キャッシュされている)2次元バウンディングボックスとインタセクトする場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#overlaps_box2df_box2df">&amp;&amp;(box2df,box2df)</a></span><span class="refpurpose"> — 二つの単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)が相互にインタセクトする場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#geometry_overlaps_nd">&amp;&amp;&amp;</a></span><span class="refpurpose"> — Aのn次元バウンディングボックスがBのn次元バウンディングボックスとインタセクトする場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#overlaps_nd_geometry_gidx">&amp;&amp;&amp;(geometry,gidx)</a></span><span class="refpurpose"> — ジオメトリの (キャッシュされている)n次元バウンディングボックスが単精度浮動小数点数によるn次元バウンディングボックス (GIDX)とインタセクトする場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#overlaps_nd_gidx_geometry">&amp;&amp;&amp;(gidx,geometry)</a></span><span class="refpurpose"> — 単精度浮動小数点数によるn次元バウンディングボックス (GIDX)がジオメトリの (キャッシュされている)n次元バウンディングボックスとインタセクトする場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#overlaps_nd_gidx_gidx">&amp;&amp;&amp;(gidx,gidx)</a></span><span class="refpurpose"> — 二つの単精度浮動小数点数によるn次元バウンディングボックス (GIDX)が相互にインタセクトする場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Geometry_Overleft">&amp;&lt;</a></span><span class="refpurpose"> — AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの左にある場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Geometry_Overbelow">&amp;&lt;|</a></span><span class="refpurpose"> — AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの下にある場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Geometry_Overright">&amp;&gt;</a></span><span class="refpurpose"> — AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの右にある場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Geometry_Left">&lt;&lt;</a></span><span class="refpurpose"> — Aのバウンダリボックスが、厳密にBのバウンダリボックスの左にある場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Geometry_Below">&lt;&lt;|</a></span><span class="refpurpose"> — Aのバウンダリボックスが、厳密にBのバウンダリボックスの下にある場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Geometry_EQ">=</a></span><span class="refpurpose"> — ジオメトリ/ジオグラフィ Aの座標と座標の並び順がジオメトリ/ジオグラフィ Bと同じ場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Geometry_Right">&gt;&gt;</a></span><span class="refpurpose"> — Aのバウンダリボックスが、厳密にBのバウンダリボックスの右にある場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Geometry_Contained">@</a></span><span class="refpurpose"> — AのバウンダリボックスがBのバウンダリボックスに含まれている場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#is_contained_geometry_box2df">@(geometry,box2df)</a></span><span class="refpurpose"> — ジオメトリの2次元バウンディングボックスが単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)に包含される場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#is_contained_box2df_geometry">@(box2df,geometry)</a></span><span class="refpurpose"> — 単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)がジオメトリの2次元バウンディングボックスに包含される場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#is_contained_box2df_box2df">@(box2df,box2df)</a></span><span class="refpurpose"> — 二つの単精度浮動小数点数によるn次元バウンディングボックス (GIDX)の一方がもう一方を包含する場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Geometry_Overabove">|&amp;&gt;</a></span><span class="refpurpose"> — AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの上にある場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Geometry_Above">|&gt;&gt;</a></span><span class="refpurpose"> — Aのバウンダリボックスが、厳密にBのバウンダリボックスの上にある場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Geometry_Contain">~</a></span><span class="refpurpose"> — AのバウンディングボックスがBのバウンディングボックスを含む場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#contains_geometry_box2df">~(geometry,box2df)</a></span><span class="refpurpose"> — ジオメトリの (キャッシュされている)2次元バウンディングボックスが単精度浮動小数点数によるn次元バウンディングボックス (GIDX)を包含する場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#contains_box2df_geometry">~(box2df,geometry)</a></span><span class="refpurpose"> — 単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)をジオメトリの (キャッシュされている)2次元バウンディングボックスが包含する場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#contains_box2df_box2df">~(box2df,box2df)</a></span><span class="refpurpose"> — 二つの単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)の一方がもう一方を包含する場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Geometry_Same">~=</a></span><span class="refpurpose"> — AのバウンディングボックスがBのバウンディングボックスと同じ場合にTRUEを返します。</span></dt><dt><span class="refentrytitle"><a href="#geometry_distance_knn">&lt;-&gt;</a></span><span class="refpurpose"> — AとBの2次元距離を返します。 </span></dt><dt><span class="refentrytitle"><a href="#geometry_distance_cpa">|=|</a></span><span class="refpurpose"> — AトラジェクトリとBトラジェクトリとの最接近する時の距離を返します。 </span></dt><dt><span class="refentrytitle"><a href="#geometry_distance_box">&lt;#&gt;</a></span><span class="refpurpose"> — AのバウンディングボックスとBのバウンディングボックスの2次元距離を返します。 </span></dt><dt><span class="refentrytitle"><a href="#geometry_distance_centroid_nd">&lt;&lt;-&gt;&gt;</a></span><span class="refpurpose"> — AのバウンディングボックスとBのバウンディングボックスのn次元距離を返します。 </span></dt><dt><span class="refentrytitle"><a href="#geometry_distance_box_nd">&lt;&lt;#&gt;&gt;</a></span><span class="refpurpose"> — AのバウンディングボックスとBのバウンディングボックスのn次元距離を返します。 </span></dt></dl></div><div class="refentry"><a name="geometry_overlaps"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>&amp;&amp; — Aの2次元バウンディングボックスがBの2次元バウンディングボックスとインタセクトする場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">&amp;&amp;</b>(</code> geometry  <var class="pdparam">A</var> ,  geometry  <var class="pdparam">B</var> <code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">&amp;&amp;</b>(</code> geography  <var class="pdparam">A</var> ,  geography  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp74851912"></a><h2>説明</h2><p><code class="varname">&amp;&amp;</code>演算子は、Aの2次元バウンディングボックスがBの2次元バウンディングボックスとインタセクトする場合に<code class="varname">TRUE</code>を返します。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これのオペランドは、ジオメトリで使用できるインデクスを使用します。</p></td></tr></table></div><p>Enhanced: 2.0.0 多面体サーフェス対応が導入されました。</p><p>Availability: 1.5.0 ジオグラフィ対応が導入されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p></div><div class="refsection"><a name="idp74857544"></a><h2>例</h2><pre class="programlisting">SELECT tbl1.column1, tbl2.column1, tbl1.column2 &amp;&amp; tbl2.column2 AS overlaps
FROM ( VALUES
        (1, 'LINESTRING(0 0, 3 3)'::geometry),
        (2, 'LINESTRING(0 1, 0 5)'::geometry)) AS tbl1,
( VALUES
        (3, 'LINESTRING(1 2, 4 6)'::geometry)) AS tbl2;

 column1 | column1 | overlaps
---------+---------+----------
           1 |       3 | t
           2 |       3 | f
(2 rows)</pre></div><div class="refsection"><a name="idp74859080"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Geometry_Overabove" title="|&amp;&gt;">|&amp;&gt;</a>, <a class="xref" href="#ST_Geometry_Overright" title="&amp;&gt;">&amp;&gt;</a>, <a class="xref" href="#ST_Geometry_Overbelow" title="&amp;&lt;|">&amp;&lt;|</a>, <a class="xref" href="#ST_Geometry_Overleft" title="&amp;&lt;">&amp;&lt;</a>, <a class="xref" href="#ST_Geometry_Contain" title="~">~</a>, <a class="xref" href="#ST_Geometry_Contained" title="@">@</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="overlaps_geometry_box2df"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>&amp;&amp;(geometry,box2df) — ジオメトリの (キャッシュされている)2次元バウンディングボックスが単精度浮動小数点数による2次元バウンディングボックスとインタセクトする場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">&amp;&amp;</b>(</code> geometry  <var class="pdparam">A</var> ,  box2df <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp74872776"></a><h2>説明</h2><p><code class="varname">&amp;&amp;</code>演算子は、ジオメトリAのキャッシュされた2次元バウンディングボックスが、2次元バウンディングボックスBとインタセクトする場合に、<code class="varname">TRUE</code>を返します。単精度浮動小数点数によるバウンディングボックスを使います。Bが倍精度浮動小数点数を使うbox2dである場合には、単精度浮動小数点数によるバウンディングボックス (BOX2DF)に変換されることになります。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この被演算子は、ユーザが使うためというよりも内部でBRINインデックスに使うために導入されました。</p></td></tr></table></div><p>Availability: 2.3.0 BRIN (Block Range INdexes)が導入されました。PostgreSQL 9.5以上が必要です。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p></div><div class="refsection"><a name="idp74878024"></a><h2>例</h2><pre class="programlisting">SELECT ST_MakePoint(1,1) &amp;&amp; ST_MakeBox2D(ST_MakePoint(0,0), ST_MakePoint(2,2)) AS overlaps;

 overlaps
----------
 t
(1 row)</pre></div><div class="refsection"><a name="idp74879304"></a><h2>関連情報</h2><p><a class="xref" href="#overlaps_box2df_geometry" title="&amp;&amp;(box2df,geometry)">&amp;&amp;(box2df,geometry)</a>, <a class="xref" href="#overlaps_box2df_box2df" title="&amp;&amp;(box2df,box2df)">&amp;&amp;(box2df,box2df)</a>, <a class="xref" href="#contains_geometry_box2df" title="~(geometry,box2df)">~(geometry,box2df)</a>, <a class="xref" href="#contains_box2df_geometry" title="~(box2df,geometry)">~(box2df,geometry)</a>, <a class="xref" href="#contains_box2df_box2df" title="~(box2df,box2df)">~(box2df,box2df)</a>, <a class="xref" href="#is_contained_geometry_box2df" title="@(geometry,box2df)">@(geometry,box2df)</a>, <a class="xref" href="#is_contained_box2df_geometry" title="@(box2df,geometry)">@(box2df,geometry)</a>, <a class="xref" href="#is_contained_box2df_box2df" title="@(box2df,box2df)">@(box2df,box2df)</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="overlaps_box2df_geometry"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>&amp;&amp;(box2df,geometry) — 単精度浮動小数点数による2次元バウンディングボックスがジオメトリの (キャッシュされている)2次元バウンディングボックスとインタセクトする場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">&amp;&amp;</b>(</code> box2df  <var class="pdparam">A</var> ,  geometry  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp74889672"></a><h2>説明</h2><p><code class="varname">&amp;&amp;</code>演算子は、2次元バウンディングボックスAが、ジオメトリBのキャッシュされた2次元バウンディングボックスとインタセクトする場合に、<code class="varname">TRUE</code>を返します。単精度浮動小数点数によるバウンディングボックスを使います。Aが倍精度浮動小数点数を使うbox2dである場合には、単精度浮動小数点数によるバウンディングボックス (BOX2DF)に変換されることになります。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この被演算子は、ユーザが使うためというよりも内部でBRINインデックスに使うために導入されました。</p></td></tr></table></div><p>Availability: 2.3.0 BRIN (Block Range INdexes)が導入されました。PostgreSQL 9.5以上が必要です。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p></div><div class="refsection"><a name="idp74894920"></a><h2>例</h2><pre class="programlisting">SELECT ST_MakeBox2D(ST_MakePoint(0,0), ST_MakePoint(2,2)) &amp;&amp; ST_MakePoint(1,1) AS overlaps;

 overlaps
----------
 t
(1 row)</pre></div><div class="refsection"><a name="idp74896200"></a><h2>関連情報</h2><p><a class="xref" href="#overlaps_geometry_box2df" title="&amp;&amp;(geometry,box2df)">&amp;&amp;(geometry,box2df)</a>, <a class="xref" href="#overlaps_box2df_box2df" title="&amp;&amp;(box2df,box2df)">&amp;&amp;(box2df,box2df)</a>, <a class="xref" href="#contains_geometry_box2df" title="~(geometry,box2df)">~(geometry,box2df)</a>, <a class="xref" href="#contains_box2df_geometry" title="~(box2df,geometry)">~(box2df,geometry)</a>, <a class="xref" href="#contains_box2df_box2df" title="~(box2df,box2df)">~(box2df,box2df)</a>, <a class="xref" href="#is_contained_geometry_box2df" title="@(geometry,box2df)">@(geometry,box2df)</a>, <a class="xref" href="#is_contained_box2df_geometry" title="@(box2df,geometry)">@(box2df,geometry)</a>, <a class="xref" href="#is_contained_box2df_box2df" title="@(box2df,box2df)">@(box2df,box2df)</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="overlaps_box2df_box2df"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>&amp;&amp;(box2df,box2df) — 二つの単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)が相互にインタセクトする場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">&amp;&amp;</b>(</code> box2df  <var class="pdparam">A</var> ,  box2df  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp74906568"></a><h2>説明</h2><p><code class="varname">&amp;&amp;</code>演算子は、2次元バウンディングボックスAとBが相互にインタセクトする場合に、<code class="varname">TRUE</code>を返します。単精度浮動小数点数によるバウンディングボックスを使います。AまたはBが倍精度浮動小数点数を使うbox2dである場合には、バウンディングボックス (BOX2DF)に変換されることになります。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この演算子は、ユーザが使うためというよりも内部でBRINインデックスに使うために導入されました。</p></td></tr></table></div><p>Availability: 2.3.0 BRIN (Block Range INdexes)が導入されました。PostgreSQL 9.5以上が必要です。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p></div><div class="refsection"><a name="idp74911816"></a><h2>例</h2><pre class="programlisting">SELECT ST_MakeBox2D(ST_MakePoint(0,0), ST_MakePoint(2,2)) &amp;&amp; ST_MakeBox2D(ST_MakePoint(1,1), ST_MakePoint(3,3)) AS overlaps;

 overlaps
----------
 t
(1 row)</pre></div><div class="refsection"><a name="idp74913096"></a><h2>関連情報</h2><p><a class="xref" href="#overlaps_geometry_box2df" title="&amp;&amp;(geometry,box2df)">&amp;&amp;(geometry,box2df)</a>, <a class="xref" href="#overlaps_box2df_geometry" title="&amp;&amp;(box2df,geometry)">&amp;&amp;(box2df,geometry)</a>, <a class="xref" href="#contains_geometry_box2df" title="~(geometry,box2df)">~(geometry,box2df)</a>, <a class="xref" href="#contains_box2df_geometry" title="~(box2df,geometry)">~(box2df,geometry)</a>, <a class="xref" href="#contains_box2df_box2df" title="~(box2df,box2df)">~(box2df,box2df)</a>, <a class="xref" href="#is_contained_geometry_box2df" title="@(geometry,box2df)">@(geometry,box2df)</a>, <a class="xref" href="#is_contained_box2df_geometry" title="@(box2df,geometry)">@(box2df,geometry)</a>, <a class="xref" href="#is_contained_box2df_box2df" title="@(box2df,box2df)">@(box2df,box2df)</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="geometry_overlaps_nd"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>&amp;&amp;&amp; — Aのn次元バウンディングボックスがBのn次元バウンディングボックスとインタセクトする場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">&amp;&amp;&amp;</b>(</code> geometry  <var class="pdparam">A</var> ,  geometry  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp74923464"></a><h2>説明</h2><p><code class="varname">&amp;&amp;&amp;</code>演算子は、Aのn次元バウンディングボックスがBのn次元バウンディングボックスとインタセクトする場合に<code class="varname">TRUE</code>を返します。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これのオペランドは、ジオメトリで使用できるインデクスを使用します。</p></td></tr></table></div><p>Availability: 2.0.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp74931528"></a><h2>例: 3次元ラインストリング</h2><pre class="programlisting">SELECT tbl1.column1, tbl2.column1, tbl1.column2 &amp;&amp;&amp; tbl2.column2 AS overlaps_3d,
                                    tbl1.column2 &amp;&amp; tbl2.column2 AS overlaps_2d
FROM ( VALUES
        (1, 'LINESTRING Z(0 0 1, 3 3 2)'::geometry),
        (2, 'LINESTRING Z(1 2 0, 0 5 -1)'::geometry)) AS tbl1,
( VALUES
        (3, 'LINESTRING Z(1 2 1, 4 6 1)'::geometry)) AS tbl2;

 column1 | column1 | overlaps_3d | overlaps_2d
---------+---------+-------------+-------------
       1 |       3 | t           | t
       2 |       3 | f           | t
</pre></div><div class="refsection"><a name="idp74932808"></a><h2>例: XYMラインストリング</h2><pre class="programlisting">SELECT tbl1.column1, tbl2.column1, tbl1.column2 &amp;&amp;&amp; tbl2.column2 AS overlaps_3zm,
                                    tbl1.column2 &amp;&amp; tbl2.column2 AS overlaps_2d
FROM ( VALUES
        (1, 'LINESTRING M(0 0 1, 3 3 2)'::geometry),
        (2, 'LINESTRING M(1 2 0, 0 5 -1)'::geometry)) AS tbl1,
( VALUES
        (3, 'LINESTRING M(1 2 1, 4 6 1)'::geometry)) AS tbl2;

 column1 | column1 | overlaps_3zm | overlaps_2d
---------+---------+-------------+-------------
       1 |       3 | t           | t
       2 |       3 | f           | t
</pre></div><div class="refsection"><a name="idp74934088"></a><h2>関連情報</h2><p><a class="xref" href="#geometry_overlaps" title="&amp;&amp;">&amp;&amp;</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="overlaps_nd_geometry_gidx"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>&amp;&amp;&amp;(geometry,gidx) — ジオメトリの (キャッシュされている)n次元バウンディングボックスが単精度浮動小数点数によるn次元バウンディングボックス (GIDX)とインタセクトする場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">&amp;&amp;&amp;</b>(</code> geometry  <var class="pdparam">A</var> ,  gidx  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp74941768"></a><h2>説明</h2><p><code class="varname">&amp;&amp;&amp;</code>演算子は、ジオメトリAのキャッシュされたn次元バウンディングボックスが、n次元バウンディングボックスBとインタセクトする場合に、<code class="varname">TRUE</code>を返します。単精度浮動小数点数によるバウンディングボックスを使います。Bが倍精度浮動小数点数を使うbox3dである場合には、単精度浮動小数点数による3次元バウンディングボックス (GIDX)に変換されることになります。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この演算子は、ユーザが使うためというよりも内部でBRINインデックスに使うために導入されました。</p></td></tr></table></div><p>Availability: 2.3.0 BRIN (Block Range INdexes)が導入されました。PostgreSQL 9.5以上が必要です。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp74949832"></a><h2>例</h2><pre class="programlisting">SELECT ST_MakePoint(1,1,1) &amp;&amp;&amp; ST_3DMakeBox(ST_MakePoint(0,0,0), ST_MakePoint(2,2,2)) AS overlaps;

 overlaps
----------
 t
(1 row)</pre></div><div class="refsection"><a name="idp74951112"></a><h2>関連情報</h2><p><a class="xref" href="#overlaps_nd_gidx_geometry" title="&amp;&amp;&amp;(gidx,geometry)">&amp;&amp;&amp;(gidx,geometry)</a>, <a class="xref" href="#overlaps_nd_gidx_gidx" title="&amp;&amp;&amp;(gidx,gidx)">&amp;&amp;&amp;(gidx,gidx)</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="overlaps_nd_gidx_geometry"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>&amp;&amp;&amp;(gidx,geometry) — 単精度浮動小数点数によるn次元バウンディングボックス (GIDX)がジオメトリの (キャッシュされている)n次元バウンディングボックスとインタセクトする場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">&amp;&amp;&amp;</b>(</code> gidx  <var class="pdparam">A</var> ,  geometry  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp74971464"></a><h2>説明</h2><p><code class="varname">&amp;&amp;&amp;</code>演算子は、n次元バウンディングボックスAが、ジオメトリBのキャッシュされたn次元バウンディングボックスとインタセクトする場合に、<code class="varname">TRUE</code>を返します。単精度浮動小数点数によるバウンディングボックスを使います。Aが倍精度浮動小数点数を使うbox3dである場合には、単精度浮動小数点数による3次元バウンディングボックス (GIDX)に変換されることになります。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この演算子は、ユーザが使うためというよりも内部でBRINインデックスに使うために導入されました。</p></td></tr></table></div><p>Availability: 2.3.0 BRIN (Block Range INdexes)が導入されました。PostgreSQL 9.5以上が必要です。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp74979528"></a><h2>例</h2><pre class="programlisting">SELECT ST_3DMakeBox(ST_MakePoint(0,0,0), ST_MakePoint(2,2,2)) &amp;&amp;&amp; ST_MakePoint(1,1,1) AS overlaps;

 overlaps
----------
 t
(1 row)</pre></div><div class="refsection"><a name="idp74980808"></a><h2>関連情報</h2><p><a class="xref" href="#overlaps_nd_geometry_gidx" title="&amp;&amp;&amp;(geometry,gidx)">&amp;&amp;&amp;(geometry,gidx)</a>, <a class="xref" href="#overlaps_nd_gidx_gidx" title="&amp;&amp;&amp;(gidx,gidx)">&amp;&amp;&amp;(gidx,gidx)</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="overlaps_nd_gidx_gidx"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>&amp;&amp;&amp;(gidx,gidx) — 二つの単精度浮動小数点数によるn次元バウンディングボックス (GIDX)が相互にインタセクトする場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">&amp;&amp;&amp;</b>(</code> gidx  <var class="pdparam">A</var> ,  gidx  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp74988872"></a><h2>説明</h2><p><code class="varname">&amp;&amp;&amp;</code>演算子は、n次元バウンディングボックスAとBが相互にインタセクトする場合に、<code class="varname">TRUE</code>を返します。単精度浮動小数点数によるバウンディングボックスを使います。AまたはBが倍精度浮動小数点数を使うbox3dである場合には、単精度浮動小数点数による3次元バウンディングボックス (GIDX)に変換されることになります。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この演算子は、ユーザが使うためというよりも内部でBRINインデックスに使うために導入されました。</p></td></tr></table></div><p>Availability: 2.3.0 BRIN (Block Range INdexes)が導入されました。PostgreSQL 9.5以上が必要です。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp74996936"></a><h2>例</h2><pre class="programlisting">SELECT ST_3DMakeBox(ST_MakePoint(0,0,0), ST_MakePoint(2,2,2)) &amp;&amp;&amp; ST_3DMakeBox(ST_MakePoint(1,1,1), ST_MakePoint(3,3,3)) AS overlaps;

 overlaps
----------
 t
(1 row)</pre></div><div class="refsection"><a name="idp74998216"></a><h2>関連情報</h2><p><a class="xref" href="#overlaps_nd_geometry_gidx" title="&amp;&amp;&amp;(geometry,gidx)">&amp;&amp;&amp;(geometry,gidx)</a>, <a class="xref" href="#overlaps_nd_gidx_geometry" title="&amp;&amp;&amp;(gidx,geometry)">&amp;&amp;&amp;(gidx,geometry)</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Geometry_Overleft"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>&amp;&lt; — AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの左にある場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">&amp;&lt;</b>(</code> geometry  <var class="pdparam">A</var> ,  geometry  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp75014472"></a><h2>説明</h2><p><code class="varname">&amp;&lt;</code>演算子は、AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの左にある場合に<code class="varname">TRUE</code>を返します。条件についてより詳細に言うと、BのバウンディングボックスをオーバラップするかBのバウンディングボックスの右に*ない*場合です。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これのオペランドは、ジオメトリで使用できるインデクスを使用します。</p></td></tr></table></div></div><div class="refsection"><a name="idp75016776"></a><h2>例</h2><pre class="programlisting">SELECT tbl1.column1, tbl2.column1, tbl1.column2 &amp;&lt; tbl2.column2 AS overleft
FROM
  ( VALUES
        (1, 'LINESTRING(1 2, 4 6)'::geometry)) AS tbl1,
  ( VALUES
        (2, 'LINESTRING(0 0, 3 3)'::geometry),
        (3, 'LINESTRING(0 1, 0 5)'::geometry),
        (4, 'LINESTRING(6 0, 6 1)'::geometry)) AS tbl2;

 column1 | column1 | overleft
---------+---------+----------
           1 |       2 | f
           1 |       3 | f
           1 |       4 | t
(3 rows)</pre></div><div class="refsection"><a name="idp75018056"></a><h2>関連情報</h2><p><a class="xref" href="#geometry_overlaps" title="&amp;&amp;">&amp;&amp;</a>, <a class="xref" href="#ST_Geometry_Overabove" title="|&amp;&gt;">|&amp;&gt;</a>, <a class="xref" href="#ST_Geometry_Overright" title="&amp;&gt;">&amp;&gt;</a>, <a class="xref" href="#ST_Geometry_Overbelow" title="&amp;&lt;|">&amp;&lt;|</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Geometry_Overbelow"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>&amp;&lt;| — AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの下にある場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">&amp;&lt;|</b>(</code> geometry  <var class="pdparam">A</var> ,  geometry  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp75039176"></a><h2>説明</h2><p><code class="varname">&amp;&lt;|</code>演算子は、AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの下にある場合に<code class="varname">TRUE</code>を返します。条件についてより詳細に言うと、BのバウンディングボックスをオーバラップするかBのバウンディングボックスの上に*ない*場合です。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これのオペランドは、ジオメトリで使用できるインデクスを使用します。</p></td></tr></table></div></div><div class="refsection"><a name="idp75044040"></a><h2>例</h2><pre class="programlisting">SELECT tbl1.column1, tbl2.column1, tbl1.column2 &amp;&lt;| tbl2.column2 AS overbelow
FROM
  ( VALUES
        (1, 'LINESTRING(6 0, 6 4)'::geometry)) AS tbl1,
  ( VALUES
        (2, 'LINESTRING(0 0, 3 3)'::geometry),
        (3, 'LINESTRING(0 1, 0 5)'::geometry),
        (4, 'LINESTRING(1 2, 4 6)'::geometry)) AS tbl2;

 column1 | column1 | overbelow
---------+---------+-----------
           1 |       2 | f
           1 |       3 | t
           1 |       4 | t
(3 rows)</pre></div><div class="refsection"><a name="idp75045320"></a><h2>関連情報</h2><p><a class="xref" href="#geometry_overlaps" title="&amp;&amp;">&amp;&amp;</a>, <a class="xref" href="#ST_Geometry_Overabove" title="|&amp;&gt;">|&amp;&gt;</a>, <a class="xref" href="#ST_Geometry_Overright" title="&amp;&gt;">&amp;&gt;</a>, <a class="xref" href="#ST_Geometry_Overleft" title="&amp;&lt;">&amp;&lt;</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Geometry_Overright"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>&amp;&gt; — AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの右にある場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">&amp;&gt;</b>(</code> geometry  <var class="pdparam">A</var> ,  geometry  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp75054152"></a><h2>説明</h2><p><code class="varname">&amp;&gt;</code>演算子は、AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの右にある場合に<code class="varname">TRUE</code>を返します。条件についてより詳細に言うと、BのバウンディングボックスをオーバラップするかBのバウンディングボックスの左に*ない*場合です。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これのオペランドは、ジオメトリで使用できるインデクスを使用します。</p></td></tr></table></div></div><div class="refsection"><a name="idp75056456"></a><h2>例</h2><pre class="programlisting">SELECT tbl1.column1, tbl2.column1, tbl1.column2 &amp;&gt; tbl2.column2 AS overright
FROM
  ( VALUES
        (1, 'LINESTRING(1 2, 4 6)'::geometry)) AS tbl1,
  ( VALUES
        (2, 'LINESTRING(0 0, 3 3)'::geometry),
        (3, 'LINESTRING(0 1, 0 5)'::geometry),
        (4, 'LINESTRING(6 0, 6 1)'::geometry)) AS tbl2;

 column1 | column1 | overright
---------+---------+-----------
           1 |       2 | t
           1 |       3 | t
           1 |       4 | f
(3 rows)</pre></div><div class="refsection"><a name="idp75057736"></a><h2>関連情報</h2><p><a class="xref" href="#geometry_overlaps" title="&amp;&amp;">&amp;&amp;</a>, <a class="xref" href="#ST_Geometry_Overabove" title="|&amp;&gt;">|&amp;&gt;</a>, <a class="xref" href="#ST_Geometry_Overbelow" title="&amp;&lt;|">&amp;&lt;|</a>, <a class="xref" href="#ST_Geometry_Overleft" title="&amp;&lt;">&amp;&lt;</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Geometry_Left"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>&lt;&lt; — Aのバウンダリボックスが、厳密にBのバウンダリボックスの左にある場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">&lt;&lt;</b>(</code> geometry  <var class="pdparam">A</var> ,  geometry  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp75066568"></a><h2>説明</h2><p><code class="varname">&lt;&lt;</code>演算子はAのバウンダリボックスが、厳密にBのバウンダリボックスの左にある場合に<code class="varname">TRUE</code>を返します。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これのオペランドは、ジオメトリで使用できるインデクスを使用します。</p></td></tr></table></div></div><div class="refsection"><a name="idp75069000"></a><h2>例</h2><pre class="programlisting">SELECT tbl1.column1, tbl2.column1, tbl1.column2 &lt;&lt; tbl2.column2 AS left
FROM
  ( VALUES
        (1, 'LINESTRING (1 2, 1 5)'::geometry)) AS tbl1,
  ( VALUES
        (2, 'LINESTRING (0 0, 4 3)'::geometry),
        (3, 'LINESTRING (6 0, 6 5)'::geometry),
        (4, 'LINESTRING (2 2, 5 6)'::geometry)) AS tbl2;

 column1 | column1 | left
---------+---------+------
           1 |       2 | f
           1 |       3 | t
           1 |       4 | t
(3 rows)</pre></div><div class="refsection"><a name="idp75070280"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Geometry_Right" title="&gt;&gt;">&gt;&gt;</a>, <a class="xref" href="#ST_Geometry_Above" title="|&gt;&gt;">|&gt;&gt;</a>, <a class="xref" href="#ST_Geometry_Below" title="&lt;&lt;|">&lt;&lt;|</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Geometry_Below"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>&lt;&lt;| — Aのバウンダリボックスが、厳密にBのバウンダリボックスの下にある場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">&lt;&lt;|</b>(</code> geometry  <var class="pdparam">A</var> ,  geometry  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp75078728"></a><h2>説明</h2><p><code class="varname">&lt;&lt;|</code>演算子は、Aのバウンダリボックスが、厳密にBのバウンダリボックスの下にある場合に<code class="varname">TRUE</code>を返します。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これのオペランドは、ジオメトリで使用できるインデクスを使用します。</p></td></tr></table></div></div><div class="refsection"><a name="idp75081160"></a><h2>例</h2><pre class="programlisting">SELECT tbl1.column1, tbl2.column1, tbl1.column2 &lt;&lt;| tbl2.column2 AS below
FROM
  ( VALUES
        (1, 'LINESTRING (0 0, 4 3)'::geometry)) AS tbl1,
  ( VALUES
        (2, 'LINESTRING (1 4, 1 7)'::geometry),
        (3, 'LINESTRING (6 1, 6 5)'::geometry),
        (4, 'LINESTRING (2 3, 5 6)'::geometry)) AS tbl2;

 column1 | column1 | below
---------+---------+-------
           1 |       2 | t
           1 |       3 | f
           1 |       4 | f
(3 rows)</pre></div><div class="refsection"><a name="idp75082440"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Geometry_Left" title="&lt;&lt;">&lt;&lt;</a>, <a class="xref" href="#ST_Geometry_Right" title="&gt;&gt;">&gt;&gt;</a>, <a class="xref" href="#ST_Geometry_Above" title="|&gt;&gt;">|&gt;&gt;</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Geometry_EQ"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>= — ジオメトリ/ジオグラフィ Aの座標と座標の並び順がジオメトリ/ジオグラフィ Bと同じ場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">=</b>(</code> geometry  <var class="pdparam">A</var> ,  geometry  <var class="pdparam">B</var> <code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">=</b>(</code> geography  <var class="pdparam">A</var> ,  geography  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp75152072"></a><h2>説明</h2><p><code class="varname">=</code>演算子は、ジオメトリ/ジオグラフィ Aの座標と座標の並び順がジオメトリ/ジオグラフィ Bと同じ場合に<code class="varname">TRUE</code>を返します。PostgreSQLは、ジオメトリの内部の順位付けと比較 (GROUP BYやORDER BY節などで使います)のために、ジオメトリ用に定義されている=, &lt;および&gt; 演算子を使います。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この演算子は、同じ座標値と並び順である、全ての点で確実に同じジオメトリ/ジオグラフィだけを同じと考えます。「空間的に等価」、つまり、並び順は無視し、異なる表現でも同じ空間領域を占めるかどうかをテストするには、<a class="xref" href="#ST_OrderingEquals" title="ST_OrderingEquals">ST_OrderingEquals</a>または<a class="xref" href="#ST_Equals" title="ST_Equals">ST_Equals</a>を使います。</p></td></tr></table></div><div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Caution"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注意]" src="images/caution.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この演算子は、ジオメトリで有効なインデックスを一切*使いません*。インデックスを使った確実な等価性試験を行うには、=と&amp;&amp;を併用します。</p></td></tr></table></div><p>Changed: 2.4.0, 以前の版では、ジオメトリ自体の等価性でなくバウンディングボックスが等価かどうかを見ていました。バウンディングボックスが等価かどうかを知る必要がある場合には、替わりに<a class="xref" href="#ST_Geometry_Same" title="~=">~=</a>を使います。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p></div><div class="refsection"><a name="idp75159240"></a><h2>例</h2><pre class="programlisting">SELECT 'LINESTRING(0 0, 0 1, 1 0)'::geometry = 'LINESTRING(1 1, 0 0)'::geometry;
 ?column?
----------
 t
(1 row)

SELECT ST_AsText(column1)
FROM ( VALUES
        ('LINESTRING(0 0, 1 1)'::geometry),
        ('LINESTRING(1 1, 0 0)'::geometry)) AS foo;
          st_astext
---------------------
 LINESTRING(0 0,1 1)
 LINESTRING(1 1,0 0)
(2 rows)

-- Note: the GROUP BY uses the "=" to compare for geometry equivalency.
SELECT ST_AsText(column1)
FROM ( VALUES
        ('LINESTRING(0 0, 1 1)'::geometry),
        ('LINESTRING(1 1, 0 0)'::geometry)) AS foo
GROUP BY column1;
          st_astext
---------------------
 LINESTRING(0 0,1 1)
(1 row)

-- 2.0より前の版では、これはTRUEを返します --
 SELECT ST_GeomFromText('POINT(1707296.37 4820536.77)') =
        ST_GeomFromText('POINT(1707296.27 4820536.87)') As pt_intersect;

--pt_intersect --
f
</pre></div><div class="refsection"><a name="idp75164616"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Equals" title="ST_Equals">ST_Equals</a>, <a class="xref" href="#ST_OrderingEquals" title="ST_OrderingEquals">ST_OrderingEquals</a>, <a class="xref" href="#ST_Geometry_Same" title="~=">~=</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Geometry_Right"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>&gt;&gt; — Aのバウンダリボックスが、厳密にBのバウンダリボックスの右にある場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">&gt;&gt;</b>(</code> geometry  <var class="pdparam">A</var> ,  geometry  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp75173192"></a><h2>説明</h2><p><code class="varname">&gt;&gt;</code>演算子は、Aのバウンダリボックスが、厳密にBのバウンダリボックスの右にある場合に<code class="varname">TRUE</code>を返します。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これのオペランドは、ジオメトリで使用できるインデクスを使用します。</p></td></tr></table></div></div><div class="refsection"><a name="idp75175624"></a><h2>例</h2><pre class="programlisting">SELECT tbl1.column1, tbl2.column1, tbl1.column2 &gt;&gt; tbl2.column2 AS right
FROM
  ( VALUES
        (1, 'LINESTRING (2 3, 5 6)'::geometry)) AS tbl1,
  ( VALUES
        (2, 'LINESTRING (1 4, 1 7)'::geometry),
        (3, 'LINESTRING (6 1, 6 5)'::geometry),
        (4, 'LINESTRING (0 0, 4 3)'::geometry)) AS tbl2;

 column1 | column1 | right
---------+---------+-------
           1 |       2 | t
           1 |       3 | f
           1 |       4 | f
(3 rows)</pre></div><div class="refsection"><a name="idp75176904"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Geometry_Left" title="&lt;&lt;">&lt;&lt;</a>, <a class="xref" href="#ST_Geometry_Above" title="|&gt;&gt;">|&gt;&gt;</a>, <a class="xref" href="#ST_Geometry_Below" title="&lt;&lt;|">&lt;&lt;|</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Geometry_Contained"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>@ — AのバウンダリボックスがBのバウンダリボックスに含まれている場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">@</b>(</code> geometry  <var class="pdparam">A</var> ,  geometry  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp75185352"></a><h2>説明</h2><p><code class="varname">@</code>演算子は、AのバウンダリボックスがBのバウンダリボックスに、完全に含まれている場合に<code class="varname">TRUE</code>を返します。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これのオペランドは、ジオメトリで使用できるインデクスを使用します。</p></td></tr></table></div></div><div class="refsection"><a name="idp75188040"></a><h2>例</h2><pre class="programlisting">SELECT tbl1.column1, tbl2.column1, tbl1.column2 @ tbl2.column2 AS contained
FROM
  ( VALUES
        (1, 'LINESTRING (1 1, 3 3)'::geometry)) AS tbl1,
  ( VALUES
        (2, 'LINESTRING (0 0, 4 4)'::geometry),
        (3, 'LINESTRING (2 2, 4 4)'::geometry),
        (4, 'LINESTRING (1 1, 3 3)'::geometry)) AS tbl2;

 column1 | column1 | contained
---------+---------+-----------
           1 |       2 | t
           1 |       3 | f
           1 |       4 | t
(3 rows)</pre></div><div class="refsection"><a name="idp75189320"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Geometry_Contain" title="~">~</a>, <a class="xref" href="#geometry_overlaps" title="&amp;&amp;">&amp;&amp;</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="is_contained_geometry_box2df"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>@(geometry,box2df) — ジオメトリの2次元バウンディングボックスが単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)に包含される場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">@</b>(</code> geometry  <var class="pdparam">A</var> ,  box2df  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp75209672"></a><h2>説明</h2><p><code class="varname">@</code>演算子は、ジオメトリAの2次元バウンディングボックスが、2次元バウンディングボックスBに包含される場合に、<code class="varname">TRUE</code>を返します。単精度浮動小数点数によるバウンディングボックスを使います。Bが倍精度浮動小数点数を使うbox2dである場合には、単精度浮動小数点数によるバウンディングボックス (BOX2DF)に変換されることになります。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この被演算子は、ユーザが使うためというよりも内部でBRINインデックスに使うために導入されました。</p></td></tr></table></div><p>Availability: 2.3.0 BRIN (Block Range INdexes)が導入されました。PostgreSQL 9.5以上が必要です。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p></div><div class="refsection"><a name="idp75214920"></a><h2>例</h2><pre class="programlisting">SELECT ST_Buffer(ST_GeomFromText('POINT(2 2)'), 1) @ ST_MakeBox2D(ST_MakePoint(0,0), ST_MakePoint(5,5)) AS is_contained;

 is_contained
--------------
 t
(1 row)</pre></div><div class="refsection"><a name="idp75216200"></a><h2>関連情報</h2><p><a class="xref" href="#overlaps_geometry_box2df" title="&amp;&amp;(geometry,box2df)">&amp;&amp;(geometry,box2df)</a>, <a class="xref" href="#overlaps_box2df_geometry" title="&amp;&amp;(box2df,geometry)">&amp;&amp;(box2df,geometry)</a>, <a class="xref" href="#overlaps_box2df_box2df" title="&amp;&amp;(box2df,box2df)">&amp;&amp;(box2df,box2df)</a>, <a class="xref" href="#contains_geometry_box2df" title="~(geometry,box2df)">~(geometry,box2df)</a>, <a class="xref" href="#contains_box2df_geometry" title="~(box2df,geometry)">~(box2df,geometry)</a>, <a class="xref" href="#contains_box2df_box2df" title="~(box2df,box2df)">~(box2df,box2df)</a>, <a class="xref" href="#is_contained_box2df_geometry" title="@(box2df,geometry)">@(box2df,geometry)</a>, <a class="xref" href="#is_contained_box2df_box2df" title="@(box2df,box2df)">@(box2df,box2df)</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="is_contained_box2df_geometry"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>@(box2df,geometry) — 単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)がジオメトリの2次元バウンディングボックスに包含される場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">@</b>(</code> box2df  <var class="pdparam">A</var> ,  geometry  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp73797064"></a><h2>説明</h2><p><code class="varname">@</code>演算子は、2次元バウンディングボックスAが、ジオメトリBの2次元バウンディングボックスに包含される場合に、<code class="varname">TRUE</code>を返します。単精度浮動小数点数によるバウンディングボックスを使います。Aが倍精度浮動小数点数を使うbox2dである場合には、単精度浮動小数点数によるバウンディングボックス (BOX2DF)に変換されることになります。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この被演算子は、ユーザが使うためというよりも内部でBRINインデックスに使うために導入されました。</p></td></tr></table></div><p>Availability: 2.3.0 BRIN (Block Range INdexes)が導入されました。PostgreSQL 9.5以上が必要です。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p></div><div class="refsection"><a name="idp73802312"></a><h2>例</h2><pre class="programlisting">SELECT ST_MakeBox2D(ST_MakePoint(2,2), ST_MakePoint(3,3)) @ ST_Buffer(ST_GeomFromText('POINT(1 1)'), 10) AS is_contained;

 is_contained
--------------
 t
(1 row)</pre></div><div class="refsection"><a name="idp73803592"></a><h2>関連情報</h2><p><a class="xref" href="#overlaps_geometry_box2df" title="&amp;&amp;(geometry,box2df)">&amp;&amp;(geometry,box2df)</a>, <a class="xref" href="#overlaps_box2df_geometry" title="&amp;&amp;(box2df,geometry)">&amp;&amp;(box2df,geometry)</a>, <a class="xref" href="#overlaps_box2df_box2df" title="&amp;&amp;(box2df,box2df)">&amp;&amp;(box2df,box2df)</a>, <a class="xref" href="#contains_geometry_box2df" title="~(geometry,box2df)">~(geometry,box2df)</a>, <a class="xref" href="#contains_box2df_geometry" title="~(box2df,geometry)">~(box2df,geometry)</a>, <a class="xref" href="#contains_box2df_box2df" title="~(box2df,box2df)">~(box2df,box2df)</a>, <a class="xref" href="#is_contained_geometry_box2df" title="@(geometry,box2df)">@(geometry,box2df)</a>, <a class="xref" href="#is_contained_box2df_box2df" title="@(box2df,box2df)">@(box2df,box2df)</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="is_contained_box2df_box2df"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>@(box2df,box2df) — 二つの単精度浮動小数点数によるn次元バウンディングボックス (GIDX)の一方がもう一方を包含する場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">@</b>(</code> box2df  <var class="pdparam">A</var> ,  box2df  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp73818056"></a><h2>説明</h2><p><code class="varname">@</code>演算子は、2次元バウンディングボックスAが2次元バウンディングボックスBに包含される場合には、<code class="varname">TRUE</code>を返します。単精度浮動小数点数によるバウンディングボックスを使います。AまたはBが倍精度浮動小数点数を使うbox2dである場合には、単精度浮動小数点数によるバウンディングボックス (BOX2DF)に変換されることになります。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この被演算子は、ユーザが使うためというよりも内部でBRINインデックスに使うために導入されました。</p></td></tr></table></div><p>Availability: 2.3.0 BRIN (Block Range INdexes)が導入されました。PostgreSQL 9.5以上が必要です。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p></div><div class="refsection"><a name="idp75224136"></a><h2>例</h2><pre class="programlisting">SELECT ST_MakeBox2D(ST_MakePoint(2,2), ST_MakePoint(3,3)) @ ST_MakeBox2D(ST_MakePoint(0,0), ST_MakePoint(5,5)) AS is_contained;

 is_contained
--------------
 t
(1 row)</pre></div><div class="refsection"><a name="idp75225416"></a><h2>関連情報</h2><p><a class="xref" href="#overlaps_geometry_box2df" title="&amp;&amp;(geometry,box2df)">&amp;&amp;(geometry,box2df)</a>, <a class="xref" href="#overlaps_box2df_geometry" title="&amp;&amp;(box2df,geometry)">&amp;&amp;(box2df,geometry)</a>, <a class="xref" href="#overlaps_box2df_box2df" title="&amp;&amp;(box2df,box2df)">&amp;&amp;(box2df,box2df)</a>, <a class="xref" href="#contains_geometry_box2df" title="~(geometry,box2df)">~(geometry,box2df)</a>, <a class="xref" href="#contains_box2df_geometry" title="~(box2df,geometry)">~(box2df,geometry)</a>, <a class="xref" href="#contains_box2df_box2df" title="~(box2df,box2df)">~(box2df,box2df)</a>, <a class="xref" href="#is_contained_geometry_box2df" title="@(geometry,box2df)">@(geometry,box2df)</a>, <a class="xref" href="#is_contained_box2df_geometry" title="@(box2df,geometry)">@(box2df,geometry)</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Geometry_Overabove"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>|&amp;&gt; — AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの上にある場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">|&amp;&gt;</b>(</code> geometry  <var class="pdparam">A</var> ,  geometry  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp75235784"></a><h2>説明</h2><p><code class="varname">|&amp;&gt;</code>演算子は、AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの上にある場合に<code class="varname">TRUE</code>を返します。条件についてより詳細に言うと、BのバウンディングボックスをオーバラップするかBのバウンディングボックスの下に*ない*場合です。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これのオペランドは、ジオメトリで使用できるインデクスを使用します。</p></td></tr></table></div></div><div class="refsection"><a name="idp75238088"></a><h2>例</h2><pre class="programlisting">SELECT tbl1.column1, tbl2.column1, tbl1.column2 |&amp;&gt; tbl2.column2 AS overabove
FROM
  ( VALUES
        (1, 'LINESTRING(6 0, 6 4)'::geometry)) AS tbl1,
  ( VALUES
        (2, 'LINESTRING(0 0, 3 3)'::geometry),
        (3, 'LINESTRING(0 1, 0 5)'::geometry),
        (4, 'LINESTRING(1 2, 4 6)'::geometry)) AS tbl2;

 column1 | column1 | overabove
---------+---------+-----------
           1 |       2 | t
           1 |       3 | f
           1 |       4 | f
(3 rows)</pre></div><div class="refsection"><a name="idp75239368"></a><h2>関連情報</h2><p><a class="xref" href="#geometry_overlaps" title="&amp;&amp;">&amp;&amp;</a>, <a class="xref" href="#ST_Geometry_Overright" title="&amp;&gt;">&amp;&gt;</a>, <a class="xref" href="#ST_Geometry_Overbelow" title="&amp;&lt;|">&amp;&lt;|</a>, <a class="xref" href="#ST_Geometry_Overleft" title="&amp;&lt;">&amp;&lt;</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Geometry_Above"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>|&gt;&gt; — Aのバウンダリボックスが、厳密にBのバウンダリボックスの上にある場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">|&gt;&gt;</b>(</code> geometry  <var class="pdparam">A</var> ,  geometry  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp75248200"></a><h2>説明</h2><p><code class="varname">|&gt;&gt;</code>演算子は、Aのバウンダリボックスが、厳密にBのバウンダリボックスの上にある場合に<code class="varname">TRUE</code>を返します。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これのオペランドは、ジオメトリで使用できるインデクスを使用します。</p></td></tr></table></div></div><div class="refsection"><a name="idp75250632"></a><h2>例</h2><pre class="programlisting">SELECT tbl1.column1, tbl2.column1, tbl1.column2 |&gt;&gt; tbl2.column2 AS above
FROM
  ( VALUES
        (1, 'LINESTRING (1 4, 1 7)'::geometry)) AS tbl1,
  ( VALUES
        (2, 'LINESTRING (0 0, 4 2)'::geometry),
        (3, 'LINESTRING (6 1, 6 5)'::geometry),
        (4, 'LINESTRING (2 3, 5 6)'::geometry)) AS tbl2;

 column1 | column1 | above
---------+---------+-------
           1 |       2 | t
           1 |       3 | f
           1 |       4 | f
(3 rows)</pre></div><div class="refsection"><a name="idp75251912"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Geometry_Left" title="&lt;&lt;">&lt;&lt;</a>, <a class="xref" href="#ST_Geometry_Right" title="&gt;&gt;">&gt;&gt;</a>, <a class="xref" href="#ST_Geometry_Below" title="&lt;&lt;|">&lt;&lt;|</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Geometry_Contain"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>~ — AのバウンディングボックスがBのバウンディングボックスを含む場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">~</b>(</code> geometry  <var class="pdparam">A</var> ,  geometry  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp75289032"></a><h2>説明</h2><p><code class="varname">~</code>演算子は、AのバウンディングボックスがBのバウンディングボックスを、完全に含む場合に<code class="varname">TRUE</code>を返します。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これのオペランドは、ジオメトリで使用できるインデクスを使用します。</p></td></tr></table></div></div><div class="refsection"><a name="idp75291464"></a><h2>例</h2><pre class="programlisting">SELECT tbl1.column1, tbl2.column1, tbl1.column2 ~ tbl2.column2 AS contains
FROM
  ( VALUES
        (1, 'LINESTRING (0 0, 3 3)'::geometry)) AS tbl1,
  ( VALUES
        (2, 'LINESTRING (0 0, 4 4)'::geometry),
        (3, 'LINESTRING (1 1, 2 2)'::geometry),
        (4, 'LINESTRING (0 0, 3 3)'::geometry)) AS tbl2;

 column1 | column1 | contains
---------+---------+----------
           1 |       2 | f
           1 |       3 | t
           1 |       4 | t
(3 rows)</pre></div><div class="refsection"><a name="idp75292744"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Geometry_Contained" title="@">@</a>, <a class="xref" href="#geometry_overlaps" title="&amp;&amp;">&amp;&amp;</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="contains_geometry_box2df"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>~(geometry,box2df) — ジオメトリの (キャッシュされている)2次元バウンディングボックスが単精度浮動小数点数によるn次元バウンディングボックス (GIDX)を包含する場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">~</b>(</code> geometry  <var class="pdparam">A</var> ,  box2df  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp75329480"></a><h2>説明</h2><p><code class="varname">~</code>演算子は、ジオメトリAの2次元バウンディングボックスが、2次元バウンディングボックスBを包含する場合に、<code class="varname">TRUE</code>を返します。単精度浮動小数点数によるバウンディングボックスを使います。Bが倍精度浮動小数点数を使うbox2dである場合には、単精度浮動小数点数によるバウンディングボックス (BOX2DF)に変換されることになります。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この被演算子は、ユーザが使うためというよりも内部でBRINインデックスに使うために導入されました。</p></td></tr></table></div><p>Availability: 2.3.0 BRIN (Block Range INdexes)が導入されました。PostgreSQL 9.5以上が必要です。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p></div><div class="refsection"><a name="idp75334728"></a><h2>例</h2><pre class="programlisting">SELECT ST_Buffer(ST_GeomFromText('POINT(1 1)'), 10) ~ ST_MakeBox2D(ST_MakePoint(0,0), ST_MakePoint(2,2)) AS contains;

 contains
----------
 t
(1 row)</pre></div><div class="refsection"><a name="idp75336008"></a><h2>関連情報</h2><p><a class="xref" href="#overlaps_geometry_box2df" title="&amp;&amp;(geometry,box2df)">&amp;&amp;(geometry,box2df)</a>, <a class="xref" href="#overlaps_box2df_geometry" title="&amp;&amp;(box2df,geometry)">&amp;&amp;(box2df,geometry)</a>, <a class="xref" href="#overlaps_box2df_box2df" title="&amp;&amp;(box2df,box2df)">&amp;&amp;(box2df,box2df)</a>, <a class="xref" href="#contains_box2df_geometry" title="~(box2df,geometry)">~(box2df,geometry)</a>, <a class="xref" href="#contains_box2df_box2df" title="~(box2df,box2df)">~(box2df,box2df)</a>, <a class="xref" href="#is_contained_geometry_box2df" title="@(geometry,box2df)">@(geometry,box2df)</a>, <a class="xref" href="#is_contained_box2df_geometry" title="@(box2df,geometry)">@(box2df,geometry)</a>, <a class="xref" href="#is_contained_box2df_box2df" title="@(box2df,box2df)">@(box2df,box2df)</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="contains_box2df_geometry"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>~(box2df,geometry) — 単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)をジオメトリの (キャッシュされている)2次元バウンディングボックスが包含する場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">~</b>(</code> box2df  <var class="pdparam">A</var> ,  geometry  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp75346376"></a><h2>説明</h2><p><code class="varname">~</code>演算子は、2次元バウンディングボックスAが、ジオメトリBの2次元バウンディングボックスを包含する場合に、<code class="varname">TRUE</code>を返します。単精度浮動小数点数によるバウンディングボックスを使います。Aが倍精度浮動小数点数を使うbox2dである場合には、単精度浮動小数点数によるバウンディングボックス (BOX2DF)に変換されることになります。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この被演算子は、ユーザが使うためというよりも内部でBRINインデックスに使うために導入されました。</p></td></tr></table></div><p>Availability: 2.3.0 BRIN (Block Range INdexes)が導入されました。PostgreSQL 9.5以上が必要です。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p></div><div class="refsection"><a name="idp75351624"></a><h2>例</h2><pre class="programlisting">SELECT ST_MakeBox2D(ST_MakePoint(0,0), ST_MakePoint(5,5)) ~ ST_Buffer(ST_GeomFromText('POINT(2 2)'), 1) AS contains;

 contains
----------
 t
(1 row)</pre></div><div class="refsection"><a name="idp75357000"></a><h2>関連情報</h2><p><a class="xref" href="#overlaps_geometry_box2df" title="&amp;&amp;(geometry,box2df)">&amp;&amp;(geometry,box2df)</a>, <a class="xref" href="#overlaps_box2df_geometry" title="&amp;&amp;(box2df,geometry)">&amp;&amp;(box2df,geometry)</a>, <a class="xref" href="#overlaps_box2df_box2df" title="&amp;&amp;(box2df,box2df)">&amp;&amp;(box2df,box2df)</a>, <a class="xref" href="#contains_geometry_box2df" title="~(geometry,box2df)">~(geometry,box2df)</a>, <a class="xref" href="#contains_box2df_box2df" title="~(box2df,box2df)">~(box2df,box2df)</a>, <a class="xref" href="#is_contained_geometry_box2df" title="@(geometry,box2df)">@(geometry,box2df)</a>, <a class="xref" href="#is_contained_box2df_geometry" title="@(box2df,geometry)">@(box2df,geometry)</a>, <a class="xref" href="#is_contained_box2df_box2df" title="@(box2df,box2df)">@(box2df,box2df)</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="contains_box2df_box2df"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>~(box2df,box2df) — 二つの単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)の一方がもう一方を包含する場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">~</b>(</code> box2df  <var class="pdparam">A</var> ,  box2df  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp75379656"></a><h2>説明</h2><p><code class="varname">~</code>演算子は、2次元バウンディングボックスAが、2次元バウンディングボックスBを包含する場合に、<code class="varname">TRUE</code>を返します。単精度浮動小数点数によるバウンディングボックスを使います。AまたはBが倍精度浮動小数点数を使うbox2dである場合には、単精度浮動小数点数によるバウンディングボックス (BOX2DF)に変換されることになります。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この被演算子は、ユーザが使うためというよりも内部でBRINインデックスに使うために導入されました。</p></td></tr></table></div><p>Availability: 2.3.0 BRIN (Block Range INdexes)が導入されました。PostgreSQL 9.5以上が必要です。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p></div><div class="refsection"><a name="idp75384904"></a><h2>例</h2><pre class="programlisting">SELECT ST_MakeBox2D(ST_MakePoint(0,0), ST_MakePoint(5,5)) ~ ST_MakeBox2D(ST_MakePoint(2,2), ST_MakePoint(3,3)) AS contains;

 contains
----------
 t
(1 row)</pre></div><div class="refsection"><a name="idp75386184"></a><h2>関連情報</h2><p><a class="xref" href="#overlaps_geometry_box2df" title="&amp;&amp;(geometry,box2df)">&amp;&amp;(geometry,box2df)</a>, <a class="xref" href="#overlaps_box2df_geometry" title="&amp;&amp;(box2df,geometry)">&amp;&amp;(box2df,geometry)</a>, <a class="xref" href="#overlaps_box2df_box2df" title="&amp;&amp;(box2df,box2df)">&amp;&amp;(box2df,box2df)</a>, <a class="xref" href="#contains_geometry_box2df" title="~(geometry,box2df)">~(geometry,box2df)</a>, <a class="xref" href="#contains_box2df_geometry" title="~(box2df,geometry)">~(box2df,geometry)</a>, <a class="xref" href="#is_contained_geometry_box2df" title="@(geometry,box2df)">@(geometry,box2df)</a>, <a class="xref" href="#is_contained_box2df_geometry" title="@(box2df,geometry)">@(box2df,geometry)</a>, <a class="xref" href="#is_contained_box2df_box2df" title="@(box2df,box2df)">@(box2df,box2df)</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Geometry_Same"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>~= — AのバウンディングボックスがBのバウンディングボックスと同じ場合にTRUEを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">~=</b>(</code> geometry  <var class="pdparam">A</var> ,  geometry  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp75396168"></a><h2>説明</h2><p><code class="varname">~=</code>演算子はジオメトリ/ジオグラフィAのバウンディングボックスがジオメトリ/ジオグラフィBのバウンディングボックスと同じ場合に<code class="varname">TRUE</code>を返します。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これのオペランドは、ジオメトリで使用できるインデクスを使用します。</p></td></tr></table></div><p>Availability: 1.5.0 挙動が変更されました</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この演算子の挙動はPostGIS 1.5で、実際のジオメトリとしての等価性のテストから、バウンディングボックスの等価性のテストに変更されました。ハードアップグレードまたはソフトアップグレードを実行している場合は、データベースがどの挙動を持つかに動作が依存して、ややこしくなります。データベースがどの挙動を持つか判断するために、下のクエリを実行することができます。本当の等価性をチェックするには<a class="xref" href="#ST_OrderingEquals" title="ST_OrderingEquals">ST_OrderingEquals</a>または <a class="xref" href="#ST_Equals" title="ST_Equals">ST_Equals</a>を使用します。</p></td></tr></table></div></div><div class="refsection"><a name="idp75401800"></a><h2>例</h2><pre class="programlisting">select 'LINESTRING(0 0, 1 1)'::geometry ~= 'LINESTRING(0 1, 1 0)'::geometry as equality;
 equality   |
-----------------+
          t    |
                        </pre></div><div class="refsection"><a name="idp75403080"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Equals" title="ST_Equals">ST_Equals</a>, <a class="xref" href="#ST_OrderingEquals" title="ST_OrderingEquals">ST_OrderingEquals</a>, <a class="xref" href="#ST_Geometry_EQ" title="=">=</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="geometry_distance_knn"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>&lt;-&gt; — AとBの2次元距離を返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">double precision <b class="fsfunc">&lt;-&gt;</b>(</code> geometry  <var class="pdparam">A</var> ,  geometry  <var class="pdparam">B</var> <code>)</code>;</p><p><code class="funcdef">double precision <b class="fsfunc">&lt;-&gt;</b>(</code> geography  <var class="pdparam">A</var> ,  geography  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp75414856"></a><h2>説明</h2><p><code class="varname">&lt;-&gt;</code>演算子は二つのジオメトリの2次元距離を返します。"ORDER BY"句内で使われ、インデクスの援助を受けた近傍結果集合を提供します。PostgreSQL 9.5より前では、バウンディングボックスの中心距離を出すだけでしたが、PostgreSQL 9.5以上では、ジオメトリ間の本当の距離が与えられた本当のKNN距離検索を行います。ジオグラフィでは球面上の距離を計算します。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これのオペランドはジオメトリで利用できるインデクスを使用します。他の演算子との相違点は、ORDER BY句でのみインデクスが使用される点です。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ジオメトリのひとつが定数となる (副問い合わせ/共通テーブル式にない)場合 (a.geomでなく'SRID=3005;POINT(1011102 450541)'::geometry等となる場合)には、インデクスが有効になるだけです。</p></td></tr></table></div><p>実際の生きた例については<a class="ulink" href="http://workshops.opengeo.org/postgis-intro/knn.html" target="_top">OpenGeo workshop: Nearest-Neighbour Searching</a>を参照して下さい。</p><p>Enhanced: 2.2.0 ジオメトリとジオグラフィとのKNN (k近傍法)の動作が本当のものになりました。ジオグラフィのKNNは回転楕円体面上でなく球面上の計算となることに注意して下さい。PostgreSQL 9.4以下では、ジオグラフィに対応していますが、バウンディングボックスの重心に対応するだけです。</p><p>Changed: 2.2.0 PostgreSQL 9.5では、古いハイブリッド書式は遅くなりる可能性があります。そのため、PostGIS 2.2以上かつPostgreSQL 9.5以上においてのみ動作させる場合には、そのやり方をり除きたくなるでしょう。</p><p>Availability: 2.0.0 弱いKNNによって、実際の距離の代わりにジオメトリの重心による近傍が得られます。ポイントは確実な結果を得て、他のタイプは全て不確実な結果を得ます。PostgreSQL 9.1以上で有効です。</p></div><div class="refsection"><a name="idp75419336"></a><h2>例</h2><pre class="programlisting">SELECT ST_Distance(geom, 'SRID=3005;POINT(1011102 450541)'::geometry) as d,edabbr, vaabbr
FROM va2005
ORDER BY d limit 10;

        d         | edabbr | vaabbr
------------------+--------+--------
                0 | ALQ    | 128
 5541.57712511724 | ALQ    | 129A
 5579.67450712005 | ALQ    | 001
  6083.4207708641 | ALQ    | 131
  7691.2205404848 | ALQ    | 003
 7900.75451037313 | ALQ    | 122
 8694.20710669982 | ALQ    | 129B
 9564.24289057111 | ALQ    | 130
  12089.665931705 | ALQ    | 127
 18472.5531479404 | ALQ    | 002
(10 rows)
</pre><p>KNNの生の答は次のとおりです。 </p><pre class="programlisting">SELECT st_distance(geom, 'SRID=3005;POINT(1011102 450541)'::geometry) as d,edabbr, vaabbr
FROM va2005
ORDER BY geom &lt;-&gt; 'SRID=3005;POINT(1011102 450541)'::geometry limit 10;

        d         | edabbr | vaabbr
------------------+--------+--------
                0 | ALQ    | 128
 5541.57712511724 | ALQ    | 129A
 5579.67450712005 | ALQ    | 001
  6083.4207708641 | ALQ    | 131
  7691.2205404848 | ALQ    | 003
 7900.75451037313 | ALQ    | 122
 8694.20710669982 | ALQ    | 129B
 9564.24289057111 | ALQ    | 130
  12089.665931705 | ALQ    | 127
 18472.5531479404 | ALQ    | 002
(10 rows)
</pre><p>二つのクエリで"EXPLAIN ANALYZE"を実行すると、二つ目で速度が改善したことが分かります。 </p><p>PostgreSQL 9.5未満では、実際の近傍を発見するために、ハイブリッドのクエリを使います。最初にインデクスを用いたKNNを使って共通テーブル式 (CTE)クエリを行い、正しい順序を得る確実なクエリを実行します。 </p><pre class="programlisting">WITH index_query AS (
  SELECT ST_Distance(geom, 'SRID=3005;POINT(1011102 450541)'::geometry) as d,edabbr, vaabbr
        FROM va2005
  ORDER BY geom &lt;-&gt; 'SRID=3005;POINT(1011102 450541)'::geometry LIMIT 100)
  SELECT *
        FROM index_query
  ORDER BY d limit 10;

        d         | edabbr | vaabbr
------------------+--------+--------
                0 | ALQ    | 128
 5541.57712511724 | ALQ    | 129A
 5579.67450712005 | ALQ    | 001
  6083.4207708641 | ALQ    | 131
  7691.2205404848 | ALQ    | 003
 7900.75451037313 | ALQ    | 122
 8694.20710669982 | ALQ    | 129B
 9564.24289057111 | ALQ    | 130
  12089.665931705 | ALQ    | 127
 18472.5531479404 | ALQ    | 002
(10 rows)

                        </pre></div><div class="refsection"><a name="idp75422920"></a><h2>関連情報</h2><p><a class="xref" href="#ST_DWithin" title="ST_DWithin">ST_DWithin</a>, <a class="xref" href="#ST_Distance" title="ST_Distance">ST_Distance</a>, <a class="xref" href="#geometry_distance_box" title="&lt;#&gt;">&lt;#&gt;</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="geometry_distance_cpa"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>|=| — AトラジェクトリとBトラジェクトリとの最接近する時の距離を返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">double precision <b class="fsfunc">|=|</b>(</code> geometry  <var class="pdparam">A</var> ,  geometry  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp75451464"></a><h2>説明</h2><p><code class="varname">|=|</code>演算子は二つのトラジェクトリの3次元距離を返します (<a class="xref" href="#ST_IsValidTrajectory" title="ST_IsValidTrajectory">ST_IsValidTrajectory</a>を参照して下さい)。これは、<a class="xref" href="#ST_DistanceCPA" title="ST_DistanceCPA">ST_DistanceCPA</a>と同じですが、N次元インデクスを使った近傍探索 (PostgreSQL 9.5.0以上)で使われる演算子です。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この演算子は、ジオメトリで使用可能なND GiST (n次元GiST)インデクスを使用します。他の空間インデクスを使う演算子と違い、ORDER BY句でのみ空間インデクスを使います。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ジオメトリのひとつが定数となる (副問い合わせ/共通テーブル式にない)場合 (a.geomでなく'SRID=3005;LINESTRINGM(0 0 0,0 0 1)'::geometry等となる場合)には、インデクスが有効になるだけです。</p></td></tr></table></div><p>Availability:: 2.2.0 インデクス対応はPostgreSQL 9.5以上でのみ有効です。</p></div><div class="refsection"><a name="idp75455176"></a><h2>例</h2><pre class="programlisting">-- psql変数にリテラルクエリのトラジェクトリを保存
\set qt 'ST_AddMeasure(ST_MakeLine(ST_MakePointM(-350,300,0),ST_MakePointM(-410,490,0)),10,20)'
-- クエリを実行
SELECT track_id, dist FROM (
  SELECT track_id, ST_DistanceCPA(tr,:qt) dist
  FROM trajectories
  ORDER BY tr |=| :qt
  LIMIT 5
) foo;
 track_id        dist
----------+-------------------
      395 | 0.576496831518066
      380 |  5.06797130410151
      390 |  7.72262293958322
      385 |   9.8004461358071
      405 |  10.9534397988433
(5 rows)
</pre></div><div class="refsection"><a name="idp75456456"></a><h2>関連情報</h2><p><a class="xref" href="#ST_DistanceCPA" title="ST_DistanceCPA">ST_DistanceCPA</a>, <a class="xref" href="#ST_ClosestPointOfApproach" title="ST_ClosestPointOfApproach">ST_ClosestPointOfApproach</a>, <a class="xref" href="#ST_IsValidTrajectory" title="ST_IsValidTrajectory">ST_IsValidTrajectory</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="geometry_distance_box"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>&lt;#&gt; — AのバウンディングボックスとBのバウンディングボックスの2次元距離を返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">double precision <b class="fsfunc">&lt;#&gt;</b>(</code> geometry  <var class="pdparam">A</var> ,  geometry  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp75464648"></a><h2>説明</h2><p><code class="varname">&lt;#&gt;</code>演算子は二つの浮動小数点数によるバウンディングボックス間の距離を返します。可能なら空間インデクス (PostgreSQL 9.1以上が必要です)を読みます。近傍の<span class="strong"><strong>概ねの</strong></span>距離による並び替えに使います。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これのオペランドはジオメトリで利用できるインデクスを使用します。他の演算子との相違点は、ORDER BY句でのみインデクスが使用される点です。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ジオメトリのひとつがg1.geom &lt;#&gt;と違って ORDER BY (ST_GeomFromText('POINT(1 2)') &lt;#&gt; geom)というように定数である場合には、インデクスが有効になるだけです。</p></td></tr></table></div><p>Availability: 2.0.0 PostgreSQL 9.1以上でのみ有効です。</p></div><div class="refsection"><a name="idp75467976"></a><h2>例</h2><pre class="programlisting">SELECT *
FROM (
SELECT b.tlid, b.mtfcc,
        b.geom &lt;#
&gt; ST_GeomFromText('LINESTRING(746149 2948672,745954 2948576,
                745787 2948499,745740 2948468,745712 2948438,
                745690 2948384,745677 2948319)',2249) As b_dist,
                ST_Distance(b.geom, ST_GeomFromText('LINESTRING(746149 2948672,745954 2948576,
                745787 2948499,745740 2948468,745712 2948438,
                745690 2948384,745677 2948319)',2249)) As act_dist
    FROM bos_roads As b
    ORDER BY b_dist, b.tlid
    LIMIT 100) As foo
    ORDER BY act_dist, tlid LIMIT 10;

   tlid    | mtfcc |      b_dist      |     act_dist
-----------+-------+------------------+------------------
  85732027 | S1400 |                0 |                0
  85732029 | S1400 |                0 |                0
  85732031 | S1400 |                0 |                0
  85734335 | S1400 |                0 |                0
  85736037 | S1400 |                0 |                0
 624683742 | S1400 |                0 | 128.528874268666
  85719343 | S1400 | 260.839270432962 | 260.839270432962
  85741826 | S1400 | 164.759294123275 | 260.839270432962
  85732032 | S1400 |           277.75 | 311.830282365264
  85735592 | S1400 |           222.25 | 311.830282365264
(10 rows)
</pre></div><div class="refsection"><a name="idp75469256"></a><h2>関連情報</h2><p><a class="xref" href="#ST_DWithin" title="ST_DWithin">ST_DWithin</a>, <a class="xref" href="#ST_Distance" title="ST_Distance">ST_Distance</a>, <a class="xref" href="#geometry_distance_knn" title="&lt;-&gt;">&lt;-&gt;</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="geometry_distance_centroid_nd"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>&lt;&lt;-&gt;&gt; — AのバウンディングボックスとBのバウンディングボックスのn次元距離を返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">double precision <b class="fsfunc">&lt;&lt;-&gt;&gt;</b>(</code> geometry  <var class="pdparam">A</var> ,  geometry  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp75501896"></a><h2>説明</h2><p><code class="varname">&lt;&lt;-&gt;&gt;</code>演算子は、二つのジオメトリのバウンディングボックスの重心のn次元 (ユークリッド)距離を返します。近傍の<span class="strong"><strong>概ねの</strong></span>距離による並び替えに使います。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これのオペランドはジオメトリで利用できるインデクスを使用します。他の演算子との相違点は、ORDER BY句でのみインデクスが使用される点です。 </p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ジオメトリのひとつが定数となる (副問い合わせ/共通テーブル式にない)場合 (a.geomでなく'SRID=3005;POINT(1011102 450541)'::geometry等となる場合)には、インデクスが有効になるだけです。 </p></td></tr></table></div><p>Availability: 2.0.0 KNNはPostgreSQL 9.1以上でのみ有効です。</p></div><div class="refsection"><a name="idp75505224"></a><h2>関連情報</h2><p><a class="xref" href="#geometry_distance_box_nd" title="&lt;&lt;#&gt;&gt;">&lt;&lt;#&gt;&gt;</a>, <a class="xref" href="#geometry_distance_knn" title="&lt;-&gt;">&lt;-&gt;</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="geometry_distance_box_nd"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>&lt;&lt;#&gt;&gt; — AのバウンディングボックスとBのバウンディングボックスのn次元距離を返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">double precision <b class="fsfunc">&lt;&lt;#&gt;&gt;</b>(</code> geometry  <var class="pdparam">A</var> ,  geometry  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp75513032"></a><h2>説明</h2><p><code class="varname">&lt;&lt;#&gt;&gt;</code>演算子は二つの浮動小数点数バウンディングボックスの距離を返します。可能なら空間インデクス  (PostgreSQL 9.1以上が必要です)を読みます。近傍の<span class="strong"><strong>概ねの</strong></span>距離による並び替えに使います。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これのオペランドはジオメトリで利用できるインデクスを使用します。他の演算子との相違点は、ORDER BY句でのみインデクスが使用される点です。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ジオメトリの一つがg1.geom &lt;&lt;#&gt;&gt;.と違ってORDER BY (ST_GeomFromText('POINT(1 2)') &lt;&lt;#&gt;&gt; geom)といった定数である場合には、インデクスが有効になるだけです。 </p></td></tr></table></div><p>Availability: 2.0.0 KNNはPostgreSQL 9.1以上でのみ有効です。</p></div><div class="refsection"><a name="idp75516360"></a><h2>関連情報</h2><p><a class="xref" href="#geometry_distance_centroid_nd" title="&lt;&lt;-&gt;&gt;">&lt;&lt;-&gt;&gt;</a>, <a class="xref" href="#geometry_distance_box" title="&lt;#&gt;">&lt;#&gt;</a> </p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Spatial_Relationships_Measurements"></a>8.9. 空間関係関数と空間計測関数 </h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#ST_3DClosestPoint">ST_3DClosestPoint</a></span><span class="refpurpose"> — g1上の、g2に最も近い3次元ポイントを返します。3次元最短線の一つ目のポイントです。 </span></dt><dt><span class="refentrytitle"><a href="#ST_3DDistance">ST_3DDistance</a></span><span class="refpurpose"> — ジオメトリ型について、二つのジオメトリの、3次元の最小デカルト距離 (空間参照系に基づきます)を、投影法の単位で返します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_3DDWithin">ST_3DDWithin</a></span><span class="refpurpose"> — 3次元 (XYZ)ジオメトリ型について、二つのジオメトリの3次元距離が指定した数の内にある場合にtrueを返します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_3DDFullyWithin">ST_3DDFullyWithin</a></span><span class="refpurpose"> — 3次元ジオメトリが他のジオメトリとの距離が指定した範囲内ならtrueを返します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_3DIntersects">ST_3DIntersects</a></span><span class="refpurpose"> — ジオメトリが3次元で「空間的にインタセクトする」場合にTRUEを返します。ポイント、ラインストリング、ポリゴン、多面体サーフェス (面)のみ対応します。SFCGALバックエンドによってTINも対応します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_3DLongestLine">ST_3DLongestLine</a></span><span class="refpurpose"> — 二つのジオメトリの3次元長が最長となるラインを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_3DMaxDistance">ST_3DMaxDistance</a></span><span class="refpurpose"> — ジオメトリ型について、二つのジオメトリの、3次元の最大デカルト距離 (空間参照系に基づきます)を、投影法の単位で返します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_3DShortestLine">ST_3DShortestLine</a></span><span class="refpurpose"> — 二つのジオメトリの3次元長が最短となるラインを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Area">ST_Area</a></span><span class="refpurpose"> — ポリゴンまたはマルチポリゴンの場合にはサーフェスの面積を返します。ジオメトリ型の面積はSRIDに基づく単位です。ジオグラフィ型の面積は曲面上で計算され、単位は平方メートルです。</span></dt><dt><span class="refentrytitle"><a href="#ST_Azimuth">ST_Azimuth</a></span><span class="refpurpose"> — pointAの鉛直線からPointBへの右回りの方位を北を基準にしたラジアン単位で返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Angle">ST_Angle</a></span><span class="refpurpose"> — 三つのポイントまたは二つのベクタ (4ポイントまたは2ライン)の間の角度を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Centroid">ST_Centroid</a></span><span class="refpurpose"> — ジオメトリの幾何学的重心を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_ClosestPoint">ST_ClosestPoint</a></span><span class="refpurpose"> — g2に最も接近するg1上の2次元のポイントを返します。これは最短線の最初のポイントです。</span></dt><dt><span class="refentrytitle"><a href="#ST_ClusterDBSCAN">ST_ClusterDBSCAN</a></span><span class="refpurpose"> — DBSCAN (ノイズ適用可能な密度に基づいた空間クラスタリング)アルゴリズムの2次元実装に基づいて、それぞれの入力ジオメトリが入るクラスタの整数識別子を返すウィンドウ関数です。</span></dt><dt><span class="refentrytitle"><a href="#ST_ClusterIntersecting">ST_ClusterIntersecting</a></span><span class="refpurpose"> — 集約関数です。ジオメトリの集合の接続された要素の配列を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_ClusterKMeans">ST_ClusterKMeans</a></span><span class="refpurpose"> — 個々のジオメトリが入るクラスタの整数識別子を返すウィンドウ関数です。</span></dt><dt><span class="refentrytitle"><a href="#ST_ClusterWithin">ST_ClusterWithin</a></span><span class="refpurpose"> — 集計関数です。ジオメトリコレクションの配列を返します。要素は、指定した距離以内となるよう分けられたジオメトリの集合です。</span></dt><dt><span class="refentrytitle"><a href="#ST_Contains">ST_Contains</a></span><span class="refpurpose"> — Bの点がAの外部に無く、かつBの内部の少なくとも一つの点がAの内部にある場合に限って、TRUEを返します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_ContainsProperly">ST_ContainsProperly</a></span><span class="refpurpose"> — BがAの内部にインタセクトするが境界 (または外部)にインタセクトしない場合に、TRUEを返します。Aは自身には、ContainsProperlyではありませんが、Containsです。</span></dt><dt><span class="refentrytitle"><a href="#ST_Covers">ST_Covers</a></span><span class="refpurpose"> — ジオメトリBにジオメトリAの外となるポイントが無い場合には、1 (TRUE)を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_CoveredBy">ST_CoveredBy</a></span><span class="refpurpose"> — ジオメトリ/ジオグラフィAの点がジオメトリ/ジオグラフィBの外に無い場合に、1 (TRUE)を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Crosses">ST_Crosses</a></span><span class="refpurpose"> — 与えられたジオメトリが共通の内部の点を持ち、かつそうでない点を持つ場合に、<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_LineCrossingDirection">ST_LineCrossingDirection</a></span><span class="refpurpose"> — 与えられた二つのラインストリングに関するクロスの種類を-3から3の区間の数で返します。0の場合はクロスしていません</span></dt><dt><span class="refentrytitle"><a href="#ST_Disjoint">ST_Disjoint</a></span><span class="refpurpose"> — ジオメトリが「空間的にインタセクトし」ていない、すなわち、空間を共有していない場合に、TRUEを返します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_Distance">ST_Distance</a></span><span class="refpurpose"> — ジオメトリ型については、二つのジオメトリの、2次元の最小デカルト距離 (空間参照系に基づきます)を、投影法の単位で返します。ジオグラフィ型については、デフォルトでは、二つのジオメトリ間の測地距離をメートル単位で返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_MinimumClearance">ST_MinimumClearance</a></span><span class="refpurpose"> — ジオメトリのクリアランスの最小値を返します。この値はジオメトリのロバスト性を示すものです。</span></dt><dt><span class="refentrytitle"><a href="#ST_MinimumClearanceLine">ST_MinimumClearanceLine</a></span><span class="refpurpose"> — ジオメトリの最小クリアランスを示す、2点のラインストリングを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_HausdorffDistance">ST_HausdorffDistance</a></span><span class="refpurpose"> — 二つのジオメトリ間のハウスドルフ距離を返します。基本的にジオメトリが似ているかどうかを計測するものです。単位はジオメトリの空間参照系の単位です。</span></dt><dt><span class="refentrytitle"><a href="#ST_FrechetDistance">ST_FrechetDistance</a></span><span class="refpurpose"> — 二つのジオメトリのフレシェ距離を返します。曲線の位置と点の並び順とを考慮に入れた曲線間の類似度を計測するものです。単位はジオメトリの空間参照系の単位です。</span></dt><dt><span class="refentrytitle"><a href="#ST_MaxDistance">ST_MaxDistance</a></span><span class="refpurpose"> — 二つのジオメトリ間の2次元距離の最大値を、投影法の単位で返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_DistanceSphere">ST_DistanceSphere</a></span><span class="refpurpose"> — 二つの経度緯度ジオメトリの間の最短距離をメートル単位で返します。SRIDで定義された回転楕円体に由来する半径となる球面を使います。ST_DistanceSpheroidより高速ですが、精度が悪くなります。PostGISの1.5より前の版ではポイント間の計測のみ実装していました。</span></dt><dt><span class="refentrytitle"><a href="#ST_Distance_Spheroid">ST_DistanceSpheroid</a></span><span class="refpurpose"> — 指定した回転楕円体による、二つの経度緯度ジオメトリ間の最小距離を返します。PostGIS 1.5より前ではポイント間の計測のみ対応していました。</span></dt><dt><span class="refentrytitle"><a href="#ST_DFullyWithin">ST_DFullyWithin</a></span><span class="refpurpose"> — 全てのジオメトリが指定したジオメトリから指定した距離内にある場合にTRUEを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_DWithin">ST_DWithin</a></span><span class="refpurpose"> — ジオメトリが指定したジオメトリから指定した距離内にある場合にTRUEを返します。ジオメトリについては、距離は空間参照系で定義されている単位になります。ジオグラフィについては、メートル単位で、デフォルトではuse_spheroid=true (回転楕円体を使った計算)となり、速いチェックをするにはuse_spheroid=falseとして球面を使って計算します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Equals">ST_Equals</a></span><span class="refpurpose"> — 与えられたジオメトリ表現が同じ場合にTRUEを返します。方向は無視されます。</span></dt><dt><span class="refentrytitle"><a href="#ST_GeometricMedian">ST_GeometricMedian </a></span><span class="refpurpose"> — マルチポイントの幾何学的中央値を返します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_HasArc">ST_HasArc</a></span><span class="refpurpose"> — ジオメトリまたはジオメトリコレクションが曲線ストリングを含む場合にTRUEを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Intersects">ST_Intersects</a></span><span class="refpurpose"> — ジオメトリ/ジオグラフィが「2次元空間で空間的にインタセクトする」 (空間に共有部分がある)場合にTRUEを返します。そうでない (非接続)場合はFALSEを返します。ジオグラフィについては、許容量は0.00001メートルです (近い点はインタセクトと考えられてしまいます)。 </span></dt><dt><span class="refentrytitle"><a href="#ST_Length">ST_Length</a></span><span class="refpurpose"> — ジオメトリがLINESTRINGまたはMULTILINESTRINGの場合には、それらの2次元長を返します。ジオメトリでは、単位は空間参照系の単位です。ジオグラフィでは、メートル単位です (回転楕円体がデフォルトです)。</span></dt><dt><span class="refentrytitle"><a href="#ST_Length2D">ST_Length2D</a></span><span class="refpurpose"> — LINESTRINGまたはMULTILINESTRINGに対して、ジオメトリの2次元長を返します。これは<code class="varname">ST_Length</code>の別名です。</span></dt><dt><span class="refentrytitle"><a href="#ST_3DLength">ST_3DLength</a></span><span class="refpurpose"> — LINESTRINGまたはMULTILINESTRINGに対して、ジオメトリの3次元長または2次元長を返します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_Length_Spheroid">ST_LengthSpheroid</a></span><span class="refpurpose"> — 回転楕円体上のジオメトリの2次元長/周囲長または3次元長/周囲長を計算します。これは、ジオメトリの座標が経度/緯度になっていて、投影変換を行わずに距離を求めたい場合に使います。</span></dt><dt><span class="refentrytitle"><a href="#ST_Length2D_Spheroid">ST_Length2D_Spheroid</a></span><span class="refpurpose"> — 回転楕円体上のジオメトリの2次元長/周囲長を計算します。これは、ジオメトリの座標が経度/緯度になっていて、投影変換を行わずに距離を求めたい場合に使います。 </span></dt><dt><span class="refentrytitle"><a href="#ST_LongestLine">ST_LongestLine</a></span><span class="refpurpose"> — 二つのジオメトリの2次元長が最長となるラインを返します。見つかったラインが複数ある場合は、最初のもののみ返します。返されるラインは常にg1側を始点、g2側を終点とします。この関数が返すラインの長さは、常に始点をg1に終点をg2にそれぞれ指定した場合のST_MaxDistanceが返す値と同じになります。</span></dt><dt><span class="refentrytitle"><a href="#ST_OrderingEquals">ST_OrderingEquals</a></span><span class="refpurpose"> — 与えられたジオメトリが同じジオメトリを示し、ポイントの順序が同じである場合にTRUEを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Overlaps">ST_Overlaps</a></span><span class="refpurpose"> — ジオメトリが共有空間を持ち、同じ次元で、かつ完全には一方に含まれていない場合にTRUEを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Perimeter">ST_Perimeter</a></span><span class="refpurpose"> — ST_SrrfaceまたはST_MultiSurface (POLYGONまたはMULTIPOLYGON)の境界の長さの計測値を返します。ジオメトリでは単位は空間参照系によります。ジオグラフィではメートル単位になります。</span></dt><dt><span class="refentrytitle"><a href="#ST_Perimeter2D">ST_Perimeter2D</a></span><span class="refpurpose"> — POLYGONまたはMULTIPOLYGONジオメトリの場合に、2次元周囲長を返します。これは、現在はST_Perimeterの別名です。</span></dt><dt><span class="refentrytitle"><a href="#ST_3DPerimeter">ST_3DPerimeter</a></span><span class="refpurpose"> — POLYGONまたはMULTIPOLYGONジオメトリの場合には、3次元周囲長を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_PointOnSurface">ST_PointOnSurface</a></span><span class="refpurpose"> — サーフェス上にあることを保障された<code class="varname">POINT</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Project">ST_Project</a></span><span class="refpurpose"> — メートル単位の距離とラジアン単位の方位とを使って始点から算出された<code class="varname">POINT</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Relate">ST_Relate</a></span><span class="refpurpose"> — intersectionMatrixPatternの値について、二つのジオメトリの内部、境界、外部のインタセクションを見て、指定したジオメトリがもうひとつのジオメトリと空間的に関係している場合に、TRUEを返します。intersectionMatrixPatternが無い場合には、二つのジオメトリについての最大のintersectionMatrixPatternを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_RelateMatch">ST_RelateMatch</a></span><span class="refpurpose"> — intersectionMattrixPattern1がintersectionMatrixPattern2を含む場合にTRUEを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_ShortestLine">ST_ShortestLine</a></span><span class="refpurpose"> — 二つのジオメトリの2次元長が最短となるラインを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Touches">ST_Touches</a></span><span class="refpurpose"> — ジオメトリが共通のポイントを少なくとも一つ持ち、かつ内部でインタセクトしない場合に、<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Within">ST_Within</a></span><span class="refpurpose"> — ジオメトリAが完全にジオメトリBの内側にある場合にTRUEを返します。</span></dt></dl></div><div class="refentry"><a name="ST_3DClosestPoint"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_3DClosestPoint — g1上の、g2に最も近い3次元ポイントを返します。3次元最短線の一つ目のポイントです。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_3DClosestPoint</b>(</code>geometry  <var class="pdparam">g1</var>, geometry  <var class="pdparam">g2</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp76071880"></a><h2>説明</h2><p>g1上の、g2に最も近い3次元ポイントを返します。3次元最短線の一つ目のポイントです。3次元最短線の長さは、3次元距離と同じです。 </p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p>Availability: 2.0.0</p><p>Changed: 2.2.0 - 二つの2次元ジオメトリが入力である場合には、2次元ポイントが返ります (古い挙動では、存在しないZの値について0を仮定していました)。2次元と3次元の場合には、もはや、存在しないZの値について0を仮定しません。</p></div><div class="refsection"><a name="idp76076872"></a><h2>例</h2><div class="informaltable"><table class="informaltable" border="1"><colgroup><col></colgroup><tbody><tr><td><p>ラインストリングとポイント -- 3次元と2次元の両方の最も近いポイント </p><pre class="programlisting">SELECT ST_AsEWKT(ST_3DClosestPoint(line,pt)) AS cp3d_line_pt,
                ST_AsEWKT(ST_ClosestPoint(line,pt)) As cp2d_line_pt
        FROM (SELECT 'POINT(100 100 30)'::geometry As pt,
                        'LINESTRING (20 80 20, 98 190 1, 110 180 3, 50 75 1000)'::geometry As line
                ) As foo;


 cp3d_line_pt                                                |               cp2d_line_pt
-----------------------------------------------------------+------------------------------------------
 POINT(54.6993798867619 128.935022917228 11.5475869506606) | POINT(73.0769230769231 115.384615384615)
                                        </pre><p>
							  </p></td></tr><tr><td><p>ラインストリングとマルチポイント -- 3次元と2次元の両方の最も近いポイント </p><pre class="programlisting">SELECT ST_AsEWKT(ST_3DClosestPoint(line,pt)) AS cp3d_line_pt,
                ST_AsEWKT(ST_ClosestPoint(line,pt)) As cp2d_line_pt
        FROM (SELECT 'MULTIPOINT(100 100 30, 50 74 1000)'::geometry As pt,
                        'LINESTRING (20 80 20, 98 190 1, 110 180 3, 50 75 900)'::geometry As line
                ) As foo;


                       cp3d_line_pt                        | cp2d_line_pt
-----------------------------------------------------------+--------------
 POINT(54.6993798867619 128.935022917228 11.5475869506606) | POINT(50 75)
                                        </pre><p>
							  </p></td></tr><tr><td><p>マルチラインストリングとポリゴン -- 3次元と2次元の両方の最も近いポイント </p><pre class="programlisting">SELECT ST_AsEWKT(ST_3DClosestPoint(poly, mline)) As cp3d,
    ST_AsEWKT(ST_ClosestPoint(poly, mline)) As cp2d
        FROM (SELECT  ST_GeomFromEWKT('POLYGON((175 150 5, 20 40 5, 35 45 5, 50 60 5, 100 100 5, 175 150 5))') As poly,
                ST_GeomFromEWKT('MULTILINESTRING((175 155 2, 20 40 20, 50 60 -2, 125 100 1, 175 155 1),
                (1 10 2, 5 20 1))') As mline ) As foo;
                   cp3d                    |     cp2d
-------------------------------------------+--------------
 POINT(39.993580415989 54.1889925532825 5) | POINT(20 40)
             </pre><p>
							  </p></td></tr></tbody></table></div></div><div class="refsection"><a name="idp76083144"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a>, <a class="xref" href="#ST_ClosestPoint" title="ST_ClosestPoint">ST_ClosestPoint</a>, <a class="xref" href="#ST_3DDistance" title="ST_3DDistance">ST_3DDistance</a>, <a class="xref" href="#ST_3DShortestLine" title="ST_3DShortestLine">ST_3DShortestLine</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_3DDistance"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_3DDistance — ジオメトリ型について、二つのジオメトリの、3次元の最小デカルト距離 (空間参照系に基づきます)を、投影法の単位で返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_3DDistance</b>(</code>geometry  <var class="pdparam">g1</var>, geometry  <var class="pdparam">g2</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp76091080"></a><h2>説明</h2><p>ジオメトリ型について、二つのジオメトリの、3次元の最小デカルト距離 (空間参照系に基づきます)を、投影法の単位で返します。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM ?</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method is also provided by SFCGAL backend.</p><p>Availability: 2.0.0</p><p>Changed: 2.2.0 - 2次元と3次元の場合には、もはや、存在しないZの値について0を仮定しません。</p></div><div class="refsection"><a name="idp76153288"></a><h2>例</h2><pre class="programlisting">-- ジオメトリの例 - メートル単位(SRID: 2163 米国ナショナルアトラス正積図法)
-- (3次元ポイントとラインの距離と、2次元ポイントとラインの距離とを比較)
-- ご注意: 現在は垂直データムに対応していないので、
-- Zは変換されずに、最終的に同じであると仮定されます。
SELECT ST_3DDistance(
                        ST_Transform(ST_GeomFromEWKT('SRID=4326;POINT(-72.1235 42.3521 4)'),2163),
                        ST_Transform(ST_GeomFromEWKT('SRID=4326;LINESTRING(-72.1260 42.45 15, -72.123 42.1546 20)'),2163)
                ) As dist_3d,
                ST_Distance(
                        ST_Transform(ST_GeomFromText('POINT(-72.1235 42.3521)',4326),2163),
                        ST_Transform(ST_GeomFromText('LINESTRING(-72.1260 42.45, -72.123 42.1546)', 4326),2163)
                ) As dist_2d;

     dist_3d      |     dist_2d
------------------+-----------------
 127.295059324629 | 126.66425605671
</pre><pre class="programlisting">-- MultiLineStringとPolygonの、3次元距離と2次元距離
-- 3次元の最接近点を求める例と同じ例です
SELECT ST_3DDistance(poly, mline) As dist3d,
    ST_Distance(poly, mline) As dist2d
        FROM (SELECT  ST_GeomFromEWKT('POLYGON((175 150 5, 20 40 5, 35 45 5, 50 60 5, 100 100 5, 175 150 5))') As poly,
                ST_GeomFromEWKT('MULTILINESTRING((175 155 2, 20 40 20, 50 60 -2, 125 100 1, 175 155 1),
                (1 10 2, 5 20 1))') As mline ) As foo;
      dist3d       | dist2d
-------------------+--------
 0.716635696066337 |      0
</pre></div><div class="refsection"><a name="idp76155080"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Distance" title="ST_Distance">ST_Distance</a>, <a class="xref" href="#ST_3DClosestPoint" title="ST_3DClosestPoint">ST_3DClosestPoint</a>, <a class="xref" href="#ST_3DDWithin" title="ST_3DDWithin">ST_3DDWithin</a>, <a class="xref" href="#ST_3DMaxDistance" title="ST_3DMaxDistance">ST_3DMaxDistance</a>, <a class="xref" href="#ST_3DShortestLine" title="ST_3DShortestLine">ST_3DShortestLine</a>, <a class="xref" href="#ST_Transform" title="ST_Transform">ST_Transform</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_3DDWithin"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_3DDWithin — 3次元 (XYZ)ジオメトリ型について、二つのジオメトリの3次元距離が指定した数の内にある場合にtrueを返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_3DDWithin</b>(</code>geometry  <var class="pdparam">g1</var>, geometry  <var class="pdparam">g2</var>, double precision  <var class="pdparam">distance_of_srid</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp76168904"></a><h2>説明</h2><p>ジオメトリ型について、二つのオブジェクト間の距離が、投影法の単位 (空間参照系の単位)でdistance_of_srid内にある場合にtrueを返します。 </p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM ?</p><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp76174920"></a><h2>例</h2><pre class="programlisting">-- ジオメトリの例 - メートル単位(SRID: 2163 米国ナショナルアトラス正積図法)
-- (3次元ポイントとラインの距離と、2次元ポイントとラインの距離とを比較)
-- ご注意: 現在は垂直データムに対応していないので、
-- Zは変換されずに、最終的に同じであると仮定されます。
SELECT ST_3DDWithin(
                        ST_Transform(ST_GeomFromEWKT('SRID=4326;POINT(-72.1235 42.3521 4)'),2163),
                        ST_Transform(ST_GeomFromEWKT('SRID=4326;LINESTRING(-72.1260 42.45 15, -72.123 42.1546 20)'),2163),
                        126.8
                ) As within_dist_3d,
ST_DWithin(
                        ST_Transform(ST_GeomFromEWKT('SRID=4326;POINT(-72.1235 42.3521 4)'),2163),
                        ST_Transform(ST_GeomFromEWKT('SRID=4326;LINESTRING(-72.1260 42.45 15, -72.123 42.1546 20)'),2163),
                        126.8
                ) As within_dist_2d;

 within_dist_3d | within_dist_2d
----------------+----------------
 f              | t
</pre></div><div class="refsection"><a name="idp76176200"></a><h2>関連情報</h2><p><a class="xref" href="#ST_3DDistance" title="ST_3DDistance">ST_3DDistance</a>, <a class="xref" href="#ST_Distance" title="ST_Distance">ST_Distance</a>, <a class="xref" href="#ST_DWithin" title="ST_DWithin">ST_DWithin</a>, <a class="xref" href="#ST_3DMaxDistance" title="ST_3DMaxDistance">ST_3DMaxDistance</a>, <a class="xref" href="#ST_Transform" title="ST_Transform">ST_Transform</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_3DDFullyWithin"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_3DDFullyWithin — 3次元ジオメトリが他のジオメトリとの距離が指定した範囲内ならtrueを返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_3DDFullyWithin</b>(</code>geometry  <var class="pdparam">g1</var>, geometry  <var class="pdparam">g2</var>, double precision  <var class="pdparam">distance</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp76185544"></a><h2>説明</h2><p>3次元ジオメトリが他のジオメトリとの距離が、完全に指定した範囲内ならtrueを返します。距離の単位はジオメトリの空間参照系で定義されているものとされます。この関数が意味を持つためには、与えられるジオメトリは両方とも同じ座標系で同じSRIDを持つ必要があります。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数の呼び出しによって、ジオメトリで使用可能なインデクスを使用したバウンディングボックスの比較が自動的に行われます。</p></td></tr></table></div><p>Availability: 2.0.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p></div><div class="refsection"><a name="idp76190920"></a><h2>例</h2><pre class="programlisting">-- 完全に中に入るかどうか (ST_3DDFullyWithin)と、
-- 中に入るかどうか (ST_3DDWithin)との比較を示します。
-- また、
-- ライン/ポイントを2次元にした場合に完全に中に入るかどうか (ST_DFullyWithin)と、
-- 3次元長のままで完全に中に入るかどうか (ST_3DDFullyWithin)との比較も
-- 示します。
                SELECT ST_3DDFullyWithin(geom_a, geom_b, 10) as D3DFullyWithin10, ST_3DDWithin(geom_a, geom_b, 10) as D3DWithin10,
        ST_DFullyWithin(geom_a, geom_b, 20) as D2DFullyWithin20,
        ST_3DDFullyWithin(geom_a, geom_b, 20) as D3DFullyWithin20 from
                (select ST_GeomFromEWKT('POINT(1 1 2)') as geom_a,
                ST_GeomFromEWKT('LINESTRING(1 5 2, 2 7 20, 1 9 100, 14 12 3)') as geom_b) t1;
 d3dfullywithin10 | d3dwithin10 | d2dfullywithin20 | d3dfullywithin20
------------------+-------------+------------------+------------------
 f                | t           | t                | f </pre></div><div class="refsection"><a name="idp76192200"></a><h2>関連情報</h2><p><a class="xref" href="#ST_3DMaxDistance" title="ST_3DMaxDistance">ST_3DMaxDistance</a>, <a class="xref" href="#ST_3DDWithin" title="ST_3DDWithin">ST_3DDWithin</a>, <a class="xref" href="#ST_DWithin" title="ST_DWithin">ST_DWithin</a>, <a class="xref" href="#ST_DFullyWithin" title="ST_DFullyWithin">ST_DFullyWithin</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_3DIntersects"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_3DIntersects — ジオメトリが3次元で「空間的にインタセクトする」場合にTRUEを返します。ポイント、ラインストリング、ポリゴン、多面体サーフェス (面)のみ対応します。SFCGALバックエンドによってTINも対応します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_3DIntersects</b>(</code> geometry <var class="pdparam">geomA</var> ,  geometry <var class="pdparam">geomB</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp76204744"></a><h2>説明</h2><p>オーバラップ、接触、包含は全て、ジオメトリがインタセクトしていることを意味しています。これらがTRUEを返す場合は、空間的にインタセクトしています。非接続は、空間インタセクトについてFALSEとなります。</p><p>Availability: 2.0.0</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数の呼び出しによって、ジオメトリで使用可能なインデクスを使用したバウンディングボックスの比較が自動的に行われます。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>TIN対応の利点を得るには、SFCGALバックエンドを有効にしなければなりません。セッション時に有効にするには<code class="code">set postgis.backend = sfcgal;</code>とします。データベースレベルまたはシステムレベルで有効になるならセッション時に有効です。データベースレベルで有効にするには<code class="code">ALTER DATABASE gisdb SET postgis.backend = sfcgal;</code>とします。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method is also provided by SFCGAL backend.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: ?</p></div><div class="refsection"><a name="idp76227912"></a><h2>ジオメトリの例</h2><pre class="programlisting">SELECT ST_3DIntersects(pt, line), ST_Intersects(pt,line)
        FROM (SELECT 'POINT(0 0 2)'::geometry As pt,
                'LINESTRING (0 0 1, 0 2 3 )'::geometry As line) As foo;
 st_3dintersects | st_intersects
-----------------+---------------
 f               | t
(1 row)
                </pre></div><div class="refsection"><a name="idp76229192"></a><h2>TINの例</h2><pre class="programlisting">set postgis.backend = sfcgal;
SELECT ST_3DIntersects('TIN(((0 0,1 0,0 1,0 0)))'::geometry, 'POINT(.1 .1)'::geometry);
 st_3dintersects
-----------------
 t</pre></div><div class="refsection"><a name="idp76230216"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Intersects" title="ST_Intersects">ST_Intersects</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_3DLongestLine"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_3DLongestLine — 二つのジオメトリの3次元長が最長となるラインを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_3DLongestLine</b>(</code>geometry  <var class="pdparam">g1</var>, geometry  <var class="pdparam">g2</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp76237000"></a><h2>説明</h2><p>二つのジオメトリの3次元長が最長となるラインを返します。見つかった最長線が複数ある場合は、最初のもののみ返します。返されるラインは常にg1側を始点、g2側を終点とします。この関数が返すラインの3次元の長さは、常に始点をg1に終点をg2にそれぞれ指定した場合の<a class="xref" href="#ST_3DMaxDistance" title="ST_3DMaxDistance">ST_3DMaxDistance</a>が返す値と同じになります。 </p><p>Availability: 2.0.0</p><p>Changed: 2.2.0 - 二つの2次元ジオメトリが入力である場合には、2次元ポイントが返ります (古い挙動では、存在しないZの値について0を仮定していました)。2次元と3次元の場合には、もはや、存在しないZの値について0を仮定しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p></div><div class="refsection"><a name="idp76242376"></a><h2>例</h2><div class="informaltable"><table class="informaltable" border="1"><colgroup><col></colgroup><tbody><tr><td><p>ラインストリングとポイント -- 3次元と2次元の最長ライン </p><pre class="programlisting">SELECT ST_AsEWKT(ST_3DLongestLine(line,pt)) AS lol3d_line_pt,
                ST_AsEWKT(ST_LongestLine(line,pt)) As lol2d_line_pt
        FROM (SELECT 'POINT(100 100 30)'::geometry As pt,
                        'LINESTRING (20 80 20, 98 190 1, 110 180 3, 50 75 1000)'::geometry As line
                ) As foo;


           lol3d_line_pt           |       lol2d_line_pt
-----------------------------------+----------------------------
 LINESTRING(50 75 1000,100 100 30) | LINESTRING(98 190,100 100)
                                        </pre><p>
							  </p></td></tr><tr><td><p>ラインストリングとマルチポイント -- 3次元と2次元の最長ライン </p><pre class="programlisting">SELECT ST_AsEWKT(ST_3DLongestLine(line,pt)) AS lol3d_line_pt,
                ST_AsEWKT(ST_LongestLine(line,pt)) As lol2d_line_pt
        FROM (SELECT 'MULTIPOINT(100 100 30, 50 74 1000)'::geometry As pt,
                        'LINESTRING (20 80 20, 98 190 1, 110 180 3, 50 75 900)'::geometry As line
                ) As foo;


          lol3d_line_pt          |      lol2d_line_pt
---------------------------------+--------------------------
 LINESTRING(98 190 1,50 74 1000) | LINESTRING(98 190,50 74)
                                        </pre><p>
							  </p></td></tr><tr><td><p>マルチラインストリングとポリゴン -- 3次元と2次元の最長ライン </p><pre class="programlisting">SELECT ST_AsEWKT(ST_3DLongestLine(poly, mline)) As lol3d,
    ST_AsEWKT(ST_LongestLine(poly, mline)) As lol2d
        FROM (SELECT  ST_GeomFromEWKT('POLYGON((175 150 5, 20 40 5, 35 45 5, 50 60 5, 100 100 5, 175 150 5))') As poly,
                ST_GeomFromEWKT('MULTILINESTRING((175 155 2, 20 40 20, 50 60 -2, 125 100 1, 175 155 1),
                (1 10 2, 5 20 1))') As mline ) As foo;
            lol3d             |          lol2d
------------------------------+--------------------------
 LINESTRING(175 150 5,1 10 2) | LINESTRING(175 150,1 10)
             </pre><p>
							  </p></td></tr></tbody></table></div></div><div class="refsection"><a name="idp76248648"></a><h2>関連情報</h2><p><a class="xref" href="#ST_3DClosestPoint" title="ST_3DClosestPoint">ST_3DClosestPoint</a>, <a class="xref" href="#ST_3DDistance" title="ST_3DDistance">ST_3DDistance</a>, <a class="xref" href="#ST_LongestLine" title="ST_LongestLine">ST_LongestLine</a>, <a class="xref" href="#ST_3DShortestLine" title="ST_3DShortestLine">ST_3DShortestLine</a>, <a class="xref" href="#ST_3DMaxDistance" title="ST_3DMaxDistance">ST_3DMaxDistance</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_3DMaxDistance"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_3DMaxDistance — ジオメトリ型について、二つのジオメトリの、3次元の最大デカルト距離 (空間参照系に基づきます)を、投影法の単位で返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_3DMaxDistance</b>(</code>geometry  <var class="pdparam">g1</var>, geometry  <var class="pdparam">g2</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp74704584"></a><h2>説明</h2><p>ジオメトリ型について、二つのジオメトリの、3次元の最大デカルト距離 (空間参照系に基づきます)を、投影法の単位で返します。 </p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p>Availability: 2.0.0</p><p>Changed: 2.2.0 - 2次元と3次元の場合には、もはや、存在しないZの値について0を仮定しません。</p></div><div class="refsection"><a name="idp76270152"></a><h2>例</h2><pre class="programlisting">-- ジオメトリの例 - メートル単位(SRID: 2163 米国ナショナルアトラス正積図法)
-- (3次元ポイントとラインの距離と、2次元ポイントとラインの距離とを比較)
-- ご注意: 現在は垂直データムに対応していないので、Zは変換されずに、最終的に同じであると仮定されます。
SELECT ST_3DMaxDistance(
                        ST_Transform(ST_GeomFromEWKT('SRID=4326;POINT(-72.1235 42.3521 10000)'),2163),
                        ST_Transform(ST_GeomFromEWKT('SRID=4326;LINESTRING(-72.1260 42.45 15, -72.123 42.1546 20)'),2163)
                ) As dist_3d,
                ST_MaxDistance(
                        ST_Transform(ST_GeomFromEWKT('SRID=4326;POINT(-72.1235 42.3521 10000)'),2163),
                        ST_Transform(ST_GeomFromEWKT('SRID=4326;LINESTRING(-72.1260 42.45 15, -72.123 42.1546 20)'),2163)
                ) As dist_2d;

     dist_3d      |     dist_2d
------------------+------------------
 24383.7467488441 | 22247.8472107251
</pre></div><div class="refsection"><a name="idp76271432"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Distance" title="ST_Distance">ST_Distance</a>, <a class="xref" href="#ST_3DDWithin" title="ST_3DDWithin">ST_3DDWithin</a>, <a class="xref" href="#ST_3DMaxDistance" title="ST_3DMaxDistance">ST_3DMaxDistance</a>, <a class="xref" href="#ST_Transform" title="ST_Transform">ST_Transform</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_3DShortestLine"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_3DShortestLine — 二つのジオメトリの3次元長が最短となるラインを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_3DShortestLine</b>(</code>geometry  <var class="pdparam">g1</var>, geometry  <var class="pdparam">g2</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp76283464"></a><h2>説明</h2><p>二つのジオメトリの3次元長が最短となるラインを返します。見つかった最短線が複数ある場合は、最初のもののみ返します。g1とg2が1点のみでインタセクトする場合は、インタセクション点を開始点と終了点とします。g1とg2が1点より多くインタセクトする場合は、同じ点を開始点と終了点としますが、その点は不定です。返されるラインは常にg1側を始点、g2側を終点とします。この関数が返すラインの長さは、常にg1とg2を指定した場合の<a class="xref" href="#ST_3DDistance" title="ST_3DDistance">ST_3DDistance</a>が返す値と同じになります。 </p><p>Availability: 2.0.0</p><p>Changed: 2.2.0 - 二つの2次元ジオメトリが入力である場合には、2次元ポイントが返ります (古い挙動では、存在しないZの値について0を仮定していました)。2次元と3次元の場合には、もはや、存在しないZの値について0を仮定しません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p></div><div class="refsection"><a name="idp76288840"></a><h2>例</h2><div class="informaltable"><table class="informaltable" border="1"><colgroup><col></colgroup><tbody><tr><td><p>ラインストリングとポイント -- 3次元と2次元の最短ライン </p><pre class="programlisting">SELECT ST_AsEWKT(ST_3DShortestLine(line,pt)) AS shl3d_line_pt,
                ST_AsEWKT(ST_ShortestLine(line,pt)) As shl2d_line_pt
        FROM (SELECT 'POINT(100 100 30)'::geometry As pt,
                        'LINESTRING (20 80 20, 98 190 1, 110 180 3, 50 75 1000)'::geometry As line
                ) As foo;


 shl3d_line_pt                                                                 |               shl2d_line_pt
----------------------------------------------------------------------------+------------------------------------------------------
 LINESTRING(54.6993798867619 128.935022917228 11.5475869506606,100 100 30)  | LINESTRING(73.0769230769231 115.384615384615,100 100)
                                        </pre><p>
							  </p></td></tr><tr><td><p>ラインストリングとマルチポイント -- 3次元と2次元の最短ライン </p><pre class="programlisting">SELECT ST_AsEWKT(ST_3DShortestLine(line,pt)) AS shl3d_line_pt,
                ST_AsEWKT(ST_ShortestLine(line,pt)) As shl2d_line_pt
        FROM (SELECT 'MULTIPOINT(100 100 30, 50 74 1000)'::geometry As pt,
                        'LINESTRING (20 80 20, 98 190 1, 110 180 3, 50 75 900)'::geometry As line
                ) As foo;


                       shl3d_line_pt                                       | shl2d_line_pt
---------------------------------------------------------------------------+------------------------
 LINESTRING(54.6993798867619 128.935022917228 11.5475869506606,100 100 30) | LINESTRING(50 75,50 74)
                                        </pre><p>
							  </p></td></tr><tr><td><p>マルチラインストリングとポリゴン -- 3次元と2次元の最短ライン </p><pre class="programlisting">SELECT ST_AsEWKT(ST_3DShortestLine(poly, mline)) As shl3d,
    ST_AsEWKT(ST_ShortestLine(poly, mline)) As shl2d
        FROM (SELECT  ST_GeomFromEWKT('POLYGON((175 150 5, 20 40 5, 35 45 5, 50 60 5, 100 100 5, 175 150 5))') As poly,
                ST_GeomFromEWKT('MULTILINESTRING((175 155 2, 20 40 20, 50 60 -2, 125 100 1, 175 155 1),
                (1 10 2, 5 20 1))') As mline ) As foo;
                   shl3d                                                                           |     shl2d
---------------------------------------------------------------------------------------------------+------------------------
 LINESTRING(39.993580415989 54.1889925532825 5,40.4078575708294 53.6052383805529 5.03423778139177) | LINESTRING(20 40,20 40)
             </pre><p>
							  </p></td></tr></tbody></table></div></div><div class="refsection"><a name="idp76295112"></a><h2>関連情報</h2><p><a class="xref" href="#ST_3DClosestPoint" title="ST_3DClosestPoint">ST_3DClosestPoint</a>, <a class="xref" href="#ST_3DDistance" title="ST_3DDistance">ST_3DDistance</a>, <a class="xref" href="#ST_LongestLine" title="ST_LongestLine">ST_LongestLine</a>, <a class="xref" href="#ST_ShortestLine" title="ST_ShortestLine">ST_ShortestLine</a>, <a class="xref" href="#ST_3DMaxDistance" title="ST_3DMaxDistance">ST_3DMaxDistance</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Area"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Area — ポリゴンまたはマルチポリゴンの場合にはサーフェスの面積を返します。ジオメトリ型の面積はSRIDに基づく単位です。ジオグラフィ型の面積は曲面上で計算され、単位は平方メートルです。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_Area</b>(</code>geometry <var class="pdparam">g1</var><code>)</code>;</p><p><code class="funcdef">float <b class="fsfunc">ST_Area</b>(</code>geography <var class="pdparam">geog</var>, boolean <var class="pdparam">use_spheroid=true</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp76317640"></a><h2>説明</h2><p>ポリゴンまたはマルチポリゴンの場合にはサーフェスの面積を返します。ST_SurfaceまたはST_MultiSurface値の面積計測を返します。ジオメトリ型の面積はSRIDに基づく単位です。ジオグラフィ型の面積は平方メートルで、デフォルトでは回転楕円体についての計測です。計算速度が速い反面精度が落ちる球面での計測を行うにはST_Area(geog,false)とします。 </p><p>Enhanced: 2.0.0 - 2次元多面体サーフェス対応が導入されました。</p><p>Enhanced: 2.2.0 - 精度とロバスト性の向上のためにGeographicLibを使って回転楕円体面上での計測を行うようにしています。この新機能を使うには、Proj 4.9.0以上が必要です。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a></p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 8.1.2, 9.5.3</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>多面体サーフェスについて、2次元多面体サーフェスのみ対応します (2.5次元は対応しません)。2.5次元について、0でない答が与えられるかも知れませんが、完全にXY平面に付いているサーフェスのみです。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method is also provided by SFCGAL backend.</p></div><div class="refsection"><a name="idp76329928"></a><h2>例</h2><p>マサチューセッツのプロットから平方フィートの面積を返すものと、乗算で平方フィートから平方メートルに変換するものです。EPSG:2249はマサチューセッツ州フィート平面であるので、平方フィートで面積が出ることに注意して下さい。 </p><pre class="programlisting">SELECT ST_Area(the_geom) As sqft, ST_Area(the_geom)*POWER(0.3048,2) As sqm
                FROM (SELECT
                ST_GeomFromText('POLYGON((743238 2967416,743238 2967450,
                        743265 2967450,743265.625 2967416,743238 2967416))',2249) ) As foo(the_geom);
  sqft   |     sqm
---------+-------------
 928.625 | 86.27208552
</pre><p>平方フィートの面積を返すものと、マサチューセッツ州メートル平面 (EPSG:26986)に変換して平方メートルを得るものです。EPSG:2249はマサチューセッツ州フィート平面であり、EPSG:26986はマサチューセッツ州メートル平面であることに注意して下さい。 </p><pre class="programlisting">SELECT ST_Area(the_geom) As sqft, ST_Area(ST_Transform(the_geom,26986)) As sqm
                FROM (SELECT
                ST_GeomFromText('POLYGON((743238 2967416,743238 2967450,
                        743265 2967450,743265.625 2967416,743238 2967416))',2249) ) As foo(the_geom);
  sqft   |       sqm
---------+------------------
 928.625 | 86.2724304199219
                        </pre><p>ジオグラフィ型を使って平方フィートと平方メートルを返すものです。 ジオメトリをジオグラフィに変換することに注意して下さい (変換に先立ってジオメトリがWGS 84緯度経度のEPSG:4326であることを確認します)。ジオグラフィは常にメートルで計測されます。これは比較のためのデモンストレーションです。通常は、ジオグラフィ型が既に格納されているものです。</p><pre class="programlisting">SELECT ST_Area(the_geog)/POWER(0.3048,2) As sqft_spheroid,  ST_Area(the_geog,false)/POWER(0.3048,2) As sqft_sphere, ST_Area(the_geog) As sqm_spheroid
                FROM (SELECT
                geography(
                ST_Transform(
                        ST_GeomFromText('POLYGON((743238 2967416,743238 2967450,743265 2967450,743265.625 2967416,743238 2967416))',
                                2249
                                ) ,4326
                        )
                )
        ) As foo(the_geog);
  sqft_spheroid   |   sqft_sphere    |   sqm_spheroid
------------------+------------------+------------------
 928.684403538925 | 927.049336105925 | 86.2776042893529

-- データが既にジオグラフィ型である場合
 SELECT ST_Area(the_geog)/POWER(0.3048,2) As  sqft, ST_Area(the_geog) As sqm
        FROM somegeogtable;</pre></div><div class="refsection"><a name="idp75428168"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a>, <a class="xref" href="#ST_GeographyFromText" title="ST_GeographyFromText">ST_GeographyFromText</a>, <a class="xref" href="#ST_SetSRID" title="ST_SetSRID">ST_SetSRID</a>, <a class="xref" href="#ST_Transform" title="ST_Transform">ST_Transform</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Azimuth"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Azimuth — pointAの鉛直線からPointBへの右回りの方位を北を基準にしたラジアン単位で返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_Azimuth</b>(</code>geometry <var class="pdparam">pointA</var>, geometry <var class="pdparam">pointB</var><code>)</code>;</p><p><code class="funcdef">float <b class="fsfunc">ST_Azimuth</b>(</code>geography <var class="pdparam">pointA</var>, geography <var class="pdparam">pointB</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp76335816"></a><h2>説明</h2><p>与えられたポイントジオメトリで定義される線分の方位をラジアン単位で返します。2点が一致する場合にはNULLを返します。方位は北を基準として時計回りに計測します。北は0、東はπ/2、南はπ西は3π/2になります。</p><p>ジオグラフィに対しては、前方の方位は測地線逆問題の一部として解きます。</p><p>方位は、基準面と点の間の角度と定義される数学的概念です。PostgreSQL組み込み関数degrees()を使うと単位を度に変換できます。下に例を挙げます。</p><p>Availability: 1.1.0</p><p>Enhanced: 2.0.0 ジオグラフィ対応が導入されました。</p><p>Enhanced: 2.2.0 精度とロバスト性向上のために回転楕円体面上の計測をGeographicLibで行うようにしました。この新機能を使うには、Proj 4.9.0以上が必要です。</p><p>ST_Azimuthは、ST_Translateと併用して、垂直軸に沿ってオブジェクトをシフトさせる場合に、特に便利です。これの例として、<a class="ulink" href="http://trac.osgeo.org/postgis/wiki/UsersWikiplpgsqlfunctions" target="_top">Plpgsqlfunctions PostGIS wiki section</a>を参照して下さい。</p></div><div class="refsection"><a name="idp76339784"></a><h2>例</h2><p>度単位のジオメトリの方位 </p><pre class="programlisting">SELECT degrees(ST_Azimuth(ST_Point(25, 45), ST_Point(75, 100))) AS degA_B,
            degrees(ST_Azimuth(ST_Point(75, 100), ST_Point(25, 45))) AS degB_A;

      dega_b       |     degb_a
------------------+------------------
 42.2736890060937 | 222.273689006094
</pre><div class="informaltable"><table class="informaltable" border="1"><colgroup><col><col></colgroup><tbody><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_azimuth01.png"><div class="caption"><p>緑: 開始点 (25,45)で、鉛直方向に行きます。黄: degA_Bを示す行程 (方位)です。</p></div></div></div><p>
				</p></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_azimuth02.png"><div class="caption"><p>緑: (75,100)が開始点で、鉛直方向に行きます。黄: degB_Aを示す行程 (方位)です。</p></div></div></div><p>
				</p></td></tr></tbody></table></div></div><div class="refsection"><a name="idp76348232"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Point" title="ST_Point">ST_Point</a>, <a class="xref" href="#ST_Translate" title="ST_Translate">ST_Translate</a>, <a class="xref" href="#ST_Project" title="ST_Project">ST_Project</a>, <a class="ulink" href="http://www.postgresql.org/docs/current/interactive/functions-math.html" target="_top">PostgreSQL Math Functions</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Angle"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Angle — 三つのポイントまたは二つのベクタ (4ポイントまたは2ライン)の間の角度を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_Angle</b>(</code>geometry <var class="pdparam">point1</var>, geometry <var class="pdparam">point2</var>, geometry <var class="pdparam">point3</var>, geometry <var class="pdparam">point4</var><code>)</code>;</p><p><code class="funcdef">float <b class="fsfunc">ST_Angle</b>(</code>geometry <var class="pdparam">line1</var>, geometry <var class="pdparam">line2</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp76361032"></a><h2>説明</h2><p>3ポイント入力では、P1P2P3の時計回りの角度を計算します。2ライン入力では、2ラインの最初と最後のポイントから4ポイントを得ます。4ポイント入力では、P1P2, P3P4の時計回りの角度を計算します。返り値は常に非負の数で、0と2πラジアンの間になります。ラインまたはポイントの角度を使います。 </p><p>ST_Angle(P1,P2,P3) = ST_Angle(P2,P1,P2,P3)</p><p>例に示す通り、ラジアンで返るので、度を得るには、PostgreSQLの組み込み関数であるdegrees()を使って変換します。</p><p>Availability: 2.5.0</p></div><div class="refsection"><a name="idp76363336"></a><h2>例</h2><p>度単位のジオメトリの方位 </p><pre class="programlisting">WITH rand AS (
                SELECT s, random() * 2 * PI() AS rad1
                        , random() * 2 * PI() AS rad2
                FROM  generate_series(1,2,2) AS s
        )
         , points AS (
                SELECT s, rad1,rad2, ST_MakePoint(cos1+s,sin1+s) as p1, ST_MakePoint(s,s) AS p2, ST_MakePoint(cos2+s,sin2+s) as p3
                FROM rand
                        ,cos(rad1) cos1, sin(rad1) sin1
                        ,cos(rad2) cos2, sin(rad2) sin2
        )
        SELECT s, ST_AsText(ST_SnapToGrid(ST_MakeLine(ARRAY[p1,p2,p3]),0.001)) AS line
                , degrees(ST_Angle(p1,p2,p3)) as computed_angle
                , round(degrees(2*PI()-rad2 -2*PI()+rad1+2*PI()))::int%360 AS reference
                , round(degrees(2*PI()-rad2 -2*PI()+rad1+2*PI()))::int%360 AS reference
        FROM points ;

1 | line | computed_angle | reference
------------------+------------------
1 | LINESTRING(1.511 1.86,1 1,0.896 0.005) | 155.27033848688 | 155

</pre></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Centroid"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Centroid — ジオメトリの幾何学的重心を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Centroid</b>(</code>geometry  <var class="pdparam">g1</var><code>)</code>;</p><p><code class="funcdef">geography <b class="fsfunc">ST_Centroid</b>(</code>geography  <var class="pdparam">g1</var>, boolean  <var class="pdparam">use_spheroid=true</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp76376904"></a><h2>説明</h2><p>ジオメトリの幾何学的重心を計算します。ジオメトリの質量中心の<code class="varname">POINT</code>と同じです。[<code class="varname">MULTI</code>]<code class="varname">POINT</code>に対しては、入力座標の算術平均として計算されます。[<code class="varname">MULTI</code>]<code class="varname">LINESTRING</code>に対しては、各辺の重み付き長さとして計算されます。  [<code class="varname">MULTI</code>]<code class="varname">POLYGON</code>に対しては、「重み」を面積ととらえて計算します。空ジオメトリが与えられた場合には、空の<code class="varname">GEOMETRYCOLLECTION</code>が返されます。<code class="varname">NULL</code>が与えられた場合には、<code class="varname">NULL</code>が返されます。<code class="varname">CIRCULARSTRING</code>または<code class="varname">COMPOUNDCURVE</code>が与えられた場合には、まずCurveToLineで直線に変換されてから、<code class="varname">LINESTRING</code>と同じ計算を行います。 </p><p>New in 2.3.0 : <code class="varname">CIRCULARSTRING</code>と<code class="varname">COMPOUNDCURVE</code>に対応するようになりました (CurveToLineを使います)。</p><p>Availability: 2.4.0 ジオグラフィが導入されました。</p><p>重心は、最も高い次元のジオメトリの要素の集合の重心と同じです (低い次元のジオメトリは「重み」0に貢献するため)。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a></p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 8.1.4, 9.5.5</p></div><div class="refsection"><a name="idp76387912"></a><h2>例</h2><p>次に示す図では、青点が入力ジオメトリの重心です。</p><div class="informaltable"><table class="informaltable" border="1"><colgroup><col><col></colgroup><tbody><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_centroid01.png"><div class="caption"><p><code class="varname">MULTIPOINT</code>の重心</p></div></div></div></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_centroid02.png"><div class="caption"><p><code class="varname">LINESTRING</code>の重心</p></div></div></div></td></tr><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_centroid03.png"><div class="caption"><p><code class="varname">POLYGON</code>の重心</p></div></div></div></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_centroid04.png"><div class="caption"><p><code class="varname">GEOMETRYCOLLECTION</code>の重心</p></div></div></div></td></tr></tbody></table></div><pre class="programlisting">SELECT ST_AsText(ST_Centroid('MULTIPOINT ( -1 0, -1 2, -1 3, -1 4, -1 7, 0 1, 0 3, 1 1, 2 0, 6 0, 7 8, 9 8, 10 6 )'));
                                st_astext
------------------------------------------
 POINT(2.30769230769231 3.30769230769231)
(1 row)

SELECT ST_AsText(ST_centroid(g))
FROM  ST_GeomFromText('CIRCULARSTRING(0 2, -1 1,0 0, 0.5 0, 1 0, 2 1, 1 2, 0.5 2, 0 2)')  AS g ;
------------------------------------------
POINT(0.5 1)


SELECT ST_AsText(ST_centroid(g))
FROM  ST_GeomFromText('COMPOUNDCURVE(CIRCULARSTRING(0 2, -1 1,0 0),(0 0, 0.5 0, 1 0),CIRCULARSTRING( 1 0, 2 1, 1 2),(1 2, 0.5 2, 0 2))' ) AS g;
------------------------------------------
POINT(0.5 1)

</pre></div><div class="refsection"><a name="idp76402376"></a><h2>関連情報</h2><p><a class="xref" href="#ST_PointOnSurface" title="ST_PointOnSurface">ST_PointOnSurface</a>, <a class="xref" href="#ST_GeometricMedian" title="ST_GeometricMedian">ST_GeometricMedian </a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_ClosestPoint"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ClosestPoint — g2に最も接近するg1上の2次元のポイントを返します。これは最短線の最初のポイントです。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_ClosestPoint</b>(</code>geometry  <var class="pdparam">g1</var>, geometry  <var class="pdparam">g2</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp76425928"></a><h2>説明</h2><p>g2に最も接近するg1上の2次元のポイントを返します。これは最短線の最初のポイントです。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>3次元ジオメトリの場合には<a class="xref" href="#ST_3DClosestPoint" title="ST_3DClosestPoint">ST_3DClosestPoint</a>の方が良いでしょう。</p></td></tr></table></div><p>Availability: 1.5.0</p></div><div class="refsection"><a name="idp76428360"></a><h2>例</h2><div class="informaltable"><table class="informaltable" border="1"><colgroup><col><col></colgroup><tbody><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_closestpoint01.png"><div class="caption"><p>ポイントとラインストリングの間の最短は、ポイントそのものです。ラインストリングとポイントの間の最短は、ラインストリング上の最短となるポイントです。</p></div></div></div><p>
				</p><pre class="programlisting">SELECT ST_AsText(ST_ClosestPoint(pt,line)) AS cp_pt_line,
        ST_AsText(ST_ClosestPoint(line,pt)) As cp_line_pt
FROM (SELECT 'POINT(100 100)'::geometry As pt,
                'LINESTRING (20 80, 98 190, 110 180, 50 75 )'::geometry As line
        ) As foo;


   cp_pt_line   |                cp_line_pt
----------------+------------------------------------------
 POINT(100 100) | POINT(73.0769230769231 115.384615384615)
                                </pre><p>
						  </p></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_closestpoint02.png"><div class="caption"><p>ポリゴンA上のポリゴンBへの最短点</p></div></div></div><p>
				</p><pre class="programlisting">SELECT ST_AsText(
                ST_ClosestPoint(
                        ST_GeomFromText('POLYGON((175 150, 20 40, 50 60, 125 100, 175 150))'),
                        ST_Buffer(ST_GeomFromText('POINT(110 170)'), 20)
                        )
                ) As ptwkt;

                  ptwkt
------------------------------------------
 POINT(140.752120669087 125.695053378061)
                                </pre><p>
						</p></td></tr></tbody></table></div></div><div class="refsection"><a name="idp76436936"></a><h2>関連情報</h2><p><a class="xref" href="#ST_3DClosestPoint" title="ST_3DClosestPoint">ST_3DClosestPoint</a>,<a class="xref" href="#ST_Distance" title="ST_Distance">ST_Distance</a>, <a class="xref" href="#ST_LongestLine" title="ST_LongestLine">ST_LongestLine</a>, <a class="xref" href="#ST_ShortestLine" title="ST_ShortestLine">ST_ShortestLine</a>, <a class="xref" href="#ST_MaxDistance" title="ST_MaxDistance">ST_MaxDistance</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_ClusterDBSCAN"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ClusterDBSCAN — DBSCAN (ノイズ適用可能な密度に基づいた空間クラスタリング)アルゴリズムの2次元実装に基づいて、それぞれの入力ジオメトリが入るクラスタの整数識別子を返すウィンドウ関数です。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_ClusterDBSCAN</b>(</code>geometry winset  <var class="pdparam">geom</var>, float8  <var class="pdparam">eps</var>, integer  <var class="pdparam">minpoints</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp76446280"></a><h2>説明</h2><p><a class="ulink" href="https://en.wikipedia.org/wiki/DBSCAN" target="_top">DBSCAN (ノイズ適用可能な密度に基づいた空間クラスタリング)</a>アルゴリズムの2次元実装に基づいて、それぞれの入力ジオメトリが入るクラスタの整数識別子を返します。<a class="xref" href="#ST_ClusterKMeans" title="ST_ClusterKMeans">ST_ClusterKMeans</a>と違って、クラスタ数の指定は求められず、所望する<a class="link" href="#ST_Distance" title="ST_Distance">距離</a> (<code class="varname">eps</code>)と密度(<code class="varname">minpoints</code>)をクラスタを構築するためのパラメータとして使います。 </p><p>入力ジオメトリは次の場合にクラスタに追加されます。 </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>「核」ジオメトリは、入力ジオメトリ (自分を含む)のうち少なくとも<code class="varname">minpoints</code>個が<code class="varname">eps</code>で指定した<a class="link" href="#ST_Distance" title="ST_Distance">距離</a>の範囲内にあるものです。 </p></li><li class="listitem"><p>「境界」ジオメトリは、核ジオメトリから<code class="varname">eps</code>で指定した<a class="link" href="#ST_Distance" title="ST_Distance">距離</a>の範囲内にあるものです。 </p></li></ul></div><p>
		</p><p>境界ジオメトリが<code class="varname">eps</code>以内に複数の核ジオメトリがあるかも知れないことに注意して下さい。この場合には、どちらに割り当てられても正しく、境界ジオメトリは、対象クラスタのうちの一つに任意に割り当てられます。これらの場合には、<code class="varname">minpoints</code>より少ないジオメトリで正しいクラスタを生成できます。境界ジオメトリの割り当てが曖昧な時、ウィンドウの定義にORDER BY句が含まれている場合には、ST_ClusterDBSCANは同じ結果を返しますが、クラスタの割り当ては同じアルゴリズムの他の実装と異なる可能性があります。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>どのクラスタの参加基準にも合わない入力ジオメトリは、番号をNULLとします。 </p></td></tr></table></div><p>Availability: 2.3.0 - GEOSが必要です。 </p></div><div class="refsection"><a name="idp76456008"></a><h2>例</h2><p>50メートル以内にある個々のポリゴンへのクラスタ番号の割り当て。少なくともクラスタには二つのポリゴンが求められます。 </p><div class="informaltable"><table class="informaltable" border="1"><colgroup><col><col></colgroup><tbody><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_clusterdbscan01.png"><div class="caption"><p>少なくともクラスタごとに二つ以上のポリゴンがある50メートル以内のクラスタ。一つだけならcidはNULL。</p></div></div></div><p>
  </p><pre class="programlisting">SELECT name, ST_ClusterDBSCAN(geom, eps := 50, minpoints := 2) over () AS cid
FROM boston_polys
WHERE name 
&gt; '' AND building 
&gt; ''
        AND ST_DWithin(geom,
        ST_Transform(
            ST_GeomFromText('POINT(-71.04054 42.35141)', 4326), 26986),
           500);</pre><p>
						  </p></td><td><pre class="screen">                name                 | bucket
-------------------------------------+--------
 Manulife Tower                      |      0
 Park Lane Seaport I                 |      0
 Park Lane Seaport II                |      0
 Renaissance Boston Waterfront Hotel |      0
 Seaport Boston Hotel                |      0
 Seaport Hotel &amp; World Trade Center  |      0
 Waterside Place                     |      0
 World Trade Center East             |      0
 100 Northern Avenue                 |      1
 100 Pier 4                          |      1
 The Institute of Contemporary Art   |      1
 101 Seaport                         |      2
 District Hall                       |      2
 One Marina Park Drive               |      2
 Twenty Two Liberty                  |      2
 Vertex                              |      2
 Vertex                              |      2
 Watermark Seaport                   |      2
 Blue Hills Bank Pavilion            |   NULL
 World Trade Center West             |   NULL
(20 rows)</pre>
				</td></tr></tbody></table></div><p>同じクラスタ番号の群を一つのジオメトリに統合します。名前付き引数を使用しています。 </p><pre class="programlisting">SELECT cid, ST_Collect(geom) AS cluster_geom, array_agg(parcel_id) AS ids_in_cluster FROM (
    SELECT parcel_id, ST_ClusterDBSCAN(geom, eps := 0.5, minpoints := 5) over () AS cid, geom
    FROM parcels) sq
GROUP BY cid;
    </pre></div><div class="refsection"><a name="idp76463816"></a><h2>関連情報</h2><p><a class="xref" href="#ST_DWithin" title="ST_DWithin">ST_DWithin</a>, <a class="xref" href="#ST_ClusterKMeans" title="ST_ClusterKMeans">ST_ClusterKMeans</a>, <a class="xref" href="#ST_ClusterIntersecting" title="ST_ClusterIntersecting">ST_ClusterIntersecting</a>, <a class="xref" href="#ST_ClusterWithin" title="ST_ClusterWithin">ST_ClusterWithin</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_ClusterIntersecting"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ClusterIntersecting — 集約関数です。ジオメトリの集合の接続された要素の配列を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry[] <b class="fsfunc">ST_ClusterIntersecting</b>(</code>geometry set <var class="pdparam">g</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp76470856"></a><h2>説明</h2><p>ST_ClusterIntersectingはジオメトリコレクションの配列を返す集約関数です。配列の要素は、相互接続されるジオメトリの集合を表現します。</p><p>Availability: 2.2.0 - GEOSが必要です。 </p></div><div class="refsection"><a name="idp76472392"></a><h2>例</h2><pre class="programlisting">WITH testdata AS
  (SELECT unnest(ARRAY['LINESTRING (0 0, 1 1)'::geometry,
                       'LINESTRING (5 5, 4 4)'::geometry,
                       'LINESTRING (6 6, 7 7)'::geometry,
                       'LINESTRING (0 0, -1 -1)'::geometry,
                       'POLYGON ((0 0, 4 0, 4 4, 0 4, 0 0))'::geometry]) AS geom)

SELECT ST_AsText(unnest(ST_ClusterIntersecting(geom))) FROM testdata;

-- 結果 --

st_astext
---------
GEOMETRYCOLLECTION(LINESTRING(0 0,1 1),LINESTRING(5 5,4 4),LINESTRING(0 0,-1 -1),POLYGON((0 0,4 0,4 4,0 4,0 0)))
GEOMETRYCOLLECTION(LINESTRING(6 6,7 7))
        </pre></div><div class="refsection"><a name="idp76473672"></a><h2>関連情報</h2><p><a class="xref" href="#ST_ClusterDBSCAN" title="ST_ClusterDBSCAN">ST_ClusterDBSCAN</a>, <a class="xref" href="#ST_ClusterKMeans" title="ST_ClusterKMeans">ST_ClusterKMeans</a>, <a class="xref" href="#ST_ClusterWithin" title="ST_ClusterWithin">ST_ClusterWithin</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_ClusterKMeans"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ClusterKMeans — 個々のジオメトリが入るクラスタの整数識別子を返すウィンドウ関数です。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_ClusterKMeans</b>(</code>geometry winset  <var class="pdparam">geom</var>, integer  <var class="pdparam">number_of_clusters</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp76481352"></a><h2>説明</h2><p>入力ジオメトリごとの、2次元距離に基づく<a class="ulink" href="https://ja.wikipedia.org/wiki/K%E5%B9%B3%E5%9D%87%E6%B3%95" target="_top">k平均法</a>クラスタ番号を返します。クラスタリングに使用する距離はジオメトリの重心間の距離です。 </p><p>Availability: 2.3.0 - GEOSが必要です。 </p></div><div class="refsection"><a name="idp76483528"></a><h2>例</h2><p>例としてダミーの区画の集合を生成します。</p><pre class="programlisting">CREATE TABLE parcels AS
SELECT lpad((row_number() over())::text,3,'0') As parcel_id, geom,
('{residential, commercial}'::text[])[1 + mod(row_number()OVER(),2)] As type
FROM
    ST_Subdivide(ST_Buffer('LINESTRING(40 100, 98 100, 100 150, 60 90)'::geometry,
    40, 'endcap=square'),12) As geom;
</pre><div class="informaltable"><table class="informaltable" border="1"><colgroup><col></colgroup><tbody><tr><td>
						<div class="informalfigure"><div class="mediaobject"><img src="images/st_clusterkmeans01.png"><div class="caption"><p>元の区画</p></div></div></div><p>
						</p>
					</td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_clusterkmeans02.png"><div class="caption"><p>クラスタ番号 (cid)による色付けを施した区画</p></div></div></div><p>
						</p><pre class="programlisting">SELECT ST_ClusterKMeans(geom, 5) OVER() AS cid, parcel_id, geom
FROM parcels;
-- 結果 --
 cid | parcel_id |   geom
-----+-----------+---------------
   0 | 001       | 0103000000...
   0 | 002       | 0103000000...
   1 | 003       | 0103000000...
   0 | 004       | 0103000000...
   1 | 005       | 0103000000...
   2 | 006       | 0103000000...
   2 | 007       | 0103000000...
(7 rows)</pre><p>
					</p></td></tr></tbody></table></div><pre class="programlisting">-- 種別による区画クラスタの分割
SELECT ST_ClusterKMeans(geom,3) over (PARTITION BY type) AS cid, parcel_id, type
FROM parcels;
-- 結果 --
 cid | parcel_id |    type
-----+-----------+-------------
   1 | 005       | commercial
   1 | 003       | commercial
   2 | 007       | commercial
   0 | 001       | commercial
   1 | 004       | residential
   0 | 002       | residential
   2 | 006       | residential
(7 rows)</pre></div><div class="refsection"><a name="idp76497352"></a><h2>関連情報</h2><p><a class="xref" href="#ST_ClusterDBSCAN" title="ST_ClusterDBSCAN">ST_ClusterDBSCAN</a>, <a class="xref" href="#ST_ClusterIntersecting" title="ST_ClusterIntersecting">ST_ClusterIntersecting</a>, <a class="xref" href="#ST_ClusterWithin" title="ST_ClusterWithin">ST_ClusterWithin</a>, <a class="xref" href="#ST_Subdivide" title="ST_Subdivide">ST_Subdivide</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_ClusterWithin"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ClusterWithin — 集計関数です。ジオメトリコレクションの配列を返します。要素は、指定した距離以内となるよう分けられたジオメトリの集合です。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry[] <b class="fsfunc">ST_ClusterWithin</b>(</code>geometry set  <var class="pdparam">g</var>, float8  <var class="pdparam">distance</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp76505416"></a><h2>説明</h2><p>集計関数です。ジオメトリコレクションの配列を返します。要素は、指定した距離 (SRIDの単位によるデカルト距離)以内となるよう分けられたジオメトリの集合です。</p><p>Availability: 2.2.0 - GEOSが必要です。</p></div><div class="refsection"><a name="idp76506952"></a><h2>例</h2><pre class="programlisting">WITH testdata AS
  (SELECT unnest(ARRAY['LINESTRING (0 0, 1 1)'::geometry,
                       'LINESTRING (5 5, 4 4)'::geometry,
                       'LINESTRING (6 6, 7 7)'::geometry,
                       'LINESTRING (0 0, -1 -1)'::geometry,
                       'POLYGON ((0 0, 4 0, 4 4, 0 4, 0 0))'::geometry]) AS geom)

SELECT ST_AsText(unnest(ST_ClusterWithin(geom, 1.4))) FROM testdata;

-- 結果 --

st_astext
---------
GEOMETRYCOLLECTION(LINESTRING(0 0,1 1),LINESTRING(5 5,4 4),LINESTRING(0 0,-1 -1),POLYGON((0 0,4 0,4 4,0 4,0 0)))
GEOMETRYCOLLECTION(LINESTRING(6 6,7 7))
        </pre></div><div class="refsection"><a name="idp76508232"></a><h2>関連情報</h2><p><a class="xref" href="#ST_ClusterDBSCAN" title="ST_ClusterDBSCAN">ST_ClusterDBSCAN</a>, <a class="xref" href="#ST_ClusterKMeans" title="ST_ClusterKMeans">ST_ClusterKMeans</a>, <a class="xref" href="#ST_ClusterIntersecting" title="ST_ClusterIntersecting">ST_ClusterIntersecting</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Contains"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Contains — Bの点がAの外部に無く、かつBの内部の少なくとも一つの点がAの内部にある場合に限って、TRUEを返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_Contains</b>(</code>geometry  <var class="pdparam">geomA</var>, geometry  <var class="pdparam">geomB</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp76528200"></a><h2>説明</h2><p>ジオメトリAがジオメトリBを含むのは、Bの点がAの外部に無く、かつBの内部の少なくとも一つの点がAの内部にある場合に限ります。この定義の重要で微妙なところは、AはAの境界を含まないと判断するのに、AはA自身を含むと判断することです。ジオメトリAはA自身を含まないと判断をする<a class="xref" href="#ST_ContainsProperly" title="ST_ContainsProperly">ST_ContainsProperly</a>と対照的です。</p><p>ジオメトリBが完全にジオメトリAの内側になる場合はTRUEを返します。この関数が意味のあるものにするためには、元のジオメトリは同じ投影座標である、同じSRIDを持っている必要があります。ST_ContainsはST_Withinの逆のものです。ST_Contains(A,B)はST_Within(B,A)を意味します。ただし、結果が常にFALSEになる、不用意な、または定義されていない不正なジオメトリの場合を除きます。</p><p>GEOSモジュールによって実現しています。</p><p>Enhanced: 2.3.0 PIP short-circuit (ポリゴンとポイントに限定した高速判定)を少ないポイントからなるマルチポイントに対応することができるよう拡張しました。以前の版ではポリゴンとポイントの組み合わせにだけ対応していました。</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[重要]" src="images/important.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">GEOMETRYCOLLECTION</code>を引数として呼ばないでください。</p></td></tr></table></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[重要]" src="images/important.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数を不正なジオメトリで呼ばないでください。予期しない結果が返されます。</p></td></tr></table></div><p>この関数の呼び出しによって、ジオメトリで使用可能なインデクスを使用したバウンディングボックスの比較が自動的に行われます。インデクスの使用を避けるには、_ST_Containsを使います。</p><p>ご注意: これは論理値を返して整数を返さないのが「許される」版です。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a> s2.1.1.2 // s2.1.13.3 - within(geometry B, geometry A)と同じ</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 5.1.31</p><p>直感的に分かりにくいST_ContainsとST_Withinの微妙な違いがあります。詳細については、<a class="ulink" href="http://lin-ear-th-inking.blogspot.com/2007/06/subtleties-of-ogc-covers-spatial.html" target="_top">Subtleties of OGC Covers, Contains, Within</a>をご覧ください。</p></div><div class="refsection"><a name="idp76545864"></a><h2>例</h2><p>次に示す図全てで、<code class="function">ST_Contains</code>は<code class="varname">TRUE</code>を返します。</p><div class="informaltable"><table class="informaltable" border="1"><colgroup><col><col></colgroup><tbody><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_contains01.png"><div class="caption"><p><code class="varname">LINESTRING</code> / <code class="varname">MULTIPOINT</code></p></div></div></div></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_contains02.png"><div class="caption"><p><code class="varname">POLYGON</code> / <code class="varname">POINT</code></p></div></div></div></td></tr><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_contains03.png"><div class="caption"><p><code class="varname">POLYGON</code> / <code class="varname">LINESTRING</code></p></div></div></div></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_contains04.png"><div class="caption"><p><code class="varname">POLYGON</code> / <code class="varname">POLYGON</code></p></div></div></div></td></tr></tbody></table></div><p>次に示す図全てで、<code class="function">ST_Contains</code>は<code class="function">FALSE</code>を返します。</p><div class="informaltable"><table class="informaltable" border="1"><colgroup><col><col></colgroup><tbody><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_contains05.png"><div class="caption"><p><code class="varname">POLYGON</code> / <code class="varname">MULTIPOINT</code></p></div></div></div></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_contains06.png"><div class="caption"><p><code class="varname">POLYGON</code> / <code class="varname">LINESTRING</code></p></div></div></div></td></tr></tbody></table></div><pre class="programlisting">-- 円の中にある円
SELECT ST_Contains(smallc, bigc) As smallcontainsbig,
           ST_Contains(bigc,smallc) As bigcontainssmall,
           ST_Contains(bigc, ST_Union(smallc, bigc)) as bigcontainsunion,
           ST_Equals(bigc, ST_Union(smallc, bigc)) as bigisunion,
           ST_Covers(bigc, ST_ExteriorRing(bigc)) As bigcoversexterior,
           ST_Contains(bigc, ST_ExteriorRing(bigc)) As bigcontainsexterior
FROM (SELECT ST_Buffer(ST_GeomFromText('POINT(1 2)'), 10) As smallc,
                         ST_Buffer(ST_GeomFromText('POINT(1 2)'), 20) As bigc) As foo;

-- 結果
  smallcontainsbig | bigcontainssmall | bigcontainsunion | bigisunion | bigcoversexterior | bigcontainsexterior
------------------+------------------+------------------+------------+-------------------+---------------------
 f                | t                | t                | t          | t        | f

-- ST_ContainsとST_ContainsProperlyとの違いを示す例
SELECT ST_GeometryType(geomA) As geomtype, ST_Contains(geomA,geomA) AS acontainsa, ST_ContainsProperly(geomA, geomA) AS acontainspropa,
   ST_Contains(geomA, ST_Boundary(geomA)) As acontainsba, ST_ContainsProperly(geomA, ST_Boundary(geomA)) As acontainspropba
FROM (VALUES ( ST_Buffer(ST_Point(1,1), 5,1) ),
                         ( ST_MakeLine(ST_Point(1,1), ST_Point(-1,-1) ) ),
                         ( ST_Point(1,1) )
          ) As foo(geomA);

  geomtype    | acontainsa | acontainspropa | acontainsba | acontainspropba
--------------+------------+----------------+-------------+-----------------
ST_Polygon    | t          | f              | f           | f
ST_LineString | t          | f              | f           | f
ST_Point      | t          | t              | f           | f

 </pre></div><div class="refsection"><a name="idp76571208"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Boundary" title="ST_Boundary">ST_Boundary</a>, <a class="xref" href="#ST_ContainsProperly" title="ST_ContainsProperly">ST_ContainsProperly</a>, <a class="xref" href="#ST_Covers" title="ST_Covers">ST_Covers</a>, <a class="xref" href="#ST_CoveredBy" title="ST_CoveredBy">ST_CoveredBy</a>, <a class="xref" href="#ST_Equals" title="ST_Equals">ST_Equals</a>, <a class="xref" href="#ST_Within" title="ST_Within">ST_Within</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_ContainsProperly"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ContainsProperly — BがAの内部にインタセクトするが境界 (または外部)にインタセクトしない場合に、TRUEを返します。Aは自身には、ContainsProperlyではありませんが、Containsです。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_ContainsProperly</b>(</code>geometry  <var class="pdparam">geomA</var>, geometry  <var class="pdparam">geomB</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp76579912"></a><h2>説明</h2><p>BがAの内部にインタセクトするが境界 (または外部)にインタセクトしない場合に、TRUEを返します。</p><p>Aは自身には、ContainsProperlyではありませんが、Containsです。</p><p>他のジオメトリの全てのポイントは、このジオメトリの内部のポイントです。 <a class="xref" href="#ST_Relate" title="ST_Relate">ST_Relate</a>で使われるDE-9IMでは[T**FF*FF*]に合致します。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>JTS文書からわずかに言い換えると、<a class="xref" href="#ST_Contains" title="ST_Contains">ST_Contains</a>と<a class="xref" href="#ST_Intersects" title="ST_Intersects">ST_Intersects</a>でこの述語を併用する利点は、個々のポイントでのトポロジの計算が必要なく、効率的に計算されることです。</p><p>この述語の使用事例として、大きいポリゴンジオメトリでのジオメトリの集合のインタセクションを計算することが挙げられます。インタセクションはかなり遅いので、ContainsProperlyを使って、対象ジオメトリのうち全体が領域内にあるものを抜き出すことができ、効率的になります。これらの場面では、インタセクションは確実に元の対象ジオメトリであることが直感的に分かります。 </p></td></tr></table></div><p>Availability: 1.4.0 - GEOS 3.1.0以上が必要です。</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[重要]" src="images/important.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">GEOMETRYCOLLECTION</code>を引数として呼ばないでください。</p></td></tr></table></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[重要]" src="images/important.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数を不正なジオメトリで呼ばないでください。予期しない結果が返されます。</p></td></tr></table></div><p>この関数の呼び出しによって、ジオメトリで使用可能なインデクスを使用したバウンディングボックスの比較が自動的に行われます。インデクスの使用を避けるには、_ST_ContainsProperlyを使います。</p></div><div class="refsection"><a name="idp76586952"></a><h2>例</h2><pre class="programlisting">-- 円の中にある円
        SELECT ST_ContainsProperly(smallc, bigc) As smallcontainspropbig,
        ST_ContainsProperly(bigc,smallc) As bigcontainspropsmall,
        ST_ContainsProperly(bigc, ST_Union(smallc, bigc)) as bigcontainspropunion,
        ST_Equals(bigc, ST_Union(smallc, bigc)) as bigisunion,
        ST_Covers(bigc, ST_ExteriorRing(bigc)) As bigcoversexterior,
        ST_ContainsProperly(bigc, ST_ExteriorRing(bigc)) As bigcontainsexterior
        FROM (SELECT ST_Buffer(ST_GeomFromText('POINT(1 2)'), 10) As smallc,
        ST_Buffer(ST_GeomFromText('POINT(1 2)'), 20) As bigc) As foo;
        -- 結果
  smallcontainspropbig | bigcontainspropsmall | bigcontainspropunion | bigisunion | bigcoversexterior | bigcontainsexterior
------------------+------------------+------------------+------------+-------------------+---------------------
 f                     | t                    | f                    | t          | t                 | f

-- ST_ContainsとST_ContainsProperlyとの違いを示す例
 SELECT ST_GeometryType(geomA) As geomtype, ST_Contains(geomA,geomA) AS acontainsa, ST_ContainsProperly(geomA, geomA) AS acontainspropa,
 ST_Contains(geomA, ST_Boundary(geomA)) As acontainsba, ST_ContainsProperly(geomA, ST_Boundary(geomA)) As acontainspropba
 FROM (VALUES ( ST_Buffer(ST_Point(1,1), 5,1) ),
                  ( ST_MakeLine(ST_Point(1,1), ST_Point(-1,-1) ) ),
                  ( ST_Point(1,1) )
        ) As foo(geomA);

  geomtype    | acontainsa | acontainspropa | acontainsba | acontainspropba
--------------+------------+----------------+-------------+-----------------
ST_Polygon    | t          | f              | f           | f
ST_LineString | t          | f              | f           | f
ST_Point      | t          | t              | f           | f
 </pre></div><div class="refsection"><a name="idp76588232"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeometryType" title="ST_GeometryType">ST_GeometryType</a>, <a class="xref" href="#ST_Boundary" title="ST_Boundary">ST_Boundary</a>, <a class="xref" href="#ST_Contains" title="ST_Contains">ST_Contains</a>, <a class="xref" href="#ST_Covers" title="ST_Covers">ST_Covers</a>, <a class="xref" href="#ST_CoveredBy" title="ST_CoveredBy">ST_CoveredBy</a>, <a class="xref" href="#ST_Equals" title="ST_Equals">ST_Equals</a>, <a class="xref" href="#ST_Relate" title="ST_Relate">ST_Relate</a>, <a class="xref" href="#ST_Within" title="ST_Within">ST_Within</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Covers"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Covers — ジオメトリBにジオメトリAの外となるポイントが無い場合には、1 (TRUE)を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_Covers</b>(</code>geometry  <var class="pdparam">geomA</var>, geometry  <var class="pdparam">geomB</var><code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">ST_Covers</b>(</code>geography  <var class="pdparam">geogpolyA</var>, geography  <var class="pdparam">geogpointB</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp76609224"></a><h2>説明</h2><p>ジオメトリ/ジオグラフィBにジオメトリ/ジオグラフィAの外となるポイントが無い場合には、1 (TRUE)を返します。</p><p>GEOSモジュールによって実現しています。</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[重要]" src="images/important.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">GEOMETRYCOLLECTION</code>を引数として呼ばないでください。</p></td></tr></table></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[重要]" src="images/important.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数を不正なジオメトリで呼ばないでください。予期しない結果が返されます。</p></td></tr></table></div><p>この関数の呼び出しによって、ジオメトリで使用可能なインデクスを使用したバウンディングボックスの比較が自動的に行われます。インデクスの使用を避けるには、_ST_Coversを使います。</p><p>Enhanced: 2.4.0 ジオグラフィ型を使う形式においてポリゴンの中のポリゴンとポリゴンの中のラインストリングへの対応を追加</p><p>Enhanced: 2.3.0 ジオメトリについて、PIP short-circuit (ポリゴンとポイントに限定した高速判定)を少ないポイントからなるマルチポイントに対応することができるよう拡張しました。以前の版ではポリゴンとポイントの組み合わせにだけ対応していました。</p><p>Availability: 1.5 - ジオグラフィ対応が導入されました。 </p><p>Availability: 1.2.2 - GEOS 3.0以上が必要です。</p><p>ご注意: これは論理値を返して整数を返さないのが「許される」版です。</p><p>これはOGC標準と違いますがOracleは持っています。</p><p>直感的に分かりにくいST_ContainsとST_Withinの微妙な違いがあります。詳細については、<a class="ulink" href="http://lin-ear-th-inking.blogspot.com/2007/06/subtleties-of-ogc-covers-spatial.html" target="_top">Subtleties of OGC Covers, Contains, Within</a>をご覧ください。</p></div><div class="refsection"><a name="idp76616392"></a><h2>例</h2><p>ジオメトリの例 </p><pre class="programlisting">-- 円をカバーする円
SELECT ST_Covers(smallc,smallc) As smallinsmall,
        ST_Covers(smallc, bigc) As smallcoversbig,
        ST_Covers(bigc, ST_ExteriorRing(bigc)) As bigcoversexterior,
        ST_Contains(bigc, ST_ExteriorRing(bigc)) As bigcontainsexterior
FROM (SELECT ST_Buffer(ST_GeomFromText('POINT(1 2)'), 10) As smallc,
        ST_Buffer(ST_GeomFromText('POINT(1 2)'), 20) As bigc) As foo;
        -- 結果
 smallinsmall | smallcoversbig | bigcoversexterior | bigcontainsexterior
--------------+----------------+-------------------+---------------------
 t            | f              | t                 | f
(1 row)        </pre><p>ジオグラフィの例</p><pre class="programlisting">-- ポイントと、別のポイントから300メートル範囲のバッファとの比較と
-- ポイントと、そこから10メートル範囲のバッファとの比較
SELECT ST_Covers(geog_poly, geog_pt) As poly_covers_pt,
        ST_Covers(ST_Buffer(geog_pt,10), geog_pt) As buff_10m_covers_cent
        FROM (SELECT ST_Buffer(ST_GeogFromText('SRID=4326;POINT(-99.327 31.4821)'), 300) As geog_poly,
                                ST_GeogFromText('SRID=4326;POINT(-99.33 31.483)') As geog_pt ) As foo;

 poly_covers_pt | buff_10m_covers_cent
----------------+------------------
 f              | t
                </pre></div><div class="refsection"><a name="idp76664008"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Contains" title="ST_Contains">ST_Contains</a>, <a class="xref" href="#ST_CoveredBy" title="ST_CoveredBy">ST_CoveredBy</a>, <a class="xref" href="#ST_Within" title="ST_Within">ST_Within</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_CoveredBy"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_CoveredBy — ジオメトリ/ジオグラフィAの点がジオメトリ/ジオグラフィBの外に無い場合に、1 (TRUE)を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_CoveredBy</b>(</code>geometry  <var class="pdparam">geomA</var>, geometry  <var class="pdparam">geomB</var><code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">ST_CoveredBy</b>(</code>geography  <var class="pdparam">geogA</var>, geography  <var class="pdparam">geogB</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp76695240"></a><h2>説明</h2><p>ジオメトリ/ジオグラフィAの点がジオメトリ/ジオグラフィBの外に無い場合に、1 (TRUE)を返します。</p><p>GEOSモジュールによって実現しています。</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[重要]" src="images/important.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">GEOMETRYCOLLECTION</code>を引数として呼ばないでください。</p></td></tr></table></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[重要]" src="images/important.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数を不正なジオメトリで呼ばないでください。予期しない結果が返されます。</p></td></tr></table></div><p>Availability: 1.2.2 - GEOS 3.0以上が必要です。</p><p>この関数の呼び出しによって、ジオメトリで使用可能なインデクスを使用したバウンディングボックスの比較が自動的に行われます。インデクスの使用を避けるには、_ST_CoveredByを使います。</p><p>ご注意: これは論理値を返して整数を返さないのが「許される」版です。</p><p>これはOGC標準と違いますがOracleは持っています。</p><p>直感的に分かりにくいST_ContainsとST_Withinの微妙な違いがあります。詳細については、<a class="ulink" href="http://lin-ear-th-inking.blogspot.com/2007/06/subtleties-of-ogc-covers-spatial.html" target="_top">Subtleties of OGC Covers, Contains, Within</a>をご覧ください。</p></div><div class="refsection"><a name="idp76701256"></a><h2>例</h2><pre class="programlisting">-- 円にカバーされる円
SELECT ST_CoveredBy(smallc,smallc) As smallinsmall,
        ST_CoveredBy(smallc, bigc) As smallcoveredbybig,
        ST_CoveredBy(ST_ExteriorRing(bigc), bigc) As exteriorcoveredbybig,
        ST_Within(ST_ExteriorRing(bigc),bigc) As exeriorwithinbig
FROM (SELECT ST_Buffer(ST_GeomFromText('POINT(1 2)'), 10) As smallc,
        ST_Buffer(ST_GeomFromText('POINT(1 2)'), 20) As bigc) As foo;
        -- 結果
 smallinsmall | smallcoveredbybig | exteriorcoveredbybig | exeriorwithinbig
--------------+-------------------+----------------------+------------------
 t            | t                 | t                    | f
(1 row)        </pre></div><div class="refsection"><a name="idp76702536"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Contains" title="ST_Contains">ST_Contains</a>, <a class="xref" href="#ST_Covers" title="ST_Covers">ST_Covers</a>, <a class="xref" href="#ST_ExteriorRing" title="ST_ExteriorRing">ST_ExteriorRing</a>, <a class="xref" href="#ST_Within" title="ST_Within">ST_Within</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Crosses"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Crosses — 与えられたジオメトリが共通の内部の点を持ち、かつそうでない点を持つ場合に、<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_Crosses</b>(</code>geometry <var class="pdparam">g1</var>, geometry <var class="pdparam">g2</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp76710600"></a><h2>説明</h2><p><code class="function">ST_Crosses</code>は、二つのジオメトリをとり、インタセクションが「空間的にクロスする」、すなわちジオメトリが共通の内部の点を持ち、かつそうでない点を持つ場合に<code class="varname">TRUE</code>を返します。ジオメトリの内部のインタセクションは、空集合であってはならず、二つのジオメトリの最大次元より低い次元でなければなりません。さらに言うと、二つのジオメトリのインタセクションは、元のジオメトリのいずれとも一致してはなりません。これらを満たさない場合には<code class="varname">FALSE</code>を返します。</p><p>数学的に述べると、次のようになります。</p><p class="remark"><em><span class="remark">TODO:適切なMathMLマークアップかgif画像をここに挿入する.単純なHTMLマークアップはIEとFirefoxではうまく動作しない. </span></em></p><div class="informalfigure"><div class="mediaobject"><img src="images/st_crosses-math.gif"></div></div><p>DE-9IMでは次のようになります。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="markup">T*T******</span> (for Point/Line, Point/Area, Line/Areaの場合)</p></li><li class="listitem"><p><span class="markup">T*****T**</span> (for Line/Point, Area/Point, Area/Lineの場合)</p></li><li class="listitem"><p><span class="markup">0********</span> (for Line/Lineの場合)</p></li></ul></div><p>他の次元の組み合わせでは、FALSEが返されます。</p><p>OpenGIS Simple Feature Specificationでは、この述語はPoint/Line, Point/Area, Line/Line, Line/Areaの場合についてのみ定義されています。JTS/GEOSでは、Line/Point, Area/Point, Area/Lineについて拡張しています。これによって関係が対称になっています。</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[重要]" src="images/important.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">GEOMETRYCOLLECTION</code>を引数として呼ばないでください。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数の呼び出しによって、ジオメトリで使用可能なインデクスを使用したバウンディングボックスの比較が自動的に行われます。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a> s2.1.13.3</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 5.1.29</p></div><div class="refsection"><a name="idp76724808"></a><h2>例</h2><p>次に示す図全てで、<code class="varname">TRUE</code>が返されます。</p><div class="informaltable"><table class="informaltable" border="1"><colgroup><col><col></colgroup><tbody><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_crosses01.png"><div class="caption"><p><code class="varname">MULTIPOINT</code> / <code class="varname">LINESTRING</code></p></div></div></div></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_crosses02.png"><div class="caption"><p><code class="varname">MULTIPOINT</code> / <code class="varname">POLYGON</code></p></div></div></div></td></tr><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_crosses03.png"><div class="caption"><p><code class="varname">LINESTRING</code> / <code class="varname">POLYGON</code></p></div></div></div></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_crosses04.png"><div class="caption"><p><code class="varname">LINESTRING</code> / <code class="varname">LINESTRING</code></p></div></div></div></td></tr></tbody></table></div><p>roads (道路)とhighways (高速道路)の2つのテーブルを持っている場面を考えます。</p><div class="informaltable"><table class="informaltable" border="1"><colgroup><col><col></colgroup><tbody><tr><td><p> </p><div class="informalexample"><pre class="programlisting">CREATE TABLE roads (
  id serial NOT NULL,
  the_geom geometry,
  CONSTRAINT roads_pkey PRIMARY KEY (road_id)
);</pre></div><p> </p></td><td><p> </p><div class="informalexample"><pre class="programlisting">CREATE TABLE highways (
  id serial NOT NULL,
  the_gem geometry,
  CONSTRAINT roads_pkey PRIMARY KEY (road_id)
);</pre></div><p> </p></td></tr></tbody></table></div><p>次のようなクエリを使って、highwayとクロスするroadsのリストを決定します。</p><div class="informalexample"><pre class="programlisting">SELECT roads.id
FROM roads, highways
WHERE ST_Crosses(roads.the_geom, highways.the_geom);</pre></div></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_LineCrossingDirection"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_LineCrossingDirection — 与えられた二つのラインストリングに関するクロスの種類を-3から3の区間の数で返します。0の場合はクロスしていません</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_LineCrossingDirection</b>(</code>geometry  <var class="pdparam">linestringA</var>, geometry  <var class="pdparam">linestringB</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp76764488"></a><h2>説明</h2><p>与えられた二つのラインストリングに関するクロスの種類を-3から3の区間の数で返します。0の場合はクロスしていません。<code class="varname">LINESTRING</code>のみサポートします。</p><p>整定数の定義は次の通りです。 </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>0: クロスが無い</p></li><li class="listitem"><p>-1: 左クロス</p></li><li class="listitem"><p>1: 右クロス</p></li><li class="listitem"><p>-2: 複数クロスで最後が左</p></li><li class="listitem"><p>2: 複数クロスで最後が右</p></li><li class="listitem"><p>-3: 複数クロスで開始終了ともに左</p></li><li class="listitem"><p>3: 複数クロスで開始終了ともに右</p></li></ul></div><p>
	  </p><p>Availability: 1.4</p></div><div class="refsection"><a name="idp76772808"></a><h2>例</h2><div class="informaltable"><table class="informaltable" border="1"><colgroup><col><col></colgroup><tbody><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_linecrossingdirection01.png"><div class="caption"><p>ライン1 (緑)とライン2 (青)、円が始点、三角が終点。クエリは次の通り。 </p></div></div></div><p>
				  </p><pre class="programlisting">SELECT ST_LineCrossingDirection(foo.line1, foo.line2) As l1_cross_l2 ,
          ST_LineCrossingDirection(foo.line2, foo.line1) As l2_cross_l1
FROM (
SELECT
 ST_GeomFromText('LINESTRING(25 169,89 114,40 70,86 43)') As line1,
 ST_GeomFromText('LINESTRING(171 154,20 140,71 74,161 53)') As line2
        ) As foo;

 l1_cross_l2 | l2_cross_l1
-------------+-------------
           3 |          -3
                                </pre><p>
			</p>
		</td><td>
			<div class="informalfigure"><div class="mediaobject"><img src="images/st_linecrossingdirection02.png"><div class="caption"><p>ライン1 (緑)とライン2 (青)、円が始点、三角が終点。クエリは次の通り。</p></div></div></div><p>
			  </p><pre class="programlisting">SELECT ST_LineCrossingDirection(foo.line1, foo.line2) As l1_cross_l2 ,
          ST_LineCrossingDirection(foo.line2, foo.line1) As l2_cross_l1
FROM (
 SELECT
  ST_GeomFromText('LINESTRING(25 169,89 114,40 70,86 43)') As line1,
  ST_GeomFromText('LINESTRING (171 154, 20 140, 71 74, 2.99 90.16)') As line2
) As foo;

 l1_cross_l2 | l2_cross_l1
-------------+-------------
           2 |          -2
                                </pre><p>
			</p>
		</td></tr><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_linecrossingdirection03.png"><div class="caption"><p>ライン1 (緑)とライン2 (青)、円が始点、三角が終点。クエリは次の通り。 </p></div></div></div><p>
				  </p><pre class="programlisting">SELECT
        ST_LineCrossingDirection(foo.line1, foo.line2) As l1_cross_l2 ,
        ST_LineCrossingDirection(foo.line2, foo.line1) As l2_cross_l1
FROM (
 SELECT
  ST_GeomFromText('LINESTRING(25 169,89 114,40 70,86 43)') As line1,
  ST_GeomFromText('LINESTRING (20 140, 71 74, 161 53)') As line2
  ) As foo;

 l1_cross_l2 | l2_cross_l1
-------------+-------------
          -1 |          1
                                </pre><p>
			</p>
		</td><td>
			<div class="informalfigure"><div class="mediaobject"><img src="images/st_linecrossingdirection04.png"><div class="caption"><p>ライン1 (緑)とライン2 (青)、円が始点、三角が終点。クエリは次の通り。</p></div></div></div><p>
			  </p><pre class="programlisting">SELECT ST_LineCrossingDirection(foo.line1, foo.line2) As l1_cross_l2 ,
          ST_LineCrossingDirection(foo.line2, foo.line1) As l2_cross_l1
FROM (SELECT
        ST_GeomFromText('LINESTRING(25 169,89 114,40 70,86 43)') As line1,
        ST_GeomFromText('LINESTRING(2.99 90.16,71 74,20 140,171 154)') As line2
        ) As foo;

 l1_cross_l2 | l2_cross_l1
-------------+-------------
          -2 |          2
                                </pre><p>
			</p>
		</td></tr></tbody></table></div><pre class="programlisting">SELECT s1.gid, s2.gid, ST_LineCrossingDirection(s1.the_geom, s2.the_geom)
        FROM streets s1 CROSS JOIN streets s2 ON (s1.gid != s2.gid AND s1.the_geom &amp;&amp; s2.the_geom )
WHERE ST_CrossingDirection(s1.the_geom, s2.the_geom) 
&gt; 0;
</pre></div><div class="refsection"><a name="idp76789704"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Crosses" title="ST_Crosses">ST_Crosses</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Disjoint"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Disjoint — ジオメトリが「空間的にインタセクトし」ていない、すなわち、空間を共有していない場合に、TRUEを返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_Disjoint</b>(</code> geometry <var class="pdparam">A</var> ,  geometry <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp76797000"></a><h2>説明</h2><p>オーバラップ、接触、包含は全て、ジオメトリが非接続でないことを意味しています。これらがTRUEを返す場合は、空間的に非接続ではありません。非接続は、空間インタセクトについてFALSEとなります。</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[重要]" src="images/important.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">GEOMETRYCOLLECTION</code>を引数として呼ばないでください。</p></td></tr></table></div><p>GEOSモジュールによって実現しています。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はインデクスを使用しません。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ご注意: これは論理値を返して整数を返さないのが「許される」版です。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a> s2.1.1.2 //s2.1.13.3 - a.Relate(b, 'FF*FF****')</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 5.1.26</p></div><div class="refsection"><a name="idp76804168"></a><h2>例</h2><pre class="programlisting">SELECT ST_Disjoint('POINT(0 0)'::geometry, 'LINESTRING ( 2 0, 0 2 )'::geometry);
 st_disjoint
---------------
 t
(1 row)
SELECT ST_Disjoint('POINT(0 0)'::geometry, 'LINESTRING ( 0 0, 0 2 )'::geometry);
 st_disjoint
---------------
 f
(1 row)
                </pre></div><div class="refsection"><a name="idp76805448"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Intersects" title="ST_Intersects">ST_Intersects</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Distance"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Distance — ジオメトリ型については、二つのジオメトリの、2次元の最小デカルト距離 (空間参照系に基づきます)を、投影法の単位で返します。ジオグラフィ型については、デフォルトでは、二つのジオメトリ間の測地距離をメートル単位で返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_Distance</b>(</code>geometry  <var class="pdparam">g1</var>, geometry  <var class="pdparam">g2</var><code>)</code>;</p><p><code class="funcdef">float <b class="fsfunc">ST_Distance</b>(</code>geography  <var class="pdparam">gg1</var>, geography  <var class="pdparam">gg2</var><code>)</code>;</p><p><code class="funcdef">float <b class="fsfunc">ST_Distance</b>(</code>geography  <var class="pdparam">gg1</var>, geography  <var class="pdparam">gg2</var>, boolean  <var class="pdparam">use_spheroid</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp76823752"></a><h2>説明</h2><p><a class="xref" href="#geometry" title="geometry">geometry</a>型については、二つのジオメトリの、2次元の最小デカルト距離 (空間参照系に基づきます)を、投影法の単位で返します。<a class="xref" href="#geography" title="geography">geography</a>型については、デフォルトでは、二つのジオメトリ間の測地距離をメートル単位で返します。use_spheroidをFALSEにすると、回転楕円体の替わりに球面で計算します。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a></p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 5.1.23</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method is also provided by SFCGAL backend.</p><p>Availability: 1.5.0 1.5でジオグラフィ対応が導入されました。大きいジオメトリや頂点の多いジオメトリについての速度が改善しました。</p><p>Enhanced: 2.1.0 ジオグラフィでの速度が改善されました。詳細は<a class="ulink" href="http://boundlessgeo.com/2012/07/making-geography-faster/" target="_top">Making Geography faster</a>をご覧ください。</p><p>Enhanced: 2.1.0 - 曲線ジオメトリ対応が導入されました。</p><p>Enhanced: 2.2.0 - 精度とロバスト性の向上のためにGeographicLibを使って回転楕円体面上での計測を行うようにしています。この新機能を使うには、Proj 4.9.0以上が必要です。</p></div><div class="refsection"><a name="idp76837192"></a><h2>基本的なジオメトリの例</h2><pre class="programlisting">-- ジオメトリの例 - 度単位 4326はWGS84経度緯度で単位は度
SELECT ST_Distance(
                'SRID=4326;POINT(-72.1235 42.3521)'::geometry,
                'SRID=4326;LINESTRING(-72.1260 42.45, -72.123 42.1546)'::geometry
        );
st_distance
-----------------
0.00150567726382282

-- ジオメトリの例 - メートル単位 (SRID: 3857 一般的なWeb地図のピクセルに比例)
-- 値が外れていても近傍は正しく比較でき、
-- KNNやKMeansのようなアルゴリズムに良い選択となります
SELECT ST_Distance(
                        ST_Transform('SRID=4326;POINT(-72.1235 42.3521)'::geometry, 3857),
                        ST_Transform('SRID=4326;LINESTRING(-72.1260 42.45, -72.123 42.1546)'::geometry, 3857)
                );
st_distance
-----------------
167.441410065196

-- ジオメトリの例 - メートル単位 (SRID: 3857 上と同じですが、歪みを考慮してcos(lat)で修正)
SELECT ST_Distance(
                        ST_Transform('SRID=4326;POINT(-72.1235 42.3521)'::geometry, 3857),
                        ST_Transform('SRID=4326;LINESTRING(-72.1260 42.45, -72.123 42.1546)'::geometry, 3857)
                ) * cosd(42.3521);
st_distance
-----------------
123.742351254151

-- ジオメトリの例 - メートル単位 (SRID: 26986 メートル単位マサチューセッツ州平面) (マサチューセッツで最も精度が高い)
SELECT ST_Distance(
                        ST_Transform('SRID=4326;POINT(-72.1235 42.3521)'::geometry, 26986),
                        ST_Transform('SRID=4326;LINESTRING(-72.1260 42.45, -72.123 42.1546)'::geometry, 26986)
                );
st_distance
-----------------
123.797937878454

-- ジオメトリの例 - メートル単位 (SRID: 2163 米国ナショナルアトラス正積図法)
(least accurate)
SELECT ST_Distance(
                        ST_Transform('SRID=4326;POINT(-72.1235 42.3521)'::geometry, 2163),
                        ST_Transform('SRID=4326;LINESTRING(-72.1260 42.45, -72.123 42.1546)'::geometry, 2163)
                );

st_distance
------------------
126.664256056812
</pre></div><div class="refsection"><a name="idp76838472"></a><h2>ジオグラフィの例</h2><pre class="programlisting">-- ジオメトリの例と同じですが、単位がメートルである点に注意して下さい。
-- 若干の速度向上と精度低下となる球面を使った計測です。
SELECT ST_Distance(gg1, gg2) As spheroid_dist, ST_Distance(gg1, gg2, false) As sphere_dist
FROM (SELECT
        'SRID=4326;POINT(-72.1235 42.3521)'::geography as gg1,
        'SRID=4326;LINESTRING(-72.1260 42.45, -72.123 42.1546)'::geography as gg2
        ) As foo  ;

  spheroid_dist   |   sphere_dist
------------------+------------------
 123.802076746848 | 123.475736916397
</pre></div><div class="refsection"><a name="idp76860232"></a><h2>関連情報</h2><p><a class="xref" href="#ST_3DDistance" title="ST_3DDistance">ST_3DDistance</a>, <a class="xref" href="#ST_DWithin" title="ST_DWithin">ST_DWithin</a>, <a class="xref" href="#ST_DistanceSphere" title="ST_DistanceSphere">ST_DistanceSphere</a>, <a class="xref" href="#ST_Distance_Spheroid" title="ST_DistanceSpheroid">ST_DistanceSpheroid</a>, <a class="xref" href="#ST_MaxDistance" title="ST_MaxDistance">ST_MaxDistance</a>, <a class="xref" href="#ST_HausdorffDistance" title="ST_HausdorffDistance">ST_HausdorffDistance</a>, <a class="xref" href="#ST_FrechetDistance" title="ST_FrechetDistance">ST_FrechetDistance</a>, <a class="xref" href="#ST_Transform" title="ST_Transform">ST_Transform</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_MinimumClearance"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MinimumClearance — ジオメトリのクリアランスの最小値を返します。この値はジオメトリのロバスト性を示すものです。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_MinimumClearance</b>(</code>geometry <var class="pdparam">g</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp76868552"></a><h2>説明</h2><p>ジオメトリは珍しくありませんが、ST_IsValud (ポリゴン)またはST_IsSimple (ラインストリング)に従った妥当性の基準に合うけれども、文字ベースの書式 (WKT, KML, GML, GeoJSON等)や、倍精度浮動小数点の座標値を使用しない書式 (MapInfo TAB)の変換で少しだけ頂点が動いて不正なジオメトリになることは珍しくありません。 </p><p>ジオメトリの「最小クリアランス」とは、ジオメトリの頂点が移動して不正なジオメトリになるための距離の最小値です。ジオメトリのロバスト性の量的計測ととらえられます。最小クリアランスが増えることはロバスト性が増えることを意味します。 </p><p>ジオメトリの最小クリアランスが<code class="varname">e</code>である場合には、次のように言えます。 </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>ジオメトリの頂点の相異なる二つは<code class="varname">e</code>未満で分割されない。 </p></li><li class="listitem"><p>頂点について、その頂点の端点となる辺を除いて、辺との距離が<code class="varname">e</code>より近いものは存在しない </p></li></ul></div><p>
		</p><p>ジオメトリで最小クリアランスを持たない (単一のポイント、要素ポイントが全く同じのマルチポイントなど)場合には、ST_MinimumClearanceは無限大を返します。 </p><p>Availability: 2.3.0 - GEOS 3.6.0以上が必要です。</p></div><div class="refsection"><a name="idp76874440"></a><h2>例</h2><pre class="programlisting">SELECT ST_MinimumClearance('POLYGON ((0 0, 1 0, 1 1, 0.5 3.2e-4, 0 0))');
 st_minimumclearance
---------------------
             0.00032
     </pre></div><div class="refsection"><a name="idp76875720"></a><h2>関連情報</h2><p>
			<a class="xref" href="#ST_MinimumClearanceLine" title="ST_MinimumClearanceLine">ST_MinimumClearanceLine</a>
		</p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_MinimumClearanceLine"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MinimumClearanceLine — ジオメトリの最小クリアランスを示す、2点のラインストリングを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">Geometry <b class="fsfunc">ST_MinimumClearanceLine</b>(</code>geometry  <var class="pdparam">g</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp76881736"></a><h2>説明</h2><p>ジオメトリの最小クリアランスを示す、2点のラインストリングを返します。ジオメトリが最小クリアランスを持たない場合には、<code class="varname">LINESTRING EMPTY</code>が返ります。 </p><p>Availability: 2.3.0 - GEOS 3.6.0以上が必要です。</p></div><div class="refsection"><a name="idp76883784"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(ST_MinimumClearanceLine('POLYGON ((0 0, 1 0, 1 1, 0.5 3.2e-4, 0 0))'));
st_astext
-------------------------------
LINESTRING(0.5 0.00032,0.5 0)
                  </pre></div><div class="refsection"><a name="idp76885064"></a><h2>関連情報</h2><p>
			<a class="xref" href="#ST_MinimumClearance" title="ST_MinimumClearance">ST_MinimumClearance</a>
		</p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_HausdorffDistance"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_HausdorffDistance — 二つのジオメトリ間のハウスドルフ距離を返します。基本的にジオメトリが似ているかどうかを計測するものです。単位はジオメトリの空間参照系の単位です。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_HausdorffDistance</b>(</code>geometry  <var class="pdparam">g1</var>, geometry  <var class="pdparam">g2</var><code>)</code>;</p><p><code class="funcdef">float <b class="fsfunc">ST_HausdorffDistance</b>(</code>geometry  <var class="pdparam">g1</var>, geometry  <var class="pdparam">g2</var>, float <var class="pdparam">densifyFrac</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp76896328"></a><h2>説明</h2><p>「離散ハウスドルフ距離」とみなすことができる距離基準を計算します。これは、一つのジオメトリの離散点に制限されたハウスドルフ距離です。<a class="ulink" href="http://en.wikipedia.org/wiki/Hausdorff_distance" target="_top">Hausdorff distanceに関するWikiPedia英語版の記事</a>や<a class="ulink" href="http://lin-ear-th-inking.blogspot.com/2009/01/computing-geometric-similarity.html" target="_top">Martin Davis note on how Hausdorff Distance calculation was used to prove correctness of the CascadePolygonUnion approach.</a>などを参照して下さい。</p><p>densifyFracが指定された際には、離散ハウスドルフ距離を計算する前に、線分の密度を高めます。densifyFracパラメータは線分ごとの密度を高める小数です。それぞれの線分が、等分に分割されます。線分の長さに対する分割線分の長さの比は与えられた小数に近くなります。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>現在の実装では、離散位置は、頂点のみに対応しています。任意の密度でポイントを使用することができるよう拡張されています。 </p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>このアルゴリズムは標準的なハウスドルフ距離と等価では*ありません*。しかし、使用可能な場面の大部分で正しくなる近似計算がなされています。重要なものに、それぞれが概ね平行で概ね等しい長さのラインストリングがあります。これはラインのマッチングに使える基準です。 </p></td></tr></table></div><p>Availability: 1.5.0 - GEOS 3.2.0以上が必要です。</p></div><div class="refsection"><a name="idp76901192"></a><h2>例</h2><p>建物ごとに、建物を表現する最善の区画を見つけます。まず、ジオメトリとインタセクトする区画を求めます。DISTINCT ONで、建物が一覧に一度だけ出現するのを保障します。ORDER BY ... ST_HausdorffDistanceで、最も建物に近い区画が前に出ます。</p><pre class="programlisting">SELECT DISTINCT ON(buildings.gid) buildings.gid, parcels.parcel_id
   FROM buildings INNER JOIN parcels ON ST_Intersects(buildings.geom,parcels.geom)
     ORDER BY buildings.gid, ST_HausdorffDistance(buildings.geom, parcels.geom);</pre><pre class="programlisting">postgis=# SELECT ST_HausdorffDistance(
                                'LINESTRING (0 0, 2 0)'::geometry,
                                'MULTIPOINT (0 1, 1 0, 2 1)'::geometry);
 st_hausdorffdistance
 ----------------------
                                         1
(1 row)
                        </pre><pre class="programlisting">postgis=# SELECT st_hausdorffdistance('LINESTRING (130 0, 0 0, 0 150)'::geometry, 'LINESTRING (10 10, 10 150, 130 10)'::geometry, 0.5);
 st_hausdorffdistance
 ----------------------
                                        70
(1 row)
                        </pre></div><div class="refsection"><a name="idp76903880"></a><h2>関連情報</h2><p><a class="xref" href="#ST_FrechetDistance" title="ST_FrechetDistance">ST_FrechetDistance</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_FrechetDistance"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_FrechetDistance — 二つのジオメトリのフレシェ距離を返します。曲線の位置と点の並び順とを考慮に入れた曲線間の類似度を計測するものです。単位はジオメトリの空間参照系の単位です。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_FrechetDistance</b>(</code>geometry  <var class="pdparam">g1</var>, geometry  <var class="pdparam">g2</var>, float <var class="pdparam">densifyFrac = -1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp76911688"></a><h2>説明</h2><p>両方のジオメトリの離散点への制限を受けたフレシェ距離の計算アルゴリズムの実装は<a class="ulink" href="http://www.kr.tuwien.ac.at/staff/eiter/et-archive/cdtr9464.pdf" target="_top">Computing Discrete Fréchet Distance</a>を基にしています。フレシェ距離は曲線の位置と点の並び順とを考慮に入れた曲線間の類似度を計測するものです。ハウスドルフ距離よりも良いことがしばしばあります。 </p><p>任意引数densifyFracが指定されると、この関数は、離散フレシェ距離の計算の前に、辺密度を増加させます。densifyFracパラメータは辺の高密度化に使う比率を設定します。それぞれの辺は多数の等長の辺に分割され、分割辺長の合計長に対する比は与えた比率に近くなります。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>現在の実装では、離散位置は、頂点のみに対応しています。任意の密度でポイントを使用することができるよう拡張されています。 </p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>densityFracに小さい値を指定すると、フレシェ距離の精度が増します。しかし、分割辺数の2乗に比例して計算時間とメモリ利用量が増大します。 </p></td></tr></table></div><p>Availability: 2.4.0 - GEOS 3.7.0以上が必要です。</p></div><div class="refsection"><a name="idp76915912"></a><h2>例</h2><pre class="programlisting">postgres=# SELECT st_frechetdistance('LINESTRING (0 0, 100 0)'::geometry, 'LINESTRING (0 0, 50 50, 100 0)'::geometry);
 st_frechetdistance
--------------------
   70.7106781186548
(1 row)
                        </pre><pre class="programlisting">SELECT st_frechetdistance('LINESTRING (0 0, 100 0)'::geometry, 'LINESTRING (0 0, 50 50, 100 0)'::geometry, 0.5);
 st_frechetdistance
--------------------
                 50
(1 row)
                        </pre></div><div class="refsection"><a name="idp76917704"></a><h2>関連情報</h2><p><a class="xref" href="#ST_HausdorffDistance" title="ST_HausdorffDistance">ST_HausdorffDistance</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_MaxDistance"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MaxDistance — 二つのジオメトリ間の2次元距離の最大値を、投影法の単位で返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_MaxDistance</b>(</code>geometry  <var class="pdparam">g1</var>, geometry  <var class="pdparam">g2</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp76936776"></a><h2>説明</h2><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>二つのジオメトリの最大2次元距離を投影法の単位で返します。g1とg2が同じジオメトリの場合には、ジオメトリ内の最も遠くなる頂点の距離を返します。</p></td></tr></table></div><p>Availability: 1.5.0</p></div><div class="refsection"><a name="idp76938952"></a><h2>例</h2><p>ポイントからラインへの基本的な最長距離</p><pre class="programlisting">postgis=# SELECT ST_MaxDistance('POINT(0 0)'::geometry, 'LINESTRING ( 2 0, 0 2 )'::geometry);
   st_maxdistance
-----------------
 2
(1 row)

postgis=# SELECT ST_MaxDistance('POINT(0 0)'::geometry, 'LINESTRING ( 2 2, 2 2 )'::geometry);
  st_maxdistance
------------------
 2.82842712474619
(1 row)</pre></div><div class="refsection"><a name="idp76940872"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Distance" title="ST_Distance">ST_Distance</a>, <a class="xref" href="#ST_LongestLine" title="ST_LongestLine">ST_LongestLine</a>, <a class="xref" href="#ST_DFullyWithin" title="ST_DFullyWithin">ST_DFullyWithin</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_DistanceSphere"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_DistanceSphere — 二つの経度緯度ジオメトリの間の最短距離をメートル単位で返します。SRIDで定義された回転楕円体に由来する半径となる球面を使います。<a class="xref" href="#ST_Distance_Spheroid" title="ST_DistanceSpheroid">ST_DistanceSpheroid</a>より高速ですが、精度が悪くなります。PostGISの1.5より前の版ではポイント間の計測のみ実装していました。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_DistanceSphere</b>(</code>geometry  <var class="pdparam">geomlonlatA</var>, geometry  <var class="pdparam">geomlonlatB</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp76948808"></a><h2>説明</h2><p>二つの経度緯度ジオメトリの間の最短距離をメートル単位で返します。SRIDで定義された回転楕円体に由来する半径となる球面を使います。<a class="xref" href="#ST_Distance_Spheroid" title="ST_DistanceSpheroid">ST_DistanceSpheroid</a>より高速ですが、精度が悪くなります。PostGISの1.5より前の版ではポイント間の距離の計測だけを実装していました。</p><p>Availability: 1.5 - ポイント以外のジオメトリが導入されました。以前の版ではポイントでのみ動作しました。</p><p>Changed: 2.2.0 前の版ではこの関数はST_Distance_Sphereと呼ばれていました。</p></div><div class="refsection"><a name="idp76951112"></a><h2>例</h2><pre class="programlisting">SELECT round(CAST(ST_DistanceSphere(ST_Centroid(the_geom), ST_GeomFromText('POINT(-118 38)',4326)) As numeric),2) As dist_meters,
round(CAST(ST_Distance(ST_Transform(ST_Centroid(the_geom),32611),
                ST_Transform(ST_GeomFromText('POINT(-118 38)', 4326),32611)) As numeric),2) As dist_utm11_meters,
round(CAST(ST_Distance(ST_Centroid(the_geom), ST_GeomFromText('POINT(-118 38)', 4326)) As numeric),5) As dist_degrees,
round(CAST(ST_Distance(ST_Transform(the_geom,32611),
                ST_Transform(ST_GeomFromText('POINT(-118 38)', 4326),32611)) As numeric),2) As min_dist_line_point_meters
FROM
        (SELECT ST_GeomFromText('LINESTRING(-118.584 38.374,-118.583 38.5)', 4326) As the_geom) as foo;
         dist_meters | dist_utm11_meters | dist_degrees | min_dist_line_point_meters
        -------------+-------------------+--------------+----------------------------
                70424.47 |          70438.00 |      0.72900 |                   65871.18

        </pre></div><div class="refsection"><a name="idp76952648"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Distance" title="ST_Distance">ST_Distance</a>, <a class="xref" href="#ST_Distance_Spheroid" title="ST_DistanceSpheroid">ST_DistanceSpheroid</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Distance_Spheroid"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_DistanceSpheroid — 指定した回転楕円体による、二つの経度緯度ジオメトリ間の最小距離を返します。PostGIS 1.5より前ではポイント間の計測のみ対応していました。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_DistanceSpheroid</b>(</code>geometry  <var class="pdparam">geomlonlatA</var>, geometry  <var class="pdparam">geomlonlatB</var>, spheroid  <var class="pdparam">measurement_spheroid</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp76960840"></a><h2>説明</h2><p>指定した回転楕円体による、ふたつの経度緯度ジオメトリ間の最小距離を返します。回転楕円体の説明については <a class="xref" href="#ST_Length_Spheroid" title="ST_LengthSpheroid">ST_LengthSpheroid</a>をご覧下さい。PostGIS 1.5より前ではポイント間の計測のみ対応していました。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数は現在のところ、ジオメトリのSRIDを見ずに、常に関数に渡される回転楕円体の座標で表現されていると仮定します。以前の版ではポイント間の計測のみ対応していました。</p></td></tr></table></div><p>Availability: 1.5 - ポイント以外のジオメトリが導入されました。以前の版ではポイントでのみ動作しました。</p><p>Changed: 2.2.0 前の版ではST_Distance_Spheroidと呼ばれていました。</p></div><div class="refsection"><a name="idp76963912"></a><h2>例</h2><pre class="programlisting">SELECT round(CAST(
                ST_DistanceSpheroid(ST_Centroid(the_geom), ST_GeomFromText('POINT(-118 38)',4326), 'SPHEROID["WGS 84",6378137,298.257223563]')
                        As numeric),2) As dist_meters_spheroid,
                round(CAST(ST_DistanceSphere(ST_Centroid(the_geom), ST_GeomFromText('POINT(-118 38)',4326)) As numeric),2) As dist_meters_sphere,
round(CAST(ST_Distance(ST_Transform(ST_Centroid(the_geom),32611),
                ST_Transform(ST_GeomFromText('POINT(-118 38)', 4326),32611)) As numeric),2) As dist_utm11_meters
FROM
        (SELECT ST_GeomFromText('LINESTRING(-118.584 38.374,-118.583 38.5)', 4326) As the_geom) as foo;
 dist_meters_spheroid | dist_meters_sphere | dist_utm11_meters
----------------------+--------------------+-------------------
                         70454.92 |           70424.47 |          70438.00

        </pre></div><div class="refsection"><a name="idp76965448"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Distance" title="ST_Distance">ST_Distance</a>, <a class="xref" href="#ST_DistanceSphere" title="ST_DistanceSphere">ST_DistanceSphere</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_DFullyWithin"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_DFullyWithin — 全てのジオメトリが指定したジオメトリから指定した距離内にある場合にTRUEを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_DFullyWithin</b>(</code>geometry  <var class="pdparam">g1</var>, geometry  <var class="pdparam">g2</var>, double precision  <var class="pdparam">distance</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp76977864"></a><h2>説明</h2><p>全てのジオメトリが指定したジオメトリから指定した距離内にある場合にTRUEを返します。距離はジオメトリの空間参照系で定義されている単位になります。この関数が意味のあるものにするためには、与えられるジオメトリは両方とも同じ座標系で同じSRIDを持つ必要があります。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数の呼び出しによって、ジオメトリで使用可能なインデクスを使用したバウンディングボックスの比較が自動的に行われます。</p></td></tr></table></div><p>Availability: 1.5.0</p></div><div class="refsection"><a name="idp76980168"></a><h2>例</h2><pre class="programlisting">postgis=# SELECT ST_DFullyWithin(geom_a, geom_b, 10) as DFullyWithin10, ST_DWithin(geom_a, geom_b, 10) as DWithin10, ST_DFullyWithin(geom_a, geom_b, 20) as DFullyWithin20 from
                (select ST_GeomFromText('POINT(1 1)') as geom_a,ST_GeomFromText('LINESTRING(1 5, 2 7, 1 9, 14 12)') as geom_b) t1;

-----------------
 DFullyWithin10 | DWithin10 | DFullyWithin20 |
---------------+----------+---------------+
 f             | t        | t             |  </pre></div><div class="refsection"><a name="idp76981448"></a><h2>関連情報</h2><p><a class="xref" href="#ST_MaxDistance" title="ST_MaxDistance">ST_MaxDistance</a>, <a class="xref" href="#ST_DWithin" title="ST_DWithin">ST_DWithin</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_DWithin"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_DWithin — ジオメトリが指定したジオメトリから指定した距離内にある場合にTRUEを返します。ジオメトリについては、距離は空間参照系で定義されている単位になります。ジオグラフィについては、メートル単位で、デフォルトではuse_spheroid=true (回転楕円体を使った計算)となり、速いチェックをするにはuse_spheroid=falseとして球面を使って計算します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_DWithin</b>(</code>geometry  <var class="pdparam">g1</var>, geometry  <var class="pdparam">g2</var>, double precision  <var class="pdparam">distance_of_srid</var><code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">ST_DWithin</b>(</code>geography  <var class="pdparam">gg1</var>, geography  <var class="pdparam">gg2</var>, double precision  <var class="pdparam">distance_meters</var><code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">ST_DWithin</b>(</code>geography  <var class="pdparam">gg1</var>, geography  <var class="pdparam">gg2</var>, double precision  <var class="pdparam">distance_meters</var>, boolean  <var class="pdparam">use_spheroid</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp76999112"></a><h2>説明</h2><p>ジオメトリが指定したジオメトリから指定した距離内にある場合にTRUEを返します。</p><p><span class="type">geometry</span>: 距離の単位は空間参照系で定義される単位です。引数のジオメトリは全て同じ座標投影、すなわち同じSRIDでなければ、この関数の意味がありません。</p><p><span class="type">geography</span>: メートル単位で計測のデフォルトは<code class="varname">use_spheroid</code>=trueです。早いチェックを行うには<code class="varname">use_spheroid</code>=falseとして球面での計測を行います。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数の呼び出しによって、ジオメトリで使用可能なインデクスを使用したバウンディングボックスの比較が自動的に行われます。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>1.3より前では、ST_Expandは一般的に&amp;&amp;とST_Distanceとを併用して、同じ効果を得ていました。1.3.4より前では、この関数は、基本的にこのやり方の短縮版でした。1.3.4から、ST_DWithinは、大きなバッファ領域について前の版より効果的になる、より短縮した距離関数を使っています。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>3次元ジオメトリの場合にはST_3DDWithinを使います。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a></p><p>Availability: 1.5.0 ジオグラフィが導入されました。</p><p>Enhanced: 2.1.0で、ジオグラフィでの速度が向上しました。詳細については<a class="ulink" href="http://blog.opengeo.org/2012/07/12/making-geography-faster/" target="_top">Making Geography faster</a>を参照して下さい。</p><p>Enhanced: 2.1.0 曲線ジオメトリ対応が導入されました。</p></div><div class="refsection"><a name="idp77007688"></a><h2>例</h2><pre class="programlisting">-- 学校ごとに、3000単位以内の最も近い病院を見つけます。
-- ST_DWithinでインデックスを使用して検索リストの絞り込みを行い、
-- インデックスを使えないST_Distanceで処理します。
-- 空間参照系の単位がメートルならここで言う単位はメートルです。
SELECT DISTINCT ON (s.gid) s.gid, s.school_name, s.geom, h.hospital_name
        FROM schools s
                LEFT JOIN hospitals h ON ST_DWithin(s.the_geom, h.geom, 3000)
        ORDER BY s.gid, ST_Distance(s.geom, h.geom);

-- 病院が近くにない学校
-- 3000単位以内に病院が無い学校を全て見つけます。
-- 単位は空間参照系の単位です (メートル、フィート、度など)
SELECT s.gid, s.school_name
        FROM schools s
                LEFT JOIN hospitals h ON ST_DWithin(s.geom, h.geom, 3000)
        WHERE h.gid IS NULL;

-- 受信可能距離の制限を持つ受信機が受信できる放送塔を見つけます。
-- データは球面メルカトル (SRID=3857)のジオメトリで、範囲は近似的なものとしています。

-- ユーザから見て塔が制限範囲内かをチェックするジオメトリインデックスの生成。
CREATE INDEX ON broadcasting_towers using gist (geom);

-- 塔から見てユーザが制限範囲内かをチェックするジオメトリインデックスの生成。
CREATE INDEX ON broadcasting_towers using gist (ST_Expand(geom, sending_range));

-- ミンスクハケルスペイスにある受信機から4キロメートル以内にある塔の検索
-- ご注意: 二つの条件があります。より短い LEAST(b.sending_range, 4000) ではインデックスが使えません。
SELECT b.tower_id, b.geom
  FROM broadcasting_towers b
  WHERE ST_DWithin(b.geom, 'SRID=3857;POINT(3072163.4 7159374.1)', 4000)
          AND ST_DWithin(b.geom, 'SRID=3857;POINT(3072163.4 7159374.1)', b.sending_range);

                          </pre></div><div class="refsection"><a name="idp77008968"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Distance" title="ST_Distance">ST_Distance</a>, <a class="xref" href="#ST_Expand" title="ST_Expand">ST_Expand</a>, <a class="xref" href="#ST_3DDWithin" title="ST_3DDWithin">ST_3DDWithin</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Equals"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Equals — 与えられたジオメトリ表現が同じ場合にTRUEを返します。方向は無視されます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_Equals</b>(</code>geometry  <var class="pdparam">A</var>, geometry  <var class="pdparam">B</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp77016520"></a><h2>説明</h2><p>与えられたジオメトリ表現が「空間的に同じ」場合にTRUEを返します。'='よりも「よりよい」答を得るために使います。空間的に同じということは、ST_Within(A,B) = trueかつST_Within(B,A) = trueとなります。また、ポイントの順序が違っても同じジオメトリ構造ならtrueとなります。構成ポイントの順序の確認にはST_OrderingEqualsを使用します (ST_OrderingEqualsはポイントのオーダが同じかを確認するよりも若干厳しくなります)。</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[重要]" src="images/important.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数は、バイナリで同じ場合を除いて、どちらのジオメトリも不正である場合はFALSEを返します。</p></td></tr></table></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[重要]" src="images/important.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ジオメトリコレクションを引数として読んではなりません。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a> s2.1.1.2</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 5.1.24</p><p>Changed: 2.2.0 この関数は、どちらのジオメトリも不正であっても、バイナリで同じ場合ならTRUEを返します。</p></div><div class="refsection"><a name="idp77022664"></a><h2>例</h2><pre class="programlisting">SELECT ST_Equals(ST_GeomFromText('LINESTRING(0 0, 10 10)'),
                ST_GeomFromText('LINESTRING(0 0, 5 5, 10 10)'));
 st_equals
-----------
 t
(1 row)

SELECT ST_Equals(ST_Reverse(ST_GeomFromText('LINESTRING(0 0, 10 10)')),
                ST_GeomFromText('LINESTRING(0 0, 5 5, 10 10)'));
 st_equals
-----------
 t
(1 row)
</pre></div><div class="refsection"><a name="idp77023944"></a><h2>関連情報</h2><p><a class="xref" href="#ST_IsValid" title="ST_IsValid">ST_IsValid</a>, <a class="xref" href="#ST_OrderingEquals" title="ST_OrderingEquals">ST_OrderingEquals</a>, <a class="xref" href="#ST_Reverse" title="ST_Reverse">ST_Reverse</a>, <a class="xref" href="#ST_Within" title="ST_Within">ST_Within</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_GeometricMedian"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_GeometricMedian  — マルチポイントの幾何学的中央値を返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc"> ST_GeometricMedian </b> (</code>  geometry  <var class="pdparam"> g </var> ,   float8  <var class="pdparam"> tolerance </var> ,   int  <var class="pdparam"> max_iter </var> ,   boolean  <var class="pdparam"> fail_if_not_converged </var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp77035080"></a><h2>説明</h2><p>マルチポイントジオメトリの幾何中央値の近似値を、Weiszfeldアルゴリズムを使って計算します。幾何中央値は、重心よりもはみ出しにくい中心性計測です。 </p><p>このアルゴリズムでは、成功した回次の間の距離の変化が、<code class="varname">tolerance</code>パラメータよりも小さくなるまで繰り返します。<code class="varname">max_iterations</code>回を超えた場合には、関数は<code class="varname">fail_if_not_converged</code>をFALSEに指定している場合を除いて、エラーを生成して終了します。 </p><p><code class="varname">tolerance</code>値が渡されていない場合には、デフォルトの許容値は、入力ジオメトリの範囲を基に計算されます。 </p><p>ポイントのM値は、存在するなら、相対的な重みと解釈されます。 </p><p>Availability: 2.3.0</p><p>Enhanced: 2.5.0 ポイントの重みとしてのM値の対応が追加されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports M coordinates.</p></div><div class="refsection"><a name="idp77042376"></a><h2>例</h2><p>
		  </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_geometricmedian01.png"><div class="caption"><p>4点のマルチポイント (黄色の点)から得た重心 (青緑色の点)と幾何学的中央値 (赤色の点)との比較。 </p></div></div></div><p>
	  </p><pre class="programlisting">WITH test AS (
SELECT 'MULTIPOINT((0 0), (1 1), (2 2), (200 200))'::geometry geom)
SELECT
  ST_AsText(ST_Centroid(geom)) centroid,
  ST_AsText(ST_GeometricMedian(geom)) median
FROM test;
      centroid      |                 median
--------------------+----------------------------------------
 POINT(50.75 50.75) | POINT(1.9761550281255 1.9761550281255)
(1 row)
          </pre></div><div class="refsection"><a name="idp77046472"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Centroid" title="ST_Centroid">ST_Centroid</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_HasArc"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_HasArc — ジオメトリまたはジオメトリコレクションが曲線ストリングを含む場合にTRUEを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_HasArc</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp77052360"></a><h2>説明</h2><p>ジオメトリまたはジオメトリコレクションが曲線ストリングを含む場合にTRUEを返します。</p><p>Availability: 1.2.3?</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p></div><div class="refsection"><a name="idp77056584"></a><h2>例</h2><pre class="programlisting">SELECT ST_HasArc(ST_Collect('LINESTRING(1 2, 3 4, 5 6)', 'CIRCULARSTRING(1 1, 2 3, 4 5, 6 7, 5 6)'));
                st_hasarc
                --------
                t
                </pre></div><div class="refsection"><a name="idp77058120"></a><h2>関連情報</h2><p><a class="xref" href="#ST_CurveToLine" title="ST_CurveToLine">ST_CurveToLine</a>, <a class="xref" href="#ST_LineToCurve" title="ST_LineToCurve">ST_LineToCurve</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Intersects"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Intersects — ジオメトリ/ジオグラフィが「2次元空間で空間的にインタセクトする」 (空間に共有部分がある)場合にTRUEを返します。そうでない (非接続)場合はFALSEを返します。ジオグラフィについては、許容量は0.00001メートルです (近い点はインタセクトと考えられてしまいます)。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_Intersects</b>(</code> geometry <var class="pdparam">geomA</var> ,  geometry <var class="pdparam">geomB</var> <code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">ST_Intersects</b>(</code> geography <var class="pdparam">geogA</var> ,  geography <var class="pdparam">geogB</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp77069512"></a><h2>説明</h2><p>ジオメトリ/ジオグラフィが空間に共有部分がある場合には、インタセクトしています。ジオグラフィでは許容誤差が0.00001メートルです (近い点はインタセクトと考えられてしまいます)。</p><p>オーバラップ、接触、包含は全て、ジオメトリがインタセクトしていることを意味しています。これらがTRUEを返す場合は、空間的にインタセクトしています。非接続は、空間インタセクトについてFALSEとなります。</p><p>Enhanced: 2.5.0 ジオメトリコレクションに対応しました。</p><p>Enhanced: 2.3.0 PIP short-circuit (ポリゴンとポイントに限定した高速判定)を少ないポイントからなるマルチポイントに対応することができるよう拡張しました。以前の版ではポリゴンとポイントの組み合わせにだけ対応していました。</p><p>ジオメトリについては、GEOSモジュールで実現しています。ジオグラフィについてはネイティブです。</p><p>Availability: 1.5 ジオグラフィ対応が導入されました。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数の呼び出しによって、ジオメトリで使用可能なインデクスを使用したバウンディングボックスの比較が自動的に行われます。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ジオグラフィでは、この関数は0.00001メートルの距離許容を持ち、回転楕円体計算でなく球面を使います。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ご注意: これは論理値を返して整数を返さないのが「許される」版です。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a> s2.1.1.2 //s2.1.13.3 - ST_Intersects(g1, g2 ) --&gt; Not (ST_Disjoint(g1, g2 )) </p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 5.1.27</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method is also provided by SFCGAL backend.</p></div><div class="refsection"><a name="idp77079368"></a><h2>ジオメトリの例</h2><pre class="programlisting">SELECT ST_Intersects('POINT(0 0)'::geometry, 'LINESTRING ( 2 0, 0 2 )'::geometry);
 st_intersects
---------------
 f
(1 row)
SELECT ST_Intersects('POINT(0 0)'::geometry, 'LINESTRING ( 0 0, 0 2 )'::geometry);
 st_intersects
---------------
 t
(1 row)
                </pre></div><div class="refsection"><a name="idp77080648"></a><h2>ジオグラフィの例</h2><pre class="programlisting">SELECT ST_Intersects(
                ST_GeographyFromText('SRID=4326;LINESTRING(-43.23456 72.4567,-43.23456 72.4568)'),
                ST_GeographyFromText('SRID=4326;POINT(-43.23456 72.4567772)')
                );

 st_intersects
---------------
t
</pre></div><div class="refsection"><a name="idp77081928"></a><h2>関連情報</h2><p><a class="xref" href="#ST_3DIntersects" title="ST_3DIntersects">ST_3DIntersects</a>, <a class="xref" href="#ST_Disjoint" title="ST_Disjoint">ST_Disjoint</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Length"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Length — ジオメトリがLINESTRINGまたはMULTILINESTRINGの場合には、それらの2次元長を返します。ジオメトリでは、単位は空間参照系の単位です。ジオグラフィでは、メートル単位です (回転楕円体がデフォルトです)。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_Length</b>(</code>geometry <var class="pdparam">a_2dlinestring</var><code>)</code>;</p><p><code class="funcdef">float <b class="fsfunc">ST_Length</b>(</code>geography <var class="pdparam">geog</var>, boolean <var class="pdparam">use_spheroid=true</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp77091016"></a><h2>説明</h2><p>ジオメトリについては、LINESTRING, MULTILINESTRING, ST_Curve, ST_MultiCurveの場合には、ジオメトリの2次元デカルト距離を返します。面ジオメトリに対しては0を返します。面ジオメトリに対しては<a class="xref" href="#ST_Perimeter" title="ST_Perimeter">ST_Perimeter</a>を使います。計測単位はジオメトリの空間参照系の単位になります。ジオグラフィについては、領域ジオメトリに対する周囲長関数としての働きもします。</p><p>ジオグラフィに対しては、測地線の逆問題を使って計算し、長さの単位はメートルです。PostGISをPROJ 4.8.0以上でコンパイルしているなら、回転楕円体面はSRIDで指定されたものですが、そうでなければ、WGS84に限定されます。<code class="varname">use_spheroid=false</code>とすると、回転楕円体面でなく近似する球面で計算します。</p><p>現在は、ジオメトリに対してはST_Length2Dの別名ですが、高次元対応に変更されるかも知れません。</p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Changed: 2.0.0 大幅な変更 -- 以前の版ではジオグラフィのPOLYGONやMULTIPOLYGONへの適用によってPOLYGONやMULTIPOLYGONの周囲長を返しました。2.0.0版ではジオメトリの挙動に従うため0を返すように変更しました。ポリゴンの周囲長を求める場合は、ST_Perimeterを使います。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ジオグラフィに対しては、回転楕円体面での計測を行います。速くなる反面精度が下がる球面を使用するには、ST_Length(gg,false)；とします。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a> s2.1.5.1</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 7.1.2, 9.3.4</p><p>Availability: 1.5.0 ジオグラフィt対応が導入されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method is also provided by SFCGAL backend.</p></div><div class="refsection"><a name="idp77099592"></a><h2>ジオメトリの例</h2><p>ラインストリングのフィート単位の長さを返します。EPSG:2249はフィート単位のマサチューセッツ州平面なので、フィート単位になることに注意して下さい。</p><pre class="programlisting">SELECT ST_Length(ST_GeomFromText('LINESTRING(743238 2967416,743238 2967450,743265 2967450,
743265.625 2967416,743238 2967416)',2249));
st_length
---------
 122.630744000095


-- WGS84ラインストリングをメートル単位のマサチューセッツ平面に変換
SELECT ST_Length(
        ST_Transform(
                ST_GeomFromEWKT('SRID=4326;LINESTRING(-72.1260 42.45, -72.1240 42.45666, -72.123 42.1546)'),
                26986
        )
);
st_length
---------
34309.4563576191
                        </pre></div><div class="refsection"><a name="idp77101256"></a><h2>ジオグラフィの例</h2><p>WGS84ジオグラフィのラインの長さを返します。</p><pre class="programlisting">-- デフォルトでは回転楕円体面でなく球面を使って計算します
SELECT ST_Length(the_geog) As length_spheroid,  ST_Length(the_geog,false) As length_sphere
FROM (SELECT ST_GeographyFromText(
'SRID=4326;LINESTRING(-72.1260 42.45, -72.1240 42.45666, -72.123 42.1546)') As the_geog)
 As foo;
 length_spheroid  |  length_sphere
------------------+------------------
 34310.5703627288 | 34346.2060960742
                        </pre></div><div class="refsection"><a name="idp77103048"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeographyFromText" title="ST_GeographyFromText">ST_GeographyFromText</a>, <a class="xref" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a>, <a class="xref" href="#ST_Length_Spheroid" title="ST_LengthSpheroid">ST_LengthSpheroid</a>, <a class="xref" href="#ST_Perimeter" title="ST_Perimeter">ST_Perimeter</a>, <a class="xref" href="#ST_Transform" title="ST_Transform">ST_Transform</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Length2D"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Length2D — LINESTRINGまたはMULTILINESTRINGに対して、ジオメトリの2次元長を返します。これは<code class="varname">ST_Length</code>の別名です。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_Length2D</b>(</code>geometry  <var class="pdparam">a_2dlinestring</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp75849160"></a><h2>説明</h2><p>LINESTRINGまたはMULTILINESTRINGに対して、ジオメトリの2次元長を返します。これは<code class="varname">ST_Length</code>の別名です。</p></div><div class="refsection"><a name="idp75850952"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Length" title="ST_Length">ST_Length</a>, <a class="xref" href="#ST_3DLength" title="ST_3DLength">ST_3DLength</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_3DLength"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_3DLength — LINESTRINGまたはMULTILINESTRINGに対して、ジオメトリの3次元長または2次元長を返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_3DLength</b>(</code>geometry  <var class="pdparam">a_3dlinestring</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp75861192"></a><h2>説明</h2><p>LINESTRINGまたはMULTILINESTRINGに対して、ジオメトリの3次元長または2次元長を返します。2次元ラインについては、2次元長を返します (ST_LengthやST_Length2Dと同じです)。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p>Changed: 2.0.0 以前の版ではST_Length3Dと呼ばれていました。</p></div><div class="refsection"><a name="idp75864136"></a><h2>例</h2><p>3次元ケーブルの長さをフィート単位で返します。EPSG:2249はフィート単位のマサチューセッツ州平面なので、フィート単位になることに注意して下さい。</p><pre class="programlisting">SELECT ST_3DLength(ST_GeomFromText('LINESTRING(743238 2967416 1,743238 2967450 1,743265 2967450 3,
743265.625 2967416 3,743238 2967416 3)',2249));
ST_3DLength
-----------
122.704716741457
                </pre></div><div class="refsection"><a name="idp75866056"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Length" title="ST_Length">ST_Length</a>, <a class="xref" href="#ST_Length2D" title="ST_Length2D">ST_Length2D</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Length_Spheroid"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_LengthSpheroid — 回転楕円体上のジオメトリの2次元長/周囲長または3次元長/周囲長を計算します。これは、ジオメトリの座標が経度/緯度になっていて、投影変換を行わずに距離を求めたい場合に使います。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_LengthSpheroid</b>(</code>geometry  <var class="pdparam">a_geometry</var>, spheroid  <var class="pdparam">a_spheroid</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp77122504"></a><h2>説明</h2><p>回転楕円体上のジオメトリの2次元長/周囲長または3次元長/周囲長を計算します。これは、ジオメトリの座標が経度/緯度になっていて、投影変換を行わずに距離を求めたい場合に使います。回転楕円体は独立したデータベースタイプで、次のように構成されています。</p><div class="literallayout"><p>SPHEROID[&lt;名称&gt;,&lt;長軸半径&gt;,&lt;扁平率の逆数&gt;]</p></div><div class="literallayout"><p>SPHEROID["GRS_1980",6378137,298.257222101]</p></div><p>Availability: 1.2.2</p><p>Changed: 2.2.0 前の版ではST_Length_Spheroidと呼ばれていました。また、ST_3DLength_Spheroidの別名でした。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp77127112"></a><h2>例</h2><pre class="programlisting">SELECT ST_LengthSpheroid( geometry_column,
                          'SPHEROID["GRS_1980",6378137,298.257222101]' )
                          FROM geometry_table;

SELECT ST_LengthSpheroid( the_geom, sph_m ) As tot_len,
ST_LengthSpheroid(ST_GeometryN(the_geom,1), sph_m) As len_line1,
ST_LengthSpheroid(ST_GeometryN(the_geom,2), sph_m) As len_line2
                          FROM (SELECT ST_GeomFromText('MULTILINESTRING((-118.584 38.374,-118.583 38.5),
        (-71.05957 42.3589 , -71.061 43))') As the_geom,
CAST('SPHEROID["GRS_1980",6378137,298.257222101]' As spheroid) As sph_m)  as foo;
        tot_len      |    len_line1     |    len_line2
------------------+------------------+------------------
 85204.5207562955 | 13986.8725229309 | 71217.6482333646

 -- 3次元
SELECT ST_LengthSpheroid( the_geom, sph_m ) As tot_len,
ST_LengthSpheroid(ST_GeometryN(the_geom,1), sph_m) As len_line1,
ST_LengthSpheroid(ST_GeometryN(the_geom,2), sph_m) As len_line2
                          FROM (SELECT ST_GeomFromEWKT('MULTILINESTRING((-118.584 38.374 20,-118.583 38.5 30),
        (-71.05957 42.3589 75, -71.061 43 90))') As the_geom,
CAST('SPHEROID["GRS_1980",6378137,298.257222101]' As spheroid) As sph_m)  as foo;

         tot_len      |    len_line1    |    len_line2
------------------+-----------------+------------------
 85204.5259107402 | 13986.876097711 | 71217.6498130292

</pre></div><div class="refsection"><a name="idp77128648"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeometryN" title="ST_GeometryN">ST_GeometryN</a>, <a class="xref" href="#ST_Length" title="ST_Length">ST_Length</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Length2D_Spheroid"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Length2D_Spheroid — 回転楕円体上のジオメトリの2次元長/周囲長を計算します。これは、ジオメトリの座標が経度/緯度になっていて、投影変換を行わずに距離を求めたい場合に使います。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_Length2D_Spheroid</b>(</code>geometry  <var class="pdparam">a_geometry</var>, spheroid  <var class="pdparam">a_spheroid</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp77156296"></a><h2>説明</h2><p>回転楕円体上のジオメトリの2次元長/周囲長を計算します。これは、ジオメトリの座標が経度/緯度になっていて、投影変換を行わずに距離を求めたい場合に使います。回転楕円体は独立したデータベースタイプで、次のように構成されています。</p><div class="literallayout"><p>SPHEROID[&lt;名称&gt;,&lt;長軸半径&gt;,&lt;扁平率の逆数&gt;]</p></div><div class="literallayout"><p>SPHEROID["GRS_1980",6378137,298.257222101]</p></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><a class="xref" href="#ST_Length_Spheroid" title="ST_LengthSpheroid">ST_LengthSpheroid</a>によく似ていますが、計算の際にZ座標値が無視される点が異なります。</p></td></tr></table></div></div><div class="refsection"><a name="idp77159496"></a><h2>例</h2><pre class="programlisting">SELECT ST_Length2D_Spheroid( geometry_column,
                          'SPHEROID["GRS_1980",6378137,298.257222101]' )
                          FROM geometry_table;

SELECT ST_Length2D_Spheroid( the_geom, sph_m ) As tot_len,
ST_Length2D_Spheroid(ST_GeometryN(the_geom,1), sph_m) As len_line1,
ST_Length2D_Spheroid(ST_GeometryN(the_geom,2), sph_m) As len_line2
                          FROM (SELECT ST_GeomFromText('MULTILINESTRING((-118.584 38.374,-118.583 38.5),
        (-71.05957 42.3589 , -71.061 43))') As the_geom,
CAST('SPHEROID["GRS_1980",6378137,298.257222101]' As spheroid) As sph_m)  as foo;
        tot_len      |    len_line1     |    len_line2
------------------+------------------+------------------
 85204.5207562955 | 13986.8725229309 | 71217.6482333646

-- 3次元 同じ答になります
SELECT ST_Length2D_Spheroid( the_geom, sph_m ) As tot_len,
ST_Length2D_Spheroid(ST_GeometryN(the_geom,1), sph_m) As len_line1,
ST_Length2D_Spheroid(ST_GeometryN(the_geom,2), sph_m) As len_line2
                          FROM (SELECT ST_GeomFromEWKT('MULTILINESTRING((-118.584 38.374 20,-118.583 38.5 30),
        (-71.05957 42.3589 75, -71.061 43 90))') As the_geom,
CAST('SPHEROID["GRS_1980",6378137,298.257222101]' As spheroid) As sph_m)  as foo;

        tot_len      |    len_line1     |    len_line2
------------------+------------------+------------------
 85204.5207562955 | 13986.8725229309 | 71217.6482333646

</pre></div><div class="refsection"><a name="idp77161032"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeometryN" title="ST_GeometryN">ST_GeometryN</a>, <a class="xref" href="#ST_Length_Spheroid" title="ST_LengthSpheroid">ST_LengthSpheroid</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_LongestLine"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_LongestLine — 二つのジオメトリの2次元長が最長となるラインを返します。見つかったラインが複数ある場合は、最初のもののみ返します。返されるラインは常にg1側を始点、g2側を終点とします。この関数が返すラインの長さは、常に始点をg1に終点をg2にそれぞれ指定した場合のST_MaxDistanceが返す値と同じになります。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_LongestLine</b>(</code>geometry  <var class="pdparam">g1</var>, geometry  <var class="pdparam">g2</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp77168200"></a><h2>説明</h2><p>二つのジオメトリの2次元長が最長となるポイントを返します。 </p><p>Availability: 1.5.0</p></div><div class="refsection"><a name="idp77169736"></a><h2>例</h2><div class="informaltable"><table class="informaltable" border="1"><colgroup><col><col></colgroup><tbody><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_longestline01.png"><div class="caption"><p>ポイントとラインとの間の最長線</p></div></div></div><p>
				</p><pre class="programlisting">SELECT ST_AsText(
        ST_LongestLine('POINT(100 100)'::geometry,
                'LINESTRING (20 80, 98 190, 110 180, 50 75 )'::geometry)
        ) As lline;


   lline
-----------------
LINESTRING(100 100,98 190)
                                </pre><p>
						  </p></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_longestline02.png"><div class="caption"><p>ポリゴンとポリゴンとの間の最長線</p></div></div></div><p>
				</p><pre class="programlisting">SELECT ST_AsText(
        ST_LongestLine(
                ST_GeomFromText('POLYGON((175 150, 20 40,
                        50 60, 125 100, 175 150))'),
                ST_Buffer(ST_GeomFromText('POINT(110 170)'), 20)
                )
        ) As llinewkt;

   lline
-----------------
LINESTRING(20 40,121.111404660392 186.629392246051)
                                </pre><p>
						</p></td></tr></tbody></table></div><div class="informaltable"><table class="informaltable" border="1"><colgroup><col></colgroup><tbody><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_longestline03.png"><div class="caption"><p>素敵な街のある部分から他の部分への直線移動距離 (最大距離=この線の長さ)</p></div></div></div><p>
				</p><pre class="programlisting">SELECT ST_AsText(ST_LongestLine(c.the_geom, c.the_geom)) As llinewkt,
        ST_MaxDistance(c.the_geom,c.the_geom) As max_dist,
        ST_Length(ST_LongestLine(c.the_geom, c.the_geom)) As lenll
FROM (SELECT ST_BuildArea(ST_Collect(the_geom)) As the_geom
        FROM (SELECT ST_Translate(ST_SnapToGrid(ST_Buffer(ST_Point(50 ,generate_series(50,190, 50)
                        ),40, 'quad_segs=2'),1), x, 0)  As the_geom
                        FROM generate_series(1,100,50) As x)  AS foo
) As c;

          llinewkt          |     max_dist     |      lenll
---------------------------+------------------+------------------
 LINESTRING(23 22,129 178) | 188.605408193933 | 188.605408193933
                                </pre><p>
						</p></td></tr></tbody></table></div></div><div class="refsection"><a name="idp77183048"></a><h2>関連情報</h2><p><a class="xref" href="#ST_MaxDistance" title="ST_MaxDistance">ST_MaxDistance</a>, <a class="xref" href="#ST_ShortestLine" title="ST_ShortestLine">ST_ShortestLine</a>, <a class="xref" href="#ST_LongestLine" title="ST_LongestLine">ST_LongestLine</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_OrderingEquals"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_OrderingEquals — 与えられたジオメトリが同じジオメトリを示し、ポイントの順序が同じである場合にTRUEを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_OrderingEquals</b>(</code>geometry  <var class="pdparam">A</var>, geometry  <var class="pdparam">B</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp77190600"></a><h2>説明</h2><p>ST_OrderingEqualsは、二つのジオメトリを比較して、ジオメトリが同じで、座標値が同じ順序である場合には、t (TRUE)を返し、それ以外の場合には、f (FALSE)を返します。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数は、SQL-MM仕様ではなくArcSDE SQL仕様に従って実装しています。http://edndoc.esri.com/arcsde/9.1/sql_api/sqlapi3.htm#ST_OrderingEqualsをご覧ください。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 5.1.43</p></div><div class="refsection"><a name="idp77247176"></a><h2>例</h2><pre class="programlisting">SELECT ST_OrderingEquals(ST_GeomFromText('LINESTRING(0 0, 10 10)'),
                ST_GeomFromText('LINESTRING(0 0, 5 5, 10 10)'));
 st_orderingequals
-----------
 f
(1 row)

SELECT ST_OrderingEquals(ST_GeomFromText('LINESTRING(0 0, 10 10)'),
                ST_GeomFromText('LINESTRING(0 0, 0 0, 10 10)'));
 st_orderingequals
-----------
 t
(1 row)

SELECT ST_OrderingEquals(ST_Reverse(ST_GeomFromText('LINESTRING(0 0, 10 10)')),
                ST_GeomFromText('LINESTRING(0 0, 0 0, 10 10)'));
 st_orderingequals
-----------
 f
(1 row)
</pre></div><div class="refsection"><a name="idp77248456"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Equals" title="ST_Equals">ST_Equals</a>, <a class="xref" href="#ST_Reverse" title="ST_Reverse">ST_Reverse</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Overlaps"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Overlaps — ジオメトリが共有空間を持ち、同じ次元で、かつ完全には一方に含まれていない場合にTRUEを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_Overlaps</b>(</code>geometry  <var class="pdparam">A</var>, geometry  <var class="pdparam">B</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp77259720"></a><h2>説明</h2><p>ジオメトリが「空間的にオーバラップ」する場合にTRUEを返します。ジオメトリがインタセクトして、かつ一方が他方を完全には含まない場合です。 </p><p>GEOSモジュールによって実現しています。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ジオメトリコレクションを引数として呼ばないでください。</p></td></tr></table></div><p>この関数の呼び出しによって、ジオメトリで使用可能なインデクスを使用したバウンディングボックスの比較が自動的に行われます。インデクスの使用を避けるには_ST_Overlapsを使います。</p><p>ご注意: これは論理値を返して整数を返さないのが「許される」版です。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a> s2.1.1.2 // s2.1.13.3</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 5.1.32</p></div><div class="refsection"><a name="idp77265608"></a><h2>例</h2><p>次に示す図全てで、<code class="varname">TRUE</code>が返されます。</p><div class="informaltable"><table class="informaltable" border="1"><colgroup><col><col><col></colgroup><tbody><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_overlaps01.png"><div class="caption"><p><code class="varname">MULTIPOINT</code> / <code class="varname">MULTIPOINT</code></p></div></div></div></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_overlaps02.png"><div class="caption"><p><code class="varname">LINESTRING</code> / <code class="varname">LINESTRING</code></p></div></div></div></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_overlaps03.png"><div class="caption"><p><code class="varname">POLYGON</code> / <code class="varname">POLYGON</code></p></div></div></div></td></tr></tbody></table></div><pre class="programlisting">-- 線上にある点は、線に含まれていますが
-- 低い次元ですので、線とオーバラップもクロスもしません

SELECT ST_Overlaps(a,b) As a_overlap_b,
        ST_Crosses(a,b) As a_crosses_b,
                ST_Intersects(a, b) As a_intersects_b, ST_Contains(b,a) As b_contains_a
FROM (SELECT ST_GeomFromText('POINT(1 0.5)') As a, ST_GeomFromText('LINESTRING(1 0, 1 1, 3 5)')  As b)
        As foo

a_overlap_b | a_crosses_b | a_intersects_b | b_contains_a
------------+-------------+----------------+--------------
f           | f           | t              | t

-- ラインは部分的に円に含まれますが、完全にはインタセクトとクロスを満たしません
-- 次元の違いからオーバラップしません
SELECT ST_Overlaps(a,b) As a_overlap_b, ST_Crosses(a,b) As a_crosses_b,
        ST_Intersects(a, b) As a_intersects_b,
        ST_Contains(a,b) As a_contains_b
FROM (SELECT ST_Buffer(ST_GeomFromText('POINT(1 0.5)'), 3)  As a, ST_GeomFromText('LINESTRING(1 0, 1 1, 3 5)')  As b)
        As foo;

 a_overlap_b | a_crosses_b | a_intersects_b | a_contains_b
-------------+-------------+----------------+--------------
 f           | t           | t              | f

-- 円にインタセクトした、2次元の曲がったホットドッグ
-- (または、ふくれたラインストリング)です。
-- 完全には円に含まれず、同じ次元ですのでオーバラップします。
-- インタセクションの次元が最大次元と同じ2次元ですから、クロスしません。

SELECT ST_Overlaps(a,b) As a_overlap_b, ST_Crosses(a,b) As a_crosses_b, ST_Intersects(a, b) As a_intersects_b,
ST_Contains(b,a) As b_contains_a,
ST_Dimension(a) As dim_a, ST_Dimension(b) as dim_b, ST_Dimension(ST_Intersection(a,b)) As dima_intersection_b
FROM (SELECT ST_Buffer(ST_GeomFromText('POINT(1 0.5)'), 3)  As a,
        ST_Buffer(ST_GeomFromText('LINESTRING(1 0, 1 1, 3 5)'),0.5)  As b)
        As foo;

 a_overlap_b | a_crosses_b | a_intersects_b | b_contains_a | dim_a | dim_b | dima_intersection_b
-------------+-------------+----------------+--------------+-------+-------+---------------------
 t           | f           | t              | f            |     2 |     2 |              2
</pre></div><div class="refsection"><a name="idp77290440"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Contains" title="ST_Contains">ST_Contains</a>, <a class="xref" href="#ST_Crosses" title="ST_Crosses">ST_Crosses</a>, <a class="xref" href="#ST_Dimension" title="ST_Dimension">ST_Dimension</a>, <a class="xref" href="#ST_Intersects" title="ST_Intersects">ST_Intersects</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Perimeter"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Perimeter — ST_SrrfaceまたはST_MultiSurface (POLYGONまたはMULTIPOLYGON)の境界の長さの計測値を返します。ジオメトリでは単位は空間参照系によります。ジオグラフィではメートル単位になります。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_Perimeter</b>(</code>geometry <var class="pdparam">g1</var><code>)</code>;</p><p><code class="funcdef">float <b class="fsfunc">ST_Perimeter</b>(</code>geography <var class="pdparam">geog</var>, boolean <var class="pdparam">use_spheroid=true</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp77300296"></a><h2>説明</h2><p>ジオメトリ/ジオグラフィがST_SrrfaceまたはST_MultiSurface (POLYGONまたはMULTIPOLYGON)の場合に、2次元周囲長を返します。面ジオメトリでない場合には0を返します。ラインストリングについては<a class="xref" href="#ST_Length" title="ST_Length">ST_Length</a>を使います。ジオメトリに対しては、周囲長の計測単位は空間参照系によります。</p><p>ジオグラフィに対しては、測地線の逆問題を使って計算し、長さの単位はメートルです。PostGISをPROJ 4.8.0以上でコンパイルしているなら、回転楕円体面はSRIDで指定されたものですが、そうでなければ、WGS84に限定されます。<code class="varname">use_spheroid=false</code>とすると、回転楕円体面でなく近似する球面で計算します。</p><p>現在は、この関数はST_Perimeter2Dの別名ですが、高次元対応に変更されるかも知れません。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a> s2.1.5.1</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 8.1.3, 9.5.4</p><p>Availability: 2.0.0 ジオグラフィ対応が導入されました。</p></div><div class="refsection"><a name="idp77310664"></a><h2>例: ジオメトリ</h2><p>POLYGONとMULTIPOLYGONに対するフィート単位の周囲長を返します。EPSG:2249はフィート単位のマサチューセッツ平面なので、フィート単位です。</p><pre class="programlisting">SELECT ST_Perimeter(ST_GeomFromText('POLYGON((743238 2967416,743238 2967450,743265 2967450,
743265.625 2967416,743238 2967416))', 2249));
st_perimeter
---------
 122.630744000095
(1 row)

SELECT ST_Perimeter(ST_GeomFromText('MULTIPOLYGON(((763104.471273676 2949418.44119003,
763104.477769673 2949418.42538203,
763104.189609677 2949418.22343004,763104.471273676 2949418.44119003)),
((763104.471273676 2949418.44119003,763095.804579742 2949436.33850239,
763086.132105649 2949451.46730207,763078.452329651 2949462.11549407,
763075.354136904 2949466.17407812,763064.362142565 2949477.64291974,
763059.953961626 2949481.28983009,762994.637609571 2949532.04103014,
762990.568508415 2949535.06640477,762986.710889563 2949539.61421415,
763117.237897679 2949709.50493431,763235.236617789 2949617.95619822,
763287.718121842 2949562.20592617,763111.553321674 2949423.91664605,
763104.471273676 2949418.44119003)))', 2249));
st_perimeter
---------
 845.227713366825
(1 row)
                        </pre></div><div class="refsection"><a name="idp77312328"></a><h2>例: ジオグラフィ</h2><p>ポリゴンとマルチポリゴンのメートル単位とフィート単位の周囲長を返します。ジオグラフィ (WGS 84経度緯度)であることに注意して下さい。</p><pre class="programlisting">SELECT  ST_Perimeter(geog) As per_meters, ST_Perimeter(geog)/0.3048 As per_ft
FROM ST_GeogFromText('POLYGON((-71.1776848522251 42.3902896512902,-71.1776843766326 42.3903829478009,
-71.1775844305465 42.3903826677917,-71.1775825927231 42.3902893647987,-71.1776848522251 42.3902896512902))') As geog;

   per_meters    |      per_ft
-----------------+------------------
37.3790462565251 | 122.634666195949


-- MultiPolygon example --
SELECT  ST_Perimeter(geog) As per_meters, ST_Perimeter(geog,false) As per_sphere_meters,  ST_Perimeter(geog)/0.3048 As per_ft
FROM ST_GeogFromText('MULTIPOLYGON(((-71.1044543107478 42.340674480411,-71.1044542869917 42.3406744369506,
-71.1044553562977 42.340673886454,-71.1044543107478 42.340674480411)),
((-71.1044543107478 42.340674480411,-71.1044860600303 42.3407237015564,-71.1045215770124 42.3407653385914,
-71.1045498002983 42.3407946553165,-71.1045611902745 42.3408058316308,-71.1046016507427 42.340837442371,
-71.104617893173 42.3408475056957,-71.1048586153981 42.3409875993595,-71.1048736143677 42.3409959528211,
-71.1048878050242 42.3410084812078,-71.1044020965803 42.3414730072048,
-71.1039672113619 42.3412202916693,-71.1037740497748 42.3410666421308,
-71.1044280218456 42.3406894151355,-71.1044543107478 42.340674480411)))') As geog;

    per_meters    | per_sphere_meters |      per_ft
------------------+-------------------+------------------
 257.634283683311 |  257.412311446337 | 845.256836231335
                        </pre></div><div class="refsection"><a name="idp77313992"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeogFromText" title="ST_GeogFromText">ST_GeogFromText</a>, <a class="xref" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a>, <a class="xref" href="#ST_Length" title="ST_Length">ST_Length</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Perimeter2D"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Perimeter2D — POLYGONまたはMULTIPOLYGONジオメトリの場合に、2次元周囲長を返します。これは、現在はST_Perimeterの別名です。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_Perimeter2D</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp77332808"></a><h2>説明</h2><p>POLYGONまたはMULTIPOLYGONジオメトリの場合に、2次元周囲長を返します。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これは、現在はST_Perimeterの別名です。将来的に、ST_Perimeterがジオメトリの最大次元の周囲長を返すようになるかも知れません。これは、まだ考慮中です。</p></td></tr></table></div></div><div class="refsection"><a name="idp77335240"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Perimeter" title="ST_Perimeter">ST_Perimeter</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_3DPerimeter"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_3DPerimeter — POLYGONまたはMULTIPOLYGONジオメトリの場合には、3次元周囲長を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_3DPerimeter</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp77341000"></a><h2>説明</h2><p>POLYGONまたはMULTIPOLYGONジオメトリの場合には、3次元周囲長を返します。ジオメトリが2次元の場合には、2次元周囲長を返します。 </p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p>Changed: 2.0.0 以前の版ではST_Perimeter3Dと呼ばれていました。</p></div><div class="refsection"><a name="idp77343944"></a><h2>例</h2><p>フィート単位のマサチューセッツ州平面での、大気中にある、わずかに持ち上げられたポリゴンの周囲長です。</p><pre class="programlisting">SELECT ST_3DPerimeter(the_geom), ST_Perimeter2d(the_geom), ST_Perimeter(the_geom) FROM
                        (SELECT ST_GeomFromEWKT('SRID=2249;POLYGON((743238 2967416 2,743238 2967450 1,
743265.625 2967416 1,743238 2967416 2))') As the_geom) As foo;

  ST_3DPerimeter  |  st_perimeter2d  |   st_perimeter
------------------+------------------+------------------
 105.465793597674 | 105.432997272188 | 105.432997272188

</pre></div><div class="refsection"><a name="idp77345864"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a>, <a class="xref" href="#ST_Perimeter" title="ST_Perimeter">ST_Perimeter</a>, <a class="xref" href="#ST_Perimeter2D" title="ST_Perimeter2D">ST_Perimeter2D</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_PointOnSurface"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_PointOnSurface — サーフェス上にあることを保障された<code class="varname">POINT</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_PointOnSurface</b>(</code>geometry  <var class="pdparam">g1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp77352776"></a><h2>説明</h2><p>サーフェス上にあることを保障された<code class="varname">POINT</code>を返します。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a> s3.2.14.2 // s3.2.18.2</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 8.1.5, 9.5.6. 仕様によると、ST_PointOnSurfaceは面ジオメトリ (POLYGON, MULTIPOLYGON, 曲線ポリゴン)で動作します。PostGISは、仕様で許される以上に拡張しているように見えます。Oracle, DB II, ESRI SDEといったほとんどのデータベースでは、面ジオメトリにのみ対応しているように見えます。SQL Server 2008は、PostGISのように全ての一般的なジオメトリに対応しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp77358792"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(ST_PointOnSurface('POINT(0 5)'::geometry));
 st_astext
------------
 POINT(0 5)
(1 row)

SELECT ST_AsText(ST_PointOnSurface('LINESTRING(0 5, 0 10)'::geometry));
 st_astext
------------
 POINT(0 5)
(1 row)

SELECT ST_AsText(ST_PointOnSurface('POLYGON((0 0, 0 5, 5 5, 5 0, 0 0))'::geometry));
   st_astext
----------------
 POINT(2.5 2.5)
(1 row)

SELECT ST_AsEWKT(ST_PointOnSurface(ST_GeomFromEWKT('LINESTRING(0 5 1, 0 0 1, 0 10 2)')));
   st_asewkt
----------------
 POINT(0 0 1)
(1 row)
</pre></div><div class="refsection"><a name="idp77360072"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Centroid" title="ST_Centroid">ST_Centroid</a>, <a class="xref" href="#ST_Point_Inside_Circle" title="ST_PointInsideCircle">ST_PointInsideCircle</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Project"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Project — メートル単位の距離とラジアン単位の方位とを使って始点から算出された<code class="varname">POINT</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geography <b class="fsfunc">ST_Project</b>(</code>geography  <var class="pdparam">g1</var>, float  <var class="pdparam">distance</var>, float  <var class="pdparam">azimuth</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp77368648"></a><h2>説明</h2><p>ラジアン単位の方位とメートル単位の距離を使って、始点から測地線に沿って移動した<code class="varname">POINT</code>を返します。これは測地線問題と言われるものです。</p><p>方位はナビゲーションでは時々ヘディングまたはベアリングと呼ばれます。 真北 (0度)との相対値です。東が90 (π/2)で、南が180 (π)、西が270 (3π/2)となります。</p><p>距離はメートル単位です。</p><p>Availability: 2.0.0</p><p>Enhanced: 2.4.0 負の距離と非正規化方位を許容するようになりました</p></div><div class="refsection"><a name="idp77371848"></a><h2>例: 度を使用する例 - 100,000メートルと方位45度で位置計算される点 </h2><pre class="programlisting">SELECT ST_AsText(ST_Project('POINT(0 0)'::geography, 100000, radians(45.0)));

                 st_astext
--------------------------------------------
 POINT(0.635231029125537 0.639472334729198)
(1 row)
      </pre></div><div class="refsection"><a name="idp77373128"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Azimuth" title="ST_Azimuth">ST_Azimuth</a>, <a class="xref" href="#ST_Distance" title="ST_Distance">ST_Distance</a>, <a class="ulink" href="http://www.postgresql.org/docs/current/interactive/functions-math.html" target="_top">PostgreSQL Math Functions</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Relate"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Relate — intersectionMatrixPatternの値について、二つのジオメトリの内部、境界、外部のインタセクションを見て、指定したジオメトリがもうひとつのジオメトリと空間的に関係している場合に、TRUEを返します。intersectionMatrixPatternが無い場合には、二つのジオメトリについての最大のintersectionMatrixPatternを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_Relate</b>(</code>geometry  <var class="pdparam">geomA</var>, geometry  <var class="pdparam">geomB</var>, text  <var class="pdparam">intersectionMatrixPattern</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">ST_Relate</b>(</code>geometry  <var class="pdparam">geomA</var>, geometry  <var class="pdparam">geomB</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">ST_Relate</b>(</code>geometry  <var class="pdparam">geomA</var>, geometry  <var class="pdparam">geomB</var>, integer  <var class="pdparam">BoundaryNodeRule</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp77389256"></a><h2>説明</h2><p>一つ目の形式: geomA, geomB, intersectionMatrixを取り、<a class="ulink" href="http://en.wikipedia.org/wiki/DE-9IM" target="_top">DE-9IM matrix pattern</a>の値によって指定される、二つのジオメトリの内部、境界、外部のインタセクションを見て、指定したジオメトリがもう一つのジオメトリと空間的に関係している場合に1 (TRUE)を返します。</p><p>これは特にインタセクト、クロス等の複合チェックを一度に行うために使われます。</p><p>ジオメトリコレクションを引数として呼ばないでください。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これは論理値を返して整数を返さないのが「許される」版です。これはOGC仕様で定められています。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数は、自動的にはインデクスを*呼びだしません*。非接続など、関連が否定的になるものがあるためです。インタセクションを必要とするパターンの関連を使うのでしたら、&amp;&amp;演算子でインデクスを呼び出して下さい。</p></td></tr></table></div><p>二つ目の形式: geomAとgeomBを取り、<a class="xref" href="#DE-9IM" title="4.3.6. ここで、Dimensionally Extended 9 Intersection Modelまたは略してDE-9IMを見てみましょう。">「ここで、Dimensionally Extended 9 Intersection Modelまたは略してDE-9IMを見てみましょう。」</a>を返します。</p><p>三つ目の形式: 二つ目の形式と同じですが、境界ノード規則 (1:OGC/MOD2, 2:Endpoint, 3:MultivalentEndpoint, 4:MonovalentEndpoint)を指定できます。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ジオメトリコレクションを引数として呼ばないでください。</p></td></tr></table></div><p>OGC仕様にはありませんが実装しました。s2.1.13.2をご覧下さい。</p><p>GEOSモジュールによって実現しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a> s2.1.1.2 // s2.1.13.3</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 5.1.25</p><p>Enhanced: 2.0.0 - 境界ノード規則が追加されました (GEOS 3.0以上が必要です)。</p></div><div class="refsection"><a name="idp77402824"></a><h2>例</h2><pre class="programlisting">-- あるポリゴンとインタセクトして接触しない (内部でインタセクトする)区域を
-- 探索します。
SELECT l.* , b.name As poly_name
        FROM polys As b
INNER JOIN compounds As l
ON (p.the_geom &amp;&amp; b.the_geom
AND ST_Relate(l.the_geom, b.the_geom,'T********'));

SELECT ST_Relate(ST_GeometryFromText('POINT(1 2)'), ST_Buffer(ST_GeometryFromText('POINT(1 2)'),2));
st_relate
-----------
0FFFFF212

SELECT ST_Relate(ST_GeometryFromText('LINESTRING(1 2, 3 4)'), ST_GeometryFromText('LINESTRING(5 6, 7 8)'));
st_relate
-----------
FF1FF0102


SELECT ST_Relate(ST_GeometryFromText('POINT(1 2)'), ST_Buffer(ST_GeometryFromText('POINT(1 2)'),2), '0FFFFF212');
st_relate
-----------
t

SELECT ST_Relate(ST_GeometryFromText('POINT(1 2)'), ST_Buffer(ST_GeometryFromText('POINT(1 2)'),2), '*FF*FF212');
st_relate
-----------
t
                </pre></div><div class="refsection"><a name="idp77404360"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Crosses" title="ST_Crosses">ST_Crosses</a>, <a class="xref" href="#DE-9IM" title="4.3.6. ここで、Dimensionally Extended 9 Intersection Modelまたは略してDE-9IMを見てみましょう。">「ここで、Dimensionally Extended 9 Intersection Modelまたは略してDE-9IMを見てみましょう。」</a>, <a class="xref" href="#ST_Disjoint" title="ST_Disjoint">ST_Disjoint</a>, <a class="xref" href="#ST_Intersects" title="ST_Intersects">ST_Intersects</a>, <a class="xref" href="#ST_Touches" title="ST_Touches">ST_Touches</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_RelateMatch"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_RelateMatch — intersectionMattrixPattern1がintersectionMatrixPattern2を含む場合にTRUEを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_RelateMatch</b>(</code>text  <var class="pdparam">intersectionMatrix</var>, text  <var class="pdparam">intersectionMatrixPattern</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp77416776"></a><h2>説明</h2><p>intersectionMatrixとintersectionMatrixPatternを取り、intersectionMatrixがintersectionMatrixPatternを満たす場合にTRUEを返します。詳細情報については<a class="xref" href="#DE-9IM" title="4.3.6. ここで、Dimensionally Extended 9 Intersection Modelまたは略してDE-9IMを見てみましょう。">「ここで、Dimensionally Extended 9 Intersection Modelまたは略してDE-9IMを見てみましょう。」</a>をご覧下さい。 </p><p>Availability: 2.0.0 - GEOS 3.3.0以上が必要 </p></div><div class="refsection"><a name="idp77418696"></a><h2>例</h2><pre class="programlisting">SELECT ST_RelateMatch('101202FFF', 'TTTTTTFFF') ;
-- 結果--
t
-- 一般的なインタセクション行列パターンと
-- 不正なジオメトリ (内部と境界で共有部分を持つラインとポリゴン)を
-- 含む関係を比較する行列の例
SELECT mat.name, pat.name, ST_RelateMatch(mat.val, pat.val) As satisfied
    FROM
        ( VALUES ('Equality', 'T1FF1FFF1'),
                ('Overlaps', 'T*T***T**'),
                ('Within', 'T*F**F***'),
                ('Disjoint', 'FF*FF****') As pat(name,val)
        CROSS JOIN
            (        VALUES ('Self intersections (invalid)', '111111111'),
                    ('IE2_BI1_BB0_BE1_EI1_EE2', 'FF2101102'),
                    ('IB1_IE1_BB0_BE0_EI2_EI1_EE2', 'F11F00212')
            ) As mat(name,val);

                </pre></div><div class="refsection"><a name="idp77420232"></a><h2>関連情報</h2><p><a class="xref" href="#DE-9IM" title="4.3.6. ここで、Dimensionally Extended 9 Intersection Modelまたは略してDE-9IMを見てみましょう。">「ここで、Dimensionally Extended 9 Intersection Modelまたは略してDE-9IMを見てみましょう。」</a>, <a class="xref" href="#ST_Relate" title="ST_Relate">ST_Relate</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_ShortestLine"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ShortestLine — 二つのジオメトリの2次元長が最短となるラインを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_ShortestLine</b>(</code>geometry  <var class="pdparam">g1</var>, geometry  <var class="pdparam">g2</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp77439688"></a><h2>説明</h2><p>二つのジオメトリの2次元最短ラインを返します。複数発見した場合には、最初のラインを返します。g1とg2が1点でインタセクトする場合には、インタセクトした点を始点と終点として返します。g1とg2が複数点でインタセクトする場合には、インタセクトした点からなるラインを返しますが、どの点になるかは分かりません。返されるラインは常にg1が始点でg2が終点です。この関数が返すラインの長さは常にg1とg2を引数に取ったST_Distanceの返り値と同じです。 </p><p>Availability: 1.5.0</p></div><div class="refsection"><a name="idp77441224"></a><h2>例</h2><div class="informaltable"><table class="informaltable" border="1"><colgroup><col><col></colgroup><tbody><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_shortestline01.png"><div class="caption"><p>ポイントとラインストリングの最短ライン</p></div></div></div><p>
				</p><pre class="programlisting">SELECT ST_AsText(
        ST_ShortestLine('POINT(100 100)'::geometry,
                'LINESTRING (20 80, 98 190, 110 180, 50 75 )'::geometry)
        ) As sline;


   sline
-----------------
LINESTRING(100 100,73.0769230769231 115.384615384615)
                                </pre><p>
						  </p></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_shortestline02.png"><div class="caption"><p>ポリゴンとポリゴンの最短ライン</p></div></div></div><p>
				</p><pre class="programlisting">SELECT ST_AsText(
                ST_ShortestLine(
                        ST_GeomFromText('POLYGON((175 150, 20 40, 50 60, 125 100, 175 150))'),
                        ST_Buffer(ST_GeomFromText('POINT(110 170)'), 20)
                        )
                ) As slinewkt;

 LINESTRING(140.752120669087 125.695053378061,121.111404660392 153.370607753949)
                                </pre><p>
						</p></td></tr></tbody></table></div></div><div class="refsection"><a name="idp77462088"></a><h2>関連情報</h2><p><a class="xref" href="#ST_ClosestPoint" title="ST_ClosestPoint">ST_ClosestPoint</a>, <a class="xref" href="#ST_Distance" title="ST_Distance">ST_Distance</a>, <a class="xref" href="#ST_LongestLine" title="ST_LongestLine">ST_LongestLine</a>, <a class="xref" href="#ST_MaxDistance" title="ST_MaxDistance">ST_MaxDistance</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Touches"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Touches — ジオメトリが共通のポイントを少なくとも一つ持ち、かつ内部でインタセクトしない場合に、<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_Touches</b>(</code>geometry  <var class="pdparam">g1</var>, geometry  <var class="pdparam">g2</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp77470536"></a><h2>説明</h2><p><em class="parameter"><code>g1</code></em>と<em class="parameter"><code>g2</code></em>の共通部分の点が<em class="parameter"><code>g1</code></em>と<em class="parameter"><code>g2</code></em>の境界の結合上にある場合にTRUEを返します。ST_Touchesは、面/面, 線/線, 線/面, 点/面, 点/線の全てを受け付けますが、点/点は<span class="emphasis"><em>受け付けません</em></span>。</p><p>数学用語で言うと、この述語は次のように表現されます。</p><div class="informalfigure"><div class="mediaobject"><img src="images/st_touches-math.gif"></div></div><p>二つのジオメトリに対して許されるDE-9IMは次のようになります。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="markup">FT*******</span></p></li><li class="listitem"><p><span class="markup">F**T*****</span></p></li><li class="listitem"><p><span class="markup">F***T****</span></p></li></ul></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[重要]" src="images/important.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">GEOMETRYCOLLECTION</code>を引数として呼ばないでください。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数の呼び出しによって、ジオメトリで使用可能なインデクスを使用したバウンディングボックスの比較が自動的に行われます。インデクスの使用を避けるには<code class="function">_ST_Touches</code>を使います。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a> s2.1.1.2 // s2.1.13.3</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 5.1.28</p></div><div class="refsection"><a name="idp77484872"></a><h2>例</h2><p>次に示す図全てで、<code class="function">ST_Touches</code>は<code class="varname">TRUE</code>を返します。</p><div class="informaltable"><table class="informaltable" border="1"><colgroup><col><col><col></colgroup><tbody><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_touches01.png"><div class="caption"><p><code class="varname">POLYGON</code> / <code class="varname">POLYGON</code></p></div></div></div></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_touches02.png"><div class="caption"><p><code class="varname">POLYGON</code> / <code class="varname">POLYGON</code></p></div></div></div></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_touches03.png"><div class="caption"><p><code class="varname">POLYGON</code> / <code class="varname">LINESTRING</code></p></div></div></div></td></tr><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_touches04.png"><div class="caption"><p><code class="varname">LINESTRING</code> / <code class="varname">LINESTRING</code></p></div></div></div></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_touches05.png"><div class="caption"><p><code class="varname">LINESTRING</code> / <code class="varname">LINESTRING</code></p></div></div></div></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_touches06.png"><div class="caption"><p><code class="varname">POLYGON</code> / <code class="varname">POINT</code></p></div></div></div></td></tr></tbody></table></div><pre class="programlisting">SELECT ST_Touches('LINESTRING(0 0, 1 1, 0 2)'::geometry, 'POINT(1 1)'::geometry);
 st_touches
------------
 f
(1 row)

SELECT ST_Touches('LINESTRING(0 0, 1 1, 0 2)'::geometry, 'POINT(0 2)'::geometry);
 st_touches
------------
 t
(1 row)</pre></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Within"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Within — ジオメトリAが完全にジオメトリBの内側にある場合にTRUEを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_Within</b>(</code>geometry  <var class="pdparam">A</var>, geometry  <var class="pdparam">B</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp77512648"></a><h2>説明</h2><p>ジオメトリAが完全にジオメトリBの内側にある場合にTRUEを返します。この関数が意味を持つためには、与えられるジオメトリは両方とも同じ座標系で同じSRIDを持つ必要があります。ST_Within(A,B)がTRUEかつST_Within(B,A)がTRUEである場合には、二つのジオメトリは空間的に同じであると考えられます。</p><p>GEOSモジュールによって実現しています。</p><p>Enhanced: 2.3.0 ジオメトリについて、PIP short-circuit (ポリゴンとポイントに限定した高速判定)を少ないポイントからなるマルチポイントに対応することができるよう拡張しました。以前の版ではポリゴンとポイントの組み合わせにだけ対応していました。</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[重要]" src="images/important.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">GEOMETRYCOLLECTION</code>を引数として呼ばないでください。</p></td></tr></table></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[重要]" src="images/important.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数を不正なジオメトリで呼ばないでください。予期しない結果が返されます。</p></td></tr></table></div><p>この関数の呼び出しによって、ジオメトリで使用可能なインデクスを使用したバウンディングボックスの比較が自動的に行われます。インデクスの使用を避けるには_ST_Withinを使います。</p><p>ご注意: これは論理値を返して整数を返さないのが「許される」版です。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a> s2.1.1.2 // s2.1.13.3 - a.Relate(b, 'T*F**F***') </p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 5.1.30</p></div><div class="refsection"><a name="idp77520328"></a><h2>例</h2><pre class="programlisting">-- 円の中にある円
SELECT ST_Within(smallc,smallc) As smallinsmall,
        ST_Within(smallc, bigc) As smallinbig,
        ST_Within(bigc,smallc) As biginsmall,
        ST_Within(ST_Union(smallc, bigc), bigc) as unioninbig,
        ST_Within(bigc, ST_Union(smallc, bigc)) as biginunion,
        ST_Equals(bigc, ST_Union(smallc, bigc)) as bigisunion
FROM
(
SELECT ST_Buffer(ST_GeomFromText('POINT(50 50)'), 20) As smallc,
        ST_Buffer(ST_GeomFromText('POINT(50 50)'), 40) As bigc) As foo;
-- 結果
 smallinsmall | smallinbig | biginsmall | unioninbig | biginunion | bigisunion
--------------+------------+------------+------------+------------+------------
 t            | t          | f          | t          | t          | t
(1 row)
                </pre><p><span class="inlinemediaobject"><img src="images/st_within01.png"></span> </p></div><div class="refsection"><a name="idp77523016"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Contains" title="ST_Contains">ST_Contains</a>, <a class="xref" href="#ST_Equals" title="ST_Equals">ST_Equals</a>, <a class="xref" href="#ST_IsValid" title="ST_IsValid">ST_IsValid</a></p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="reference_sfcgal"></a>8.10. SFCGAL関数</h2></div><div><div class="abstract"><p class="title"><b>概要</b></p><p>SFCGALは、高度な2次元と3次元の関数を提供するCGALのC++ラッパです。堅牢性のために、ジオメトリの座標は正確な有理数表現を持ちます。 </p><p>このライブラリのインストール手順は、SFCGALウェブページ<a class="ulink" href="http://www.sfcgal.org" target="_top">http://www.sfcgal.org/</a>にあります。関数をロードするには、<code class="code">CREATE EXTENSION postgis_sfcgal;</code>とします。 </p><p>SFCGAL関数には標準の関数を置き換えるものがあります (ST_Intersects, ST_Intersection, ST_Difference, ST_Union, ST_Area, ST_Distance)。標準の関数とSFCGAL関数とを切り替えるには、次の二つのいずれかを実行します。</p><pre class="programlisting">SET postgis.backend = sfcgal;</pre><p>および </p><pre class="programlisting">SET postgis.backend = geos;</pre><p>

        </p></div></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#postgis_sfcgal_version">postgis_sfcgal_version</a></span><span class="refpurpose"> — 使用しているSFCGALの版を返します</span></dt><dt><span class="refentrytitle"><a href="#ST_Extrude">ST_Extrude</a></span><span class="refpurpose"> — 関連するボリュームにサーフェスを押し出します。</span></dt><dt><span class="refentrytitle"><a href="#ST_StraightSkeleton">ST_StraightSkeleton</a></span><span class="refpurpose"> — ジオメトリからストレートスケルトンを計算します。</span></dt><dt><span class="refentrytitle"><a href="#ST_ApproximateMedialAxis">ST_ApproximateMedialAxis</a></span><span class="refpurpose"> — 面ジオメトリの近似的な中心軸を計算します。</span></dt><dt><span class="refentrytitle"><a href="#ST_IsPlanar">ST_IsPlanar</a></span><span class="refpurpose"> — サーフェスが平面であるかないかをチェックします。</span></dt><dt><span class="refentrytitle"><a href="#ST_Orientation">ST_Orientation</a></span><span class="refpurpose"> — サーフェスの方向を判定します。</span></dt><dt><span class="refentrytitle"><a href="#ST_ForceLHR">ST_ForceLHR</a></span><span class="refpurpose"> — LHR (Left Hand Rule)方向に強制します。</span></dt><dt><span class="refentrytitle"><a href="#ST_MinkowskiSum">ST_MinkowskiSum</a></span><span class="refpurpose"> — ミンコフスキー和を求めます。</span></dt><dt><span class="refentrytitle"><a href="#ST_3DIntersection">ST_3DIntersection</a></span><span class="refpurpose"> — 3次元のインタセクトした (共有する)部分を計算します。</span></dt><dt><span class="refentrytitle"><a href="#ST_3DDifference">ST_3DDifference</a></span><span class="refpurpose"> — 3次元の差分を計算します。</span></dt><dt><span class="refentrytitle"><a href="#ST_3DUnion">ST_3DUnion</a></span><span class="refpurpose"> — 3次元の結合を計算します。</span></dt><dt><span class="refentrytitle"><a href="#ST_3DArea">ST_3DArea</a></span><span class="refpurpose"> — 3次元の面ジオメトリの面積を計算します。立体の場合は0を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Tesselate">ST_Tesselate</a></span><span class="refpurpose"> — ポリゴンまたは多面体サーフェスのテッセレーションを計算し、TINまたはTINコレクションを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Volume">ST_Volume</a></span><span class="refpurpose"> — 3次元立体の体積を計算します。面ジオメトリは (閉じていても)0を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_MakeSolid">ST_MakeSolid</a></span><span class="refpurpose"> — ジオメトリを立体にキャストします。チェックはしません。妥当な立体を得るには、入力ジオメトリは閉じた多面体サーフェスか閉じたTINでなければなりません。</span></dt><dt><span class="refentrytitle"><a href="#ST_IsSolid">ST_IsSolid</a></span><span class="refpurpose"> — ジオメトリが立体であるかどうかをテストします。妥当性チェックは行いません。</span></dt></dl></div><div class="refentry"><a name="postgis_sfcgal_version"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>postgis_sfcgal_version — 使用しているSFCGALの版を返します</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">postgis_sfcgal_version</b>(</code><code>void)</code>;</p></div></div><div class="refsection"><a name="idp78795592"></a><h2>説明</h2><p>Availability: 2.1.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method needs SFCGAL backend.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Extrude"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Extrude — 関連するボリュームにサーフェスを押し出します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Extrude</b>(</code>geometry <var class="pdparam">geom</var>, float <var class="pdparam">x</var>, float <var class="pdparam">y</var>, float <var class="pdparam">z</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp78811080"></a><h2>説明</h2><p>Availability: 2.1.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method needs SFCGAL backend.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div><div class="refsection"><a name="idp78817864"></a><h2>例</h2><p>PostGIS関数<a class="xref" href="#ST_AsX3D" title="ST_AsX3D">ST_AsX3D</a>を使って3次元イメージを生成し、<a class="ulink" href="http://www.x3dom.org" target="_top">X3Dom HTML Javascript redering library</a>を使ってHTMLでの描画を行います。</p><div class="informaltable"><table class="informaltable" border="1"><colgroup><col><col></colgroup><tbody><tr><td><p>
						</p><pre class="programlisting">SELECT ST_Buffer(ST_GeomFromText('POINT(100 90)'),
  50, 'quad_segs=2'),0,0,30);</pre><p>
						</p><div class="informalfigure"><div class="mediaobject"><img src="images/st_extrude01.png"><div class="caption"><p>ポイントのバッファから形成された元の八角形</p></div></div></div>
					  </td><td><p>
					  </p><pre class="programlisting">ST_Extrude(ST_Buffer(ST_GeomFromText('POINT(100 90)'),
 50, 'quad_segs=2'),0,0,30);</pre><p>
					  </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_extrude02.png"><div class="caption"><p>Z方向に30単位押し出して得たPolyhedralSurfaceZ</p></div></div></div>
					  </td></tr><tr><td><p>
						</p><pre class="programlisting">SELECT ST_GeomFromText('LINESTRING(50 50, 100 90, 95 150)')</pre><p>
						</p><div class="informalfigure"><div class="mediaobject"><img src="images/st_extrude03.png"><div class="caption"><p>元のラインストリング</p></div></div></div>
					  </td><td><p>
					  </p><pre class="programlisting">SELECT ST_Extrude(
 ST_GeomFromText('LINESTRING(50 50, 100 90, 95 150)'),0,0,10));</pre><p>
					  </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_extrude04.png"><div class="caption"><p>ラインストリングをZ方向に押し出したPolyhedralSurfaceZ</p></div></div></div>
					  </td></tr></tbody></table></div></div><div class="refsection"><a name="idp78847048"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsX3D" title="ST_AsX3D">ST_AsX3D</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_StraightSkeleton"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_StraightSkeleton — ジオメトリからストレートスケルトンを計算します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_StraightSkeleton</b>(</code>geometry <var class="pdparam">geom</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp78852808"></a><h2>説明</h2><p>Availability: 2.1.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method needs SFCGAL backend.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div><div class="refsection"><a name="idp77782344"></a><h2>例</h2><pre class="programlisting">SELECT ST_StraightSkeleton(ST_GeomFromText('POLYGON (( 190 190, 10 190, 10 10, 190 10, 190 20, 160 30, 60 30, 60 130, 190 140, 190 190 ))'));</pre><div class="informaltable"><table class="informaltable" border="1"><colgroup><col><col></colgroup><tbody><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_straightskeleton01.png"><div class="caption"><p>元のポリゴン</p></div></div></div>
					  </td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_straightskeleton02.png"><div class="caption"><p>ポリゴンのストレートスケルトン</p></div></div></div>
					  </td></tr></tbody></table></div></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_ApproximateMedialAxis"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ApproximateMedialAxis — 面ジオメトリの近似的な中心軸を計算します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_ApproximateMedialAxis</b>(</code>geometry <var class="pdparam">geom</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp78859720"></a><h2>説明</h2><p>ストレートスケルトンを基に、入力された面の近似的な中心軸を返します。可能な版 (1.2.0以上)でビルドすると、SFCGAL独自APIを使います。そうでない場合はST_StraightSkeleton (遅い)のラップとなります。 </p><p>Availability: 2.2.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method needs SFCGAL backend.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div><div class="refsection"><a name="idp77855176"></a><h2>例</h2><pre class="programlisting">SELECT ST_ApproximateMedialAxis(ST_GeomFromText('POLYGON (( 190 190, 10 190, 10 10, 190 10, 190 20, 160 30, 60 30, 60 130, 190 140, 190 190 ))'));</pre><div class="informaltable"><table class="informaltable" border="1"><colgroup><col></colgroup><tbody><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_approximatemedialaxis01.png"><div class="caption"><p>ポリゴンと近似的な中心軸</p></div></div></div>
					  </td></tr></tbody></table></div></div><div class="refsection"><a name="idp78864072"></a><h2>関連情報</h2><p><a class="xref" href="#ST_StraightSkeleton" title="ST_StraightSkeleton">ST_StraightSkeleton</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_IsPlanar"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_IsPlanar — サーフェスが平面であるかないかをチェックします。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_IsPlanar</b>(</code>geometry <var class="pdparam">geom</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp78869832"></a><h2>説明</h2><p>Availability: 2.2.0: これは2.1.0のマニュアルに記述されていましたが、2.1版では偶然に外れてしまいました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method needs SFCGAL backend.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Orientation"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Orientation — サーフェスの方向を判定します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_Orientation</b>(</code>geometry <var class="pdparam">geom</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp78881096"></a><h2>説明</h2><p>この関数はポリゴンのみ受け付けます。ポリゴンが反時計回りなら-1を返し、時計回りなら1を返します。</p><p>Availability: 2.1.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method needs SFCGAL backend.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_ForceLHR"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ForceLHR — LHR (Left Hand Rule)方向に強制します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_ForceLHR</b>(</code>geometry <var class="pdparam">geom</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp78889928"></a><h2>説明</h2><p>Availability: 2.1.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method needs SFCGAL backend.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_MinkowskiSum"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MinkowskiSum — ミンコフスキー和を求めます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_MinkowskiSum</b>(</code>geometry <var class="pdparam">geom1</var>, geometry <var class="pdparam">geom2</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp78902216"></a><h2>説明</h2><p>ポリゴンと、ポイント、ライン、ポリゴンのいずれかとの2次元のミンコフスキー和を計算します。</p><p>二つのジオメトリAとBのミンコフスキー和はAとBのあらゆるポイントの和の集合です。ミンコフスキー和は、しばしば動作計画とCADで使われます。より詳細な情報について<a class="ulink" href="https://en.wikipedia.org/wiki/Minkowski_addition" target="_top">Wikipedia Minkowski addition</a>をご覧ください。</p><p>一つ目の引数は2次元ジオメトリ (ポイント、ラインストリング、ポリゴン)とすることができます。3次元ジオメトリを渡すと、Zを0とした2次元に強制され、この場合は無効と考えられます。二つ目の引数は2次元ポリゴンでなければなりません。</p><p><a class="ulink" href="http://doc.cgal.org/latest/Minkowski_sum_2/" target="_top">CGAL 2D Minkowskisum</a>を利用して実装しています。</p><p>Availability: 2.1.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method needs SFCGAL backend.</p></div><div class="refsection"><a name="idp78907208"></a><h2>例</h2><p>ラインストリングと円ポリゴンであって、ラインストリングがポリゴンを横切るミンコフスキー和</p><div class="informaltable"><table class="informaltable" border="1"><colgroup><col><col></colgroup><tbody><tr><td>
                         <p>
                            </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_minkowskisum01.png"><div class="caption"><p>ミンコフスキー和を実行する前</p></div></div></div><p>
                                               </p>
                        </td><td>
                           <p>
                            </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_minkowskisum02.png"><div class="caption"><p>ミンコフスキー和実行後</p></div></div></div><p>
                                              </p>
                        </td></tr></tbody></table></div><pre class="programlisting">SELECT ST_MinkowskiSum(line, circle))
FROM (SELECT
    ST_MakeLine(ST_MakePoint(10, 10),ST_MakePoint(100, 100)) As line,
    ST_Buffer(ST_GeomFromText('POINT(50 50)'), 30) As circle) As foo;

-- wkt --
MULTIPOLYGON(((30 59.9999999999999,30.5764415879031 54.1472903395161,32.2836140246614 48.5194970290472,35.0559116309237 43.3328930094119,38.7867965644036 38.7867965644035,43.332893009412 35.0559116309236,48.5194970290474 32.2836140246614,54.1472903395162 30.5764415879031,60.0000000000001 30,65.8527096604839 30.5764415879031,71.4805029709527 32.2836140246614,76.6671069905881 35.0559116309237,81.2132034355964 38.7867965644036,171.213203435596 128.786796564404,174.944088369076 133.332893009412,177.716385975339 138.519497029047,179.423558412097 144.147290339516,180 150,179.423558412097 155.852709660484,177.716385975339 161.480502970953,174.944088369076 166.667106990588,171.213203435596 171.213203435596,166.667106990588 174.944088369076,
161.480502970953 177.716385975339,155.852709660484 179.423558412097,150 180,144.147290339516 179.423558412097,138.519497029047 177.716385975339,133.332893009412 174.944088369076,128.786796564403 171.213203435596,38.7867965644035 81.2132034355963,35.0559116309236 76.667106990588,32.2836140246614 71.4805029709526,30.5764415879031 65.8527096604838,30 59.9999999999999)))
            </pre><p>ポリゴンとマルチポイントとのミンコフスキー和</p><div class="informaltable"><table class="informaltable" border="1"><colgroup><col><col></colgroup><tbody><tr><td>
                         <p>
                            </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_minkowskisum03.png"><div class="caption"><p>ミンコフスキー和を実行する前</p></div></div></div><p>
                          </p>
                        </td><td>
                           <p>
                            </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_minkowskisum04.png"><div class="caption"><p>ミンコフスキー和実行後: ポリゴンが二つになり、ポイントの位置に移動しています。</p></div></div></div><p>
                           </p>
                        </td></tr></tbody></table></div><pre class="programlisting">SELECT ST_MinkowskiSum(mp, poly)
FROM (SELECT 'MULTIPOINT(25 50,70 25)'::geometry As mp,
   'POLYGON((130 150, 20 40, 50 60, 125 100, 130 150))'::geometry As poly
    ) As foo


-- wkt --
MULTIPOLYGON(
    ((70 115,100 135,175 175,225 225,70 115)),
    ((120 65,150 85,225 125,275 175,120 65))
    )
            </pre></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_3DIntersection"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_3DIntersection — 3次元のインタセクトした (共有する)部分を計算します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_3DIntersection</b>(</code>geometry <var class="pdparam">geom1</var>, geometry <var class="pdparam">geom2</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp78930376"></a><h2>説明</h2><p>geom1とgeom2の間で共有される部分のジオメトリを返します。</p><p>Availability: 2.1.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method needs SFCGAL backend.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div><div class="refsection"><a name="idp78941640"></a><h2>例</h2><p>PostGIS関数<a class="xref" href="#ST_AsX3D" title="ST_AsX3D">ST_AsX3D</a>を使って3次元イメージを生成し、<a class="ulink" href="http://www.x3dom.org" target="_top">X3Dom HTML Javascript redering library</a>を使ってHTMLでの描画を行います。</p><div class="informaltable"><table class="informaltable" border="1"><colgroup><col><col></colgroup><tbody><tr><td><p>
                </p><pre class="programlisting">SELECT ST_Extrude(ST_Buffer(ST_GeomFromText('POINT(100 90)'),
 50, 'quad_segs=2'),0,0,30) AS geom1,
        ST_Extrude(ST_Buffer(ST_GeomFromText('POINT(80 80)'),
 50, 'quad_segs=1'),0,0,30) AS geom2;
                </pre><p>
                </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_3ddifference01.png"><div class="caption"><p>元の3次元ジオメトリを重ねたもの。geom2は半透明で示しています。</p></div></div></div>
              </td><td><p>
              </p><pre class="programlisting">SELECT ST_3DIntersection(geom1,geom2)
FROM ( SELECT ST_Extrude(ST_Buffer(ST_GeomFromText('POINT(100 90)'),
 50, 'quad_segs=2'),0,0,30) AS geom1,
        ST_Extrude(ST_Buffer(ST_GeomFromText('POINT(80 80)'),
 50, 'quad_segs=1'),0,0,30) AS geom2 ) As t;</pre><p>
              </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_3dintersection01.png"><div class="caption"><p>geom1とgeom2の共有部分</p></div></div></div>
              </td></tr></tbody></table></div><p>3次元ラインストリングとポリゴン</p><pre class="programlisting">SELECT ST_AsText(ST_3DIntersection(linestring, polygon)) As wkt
FROM  ST_GeomFromText('LINESTRING Z (2 2 6,1.5 1.5 7,1 1 8,0.5 0.5 8,0 0 10)') AS linestring
 CROSS JOIN ST_GeomFromText('POLYGON((0 0 8, 0 1 8, 1 1 8, 1 0 8, 0 0 8))') AS polygon;

              wkt
--------------------------------
 LINESTRING Z (1 1 8,0.5 0.5 8)
                </pre><p>立方体 (閉じた多面体サーフェス)と3次元ポリゴン</p><pre class="programlisting">SELECT ST_AsText(ST_3DIntersection(
                ST_GeomFromText('POLYHEDRALSURFACE Z( ((0 0 0, 0 0 1, 0 1 1, 0 1 0, 0 0 0)),
        ((0 0 0, 0 1 0, 1 1 0, 1 0 0, 0 0 0)), ((0 0 0, 1 0 0, 1 0 1, 0 0 1, 0 0 0)),
        ((1 1 0, 1 1 1, 1 0 1, 1 0 0, 1 1 0)),
        ((0 1 0, 0 1 1, 1 1 1, 1 1 0, 0 1 0)), ((0 0 1, 1 0 1, 1 1 1, 0 1 1, 0 0 1)) )'),
        'POLYGON Z ((0 0 0, 0 0 0.5, 0 0.5 0.5, 0 0.5 0, 0 0 0))'::geometry))</pre><pre class="screen">TIN Z (((0 0 0,0 0 0.5,0 0.5 0.5,0 0 0)),((0 0.5 0,0 0 0,0 0.5 0.5,0 0.5 0)))</pre><p>二つの立体の共通部分もまた立体です (ST_Dimensionで3を返します)。</p><pre class="programlisting">SELECT ST_AsText(ST_3DIntersection( ST_Extrude(ST_Buffer('POINT(10 20)'::geometry,10,1),0,0,30),
 ST_Extrude(ST_Buffer('POINT(10 20)'::geometry,10,1),2,0,10) ));</pre><pre class="screen">POLYHEDRALSURFACE Z (((13.3333333333333 13.3333333333333 10,20 20 0,20 20 10,13.3333333333333 13.3333333333333 10)),
        ((20 20 10,16.6666666666667 23.3333333333333 10,13.3333333333333 13.3333333333333 10,20 20 10)),
        ((20 20 0,16.6666666666667 23.3333333333333 10,20 20 10,20 20 0)),
        ((13.3333333333333 13.3333333333333 10,10 10 0,20 20 0,13.3333333333333 13.3333333333333 10)),
        ((16.6666666666667 23.3333333333333 10,12 28 10,13.3333333333333 13.3333333333333 10,16.6666666666667 23.3333333333333 10)),
        ((20 20 0,9.99999999999995 30 0,16.6666666666667 23.3333333333333 10,20 20 0)),
        ((10 10 0,9.99999999999995 30 0,20 20 0,10 10 0)),((13.3333333333333 13.3333333333333 10,12 12 10,10 10 0,13.3333333333333 13.3333333333333 10)),
        ((12 28 10,12 12 10,13.3333333333333 13.3333333333333 10,12 28 10)),
        ((16.6666666666667 23.3333333333333 10,9.99999999999995 30 0,12 28 10,16.6666666666667 23.3333333333333 10)),
        ((10 10 0,0 20 0,9.99999999999995 30 0,10 10 0)),
        ((12 12 10,11 11 10,10 10 0,12 12 10)),((12 28 10,11 11 10,12 12 10,12 28 10)),
        ((9.99999999999995 30 0,11 29 10,12 28 10,9.99999999999995 30 0)),((0 20 0,2 20 10,9.99999999999995 30 0,0 20 0)),
        ((10 10 0,2 20 10,0 20 0,10 10 0)),((11 11 10,2 20 10,10 10 0,11 11 10)),((12 28 10,11 29 10,11 11 10,12 28 10)),
        ((9.99999999999995 30 0,2 20 10,11 29 10,9.99999999999995 30 0)),((11 11 10,11 29 10,2 20 10,11 11 10)))</pre></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_3DDifference"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_3DDifference — 3次元の差分を計算します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_3DDifference</b>(</code>geometry <var class="pdparam">geom1</var>, geometry <var class="pdparam">geom2</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp78973256"></a><h2>説明</h2><p>geom2に含まれないgeom1の一部を返します</p><p>Availability: 2.2.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method needs SFCGAL backend.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div><div class="refsection"><a name="idp78980424"></a><h2>例</h2><p>PostGIS関数<a class="xref" href="#ST_AsX3D" title="ST_AsX3D">ST_AsX3D</a>を使って3次元イメージを生成し、<a class="ulink" href="http://www.x3dom.org" target="_top">X3Dom HTML Javascript redering library</a>を使ってHTMLでの描画を行います。</p><div class="informaltable"><table class="informaltable" border="1"><colgroup><col><col></colgroup><tbody><tr><td><p>
                </p><pre class="programlisting">SELECT ST_Extrude(ST_Buffer(ST_GeomFromText('POINT(100 90)'),
 50, 'quad_segs=2'),0,0,30) AS geom1,
        ST_Extrude(ST_Buffer(ST_GeomFromText('POINT(80 80)'),
 50, 'quad_segs=1'),0,0,30) AS geom2;
                </pre><p>
                </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_3ddifference01.png"><div class="caption"><p>元の3次元ジオメトリを重ねたもの。geom2は削除部分にあたります。</p></div></div></div>
              </td><td><p>
              </p><pre class="programlisting">SELECT ST_3DDifference(geom1,geom2)
FROM ( SELECT ST_Extrude(ST_Buffer(ST_GeomFromText('POINT(100 90)'),
 50, 'quad_segs=2'),0,0,30) AS geom1,
        ST_Extrude(ST_Buffer(ST_GeomFromText('POINT(80 80)'),
 50, 'quad_segs=1'),0,0,30) AS geom2 ) As t;</pre><p>
              </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_3ddifference02.png"><div class="caption"><p>geom2を削除した後に残るもの</p></div></div></div>
              </td></tr></tbody></table></div></div><div class="refsection"><a name="idp78990536"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Extrude" title="ST_Extrude">ST_Extrude</a>, <a class="xref" href="#ST_AsX3D" title="ST_AsX3D">ST_AsX3D</a>, <a class="xref" href="#ST_3DIntersection" title="ST_3DIntersection">ST_3DIntersection</a> <a class="xref" href="#ST_3DUnion" title="ST_3DUnion">ST_3DUnion</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_3DUnion"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_3DUnion — 3次元の結合を計算します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_3DUnion</b>(</code>geometry <var class="pdparam">geom1</var>, geometry <var class="pdparam">geom2</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp78998600"></a><h2>説明</h2><p>Availability: 2.2.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method needs SFCGAL backend.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div><div class="refsection"><a name="idp79005384"></a><h2>例</h2><p>PostGIS関数<a class="xref" href="#ST_AsX3D" title="ST_AsX3D">ST_AsX3D</a>を使って3次元イメージを生成し、<a class="ulink" href="http://www.x3dom.org" target="_top">X3Dom HTML Javascript redering library</a>を使ってHTMLでの描画を行います。</p><div class="informaltable"><table class="informaltable" border="1"><colgroup><col><col></colgroup><tbody><tr><td><p>
                </p><pre class="programlisting">SELECT ST_Extrude(ST_Buffer(ST_GeomFromText('POINT(100 90)'),
 50, 'quad_segs=2'),0,0,30) AS geom1,
        ST_Extrude(ST_Buffer(ST_GeomFromText('POINT(80 80)'),
 50, 'quad_segs=1'),0,0,30) AS geom2;
                </pre><p>
                </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_3ddifference01.png"><div class="caption"><p>元の3次元ジオメトリを重ねたもの。geom2は半透明で示しています。</p></div></div></div>
              </td><td><p>
              </p><pre class="programlisting">SELECT ST_3DUnion(geom1,geom2)
FROM ( SELECT ST_Extrude(ST_Buffer(ST_GeomFromText('POINT(100 90)'),
 50, 'quad_segs=2'),0,0,30) AS geom1,
        ST_Extrude(ST_Buffer(ST_GeomFromText('POINT(80 80)'),
 50, 'quad_segs=1'),0,0,30) AS geom2 ) As t;</pre><p>
              </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_3dunion01.png"><div class="caption"><p>geom1とgeom2の結合</p></div></div></div>
              </td></tr></tbody></table></div></div><div class="refsection"><a name="idp79044168"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Extrude" title="ST_Extrude">ST_Extrude</a>, <a class="xref" href="#ST_AsX3D" title="ST_AsX3D">ST_AsX3D</a>, <a class="xref" href="#ST_3DIntersection" title="ST_3DIntersection">ST_3DIntersection</a> <a class="xref" href="#ST_3DDifference" title="ST_3DDifference">ST_3DDifference</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_3DArea"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_3DArea — 3次元の面ジオメトリの面積を計算します。立体の場合は0を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float<b class="fsfunc">ST_3DArea</b>(</code>geometry <var class="pdparam">geom1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp79051208"></a><h2>説明</h2><p>Availability: 2.1.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method needs SFCGAL backend.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div><div class="refsection"><a name="idp79057992"></a><h2>例</h2><p>ご注意: デフォルトでは、WKTから生成されたPolyhedralSurfaceは面ジオメトリで、立体ではありません。サーフェス面を持ちます。立体に変換すると、面を持ちません。</p><pre class="programlisting">SELECT ST_3DArea(geom) As cube_surface_area,
        ST_3DArea(ST_MakeSolid(geom)) As solid_surface_area
  FROM (SELECT 'POLYHEDRALSURFACE( ((0 0 0, 0 0 1, 0 1 1, 0 1 0, 0 0 0)),
    ((0 0 0, 0 1 0, 1 1 0, 1 0 0, 0 0 0)),
    ((0 0 0, 1 0 0, 1 0 1, 0 0 1, 0 0 0)),
    ((1 1 0, 1 1 1, 1 0 1, 1 0 0, 1 1 0)),
    ((0 1 0, 0 1 1, 1 1 1, 1 1 0, 0 1 0)),
    ((0 0 1, 1 0 1, 1 1 1, 0 1 1, 0 0 1)) )'::geometry) As f(geom);

 cube_surface_area | solid_surface_area
-------------------+--------------------
                 6 |                  0    </pre></div><div class="refsection"><a name="idp79059528"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Area" title="ST_Area">ST_Area</a>, <a class="xref" href="#ST_MakeSolid" title="ST_MakeSolid">ST_MakeSolid</a>, <a class="xref" href="#ST_IsSolid" title="ST_IsSolid">ST_IsSolid</a>, <a class="xref" href="#ST_Area" title="ST_Area">ST_Area</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Tesselate"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Tesselate — ポリゴンまたは多面体サーフェスのテッセレーションを計算し、TINまたはTINコレクションを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Tesselate</b>(</code>geometry <var class="pdparam">geom</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp79066440"></a><h2>説明</h2><p>(MULTI)POLYGONまたはPOLYHEDRALSURFACEのような面を入力に取り、三角形を使ったテッセレーション処理を通してTIN表現を返します。</p><p>Availability: 2.1.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method needs SFCGAL backend.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div><div class="refsection"><a name="idp79073608"></a><h2>例</h2><div class="informaltable"><table class="informaltable" border="1"><colgroup><col><col></colgroup><tbody><tr><td><p>
						</p><pre class="programlisting">SELECT ST_GeomFromText('POLYHEDRALSURFACE Z( ((0 0 0, 0 0 1, 0 1 1, 0 1 0, 0 0 0)),
                ((0 0 0, 0 1 0, 1 1 0, 1 0 0, 0 0 0)), ((0 0 0, 1 0 0, 1 0 1, 0 0 1, 0 0 0)),
                ((1 1 0, 1 1 1, 1 0 1, 1 0 0, 1 1 0)),
                ((0 1 0, 0 1 1, 1 1 1, 1 1 0, 0 1 0)), ((0 0 1, 1 0 1, 1 1 1, 0 1 1, 0 0 1)) )');</pre><p>
						</p><div class="informalfigure"><div class="mediaobject"><img src="images/st_tesselate01.png"><div class="caption"><p>元の立方体</p></div></div></div>
					  </td><td><p>
					  </p><pre class="programlisting">SELECT ST_Tesselate(ST_GeomFromText('POLYHEDRALSURFACE Z( ((0 0 0, 0 0 1, 0 1 1, 0 1 0, 0 0 0)),
        ((0 0 0, 0 1 0, 1 1 0, 1 0 0, 0 0 0)), ((0 0 0, 1 0 0, 1 0 1, 0 0 1, 0 0 0)),
        ((1 1 0, 1 1 1, 1 0 1, 1 0 0, 1 1 0)),
        ((0 1 0, 0 1 1, 1 1 1, 1 1 0, 0 1 0)), ((0 0 1, 1 0 1, 1 1 1, 0 1 1, 0 0 1)) )'));</pre>
		<p>ST_AsTextの出力:</p>
		<pre class="screen">TIN Z (((0 0 0,0 0 1,0 1 1,0 0 0)),((0 1 0,0 0 0,0 1 1,0 1 0)),
        ((0 0 0,0 1 0,1 1 0,0 0 0)),
        ((1 0 0,0 0 0,1 1 0,1 0 0)),((0 0 1,1 0 0,1 0 1,0 0 1)),
        ((0 0 1,0 0 0,1 0 0,0 0 1)),
        ((1 1 0,1 1 1,1 0 1,1 1 0)),((1 0 0,1 1 0,1 0 1,1 0 0)),
        ((0 1 0,0 1 1,1 1 1,0 1 0)),((1 1 0,0 1 0,1 1 1,1 1 0)),
        ((0 1 1,1 0 1,1 1 1,0 1 1)),((0 1 1,0 0 1,1 0 1,0 1 1)))</pre>
		       <p> </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_tesselate02.png"><div class="caption"><p>彩色した三角形によるテッセレーションを施した立方体</p></div></div></div>
					  </td></tr><tr><td><p>
						</p><pre class="programlisting">SELECT 'POLYGON (( 10 190, 10 70, 80 70, 80 130, 50 160, 120 160, 120 190, 10 190 ))'::geometry;</pre><p>
						</p><div class="informalfigure"><div class="mediaobject"><img src="images/st_tesselate03.png"><div class="caption"><p>元のポリゴン</p></div></div></div>
					  </td><td><p>
					  </p><pre class="programlisting">SELECT
        ST_Tesselate('POLYGON (( 10 190, 10 70, 80 70, 80 130, 50 160, 120 160, 120 190, 10 190 ))'::geometry);</pre><p>
	</p>
	<p>ST_AsTextの出力:</p>
	<pre class="screen">TIN(((80 130,50 160,80 70,80 130)),((50 160,10 190,10 70,50 160)),
         ((80 70,50 160,10 70,80 70)),((120 160,120 190,50 160,120 160)),
 ((120 190,10 190,50 160,120 190)))</pre>
					  <div class="informalfigure"><div class="mediaobject"><img src="images/st_tesselate04.png"><div class="caption"><p>テッセレーションを施したポリゴン</p></div></div></div>
					  </td></tr></tbody></table></div></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Volume"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Volume — 3次元立体の体積を計算します。面ジオメトリは (閉じていても)0を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float <b class="fsfunc">ST_Volume</b>(</code>geometry <var class="pdparam">geom1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp79108296"></a><h2>説明</h2><p>Availability: 2.2.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method needs SFCGAL backend.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div><div class="refsection"><a name="idp79115080"></a><h2>例</h2><p>WKTで閉じた面を生成した時、それは立体でなく面として扱われるます。立体にするには<a class="xref" href="#ST_MakeSolid" title="ST_MakeSolid">ST_MakeSolid</a>を使います。面ジオメトリは堆積を持ちません。例を挙げます。</p><pre class="programlisting">SELECT ST_Volume(geom) As cube_surface_vol,
        ST_Volume(ST_MakeSolid(geom)) As solid_surface_vol
  FROM (SELECT 'POLYHEDRALSURFACE( ((0 0 0, 0 0 1, 0 1 1, 0 1 0, 0 0 0)),
    ((0 0 0, 0 1 0, 1 1 0, 1 0 0, 0 0 0)),
    ((0 0 0, 1 0 0, 1 0 1, 0 0 1, 0 0 0)),
    ((1 1 0, 1 1 1, 1 0 1, 1 0 0, 1 1 0)),
    ((0 1 0, 0 1 1, 1 1 1, 1 1 0, 0 1 0)),
    ((0 0 1, 1 0 1, 1 1 1, 0 1 1, 0 0 1)) )'::geometry) As f(geom);

 cube_surface_vol | solid_surface_vol
------------------+-------------------
                0 |                 1
              </pre></div><div class="refsection"><a name="idp79117128"></a><h2>関連情報</h2><p><a class="xref" href="#ST_3DArea" title="ST_3DArea">ST_3DArea</a>, <a class="xref" href="#ST_MakeSolid" title="ST_MakeSolid">ST_MakeSolid</a>, <a class="xref" href="#ST_IsSolid" title="ST_IsSolid">ST_IsSolid</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_MakeSolid"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MakeSolid — ジオメトリを立体にキャストします。チェックはしません。妥当な立体を得るには、入力ジオメトリは閉じた多面体サーフェスか閉じたTINでなければなりません。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry<b class="fsfunc">ST_MakeSolid</b>(</code>geometry <var class="pdparam">geom1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp79135944"></a><h2>説明</h2><p>Availability: 2.2.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method needs SFCGAL backend.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_IsSolid"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_IsSolid — ジオメトリが立体であるかどうかをテストします。妥当性チェックは行いません。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean<b class="fsfunc">ST_IsSolid</b>(</code>geometry <var class="pdparam">geom1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp79147208"></a><h2>説明</h2><p>Availability: 2.2.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method needs SFCGAL backend.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Geometry_Processing"></a>8.11. ジオメトリ処理関数</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#ST_Buffer">ST_Buffer</a></span><span class="refpurpose"> — (T) このジオメトリからの距離が指定された距離以下となる点全てを表現するジオメトリを返します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_BuildArea">ST_BuildArea</a></span><span class="refpurpose"> — 与えられたジオメトリの構成ラインから面ジオメトリを生成します。</span></dt><dt><span class="refentrytitle"><a href="#ST_ClipByBox2D">ST_ClipByBox2D</a></span><span class="refpurpose"> — 長方形内に落ちるジオメトリの一部を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Collect">ST_Collect</a></span><span class="refpurpose"> — 他のジオメトリのコレクションから、指定したST_Geometry値を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_ConcaveHull">ST_ConcaveHull</a></span><span class="refpurpose"> — 凹包は、集合の範囲内におけるすべてのジオメトリーを囲む、できる限り凹となるジオメトリを表現するものです。収縮包装とみることができます。</span></dt><dt><span class="refentrytitle"><a href="#ST_ConvexHull">ST_ConvexHull</a></span><span class="refpurpose"> — 凸包は与えられた集合の全てのジオメトリを含む最小の閉じた凸ジオメトリです。</span></dt><dt><span class="refentrytitle"><a href="#ST_CurveToLine">ST_CurveToLine</a></span><span class="refpurpose"> — CIRCULARSTRING/CURVEPOLYGONをLINESTRING/POLYGONに変換します。</span></dt><dt><span class="refentrytitle"><a href="#ST_DelaunayTriangles">ST_DelaunayTriangles</a></span><span class="refpurpose"> — 与えられたポイントの周りのドロネー三角形を返します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_Difference">ST_Difference</a></span><span class="refpurpose"> — ジオメトリBにインタセクトしないジオメトリAの部分を表現するジオメトリを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Dump">ST_Dump</a></span><span class="refpurpose"> — ジオメトリg1から作られたgeometry_dump(geom, path)行の集合を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_DumpPoints">ST_DumpPoints</a></span><span class="refpurpose"> — ジオメトリを作る全ての点のgometry_dump(geom,path)行の集合を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_DumpRings">ST_DumpRings</a></span><span class="refpurpose"> — ポリゴンの外環と内環を表す<code class="varname">geometry_dump</code>行の集合を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_FlipCoordinates">ST_FlipCoordinates</a></span><span class="refpurpose"> — 与えられたジオメトリのX軸とY軸とを入れ替えたものを返します。緯度/経度のフィーチャーを構築して、これを訂正したい場合に使えます。</span></dt><dt><span class="refentrytitle"><a href="#ST_GeneratePoints">ST_GeneratePoints</a></span><span class="refpurpose"> — ポリゴンまたはマルチポリゴンから、元の領域の内部の、乱数で決められた位置に置かれた点からなるマルチポイントに変換します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Intersection">ST_Intersection</a></span><span class="refpurpose"> — (T) geomAとgeomBの共有する部分を表現するジオメトリを返します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_LineToCurve">ST_LineToCurve</a></span><span class="refpurpose"> — LINESTRING/POLYGONをCIRCULARSTRINGかCURVEPOLYGONに変換します。</span></dt><dt><span class="refentrytitle"><a href="#ST_MakeValid">ST_MakeValid</a></span><span class="refpurpose"> — 頂点を失うことなしに不正なジオメトリを妥当なジオメトリにしようと試みます。</span></dt><dt><span class="refentrytitle"><a href="#ST_MemUnion">ST_MemUnion</a></span><span class="refpurpose"> — ST_Unionと同じですが、メモリフレンドリ (少ないメモリ使用、多いCPU時間)です。</span></dt><dt><span class="refentrytitle"><a href="#ST_MinimumBoundingCircle">ST_MinimumBoundingCircle</a></span><span class="refpurpose"> — ジオメトリを完全に含む最小の円ポリゴンを返します。デフォルトでは、4分の1円に対して48区分を使用します。</span></dt><dt><span class="refentrytitle"><a href="#ST_MinimumBoundingRadius">ST_MinimumBoundingRadius</a></span><span class="refpurpose"> — ジオメトリを完全に包含する最小円の中心ポイントと半径を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_OrientedEnvelope">ST_OrientedEnvelope</a></span><span class="refpurpose"> — ジオメトリを囲む最小の回転した四角形を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Polygonize">ST_Polygonize</a></span><span class="refpurpose"> — 集約関数。ジオメトリの集合のラインから形成されうるポリゴンを含むジオメトリコレクションを生成します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Node">ST_Node</a></span><span class="refpurpose"> — ラインストリングの集合にノードを作成します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_OffsetCurve">ST_OffsetCurve</a></span><span class="refpurpose"> — 与えられた距離と方面に入力ラインをずらしたラインを返します。中心線と平行する線を引く際に使えます。 </span></dt><dt><span class="refentrytitle"><a href="#ST_RemoveRepeatedPoints">ST_RemoveRepeatedPoints</a></span><span class="refpurpose"> — 入力ジオメトリから重複ポイントを除いたものを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_SharedPaths">ST_SharedPaths</a></span><span class="refpurpose"> — 二つのLINESTRING/MULTILINESTRINGの入力が共有するパスのコレクションを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Shift_Longitude">ST_ShiftLongitude</a></span><span class="refpurpose"> — ジオメトリの座標値を-180度から180度の範囲と0度から360度の範囲に揃えます。</span></dt><dt><span class="refentrytitle"><a href="#ST_WrapX">ST_WrapX</a></span><span class="refpurpose"> — ジオメトリをX値で回り込ませます。</span></dt><dt><span class="refentrytitle"><a href="#ST_Simplify">ST_Simplify</a></span><span class="refpurpose"> — 与えられたジオメトリを「簡略化」したものを返します。Douglas-Peukerアルゴリズムを使用します。</span></dt><dt><span class="refentrytitle"><a href="#ST_SimplifyPreserveTopology">ST_SimplifyPreserveTopology</a></span><span class="refpurpose"> — 与えられたジオメトリを「簡略化」したものを返します。Douglas-Peukerアルゴリズムを使用します。不正な派生ジオメトリ (特にポリゴン)の生成を回避します。</span></dt><dt><span class="refentrytitle"><a href="#ST_SimplifyVW">ST_SimplifyVW</a></span><span class="refpurpose"> — Visvalingam-Whyattアルゴリズムを用いて、入力ジオメトリを「簡略化」したジオメトリを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_ChaikinSmoothing">ST_ChaikinSmoothing</a></span><span class="refpurpose"> — チャイキンのアルゴリズムを使って、与えられたジオメトリが「平滑化された」ものを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_FilterByM">ST_FilterByM</a></span><span class="refpurpose"> — M値に基づく頂点のフィルタリングを行います。</span></dt><dt><span class="refentrytitle"><a href="#ST_SetEffectiveArea">ST_SetEffectiveArea</a></span><span class="refpurpose"> — 個々の頂点について有効範囲を設定し、M値として保存します。M値でフィルタリングすると、単純化したジオメトリを生成できます。 </span></dt><dt><span class="refentrytitle"><a href="#ST_Split">ST_Split</a></span><span class="refpurpose"> — ジオメトリを分割したジオメトリのコレクションを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_SymDifference">ST_SymDifference</a></span><span class="refpurpose"> — AとBの、インタセクトしていない部分を表現するジオメトリを返します。対称と呼ばれるのは、ST_SymDifference(A,B) = ST_SymDifference(B,A) となるからです。</span></dt><dt><span class="refentrytitle"><a href="#ST_Subdivide">ST_Subdivide</a></span><span class="refpurpose"> — 指定した数より多い頂点を持たないジオメトリの集合を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_SwapOrdinates">ST_SwapOrdinates</a></span><span class="refpurpose"> — 与えられたジオメトリにおいて与えられた座標の値を入れ替えたジオメトリを返します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_Union">ST_Union</a></span><span class="refpurpose"> — ジオメトリの結合の点集合を表現するジオメトリを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_UnaryUnion">ST_UnaryUnion</a></span><span class="refpurpose"> — ST_Unionに似ていますが、ジオメトリ要素レベルで動作します。</span></dt><dt><span class="refentrytitle"><a href="#ST_VoronoiLines">ST_VoronoiLines</a></span><span class="refpurpose"> — ジオメトリの頂点からボロノイ図のセル間の境界を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_VoronoiPolygons">ST_VoronoiPolygons</a></span><span class="refpurpose"> — ジオメトリの頂点からボロノイ図のセルを返します。</span></dt></dl></div><div class="refentry"><a name="ST_Buffer"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Buffer — (T) このジオメトリからの距離が指定された距離以下となる点全てを表現するジオメトリを返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Buffer</b>(</code>geometry  <var class="pdparam">g1</var>, float  <var class="pdparam">radius_of_buffer</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_Buffer</b>(</code>geometry  <var class="pdparam">g1</var>, float  <var class="pdparam">radius_of_buffer</var>, integer  <var class="pdparam">num_seg_quarter_circle</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_Buffer</b>(</code>geometry  <var class="pdparam">g1</var>, float  <var class="pdparam">radius_of_buffer</var>, text  <var class="pdparam">buffer_style_parameters</var><code>)</code>;</p><p><code class="funcdef">geography <b class="fsfunc">ST_Buffer</b>(</code>geography  <var class="pdparam">g1</var>, float  <var class="pdparam">radius_of_buffer_in_meters</var><code>)</code>;</p><p><code class="funcdef">geography <b class="fsfunc">ST_Buffer</b>(</code>geography  <var class="pdparam">g1</var>, float  <var class="pdparam">radius_of_buffer</var>, integer  <var class="pdparam">num_seg_quarter_circle</var><code>)</code>;</p><p><code class="funcdef">geography <b class="fsfunc">ST_Buffer</b>(</code>geography  <var class="pdparam">g1</var>, float  <var class="pdparam">radius_of_buffer</var>, text  <var class="pdparam">buffer_style_parameters</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp79591496"></a><h2>説明</h2><p>このジオメトリ/ジオグラフィからの距離が指定された距離以下となる点全てを表現するジオメトリ/ジオグラフィを返します。 </p><p>ジオメトリ: 計算は、ジオメトリの空間参照系で行われます。形状制御のために異なる終端キャップと継ぎ目を設定する機能が1.5で導入されました。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>負の半径: ポリゴンでは、負の半径が使えます。ポリゴンを拡張させずに縮小させることができます。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ジオグラフィ: ジオメトリ実装にかぶさる、薄いラッパです。ジオグラフィオブジェクトのバウンディングボックスに最適なSRIDを決定し (UTMが望ましいですが、ランベルト正積方位図法 (北/南)や、最悪のシナリオではメルカトルに頼ります)、その平面でバッファを生成し、WGS84ジオグラフィに戻します。</p></td></tr></table></div><p><img src="images/warning.png"> ジオグラフィでは、オブジェクトが二つのUTMゾーンをまたいだり、日付変更線をまたぐような、相当に大きい場合には、期待した通りの動作をないかも知れません。</p><p>Enhanced: 2.5.0 - ST_Bufferジオメトリ対応において、<code class="code">side=both|left|right</code>でバッファ方向を指定できるようになりました。</p><p>Availability: 1.5 - ST_Bufferが異なる終端と継ぎ目の型に対応するよう強化されました。たとえば、道路ラインストリングを、丸の代わりに平坦や四角形の終端を持つ道路ポリゴンに変換するのに使います。ジオグラフィ用の薄いラッパが追加されました。最新のジオメトリ機能の利点を得るにはGEOS 3.2以上が必要です。 </p><p>第3引数 (現在ジオメトリしか適用できません)で、4分の1円に近づけるための区分数を指定でき (整数の場合、デフォルトは8です)、また、空白区切りのkey=valueペア (文字列の場合)を、次に示す操作として指定することができます。 </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>'quad_segs=#' : 4分の1円区分数に近づけるために使われる区分の数 (デフォルトは8)。</p></li><li class="listitem"><p>'endcap=round|flat|square' : 終端スタイル (デフォルトは"round"、他の値を取るにはGEOS 3.2以上が必要)。'butt'は'flat'の同意語として受け付けます。</p></li><li class="listitem"><p>'join=round|mitre|bevel' : 接続スタイル (デフォルトは"round"、他の値を取るにはGEOS 3.2以上が必要)。'miter'は'mitre'の同義語として受け付けます。</p></li><li class="listitem"><p>'mitre_limit=#.#' : マイター比 (訳注: 継ぎ目の内側と外側の距離と線幅との比)の最大値 (継ぎ目スタイルがmiterである場合のみ有効)。'miter_limit'は'mitre_limit'の同義語として受け付けます。</p></li><li class="listitem"><p>'side=both|left|right' : 'left'または'right'については、線の方向から見た相対的なサイドによる、単一サイドのジオメトリのバッファを実行します。これはLINESTRINGジオメトリにだけ関連して、POINTまたはPOLYGONジオメトリには影響がありません。デフォルトでは終端スタイルは四角形です。</p></li></ul></div><p>
				</p><p>半径の単位は空間参照系の単位です。</p><p>入力は、POINT, MULTIPOINT, LINESTRING, MULTILINESTRING, POLYGON, MULTIPOLYGON, GEOMETRYCOLLECTIONが可能です。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数は第3次元 (Z軸)は無視し、3次元ジオメトリが与えられても、常に2次元バッファを返します。</p></td></tr></table></div><p>GEOSモジュールで実現しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a> s2.1.1.3</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 5.1.17</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はしばしば間違って半径探索に使われています。バッファを生成して半径探索に使うのは遅いし無意味です。<a class="xref" href="#ST_DWithin" title="ST_DWithin">ST_DWithin</a>を使います。</p></td></tr></table></div></div><div class="refsection"><a name="idp79614536"></a><h2>例</h2><div class="informaltable"><table class="informaltable" border="1"><colgroup><col><col></colgroup><tbody><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_buffer01.png"><div class="caption"><p>quad_segs=8 (デフォルト)</p></div></div></div><p>
				</p><pre class="programlisting">SELECT ST_Buffer(
 ST_GeomFromText('POINT(100 90)'),
 50, 'quad_segs=8');
                                </pre><p>
						  </p></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_buffer02.png"><div class="caption"><p>quad_segs=2 (不十分)</p></div></div></div><p>
				</p><pre class="programlisting">SELECT ST_Buffer(
 ST_GeomFromText('POINT(100 90)'),
 50, 'quad_segs=2');
                                </pre><p>
						</p></td></tr><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_buffer03.png"><div class="caption"><p>endcap=round join=round (デフォルト)</p></div></div></div><p>
				</p><pre class="programlisting">SELECT ST_Buffer(
 ST_GeomFromText(
  'LINESTRING(50 50,150 150,150 50)'
 ), 10, 'endcap=round join=round');
                                </pre><p>
						 </p></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_buffer04.png"><div class="caption"><p>endcap=square</p></div></div></div><p>
				</p><pre class="programlisting">SELECT ST_Buffer(
 ST_GeomFromText(
  'LINESTRING(50 50,150 150,150 50)'
 ), 10, 'endcap=square join=round');
                                </pre><p>
						  </p></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_buffer05.png"><div class="caption"><p>endcap=flat</p></div></div></div><p>
				</p><pre class="programlisting">SELECT ST_Buffer(
 ST_GeomFromText(
  'LINESTRING(50 50,150 150,150 50)'
 ), 10, 'endcap=flat join=round');
                                </pre><p>
						  </p></td></tr><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_buffer07.png"><div class="caption"><p>join=bevel</p></div></div></div><p>
				</p><pre class="programlisting">SELECT ST_Buffer(
 ST_GeomFromText(
  'LINESTRING(50 50,150 150,150 50)'
 ), 10, 'join=bevel');
                                </pre><p>
						  </p></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_buffer06.png"><div class="caption"><p>join=mitre mitre_limit=5.0 (デフォルトの最大マイター比)</p></div></div></div><p>
				</p><pre class="programlisting">SELECT ST_Buffer(
 ST_GeomFromText(
  'LINESTRING(50 50,150 150,150 50)'
 ), 10, 'join=mitre mitre_limit=5.0');
                                </pre><p>
						  </p></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_buffer08.png"><div class="caption"><p>join=mitre mitre_limit=1</p></div></div></div><p>
				</p><pre class="programlisting">SELECT ST_Buffer(
 ST_GeomFromText(
  'LINESTRING(50 50,150 150,150 50)'
 ), 10, 'join=mitre mitre_limit=1.0');
                                </pre><p>
						  </p></td></tr><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_buffer09.png"><div class="caption"><p>side=left</p></div></div></div><p>
				</p><pre class="programlisting">SELECT ST_Buffer(
 ST_GeomFromText(
  'LINESTRING(50 50,150 150,150 50)'
 ), 10, 'side=left');
                                </pre><p>
						  </p></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_buffer10.png"><div class="caption"><p>side=right</p></div></div></div><p>
				</p><pre class="programlisting">SELECT ST_Buffer(
 ST_GeomFromText(
  'LINESTRING(50 50,150 150,150 50)'
 ), 10, 'side=right');
                                </pre><p>
						  </p></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_buffer11.png"><div class="caption"><p>side=left join=mitre</p></div></div></div><p>
				</p><pre class="programlisting">SELECT ST_Buffer(
 ST_GeomFromText(
  'LINESTRING(50 50,150 150,150 50)'
 ), 10, 'side=left join=mitre');
                                </pre><p>
						  </p></td></tr><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_buffer12.png"><div class="caption"><p>右回りポリゴン、 side=left</p></div></div></div><p>
				</p><pre class="programlisting">SELECT ST_Buffer(
ST_ForceRHR(
ST_Boundary(
 ST_GeomFromText(
'POLYGON ((50 50, 50 150, 150 150, 150 50, 50 50))'))),
 ), 20, 'side=left');
                                </pre><p>
						  </p></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_buffer13.png"><div class="caption"><p>右回りポリゴン、 side=right</p></div></div></div><p>
				</p><pre class="programlisting">SELECT ST_Buffer(
ST_ForceRHR(
ST_Boundary(
 ST_GeomFromText(
'POLYGON ((50 50, 50 150, 150 150, 150 50, 50 50))'))
), 20,'side=right')
                                </pre><p>
				</p></td></tr></tbody></table></div><pre class="programlisting">-- ポイントに対する近似円バッファ
-- 4分の1円を2点で近似するようポイントに施したバッファは8辺のポリゴンです。
-- (ダイアグラム参照)
SELECT ST_NPoints(ST_Buffer(ST_GeomFromText('POINT(100 90)'), 50)) As promisingcircle_pcount,
ST_NPoints(ST_Buffer(ST_GeomFromText('POINT(100 90)'), 50, 2)) As lamecircle_pcount;

promisingcircle_pcount | lamecircle_pcount
------------------------+-------------------
                         33 |                9

--- 手軽だけれども不十分な円(4分の1円で2点だけの八角形)
-- 次に示すのは100メートルの八角形です。
-- 座標系は、元はNAD 83経度緯度で、メートル単位マサチューセッツ州平面に変換してから、
-- メートルでバッファを取っています。
SELECT ST_AsText(ST_Buffer(
ST_Transform(
ST_SetSRID(ST_MakePoint(-71.063526, 42.35785),4269), 26986)
,100,2)) As octagon;
----------------------
POLYGON((236057.59057465 900908.759918696,236028.301252769 900838.049240578,235
957.59057465 900808.759918696,235886.879896532 900838.049240578,235857.59057465
900908.759918696,235886.879896532 900979.470596815,235957.59057465 901008.759918
696,236028.301252769 900979.470596815,236057.59057465 900908.759918696))
                </pre></div><div class="refsection"><a name="idp79671368"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Collect" title="ST_Collect">ST_Collect</a>, <a class="xref" href="#ST_DWithin" title="ST_DWithin">ST_DWithin</a>, <a class="xref" href="#ST_SetSRID" title="ST_SetSRID">ST_SetSRID</a>, <a class="xref" href="#ST_Transform" title="ST_Transform">ST_Transform</a>, <a class="xref" href="#ST_Union" title="ST_Union">ST_Union</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_BuildArea"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_BuildArea — 与えられたジオメトリの構成ラインから面ジオメトリを生成します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_BuildArea</b>(</code>geometry  <var class="pdparam">A</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp79678664"></a><h2>説明</h2><p>与えられたジオメトリの構成ラインから面ジオメトリを生成します。返り値はポリゴンまたはマルチポリゴンで、どちらになるかは入力に依存します。入力構成ラインがポリゴンを形成しない場合はNULLを返します。入力としてLINESTRING, MULTILINESTRING, POLYGON, MULTIPOLYGON, GEOMETRYCOLLECTIONを取ることができます。 </p><p>この関数は全ての内部ジオメトリが穴を表現すると仮定します。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数が正しく動作するには、入力ラインに正しくノードが作成されている必要があります。</p></td></tr></table></div><p>Availability: 1.1.0 - GEOS 2.1.0以上が必要です。</p></div><div class="refsection"><a name="idp79681480"></a><h2>例</h2><div class="informaltable"><table class="informaltable" border="1"><colgroup><col></colgroup><tbody><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_buildarea01.png"><div class="caption"><p>ドーナツを生成します。</p></div></div></div><p>
				</p><pre class="programlisting">SELECT ST_BuildArea(ST_Collect(smallc,bigc))
FROM (SELECT
        ST_Buffer(
          ST_GeomFromText('POINT(100 90)'), 25) As smallc,
        ST_Buffer(ST_GeomFromText('POINT(100 90)'), 50) As bigc) As foo;
                                </pre><p>
						  </p></td></tr><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_buildarea02.png"><div class="caption"><p>円内にとがったものの先で、裂け目を生成します。</p></div></div></div><p>
				</p><pre class="programlisting">SELECT ST_BuildArea(ST_Collect(line,circle))
FROM (SELECT
        ST_Buffer(
                ST_MakeLine(ST_MakePoint(10, 10),ST_MakePoint(190, 190)),
                                5)  As line,
        ST_Buffer(ST_GeomFromText('POINT(100 90)'), 50) As circle) As foo;

-- 同じ裂け目を生成します
-- ただし、ポリゴンでなくラインストリングを使います
SELECT ST_BuildArea(
        ST_Collect(ST_ExteriorRing(line),ST_ExteriorRing(circle))
        )
FROM (SELECT ST_Buffer(
        ST_MakeLine(ST_MakePoint(10, 10),ST_MakePoint(190, 190))
                ,5)  As line,
        ST_Buffer(ST_GeomFromText('POINT(100 90)'), 50) As circle) As foo;

                                </pre><p>
						</p></td></tr></tbody></table></div></div><div class="refsection"><a name="idp79690440"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Node" title="ST_Node">ST_Node</a>, <a class="xref" href="#ST_MakePolygon" title="ST_MakePolygon">ST_MakePolygon</a>, <a class="xref" href="#ST_BdPolyFromText" title="ST_BdPolyFromText">ST_BdPolyFromText</a>, <a class="xref" href="#ST_BdMPolyFromText" title="ST_BdMPolyFromText">ST_BdMPolyFromText</a> (この関数を標準OGCインタフェースにするためのラッパ)</p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_ClipByBox2D"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ClipByBox2D — 長方形内に落ちるジオメトリの一部を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_ClipByBox2D</b>(</code>geometry <var class="pdparam">geom</var>, box2d <var class="pdparam">box</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp79698504"></a><h2>説明</h2><p>2次元ボックスでジオメトリを切り抜きます。高速ですが汚い方法かもしれません。出力ジオメトリの妥当性は保証されません (ポリゴンで自己インタセクションができるかも知れません)。トポロジ的に不正な入力ジオメトリでは例外が投げられ結果を返しません。 </p><p>GEOSモジュールで実現しています。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>GEOS 3.5.0以上が必要です。</p></td></tr></table></div><p>Availability: 2.2.0 - GEOS 3.5.0以上が必要です。</p></div><div class="refsection"><a name="idp79701064"></a><h2>例</h2><pre class="programlisting">-- 第2引数はジオメトリからbox2dへの暗黙のキャストに依っています
SELECT ST_ClipByBox2D(the_geom, ST_MakeEnvelope(0,0,10,10)) FROM mytab;
      </pre></div><div class="refsection"><a name="idp79702344"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Intersection" title="ST_Intersection">ST_Intersection</a>, <a class="xref" href="#ST_MakeBox2D" title="ST_MakeBox2D">ST_MakeBox2D</a>, <a class="xref" href="#ST_MakeEnvelope" title="ST_MakeEnvelope">ST_MakeEnvelope</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Collect"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Collect — 他のジオメトリのコレクションから、指定したST_Geometry値を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Collect</b>(</code>geometry set <var class="pdparam">g1field</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_Collect</b>(</code>geometry <var class="pdparam">g1</var>, geometry <var class="pdparam">g2</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_Collect</b>(</code>geometry[] <var class="pdparam">g1_array</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp79718472"></a><h2>説明</h2><p>出力タイプはMULTI系またはGEOMETRYCOLLECTIONです。二つの形式があります。 一つ目は、二つのジオメトリをまとめるものです。二つ目は、ジオメトリの集合を取って単一のST_Geometryにまとめる集約関数です。</p><p>集約関数版: この関数は、ジオメトリの集合からGEOMETRYCOLLECTIONまたはMULTI系を返します。ST_Collect()関数はPostgreSQL用語で言うところの「集約関数」です。SUM()やMEAN()と同じ方法でデータ行での操作を行うことを意味します。たとえば、"SELECT ST_Collect(GEOM) FROM GEOMTABLE GROUP BY ATTRCOLUMN"はATTRCOLUMNの異なった値ごとに、別々のGEOMETRYCOLLECTIONを返します。</p><p>非集約関数版: この関数は、二つの入力ジオメトリをまとめたジオメトリを返します。出力タイプはMULTI系またはGEOMETRYCOLLECTIONです。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_CollectとST_Unionはしばしば交換して使うことができます。ただし、ST_Collectは常にジオメトリコレクションかマルチ系ジオメトリを返すのに対して、ST_Unionは分解できる時に単一ジオメトリを返すことがあります。また、ST_Unionはラインストリングをインタセクトするノードで分割しますが、ST_Collectは分割せずにマルチラインストリングとして返します。マルチ系ジオメトリを収集する時にST_Collectにジオメトリコレクションを返さないようにするためには、下に示すように、<a class="xref" href="#ST_Dump" title="ST_Dump">ST_Dump</a>を利用して、マルチ系ジオメトリを単一ジオメトリにして、再グループ化するというトリックを使います。</p></td></tr></table></div><p>Availability: 1.4.0 - ST_Collect(geometry)が導入されました。ST_Collectがより多くのジオメトリをより早く扱えるよう強化されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves このメソッドは曲線ストリングと曲線をサポートします。 ただし、MULTICURVEまたはMULTI系は期待するように返ることはなく、PostGISは現在のところこれに対応していません。</p></div><div class="refsection"><a name="idp79724232"></a><h2>例</h2><p>集約関数版の例</p><pre class="programlisting">SELECT stusps, ST_Collect(f.the_geom) as singlegeom
         FROM (SELECT stusps, (ST_Dump(the_geom)).geom As the_geom
                                FROM
                                somestatetable ) As f
GROUP BY stusps</pre><p>非集約関数の例</p><pre class="programlisting">SELECT ST_AsText(ST_Collect(ST_GeomFromText('POINT(1 2)'),
        ST_GeomFromText('POINT(-2 3)') ));

st_astext
----------
MULTIPOINT(1 2,-2 3)

-- 2次元ポイント
SELECT ST_AsText(ST_Collect(ST_GeomFromText('POINT(1 2)'),
                ST_GeomFromText('POINT(1 2)') ) );

st_astext
----------
MULTIPOINT(1 2,1 2)

-- 3次元ポイント
SELECT ST_AsEWKT(ST_Collect(ST_GeomFromEWKT('POINT(1 2 3)'),
                ST_GeomFromEWKT('POINT(1 2 4)') ) );

                st_asewkt
-------------------------
 MULTIPOINT(1 2 3,1 2 4)

-- 曲線の例
SELECT ST_AsText(ST_Collect(ST_GeomFromText('CIRCULARSTRING(220268 150415,220227 150505,220227 150406)'),
ST_GeomFromText('CIRCULARSTRING(220227 150406,2220227 150407,220227 150406)')));
                                                                                                                                st_astext
------------------------------------------------------------------------------------
 GEOMETRYCOLLECTION(CIRCULARSTRING(220268 150415,220227 150505,220227 150406),
 CIRCULARSTRING(220227 150406,2220227 150407,220227 150406))

-- 配列を構築して渡す新しいST_Collect
SELECT ST_Collect(ARRAY(SELECT the_geom FROM sometable));

SELECT ST_AsText(ST_Collect(ARRAY[ST_GeomFromText('LINESTRING(1 2, 3 4)'),
                        ST_GeomFromText('LINESTRING(3 4, 4 5)')])) As wktcollect;

--wkt collect --
MULTILINESTRING((1 2,3 4),(3 4,4 5))

</pre></div><div class="refsection"><a name="idp79726792"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Dump" title="ST_Dump">ST_Dump</a>, <a class="xref" href="#ST_Union" title="ST_Union">ST_Union</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_ConcaveHull"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ConcaveHull — 凹包は、集合の範囲内におけるすべてのジオメトリーを囲む、できる限り凹となるジオメトリを表現するものです。収縮包装とみることができます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_ConcaveHull</b>(</code>geometry  <var class="pdparam">geomA</var>, float  <var class="pdparam">target_percent</var>, boolean  <var class="pdparam">allow_holes=false</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp79735112"></a><h2>説明</h2><p>凹包は、集合の範囲内におけるすべてのジオメトリを囲む、できる限り凹となるジオメトリを表現するものです。ポリゴンの穴を認めるのはデフォルトではfalseです。結果はシングルポリゴンより高くなることはありません。</p><p>target_percentは、凸包からPostGISがあきらめるか終了するまでに接近を試みる、凸包に対する目標割合です。凹包はジオメトリの集合を真空パックしたジオメトリと考えることができます。target_percentが1の場合には、凸包と同じ答えになります。target_parcetが0から0.99までの間では、凸包より小さい面積が得られます。これが、ジオメトリ集合を輪ゴムで囲うのに似ている凸包との違いです。</p><p>通常はMULTI系とジオメトリコレクションに使われます。 集約関数ではないのですが、ST_CollectやST_Unionと併用して、ポイント/ラインストリング/ポリゴンの凹包を得ることができます。"ST_ConcaveHull(ST_Collect(somepointfield), 0.80)"といったようにします。</p><p>凸包の計算よりも非常に遅いですが、よりよくジオメトリを囲みますし、画像認識にも使用されます。</p><p>GEOSモジュールによって実現しています。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ご注意 - ポイント、ラインストリング、ジオメトリコレクションで使用する場合には、ST_Collectを使用して下さい。ポリゴンで使用する場合には、不正なジオメトリで失敗する可能性があるため、ST_Unionを使用して下さい。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ご注意 - 目標割合を小さくすると、凹包処理が長くなり、トポロジ例外が発生しやすくなります。蓄積される浮動小数点数とポイントの数もまた多くなります。最初に0.99で実行してみて下さい。普通は非常に速く、時々凸包と同じ速さです。99%縮小ではほとんどの場合行き過ぎになるので、通常は99%縮小より良い結果になります。次に0.98で実行すると、2乗のオーダーで遅くなります。ST_ConcaveHull実行後に、精度と浮動小数点数を減らすために、<a class="xref" href="#ST_SimplifyPreserveTopology" title="ST_SimplifyPreserveTopology">ST_SimplifyPreserveTopology</a>や<a class="xref" href="#ST_SnapToGrid" title="ST_SnapToGrid">ST_SnapToGrid</a>を使用します。ST_SnapToGridは少し早くなりますが、不正なジオメトリが得られることがあります。ST_SimplifyPreserveTopologyは常にジオメトリの妥当性を確保します。</p></td></tr></table></div><p>現実世界の例と技術面でのしっかりした説明は、<a class="ulink" href="http://www.bostongis.com/postgis_concavehull.snippet" target="_top">http://www.bostongis.com/postgis_concavehull.snippet</a>にあります。</p><p>Oracle 11G R2で導入された凹包のデモンストレーションに関するSimon Greenerさんの記事も見てください。<a class="ulink" href="http://www.spatialdbadvisor.com/oracle_spatial_tips_tricks/172/concave-hull-geometries-in-oracle-11gr2" target="_top">http://www.spatialdbadvisor.com/oracle_spatial_tips_tricks/172/concave-hull-geometries-in-oracle-11gr2</a>にあります。凸包に対する目標割合を0.75にした際の形状がSimonさんOracleのSDO_CONCAVEHULL_BOUNDARYで得た形状と似ています。</p><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp79741768"></a><h2>例</h2><pre class="programlisting">-- 観察ポイントを基に感染域の見積もりを得ます
SELECT d.disease_type,
        ST_ConcaveHull(ST_Collect(d.pnt_geom), 0.99) As geom
        FROM disease_obs As d
        GROUP BY d.disease_type;
</pre><div class="informaltable"><table class="informaltable" border="1"><colgroup><col><col></colgroup><tbody><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_concavehull03.png"><div class="caption"><p> 縮小目標割合100%にした場合の2ポリゴンのST_ConcaveHull</p></div></div></div><p>
				</p><pre class="programlisting">-- 目標縮小率を100%にした (凸包と同じとなり、縮小していません)場合の凹包で
-- 覆ったジオメトリ
SELECT
        ST_ConcaveHull(
                ST_Union(ST_GeomFromText('POLYGON((175 150, 20 40,
                        50 60, 125 100, 175 150))'),
                ST_Buffer(ST_GeomFromText('POINT(110 170)'), 20)
                ), 1)
         As convexhull;
                                </pre><p>
						  </p></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_concavehull02.png"><div class="caption"><p>凸包に対する縮小目標割合を90%にした凹包で覆われるジオメトリ</p></div></div></div><p>
				</p><pre class="programlisting">-- 目標縮小率を900%にした 場合の凹包で覆ったジオメトリ
SELECT
        ST_ConcaveHull(
                ST_Union(ST_GeomFromText('POLYGON((175 150, 20 40,
                        50 60, 125 100, 175 150))'),
                ST_Buffer(ST_GeomFromText('POINT(110 170)'), 20)
                ), 0.9)
         As target_90;
                                </pre><p>
						</p></td></tr><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_concavehull04.png"><div class="caption"><p>凸包で覆われたL字型のポイント群</p></div></div></div><p>
				</p><pre class="programlisting">-- 42ポイントでL字型を形成するテーブルを生成
SELECT (ST_DumpPoints(ST_GeomFromText(
'MULTIPOINT(14 14,34 14,54 14,74 14,94 14,114 14,134 14,
150 14,154 14,154 6,134 6,114 6,94 6,74 6,54 6,34 6,
14 6,10 6,8 6,7 7,6 8,6 10,6 30,6 50,6 70,6 90,6 110,6 130,
6 150,6 170,6 190,6 194,14 194,14 174,14 154,14 134,14 114,
14 94,14 74,14 54,14 34,14 14)'))).geom
        INTO TABLE l_shape;

SELECT ST_ConvexHull(ST_Collect(geom))
FROM l_shape;
                                </pre><p>
						  </p></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_concavehull05.png"><div class="caption"><p>凸包に対する縮小目標割合を99%としたL字型のポイント群の凹包</p></div></div></div><p>
				</p><pre class="programlisting">SELECT ST_ConcaveHull(ST_Collect(geom), 0.99)
        FROM l_shape;
                                </pre><p>
						  </p></td></tr><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_concavehull06.png"><div class="caption"><p>凸包に対する縮小目標割合を80%としたL字型のポイント群の凹包</p></div></div></div><p>
	</p><pre class="programlisting">-- 凸包に対する縮小目標割合を80%としたL字型のポイント群の凹包
        SELECT ST_ConcaveHull(ST_Collect(geom), 0.80)
        FROM l_shape;
        </pre><p>
			</p>
			</td><td><p>
				</p><div class="informalfigure"><div class="mediaobject"><img src="images/st_concavehull07.png"><div class="caption"><p>凸包に覆われたマルチラインストリング</p></div></div></div><p>
				</p><div class="informalfigure"><div class="mediaobject"><img src="images/st_concavehull08.png"><div class="caption"><p>凸包に対する縮小目標割合を99% (第1段階)とした凹包に覆われたマルチラインストリング</p></div></div></div><p>
	</p><pre class="programlisting">SELECT ST_ConcaveHull(ST_GeomFromText('MULTILINESTRING((106 164,30 112,74 70,82 112,130 94,
        130 62,122 40,156 32,162 76,172 88),
(132 178,134 148,128 136,96 128,132 108,150 130,
170 142,174 110,156 96,158 90,158 88),
(22 64,66 28,94 38,94 68,114 76,112 30,
132 10,168 18,178 34,186 52,184 74,190 100,
190 122,182 148,178 170,176 184,156 164,146 178,
132 186,92 182,56 158,36 150,62 150,76 128,88 118))'),0.99)
        </pre><p>
			</p>
			</td></tr></tbody></table></div></div><div class="refsection"><a name="idp79828040"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Collect" title="ST_Collect">ST_Collect</a>, <a class="xref" href="#ST_ConvexHull" title="ST_ConvexHull">ST_ConvexHull</a>, <a class="xref" href="#ST_SimplifyPreserveTopology" title="ST_SimplifyPreserveTopology">ST_SimplifyPreserveTopology</a>, <a class="xref" href="#ST_SnapToGrid" title="ST_SnapToGrid">ST_SnapToGrid</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_ConvexHull"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ConvexHull — 凸包は与えられた集合の全てのジオメトリを含む最小の閉じた凸ジオメトリです。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_ConvexHull</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp79834952"></a><h2>説明</h2><p>凸包は与えられた集合の全てのジオメトリを含む最小の閉じた凸ジオメトリです。</p><p>凸包は、ジオメトリの集合に輪ゴムをかけて得られるジオメトリと見ることができます。これは縮小包装に似ている凹包と異なります。</p><p>通常はMULTI系まはたジオメトリカラムを使いますが、集約関数ではありません - ST_Collectと併用してST_ConvexHull(ST_Collect(somepointfield))とすると、ポイントの集合の凸包を得ることができます。</p><p>ポイント観察の集合を基にして、影響を受ける範囲を決定するのに使用します。</p><p>GEOSモジュールによって実現しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a> s2.1.1.3</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 5.1.16</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp79842120"></a><h2>例</h2><pre class="programlisting">-- ポイント観察に基づいて、感染域の推定を得る
SELECT d.disease_type,
        ST_ConvexHull(ST_Collect(d.the_geom)) As the_geom
        FROM disease_obs As d
        GROUP BY d.disease_type;
</pre><p>
	</p><div class="informalfigure"><div class="mediaobject"><img src="images/st_convexhull01.png"><div class="caption"><p>マルチラインストリングとマルチポイントの凸包</p></div></div></div><p>
	</p><pre class="programlisting">SELECT ST_AsText(ST_ConvexHull(
        ST_Collect(
                ST_GeomFromText('MULTILINESTRING((100 190,10 8),(150 10, 20 30))'),
                        ST_GeomFromText('MULTIPOINT(50 5, 150 30, 50 10, 10 10)')
                        )) );
---st_astext--
POLYGON((50 5,10 8,10 10,100 190,150 30,150 10,50 5))
        </pre><p>
</p></div><div class="refsection"><a name="idp79846472"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Collect" title="ST_Collect">ST_Collect</a>, <a class="xref" href="#ST_ConcaveHull" title="ST_ConcaveHull">ST_ConcaveHull</a>, <a class="xref" href="#ST_MinimumBoundingCircle" title="ST_MinimumBoundingCircle">ST_MinimumBoundingCircle</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_CurveToLine"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_CurveToLine — CIRCULARSTRING/CURVEPOLYGONをLINESTRING/POLYGONに変換します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_CurveToLine</b>(</code>geometry <var class="pdparam">curveGeom</var>, float <var class="pdparam">tolerance</var>, integer <var class="pdparam">tolerance_type</var>, integer <var class="pdparam">flags</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp79856328"></a><h2>説明</h2><p>CIRCULARSTRINGを規則的なLINESTRINGに、または、CURVEPOLYGONをPOLYGONに変換します。CIRCULARSTRING型に対応していないデバイスへの出力に使います。</p><p>与えられたジオメトリを線型ジオメトリに変換します。それぞれの曲線ジオメトリまたは辺は、`tolerance` とオプションを使用して線形近似に変換します (デフォルトでは4分の1円ごとに32辺でオプションなしです)。</p><p>'tolerance_type'引数によって`tolerance`引数の解釈が決定されます。 </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>0 (デフォルト): toleranceは4分の1円の最大辺数です。</p></li><li class="listitem"><p>1: toleranceは曲線からラインまでの最大差です。単位は入力ジオメトリの単位です。</p></li><li class="listitem"><p>2: toleranceは生成される半径がなす角度のラジアン単位の最大値です。</p></li></ul></div><p>
    </p><p>'flags'引数はビットフィールドです。デフォルトでは0です。次のビットに対応します。 </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>1: 対称となる (方向独立)出力。</p></li><li class="listitem"><p>2: 角度維持。対称出力を生成する時に角度 (辺長)減少を避けます。対称フラグがOFFの時は何の効果もありません。</p></li></ul></div><p>
    </p><p>Availability: 1.3.0</p><p>Enhanced: 2.4.0 最大距離差による許容範囲と最大角度による許容範囲に対応し、対称出力に対応しました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a></p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 7.1.7</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p></div><div class="refsection"><a name="idp79869512"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(ST_CurveToLine(ST_GeomFromText('CIRCULARSTRING(220268 150415,220227 150505,220227 150406)')));

-- 結果 --
 LINESTRING(220268 150415,220269.95064912 150416.539364228,220271.823415575 150418.17258804,220273.613787707 150419.895736857,
 220275.317452352 150421.704659462,220276.930305234 150423.594998003,220278.448460847 150425.562198489,
 220279.868261823 150427.60152176,220281.186287736 150429.708054909,220282.399363347 150431.876723113,
 220283.50456625 150434.10230186,220284.499233914 150436.379429536,220285.380970099 150438.702620341,220286.147650624 150441.066277505,
 220286.797428488 150443.464706771,220287.328738321 150445.892130112,220287.740300149 150448.342699654,
 220288.031122486 150450.810511759,220288.200504713 150453.289621251,220288.248038775 150455.77405574,
 220288.173610157 150458.257830005,220287.977398166 150460.734960415,220287.659875492 150463.199479347,
 220287.221807076 150465.64544956,220286.664248262 150468.066978495,220285.988542259 150470.458232479,220285.196316903 150472.81345077,
 220284.289480732 150475.126959442,220283.270218395 150477.39318505,220282.140985384 150479.606668057,
 220280.90450212 150481.762075989,220279.5637474 150483.85421628,220278.12195122 150485.87804878,
 220276.582586992 150487.828697901,220274.949363179 150489.701464356,220273.226214362 150491.491836488,
 220271.417291757 150493.195501133,220269.526953216 150494.808354014,220267.559752731 150496.326509628,
 220265.520429459 150497.746310603,220263.41389631 150499.064336517,220261.245228106 150500.277412127,
 220259.019649359 150501.38261503,220256.742521683 150502.377282695,220254.419330878 150503.259018879,
 220252.055673714 150504.025699404,220249.657244448 150504.675477269,220247.229821107 150505.206787101,
 220244.779251566 150505.61834893,220242.311439461 150505.909171266,220239.832329968 150506.078553494,
 220237.347895479 150506.126087555,220234.864121215 150506.051658938,220232.386990804 150505.855446946,
 220229.922471872 150505.537924272,220227.47650166 150505.099855856,220225.054972724 150504.542297043,
 220222.663718741 150503.86659104,220220.308500449 150503.074365683,
 220217.994991777 150502.167529512,220215.72876617 150501.148267175,
 220213.515283163 150500.019034164,220211.35987523 150498.7825509,
 220209.267734939 150497.441796181,220207.243902439 150496,
 220205.293253319 150494.460635772,220203.420486864 150492.82741196,220201.630114732 150491.104263143,
 220199.926450087 150489.295340538,220198.313597205 150487.405001997,220196.795441592 150485.437801511,
 220195.375640616 150483.39847824,220194.057614703 150481.291945091,220192.844539092 150479.123276887,220191.739336189 150476.89769814,
 220190.744668525 150474.620570464,220189.86293234 150472.297379659,220189.096251815 150469.933722495,
 220188.446473951 150467.535293229,220187.915164118 150465.107869888,220187.50360229 150462.657300346,
 220187.212779953 150460.189488241,220187.043397726 150457.710378749,220186.995863664 150455.22594426,
 220187.070292282 150452.742169995,220187.266504273 150450.265039585,220187.584026947 150447.800520653,
 220188.022095363 150445.35455044,220188.579654177 150442.933021505,220189.25536018 150440.541767521,
 220190.047585536 150438.18654923,220190.954421707 150435.873040558,220191.973684044 150433.60681495,
 220193.102917055 150431.393331943,220194.339400319 150429.237924011,220195.680155039 150427.14578372,220197.12195122 150425.12195122,
 220198.661315447 150423.171302099,220200.29453926 150421.298535644,220202.017688077 150419.508163512,220203.826610682 150417.804498867,
 220205.716949223 150416.191645986,220207.684149708 150414.673490372,220209.72347298 150413.253689397,220211.830006129 150411.935663483,
 220213.998674333 150410.722587873,220216.22425308 150409.61738497,220218.501380756 150408.622717305,220220.824571561 150407.740981121,
 220223.188228725 150406.974300596,220225.586657991 150406.324522731,220227 150406)

-- 3次元の例
SELECT ST_AsEWKT(ST_CurveToLine(ST_GeomFromEWKT('CIRCULARSTRING(220268 150415 1,220227 150505 2,220227 150406 3)')));
Output
------
 LINESTRING(220268 150415 1,220269.95064912 150416.539364228 1.0181172856673,
 220271.823415575 150418.17258804 1.03623457133459,220273.613787707 150419.895736857 1.05435185700189,....AD INFINITUM ....
        220225.586657991 150406.324522731 1.32611114201132,220227 150406 3)

-- 近似4分の1円を2辺だけとする例
SELECT ST_AsText(ST_CurveToLine(ST_GeomFromText('CIRCULARSTRING(220268 150415,220227 150505,220227 150406)'),2));
st_astext
------------------------------
 LINESTRING(220268 150415,220287.740300149 150448.342699654,220278.12195122 150485.87804878,
 220244.779251566 150505.61834893,220207.243902439 150496,220187.50360229 150462.657300346,
 220197.12195122 150425.12195122,220227 150406)

-- 近似線が入力曲線から20単位以上離れることがないようにし、
-- 方向中立にします
SELECT ST_AsText(ST_CurveToLine(
 'CIRCULARSTRING(0 0,100 -100,200 0)'::geometry,
        20, -- 許容範囲値
        1, -- 上の値は曲線と線分との最大距離
        1  -- 対称性フラグ
));
st_astext
-------------------------------------------------------------------------------------------
 LINESTRING(0 0,50 -86.6025403784438,150 -86.6025403784439,200 -1.1331077795296e-13,200 0)


                </pre></div><div class="refsection"><a name="idp79871048"></a><h2>関連情報</h2><p><a class="xref" href="#ST_LineToCurve" title="ST_LineToCurve">ST_LineToCurve</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_DelaunayTriangles"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_DelaunayTriangles — 与えられたポイントの周りのドロネー三角形を返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_DelaunayTriangles</b>(</code>geometry  <var class="pdparam">g1</var>, float  <var class="pdparam">tolerance</var>, int4  <var class="pdparam">flags</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp79940296"></a><h2>説明</h2><p>入力ジオメトリの頂点の周りの<a class="ulink" href="http://ja.wikipedia.org/wiki/%E3%83%89%E3%83%AD%E3%83%8D%E3%83%BC%E5%9B%B3" target="_top">ドロネー三角形</a>を返します。出力はポリゴンのコレクション (flags=0の場合)、MULTILINESTRING (flags=1の場合)、TIN(flags=2の場合)のいずれかになります。いずれの場合も、入力の頂点を一緒にスナップするために許容誤差が使われます。 </p><p>Availability: 2.1.0 - GEOS 3.4.0以上が必要です。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div><div class="refsection"><a name="idp79945288"></a><h2>2次元の例</h2><div class="informaltable"><table class="informaltable" border="1"><colgroup><col></colgroup><tbody><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_delaunaytriangles01.png"><div class="caption"><p>元のポリゴン</p></div></div></div>
<pre class="programlisting">-- 元のジオメトリ --
        ST_Union(ST_GeomFromText('POLYGON((175 150, 20 40,
                        50 60, 125 100, 175 150))'),
                ST_Buffer(ST_GeomFromText('POINT(110 170)'), 20)
                )</pre></td></tr><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_delaunaytriangles03.png"><div class="caption"><p>二つのポリゴンのST_DelaunayTriangles: ポリゴンごとに異なる色をつけたドロネー三角形ポリゴン</p></div></div></div><p>
				</p><pre class="programlisting">-- マルチラインストリングによる三角形を載せたジオメトリ --
SELECT
        ST_DelaunayTriangles(
                ST_Union(ST_GeomFromText('POLYGON((175 150, 20 40,
                        50 60, 125 100, 175 150))'),
                ST_Buffer(ST_GeomFromText('POINT(110 170)'), 20)
                ))
         As  dtriag;
                                </pre><p>
						  </p></td></tr><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_delaunaytriangles02.png"><div class="caption"><p>マルチラインストリングにしたドロネー三角形</p></div></div></div><p>
				</p><pre class="programlisting">SELECT
        ST_DelaunayTriangles(
                ST_Union(ST_GeomFromText('POLYGON((175 150, 20 40,
                        50 60, 125 100, 175 150))'),
                ST_Buffer(ST_GeomFromText('POINT(110 170)'), 20)
                ),0.001,1)
         As  dtriag;</pre><p>
						</p></td></tr><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_delaunaytriangles04.png"><div class="caption"><p>45個のポイントから生成した55個のドロネー三角形</p></div></div></div><p>
				</p><pre class="programlisting">-- L字型に42個のポイントを持つテーブルを生成
SELECT (ST_DumpPoints(ST_GeomFromText(
'MULTIPOINT(14 14,34 14,54 14,74 14,94 14,114 14,134 14,
150 14,154 14,154 6,134 6,114 6,94 6,74 6,54 6,34 6,
14 6,10 6,8 6,7 7,6 8,6 10,6 30,6 50,6 70,6 90,6 110,6 130,
6 150,6 170,6 190,6 194,14 194,14 174,14 154,14 134,14 114,
14 94,14 74,14 54,14 34,14 14)'))).geom
        INTO TABLE l_shape;
-- 個別の三角形ポリゴンとして出力
SELECT ST_AsText((ST_Dump(geom)).geom) As wkt
FROM ( SELECT ST_DelaunayTriangles(ST_Collect(geom)) As geom
FROM l_shape) As foo;

-- wkt --
POLYGON((6 194,6 190,14 194,6 194))
POLYGON((14 194,6 190,14 174,14 194))
POLYGON((14 194,14 174,154 14,14 194))
POLYGON((154 14,14 174,14 154,154 14))
POLYGON((154 14,14 154,150 14,154 14))
POLYGON((154 14,150 14,154 6,154 14))
:
:
</pre><p>
						</p></td></tr></tbody></table></div></div><div class="refsection"><a name="idp79960648"></a><h2>3次元の例</h2><pre class="programlisting">-- 3次元マルチポイント --
SELECT ST_AsText(ST_DelaunayTriangles(ST_GeomFromText(
'MULTIPOINT Z(14 14 10,
150 14 100,34 6 25, 20 10 150)'))) As wkt;

----- WKT ----
GEOMETRYCOLLECTION Z (POLYGON Z ((14 14 10,20 10 150,34 6 25,14 14 10))
 ,POLYGON Z ((14 14 10,34 6 25,150 14 100,14 14 10)))</pre></div><div class="refsection"><a name="idp79961928"></a><h2>関連情報</h2><p><a class="xref" href="#ST_ConcaveHull" title="ST_ConcaveHull">ST_ConcaveHull</a>, <a class="xref" href="#ST_Dump" title="ST_Dump">ST_Dump</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Difference"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Difference — ジオメトリBにインタセクトしないジオメトリAの部分を表現するジオメトリを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Difference</b>(</code>geometry  <var class="pdparam">geomA</var>, geometry  <var class="pdparam">geomB</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp79969352"></a><h2>説明</h2><p>ジオメトリBにインタセクトしないジオメトリAの部分を表現するジオメトリを返します。これは、ジオメトリA - ST_Intersection(A,B)と見ることができます。Aが完全にBに含まれる場合に、空ジオメトリコレクションが返されます。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>順序の問題に注意が必要です。B-Aでは常にBの部分が返ります。</p></td></tr></table></div><p>GEOSモジュールによって実現しています。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ジオメトリコレクションを引数として呼ばないでください。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a> s2.1.1.3</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 5.1.20</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index. ただし、差を取ってZインデクスを戻す時に、X Yのみ考慮に入れているように見えます。</p></div><div class="refsection"><a name="idp79976392"></a><h2>例</h2><div class="informaltable"><table class="informaltable" border="1"><colgroup><col><col></colgroup><tbody><tr><td>
						<p>
							</p><div class="informalfigure"><div class="mediaobject"><img src="images/st_symdifference01.png"><div class="caption"><p>元のラインストリングと一緒に表示 </p></div></div></div><p>
						</p>
					</td><td>
						<div class="informalfigure"><div class="mediaobject"><img src="images/st_difference01.png"><div class="caption"><p>二つのラインストリングの差</p></div></div></div><p>
					</p>
				</td></tr></tbody></table></div><pre class="programlisting">-- 2次元では安全です。これは同じST_SymDifferenceで示したのと同じジオメトリです。
SELECT ST_AsText(
        ST_Difference(
                        ST_GeomFromText('LINESTRING(50 100, 50 200)'),
                        ST_GeomFromText('LINESTRING(50 50, 50 150)')
                )
        );

st_astext
---------
LINESTRING(50 150,50 200)
</pre><pre class="programlisting">-- 3次元では正しく動作しません
SELECT ST_AsEWKT(ST_Difference(ST_GeomFromEWKT('MULTIPOINT(-118.58 38.38 5,-118.60 38.329 6,-118.614 38.281 7)'), ST_GeomFromEWKT('POINT(-118.614 38.281 5)')));
st_asewkt
---------
MULTIPOINT(-118.6 38.329 6,-118.58 38.38 5)
                </pre></div><div class="refsection"><a name="idp79985864"></a><h2>関連情報</h2><p><a class="xref" href="#ST_SymDifference" title="ST_SymDifference">ST_SymDifference</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Dump"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Dump — ジオメトリg1から作られたgeometry_dump(geom, path)行の集合を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry_dump[] <b class="fsfunc">ST_Dump</b>(</code>geometry  <var class="pdparam">g1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp79991624"></a><h2>説明</h2><p>これは集合を返す関数 (SRF=set-returning function)です。ジオメトリ (<code class="varname">geom</code>)と整数配列 (<code class="varname">path</code>)で作られる<code class="varname">geometry_dump</code>行を返します。入力ジオメトリが単純型 (POINT,LINESTRING,POLYGON)の場合は、単一の行で返り、pathには空配列、geomには入力ジオメトリが入ります。入力ジオメトリがジオメトリコレクションまたはMULTI系の場合は、要素ごとの行で返り、pathはコレクション内の要素位置を表します。</p><p>ST_Dumpはジオメトリを展開するのに使えます。新しい行を作る点では、GROUP BYの逆です。たとえば、MULTIPOLYGONをPOLYGONに展開するために使われます。</p><p>Enhanced: 2.0.0 多面体サーフェス対応、三角対応、TIN対応が導入されました。</p><p>Availability: PostGIS 1.0.0RC1 PostgreSQL 7.3以上が必要です。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>1.3.4より前では、曲線を含むジオメトリで使用すると、この関数はクラッシュします。これは1.3.4以上で訂正されています。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp79996872"></a><h2>標準的な例</h2><pre class="programlisting">SELECT sometable.field1, sometable.field1,
      (ST_Dump(sometable.the_geom)).geom AS the_geom
FROM sometable;

-- COMPOUNDCURVEをLINESTRINGとCIRCULARSTRINGとに分けます
SELECT ST_AsEWKT(a.geom), ST_HasArc(a.geom)
  FROM ( SELECT (ST_Dump(p_geom)).geom AS geom
         FROM (SELECT ST_GeomFromEWKT('COMPOUNDCURVE(CIRCULARSTRING(0 0, 1 1, 1 0),(1 0, 0 1))') AS p_geom) AS b
        ) AS a;
          st_asewkt          | st_hasarc
-----------------------------+----------
 CIRCULARSTRING(0 0,1 1,1 0) | t
 LINESTRING(1 0,0 1)         | f
(2 rows)</pre></div><div class="refsection"><a name="idp80010440"></a><h2>多面体サーフェス、TIN、三角形の例</h2><pre class="programlisting">-- 多面体サーフェスの例
-- 多面体サーフェスを面に分解
SELECT (a.p_geom).path[1] As path, ST_AsEWKT((a.p_geom).geom) As geom_ewkt
  FROM (SELECT ST_Dump(ST_GeomFromEWKT('POLYHEDRALSURFACE(
((0 0 0, 0 0 1, 0 1 1, 0 1 0, 0 0 0)),
((0 0 0, 0 1 0, 1 1 0, 1 0 0, 0 0 0)), ((0 0 0, 1 0 0, 1 0 1, 0 0 1, 0 0 0)),  ((1 1 0, 1 1 1, 1 0 1, 1 0 0, 1 1 0)),
((0 1 0, 0 1 1, 1 1 1, 1 1 0, 0 1 0)),  ((0 0 1, 1 0 1, 1 1 1, 0 1 1, 0 0 1))
)') ) AS p_geom )  AS a;

 path |                geom_ewkt
------+------------------------------------------
    1 | POLYGON((0 0 0,0 0 1,0 1 1,0 1 0,0 0 0))
    2 | POLYGON((0 0 0,0 1 0,1 1 0,1 0 0,0 0 0))
    3 | POLYGON((0 0 0,1 0 0,1 0 1,0 0 1,0 0 0))
    4 | POLYGON((1 1 0,1 1 1,1 0 1,1 0 0,1 1 0))
    5 | POLYGON((0 1 0,0 1 1,1 1 1,1 1 0,0 1 0))
    6 | POLYGON((0 0 1,1 0 1,1 1 1,0 1 1,0 0 1))</pre><pre class="programlisting">-- TIN --
SELECT (g.gdump).path, ST_AsEWKT((g.gdump).geom) as wkt
  FROM
    (SELECT
       ST_Dump( ST_GeomFromEWKT('TIN (((
                0 0 0,
                0 0 1,
                0 1 0,
                0 0 0
            )), ((
                0 0 0,
                0 1 0,
                1 1 0,
                0 0 0
            ))
            )') ) AS gdump
    ) AS g;
-- 結果 --
 path |                 wkt
------+-------------------------------------
 {1}  | TRIANGLE((0 0 0,0 0 1,0 1 0,0 0 0))
 {2}  | TRIANGLE((0 0 0,0 1 0,1 1 0,0 0 0))
</pre></div><div class="refsection"><a name="idp80012104"></a><h2>関連情報</h2><p><a class="xref" href="#geometry_dump" title="geometry_dump">geometry_dump</a>, <a class="xref" href="#PostGIS_Geometry_DumpFunctions" title="14.6. PostGISジオメトリ/ジオグラフィ/ラスタのダンプ関数">「PostGISジオメトリ/ジオグラフィ/ラスタのダンプ関数」</a>, <a class="xref" href="#ST_Collect" title="ST_Collect">ST_Collect</a>, <a class="xref" href="#ST_Collect" title="ST_Collect">ST_Collect</a>, <a class="xref" href="#ST_GeometryN" title="ST_GeometryN">ST_GeometryN</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_DumpPoints"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_DumpPoints — ジオメトリを作る全ての点のgometry_dump(geom,path)行の集合を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry_dump[]<b class="fsfunc">ST_DumpPoints</b>(</code>geometry  <var class="pdparam">geom</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp80019400"></a><h2>説明</h2><p>この集合を返す関数 (SRF=set-returning function)は、ジオメトリ (<code class="varname">geom</code>)と整数配列 (<code class="varname">path</code>)で作られる<code class="varname">geometry_dump</code>行を返します。</p><p><code class="varname">geometry_dump</code>の<em class="parameter"><code>geom</code></em>要素は全て、与えられたジオメトリを作る<code class="varname">POINT</code>です。</p><p><code class="varname">geometry_dump</code>の<em class="parameter"><code>path</code></em>要素 (<code class="varname">integer[]</code>)は、与えられたジオメトリの<code class="varname">POINT</code>を列挙するインデクス参照です。たとえば、<code class="varname">LINESTRING</code>が与えられた場合に、<code class="varname">{i}</code>のpathが返ります。ここで、<code class="varname">i</code>は<code class="varname">LINESTRING</code>の<code class="varname">n番目</code>の座標です。<code class="varname">POLYGON</code>が与えられた場合には、<code class="varname">{i,j}</code>のpathが返ります。ここで、<code class="varname">i</code>は環番号 (1が外環で、内環が続きます)で、<code class="varname">j</code>は<code class="varname">POINT</code>を列挙するものです (1始まり)。 </p><p>Enhanced: 2.1.0 速度向上しました。C言語で実装しなおしました。</p><p>Enhanced: 2.0.0 多面体サーフェス対応、三角対応、TIN対応が導入されました。</p><p>Availability: 1.5.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp80039624"></a><h2>ラインストリングのテーブルのノードへの古典的な分割</h2><pre class="programlisting">SELECT edge_id, (dp).path[1] As index, ST_AsText((dp).geom) As wktnode
FROM (SELECT 1 As edge_id
        , ST_DumpPoints(ST_GeomFromText('LINESTRING(1 2, 3 4, 10 10)')) AS dp
     UNION ALL
     SELECT 2 As edge_id
        , ST_DumpPoints(ST_GeomFromText('LINESTRING(3 5, 5 6, 9 10)')) AS dp
   ) As foo;
 edge_id | index |    wktnode
---------+-------+--------------
       1 |     1 | POINT(1 2)
       1 |     2 | POINT(3 4)
       1 |     3 | POINT(10 10)
       2 |     1 | POINT(3 5)
       2 |     2 | POINT(5 6)
       2 |     3 | POINT(9 10)</pre></div><div class="refsection"><a name="idp80040776"></a><h2>標準的なジオメトリの例</h2><div class="informalfigure"><div class="mediaobject"><img src="images/st_dumppoints01.png"></div></div><pre class="programlisting">SELECT path, ST_AsText(geom)
FROM (
  SELECT (ST_DumpPoints(g.geom)).*
  FROM
    (SELECT
       'GEOMETRYCOLLECTION(
          POINT ( 0 1 ),
          LINESTRING ( 0 3, 3 4 ),
          POLYGON (( 2 0, 2 3, 0 2, 2 0 )),
          POLYGON (( 3 0, 3 3, 6 3, 6 0, 3 0 ),
                   ( 5 1, 4 2, 5 2, 5 1 )),
          MULTIPOLYGON (
                  (( 0 5, 0 8, 4 8, 4 5, 0 5 ),
                   ( 1 6, 3 6, 2 7, 1 6 )),
                  (( 5 4, 5 8, 6 7, 5 4 ))
          )
        )'::geometry AS geom
    ) AS g
  ) j;

   path    | st_astext
-----------+------------
 {1,1}     | POINT(0 1)
 {2,1}     | POINT(0 3)
 {2,2}     | POINT(3 4)
 {3,1,1}   | POINT(2 0)
 {3,1,2}   | POINT(2 3)
 {3,1,3}   | POINT(0 2)
 {3,1,4}   | POINT(2 0)
 {4,1,1}   | POINT(3 0)
 {4,1,2}   | POINT(3 3)
 {4,1,3}   | POINT(6 3)
 {4,1,4}   | POINT(6 0)
 {4,1,5}   | POINT(3 0)
 {4,2,1}   | POINT(5 1)
 {4,2,2}   | POINT(4 2)
 {4,2,3}   | POINT(5 2)
 {4,2,4}   | POINT(5 1)
 {5,1,1,1} | POINT(0 5)
 {5,1,1,2} | POINT(0 8)
 {5,1,1,3} | POINT(4 8)
 {5,1,1,4} | POINT(4 5)
 {5,1,1,5} | POINT(0 5)
 {5,1,2,1} | POINT(1 6)
 {5,1,2,2} | POINT(3 6)
 {5,1,2,3} | POINT(2 7)
 {5,1,2,4} | POINT(1 6)
 {5,2,1,1} | POINT(5 4)
 {5,2,1,2} | POINT(5 8)
 {5,2,1,3} | POINT(6 7)
 {5,2,1,4} | POINT(5 4)
(29 rows)</pre></div><div class="refsection"><a name="idp80043720"></a><h2>多面体サーフェス、TIN、三角形の例</h2><pre class="programlisting">-- 多面体サーフェスの立方体--
SELECT (g.gdump).path, ST_AsEWKT((g.gdump).geom) as wkt
  FROM
    (SELECT
       ST_DumpPoints(ST_GeomFromEWKT('POLYHEDRALSURFACE( ((0 0 0, 0 0 1, 0 1 1, 0 1 0, 0 0 0)),
((0 0 0, 0 1 0, 1 1 0, 1 0 0, 0 0 0)), ((0 0 0, 1 0 0, 1 0 1, 0 0 1, 0 0 0)),
((1 1 0, 1 1 1, 1 0 1, 1 0 0, 1 1 0)),
((0 1 0, 0 1 1, 1 1 1, 1 1 0, 0 1 0)), ((0 0 1, 1 0 1, 1 1 1, 0 1 1, 0 0 1)) )') ) AS gdump
    ) AS g;
-- 結果 --
  path   |     wkt
---------+--------------
 {1,1,1} | POINT(0 0 0)
 {1,1,2} | POINT(0 0 1)
 {1,1,3} | POINT(0 1 1)
 {1,1,4} | POINT(0 1 0)
 {1,1,5} | POINT(0 0 0)
 {2,1,1} | POINT(0 0 0)
 {2,1,2} | POINT(0 1 0)
 {2,1,3} | POINT(1 1 0)
 {2,1,4} | POINT(1 0 0)
 {2,1,5} | POINT(0 0 0)
 {3,1,1} | POINT(0 0 0)
 {3,1,2} | POINT(1 0 0)
 {3,1,3} | POINT(1 0 1)
 {3,1,4} | POINT(0 0 1)
 {3,1,5} | POINT(0 0 0)
 {4,1,1} | POINT(1 1 0)
 {4,1,2} | POINT(1 1 1)
 {4,1,3} | POINT(1 0 1)
 {4,1,4} | POINT(1 0 0)
 {4,1,5} | POINT(1 1 0)
 {5,1,1} | POINT(0 1 0)
 {5,1,2} | POINT(0 1 1)
 {5,1,3} | POINT(1 1 1)
 {5,1,4} | POINT(1 1 0)
 {5,1,5} | POINT(0 1 0)
 {6,1,1} | POINT(0 0 1)
 {6,1,2} | POINT(1 0 1)
 {6,1,3} | POINT(1 1 1)
 {6,1,4} | POINT(0 1 1)
 {6,1,5} | POINT(0 0 1)
(30 rows)</pre><pre class="programlisting">-- 三角形 --
SELECT (g.gdump).path, ST_AsText((g.gdump).geom) as wkt
  FROM
    (SELECT
       ST_DumpPoints( ST_GeomFromEWKT('TRIANGLE ((
                0 0,
                0 9,
                9 0,
                0 0
            ))') ) AS gdump
    ) AS g;
-- 結果 --
 path |    wkt
------+------------
 {1}  | POINT(0 0)
 {2}  | POINT(0 9)
 {3}  | POINT(9 0)
 {4}  | POINT(0 0)
</pre><pre class="programlisting">-- TIN --
SELECT (g.gdump).path, ST_AsEWKT((g.gdump).geom) as wkt
  FROM
    (SELECT
       ST_DumpPoints( ST_GeomFromEWKT('TIN (((
                0 0 0,
                0 0 1,
                0 1 0,
                0 0 0
            )), ((
                0 0 0,
                0 1 0,
                1 1 0,
                0 0 0
            ))
            )') ) AS gdump
    ) AS g;
-- 結果 --
  path   |     wkt
---------+--------------
 {1,1,1} | POINT(0 0 0)
 {1,1,2} | POINT(0 0 1)
 {1,1,3} | POINT(0 1 0)
 {1,1,4} | POINT(0 0 0)
 {2,1,1} | POINT(0 0 0)
 {2,1,2} | POINT(0 1 0)
 {2,1,3} | POINT(1 1 0)
 {2,1,4} | POINT(0 0 0)
(8 rows)
</pre></div><div class="refsection"><a name="idp80046024"></a><h2>関連情報</h2><p><a class="xref" href="#geometry_dump" title="geometry_dump">geometry_dump</a>, <a class="xref" href="#PostGIS_Geometry_DumpFunctions" title="14.6. PostGISジオメトリ/ジオグラフィ/ラスタのダンプ関数">「PostGISジオメトリ/ジオグラフィ/ラスタのダンプ関数」</a>, <a class="xref" href="#ST_Dump" title="ST_Dump">ST_Dump</a>, <a class="xref" href="#ST_DumpRings" title="ST_DumpRings">ST_DumpRings</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_DumpRings"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_DumpRings — ポリゴンの外環と内環を表す<code class="varname">geometry_dump</code>行の集合を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry_dump[] <b class="fsfunc">ST_DumpRings</b>(</code>geometry  <var class="pdparam">a_polygon</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp80053320"></a><h2>説明</h2><p>これは集合を返す関数 (SRF=set-returning function)です。それぞれ"path", "geom"と別名が付けられた<code class="varname">integer[]</code>と<code class="varname">geometry</code>で定義さた<code class="varname">geometry_dump</code>行の集合を返します。"path"フィールドは、単一整数を持つ環のインデクスで、0が外環で、0より大きい値は内環です。"geom"フィールドは、対応する環をポリゴンで持ちます。</p><p>Availability: PostGIS 1.1.3 PostgreSQL 7.3以上が必要です。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>POLYGONジオメトリでのみ動作します。MULTIPOLYGONでは動作しません。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp80058056"></a><h2>例</h2><pre class="programlisting">SELECT sometable.field1, sometable.field1,
          (ST_DumpRings(sometable.the_geom)).geom As the_geom
FROM sometableOfpolys;

SELECT ST_AsEWKT(geom) As the_geom, path
        FROM ST_DumpRings(
                ST_GeomFromEWKT('POLYGON((-8149064 5133092 1,-8149064 5132986 1,-8148996 5132839 1,-8148972 5132767 1,-8148958 5132508 1,-8148941 5132466 1,-8148924 5132394 1,
                -8148903 5132210 1,-8148930 5131967 1,-8148992 5131978 1,-8149237 5132093 1,-8149404 5132211 1,-8149647 5132310 1,-8149757 5132394 1,
                -8150305 5132788 1,-8149064 5133092 1),
                (-8149362 5132394 1,-8149446 5132501 1,-8149548 5132597 1,-8149695 5132675 1,-8149362 5132394 1))')
                )  as foo;
 path |                                            the_geom
----------------------------------------------------------------------------------------------------------------
  {0} | POLYGON((-8149064 5133092 1,-8149064 5132986 1,-8148996 5132839 1,-8148972 5132767 1,-8148958 5132508 1,
          |          -8148941 5132466 1,-8148924 5132394 1,
          |          -8148903 5132210 1,-8148930 5131967 1,
          |          -8148992 5131978 1,-8149237 5132093 1,
          |          -8149404 5132211 1,-8149647 5132310 1,-8149757 5132394 1,-8150305 5132788 1,-8149064 5133092 1))
  {1} | POLYGON((-8149362 5132394 1,-8149446 5132501 1,
          |          -8149548 5132597 1,-8149695 5132675 1,-8149362 5132394 1))</pre></div><div class="refsection"><a name="idp80063688"></a><h2>関連情報</h2><p><a class="xref" href="#geometry_dump" title="geometry_dump">geometry_dump</a>, <a class="xref" href="#PostGIS_Geometry_DumpFunctions" title="14.6. PostGISジオメトリ/ジオグラフィ/ラスタのダンプ関数">「PostGISジオメトリ/ジオグラフィ/ラスタのダンプ関数」</a>, <a class="xref" href="#ST_Dump" title="ST_Dump">ST_Dump</a>, <a class="xref" href="#ST_ExteriorRing" title="ST_ExteriorRing">ST_ExteriorRing</a>, <a class="xref" href="#ST_InteriorRingN" title="ST_InteriorRingN">ST_InteriorRingN</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_FlipCoordinates"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_FlipCoordinates — 与えられたジオメトリのX軸とY軸とを入れ替えたものを返します。緯度/経度のフィーチャーを構築して、これを訂正したい場合に使えます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_FlipCoordinates</b>(</code>geometry <var class="pdparam">geom</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp80083272"></a><h2>説明</h2><p>与えられたジオメトリのX軸とY軸とを入れ替えたものを返します。</p><p>Availability: 2.0.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports M coordinates.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div><div class="refsection"><a name="idp80095688"></a><h2>例</h2><pre class="programlisting">
SELECT ST_AsEWKT(ST_FlipCoordinates(GeomFromEWKT('POINT(1 2)')));
 st_asewkt
------------
POINT(2 1)
                 </pre></div><div class="refsection"><a name="idp80097352"></a><h2>関連情報</h2><p> <a class="xref" href="#ST_SwapOrdinates" title="ST_SwapOrdinates">ST_SwapOrdinates</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_GeneratePoints"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_GeneratePoints — ポリゴンまたはマルチポリゴンから、元の領域の内部の、乱数で決められた位置に置かれた点からなるマルチポイントに変換します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_GeneratePoints</b>(</code> <var class="pdparam">g</var> geometry ,  <var class="pdparam">npoints</var> numeric <code>)</code>;</p></div></div><div class="refsection"><a name="idp80104904"></a><h2>説明</h2><p>ST_GeneratePointsは、指定された個数が入力領域内に出現するまで、擬似乱数による点を生成します。 </p><p>Availability: 2.3.0</p></div><div class="refsection"><a name="idp80106440"></a><h2>例</h2><div class="informaltable"><table class="informaltable" border="1"><colgroup><col><col></colgroup><tbody><tr><td>
						<div class="informalfigure"><div class="mediaobject"><img src="images/st_generatepoints01.png"><div class="caption"><p>元のポリゴン</p></div></div></div><p>
						</p>
					</td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_generatepoints02.png"><div class="caption"><p>元のポリゴンの上に重ねた、生成された12個のポイント</p></div></div></div><p>
						</p><pre class="programlisting">SELECT ST_GeneratePoints(
        ST_Buffer(
                ST_GeomFromText(
                'LINESTRING(50 50,150 150,150 50)'
                ), 10, 'endcap=round join=round'), 12);</pre><p>
					</p></td></tr></tbody></table></div></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Intersection"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Intersection — (T) geomAとgeomBの共有する部分を表現するジオメトリを返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Intersection</b>(</code> geometry <var class="pdparam">geomA</var> ,  geometry <var class="pdparam">geomB</var> <code>)</code>;</p><p><code class="funcdef">geography <b class="fsfunc">ST_Intersection</b>(</code> geography <var class="pdparam">geogA</var> ,  geography <var class="pdparam">geogB</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp80124488"></a><h2>説明</h2><p>ジオメトリのインタセクションとなる点集合を表現するジオメトリを返します。</p><p>言い換えると、ジオメトリAとジオメトリBとで共有されている部分のことです。</p><p>ジオメトリの共有部分が無い (非接触になる)場合には、空ジオメトリコレクションが返されます。</p><p>ST_IntersectionとST_Intersectsとの併用は、バウンディングボックス、バッファ、領域のクエリ等で、対象とする国または地域にあるジオメトリの部分の返ってほしいところを切り取るのに、非常に便利です。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ジオグラフィ: ジオメトリ実装にかぶさる、薄いラッパです。ジオグラフィオブジェクトのバウンディングボックスに最適なSRIDを決定し (UTMが望ましいですが、ランベルト正積方位図法 (北/南)、最悪のシナリオでメルカトルに頼ります)、その平面でバッファを生成し、WGS84ジオグラフィに戻します。</p></td></tr></table></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[重要]" src="images/important.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">GEOMETRYCOLLECTION</code>を引数として呼ばないでください。</p></td></tr></table></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はM値が存在している場合には削除します。</p></td></tr></table></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>3次元ジオメトリで動作させるにはSFCGALベースの<a class="xref" href="#ST_3DIntersection" title="ST_3DIntersection">ST_3DIntersection</a>を使います。3次元ジオメトリに適切な3次元インタセクションを生成します。この関数はZ軸を持っていても動作しますが、<code class="code">postgis.backend=geos</code>の時はZ値の平均をとります。<code class="code">postgis.backend=sfcgal</code>とすると、Z軸を無視して2次元ジオメトリを返します。詳細については<a class="xref" href="#postgis_backend" title="postgis.backend">postgis.backend</a>を参照してください。</p></td></tr></table></div><p>GEOSモジュールによって実現しています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method is also provided by SFCGAL backend.</p><p>Availability: 1.5 ジオグラフィ型が導入されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a> s2.1.1.3</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 5.1.18</p></div><div class="refsection"><a name="idp80136136"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(ST_Intersection('POINT(0 0)'::geometry, 'LINESTRING ( 2 0, 0 2 )'::geometry));
 st_astext
---------------
GEOMETRYCOLLECTION EMPTY
(1 row)
SELECT ST_AsText(ST_Intersection('POINT(0 0)'::geometry, 'LINESTRING ( 0 0, 0 2 )'::geometry));
 st_astext
---------------
POINT(0 0)
(1 row)

-- trailsテーブルの線を全てをcountryテーブル
--   (POLYGONかMULTIPOLYGONであるとします)で切り抜きます
-- ご注意: trailsが点を共有することに注意を払っていないため
--  LINESTRINGかMULTILINESTRINGとなるインタセクションのみを
--   抜き出すようにしています
-- ダンプはコレクションから個々のMULTI系ポリゴンに展開するために必要です
-- 下に示したのは、かなり一般的なもので、WHERE節を変更するだけで
--  ポリゴンや他でも動作します。
SELECT clipped.gid, clipped.f_name, clipped_geom
FROM (SELECT trails.gid, trails.f_name, (ST_Dump(ST_Intersection(country.the_geom, trails.the_geom))).geom As clipped_geom
FROM country
        INNER JOIN trails
        ON ST_Intersects(country.the_geom, trails.the_geom))  As clipped
        WHERE ST_Dimension(clipped.clipped_geom) = 1 ;

-- ランドマーク等のポリゴンに対しては、
-- 0.0を指定したバッファを使う、高速にする技を使うことができます
-- ただし、ポリゴンが空のジオメトリコレクションの結果になる時を除きます
-- (ジオメトリコレクションはポリゴン、ライン、ポイントを含みます)
-- 0.0でバッファを施すと、ポリゴンはそのままで、コレクションの殻は分解されます。
SELECT poly.gid,  ST_Multi(ST_Buffer(
                                ST_Intersection(country.the_geom, poly.the_geom),
                                0.0)
                                ) As clipped_geom
FROM country
        INNER JOIN poly
        ON ST_Intersects(country.the_geom, poly.the_geom)
        WHERE Not ST_IsEmpty(ST_Buffer(ST_Intersection(country.the_geom, poly.the_geom),0.0));
                </pre></div><div class="refsection"><a name="idp80137416"></a><h2>例: 2.5次元的なもの</h2><p>GEOSが、バックエンド指定がない場合のデフォルトです。<a class="xref" href="#ST_3DIntersection" title="ST_3DIntersection">ST_3DIntersection</a>を使った同じ例と比較します。</p><pre class="programlisting">set postgis.backend=geos;
select ST_AsText(ST_Intersection(linestring, polygon)) As wkt
from  ST_GeomFromText('LINESTRING Z (2 2 6,1.5 1.5 7,1 1 8,0.5 0.5 8,0 0 10)') AS linestring
 CROSS JOIN ST_GeomFromText('POLYGON((0 0 8, 0 1 8, 1 1 8, 1 0 8, 0 0 8))') AS polygon;

               st_astext
---------------------------------------
 LINESTRING Z (1 1 8,0.5 0.5 8,0 0 10)
                </pre><p>PostGISをSFCGAL対応でコンパイルしている場合には、SFCGAL使用の選択肢があります。ただし、基本的にインタセクション実行前にジオメトリを2次元に落とし、ST_Force2Dと等価な2次元ジオメトリを返します。</p><pre class="programlisting">set postgis.backend=sfcgal;
select ST_AsText(ST_Intersection(linestring, polygon)) As wkt
from  ST_GeomFromText('LINESTRING Z (2 2 6,1.5 1.5 7,1 1 8,0.5 0.5 8,0 0 10)') AS linestring
 CROSS JOIN ST_GeomFromText('POLYGON((0 0 8, 0 1 8, 1 1 8, 1 0 8, 0 0 8))') AS polygon;

                     wkt
----------------------------------------------
 MULTILINESTRING((0.5 0.5,0 0),(1 1,0.5 0.5))
                </pre></div><div class="refsection"><a name="idp80140360"></a><h2>関連情報</h2><p><a class="xref" href="#ST_3DIntersection" title="ST_3DIntersection">ST_3DIntersection</a>, <a class="xref" href="#ST_Difference" title="ST_Difference">ST_Difference</a>, <a class="xref" href="#ST_Dimension" title="ST_Dimension">ST_Dimension</a>, <a class="xref" href="#ST_Dump" title="ST_Dump">ST_Dump</a>, <a class="xref" href="#ST_Force2D" title="ST_Force2D">ST_Force2D</a>, <a class="xref" href="#ST_SymDifference" title="ST_SymDifference">ST_SymDifference</a>, <a class="xref" href="#ST_Intersects" title="ST_Intersects">ST_Intersects</a>, <a class="xref" href="#ST_Multi" title="ST_Multi">ST_Multi</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_LineToCurve"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_LineToCurve — LINESTRING/POLYGONをCIRCULARSTRINGかCURVEPOLYGONに変換します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_LineToCurve</b>(</code>geometry  <var class="pdparam">geomANoncircular</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp80148808"></a><h2>説明</h2><p>LINESTRING/POLYGONをCIRCULARSTRINGと曲線ポリゴンに変換します。等価の曲線を記述するのに必要なポイントが少なくなります。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>入力ラインストリング/ポリゴンが、曲線をはっきりと表現するのには不十分な場合には、関数は入力ジオメトリと同じものを返します。</p></td></tr></table></div><p>Availability: 1.3.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p></div><div class="refsection"><a name="idp80153416"></a><h2>例</h2><pre class="programlisting">-- 2次元の例
SELECT ST_AsText(ST_LineToCurve(foo.the_geom)) As curvedastext,ST_AsText(foo.the_geom) As non_curvedastext
        FROM (SELECT ST_Buffer('POINT(1 3)'::geometry, 3) As the_geom) As foo;

curvedatext                                                            non_curvedastext
--------------------------------------------------------------------|-----------------------------------------------------------------
CURVEPOLYGON(CIRCULARSTRING(4 3,3.12132034355964 0.878679656440359, | POLYGON((4 3,3.94235584120969 2.41472903395162,3.77163859753386 1.85194970290473,
1 0,-1.12132034355965 5.12132034355963,4 3))                        |  3.49440883690764 1.33328930094119,3.12132034355964 0.878679656440359,
                                                                    |  2.66671069905881 0.505591163092366,2.14805029709527 0.228361402466141,
                                                                    |  1.58527096604839 0.0576441587903094,1 0,
                                                                    |  0.414729033951621 0.0576441587903077,-0.148050297095264 0.228361402466137,
                                                                    |  -0.666710699058802 0.505591163092361,-1.12132034355964 0.878679656440353,
                                                                    |  -1.49440883690763 1.33328930094119,-1.77163859753386 1.85194970290472
                                                                    |  --ETC-- ,3.94235584120969 3.58527096604839,4 3))

-- 3次元の例
SELECT ST_AsText(ST_LineToCurve(geom)) As curved, ST_AsText(geom) AS not_curved
FROM (SELECT ST_Translate(ST_Force3D(ST_Boundary(ST_Buffer(ST_Point(1,3), 2,2))),0,0,3) AS geom) AS foo;

                        curved                        |               not_curved
------------------------------------------------------+---------------------------------------------------------------------
 CIRCULARSTRING Z (3 3 3,-1 2.99999999999999 3,3 3 3) | LINESTRING Z (3 3 3,2.4142135623731 1.58578643762691 3,1 1 3,
                                                      |        -0.414213562373092 1.5857864376269 3,-1 2.99999999999999 3,
                                                      | -0.414213562373101 4.41421356237309 3,
                                                      |        0.999999999999991 5 3,2.41421356237309 4.4142135623731 3,3 3 3)
(1 row)
</pre></div><div class="refsection"><a name="idp80154952"></a><h2>関連情報</h2><p><a class="xref" href="#ST_CurveToLine" title="ST_CurveToLine">ST_CurveToLine</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_MakeValid"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MakeValid — 頂点を失うことなしに不正なジオメトリを妥当なジオメトリにしようと試みます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_MakeValid</b>(</code>geometry <var class="pdparam">input</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp80189384"></a><h2>説明</h2><p>入力頂点を失うことなしに、与えられた不正なジオメトリの妥当な表現を生成しようと試みます。既に妥当であるジオメトリは、さらなる操作を行わずに返ります。 </p><p>対応する入力はPOINTS, MULTIPOINTS, LINESTRING, MULTILINESTRING, POLYGON, MULTIPOLYGON, GEOMETRYCOLLECTIONおよびそれらの混交したものです。 </p><p>全部また部分的に次元減少が発生した場合には、出力ジオメトリが低い次元のジオメトリまたは元の次元以下の次元のコレクションになります。 </p><p>単一ポリゴンは、自己インタセクトがある場合には、マルチポリゴンになります。 </p><p>Availability: 2.0.0, GEOS 3.3.0以上が必要です。</p><p>Enhanced: 2.0.1 速度向上しました。GEOS 3.3.4が必要です。</p><p>Enhanced: 2.1.0 GEOMETRYCOLLECTIONとMULTIPOINTに対応するようになりました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp78764872"></a><h2>関連情報</h2><p>
                <a class="xref" href="#ST_IsValid" title="ST_IsValid">ST_IsValid</a>
                <a class="xref" href="#ST_CollectionExtract" title="ST_CollectionExtract">ST_CollectionExtract</a>
            </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_MemUnion"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MemUnion — ST_Unionと同じですが、メモリフレンドリ (少ないメモリ使用、多いCPU時間)です。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_MemUnion</b>(</code>geometry set <var class="pdparam">geomfield</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp80200776"></a><h2>説明</h2><p>(説明を記載)</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_Unionと同じですが、メモリフレンドリ (少ないメモリ使用、多いCPU時間)です。この集約関数は、最初に配列を作って結合していくST_Union集約関数と対象的に、一つずつ前の結果にジオメトリを結合させることによって動作します。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp80204360"></a><h2>例</h2><pre class="programlisting">ST_Unionを参照して下さい。</pre></div><div class="refsection"><a name="idp80205896"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Union" title="ST_Union">ST_Union</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_MinimumBoundingCircle"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MinimumBoundingCircle — ジオメトリを完全に含む最小の円ポリゴンを返します。デフォルトでは、4分の1円に対して48区分を使用します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_MinimumBoundingCircle</b>(</code>geometry  <var class="pdparam">geomA</var>, integer  <var class="pdparam">num_segs_per_qt_circ=48</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp80212808"></a><h2>説明</h2><p>ジオメトリを完全に含む最小の円ポリゴンを返します。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>円はポリゴンで近似されます。デフォルトでは、4分の1円で48辺です。このポリゴンは円の最小バウンディングボックスの近似であるので、入力ジオメトリのいくつかの点はポリゴンに入らない可能性があります。この近似は辺の数を増やすことによって改善され、辺の数を増やすことで得られる不利益は小さいです。ポリゴン近似が適切でない場合のアプリケーションにおいては、ST_MinimumBoundingRadiusを使います。</p></td></tr></table></div><p>しばしば、MULTI系とジオメトリコレクションで使用します。しかし、集約関数ではありません。ST_Collectと併用して、ジオメトリの集合の最小包含円を得ます。ST_MinimumBoundingCircle(ST_Collect(somepointfield))とします。</p><p>ポリゴンの面積を最小包含円の面積で割った割合は、しばしばRoeckテストとして参照されます。</p><p>Availability: 1.4.0 - GEOSが必要です。</p></div><div class="refsection"><a name="idp80215624"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Collect" title="ST_Collect">ST_Collect</a>, <a class="xref" href="#ST_MinimumBoundingRadius" title="ST_MinimumBoundingRadius">ST_MinimumBoundingRadius</a></p></div><div class="refsection"><a name="idp80217288"></a><h2>例</h2><pre class="programlisting">SELECT d.disease_type,
        ST_MinimumBoundingCircle(ST_Collect(d.the_geom)) As the_geom
        FROM disease_obs As d
        GROUP BY d.disease_type;
</pre><div class="informalfigure"><div class="mediaobject"><img src="images/st_minimumboundingcircle01.png"><div class="caption"><p>ポイントとラインストリングの最小包含円です。4分の1円の近似に8区分使用しています。</p></div></div></div><pre class="programlisting">SELECT ST_AsText(ST_MinimumBoundingCircle(
                ST_Collect(
                        ST_GeomFromText('LINESTRING(55 75,125 150)'),
                                ST_Point(20, 80)), 8
                                )) As wktmbc;
wktmbc
-----------
POLYGON((135.59714732062 115,134.384753327498 102.690357210921,130.79416296937 90.8537670908995,124.963360620072 79.9451031602111,117.116420743937 70.3835792560632,107.554896839789 62.5366393799277,96.6462329091006 56.70583703063,84.8096427890789 53.115246672502,72.5000000000001 51.9028526793802,60.1903572109213 53.1152466725019,48.3537670908996 56.7058370306299,37.4451031602112 62.5366393799276,27.8835792560632 70.383579256063,20.0366393799278 79.9451031602109,14.20583703063 90.8537670908993,10.615246672502 102.690357210921,9.40285267938019 115,10.6152466725019 127.309642789079,14.2058370306299 139.1462329091,20.0366393799275 150.054896839789,27.883579256063 159.616420743937,
37.4451031602108 167.463360620072,48.3537670908992 173.29416296937,60.190357210921 176.884753327498,
72.4999999999998 178.09714732062,84.8096427890786 176.884753327498,96.6462329091003 173.29416296937,107.554896839789 167.463360620072,
117.116420743937 159.616420743937,124.963360620072 150.054896839789,130.79416296937 139.146232909101,134.384753327498 127.309642789079,135.59714732062 115))
                                </pre></div><div class="refsection"><a name="idp80221384"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Collect" title="ST_Collect">ST_Collect</a>, <a class="xref" href="#ST_MinimumBoundingRadius" title="ST_MinimumBoundingRadius">ST_MinimumBoundingRadius</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_MinimumBoundingRadius"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MinimumBoundingRadius — ジオメトリを完全に包含する最小円の中心ポイントと半径を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">(geometry, double precision) <b class="fsfunc">ST_MinimumBoundingRadius</b>(</code>geometry <var class="pdparam">geom</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp80227528"></a><h2>説明</h2><p>ジオメトリを完全に包含する最小円の中心ポイントと半径を返します。</p><p>ジオメトリの集合の最小包含円を得るには<a class="xref" href="#ST_Collect" title="ST_Collect">ST_Collect</a>と併用します。</p><p>Availability: 2.3.0</p></div><div class="refsection"><a name="idp80229832"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Collect" title="ST_Collect">ST_Collect</a>, <a class="xref" href="#ST_MinimumBoundingCircle" title="ST_MinimumBoundingCircle">ST_MinimumBoundingCircle</a></p></div><div class="refsection"><a name="idp80231496"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(center), radius FROM ST_MinimumBoundingRadius('POLYGON((26426 65078,26531 65242,26075 65136,26096 65427,26426 65078))');

                st_astext                 |      radius
------------------------------------------+------------------
 POINT(26284.8418027133 65267.1145090825) | 247.436045591407
</pre></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_OrientedEnvelope"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_OrientedEnvelope — ジオメトリを囲む最小の回転した四角形を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_OrientedEnvelope</b>(</code> geometry <var class="pdparam">geom</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp80237512"></a><h2>説明</h2><p>ジオメトリを囲む最小の回転した四角形を返します。二つ以上の最小回転矩形が存在することがあるので注意して下さい。入力が退化している場合には、ポイントまたはラインストリングを返すことがあります。 </p><p>Availability: 2.5.0 </p></div><div class="refsection"><a name="idp80239048"></a><h2>関連情報</h2><p>
				<a class="xref" href="#ST_Envelope" title="ST_Envelope">ST_Envelope</a>
				<a class="xref" href="#ST_MinimumBoundingCircle" title="ST_MinimumBoundingCircle">ST_MinimumBoundingCircle</a>
			</p></div><div class="refsection"><a name="idp80240968"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(-- 複雑なジオメトリの適切な分割);

                                st_astext
                                ------------------------------------------------
                                POLYGON((3 2,2.88 2.16,-1.12 -0.84,-1 -1,3 2))
                        </pre><div class="informalfigure"><div class="mediaobject"><img src="images/st_orientedenvelope01.png"><div class="caption"><p>ポイントとラインストリングの最小バウンディングボックス</p></div></div></div><pre class="programlisting">SELECT ST_AsText(ST_OrientedEnvelope(
                ST_Collect(
                        ST_GeomFromText('LINESTRING(55 75,125 150)'),
                                ST_Point(20, 80))
                                )) As wktenv;
wktenv
-----------
POLYGON((19.9999999999997 79.9999999999999,33.0769230769229 60.3846153846152,138.076923076924 130.384615384616,125.000000000001 150.000000000001,19.9999999999997 79.9999999999999))
</pre></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Polygonize"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Polygonize — 集約関数。ジオメトリの集合のラインから形成されうるポリゴンを含むジオメトリコレクションを生成します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Polygonize</b>(</code>geometry set <var class="pdparam">geomfield</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_Polygonize</b>(</code>geometry[] <var class="pdparam">geom_array</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp80251592"></a><h2>説明</h2><p>ジオメトリの集合のラインから形成された可能なポリゴンを含むジオメトリコレクションを生成します。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ジオメトリコレクションはしばしばサードパーティのツールでは扱いにくいことがあります。ST_Polygonizeを<a class="xref" href="#ST_Dump" title="ST_Dump">ST_Dump</a>と併用して、ポリゴンを個々のポリゴンにダンプします。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数が正しく動作するには、入力ラインに正しくノードが作成されている必要があります。</p></td></tr></table></div><p>Availability: 1.0.0RC1 - GEOS 2.1.0が必要です。</p></div><div class="refsection"><a name="idp80255048"></a><h2>例: 単一ラインストリングのポリゴン化</h2><pre class="programlisting">SELECT ST_AsEWKT(ST_Polygonize(the_geom_4269)) As geomtextrep
FROM (SELECT the_geom_4269 FROM ma.suffolk_edges ORDER BY tlid LIMIT 45) As foo;

geomtextrep
-------------------------------------
 SRID=4269;GEOMETRYCOLLECTION(POLYGON((-71.040878 42.285678,-71.040943 42.2856,-71.04096 42.285752,-71.040878 42.285678)),
 POLYGON((-71.17166 42.353675,-71.172026 42.354044,-71.17239 42.354358,-71.171794 42.354971,-71.170511 42.354855,
 -71.17112 42.354238,-71.17166 42.353675)))
(1 row)

-- ポリゴン化ジオメトリを個々のポリゴンにダンプするためST_Dumpを使います
SELECT ST_AsEWKT((ST_Dump(foofoo.polycoll)).geom) As geomtextrep
FROM (SELECT ST_Polygonize(the_geom_4269) As polycoll
        FROM (SELECT the_geom_4269 FROM ma.suffolk_edges
                ORDER BY tlid LIMIT 45) As foo) As foofoo;

geomtextrep
------------------------
 SRID=4269;POLYGON((-71.040878 42.285678,-71.040943 42.2856,-71.04096 42.285752,
-71.040878 42.285678))
 SRID=4269;POLYGON((-71.17166 42.353675,-71.172026 42.354044,-71.17239 42.354358
,-71.171794 42.354971,-71.170511 42.354855,-71.17112 42.354238,-71.17166 42.353675))
(2 rows)

                          </pre></div><div class="refsection"><a name="idp80256328"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Node" title="ST_Node">ST_Node</a>, <a class="xref" href="#ST_Dump" title="ST_Dump">ST_Dump</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Node"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Node — ラインストリングの集合にノードを作成します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Node</b>(</code>geometry  <var class="pdparam">geom</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp80262600"></a><h2>説明</h2><p>最小の可能なノード数を使ってラインストリングにノードを作成します。全ての入力ラインストリングは保存されます。 </p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p>Availability: 2.0.0 - GEOS 3.3.0以上が必要 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>GEOS 3.3.1までのバグのため、この関数は自己インタセクトするラインのノード作成に失敗します。GEOS 3.3.2以上で訂正されています。 </p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Changed: 2.4.0 この関数は内部でGEOSUnaryUnionの替わりにGEOSNodeを使用しています。ラインストリングの並び順と方向がPostGIS 2.4より前のものと違うことになるかも知れません。 </p></td></tr></table></div></div><div class="refsection"><a name="idp80287048"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(
                ST_Node('LINESTRINGZ(0 0 0, 10 10 10, 0 10 5, 10 0 3)'::geometry)
        ) As  output;
output
-----------
MULTILINESTRING Z ((0 0 0,5 5 4.5),(5 5 4.5,10 10 10,0 10 5,5 5 4.5),(5 5 4.5,10 0 3))
                </pre></div><div class="refsection"><a name="idp80288584"></a><h2>関連情報</h2><p>
			<a class="xref" href="#ST_UnaryUnion" title="ST_UnaryUnion">ST_UnaryUnion</a>
		</p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_OffsetCurve"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_OffsetCurve — 与えられた距離と方面に入力ラインをずらしたラインを返します。中心線と平行する線を引く際に使えます。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_OffsetCurve</b>(</code>geometry  <var class="pdparam">line</var>, float  <var class="pdparam">signed_distance</var>, text  <var class="pdparam">style_parameters=''</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp80296776"></a><h2>説明</h2><p>与えられた距離と方面に入力ラインをずらしたラインを返します。返されるジオメトリの全てのポイントは、入力ジオメトリより与えられた距離以上には離れません。 </p><p>距離が正の場合には、入力ラインの左側にずらして、方向が保持されます。負の場合には、右側にずらし、逆方向のラインになります。 </p><p>Availability: 2.0 - GEOS 3.2以上、GEOS 3.3以上で改善されました。 </p><p>Enhanced: 2.5 - GEOMETRYCOLLECTIONとMULTILINESTRINGに対応するようになりました。 </p><p>任意指定の第3引数では、空白区切りのkey=valueペアの一覧を指定して、次のような操作をすることができます。 </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>'quad_segs=#' : 4分の1円区分数に近づけるために使われる区分の数 (デフォルトは8)。</p></li><li class="listitem"><p>'join=round|mitre|bevel' : 接続スタイル (デフォルトは"round")。'miter'も'mitre'の同義語として受け付けます。</p></li><li class="listitem"><p>'mitre_limit=#.#' : マイターの割合制限 (接続スタイルがマイターである場合のみ影響が出ます)。'miter_limit'も'mitre_limit'の同義語として受け付けます。</p></li></ul></div><p>
				</p><p>距離の単位は空間参照系の単位です。 </p><p>GEOSモジュールで実現しています。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数は第3次元 (Z)を無視し、3次元ジオメトリが与えられたとしても、常に2次元の結果を返します。</p></td></tr></table></div></div><div class="refsection"><a name="idp80303432"></a><h2>例</h2><p>道路の周りの開いたバッファの算出</p><pre class="programlisting">SELECT ST_Union(
 ST_OffsetCurve(f.the_geom,  f.width/2, 'quad_segs=4 join=round'),
 ST_OffsetCurve(f.the_geom, -f.width/2, 'quad_segs=4 join=round')
) as track
FROM someroadstable;

                                </pre><div class="informaltable"><table class="informaltable" border="1"><colgroup><col><col></colgroup><tbody><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_offsetcurve01.png"><div class="caption"><p>15, 'quad_segs=4 join=round' 元のラインと15単位ずらしたライン。</p></div></div></div><p>
				</p><pre class="programlisting">SELECT ST_AsText(ST_OffsetCurve(ST_GeomFromText(
'LINESTRING(164 16,144 16,124 16,104 16,84 16,64 16,
        44 16,24 16,20 16,18 16,17 17,
        16 18,16 20,16 40,16 60,16 80,16 100,
        16 120,16 140,16 160,16 180,16 195)'),
        15, 'quad_segs=4 join=round'));
-- 出力 --
LINESTRING(164 1,18 1,12.2597485145237 2.1418070123307,
        7.39339828220179 5.39339828220179,
        5.39339828220179 7.39339828220179,
        2.14180701233067 12.2597485145237,1 18,1 195)
                                </pre><p>
						  </p></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_offsetcurve02.png"><div class="caption"><p>-15, 'quad_segs=4 join=round' 元のラインと-15単位ずらしたライン。 </p></div></div></div><p>
				</p><pre class="programlisting">SELECT ST_AsText(ST_OffsetCurve(geom,
        -15, 'quad_segs=4 join=round')) As notsocurvy
        FROM ST_GeomFromText(
'LINESTRING(164 16,144 16,124 16,104 16,84 16,64 16,
        44 16,24 16,20 16,18 16,17 17,
        16 18,16 20,16 40,16 60,16 80,16 100,
        16 120,16 140,16 160,16 180,16 195)') As geom;
-- 曲線になりません --
LINESTRING(31 195,31 31,164 31)
                                </pre><p>
						</p></td></tr><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_offsetcurve05.png"><div class="caption"><p>二重にずらして曲線を得ます。1回目で逆方向にしていて、-30 + 15 = -15としています。</p></div></div></div><p>
				</p><pre class="programlisting">SELECT ST_AsText(ST_OffsetCurve(ST_OffsetCurve(geom,
        -30, 'quad_segs=4 join=round'), -15, 'quad_segs=4 join=round')) As morecurvy
        FROM ST_GeomFromText(
'LINESTRING(164 16,144 16,124 16,104 16,84 16,64 16,
        44 16,24 16,20 16,18 16,17 17,
        16 18,16 20,16 40,16 60,16 80,16 100,
        16 120,16 140,16 160,16 180,16 195)') As geom;
-- 曲線になります --
LINESTRING(164 31,46 31,40.2597485145236 32.1418070123307,
35.3933982822018 35.3933982822018,
32.1418070123307 40.2597485145237,31 46,31 195)
                                </pre><p>
						</p></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_offsetcurve06.png"><div class="caption"><p>二重にずらして曲線を得て、順方向に15ずらして平行線を得ます。元のラインを覆います。</p></div></div></div><p>
				</p><pre class="programlisting">SELECT ST_AsText(ST_Collect(
        ST_OffsetCurve(geom, 15, 'quad_segs=4 join=round'),
        ST_OffsetCurve(ST_OffsetCurve(geom,
        -30, 'quad_segs=4 join=round'), -15, 'quad_segs=4 join=round')
        )
) As parallel_curves
        FROM ST_GeomFromText(
'LINESTRING(164 16,144 16,124 16,104 16,84 16,64 16,
        44 16,24 16,20 16,18 16,17 17,
        16 18,16 20,16 40,16 60,16 80,16 100,
        16 120,16 140,16 160,16 180,16 195)') As geom;
-- parallel curves (平行曲線)  --
MULTILINESTRING((164 1,18 1,12.2597485145237 2.1418070123307,
7.39339828220179 5.39339828220179,5.39339828220179 7.39339828220179,
2.14180701233067 12.2597485145237,1 18,1 195),
(164 31,46 31,40.2597485145236 32.1418070123307,35.3933982822018 35.3933982822018,
32.1418070123307 40.2597485145237,31 46,31 195))
                                </pre><p>
						</p></td></tr><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_offsetcurve03.png"><div class="caption"><p>15, 'quad_segs=4 join=bevel' と元のライン</p></div></div></div><p>
				</p><pre class="programlisting">SELECT ST_AsText(ST_OffsetCurve(ST_GeomFromText(
'LINESTRING(164 16,144 16,124 16,104 16,84 16,64 16,
        44 16,24 16,20 16,18 16,17 17,
        16 18,16 20,16 40,16 60,16 80,16 100,
        16 120,16 140,16 160,16 180,16 195)'),
                15, 'quad_segs=4 join=bevel'));
-- 出力 --
LINESTRING(164 1,18 1,7.39339828220179 5.39339828220179,
        5.39339828220179 7.39339828220179,1 18,1 195)
                                </pre><p>
						 </p></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_offsetcurve04.png"><div class="caption"><p>join=mitre mitre_limit=2.1で、15ずらしたものと-15ずらしたものとを集めたもの。</p></div></div></div><p>
				</p><pre class="programlisting">SELECT ST_AsText(ST_Collect(
        ST_OffsetCurve(geom, 15, 'quad_segs=4 join=mitre mitre_limit=2.2'),
        ST_OffsetCurve(geom, -15, 'quad_segs=4 join=mitre mitre_limit=2.2')
        ) )
        FROM ST_GeomFromText(
'LINESTRING(164 16,144 16,124 16,104 16,84 16,64 16,
        44 16,24 16,20 16,18 16,17 17,
        16 18,16 20,16 40,16 60,16 80,16 100,
        16 120,16 140,16 160,16 180,16 195)') As geom;
-- 出力 --
MULTILINESTRING((164 1,11.7867965644036 1,1 11.7867965644036,1 195),
        (31 195,31 31,164 31))
                                </pre><p>
						  </p></td></tr></tbody></table></div></div><div class="refsection"><a name="idp80318024"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Buffer" title="ST_Buffer">ST_Buffer</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_RemoveRepeatedPoints"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_RemoveRepeatedPoints — 入力ジオメトリから重複ポイントを除いたものを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_RemoveRepeatedPoints</b>(</code>geometry <var class="pdparam">geom</var>, float8 <var class="pdparam">tolerance</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp80324936"></a><h2>説明</h2><p>入力ジオメトリから重複ポイントを除いたものを返します。実際には(MULTI)LINE, (MULTI)POLYGONとMULTIPOINTで動作します。あらゆる種類のジオメトリで安全に呼び出せます。簡略化がオブジェクトごとに行われるので、ジオメトリコレクションでこの関数を呼ぶことができます。</p><p>tolerance引数を与えると、他の頂点との距離が許容値内にある頂点は、削除の目的から、「同じ」と考えます。</p><p>Availability: 2.2.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp80329672"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Simplify" title="ST_Simplify">ST_Simplify</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_SharedPaths"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SharedPaths — 二つのLINESTRING/MULTILINESTRINGの入力が共有するパスのコレクションを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_SharedPaths</b>(</code>geometry <var class="pdparam">lineal1</var>, geometry <var class="pdparam">lineal2</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp80336456"></a><h2>説明</h2><p>二つの入力ジオメトリが共有するパスのコレクションを返します。順方向に行くものはコレクションの一つ目の要素にあり、逆方向は二つ目の要素にあります。これらのパス自体は一つ目のジオメトリの方向をもとにします。 </p><p>Availability: 2.0.0 GEOS 3.3.0以降が必要です。</p></div><div class="refsection"><a name="idp80337992"></a><h2>例: 共有パスの探索</h2><div class="informaltable"><table class="informaltable" border="1"><colgroup><col></colgroup><tbody><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_sharedpaths01.png"><div class="caption"><p>マルチラインストリングとラインストリング</p></div></div></div>
			   </td></tr><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_sharedpaths02.png"><div class="caption"><p>マルチラインストリングとラインストリングとの共有パスと元のジオメトリ。</p></div></div></div><p>
				  </p><pre class="programlisting">SELECT ST_AsText(
  ST_SharedPaths(
    ST_GeomFromText('MULTILINESTRING((26 125,26 200,126 200,126 125,26 125),
           (51 150,101 150,76 175,51 150))'),
        ST_GeomFromText('LINESTRING(151 100,126 156.25,126 125,90 161, 76 175)')
        )
  ) As wkt

                                wkt
-------------------------------------------------------------
GEOMETRYCOLLECTION(MULTILINESTRING((126 156.25,126 125),
 (101 150,90 161),(90 161,76 175)),MULTILINESTRING EMPTY)
                          </pre><p>
			</p>
			</td></tr><tr><td><p>
				  </p><pre class="programlisting">-- 同じ例ですがラインストリングの引数の順序を入れ替えています
SELECT ST_AsText(
  ST_SharedPaths(
   ST_GeomFromText('LINESTRING(76 175,90 161,126 125,126 156.25,151 100)'),
   ST_GeomFromText('MULTILINESTRING((26 125,26 200,126 200,126 125,26 125),
           (51 150,101 150,76 175,51 150))')
        )
  ) As wkt

                                wkt
-------------------------------------------------------------
GEOMETRYCOLLECTION(MULTILINESTRING EMPTY,
MULTILINESTRING((76 175,90 161),(90 161,101 150),(126 125,126 156.25)))
                          </pre><p>
			</p>
			</td></tr></tbody></table></div></div><div class="refsection"><a name="idp80360392"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Dump" title="ST_Dump">ST_Dump</a>, <a class="xref" href="#ST_GeometryN" title="ST_GeometryN">ST_GeometryN</a>, <a class="xref" href="#ST_NumGeometries" title="ST_NumGeometries">ST_NumGeometries</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Shift_Longitude"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ShiftLongitude — ジオメトリの座標値を-180度から180度の範囲と0度から360度の範囲に揃えます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_ShiftLongitude</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp80367048"></a><h2>説明</h2><p>ジオメトリの全ての地物の全てのポイント/頂点を読み、経度値が0より小さい場合には360を足します。結果は、180度を中心にした地図に描画される、経度が0-360の区間にあるデータです。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これは4326 (WGS84経度緯度)のような経度緯度でのみ使えます。</p></td></tr></table></div><p><img src="images/warning.png"> 1.3.4より前ではMULTIPOINTでは動作しないバグがありました。1.3.4以上ではMULTIPOINTでも動作します。 </p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p>Enhanced: 2.0.0 多面体サーフェス対応とTIN対応が導入されました。</p><p>ご注意: この関数は2.0.0で"ST_Shift_Longitude"から名称変更しました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div><div class="refsection"><a name="idp80374344"></a><h2>例</h2><pre class="programlisting">-- 3次元ポイント
SELECT ST_AsEWKT(ST_ShiftLongitude(ST_GeomFromEWKT('SRID=4326;POINT(-118.58 38.38 10)'))) As geomA,
        ST_AsEWKT(ST_ShiftLongitude(ST_GeomFromEWKT('SRID=4326;POINT(241.42 38.38 10)'))) As geomb
geomA                                                          geomB
----------                                                  -----------
SRID=4326;POINT(241.42 38.38 10) SRID=4326;POINT(-118.58 38.38 10)

-- 普通のラインストリング
SELECT ST_AsText(ST_ShiftLongitude(ST_GeomFromText('LINESTRING(-118.58 38.38, -118.20 38.45)')))

st_astext
----------
LINESTRING(241.42 38.38,241.8 38.45)
                </pre></div><div class="refsection"><a name="idp80375880"></a><h2>関連情報</h2><p>
      <a class="xref" href="#ST_WrapX" title="ST_WrapX">ST_WrapX</a>
    </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_WrapX"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_WrapX — ジオメトリをX値で回り込ませます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_WrapX</b>(</code>geometry  <var class="pdparam">geom</var>, float8  <var class="pdparam">wrap</var>, float8  <var class="pdparam">move</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp80383944"></a><h2>説明</h2><p>入力ジオメトリを分割して、全ての結果要素が「回り込み ('wrap')」線から’move'パラメータで決められた方向、すなわち、右側 ('move'が負数)または左側 ('move'が正数)に全ての要素が落ちるように移動させ、最後に再結合します。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>経度緯度入力を「再センタリング」して、対象地物が一方からもう一方に飛ばないようにするのに使えます。 </p></td></tr></table></div><p>Availability: 2.3.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp80387656"></a><h2>例</h2><pre class="programlisting">-- 与えられたジオメトリのうち、
-- バウンディングボックスが完全にx=0の左側にあるもののについて
-- X値に360を足して移動させます。
select ST_WrapX(the_geom, 0, 360);

-- 与えられたジオメトリのうち、
-- バウンディングボックスが完全にx=-30の左側にあるもののについて
-- X値に360を足して移動させます。
select ST_WrapX(the_geom, -30, 360);
                </pre></div><div class="refsection"><a name="idp80389192"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Shift_Longitude" title="ST_ShiftLongitude">ST_ShiftLongitude</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Simplify"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Simplify — 与えられたジオメトリを「簡略化」したものを返します。Douglas-Peukerアルゴリズムを使用します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Simplify</b>(</code>geometry <var class="pdparam">geomA</var>, float <var class="pdparam">tolerance</var>, boolean <var class="pdparam">preserveCollapsed</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp80397000"></a><h2>説明</h2><p>与えられたジオメトリを「簡略化」したものを返します。Douglas-Peukerアルゴリズムを使用します。(MULTI)LINEと(MULTI)POLYGONとで実際に動作をしますが、どのような種類のジオメトリでも安全に呼ぶことができます。簡略化はオブジェクトごとに行われるので、ジオメトリコレクションでこの関数を呼ぶことができます。</p><p>"preserve collapsed"フラグによって、許容範囲より非常に小さいオブジェクトが保持されます。例えば、1メートル長のラインを10メートルの許容範囲で簡略化する場合です。"preserve"フラグを与えると、ラインは消去されません。このフラグは、多数の非常に小さいオブジェクトを持っていて、これらが想定外の隙間を残して地図から消えることを避けるのに使えます。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>返されるジオメトリは単純性 (<a class="xref" href="#ST_IsSimple" title="ST_IsSimple">ST_IsSimple</a>参照)を失うことがあります。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>トポロジは保存されているとは限らず、不正なジオメトリを返すことがあります。トポロジを保存するには<a class="xref" href="#ST_SimplifyPreserveTopology" title="ST_SimplifyPreserveTopology">ST_SimplifyPreserveTopology</a>を使います。</p></td></tr></table></div><p>Availability: 1.2.2</p></div><div class="refsection"><a name="idp80400712"></a><h2>例</h2><p>簡略化をやりすぎて三角形になった円、八角形になった円です。 </p><pre class="programlisting">SELECT ST_Npoints(the_geom) As np_before, ST_NPoints(ST_Simplify(the_geom,0.1)) As np01_notbadcircle, ST_NPoints(ST_Simplify(the_geom,0.5)) As np05_notquitecircle,
ST_NPoints(ST_Simplify(the_geom,1)) As np1_octagon, ST_NPoints(ST_Simplify(the_geom,10)) As np10_triangle,
(ST_Simplify(the_geom,100) is null) As  np100_geometrygoesaway
FROM (SELECT ST_Buffer('POINT(1 3)', 10,12) As the_geom) As foo;
-- 結果 --
 np_before | np01_notbadcircle | np05_notquitecircle | np1_octagon | np10_triangle | np100_geometrygoesaway
-----------+-------------------+---------------------+-------------+---------------+------------------------
                49 |                33 |                  17 |           9 |             4 | t

                                </pre></div><div class="refsection"><a name="idp80402376"></a><h2>関連情報</h2><p><a class="xref" href="#ST_IsSimple" title="ST_IsSimple">ST_IsSimple</a>, <a class="xref" href="#ST_SimplifyPreserveTopology" title="ST_SimplifyPreserveTopology">ST_SimplifyPreserveTopology</a>, Topology <a class="xref" href="#TP_ST_Simplify" title="ST_Simplify">ST_Simplify</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_SimplifyPreserveTopology"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SimplifyPreserveTopology — 与えられたジオメトリを「簡略化」したものを返します。Douglas-Peukerアルゴリズムを使用します。不正な派生ジオメトリ (特にポリゴン)の生成を回避します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_SimplifyPreserveTopology</b>(</code>geometry <var class="pdparam">geomA</var>, float <var class="pdparam">tolerance</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp80409928"></a><h2>説明</h2><p>与えられたジオメトリを「簡略化」したものを返します。Douglas-Peukerアルゴリズムを使用します。不正な派生ジオメトリ (特にポリゴン)の生成を回避します。(MULTI)LINEと(MULTI)POLYGONとで実際に動作をしますが、どのような種類のジオメトリでも安全に呼ぶことができます。簡略化はオブジェクトごとに行われるので、ジオメトリコレクションでこの関数を呼ぶことができます。</p><p>GEOSモジュールで実現しています。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>GEOS 3.0.0以上が必要です。</p></td></tr></table></div><p>Availability: 1.3.3</p></div><div class="refsection"><a name="idp80412360"></a><h2>例</h2><p>Simplyfyと同じ例ですが、トポロジ保存で簡略化の行きすぎを阻止します。円は最低でも四角形になります。</p><pre class="programlisting">SELECT ST_Npoints(the_geom) As np_before, ST_NPoints(ST_SimplifyPreserveTopology(the_geom,0.1)) As np01_notbadcircle, ST_NPoints(ST_SimplifyPreserveTopology(the_geom,0.5)) As np05_notquitecircle,
ST_NPoints(ST_SimplifyPreserveTopology(the_geom,1)) As np1_octagon, ST_NPoints(ST_SimplifyPreserveTopology(the_geom,10)) As np10_square,
ST_NPoints(ST_SimplifyPreserveTopology(the_geom,100)) As  np100_stillsquare
FROM (SELECT ST_Buffer('POINT(1 3)', 10,12) As the_geom) As foo;

-- 結果 --
 np_before | np01_notbadcircle | np05_notquitecircle | np1_octagon | np10_square | np100_stillsquare
-----------+-------------------+---------------------+-------------+---------------+-------------------
                49 |                33 |                  17 |           9 |             5 |                 5
                                </pre></div><div class="refsection"><a name="idp80414024"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Simplify" title="ST_Simplify">ST_Simplify</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_SimplifyVW"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SimplifyVW — Visvalingam-Whyattアルゴリズムを用いて、入力ジオメトリを「簡略化」したジオメトリを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_SimplifyVW</b>(</code>geometry <var class="pdparam">geomA</var>, float <var class="pdparam">tolerance</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp80449480"></a><h2>説明</h2><p>Visvalingam-Whyattアルゴリズムを用いて、入力ジオメトリを「簡略化」したジオメトリを返します。(マルチ)ラインと(マルチ)ポリゴンでのみ動作しますが、どの種類のジオメトリでも安全に呼ぶことができます。(MULTI)LINEと(MULTI)POLYGONとで実際に動作をしますが、どのような種類のジオメトリでも安全に呼ぶことができます。簡略化はオブジェクトごとに行われるので、ジオメトリコレクションでこの関数を呼ぶことができます。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>返されるジオメトリは単純性 (<a class="xref" href="#ST_IsSimple" title="ST_IsSimple">ST_IsSimple</a>参照)を失うことがあります。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>トポロジは保存されているとは限らず、不正なジオメトリを返すことがあります。トポロジを保存するには<a class="xref" href="#ST_SimplifyPreserveTopology" title="ST_SimplifyPreserveTopology">ST_SimplifyPreserveTopology</a>を使います。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数は3次元を扱います。第3次元は結果に影響を与えます。</p></td></tr></table></div><p>Availability: 2.2.0</p></div><div class="refsection"><a name="idp80453320"></a><h2>例</h2><p>ラインストリングを最小範囲のしきい値を30で簡略化しています。</p><pre class="programlisting">select ST_AsText(ST_SimplifyVW(geom,30)) simplified
FROM (SELECT  'LINESTRING(5 2, 3 8, 6 20, 7 25, 10 10)'::geometry geom) As foo;
-- 結果 --
 simplified
------------------------------
LINESTRING(5 2,7 25,10 10)

                                </pre></div><div class="refsection"><a name="idp80454984"></a><h2>関連情報</h2><p><a class="xref" href="#ST_SetEffectiveArea" title="ST_SetEffectiveArea">ST_SetEffectiveArea</a>, <a class="xref" href="#ST_Simplify" title="ST_Simplify">ST_Simplify</a>, <a class="xref" href="#ST_SimplifyPreserveTopology" title="ST_SimplifyPreserveTopology">ST_SimplifyPreserveTopology</a>, Topology <a class="xref" href="#TP_ST_Simplify" title="ST_Simplify">ST_Simplify</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_ChaikinSmoothing"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ChaikinSmoothing — チャイキンのアルゴリズムを使って、与えられたジオメトリが「平滑化された」ものを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_ChaikinSmoothing</b>(</code>geometry <var class="pdparam">geom</var>, integer <var class="pdparam">nIterations = 1</var>, boolean <var class="pdparam">preserveEndPoints = false</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp80463944"></a><h2>説明</h2><p>チャイキンのアルゴリズムを使って、与えられたジオメトリの「平滑化された」ものを返します。処理の説明については<a class="ulink" href="http://www.idav.ucdavis.edu/education/CAGDNotes/Chaikins-Algorithm/Chaikins-Algorithm.html" target="_top">Chaikins-Algorithm</a>をご覧下さい。繰り返しごとに頂点の数は倍になります。この関数は新しい頂点を、各ポイントの前後に、ラインの1/4の位置に置き、元のポイントを削除します。ポイント数を減らすには、結果に対して簡略化関数を使います。新しいポイントの、ZとMを含むジオメトリの全ての次元に補間値が付きます。</p><p>第2引数は、繰り返し回数で、最大5回に制限されます。</p><p>第3引数はポリゴンでのみ有効で、ラインストリングでは無視されます。</p><p>この関数は3次元を扱います。第3次元は結果に影響を与えます。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>返されるジオメトリは元のジオメトリより頂点が多くなります。ポイント数を減らすには、結果に対して簡略化関数を使います (<a class="xref" href="#ST_Simplify" title="ST_Simplify">ST_Simplify</a>と<a class="xref" href="#ST_SimplifyVW" title="ST_SimplifyVW">ST_SimplifyVW</a>をご覧下さい)。</p></td></tr></table></div><p>Availability: 2.5.0</p></div><div class="refsection"><a name="idp80468424"></a><h2>例</h2><p>三角形を平滑化します</p><pre class="programlisting">select ST_AsText(ST_ChaikinSmoothing(geom)) smoothed
FROM (SELECT  'POLYGON((0 0, 8 8, 0 16, 0 0))'::geometry geom) As foo;
┌───────────────────────────────────────────┐
│                 smoothed                  │
├───────────────────────────────────────────┤
│ POLYGON((2 2,6 6,6 10,2 14,0 12,0 4,2 2)) │
└───────────────────────────────────────────┘
                                </pre></div><div class="refsection"><a name="idp80470088"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Simplify" title="ST_Simplify">ST_Simplify</a>, <a class="xref" href="#ST_SimplifyVW" title="ST_SimplifyVW">ST_SimplifyVW</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_FilterByM"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_FilterByM — M値に基づく頂点のフィルタリングを行います。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_FilterByM</b>(</code>geometry <var class="pdparam">geom</var>, double precision <var class="pdparam">min</var>, double precision <var class="pdparam">max = null</var>, boolean <var class="pdparam">returnM = false</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp80479304"></a><h2>説明</h2><p>M値に基づいた頂点ポイントのフィルタリングを行います。返されるジオメトリは最小値以上最大値以下のM値を持つポイントだけでできています。最大値の引数が指定されていない場合には、最小値のみ考慮されます。第4引数が指定されていない場合には、M値は結果ジオメトリに存在しません。結果ジオメトリの頂点ポイントの数が、ジオメトリを構成するに必要な数に達しない場合には、空ジオメトリが返されます。ジオメトリコレクション内の、十分なポイントを持たないジオメトリ要素は消えます。 </p><p>この関数は主にST_SetEffectiveAreaとの併用を意図しています。ST_SetEffectiveAreaは、頂点のM値に関する有効範囲を設定します。ST_FilterByMでフィルタリングをすることで、他の計算を行わずに、単純化されたジオメトリを得ることができます。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ポイント数が基準を満たすのに十分でない時のST_SimplifyVWの返り値とST_FilterByMの返り値とで違いがあります。ST_FilterByMは空ジオメトリを返し、ST_SimplifyVWは十分なポイントを持つジオメトリを返します。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>返されるジオメトリは不正になることがあることに注意して下さい。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数は、Z値とM値を含む、すべての次元を返します。</p></td></tr></table></div><p>Availability: 2.5.0</p></div><div class="refsection"><a name="idp80482760"></a><h2>例</h2><p>ラインストリングにフィルタリングを行います</p><pre class="programlisting">SELECT ST_AsText(ST_FilterByM(geom,30)) simplified
FROM (SELECT  ST_SetEffectiveArea('LINESTRING(5 2, 3 8, 6 20, 7 25, 10 10)'::geometry) geom) As foo;
-- 結果 --
         simplified
----------------------------
 LINESTRING(5 2,7 25,10 10)

                                </pre></div><div class="refsection"><a name="idp80484424"></a><h2>関連情報</h2><p><a class="xref" href="#ST_SetEffectiveArea" title="ST_SetEffectiveArea">ST_SetEffectiveArea</a>, <a class="xref" href="#ST_SimplifyVW" title="ST_SimplifyVW">ST_SimplifyVW</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_SetEffectiveArea"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SetEffectiveArea — 個々の頂点について有効範囲を設定し、M値として保存します。M値でフィルタリングすると、単純化したジオメトリを生成できます。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_SetEffectiveArea</b>(</code>geometry <var class="pdparam">geomA</var>, float <var class="pdparam">threshold = 0</var>, integer <var class="pdparam">set_area = 1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp80492616"></a><h2>説明</h2><p>Visvalingam-Whyattアルゴリズムから有効範囲となる個々の頂点を置きます。有効範囲はジオメトリのM値として格納されます。任意引数である第2引数を使うと、しきい値以上の有効範囲となる頂点だけで構築されるジオメトリを返します。 </p><p>この関数は、しきい値を使うことでサーバサイド簡略化に使えます。もう一つの任意引数はしきい値を0にする際に使用します。この場合、完全なジオメトリを得ますが、クライアントが非常に高速に簡略化するために使うM値として格納している有効範囲を持っています。 </p><p>(MULTI)LINEと(MULTI)POLYGONとで実際に動作をしますが、どのような種類のジオメトリでも安全に呼ぶことができます。簡略化はオブジェクトごとに行われるので、ジオメトリコレクションでこの関数を呼ぶことができます。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>返されるジオメトリは単純性 (<a class="xref" href="#ST_IsSimple" title="ST_IsSimple">ST_IsSimple</a>参照)を失うことがあります。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>トポロジは保存されているとは限らず、不正なジオメトリを返すことがあります。トポロジを保存するには<a class="xref" href="#ST_SimplifyPreserveTopology" title="ST_SimplifyPreserveTopology">ST_SimplifyPreserveTopology</a>を使います。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>出力ジオメトリは、入力時に持っていたM値の情報の全てを失います。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数は3次元を扱います。第3次元は結果に影響を与えます。</p></td></tr></table></div><p>Availability: 2.2.0</p></div><div class="refsection"><a name="idp80497480"></a><h2>例</h2><p>ラインストリングの有効範囲の計算。しきい値を0にしているので、入力ジオメトリの全ての頂点が返ります。 </p><pre class="programlisting">select ST_AsText(ST_SetEffectiveArea(geom)) all_pts, ST_AsText(ST_SetEffectiveArea(geom,30) ) thrshld_30
FROM (SELECT  'LINESTRING(5 2, 3 8, 6 20, 7 25, 10 10)'::geometry geom) As foo;
-- 結果 --
 all_pts | thrshld_30
-----------+-------------------+
LINESTRING M (5 2 3.40282346638529e+38,3 8 29,6 20 1.5,7 25 49.5,10 10 3.40282346638529e+38) | LINESTRING M (5 2 3.40282346638529e+38,7 25 49.5,10 10 3.40282346638529e+38)

                                </pre></div><div class="refsection"><a name="idp80499144"></a><h2>関連情報</h2><p><a class="xref" href="#ST_SimplifyVW" title="ST_SimplifyVW">ST_SimplifyVW</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Split"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Split — ジオメトリを分割したジオメトリのコレクションを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Split</b>(</code>geometry <var class="pdparam">input</var>, geometry <var class="pdparam">blade</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp80510024"></a><h2>説明</h2><p>この関数は、ラインの(MULTI)POINT, (MULTI)LINEまたは(MULTI)POLYGONの境界による分割に対応しています。返されるジオメトリは常にコレクションです。 </p><p>この関数はST_Unionの逆と考えられます。理論的には、返されたコレクションにST_Unionを適用すると、常に元のジオメトリが得られます。 </p><p>Availability: 2.0.0</p><p>Enhanced: 2.2.0 マルチライン、マルチポイントおよびポリゴン並びにマルチポリゴンの境界によるラインの分割への対応が導入されました。</p><p>Enhanced: 2.5.0 マルチラインによるポリゴン分割への対応が導入されました。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_Splitのロバスト性を改善するには、非常に低い許容誤差を使用する前に、入力ジオメトリを、刃ジオメトリに対して<a class="xref" href="#ST_Snap" title="ST_Snap">ST_Snap</a>すると良いかも知れません。内部で使用されている座標グリッドは、許容誤差に関する問題を引き起こす可能性があります。入力座標と刃がお互いの上に落ちず、入力が正しく分割されない場合があります (<a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2192" target="_top">#2192</a>を参照して下さい)。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>(MULTI)ポリゴンを刃として渡すと、線要素 (境界)が入力の分割に使われます。 </p></td></tr></table></div></div><div class="refsection"><a name="idp80514632"></a><h2>例</h2><p>ラインに切られるポリゴン</p><div class="informaltable"><table class="informaltable" border="1"><colgroup><col><col></colgroup><tbody><tr><td>
                                               <p>
                            </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_split01.png"><div class="caption"><p>分割前</p></div></div></div><p>
                                               </p>
                        </td><td>
                                               <p>
                            </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_split02.png"><div class="caption"><p>分割後</p></div></div></div><p>
                                              </p>
                        </td></tr></tbody></table></div><pre class="programlisting">-- ポリゴンを2個に割ったものからなるジオメトリコレクションを生成します
-- ST_BuildAreaの例と似ています
SELECT ST_Split(circle, line)
FROM (SELECT
    ST_MakeLine(ST_MakePoint(10, 10),ST_MakePoint(190, 190)) As line,
    ST_Buffer(ST_GeomFromText('POINT(100 90)'), 50) As circle) As foo;

-- 結果 --
 GEOMETRYCOLLECTION(POLYGON((150 90,149.039264020162 80.2454838991936,146.193976625564 70.8658283817455,..), POLYGON(..)))

-- 個々のポリゴンに変換するには、ST_DumpまたはST_GeometryNを使います
SELECT ST_AsText((ST_Dump(ST_Split(circle, line))).geom) As wkt
FROM (SELECT
    ST_MakeLine(ST_MakePoint(10, 10),ST_MakePoint(190, 190)) As line,
    ST_Buffer(ST_GeomFromText('POINT(100 90)'), 50) As circle) As foo;

-- 結果 --
wkt
---------------
POLYGON((150 90,149.039264020162 80.2454838991936,..))
POLYGON((60.1371179574584 60.1371179574584,58.4265193848728 62.2214883490198,53.8060233744357 ..))
            </pre><p>ポイントで切られるマルチラインストリング</p><div class="informaltable"><table class="informaltable" border="1"><colgroup><col><col></colgroup><tbody><tr><td>
                                               <p>
                            </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_split03.png"><div class="caption"><p>分割前</p></div></div></div><p>
                                               </p>
                        </td><td>
                                               <p>
                            </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_split04.png"><div class="caption"><p>分割後</p></div></div></div><p>
                                               </p>
                        </td></tr></tbody></table></div><pre class="programlisting">SELECT ST_AsText(ST_Split(mline, pt)) As wktcut
        FROM (SELECT
    ST_GeomFromText('MULTILINESTRING((10 10, 190 190), (15 15, 30 30, 100 90))') As mline,
    ST_Point(30,30) As pt) As foo;

wktcut
------
GEOMETRYCOLLECTION(
    LINESTRING(10 10,30 30),
    LINESTRING(30 30,190 190),
    LINESTRING(15 15,30 30),
    LINESTRING(30 30,100 90)
)
            </pre></div><div class="refsection"><a name="idp80544584"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a>, <a class="xref" href="#ST_BuildArea" title="ST_BuildArea">ST_BuildArea</a>, <a class="xref" href="#ST_Dump" title="ST_Dump">ST_Dump</a>, <a class="xref" href="#ST_GeometryN" title="ST_GeometryN">ST_GeometryN</a>, <a class="xref" href="#ST_Union" title="ST_Union">ST_Union</a>, <a class="xref" href="#ST_Subdivide" title="ST_Subdivide">ST_Subdivide</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_SymDifference"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SymDifference — AとBの、インタセクトしていない部分を表現するジオメトリを返します。対称と呼ばれるのは、ST_SymDifference(A,B) = ST_SymDifference(B,A) となるからです。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_SymDifference</b>(</code>geometry  <var class="pdparam">geomA</var>, geometry  <var class="pdparam">geomB</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp80553416"></a><h2>説明</h2><p>AとBの、インタセクトしていない部分を表現するジオメトリを返します。対称と呼ばれるのは、ST_SymDifference(A,B) = ST_SymDifference(B,A)となるからです。ST_Union(geomA,geomB) - ST_Intersection(A,B)と見ることができます。 </p><p>GEOSモジュールによって実現しています。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ジオメトリコレクションを引数として呼ばないでください。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a> s2.1.1.3</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 5.1.21</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index. ただし、差を取ってZインデクスを戻す時に、X Yのみ考慮に入れているように見えます。</p></div><div class="refsection"><a name="idp80559944"></a><h2>例</h2><div class="informaltable"><table class="informaltable" border="1"><colgroup><col><col></colgroup><tbody><tr><td>
						<p>
							</p><div class="informalfigure"><div class="mediaobject"><img src="images/st_symdifference01.png"><div class="caption"><p>二つある元のラインストリングの両方</p></div></div></div><p>
						</p>
					</td><td>
						<div class="informalfigure"><div class="mediaobject"><img src="images/st_symdifference02.png"><div class="caption"><p>二つのラインストリングの対称差</p></div></div></div><p>
					</p>
				</td></tr></tbody></table></div><pre class="programlisting">-- 2次元では安全です - 二つのラインストリングの対称差
SELECT ST_AsText(
        ST_SymDifference(
                ST_GeomFromText('LINESTRING(50 100, 50 200)'),
                ST_GeomFromText('LINESTRING(50 50, 50 150)')
        )
);

st_astext
---------
MULTILINESTRING((50 150,50 200),(50 50,50 100))
</pre><pre class="programlisting">-- 3次元で使用すると、完全には正しいものとはなりません
SELECT ST_AsEWKT(ST_SymDifference(ST_GeomFromEWKT('LINESTRING(1 2 1, 1 4 2)'),
        ST_GeomFromEWKT('LINESTRING(1 1 3, 1 3 4)')))

st_astext
------------
MULTILINESTRING((1 3 2.75,1 4 2),(1 1 3,1 2 2.25))
                </pre></div><div class="refsection"><a name="idp80569416"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Difference" title="ST_Difference">ST_Difference</a>, <a class="xref" href="#ST_Intersection" title="ST_Intersection">ST_Intersection</a>, <a class="xref" href="#ST_Union" title="ST_Union">ST_Union</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Subdivide"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Subdivide — 指定した数より多い頂点を持たないジオメトリの集合を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">setof geometry <b class="fsfunc">ST_Subdivide</b>(</code>geometry <var class="pdparam">geom</var>, integer <var class="pdparam">max_vertices=256</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp80576968"></a><h2>説明</h2><p>ジオメトリを<code class="code">max_vertices</code>を超えないで表現できるまで分割します。ポリゴン内のポイントや他の包含関係等の演算では、通常、分割したデータセットのインデックスを使う方が早くなります。「当たらない」かどうかのテストは、分割されたポリゴンのボックス全体の面積は元のポリゴンのボックスより小さくなるので、より速くなります。「当たる」かどうかのテストは、再確認演算の実行箇所が減るので速くなります。同じ最小バウンディングボックスのクリッピング関数には<code class="code">ST_ClipByBox2D</code>があります。<code class="code">max_vertices</code>は5以上にしなければなりません。5ポイントは閉じたボックスの表現に必要なポイント数です。 </p><p>Availability: 2.2.0 GEOS 3.5.0以上が必要です。</p><p>Enhanced: 2.5.0 ポリゴン分割で存在するポイントの再利用、頂点数の最小値を8から5に変更。</p></div><div class="refsection"><a name="idp80580040"></a><h2>例</h2><pre class="programlisting">-- 複雑なジオメトリの適切な分割
with complex_areas_to_subdivide as (
    delete from polygons_table
    where ST_NPoints(geom) 
&gt; 255
    returning id, column1, column2, column3, geom
)
insert into polygons_table (fid, column1, column2, column3, geom)
    select
        fid, column1, column2, column3,
        ST_Subdivide(geom, 255) as geom
    from complex_areas_to_subdivide;
 </pre><pre class="programlisting">-- 元のジオメトリに結合するのに適切な、新しい分割されたテーブルの作成
CREATE TABLE subdivided_geoms AS
SELECT pkey, ST_Subdivide(geom) AS geom
FROM original_geoms;
 </pre><div class="informaltable"><table class="informaltable" border="1"><colgroup><col></colgroup><tbody><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_subdivide01.png"><div class="caption"><p>最大10頂点での分割</p></div></div></div><p>
				</p><pre class="programlisting">SELECT row_number() OVER() As rn, ST_AsText(geom) As wkt
FROM ( SELECT ST_SubDivide('POLYGON((132 10,119 23,85 35,68 29,66 28,49 42,32 56,22 64,32 110,40 119,36 150,
57 158,75 171,92 182,114 184,132 186,146 178,176 184,179 162,184 141,190 122,
190 100,185 79,186 56,186 52,178 34,168 18,147 13,132 10))'::geometry,10))  As f(geom);</pre><p>
</p><pre class="screen">rn │                                                      wkt
────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────
  1 │ POLYGON((119 23,85 35,68 29,66 28,32 56,22 64,29.8260869565217 100,119 100,119 23))
  2 │ POLYGON((132 10,119 23,119 56,186 56,186 52,178 34,168 18,147 13,132 10))
  3 │ POLYGON((119 56,119 100,190 100,185 79,186 56,119 56))
  4 │ POLYGON((29.8260869565217 100,32 110,40 119,36 150,57 158,75 171,92 182,114 184,114 100,29.8260869565217 100))
  5 │ POLYGON((114 184,132 186,146 178,176 184,179 162,184 141,190 122,190 100,114 100,114 184))</pre><p>
						  </p></td></tr><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_subdivide02.png"><div class="caption"><p>分割に使うことができる頂点の追加に ST_Segmentize(geography)を併用します</p></div></div></div><p>
				</p><pre class="programlisting">SELECT ST_AsText(ST_Subdivide(ST_Segmentize('LINESTRING(0 0, 85 85)'::geography,1200000)::geometry,8));</pre><p>
				</p><pre class="screen">LINESTRING(0 0,0.487578359029357 5.57659056746196,0.984542144675897 11.1527721155093,1.50101059639722 16.7281035483571,1.94532113630331 21.25)
LINESTRING(1.94532113630331 21.25,2.04869538062779 22.3020741387339,2.64204641967673 27.8740533545155,3.29994062412787 33.443216802941,4.04836719489742 39.0084282520239,4.59890468420694 42.5)
LINESTRING(4.59890468420694 42.5,4.92498503922732 44.5680389206321,5.98737409390639 50.1195229244701,7.3290919767674 55.6587646879025,8.79638749938413 60.1969505994924)
LINESTRING(8.79638749938413 60.1969505994924,9.11375579533779 61.1785363177625,11.6558166691368 66.6648504160202,15.642041247655 72.0867690601745,22.8716627200212 77.3609628116894,24.6991785131552 77.8939011989848)
LINESTRING(24.6991785131552 77.8939011989848,39.4046096622744 82.1822848017636,44.7994523421035 82.5156766227011)
LINESTRING(44.7994523421035 82.5156766227011,85 85)</pre><p>
						  </p></td></tr></tbody></table></div></div><div class="refsection"><a name="idp80590792"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a>, <a class="xref" href="#ST_ClipByBox2D" title="ST_ClipByBox2D">ST_ClipByBox2D</a>, <a class="xref" href="#ST_Segmentize" title="ST_Segmentize">ST_Segmentize</a>, <a class="xref" href="#ST_Split" title="ST_Split">ST_Split</a>, <a class="xref" href="#ST_NPoints" title="ST_NPoints">ST_NPoints</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_SwapOrdinates"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SwapOrdinates — 与えられたジオメトリにおいて与えられた座標の値を入れ替えたジオメトリを返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_SwapOrdinates</b>(</code>geometry <var class="pdparam">geom</var>, cstring <var class="pdparam">ords</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp80607560"></a><h2>説明</h2><p>与えられたジオメトリにおいて与えられた座標の値を入れ替えたジオメトリを返します。 </p><p><code class="varname">ords</code>引数は2文字の文字列で、入れ替える座標名を示します。座標名はx, y, z, mが有効です。 </p><p>Availability: 2.2.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports M coordinates.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div><div class="refsection"><a name="idp80616776"></a><h2>例</h2><pre class="programlisting">
-- M値を2倍にする
-- (訳注: M値の拡大縮小はST_Scaleだけではできません)
SELECT ST_AsText(
  ST_SwapOrdinates(
    ST_Scale(
      ST_SwapOrdinates(g,'xm'),
      2, 1
    ),
  'xm')
) FROM ( SELECT 'POINT ZM (0 0 0 2)'::geometry g ) foo;
     st_astext
--------------------
 POINT ZM (0 0 0 4)
                 </pre></div><div class="refsection"><a name="idp80618312"></a><h2>関連情報</h2><p> <a class="xref" href="#ST_FlipCoordinates" title="ST_FlipCoordinates">ST_FlipCoordinates</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Union"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Union — ジオメトリの結合の点集合を表現するジオメトリを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Union</b>(</code>geometry set <var class="pdparam">g1field</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_Union</b>(</code>geometry <var class="pdparam">g1</var>, geometry <var class="pdparam">g2</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_Union</b>(</code>geometry[] <var class="pdparam">g1_array</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp80629704"></a><h2>説明</h2><p>MULTI系、単一ジオメトリ、ジオメトリコレクションのいずれでも出力されます。二つの形式があります。一つ目は、二つのジオメトリを結合して、インタセクトしている領域の無い新しいジオメトリを返します。二つ目は、ジオメトリの集合を結合して、インタセクトしている領域の無い単一のST_Geometryを返すものです。</p><p>集約関数版: この関数は、ジオメトリの集合から、MULTI系ジオメトリまたは非MULTI系ジオメトリを返します。ST_Union()関数は、PostgreSQL用語で言うところの「集約関数」です。SUM()やMEAN()と同じ方法でデータリストの操作を行い、NULLジオメトリを無視することを意味します。</p><p>非集約関数版: この関数は二つの入力ジオメトリの結合したジオメトリを返します。出力型はMULTI系、非MULTI系またはGEOMETRYCOLLECTIONです。入力が全てNULLならNULLを返します。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_CollectとST_Unionはしばしば交換して使うことができます。ST_Unionは境界を更新し、生成されるMULTI系ジオメトリがインタセクトした領域を持たないようにするため、一般的にST_Collectよりも桁違いに遅く動きます。</p></td></tr></table></div><p>GEOSモジュールで実現しています。</p><p>ご注意: この関数は以前は、"Union"から名称変更してGeomUnion()と呼ばれていました。UNIONはSQLの予約語であるためです。</p><p>Availability: 1.4.0 - ST_Unionが強化されました。ST_Union(geomarray)が導入され、また、PostgreSQL内での集計が速くなりました。GEOS 3.1.0以上を使用している場合は、ST_Unionは、<a class="ulink" href="http://blog.cleverelephant.ca/2009/01/must-faster-unions-in-postgis-14.html" target="_top">http://blog.cleverelephant.ca/2009/01/must-faster-unions-in-postgis-14.html</a>に記述がある、Cascaded Unionアルゴリズムを使います。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method implements the <a class="ulink" href="http://www.opengeospatial.org/standards/sfs" target="_top">OpenGIS Simple Features
 Implementation Specification for SQL 1.1.</a> s2.1.1.3</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>集約関数版は、OGC仕様に明示的に定義されていません。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3: 5.1.19 ポリゴンが含まれる時、Z値 (標高)を持ちます。</p></div><div class="refsection"><a name="idp80637384"></a><h2>例</h2><p>集約関数版の例</p><pre class="programlisting">SELECT stusps,
           ST_Multi(ST_Union(f.the_geom)) as singlegeom
         FROM sometable As f
GROUP BY stusps
                          </pre><p>非集約関数の例</p><pre class="programlisting">SELECT ST_AsText(ST_Union(ST_GeomFromText('POINT(1 2)'),
        ST_GeomFromText('POINT(-2 3)') ) )

st_astext
----------
MULTIPOINT(-2 3,1 2)


SELECT ST_AsText(ST_Union(ST_GeomFromText('POINT(1 2)'),
                ST_GeomFromText('POINT(1 2)') ) );
st_astext
----------
POINT(1 2)

-- 3次元の例 - 対応する3次元 (次元の混合があります!)の一覧
SELECT ST_AsEWKT(st_union(the_geom))
FROM
(SELECT ST_GeomFromEWKT('POLYGON((-7 4.2,-7.1 4.2,-7.1 4.3,
-7 4.2))') as the_geom
UNION ALL
SELECT ST_GeomFromEWKT('POINT(5 5 5)') as the_geom
UNION ALL
        SELECT ST_GeomFromEWKT('POINT(-2 3 1)') as the_geom
UNION ALL
SELECT ST_GeomFromEWKT('LINESTRING(5 5 5, 10 10 10)') as the_geom ) as foo;

st_asewkt
---------
GEOMETRYCOLLECTION(POINT(-2 3 1),LINESTRING(5 5 5,10 10 10),POLYGON((-7 4.2 5,-7.1 4.2 5,-7.1 4.3 5,-7 4.2 5)));

-- 3次元で次元の混合がない例
SELECT ST_AsEWKT(st_union(the_geom))
FROM
(SELECT ST_GeomFromEWKT('POLYGON((-7 4.2 2,-7.1 4.2 3,-7.1 4.3 2,
-7 4.2 2))') as the_geom
UNION ALL
SELECT ST_GeomFromEWKT('POINT(5 5 5)') as the_geom
UNION ALL
        SELECT ST_GeomFromEWKT('POINT(-2 3 1)') as the_geom
UNION ALL
SELECT ST_GeomFromEWKT('LINESTRING(5 5 5, 10 10 10)') as the_geom ) as foo;

st_asewkt
---------
GEOMETRYCOLLECTION(POINT(-2 3 1),LINESTRING(5 5 5,10 10 10),POLYGON((-7 4.2 2,-7.1 4.2 3,-7.1 4.3 2,-7 4.2 2)))

-- 新しい配列構築を用いた例
SELECT ST_Union(ARRAY(SELECT the_geom FROM sometable));

SELECT ST_AsText(ST_Union(ARRAY[ST_GeomFromText('LINESTRING(1 2, 3 4)'),
                        ST_GeomFromText('LINESTRING(3 4, 4 5)')])) As wktunion;

--wktunion---
MULTILINESTRING((3 4,4 5),(1 2,3 4))

                          </pre></div><div class="refsection"><a name="idp80639944"></a><h2>関連情報</h2><p>
			<a class="xref" href="#ST_Collect" title="ST_Collect">ST_Collect</a>
			<a class="xref" href="#ST_UnaryUnion" title="ST_UnaryUnion">ST_UnaryUnion</a>
		</p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_UnaryUnion"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_UnaryUnion — ST_Unionに似ていますが、ジオメトリ要素レベルで動作します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_UnaryUnion</b>(</code>geometry  <var class="pdparam">geom</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp80658632"></a><h2>説明</h2><p>ST_UnaryUnionは、ST_Unionと違い、マルチポリゴンの要素間の境界更新を行い、ジオメトリコレクションの要素間の結合を行います。入力ジオメトリの要素は、それぞれ妥当であると仮定しているので、蝶ネクタイポリゴン (不正なポリゴンです)から妥当なマルチポリゴンを得ることはできません。 </p><p>この関数はラインストリングの集合にノードを作成するのに使えます。ST_UnaryUnionとST_Collectを混ぜて、ST_UnionとST_MemUnionの釣り合いを見つけて、メモリサイズとCPU時間の両方について適切になるように、一度に結合したいジオメトリ数を微調整することができます。 </p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p>Availability: 2.0.0 - GEOS 3.3.0以上が必要 </p></div><div class="refsection"><a name="idp80662216"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Union" title="ST_Union">ST_Union</a>, <a class="xref" href="#ST_MemUnion" title="ST_MemUnion">ST_MemUnion</a>, <a class="xref" href="#ST_Collect" title="ST_Collect">ST_Collect</a>, <a class="xref" href="#ST_Node" title="ST_Node">ST_Node</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_VoronoiLines"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_VoronoiLines — ジオメトリの頂点からボロノイ図のセル間の境界を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_VoronoiLines</b>(</code> <var class="pdparam">g1</var> geometry ,  <var class="pdparam">tolerance</var> float8 ,  <var class="pdparam">extend_to</var> geometry <code>)</code>;</p></div></div><div class="refsection"><a name="idp80696904"></a><h2>説明</h2><p>ST_VoronoiLines は、与えられたジオメトリの頂点から、2次元<a class="ulink" href="https://ja.wikipedia.org/wiki/%E3%83%9C%E3%83%AD%E3%83%8E%E3%82%A4%E5%9B%B3" target="_top">ボロノイ図</a>を計算します。図の細胞間の境界をMULTILINESTRINGで返します。入力ジオメトリがNULLの場合には、NULLを返します。入力ジオメトリに頂点が一つだけしか無い場合には、空ジオメトリコレクションを返します。extend_toのエンベロープの面積が0の場合には、空ジオメトリコレクションを返します。 </p><p>任意パラメータ: </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>'tolerance' : この距離以内の点は等価とします。0でない許容距離を指定することで、アルゴリズムのロバスト性が改善します。デフォルトは0.0です。</p></li><li class="listitem"><p>'extend_to': ジオメトリが"extend_to"パラメータとして渡された場合には、エンベロープがデフォルトエンベロープより小さい場合を除いて、ボロノイ図は"extend_to"ジオメトリのエンベロープを覆う範囲になります (デフォルトはNULLで、デフォルトのエンベロープは入力ジオメトリのバウンディングボックスから各方向に50%ずつ拡張したものです)。</p></li></ul></div><p>
		</p><p>Availability: 2.3.0 - GEOS 3.5.0以上が必要です。</p></div><div class="refsection"><a name="idp80701640"></a><h2>例</h2><div class="informaltable"><table class="informaltable" border="1"><colgroup><col></colgroup><tbody><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_voronoi03.png"><div class="caption"><p>許容範囲を30単位としたボロノイ図</p></div></div></div><p>
					</p><pre class="programlisting">SELECT ST_VoronoiLines(geom, 30) As geom
FROM (SELECT 'MULTIPOINT (50 30, 60 30, 100 100,10 150, 110 120)'::geometry As geom ) As g</pre><p>
</p><pre class="screen">-- ST_AsText 出力
MULTILINESTRING((135.555555555556 270,36.8181818181818 92.2727272727273),(36.8181818181818 92.2727272727273,-110 43.3333333333333),(230 -45.7142857142858,36.8181818181818 92.2727272727273))
</pre><p>
				</p></td></tr></tbody></table></div></div><div class="refsection"><a name="idp80707912"></a><h2>関連情報</h2><p><a class="xref" href="#ST_DelaunayTriangles" title="ST_DelaunayTriangles">ST_DelaunayTriangles</a>, <a class="xref" href="#ST_VoronoiPolygons" title="ST_VoronoiPolygons">ST_VoronoiPolygons</a>, <a class="xref" href="#ST_Collect" title="ST_Collect">ST_Collect</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_VoronoiPolygons"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_VoronoiPolygons — ジオメトリの頂点からボロノイ図のセルを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_VoronoiPolygons</b>(</code> <var class="pdparam">g1</var> geometry ,  <var class="pdparam">tolerance</var> float8 ,  <var class="pdparam">extend_to</var> geometry <code>)</code>;</p></div></div><div class="refsection"><a name="idp80717640"></a><h2>説明</h2><p>ST_VoronoiPolygonsは、与えられたジオメトリの頂点から、2次元<a class="ulink" href="https://ja.wikipedia.org/wiki/%E3%83%9C%E3%83%AD%E3%83%8E%E3%82%A4%E5%9B%B3" target="_top">ボロノイ図</a>を計算します。結果は、入力頂点の範囲より大きいエンベロープを覆うポリゴンのジオメトリコレクションです。入力ジオメトリがNULLの場合には、NULLを返します。入力ジオメトリに頂点が一つだけしか無い場合には、空ジオメトリコレクションを返します。extend_toのエンベロープの面積が0の場合には、空ジオメトリコレクションを返します。 </p><p>任意パラメータ: </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>'tolerance' : この距離以内の点は等価とします。0でない許容距離を指定することで、アルゴリズムのロバスト性が改善します。デフォルトは0.0です。</p></li><li class="listitem"><p>'extend_to': ジオメトリが"extend_to"パラメータとして渡された場合には、エンベロープがデフォルトエンベロープより小さい場合を除いて、ボロノイ図は"extend_to"ジオメトリのエンベロープを覆う範囲になります (デフォルトはNULLで、デフォルトのエンベロープは入力ジオメトリのバウンディングボックスから各方向に50%ずつ拡張したものです)。 </p></li></ul></div><p>
		</p><p>Availability: 2.3.0 - GEOS 3.5.0以上が必要です。</p></div><div class="refsection"><a name="idp80722376"></a><h2>例</h2><div class="informaltable"><table class="informaltable" border="1"><colgroup><col></colgroup><tbody><tr><td>
					<div class="informalfigure"><div class="mediaobject"><img src="images/st_voronoi01.png"><div class="caption"><p>Points overlaid on top of Voronoi diagram</p></div></div></div><p>
					</p><pre class="programlisting">SELECT
        ST_VoronoiPolygons(geom) As geom
FROM (SELECT 'MULTIPOINT (50 30, 60 30, 100 100,10 150, 110 120)'::geometry As geom ) As g;</pre><p>
</p><pre class="screen">-- ST_AsText 出力 --
GEOMETRYCOLLECTION(POLYGON((-110 43.3333333333333,-110 270,100.5 270,59.3478260869565 132.826086956522,36.8181818181818 92.2727272727273,-110 43.3333333333333)),
POLYGON((55 -90,-110 -90,-110 43.3333333333333,36.8181818181818 92.2727272727273,55 79.2857142857143,55 -90)),
POLYGON((230 47.5,230 -20.7142857142857,55 79.2857142857143,36.8181818181818 92.2727272727273,59.3478260869565 132.826086956522,230 47.5)),POLYGON((230 -20.7142857142857,230 -90,55 -90,55 79.2857142857143,230 -20.7142857142857)),
POLYGON((100.5 270,230 270,230 47.5,59.3478260869565 132.826086956522,100.5 270)))
</pre><p>
					</p>
				</td></tr><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_voronoi02.png"><div class="caption"><p>許容範囲を30単位としたボロノイ図</p></div></div></div><p>
					</p><pre class="programlisting">SELECT ST_VoronoiPolygons(geom, 30) As geom
FROM (SELECT 'MULTIPOINT (50 30, 60 30, 100 100,10 150, 110 120)'::geometry As geom ) As g;</pre><p>
</p><pre class="screen">-- ST_AsText 出力
GEOMETRYCOLLECTION(POLYGON((-110 43.3333333333333,-110 270,100.5 270,59.3478260869565 132.826086956522,36.8181818181818 92.2727272727273,-110 43.3333333333333)),
POLYGON((230 47.5,230 -45.7142857142858,36.8181818181818 92.2727272727273,59.3478260869565 132.826086956522,230 47.5)),POLYGON((230 -45.7142857142858,230 -90,-110 -90,-110 43.3333333333333,36.8181818181818 92.2727272727273,230 -45.7142857142858)),
POLYGON((100.5 270,230 270,230 47.5,59.3478260869565 132.826086956522,100.5 270)))
</pre><p>
				</p></td></tr><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_voronoi03.png"><div class="caption"><p>許容範囲を30単位とした、マルチラインストリングのボロノイ図</p></div></div></div><p>
					</p><pre class="programlisting">SELECT ST_VoronoiLines(geom, 30) As geom
FROM (SELECT 'MULTIPOINT (50 30, 60 30, 100 100,10 150, 110 120)'::geometry As geom ) As g</pre><p>
</p><pre class="screen">-- ST_AsText 出力
MULTILINESTRING((135.555555555556 270,36.8181818181818 92.2727272727273),(36.8181818181818 92.2727272727273,-110 43.3333333333333),(230 -45.7142857142858,36.8181818181818 92.2727272727273))
</pre><p>
				</p></td></tr></tbody></table></div></div><div class="refsection"><a name="idp80736840"></a><h2>関連情報</h2><p><a class="xref" href="#ST_DelaunayTriangles" title="ST_DelaunayTriangles">ST_DelaunayTriangles</a>, <a class="xref" href="#ST_VoronoiLines" title="ST_VoronoiLines">ST_VoronoiLines</a>, <a class="xref" href="#ST_Collect" title="ST_Collect">ST_Collect</a> </p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Linear_Referencing"></a>8.12. 線型参照</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#ST_LineInterpolatePoint">ST_LineInterpolatePoint</a></span><span class="refpurpose"> — 線に沿った内挿点を返します。第2引数はfloat8で0から1の区間で、そのポイントが位置するラインストリングの総延長についての割合です。</span></dt><dt><span class="refentrytitle"><a href="#ST_LineInterpolatePoints">ST_LineInterpolatePoints</a></span><span class="refpurpose"> — 線に沿った内挿点を一つ以上返します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_LineLocatePoint">ST_LineLocatePoint</a></span><span class="refpurpose"> — ラインストリング上の、与えたポイントへの最短点を、2次元長に対する割合として0から1の区間で返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_LineSubstring">ST_LineSubstring</a></span><span class="refpurpose"> — 次元長に対する割合で示された開始位置と終了位置で切り取られた部分ラインストリングを返します。第2引数と第3引数は、float8で0から1の区間です。</span></dt><dt><span class="refentrytitle"><a href="#ST_LocateAlong">ST_LocateAlong</a></span><span class="refpurpose"> — 指定したM値に一致する要素からなる、派生ジオメトリコレクション値を返します。ポリゴン要素には対応していません。</span></dt><dt><span class="refentrytitle"><a href="#ST_LocateBetween">ST_LocateBetween</a></span><span class="refpurpose"> — 指定したM値の範囲内にある要素からなる、派生ジオメトリコレクション値を返します。ポリゴン要素には対応していません。</span></dt><dt><span class="refentrytitle"><a href="#ST_LocateBetweenElevations">ST_LocateBetweenElevations</a></span><span class="refpurpose"> — 指定したZ値の範囲内にある要素からなる、派生ジオメトリ (コレクション)値を返します。3次元、4次元のLINESTRINGSとMULTILINESTRINGSのみに対応しています。</span></dt><dt><span class="refentrytitle"><a href="#ST_InterpolatePoint">ST_InterpolatePoint</a></span><span class="refpurpose"> — ジオメトリの、指定したポイントに近いポイントにおけるM値を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_AddMeasure">ST_AddMeasure</a></span><span class="refpurpose"> — 始点と終点の間を線型補完した、M値を持つ派生ジオメトリを返します。</span></dt></dl></div><div class="refentry"><a name="ST_LineInterpolatePoint"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_LineInterpolatePoint — 線に沿った内挿点を返します。第2引数はfloat8で0から1の区間で、そのポイントが位置するラインストリングの総延長についての割合です。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_LineInterpolatePoint</b>(</code>geometry  <var class="pdparam">a_linestring</var>, float8  <var class="pdparam">a_fraction</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp81828936"></a><h2>説明</h2><p>線に沿った内挿点を返します。第1引数は LINESTRINGでなければなりません。第2引数はfloat8で0から1の区間で、そのポイントが位置するラインストリングの総延長に対する割合です。</p><p>ポイントに最も近いライン位置の計算については<a class="xref" href="#ST_LineLocatePoint" title="ST_LineLocatePoint">ST_LineLocatePoint</a>を参照して下さい。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>1.1.1から、この関数はM軸やZ軸の内挿点も (存在するなら)計算するようになりました。それより前の版では0.0となります。</p></td></tr></table></div><p>Availability: 0.8.2 Z軸とM軸のサポートが1.1.1で追加されました。</p><p>Changed: 2.1.0 2.0.xまでではST_Line_Interpolate_Pointと呼んでいました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp81833800"></a><h2>例</h2><div class="informalfigure"><div class="mediaobject"><img src="images/st_line_interpolate_point01.png"><div class="caption"><p>ラインストリングの20% (0.20)位置の内挿点 </p></div></div></div><pre class="programlisting">-- 2次元ラインに沿った20%ポイント
SELECT ST_AsEWKT(ST_LineInterpolatePoint(the_line, 0.20))
        FROM (SELECT ST_GeomFromEWKT('LINESTRING(25 50, 100 125, 150 190)') as the_line) As foo;
   st_asewkt
----------------
 POINT(51.5974135047432 76.5974135047432)

</pre><pre class="programlisting">-- 3次元線の中点
SELECT ST_AsEWKT(ST_LineInterpolatePoint(the_line, 0.5))
        FROM (SELECT ST_GeomFromEWKT('LINESTRING(1 2 3, 4 5 6, 6 7 8)') as the_line) As foo;

        st_asewkt
--------------------
 POINT(3.5 4.5 5.5)


-- ポイントまたは他のジオメトリへの、ライン上の最短点の探索
 SELECT ST_AsText(ST_LineInterpolatePoint(foo.the_line, ST_LineLocatePoint(foo.the_line, ST_GeomFromText('POINT(4 3)'))))
FROM (SELECT ST_GeomFromText('LINESTRING(1 2, 4 5, 6 7)') As the_line) As foo;
   st_astext
----------------
 POINT(3 4)

</pre></div><div class="refsection"><a name="idp81838024"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a>, <a class="xref" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a>, <a class="xref" href="#ST_Length" title="ST_Length">ST_Length</a>, <a class="xref" href="#ST_LineInterpolatePoints" title="ST_LineInterpolatePoints">ST_LineInterpolatePoints</a> <a class="xref" href="#ST_LineLocatePoint" title="ST_LineLocatePoint">ST_LineLocatePoint</a> O</p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_LineInterpolatePoints"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_LineInterpolatePoints — 線に沿った内挿点を一つ以上返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_LineInterpolatePoints</b>(</code>geometry  <var class="pdparam">a_linestring</var>, float8  <var class="pdparam">a_fraction</var>, boolean  <var class="pdparam">repeat</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp81867976"></a><h2>説明</h2><p>線に沿った内挿点を一つ以上返します。第1引数は LINESTRINGでなければなりません。第2引数はfloat8で0から1の区間で、そのポイントが位置するラインストリングの総延長に対する割合です。第3引数がFALSEの場合には、たかだか一つのポイントが構築されます (これは <a class="xref" href="#ST_LineInterpolatePoint" title="ST_LineInterpolatePoint">ST_LineInterpolatePoint</a>と同じです)。 </p><p>結果にポイントが無いかポイントが一つだけの場合には、一つのPOINTを返します。二つ以上のポイントがある場合には、MULTIPOINTを返します。 </p><p>Availability: 2.5.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports M coordinates.</p></div><div class="refsection"><a name="idp80419016"></a><h2>例</h2><div class="informalfigure"><div class="mediaobject"><img src="images/st_line_interpolate_points01.png"><div class="caption"><p>20% (0.20)位置ごとの内挿点を持ったラインストリング </p></div></div></div><pre class="programlisting">-- 2次元ラインに沿った20%ごとのポイントを返します。
SELECT ST_AsText(ST_LineInterpolatePoints('LINESTRING(25 50, 100 125, 150 190)', 0.20))
   st_astext
----------------
 MULTIPOINT(51.5974135047432 76.5974135047432,78.1948270094864 103.194827009486,104.132163186446 130.37181214238,127.066081593223 160.18590607119,150 190)
</pre></div><div class="refsection"><a name="idp80434760"></a><h2>関連情報</h2><p>
				<a class="xref" href="#ST_LineInterpolatePoint" title="ST_LineInterpolatePoint">ST_LineInterpolatePoint</a>
				<a class="xref" href="#ST_LineLocatePoint" title="ST_LineLocatePoint">ST_LineLocatePoint</a>
			</p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_LineLocatePoint"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_LineLocatePoint — ラインストリング上の、与えたポイントへの最短点を、2次元長に対する割合として0から1の区間で返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float8 <b class="fsfunc">ST_LineLocatePoint</b>(</code>geometry  <var class="pdparam">a_linestring</var>, geometry  <var class="pdparam">a_point</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp80442184"></a><h2>説明</h2><p>ラインストリング上の、与えたポイントへの最短点を、<a class="link" href="#ST_Length2D" title="ST_Length2D">2次元ラインストリング</a>の総延長に対する割合として0から1の区間で返します。</p><p>返された位置は、ポイント(<a class="xref" href="#ST_LineInterpolatePoint" title="ST_LineInterpolatePoint">ST_LineInterpolatePoint</a>)または、部分ラインストリング(<a class="xref" href="#ST_LineSubstring" title="ST_LineSubstring">ST_LineSubstring</a>)の抽出に使用することができます。</p><p>この関数は、住所番号に近づくのに使えます (訳注: 道路方式の住居表示の場合)。</p><p>Availability: 1.1.0</p><p>Changed: 2.1.0 2.0.xまでではST_Line_Locate_Pointと呼んでいました。</p></div><div class="refsection"><a name="idp80163528"></a><h2>例</h2><pre class="programlisting">-- ストリートに沿った、ストリート番号の点の、粗い探索です。
-- なお、foo全体は住居の重心と通りのように見えるダミーデータです。
-- ST_DWithInで対象とする通りから大きく外れる住居を除外しています。
SELECT ST_AsText(house_loc) As as_text_house_loc,
        startstreet_num +
                CAST( (endstreet_num - startstreet_num)
                        * ST_LineLocatePoint(street_line, house_loc) As integer) As street_num
FROM
(SELECT ST_GeomFromText('LINESTRING(1 2, 3 4)') As street_line,
        ST_MakePoint(x*1.01,y*1.03) As house_loc, 10 As startstreet_num,
                20 As endstreet_num
FROM generate_series(1,3) x CROSS JOIN generate_series(2,4) As y)
As foo
WHERE ST_DWithin(street_line, house_loc, 0.2);

 as_text_house_loc | street_num
-------------------+------------
 POINT(1.01 2.06)  |         10
 POINT(2.02 3.09)  |         15
 POINT(3.03 4.12)  |         20

 -- ポイントまたは他のジオメトリへのライン上の最短点の探索
 SELECT ST_AsText(ST_LineInterpolatePoint(foo.the_line, ST_LineLocatePoint(foo.the_line, ST_GeomFromText('POINT(4 3)'))))
FROM (SELECT ST_GeomFromText('LINESTRING(1 2, 4 5, 6 7)') As the_line) As foo;
   st_astext
----------------
 POINT(3 4)

</pre></div><div class="refsection"><a name="idp80165064"></a><h2>関連情報</h2><p><a class="xref" href="#ST_DWithin" title="ST_DWithin">ST_DWithin</a>, <a class="xref" href="#ST_Length2D" title="ST_Length2D">ST_Length2D</a>, <a class="xref" href="#ST_LineInterpolatePoint" title="ST_LineInterpolatePoint">ST_LineInterpolatePoint</a>, <a class="xref" href="#ST_LineSubstring" title="ST_LineSubstring">ST_LineSubstring</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_LineSubstring"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_LineSubstring — 次元長に対する割合で示された開始位置と終了位置で切り取られた部分ラインストリングを返します。第2引数と第3引数は、float8で0から1の区間です。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_LineSubstring</b>(</code>geometry  <var class="pdparam">a_linestring</var>, float8  <var class="pdparam">startfraction</var>, float8  <var class="pdparam">endfraction</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp81890248"></a><h2>説明</h2><p>2次元長に対する割合で示された開始位置と終了位置で切り取られた部分ラインストリングを返します。第2引数と第3引数は、float8で0から1の区間です。この関数はLINESTRINGでのみ動作します。MULTILINESTRINGで使用するには、<a class="xref" href="#ST_LineMerge" title="ST_LineMerge">ST_LineMerge</a>と併用します。</p><p>startfractionとendfractionが同じ値を持つ場合には、<a class="xref" href="#ST_LineInterpolatePoint" title="ST_LineInterpolatePoint">ST_LineInterpolatePoint</a>と等価になります。</p><p>ポイントに最も近いライン位置の計算については<a class="xref" href="#ST_LineLocatePoint" title="ST_LineLocatePoint">ST_LineLocatePoint</a>を参照して下さい。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>1.1.1から、この関数はM軸やZ軸の内挿点も (存在するなら)計算するようになりました。それより前の版では不定値となります。</p></td></tr></table></div><p>Availability: 1.1.0 Z軸とM軸のサポートが1.1.1で追加されました。</p><p>Changed: 2.1.0 2.0.xではST_Line_Substringと呼ばれていました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp81900488"></a><h2>例</h2><div class="informalfigure"><div class="mediaobject"><img src="images/st_line_substring01.png"><div class="caption"><p>1/3の真ん中 (0.333, 0.666)のラインストリング </p></div></div></div><pre class="programlisting">-- ラインストリングの概ね1/3の真ん中の線を返します
SELECT ST_AsText(ST_Line_SubString(ST_GeomFromText('LINESTRING(25 50, 100 125, 150 190)'), 0.333, 0.666));

                                                                                   st_astext
------------------------------------------------------------------------------------------------
LINESTRING(69.2846934853974 94.2846934853974,100 125,111.700356260683 140.210463138888)

--次に示す例では、PostgreSQLのgenerate_series()を
--使ったwhileループに似たことを行って、
--テーブル内の全てのラインストリングを100単位の
--区分にカットしています。
--単位はSRIDで決まります。
--全てのジオメトリがラインストリングまたは
--隣接するマルチラインストリングで、
--100単位*10000より長いジオメトリが無いと仮定します。
--パフォーマンスを良くするために、10000を減らして、
--期待する最大区分数にあわせることができます。

SELECT field1, field2, ST_LineSubstring(the_geom, 100.00*n/length,
  CASE
        WHEN 100.00*(n+1) &lt; length THEN 100.00*(n+1)/length
        ELSE 1
  END) As the_geom
FROM
  (SELECT sometable.field1, sometable.field2,
  ST_LineMerge(sometable.the_geom) AS the_geom,
  ST_Length(sometable.the_geom) As length
  FROM sometable
  ) AS t
CROSS JOIN generate_series(0,10000) AS n
WHERE n*100.00/length &lt; 1;
                        </pre></div><div class="refsection"><a name="idp81904328"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Length" title="ST_Length">ST_Length</a>, <a class="xref" href="#ST_LineInterpolatePoint" title="ST_LineInterpolatePoint">ST_LineInterpolatePoint</a>, <a class="xref" href="#ST_LineMerge" title="ST_LineMerge">ST_LineMerge</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_LocateAlong"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_LocateAlong — 指定したM値に一致する要素からなる、派生ジオメトリコレクション値を返します。ポリゴン要素には対応していません。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_LocateAlong</b>(</code>geometry  <var class="pdparam">ageom_with_measure</var>, float8  <var class="pdparam">a_measure</var>, float8  <var class="pdparam">offset</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp81921224"></a><h2>説明</h2><p>指定したM値に一致する要素からなる、派生ジオメトリコレクション値を返します。ポリゴン要素には対応していません。</p><p>offsetを与えた場合には、結果は入力ラインの右または左に、指定した数字分ずれます。正のオフセットでは左に、負のオフセットでは右にずれます。</p><p>意味は ISO/IEC CD 13249-3:200x(E) - Text for Continuation CD Editing Meeting で決められています。</p><p>Availability: 1.1.0 それまではST_Locale_Along_Measureでした。 </p><p>Changed: 2.0.0 以前の版ではST_Locate_Along_Measureと呼ばれていましたが、古い名前は非推奨となり、将来的には削除しますが現時点では有効です。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数は、M要素を持つジオメトリでのみ使います。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports M coordinates.</p></div><div class="refsection"><a name="idp80647880"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(the_geom)
                FROM
                (SELECT ST_LocateAlong(
                        ST_GeomFromText('MULTILINESTRINGM((1 2 3, 3 4 2, 9 4 3),
                (1 2 3, 5 4 5))'),3) As the_geom) As foo;

                                                 st_asewkt
-----------------------------------------------------------
 MULTIPOINT M (1 2 3)

-- ジオメトリコレクションは難しいものですので、
-- 簡略化するためにダンプしています。
SELECT ST_AsText((ST_Dump(the_geom)).geom)
        FROM
        (SELECT ST_LocateAlong(
                        ST_GeomFromText('MULTILINESTRINGM((1 2 3, 3 4 2, 9 4 3),
        (1 2 3, 5 4 5))'),3) As the_geom) As foo;

   st_asewkt
---------------
 POINTM(1 2 3)
 POINTM(9 4 3)
 POINTM(1 2 3)
        </pre></div><div class="refsection"><a name="idp80649416"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Dump" title="ST_Dump">ST_Dump</a>, <a class="xref" href="#ST_LocateBetween" title="ST_LocateBetween">ST_LocateBetween</a>, <a class="xref" href="#ST_LocateBetweenElevations" title="ST_LocateBetweenElevations">ST_LocateBetweenElevations</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_LocateBetween"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_LocateBetween — 指定したM値の範囲内にある要素からなる、派生ジオメトリコレクション値を返します。ポリゴン要素には対応していません。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_LocateBetween</b>(</code>geometry  <var class="pdparam">geomA</var>, float8  <var class="pdparam">measure_start</var>, float8  <var class="pdparam">measure_end</var>, float8  <var class="pdparam">offset</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp81924808"></a><h2>説明</h2><p>指定したM値の範囲内にある要素からなる、派生ジオメトリコレクションを返します。ポリゴン要素には対応していません。</p><p>offsetを与えた場合には、結果は入力ラインの右または左に、指定した数字分ずれます。正のオフセットでは左に、負のオフセットでは右にずれます。</p><p>意味は ISO/IEC CD 13249-3:200x(E) - Text for Continuation CD Editing Meeting で決められています。</p><p>Availability: 1.1.0 それより前はST_Locate_Between_Measuresでした。 </p><p>Changed: 2.0.0 以前の版でST_Locate_Between_Measuresと呼ばれていましたが、古い名前は非推奨となり、将来的には削除しますが現時点では後方互換のため有効になっています。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports M coordinates.</p></div><div class="refsection"><a name="idp81928904"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(the_geom)
                FROM
                (SELECT ST_LocateBetween(
                        ST_GeomFromText('MULTILINESTRING M ((1 2 3, 3 4 2, 9 4 3),
                (1 2 3, 5 4 5))'),1.5, 3) As the_geom) As foo;

                                                         st_asewkt
------------------------------------------------------------------------
 GEOMETRYCOLLECTION M (LINESTRING M (1 2 3,3 4 2,9 4 3),POINT M (1 2 3))

-- ジオメトリコレクションは難しいものですので、
-- 簡略化するためにダンプしています。
SELECT ST_AsText((ST_Dump(the_geom)).geom)
                FROM
                (SELECT ST_LocateBetween(
                        ST_GeomFromText('MULTILINESTRING M ((1 2 3, 3 4 2, 9 4 3),
                (1 2 3, 5 4 5))'),1.5, 3) As the_geom) As foo;

                   st_asewkt
--------------------------------
 LINESTRING M (1 2 3,3 4 2,9 4 3)
 POINT M (1 2 3)</pre></div><div class="refsection"><a name="idp81930440"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Dump" title="ST_Dump">ST_Dump</a>, <a class="xref" href="#ST_LocateAlong" title="ST_LocateAlong">ST_LocateAlong</a>, <a class="xref" href="#ST_LocateBetweenElevations" title="ST_LocateBetweenElevations">ST_LocateBetweenElevations</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_LocateBetweenElevations"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_LocateBetweenElevations — 指定したZ値の範囲内にある要素からなる、派生ジオメトリ (コレクション)値を返します。3次元、4次元のLINESTRINGSとMULTILINESTRINGSのみに対応しています。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_LocateBetweenElevations</b>(</code>geometry  <var class="pdparam">geom_mline</var>, float8  <var class="pdparam">elevation_start</var>, float8  <var class="pdparam">elevation_end</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp81959496"></a><h2>説明</h2><p>指定したZ値の範囲内にある要素からなる、派生ジオメトリ (コレクション)値を返します。3次元、4次元のLINESTRINGSとMULTILINESTRINGSのみに対応しています。</p><p>Availability: 1.4.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp81962440"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsEWKT(ST_LocateBetweenElevations(
                        ST_GeomFromEWKT('LINESTRING(1 2 3, 4 5 6)'),2,4)) As ewelev;
                                                                   ewelev
----------------------------------------------------------------
        MULTILINESTRING((1 2 3,2 3 4))

SELECT ST_AsEWKT(ST_LocateBetweenElevations(
                        ST_GeomFromEWKT('LINESTRING(1 2 6, 4 5 -1, 7 8 9)'),6,9)) As ewelev;

                                ewelev
----------------------------------------------------------------
GEOMETRYCOLLECTION(POINT(1 2 6),LINESTRING(6.1 7.1 6,7 8 9))

-- ジオメトリコレクションは難しいものですので、
-- 簡略化するためにダンプしています。
SELECT ST_AsEWKT((ST_Dump(the_geom)).geom)
                FROM
                (SELECT ST_LocateBetweenElevations(
                        ST_GeomFromEWKT('LINESTRING(1 2 6, 4 5 -1, 7 8 9)'),6,9) As the_geom) As foo;

                   st_asewkt
--------------------------------
POINT(1 2 6)
LINESTRING(6.1 7.1 6,7 8 9)
</pre></div><div class="refsection"><a name="idp81963976"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Dump" title="ST_Dump">ST_Dump</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_InterpolatePoint"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_InterpolatePoint — ジオメトリの、指定したポイントに近いポイントにおけるM値を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float8 <b class="fsfunc">ST_InterpolatePoint</b>(</code>geometry  <var class="pdparam">line</var>, geometry  <var class="pdparam">point</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp81970760"></a><h2>説明</h2><p>ジオメトリの、指定したポイントに近いポイントにおけるM値を返します。</p><p>Availability: 2.0.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp81973704"></a><h2>例</h2><pre class="programlisting">SELECT ST_InterpolatePoint('LINESTRING M (0 0 0, 10 0 20)', 'POINT(5 5)');
 st_interpolatepoint
 ---------------------
                                    10
        </pre></div><div class="refsection"><a name="idp81974984"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AddMeasure" title="ST_AddMeasure">ST_AddMeasure</a>, <a class="xref" href="#ST_LocateAlong" title="ST_LocateAlong">ST_LocateAlong</a>, <a class="xref" href="#ST_LocateBetween" title="ST_LocateBetween">ST_LocateBetween</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_AddMeasure"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AddMeasure — 始点と終点の間を線型補完した、M値を持つ派生ジオメトリを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_AddMeasure</b>(</code>geometry  <var class="pdparam">geom_mline</var>, float8  <var class="pdparam">measure_start</var>, float8  <var class="pdparam">measure_end</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp81983560"></a><h2>説明</h2><p>始点と終点の間を線型補完した、M値を持つ派生ジオメトリを返します。ジオメトリにM値が無い場合には、1が追加されます。ジオメトリがM値を持つ場合には、新しい値で上書きされます。LINESTRINGとMULTILINESTRINGのみ対応しています。</p><p>Availability: 1.5.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp81986504"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(ST_AddMeasure(
ST_GeomFromEWKT('LINESTRING(1 0, 2 0, 4 0)'),1,4)) As ewelev;
           ewelev
--------------------------------
 LINESTRINGM(1 0 1,2 0 2,4 0 4)

SELECT ST_AsText(ST_AddMeasure(
ST_GeomFromEWKT('LINESTRING(1 0 4, 2 0 4, 4 0 4)'),10,40)) As ewelev;
                 ewelev
----------------------------------------
 LINESTRING(1 0 4 10,2 0 4 20,4 0 4 40)

SELECT ST_AsText(ST_AddMeasure(
ST_GeomFromEWKT('LINESTRINGM(1 0 4, 2 0 4, 4 0 4)'),10,40)) As ewelev;
                 ewelev
----------------------------------------
 LINESTRINGM(1 0 10,2 0 20,4 0 40)

SELECT ST_AsText(ST_AddMeasure(
ST_GeomFromEWKT('MULTILINESTRINGM((1 0 4, 2 0 4, 4 0 4),(1 0 4, 2 0 4, 4 0 4))'),10,70)) As ewelev;
                             ewelev
-----------------------------------------------------------------
 MULTILINESTRINGM((1 0 10,2 0 20,4 0 40),(1 0 40,2 0 50,4 0 70))
</pre></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Temporal"></a>8.13. 時間機能</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#ST_IsValidTrajectory">ST_IsValidTrajectory</a></span><span class="refpurpose"> — ジオメトリが妥当なトラジェクトリの場合には<code class="varname">true</code>を返します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_ClosestPointOfApproach">ST_ClosestPointOfApproach</a></span><span class="refpurpose"> — 二つのラインの最も近くなる内挿補間点のM値を返します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_DistanceCPA">ST_DistanceCPA</a></span><span class="refpurpose"> — 二つのトラジェクトリの最接近時の距離を返します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_CPAWithin">ST_CPAWithin</a></span><span class="refpurpose"> — トラジェクトリの最接近点が空間的な距離内にある場合にはTRUEを返します。 </span></dt></dl></div><div class="refentry"><a name="ST_IsValidTrajectory"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_IsValidTrajectory — ジオメトリが妥当なトラジェクトリの場合には<code class="varname">true</code>を返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_IsValidTrajectory</b>(</code>geometry  <var class="pdparam">line</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp82183240"></a><h2>説明</h2><p>ジオメトリが妥当なトラジェクトリになっているかどうかを問い合わせます。妥当なトラジェクトリはM値を持つLINESTRINGで、頂点を追うごとにM値が大きくなっていなければなりません。 </p><p>妥当なトラジェクトリは<a class="xref" href="#ST_ClosestPointOfApproach" title="ST_ClosestPointOfApproach">ST_ClosestPointOfApproach</a>のような時空間クエリの入力で期待されます。 </p><p>初出: 2.2.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp82186952"></a><h2>例</h2><pre class="programlisting">-- 妥当なトラジェクトリ
SELECT ST_IsValidTrajectory(ST_MakeLine(
  ST_MakePointM(0,0,1),
  ST_MakePointM(0,1,2))
);
 t

-- 不正なトラジェクトリ
SELECT ST_IsValidTrajectory(ST_MakeLine(ST_MakePointM(0,0,1), ST_MakePointM(0,1,0)));
NOTICE:  Measure of vertex 1 (0) not bigger than measure of vertex 0 (1)
 st_isvalidtrajectory
----------------------
 f
</pre></div><div class="refsection"><a name="idp82188488"></a><h2>関連情報</h2><p>
<a class="xref" href="#ST_ClosestPointOfApproach" title="ST_ClosestPointOfApproach">ST_ClosestPointOfApproach</a>
			</p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_ClosestPointOfApproach"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ClosestPointOfApproach — 二つのラインの最も近くなる内挿補間点のM値を返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float8 <b class="fsfunc">ST_ClosestPointOfApproach</b>(</code>geometry  <var class="pdparam">track1</var>, geometry  <var class="pdparam">track2</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp82195528"></a><h2>説明</h2><p>与えられたラインの最も近くなる内挿補間点のM値を返します。入力は妥当なトラジェクトリでなければなりません。<a class="xref" href="#ST_IsValidTrajectory" title="ST_IsValidTrajectory">ST_IsValidTrajectory</a>で確認します。トラジェクトリのM値範囲が重ならない場合にはNULLを返します。 </p><p>与えられたM値における実際の点を得るには<a class="xref" href="#ST_LocateAlong" title="ST_LocateAlong">ST_LocateAlong</a>を参照して下さい。 </p><p>初出: 2.2.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp82203720"></a><h2>例</h2><pre class="programlisting">-- 10:00から11:00まで移動する二つの物体の最接近する時刻を返します
WITH inp AS ( SELECT
  ST_AddMeasure('LINESTRING Z (0 0 0, 10 0 5)'::geometry,
    extract(epoch from '2015-05-26 10:00'::timestamptz),
    extract(epoch from '2015-05-26 11:00'::timestamptz)
  ) a,
  ST_AddMeasure('LINESTRING Z (0 2 10, 12 1 2)'::geometry,
    extract(epoch from '2015-05-26 10:00'::timestamptz),
    extract(epoch from '2015-05-26 11:00'::timestamptz)
  ) b
), cpa AS (
  SELECT ST_ClosestPointOfApproach(a,b) m FROM inp
), points AS (
  SELECT ST_Force3DZ(ST_GeometryN(ST_LocateAlong(a,m),1)) pa,
         ST_Force3DZ(ST_GeometryN(ST_LocateAlong(b,m),1)) pb
  FROM inp, cpa
)
SELECT to_timestamp(m) t,
       ST_Distance(pa,pb) distance
FROM points, cpa;

               t               |     distance
-------------------------------+------------------
 2015-05-26 10:45:31.034483+02 | 1.96036833151395
</pre></div><div class="refsection"><a name="idp82205256"></a><h2>関連情報</h2><p><a class="xref" href="#ST_IsValidTrajectory" title="ST_IsValidTrajectory">ST_IsValidTrajectory</a>, <a class="xref" href="#ST_DistanceCPA" title="ST_DistanceCPA">ST_DistanceCPA</a>, <a class="xref" href="#ST_LocateAlong" title="ST_LocateAlong">ST_LocateAlong</a>, <a class="xref" href="#ST_AddMeasure" title="ST_AddMeasure">ST_AddMeasure</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_DistanceCPA"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_DistanceCPA — 二つのトラジェクトリの最接近時の距離を返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float8 <b class="fsfunc">ST_DistanceCPA</b>(</code>geometry  <var class="pdparam">track1</var>, geometry  <var class="pdparam">track2</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp82213320"></a><h2>説明</h2><p>二つの移動するオブジェクトの最小距離を返します。入力は妥当なトラジェクトリでなければなりません。<a class="xref" href="#ST_IsValidTrajectory" title="ST_IsValidTrajectory">ST_IsValidTrajectory</a>で確認します。トラジェクトリのM値範囲が重ならない場合にはNULLを返します。 </p><p>初出: 2.2.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp82216648"></a><h2>例</h2><pre class="programlisting">-- 10:00から11:00まで移動する二つの物体の最短距離を返します
WITH inp AS ( SELECT
  ST_AddMeasure('LINESTRING Z (0 0 0, 10 0 5)'::geometry,
    extract(epoch from '2015-05-26 10:00'::timestamptz),
    extract(epoch from '2015-05-26 11:00'::timestamptz)
  ) a,
  ST_AddMeasure('LINESTRING Z (0 2 10, 12 1 2)'::geometry,
    extract(epoch from '2015-05-26 10:00'::timestamptz),
    extract(epoch from '2015-05-26 11:00'::timestamptz)
  ) b
)
SELECT ST_DistanceCPA(a,b) distance FROM inp;

     distance
------------------
 1.96036833151395
</pre></div><div class="refsection"><a name="idp82218184"></a><h2>関連情報</h2><p><a class="xref" href="#ST_IsValidTrajectory" title="ST_IsValidTrajectory">ST_IsValidTrajectory</a>, <a class="xref" href="#ST_ClosestPointOfApproach" title="ST_ClosestPointOfApproach">ST_ClosestPointOfApproach</a>, <a class="xref" href="#ST_AddMeasure" title="ST_AddMeasure">ST_AddMeasure</a>, <a class="xref" href="#geometry_distance_cpa" title="|=|">|=|</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_CPAWithin"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_CPAWithin — トラジェクトリの最接近点が空間的な距離内にある場合にはTRUEを返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float8 <b class="fsfunc">ST_CPAWithin</b>(</code>geometry  <var class="pdparam">track1</var>, geometry  <var class="pdparam">track2</var>, float8  <var class="pdparam">maxdist</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp82227272"></a><h2>説明</h2><p>二つの移動する物体が、指定した最大距離以内にあるかどうかを確認します。 </p><p>入力は妥当なトラジェクトリでなければなりません。<a class="xref" href="#ST_IsValidTrajectory" title="ST_IsValidTrajectory">ST_IsValidTrajectory</a>で確認します。トラジェクトリのM値範囲が重ならない場合にはFALSEを返します。 </p><p>初出: 2.2.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp82230984"></a><h2>例</h2><pre class="programlisting">WITH inp AS ( SELECT
  ST_AddMeasure('LINESTRING Z (0 0 0, 10 0 5)'::geometry,
    extract(epoch from '2015-05-26 10:00'::timestamptz),
    extract(epoch from '2015-05-26 11:00'::timestamptz)
  ) a,
  ST_AddMeasure('LINESTRING Z (0 2 10, 12 1 2)'::geometry,
    extract(epoch from '2015-05-26 10:00'::timestamptz),
    extract(epoch from '2015-05-26 11:00'::timestamptz)
  ) b
)
SELECT ST_CPAWithin(a,b,2), ST_DistanceCPA(a,b) distance FROM inp;

 st_cpawithin |     distance
--------------+------------------
 t            | 1.96521473776207
</pre></div><div class="refsection"><a name="idp82232520"></a><h2>関連情報</h2><p><a class="xref" href="#ST_IsValidTrajectory" title="ST_IsValidTrajectory">ST_IsValidTrajectory</a>, <a class="xref" href="#ST_ClosestPointOfApproach" title="ST_ClosestPointOfApproach">ST_ClosestPointOfApproach</a>, <a class="xref" href="#ST_DistanceCPA" title="ST_DistanceCPA">ST_DistanceCPA</a>, <a class="xref" href="#geometry_distance_cpa" title="|=|">|=|</a> </p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Long_Transactions_Support"></a>8.14. ロングトランザクション機能</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#AddAuth">AddAuth</a></span><span class="refpurpose"> — 現在のトランザクションで使われる認証トークンを追加します。</span></dt><dt><span class="refentrytitle"><a href="#CheckAuth">CheckAuth</a></span><span class="refpurpose"> — 認証トークンに基づいて行の更新と削除を拒否/許可するテーブルのトリガを生成します。</span></dt><dt><span class="refentrytitle"><a href="#DisableLongTransactions">DisableLongTransactions</a></span><span class="refpurpose"> — ロングトランザクション機能を無効にします。この関数によって、ロングトランザクション機能のためのメタデータテーブルが削除され、ロックチェックテーブルに付けられた全てのトリガが削除されます。</span></dt><dt><span class="refentrytitle"><a href="#EnableLongTransactions">EnableLongTransactions</a></span><span class="refpurpose"> — ロングトランザクション機能を有効にします。この関数によって、必要なメタデータテーブルが生成されます。このセクションにある他の関数を呼ぶ前に、一度呼ぶ必要があります。二度呼んでも構いません。</span></dt><dt><span class="refentrytitle"><a href="#LockRow">LockRow</a></span><span class="refpurpose"> — テーブルの指定した行についてロック/認証を設定します。</span></dt><dt><span class="refentrytitle"><a href="#UnlockRows">UnlockRows</a></span><span class="refpurpose"> — 指定した認証IDが保持するロックを全て削除します。解放されたロックの数が返されます。</span></dt></dl></div><p>このモジュールとPL/pgSQL関数は、<a class="ulink" href="http://www.opengeospatial.org/standards/wfs" target="_top">Web Feature Service</a>仕様で求められているロングロックに対応しています。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><a class="ulink" href="http://www.postgresql.org/docs/current/static/transaction-iso.html" target="_top">serializable transaction level</a>を使わなければなりません。さもなくばロック機構が壊れます。</p></td></tr></table></div><div class="refentry"><a name="AddAuth"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>AddAuth — 現在のトランザクションで使われる認証トークンを追加します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">AddAuth</b>(</code>text  <var class="pdparam">auth_token</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp82300232"></a><h2>説明</h2><p>現在のトランザクションで使われる認証トークンを追加します。</p><p>temp_lock_have_tableという一時テーブルに現在のトランザクション識別子と認証トークンキーを作成、追加します。</p><p>Availability: 1.1.3</p></div><div class="refsection"><a name="idp82302152"></a><h2>例</h2><pre class="programlisting">SELECT LockRow('towns', '353', 'priscilla');
                BEGIN TRANSACTION;
                        SELECT AddAuth('joey');
                        UPDATE towns SET the_geom = ST_Translate(the_geom,2,2) WHERE gid = 353;
                COMMIT;


                -- エラー --
                ERROR:  UPDATE where "gid" = '353' requires authorization 'priscilla'
                </pre></div><div class="refsection"><a name="idp82303688"></a><h2>関連情報</h2><p><a class="xref" href="#LockRow" title="LockRow">LockRow</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="CheckAuth"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>CheckAuth — 認証トークンに基づいて行の更新と削除を拒否/許可するテーブルのトリガを生成します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">CheckAuth</b>(</code>text  <var class="pdparam">a_schema_name</var>, text  <var class="pdparam">a_table_name</var>, text  <var class="pdparam">a_key_column_name</var><code>)</code>;</p><p><code class="funcdef">integer <b class="fsfunc">CheckAuth</b>(</code>text  <var class="pdparam">a_table_name</var>, text  <var class="pdparam">a_key_column_name</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp82335304"></a><h2>説明</h2><p>認証トークンに基づいて行の更新と削除を拒否/許可するテーブルのトリガを生成します。&lt;rowid_col&gt;カラムを使用する行を判別します。</p><p>a_schema_nameが渡されない場合には、現在のスキーマのテーブルを探索します。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>このテーブルに認証トリガが既に存在している場合には、エラーになります。</p><p>トランザクション機能が無い場合は、例外が投げられます。</p></td></tr></table></div><p>Availability: 1.1.3</p></div><div class="refsection"><a name="idp82338248"></a><h2>例</h2><pre class="programlisting">SELECT CheckAuth('public', 'towns', 'gid');
                        結果
                        ------
                        0
                        </pre></div><div class="refsection"><a name="idp82339784"></a><h2>関連情報</h2><p><a class="xref" href="#EnableLongTransactions" title="EnableLongTransactions">EnableLongTransactions</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="DisableLongTransactions"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>DisableLongTransactions — ロングトランザクション機能を無効にします。この関数によって、ロングトランザクション機能のためのメタデータテーブルが削除され、ロックチェックテーブルに付けられた全てのトリガが削除されます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">DisableLongTransactions</b>(</code><code>)</code>;</p></div></div><div class="refsection"><a name="idp82344776"></a><h2>説明</h2><p>ロングトランザクション機能を無効にします。この関数によって、ロングトランザクション機能のためのメタデータテーブルが削除され、ロックチェックテーブルに付けられた全てのトリガが削除されます。</p><p><code class="varname">authorization_table</code>メタデータテーブル、<code class="varname">authorized_tables</code>ビュー、<code class="varname">checkauthtrigger</code>トリガの全てが削除されます。</p><p>Availability: 1.1.3</p></div><div class="refsection"><a name="idp82347720"></a><h2>例</h2><pre class="programlisting">SELECT DisableLongTransactions();
-- 結果 --
Long transactions support disabled
                  </pre></div><div class="refsection"><a name="idp82349256"></a><h2>関連情報</h2><p><a class="xref" href="#EnableLongTransactions" title="EnableLongTransactions">EnableLongTransactions</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="EnableLongTransactions"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>EnableLongTransactions — ロングトランザクション機能を有効にします。この関数によって、必要なメタデータテーブルが生成されます。このセクションにある他の関数を呼ぶ前に、一度呼ぶ必要があります。二度呼んでも構いません。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">EnableLongTransactions</b>(</code><code>)</code>;</p></div></div><div class="refsection"><a name="idp82358344"></a><h2>説明</h2><p>ロングトランザクション機能を有効にします。この関数によって、必要なメタデータテーブルが生成されます。このセクションにある他の関数を呼ぶ前に、一度呼ぶ必要があります。二度呼んでも構いません。</p><p><code class="varname">authorization_table</code>メタデータテーブル<code class="varname">authorized_tables</code>ビューが生成されます。</p><p>Availability: 1.1.3</p></div><div class="refsection"><a name="idp82360904"></a><h2>例</h2><pre class="programlisting">SELECT EnableLongTransactions();
-- 結果 --
Long transactions support enabled
                  </pre></div><div class="refsection"><a name="idp82362440"></a><h2>関連情報</h2><p><a class="xref" href="#DisableLongTransactions" title="DisableLongTransactions">DisableLongTransactions</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="LockRow"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>LockRow — テーブルの指定した行についてロック/認証を設定します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">LockRow</b>(</code>text  <var class="pdparam">a_schema_name</var>, text  <var class="pdparam">a_table_name</var>, text  <var class="pdparam">a_row_key</var>, text <var class="pdparam">an_auth_token</var>, timestamp <var class="pdparam">expire_dt</var><code>)</code>;</p><p><code class="funcdef">integer <b class="fsfunc">LockRow</b>(</code>text  <var class="pdparam">a_table_name</var>, text  <var class="pdparam">a_row_key</var>, text <var class="pdparam">an_auth_token</var>, timestamp <var class="pdparam">expire_dt</var><code>)</code>;</p><p><code class="funcdef">integer <b class="fsfunc">LockRow</b>(</code>text  <var class="pdparam">a_table_name</var>, text  <var class="pdparam">a_row_key</var>, text <var class="pdparam">an_auth_token</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp82381768"></a><h2>説明</h2><p>テーブルの指定した行についてロック/認証を設定します。&lt;authid&gt;は文字列値です。&lt;expires&gt;はタイムスタンプ値で、now()+1時間がデフォルトです。ロックされた場合は1を返し、他の場合 (既に他の認証によってロックされている場合)には、0を返します。</p><p>Availability: 1.1.3</p></div><div class="refsection"><a name="idp82383304"></a><h2>例</h2><pre class="programlisting">SELECT LockRow('public', 'towns', '2', 'joey');
LockRow
-------
1

-- Joeyは既にレコードをロックしていて
-- Priscillaはロックできなかっただけにラックが無かったと
SELECT LockRow('public', 'towns', '2', 'priscilla');
LockRow
-------
0

                </pre></div><div class="refsection"><a name="idp82384840"></a><h2>関連情報</h2><p><a class="xref" href="#UnlockRows" title="UnlockRows">UnlockRows</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="UnlockRows"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>UnlockRows — 指定した認証IDが保持するロックを全て削除します。解放されたロックの数が返されます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">UnlockRows</b>(</code>text  <var class="pdparam">auth_token</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp82390728"></a><h2>説明</h2><p>指定した認証IDが保持するロックを全て削除します。解放されたロックの数が返されます。</p><p>Availability: 1.1.3</p></div><div class="refsection"><a name="idp82392392"></a><h2>例</h2><pre class="programlisting">SELECT LockRow('towns', '353', 'priscilla');
                SELECT LockRow('towns', '2', 'priscilla');
                SELECT UnLockRows('priscilla');
                UnLockRows
                ------------
                2
                </pre></div><div class="refsection"><a name="idp82393928"></a><h2>関連情報</h2><p><a class="xref" href="#LockRow" title="LockRow">LockRow</a></p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Miscellaneous_Functions"></a>8.15. その他の関数</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#ST_Accum">ST_Accum</a></span><span class="refpurpose"> — 集約関数です。ジオメトリの配列を生成します。</span></dt><dt><span class="refentrytitle"><a href="#Box2D">Box2D</a></span><span class="refpurpose"> — ジオメトリの最大範囲を表すBOX2Dを返します。</span></dt><dt><span class="refentrytitle"><a href="#Box3D">Box3D</a></span><span class="refpurpose"> — ジオメトリの最大範囲を表すBOX3Dを返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_EstimatedExtent">ST_EstimatedExtent</a></span><span class="refpurpose"> — 与えられた空間テーブルの「見積もられた」範囲を返します。ジオメトリカラムの統計情報から見積もります。指定されていない場合は現在のスキーマが使われます。</span></dt><dt><span class="refentrytitle"><a href="#ST_Expand">ST_Expand</a></span><span class="refpurpose"> — 入力ジオメトリのバウンディングボックスから全ての方向に拡張されたバウンディングボックスを返します。倍精度浮動小数点数を使います。</span></dt><dt><span class="refentrytitle"><a href="#ST_Extent">ST_Extent</a></span><span class="refpurpose"> — ジオメトリのバウンディングボックスを返す集約関数です。</span></dt><dt><span class="refentrytitle"><a href="#ST_3DExtent">ST_3DExtent</a></span><span class="refpurpose"> — ジオメトリのbox3Dバウンディングボックスを返す集約関数です。</span></dt><dt><span class="refentrytitle"><a href="#Find_SRID">Find_SRID</a></span><span class="refpurpose"> — この関数の書式はfind_srid(a_db_schema, a_table, a_column)です。GEOMETRY_COLUMNSで検索して、指定したカラムのSRID整数値を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_MemSize">ST_MemSize</a></span><span class="refpurpose"> — ジオメトリが取る容量 (バイト単位)を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_Point_Inside_Circle">ST_PointInsideCircle</a></span><span class="refpurpose"> — ポイントジオメトリがcenter_x, center_y , radiusで定義される円内にあるかどうかを見ます。</span></dt></dl></div><div class="refentry"><a name="ST_Accum"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Accum — 集約関数です。ジオメトリの配列を生成します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry[] <b class="fsfunc">ST_Accum</b>(</code>geometry set <var class="pdparam">geomfield</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp82494920"></a><h2>説明</h2><p>集約関数です。ジオメトリの配列を生成します。</p><p>Enhanced: 2.0.0 多面体サーフェス対応、三角対応、TIN対応が導入されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div><div class="refsection"><a name="idp82505928"></a><h2>例</h2><pre class="programlisting">SELECT (ST_Accum(the_geom)) As all_em, ST_AsText((ST_Accum(the_geom))[1]) As grabone,
(ST_Accum(the_geom))[2:4] as grab_rest
                        FROM (SELECT ST_MakePoint(a*CAST(random()*10 As integer), a*CAST(random()*10 As integer), a*CAST(random()*10 As integer)) As the_geom
                                FROM generate_series(1,4) a) As foo;

all_em|grabone   | grab_rest

-------------------------------------------------------------------------------+

 {0101000080000000000000144000000000000024400000000000001040:
 0101000080000000000
00018400000000000002C400000000000003040:
0101000080000000000000354000000000000038400000000000001840:
010100008000000000000040400000000000003C400000000000003040} |
 POINT(5 10) | {010100008000000000000018400000000000002C400000000000003040:
 0101000080000000000000354000000000000038400000000000001840:
 010100008000000000000040400000000000003C400000000000003040}
(1 row)
                </pre></div><div class="refsection"><a name="idp82507464"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Collect" title="ST_Collect">ST_Collect</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="Box2D"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Box2D — ジオメトリの最大範囲を表すBOX2Dを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">box2d <b class="fsfunc">Box2D</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp82513224"></a><h2>説明</h2><p>ジオメトリの最大範囲を表すBOX2Dを返します。</p><p>Enhanced: 2.0.0 多面体サーフェス対応、三角対応、TIN対応が導入されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div><div class="refsection"><a name="idp82518728"></a><h2>例</h2><pre class="programlisting">SELECT Box2D(ST_GeomFromText('LINESTRING(1 2, 3 4, 5 6)'));
        box2d
        ---------
        BOX(1 2,5 6)

        SELECT Box2D(ST_GeomFromText('CIRCULARSTRING(220268 150415,220227 150505,220227 150406)'));
        box2d
        --------
        BOX(220186.984375 150406,220288.25 150506.140625)
        </pre></div><div class="refsection"><a name="idp82520264"></a><h2>関連情報</h2><p><a class="xref" href="#Box3D" title="Box3D">Box3D</a>, <a class="xref" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="Box3D"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Box3D — ジオメトリの最大範囲を表すBOX3Dを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">box3d <b class="fsfunc">Box3D</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp82526408"></a><h2>説明</h2><p>ジオメトリの最大範囲を表すBOX3Dを返します。</p><p>Enhanced: 2.0.0 多面体サーフェス対応、三角対応、TIN対応が導入されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp82533320"></a><h2>例</h2><pre class="programlisting">SELECT Box3D(ST_GeomFromEWKT('LINESTRING(1 2 3, 3 4 5, 5 6 5)'));
        Box3d
        ---------
        BOX3D(1 2 3,5 6 5)

        SELECT Box3D(ST_GeomFromEWKT('CIRCULARSTRING(220268 150415 1,220227 150505 1,220227 150406 1)'));
        Box3d
        --------
        BOX3D(220227 150406 1,220268 150415 1)
        </pre></div><div class="refsection"><a name="idp82534856"></a><h2>関連情報</h2><p><a class="xref" href="#Box2D" title="Box2D">Box2D</a>, <a class="xref" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_EstimatedExtent"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_EstimatedExtent — 与えられた空間テーブルの「見積もられた」範囲を返します。ジオメトリカラムの統計情報から見積もります。指定されていない場合は現在のスキーマが使われます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">box2d <b class="fsfunc">ST_EstimatedExtent</b>(</code>text  <var class="pdparam">schema_name</var>, text  <var class="pdparam">table_name</var>, text  <var class="pdparam">geocolumn_name</var>, boolean  <var class="pdparam">parent_ony</var><code>)</code>;</p><p><code class="funcdef">box2d <b class="fsfunc">ST_EstimatedExtent</b>(</code>text  <var class="pdparam">schema_name</var>, text  <var class="pdparam">table_name</var>, text  <var class="pdparam">geocolumn_name</var><code>)</code>;</p><p><code class="funcdef">box2d <b class="fsfunc">ST_EstimatedExtent</b>(</code>text  <var class="pdparam">table_name</var>, text  <var class="pdparam">geocolumn_name</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp82551496"></a><h2>説明</h2><p>与えられた空間テーブルの「見積もられた」範囲を返します。ジオメトリカラムの統計情報から見積もります。指定されていない場合は現在のスキーマが使われます。デフォルトの挙動では、子テーブル (継承されたテーブル)が存在する場合に、これらから集めた統計情報も使用します。'parent_only'がTRUEに設定されている場合には、指定されたテーブルの統計情報のみを使い、子テーブルは無視されます。 </p><p>PostgreSQL 8.0.0以上では、統計情報はVACUUM ANALYZEで集められ、結果の範囲は実際の約95%です。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>統計情報が無い (空のテーブルまたはANALYZEを実行していない)場合には、この関数はNULLを返します。1.5.4より前では、代わりに例外が投げられていました。 </p></td></tr></table></div><p>PostgreSQL 8.0.0より前では、統計情報はupdate_geometry_stats()で集められ、範囲は確実です。</p><p>Availability: 1.0.0</p><p>Changed: 2.1.0 2.0.xまではST_Estimated_Extentと呼ばれていました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p></div><div class="refsection"><a name="idp82556104"></a><h2>例</h2><pre class="programlisting">SELECT ST_EstimatedExtent('ny', 'edges', 'the_geom');
-- 結果 --
BOX(-8877653 4912316,-8010225.5 5589284)

SELECT ST_EstimatedExtent('feature_poly', 'the_geom');
-- 結果 --
BOX(-124.659652709961 24.6830825805664,-67.7798080444336 49.0012092590332)
                </pre></div><div class="refsection"><a name="idp82557640"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Extent" title="ST_Extent">ST_Extent</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Expand"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Expand — 入力ジオメトリのバウンディングボックスから全ての方向に拡張されたバウンディングボックスを返します。倍精度浮動小数点数を使います。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Expand</b>(</code>geometry  <var class="pdparam">geom</var>, float <var class="pdparam">units_to_expand</var><code>)</code>;</p><p><code class="funcdef">geometry <b class="fsfunc">ST_Expand</b>(</code>geometry  <var class="pdparam">geom</var>, float <var class="pdparam">dx</var>, float <var class="pdparam">dy</var>, float <var class="pdparam">dz=0</var>, float <var class="pdparam">dm=0</var><code>)</code>;</p><p><code class="funcdef">box2d <b class="fsfunc">ST_Expand</b>(</code>box2d  <var class="pdparam">box</var>, float <var class="pdparam">units_to_expand</var><code>)</code>;</p><p><code class="funcdef">box2d <b class="fsfunc">ST_Expand</b>(</code>box2d  <var class="pdparam">box</var>, float <var class="pdparam">dx</var>, float <var class="pdparam">dy</var><code>)</code>;</p><p><code class="funcdef">box3d <b class="fsfunc">ST_Expand</b>(</code>box3d  <var class="pdparam">box</var>, float <var class="pdparam">units_to_expand</var><code>)</code>;</p><p><code class="funcdef">box3d <b class="fsfunc">ST_Expand</b>(</code>box3d  <var class="pdparam">box</var>, float <var class="pdparam">dx</var>, float <var class="pdparam">dy</var>, float <var class="pdparam">dz=0</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp82586952"></a><h2>説明</h2><p>入力のバウンディングボックスから拡張したバウンディングボックスを返します。一つの距離を指定して全ての方向に拡張するものと、方向ごとに距離を指定して拡張するものとがあります。倍精度浮動小数点を使います。距離に関するクエリや、空間インデックスの利点を得るために行うクエリへのフィルタリングの追加で非常に有用です。</p><p>最も一般的に使用されるジオメトリを引数に取る版のST_Expandの他に、内部で使われるBOX2Dデータ型やBOX3Dデータ型を受け付けたり生成したりする形式が提供されています。 </p><p>ST_ExpandはST_bufferに概念的に似ていますが、バッファはジオメトリを全ての方向に拡張し、ST_Expandはバウンディングボックスをx,y,zの単位の量で拡張します。</p><p>単位はSRIDで示されている空間参照系の単位です。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>1.3より前は、ST_Expandは、インデクスを利用するクエリを実行するために、distanceと併せて使用されていました。形式は <code class="code">the_geom &amp;&amp; ST_Expand('POINT(10 20)', 10) AND ST_Distance(the_geom, 'POINT(10 20)') &lt; 10</code>となります。1.2以降は、より簡単なST_DWithinと入れ替えられました。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Availability: 1.5.0 出力をfloat4座標値から倍精度に変更しました。</p><p>Enhanced: 2.0.0 多面体サーフェス対応、三角対応、TIN対応が導入されました。</p><p>Enhanced: 2.3.0 異なる次元の異なる量によるボックスの拡張に対応するようになりました。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div><div class="refsection"><a name="idp82594760"></a><h2>例</h2><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>次に示す例では、メートル単位の投影法である米国ナショナルアトラス正積図法 (SRID=2163)を使っています。</p></td></tr></table></div><pre class="programlisting">
-- ラインストリングのバウンディングボックスを10メートル拡張
SELECT CAST(ST_Expand(ST_GeomFromText('LINESTRING(2312980 110676,2312923 110701,2312892 110714)', 2163),10) As box2d);
                                         st_expand
------------------------------------
 BOX(2312882 110666,2312990 110724)

--10 meter expanded 3d box of a 3d box
SELECT ST_Expand(CAST('BOX3D(778783 2951741 1,794875 2970042.61545891 10)' As box3d),10)
                                                          st_expand
-----------------------------------------------------
 BOX3D(778773 2951731 -9,794885 2970052.61545891 20)

 -- 3次元ボックスを10メートル拡張
 SELECT ST_AsEWKT(ST_Expand(ST_GeomFromEWKT('SRID=2163;POINT(2312980 110676)'),10));
                                                                                        st_asewkt
-------------------------------------------------------------------------------------------------
 SRID=2163;POLYGON((2312970 110666,2312970 110686,2312990 110686,2312990 110666,2312970 110666))

                </pre></div><div class="refsection"><a name="idp82596680"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a>, <a class="xref" href="#ST_Buffer" title="ST_Buffer">ST_Buffer</a>, <a class="xref" href="#ST_DWithin" title="ST_DWithin">ST_DWithin</a>, <a class="xref" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a>, <a class="xref" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a>, <a class="xref" href="#ST_SRID" title="ST_SRID">ST_SRID</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Extent"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Extent — ジオメトリのバウンディングボックスを返す集約関数です。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">box2d <b class="fsfunc">ST_Extent</b>(</code>geometry set <var class="pdparam">geomfield</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp82616648"></a><h2>説明</h2><p>ST_Extentは、ジオメトリの集合を囲むバウンディングボックスを返します。ST_Extentは、PostgreSQL用語で言うところの「集約関数」です。SUM()やMEAN()と同じ方法でデータリストの操作を行うことを意味します。</p><p>バウンディングボックスを返しますが、空間単位はSRIDで示された空間参照系の単位です。</p><p>ST_ExtentはOracle Spatial/LocatorのSDO_AGGR_MBRと似た発想のものです。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_Extentはバウンディングボックスを返しますが、SRIDメタデータは失います。ST_SetSRIDを使って、SRIDメタデータをジオメトリに強制的に戻します。座標値の単位は元のジオメトリの空間参照系の単位です。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_Extentは(X,Y,Z)を持っていても、X値とY値のボックスを返します。X,Y,Zを維持するにはST_Extent3Dを使います。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Availability: 1.4.0</p></td></tr></table></div><p>Enhanced: 2.0.0 多面体サーフェス対応、三角対応、TIN対応が導入されました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div><div class="refsection"><a name="idp82624200"></a><h2>例</h2><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>次に示す例では、フィート単位のマサチューセッツ州平面 (SRID=2249)を使っています。</p></td></tr></table></div><pre class="programlisting">SELECT ST_Extent(the_geom) as bextent FROM sometable;
                                         st_bextent
------------------------------------
BOX(739651.875 2908247.25,794875.8125 2970042.75)


-- ジオメトリの各カテゴリの範囲を返します
SELECT ST_Extent(the_geom) as bextent
FROM sometable
GROUP BY category ORDER BY category;

                                          bextent                       |         name
----------------------------------------------------+----------------
 BOX(778783.5625 2951741.25,794875.8125 2970042.75) | A
 BOX(751315.8125 2919164.75,765202.6875 2935417.25) | B
 BOX(739651.875 2917394.75,756688.375 2935866)      | C

-- ジオメトリに強制的戻し、ジオメトリのEWKT表現を表示します
SELECT ST_SetSRID(ST_Extent(the_geom),2249) as bextent FROM sometable;

                                bextent
--------------------------------------------------------------------------------
 SRID=2249;POLYGON((739651.875 2908247.25,739651.875 2970042.75,794875.8125 2970042.75,
 794875.8125 2908247.25,739651.875 2908247.25))
                </pre></div><div class="refsection"><a name="idp82626120"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a>, <a class="xref" href="#ST_3DExtent" title="ST_3DExtent">ST_3DExtent</a>, <a class="xref" href="#ST_SetSRID" title="ST_SetSRID">ST_SetSRID</a>, <a class="xref" href="#ST_SRID" title="ST_SRID">ST_SRID</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_3DExtent"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_3DExtent — ジオメトリのbox3Dバウンディングボックスを返す集約関数です。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">box3d <b class="fsfunc">ST_3DExtent</b>(</code>geometry set <var class="pdparam">geomfield</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp82637128"></a><h2>説明</h2><p>ST_3DExtentはジオメトリの集合を囲むbox3d (Z座標を含む)のバウンディングボックスを返します。ST_Extentは、PostgreSQL用語で言うところの「集約関数」です。SUM()やMEAN()と同じ方法でデータリストの操作を行うことを意味します。</p><p>バウンディングボックスを返しますが、空間単位はSRIDで示された空間参照系の単位です。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_3DExtentはバウンディングボックスを返しますが、SRIDメタデータは失います。ST_SetSRIDを使って、SRIDメタデータをジオメトリに強制的に戻します。座標値の単位は元のジオメトリの空間参照系の単位です。</p></td></tr></table></div><p>Enhanced: 2.0.0 多面体サーフェス対応、三角対応、TIN対応が導入されました。</p><p>Changed: 2.0.0 以前の版ではST_Extent3Dと呼ばれていました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p></div><div class="refsection"><a name="idp82645704"></a><h2>例</h2><pre class="programlisting">SELECT ST_3DExtent(foo.the_geom) As b3extent
FROM (SELECT ST_MakePoint(x,y,z) As the_geom
        FROM generate_series(1,3) As x
                CROSS JOIN generate_series(1,2) As y
                CROSS JOIN generate_series(0,2) As Z) As foo;
          b3extent
--------------------
 BOX3D(1 1 0,3 2 2)

-- 様々な高度を持つ曲線ストリングの範囲を得ます
SELECT ST_3DExtent(foo.the_geom) As b3extent
FROM (SELECT ST_Translate(ST_Force_3DZ(ST_LineToCurve(ST_Buffer(ST_MakePoint(x,y),1))),0,0,z) As the_geom
        FROM generate_series(1,3) As x
                CROSS JOIN generate_series(1,2) As y
                CROSS JOIN generate_series(0,2) As Z) As foo;

        b3extent
--------------------
 BOX3D(1 0 0,4 2 2)
                </pre></div><div class="refsection"><a name="idp82646984"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Extent" title="ST_Extent">ST_Extent</a>, <a class="xref" href="#ST_Force_3DZ" title="ST_Force3DZ">ST_Force3DZ</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="Find_SRID"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Find_SRID — この関数の書式はfind_srid(a_db_schema, a_table, a_column)です。GEOMETRY_COLUMNSで検索して、指定したカラムのSRID整数値を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">Find_SRID</b>(</code>varchar  <var class="pdparam">a_schema_name</var>, varchar  <var class="pdparam">a_table_name</var>, varchar  <var class="pdparam">a_geomfield_name</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp82659272"></a><h2>説明</h2><p>この関数の書式はfind_srid(a_db_schema, a_table, a_column)です。GEOMETRY_COLUMNSで検索して、指定したカラムのSRID整数値を返します。ジオメトリカラムがAddGeometryColumn()関数で確実に追加していない場合には、確実には動作しません (訳注: GEOMETRY_COLUMNSビューで確実な登録が確認できていれば良いです)。</p></div><div class="refsection"><a name="idp82660424"></a><h2>例</h2><pre class="programlisting">SELECT Find_SRID('public', 'tiger_us_state_2007', 'the_geom_4269');
find_srid
----------
4269
</pre></div><div class="refsection"><a name="idp82661960"></a><h2>関連情報</h2><p><a class="xref" href="#ST_SRID" title="ST_SRID">ST_SRID</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_MemSize"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MemSize — ジオメトリが取る容量 (バイト単位)を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_MemSize</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp82667720"></a><h2>説明</h2><p>ジオメトリが取る容量 (バイト単位)を返します。 </p><p>この関数はPostgreSQLビルトイン関数pg_clumn_size, pg_size_pretty, pg_relation_size, pg_total_relation_sizeへのすばらしい賛辞です。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>テーブルのバイト単位のサイズを与えるpg_relation_sizeはST_Mem_Sizeより小さいバイト数が返ります。これはpg_relation_sizeがTOAST化されたテーブルの寄与を追加せず、TOASTテーブルに格納された大きなジオメトリを加えないためです。</p><p>pg_total_relation_size - テーブル、TOASTテーブル、インデクスを含みます。</p><p>pg_column_sizeは、ジオメトリがカラム内で取る領域がどれだけかを、圧縮を考慮して返します。そのため、ST_MemSizeより小さくなることがあります。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Polyhedral surfaces.</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports Triangles and Triangulated Irregular Network Surfaces (TIN).</p><p>Changed: 2.2.0 命名規則に従うためにST_MemSizeに変更しました。以前の版では、この関数はST_Mem_Sizeと呼ばれていました。古い名前は非推奨ですが現在のところは有効です。</p></div><div class="refsection"><a name="idp82676424"></a><h2>例</h2><pre class="programlisting">-- マサチューセッツ州データセットにおいて
-- ボストンがどれだけの容量を取るかを返します
SELECT pg_size_pretty(SUM(ST_MemSize(the_geom))) as totgeomsum,
pg_size_pretty(SUM(CASE WHEN town = 'BOSTON' THEN ST_MemSize(the_geom) ELSE 0 END)) As bossum,
CAST(SUM(CASE WHEN town = 'BOSTON' THEN ST_MemSize(the_geom) ELSE 0 END)*1.00 /
                SUM(ST_MemSize(the_geom))*100 As numeric(10,2)) As perbos
FROM towns;

totgeomsum        bossum        perbos
----------        ------        ------
1522 kB                30 kB        1.99


SELECT ST_MemSize(ST_GeomFromText('CIRCULARSTRING(220268 150415,220227 150505,220227 150406)'));

---
73

-- ジオメトリだけでテーブルの何パーセントを取っているか
SELECT pg_total_relation_size('public.neighborhoods') As fulltable_size, sum(ST_MemSize(the_geom)) As geomsize,
sum(ST_MemSize(the_geom))*1.00/pg_total_relation_size('public.neighborhoods')*100 As pergeom
FROM neighborhoods;
fulltable_size geomsize  pergeom
------------------------------------------------
262144         96238         36.71188354492187500000
        </pre></div><div class="refsection"><a name="idp82677960"></a><h2>関連情報</h2><p></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_Point_Inside_Circle"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_PointInsideCircle — ポイントジオメトリがcenter_x, center_y , radiusで定義される円内にあるかどうかを見ます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_PointInsideCircle</b>(</code>geometry  <var class="pdparam">a_point</var>, float  <var class="pdparam">center_x</var>, float  <var class="pdparam">center_y</var>, float  <var class="pdparam">radius</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp82686664"></a><h2>説明</h2><p>この関数の書式はST_PointInsideCircle(&lt;geometry&gt;,&lt;circle_center_x&gt;,&lt;circle_center_y&gt;,&lt;radius&gt;)です。ジオメトリがポイントで、かつ円内にある場合にTRUEを返します。他の場合はFALSEを返します。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数は名前が示すようにポイントでのみ動作します。</p></td></tr></table></div><p>Availability: 1.2</p><p>Changed: 2.2.0 以前の版ではST_Point_Inside_Circleと呼ばれていました。</p></div><div class="refsection"><a name="idp82689096"></a><h2>例</h2><pre class="programlisting">SELECT ST_PointInsideCircle(ST_Point(1,2), 0.5, 2, 3);
 st_pointinsidecircle
------------------------
 t
</pre></div><div class="refsection"><a name="idp82690632"></a><h2>関連情報</h2><p><a class="xref" href="#ST_DWithin" title="ST_DWithin">ST_DWithin</a></p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Exceptional_Functions"></a>8.16. 例外的関数</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#PostGIS_AddBBox">PostGIS_AddBBox</a></span><span class="refpurpose"> — ジオメトリにバウンディングボックスを追加します。</span></dt><dt><span class="refentrytitle"><a href="#PostGIS_DropBBox">PostGIS_DropBBox</a></span><span class="refpurpose"> — ジオメトリからバウンディングボックスのキャッシュを削除します。</span></dt><dt><span class="refentrytitle"><a href="#PostGIS_HasBBox">PostGIS_HasBBox</a></span><span class="refpurpose"> — ジオメトリのバウンディングボックスがキャッシュされている場合にはTRUEを返し、他の場合にはFALSEを返します。</span></dt></dl></div><p>ここで示す関数は、データが何らかの理由で破損した場合にだけ使われる、使用頻度の低い関数です。これらの関数は破損のトラブルシューティングと通常の環境では決して起こらないことを訂正するために使われます。</p><div class="refentry"><a name="PostGIS_AddBBox"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>PostGIS_AddBBox — ジオメトリにバウンディングボックスを追加します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">PostGIS_AddBBox</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp82904648"></a><h2>説明</h2><p>ジオメトリにバウンディングボックスを追加します。これにより、バウンディングボックスに基づく検索が早くなりますが、ジオメトリのサイズが大きくなります。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>バウンディングボックスは自動的にジオメトリに追加されるので、通常はこの関数は不要ですが、生成されたバウンディングボックスが何らかの理由で破損するか、バウンディングボックスを欠く古い版をインストールしている場合に使われます。古いものを削除し、再追加する必要があります。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p></div><div class="refsection"><a name="idp82920008"></a><h2>例</h2><pre class="programlisting">UPDATE sometable
 SET the_geom =  PostGIS_AddBBox(the_geom)
 WHERE PostGIS_HasBBox(the_geom) = false;</pre></div><div class="refsection"><a name="idp82921544"></a><h2>関連情報</h2><p><a class="xref" href="#PostGIS_DropBBox" title="PostGIS_DropBBox">PostGIS_DropBBox</a>, <a class="xref" href="#PostGIS_HasBBox" title="PostGIS_HasBBox">PostGIS_HasBBox</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="PostGIS_DropBBox"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>PostGIS_DropBBox — ジオメトリからバウンディングボックスのキャッシュを削除します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">PostGIS_DropBBox</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp82927688"></a><h2>説明</h2><p>ジオメトリからバウンディングボックスのキャッシュを削除します。これによりジオメトリのサイズは小さくなりますが、バウンディングボックスを基にした検索が遅くなります。破損したバウンディングボックスを削除する際にも使われます。ST_Intersectsや他の関係関数がジオメトリを正しくtrueを返すべきジオメトリを無視すると、それが、バウンディングボックスのキャッシュが破損したことを示す合図です。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>バウンディングボックスは自動的にジオメトリに追加されるので、通常はこの関数は不要ですが、生成されたバウンディングボックスが何らかの理由で破損するか、バウンディングボックスを欠く古い版をインストールしている場合に使われます。古いものを削除し、再追加する必要があります。この種類の破損は8.3-8.3.6で観察されました。ジオメトリが変更された際に常にキャッシュされたバウンディングボックスが再計算されておらず、ダンプと再読み込みを行わずに新しい版へのアップグレードを行うと、既に破損したバウンディングボックスが訂正されないためです。次に示すように手動で収集してバウンディングボックスを再追加するか、ダンプとリロードを使います。</p></td></tr></table></div><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p></div><div class="refsection"><a name="idp82930760"></a><h2>例</h2><pre class="programlisting">-- これは、バウンディングボックスのキャッシュが正しくないときに
-- バウンディングボックスを削除する例です。
-- Box2Dの適用でバウンディングボックスの再計算が強制される前に
-- ST_AsBinaryを実行して、
-- ジオメトリテーブルに適用されたBox2Dが
-- 常にバウンディングボックスのキャッシュを返すようにします。
                        UPDATE sometable
 SET the_geom =  PostGIS_DropBBox(the_geom)
 WHERE Not (Box2D(ST_AsBinary(the_geom)) = Box2D(the_geom));

        UPDATE sometable
 SET the_geom =  PostGIS_AddBBox(the_geom)
 WHERE Not PostGIS_HasBBOX(the_geom);


 </pre></div><div class="refsection"><a name="idp82932296"></a><h2>関連情報</h2><p><a class="xref" href="#PostGIS_AddBBox" title="PostGIS_AddBBox">PostGIS_AddBBox</a>, <a class="xref" href="#PostGIS_HasBBox" title="PostGIS_HasBBox">PostGIS_HasBBox</a>, <a class="xref" href="#Box2D" title="Box2D">Box2D</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="PostGIS_HasBBox"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>PostGIS_HasBBox — ジオメトリのバウンディングボックスがキャッシュされている場合にはTRUEを返し、他の場合にはFALSEを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">PostGIS_HasBBox</b>(</code>geometry  <var class="pdparam">geomA</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp82959304"></a><h2>説明</h2><p>ジオメトリのバウンディングボックスがキャッシュされている場合にはTRUEを返し、他の場合にはFALSEを返します。<a class="xref" href="#PostGIS_AddBBox" title="PostGIS_AddBBox">PostGIS_AddBBox</a>と<a class="xref" href="#PostGIS_DropBBox" title="PostGIS_DropBBox">PostGIS_DropBBox</a>でバウンディングボックスのキャッシュを制御します。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This method supports Circular Strings and Curves</p></div><div class="refsection"><a name="idp82962376"></a><h2>例</h2><pre class="programlisting">SELECT the_geom
FROM sometable WHERE PostGIS_HasBBox(the_geom) = false;</pre></div><div class="refsection"><a name="idp82963912"></a><h2>関連情報</h2><p><a class="xref" href="#PostGIS_AddBBox" title="PostGIS_AddBBox">PostGIS_AddBBox</a>, <a class="xref" href="#PostGIS_DropBBox" title="PostGIS_DropBBox">PostGIS_DropBBox</a></p></div></div></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="RT_reference"></a>第9章 ラスタ リファレンス</h1></div></div></div><div class="toc"><p><b>目次</b></p><dl class="toc"><dt><span class="sect1"><a href="#Raster_Types">9.1. ラスタサポートデータ型</a></span></dt><dt><span class="sect1"><a href="#Raster_Management_Functions">9.2. ラスタ管理</a></span></dt><dt><span class="sect1"><a href="#Raster_Constructors">9.3. ラスタコンストラクタ</a></span></dt><dt><span class="sect1"><a href="#Raster_Accessors">9.4. ラスタアクセサ</a></span></dt><dt><span class="sect1"><a href="#RasterBand_Accessors">9.5. ラスタバンドアクセサ</a></span></dt><dt><span class="sect1"><a href="#Raster_Pixel_Accessors">9.6. ラスタピクセルアクセサとセッター</a></span></dt><dt><span class="sect1"><a href="#Raster_Editors">9.7. ラスタエディタ</a></span></dt><dt><span class="sect1"><a href="#RasterBand_Editors">9.8. ラスタバンドエディタ</a></span></dt><dt><span class="sect1"><a href="#RasterBand_Stats">9.9. ラスタバンド統計情報と解析</a></span></dt><dt><span class="sect1"><a href="#Raster_Inputs">9.10. ラスタ入力</a></span></dt><dt><span class="sect1"><a href="#Raster_Outputs">9.11. 出力</a></span></dt><dt><span class="sect1"><a href="#Raster_Processing">9.12. ラスタ処理</a></span></dt><dd><dl><dt><span class="sect2"><a href="#Raster_Processing_MapAlgebra">9.12.1. 地図代数</a></span></dt><dt><span class="sect2"><a href="#Raster_Processing_MapAlgebra_Callbacks">9.12.2. 組み込み地図代数コールバック関数</a></span></dt><dt><span class="sect2"><a href="#Raster_Processing_DEM">9.12.3. DEM (標高)</a></span></dt><dt><span class="sect2"><a href="#Raster_Processing_Geometry">9.12.4. ラスタからジオメトリ</a></span></dt></dl></dd><dt><span class="sect1"><a href="#RT_Operators">9.13. ラスタ演算子</a></span></dt><dt><span class="sect1"><a href="#Raster_Relationships">9.14. ラスタとラスタバンドの空間関係関数</a></span></dt><dt><span class="sect1"><a href="#Raster_Tips">9.15. ラスタに関する技法</a></span></dt><dd><dl><dt><span class="sect2"><a href="#outdb">9.15.1. データベース外ラスタ</a></span></dt></dl></dd></dl></div><p>ここで挙げる関数は、PostGISラスタにとって必要と思われるもので、現在PostGISラスタで有効なものです。他に、一般的なユーザが利用しない、ラスタオブジェクトに対して求められるサポート関数があります。</p><p><code class="varname">raster</code>は、ラスタデータの格納と分析のための新しいPostGIS型です。 </p><p>ラスタファイルからラスタをロードするには<a class="xref" href="#RT_Loading_Rasters" title="5.1. ラスタのロードと生成">「ラスタのロードと生成」</a>を参照して下さい。</p><p>このリファレンスにおける例ではダミーラスタのラスタテーブルを使っています。ラスタは次のようなコードで形成しています。 </p><pre class="programlisting">CREATE TABLE dummy_rast(rid integer, rast raster);
INSERT INTO dummy_rast(rid, rast)
VALUES (1,
('01' -- little endian - リトルエンディアン (uint8 ndr)
||
'0000' -- version - 版 (uint16 0)
||
'0000' -- nBands - バンド数 (uint16 0)
||
'0000000000000040' -- scaleX - X方向セルサイズ (float64 2)
||
'0000000000000840' -- scaleY - Y方向セルサイズ (float64 3)
||
'000000000000E03F' -- ipX - 左上隅X値 (float64 0.5)
||
'000000000000E03F' -- ipY - 左上隅Y値 (float64 0.5)
||
'0000000000000000' -- skewX - スキューX (float64 0)
||
'0000000000000000' -- skewY - スキューY (float64 0)
||
'00000000' -- SRID (int32 0)
||
'0A00' -- width - 横セル数 (uint16 10)
||
'1400' -- height - 縦セル数 (uint16 20)
)::raster
),
-- Raster: 5 x 5 pixels, 3 bands, PT_8BUI pixel type, NODATA = 0
(2,  ('01000003009A9999999999A93F9A9999999999A9BF000000E02B274A' ||
'41000000007719564100000000000000000000000000000000FFFFFFFF050005000400FDFEFDFEFEFDFEFEFDF9FAFEF' ||
'EFCF9FBFDFEFEFDFCFAFEFEFE04004E627AADD16076B4F9FE6370A9F5FE59637AB0E54F58617087040046566487A1506CA2E3FA5A6CAFFBFE4D566DA4CB3E454C5665')::raster);</pre><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Raster_Types"></a>9.1. ラスタサポートデータ型</h2></div><div><div class="abstract"><p class="title"><b>概要</b></p><p>本節では、ラスタ機能をサポートするために作られたPostgreSQLデータ型の一覧を挙げます。</p></div></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#geomval">geomval</a></span><span class="refpurpose"> — geom (ジオメトリオブジェクトを保持)とval (ラスタバンドからのピクセル値を倍精度浮動小数点数で保持)の2フィールドからなるデータ型。</span></dt><dt><span class="refentrytitle"><a href="#addbandarg">addbandarg</a></span><span class="refpurpose"> — ST_AddBandの入力に使われる複合型で、新しいバンドの属性と初期値からなります。</span></dt><dt><span class="refentrytitle"><a href="#rastbandarg">rastbandarg</a></span><span class="refpurpose"> — ラスタとそのバンドインデクスを表現する必要がある時に使われる複合型。</span></dt><dt><span class="refentrytitle"><a href="#raster">raster</a></span><span class="refpurpose"> — ラスタ空間データ型。</span></dt><dt><span class="refentrytitle"><a href="#reclassarg">reclassarg</a></span><span class="refpurpose"> — ST_Reclass関数への入力として使用する複合型です。再分類の挙動を定義します。</span></dt><dt><span class="refentrytitle"><a href="#summarystats">summarystats</a></span><span class="refpurpose"> — ST_SummaryStats関数とST_SummaryStatsAgg関数の出力として使う複合型です。</span></dt><dt><span class="refentrytitle"><a href="#unionarg">unionarg</a></span><span class="refpurpose"> — ST_Union関数の入力に使う複合型です。処理するバンドと結合処理の挙動を定義します。</span></dt></dl></div><div class="refentry"><a name="geomval"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>geomval — geom (ジオメトリオブジェクトを保持)とval (ラスタバンドからのピクセル値を倍精度浮動小数点数で保持)の2フィールドからなるデータ型。</p></div><div class="refsection"><a name="idp90341576"></a><h2>説明</h2><p>geomvalは.geomフィールドで参照されるジオメトリオブジェクトと、特定の地理位置におけるラスタバンドのピクセル値を表現する浮動小数点数のvalからなる複合型です。ポリゴンにラスタバンドを展開するための出力型として、ST_DumpAsPolygonとラスタのインタセクション関連関数群に使われます。</p></div><div class="refsection"><a name="idp90342728"></a><h2>関連情報</h2><p><a class="xref" href="#PostGIS_Geometry_DumpFunctions" title="14.6. PostGISジオメトリ/ジオグラフィ/ラスタのダンプ関数">「PostGISジオメトリ/ジオグラフィ/ラスタのダンプ関数」</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="addbandarg"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>addbandarg — ST_AddBandの入力に使われる複合型で、新しいバンドの属性と初期値からなります。</p></div><div class="refsection"><a name="idp90345800"></a><h2>説明</h2><p>ST_AddBandの入力に使われる複合型で、新しいバンドの属性と初期値からなります。 </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><em class="parameter"><code>index </code></em> <span class="type">integer</span> </span></dt><dd><p>ラスタのバンド群のうち新しいバンドが追加される位置を示す1始まりの値。NULLの場合には、新しいバンドはラスタバンド群の末尾に追加されます。 </p></dd><dt><span class="term"><em class="parameter"><code>pixeltype </code></em> <span class="type">text</span> </span></dt><dd><p>新しいバンドのピクセルタイプ。定義されたピクセルタイプは<a class="xref" href="#RT_ST_BandPixelType" title="ST_BandPixelType">ST_BandPixelType</a>に記述されています。 </p></dd><dt><span class="term"><em class="parameter"><code>initialvalue </code></em> <span class="type">double precision</span> </span></dt><dd><p>新しいバンドに設定する初期値。 </p></dd><dt><span class="term"><em class="parameter"><code>nodataval </code></em> <span class="type">double precision</span> </span></dt><dd><p>新しいバンドのNODATA値。NULLの場合には、新しいバンドにNODATA値を設定しません。 </p></dd></dl></div><p>

				</p></div><div class="refsection"><a name="idp90356936"></a><h2>関連情報</h2><p>
					<a class="xref" href="#RT_ST_AddBand" title="ST_AddBand">ST_AddBand</a>
				</p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="rastbandarg"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>rastbandarg — ラスタとそのバンドインデクスを表現する必要がある時に使われる複合型。</p></div><div class="refsection"><a name="idp90360136"></a><h2>説明</h2><p>ラスタとそのバンドインデクスを表現する必要がある時に使われる複合型。 </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><em class="parameter"><code>rast </code></em> <span class="type">raster</span> </span></dt><dd><p>問題にするラスタ。 </p></dd><dt><span class="term"><em class="parameter"><code>nband </code></em> <span class="type">integer</span> </span></dt><dd><p>ラスタのバンドを示す1始まりの値。 </p></dd></dl></div><p>

				</p></div><div class="refsection"><a name="idp90378568"></a><h2>関連情報</h2><p>
					<a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>
				</p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="raster"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>raster — ラスタ空間データ型。</p></div><div class="refsection"><a name="idp90381768"></a><h2>説明</h2><p>rasterは、JPEG, TIFF, PNG, デジタル標高モデルといったラスタデータを表現する空間データ型です。ラスタはそれぞれ1以上のバンドを持ち、バンドはそれぞれにピクセル値の集合を持ちます。ラスタには地理参照を与えることができます。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>PostGISをGDALサポート付きでコンパイルする必要があります。 現在、ラスタは暗黙にジオメトリ型に変換することができますが、ラスタの<a class="xref" href="#RT_ST_ConvexHull" title="ST_ConvexHull">ST_ConvexHull</a>を返します。この自動キャストは近いうちに削除するかも知れないので、この関数に頼らないようにして下さい。</p></td></tr></table></div></div><div class="refsection"><a name="idp90384072"></a><h2>キャストの挙動</h2><p>本節では、このデータ型で許容される明示的なキャストと自動キャストの一覧を挙げます。</p><div class="informaltable"><table class="informaltable" border="1"><colgroup><col><col></colgroup><tbody><tr><td>キャスト先</td><td>挙動</td></tr><tr><td>geometry</td><td>自動</td></tr></tbody></table></div></div><div class="refsection"><a name="idp90393288"></a><h2>関連情報</h2><p><a class="xref" href="#RT_reference" title="第9章 ラスタ リファレンス">9章<i>ラスタ リファレンス</i></a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="reclassarg"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>reclassarg — ST_Reclass関数への入力として使用する複合型です。再分類の挙動を定義します。</p></div><div class="refsection"><a name="idp90396232"></a><h2>説明</h2><p>ST_Reclass関数への入力として使用する複合型です。再分類の挙動を定義します。</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><em class="parameter"><code>nband </code></em><span class="type">integer</span></span></dt><dd><p>再分類対象バンドの番号。</p></dd><dt><span class="term"><em class="parameter"><code>reclassexpr </code></em><span class="type">text</span></span></dt><dd><p>コンマ区切りの範囲表現。古い値から新しい値にマップする方法を定義します。 '('は「これより大きい」、')'は「これより小さい」、'['は「これ以上」、']'は「これ以下」、をそれぞれ示します。</p><pre class="programlisting">1. [a-b] = a &lt;= x &lt;= b

2. (a-b] = a &lt; x &lt;= b

3. [a-b) = a &lt;= x &lt; b

4. (a-b) = a &lt; x &lt; b</pre><p>'('標記はオプションです。'a-b'は'(a-b)'と同じ意味になります。</p></dd><dt><span class="term"><em class="parameter"><code>pixeltype </code></em><span class="type">text</span></span></dt><dd><p><a class="xref" href="#RT_ST_BandPixelType" title="ST_BandPixelType">ST_BandPixelType</a>の記述にあるピクセルタイプの一つ。</p></dd><dt><span class="term"><em class="parameter"><code>nodataval </code></em><span class="type">double precision</span></span></dt><dd><p>NODATAとして扱う値。透過が可能な画像出力では、この値は空白になります。</p></dd></dl></div></div><div class="refsection"><a name="idp90406344"></a><h2>例: 2番バンドを8BUIで255をNODATAに再分類</h2><pre class="programlisting">SELECT ROW(2, '0-100:1-10, 101-500:11-150,501 - 10000: 151-254', '8BUI', 255)::reclassarg;</pre></div><div class="refsection"><a name="idp90407624"></a><h2>例: 1番バンドを1BBでNODATAを定義しないで再分類</h2><pre class="programlisting">SELECT ROW(1, '0-100]:0, (100-255:1', '1BB', NULL)::reclassarg;</pre></div><div class="refsection"><a name="idp90408904"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Reclass" title="ST_Reclass">ST_Reclass</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="summarystats"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>summarystats — ST_SummaryStats関数とST_SummaryStatsAgg関数の出力として使う複合型です。</p></div><div class="refsection"><a name="idp90411848"></a><h2>説明</h2><p><a class="xref" href="#RT_ST_SummaryStats" title="ST_SummaryStats">ST_SummaryStats</a>関数と<a class="xref" href="#RT_ST_SummaryStatsAgg" title="ST_SummaryStatsAgg">ST_SummaryStatsAgg</a>関数の出力として使う複合型です。 </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><em class="parameter"><code>count </code></em> <span class="type">integer</span> </span></dt><dd><p>統計情報で使ったピクセルの数。 </p></dd><dt><span class="term"><em class="parameter"><code>sum </code></em> <span class="type">double precision</span> </span></dt><dd><p>統計情報で使ったピクセルの値の合計。 </p></dd><dt><span class="term"><em class="parameter"><code>mean </code></em> <span class="type">double precision</span> </span></dt><dd><p>統計情報で使ったピクセルの値の平均。 </p></dd><dt><span class="term"><em class="parameter"><code>stddev </code></em> <span class="type">double precision</span> </span></dt><dd><p>統計情報で使ったピクセルの値の標準偏差。 </p></dd><dt><span class="term"><em class="parameter"><code>min </code></em> <span class="type">double precision</span> </span></dt><dd><p>統計情報で使ったピクセルの値の最小値。 </p></dd><dt><span class="term"><em class="parameter"><code>max </code></em> <span class="type">double precision</span> </span></dt><dd><p>統計情報で使ったピクセルの値の最大値。 </p></dd></dl></div><p>

				</p></div><div class="refsection"><a name="idp90427848"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_SummaryStats" title="ST_SummaryStats">ST_SummaryStats</a>, <a class="xref" href="#RT_ST_SummaryStatsAgg" title="ST_SummaryStatsAgg">ST_SummaryStatsAgg</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="unionarg"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>unionarg — ST_Union関数の入力に使う複合型です。処理するバンドと結合処理の挙動を定義します。</p></div><div class="refsection"><a name="idp88887112"></a><h2>説明</h2><p>ST_Union関数の入力に使う複合型です。処理するバンドと結合処理の挙動を定義します。 </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><em class="parameter"><code>nband </code></em> <span class="type">integer</span> </span></dt><dd><p>処理する入力ラスタごとのバンドを示す1始まりの値です。 </p></dd><dt><span class="term"><em class="parameter"><code>uniontype </code></em> <span class="type">text</span> </span></dt><dd><p>結合処理の種別。<a class="xref" href="#RT_ST_Union" title="ST_Union">ST_Union</a>に記述がある、定義された種別のうち一つを取ります。 </p></dd></dl></div><p>

				</p></div><div class="refsection"><a name="idp88897736"></a><h2>関連情報</h2><p>
					<a class="xref" href="#RT_ST_Union" title="ST_Union">ST_Union</a>
				</p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Raster_Management_Functions"></a>9.2. ラスタ管理</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#RT_AddRasterConstraints">AddRasterConstraints</a></span><span class="refpurpose"> — ロードされたラスタテーブルの特定のカラムにラスタ制約を追加します。制約には空間参照系、スケール、ブロックサイズ、アラインメント、バンド数、バンド型、ラスタカラムが規則正しいブロックかどうかを示すフラグがあります。テーブルは制約が推論されるためのデータがロードされなければなりません。制約の設定が完了するとtrueを返し、問題があると通知を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_DropRasterConstraints">DropRasterConstraints</a></span><span class="refpurpose"> — ラスタテーブルカラムを参照するPostGISラスタ制約を削除します。データの再読み込みやラスタカラムデータの更新の際に使えます。</span></dt><dt><span class="refentrytitle"><a href="#RT_AddOverviewConstraints">AddOverviewConstraints</a></span><span class="refpurpose"> — ラスタカラムに対して、他のオーバビューであることをタグ付けします。</span></dt><dt><span class="refentrytitle"><a href="#RT_DropOverviewConstraints">DropOverviewConstraints</a></span><span class="refpurpose"> — ラスタカラムに対して他のオーバビューであることをタグ付けしているのを解除します。</span></dt><dt><span class="refentrytitle"><a href="#RT_PostGIS_GDAL_Version">PostGIS_GDAL_Version</a></span><span class="refpurpose"> — PostGISで使っているGDALライブラリの版を報告します。</span></dt><dt><span class="refentrytitle"><a href="#RT_PostGIS_Raster_Lib_Build_Date">PostGIS_Raster_Lib_Build_Date</a></span><span class="refpurpose"> — 完全なラスタライブラリをビルドした日付を報告します。</span></dt><dt><span class="refentrytitle"><a href="#RT_PostGIS_Raster_Lib_Version">PostGIS_Raster_Lib_Version</a></span><span class="refpurpose"> — 完全なラスタの版とビルドコンフィギュレーション情報を報告します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_GDALDrivers">ST_GDALDrivers</a></span><span class="refpurpose"> — 使用しているGDALライブラリが対応するラスタ書式の一覧を返します。この一覧でcan_write=TrueとなっているものだけがST_AsGDALRasterで使えます。</span></dt><dt><span class="refentrytitle"><a href="#RT_UpdateRasterSRID">UpdateRasterSRID</a></span><span class="refpurpose"> — ユーザが指定したカラムとテーブルにあるラスタの全てについてSRIDを変更します。 </span></dt><dt><span class="refentrytitle"><a href="#RT_CreateOverview">ST_CreateOverview</a></span><span class="refpurpose"> — 与えられたラスタカバレッジから解像度を落としたものを生成します。 </span></dt></dl></div><div class="refentry"><a name="RT_AddRasterConstraints"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>AddRasterConstraints — ロードされたラスタテーブルの特定のカラムにラスタ制約を追加します。制約には空間参照系、スケール、ブロックサイズ、アラインメント、バンド数、バンド型、ラスタカラムが規則正しいブロックかどうかを示すフラグがあります。テーブルは制約が推論されるためのデータがロードされなければなりません。制約の設定が完了するとtrueを返し、問題があると通知を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">AddRasterConstraints</b>(</code>name  <var class="pdparam">rasttable</var>, name  <var class="pdparam">rastcolumn</var>, boolean  <var class="pdparam">srid</var>, boolean  <var class="pdparam">scale_x</var>, boolean  <var class="pdparam">scale_y</var>, boolean  <var class="pdparam">blocksize_x</var>, boolean  <var class="pdparam">blocksize_y</var>, boolean  <var class="pdparam">same_alignment</var>, boolean  <var class="pdparam">regular_blocking</var>, boolean  <var class="pdparam">num_bands=true</var> , boolean  <var class="pdparam">pixel_types=true</var> , boolean  <var class="pdparam">nodata_values=true</var> , boolean  <var class="pdparam">out_db=true</var> , boolean  <var class="pdparam">extent=true</var> <code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">AddRasterConstraints</b>(</code>name  <var class="pdparam">rasttable</var>, name  <var class="pdparam">rastcolumn</var>, text[]  <var class="pdparam">VARIADIC constraints</var><code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">AddRasterConstraints</b>(</code>name  <var class="pdparam">rastschema</var>, name  <var class="pdparam">rasttable</var>, name  <var class="pdparam">rastcolumn</var>, text[]  <var class="pdparam">VARIADIC constraints</var><code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">AddRasterConstraints</b>(</code>name  <var class="pdparam">rastschema</var>, name  <var class="pdparam">rasttable</var>, name  <var class="pdparam">rastcolumn</var>, boolean  <var class="pdparam">srid=true</var>, boolean  <var class="pdparam">scale_x=true</var>, boolean  <var class="pdparam">scale_y=true</var>, boolean  <var class="pdparam">blocksize_x=true</var>, boolean  <var class="pdparam">blocksize_y=true</var>, boolean  <var class="pdparam">same_alignment=true</var>, boolean  <var class="pdparam">regular_blocking=false</var>, boolean  <var class="pdparam">num_bands=true</var>, boolean  <var class="pdparam">pixel_types=true</var>, boolean  <var class="pdparam">nodata_values=true</var> , boolean  <var class="pdparam">out_db=true</var> , boolean  <var class="pdparam">extent=true</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp90479048"></a><h2>説明</h2><p>ラスタカラム上に、ラスタカタログ<code class="varname">raster_columns</code>で情報を表示するために使われる制約を生成します。<code class="varname">rastschema</code>は、テーブルがあるテーブルスキーマの名前です。<code class="varname">srid</code>はSPATIAL_REF_SYSテーブル内のエントリを参照する整数でなければなりません。</p><p><code class="varname">raster2pgsql</code>はこの関数を使ってラスタテーブルを登録します。</p><p>渡すのに妥当な制約名は次の通りです。詳細情報については<a class="xref" href="#RT_Raster_Columns" title="5.2.1. ラスタカラムカタログ">「ラスタカラムカタログ」</a>を参照して下さい。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="varname">blocksize</code> ブロックのXとY両方のサイズを指定します</p></li><li class="listitem"><p><code class="varname">blocksize_x</code> Xタイル(タイル毎のピクセル幅)を設定します</p></li><li class="listitem"><p><code class="varname">blocksize_y</code> Yタイル(タイル毎のピクセル幅)を設定します</p></li><li class="listitem"><p><code class="varname">extent</code> テーブル全体の範囲を計算し、全てのラスタがこの範囲内にある制約を適用します</p></li><li class="listitem"><p><code class="varname">num_bands</code> バンド数</p></li><li class="listitem"><p><code class="varname">pixel_types</code> バンドごとにピクセルタイプを読み、全てのバンドが同じピクセルタイプであることを確認します。</p></li><li class="listitem"><p><code class="varname">regular_blocking</code> 空間的に一意 (二つのラスタが空間的に同じにならない)であり、カバレッジタイル (ラスタがカバレッジに整列する)制約であるようにします。</p></li><li class="listitem"><p><code class="varname">same_alignment</code> 同じアラインメントを持つようにします。任意の2タイルについて比較するとtrueを返すという意味です。<a class="xref" href="#RT_ST_SameAlignment" title="ST_SameAlignment">ST_SameAlignment</a>を参照して下さい。</p></li><li class="listitem"><p><code class="varname">srid</code> 全て同じSRIDを持っていることを確認するためのものです。</p></li><li class="listitem"><p>その他 -- 上の関数への入力で一覧が挙げられています。</p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はテーブル内に存在するデータから制約を推論します。動作させるには、まずラスタカラムを生成し、その後にデータをロードする必要があります。 </p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>制約を適用した後にデータをさらにロードする必要がある場合には、データ範囲が変わるならDropRasterConstraintsを使います。 </p></td></tr></table></div><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp90493256"></a><h2>例: カラムに対して全てのありえる制約をデータに基づいて適用する</h2><pre class="programlisting">CREATE TABLE myrasters(rid SERIAL primary key, rast raster);
INSERT INTO myrasters(rast)
SELECT ST_AddBand(ST_MakeEmptyRaster(1000, 1000, 0.3, -0.3, 2, 2, 0, 0,4326), 1, '8BSI'::text, -129, NULL);

SELECT AddRasterConstraints('myrasters'::name, 'rast'::name);


-- verify if registered correctly in the raster_columns view --
SELECT srid, scale_x, scale_y, blocksize_x, blocksize_y, num_bands, pixel_types, nodata_values
        FROM raster_columns
        WHERE r_table_name = 'myrasters';

 srid | scale_x | scale_y | blocksize_x | blocksize_y | num_bands | pixel_types| nodata_values
------+---------+---------+-------------+-------------+-----------+-------------+---------------
 4326 |       2 |       2 |        1000 |        1000 |         1 | {8BSI}      | {0}
                </pre></div><div class="refsection"><a name="idp90494536"></a><h2>例: 単一の制約を適用する</h2><pre class="programlisting">CREATE TABLE public.myrasters2(rid SERIAL primary key, rast raster);
INSERT INTO myrasters2(rast)
SELECT ST_AddBand(ST_MakeEmptyRaster(1000, 1000, 0.3, -0.3, 2, 2, 0, 0,4326), 1, '8BSI'::text, -129, NULL);

SELECT AddRasterConstraints('public'::name, 'myrasters2'::name, 'rast'::name,'regular_blocking', 'blocksize');
-- 通知が出ます --
NOTICE:  Adding regular blocking constraint
NOTICE:  Adding blocksize-X constraint
NOTICE:  Adding blocksize-Y constraint</pre></div><div class="refsection"><a name="idp90495816"></a><h2>関連情報</h2><p><a class="xref" href="#RT_Raster_Columns" title="5.2.1. ラスタカラムカタログ">「ラスタカラムカタログ」</a>, <a class="xref" href="#RT_ST_AddBand" title="ST_AddBand">ST_AddBand</a>, <a class="xref" href="#RT_ST_MakeEmptyRaster" title="ST_MakeEmptyRaster">ST_MakeEmptyRaster</a>, <a class="xref" href="#RT_DropRasterConstraints" title="DropRasterConstraints">DropRasterConstraints</a>, <a class="xref" href="#RT_ST_BandPixelType" title="ST_BandPixelType">ST_BandPixelType</a>, <a class="xref" href="#RT_ST_SRID" title="ST_SRID">ST_SRID</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_DropRasterConstraints"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>DropRasterConstraints — ラスタテーブルカラムを参照するPostGISラスタ制約を削除します。データの再読み込みやラスタカラムデータの更新の際に使えます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">DropRasterConstraints</b>(</code>name  <var class="pdparam">rasttable</var>, name  <var class="pdparam">rastcolumn</var>, boolean  <var class="pdparam">srid</var>, boolean  <var class="pdparam">scale_x</var>, boolean  <var class="pdparam">scale_y</var>, boolean  <var class="pdparam">blocksize_x</var>, boolean  <var class="pdparam">blocksize_y</var>, boolean  <var class="pdparam">same_alignment</var>, boolean  <var class="pdparam">regular_blocking</var>, boolean  <var class="pdparam">num_bands=true</var>, boolean  <var class="pdparam">pixel_types=true</var>, boolean  <var class="pdparam">nodata_values=true</var>, boolean  <var class="pdparam">out_db=true</var> , boolean  <var class="pdparam">extent=true</var><code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">DropRasterConstraints</b>(</code>name  <var class="pdparam">rastschema</var>, name  <var class="pdparam">rasttable</var>, name  <var class="pdparam">rastcolumn</var>, boolean  <var class="pdparam">srid=true</var>, boolean  <var class="pdparam">scale_x=true</var>, boolean  <var class="pdparam">scale_y=true</var>, boolean  <var class="pdparam">blocksize_x=true</var>, boolean  <var class="pdparam">blocksize_y=true</var>, boolean  <var class="pdparam">same_alignment=true</var>, boolean  <var class="pdparam">regular_blocking=false</var>, boolean  <var class="pdparam">num_bands=true</var>, boolean  <var class="pdparam">pixel_types=true</var>, boolean  <var class="pdparam">nodata_values=true</var>, boolean  <var class="pdparam">out_db=true</var> , boolean  <var class="pdparam">extent=true</var><code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">DropRasterConstraints</b>(</code>name  <var class="pdparam">rastschema</var>, name  <var class="pdparam">rasttable</var>, name  <var class="pdparam">rastcolumn</var>, text[]  <var class="pdparam">constraints</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp90561352"></a><h2>説明</h2><p><a class="xref" href="#RT_AddRasterConstraints" title="AddRasterConstraints">AddRasterConstraints</a>で追加された、ラスタテーブルカラムを参照するPostGISラスタ制約を削除します。データの追加ロードやラスタカラムデータの更新で使えます。ラスタテーブルまたはラスタカラムのridを取得したい場合には使う必要がありません。 </p><p>ラスタテーブルを削除するには、次の標準的なSQLを使います。 </p><pre class="programlisting">DROP TABLE mytable</pre><p>ラスタカラムを削除してテーブルの残りのカラムを置いておくには、次の標準的なSQLを使います。 </p><pre class="programlisting">ALTER TABLE mytable DROP COLUMN rast</pre><p>カラムまたはテーブルが削除されると、テーブルは<code class="varname">raster_columns</code>カタログから見えなくなります。しかしながら、制約だけが削除されたので、ラスタカラムはなお<code class="varname">raster_columns</code>カタログに残ります。ただし、カラム名とテーブルからの内部に関する他の情報は存在しません。</p><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp90565832"></a><h2>例</h2><pre class="programlisting">SELECT DropRasterConstraints ('myrasters','rast');
-- 結果出力 --
t

-- raster_columnsで変更を確認します --
SELECT srid, scale_x, scale_y, blocksize_x, blocksize_y, num_bands, pixel_types, nodata_values
        FROM raster_columns
        WHERE r_table_name = 'myrasters';

 srid | scale_x | scale_y | blocksize_x | blocksize_y | num_bands | pixel_types| nodata_values
------+---------+---------+-------------+-------------+-----------+-------------+---------------
    0 |         |         |             |             |           |             |
                </pre></div><div class="refsection"><a name="idp90567112"></a><h2>関連情報</h2><p><a class="xref" href="#RT_AddRasterConstraints" title="AddRasterConstraints">AddRasterConstraints</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_AddOverviewConstraints"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>AddOverviewConstraints — ラスタカラムに対して、他のオーバビューであることをタグ付けします。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">AddOverviewConstraints</b>(</code>name  <var class="pdparam">ovschema</var>, name  <var class="pdparam">ovtable</var>, name  <var class="pdparam">ovcolumn</var>, name  <var class="pdparam">refschema</var>, name  <var class="pdparam">reftable</var>, name  <var class="pdparam">refcolumn</var>, int  <var class="pdparam">ovfactor</var><code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">AddOverviewConstraints</b>(</code>name  <var class="pdparam">ovtable</var>, name  <var class="pdparam">ovcolumn</var>, name  <var class="pdparam">reftable</var>, name  <var class="pdparam">refcolumn</var>, int  <var class="pdparam">ovfactor</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp90585288"></a><h2>説明</h2><p><code class="varname">raster_overviews</code>ラスタカタログ内の情報を表示するために使われるラスタカラムに制約を追加します。 </p><p><code class="varname">ovfactor</code>引数は、オーバビューカラムの縮尺乗数を示します。縮尺乗数は大きいほど低い解像度になります。 </p><p><code class="varname">ovschema</code>と<code class="varname">refschema</code>が省略されると、<code class="varname">search_path</code>を走査して発見した最初のテーブルを使います。 </p><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp90589256"></a><h2>例</h2><pre class="programlisting">CREATE TABLE res1 AS SELECT
ST_AddBand(
  ST_MakeEmptyRaster(1000, 1000, 0, 0, 2),
  1, '8BSI'::text, -129, NULL
) r1;

CREATE TABLE res2 AS SELECT
ST_AddBand(
  ST_MakeEmptyRaster(500, 500, 0, 0, 4),
  1, '8BSI'::text, -129, NULL
) r2;

SELECT AddOverviewConstraints('res2', 'r2', 'res1', 'r1', 2);

-- raster_overviewsビューに正しく登録されたか確認します --
SELECT o_table_name ot, o_raster_column oc,
       r_table_name rt, r_raster_column rc,
       overview_factor f
FROM raster_overviews WHERE o_table_name = 'res2';
  ot  | oc |  rt  | rc | f
------+----+------+----+---
 res2 | r2 | res1 | r1 | 2
(1 row)
                </pre></div><div class="refsection"><a name="idp90590536"></a><h2>関連情報</h2><p><a class="xref" href="#RT_Raster_Overviews" title="5.2.2. ラスタオーバビュー">「ラスタオーバビュー」</a>, <a class="xref" href="#RT_DropOverviewConstraints" title="DropOverviewConstraints">DropOverviewConstraints</a>, <a class="xref" href="#RT_CreateOverview" title="ST_CreateOverview">ST_CreateOverview</a>, <a class="xref" href="#RT_AddRasterConstraints" title="AddRasterConstraints">AddRasterConstraints</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_DropOverviewConstraints"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>DropOverviewConstraints — ラスタカラムに対して他のオーバビューであることをタグ付けしているのを解除します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">DropOverviewConstraints</b>(</code>name  <var class="pdparam">ovschema</var>, name  <var class="pdparam">ovtable</var>, name  <var class="pdparam">ovcolumn</var><code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">DropOverviewConstraints</b>(</code>name  <var class="pdparam">ovtable</var>, name  <var class="pdparam">ovcolumn</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp90607048"></a><h2>説明</h2><p>ラスタカラムから、<code class="varname">raster_overviews</code>ラスタカタログ内にある、他のラスタのオーバビューであるこをと示すために使われる制約を削除します。 </p><p><code class="varname">ovschema</code>が省略されると、<code class="varname">search_path</code>を走査して発見した最初のテーブルを使います。 </p><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp90609992"></a><h2>関連情報</h2><p><a class="xref" href="#RT_Raster_Overviews" title="5.2.2. ラスタオーバビュー">「ラスタオーバビュー」</a>, <a class="xref" href="#RT_AddOverviewConstraints" title="AddOverviewConstraints">AddOverviewConstraints</a>, <a class="xref" href="#RT_DropRasterConstraints" title="DropRasterConstraints">DropRasterConstraints</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_PostGIS_GDAL_Version"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>PostGIS_GDAL_Version — PostGISで使っているGDALライブラリの版を報告します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">PostGIS_GDAL_Version</b>(</code><code>)</code>;</p></div></div><div class="refsection"><a name="idp90615880"></a><h2>説明</h2><p>PostGISで使っているGDALライブラリの版を報告します。GDALがデータファイルを発見できるかについてもチェックして、報告します。</p></div><div class="refsection"><a name="idp90617032"></a><h2>例</h2><pre class="programlisting">SELECT PostGIS_GDAL_Version();
       postgis_gdal_version
-----------------------------------
 GDAL 1.11dev, released 2013/04/13
                                </pre></div><div class="refsection"><a name="idp90618312"></a><h2>関連情報</h2><p>
					<a class="xref" href="#postgis_gdal_datapath" title="postgis.gdal_datapath">postgis.gdal_datapath</a>
				</p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_PostGIS_Raster_Lib_Build_Date"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>PostGIS_Raster_Lib_Build_Date — 完全なラスタライブラリをビルドした日付を報告します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">PostGIS_Raster_Lib_Build_Date</b>(</code><code>)</code>;</p></div></div><div class="refsection"><a name="idp90623560"></a><h2>説明</h2><p>ラスタをビルドした日付を報告します。</p></div><div class="refsection"><a name="idp90624712"></a><h2>例</h2><pre class="programlisting">SELECT PostGIS_Raster_Lib_Build_Date();
postgis_raster_lib_build_date
-----------------------------
2010-04-28 21:15:10
</pre></div><div class="refsection"><a name="idp90626120"></a><h2>関連情報</h2><p> <a class="xref" href="#RT_PostGIS_Raster_Lib_Version" title="PostGIS_Raster_Lib_Version">PostGIS_Raster_Lib_Version</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_PostGIS_Raster_Lib_Version"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>PostGIS_Raster_Lib_Version — 完全なラスタの版とビルドコンフィギュレーション情報を報告します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">PostGIS_Raster_Lib_Version</b>(</code><code>)</code>;</p></div></div><div class="refsection"><a name="idp90631240"></a><h2>説明</h2><p>完全なラスタの版とビルドコンフィギュレーション情報を報告します。</p></div><div class="refsection"><a name="idp90632392"></a><h2>例</h2><pre class="programlisting">SELECT PostGIS_Raster_Lib_Version();
postgis_raster_lib_version
-----------------------------
 2.0.0
</pre></div><div class="refsection"><a name="idp90633672"></a><h2>関連情報</h2><p> <a class="xref" href="#PostGIS_Lib_Version" title="PostGIS_Lib_Version">PostGIS_Lib_Version</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_GDALDrivers"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_GDALDrivers — 使用しているGDALライブラリが対応するラスタ書式の一覧を返します。この一覧でcan_write=TrueとなっているものだけがST_AsGDALRasterで使えます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">setof record <b class="fsfunc">ST_GDALDrivers</b>(</code>integer  <var class="pdparam">OUT idx</var>, text  <var class="pdparam">OUT short_name</var>, text  <var class="pdparam">OUT long_name</var>, text  <var class="pdparam">OUT can_read</var>, text  <var class="pdparam">OUT can_write</var>, text  <var class="pdparam">OUT create_options</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp90656968"></a><h2>説明</h2><p>使用しているGDALライブラリが対応するラスタ書式のshort_name, long_nameと作成オプションの一覧を返します。short_nameは、<a class="xref" href="#RT_ST_AsGDALRaster" title="ST_AsGDALRaster">ST_AsGDALRaster</a>の<code class="varname">format</code>パラメタに使います。オプションはGDALライブラリのコンパイルに使ったドライバに依存します。<code class="varname">create_options</code>は、XML形式のCretionOptionList/Optionの集合で、ドライバごとの生成オプションごとに、名前を持ち、追加情報の<code class="varname">type</code>, <code class="varname">description</code>と<code class="varname">VALUE</code>の集合を持ちます。 </p><p>Changed: 2.5.0 - can_readカラムとcan_writeカラムを追加</p><p>Changed: 2.0.6, 2.1.3 - GUC (訳注: Grand Unified Configurationの略で、動的に変更できるPostgreSQLパラメータ)または環境変数gdal_enabled_driversが設定されていないデフォルトではドライバが全て無効になりました。</p><p>Availability: 2.0.0 - GDAL 1.6.0以上が必要です。 </p></div><div class="refsection"><a name="idp90661704"></a><h2>例: ドライバ一覧</h2><pre class="programlisting">SET postgis.gdal_enabled_drivers = 'ENABLE_ALL';
SELECT short_name, long_name, can_write
FROM st_gdaldrivers()
ORDER BY short_name;

   short_name    |                          long_name                          | can_write
-----------------+-------------------------------------------------------------+-----------
 AAIGrid         | Arc/Info ASCII Grid                                         | t
 ACE2            | ACE2                                                        | f
 ADRG            | ARC Digitized Raster Graphics                               | f
 AIG             | Arc/Info Binary Grid                                        | f
 AirSAR          | AirSAR Polarimetric Image                                   | f
 ARG             | Azavea Raster Grid format                                   | t
 BAG             | Bathymetry Attributed Grid                                  | f
 BIGGIF          | Graphics Interchange Format (.gif)                          | f
 BLX             | Magellan topo (.blx)                                        | t
 BMP             | MS Windows Device Independent Bitmap                        | f
 BSB             | Maptech BSB Nautical Charts                                 | f
 PAux            | PCI .aux Labelled                                           | f
 PCIDSK          | PCIDSK Database File                                        | f
 PCRaster        | PCRaster Raster File                                        | f
 PDF             | Geospatial PDF                                              | f
 PDS             | NASA Planetary Data System                                  | f
 PDS4            | NASA Planetary Data System 4                                | t
 PLMOSAIC        | Planet Labs Mosaics API                                     | f
 PLSCENES        | Planet Labs Scenes API                                      | f
 PNG             | Portable Network Graphics                                   | t
 PNM             | Portable Pixmap Format (netpbm)                             | f
 PRF             | Racurs PHOTOMOD PRF                                         | f
 R               | R Object Data Store                                         | t
 Rasterlite      | Rasterlite                                                  | t
 RDA             | DigitalGlobe Raster Data Access driver                      | f
 RIK             | Swedish Grid RIK (.rik)                                     | f
 RMF             | Raster Matrix Format                                        | f
 ROI_PAC         | ROI_PAC raster                                              | f
 RPFTOC          | Raster Product Format TOC format                            | f
 RRASTER         | R Raster                                                    | f
 RS2             | RadarSat 2 XML Product                                      | f
 RST             | Idrisi Raster A.1                                           | t
 SAFE            | Sentinel-1 SAR SAFE Product                                 | f
 SAGA            | SAGA GIS Binary Grid (.sdat, .sg-grd-z)                     | t
 SAR_CEOS        | CEOS SAR Image                                              | f
 SDTS            | SDTS Raster                                                 | f
 SENTINEL2       | Sentinel 2                                                  | f
 SGI             | SGI Image File Format 1.0                                   | f
 SNODAS          | Snow Data Assimilation System                               | f
 SRP             | Standard Raster Product (ASRP/USRP)                         | f
 SRTMHGT         | SRTMHGT File Format                                         | t
 Terragen        | Terragen heightfield                                        | f
 TIL             | EarthWatch .TIL                                             | f
 TSX             | TerraSAR-X Product                                          | f
 USGSDEM         | USGS Optional ASCII DEM (and CDED)                          | t
 VICAR           | MIPL VICAR file                                             | f
 VRT             | Virtual Raster                                              | t
 WCS             | OGC Web Coverage Service                                    | f
 WMS             | OGC Web Map Service                                         | t
 WMTS            | OGC Web Map Tile Service                                    | t
 XPM             | X11 PixMap Format                                           | t
 XYZ             | ASCII Gridded XYZ                                           | t
 ZMap            | ZMap Plus Grid                                              | t
</pre></div><div class="refsection"><a name="idp90662984"></a><h2>例: ドライバ毎のオプション一覧</h2><pre class="programlisting">-- JPEGのXMLカラムから生成オプションをテーブルとして出力します --
-- この生成オプションはST_AsGDALRasterのオプション引数で使えます --
SELECT (xpath('@name', g.opt))[1]::text As oname,
       (xpath('@type', g.opt))[1]::text As otype,
       (xpath('@description', g.opt))[1]::text As descrip
FROM (SELECT unnest(xpath('/CreationOptionList/Option', create_options::xml)) As opt
FROM  st_gdaldrivers()
WHERE short_name = 'JPEG') As g;

       oname        |  otype  |      descrip
--------------------+---------+-------------------------------------------------
 PROGRESSIVE        | boolean | whether to generate a progressive JPEG
 QUALITY            | int     | good=100, bad=0, default=75
 WORLDFILE          | boolean | whether to geneate a worldfile
 INTERNAL_MASK      | boolean | whether to generate a validity mask
 COMMENT            | string  | Comment
 SOURCE_ICC_PROFILE | string  | ICC profile encoded in Base64
 EXIF_THUMBNAIL     | boolean | whether to generate an EXIF thumbnail(overview).
                                By default its max dimension will be 128
 THUMBNAIL_WIDTH    | int     | Forced thumbnail width
 THUMBNAIL_HEIGHT   | int     | Forced thumbnail height
(9 rows)
</pre><pre class="programlisting">-- GeoTIFFの生成オプションを生のXMLで出力します --
SELECT create_options
FROM st_gdaldrivers()
WHERE short_name = 'GTiff';

&lt;CreationOptionList&gt;
    &lt;Option name="COMPRESS" type="string-select"&gt;
        &lt;Value
&gt;NONE&lt;/Value&gt;
        &lt;Value
&gt;LZW&lt;/Value&gt;
        &lt;Value
&gt;PACKBITS&lt;/Value&gt;
        &lt;Value
&gt;JPEG&lt;/Value&gt;
        &lt;Value
&gt;CCITTRLE&lt;/Value&gt;
        &lt;Value
&gt;CCITTFAX3&lt;/Value&gt;
        &lt;Value
&gt;CCITTFAX4&lt;/Value&gt;
        &lt;Value
&gt;DEFLATE&lt;/Value&gt;
    &lt;/Option&gt;
    &lt;Option name="PREDICTOR" type="int" description="Predictor Type"/&gt;
    &lt;Option name="JPEG_QUALITY" type="int" description="JPEG quality 1-100" default="75"/&gt;
    &lt;Option name="ZLEVEL" type="int" description="DEFLATE compression level 1-9" default="6"/&gt;
    &lt;Option name="NBITS" type="int" description="BITS for sub-byte files (1-7), sub-uint16 (9-15), sub-uint32 (17-31)"/&gt;
    &lt;Option name="INTERLEAVE" type="string-select" default="PIXEL"&gt;
        &lt;Value
&gt;BAND&lt;/Value&gt;
        &lt;Value
&gt;PIXEL&lt;/Value&gt;
    &lt;/Option&gt;
    &lt;Option name="TILED" type="boolean" description="Switch to tiled format"/&gt;
    &lt;Option name="TFW" type="boolean" description="Write out world file"/&gt;
    &lt;Option name="RPB" type="boolean" description="Write out .RPB (RPC) file"/&gt;
    &lt;Option name="BLOCKXSIZE" type="int" description="Tile Width"/&gt;
    &lt;Option name="BLOCKYSIZE" type="int" description="Tile/Strip Height"/&gt;
    &lt;Option name="PHOTOMETRIC" type="string-select"&gt;
        &lt;Value
&gt;MINISBLACK&lt;/Value&gt;
        &lt;Value
&gt;MINISWHITE&lt;/Value&gt;
        &lt;Value
&gt;PALETTE&lt;/Value&gt;
        &lt;Value
&gt;RGB&lt;/Value&gt;
        &lt;Value
&gt;CMYK&lt;/Value&gt;
        &lt;Value
&gt;YCBCR&lt;/Value&gt;
        &lt;Value
&gt;CIELAB&lt;/Value&gt;
        &lt;Value
&gt;ICCLAB&lt;/Value&gt;
        &lt;Value
&gt;ITULAB&lt;/Value&gt;
    &lt;/Option&gt;
    &lt;Option name="SPARSE_OK" type="boolean" description="Can newly created files have missing blocks?" default="FALSE"/&gt;
    &lt;Option name="ALPHA" type="boolean" description="Mark first extrasample as being alpha"/&gt;
    &lt;Option name="PROFILE" type="string-select" default="GDALGeoTIFF"&gt;
        &lt;Value
&gt;GDALGeoTIFF&lt;/Value&gt;
        &lt;Value
&gt;GeoTIFF&lt;/Value&gt;
        &lt;Value
&gt;BASELINE&lt;/Value&gt;
    &lt;/Option&gt;
    &lt;Option name="PIXELTYPE" type="string-select"&gt;
        &lt;Value
&gt;DEFAULT&lt;/Value&gt;
        &lt;Value
&gt;SIGNEDBYTE&lt;/Value&gt;
    &lt;/Option&gt;
    &lt;Option name="BIGTIFF" type="string-select" description="Force creation of BigTIFF file"&gt;
        &lt;Value
&gt;YES&lt;/Value&gt;
        &lt;Value
&gt;NO&lt;/Value&gt;
        &lt;Value
&gt;IF_NEEDED&lt;/Value&gt;
        &lt;Value
&gt;IF_SAFER&lt;/Value&gt;
    &lt;/Option&gt;
    &lt;Option name="ENDIANNESS" type="string-select" default="NATIVE" description="Force endianness of created file. For DEBUG purpose mostly"&gt;
        &lt;Value
&gt;NATIVE&lt;/Value&gt;
        &lt;Value
&gt;INVERTED&lt;/Value&gt;
        &lt;Value
&gt;LITTLE&lt;/Value&gt;
        &lt;Value
&gt;BIG&lt;/Value&gt;
    &lt;/Option&gt;
    &lt;Option name="COPY_SRC_OVERVIEWS" type="boolean" default="NO" description="Force copy of overviews of source dataset (CreateCopy())"/&gt;
&lt;/CreationOptionList
&gt;

-- GeoTIFF生成オプションのXMLをテーブルとして出力します --
-- Output the create options XML column for GTiff as a table  --
SELECT (xpath('@name', g.opt))[1]::text As oname,
       (xpath('@type', g.opt))[1]::text As otype,
       (xpath('@description', g.opt))[1]::text As descrip,
       array_to_string(xpath('Value/text()', g.opt),', ') As vals
FROM (SELECT unnest(xpath('/CreationOptionList/Option', create_options::xml)) As opt
FROM  st_gdaldrivers()
WHERE short_name = 'GTiff') As g;

       oname        |     otype     |                               descrip                                |                                   vals
--------------------+---------------+----------------------------------------------------------------------+---------------------------------------------------------------------------
 COMPRESS           | string-select |                                                                      | NONE, LZW, PACKBITS, JPEG, CCITTRLE, CCITTFAX3, CCITTFAX4, DEFLATE
 PREDICTOR          | int           | Predictor Type                                                       |
 JPEG_QUALITY       | int           | JPEG quality 1-100                                                   |
 ZLEVEL             | int           | DEFLATE compression level 1-9                                        |
 NBITS              | int           | BITS for sub-byte files (1-7), sub-uint16 (9-15), sub-uint32 (17-31) |
 INTERLEAVE         | string-select |                                                                      | BAND, PIXEL
 TILED              | boolean       | Switch to tiled format                                               |
 TFW                | boolean       | Write out world file                                                 |
 RPB                | boolean       | Write out .RPB (RPC) file                                            |
 BLOCKXSIZE         | int           | Tile Width                                                           |
 BLOCKYSIZE         | int           | Tile/Strip Height                                                    |
 PHOTOMETRIC        | string-select |                                                                      | MINISBLACK, MINISWHITE, PALETTE, RGB, CMYK, YCBCR, CIELAB, ICCLAB, ITULAB
 SPARSE_OK          | boolean       | Can newly created files have missing blocks?                         |
 ALPHA              | boolean       | Mark first extrasample as being alpha                                |
 PROFILE            | string-select |                                                                      | GDALGeoTIFF, GeoTIFF, BASELINE
 PIXELTYPE          | string-select |                                                                      | DEFAULT, SIGNEDBYTE
 BIGTIFF            | string-select | Force creation of BigTIFF file                                       | YES, NO, IF_NEEDED, IF_SAFER
 ENDIANNESS         | string-select | Force endianness of created file. For DEBUG purpose mostly           | NATIVE, INVERTED, LITTLE, BIG
 COPY_SRC_OVERVIEWS | boolean       | Force copy of overviews of source dataset (CreateCopy())             |
(19 rows)
</pre></div><div class="refsection"><a name="idp90664648"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_AsGDALRaster" title="ST_AsGDALRaster">ST_AsGDALRaster</a>, <a class="xref" href="#ST_SRID" title="ST_SRID">ST_SRID</a>, <a class="xref" href="#postgis_gdal_enabled_drivers" title="postgis.gdal_enabled_drivers">postgis.gdal_enabled_drivers</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_UpdateRasterSRID"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>UpdateRasterSRID — ユーザが指定したカラムとテーブルにあるラスタの全てについてSRIDを変更します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">UpdateRasterSRID</b>(</code>name  <var class="pdparam">schema_name</var>, name  <var class="pdparam">table_name</var>, name  <var class="pdparam">column_name</var>, integer  <var class="pdparam">new_srid</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">UpdateRasterSRID</b>(</code>name  <var class="pdparam">table_name</var>, name  <var class="pdparam">column_name</var>, integer  <var class="pdparam">new_srid</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp90760648"></a><h2>説明</h2><p>ユーザが指定したカラムとテーブルにあるラスタの全てについてSRIDを変更します。この関数は全ての適切なカラム制約 (extent, alignment, SRID)を削除してから、指定したカラムのラスタのSRIDを変更します。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はラスタのデータ (バンドピクセル値)を触りません。ラスタのメタデータのみ変更します。 </p></td></tr></table></div><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp90762952"></a><h2>関連情報</h2><p>
          <a class="xref" href="#UpdateGeometrySRID" title="UpdateGeometrySRID">UpdateGeometrySRID</a>
        </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_CreateOverview"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_CreateOverview — 与えられたラスタカバレッジから解像度を落としたものを生成します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">regclass <b class="fsfunc">ST_CreateOverview</b>(</code>regclass  <var class="pdparam">tab</var>, name  <var class="pdparam">col</var>, int  <var class="pdparam">factor</var>, text  <var class="pdparam">algo='NearestNeighbor'</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp90772168"></a><h2>説明</h2><p>元のテーブルからリサンプリングを施したタイルのオーバビューテーブルを生成します。出力タイルは入力タイルと同じサイズで、同じ空間範囲を持ち、入力タイルより低い解像度 (ピクセル数は縦横ともに元のタイルの1/<code class="varname">factor</code>倍になります)を持ちます。 </p><p>オーバビューテーブルは<code class="varname">raster_overviews</code>カタログに出現し、ラスタ制約を持ちます。 </p><p>アルゴリズム指定オプションは'NearestNeighbor', 'Bilinear', 'Cubic', 'CubicSpline', 'Lanczos'です。詳細については<a class="ulink" href="http://www.gdal.org/gdalwarp.html" target="_top">GDAL Warp resampling methods</a>をご覧ください。</p><p>Availability: 2.2.0</p></div><div class="refsection"><a name="idp90775752"></a><h2>例</h2><p>高品質ですが遅い生成書式での出力</p><pre class="programlisting">SELECT ST_CreateOverview('mydata.mytable'::regclass, 'rast', 2, 'Lanczos');</pre><p>デフォルトの最近傍補間を使った早い処理による出力</p><pre class="programlisting">SELECT ST_CreateOverview('mydata.mytable'::regclass, 'rast', 2);</pre></div><div class="refsection"><a name="idp90778184"></a><h2>関連情報</h2><p><a class="xref" href="#RT_Retile" title="ST_Retile">ST_Retile</a>, <a class="xref" href="#RT_AddOverviewConstraints" title="AddOverviewConstraints">AddOverviewConstraints</a>, <a class="xref" href="#RT_AddRasterConstraints" title="AddRasterConstraints">AddRasterConstraints</a>, <a class="xref" href="#RT_Raster_Overviews" title="5.2.2. ラスタオーバビュー">「ラスタオーバビュー」</a> </p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Raster_Constructors"></a>9.3. ラスタコンストラクタ</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#RT_ST_AddBand">ST_AddBand</a></span><span class="refpurpose"> — 与えられたタイプで、与えられた初期値にした新しいバンドを、与えられたインデクス位置に追加したラスタを返します。インデクス位置を指定していない場合には、バンドは末尾に追加されます。 </span></dt><dt><span class="refentrytitle"><a href="#RT_ST_AsRaster">ST_AsRaster</a></span><span class="refpurpose"> — PostGISジオメトリをPostGISラスタに変換します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Band">ST_Band</a></span><span class="refpurpose"> — 既存のラスタの、一つ以上のバンドを新しいラスタとして返します。既存のラスタから新しいラスタを構築する際に使えます。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_MakeEmptyCoverage">ST_MakeEmptyCoverage</a></span><span class="refpurpose"> — 空のラスタタイルのグリッドでジオリファレンスを施されている領域を生成します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_MakeEmptyRaster">ST_MakeEmptyRaster</a></span><span class="refpurpose"> — 与えられたピクセル範囲 (width &amp; height)、左上のX,Y、ピクセルサイズ、回転 (scalex, scaley, skewx, skewy)と空間参照系 (srid)が指定された空ラスタ (バンドを持たないラスタ)を返します。ラスタが渡されると、新しいラスタは渡されたラスタと同じサイズ、アラインメント、SRIDになります。SRIDが指定されていない場合には、空間参照系は不明 (0)とされます。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Tile">ST_Tile</a></span><span class="refpurpose"> — 求められた出力ラスタのピクセル数に基づいて入力ラスタを分割した結果のラスタ集合を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_Retile">ST_Retile</a></span><span class="refpurpose"> — 任意のタイル化されたラスタカバレッジから構成されたタイルの集合を返します。 </span></dt><dt><span class="refentrytitle"><a href="#RT_ST_FromGDALRaster">ST_FromGDALRaster</a></span><span class="refpurpose"> — 対応するGDALラスタファイルからラスタを返します。</span></dt></dl></div><div class="refentry"><a name="RT_ST_AddBand"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AddBand — 与えられたタイプで、与えられた初期値にした新しいバンドを、与えられたインデクス位置に追加したラスタを返します。インデクス位置を指定していない場合には、バンドは末尾に追加されます。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">(1) raster <b class="fsfunc">ST_AddBand</b>(</code>raster  <var class="pdparam">rast</var>, addbandarg[]  <var class="pdparam">addbandargset</var><code>)</code>;</p><p><code class="funcdef">(2) raster <b class="fsfunc">ST_AddBand</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">index</var>, text  <var class="pdparam">pixeltype</var>, double precision  <var class="pdparam">initialvalue=0</var>, double precision  <var class="pdparam">nodataval=NULL</var><code>)</code>;</p><p><code class="funcdef">(3) raster <b class="fsfunc">ST_AddBand</b>(</code>raster  <var class="pdparam">rast</var>, text  <var class="pdparam">pixeltype</var>, double precision  <var class="pdparam">initialvalue=0</var>, double precision  <var class="pdparam">nodataval=NULL</var><code>)</code>;</p><p><code class="funcdef">(4) raster <b class="fsfunc">ST_AddBand</b>(</code>raster  <var class="pdparam">torast</var>, raster  <var class="pdparam">fromrast</var>, integer  <var class="pdparam">fromband=1</var>, integer  <var class="pdparam">torastindex=at_end</var><code>)</code>;</p><p><code class="funcdef">(5) raster <b class="fsfunc">ST_AddBand</b>(</code>raster  <var class="pdparam">torast</var>, raster[]  <var class="pdparam">fromrasts</var>, integer  <var class="pdparam">fromband=1</var>, integer  <var class="pdparam">torastindex=at_end</var><code>)</code>;</p><p><code class="funcdef">(6) raster <b class="fsfunc">ST_AddBand</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">index</var>, text  <var class="pdparam">outdbfile</var>, integer[]  <var class="pdparam">outdbindex</var>, double precision  <var class="pdparam">nodataval=NULL</var><code>)</code>;</p><p><code class="funcdef">(7) raster <b class="fsfunc">ST_AddBand</b>(</code>raster  <var class="pdparam">rast</var>, text  <var class="pdparam">outdbfile</var>, integer[]  <var class="pdparam">outdbindex</var>, integer  <var class="pdparam">index=at_end</var>, double precision  <var class="pdparam">nodataval=NULL</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp90823112"></a><h2>説明</h2><p>与えられたタイプで、与えられた初期値にし、与えられたNODATA値を付した新しいバンドを追加したラスタを返します。インデクス位置を指定していない場合には、バンドは末尾に追加されます。<code class="varname">fromband</code>が指定されない場合には、1番バンドと仮定します。ピクセルタイプは<a class="xref" href="#RT_ST_BandPixelType" title="ST_BandPixelType">ST_BandPixelType</a>で指定されているピクセルタイプの文字列表現です。既存のインデクスが指定された場合には、以降のバンドは全て1以上足されたインデクスになります。初期値としてピクセルタイプの最大値を超えた値が指定された場合には、初期値にピクセルタイプの許容最大値が指定されます。 </p><p><a class="xref" href="#addbandarg" title="addbandarg">addbandarg</a>の配列を取る版 (一つ目の版)では、指定したaddbandargのインデクス値は、addbandargで示されるバンドがラスタに追加される時のラスタとの相対値です。下の複数バンドの例を参照してください。 </p><p>ラスタの配列を取る版 (五つ目の版)では、<code class="varname">torast</code>がNULLなら、配列内のラスタごとの<code class="varname">fromband</code>のバンドが新しいラスタに集約されます。 </p><p><code class="varname">outdbfile</code>を取る版 (六つ目と七つ目の版)では、値はラスタファイルへのフルパスを含まなければなりません。また、ファイルはPostgreSQLサーバプロセスがアクセス可能でなければなりません。 </p><p>Enhanced: 2.1.0 addbandarg対応が追加されました。</p><p>Enhanced: 2.1.0 out-dbバンドが追加されました。</p></div><div class="refsection"><a name="idp90828488"></a><h2>例: 単一バンド</h2><pre class="programlisting">-- 8ビット符号無し整数で初期値200のバンドを追加します
UPDATE dummy_rast
    SET rast = ST_AddBand(rast,'8BUI'::text,200)
WHERE rid = 1;
                                </pre><pre class="programlisting">-- 100x100単位で左上を0,0とした空のラスタを生成し、
-- 2個のバンドを追加します (1番バンドは0/1の真偽値、2番バンドは0-15を許容)
-- addbandargsを使用しています。
INSERT INTO dummy_rast(rid,rast)
    VALUES(10, ST_AddBand(ST_MakeEmptyRaster(100, 100, 0, 0, 1, -1, 0, 0, 0),
        ARRAY[
                ROW(1, '1BB'::text, 0, NULL),
                ROW(2, '4BUI'::text, 0, NULL)
                        ]::addbandarg[]
     )
    );

-- output meta data of raster bands to verify all is right --
SELECT  (bmd).*
FROM (SELECT ST_BandMetaData(rast,generate_series(1,2)) As bmd
    FROM dummy_rast WHERE rid = 10) AS foo;
 --result --
 pixeltype | nodatavalue | isoutdb | path
-----------+----------------+-------------+---------+------
 1BB       |             | f       |
 4BUI      |             | f       |


-- ラスタのメタデータの出力 --
SELECT  (rmd).width, (rmd).height, (rmd).numbands
FROM (SELECT ST_MetaData(rast) As rmd
    FROM dummy_rast WHERE rid = 10) AS foo;
-- 結果 --
 upperleftx | upperlefty | width | height | scalex | scaley | skewx | skewy | srid | numbands
------------+------------+-------+--------+------------+------------+-------+-------+------+----------
          0 |          0 |   100 |    100 |      1 |     -1 |     0 |     0 |   0 |        2
                                </pre></div><div class="refsection"><a name="idp90830280"></a><h2>例: 複数の新規バンド</h2><pre class="programlisting">SELECT
        *
FROM ST_BandMetadata(
        ST_AddBand(
                ST_MakeEmptyRaster(10, 10, 0, 0, 1, -1, 0, 0, 0),
                ARRAY[
                        ROW(NULL, '8BUI', 255, 0),
                        ROW(NULL, '16BUI', 1, 2),
                        ROW(2, '32BUI', 100, 12),
                        ROW(2, '32BF', 3.14, -1)
                ]::addbandarg[]
        ),
        ARRAY[]::integer[]
);

 bandnum | pixeltype | nodatavalue | isoutdb | path
---------+-----------+-------------+---------+------
       1 | 8BUI      |           0 | f       |
       2 | 32BF      |          -1 | f       |
       3 | 32BUI     |          12 | f       |
       4 | 16BUI     |           2 | f       |
                                </pre><pre class="programlisting">-- 複数のラスタのようなテーブルの1番バンドを集計して単一ラスタに入れます。
-- test_typeと同じ数のバンドを持つ、マウスの数と同じ行 (新しいラスタ)になります。
-- ご注意: ORDER BY test_typeは、PostgreSQL 9.0以上でのみ対応します。
-- 8.4以下では副問い合わせ内の並び順になります (保証もされません)。
-- 結果ラスタはtest_typeのアルファベット順でtest_typeごとのバンドを持ちます
-- マウス好きの方へ: この例ではマウスは傷つきませんでした
SELECT
        mouse,
        ST_AddBand(NULL, array_agg(rast ORDER BY test_type), 1) As rast
FROM mice_studies
GROUP BY mouse;
                                </pre></div><div class="refsection"><a name="idp90832072"></a><h2>例: データベース外のバンド</h2><pre class="programlisting">SELECT
        *
FROM ST_BandMetadata(
        ST_AddBand(
                ST_MakeEmptyRaster(10, 10, 0, 0, 1, -1, 0, 0, 0),
                '/home/raster/mytestraster.tif'::text, NULL::int[]
        ),
        ARRAY[]::integer[]
);

 bandnum | pixeltype | nodatavalue | isoutdb | path
---------+-----------+-------------+---------+------
       1 | 8BUI      |             | t       | /home/raster/mytestraster.tif
       2 | 8BUI      |             | t       | /home/raster/mytestraster.tif
       3 | 8BUI      |             | t       | /home/raster/mytestraster.tif
                                </pre></div><div class="refsection"><a name="idp90833352"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_BandMetaData" title="ST_BandMetaData">ST_BandMetaData</a>, <a class="xref" href="#RT_ST_BandPixelType" title="ST_BandPixelType">ST_BandPixelType</a>, <a class="xref" href="#RT_ST_MakeEmptyRaster" title="ST_MakeEmptyRaster">ST_MakeEmptyRaster</a>, <a class="xref" href="#RT_ST_MetaData" title="ST_MetaData">ST_MetaData</a>, <a class="xref" href="#RT_ST_NumBands" title="ST_NumBands">ST_NumBands</a>, <a class="xref" href="#RT_ST_Reclass" title="ST_Reclass">ST_Reclass</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_AsRaster"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsRaster — PostGISジオメトリをPostGISラスタに変換します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_AsRaster</b>(</code>geometry  <var class="pdparam">geom</var>, raster  <var class="pdparam">ref</var>, text  <var class="pdparam">pixeltype</var>, double precision  <var class="pdparam">value=1</var>, double precision  <var class="pdparam">nodataval=0</var>, boolean  <var class="pdparam">touched=false</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_AsRaster</b>(</code>geometry  <var class="pdparam">geom</var>, raster  <var class="pdparam">ref</var>, text[]  <var class="pdparam">pixeltype=ARRAY['8BUI']</var>, double precision[]  <var class="pdparam">value=ARRAY[1]</var>, double precision[]  <var class="pdparam">nodataval=ARRAY[0]</var>, boolean  <var class="pdparam">touched=false</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_AsRaster</b>(</code>geometry  <var class="pdparam">geom</var>, double precision  <var class="pdparam">scalex</var>, double precision  <var class="pdparam">scaley</var>, double precision  <var class="pdparam">gridx</var>, double precision  <var class="pdparam">gridy</var>, text  <var class="pdparam">pixeltype</var>, double precision  <var class="pdparam">value=1</var>, double precision  <var class="pdparam">nodataval=0</var>, double precision  <var class="pdparam">skewx=0</var>, double precision  <var class="pdparam">skewy=0</var>, boolean  <var class="pdparam">touched=false</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_AsRaster</b>(</code>geometry  <var class="pdparam">geom</var>, double precision  <var class="pdparam">scalex</var>, double precision  <var class="pdparam">scaley</var>, double precision  <var class="pdparam">gridx=NULL</var>, double precision  <var class="pdparam">gridy=NULL</var>, text[]  <var class="pdparam">pixeltype=ARRAY['8BUI']</var>, double precision[]  <var class="pdparam">value=ARRAY[1]</var>, double precision[]  <var class="pdparam">nodataval=ARRAY[0]</var>, double precision  <var class="pdparam">skewx=0</var>, double precision  <var class="pdparam">skewy=0</var>, boolean  <var class="pdparam">touched=false</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_AsRaster</b>(</code>geometry  <var class="pdparam">geom</var>, double precision  <var class="pdparam">scalex</var>, double precision  <var class="pdparam">scaley</var>, text  <var class="pdparam">pixeltype</var>, double precision  <var class="pdparam">value=1</var>, double precision  <var class="pdparam">nodataval=0</var>, double precision  <var class="pdparam">upperleftx=NULL</var>, double precision  <var class="pdparam">upperlefty=NULL</var>, double precision  <var class="pdparam">skewx=0</var>, double precision  <var class="pdparam">skewy=0</var>, boolean  <var class="pdparam">touched=false</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_AsRaster</b>(</code>geometry  <var class="pdparam">geom</var>, double precision  <var class="pdparam">scalex</var>, double precision  <var class="pdparam">scaley</var>, text[]  <var class="pdparam">pixeltype</var>, double precision[]  <var class="pdparam">value=ARRAY[1]</var>, double precision[]  <var class="pdparam">nodataval=ARRAY[0]</var>, double precision  <var class="pdparam">upperleftx=NULL</var>, double precision  <var class="pdparam">upperlefty=NULL</var>, double precision  <var class="pdparam">skewx=0</var>, double precision  <var class="pdparam">skewy=0</var>, boolean  <var class="pdparam">touched=false</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_AsRaster</b>(</code>geometry  <var class="pdparam">geom</var>, integer  <var class="pdparam">width</var>, integer  <var class="pdparam">height</var>, double precision  <var class="pdparam">gridx</var>, double precision  <var class="pdparam">gridy</var>, text  <var class="pdparam">pixeltype</var>, double precision  <var class="pdparam">value=1</var>, double precision  <var class="pdparam">nodataval=0</var>, double precision  <var class="pdparam">skewx=0</var>, double precision  <var class="pdparam">skewy=0</var>, boolean  <var class="pdparam">touched=false</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_AsRaster</b>(</code>geometry  <var class="pdparam">geom</var>, integer  <var class="pdparam">width</var>, integer  <var class="pdparam">height</var>, double precision  <var class="pdparam">gridx=NULL</var>, double precision  <var class="pdparam">gridy=NULL</var>, text[]  <var class="pdparam">pixeltype=ARRAY['8BUI']</var>, double precision[]  <var class="pdparam">value=ARRAY[1]</var>, double precision[]  <var class="pdparam">nodataval=ARRAY[0]</var>, double precision  <var class="pdparam">skewx=0</var>, double precision  <var class="pdparam">skewy=0</var>, boolean  <var class="pdparam">touched=false</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_AsRaster</b>(</code>geometry  <var class="pdparam">geom</var>, integer  <var class="pdparam">width</var>, integer  <var class="pdparam">height</var>, text  <var class="pdparam">pixeltype</var>, double precision  <var class="pdparam">value=1</var>, double precision  <var class="pdparam">nodataval=0</var>, double precision  <var class="pdparam">upperleftx=NULL</var>, double precision  <var class="pdparam">upperlefty=NULL</var>, double precision  <var class="pdparam">skewx=0</var>, double precision  <var class="pdparam">skewy=0</var>, boolean  <var class="pdparam">touched=false</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_AsRaster</b>(</code>geometry  <var class="pdparam">geom</var>, integer  <var class="pdparam">width</var>, integer  <var class="pdparam">height</var>, text[]  <var class="pdparam">pixeltype</var>, double precision[]  <var class="pdparam">value=ARRAY[1]</var>, double precision[]  <var class="pdparam">nodataval=ARRAY[0]</var>, double precision  <var class="pdparam">upperleftx=NULL</var>, double precision  <var class="pdparam">upperlefty=NULL</var>, double precision  <var class="pdparam">skewx=0</var>, double precision  <var class="pdparam">skewy=0</var>, boolean  <var class="pdparam">touched=false</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp90989128"></a><h2>説明</h2><p>PostGISジオメトリをPostGISラスタに変換します。多数の形式がありますが、結果ラスタのアラインメントとピクセルサイズを設定する三つの考えられる類型に分かれます。</p><p>一つ目の群は、最初の2形式です。 アラインメント (<code class="varname">scalex</code>, <code class="varname">scaley</code>, <code class="varname">gridx</code>, <code class="varname">gridy</code>)、ピクセルタイプ、NODATA値が提供される参照ラスタと同じとなるラスタを生成します。一般的にこの参照ラスタは、ジオメトリを含むテーブルを参照ラスタを含むテーブルに結合して渡します。</p><p>二つ目の群は、4形式あります。ピクセルサイズ (<code class="varname">scalex</code> &amp; <code class="varname">scaley</code>と<code class="varname">skewx</code> &amp; <code class="varname">skewy</code>)の引数を渡してラスタのピクセル範囲を設定します。結果ラスタの<code class="varname">width</code> &amp; <code class="varname">height</code>はジオメトリの範囲にあわせて調整されます。ほとんどの場合、PostgreSQLが正しい形式を選択するために、<code class="varname">scalex</code> &amp; <code class="varname">scaley</code>の整数引数を倍精度浮動小数点数にキャストしなければなりません。</p><p>三つ目の群は、4形式あります。ラスタのピクセル範囲 (<code class="varname">width</code> &amp; <code class="varname">height</code>)を渡してラスタのピクセル範囲を固定するものです。結果ラスタのピクセルサイズ(<code class="varname">scalex</code> &amp; <code class="varname">scaley</code>と<code class="varname">skewx</code> &amp; <code class="varname">skewy</code>)の引数はジオメトリの範囲にあわせて調整されます。</p><p>二つ目の群と三つ目の群の群内前半2形式は、アラインメントグリッド (<code class="varname">gridx</code> &amp; <code class="varname">gridy</code>)の適切な隅でアラインメントを特定します。群内後半2形式は左上隅 (<code class="varname">upperleftx</code> &amp; <code class="varname">upperlefty</code>)を取ります。</p><p>これらの群のそれぞれによって、1バンドまたは複数バンドのラスタを生成することができます。複数バンドのラスタを生成するには、ピクセルタイプ配列 (<code class="varname">pixeltype[]</code>)、初期値配列 (<code class="varname">value</code>)、NODATA値配列 (<code class="varname">nodataval</code>)を渡す必要があります。ピクセルタイプが渡されていない場合には、デフォルトは8BUIになり、初期値については1、NODATA値については0になります。</p><p>出力ラスタは元のジオメトリと同じ空間参照系になります。参照ラスタを使う形式は例外で、結果ラスタは参照ラスタと同じSRIDになります。</p><p>任意引数<code class="varname">touched</code>は、デフォルトではFALSEになります。GDALのALL_TOUCHEDラスタ化オプションに相当し、ラインまたはポリゴンに接触するピクセルが描画されます。ライン上にあるか中心点がポリゴン内部にあるピクセルが描画されるだけではありません。</p><p>これは特にジオメトリをデータベースから<a class="xref" href="#RT_ST_AsPNG" title="ST_AsPNG">ST_AsPNG</a>や<a class="xref" href="#RT_ST_AsGDALRaster" title="ST_AsGDALRaster">ST_AsGDALRaster</a>系の関数を併用して直接JPEGやPNGに描画する際に使えます。</p><p>Availability: 2.0.0 - GDAL 1.6.0以上が必要です。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>曲線、TIN、多面体サーフェスのような複雑なジオメトリタイプのレンダリングは、まだできませんが、GDALができることは実現できます。</p></td></tr></table></div></div><div class="refsection"><a name="idp91005128"></a><h2>例: ジオメトリをPNGファイルとして出力</h2><div class="informalfigure"><div class="mediaobject"><img src="images/st_asraster01.png"><div class="caption"><p>黒い円</p></div></div></div><pre class="programlisting">-- 150x150ピクセルを占める黒い円を出力します --
SELECT ST_AsPNG(ST_AsRaster(ST_Buffer(ST_Point(1,5),10),150, 150));</pre><div class="informalfigure"><div class="mediaobject"><img src="images/st_asraster02.png"><div class="caption"><p>PostGISだけで描画したバッファの例</p></div></div></div><pre class="programlisting">-- RGBバンド (118,154,118) - 鴨の羽色 にマップします --
SELECT ST_AsPNG(
        ST_AsRaster(
                ST_Buffer(
                        ST_GeomFromText('LINESTRING(50 50,150 150,150 50)'), 10,'join=bevel'),
                        200,200,ARRAY['8BUI', '8BUI', '8BUI'], ARRAY[118,154,118], ARRAY[0,0,0]));</pre></div><div class="refsection"><a name="idp91011784"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_BandPixelType" title="ST_BandPixelType">ST_BandPixelType</a>, <a class="xref" href="#ST_Buffer" title="ST_Buffer">ST_Buffer</a>, <a class="xref" href="#RT_ST_GDALDrivers" title="ST_GDALDrivers">ST_GDALDrivers</a>, <a class="xref" href="#RT_ST_AsGDALRaster" title="ST_AsGDALRaster">ST_AsGDALRaster</a>, <a class="xref" href="#RT_ST_AsPNG" title="ST_AsPNG">ST_AsPNG</a>, <a class="xref" href="#RT_ST_AsJPEG" title="ST_AsJPEG">ST_AsJPEG</a>, <a class="xref" href="#RT_ST_SRID" title="ST_SRID">ST_SRID</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Band"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Band — 既存のラスタの、一つ以上のバンドを新しいラスタとして返します。既存のラスタから新しいラスタを構築する際に使えます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_Band</b>(</code>raster  <var class="pdparam">rast</var>, integer[]  <var class="pdparam">nbands = ARRAY[1]</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Band</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Band</b>(</code>raster  <var class="pdparam">rast</var>, text  <var class="pdparam">nbands</var>, character  <var class="pdparam">delimiter=,</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp91028552"></a><h2>説明</h2><p>既存のラスタの、一つ以上のバンドを新しいラスタとして返します。既存ラスタから新しいラスタを構築したり、ラスタの選択したバンドのみを出力したり、バンドの並びを改める際に使えます。バンドが指定されない場合や指定したバンドがラスタに存在しない場合には、全てのバンドを返します。バンド削除等の様々な関数を補助する関数として使われています。 </p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="code">nbands</code>を文字列とする版では、デフォルトのデリミタは<code class="code">,</code>です。<code class="code">'1,2,3'</code>と指定できます。異なるデリミタを使いたい場合には、<code class="code">ST_Band(rast, '1@2@3', '@')</code>とします。複数バンドを指定する際に、<code class="code">ST_Band(rast, '{1,2,3}'::int[]);</code>というような、配列を使うことを強くお勧めします。<code class="code">text</code>によるバンド一覧を取る形式は、PostGISの将来の版で削除するかも知れません。</p></td></tr></table></div><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp91045064"></a><h2>例</h2><pre class="programlisting">-- 二つの新しいラスタを生成します
--   1 - ダミーラスタの1番バンド
--   2 - ダミーラスタの3番バンドを生成して2BUIで再分類
SELECT ST_NumBands(rast1) As numb1, ST_BandPixelType(rast1) As pix1,
 ST_NumBands(rast2) As numb2,  ST_BandPixelType(rast2) As pix2
FROM (
    SELECT ST_Band(rast) As rast1, ST_Reclass(ST_Band(rast,3), '100-200):1, [200-254:2', '2BUI') As rast2
        FROM dummy_rast
        WHERE rid = 2) As foo;

 numb1 | pix1 | numb2 | pix2
-------+------+-------+------
     1 | 8BUI |     1 | 2BUI
                                        </pre><pre class="programlisting">-- 配列へのキャストを使って2番と3番バンドを返します
SELECT ST_NumBands(ST_Band(rast, '{2,3}'::int[])) As num_bands
    FROM dummy_rast WHERE rid=2;

num_bands
----------
2

-- バンドの指定に配列を使って2番と3番バンドを返します
SELECT ST_NumBands(ST_Band(rast, ARRAY[2,3])) As num_bands
    FROM dummy_rast
WHERE rid=2;
                                        </pre><div class="informaltable"><table class="informaltable" border="1"><colgroup><col><col><col></colgroup><tbody><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_band01.png"><div class="caption"><p>元画像 (rastカラム)</p></div></div></div>
		 </td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_band02.png"><div class="caption"><p>dupe_band</p></div></div></div>
		 </td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_band03.png"><div class="caption"><p>sing_band</p></div></div></div>
		 </td></tr></tbody></table></div><pre class="programlisting">-- 元画像の2番バンド、1番バンド、1番バンドでバンドを成すラスタと
-- 3番バンドだけのラスタの生成
SELECT rast, ST_Band(rast, ARRAY[2,1,1]) As dupe_band,
        ST_Band(rast, 3) As sing_band
FROM samples.than_chunked
WHERE rid=35;
                                        </pre></div><div class="refsection"><a name="idp91069000"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_AddBand" title="ST_AddBand">ST_AddBand</a>, <a class="xref" href="#RT_ST_NumBands" title="ST_NumBands">ST_NumBands</a>, <a class="xref" href="#RT_ST_Reclass" title="ST_Reclass">ST_Reclass</a>, <a class="xref" href="#RT_reference" title="第9章 ラスタ リファレンス">9章<i>ラスタ リファレンス</i></a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_MakeEmptyCoverage"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MakeEmptyCoverage — 空のラスタタイルのグリッドでジオリファレンスを施されている領域を生成します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_MakeEmptyCoverage</b>(</code>integer  <var class="pdparam">tilewidth</var>, integer  <var class="pdparam">tileheight</var>, integer  <var class="pdparam">width</var>, integer  <var class="pdparam">height</var>, double precision  <var class="pdparam">upperleftx</var>, double precision  <var class="pdparam">upperlefty</var>, double precision  <var class="pdparam">scalex</var>, double precision  <var class="pdparam">scaley</var>, double precision  <var class="pdparam">skewx</var>, double precision  <var class="pdparam">skewy</var>, integer  <var class="pdparam">srid=unknown</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp91086408"></a><h2>説明</h2><p><a class="xref" href="#RT_ST_MakeEmptyRaster" title="ST_MakeEmptyRaster">ST_MakeEmptyRaster</a>でラスタ集合を生成します。グリッドの次元は<code class="varname">width</code>と<code class="varname">height</code>です。タイルの次元は<code class="varname">tilewidth</code>と<code class="varname">tileheight</code>です。領域は左上隅(<code class="varname">upperleftx</code>, <code class="varname">upperlefty</code>)から右下隅 (<code class="varname">upperleftx</code> + <code class="varname">width</code> * <code class="varname">scalex</code>, <code class="varname">upperlefty</code> + <code class="varname">height</code> * <code class="varname">scaley</code>)で形成されます。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ラスタのscaleyは一般的に負数で、scalexは一般的に正数です。右下隅は、左上隅より、yは小さな値、xは大きな値になります。</p></td></tr></table></div><p>Availability: 2.4.0 </p></div><div class="refsection"><a name="idp91093320"></a><h2>基本的な例</h2><p>WGS84で左上が(22, 27)で右下が(55, 53)となる範囲の4x4グリッドの16タイルを生成します。</p><pre class="programlisting">SELECT (ST_MetaData(tile)).* FROM ST_MakeEmptyCoverage(1, 1, 4, 4, 22, 33, (55 - 22)/(4)::float, (33 - 77)/(4)::float, 0., 0., 4326) tile;

 upperleftx | upperlefty | width | height | scalex | scaley | skewx | skewy | srid | numbands
-------------------------------------------------------------------------------------
         22 |         33 |     1 |      1 |   8.25 |    -11 |     0 |     0 | 4326 |        0
      30.25 |         33 |     1 |      1 |   8.25 |    -11 |     0 |     0 | 4326 |        0
       38.5 |         33 |     1 |      1 |   8.25 |    -11 |     0 |     0 | 4326 |        0
      46.75 |         33 |     1 |      1 |   8.25 |    -11 |     0 |     0 | 4326 |        0
         22 |         22 |     1 |      1 |   8.25 |    -11 |     0 |     0 | 4326 |        0
      30.25 |         22 |     1 |      1 |   8.25 |    -11 |     0 |     0 | 4326 |        0
       38.5 |         22 |     1 |      1 |   8.25 |    -11 |     0 |     0 | 4326 |        0
      46.75 |         22 |     1 |      1 |   8.25 |    -11 |     0 |     0 | 4326 |        0
         22 |         11 |     1 |      1 |   8.25 |    -11 |     0 |     0 | 4326 |        0
      30.25 |         11 |     1 |      1 |   8.25 |    -11 |     0 |     0 | 4326 |        0
       38.5 |         11 |     1 |      1 |   8.25 |    -11 |     0 |     0 | 4326 |        0
      46.75 |         11 |     1 |      1 |   8.25 |    -11 |     0 |     0 | 4326 |        0
         22 |          0 |     1 |      1 |   8.25 |    -11 |     0 |     0 | 4326 |        0
      30.25 |          0 |     1 |      1 |   8.25 |    -11 |     0 |     0 | 4326 |        0
       38.5 |          0 |     1 |      1 |   8.25 |    -11 |     0 |     0 | 4326 |        0
      46.75 |          0 |     1 |      1 |   8.25 |    -11 |     0 |     0 | 4326 |        0</pre></div><div class="refsection"><a name="idp91094984"></a><h2>関連情報</h2><p>
                      <a class="xref" href="#RT_ST_MakeEmptyRaster" title="ST_MakeEmptyRaster">ST_MakeEmptyRaster</a>
                    </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_MakeEmptyRaster"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MakeEmptyRaster — 与えられたピクセル範囲 (width &amp; height)、左上のX,Y、ピクセルサイズ、回転 (scalex, scaley, skewx, skewy)と空間参照系 (srid)が指定された空ラスタ (バンドを持たないラスタ)を返します。ラスタが渡されると、新しいラスタは渡されたラスタと同じサイズ、アラインメント、SRIDになります。SRIDが指定されていない場合には、空間参照系は不明 (0)とされます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_MakeEmptyRaster</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_MakeEmptyRaster</b>(</code>integer  <var class="pdparam">width</var>, integer  <var class="pdparam">height</var>, float8  <var class="pdparam">upperleftx</var>, float8  <var class="pdparam">upperlefty</var>, float8  <var class="pdparam">scalex</var>, float8  <var class="pdparam">scaley</var>, float8  <var class="pdparam">skewx</var>, float8  <var class="pdparam">skewy</var>, integer  <var class="pdparam">srid=unknown</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_MakeEmptyRaster</b>(</code>integer  <var class="pdparam">width</var>, integer  <var class="pdparam">height</var>, float8  <var class="pdparam">upperleftx</var>, float8  <var class="pdparam">upperlefty</var>, float8  <var class="pdparam">pixelsize</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp91117768"></a><h2>説明</h2><p>与えられたピクセル範囲 (width &amp; height)を持ち、かつ、左上隅のX (upperleftx)とY (upperlefty)、ピクセルサイズと回転 (scalex, scaley, skewx, skewy)、空間参照系 (srid)によって空間 (またはワールド)座標上で地理参照された空ラスタ (バンドを持たないラスタ)を返します。</p><p>最後の形式では、ピクセルサイズを一つの引数 (pixelsize)で指定しています。scalexはこの引数に、scaleyは引数の正負逆の数に、それぞれ設定され、skewxとskewyは0に設定されます。 </p><p>既存のラスタを渡すと、同じメタデータ設定 (バンド以外)を持つ新しいラスタが返ります。 </p><p>SRIDが設定されていない場合には、デフォルトは0です。空ラスタを生成した後に、バンドの追加や編集を行うことになります。<a class="xref" href="#RT_ST_AddBand" title="ST_AddBand">ST_AddBand</a>でバンドを定義し、<a class="xref" href="#RT_ST_SetValue" title="ST_SetValue">ST_SetValue</a>で初期ピクセル値を設定します。</p></div><div class="refsection"><a name="idp91120968"></a><h2>例</h2><pre class="programlisting">INSERT INTO dummy_rast(rid,rast)
VALUES(3, ST_MakeEmptyRaster( 100, 100, 0.0005, 0.0005, 1, 1, 0, 0, 4326) );

-- 既存のラスタをテンプレートに用いて新しいラスタを生成
INSERT INTO dummy_rast(rid,rast)
SELECT 4, ST_MakeEmptyRaster(rast)
FROM dummy_rast WHERE rid = 3;

-- 既存ラスタと生成したラスタのメタデータを出力
SELECT rid, (md).*
FROM (SELECT rid, ST_MetaData(rast) As md
        FROM dummy_rast
        WHERE rid IN(3,4)) As foo;

-- output --
 rid | upperleftx | upperlefty | width | height | scalex | scaley | skewx | skewy | srid | numbands
-----+------------+------------+-------+--------+------------+------------+-------+-------+------+----------
   3 |     0.0005 |     0.0005 |   100 |    100 |          1 |          1 |    0  |     0 | 4326 |        0
   4 |     0.0005 |     0.0005 |   100 |    100 |          1 |          1 |    0  |     0 | 4326 |        0
                                </pre></div><div class="refsection"><a name="idp91126344"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_AddBand" title="ST_AddBand">ST_AddBand</a>, <a class="xref" href="#RT_ST_MetaData" title="ST_MetaData">ST_MetaData</a>, <a class="xref" href="#RT_ST_ScaleX" title="ST_ScaleX">ST_ScaleX</a>, <a class="xref" href="#RT_ST_ScaleY" title="ST_ScaleY">ST_ScaleY</a>, <a class="xref" href="#RT_ST_SetValue" title="ST_SetValue">ST_SetValue</a>, <a class="xref" href="#RT_ST_SkewX" title="ST_SkewX">ST_SkewX</a>, , <a class="xref" href="#RT_ST_SkewY" title="ST_SkewY">ST_SkewY</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Tile"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Tile — 求められた出力ラスタのピクセル数に基づいて入力ラスタを分割した結果のラスタ集合を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">setof raster <b class="fsfunc">ST_Tile</b>(</code>raster  <var class="pdparam">rast</var>, int[]  <var class="pdparam">nband</var>, integer  <var class="pdparam">width</var>, integer  <var class="pdparam">height</var>, boolean  <var class="pdparam">padwithnodata=FALSE</var>, double precision  <var class="pdparam">nodataval=NULL</var><code>)</code>;</p><p><code class="funcdef">setof raster <b class="fsfunc">ST_Tile</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, integer  <var class="pdparam">width</var>, integer  <var class="pdparam">height</var>, boolean  <var class="pdparam">padwithnodata=FALSE</var>, double precision  <var class="pdparam">nodataval=NULL</var><code>)</code>;</p><p><code class="funcdef">setof raster <b class="fsfunc">ST_Tile</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">width</var>, integer  <var class="pdparam">height</var>, boolean  <var class="pdparam">padwithnodata=FALSE</var>, double precision  <var class="pdparam">nodataval=NULL</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp91141576"></a><h2>説明</h2><p>求められた出力ラスタのピクセル数に基づいて入力ラスタを分割した結果のラスタ集合を返します。 </p><p><code class="varname">padwithnodata</code>がFALSEである場合には、ラスタの右端と下端のタイルは、他のタイルと異なるピクセル範囲を持つことがあります。<code class="varname">padwithnodata</code>がTRUEの場合には、全てのタイルは同じピクセル範囲を持ち、端のタイルにNODATA値が詰められます。ラスタバンドにNODATA値が指定されていない場合には、<code class="varname">nodataval</code>で指定することができます。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>入力ラスタの指定したバンドがデータベース外ラスタの場合には、出力ラスタ内の対応するバンドもデータベース外になります。 </p></td></tr></table></div><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp91149384"></a><h2>例</h2><pre class="programlisting">WITH foo AS (
        SELECT ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(3, 3, 0, 0, 1, -1, 0, 0, 0), 1, '8BUI', 1, 0), 2, '8BUI', 10, 0) AS rast UNION ALL
        SELECT ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(3, 3, 3, 0, 1, -1, 0, 0, 0), 1, '8BUI', 2, 0), 2, '8BUI', 20, 0) AS rast UNION ALL
        SELECT ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(3, 3, 6, 0, 1, -1, 0, 0, 0), 1, '8BUI', 3, 0), 2, '8BUI', 30, 0) AS rast UNION ALL

        SELECT ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(3, 3, 0, -3, 1, -1, 0, 0, 0), 1, '8BUI', 4, 0), 2, '8BUI', 40, 0) AS rast UNION ALL
        SELECT ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(3, 3, 3, -3, 1, -1, 0, 0, 0), 1, '8BUI', 5, 0), 2, '8BUI', 50, 0) AS rast UNION ALL
        SELECT ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(3, 3, 6, -3, 1, -1, 0, 0, 0), 1, '8BUI', 6, 0), 2, '8BUI', 60, 0) AS rast UNION ALL

        SELECT ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(3, 3, 0, -6, 1, -1, 0, 0, 0), 1, '8BUI', 7, 0), 2, '8BUI', 70, 0) AS rast UNION ALL
        SELECT ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(3, 3, 3, -6, 1, -1, 0, 0, 0), 1, '8BUI', 8, 0), 2, '8BUI', 80, 0) AS rast UNION ALL
        SELECT ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(3, 3, 6, -6, 1, -1, 0, 0, 0), 1, '8BUI', 9, 0), 2, '8BUI', 90, 0) AS rast
), bar AS (
        SELECT ST_Union(rast) AS rast FROM foo
), baz AS (
        SELECT ST_Tile(rast, 3, 3, TRUE) AS rast FROM bar
)
SELECT
        ST_DumpValues(rast)
FROM baz;

              st_dumpvalues
------------------------------------------
 (1,"{{1,1,1},{1,1,1},{1,1,1}}")
 (2,"{{10,10,10},{10,10,10},{10,10,10}}")
 (1,"{{2,2,2},{2,2,2},{2,2,2}}")
 (2,"{{20,20,20},{20,20,20},{20,20,20}}")
 (1,"{{3,3,3},{3,3,3},{3,3,3}}")
 (2,"{{30,30,30},{30,30,30},{30,30,30}}")
 (1,"{{4,4,4},{4,4,4},{4,4,4}}")
 (2,"{{40,40,40},{40,40,40},{40,40,40}}")
 (1,"{{5,5,5},{5,5,5},{5,5,5}}")
 (2,"{{50,50,50},{50,50,50},{50,50,50}}")
 (1,"{{6,6,6},{6,6,6},{6,6,6}}")
 (2,"{{60,60,60},{60,60,60},{60,60,60}}")
 (1,"{{7,7,7},{7,7,7},{7,7,7}}")
 (2,"{{70,70,70},{70,70,70},{70,70,70}}")
 (1,"{{8,8,8},{8,8,8},{8,8,8}}")
 (2,"{{80,80,80},{80,80,80},{80,80,80}}")
 (1,"{{9,9,9},{9,9,9},{9,9,9}}")
 (2,"{{90,90,90},{90,90,90},{90,90,90}}")
(18 rows)
                                </pre><pre class="programlisting">WITH foo AS (
        SELECT ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(3, 3, 0, 0, 1, -1, 0, 0, 0), 1, '8BUI', 1, 0), 2, '8BUI', 10, 0) AS rast UNION ALL
        SELECT ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(3, 3, 3, 0, 1, -1, 0, 0, 0), 1, '8BUI', 2, 0), 2, '8BUI', 20, 0) AS rast UNION ALL
        SELECT ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(3, 3, 6, 0, 1, -1, 0, 0, 0), 1, '8BUI', 3, 0), 2, '8BUI', 30, 0) AS rast UNION ALL

        SELECT ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(3, 3, 0, -3, 1, -1, 0, 0, 0), 1, '8BUI', 4, 0), 2, '8BUI', 40, 0) AS rast UNION ALL
        SELECT ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(3, 3, 3, -3, 1, -1, 0, 0, 0), 1, '8BUI', 5, 0), 2, '8BUI', 50, 0) AS rast UNION ALL
        SELECT ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(3, 3, 6, -3, 1, -1, 0, 0, 0), 1, '8BUI', 6, 0), 2, '8BUI', 60, 0) AS rast UNION ALL

        SELECT ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(3, 3, 0, -6, 1, -1, 0, 0, 0), 1, '8BUI', 7, 0), 2, '8BUI', 70, 0) AS rast UNION ALL
        SELECT ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(3, 3, 3, -6, 1, -1, 0, 0, 0), 1, '8BUI', 8, 0), 2, '8BUI', 80, 0) AS rast UNION ALL
        SELECT ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(3, 3, 6, -6, 1, -1, 0, 0, 0), 1, '8BUI', 9, 0), 2, '8BUI', 90, 0) AS rast
), bar AS (
        SELECT ST_Union(rast) AS rast FROM foo
), baz AS (
        SELECT ST_Tile(rast, 3, 3, 2) AS rast FROM bar
)
SELECT
        ST_DumpValues(rast)
FROM baz;

              st_dumpvalues
------------------------------------------
 (1,"{{10,10,10},{10,10,10},{10,10,10}}")
 (1,"{{20,20,20},{20,20,20},{20,20,20}}")
 (1,"{{30,30,30},{30,30,30},{30,30,30}}")
 (1,"{{40,40,40},{40,40,40},{40,40,40}}")
 (1,"{{50,50,50},{50,50,50},{50,50,50}}")
 (1,"{{60,60,60},{60,60,60},{60,60,60}}")
 (1,"{{70,70,70},{70,70,70},{70,70,70}}")
 (1,"{{80,80,80},{80,80,80},{80,80,80}}")
 (1,"{{90,90,90},{90,90,90},{90,90,90}}")
(9 rows)
                                </pre></div><div class="refsection"><a name="idp91151176"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Union" title="ST_Union">ST_Union</a>, <a class="xref" href="#RT_Retile" title="ST_Retile">ST_Retile</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_Retile"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Retile — 任意のタイル化されたラスタカバレッジから構成されたタイルの集合を返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">SETOF raster <b class="fsfunc">ST_Retile</b>(</code>regclass  <var class="pdparam">tab</var>, name  <var class="pdparam">col</var>, geometry  <var class="pdparam">ext</var>, float8  <var class="pdparam">sfx</var>, float8  <var class="pdparam">sfy</var>, int  <var class="pdparam">tw</var>, int  <var class="pdparam">th</var>, text  <var class="pdparam">algo='NearestNeighbor'</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp91164872"></a><h2>説明</h2><p>指定された縮尺 (<code class="varname">sfx</code>, <code class="varname">sfy</code>)と最大サイズ (<code class="varname">tw</code>, <code class="varname">th</code>)を持ち、指定された範囲 (<code class="varname">ext</code>)を包含し、指定されたラスタカバレッジ (<code class="varname">tab</code>, <code class="varname">col</code>)からのデータを持つタイルの集合を返します。 </p><p>アルゴリズム指定オプションは'NearestNeighbor', 'Bilinear', 'Cubic', 'CubicSpline', 'Lanczos'です。詳細については<a class="ulink" href="http://www.gdal.org/gdalwarp.html" target="_top">GDAL Warp resampling methods</a>をご覧ください。</p><p>Availability: 2.2.0</p></div><div class="refsection"><a name="idp91182408"></a><h2>関連情報</h2><p>
          <a class="xref" href="#RT_CreateOverview" title="ST_CreateOverview">ST_CreateOverview</a>
        </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_FromGDALRaster"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_FromGDALRaster — 対応するGDALラスタファイルからラスタを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_FromGDALRaster</b>(</code>bytea  <var class="pdparam">gdaldata</var>, integer  <var class="pdparam">srid=NULL</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp91189576"></a><h2>説明</h2><p>対応するGDALラスタファイルからラスタを返します。<code class="varname">gdaldata</code>はbytea型で、GDALラスタファイルの中身です。 </p><p><code class="varname">srid</code>がNULLの場合には、この関数は、GDALラスタから自動的にSRIDを設定しようとします。<code class="varname">srid</code>が与えられている場合には、与えられた値が自動的に設定したSRIDを上書きします。 </p><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp91192648"></a><h2>例</h2><pre class="programlisting">WITH foo AS (
        SELECT ST_AsPNG(ST_AddBand(ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(2, 2, 0, 0, 0.1, -0.1, 0, 0, 4326), 1, '8BUI', 1, 0), 2, '8BUI', 2, 0), 3, '8BUI', 3, 0)) AS png
),
bar AS (
        SELECT 1 AS rid, ST_FromGDALRaster(png) AS rast FROM foo
        UNION ALL
        SELECT 2 AS rid, ST_FromGDALRaster(png, 3310) AS rast FROM foo
)
SELECT
        rid,
        ST_Metadata(rast) AS metadata,
        ST_SummaryStats(rast, 1) AS stats1,
        ST_SummaryStats(rast, 2) AS stats2,
        ST_SummaryStats(rast, 3) AS stats3
FROM bar
ORDER BY rid;

 rid |         metadata          |    stats1     |    stats2     |     stats3
-----+---------------------------+---------------+---------------+----------------
   1 | (0,0,2,2,1,-1,0,0,0,3)    | (4,4,1,0,1,1) | (4,8,2,0,2,2) | (4,12,3,0,3,3)
   2 | (0,0,2,2,1,-1,0,0,3310,3) | (4,4,1,0,1,1) | (4,8,2,0,2,2) | (4,12,3,0,3,3)
(2 rows)
                                </pre></div><div class="refsection"><a name="idp91193928"></a><h2>関連情報</h2><p>
					<a class="xref" href="#RT_ST_AsGDALRaster" title="ST_AsGDALRaster">ST_AsGDALRaster</a>
				</p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Raster_Accessors"></a>9.4. ラスタアクセサ</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#RT_ST_GeoReference">ST_GeoReference</a></span><span class="refpurpose"> — GDAL書式または一般的にワールドファイルでみられるESRI書式の地理参照メタデータを返します。デフォルトはGDALです。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Height">ST_Height</a></span><span class="refpurpose"> — ラスタの高さをピクセル単位で返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_IsEmpty">ST_IsEmpty</a></span><span class="refpurpose"> — ラスタが空 (幅が0で高さが0)の場合にはTRUEを返します。他の場合には、FALSEを返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_MemSize">ST_MemSize</a></span><span class="refpurpose"> — ラスタが取る領域の合計をバイト単位で返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_MetaData">ST_MetaData</a></span><span class="refpurpose"> — ピクセル数、回転 (スキュー)、左上隅位置等のラスタオブジェクトに関する基本的なメタデータを返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_NumBands">ST_NumBands</a></span><span class="refpurpose"> — ラスタオブジェクトのバンド数を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_PixelHeight">ST_PixelHeight</a></span><span class="refpurpose"> — 空間参照系の地理的な単位でのピクセルの高さを返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_PixelWidth">ST_PixelWidth</a></span><span class="refpurpose"> — 空間参照系の地理的な単位でのピクセルの幅を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_ScaleX">ST_ScaleX</a></span><span class="refpurpose"> — 空間参照系の地理的な単位でのピクセル幅のX成分を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_ScaleY">ST_ScaleY</a></span><span class="refpurpose"> — 空間参照系の地理的な単位でのピクセル幅のY成分を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_RasterToWorldCoord">ST_RasterToWorldCoord</a></span><span class="refpurpose"> — ラスタの指定した列と行における左上隅の地理座標X値とY値 (経度と緯度)を返します。列と行の番号は1始まりです。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_RasterToWorldCoordX">ST_RasterToWorldCoordX</a></span><span class="refpurpose"> — ラスタの指定した列と行における左上隅の地理座標のX値を返します。列と行の番号は1始まりです。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_RasterToWorldCoordY">ST_RasterToWorldCoordY</a></span><span class="refpurpose"> — ラスタの指定した列と行における左上隅の地理座標のY値を返します。列と行の番号は1始まりです。 </span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Rotation">ST_Rotation</a></span><span class="refpurpose"> — ラスタの回転をラジアンで返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_SkewX">ST_SkewX</a></span><span class="refpurpose"> — 空間参照のXスキュー (回転パラメータ)を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_SkewY">ST_SkewY</a></span><span class="refpurpose"> — 空間参照のYスキュー (回転パラメータ)を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_SRID">ST_SRID</a></span><span class="refpurpose"> — ラスタのspatial_ref_sysテーブルで定義されている空間参照系識別番号を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Summary">ST_Summary</a></span><span class="refpurpose"> — ラスタの中身の概要が文字列で返されます。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_UpperLeftX">ST_UpperLeftX</a></span><span class="refpurpose"> — 適用されている空間参照系でのラスタの左上隅のX座標値を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_UpperLeftY">ST_UpperLeftY</a></span><span class="refpurpose"> — 適用されている空間参照系でのラスタの左上隅のY座標値を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Width">ST_Width</a></span><span class="refpurpose"> — ラスタの幅をピクセル単位で返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_WorldToRasterCoord">ST_WorldToRasterCoord</a></span><span class="refpurpose"> — ラスタの空間参照系による地理座標のX値とY値 (経度と緯度)またはポイントジオメトリに対応するピクセルの左上隅を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_WorldToRasterCoordX">ST_WorldToRasterCoordX</a></span><span class="refpurpose"> — ラスタの空間参照系に基づくポイントジオメトリ (pt)またはX,Y座標値 (xw,yw)に対応するラスタの列を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_WorldToRasterCoordY">ST_WorldToRasterCoordY</a></span><span class="refpurpose"> — ラスタの空間参照系に基づくポイントジオメトリ (pt)またはX,Y座標値 (xw,yw)に対応するラスタの行を返します。</span></dt></dl></div><div class="refentry"><a name="RT_ST_GeoReference"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_GeoReference — GDAL書式または一般的にワールドファイルでみられるESRI書式の地理参照メタデータを返します。デフォルトはGDALです。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_GeoReference</b>(</code>raster  <var class="pdparam">rast</var>, text  <var class="pdparam">format=GDAL</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp91201992"></a><h2>説明</h2><p>GDAL書式または一般的に<a class="ulink" href="http://en.wikipedia.org/wiki/World_file" target="_top">world file</a> (英語版WikiPedia)でみられるESRI書式の地理参照メタデータを返します。書式を指定したいない場合のデフォルトはGDALです。書式は'GDAL'または'ESRI'の文字列です。 </p><p>書式の表現の違いは次の通りです。</p><p><code class="varname">GDAL</code>: </p><pre class="programlisting">scalex
skewy
skewx
scaley
upperleftx
upperlefty</pre><p><code class="varname">ESRI</code>: </p><pre class="programlisting">scalex
skewy
skewx
scaley
upperleftx + scalex*0.5
upperlefty + scaley*0.5</pre></div><div class="refsection"><a name="idp91206088"></a><h2>例</h2><pre class="programlisting">SELECT ST_GeoReference(rast, 'ESRI') As esri_ref, ST_GeoReference(rast, 'GDAL') As gdal_ref
 FROM dummy_rast WHERE rid=1;

   esri_ref   |   gdal_ref
--------------+--------------
 2.0000000000 | 2.0000000000
 0.0000000000 : 0.0000000000
 0.0000000000 : 0.0000000000
 3.0000000000 : 3.0000000000
 1.5000000000 : 0.5000000000
 2.0000000000 : 0.5000000000
                                </pre></div><div class="refsection"><a name="idp91207368"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_SetGeoReference" title="ST_SetGeoReference">ST_SetGeoReference</a>, <a class="xref" href="#RT_ST_ScaleX" title="ST_ScaleX">ST_ScaleX</a>, <a class="xref" href="#RT_ST_ScaleY" title="ST_ScaleY">ST_ScaleY</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Height"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Height — ラスタの高さをピクセル単位で返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_Height</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp91213896"></a><h2>説明</h2><p>ラスタの高さをピクセル単位で返します。</p></div><div class="refsection"><a name="idp91215048"></a><h2>例</h2><pre class="programlisting">SELECT rid, ST_Height(rast) As rastheight
FROM dummy_rast;

 rid | rastheight
-----+------------
   1 |         20
   2 |          5
                                </pre></div><div class="refsection"><a name="idp91216328"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Width" title="ST_Width">ST_Width</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_IsEmpty"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_IsEmpty — ラスタが空 (幅が0で高さが0)の場合にはTRUEを返します。他の場合には、FALSEを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_IsEmpty</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp91222216"></a><h2>説明</h2><p>ラスタが空 (幅が0で高さが0)の場合にはTRUEを返します。他の場合には、FALSEを返します。</p><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp91223880"></a><h2>例</h2><pre class="programlisting">SELECT ST_IsEmpty(ST_MakeEmptyRaster(100, 100, 0, 0, 0, 0, 0, 0))
st_isempty |
-----------+
f          |


SELECT ST_IsEmpty(ST_MakeEmptyRaster(0, 0, 0, 0, 0, 0, 0, 0))
st_isempty |
-----------+
t          |

                </pre></div><div class="refsection"><a name="idp89554248"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_HasNoBand" title="ST_HasNoBand">ST_HasNoBand</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_MemSize"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MemSize — ラスタが取る領域の合計をバイト単位で返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_MemSize</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp89560008"></a><h2>説明</h2><p>ラスタが取る領域の合計をバイト単位で返します。 </p><p>この関数はPostgreSQLビルトイン関数pg_clumn_size, pg_size_pretty, pg_relation_size, pg_total_relation_sizeへのすばらしい賛辞です。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>テーブルのバイト単位のサイズを得るpg_relation_sizeはST_MemSizeよりも小さい値を返すことがあります。pg_relation_sizeはTOASTテーブルの寄与分を追加せず、大きなジオメトリはTOASTテーブルに格納されるためです。pg_column_sizeは圧縮後のサイズを返すので、小さくなることがあります。</p><p>pg_total_relation_size - テーブル、TOASTテーブル、インデクスを含みます。</p></td></tr></table></div><p>Availability: 2.2.0</p></div><div class="refsection"><a name="idp89562952"></a><h2>例</h2><pre class="programlisting">SELECT ST_MemSize(ST_AsRaster(ST_Buffer(ST_Point(1,5),10,1000),150, 150, '8BUI')) As rast_mem;

                rast_mem
                --------
                22568
        </pre></div><div class="refsection"><a name="idp89564488"></a><h2>関連情報</h2><p></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_MetaData"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MetaData — ピクセル数、回転 (スキュー)、左上隅位置等のラスタオブジェクトに関する基本的なメタデータを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">record <b class="fsfunc">ST_MetaData</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp91224776"></a><h2>説明</h2><p>ピクセルサイズ、回転 (skew)、左上隅位置等のラスタオブジェクトに関する基本的なメタデータを返します。返されるカラムはupperleftx | upperlefty | width | height | scalex | scaley | skewx | skewy | srid | numbandsです。</p></div><div class="refsection"><a name="idp91225928"></a><h2>例</h2><pre class="programlisting">SELECT rid, (foo.md).*
 FROM (SELECT rid, ST_MetaData(rast) As md
FROM dummy_rast) As foo;

 rid | upperleftx | upperlefty | width | height | scalex | scaley | skewx | skewy | srid | numbands
 ----+------------+------------+-------+--------+--------+-----------+-------+-------+------+-------
   1 |        0.5 |        0.5 |    10 |     20 |      2 |      3 |                0 |     0 |    0 |        0
   2 | 3427927.75 |    5793244 |     5 |      5 |   0.05 |  -0.05 |                0 |     0 |    0 |        3
                                </pre></div><div class="refsection"><a name="idp91227464"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_BandMetaData" title="ST_BandMetaData">ST_BandMetaData</a>, <a class="xref" href="#RT_ST_NumBands" title="ST_NumBands">ST_NumBands</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_NumBands"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_NumBands — ラスタオブジェクトのバンド数を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_NumBands</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp91233608"></a><h2>説明</h2><p>ラスタオブジェクトのバンド数を返します。</p></div><div class="refsection"><a name="idp91234760"></a><h2>例</h2><pre class="programlisting">SELECT rid, ST_NumBands(rast) As numbands
FROM dummy_rast;

rid | numbands
----+----------
  1 |        0
  2 |        3
                                </pre></div><div class="refsection"><a name="idp91236296"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Value" title="ST_Value">ST_Value</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_PixelHeight"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_PixelHeight — 空間参照系の地理的な単位でのピクセルの高さを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">double precision <b class="fsfunc">ST_PixelHeight</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp91242056"></a><h2>説明</h2><p>空間参照系の地理的な単位でのピクセルの高さを返します。スキューが無い一般的な状況では、ピクセル高は地理座標とラスタピクセルのスケール率です。</p><p>関係について図示したものは<a class="xref" href="#RT_ST_PixelWidth" title="ST_PixelWidth">ST_PixelWidth</a>を参照して下さい。 </p></div><div class="refsection"><a name="idp91243976"></a><h2>例: スキューの無いラスタ</h2><pre class="programlisting">SELECT ST_Height(rast) As rastheight, ST_PixelHeight(rast) As pixheight,
 ST_ScaleX(rast) As scalex, ST_ScaleY(rast) As scaley, ST_SkewX(rast) As skewx,
        ST_SkewY(rast) As skewy
FROM dummy_rast;

 rastheight | pixheight | scalex | scaley | skewx | skewy
------------+-----------+--------+--------+-------+----------
         20 |         3 |      2 |      3 |     0 |        0
          5 |      0.05 |   0.05 |  -0.05 |     0 |        0
                        </pre></div><div class="refsection"><a name="idp91245256"></a><h2>例: スキューが0でないラスタ</h2><pre class="programlisting">SELECT ST_Height(rast) As rastheight, ST_PixelHeight(rast) As pixheight,
 ST_ScaleX(rast) As scalex, ST_ScaleY(rast) As scaley, ST_SkewX(rast) As skewx,
        ST_SkewY(rast) As skewy
FROM (SELECT ST_SetSKew(rast,0.5,0.5) As rast
        FROM dummy_rast) As skewed;

rastheight |     pixheight     | scalex | scaley | skewx | skewy
-----------+-------------------+--------+--------+-------+----------
        20 |  3.04138126514911 |      2 |      3 |   0.5 |      0.5
         5 | 0.502493781056044 |   0.05 |  -0.05 |   0.5 |      0.5
                        </pre></div><div class="refsection"><a name="idp91246792"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_PixelWidth" title="ST_PixelWidth">ST_PixelWidth</a>, <a class="xref" href="#RT_ST_ScaleX" title="ST_ScaleX">ST_ScaleX</a>, <a class="xref" href="#RT_ST_ScaleY" title="ST_ScaleY">ST_ScaleY</a>, <a class="xref" href="#RT_ST_SkewX" title="ST_SkewX">ST_SkewX</a>, <a class="xref" href="#RT_ST_SkewY" title="ST_SkewY">ST_SkewY</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_PixelWidth"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_PixelWidth — 空間参照系の地理的な単位でのピクセルの幅を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">double precision <b class="fsfunc">ST_PixelWidth</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp91254216"></a><h2>説明</h2><p>空間参照系の地理的な単位でのピクセルの幅を返します。スキューが無い一般的な状況では、ピクセル幅は地理座標とラスタピクセルのスケール率です。</p><p>関係について次の図に示します。</p><p>
			</p><div class="informalfigure"><div class="mediaobject"><img src="images/raster_xscale_yscale_xskew_yskew.png"><div class="caption"><p>ピクセル幅: i方向のピクセルサイズ</p><p>ピクセル高: j方向のピクセルサイズ</p></div></div></div><p>
			</p></div><div class="refsection"><a name="idp91258568"></a><h2>例: スキューの無いラスタ</h2><pre class="programlisting">SELECT ST_Width(rast) As rastwidth, ST_PixelWidth(rast) As pixwidth,
        ST_ScaleX(rast) As scalex, ST_ScaleY(rast) As scaley, ST_SkewX(rast) As skewx,
        ST_SkewY(rast) As skewy
        FROM dummy_rast;

        rastwidth | pixwidth | scalex | scaley | skewx | skewy
        -----------+----------+--------+--------+-------+----------
        10 |        2 |      2 |      3 |     0 |        0
         5 |     0.05 |   0.05 |  -0.05 |     0 |        0
                </pre></div><div class="refsection"><a name="idp91259848"></a><h2>例: スキューが0でないラスタ</h2><pre class="programlisting">SELECT ST_Width(rast) As rastwidth, ST_PixelWidth(rast) As pixwidth,
        ST_ScaleX(rast) As scalex, ST_ScaleY(rast) As scaley, ST_SkewX(rast) As skewx,
        ST_SkewY(rast) As skewy
        FROM (SELECT ST_SetSkew(rast,0.5,0.5) As rast
        FROM dummy_rast) As skewed;

        rastwidth |     pixwidth      | scalex | scaley | skewx | skewy
        -----------+-------------------+--------+--------+-------+----------
        10 |  2.06155281280883 |      2 |      3 |   0.5 |      0.5
         5 | 0.502493781056044 |   0.05 |  -0.05 |   0.5 |      0.5
                </pre></div><div class="refsection"><a name="idp91261384"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_PixelHeight" title="ST_PixelHeight">ST_PixelHeight</a>, <a class="xref" href="#RT_ST_ScaleX" title="ST_ScaleX">ST_ScaleX</a>, <a class="xref" href="#RT_ST_ScaleY" title="ST_ScaleY">ST_ScaleY</a>, <a class="xref" href="#RT_ST_SkewX" title="ST_SkewX">ST_SkewX</a>, <a class="xref" href="#RT_ST_SkewY" title="ST_SkewY">ST_SkewY</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_ScaleX"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ScaleX — 空間参照系の地理的な単位でのピクセル幅のX成分を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float8 <b class="fsfunc">ST_ScaleX</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp91272776"></a><h2>説明</h2><p>空間参照系の地理的な単位でのピクセル幅のX成分を返します。詳細については<a class="ulink" href="http://en.wikipedia.org/wiki/World_file" target="_top">World File</a> (英語版WikiPedia)をご覧ください。</p><p>Changed: 2.0.0. WKTRaster版ではST_PixelSizeXと呼ばれていました。</p></div><div class="refsection"><a name="idp91274824"></a><h2>例</h2><pre class="programlisting">SELECT rid, ST_ScaleX(rast) As rastpixwidth
FROM dummy_rast;

 rid | rastpixwidth
-----+--------------
   1 |            2
   2 |         0.05
                                </pre></div><div class="refsection"><a name="idp91276360"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Width" title="ST_Width">ST_Width</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_ScaleY"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ScaleY — 空間参照系の地理的な単位でのピクセル幅のY成分を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float8 <b class="fsfunc">ST_ScaleY</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp91282120"></a><h2>説明</h2><p>空間参照系の地理的な単位でのピクセル幅のY成分を返します。詳細については<a class="ulink" href="http://en.wikipedia.org/wiki/World_file" target="_top">World File</a> (英語版WikiPedia)をご覧ください。</p><p>Changed: 2.0.0. WKTRaster版ではST_PixelSizeYと呼ばれていました。</p></div><div class="refsection"><a name="idp91284168"></a><h2>例</h2><pre class="programlisting">SELECT rid, ST_ScaleY(rast) As rastpixheight
FROM dummy_rast;

 rid | rastpixheight
-----+---------------
   1 |             3
   2 |         -0.05
                                </pre></div><div class="refsection"><a name="idp91285704"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Height" title="ST_Height">ST_Height</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_RasterToWorldCoord"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_RasterToWorldCoord — ラスタの指定した列と行における左上隅の地理座標X値とY値 (経度と緯度)を返します。列と行の番号は1始まりです。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">record <b class="fsfunc">ST_RasterToWorldCoord</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">xcolumn</var>, integer  <var class="pdparam">yrow</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp91293512"></a><h2>説明</h2><p>ラスタの指定した列と行における左上隅の地理座標X値とY値 (経度と緯度)を返します。X値とY値の単位は、地理参照されたラスタの地理単位です。列と行の数字は1始まりですが、引数に0、負数またはラスタのピクセル範囲を超える値が渡されている場合には、ラスタのグリッドがラスタ範囲外に適用できると仮定して、範囲外の座標を返します。 </p><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp91295048"></a><h2>例</h2><pre class="programlisting">-- スキューの無いラスタ
SELECT
        rid,
        (ST_RasterToWorldCoord(rast,1, 1)).*,
        (ST_RasterToWorldCoord(rast,2, 2)).*
FROM dummy_rast

 rid | longitude  | latitude | longitude |  latitude
-----+------------+----------+-----------+------------
   1 |        0.5 |      0.5 |       2.5 |        3.5
   2 | 3427927.75 |  5793244 | 3427927.8 | 5793243.95
                                </pre><pre class="programlisting">-- スキューの有るラスタ
SELECT
        rid,
        (ST_RasterToWorldCoord(rast, 1, 1)).*,
        (ST_RasterToWorldCoord(rast, 2, 3)).*
FROM (
        SELECT
                rid,
                ST_SetSkew(rast, 100.5, 0) As rast
        FROM dummy_rast
) As foo

 rid | longitude  | latitude | longitude | latitude
-----+------------+----------+-----------+-----------
   1 |        0.5 |      0.5 |     203.5 |       6.5
   2 | 3427927.75 |  5793244 | 3428128.8 | 5793243.9
                                </pre></div><div class="refsection"><a name="idp91297096"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_RasterToWorldCoordX" title="ST_RasterToWorldCoordX">ST_RasterToWorldCoordX</a>, <a class="xref" href="#RT_ST_RasterToWorldCoordY" title="ST_RasterToWorldCoordY">ST_RasterToWorldCoordY</a>, <a class="xref" href="#RT_ST_SetSkew" title="ST_SetSkew">ST_SetSkew</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_RasterToWorldCoordX"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_RasterToWorldCoordX — ラスタの指定した列と行における左上隅の地理座標のX値を返します。列と行の番号は1始まりです。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float8 <b class="fsfunc">ST_RasterToWorldCoordX</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">xcolumn</var><code>)</code>;</p><p><code class="funcdef">float8 <b class="fsfunc">ST_RasterToWorldCoordX</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">xcolumn</var>, integer  <var class="pdparam">yrow</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp91321288"></a><h2>説明</h2><p>ラスタの指定した列と行における左上隅の地理座標のX値を地理参照したラスタの地理単位で返します。列と行の番号は1始まりです。負数またはラスタの列数を超える値を渡した場合には、スキューとピクセルサイズが選択したラスタと同じであるという仮定のもとで、ラスタファイルから左または右にはずれた座標値を返します。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>スキューの無いラスタでは、X列を与えれば十分です。スキューのあるラスタの場合には、地理参照のとれた座標はST_ScaleXとST_SkewXおよび行と列の関数となります。スキューのあるラスタでX列のみ与えた場合にはエラーが発生します。</p></td></tr></table></div><p>Changed: 2.1.0 以前の版ではST_Raster2WorldCoordXと呼ばれていました。</p></div><div class="refsection"><a name="idp91323336"></a><h2>例</h2><pre class="programlisting">-- スキューの無いラスタでは列を与えれば十分です
SELECT rid, ST_RasterToWorldCoordX(rast,1) As x1coord,
        ST_RasterToWorldCoordX(rast,2) As x2coord,
        ST_ScaleX(rast) As pixelx
FROM dummy_rast;

 rid |  x1coord   |  x2coord  | pixelx
-----+------------+-----------+--------
   1 |        0.5 |       2.5 |      2
   2 | 3427927.75 | 3427927.8 |   0.05
                                </pre><pre class="programlisting">-- 面白半分にスキューさせてみましょう
SELECT rid, ST_RasterToWorldCoordX(rast, 1, 1) As x1coord,
        ST_RasterToWorldCoordX(rast, 2, 3) As x2coord,
        ST_ScaleX(rast) As pixelx
FROM (SELECT rid, ST_SetSkew(rast, 100.5, 0) As rast FROM dummy_rast) As foo;

 rid |  x1coord   |  x2coord  | pixelx
-----+------------+-----------+--------
   1 |        0.5 |     203.5 |      2
   2 | 3427927.75 | 3428128.8 |   0.05
                                </pre></div><div class="refsection"><a name="idp91325384"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_ScaleX" title="ST_ScaleX">ST_ScaleX</a>, <a class="xref" href="#RT_ST_RasterToWorldCoordY" title="ST_RasterToWorldCoordY">ST_RasterToWorldCoordY</a>, <a class="xref" href="#RT_ST_SetSkew" title="ST_SetSkew">ST_SetSkew</a>, <a class="xref" href="#RT_ST_SkewX" title="ST_SkewX">ST_SkewX</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_RasterToWorldCoordY"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_RasterToWorldCoordY — ラスタの指定した列と行における左上隅の地理座標のY値を返します。列と行の番号は1始まりです。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float8 <b class="fsfunc">ST_RasterToWorldCoordY</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">yrow</var><code>)</code>;</p><p><code class="funcdef">float8 <b class="fsfunc">ST_RasterToWorldCoordY</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">xcolumn</var>, integer  <var class="pdparam">yrow</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp91337544"></a><h2>説明</h2><p>ラスタの指定した列と行における左上隅の地理座標のY値を地理参照したラスタの地理単位で返します。列と行の番号は1始まりです。負数またはラスタの列数や行数を超える値を渡した場合には、スキューとピクセルサイズが選択したラスタと同じであるという仮定のもとで、ラスタファイルから左または右にはずれた座標値を返します。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>スキューの無いラスタでは、Y行を与えれば十分です。スキューのあるラスタの場合には、地理参照のとれた座標はST_ScaleYとST_SkewYおよび行と列の関数となります。スキューのあるラスタでY行のみ与えた場合にはエラーが発生します</p></td></tr></table></div><p>Changed: 2.1.0 以前の版ではST_Raster2WorldCoordYと呼ばれていました。</p></div><div class="refsection"><a name="idp91339592"></a><h2>例</h2><pre class="programlisting">-- スキューの無いラスタでは列を与えれば十分です
SELECT rid, ST_RasterToWorldCoordY(rast,1) As y1coord,
        ST_RasterToWorldCoordY(rast,3) As y2coord,
        ST_ScaleY(rast) As pixely
FROM dummy_rast;

 rid | y1coord |  y2coord  | pixely
-----+---------+-----------+--------
   1 |     0.5 |       6.5 |      3
   2 | 5793244 | 5793243.9 |  -0.05
                                </pre><pre class="programlisting">-- 面白半分に回転させてみましょう
SELECT rid, ST_RasterToWorldCoordY(rast,1,1) As y1coord,
        ST_RasterToWorldCoordY(rast,2,3) As y2coord,
        ST_ScaleY(rast) As pixely
FROM (SELECT rid, ST_SetSkew(rast,0,100.5) As rast FROM dummy_rast) As foo;

 rid | y1coord |  y2coord  | pixely
-----+---------+-----------+--------
   1 |     0.5 |       107 |      3
   2 | 5793244 | 5793344.4 |  -0.05
                                </pre></div><div class="refsection"><a name="idp91341640"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_ScaleY" title="ST_ScaleY">ST_ScaleY</a>, <a class="xref" href="#RT_ST_RasterToWorldCoordX" title="ST_RasterToWorldCoordX">ST_RasterToWorldCoordX</a>, <a class="xref" href="#RT_ST_SetSkew" title="ST_SetSkew">ST_SetSkew</a>, <a class="xref" href="#RT_ST_SkewY" title="ST_SkewY">ST_SkewY</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Rotation"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Rotation — ラスタの回転をラジアンで返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float8 <b class="fsfunc">ST_Rotation</b>(</code>raster <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp91348552"></a><h2>説明</h2><p>ラスタの回転をラジアンで返します。ラスタが回転を持っていない場合には、NaNが返されます。詳細については<a class="ulink" href="http://en.wikipedia.org/wiki/World_file" target="_top">World File</a> (英語版WikiPedia)を参照して下さい。</p></div><div class="refsection"><a name="idp91350216"></a><h2>例</h2><pre class="programlisting">SELECT rid, ST_Rotation(ST_SetScale(ST_SetSkew(rast, sqrt(2)), sqrt(2))) as rot FROM dummy_rast;

 rid |        rot
-----+-------------------
   1 | 0.785398163397448
   2 | 0.785398163397448
                </pre></div><div class="refsection"><a name="idp91351752"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_SetRotation" title="ST_SetRotation">ST_SetRotation</a>, <a class="xref" href="#RT_ST_SetScale" title="ST_SetScale">ST_SetScale</a>, <a class="xref" href="#RT_ST_SetSkew" title="ST_SetSkew">ST_SetSkew</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_SkewX"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SkewX — 空間参照のXスキュー (回転パラメータ)を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float8 <b class="fsfunc">ST_SkewX</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp91362376"></a><h2>説明</h2><p>空間参照のXスキュー (回転パラメータ)を返します。詳細については<a class="ulink" href="http://en.wikipedia.org/wiki/World_file" target="_top">World File</a> (英語版WikiPedia)を参照して下さい。</p></div><div class="refsection"><a name="idp91364040"></a><h2>例</h2><pre class="programlisting">SELECT rid, ST_SkewX(rast) As skewx, ST_SkewY(rast) As skewy,
    ST_GeoReference(rast) as georef
FROM dummy_rast;

 rid | skewx | skewy |       georef
-----+-------+-------+--------------------
   1 |     0 |     0 | 2.0000000000
                     : 0.0000000000
                     : 0.0000000000
                     : 3.0000000000
                     : 0.5000000000
                     : 0.5000000000
                     :
   2 |     0 |     0 | 0.0500000000
                     : 0.0000000000
                     : 0.0000000000
                     : -0.0500000000
                     : 3427927.7500000000
                     : 5793244.0000000000
                                </pre></div><div class="refsection"><a name="idp91365576"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_GeoReference" title="ST_GeoReference">ST_GeoReference</a>, <a class="xref" href="#RT_ST_SkewY" title="ST_SkewY">ST_SkewY</a>, <a class="xref" href="#RT_ST_SetSkew" title="ST_SetSkew">ST_SetSkew</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_SkewY"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SkewY — 空間参照のYスキュー (回転パラメータ)を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float8 <b class="fsfunc">ST_SkewY</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp91372104"></a><h2>説明</h2><p>空間参照のYスキュー (回転パラメータ)を返します。詳細については<a class="ulink" href="http://en.wikipedia.org/wiki/World_file" target="_top">World File</a> (英語版WikiPedia)を参照して下さい。</p></div><div class="refsection"><a name="idp91373768"></a><h2>例</h2><pre class="programlisting">SELECT rid, ST_SkewX(rast) As skewx, ST_SkewY(rast) As skewy,
    ST_GeoReference(rast) as georef
FROM dummy_rast;

 rid | skewx | skewy |       georef
-----+-------+-------+--------------------
   1 |     0 |     0 | 2.0000000000
                     : 0.0000000000
                     : 0.0000000000
                     : 3.0000000000
                     : 0.5000000000
                     : 0.5000000000
                     :
   2 |     0 |     0 | 0.0500000000
                     : 0.0000000000
                     : 0.0000000000
                     : -0.0500000000
                     : 3427927.7500000000
                     : 5793244.0000000000
                                </pre></div><div class="refsection"><a name="idp91375304"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_GeoReference" title="ST_GeoReference">ST_GeoReference</a>, <a class="xref" href="#RT_ST_SkewX" title="ST_SkewX">ST_SkewX</a>, <a class="xref" href="#RT_ST_SetSkew" title="ST_SetSkew">ST_SetSkew</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_SRID"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SRID — ラスタのspatial_ref_sysテーブルで定義されている空間参照系識別番号を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_SRID</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp91381832"></a><h2>説明</h2><p>ラスタのspatial_ref_sysテーブルで定義されている空間参照系識別番号を返します。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>空間参照を持たないラスタ/ジオメトリのSRIDは、以前は-1でしたがPostGIS 2.0以上では0になります。</p></td></tr></table></div></div><div class="refsection"><a name="idp91383496"></a><h2>例</h2><pre class="programlisting">SELECT ST_SRID(rast) As srid
FROM dummy_rast WHERE rid=1;

srid
----------------
0
                                </pre></div><div class="refsection"><a name="idp91385160"></a><h2>関連情報</h2><p><a class="xref" href="#spatial_ref_sys" title="4.3.1. SPATIAL_REF_SYSテーブルと空間参照系">「SPATIAL_REF_SYSテーブルと空間参照系」</a>, <a class="xref" href="#ST_SRID" title="ST_SRID">ST_SRID</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Summary"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Summary — ラスタの中身の概要が文字列で返されます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_Summary</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp91391304"></a><h2>説明</h2><p>ラスタの中身の概要が文字列で返されます。</p><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp91392840"></a><h2>例</h2><pre class="programlisting">SELECT ST_Summary(
        ST_AddBand(
                ST_AddBand(
                        ST_AddBand(
                                ST_MakeEmptyRaster(10, 10, 0, 0, 1, -1, 0, 0, 0)
                                , 1, '8BUI', 1, 0
                        )
                        , 2, '32BF', 0, -9999
                )
                , 3, '16BSI', 0, NULL
        )
);

                            st_summary
------------------------------------------------------------------
 Raster of 10x10 pixels has 3 bands and extent of BOX(0 -10,10 0)+
     band 1 of pixtype 8BUI is in-db with NODATA value of 0      +
     band 2 of pixtype 32BF is in-db with NODATA value of -9999  +
     band 3 of pixtype 16BSI is in-db with no NODATA value
(1 row)
                                </pre></div><div class="refsection"><a name="idp91394120"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_MetaData" title="ST_MetaData">ST_MetaData</a>, <a class="xref" href="#RT_ST_BandMetaData" title="ST_BandMetaData">ST_BandMetaData</a>, <a class="xref" href="#ST_Summary" title="ST_Summary">ST_Summary</a> <a class="xref" href="#ST_Extent" title="ST_Extent">ST_Extent</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_UpperLeftX"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_UpperLeftX — 適用されている空間参照系でのラスタの左上隅のX座標値を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float8 <b class="fsfunc">ST_UpperLeftX</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp91401160"></a><h2>説明</h2><p>適用されている空間参照系でのラスタの左上隅のX座標値を返します。</p></div><div class="refsection"><a name="idp91402312"></a><h2>例</h2><pre class="programlisting">SELECt rid, ST_UpperLeftX(rast) As ulx
FROM dummy_rast;

 rid |    ulx
-----+------------
   1 |        0.5
   2 | 3427927.75
                                </pre></div><div class="refsection"><a name="idp91403592"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_UpperLeftY" title="ST_UpperLeftY">ST_UpperLeftY</a>, <a class="xref" href="#RT_ST_GeoReference" title="ST_GeoReference">ST_GeoReference</a>, <a class="xref" href="#RT_Box3D" title="Box3D">Box3D</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_UpperLeftY"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_UpperLeftY — 適用されている空間参照系でのラスタの左上隅のY座標値を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float8 <b class="fsfunc">ST_UpperLeftY</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp91414216"></a><h2>説明</h2><p>適用されている空間参照系でのラスタの左上隅のY座標値を返します。</p></div><div class="refsection"><a name="idp91415368"></a><h2>例</h2><pre class="programlisting">SELECT rid, ST_UpperLeftY(rast) As uly
FROM dummy_rast;

 rid |   uly
-----+---------
   1 |     0.5
   2 | 5793244
                                </pre></div><div class="refsection"><a name="idp91416648"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_UpperLeftX" title="ST_UpperLeftX">ST_UpperLeftX</a>, <a class="xref" href="#RT_ST_GeoReference" title="ST_GeoReference">ST_GeoReference</a>, <a class="xref" href="#RT_Box3D" title="Box3D">Box3D</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Width"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Width — ラスタの幅をピクセル単位で返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_Width</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp91423176"></a><h2>説明</h2><p>ラスタの幅をピクセル単位で返します。</p></div><div class="refsection"><a name="idp91424328"></a><h2>例</h2><pre class="programlisting">SELECT ST_Width(rast) As rastwidth
FROM dummy_rast WHERE rid=1;

rastwidth
----------------
10
                                </pre></div><div class="refsection"><a name="idp91425992"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Height" title="ST_Height">ST_Height</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_WorldToRasterCoord"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_WorldToRasterCoord — ラスタの空間参照系による地理座標のX値とY値 (経度と緯度)またはポイントジオメトリに対応するピクセルの左上隅を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">record <b class="fsfunc">ST_WorldToRasterCoord</b>(</code>raster  <var class="pdparam">rast</var>, geometry  <var class="pdparam">pt</var><code>)</code>;</p><p><code class="funcdef">record <b class="fsfunc">ST_WorldToRasterCoord</b>(</code>raster  <var class="pdparam">rast</var>, double precision  <var class="pdparam">longitude</var>, double precision  <var class="pdparam">latitude</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp91437000"></a><h2>説明</h2><p>地理座標のX値とY値 (経度と緯度)またはポイントジオメトリに対応するピクセルの左上隅を返します。X値、Y値やポイントジオメトリがラスタの範囲外であるかないかにかかわらず動作します。地理座標のX値とY値はラスタの空間参照系で表現しなければなりません。 </p><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp91438536"></a><h2>例</h2><pre class="programlisting">SELECT
        rid,
        (ST_WorldToRasterCoord(rast,3427927.8,20.5)).*,
        (ST_WorldToRasterCoord(rast,ST_GeomFromText('POINT(3427927.8 20.5)',ST_SRID(rast)))).*
FROM dummy_rast;

 rid | columnx |   rowy    | columnx |   rowy
-----+---------+-----------+---------+-----------
   1 | 1713964 |         7 | 1713964 |         7
   2 |       2 | 115864471 |       2 | 115864471
                                </pre></div><div class="refsection"><a name="idp91440072"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_WorldToRasterCoordX" title="ST_WorldToRasterCoordX">ST_WorldToRasterCoordX</a>, <a class="xref" href="#RT_ST_WorldToRasterCoordY" title="ST_WorldToRasterCoordY">ST_WorldToRasterCoordY</a>, <a class="xref" href="#RT_ST_RasterToWorldCoordX" title="ST_RasterToWorldCoordX">ST_RasterToWorldCoordX</a>, <a class="xref" href="#RT_ST_RasterToWorldCoordY" title="ST_RasterToWorldCoordY">ST_RasterToWorldCoordY</a>, <a class="xref" href="#RT_ST_SRID" title="ST_SRID">ST_SRID</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_WorldToRasterCoordX"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_WorldToRasterCoordX — ラスタの空間参照系に基づくポイントジオメトリ (pt)またはX,Y座標値 (xw,yw)に対応するラスタの列を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_WorldToRasterCoordX</b>(</code>raster  <var class="pdparam">rast</var>, geometry  <var class="pdparam">pt</var><code>)</code>;</p><p><code class="funcdef">integer <b class="fsfunc">ST_WorldToRasterCoordX</b>(</code>raster  <var class="pdparam">rast</var>, double precision  <var class="pdparam">xw</var><code>)</code>;</p><p><code class="funcdef">integer <b class="fsfunc">ST_WorldToRasterCoordX</b>(</code>raster  <var class="pdparam">rast</var>, double precision  <var class="pdparam">xw</var>, double precision  <var class="pdparam">yw</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp91480520"></a><h2>説明</h2><p>ラスタの空間参照系に基づくポイントジオメトリ (pt)またはX,Y座標値 (xw,yw)に対応するラスタの列を返します。ラスタがスキューされている場合には、ポイントかxwとywの両方かが必要です。ラスタがスキューされていない場合には、xwを指定すれば十分です。ワールド座標系はラスタの空間参照系です。</p><p>Changed: 2.1.0 以前の版ではST_World2RasterCoordXと呼ばれていました。</p></div><div class="refsection"><a name="idp91482056"></a><h2>例</h2><pre class="programlisting">SELECT rid, ST_WorldToRasterCoordX(rast,3427927.8) As xcoord,
                ST_WorldToRasterCoordX(rast,3427927.8,20.5) As xcoord_xwyw,
                ST_WorldToRasterCoordX(rast,ST_GeomFromText('POINT(3427927.8 20.5)',ST_SRID(rast))) As ptxcoord
FROM dummy_rast;

 rid | xcoord  |  xcoord_xwyw   | ptxcoord
-----+---------+---------+----------
   1 | 1713964 | 1713964 |  1713964
   2 |       1 |       1 |        1
                                </pre></div><div class="refsection"><a name="idp91483592"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_RasterToWorldCoordX" title="ST_RasterToWorldCoordX">ST_RasterToWorldCoordX</a>, <a class="xref" href="#RT_ST_RasterToWorldCoordY" title="ST_RasterToWorldCoordY">ST_RasterToWorldCoordY</a>, <a class="xref" href="#RT_ST_SRID" title="ST_SRID">ST_SRID</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_WorldToRasterCoordY"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_WorldToRasterCoordY — ラスタの空間参照系に基づくポイントジオメトリ (pt)またはX,Y座標値 (xw,yw)に対応するラスタの行を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_WorldToRasterCoordY</b>(</code>raster  <var class="pdparam">rast</var>, geometry  <var class="pdparam">pt</var><code>)</code>;</p><p><code class="funcdef">integer <b class="fsfunc">ST_WorldToRasterCoordY</b>(</code>raster  <var class="pdparam">rast</var>, double precision  <var class="pdparam">xw</var><code>)</code>;</p><p><code class="funcdef">integer <b class="fsfunc">ST_WorldToRasterCoordY</b>(</code>raster  <var class="pdparam">rast</var>, double precision  <var class="pdparam">xw</var>, double precision  <var class="pdparam">yw</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp91498696"></a><h2>説明</h2><p>ラスタの空間参照系に基づくポイントジオメトリ (pt)またはX,Y座標値 (xw,yw)に対応するラスタの行を返します。ラスタがスキューされている場合には、ポイントかxwとywの両方かが必要です。ラスタがスキューされていない場合には、ywを指定すれば十分です。ワールド座標系はラスタの空間参照系です。</p><p>Changed: 2.1.0 以前の版ではST_World2RasterCoordYと呼ばれていました。</p></div><div class="refsection"><a name="idp91500232"></a><h2>例</h2><pre class="programlisting">SELECT rid, ST_WorldToRasterCoordY(rast,20.5) As ycoord,
                ST_WorldToRasterCoordY(rast,3427927.8,20.5) As ycoord_xwyw,
                ST_WorldToRasterCoordY(rast,ST_GeomFromText('POINT(3427927.8 20.5)',ST_SRID(rast))) As ptycoord
FROM dummy_rast;

 rid |  ycoord   | ycoord_xwyw | ptycoord
-----+-----------+-------------+-----------
   1 |         7 |           7 |         7
   2 | 115864471 |   115864471 | 115864471
                                </pre></div><div class="refsection"><a name="idp91501768"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_RasterToWorldCoordX" title="ST_RasterToWorldCoordX">ST_RasterToWorldCoordX</a>, <a class="xref" href="#RT_ST_RasterToWorldCoordY" title="ST_RasterToWorldCoordY">ST_RasterToWorldCoordY</a>, <a class="xref" href="#RT_ST_SRID" title="ST_SRID">ST_SRID</a></p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="RasterBand_Accessors"></a>9.5. ラスタバンドアクセサ</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#RT_ST_BandMetaData">ST_BandMetaData</a></span><span class="refpurpose"> — 指定したラスタバンドの基本的なメタデータを返します。バンド番号を指定しない場合には、1番と仮定します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_BandNoDataValue">ST_BandNoDataValue</a></span><span class="refpurpose"> — 指定されたバンドについてデータが無いことを表現する値を返します。バンド番号を指定しない場合には、1番と仮定します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_BandIsNoData">ST_BandIsNoData</a></span><span class="refpurpose"> — 指定したバンドがNODATA値だけで満たされている場合には、TRUEを返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_BandPath">ST_BandPath</a></span><span class="refpurpose"> — ファイルシステムに格納されているバンドのシステムファイルパスを返します。バンド番号が指定されていない場合には、1番と仮定します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_BandFileSize">ST_BandFileSize</a></span><span class="refpurpose"> — ファイルシステムに格納されているバンドのファイルサイズを返します。バンド番号が指定されていない場合には、1番と仮定します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_BandFileTimestamp">ST_BandFileTimestamp</a></span><span class="refpurpose"> — ファイルシステムに格納されているバンドのファイルタイムスタンプ返します。バンド番号が指定されていない場合には、1番と仮定します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_BandPixelType">ST_BandPixelType</a></span><span class="refpurpose"> — 指定したバンドのピクセルタイプを返します。バンド番号が指定されていない場合には、1番と仮定します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_HasNoBand">ST_HasNoBand</a></span><span class="refpurpose"> — 指定したバンド番号のバンドが無い場合には、TRUEを返します。バンド番号を指定していない場合には、1番と仮定します。</span></dt></dl></div><div class="refentry"><a name="RT_ST_BandMetaData"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_BandMetaData — 指定したラスタバンドの基本的なメタデータを返します。バンド番号を指定しない場合には、1番と仮定します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">(1) record <b class="fsfunc">ST_BandMetaData</b>(</code>raster <var class="pdparam">rast</var>, integer <var class="pdparam">band=1</var><code>)</code>;</p><p><code class="funcdef">(2) record <b class="fsfunc">ST_BandMetaData</b>(</code>raster <var class="pdparam">rast</var>, integer[] <var class="pdparam">band</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp91513160"></a><h2>説明</h2><p>指定したラスタバンドの基本的なメタデータを返します。返されるカラムは pixeltype, nodatavalue, isoutdb, path, outdbbandnum, filesize, filetimestamp です。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ラスタがバンドを持たない場合にはエラーが投げられます。 </p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>バンドにNODATA値が無い場合には、nodatavalueはNULLになります。 </p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>isoutdbがFALSEの場合には、path, outdbbandnum, filedizeおよびfiletimestampはNULLです。outdbのアクセスが禁止されているなら、filesizeとfiletimestampがNULLになります。 </p></td></tr></table></div><p>Enhanced: 2.5.0 outdbラスタに<span class="emphasis"><em>outdbbandnum</em></span>, <span class="emphasis"><em>filesize</em></span>と<span class="emphasis"><em>filetimestamp</em></span>を取り入れました。</p></div><div class="refsection"><a name="idp91518152"></a><h2>例: 一つ目の形式</h2><pre class="programlisting">SELECT
        rid,
        (foo.md).*
FROM (
        SELECT
                rid,
                ST_BandMetaData(rast, 1) AS md
        FROM dummy_rast
        WHERE rid=2
) As foo;

 rid | pixeltype | nodatavalue | isoutdb | path | outdbbandnum
-----+-----------+---- --------+---------+------+--------------
   2 | 8BUI      |           0 | f       |      |
                                </pre></div><div class="refsection"><a name="idp91519432"></a><h2>例: 二つ目の形式</h2><pre class="programlisting">WITH foo AS (
        SELECT
                ST_AddBand(NULL::raster, '/home/pele/devel/geo/postgis-git/raster/test/regress/loader/Projected.tif', NULL::int[]) AS rast
)
SELECT
        *
FROM ST_BandMetadata(
        (SELECT rast FROM foo),
         ARRAY[1,3,2]::int[]
);

 bandnum | pixeltype | nodatavalue | isoutdb |                                      path                                      | outdbbandnum  | filesize | filetimestamp |
---------+-----------+-------------+---------+--------------------------------------------------------------------------------+---------------+----------+---------------+-
       1 | 8BUI      |             | t       | /home/pele/devel/geo/postgis-git/raster/test/regress/loader/Projected.tif      |            1  |    12345 |    1521807257 |
       3 | 8BUI      |             | t       | /home/pele/devel/geo/postgis-git/raster/test/regress/loader/Projected.tif      |            3  |    12345 |    1521807257 |
       2 | 8BUI      |             | t       | /home/pele/devel/geo/postgis-git/raster/test/regress/loader/Projected.tif      |            2  |    12345 |    1521807257 |
                                </pre></div><div class="refsection"><a name="idp91520968"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_MetaData" title="ST_MetaData">ST_MetaData</a>, <a class="xref" href="#RT_ST_BandPixelType" title="ST_BandPixelType">ST_BandPixelType</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_BandNoDataValue"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_BandNoDataValue — 指定されたバンドについてデータが無いことを表現する値を返します。バンド番号を指定しない場合には、1番と仮定します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">double precision <b class="fsfunc">ST_BandNoDataValue</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">bandnum=1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp91528264"></a><h2>説明</h2><p>指定されたバンドについてデータが無いことを表現する値を返します。</p></div><div class="refsection"><a name="idp91529416"></a><h2>例</h2><pre class="programlisting">SELECT ST_BandNoDataValue(rast,1) As bnval1,
    ST_BandNoDataValue(rast,2) As bnval2, ST_BandNoDataValue(rast,3) As bnval3
FROM dummy_rast
WHERE rid = 2;

 bnval1 | bnval2 | bnval3
--------+--------+--------
      0 |      0 |      0
                                </pre></div><div class="refsection"><a name="idp91530696"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_NumBands" title="ST_NumBands">ST_NumBands</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_BandIsNoData"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_BandIsNoData — 指定したバンドがNODATA値だけで満たされている場合には、TRUEを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_BandIsNoData</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">band</var>, boolean  <var class="pdparam">forceChecking=true</var><code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">ST_BandIsNoData</b>(</code>raster  <var class="pdparam">rast</var>, boolean  <var class="pdparam">forceChecking=true</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp91541960"></a><h2>説明</h2><p>指定したバンドがNODATA値だけで満たされている場合には、TRUEを返します。バンド番号を指定しない場合には、1番と仮定します。最後の引数がTRUEの場合には、全バンドについてピクセル毎に調べます。他の場合には、isnodataフラグの値を返すだけです。この引数を指定しない場合のデフォルト値はFALSEです。</p><p>Availability: 2.0.0</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>フラグが汚れている (最後の引数をTRUEにした場合としない場合とで結果が違う)場合には、ST_SetBandIsNodata関数、または最後の引数をTRUEにしたST_BandNodataValue関数を使って、フラグにTRUEを設定するためにラスタを更新するべきです。<a class="xref" href="#RT_ST_SetBandIsNoData" title="ST_SetBandIsNoData">ST_SetBandIsNoData</a>を参照して下さい。</p></td></tr></table></div></div><div class="refsection"><a name="idp91544648"></a><h2>例</h2><pre class="programlisting">-- 一つのラスタカラムを持つダミーテーブルの生成
create table dummy_rast (rid integer, rast raster);

-- 2バンドでバンドごとに1ピクセルを持つラスタを追加します。
-- 一つ目のバンドにはnodatavalueとピクセル値をともに3とし、
-- 二つ目のバンドにはnodatavalue=13とピクセル値=4とします。
insert into dummy_rast values(1,
(
'01' -- little endian - リトルエンディアン (uint8 ndr)
||
'0000' -- version - 版 (uint16 0)
||
'0200' -- nBands - バンド数 (uint16 0)
||
'17263529ED684A3F' -- scaleX - X方向セルサイズ (float64 0.000805965234044584)
||
'F9253529ED684ABF' -- scaleY - Y方向セルサイズ (float64 -0.00080596523404458)
||
'1C9F33CE69E352C0' -- ipX - 左上隅X値 (float64 -75.5533328537098)
||
'718F0E9A27A44840' -- ipY - 左上隅Y値 (float64 49.2824585505576)
||
'ED50EB853EC32B3F' -- skewX - スキューX (float64 0.000211812383858707)
||
'7550EB853EC32B3F' -- skewY - スキューY (float64 0.000211812383858704)
||
'E6100000' -- SRID (int32 4326)
||
'0100' -- width - 横セル数 (uint16 1)
||
'0100' -- height - 縦セル数 (uint16 1)
||
'6' -- hasnodatavalueとisnodataの値をtrueにする。
||
'2' -- 1番バンドのタイプ (4BUI)
||
'03' -- NODATA値==3
||
'03' -- 0列0行ピクセルの値==3 (NODATA値と同じ)
||
'0' -- hasnodatavalueをFALSEにする。
||
'5' -- 2番バンドのタイプ (16BSI)
||
'0D00' -- NODATA値==13
||
'0400' -- 0列0行ピクセルの値==4
)::raster
);

select st_bandisnodata(rast, 1) from dummy_rast where rid = 1; -- Expected true
select st_bandisnodata(rast, 2) from dummy_rast where rid = 1; -- Expected false
                        </pre></div><div class="refsection"><a name="idp91545928"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_BandNoDataValue" title="ST_BandNoDataValue">ST_BandNoDataValue</a>, <a class="xref" href="#RT_ST_NumBands" title="ST_NumBands">ST_NumBands</a>, <a class="xref" href="#RT_ST_SetBandNoDataValue" title="ST_SetBandNoDataValue">ST_SetBandNoDataValue</a>, <a class="xref" href="#RT_ST_SetBandIsNoData" title="ST_SetBandIsNoData">ST_SetBandIsNoData</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_BandPath"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_BandPath — ファイルシステムに格納されているバンドのシステムファイルパスを返します。バンド番号が指定されていない場合には、1番と仮定します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_BandPath</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">bandnum=1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp91558088"></a><h2>説明</h2><p>バンドへのシステムファイルパスを返します。データベース内に格納されているバンドでこの関数を呼んだ場合にはエラーが投げられます。</p></div><div class="refsection"><a name="idp91559240"></a><h2>例</h2><pre class="programlisting">
                                        </pre></div><div class="refsection"><a name="idp91560648"></a><h2>関連情報</h2><p></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_BandFileSize"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_BandFileSize — ファイルシステムに格納されているバンドのファイルサイズを返します。バンド番号が指定されていない場合には、1番と仮定します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">bigint <b class="fsfunc">ST_BandFileSize</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">bandnum=1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp91567304"></a><h2>説明</h2><p>ファイルシステムに格納されているバンドのファイルサイズを返します。データベース内バンドを与えるか、データベース外バンドにアクセスできない場合にはエラーが投げられます。</p><p>この関数は一般的にST_BandPath()とST_BandFileTimestamp()とを併用して、データベース外ラスタのファイル名が、この関数から見えるものとサーバから見えるものと同じかどうかを判断することができます。</p><p>Availability: 2.5.0</p></div><div class="refsection"><a name="idp91569224"></a><h2>例</h2><pre class="programlisting">SELECT ST_BandFileSize(rast,1) FROM dummy_rast WHERE rid = 1;

 st_bandfilesize
-----------------
          240574
                                </pre></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_BandFileTimestamp"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_BandFileTimestamp — ファイルシステムに格納されているバンドのファイルタイムスタンプ返します。バンド番号が指定されていない場合には、1番と仮定します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">bigint <b class="fsfunc">ST_BandFileTimestamp</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">bandnum=1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp91576136"></a><h2>説明</h2><p>ファイルシステムに保存されているバンドのファイルタイムスタンプを返します (UTC 1970年1月1日 0時0分0秒からの秒数)。データベース内バンドの場合またはデータベース外ラスタへのアクセスが無効な場合にはエラーが投げられます。</p><p>この関数は通常、ST_BandPath() および ST_BandFileSize() と組み合わせて使用されるため、クライアントは、outdb ラスタのファイル名がサーバーによって見られるものと同じであるかどうかを判断できます。</p><p>Availability: 2.5.0</p></div><div class="refsection"><a name="idp91578056"></a><h2>例</h2><pre class="programlisting">SELECT ST_BandFileTimestamp(rast,1) FROM dummy_rast WHERE rid = 1;

 st_bandfiletimestamp
----------------------
           1521807257
                                </pre></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_BandPixelType"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_BandPixelType — 指定したバンドのピクセルタイプを返します。バンド番号が指定されていない場合には、1番と仮定します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_BandPixelType</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">bandnum=1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp91584968"></a><h2>説明</h2><p>指定されたバンドについてデータが無いことを表現する値を返します。</p><p>ピクセルタイプは11通りあります。対応しているピクセルタイプは次の通りです。 </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>1BB - 1ビット真偽値</p></li><li class="listitem"><p>2BUI - 2ビット符号なし整数</p></li><li class="listitem"><p>4BUI - 4ビット符号なし整数 </p></li><li class="listitem"><p>8BSI - 8ビット整数 </p></li><li class="listitem"><p>8BUI - 8ビット符号なし整数</p></li><li class="listitem"><p>16BSI - 16ビット整数</p></li><li class="listitem"><p>16BUI - 16ビット符号なし整数</p></li><li class="listitem"><p>32BSI - 32ビット整数</p></li><li class="listitem"><p>32BUI - 32ビット符号なし整数</p></li><li class="listitem"><p>32BF - 32ビット浮動小数点数</p></li><li class="listitem"><p>64BF - 64ビット浮動小数点数</p></li></ul></div><p>
				</p></div><div class="refsection"><a name="idp91595336"></a><h2>例</h2><pre class="programlisting">SELECT ST_BandPixelType(rast,1) As btype1,
    ST_BandPixelType(rast,2) As btype2, ST_BandPixelType(rast,3) As btype3
FROM dummy_rast
WHERE rid = 2;

 btype1 | btype2 | btype3
--------+--------+--------
 8BUI   | 8BUI   | 8BUI
                                </pre></div><div class="refsection"><a name="idp91596616"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_NumBands" title="ST_NumBands">ST_NumBands</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_HasNoBand"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_HasNoBand — 指定したバンド番号のバンドが無い場合には、TRUEを返します。バンド番号を指定していない場合には、1番と仮定します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_HasNoBand</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">bandnum=1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp91603400"></a><h2>説明</h2><p>指定したバンド番号のバンドが無い場合には、TRUEを返します。バンド番号を指定していない場合には、1番と仮定します。</p><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp91604936"></a><h2>例</h2><pre class="programlisting">SELECT rid, ST_HasNoBand(rast) As hb1, ST_HasNoBand(rast,2) as hb2,
ST_HasNoBand(rast,4) as hb4, ST_NumBands(rast) As numbands
FROM dummy_rast;

rid | hb1 | hb2 | hb4 | numbands
-----+-----+-----+-----+----------
1 | t   | t   | t   |        0
2 | f   | f   | t   |        3
                        </pre></div><div class="refsection"><a name="idp91606216"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_NumBands" title="ST_NumBands">ST_NumBands</a></p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Raster_Pixel_Accessors"></a>9.6. ラスタピクセルアクセサとセッター</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#RT_ST_PixelAsPolygon">ST_PixelAsPolygon</a></span><span class="refpurpose"> — 指定した行と列のピクセルの境界となるジオメトリを返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_PixelAsPolygons">ST_PixelAsPolygons</a></span><span class="refpurpose"> — 全てのピクセルについて境界となるジオメトリを、ピクセルごとのピクセル値とラスタ座標系のXとYとを付けて返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_PixelAsPoint">ST_PixelAsPoint</a></span><span class="refpurpose"> — ピクセルの左上隅のポイントジオメトリを返します。 </span></dt><dt><span class="refentrytitle"><a href="#RT_ST_PixelAsPoints">ST_PixelAsPoints</a></span><span class="refpurpose"> — 全てのピクセルについてポイントジオメトリを、ピクセルごとのピクセル値とラスタ座標系のXとYとを付けて返します。ポイントジオメトリの座標はピクセルの左上隅です。 </span></dt><dt><span class="refentrytitle"><a href="#RT_ST_PixelAsCentroid">ST_PixelAsCentroid</a></span><span class="refpurpose"> — ピクセルで表現される面の重心 (ポイントジオメトリ)を返します。 </span></dt><dt><span class="refentrytitle"><a href="#RT_ST_PixelAsCentroids">ST_PixelAsCentroids</a></span><span class="refpurpose"> — 全てのピクセルについて重心 (ポイントジオメト)リを、ピクセルごとのピクセル値とラスタ座標系のXとYとを付けて返します。ポイントジオメトリの座標はピクセルで表現される面の重心です。 </span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Value">ST_Value</a></span><span class="refpurpose"> — 指定したバンドにおけるcolumnx, rowyで指定したピクセルまたは指定したジオメトリポイントに対応するピクセルの値を返します。 バンド番号は1始まりで、指定しない場合には、1番と仮定します。<code class="varname">exclude_nodata_value</code>がFALSEに設定された場合には、NODATAピクセルを含む全てのピクセルがインタセクトするかが考慮され、値を返します。<code class="varname">exclude_nodata_value</code>を渡さない場合には、ラスタのメタデータから読みます。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_NearestValue">ST_NearestValue</a></span><span class="refpurpose"> — 与えられたバンドの、columnxとrowyで指定されるか、またはラスタと同じ空間参照系で表現されたポイントで指定されたピクセルに最も近い<code class="varname">NODATA</code>でない値を返します。 </span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Neighborhood">ST_Neighborhood</a></span><span class="refpurpose"> — 与えられたバンドのcolumnX, columnYか、ラスタと同じ空間参照系のジオメトリポイントで指定されたピクセルの周囲にある、<code class="varname">NODATA</code>でない2次元倍精度浮動小数点数配列を返します。 </span></dt><dt><span class="refentrytitle"><a href="#RT_ST_SetValue">ST_SetValue</a></span><span class="refpurpose"> — 与えられたバンドのcolumnX, columnYか、ラスタと同じ空間参照系のジオメトリポイントで指定されたピクセルの値または指定したジオメトリとインタセクトするピクセル群の値を設定することから得られる、変更されたラスタを返します。バンド番号は1始まりで、指定しない場合には、1番と仮定します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_SetValues">ST_SetValues</a></span><span class="refpurpose"> — 与えられたバンドに複数の値を設定して、変更されたラスタを返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_DumpValues">ST_DumpValues</a></span><span class="refpurpose"> — 指定したバンドの値を2次元で得ます。 </span></dt><dt><span class="refentrytitle"><a href="#RT_ST_PixelOfValue">ST_PixelOfValue</a></span><span class="refpurpose"> — 検索値と同じ値を持つピクセルのcolumnx, rowyピクセル座標を得ます。 </span></dt></dl></div><div class="refentry"><a name="RT_ST_PixelAsPolygon"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_PixelAsPolygon — 指定した行と列のピクセルの境界となるジオメトリを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_PixelAsPolygon</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">columnx</var>, integer  <var class="pdparam">rowy</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp91614920"></a><h2>説明</h2><p>指定した行と列のピクセルの境界となるジオメトリを返します。</p><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp91616456"></a><h2>例</h2><pre class="programlisting">-- ラスタピクセルのポリゴンを得ます
SELECT i,j, ST_AsText(ST_PixelAsPolygon(foo.rast, i,j)) As b1pgeom
FROM dummy_rast As foo
        CROSS JOIN generate_series(1,2) As i
        CROSS JOIN generate_series(1,1) As j
WHERE rid=2;

 i | j |                                                    b1pgeom
---+---+-----------------------------------------------------------------------------
 1 | 1 | POLYGON((3427927.75 5793244,3427927.8 5793244,3427927.8 5793243.95,...
 2 | 1 | POLYGON((3427927.8 5793244,3427927.85 5793244,3427927.85 5793243.95, ..
  </pre></div><div class="refsection"><a name="idp91617736"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_DumpAsPolygons" title="ST_DumpAsPolygons">ST_DumpAsPolygons</a>, <a class="xref" href="#RT_ST_PixelAsPolygons" title="ST_PixelAsPolygons">ST_PixelAsPolygons</a>, <a class="xref" href="#RT_ST_PixelAsPoint" title="ST_PixelAsPoint">ST_PixelAsPoint</a>, <a class="xref" href="#RT_ST_PixelAsPoints" title="ST_PixelAsPoints">ST_PixelAsPoints</a>, <a class="xref" href="#RT_ST_PixelAsCentroid" title="ST_PixelAsCentroid">ST_PixelAsCentroid</a>, <a class="xref" href="#RT_ST_PixelAsCentroids" title="ST_PixelAsCentroids">ST_PixelAsCentroids</a>, <a class="xref" href="#RT_ST_Intersection" title="ST_Intersection">ST_Intersection</a>, <a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_PixelAsPolygons"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_PixelAsPolygons — 全てのピクセルについて境界となるジオメトリを、ピクセルごとのピクセル値とラスタ座標系のXとYとを付けて返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">setof record <b class="fsfunc">ST_PixelAsPolygons</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">band=1</var>, boolean  <var class="pdparam">exclude_nodata_value=TRUE</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp91628616"></a><h2>説明</h2><p>全てのピクセルについて境界となるジオメトリを、ピクセルごとのピクセル値 (倍精度浮動小数点数)とラスタ座標系のXとY (ともに整数)とを付けて返します。</p><p>返されるレコードの書式は、<a class="xref" href="#geometry" title="geometry">geometry</a>型の<em class="parameter"><code>geom</code></em>、倍精度浮動小数点数の<em class="parameter"><code>val</code></em>、整数の<em class="parameter"><code>x</code></em>、整数の<em class="parameter"><code>y</code></em>です。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><em class="parameter"><code>exclude_nodata_value</code></em>がTRUEの時、値がNODATAでないこれらのピクセルだけをポイントとして返します。 </p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_PixelAsPolygonsは、ピクセルごとに一つのポリゴンジオメトリを返します。ST_DumpAsPolygonsとは、 一つのジオメトリが同じ値となる一つ以上のピクセルを表現する点で違います。 </p></td></tr></table></div><p>Availability: 2.0.0</p><p>Enhanced: 2.1.0 任意引数exclude_nodata_valueが追加されました。</p><p>Changed: 2.1.1 exclude_nodata_valueの挙動を変更しました。</p></div><div class="refsection"><a name="idp91635656"></a><h2>例</h2><pre class="programlisting">-- ラスタピクセルのポリゴンを得ます
SELECT (gv).x, (gv).y, (gv).val, ST_AsText((gv).geom) geom
FROM (SELECT ST_PixelAsPolygons(
                 ST_SetValue(ST_SetValue(ST_AddBand(ST_MakeEmptyRaster(2, 2, 0, 0, 0.001, -0.001, 0.001, 0.001, 4269),
                                                    '8BUI'::text, 1, 0),
                                         2, 2, 10),
                             1, 1, NULL)
) gv
) foo;

 x | y | val |                geom
---+---+-----------------------------------------------------------------------------
 1 | 1 |     | POLYGON((0 0,0.001 0.001,0.002 0,0.001 -0.001,0 0))
 1 | 2 |   1 | POLYGON((0.001 -0.001,0.002 0,0.003 -0.001,0.002 -0.002,0.001 -0.001))
 2 | 1 |   1 | POLYGON((0.001 0.001,0.002 0.002,0.003 0.001,0.002 0,0.001 0.001))
 2 | 2 |  10 | POLYGON((0.002 0,0.003 0.001,0.004 0,0.003 -0.001,0.002 0))
  </pre></div><div class="refsection"><a name="idp91636936"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_DumpAsPolygons" title="ST_DumpAsPolygons">ST_DumpAsPolygons</a>, <a class="xref" href="#RT_ST_PixelAsPolygon" title="ST_PixelAsPolygon">ST_PixelAsPolygon</a>, <a class="xref" href="#RT_ST_PixelAsPoint" title="ST_PixelAsPoint">ST_PixelAsPoint</a>, <a class="xref" href="#RT_ST_PixelAsPoints" title="ST_PixelAsPoints">ST_PixelAsPoints</a>, <a class="xref" href="#RT_ST_PixelAsCentroid" title="ST_PixelAsCentroid">ST_PixelAsCentroid</a>, <a class="xref" href="#RT_ST_PixelAsCentroids" title="ST_PixelAsCentroids">ST_PixelAsCentroids</a>, <a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_PixelAsPoint"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_PixelAsPoint — ピクセルの左上隅のポイントジオメトリを返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_PixelAsPoint</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">columnx</var>, integer  <var class="pdparam">rowy</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp91651272"></a><h2>説明</h2><p>ピクセルの左上隅のポイントジオメトリを返します。</p><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp91652808"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(ST_PixelAsPoint(rast, 1, 1)) FROM dummy_rast WHERE rid = 1;

   st_astext
----------------
 POINT(0.5 0.5)
                                </pre></div><div class="refsection"><a name="idp91654088"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_DumpAsPolygons" title="ST_DumpAsPolygons">ST_DumpAsPolygons</a>, <a class="xref" href="#RT_ST_PixelAsPolygon" title="ST_PixelAsPolygon">ST_PixelAsPolygon</a>, <a class="xref" href="#RT_ST_PixelAsPolygons" title="ST_PixelAsPolygons">ST_PixelAsPolygons</a>, <a class="xref" href="#RT_ST_PixelAsPoints" title="ST_PixelAsPoints">ST_PixelAsPoints</a>, <a class="xref" href="#RT_ST_PixelAsCentroid" title="ST_PixelAsCentroid">ST_PixelAsCentroid</a>, <a class="xref" href="#RT_ST_PixelAsCentroids" title="ST_PixelAsCentroids">ST_PixelAsCentroids</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_PixelAsPoints"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_PixelAsPoints — 全てのピクセルについてポイントジオメトリを、ピクセルごとのピクセル値とラスタ座標系のXとYとを付けて返します。ポイントジオメトリの座標はピクセルの左上隅です。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">setof record <b class="fsfunc">ST_PixelAsPoints</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">band=1</var>, boolean  <var class="pdparam">exclude_nodata_value=TRUE</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp91664200"></a><h2>説明</h2><p>全てのピクセルについてポイントジオメトリを、ピクセルごとのピクセル値とラスタ座標系のXとYとを付けて返します。ポイントジオメトリの座標はピクセルの左上隅です。 </p><p>返されるレコードの書式は、<a class="xref" href="#geometry" title="geometry">geometry</a>型の<em class="parameter"><code>geom</code></em>、倍精度浮動小数点数の<em class="parameter"><code>val</code></em>、整数の<em class="parameter"><code>x</code></em>、整数の<em class="parameter"><code>y</code></em>です。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><em class="parameter"><code>exclude_nodata_value</code></em>がTRUEの時、値がNODATAでないこれらのピクセルだけをポイントとして返します。 </p></td></tr></table></div><p>Availability: 2.1.0</p><p>Changed: 2.1.1 exclude_nodata_valueの挙動を変更しました。</p></div><div class="refsection"><a name="idp91670088"></a><h2>例</h2><pre class="programlisting">SELECT x, y, val, ST_AsText(geom) FROM (SELECT (ST_PixelAsPoints(rast, 1)).* FROM dummy_rast WHERE rid = 2) foo;

 x | y | val |          st_astext
---+---+-----+------------------------------
 1 | 1 | 253 | POINT(3427927.75 5793244)
 2 | 1 | 254 | POINT(3427927.8 5793244)
 3 | 1 | 253 | POINT(3427927.85 5793244)
 4 | 1 | 254 | POINT(3427927.9 5793244)
 5 | 1 | 254 | POINT(3427927.95 5793244)
 1 | 2 | 253 | POINT(3427927.75 5793243.95)
 2 | 2 | 254 | POINT(3427927.8 5793243.95)
 3 | 2 | 254 | POINT(3427927.85 5793243.95)
 4 | 2 | 253 | POINT(3427927.9 5793243.95)
 5 | 2 | 249 | POINT(3427927.95 5793243.95)
 1 | 3 | 250 | POINT(3427927.75 5793243.9)
 2 | 3 | 254 | POINT(3427927.8 5793243.9)
 3 | 3 | 254 | POINT(3427927.85 5793243.9)
 4 | 3 | 252 | POINT(3427927.9 5793243.9)
 5 | 3 | 249 | POINT(3427927.95 5793243.9)
 1 | 4 | 251 | POINT(3427927.75 5793243.85)
 2 | 4 | 253 | POINT(3427927.8 5793243.85)
 3 | 4 | 254 | POINT(3427927.85 5793243.85)
 4 | 4 | 254 | POINT(3427927.9 5793243.85)
 5 | 4 | 253 | POINT(3427927.95 5793243.85)
 1 | 5 | 252 | POINT(3427927.75 5793243.8)
 2 | 5 | 250 | POINT(3427927.8 5793243.8)
 3 | 5 | 254 | POINT(3427927.85 5793243.8)
 4 | 5 | 254 | POINT(3427927.9 5793243.8)
 5 | 5 | 254 | POINT(3427927.95 5793243.8)
                                </pre></div><div class="refsection"><a name="idp91671368"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_DumpAsPolygons" title="ST_DumpAsPolygons">ST_DumpAsPolygons</a>, <a class="xref" href="#RT_ST_PixelAsPolygon" title="ST_PixelAsPolygon">ST_PixelAsPolygon</a>, <a class="xref" href="#RT_ST_PixelAsPolygons" title="ST_PixelAsPolygons">ST_PixelAsPolygons</a>, <a class="xref" href="#RT_ST_PixelAsPoint" title="ST_PixelAsPoint">ST_PixelAsPoint</a>, <a class="xref" href="#RT_ST_PixelAsCentroid" title="ST_PixelAsCentroid">ST_PixelAsCentroid</a>, <a class="xref" href="#RT_ST_PixelAsCentroids" title="ST_PixelAsCentroids">ST_PixelAsCentroids</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_PixelAsCentroid"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_PixelAsCentroid — ピクセルで表現される面の重心 (ポイントジオメトリ)を返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_PixelAsCentroid</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">x</var>, integer  <var class="pdparam">y</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp91681224"></a><h2>説明</h2><p>ピクセルで表現される面の重心 (ポイントジオメトリ)を返します。</p><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp91682760"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsText(ST_PixelAsCentroid(rast, 1, 1)) FROM dummy_rast WHERE rid = 1;

  st_astext
--------------
 POINT(1.5 2)
                                </pre></div><div class="refsection"><a name="idp91684040"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_DumpAsPolygons" title="ST_DumpAsPolygons">ST_DumpAsPolygons</a>, <a class="xref" href="#RT_ST_PixelAsPolygon" title="ST_PixelAsPolygon">ST_PixelAsPolygon</a>, <a class="xref" href="#RT_ST_PixelAsPolygons" title="ST_PixelAsPolygons">ST_PixelAsPolygons</a>, <a class="xref" href="#RT_ST_PixelAsPoint" title="ST_PixelAsPoint">ST_PixelAsPoint</a>, <a class="xref" href="#RT_ST_PixelAsPoints" title="ST_PixelAsPoints">ST_PixelAsPoints</a>, <a class="xref" href="#RT_ST_PixelAsCentroids" title="ST_PixelAsCentroids">ST_PixelAsCentroids</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_PixelAsCentroids"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_PixelAsCentroids — 全てのピクセルについて重心 (ポイントジオメト)リを、ピクセルごとのピクセル値とラスタ座標系のXとYとを付けて返します。ポイントジオメトリの座標はピクセルで表現される面の重心です。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">setof record <b class="fsfunc">ST_PixelAsCentroids</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">band=1</var>, boolean  <var class="pdparam">exclude_nodata_value=TRUE</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp91694152"></a><h2>説明</h2><p>全てのピクセルについて重心 (ポイントジオメト)リを、ピクセルごとのピクセル値とラスタ座標系のXとYとを付けて返します。ポイントジオメトリの座標はピクセルで表現される面の重心です。 </p><p>返されるレコードの書式は、<a class="xref" href="#geometry" title="geometry">geometry</a>型の<em class="parameter"><code>geom</code></em>、倍精度浮動小数点数の<em class="parameter"><code>val</code></em>、整数の<em class="parameter"><code>x</code></em>、整数の<em class="parameter"><code>y</code></em>です。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><em class="parameter"><code>exclude_nodata_value</code></em>がTRUEの時、値がNODATAでないこれらのピクセルだけをポイントとして返します。 </p></td></tr></table></div><p>Availability: 2.1.0</p><p>Changed: 2.1.1 exclude_nodata_valueの挙動を変更しました。</p></div><div class="refsection"><a name="idp91700040"></a><h2>例</h2><pre class="programlisting">-- LATERAL句を使うにはPostgreSQL 9.3以上が必要です
SELECT x, y, val, ST_AsText(geom)
        FROM (SELECT dp.* FROM dummy_rast, LATERAL ST_PixelAsCentroids(rast, 1) AS dp WHERE rid = 2) foo;
 x | y | val |           st_astext
---+---+-----+--------------------------------
 1 | 1 | 253 | POINT(3427927.775 5793243.975)
 2 | 1 | 254 | POINT(3427927.825 5793243.975)
 3 | 1 | 253 | POINT(3427927.875 5793243.975)
 4 | 1 | 254 | POINT(3427927.925 5793243.975)
 5 | 1 | 254 | POINT(3427927.975 5793243.975)
 1 | 2 | 253 | POINT(3427927.775 5793243.925)
 2 | 2 | 254 | POINT(3427927.825 5793243.925)
 3 | 2 | 254 | POINT(3427927.875 5793243.925)
 4 | 2 | 253 | POINT(3427927.925 5793243.925)
 5 | 2 | 249 | POINT(3427927.975 5793243.925)
 1 | 3 | 250 | POINT(3427927.775 5793243.875)
 2 | 3 | 254 | POINT(3427927.825 5793243.875)
 3 | 3 | 254 | POINT(3427927.875 5793243.875)
 4 | 3 | 252 | POINT(3427927.925 5793243.875)
 5 | 3 | 249 | POINT(3427927.975 5793243.875)
 1 | 4 | 251 | POINT(3427927.775 5793243.825)
 2 | 4 | 253 | POINT(3427927.825 5793243.825)
 3 | 4 | 254 | POINT(3427927.875 5793243.825)
 4 | 4 | 254 | POINT(3427927.925 5793243.825)
 5 | 4 | 253 | POINT(3427927.975 5793243.825)
 1 | 5 | 252 | POINT(3427927.775 5793243.775)
 2 | 5 | 250 | POINT(3427927.825 5793243.775)
 3 | 5 | 254 | POINT(3427927.875 5793243.775)
 4 | 5 | 254 | POINT(3427927.925 5793243.775)
 5 | 5 | 254 | POINT(3427927.975 5793243.775)
                                </pre></div><div class="refsection"><a name="idp91701320"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_DumpAsPolygons" title="ST_DumpAsPolygons">ST_DumpAsPolygons</a>, <a class="xref" href="#RT_ST_PixelAsPolygon" title="ST_PixelAsPolygon">ST_PixelAsPolygon</a>, <a class="xref" href="#RT_ST_PixelAsPolygons" title="ST_PixelAsPolygons">ST_PixelAsPolygons</a>, <a class="xref" href="#RT_ST_PixelAsPoint" title="ST_PixelAsPoint">ST_PixelAsPoint</a>, <a class="xref" href="#RT_ST_PixelAsPoints" title="ST_PixelAsPoints">ST_PixelAsPoints</a>, <a class="xref" href="#RT_ST_PixelAsCentroid" title="ST_PixelAsCentroid">ST_PixelAsCentroid</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Value"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Value — 指定したバンドにおけるcolumnx, rowyで指定したピクセルまたは指定したジオメトリポイントに対応するピクセルの値を返します。 バンド番号は1始まりで、指定しない場合には、1番と仮定します。<code class="varname">exclude_nodata_value</code>がFALSEに設定された場合には、NODATAピクセルを含む全てのピクセルがインタセクトするかが考慮され、値を返します。<code class="varname">exclude_nodata_value</code>を渡さない場合には、ラスタのメタデータから読みます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">double precision <b class="fsfunc">ST_Value</b>(</code>raster  <var class="pdparam">rast</var>, geometry  <var class="pdparam">pt</var>, boolean  <var class="pdparam">exclude_nodata_value=true</var><code>)</code>;</p><p><code class="funcdef">double precision <b class="fsfunc">ST_Value</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">band</var>, geometry  <var class="pdparam">pt</var>, boolean  <var class="pdparam">exclude_nodata_value=true</var><code>)</code>;</p><p><code class="funcdef">double precision <b class="fsfunc">ST_Value</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">x</var>, integer  <var class="pdparam">y</var>, boolean  <var class="pdparam">exclude_nodata_value=true</var><code>)</code>;</p><p><code class="funcdef">double precision <b class="fsfunc">ST_Value</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">band</var>, integer  <var class="pdparam">x</var>, integer  <var class="pdparam">y</var>, boolean  <var class="pdparam">exclude_nodata_value=true</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp91761992"></a><h2>説明</h2><p>指定したバンドにおけるcolumnx, rowyで指定したピクセルまたは指定したジオメトリポイントに対応するピクセルの値を返します。 バンド番号は1始まりで、指定しない場合には、1番と仮定します。<code class="varname">exclude_nodata_value</code>がTRUEに設定された場合には、非NODATAピクセルのみが考慮されます。<code class="varname">exclude_nodata_value</code>がFALSEに設定された場合には、全てのピクセルが考慮されます。</p><p>Enhanced: 2.0.0 任意引数exclude_nodata_valueが追加されました。</p></div><div class="refsection"><a name="idp91764296"></a><h2>例</h2><pre class="programlisting">-- PostGISジオメトリポイントを指定してラスタの値を得ます
-- ジオメトリのSRIDはラスタと同じにします
SELECT rid, ST_Value(rast, foo.pt_geom) As b1pval, ST_Value(rast, 2, foo.pt_geom) As b2pval
FROM dummy_rast CROSS JOIN (SELECT ST_SetSRID(ST_Point(3427927.77, 5793243.76), 0) As pt_geom) As foo
WHERE rid=2;

 rid | b1pval | b2pval
-----+--------+--------
   2 |    252 |     79


-- 実際のテーブルを使った一般的な架空の例
SELECT rid, ST_Value(rast, 3, sometable.geom) As b3pval
FROM sometable
WHERE ST_Intersects(rast,sometable.geom);
                                </pre><pre class="programlisting">SELECT rid, ST_Value(rast, 1, 1, 1) As b1pval,
    ST_Value(rast, 2, 1, 1) As b2pval, ST_Value(rast, 3, 1, 1) As b3pval
FROM dummy_rast
WHERE rid=2;

 rid | b1pval | b2pval | b3pval
-----+--------+--------+--------
   2 |    253 |     78 |     70
                                </pre><pre class="programlisting">-- 1番、2番、3番バンドの全ての値を得ます
SELECT x, y, ST_Value(rast, 1, x, y) As b1val,
        ST_Value(rast, 2, x, y) As b2val, ST_Value(rast, 3, x, y) As b3val
FROM dummy_rast CROSS JOIN
generate_series(1, 1000) As x CROSS JOIN generate_series(1, 1000) As y
WHERE rid =  2 AND x &lt;= ST_Width(rast) AND y &lt;= ST_Height(rast);

 x | y | b1val | b2val | b3val
---+---+-------+-------+-------
 1 | 1 |   253 |    78 |    70
 1 | 2 |   253 |    96 |    80
 1 | 3 |   250 |    99 |    90
 1 | 4 |   251 |    89 |    77
 1 | 5 |   252 |    79 |    62
 2 | 1 |   254 |    98 |    86
 2 | 2 |   254 |   118 |   108
 :
 :
                                </pre><pre class="programlisting">-- 上の例と同じに、1番、2番、3番バンドの全ての値を得ますが、
-- ピクセル毎の左上隅のポイントを返します
SELECT ST_AsText(ST_SetSRID(
        ST_Point(ST_UpperLeftX(rast) + ST_ScaleX(rast)*x,
                ST_UpperLeftY(rast) + ST_ScaleY(rast)*y),
                ST_SRID(rast))) As uplpt
    , ST_Value(rast, 1, x, y) As b1val,
        ST_Value(rast, 2, x, y) As b2val, ST_Value(rast, 3, x, y) As b3val
FROM dummy_rast CROSS JOIN
generate_series(1,1000) As x CROSS JOIN generate_series(1,1000) As y
WHERE rid =  2 AND x &lt;= ST_Width(rast) AND y &lt;= ST_Height(rast);

            uplpt            | b1val | b2val | b3val
-----------------------------+-------+-------+-------
 POINT(3427929.25 5793245.5) |   253 |    78 |    70
 POINT(3427929.25 5793247)   |   253 |    96 |    80
 POINT(3427929.25 5793248.5) |   250 |    99 |    90
:
                                </pre><pre class="programlisting">-- 指定した範囲内の値を持ち、指定したポリゴンにインタセクトするピクセルの
-- 全てを結合することによって形成されるポリゴンを得ます
SELECT ST_AsText(ST_Union(pixpolyg)) As shadow
FROM (SELECT ST_Translate(ST_MakeEnvelope(
                ST_UpperLeftX(rast), ST_UpperLeftY(rast),
                        ST_UpperLeftX(rast) + ST_ScaleX(rast),
                        ST_UpperLeftY(rast) + ST_ScaleY(rast), 0
                        ), ST_ScaleX(rast)*x, ST_ScaleY(rast)*y
                ) As pixpolyg, ST_Value(rast, 2, x, y) As b2val
        FROM dummy_rast CROSS JOIN
generate_series(1,1000) As x CROSS JOIN generate_series(1,1000) As y
WHERE rid =  2
        AND x &lt;= ST_Width(rast) AND y &lt;= ST_Height(rast)) As foo
WHERE
        ST_Intersects(
                pixpolyg,
                ST_GeomFromText('POLYGON((3427928 5793244,3427927.75 5793243.75,3427928 5793243.75,3427928 5793244))',0)
                ) AND b2val != 254;


                shadow
------------------------------------------------------------------------------------
 MULTIPOLYGON(((3427928 5793243.9,3427928 5793243.85,3427927.95 5793243.85,3427927.95 5793243.9,
 3427927.95 5793243.95,3427928 5793243.95,3427928.05 5793243.95,3427928.05 5793243.9,3427928 5793243.9)),((3427927.95 5793243.9,3427927.95 579324
3.85,3427927.9 5793243.85,3427927.85 5793243.85,3427927.85 5793243.9,3427927.9 5793243.9,3427927.9 5793243.95,
3427927.95 5793243.95,3427927.95 5793243.9)),((3427927.85 5793243.75,3427927.85 5793243.7,3427927.8 5793243.7,3427927.8 5793243.75
,3427927.8 5793243.8,3427927.8 5793243.85,3427927.85 5793243.85,3427927.85 5793243.8,3427927.85 5793243.75)),
((3427928.05 5793243.75,3427928.05 5793243.7,3427928 5793243.7,3427927.95 5793243.7,3427927.95 5793243.75,3427927.95 5793243.8,3427
927.95 5793243.85,3427928 5793243.85,3427928 5793243.8,3427928.05 5793243.8,
3427928.05 5793243.75)),((3427927.95 5793243.75,3427927.95 5793243.7,3427927.9 5793243.7,3427927.85 5793243.7,
3427927.85 5793243.75,3427927.85 5793243.8,3427927.85 5793243.85,3427927.9 5793243.85,
3427927.95 5793243.85,3427927.95 5793243.8,3427927.95 5793243.75)))
                                </pre><pre class="programlisting">-- 大きなラスタタイルの全てのピクセルをチェックは長時間かかります。
-- generate_seriesの任意引数stepを使用してサンプリングすることで、
-- 精度を大きく落としますが、劇的な速度改善が可能です。
-- 次の例では、前の例と同じことをしていますが、
-- 4 (2x2)ピクセルごとに1度チェックを行い、4ピクセルの値として置いています。

SELECT ST_AsText(ST_Union(pixpolyg)) As shadow
FROM (SELECT ST_Translate(ST_MakeEnvelope(
                ST_UpperLeftX(rast), ST_UpperLeftY(rast),
                        ST_UpperLeftX(rast) + ST_ScaleX(rast)*2,
                        ST_UpperLeftY(rast) + ST_ScaleY(rast)*2, 0
                        ), ST_ScaleX(rast)*x, ST_ScaleY(rast)*y
                ) As pixpolyg, ST_Value(rast, 2, x, y) As b2val
        FROM dummy_rast CROSS JOIN
generate_series(1,1000,2) As x CROSS JOIN generate_series(1,1000,2) As y
WHERE rid =  2
        AND x &lt;= ST_Width(rast)  AND y &lt;= ST_Height(rast)  ) As foo
WHERE
        ST_Intersects(
                pixpolyg,
                ST_GeomFromText('POLYGON((3427928 5793244,3427927.75 5793243.75,3427928 5793243.75,3427928 5793244))',0)
                ) AND b2val != 254;

                shadow
------------------------------------------------------------------------------------
 MULTIPOLYGON(((3427927.9 5793243.85,3427927.8 5793243.85,3427927.8 5793243.95,
 3427927.9 5793243.95,3427928 5793243.95,3427928.1 5793243.95,3427928.1 5793243.85,3427928 5793243.85,3427927.9 5793243.85)),
 ((3427927.9 5793243.65,3427927.8 5793243.65,3427927.8 5793243.75,3427927.8 5793243.85,3427927.9 5793243.85,
 3427928 5793243.85,3427928 5793243.75,3427928.1 5793243.75,3427928.1 5793243.65,3427928 5793243.65,3427927.9 5793243.65)))
                                </pre></div><div class="refsection"><a name="idp91768136"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_SetValue" title="ST_SetValue">ST_SetValue</a>, <a class="xref" href="#RT_ST_DumpAsPolygons" title="ST_DumpAsPolygons">ST_DumpAsPolygons</a>, <a class="xref" href="#RT_ST_NumBands" title="ST_NumBands">ST_NumBands</a>, <a class="xref" href="#RT_ST_PixelAsPolygon" title="ST_PixelAsPolygon">ST_PixelAsPolygon</a>, <a class="xref" href="#RT_ST_ScaleX" title="ST_ScaleX">ST_ScaleX</a>, <a class="xref" href="#RT_ST_ScaleY" title="ST_ScaleY">ST_ScaleY</a>, <a class="xref" href="#RT_ST_UpperLeftX" title="ST_UpperLeftX">ST_UpperLeftX</a>, <a class="xref" href="#RT_ST_UpperLeftY" title="ST_UpperLeftY">ST_UpperLeftY</a>, <a class="xref" href="#RT_ST_SRID" title="ST_SRID">ST_SRID</a>, <a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a>, <a class="xref" href="#ST_Point" title="ST_Point">ST_Point</a>, <a class="xref" href="#ST_MakeEnvelope" title="ST_MakeEnvelope">ST_MakeEnvelope</a>, <a class="xref" href="#ST_Intersects" title="ST_Intersects">ST_Intersects</a>, <a class="xref" href="#ST_Intersection" title="ST_Intersection">ST_Intersection</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_NearestValue"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_NearestValue — 与えられたバンドの、columnxとrowyで指定されるか、またはラスタと同じ空間参照系で表現されたポイントで指定されたピクセルに最も近い<code class="varname">NODATA</code>でない値を返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">double precision <b class="fsfunc">ST_NearestValue</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">bandnum</var>, geometry  <var class="pdparam">pt</var>, boolean  <var class="pdparam">exclude_nodata_value=true</var><code>)</code>;</p><p><code class="funcdef">double precision <b class="fsfunc">ST_NearestValue</b>(</code>raster  <var class="pdparam">rast</var>, geometry  <var class="pdparam">pt</var>, boolean  <var class="pdparam">exclude_nodata_value=true</var><code>)</code>;</p><p><code class="funcdef">double precision <b class="fsfunc">ST_NearestValue</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">bandnum</var>, integer  <var class="pdparam">columnx</var>, integer  <var class="pdparam">rowy</var>, boolean  <var class="pdparam">exclude_nodata_value=true</var><code>)</code>;</p><p><code class="funcdef">double precision <b class="fsfunc">ST_NearestValue</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">columnx</var>, integer  <var class="pdparam">rowy</var>, boolean  <var class="pdparam">exclude_nodata_value=true</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp91835592"></a><h2>説明</h2><p>与えられたバンドの、columnxとrowyで指定されるか、またはラスタと同じ空間参照系で表現されたポイントで指定されたピクセルに最も近い<code class="varname">NODATA</code>でない値を返します。columnx, rowyピクセルまたは指定したジオメトリポイントのピクセルが<code class="varname">NODATA</code>である場合には、この関数は、columnx, rowyピクセルかジオメトリポイントのピクセルから最も近い<code class="varname">NODATA</code>.でないピクセルを探索します。 </p><p>バンド番号は1始まりで、<code class="varname">bandnum</code>が指定されていない場合には、1番と仮定します。<code class="varname">exclude_nodata_value</code>がFALSEに設定された場合には、<code class="varname">NODATA</code>ピクセルを含む全てのピクセルがインタセクトするかが考慮され、値を返します。<code class="varname">exclude_nodata_value</code>を渡さない場合には、ラスタのメタデータから読みます。 </p><p>Availability: 2.1.0</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_NearestValueはST_Valueと交換可能です。 </p></td></tr></table></div></div><div class="refsection"><a name="idp91853384"></a><h2>例</h2><pre class="programlisting">-- 2,2ピクセルは値を持っています
SELECT
        ST_Value(rast, 2, 2) AS value,
        ST_NearestValue(rast, 2, 2) AS nearestvalue
FROM (
        SELECT
                ST_SetValue(
                        ST_SetValue(
                                ST_SetValue(
                                        ST_SetValue(
                                                ST_SetValue(
                                                        ST_AddBand(
                                                                ST_MakeEmptyRaster(5, 5, -2, 2, 1, -1, 0, 0, 0),
                                                                '8BUI'::text, 1, 0
                                                        ),
                                                        1, 1, 0.
                                                ),
                                                2, 3, 0.
                                        ),
                                        3, 5, 0.
                                ),
                                4, 2, 0.
                        ),
                        5, 4, 0.
                ) AS rast
) AS foo

 value | nearestvalue
-------+--------------
     1 |            1
                                </pre><pre class="programlisting">-- 2,3ピクセルはNODATAです
SELECT
        ST_Value(rast, 2, 3) AS value,
        ST_NearestValue(rast, 2, 3) AS nearestvalue
FROM (
        SELECT
                ST_SetValue(
                        ST_SetValue(
                                ST_SetValue(
                                        ST_SetValue(
                                                ST_SetValue(
                                                        ST_AddBand(
                                                                ST_MakeEmptyRaster(5, 5, -2, 2, 1, -1, 0, 0, 0),
                                                                '8BUI'::text, 1, 0
                                                        ),
                                                        1, 1, 0.
                                                ),
                                                2, 3, 0.
                                        ),
                                        3, 5, 0.
                                ),
                                4, 2, 0.
                        ),
                        5, 4, 0.
                ) AS rast
) AS foo

 value | nearestvalue
-------+--------------
       |            1
                                </pre></div><div class="refsection"><a name="idp91855176"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Neighborhood" title="ST_Neighborhood">ST_Neighborhood</a>, <a class="xref" href="#RT_ST_Value" title="ST_Value">ST_Value</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Neighborhood"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Neighborhood — 与えられたバンドのcolumnX, columnYか、ラスタと同じ空間参照系のジオメトリポイントで指定されたピクセルの周囲にある、<code class="varname">NODATA</code>でない2次元倍精度浮動小数点数配列を返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">double precision[][] <b class="fsfunc">ST_Neighborhood</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">bandnum</var>, integer  <var class="pdparam">columnX</var>, integer  <var class="pdparam">rowY</var>, integer  <var class="pdparam">distanceX</var>, integer  <var class="pdparam">distanceY</var>, boolean  <var class="pdparam">exclude_nodata_value=true</var><code>)</code>;</p><p><code class="funcdef">double precision[][] <b class="fsfunc">ST_Neighborhood</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">columnX</var>, integer  <var class="pdparam">rowY</var>, integer  <var class="pdparam">distanceX</var>, integer  <var class="pdparam">distanceY</var>, boolean  <var class="pdparam">exclude_nodata_value=true</var><code>)</code>;</p><p><code class="funcdef">double precision[][] <b class="fsfunc">ST_Neighborhood</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">bandnum</var>, geometry  <var class="pdparam">pt</var>, integer  <var class="pdparam">distanceX</var>, integer  <var class="pdparam">distanceY</var>, boolean  <var class="pdparam">exclude_nodata_value=true</var><code>)</code>;</p><p><code class="funcdef">double precision[][] <b class="fsfunc">ST_Neighborhood</b>(</code>raster  <var class="pdparam">rast</var>, geometry  <var class="pdparam">pt</var>, integer  <var class="pdparam">distanceX</var>, integer  <var class="pdparam">distanceY</var>, boolean  <var class="pdparam">exclude_nodata_value=true</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp91963080"></a><h2>説明</h2><p>与えられたバンドのcolumnX, columnYか、ラスタと同じ空間参照系のジオメトリポイントで指定されたピクセルの周囲にある、<code class="varname">NODATA</code>でない2次元倍精度浮動小数点数配列を返します。<code class="varname">distanceX</code>と<code class="varname">distanceY</code>引数は、たとえば、対象ピクセルからX軸に沿って3ピクセルとしてY軸に沿って2ピクセルというふうに、指定したピクセルの周囲のピクセル数を、それぞれX方向とY方向に定義します。2次元配列の中心の値はcolumnX, columnYまたはジオメトリポイントで指定したピクセルの値です。 </p><p>バンド番号は1始まりで、<code class="varname">bandnum</code>が指定されていない場合には、1番と仮定します。<code class="varname">exclude_nodata_value</code>がFALSEに設定された場合には、<code class="varname">NODATA</code>ピクセルを含む全てのピクセルがインタセクトするかが考慮され、値を返します。<code class="varname">exclude_nodata_value</code>を渡さない場合には、ラスタのメタデータから読みます。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>返される2次元配列の各軸の要素数は2 * (<code class="varname">distanceX</code>|<code class="varname">distanceY</code>) + 1です。<code class="varname">distanceX</code>と<code class="varname">distanceY</code>を1にすると、3x3の配列が返ります。 </p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>2次元配列の出力はST_Min4ma, ST_Sum4ma, ST_Mean4maといったあらゆるラスタ処理関数に渡すことができます。 </p></td></tr></table></div><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp91970760"></a><h2>例</h2><pre class="programlisting">-- 2,3ピクセルは値を持っています
SELECT
        ST_Neighborhood(rast, 2, 2, 1, 1)
FROM (
        SELECT
                ST_SetValues(
                        ST_AddBand(
                                ST_MakeEmptyRaster(5, 5, -2, 2, 1, -1, 0, 0, 0),
                                '8BUI'::text, 1, 0
                        ),
                        1, 1, 1, ARRAY[
                                [0, 1, 1, 1, 1],
                                [1, 1, 1, 0, 1],
                                [1, 0, 1, 1, 1],
                                [1, 1, 1, 1, 0],
                                [1, 1, 0, 1, 1]
                        ]::double precision[],
                        1
                ) AS rast
) AS foo

         st_neighborhood
---------------------------------
 {{NULL,1,1},{1,1,NULL},{1,1,1}}
                                </pre><pre class="programlisting">-- 2,3ピクセルはNODATAです
SELECT
        ST_Neighborhood(rast, 2, 3, 1, 1)
FROM (
        SELECT
                ST_SetValues(
                        ST_AddBand(
                                ST_MakeEmptyRaster(5, 5, -2, 2, 1, -1, 0, 0, 0),
                                '8BUI'::text, 1, 0
                        ),
                        1, 1, 1, ARRAY[
                                [0, 1, 1, 1, 1],
                                [1, 1, 1, 0, 1],
                                [1, 0, 1, 1, 1],
                                [1, 1, 1, 1, 0],
                                [1, 1, 0, 1, 1]
                        ]::double precision[],
                        1
                ) AS rast
) AS foo

       st_neighborhood
------------------------------
 {{1,1,1},{1,NULL,1},{1,1,1}}
                                </pre><pre class="programlisting">-- 2,3ピクセルは値を持っています
-- exclude_nodata_value = FALSE
SELECT
        ST_Neighborhood(rast, 3, 3, 1, 1, false)
FROM (
                ST_SetValues(
                        ST_AddBand(
                                ST_MakeEmptyRaster(5, 5, -2, 2, 1, -1, 0, 0, 0),
                                '8BUI'::text, 1, 0
                        ),
                        1, 1, 1, ARRAY[
                                [0, 1, 1, 1, 1],
                                [1, 1, 1, 0, 1],
                                [1, 0, 1, 1, 1],
                                [1, 1, 1, 1, 0],
                                [1, 1, 0, 1, 1]
                        ]::double precision[],
                        1
                ) AS rast
) AS foo

      st_neighborhood
---------------------------
 {{1,0,1},{1,1,1},{0,1,1}}
                                </pre></div><div class="refsection"><a name="idp91973064"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_NearestValue" title="ST_NearestValue">ST_NearestValue</a>, <a class="xref" href="#RT_ST_Min4ma" title="ST_Min4ma">ST_Min4ma</a>, <a class="xref" href="#RT_ST_Max4ma" title="ST_Max4ma">ST_Max4ma</a>, <a class="xref" href="#RT_ST_Sum4ma" title="ST_Sum4ma">ST_Sum4ma</a>, <a class="xref" href="#RT_ST_Mean4ma" title="ST_Mean4ma">ST_Mean4ma</a>, <a class="xref" href="#RT_ST_Range4ma" title="ST_Range4ma">ST_Range4ma</a>, <a class="xref" href="#RT_ST_Distinct4ma" title="ST_Distinct4ma">ST_Distinct4ma</a>, <a class="xref" href="#RT_ST_StdDev4ma" title="ST_StdDev4ma">ST_StdDev4ma</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_SetValue"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SetValue — 与えられたバンドのcolumnX, columnYか、ラスタと同じ空間参照系のジオメトリポイントで指定されたピクセルの値または指定したジオメトリとインタセクトするピクセル群の値を設定することから得られる、変更されたラスタを返します。バンド番号は1始まりで、指定しない場合には、1番と仮定します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_SetValue</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">bandnum</var>, geometry  <var class="pdparam">geom</var>, double precision  <var class="pdparam">newvalue</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_SetValue</b>(</code>raster  <var class="pdparam">rast</var>, geometry  <var class="pdparam">geom</var>, double precision  <var class="pdparam">newvalue</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_SetValue</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">bandnum</var>, integer  <var class="pdparam">columnx</var>, integer  <var class="pdparam">rowy</var>, double precision  <var class="pdparam">newvalue</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_SetValue</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">columnx</var>, integer  <var class="pdparam">rowy</var>, double precision  <var class="pdparam">newvalue</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp90308808"></a><h2>説明</h2><p>指定されたバンドの、与えられたラスタの行と列またはジオメトリで指定したピクセルの値を新しい値に設定することで得られる、変更したラスタを返します。バンドが指定されいていない場合には、1番と仮定します。 </p><p>Enhanced: 2.1.0 ST_SetValueでジオメトリを用いる形式が、ポイントだけでなくあらゆるジオメトリタイプに対応するようになりました。ジオメトリを用いる形式はST_SetValuesのgeomval[]を用いる形式をラップしたものです。</p></div><div class="refsection"><a name="idp90310344"></a><h2>例</h2><pre class="programlisting">-- ジオメトリの例
SELECT (foo.geomval).val, ST_AsText(ST_Union((foo.geomval).geom))
FROM (SELECT ST_DumpAsPolygons(
                ST_SetValue(rast,1,
                                ST_Point(3427927.75, 5793243.95),
                                50)
                        ) As geomval
FROM dummy_rast
where rid = 2) As foo
WHERE (foo.geomval).val &lt; 250
GROUP BY (foo.geomval).val;

 val |                                                     st_astext
-----+-------------------------------------------------------------------
  50 | POLYGON((3427927.75 5793244,3427927.75 5793243.95,3427927.8 579324 ...
 249 | POLYGON((3427927.95 5793243.95,3427927.95 5793243.85,3427928 57932 ...

                                </pre><pre class="programlisting">-- 変更したラスタの格納 --
        UPDATE dummy_rast SET rast = ST_SetValue(rast,1, ST_Point(3427927.75, 5793243.95),100)
                WHERE rid = 2   ;

                                </pre></div><div class="refsection"><a name="idp90312136"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Value" title="ST_Value">ST_Value</a>, <a class="xref" href="#RT_ST_DumpAsPolygons" title="ST_DumpAsPolygons">ST_DumpAsPolygons</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_SetValues"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SetValues — 与えられたバンドに複数の値を設定して、変更されたラスタを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_SetValues</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, integer  <var class="pdparam">columnx</var>, integer  <var class="pdparam">rowy</var>, double precision[][]  <var class="pdparam">newvalueset</var>, boolean[][]  <var class="pdparam">noset=NULL</var>, boolean  <var class="pdparam">keepnodata=FALSE</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_SetValues</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, integer  <var class="pdparam">columnx</var>, integer  <var class="pdparam">rowy</var>, double precision[][]  <var class="pdparam">newvalueset</var>, double precision  <var class="pdparam">nosetvalue</var>, boolean  <var class="pdparam">keepnodata=FALSE</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_SetValues</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, integer  <var class="pdparam">columnx</var>, integer  <var class="pdparam">rowy</var>, integer  <var class="pdparam">width</var>, integer  <var class="pdparam">height</var>, double precision  <var class="pdparam">newvalue</var>, boolean  <var class="pdparam">keepnodata=FALSE</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_SetValues</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">columnx</var>, integer  <var class="pdparam">rowy</var>, integer  <var class="pdparam">width</var>, integer  <var class="pdparam">height</var>, double precision  <var class="pdparam">newvalue</var>, boolean  <var class="pdparam">keepnodata=FALSE</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_SetValues</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, geomval[]  <var class="pdparam">geomvalset</var>, boolean  <var class="pdparam">keepnodata=FALSE</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp92051400"></a><h2>説明</h2><p>指定されたバンドに値を設定して、変更されたラスタを返します。 </p><p><code class="varname">keepnodata</code>がTRUEの場合には、NODATA値を持つピクセルは<code class="varname">newvalueset</code>に一致する値に設定しません。 </p><p>一つ目の形式では、設定するピクセルを<code class="varname">columnx</code>, <code class="varname">rowy</code>のピクセル座標で決定し、 範囲を<code class="varname">newvalueset</code>配列で決定します。<code class="varname">noset</code>によって、ピクセルを<code class="varname">newvalueset</code>内にある値で、一部を設定されないようにすることができます (PostgreSQLは不調和配列、ジャグ配列を許さないため)。一つ目の形式の例をご覧ください。 </p><p>二つ目の形式では、一つ目の形式と似ていますが、倍精度浮動小数点数のスカラ値である<code class="varname">nosetvalue</code>を<code class="varname">noset</code>配列の代わりに使う点が違います。<code class="varname">nosetvalue</code>の値になる<code class="varname">newvalueset</code>内の要素の設定は行いません。二つ目の形式の例をご覧下さい。 </p><p>三つ目の形式では、設定するピクセルを<code class="varname">columnx</code>, <code class="varname">rowy</code>のピクセル座標と<code class="varname">width</code>, <code class="varname">height</code>.で決定します。三つ目の形式の例をご覧ください。 </p><p>四つ目の形式では、<code class="varname">rast</code>の1番バンドのピクセルを設定すると仮定する点を除いては、三つ目の形式と同じです。 </p><p>五つ目の形式では、設定するピクセルを<a class="xref" href="#geomval" title="geomval">geomval</a>の配列で決定します。配列内の全てのジオメトリのタイプがPOINTまたはMULTIPOINTである場合には、ポイントごとの経度と緯度がピクセルの設定に直接使うためのショートカットに使われます。他の場合には、ジオメトリはラスタに変換され一つずつ渡されます。五つ目の形式の例をご覧下さい。 </p><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp92061896"></a><h2>例: 一つ目の形式</h2><pre class="programlisting">/*
ST_SetValues()によって次のように書き換わります

+ - + - + - +          + - + - + - +
| 1 | 1 | 1 |          | 1 | 1 | 1 |
+ - + - + - +          + - + - + - +
| 1 | 1 | 1 |    =
&gt;    | 1 | 9 | 9 |
+ - + - + - +          + - + - + - +
| 1 | 1 | 1 |          | 1 | 9 | 9 |
+ - + - + - +          + - + - + - +
*/
SELECT
        (poly).x,
        (poly).y,
        (poly).val
FROM (
SELECT
        ST_PixelAsPolygons(
                ST_SetValues(
                        ST_AddBand(
                                ST_MakeEmptyRaster(3, 3, 0, 0, 1, -1, 0, 0, 0),
                                1, '8BUI', 1, 0
                        ),
                        1, 2, 2, ARRAY[[9, 9], [9, 9]]::double precision[][]
                )
        ) AS poly
) foo
ORDER BY 1, 2;

 x | y | val
---+---+-----
 1 | 1 |   1
 1 | 2 |   1
 1 | 3 |   1
 2 | 1 |   1
 2 | 2 |   9
 2 | 3 |   9
 3 | 1 |   1
 3 | 2 |   9
 3 | 3 |   9
                                </pre><pre class="programlisting">/*
ST_SetValues()によって次のように書き換わります

+ - + - + - +          + - + - + - +
| 1 | 1 | 1 |          | 9 | 9 | 9 |
+ - + - + - +          + - + - + - +
| 1 | 1 | 1 |    =
&gt;    | 9 |   | 9 |
+ - + - + - +          + - + - + - +
| 1 | 1 | 1 |          | 9 | 9 | 9 |
+ - + - + - +          + - + - + - +
*/
SELECT
        (poly).x,
        (poly).y,
        (poly).val
FROM (
SELECT
        ST_PixelAsPolygons(
                ST_SetValues(
                        ST_AddBand(
                                ST_MakeEmptyRaster(3, 3, 0, 0, 1, -1, 0, 0, 0),
                                1, '8BUI', 1, 0
                        ),
                        1, 1, 1, ARRAY[[9, 9, 9], [9, NULL, 9], [9, 9, 9]]::double precision[][]
                )
        ) AS poly
) foo
ORDER BY 1, 2;

 x | y | val
---+---+-----
 1 | 1 |   9
 1 | 2 |   9
 1 | 3 |   9
 2 | 1 |   9
 2 | 2 |
 2 | 3 |   9
 3 | 1 |   9
 3 | 2 |   9
 3 | 3 |   9
                                </pre><pre class="programlisting">/*
ST_SetValues()によって次のように書き換わります

+ - + - + - +          + - + - + - +
| 1 | 1 | 1 |          | 9 | 9 | 9 |
+ - + - + - +          + - + - + - +
| 1 | 1 | 1 |    =
&gt;    | 1 |   | 9 |
+ - + - + - +          + - + - + - +
| 1 | 1 | 1 |          | 9 | 9 | 9 |
+ - + - + - +          + - + - + - +
*/
SELECT
        (poly).x,
        (poly).y,
        (poly).val
FROM (
SELECT
        ST_PixelAsPolygons(
                ST_SetValues(
                        ST_AddBand(
                                ST_MakeEmptyRaster(3, 3, 0, 0, 1, -1, 0, 0, 0),
                                1, '8BUI', 1, 0
                        ),
                        1, 1, 1,
                                ARRAY[[9, 9, 9], [9, NULL, 9], [9, 9, 9]]::double precision[][],
                                ARRAY[[false], [true]]::boolean[][]
                )
        ) AS poly
) foo
ORDER BY 1, 2;

 x | y | val
---+---+-----
 1 | 1 |   9
 1 | 2 |   1
 1 | 3 |   9
 2 | 1 |   9
 2 | 2 |
 2 | 3 |   9
 3 | 1 |   9
 3 | 2 |   9
 3 | 3 |   9
                                </pre><pre class="programlisting">/*
ST_SetValues()によって次のように書き換わります

+ - + - + - +          + - + - + - +
|   | 1 | 1 |          |   | 9 | 9 |
+ - + - + - +          + - + - + - +
| 1 | 1 | 1 |    =
&gt;    | 1 |   | 9 |
+ - + - + - +          + - + - + - +
| 1 | 1 | 1 |          | 9 | 9 | 9 |
+ - + - + - +          + - + - + - +
*/
SELECT
        (poly).x,
        (poly).y,
        (poly).val
FROM (
SELECT
        ST_PixelAsPolygons(
                ST_SetValues(
                        ST_SetValue(
                                ST_AddBand(
                                        ST_MakeEmptyRaster(3, 3, 0, 0, 1, -1, 0, 0, 0),
                                        1, '8BUI', 1, 0
                                ),
                                1, 1, 1, NULL
                        ),
                        1, 1, 1,
                                ARRAY[[9, 9, 9], [9, NULL, 9], [9, 9, 9]]::double precision[][],
                                ARRAY[[false], [true]]::boolean[][],
                                TRUE
                )
        ) AS poly
) foo
ORDER BY 1, 2;

 x | y | val
---+---+-----
 1 | 1 |
 1 | 2 |   1
 1 | 3 |   9
 2 | 1 |   9
 2 | 2 |
 2 | 3 |   9
 3 | 1 |   9
 3 | 2 |   9
 3 | 3 |   9
                                </pre></div><div class="refsection"><a name="idp92093384"></a><h2>例: 二つ目の形式</h2><pre class="programlisting">/*
ST_SetValues()によって次のように書き換わります

+ - + - + - +          + - + - + - +
| 1 | 1 | 1 |          | 1 | 1 | 1 |
+ - + - + - +          + - + - + - +
| 1 | 1 | 1 |    =
&gt;    | 1 | 9 | 9 |
+ - + - + - +          + - + - + - +
| 1 | 1 | 1 |          | 1 | 9 | 9 |
+ - + - + - +          + - + - + - +
*/
SELECT
        (poly).x,
        (poly).y,
        (poly).val
FROM (
SELECT
        ST_PixelAsPolygons(
                ST_SetValues(
                        ST_AddBand(
                                ST_MakeEmptyRaster(3, 3, 0, 0, 1, -1, 0, 0, 0),
                                1, '8BUI', 1, 0
                        ),
                        1, 1, 1, ARRAY[[-1, -1, -1], [-1, 9, 9], [-1, 9, 9]]::double precision[][], -1
                )
        ) AS poly
) foo
ORDER BY 1, 2;

 x | y | val
---+---+-----
 1 | 1 |   1
 1 | 2 |   1
 1 | 3 |   1
 2 | 1 |   1
 2 | 2 |   9
 2 | 3 |   9
 3 | 1 |   1
 3 | 2 |   9
 3 | 3 |   9
                                </pre><pre class="programlisting">/*
この例は上の例と似ていますが、nosetvalueを-1でなくNULLにしています。


ST_SetValues()によって次のように書き換わります

+ - + - + - +          + - + - + - +
| 1 | 1 | 1 |          | 1 | 1 | 1 |
+ - + - + - +          + - + - + - +
| 1 | 1 | 1 |    =
&gt;    | 1 | 9 | 9 |
+ - + - + - +          + - + - + - +
| 1 | 1 | 1 |          | 1 | 9 | 9 |
+ - + - + - +          + - + - + - +
*/
SELECT
        (poly).x,
        (poly).y,
        (poly).val
FROM (
SELECT
        ST_PixelAsPolygons(
                ST_SetValues(
                        ST_AddBand(
                                ST_MakeEmptyRaster(3, 3, 0, 0, 1, -1, 0, 0, 0),
                                1, '8BUI', 1, 0
                        ),
                        1, 1, 1, ARRAY[[NULL, NULL, NULL], [NULL, 9, 9], [NULL, 9, 9]]::double precision[][], NULL::double precision
                )
        ) AS poly
) foo
ORDER BY 1, 2;

 x | y | val
---+---+-----
 1 | 1 |   1
 1 | 2 |   1
 1 | 3 |   1
 2 | 1 |   1
 2 | 2 |   9
 2 | 3 |   9
 3 | 1 |   1
 3 | 2 |   9
 3 | 3 |   9
                                </pre></div><div class="refsection"><a name="idp92095176"></a><h2>例: 三つ目の形式</h2><pre class="programlisting">/*
ST_SetValues()によって次のように書き換わります

+ - + - + - +          + - + - + - +
| 1 | 1 | 1 |          | 1 | 1 | 1 |
+ - + - + - +          + - + - + - +
| 1 | 1 | 1 |    =
&gt;    | 1 | 9 | 9 |
+ - + - + - +          + - + - + - +
| 1 | 1 | 1 |          | 1 | 9 | 9 |
+ - + - + - +          + - + - + - +
*/
SELECT
        (poly).x,
        (poly).y,
        (poly).val
FROM (
SELECT
        ST_PixelAsPolygons(
                ST_SetValues(
                        ST_AddBand(
                                ST_MakeEmptyRaster(3, 3, 0, 0, 1, -1, 0, 0, 0),
                                1, '8BUI', 1, 0
                        ),
                        1, 2, 2, 2, 2, 9
                )
        ) AS poly
) foo
ORDER BY 1, 2;

 x | y | val
---+---+-----
 1 | 1 |   1
 1 | 2 |   1
 1 | 3 |   1
 2 | 1 |   1
 2 | 2 |   9
 2 | 3 |   9
 3 | 1 |   1
 3 | 2 |   9
 3 | 3 |   9
                                </pre><pre class="programlisting">/*
ST_SetValues()によって次のように書き換わります

+ - + - + - +          + - + - + - +
| 1 | 1 | 1 |          | 1 | 1 | 1 |
+ - + - + - +          + - + - + - +
| 1 |   | 1 |    =
&gt;    | 1 |   | 9 |
+ - + - + - +          + - + - + - +
| 1 | 1 | 1 |          | 1 | 9 | 9 |
+ - + - + - +          + - + - + - +
*/
SELECT
        (poly).x,
        (poly).y,
        (poly).val
FROM (
SELECT
        ST_PixelAsPolygons(
                ST_SetValues(
                        ST_SetValue(
                                ST_AddBand(
                                        ST_MakeEmptyRaster(3, 3, 0, 0, 1, -1, 0, 0, 0),
                                        1, '8BUI', 1, 0
                                ),
                                1, 2, 2, NULL
                        ),
                        1, 2, 2, 2, 2, 9, TRUE
                )
        ) AS poly
) foo
ORDER BY 1, 2;

 x | y | val
---+---+-----
 1 | 1 |   1
 1 | 2 |   1
 1 | 3 |   1
 2 | 1 |   1
 2 | 2 |
 2 | 3 |   9
 3 | 1 |   1
 3 | 2 |   9
 3 | 3 |   9
                                </pre></div><div class="refsection"><a name="idp92129736"></a><h2>例: 五つ目の形式</h2><pre class="programlisting">WITH foo AS (
        SELECT 1 AS rid, ST_AddBand(ST_MakeEmptyRaster(5, 5, 0, 0, 1, -1, 0, 0, 0), 1, '8BUI', 0, 0) AS rast
), bar AS (
        SELECT 1 AS gid, 'SRID=0;POINT(2.5 -2.5)'::geometry geom UNION ALL
        SELECT 2 AS gid, 'SRID=0;POLYGON((1 -1, 4 -1, 4 -4, 1 -4, 1 -1))'::geometry geom UNION ALL
        SELECT 3 AS gid, 'SRID=0;POLYGON((0 0, 5 0, 5 -1, 1 -1, 1 -4, 0 -4, 0 0))'::geometry geom UNION ALL
        SELECT 4 AS gid, 'SRID=0;MULTIPOINT(0 0, 4 4, 4 -4)'::geometry
)
SELECT
        rid, gid, ST_DumpValues(ST_SetValue(rast, 1, geom, gid))
FROM foo t1
CROSS JOIN bar t2
ORDER BY rid, gid;

 rid | gid |                                                                st_dumpvalues
-----+-----+---------------------------------------------------------------------------------------------------------------------------------------------
   1 |   1 | (1,"{{NULL,NULL,NULL,NULL,NULL},{NULL,NULL,NULL,NULL,NULL},{NULL,NULL,1,NULL,NULL},{NULL,NULL,NULL,NULL,NULL},{NULL,NULL,NULL,NULL,NULL}}")
   1 |   2 | (1,"{{NULL,NULL,NULL,NULL,NULL},{NULL,2,2,2,NULL},{NULL,2,2,2,NULL},{NULL,2,2,2,NULL},{NULL,NULL,NULL,NULL,NULL}}")
   1 |   3 | (1,"{{3,3,3,3,3},{3,NULL,NULL,NULL,NULL},{3,NULL,NULL,NULL,NULL},{3,NULL,NULL,NULL,NULL},{NULL,NULL,NULL,NULL,NULL}}")
   1 |   4 | (1,"{{4,NULL,NULL,NULL,NULL},{NULL,NULL,NULL,NULL,NULL},{NULL,NULL,NULL,NULL,NULL},{NULL,NULL,NULL,NULL,NULL},{NULL,NULL,NULL,NULL,4}}")
(4 rows)
                                </pre><p>配列内における後のgeomvalsで前のgeomvalsを上書きできることを示しています。</p><pre class="programlisting">WITH foo AS (
        SELECT 1 AS rid, ST_AddBand(ST_MakeEmptyRaster(5, 5, 0, 0, 1, -1, 0, 0, 0), 1, '8BUI', 0, 0) AS rast
), bar AS (
        SELECT 1 AS gid, 'SRID=0;POINT(2.5 -2.5)'::geometry geom UNION ALL
        SELECT 2 AS gid, 'SRID=0;POLYGON((1 -1, 4 -1, 4 -4, 1 -4, 1 -1))'::geometry geom UNION ALL
        SELECT 3 AS gid, 'SRID=0;POLYGON((0 0, 5 0, 5 -1, 1 -1, 1 -4, 0 -4, 0 0))'::geometry geom UNION ALL
        SELECT 4 AS gid, 'SRID=0;MULTIPOINT(0 0, 4 4, 4 -4)'::geometry
)
SELECT
        t1.rid, t2.gid, t3.gid, ST_DumpValues(ST_SetValues(rast, 1, ARRAY[ROW(t2.geom, t2.gid), ROW(t3.geom, t3.gid)]::geomval[]))
FROM foo t1
CROSS JOIN bar t2
CROSS JOIN bar t3
WHERE t2.gid = 1
        AND t3.gid = 2
ORDER BY t1.rid, t2.gid, t3.gid;

 rid | gid | gid |                                                    st_dumpvalues
-----+-----+-----+---------------------------------------------------------------------------------------------------------------------
   1 |   1 |   2 | (1,"{{NULL,NULL,NULL,NULL,NULL},{NULL,2,2,2,NULL},{NULL,2,2,2,NULL},{NULL,2,2,2,NULL},{NULL,NULL,NULL,NULL,NULL}}")
(1 row)
                                </pre><p>この例は前の例の逆です。</p><pre class="programlisting">WITH foo AS (
        SELECT 1 AS rid, ST_AddBand(ST_MakeEmptyRaster(5, 5, 0, 0, 1, -1, 0, 0, 0), 1, '8BUI', 0, 0) AS rast
), bar AS (
        SELECT 1 AS gid, 'SRID=0;POINT(2.5 -2.5)'::geometry geom UNION ALL
        SELECT 2 AS gid, 'SRID=0;POLYGON((1 -1, 4 -1, 4 -4, 1 -4, 1 -1))'::geometry geom UNION ALL
        SELECT 3 AS gid, 'SRID=0;POLYGON((0 0, 5 0, 5 -1, 1 -1, 1 -4, 0 -4, 0 0))'::geometry geom UNION ALL
        SELECT 4 AS gid, 'SRID=0;MULTIPOINT(0 0, 4 4, 4 -4)'::geometry
)
SELECT
        t1.rid, t2.gid, t3.gid, ST_DumpValues(ST_SetValues(rast, 1, ARRAY[ROW(t2.geom, t2.gid), ROW(t3.geom, t3.gid)]::geomval[]))
FROM foo t1
CROSS JOIN bar t2
CROSS JOIN bar t3
WHERE t2.gid = 2
        AND t3.gid = 1
ORDER BY t1.rid, t2.gid, t3.gid;

 rid | gid | gid |                                                    st_dumpvalues
-----+-----+-----+---------------------------------------------------------------------------------------------------------------------
   1 |   2 |   1 | (1,"{{NULL,NULL,NULL,NULL,NULL},{NULL,2,2,2,NULL},{NULL,2,1,2,NULL},{NULL,2,2,2,NULL},{NULL,NULL,NULL,NULL,NULL}}")
(1 row)
                                </pre></div><div class="refsection"><a name="idp92132808"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Value" title="ST_Value">ST_Value</a>, <a class="xref" href="#RT_ST_SetValue" title="ST_SetValue">ST_SetValue</a>, <a class="xref" href="#RT_ST_PixelAsPolygons" title="ST_PixelAsPolygons">ST_PixelAsPolygons</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_DumpValues"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_DumpValues — 指定したバンドの値を2次元で得ます。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">setof record <b class="fsfunc">ST_DumpValues</b>(</code> raster  <var class="pdparam">rast</var> ,  integer[]  <var class="pdparam">nband=NULL</var> ,  boolean  <var class="pdparam">exclude_nodata_value=true</var> <code>)</code>;</p><p><code class="funcdef">double precision[][] <b class="fsfunc">ST_DumpValues</b>(</code> raster  <var class="pdparam">rast</var> ,  integer  <var class="pdparam">nband</var> ,  boolean  <var class="pdparam">exclude_nodata_value=true</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp92147272"></a><h2>説明</h2><p>指定したバンドの値を2次元で得ます (一つ目の添え字で行、二つ目の添え字で列に、それぞれ対応します)。<code class="varname">nband</code>がNULLまたは指定されていない場合には、全てのラスタバンドが処理されます。 </p><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp92149192"></a><h2>例</h2><pre class="programlisting">WITH foo AS (
        SELECT ST_AddBand(ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(3, 3, 0, 0, 1, -1, 0, 0, 0), 1, '8BUI'::text, 1, 0), 2, '32BF'::text, 3, -9999), 3, '16BSI', 0, 0) AS rast
)
SELECT
        (ST_DumpValues(rast)).*
FROM foo;

 nband |                       valarray
-------+------------------------------------------------------
     1 | {{1,1,1},{1,1,1},{1,1,1}}
     2 | {{3,3,3},{3,3,3},{3,3,3}}
     3 | {{NULL,NULL,NULL},{NULL,NULL,NULL},{NULL,NULL,NULL}}
(3 rows)
                                </pre><pre class="programlisting">WITH foo AS (
        SELECT ST_AddBand(ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(3, 3, 0, 0, 1, -1, 0, 0, 0), 1, '8BUI'::text, 1, 0), 2, '32BF'::text, 3, -9999), 3, '16BSI', 0, 0) AS rast
)
SELECT
        (ST_DumpValues(rast, ARRAY[3, 1])).*
FROM foo;

 nband |                       valarray
-------+------------------------------------------------------
     3 | {{NULL,NULL,NULL},{NULL,NULL,NULL},{NULL,NULL,NULL}}
     1 | {{1,1,1},{1,1,1},{1,1,1}}
(2 rows)
                                </pre><pre class="programlisting">WITH foo AS (
        SELECT ST_SetValue(ST_AddBand(ST_MakeEmptyRaster(3, 3, 0, 0, 1, -1, 0, 0, 0), 1, '8BUI', 1, 0), 1, 2, 5) AS rast
)
SELECT
        (ST_DumpValues(rast, 1))[2][1]
FROM foo;

 st_dumpvalues
---------------
             5
(1 row)
                                </pre></div><div class="refsection"><a name="idp92151496"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Value" title="ST_Value">ST_Value</a>, <a class="xref" href="#RT_ST_SetValue" title="ST_SetValue">ST_SetValue</a>, <a class="xref" href="#RT_ST_SetValues" title="ST_SetValues">ST_SetValues</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_PixelOfValue"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_PixelOfValue — 検索値と同じ値を持つピクセルのcolumnx, rowyピクセル座標を得ます。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">setof record <b class="fsfunc">ST_PixelOfValue</b>(</code> raster  <var class="pdparam">rast</var> ,  integer  <var class="pdparam">nband</var> ,  double precision[]  <var class="pdparam">search</var> ,  boolean  <var class="pdparam">exclude_nodata_value=true</var> <code>)</code>;</p><p><code class="funcdef">setof record <b class="fsfunc">ST_PixelOfValue</b>(</code> raster  <var class="pdparam">rast</var> ,  double precision[]  <var class="pdparam">search</var> ,  boolean  <var class="pdparam">exclude_nodata_value=true</var> <code>)</code>;</p><p><code class="funcdef">setof record <b class="fsfunc">ST_PixelOfValue</b>(</code> raster  <var class="pdparam">rast</var> ,  integer  <var class="pdparam">nband</var> ,  double precision  <var class="pdparam">search</var> ,  boolean  <var class="pdparam">exclude_nodata_value=true</var> <code>)</code>;</p><p><code class="funcdef">setof record <b class="fsfunc">ST_PixelOfValue</b>(</code> raster  <var class="pdparam">rast</var> ,  double precision  <var class="pdparam">search</var> ,  boolean  <var class="pdparam">exclude_nodata_value=true</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp92170312"></a><h2>説明</h2><p>検索値と同じ値を持つピクセルのcolumnx, rowyピクセル座標を得ます。バンドを指定しない場合には、1番と仮定します。 </p><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp92171848"></a><h2>例</h2><pre class="programlisting">SELECT
        (pixels).*
FROM (
        SELECT
                ST_PixelOfValue(
                        ST_SetValue(
                                ST_SetValue(
                                        ST_SetValue(
                                                ST_SetValue(
                                                        ST_SetValue(
                                                                ST_AddBand(
                                                                        ST_MakeEmptyRaster(5, 5, -2, 2, 1, -1, 0, 0, 0),
                                                                        '8BUI'::text, 1, 0
                                                                ),
                                                                1, 1, 0
                                                        ),
                                                        2, 3, 0
                                                ),
                                                3, 5, 0
                                        ),
                                        4, 2, 0
                                ),
                                5, 4, 255
                        )
                , 1, ARRAY[1, 255]) AS pixels
) AS foo

 val | x | y
-----+---+---
   1 | 1 | 2
   1 | 1 | 3
   1 | 1 | 4
   1 | 1 | 5
   1 | 2 | 1
   1 | 2 | 2
   1 | 2 | 4
   1 | 2 | 5
   1 | 3 | 1
   1 | 3 | 2
   1 | 3 | 3
   1 | 3 | 4
   1 | 4 | 1
   1 | 4 | 3
   1 | 4 | 4
   1 | 4 | 5
   1 | 5 | 1
   1 | 5 | 2
   1 | 5 | 3
 255 | 5 | 4
   1 | 5 | 5
                                </pre></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Raster_Editors"></a>9.7. ラスタエディタ</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#RT_ST_SetGeoReference">ST_SetGeoReference</a></span><span class="refpurpose"> — 地理参照6パラメタを一度に設定します。数値は空白で区切ります。GDALまたはESRI書式の入力を受け付けます。デフォルトはGDALです。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_SetRotation">ST_SetRotation</a></span><span class="refpurpose"> — ラスタの回転をラジアン単位で設定します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_SetScale">ST_SetScale</a></span><span class="refpurpose"> — ピクセルサイズのX値とY値を空間参照系の単位で設定します。数値は単位/ピクセルの幅または高さです。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_SetSkew">ST_SetSkew</a></span><span class="refpurpose"> — 地理参照のスキュー (回転パラメタ)のX値とY値を設定します。一つだけ渡した場合には、X値とY値は同じ値に設定されます。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_SetSRID">ST_SetSRID</a></span><span class="refpurpose"> — スタのSRIDをspatial_ref_sysに定義されている特定の整数値に設定します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_SetUpperLeft">ST_SetUpperLeft</a></span><span class="refpurpose"> — ラスタの左上隅の投影座標系のX値とY値を設定します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Resample">ST_Resample</a></span><span class="refpurpose"> — 指定したリサンプリングアルゴリズム、新しいピクセル範囲、グリッドの隅、定義するか他のラスタから借りてきた地理参照属性を使ってリサンプリングを行います。 </span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Rescale">ST_Rescale</a></span><span class="refpurpose"> — スケール (ピクセルサイズ)だけを調整するリサンプリングを行います。新しいピクセル値のリサンプリングアルゴリズムとして最近傍補間 ('NearestNeighbor' (米式綴り方))、双線形補間 ('Bilinear')、3次補間 ('Cubic')、3次スプライン補間 ('CubicSpline')、ランチョス補間 ('Lanczos')を用います。デフォルトは最近傍補間です。 </span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Reskew">ST_Reskew</a></span><span class="refpurpose"> — キュー (回転パラメタ)だけを調整するリサンプリングを行います。新しいピクセル値のリサンプリングアルゴリズムとして最近傍補間 ('NearestNeighbor' (米式綴り方))、双線形補間 ('Bilinear')、3次補間 ('Cubic')、3次スプライン補間 ('CubicSpline')、ランチョス補間 ('Lanczos')を用います。デフォルトは最近傍補間です。 </span></dt><dt><span class="refentrytitle"><a href="#RT_ST_SnapToGrid">ST_SnapToGrid</a></span><span class="refpurpose"> — グリッドにスナップすることでラスタをリサンプリングします。新しいピクセル値のリサンプリングアルゴリズムとして最近傍補間 ('NearestNeighbor' (米式綴り方))、双線形補間 ('Bilinear')、3次補間 ('Cubic')、3次スプライン補間 ('CubicSpline')、ランチョス補間('Lanczos')を用います。デフォルトは最近傍補間です。 </span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Resize">ST_Resize</a></span><span class="refpurpose"> — ラスタを新しい幅、高さにサイズ再設定を行います。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Transform">ST_Transform</a></span><span class="refpurpose"> — ラスタを既知の空間参照系から他の既知の空間参照系に、指定したリサンプリングアルゴリズムで投影変換します。新しいピクセル値のリサンプリングアルゴリズムとして最近傍補間 ('NearestNeighbor' (米式綴り方))、双線形補間 ('Bilinear')、3次補間 ('Cubic')、3次スプライン補間 ('CubicSpline')、ランチョス補間 ('Lanczos')を用います。デフォルトは最近傍補間です。</span></dt></dl></div><div class="refentry"><a name="RT_ST_SetGeoReference"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SetGeoReference — 地理参照6パラメタを一度に設定します。数値は空白で区切ります。GDALまたはESRI書式の入力を受け付けます。デフォルトはGDALです。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_SetGeoReference</b>(</code>raster  <var class="pdparam">rast</var>, text  <var class="pdparam">georefcoords</var>, text  <var class="pdparam">format=GDAL</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_SetGeoReference</b>(</code>raster  <var class="pdparam">rast</var>, double precision  <var class="pdparam">upperleftx</var>, double precision  <var class="pdparam">upperlefty</var>, double precision  <var class="pdparam">scalex</var>, double precision  <var class="pdparam">scaley</var>, double precision  <var class="pdparam">skewx</var>, double precision  <var class="pdparam">skewy</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp92189000"></a><h2>説明</h2><p>地理参照6パラメタを一度に設定します。'GDAL'または'ESRI'書式の入力を受け付けます。デフォルトはGDALです。6パラメタが与えられない場合には、NULLを返します。</p><p>書式の表現の違いは次の通りです。</p><p><code class="varname">GDAL</code>: </p><pre class="programlisting">scalex skewy skewx scaley upperleftx upperlefty</pre><p><code class="varname">ESRI</code>: </p><pre class="programlisting">scalex skewy skewx scaley upperleftx + scalex*0.5 upperlefty + scaley*0.5</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ラスタがデータベース外のバンドを持っている場合には、地理参照の変更によって、バンドの外部保存されているデータに正しくアクセスできなくなることがあります。 </p></td></tr></table></div><p>Enhanced: 2.1.0 ST_SetGeoReference(raster, double precision, ...)形式を追加しました。</p></div><div class="refsection"><a name="idp92193736"></a><h2>例</h2><pre class="programlisting">WITH foo AS (
        SELECT ST_MakeEmptyRaster(5, 5, 0, 0, 1, -1, 0, 0, 0) AS rast
)
SELECT
        0 AS rid, (ST_Metadata(rast)).*
FROM foo
UNION ALL
SELECT
        1, (ST_Metadata(ST_SetGeoReference(rast, '10 0 0 -10 0.1 0.1', 'GDAL'))).*
FROM foo
UNION ALL
SELECT
        2, (ST_Metadata(ST_SetGeoReference(rast, '10 0 0 -10 5.1 -4.9', 'ESRI'))).*
FROM foo
UNION ALL
SELECT
        3, (ST_Metadata(ST_SetGeoReference(rast, 1, 1, 10, -10, 0.001, 0.001))).*
FROM foo

 rid |     upperleftx     |     upperlefty     | width | height | scalex | scaley | skewx | skewy | srid | numbands
-----+--------------------+--------------------+-------+--------+--------+--------+-------+-------+------+----------
   0 |                  0 |                  0 |     5 |      5 |      1 |     -1 |     0 |     0 |    0 |        0
   1 |                0.1 |                0.1 |     5 |      5 |     10 |    -10 |     0 |     0 |    0 |        0
   2 | 0.0999999999999996 | 0.0999999999999996 |     5 |      5 |     10 |    -10 |     0 |     0 |    0 |        0
   3 |                  1 |                  1 |     5 |      5 |     10 |    -10 | 0.001 | 0.001 |    0 |        0
                                </pre></div><div class="refsection"><a name="idp92195016"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_GeoReference" title="ST_GeoReference">ST_GeoReference</a>, <a class="xref" href="#RT_ST_ScaleX" title="ST_ScaleX">ST_ScaleX</a>, <a class="xref" href="#RT_ST_ScaleY" title="ST_ScaleY">ST_ScaleY</a>, <a class="xref" href="#RT_ST_UpperLeftX" title="ST_UpperLeftX">ST_UpperLeftX</a>, <a class="xref" href="#RT_ST_UpperLeftY" title="ST_UpperLeftY">ST_UpperLeftY</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_SetRotation"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SetRotation — ラスタの回転をラジアン単位で設定します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float8 <b class="fsfunc">ST_SetRotation</b>(</code>raster <var class="pdparam">rast</var>, float8 <var class="pdparam">rotation</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp92203336"></a><h2>説明</h2><p>ラスタを回転させます。回転はラジアン単位です。詳細については<a class="ulink" href="http://en.wikipedia.org/wiki/World_file" target="_top">World File</a> (英語版WikiPedia)をご覧下さい。</p></div><div class="refsection"><a name="idp92205000"></a><h2>例</h2><pre class="programlisting">SELECT
  ST_ScaleX(rast1), ST_ScaleY(rast1), ST_SkewX(rast1), ST_SkewY(rast1),
  ST_ScaleX(rast2), ST_ScaleY(rast2), ST_SkewX(rast2), ST_SkewY(rast2)
FROM (
  SELECT ST_SetRotation(rast, 15) AS rast1, rast as rast2 FROM dummy_rast
) AS foo;
      st_scalex      |      st_scaley      |      st_skewx      |      st_skewy      | st_scalex | st_scaley | st_skewx | st_skewy
---------------------+---------------------+--------------------+--------------------+-----------+-----------+----------+----------
   -1.51937582571764 |   -2.27906373857646 |   1.95086352047135 |   1.30057568031423 |         2 |         3 |        0 |        0
 -0.0379843956429411 | -0.0379843956429411 | 0.0325143920078558 | 0.0325143920078558 |      0.05 |     -0.05 |        0 |        0
                </pre></div><div class="refsection"><a name="idp92206536"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Rotation" title="ST_Rotation">ST_Rotation</a>, <a class="xref" href="#RT_ST_ScaleX" title="ST_ScaleX">ST_ScaleX</a>, <a class="xref" href="#RT_ST_ScaleY" title="ST_ScaleY">ST_ScaleY</a>, <a class="xref" href="#RT_ST_SkewX" title="ST_SkewX">ST_SkewX</a>, <a class="xref" href="#RT_ST_SkewY" title="ST_SkewY">ST_SkewY</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_SetScale"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SetScale — ピクセルサイズのX値とY値を空間参照系の単位で設定します。数値は単位/ピクセルの幅または高さです。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_SetScale</b>(</code>raster  <var class="pdparam">rast</var>, float8  <var class="pdparam">xy</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_SetScale</b>(</code>raster  <var class="pdparam">rast</var>, float8  <var class="pdparam">x</var>, float8  <var class="pdparam">y</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp92223176"></a><h2>説明</h2><p>ピクセルサイズのX値とY値を空間参照系の単位で設定します。数値は単位/ピクセルの幅または高さです。一つだけ渡した場合には、X値とY値は同じ値に設定されます。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_SetScaleはラスタの範囲をあわせるためのリサンプリングをしない点で<a class="xref" href="#RT_ST_Rescale" title="ST_Rescale">ST_Rescale</a>と異なります。根本的に誤った設定を行ったのを訂正するためにラスタのメタデータ (地理参照)を変更するだけです。ST_Rescaleは、入力ラスタの地理範囲に合わせて計算された幅、高さを持つラスタを返します。ST_SetScaleはラスタの幅も高さも変更しません。</p></td></tr></table></div><p>Changed: 2.0.0 WKTRaster版では、ST_SetPixelSizeと呼ばれていました。2.0.0で変更されました。</p></div><div class="refsection"><a name="idp92225608"></a><h2>例</h2><pre class="programlisting">UPDATE dummy_rast
        SET rast = ST_SetScale(rast, 1.5)
WHERE rid = 2;

SELECT ST_ScaleX(rast) As pixx, ST_ScaleY(rast) As pixy, Box3D(rast) As newbox
FROM dummy_rast
WHERE rid = 2;

 pixx | pixy |                    newbox
------+------+----------------------------------------------
  1.5 |  1.5 | BOX(3427927.75 5793244 0, 3427935.25 5793251.5 0)
                                </pre><pre class="programlisting">UPDATE dummy_rast
        SET rast = ST_SetScale(rast, 1.5, 0.55)
WHERE rid = 2;

SELECT ST_ScaleX(rast) As pixx, ST_ScaleY(rast) As pixy, Box3D(rast) As newbox
FROM dummy_rast
WHERE rid = 2;

 pixx | pixy |                   newbox
------+------+--------------------------------------------
  1.5 | 0.55 | BOX(3427927.75 5793244 0,3427935.25 5793247 0)
                                </pre></div><div class="refsection"><a name="idp92227400"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_ScaleX" title="ST_ScaleX">ST_ScaleX</a>, <a class="xref" href="#RT_ST_ScaleY" title="ST_ScaleY">ST_ScaleY</a>, <a class="xref" href="#RT_Box3D" title="Box3D">Box3D</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_SetSkew"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SetSkew — 地理参照のスキュー (回転パラメタ)のX値とY値を設定します。一つだけ渡した場合には、X値とY値は同じ値に設定されます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_SetSkew</b>(</code>raster  <var class="pdparam">rast</var>, float8  <var class="pdparam">skewxy</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_SetSkew</b>(</code>raster  <var class="pdparam">rast</var>, float8  <var class="pdparam">skewx</var>, float8  <var class="pdparam">skewy</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp92251464"></a><h2>説明</h2><p>地理参照のスキュー (回転パラメタ)のX値とY値を設定します。一つだけ渡した場合には、X値とY値は同じ値に設定されます。詳細については<a class="ulink" href="http://en.wikipedia.org/wiki/World_file" target="_top">World File</a> (英語版WikiPedia)をご覧下さい。</p></div><div class="refsection"><a name="idp92253128"></a><h2>例</h2><pre class="programlisting">-- 例1
UPDATE dummy_rast SET rast = ST_SetSkew(rast,1,2) WHERE rid = 1;
SELECT rid, ST_SkewX(rast) As skewx, ST_SkewY(rast) As skewy,
    ST_GeoReference(rast) as georef
FROM dummy_rast WHERE rid = 1;

rid | skewx | skewy |    georef
----+-------+-------+--------------
  1 |     1 |     2 | 2.0000000000
                    : 2.0000000000
                    : 1.0000000000
                    : 3.0000000000
                    : 0.5000000000
                    : 0.5000000000

                                </pre><pre class="programlisting">-- 例2 同じ値に設定
UPDATE dummy_rast SET rast = ST_SetSkew(rast,0) WHERE rid = 1;
SELECT rid, ST_SkewX(rast) As skewx, ST_SkewY(rast) As skewy,
    ST_GeoReference(rast) as georef
FROM dummy_rast WHERE rid = 1;

 rid | skewx | skewy |    georef
-----+-------+-------+--------------
   1 |     0 |     0 | 2.0000000000
                     : 0.0000000000
                     : 0.0000000000
                     : 3.0000000000
                     : 0.5000000000
                     : 0.5000000000
                                </pre></div><div class="refsection"><a name="idp92255176"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_GeoReference" title="ST_GeoReference">ST_GeoReference</a>, <a class="xref" href="#RT_ST_SetGeoReference" title="ST_SetGeoReference">ST_SetGeoReference</a>, <a class="xref" href="#RT_ST_SkewX" title="ST_SkewX">ST_SkewX</a>, <a class="xref" href="#RT_ST_SkewY" title="ST_SkewY">ST_SkewY</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_SetSRID"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SetSRID — スタのSRIDをspatial_ref_sysに定義されている特定の整数値に設定します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_SetSRID</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">srid</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp92267208"></a><h2>説明</h2><p>ラスタのSRIDを特定の整数値に設定します。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ラスタの投影変換は行いません。単にメタデータを空間参照系の定義されている値に設定するだけです。後で投影変換を行う場合に使います。 </p></td></tr></table></div></div><div class="refsection"><a name="idp92269128"></a><h2>関連情報</h2><p><a class="xref" href="#spatial_ref_sys" title="4.3.1. SPATIAL_REF_SYSテーブルと空間参照系">「SPATIAL_REF_SYSテーブルと空間参照系」</a>, <a class="xref" href="#RT_ST_SRID" title="ST_SRID">ST_SRID</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_SetUpperLeft"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SetUpperLeft — ラスタの左上隅の投影座標系のX値とY値を設定します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_SetUpperLeft</b>(</code>raster  <var class="pdparam">rast</var>, double precision  <var class="pdparam">x</var>, double precision  <var class="pdparam">y</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp92277320"></a><h2>説明</h2><p>ラスタの左上隅の投影座標系のX値とY値を設定します。</p></div><div class="refsection"><a name="idp92278472"></a><h2>例</h2><pre class="programlisting">SELECT ST_SetUpperLeft(rast,-71.01,42.37)
FROM dummy_rast
WHERE rid = 2;
                                        </pre></div><div class="refsection"><a name="idp92279880"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_UpperLeftX" title="ST_UpperLeftX">ST_UpperLeftX</a>, <a class="xref" href="#RT_ST_UpperLeftY" title="ST_UpperLeftY">ST_UpperLeftY</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Resample"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Resample — 指定したリサンプリングアルゴリズム、新しいピクセル範囲、グリッドの隅、定義するか他のラスタから借りてきた地理参照属性を使ってリサンプリングを行います。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_Resample</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">width</var>, integer  <var class="pdparam">height</var>, double precision  <var class="pdparam">gridx=NULL</var>, double precision  <var class="pdparam">gridy=NULL</var>, double precision  <var class="pdparam">skewx=0</var>, double precision  <var class="pdparam">skewy=0</var>, text  <var class="pdparam">algorithm=NearestNeighbour</var>, double precision  <var class="pdparam">maxerr=0.125</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Resample</b>(</code>raster  <var class="pdparam">rast</var>, double precision  <var class="pdparam">scalex=0</var>, double precision  <var class="pdparam">scaley=0</var>, double precision  <var class="pdparam">gridx=NULL</var>, double precision  <var class="pdparam">gridy=NULL</var>, double precision  <var class="pdparam">skewx=0</var>, double precision  <var class="pdparam">skewy=0</var>, text  <var class="pdparam">algorithm=NearestNeighbor</var>, double precision  <var class="pdparam">maxerr=0.125</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Resample</b>(</code>raster  <var class="pdparam">rast</var>, raster  <var class="pdparam">ref</var>, text  <var class="pdparam">algorithm=NearestNeighbour</var>, double precision  <var class="pdparam">maxerr=0.125</var>, boolean  <var class="pdparam">usescale=true</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Resample</b>(</code>raster  <var class="pdparam">rast</var>, raster  <var class="pdparam">ref</var>, boolean  <var class="pdparam">usescale</var>, text  <var class="pdparam">algorithm=NearestNeighbour</var>, double precision  <var class="pdparam">maxerr=0.125</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp92319560"></a><h2>説明</h2><p>指定したリサンプリングアルゴリズム、新しいピクセル範囲 (width &amp; height)、グリッド隅 (gridx &amp; gridy)、定義するか他のラスタから借りてきた地理参照属性 (scalex, scaley, skewx, skewy)を使ってリサンプリングを行います。参照ラスタを使用する場合には、二つのラスタは同じSRIDでなければなりません。 </p><p>新しいピクセル値は、リサンプリングアルゴリズムとして最近傍補間 ('NearestNeighbor' (米式綴り方))、双線形補間 ('Bilinear')、3次補間 ('Cubic')、3次スプライン補間 ('CubicSpline')、ランチョス補間 ('Lanczos')を用います。デフォルトは最も早いですが最も悪い内挿を行う最近傍補間です。 </p><p><code class="varname">maxerr</code>が指定されていない場合には0.125とします。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>詳細については <a class="ulink" href="http://www.gdal.org/gdalwarp.html" target="_top">GDAL Warp resampling methods</a>をご覧下さい。 </p></td></tr></table></div><p>Availability: 2.0.0 GDAL 1.6.1以上が必要です。</p><p>Changed: 2.1.0 srid引数を削除しました。参照ラスタを使う形式では、もはや参照ラスタのSRIDを適用しません。ラスタの投影変換にはST_Transform()を使います。SRIDなしで動作します。</p></div><div class="refsection"><a name="idp92323784"></a><h2>例</h2><pre class="programlisting">SELECT
        ST_Width(orig) AS orig_width,
        ST_Width(reduce_100) AS new_width
FROM (
        SELECT
                rast AS orig,
                ST_Resample(rast,100,100) AS reduce_100
        FROM aerials.boston
        WHERE ST_Intersects(rast,
                ST_Transform(
                        ST_MakeEnvelope(-71.128, 42.2392,-71.1277, 42.2397, 4326),26986)
        )
        LIMIT 1
) AS foo;

 orig_width | new_width
------------+-------------
        200 |         100
                                </pre></div><div class="refsection"><a name="idp92325064"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Rescale" title="ST_Rescale">ST_Rescale</a>, <a class="xref" href="#RT_ST_Resize" title="ST_Resize">ST_Resize</a>, <a class="xref" href="#RT_ST_Transform" title="ST_Transform">ST_Transform</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Rescale"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Rescale — スケール (ピクセルサイズ)だけを調整するリサンプリングを行います。新しいピクセル値のリサンプリングアルゴリズムとして最近傍補間 ('NearestNeighbor' (米式綴り方))、双線形補間 ('Bilinear')、3次補間 ('Cubic')、3次スプライン補間 ('CubicSpline')、ランチョス補間 ('Lanczos')を用います。デフォルトは最近傍補間です。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_Rescale</b>(</code>raster  <var class="pdparam">rast</var>, double precision  <var class="pdparam">scalexy</var>, text  <var class="pdparam">algorithm=NearestNeighbour</var>, double precision  <var class="pdparam">maxerr=0.125</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Rescale</b>(</code>raster  <var class="pdparam">rast</var>, double precision  <var class="pdparam">scalex</var>, double precision  <var class="pdparam">scaley</var>, text  <var class="pdparam">algorithm=NearestNeighbour</var>, double precision  <var class="pdparam">maxerr=0.125</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp92362056"></a><h2>説明</h2><p>スケール (ピクセルサイズ)だけを調整するリサンプリングを行います。新しいピクセル値のリサンプリングアルゴリズムとして最近傍補間 ('NearestNeighbor' (米式綴り方))、双線形補間 ('Bilinear')、3次補間 ('Cubic')、3次スプライン補間 ('CubicSpline')、ランチョス補間 ('Lanczos')を用います。デフォルトは最も早いですが最も悪い内挿を行う最近傍補間です。</p><p><code class="varname">scalex</code>と<code class="varname">scaley</code>で、新しいピクセルサイズを定義します。ラスタを正しい方向にするには、scaleyは負数でなければならないことがしばしばあります。</p><p>新しいscalexまたはscaleyがラスタのwidthまたはheightの除数でない時、結果ラスタの範囲は元のラスタの範囲を含むために拡大されます。<a class="xref" href="#RT_ST_Resize" title="ST_Resize">ST_Resize</a>をご覧ください。</p><p><code class="varname">maxerr</code>が指定されていない場合には0.125とします。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>詳細については <a class="ulink" href="http://www.gdal.org/gdalwarp.html" target="_top">GDAL Warp resampling methods</a>をご覧下さい。 </p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_Recalcは、ST_SetScaleはラスタ範囲に合わせるためのリサンプリングをしない点で、<a class="xref" href="#RT_ST_SetScale" title="ST_SetScale">ST_SetScale</a>と異なります。ST_SetScaleは根本的に誤った設定を行ったのを訂正するためにラスタのメタデータ (地理参照)を変更するだけです。ST_Rescaleは、入力ラスタの地理範囲に合わせて計算された幅、高さを持つラスタを返します。ST_SetScaleはラスタの幅も高さも変更しません。</p></td></tr></table></div><p>Availability: 2.0.0 GDAL 1.6.1以上が必要です。</p><p>Changed: 2.1.0 SRIDなしのラスタで動作するようになりました。</p></div><div class="refsection"><a name="idp92380616"></a><h2>例</h2><p>ラスタのピクセルサイズを0.001度から0.0015度にスケール再設定を行う例です。</p><pre class="programlisting">-- 元のラスタのピクセルサイズ
SELECT ST_PixelWidth(ST_AddBand(ST_MakeEmptyRaster(100, 100, 0, 0, 0.001, -0.001, 0, 0, 4269), '8BUI'::text, 1, 0)) width

   width
----------
0.001

-- スケール再設定したラスタのピクセルサイズ
SELECT ST_PixelWidth(ST_Rescale(ST_AddBand(ST_MakeEmptyRaster(100, 100, 0, 0, 0.001, -0.001, 0, 0, 4269), '8BUI'::text, 1, 0), 0.0015)) width

   width
----------
0.0015
</pre></div><div class="refsection"><a name="idp92382280"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Resize" title="ST_Resize">ST_Resize</a>, <a class="xref" href="#RT_ST_Resample" title="ST_Resample">ST_Resample</a>, <a class="xref" href="#RT_ST_SetScale" title="ST_SetScale">ST_SetScale</a>, <a class="xref" href="#RT_ST_ScaleX" title="ST_ScaleX">ST_ScaleX</a>, <a class="xref" href="#RT_ST_ScaleY" title="ST_ScaleY">ST_ScaleY</a>, <a class="xref" href="#RT_ST_Transform" title="ST_Transform">ST_Transform</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Reskew"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Reskew — キュー (回転パラメタ)だけを調整するリサンプリングを行います。新しいピクセル値のリサンプリングアルゴリズムとして最近傍補間 ('NearestNeighbor' (米式綴り方))、双線形補間 ('Bilinear')、3次補間 ('Cubic')、3次スプライン補間 ('CubicSpline')、ランチョス補間 ('Lanczos')を用います。デフォルトは最近傍補間です。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_Reskew</b>(</code>raster  <var class="pdparam">rast</var>, double precision  <var class="pdparam">skewxy</var>, text  <var class="pdparam">algorithm=NearestNeighbour</var>, double precision  <var class="pdparam">maxerr=0.125</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Reskew</b>(</code>raster  <var class="pdparam">rast</var>, double precision  <var class="pdparam">skewx</var>, double precision  <var class="pdparam">skewy</var>, text  <var class="pdparam">algorithm=NearestNeighbour</var>, double precision  <var class="pdparam">maxerr=0.125</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp92399944"></a><h2>説明</h2><p>スキュー (回転パラメタ)だけを調整するリサンプリングを行います。新しいピクセル値のリサンプリングアルゴリズムとして最近傍補間 ('NearestNeighbor' (米式綴り方))、双線形補間 ('Bilinear')、3次補間 ('Cubic')、3次スプライン補間 ('CubicSpline')、ランチョス補間 ('Lanczos')を用います。デフォルトは最も早いですが最も悪い内挿を行う最近傍補間です。</p><p><code class="varname">skewx</code>と<code class="varname">skewy</code>によって新しいスキューが定義されます。</p><p>新しいラスタの範囲は元のラスタの範囲を含みます。</p><p><code class="varname">maxerr</code>が指定されていない場合には0.125とします。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>詳細については <a class="ulink" href="http://www.gdal.org/gdalwarp.html" target="_top">GDAL Warp resampling methods</a>をご覧下さい。 </p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_Reskewは、ST_SetSkewがラスタの範囲をあわせるためのリサンプリングをしない点で<a class="xref" href="#RT_ST_SetSkew" title="ST_SetSkew">ST_SetSkew</a>と異なります。根本的に誤った設定を行ったのを訂正するためにラスタのメタデータ (地理参照)を変更するだけです。ST_Reskewは、入力ラスタの地理範囲に合わせて計算された幅、高さを持つラスタを返します。ST_SetSkewはラスタの幅も高さも変更しません。</p></td></tr></table></div><p>Availability: 2.0.0 GDAL 1.6.1以上が必要です。</p><p>Changed: 2.1.0 SRIDなしのラスタで動作するようになりました。</p></div><div class="refsection"><a name="idp92414024"></a><h2>例</h2><p>スキューを0.0から0.0015に再設定する簡単な例です。</p><pre class="programlisting">-- 回転前の元のラスタ
SELECT ST_Rotation(ST_AddBand(ST_MakeEmptyRaster(100, 100, 0, 0, 0.001, -0.001, 0, 0, 4269), '8BUI'::text, 1, 0));

-- 結果
0

-- ST_Reskewを施したラスタの回転
SELECT ST_Rotation(ST_Reskew(ST_AddBand(ST_MakeEmptyRaster(100, 100, 0, 0, 0.001, -0.001, 0, 0, 4269), '8BUI'::text, 1, 0), 0.0015));

-- 結果
-0.982793723247329</pre></div><div class="refsection"><a name="idp92415688"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Resample" title="ST_Resample">ST_Resample</a>, <a class="xref" href="#RT_ST_Rescale" title="ST_Rescale">ST_Rescale</a>, <a class="xref" href="#RT_ST_SetSkew" title="ST_SetSkew">ST_SetSkew</a>, <a class="xref" href="#RT_ST_SetRotation" title="ST_SetRotation">ST_SetRotation</a>, <a class="xref" href="#RT_ST_SkewX" title="ST_SkewX">ST_SkewX</a>, <a class="xref" href="#RT_ST_SkewY" title="ST_SkewY">ST_SkewY</a>, <a class="xref" href="#RT_ST_Transform" title="ST_Transform">ST_Transform</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_SnapToGrid"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SnapToGrid — グリッドにスナップすることでラスタをリサンプリングします。新しいピクセル値のリサンプリングアルゴリズムとして最近傍補間 ('NearestNeighbor' (米式綴り方))、双線形補間 ('Bilinear')、3次補間 ('Cubic')、3次スプライン補間 ('CubicSpline')、ランチョス補間('Lanczos')を用います。デフォルトは最近傍補間です。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_SnapToGrid</b>(</code>raster  <var class="pdparam">rast</var>, double precision  <var class="pdparam">gridx</var>, double precision  <var class="pdparam">gridy</var>, text  <var class="pdparam">algorithm=NearestNeighbour</var>, double precision  <var class="pdparam">maxerr=0.125</var>, double precision  <var class="pdparam">scalex=DEFAULT 0</var>, double precision  <var class="pdparam">scaley=DEFAULT 0</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_SnapToGrid</b>(</code>raster  <var class="pdparam">rast</var>, double precision  <var class="pdparam">gridx</var>, double precision  <var class="pdparam">gridy</var>, double precision  <var class="pdparam">scalex</var>, double precision  <var class="pdparam">scaley</var>, text  <var class="pdparam">algorithm=NearestNeighbour</var>, double precision  <var class="pdparam">maxerr=0.125</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_SnapToGrid</b>(</code>raster  <var class="pdparam">rast</var>, double precision  <var class="pdparam">gridx</var>, double precision  <var class="pdparam">gridy</var>, double precision  <var class="pdparam">scalexy</var>, text  <var class="pdparam">algorithm=NearestNeighbour</var>, double precision  <var class="pdparam">maxerr=0.125</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp90693448"></a><h2>説明</h2><p>任意のピクセル隅 (gridx &amp; gridy)と、任意引数としてピクセルサイズ (scalex &amp; scaley)によって定義されるグリッドにスナップすることでラスタをリサンプリングします。新しいピクセル値のリサンプリングアルゴリズムとして最近傍補間 ('NearestNeighbor' (米式綴り方))、双線形補間 ('Bilinear')、3次補間 ('Cubic')、3次スプライン補間 ('CubicSpline')、ランチョス補間 ('Lanczos')を用います。デフォルトは最も早いですが最も悪い内挿を行う最近傍補間です。</p><p><code class="varname">gridx</code>と<code class="varname">gridy</code>は、新しいグリッドの任意のピクセル隅を定義します。これは新しいラスタの左上隅に必ずなるものではありません。新しいラスタ範囲の内部または境界である必要はありません。</p><p>任意引数として、新しいグリッドのピクセルサイズを<code class="varname">scalex</code>と<code class="varname">scaley</code>で指定することができます。</p><p>新しいラスタの範囲は元のラスタの範囲を含みます。</p><p><code class="varname">maxerr</code>が指定されていない場合には0.125とします。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>詳細については <a class="ulink" href="http://www.gdal.org/gdalwarp.html" target="_top">GDAL Warp resampling methods</a>をご覧下さい。 </p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>グリッドパラメタより多くの制御が必要な場合には、<a class="xref" href="#RT_ST_Resample" title="ST_Resample">ST_Resample</a>を使います。</p></td></tr></table></div><p>Availability: 2.0.0 GDAL 1.6.1以上が必要です。</p><p>Changed: 2.1.0 SRIDなしのラスタで動作するようになりました。</p></div><div class="refsection"><a name="idp90700488"></a><h2>例</h2><p>ラスタをわずかに異なるグリッドにスナップさせる簡単な例です。</p><pre class="programlisting">-- 元のラスタの左上隅のX値

SELECT ST_UpperLeftX(ST_AddBand(ST_MakeEmptyRaster(10, 10, 0, 0, 0.001, -0.001, 0, 0, 4269), '8BUI'::text, 1, 0));
-- 結果
0

-- スナップしたラスタの左上隅のX値
SELECT ST_UpperLeftX(ST_SnapToGrid(ST_AddBand(ST_MakeEmptyRaster(10, 10, 0, 0, 0.001, -0.001, 0, 0, 4269), '8BUI'::text, 1, 0), 0.0002, 0.0002));

-- 結果
-0.0008</pre></div><div class="refsection"><a name="idp90702152"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Resample" title="ST_Resample">ST_Resample</a>, <a class="xref" href="#RT_ST_Rescale" title="ST_Rescale">ST_Rescale</a>, <a class="xref" href="#RT_ST_UpperLeftX" title="ST_UpperLeftX">ST_UpperLeftX</a>, <a class="xref" href="#RT_ST_UpperLeftY" title="ST_UpperLeftY">ST_UpperLeftY</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Resize"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Resize — ラスタを新しい幅、高さにサイズ再設定を行います。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_Resize</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">width</var>, integer  <var class="pdparam">height</var>, text  <var class="pdparam">algorithm=NearestNeighbor</var>, double precision  <var class="pdparam">maxerr=0.125</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Resize</b>(</code>raster  <var class="pdparam">rast</var>, double precision  <var class="pdparam">percentwidth</var>, double precision  <var class="pdparam">percentheight</var>, text  <var class="pdparam">algorithm=NearestNeighbor</var>, double precision  <var class="pdparam">maxerr=0.125</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Resize</b>(</code>raster  <var class="pdparam">rast</var>, text  <var class="pdparam">width</var>, text  <var class="pdparam">height</var>, text  <var class="pdparam">algorithm=NearestNeighbor</var>, double precision  <var class="pdparam">maxerr=0.125</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp92467272"></a><h2>説明</h2><p>ラスタを新しい幅、高さにサイズ再設定を行います。新しい幅、高さはピクセル数で確実に指定するか、ラスタの幅、高さの比率で指定します。新しいラスタの範囲は元のラスタの範囲と同じです。 </p><p>新しいピクセル値のリサンプリングアルゴリズムとして最近傍補間 ('NearestNeighbor' (米式綴り方))、双線形補間 ('Bilinear')、3次補間 ('Cubic')、3次スプライン補間 ('CubicSpline')、ランチョス補間 ('Lanczos')を用います。デフォルトは最も早いですが最も悪い内挿を行う最近傍補間です。 </p><p>一つ目の形式では、出力ラスタの実際の幅、高さを予定しています。 </p><p>二つ目の形式では、0から1の間の値で、入力ラスタの幅、高さに対する比率を指定しています。 </p><p>三つ目の形式では、出力ラスタの実際の幅、高さを取るか、文字列による入力ラスタの幅、高さに対する百分率 ("20%")を取ります。 </p><p>Availability: 2.1.0 GDAL 1.6.1以上が必要です。</p></div><div class="refsection"><a name="idp92482632"></a><h2>例</h2><pre class="programlisting">WITH foo AS(
SELECT
        1 AS rid,
        ST_Resize(
                ST_AddBand(
                        ST_MakeEmptyRaster(1000, 1000, 0, 0, 1, -1, 0, 0, 0)
                        , 1, '8BUI', 255, 0
                )
        , '50%', '500') AS rast
UNION ALL
SELECT
        2 AS rid,
        ST_Resize(
                ST_AddBand(
                        ST_MakeEmptyRaster(1000, 1000, 0, 0, 1, -1, 0, 0, 0)
                        , 1, '8BUI', 255, 0
                )
        , 500, 100) AS rast
UNION ALL
SELECT
        3 AS rid,
        ST_Resize(
                ST_AddBand(
                        ST_MakeEmptyRaster(1000, 1000, 0, 0, 1, -1, 0, 0, 0)
                        , 1, '8BUI', 255, 0
                )
        , 0.25, 0.9) AS rast
), bar AS (
        SELECT rid, ST_Metadata(rast) AS meta, rast FROM foo
)
SELECT rid, (meta).* FROM bar

 rid | upperleftx | upperlefty | width | height | scalex | scaley | skewx | skewy | srid | numbands
-----+------------+------------+-------+--------+--------+--------+-------+-------+------+----------
   1 |          0 |          0 |   500 |    500 |      1 |     -1 |     0 |     0 |    0 |        1
   2 |          0 |          0 |   500 |    100 |      1 |     -1 |     0 |     0 |    0 |        1
   3 |          0 |          0 |   250 |    900 |      1 |     -1 |     0 |     0 |    0 |        1
(3 rows)
                                </pre></div><div class="refsection"><a name="idp92483912"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Resample" title="ST_Resample">ST_Resample</a>, <a class="xref" href="#RT_ST_Rescale" title="ST_Rescale">ST_Rescale</a>, <a class="xref" href="#RT_ST_Reskew" title="ST_Reskew">ST_Reskew</a>, <a class="xref" href="#RT_ST_SnapToGrid" title="ST_SnapToGrid">ST_SnapToGrid</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Transform"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Transform — ラスタを既知の空間参照系から他の既知の空間参照系に、指定したリサンプリングアルゴリズムで投影変換します。新しいピクセル値のリサンプリングアルゴリズムとして最近傍補間 ('NearestNeighbor' (米式綴り方))、双線形補間 ('Bilinear')、3次補間 ('Cubic')、3次スプライン補間 ('CubicSpline')、ランチョス補間 ('Lanczos')を用います。デフォルトは最近傍補間です。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_Transform</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">srid</var>, text  <var class="pdparam">algorithm=NearestNeighbor</var>, double precision  <var class="pdparam">maxerr=0.125</var>, double precision  <var class="pdparam">scalex</var>, double precision  <var class="pdparam">scaley</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Transform</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">srid</var>, double precision  <var class="pdparam">scalex</var>, double precision  <var class="pdparam">scaley</var>, text  <var class="pdparam">algorithm=NearestNeighbor</var>, double precision  <var class="pdparam">maxerr=0.125</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Transform</b>(</code>raster  <var class="pdparam">rast</var>, raster  <var class="pdparam">alignto</var>, text  <var class="pdparam">algorithm=NearestNeighbor</var>, double precision  <var class="pdparam">maxerr=0.125</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp92534216"></a><h2>説明</h2><p>ラスタを既知の空間参照系から他の既知の空間参照系に、指定したリサンプリングアルゴリズムで投影変換します。algorithmが指定されていない場合には'NearestNeighbor'とし、maxerrorが指定されていない場合には0.125とします。</p><p>アルゴリズム指定オプションは'NearestNeighbor', 'Bilinear', 'Cubic', 'CubicSpline', 'Lanczos'です。詳細については<a class="ulink" href="http://www.gdal.org/gdalwarp.html" target="_top">GDAL Warp resampling methods</a>をご覧ください。</p><p>ST_TransformはしばしばST_SetSRIDと混同されます。ST_Transformは、ある空間参照系から別の空間参照系に変更する際に、実際にラスタの座標を変更します (かつピクセル値のリサンプリングを行います)が、ST_SetSRIDは単にラスタの空間参照系識別子を変更するだけです。 </p><p>三つ目の形式は、他の形式と違い、<code class="varname">alignto</code>として参照ラスタが求められます。投影変換したラスタは参照ラスタの空間参照系 (SRID)に投影変換して、参照ラスタと同じアラインメントを持つようにします (ST_SameAlignmentがTRUEになるようにします)。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>変換機能が思ったように働かない場合には、環境変数PROJSOをPostGISが使用する投影変換ライブラリの.soまたは.dllに指定する必要があるかも知れません。ファイル名の指定だけ必要です。Windowsでの例として、コントロールパネル-&gt;システム-&gt;システムの詳細設定-&gt;環境変数で、<code class="varname">PROJSO</code>という名前のシステム変数を追加して、<code class="varname">libproj.dll</code> (Proj 4.6.1を使用している場合)を設定します。変更後はPostgreSQLサービス/デーモンを再起動します。 </p></td></tr></table></div><p>Availability: 2.0.0 GDAL 1.6.1以上が必要です。</p><p>Enhanced: 2.1.0 ST_Tranfrorm(rast, alignto)の形式を追加しました。</p></div><div class="refsection"><a name="idp92539720"></a><h2>例</h2><pre class="programlisting">SELECT ST_Width(mass_stm) As w_before, ST_Width(wgs_84) As w_after,
  ST_Height(mass_stm) As h_before, ST_Height(wgs_84) As h_after
        FROM
        ( SELECT rast As mass_stm, ST_Transform(rast,4326) As wgs_84
  ,  ST_Transform(rast,4326, 'Bilinear') AS wgs_84_bilin
                FROM aerials.o_2_boston
                        WHERE ST_Intersects(rast,
                                ST_Transform(ST_MakeEnvelope(-71.128, 42.2392,-71.1277, 42.2397, 4326),26986) )
                LIMIT 1) As foo;

 w_before | w_after | h_before | h_after
----------+---------+----------+---------
      200 |     228 |      200 |     170
                                        </pre><div class="informaltable"><table class="informaltable" border="1"><colgroup><col><col><col></colgroup><tbody><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/rt_st_transform01.png"><div class="caption"><p>元のラスタはメートル単位のマサチューセッツ州平面 (mass_stm)</p></div></div></div>
		 </td><td><div class="informalfigure"><div class="mediaobject"><img src="images/rt_st_transform02.png"><div class="caption"><p>WGS84経度緯度に変換した後 (wgs_84)</p></div></div></div>
		 </td><td><div class="informalfigure"><div class="mediaobject"><img src="images/rt_st_transform03.png"><div class="caption"><p>最近傍補間の代わりに双線形補間を使ってWGS84経度緯度に変換した後 (wgs_84_bilin)</p></div></div></div>
		 </td></tr></tbody></table></div></div><div class="refsection"><a name="idp92550344"></a><h2>例: 三つ目の形式</h2><p>次に示す例は、ST_Transform(raster, srid)とST_Transform(raster, alignto)との違いを示しています。</p><pre class="programlisting">WITH foo AS (
        SELECT 0 AS rid, ST_AddBand(ST_MakeEmptyRaster(2, 2, -500000, 600000, 100, -100, 0, 0, 2163), 1, '16BUI', 1, 0) AS rast UNION ALL
        SELECT 1, ST_AddBand(ST_MakeEmptyRaster(2, 2, -499800, 600000, 100, -100, 0, 0, 2163), 1, '16BUI', 2, 0) AS rast UNION ALL
        SELECT 2, ST_AddBand(ST_MakeEmptyRaster(2, 2, -499600, 600000, 100, -100, 0, 0, 2163), 1, '16BUI', 3, 0) AS rast UNION ALL

        SELECT 3, ST_AddBand(ST_MakeEmptyRaster(2, 2, -500000, 599800, 100, -100, 0, 0, 2163), 1, '16BUI', 10, 0) AS rast UNION ALL
        SELECT 4, ST_AddBand(ST_MakeEmptyRaster(2, 2, -499800, 599800, 100, -100, 0, 0, 2163), 1, '16BUI', 20, 0) AS rast UNION ALL
        SELECT 5, ST_AddBand(ST_MakeEmptyRaster(2, 2, -499600, 599800, 100, -100, 0, 0, 2163), 1, '16BUI', 30, 0) AS rast UNION ALL

        SELECT 6, ST_AddBand(ST_MakeEmptyRaster(2, 2, -500000, 599600, 100, -100, 0, 0, 2163), 1, '16BUI', 100, 0) AS rast UNION ALL
        SELECT 7, ST_AddBand(ST_MakeEmptyRaster(2, 2, -499800, 599600, 100, -100, 0, 0, 2163), 1, '16BUI', 200, 0) AS rast UNION ALL
        SELECT 8, ST_AddBand(ST_MakeEmptyRaster(2, 2, -499600, 599600, 100, -100, 0, 0, 2163), 1, '16BUI', 300, 0) AS rast
), bar AS (
        SELECT
                ST_Transform(rast, 4269) AS alignto
        FROM foo
        LIMIT 1
), baz AS (
        SELECT
                rid,
                rast,
                ST_Transform(rast, 4269) AS not_aligned,
                ST_Transform(rast, alignto) AS aligned
        FROM foo
        CROSS JOIN bar
)
SELECT
        ST_SameAlignment(rast) AS rast,
        ST_SameAlignment(not_aligned) AS not_aligned,
        ST_SameAlignment(aligned) AS aligned
FROM baz

 rast | not_aligned | aligned
------+-------------+---------
 t    | f           | t
                                </pre></div><div class="refsection"><a name="idp92552136"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Transform" title="ST_Transform">ST_Transform</a>, <a class="xref" href="#RT_ST_SetSRID" title="ST_SetSRID">ST_SetSRID</a></p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="RasterBand_Editors"></a>9.8. ラスタバンドエディタ</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#RT_ST_SetBandNoDataValue">ST_SetBandNoDataValue</a></span><span class="refpurpose"> — 指定したバンドにNODATAを表現する値を設定します。バンドを指定しない場合には、1番と仮定します。NODATA値を持たないようにするには、nodatavalueにNULLを指定します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_SetBandIsNoData">ST_SetBandIsNoData</a></span><span class="refpurpose"> — バンドのisnodataフラグをTRUEにします。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_SetBandPath">ST_SetBandPath</a></span><span class="refpurpose"> — データベース外バンドの外部パスとバンド番号を更新します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_SetBandIndex">ST_SetBandIndex</a></span><span class="refpurpose"> — データベース外バンドの外部バンド番号の更新</span></dt></dl></div><div class="refentry"><a name="RT_ST_SetBandNoDataValue"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SetBandNoDataValue — 指定したバンドにNODATAを表現する値を設定します。バンドを指定しない場合には、1番と仮定します。NODATA値を持たないようにするには、nodatavalueにNULLを指定します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_SetBandNoDataValue</b>(</code>raster  <var class="pdparam">rast</var>, double precision  <var class="pdparam">nodatavalue</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_SetBandNoDataValue</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">band</var>, double precision  <var class="pdparam">nodatavalue</var>, boolean  <var class="pdparam">forcechecking=false</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp92565576"></a><h2>説明</h2><p>指定したバンドにNODATAを表現する値を設定します。バンドを指定しない場合には、1番と仮定します。この関数は<a class="xref" href="#RT_ST_Polygon" title="ST_Polygon">ST_Polygon</a>, <a class="xref" href="#RT_ST_DumpAsPolygons" title="ST_DumpAsPolygons">ST_DumpAsPolygons</a>, ST_PixelAs系関数群からの結果に影響を与えます。</p></div><div class="refsection"><a name="idp92567496"></a><h2>例</h2><pre class="programlisting">-- 1番バンドのNODATA値を変更します
UPDATE dummy_rast
        SET rast = ST_SetBandNoDataValue(rast,1, 254)
WHERE rid = 2;

-- 1番、2番、3番のNODATA値を変更します
UPDATE dummy_rast
        SET rast =
                ST_SetBandNoDataValue(
                        ST_SetBandNoDataValue(
                                ST_SetBandNoDataValue(
                                        rast,1, 254)
                                ,2,99),
                                3,108)
                WHERE rid = 2;

-- NODATA値の設定を解除して、処理関数が全てのピクセルを考慮するようにします
-- wipe out the nodata value this will ensure all pixels are considered for all processing functions
UPDATE dummy_rast
        SET rast = ST_SetBandNoDataValue(rast,1, NULL)
WHERE rid = 2;
                                        </pre></div><div class="refsection"><a name="idp92568776"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_BandNoDataValue" title="ST_BandNoDataValue">ST_BandNoDataValue</a>, <a class="xref" href="#RT_ST_NumBands" title="ST_NumBands">ST_NumBands</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_SetBandIsNoData"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SetBandIsNoData — バンドのisnodataフラグをTRUEにします。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_SetBandIsNoData</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">band=1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp92576072"></a><h2>説明</h2><p>バンドのisnodataフラグをTRUEにします。バンドを指定しない場合には、1番と仮定します。isnodataフラグが汚れている場合にのみ呼ぶべきものです。<a class="xref" href="#RT_ST_BandIsNoData" title="ST_BandIsNoData">ST_BandIsNoData</a>の、最後の引数にTRUEを設定した場合の結果と指定しない場合の結果とで異なっている時です。</p><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp92578120"></a><h2>例</h2><pre class="programlisting">-- ラスタカラムを一つ持つダミーテーブルを生成します
create table dummy_rast (rid integer, rast raster);

-- 2バンドでバンドごとに1ピクセルを持つラスタを追加します
-- 一つ目のバンドにはnodatavalueとピクセル値をともに3とし、
-- 二つ目のバンドにはnodatavalue=13とピクセル値=4とします。
insert into dummy_rast values(1,
(
'01' -- little endian - リトルエンディアン (uint8 ndr)
||
'0000' -- version - 版 (uint16 0)
||
'0200' -- nBands - バンド数 (uint16 0)
||
'17263529ED684A3F' -- scaleX - X方向セルサイズ (float64 0.000805965234044584)
||
'F9253529ED684ABF' -- scaleY - Y方向セルサイズ (float64 -0.00080596523404458)
||
'1C9F33CE69E352C0' -- ipX - 左上隅X値 (float64 -75.5533328537098)
||
'718F0E9A27A44840' -- ipY - 左上隅Y値 (float64 49.2824585505576)
||
'ED50EB853EC32B3F' -- skewX - スキューX (float64 0.000211812383858707)
||
'7550EB853EC32B3F' -- skewY - スキューY (float64 0.000211812383858704)
||
'E6100000' -- SRID (int32 4326)
||
'0100' -- width - 横セル数 (uint16 1)
||
'0100' -- height - 縦セル数 (uint16 1)
||
'4' -- hasnodatavalueをTRUEにし、isnodata値を (TRUEにするべきところ)FALSEにする
||
'2' -- 1番バンドのタイプ (4BUI)
||
'03' -- NODATA値==3
||
'03' -- 0列0行ピクセルの値==3 (NODATA値と同じ)
||
'0' -- hasnodatavalueをFALSEにする。
||
'5' -- 2番バンドのタイプ (16BSI)
||
'0D00' -- NODATA値==13
||
'0400' -- 0列0行ピクセルの値==4
)::raster
);

select st_bandisnodata(rast, 1) from dummy_rast where rid = 1; -- FALSEを期待
select st_bandisnodata(rast, 1, TRUE) from dummy_rast where rid = 1; -- TRUEを期待

-- isnodataフラグが汚れているのでTRUEに設定します
update dummy_rast set rast = st_setbandisnodata(rast, 1) where rid = 1;


select st_bandisnodata(rast, 1) from dummy_rast where rid = 1; -- TRUEを期待

                    </pre></div><div class="refsection"><a name="idp92579400"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_BandNoDataValue" title="ST_BandNoDataValue">ST_BandNoDataValue</a>, <a class="xref" href="#RT_ST_NumBands" title="ST_NumBands">ST_NumBands</a>, <a class="xref" href="#RT_ST_SetBandNoDataValue" title="ST_SetBandNoDataValue">ST_SetBandNoDataValue</a>, <a class="xref" href="#RT_ST_BandIsNoData" title="ST_BandIsNoData">ST_BandIsNoData</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_SetBandPath"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SetBandPath — データベース外バンドの外部パスとバンド番号を更新します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_SetBandPath</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">band</var>, text  <var class="pdparam">outdbpath</var>, integer  <var class="pdparam">outdbindex</var>, boolean  <var class="pdparam">force=false</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp92598728"></a><h2>説明</h2><p>データベース外バンドの外部パスと外部バンド番号を更新します。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">force</code>がTRUEの場合には、外部ラスタファイルとPostGISラスタとの互換性 (例：アラインメント、ピクセル対応)確認のためのテストを行いません。このモードは、外部ラスタファイルが存在するファイルシステムの変更を目的としています。 </p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>内部的には、このメソッドは、存在するパス情報を更新する替わりに、PostGISラスタの<code class="varname">band</code>で指定したバンドを新しいバンドに置き換えます。 </p></td></tr></table></div><p>Availability: 2.5.0</p></div><div class="refsection"><a name="idp92602568"></a><h2>例</h2><pre class="programlisting">WITH foo AS (
        SELECT
                ST_AddBand(NULL::raster, '/home/pele/devel/geo/postgis-git/raster/test/regress/loader/Projected.tif', NULL::int[]) AS rast
)
SELECT
        1 AS query,
        *
FROM ST_BandMetadata(
        (SELECT rast FROM foo),
         ARRAY[1,3,2]::int[]
)
UNION ALL
SELECT
        2,
        *
FROM ST_BandMetadata(
        (
                SELECT
                        <span class="strong"><strong>ST_SetBandPath(
                                rast,
                                2,
                                '/home/pele/devel/geo/postgis-git/raster/test/regress/loader/Projected2.tif',
                                1
                        )</strong></span> AS rast
                 FROM foo
        ),
         ARRAY[1,3,2]::int[]
)
ORDER BY 1, 2;

 query | bandnum | pixeltype | nodatavalue | isoutdb |                                      path                                       | outdbbandnum
-------+---------+-----------+-------------+---------+---------------------------------------------------------------------------------+--------------
     1 |       1 | 8BUI      |             | t       | /home/pele/devel/geo/postgis-git/raster/test/regress/loader/Projected.tif       |            1
     1 |       2 | 8BUI      |             | t       | /home/pele/devel/geo/postgis-git/raster/test/regress/loader/Projected.tif       |            2
     1 |       3 | 8BUI      |             | t       | /home/pele/devel/geo/postgis-git/raster/test/regress/loader/Projected.tif       |            3
     2 |       1 | 8BUI      |             | t       | /home/pele/devel/geo/postgis-git/raster/test/regress/loader/Projected.tif       |            1
<span class="strong"><strong>     2 |       2 | 8BUI      |             | t       | /home/pele/devel/geo/postgis-git/raster/test/regress/loader/Projected2.tif      |            1</strong></span>
     2 |       3 | 8BUI      |             | t       | /home/pele/devel/geo/postgis-git/raster/test/regress/loader/Projected.tif       |            3
                                </pre></div><div class="refsection"><a name="idp92604872"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_BandMetaData" title="ST_BandMetaData">ST_BandMetaData</a>, <a class="xref" href="#RT_ST_SetBandIndex" title="ST_SetBandIndex">ST_SetBandIndex</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_SetBandIndex"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SetBandIndex — データベース外バンドの外部バンド番号の更新</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_SetBandIndex</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">band</var>, integer  <var class="pdparam">outdbindex</var>, boolean  <var class="pdparam">force=false</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp92614344"></a><h2>説明</h2><p>データベース外バンドの外部バンド番号を更新します。データベース外バンドと関連する外部ラスタファイルには触れません。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">force</code>がTRUEの場合には、外部ラスタファイルとPostGISラスタとの互換性 (例：アラインメント、ピクセル対応)確認のためのテストを行いません。このモードは、バンドが外部ラスタファイル内で移動する場所を対象としています。 </p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>内部的には、このメソッドは、存在するパス情報を更新する替わりに、PostGISラスタの<code class="varname">band</code>で指定したバンドを新しいバンドに置き換えます。 </p></td></tr></table></div><p>Availability: 2.5.0</p></div><div class="refsection"><a name="idp92618184"></a><h2>例</h2><pre class="programlisting">WITH foo AS (
        SELECT
                ST_AddBand(NULL::raster, '/home/pele/devel/geo/postgis-git/raster/test/regress/loader/Projected.tif', NULL::int[]) AS rast
)
SELECT
        1 AS query,
        *
FROM ST_BandMetadata(
        (SELECT rast FROM foo),
         ARRAY[1,3,2]::int[]
)
UNION ALL
SELECT
        2,
        *
FROM ST_BandMetadata(
        (
                SELECT
                        <span class="strong"><strong>ST_SetBandIndex(
                                rast,
                                2,
                                1
                        )</strong></span> AS rast
                 FROM foo
        ),
         ARRAY[1,3,2]::int[]
)
ORDER BY 1, 2;

 query | bandnum | pixeltype | nodatavalue | isoutdb |                                      path                                       | outdbbandnum
-------+---------+-----------+-------------+---------+---------------------------------------------------------------------------------+--------------
     1 |       1 | 8BUI      |             | t       | /home/pele/devel/geo/postgis-git/raster/test/regress/loader/Projected.tif       |            1
     1 |       2 | 8BUI      |             | t       | /home/pele/devel/geo/postgis-git/raster/test/regress/loader/Projected.tif       |            2
     1 |       3 | 8BUI      |             | t       | /home/pele/devel/geo/postgis-git/raster/test/regress/loader/Projected.tif       |            3
     2 |       1 | 8BUI      |             | t       | /home/pele/devel/geo/postgis-git/raster/test/regress/loader/Projected.tif       |            1
<span class="strong"><strong>     2 |       2 | 8BUI      |             | t       | /home/pele/devel/geo/postgis-git/raster/test/regress/loader/Projected.tif       |            1</strong></span>
     2 |       3 | 8BUI      |             | t       | /home/pele/devel/geo/postgis-git/raster/test/regress/loader/Projected.tif       |            3
                                </pre></div><div class="refsection"><a name="idp92620488"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_BandMetaData" title="ST_BandMetaData">ST_BandMetaData</a>, <a class="xref" href="#RT_ST_SetBandPath" title="ST_SetBandPath">ST_SetBandPath</a> </p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="RasterBand_Stats"></a>9.9. ラスタバンド統計情報と解析</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#RT_ST_Count">ST_Count</a></span><span class="refpurpose"> — ラスタまたはラスタカバレッジの指定したバンドのピクセル数を返します。バンドを指定しない場合には、1番と仮定します。exclude_nodata_valueをTRUEに設定している場合には、NODATA値と等しくないピクセルのみを数えます。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_CountAgg">ST_CountAgg</a></span><span class="refpurpose"> — 集約関数です。ラスタ集合の与えられたバンドのピクセル数を返します。バンドが指定されていない場合には、1番と仮定します。exclude_nodata_valueをTRUEに設定している場合には、NODATA値と等しくないピクセルのみを数えます。 </span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Histogram">ST_Histogram</a></span><span class="refpurpose"> — ラスタまたはラスタカバレッジのビン範囲で分割したデータ分布をまとめるヒストグラムの集合を返します。ビン数を指定しない場合には自動計算されます。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Quantile">ST_Quantile</a></span><span class="refpurpose"> — ラスタまたはラスタテーブルカバレッジのサンプルまたは母集団の分位数を計算します。値がラスタの25%,50%,75%にあるかを調べることができます。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_SummaryStats">ST_SummaryStats</a></span><span class="refpurpose"> — ラスタまたはラスタカバレッジの指定したバンドについて、ピクセル数、合計値、平均値、標準偏差、最小値、最大値からなる統計情報の概要を返します。バンドを指定しない場合には、1番と仮定します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_SummaryStatsAgg">ST_SummaryStatsAgg</a></span><span class="refpurpose"> — 集約関数です。ラスタ集合の指定したバンドについて、ピクセル数、合計値、平均値、標準偏差、最小値、最大値からなる統計情報の概要を返します。バンドを指定しない場合には、1番と仮定します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_ValueCount">ST_ValueCount</a></span><span class="refpurpose"> — ラスタ　(またはラスタカバレッジ)の指定されたバンドで、指定した値を持つピクセルを対象として、ピクセルバンド値とピクセル数からなるレコードの集合を返します。バンドを指定しない場合には、1番と仮定します。デフォルトではNODATA値のピクセルは数えられず、ピクセルの他の値は出力され、ピクセルバンド値は最も近い整数に丸められます。</span></dt></dl></div><div class="refentry"><a name="RT_ST_Count"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Count — ラスタまたはラスタカバレッジの指定したバンドのピクセル数を返します。バンドを指定しない場合には、1番と仮定します。exclude_nodata_valueをTRUEに設定している場合には、NODATA値と等しくないピクセルのみを数えます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">bigint <b class="fsfunc">ST_Count</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband=1</var>, boolean  <var class="pdparam">exclude_nodata_value=true</var><code>)</code>;</p><p><code class="funcdef">bigint <b class="fsfunc">ST_Count</b>(</code>raster  <var class="pdparam">rast</var>, boolean  <var class="pdparam">exclude_nodata_value</var><code>)</code>;</p><p><code class="funcdef">bigint <b class="fsfunc">ST_Count</b>(</code>text  <var class="pdparam">rastertable</var>, text  <var class="pdparam">rastercolumn</var>, integer  <var class="pdparam">nband=1</var>, boolean  <var class="pdparam">exclude_nodata_value=true</var><code>)</code>;</p><p><code class="funcdef">bigint <b class="fsfunc">ST_Count</b>(</code>text  <var class="pdparam">rastertable</var>, text  <var class="pdparam">rastercolumn</var>, boolean  <var class="pdparam">exclude_nodata_value</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp92655176"></a><h2>説明</h2><p>ラスタまたはラスタカバレッジの指定したバンドのピクセル数を返します。<code class="varname">nband</code>でバンドを指定しない場合には、1番と仮定します。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">exclude_nodata_value</code>をTRUEに設定している場合には、<code class="varname">nodata</code>値と等しくないピクセルのみ数えます。<code class="varname">exclude_nodata_value</code>をFALSEに設定している場合には、全てのピクセルを数えます。</p></td></tr></table></div><p>Availability: 2.0.0 </p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_Count(rastertable, rastercolumn, ...)の形式は2.2.0で非推奨関数となりました。代わりに<a class="xref" href="#RT_ST_CountAgg" title="ST_CountAgg">ST_CountAgg</a>を使います。 </p></td></tr></table></div></div><div class="refsection"><a name="idp92659784"></a><h2>例</h2><pre class="programlisting">-- 249でないピクセルの数え上げと、全てのピクセルの数え上げを行います --
SELECT rid, ST_Count(ST_SetBandNoDataValue(rast,249)) As exclude_nodata,
        ST_Count(ST_SetBandNoDataValue(rast,249),false) As include_nodata
    FROM dummy_rast WHERE rid=2;

rid | exclude_nodata | include_nodata
-----+----------------+----------------
   2 |             23 |             25
                                </pre></div><div class="refsection"><a name="idp92661320"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_CountAgg" title="ST_CountAgg">ST_CountAgg</a>, <a class="xref" href="#RT_ST_SummaryStats" title="ST_SummaryStats">ST_SummaryStats</a>, <a class="xref" href="#RT_ST_SetBandNoDataValue" title="ST_SetBandNoDataValue">ST_SetBandNoDataValue</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_CountAgg"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_CountAgg — 集約関数です。ラスタ集合の与えられたバンドのピクセル数を返します。バンドが指定されていない場合には、1番と仮定します。exclude_nodata_valueをTRUEに設定している場合には、NODATA値と等しくないピクセルのみを数えます。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">bigint <b class="fsfunc">ST_CountAgg</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, boolean  <var class="pdparam">exclude_nodata_value</var>, double precision  <var class="pdparam">sample_percent</var><code>)</code>;</p><p><code class="funcdef">bigint <b class="fsfunc">ST_CountAgg</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, boolean  <var class="pdparam">exclude_nodata_value</var><code>)</code>;</p><p><code class="funcdef">bigint <b class="fsfunc">ST_CountAgg</b>(</code>raster  <var class="pdparam">rast</var>, boolean  <var class="pdparam">exclude_nodata_value</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp92678472"></a><h2>説明</h2><p>ラスタ集合の与えられたバンドのピクセル数を返します。<code class="varname">nband</code>でバンドを指定しない場合には、1番と仮定します。</p><p><code class="varname">exclude_nodata_value</code>をTRUEに設定している場合には、<code class="varname">NODATA</code>値と等しくないピクセルのみを数えます。<code class="varname">exclude_nodata_value</code>をFALSEに設定している場合には、全てのピクセルを数えます。 </p><p>デフォルトでは、全てのピクセルを見ます。より早い応答を得るには、<code class="varname">sample_percent</code>値を0から1の間で設定します。</p><p>Availability: 2.2.0 </p></div><div class="refsection"><a name="idp92682568"></a><h2>例</h2><pre class="programlisting">WITH foo AS (
        SELECT
                rast.rast
        FROM (
                SELECT ST_SetValue(
                        ST_SetValue(
                                ST_SetValue(
                                        ST_AddBand(
                                                ST_MakeEmptyRaster(10, 10, 10, 10, 2, 2, 0, 0,0)
                                                , 1, '64BF', 0, 0
                                        )
                                        , 1, 1, 1, -10
                                )
                                , 1, 5, 4, 0
                        )
                        , 1, 5, 5, 3.14159
                ) AS rast
        ) AS rast
        FULL JOIN (
                SELECT generate_series(1, 10) AS id
        ) AS id
                ON 1 = 1
)
SELECT
        ST_CountAgg(rast, 1, TRUE)
FROM foo;

 st_countagg
-------------
          20
(1 row)
                                </pre></div><div class="refsection"><a name="idp92683848"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Count" title="ST_Count">ST_Count</a>, <a class="xref" href="#RT_ST_SummaryStats" title="ST_SummaryStats">ST_SummaryStats</a>, <a class="xref" href="#RT_ST_SetBandNoDataValue" title="ST_SetBandNoDataValue">ST_SetBandNoDataValue</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Histogram"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Histogram — ラスタまたはラスタカバレッジのビン範囲で分割したデータ分布をまとめるヒストグラムの集合を返します。ビン数を指定しない場合には自動計算されます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">SETOF record <b class="fsfunc">ST_Histogram</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband=1</var>, boolean  <var class="pdparam">exclude_nodata_value=true</var>, integer  <var class="pdparam">bins=autocomputed</var>, double precision[]  <var class="pdparam">width=NULL</var>, boolean  <var class="pdparam">right=false</var><code>)</code>;</p><p><code class="funcdef">SETOF record <b class="fsfunc">ST_Histogram</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, integer  <var class="pdparam">bins</var>, double precision[]  <var class="pdparam">width=NULL</var>, boolean  <var class="pdparam">right=false</var><code>)</code>;</p><p><code class="funcdef">SETOF record <b class="fsfunc">ST_Histogram</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, boolean  <var class="pdparam">exclude_nodata_value</var>, integer  <var class="pdparam">bins</var>, boolean  <var class="pdparam">right</var><code>)</code>;</p><p><code class="funcdef">SETOF record <b class="fsfunc">ST_Histogram</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, integer  <var class="pdparam">bins</var>, boolean  <var class="pdparam">right</var><code>)</code>;</p><p><code class="funcdef">SETOF record <b class="fsfunc">ST_Histogram</b>(</code>text  <var class="pdparam">rastertable</var>, text  <var class="pdparam">rastercolumn</var>, integer  <var class="pdparam">nband</var>, integer  <var class="pdparam">bins</var>, boolean  <var class="pdparam">right</var><code>)</code>;</p><p><code class="funcdef">SETOF record <b class="fsfunc">ST_Histogram</b>(</code>text  <var class="pdparam">rastertable</var>, text  <var class="pdparam">rastercolumn</var>, integer  <var class="pdparam">nband</var>, boolean  <var class="pdparam">exclude_nodata_value</var>, integer  <var class="pdparam">bins</var>, boolean  <var class="pdparam">right</var><code>)</code>;</p><p><code class="funcdef">SETOF record <b class="fsfunc">ST_Histogram</b>(</code>text  <var class="pdparam">rastertable</var>, text  <var class="pdparam">rastercolumn</var>, integer  <var class="pdparam">nband=1</var>, boolean  <var class="pdparam">exclude_nodata_value=true</var>, integer  <var class="pdparam">bins=autocomputed</var>, double precision[]  <var class="pdparam">width=NULL</var>, boolean  <var class="pdparam">right=false</var><code>)</code>;</p><p><code class="funcdef">SETOF record <b class="fsfunc">ST_Histogram</b>(</code>text  <var class="pdparam">rastertable</var>, text  <var class="pdparam">rastercolumn</var>, integer  <var class="pdparam">nband=1</var>, integer  <var class="pdparam">bins</var>, double precision[]  <var class="pdparam">width=NULL</var>, boolean  <var class="pdparam">right=false</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp92756808"></a><h2>説明</h2><p>最小値、最大値、合計数、全体から見た割合からなるレコードの集合を返します。<code class="varname">nband</code>でバンドを指定しない場合には、1番と仮定します。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>デフォルトでは、<code class="varname">nodata</code>と同じピクセル値は考慮に入れません。<code class="varname">exclude_nodata_value</code>をFALSEに設定すると全てのピクセルを数えます。</p></td></tr></table></div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><em class="parameter"><code>width </code></em><span class="type">double precision[]</span></span></dt><dd><p>カテゴリ/ビン毎の幅を示す配列です。ビン数の指定がwidth要素数を超える場合には、widthを繰り返します。 </p><p>例: ビン9個、widthが[a, b, c]では、[a, b, c, a, b, c, a, b, c]が出力されます。</p></dd><dt><span class="term"><em class="parameter"><code>bins </code></em><span class="type">integer</span></span></dt><dd><p>取り出し数 -- 関数から戻そうとするレコード数です。指定しない場合には、自動計算されます。</p></dd><dt><span class="term"><em class="parameter"><code>right </code></em><span class="type">boolean</span></span></dt><dd><p>ヒストグラムを右から計算します (デフォルトは左からです)。値の評価の優先順位が、X軸について[a, b)から(a, b]に変わります。</p></dd></dl></div><p>Availability: 2.0.0 </p></div><div class="refsection"><a name="idp92766152"></a><h2>例: 単一ラスタタイル - ビン数を自動計算とした、1番、2番、3番バンドのヒストグラムの計算</h2><pre class="programlisting">SELECT band, (stats).*
FROM (SELECT rid, band, ST_Histogram(rast, band) As stats
    FROM dummy_rast CROSS JOIN generate_series(1,3) As band
     WHERE rid=2) As foo;

 band |  min  |  max  | count | percent
------+-------+-------+-------+---------
    1 |   249 |   250 |     2 |    0.08
    1 |   250 |   251 |     2 |    0.08
    1 |   251 |   252 |     1 |    0.04
    1 |   252 |   253 |     2 |    0.08
    1 |   253 |   254 |    18 |    0.72
    2 |    78 | 113.2 |    11 |    0.44
    2 | 113.2 | 148.4 |     4 |    0.16
    2 | 148.4 | 183.6 |     4 |    0.16
    2 | 183.6 | 218.8 |     1 |    0.04
    2 | 218.8 |   254 |     5 |     0.2
    3 |    62 | 100.4 |    11 |    0.44
    3 | 100.4 | 138.8 |     5 |     0.2
    3 | 138.8 | 177.2 |     4 |    0.16
    3 | 177.2 | 215.6 |     1 |    0.04
    3 | 215.6 |   254 |     4 |    0.16</pre></div><div class="refsection"><a name="idp92767560"></a><h2>例: ビン数を6で固定して2番バンドだけを計算</h2><pre class="programlisting">SELECT (stats).*
FROM (SELECT rid, ST_Histogram(rast, 2,6) As stats
    FROM dummy_rast
     WHERE rid=2) As foo;

    min     |    max     | count | percent
------------+------------+-------+---------
         78 | 107.333333 |     9 |    0.36
 107.333333 | 136.666667 |     6 |    0.24
 136.666667 |        166 |     0 |       0
        166 | 195.333333 |     4 |    0.16
 195.333333 | 224.666667 |     1 |    0.04
 224.666667 |        254 |     5 |     0.2
(6 rows)

-- 前と同じですが、ビン毎のピクセル値の範囲を明示的に制御しています
SELECT (stats).*
FROM (SELECT rid, ST_Histogram(rast, 2,6,ARRAY[0.5,1,4,100,5]) As stats
    FROM dummy_rast
     WHERE rid=2) As foo;

  min  |  max  | count | percent
-------+-------+-------+----------
    78 |  78.5 |     1 |     0.08
  78.5 |  79.5 |     1 |     0.04
  79.5 |  83.5 |     0 |        0
  83.5 | 183.5 |    17 |   0.0068
 183.5 | 188.5 |     0 |        0
 188.5 |   254 |     6 | 0.003664
(6 rows)</pre></div><div class="refsection"><a name="idp92768840"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Count" title="ST_Count">ST_Count</a>, <a class="xref" href="#RT_ST_SummaryStats" title="ST_SummaryStats">ST_SummaryStats</a>, <a class="xref" href="#RT_ST_SummaryStatsAgg" title="ST_SummaryStatsAgg">ST_SummaryStatsAgg</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Quantile"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Quantile — ラスタまたはラスタテーブルカバレッジのサンプルまたは母集団の分位数を計算します。値がラスタの25%,50%,75%にあるかを調べることができます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">SETOF record <b class="fsfunc">ST_Quantile</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband=1</var>, boolean  <var class="pdparam">exclude_nodata_value=true</var>, double precision[]  <var class="pdparam">quantiles=NULL</var><code>)</code>;</p><p><code class="funcdef">SETOF record <b class="fsfunc">ST_Quantile</b>(</code>raster  <var class="pdparam">rast</var>, double precision[]  <var class="pdparam">quantiles</var><code>)</code>;</p><p><code class="funcdef">SETOF record <b class="fsfunc">ST_Quantile</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, double precision[]  <var class="pdparam">quantiles</var><code>)</code>;</p><p><code class="funcdef">double precision <b class="fsfunc">ST_Quantile</b>(</code>raster  <var class="pdparam">rast</var>, double precision  <var class="pdparam">quantile</var><code>)</code>;</p><p><code class="funcdef">double precision <b class="fsfunc">ST_Quantile</b>(</code>raster  <var class="pdparam">rast</var>, boolean  <var class="pdparam">exclude_nodata_value</var>, double precision  <var class="pdparam">quantile=NULL</var><code>)</code>;</p><p><code class="funcdef">double precision <b class="fsfunc">ST_Quantile</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, double precision  <var class="pdparam">quantile</var><code>)</code>;</p><p><code class="funcdef">double precision <b class="fsfunc">ST_Quantile</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, boolean  <var class="pdparam">exclude_nodata_value</var>, double precision  <var class="pdparam">quantile</var><code>)</code>;</p><p><code class="funcdef">double precision <b class="fsfunc">ST_Quantile</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, double precision  <var class="pdparam">quantile</var><code>)</code>;</p><p><code class="funcdef">SETOF record <b class="fsfunc">ST_Quantile</b>(</code>text  <var class="pdparam">rastertable</var>, text  <var class="pdparam">rastercolumn</var>, integer  <var class="pdparam">nband=1</var>, boolean  <var class="pdparam">exclude_nodata_value=true</var>, double precision[]  <var class="pdparam">quantiles=NULL</var><code>)</code>;</p><p><code class="funcdef">SETOF record <b class="fsfunc">ST_Quantile</b>(</code>text  <var class="pdparam">rastertable</var>, text  <var class="pdparam">rastercolumn</var>, integer  <var class="pdparam">nband</var>, double precision[]  <var class="pdparam">quantiles</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp92827720"></a><h2>説明</h2><p>ラスタまたはラスタテーブルカバレッジのサンプルまたは母集団の分位数を計算します。値がラスタの25%,50%,75%にあるかを調べることができます。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">exclude_nodata_value</code>をFALSEに設定している場合には、NODATA値となるピクセルも数えます。</p></td></tr></table></div><p>Availability: 2.0.0 </p></div><div class="refsection"><a name="idp92830024"></a><h2>例</h2><pre class="programlisting">UPDATE dummy_rast SET rast = ST_SetBandNoDataValue(rast,249) WHERE rid=2;
-- 1番バンドの値が249でないピクセルのみ考慮に入れた分位数を計算する例です

SELECT (pvq).*
FROM (SELECT ST_Quantile(rast, ARRAY[0.25,0.75]) As pvq
    FROM dummy_rast WHERE rid=2) As foo
    ORDER BY (pvq).quantile;

 quantile | value
----------+-------
     0.25 |   253
     0.75 |   254

SELECT ST_Quantile(rast, 0.75) As value
    FROM dummy_rast WHERE rid=2;

value
------
  254
</pre><pre class="programlisting">-- 実際の例です。2番バンドでジオメトリとインタセクトする部分の
-- 全てのピクセルの分位数を計算します。
SELECT rid, (ST_Quantile(rast,2)).* As pvc
    FROM o_4_boston
        WHERE ST_Intersects(rast,
            ST_GeomFromText('POLYGON((224486 892151,224486 892200,224706 892200,224706 892151,224486 892151))',26986)
            )
ORDER BY value, quantile,rid
;


 rid | quantile | value
-----+----------+-------
   1 |        0 |     0
   2 |        0 |     0
  14 |        0 |     1
  15 |        0 |     2
  14 |     0.25 |    37
   1 |     0.25 |    42
  15 |     0.25 |    47
   2 |     0.25 |    50
  14 |      0.5 |    56
   1 |      0.5 |    64
  15 |      0.5 |    66
   2 |      0.5 |    77
  14 |     0.75 |    81
  15 |     0.75 |    87
   1 |     0.75 |    94
   2 |     0.75 |   106
  14 |        1 |   199
   1 |        1 |   244
   2 |        1 |   255
  15 |        1 |   255
</pre></div><div class="refsection"><a name="idp92831816"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Count" title="ST_Count">ST_Count</a>, <a class="xref" href="#RT_ST_SummaryStats" title="ST_SummaryStats">ST_SummaryStats</a>, <a class="xref" href="#RT_ST_SummaryStatsAgg" title="ST_SummaryStatsAgg">ST_SummaryStatsAgg</a>, <a class="xref" href="#RT_ST_SetBandNoDataValue" title="ST_SetBandNoDataValue">ST_SetBandNoDataValue</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_SummaryStats"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SummaryStats — ラスタまたはラスタカバレッジの指定したバンドについて、ピクセル数、合計値、平均値、標準偏差、最小値、最大値からなる統計情報の概要を返します。バンドを指定しない場合には、1番と仮定します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">summarystats <b class="fsfunc">ST_SummaryStats</b>(</code>raster  <var class="pdparam">rast</var>, boolean  <var class="pdparam">exclude_nodata_value</var><code>)</code>;</p><p><code class="funcdef">summarystats <b class="fsfunc">ST_SummaryStats</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, boolean  <var class="pdparam">exclude_nodata_value</var><code>)</code>;</p><p><code class="funcdef">summarystats <b class="fsfunc">ST_SummaryStats</b>(</code>text  <var class="pdparam">rastertable</var>, text  <var class="pdparam">rastercolumn</var>, boolean  <var class="pdparam">exclude_nodata_value</var><code>)</code>;</p><p><code class="funcdef">summarystats <b class="fsfunc">ST_SummaryStats</b>(</code>text  <var class="pdparam">rastertable</var>, text  <var class="pdparam">rastercolumn</var>, integer  <var class="pdparam">nband=1</var>, boolean  <var class="pdparam">exclude_nodata_value=true</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp92853832"></a><h2>説明</h2><p>ラスタまたはラスタカバレッジの指定したバンドについて、ピクセル数、合計値、平均値、標準偏差、最小値、最大値からなる<a class="xref" href="#summarystats" title="summarystats">summarystats</a>による統計情報の概要を返します。<code class="varname">nband</code>でバンドを指定しない場合には、1番と仮定します。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>デフォルトでは、<code class="varname">nodata</code>と同じピクセル値は考慮に入れません。<code class="varname">exclude_nodata_value</code>をFALSEに設定すると全てのピクセルを数えます。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>デフォルトでは、全てのピクセルを見ます。より早い応答を得るには、<code class="varname">sample_percent</code>値を1未満で設定します。</p></td></tr></table></div><p>Availability: 2.0.0 </p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_SummaryStats(rastertable, rastercolumn, ...)の形式は2.2.0で非推奨になりました。代わりに<a class="xref" href="#RT_ST_SummaryStatsAgg" title="ST_SummaryStatsAgg">ST_SummaryStatsAgg</a>を使います。 </p></td></tr></table></div></div><div class="refsection"><a name="idp92859464"></a><h2>例: 単一ラスタタイル</h2><pre class="programlisting">SELECT rid, band, (stats).*
FROM (SELECT rid, band, ST_SummaryStats(rast, band) As stats
    FROM dummy_rast CROSS JOIN generate_series(1,3) As band
     WHERE rid=2) As foo;

 rid | band | count | sum  |    mean    |  stddev   | min | max
-----+------+-------+------+------------+-----------+-----+-----
   2 |    1 |    23 | 5821 | 253.086957 |  1.248061 | 250 | 254
   2 |    2 |    25 | 3682 |     147.28 | 59.862188 |  78 | 254
   2 |    3 |    25 | 3290 |      131.6 | 61.647384 |  62 | 254
                                </pre></div><div class="refsection"><a name="idp92860744"></a><h2>例: 対象とする建物とインタセクトするピクセルの概要</h2><p>この例は、ボストンの建物の全て (約102,000件)と空中写真タイル (150x150ピクセルで約134,000タイル)とで、Windows 64ビット上のPostGISで計算したところ、574ミリ秒かかりました。</p><pre class="programlisting">WITH
-- 対象地物
   feat AS (SELECT gid As building_id, geom_26986 As geom FROM buildings AS b
    WHERE gid IN(100, 103,150)
   ),
-- ラスタタイルの2番バンドを建物の境界で切り取って
-- その範囲の統計情報を得ます
   b_stats AS
        (SELECT  building_id, (stats).*
FROM (SELECT building_id, ST_SummaryStats(ST_Clip(rast,2,geom)) As stats
    FROM aerials.boston
                INNER JOIN feat
        ON ST_Intersects(feat.geom,rast)
 ) As foo
 )
-- 最後に統計情報の概要を得ます
SELECT building_id, SUM(count) As num_pixels
  , MIN(min) As min_pval
  ,  MAX(max) As max_pval
  , SUM(mean*count)/SUM(count) As avg_pval
        FROM b_stats
 WHERE count 
&gt; 0
        GROUP BY building_id
        ORDER BY building_id;
 building_id | num_pixels | min_pval | max_pval |     avg_pval
-------------+------------+----------+----------+------------------
         100 |       1090 |        1 |      255 | 61.0697247706422
         103 |        655 |        7 |      182 | 70.5038167938931
         150 |        895 |        2 |      252 | 185.642458100559</pre></div><div class="refsection"><a name="idp92862408"></a><h2>例:ラスタカバレッジ</h2><pre class="programlisting">-- バンドごとの統計情報 --
SELECT band, (stats).*
FROM (SELECT band, ST_SummaryStats('o_4_boston','rast', band) As stats
    FROM generate_series(1,3) As band) As foo;

 band |  count  |  sum   |       mean       |      stddev      | min | max
------+---------+--------+------------------+------------------+-----+-----
    1 | 8450000 | 725799 | 82.7064349112426 | 45.6800222638537 |   0 | 255
    2 | 8450000 | 700487 | 81.4197705325444 | 44.2161184161765 |   0 | 255
    3 | 8450000 | 575943 |  74.682739408284 | 44.2143885481407 |   0 | 255

-- テーブルの場合 -- サンプリング率を100%より低くすると早くなります
-- 25%に設定して、速く答を得ています
SELECT band, (stats).*
FROM (SELECT band, ST_SummaryStats('o_4_boston','rast', band,true,0.25) As stats
    FROM generate_series(1,3) As band) As foo;

 band |  count  |  sum   |       mean       |      stddev      | min | max
------+---------+--------+------------------+------------------+-----+-----
    1 | 2112500 | 180686 | 82.6890480473373 | 45.6961043857248 |   0 | 255
    2 | 2112500 | 174571 |  81.448503668639 | 44.2252623171821 |   0 | 255
    3 | 2112500 | 144364 | 74.6765884023669 | 44.2014869384578 |   0 | 255
                                </pre></div><div class="refsection"><a name="idp92863688"></a><h2>関連情報</h2><p><a class="xref" href="#summarystats" title="summarystats">summarystats</a>, <a class="xref" href="#RT_ST_SummaryStatsAgg" title="ST_SummaryStatsAgg">ST_SummaryStatsAgg</a>, <a class="xref" href="#RT_ST_Count" title="ST_Count">ST_Count</a>, <a class="xref" href="#RT_ST_Clip" title="ST_Clip">ST_Clip</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_SummaryStatsAgg"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SummaryStatsAgg — 集約関数です。ラスタ集合の指定したバンドについて、ピクセル数、合計値、平均値、標準偏差、最小値、最大値からなる統計情報の概要を返します。バンドを指定しない場合には、1番と仮定します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">summarystats <b class="fsfunc">ST_SummaryStatsAgg</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, boolean  <var class="pdparam">exclude_nodata_value</var>, double precision  <var class="pdparam">sample_percent</var><code>)</code>;</p><p><code class="funcdef">summarystats <b class="fsfunc">ST_SummaryStatsAgg</b>(</code>raster  <var class="pdparam">rast</var>, boolean  <var class="pdparam">exclude_nodata_value</var>, double precision  <var class="pdparam">sample_percent</var><code>)</code>;</p><p><code class="funcdef">summarystats <b class="fsfunc">ST_SummaryStatsAgg</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, boolean  <var class="pdparam">exclude_nodata_value</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp92882248"></a><h2>説明</h2><p>ラスタまたはラスタカバレッジの指定したバンドについて、ピクセル数、合計値、平均値、標準偏差、最小値、最大値からなる<a class="xref" href="#summarystats" title="summarystats">summarystats</a>による統計情報の概要を返します。<code class="varname">nband</code>でバンドを指定しない場合には、1番と仮定します。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>デフォルトでは、<code class="varname">NODATA</code>と同じピクセル値は考慮に入れません。<code class="varname">exclude_nodata_value</code>をFALSEに設定すると全てのピクセルを数えます。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>デフォルトでは全てのピクセルを見ます。よりい早い応答を得るには、<code class="varname">sample_percent</code>を0から1の間で設定します。</p></td></tr></table></div><p>Availability: 2.2.0 </p></div><div class="refsection"><a name="idp92886728"></a><h2>例</h2><pre class="programlisting">WITH foo AS (
        SELECT
                rast.rast
        FROM (
                SELECT ST_SetValue(
                        ST_SetValue(
                                ST_SetValue(
                                        ST_AddBand(
                                                ST_MakeEmptyRaster(10, 10, 10, 10, 2, 2, 0, 0,0)
                                                , 1, '64BF', 0, 0
                                        )
                                        , 1, 1, 1, -10
                                )
                                , 1, 5, 4, 0
                        )
                        , 1, 5, 5, 3.14159
                ) AS rast
        ) AS rast
        FULL JOIN (
                SELECT generate_series(1, 10) AS id
        ) AS id
                ON 1 = 1
)
SELECT
        (stats).count,
        round((stats).sum::numeric, 3),
        round((stats).mean::numeric, 3),
        round((stats).stddev::numeric, 3),
        round((stats).min::numeric, 3),
        round((stats).max::numeric, 3)
FROM (
        SELECT
                ST_SummaryStatsAgg(rast, 1, TRUE, 1) AS stats
        FROM foo
) bar;

 count |  round  | round  | round |  round  | round
-------+---------+--------+-------+---------+-------
    20 | -68.584 | -3.429 | 6.571 | -10.000 | 3.142
(1 row)
                                </pre></div><div class="refsection"><a name="idp92888008"></a><h2>関連情報</h2><p><a class="xref" href="#summarystats" title="summarystats">summarystats</a>, <a class="xref" href="#RT_ST_SummaryStats" title="ST_SummaryStats">ST_SummaryStats</a>, <a class="xref" href="#RT_ST_Count" title="ST_Count">ST_Count</a>, <a class="xref" href="#RT_ST_Clip" title="ST_Clip">ST_Clip</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_ValueCount"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ValueCount — ラスタ　(またはラスタカバレッジ)の指定されたバンドで、指定した値を持つピクセルを対象として、ピクセルバンド値とピクセル数からなるレコードの集合を返します。バンドを指定しない場合には、1番と仮定します。デフォルトではNODATA値のピクセルは数えられず、ピクセルの他の値は出力され、ピクセルバンド値は最も近い整数に丸められます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">SETOF record <b class="fsfunc">ST_ValueCount</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband=1</var>, boolean  <var class="pdparam">exclude_nodata_value=true</var>, double precision[]  <var class="pdparam">searchvalues=NULL</var>, double precision  <var class="pdparam">roundto=0</var>, double precision  <var class="pdparam">OUT value</var>, integer  <var class="pdparam">OUT count</var><code>)</code>;</p><p><code class="funcdef">SETOF record <b class="fsfunc">ST_ValueCount</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, double precision[]  <var class="pdparam">searchvalues</var>, double precision  <var class="pdparam">roundto=0</var>, double precision  <var class="pdparam">OUT value</var>, integer  <var class="pdparam">OUT count</var><code>)</code>;</p><p><code class="funcdef">SETOF record <b class="fsfunc">ST_ValueCount</b>(</code>raster  <var class="pdparam">rast</var>, double precision[]  <var class="pdparam">searchvalues</var>, double precision  <var class="pdparam">roundto=0</var>, double precision  <var class="pdparam">OUT value</var>, integer  <var class="pdparam">OUT count</var><code>)</code>;</p><p><code class="funcdef">bigint <b class="fsfunc">ST_ValueCount</b>(</code>raster  <var class="pdparam">rast</var>, double precision  <var class="pdparam">searchvalue</var>, double precision  <var class="pdparam">roundto=0</var><code>)</code>;</p><p><code class="funcdef">bigint <b class="fsfunc">ST_ValueCount</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, boolean  <var class="pdparam">exclude_nodata_value</var>, double precision  <var class="pdparam">searchvalue</var>, double precision  <var class="pdparam">roundto=0</var><code>)</code>;</p><p><code class="funcdef">bigint <b class="fsfunc">ST_ValueCount</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, double precision  <var class="pdparam">searchvalue</var>, double precision  <var class="pdparam">roundto=0</var><code>)</code>;</p><p><code class="funcdef">SETOF record <b class="fsfunc">ST_ValueCount</b>(</code>text  <var class="pdparam">rastertable</var>, text  <var class="pdparam">rastercolumn</var>, integer  <var class="pdparam">nband=1</var>, boolean  <var class="pdparam">exclude_nodata_value=true</var>, double precision[]  <var class="pdparam">searchvalues=NULL</var>, double precision  <var class="pdparam">roundto=0</var>, double precision  <var class="pdparam">OUT value</var>, integer  <var class="pdparam">OUT count</var><code>)</code>;</p><p><code class="funcdef">SETOF record <b class="fsfunc">ST_ValueCount</b>(</code>text  <var class="pdparam">rastertable</var>, text  <var class="pdparam">rastercolumn</var>, double precision[]  <var class="pdparam">searchvalues</var>, double precision  <var class="pdparam">roundto=0</var>, double precision  <var class="pdparam">OUT value</var>, integer  <var class="pdparam">OUT count</var><code>)</code>;</p><p><code class="funcdef">SETOF record <b class="fsfunc">ST_ValueCount</b>(</code>text  <var class="pdparam">rastertable</var>, text  <var class="pdparam">rastercolumn</var>, integer  <var class="pdparam">nband</var>, double precision[]  <var class="pdparam">searchvalues</var>, double precision  <var class="pdparam">roundto=0</var>, double precision  <var class="pdparam">OUT value</var>, integer  <var class="pdparam">OUT count</var><code>)</code>;</p><p><code class="funcdef">bigint<b class="fsfunc">ST_ValueCount</b>(</code>text  <var class="pdparam">rastertable</var>, text  <var class="pdparam">rastercolumn</var>, integer  <var class="pdparam">nband</var>, boolean  <var class="pdparam">exclude_nodata_value</var>, double precision  <var class="pdparam">searchvalue</var>, double precision  <var class="pdparam">roundto=0</var><code>)</code>;</p><p><code class="funcdef">bigint <b class="fsfunc">ST_ValueCount</b>(</code>text  <var class="pdparam">rastertable</var>, text  <var class="pdparam">rastercolumn</var>, double precision  <var class="pdparam">searchvalue</var>, double precision  <var class="pdparam">roundto=0</var><code>)</code>;</p><p><code class="funcdef">bigint <b class="fsfunc">ST_ValueCount</b>(</code>text  <var class="pdparam">rastertable</var>, text  <var class="pdparam">rastercolumn</var>, integer  <var class="pdparam">nband</var>, double precision  <var class="pdparam">searchvalue</var>, double precision  <var class="pdparam">roundto=0</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp93001160"></a><h2>説明</h2><p>ラスタタイルまたはラスタカバレッジの指定したバンドにおけるピクセルバンド値とピクセル数にあたる、<code class="varname">value</code>と<code class="varname">count</code>からなるレコードの集合を返します。 </p><p><code class="varname">nband</code>でバンドを指定しない場合には、1番と仮定します。<code class="varname">searchvalues</code>が指定されていない場合には、ラスタまたはラスタカバレッジで発見した全てのピクセル値が返ります。searchvalueを一つ指定した場合には、指定したピクセルバンド値を持つピクセルの数を示すレコードでなく、整数を返します。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">exclude_nodata_value</code>をFALSEに設定している場合には、NODATA値となるピクセルも数えます。</p></td></tr></table></div><p>Availability: 2.0.0 </p></div><div class="refsection"><a name="idp93005256"></a><h2>例</h2><pre class="programlisting">UPDATE dummy_rast SET rast = ST_SetBandNoDataValue(rast,249) WHERE rid=2;
-- この例では、1番バンドの、値が249でないピクセルに限って数えます

SELECT (pvc).*
FROM (SELECT ST_ValueCount(rast) As pvc
    FROM dummy_rast WHERE rid=2) As foo
    ORDER BY (pvc).value;

 value | count
-------+-------
   250 |     2
   251 |     1
   252 |     2
   253 |     6
   254 |    12

-- この例では、1番バンドの、249を含む全てのピクセルを数えます
SELECT (pvc).*
FROM (SELECT ST_ValueCount(rast,1,false) As pvc
    FROM dummy_rast WHERE rid=2) As foo
    ORDER BY (pvc).value;

 value | count
-------+-------
   249 |     2
   250 |     2
   251 |     1
   252 |     2
   253 |     6
   254 |    12

-- この例では、2番バンドの、NODATA値でない値を持つピクセルに限って数えます
SELECT (pvc).*
FROM (SELECT ST_ValueCount(rast,2) As pvc
    FROM dummy_rast WHERE rid=2) As foo
    ORDER BY (pvc).value;
 value | count
-------+-------
    78 |     1
    79 |     1
    88 |     1
    89 |     1
    96 |     1
    97 |     1
    98 |     1
    99 |     2
   112 |     2
:

                                </pre><pre class="programlisting">-- 現実の例です。空中写真ラスタタイルの2番バンドで、
-- ジオメトリとインタセクトするピクセル数を数え、
-- 500を超えるピクセル数があるピクセルバンド値のみ返します。
SELECT (pvc).value, SUM((pvc).count) As total
FROM (SELECT ST_ValueCount(rast,2) As pvc
    FROM o_4_boston
        WHERE ST_Intersects(rast,
            ST_GeomFromText('POLYGON((224486 892151,224486 892200,224706 892200,224706 892151,224486 892151))',26986)
             )
        ) As foo
    GROUP BY (pvc).value
    HAVING SUM((pvc).count) 
&gt; 500
    ORDER BY (pvc).value;

 value | total
-------+-----
    51 | 502
    54 | 521
</pre><pre class="programlisting">-- 指定したジオメトリとインタセクトするタイルの
-- 値が100のピクセルをラスタタイルごとに数えて返します
SELECT rid, ST_ValueCount(rast,2,100) As count
    FROM o_4_boston
        WHERE ST_Intersects(rast,
            ST_GeomFromText('POLYGON((224486 892151,224486 892200,224706 892200,224706 892151,224486 892151))',26986)
             ) ;

 rid | count
-----+-------
   1 |    56
   2 |    95
  14 |    37
  15 |    64
</pre></div><div class="refsection"><a name="idp93007560"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Count" title="ST_Count">ST_Count</a>, <a class="xref" href="#RT_ST_SetBandNoDataValue" title="ST_SetBandNoDataValue">ST_SetBandNoDataValue</a></p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Raster_Inputs"></a>9.10. ラスタ入力</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#RT_ST_RastFromWKB">ST_RastFromWKB</a></span><span class="refpurpose"> — Well-Known Binary (WKB)ラスタからラスタ値を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_RastFromHexWKB">ST_RastFromHexWKB</a></span><span class="refpurpose"> — Well-Knownバイナリ (WKB)ラスタの16進数表現からラスタを返します。</span></dt></dl></div><div class="refentry"><a name="RT_ST_RastFromWKB"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_RastFromWKB — Well-Known Binary (WKB)ラスタからラスタ値を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_RastFromWKB</b>(</code>bytea  <var class="pdparam">wkb</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp93035080"></a><h2>説明</h2><p>Well-Known Binary (WKB)ラスタが与えられると、ラスタを返します。 </p><p>Availability: 2.5.0</p></div><div class="refsection"><a name="idp93036616"></a><h2>例</h2><pre class="programlisting">SELECT (ST_Metadata(
        ST_RastFromWKB(
                '\001\000\000\000\000\000\000\000\000\000\000\000@\000\000\000\000\000\000\010@\000\000\000\000\000\000\340?\000\000\000\000\000\000\340?\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\012\000\000\000\012\000\024\000'::bytea
        )
)).* AS metadata;

 upperleftx | upperlefty | width | height | scalex | scaley | skewx | skewy | srid | numbands
------------+------------+-------+--------+--------+--------+-------+-------+------+----------
        0.5 |        0.5 |    10 |     20 |      2 |      3 |     0 |     0 |   10 |        0
                                </pre></div><div class="refsection"><a name="idp93037896"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_MetaData" title="ST_MetaData">ST_MetaData</a>, <a class="xref" href="#RT_ST_RastFromHexWKB" title="ST_RastFromHexWKB">ST_RastFromHexWKB</a>, <a class="xref" href="#RT_ST_AsBinary" title="ST_AsBinary/ST_AsWKB">ST_AsBinary/ST_AsWKB</a>, <a class="xref" href="#RT_ST_AsHexWKB" title="ST_AsHexWKB">ST_AsHexWKB</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_RastFromHexWKB"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_RastFromHexWKB — Well-Knownバイナリ (WKB)ラスタの16進数表現からラスタを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_RastFromHexWKB</b>(</code>text  <var class="pdparam">wkb</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp93044936"></a><h2>説明</h2><p>Well-Known Binary (WKB)ラスタが16進数表現で与えられると、ラスタを返します。 </p><p>Availability: 2.5.0</p></div><div class="refsection"><a name="idp93046472"></a><h2>例</h2><pre class="programlisting">SELECT (ST_Metadata(
        ST_RastFromHexWKB(
                '010000000000000000000000400000000000000840000000000000E03F000000000000E03F000000000000000000000000000000000A0000000A001400'
        )
)).* AS metadata;

 upperleftx | upperlefty | width | height | scalex | scaley | skewx | skewy | srid | numbands
------------+------------+-------+--------+--------+--------+-------+-------+------+----------
        0.5 |        0.5 |    10 |     20 |      2 |      3 |     0 |     0 |   10 |        0
                                </pre></div><div class="refsection"><a name="idp93047752"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_MetaData" title="ST_MetaData">ST_MetaData</a>, <a class="xref" href="#RT_ST_RastFromWKB" title="ST_RastFromWKB">ST_RastFromWKB</a>, <a class="xref" href="#RT_ST_AsBinary" title="ST_AsBinary/ST_AsWKB">ST_AsBinary/ST_AsWKB</a>, <a class="xref" href="#RT_ST_AsHexWKB" title="ST_AsHexWKB">ST_AsHexWKB</a> </p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Raster_Outputs"></a>9.11. 出力</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#RT_ST_AsBinary">ST_AsBinary/ST_AsWKB</a></span><span class="refpurpose"> — ラスタのWell-Known Binary (WKB)表現を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_AsHexWKB">ST_AsHexWKB</a></span><span class="refpurpose"> — Well-Known Binary (WKB)ラスタを16進数表現で返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_AsGDALRaster">ST_AsGDALRaster</a></span><span class="refpurpose"> — 指定されたGDALラスタ書式でラスタタイルを返します。ラスタ書式はコンパイルしたライブラリが対応するものです。ライブラリが対応する書式の一覧を得るにはST_GDALRasters()を使います。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_AsJPEG">ST_AsJPEG</a></span><span class="refpurpose"> — ラスタの選択されたバンドを、単一のJoint Photographic Exports Group (JPEG)画像としてバイト配列で返します。バンドを指定せず、1バンドか3より多いバンドがある場合には、1番バンドを使用します。3バンドのみ指定した場合には、3バンドを使用し、RGBに対応付けます。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_AsPNG">ST_AsPNG</a></span><span class="refpurpose"> — ラスタの選択されたバンドを、単一のportable network graphics (PNG)画像としてバイト配列で返します。バンドを指定せず、1バンドか3バンドか4バンドある場合には、全てのバンドを使用します。バンドを指定せず、2バンドか4より多いバンドがある場合には、1番バンドを使用します。対象バンドはRGBまたはRGBAに対応付けられます。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_AsTIFF">ST_AsTIFF</a></span><span class="refpurpose"> — ラスタの選択されたバンドを、単一のTIFF画像 (バイト配列)として返します。バンドを指定しないか指定したバンドがラスタ内に無い場合には、全てのバンドの使用を試みます。</span></dt></dl></div><div class="refentry"><a name="RT_ST_AsBinary"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsBinary/ST_AsWKB — ラスタのWell-Known Binary (WKB)表現を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">bytea <b class="fsfunc">ST_AsBinary</b>(</code>raster  <var class="pdparam">rast</var>, boolean  <var class="pdparam">outasin=FALSE</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsWKB</b>(</code>raster  <var class="pdparam">rast</var>, boolean  <var class="pdparam">outasin=FALSE</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp93060168"></a><h2>説明</h2><p>ラスタのバイナリ表現を返します。<code class="varname">outasin</code>がTRUEの場合には、データベース外のバンドがデータベース内のバンドとして扱われます。表現の詳細については、PostGISソースフォルダにあるraster/doc/RFC2-WellKnownBinaryFormatをご覧下さい。 </p><p>データを文字列表現に変換せずにデータベース外に引き出すためのバイナリカーソルに使えます。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>デフォルトでは、WKB出力には、データベース外のバンドの外部ファイルパスを含みます。クライアントがデータベース外にあるラスタファイルにアクセスできない場合には、<code class="varname">outasin</code>をTRUEに設定します。</p></td></tr></table></div><p>Enhanced: 2.1.0 <code class="varname">outasin</code>の追加</p><p>Enhanced: 2.5.0 <code class="varname">ST_AsWKB</code>の追加</p></div><div class="refsection"><a name="idp93064776"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsBinary(rast) As rastbin FROM dummy_rast WHERE rid=1;

                                         rastbin
---------------------------------------------------------------------------------
\001\000\000\000\000\000\000\000\000\000\000\000@\000\000\000\000\000\000\010@\000\000\000\000\000\000\340?\000\000\000\000\000\000\340?\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\012\000\000\000\012\000\024\000
                                </pre></div><div class="refsection"><a name="idp93066056"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_RastFromWKB" title="ST_RastFromWKB">ST_RastFromWKB</a>, <a class="xref" href="#RT_ST_AsHexWKB" title="ST_AsHexWKB">ST_AsHexWKB</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_AsHexWKB"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsHexWKB — Well-Known Binary (WKB)ラスタを16進数表現で返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">bytea <b class="fsfunc">ST_AsHexWKB</b>(</code>raster  <var class="pdparam">rast</var>, boolean  <var class="pdparam">outasin=FALSE</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp93073480"></a><h2>説明</h2><p>ラスタのバイナリの16進数表現を返します。<code class="varname">outasin</code>がTRUEの場合には、データベース外のバンドがデータベース内のバンドとして扱われます。表現の詳細については、PostGISソースフォルダにあるraster/doc/RFC2-WellKnownBinaryFormatをご覧下さい。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>デフォルトでは、WKB出力には、データベース外のバンドの外部ファイルパスを含みます。クライアントがデータベース外バンドを持っているラスタファイルにアクセスできない場合には、<code class="varname">outasin</code>をTRUEに設定します。</p></td></tr></table></div><p>Availability: 2.5.0 </p></div><div class="refsection"><a name="idp93076552"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsHexWKB(rast) As rastbin FROM dummy_rast WHERE rid=1;

                                                        st_ashexwkb
----------------------------------------------------------------------------------------------------------------------------
 010000000000000000000000400000000000000840000000000000E03F000000000000E03F000000000000000000000000000000000A0000000A001400
                                </pre></div><div class="refsection"><a name="idp93077832"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_RastFromHexWKB" title="ST_RastFromHexWKB">ST_RastFromHexWKB</a>, <a class="xref" href="#RT_ST_AsBinary" title="ST_AsBinary/ST_AsWKB">ST_AsBinary/ST_AsWKB</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_AsGDALRaster"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsGDALRaster — 指定されたGDALラスタ書式でラスタタイルを返します。ラスタ書式はコンパイルしたライブラリが対応するものです。ライブラリが対応する書式の一覧を得るにはST_GDALRasters()を使います。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">bytea <b class="fsfunc">ST_AsGDALRaster</b>(</code>raster  <var class="pdparam">rast</var>, text  <var class="pdparam">format</var>, text[]  <var class="pdparam">options=NULL</var>, integer  <var class="pdparam">srid=sameassource</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp93091528"></a><h2>説明</h2><p>指定された書式でラスタタイルを返します。引数は次の通りです。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="varname">format</code> 出力書式です。libgdalライブラリでコンパイルしたドライバに依存します。一般的には'JPEG', 'GTIff', 'PNG'が有効になっています。ライブラリが対応する形式の一覧を得るには<a class="xref" href="#RT_ST_GDALDrivers" title="ST_GDALDrivers">ST_GDALDrivers</a>を使います。 </p></li><li class="listitem"><p><code class="varname">options</code> GDALオプションの文字列配列です。妥当なオプションは書式に依存します。詳細については<a class="ulink" href="http://www.gdal.org/frmt_various.html" target="_top">GDAL Raster format options</a>をご覧下さい。 </p></li><li class="listitem"><p><code class="varname">srs</code> 画像に埋め込むproj4textまたはsrtext (spatial_ref_sysから)です。 </p></li></ul></div><p>Availability: 2.0.0 - GDAL 1.6.0以上が必要です。 </p></div><div class="refsection"><a name="idp93097544"></a><h2>複数タイルを単一ラスタとするJPEG出力例</h2><pre class="programlisting">SELECT ST_AsGDALRaster(ST_Union(rast), 'JPEG', ARRAY['QUALITY=50']) As rastjpg
FROM dummy_rast
WHERE rast &amp;&amp; ST_MakeEnvelope(10, 10, 11, 11);</pre></div><div class="refsection"><a name="idp93098824"></a><h2>PostgreSQLラージオブジェクト対応を使ったラスタの出力</h2><p>ラスタを他の書式に出力する方法の一つとして、<a class="ulink" href="https://www.postgresql.org/docs/current/static/lo-funcs.html" target="_top">PostgreSQL large object export functions</a>の使用があります。前の例の繰り返しですが、出力も行います。サーバ側のlo関数を使うため、データベースへのスーパーユーザ権限が必要となることに注意して下さい。また、サーバネットワーク上のパスに出力します。ローカルに出力するには、psqlで、サーバのファイルシステムでなくローカルのファイルシステムに出力する等価のlo_関数を使います。</p><pre class="programlisting">DROP TABLE IF EXISTS tmp_out ;

CREATE TABLE tmp_out AS
SELECT lo_from_bytea(0,
       ST_AsGDALRaster(ST_Union(rast), 'JPEG', ARRAY['QUALITY=50'])
        ) AS loid
  FROM dummy_rast
WHERE rast &amp;&amp; ST_MakeEnvelope(10, 10, 11, 11);

SELECT lo_export(loid, '/tmp/dummy.jpg')
   FROM tmp_out;

SELECT lo_unlink(loid)
  FROM tmp_out;</pre></div><div class="refsection"><a name="idp93100872"></a><h2>GTIFF出力の例</h2><pre class="programlisting">SELECT ST_AsGDALRaster(rast, 'GTiff') As rastjpg
FROM dummy_rast WHERE rid=2;

-- GeoTIFFをJPEG、90%品質で圧縮して出力します
SELECT ST_AsGDALRaster(rast, 'GTiff',
  ARRAY['COMPRESS=JPEG', 'JPEG_QUALITY=90'],
  4269) As rasttiff
FROM dummy_rast WHERE rid=2;
                                </pre></div><div class="refsection"><a name="idp93102408"></a><h2>関連情報</h2><p><a class="xref" href="#RT_Raster_Applications" title="5.3. PostGISラスタを使ったカスタムアプリケーションの構築">「PostGISラスタを使ったカスタムアプリケーションの構築」</a>, <a class="xref" href="#RT_ST_GDALDrivers" title="ST_GDALDrivers">ST_GDALDrivers</a>, <a class="xref" href="#RT_ST_SRID" title="ST_SRID">ST_SRID</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_AsJPEG"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsJPEG — ラスタの選択されたバンドを、単一のJoint Photographic Exports Group (JPEG)画像としてバイト配列で返します。バンドを指定せず、1バンドか3より多いバンドがある場合には、1番バンドを使用します。3バンドのみ指定した場合には、3バンドを使用し、RGBに対応付けます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">bytea <b class="fsfunc">ST_AsJPEG</b>(</code>raster  <var class="pdparam">rast</var>, text[]  <var class="pdparam">options=NULL</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsJPEG</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, integer  <var class="pdparam">quality</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsJPEG</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, text[]  <var class="pdparam">options=NULL</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsJPEG</b>(</code>raster  <var class="pdparam">rast</var>, integer[]  <var class="pdparam">nbands</var>, text[]  <var class="pdparam">options=NULL</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsJPEG</b>(</code>raster  <var class="pdparam">rast</var>, integer[]  <var class="pdparam">nbands</var>, integer  <var class="pdparam">quality</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp93139528"></a><h2>説明</h2><p>ラスタの選択されたバンドを、単一のJoint Photographic Exports Group (JPEG)画像として返します。 より一般でないラスタタイプで出力する必要がある場合には、<a class="xref" href="#RT_ST_AsGDALRaster" title="ST_AsGDALRaster">ST_AsGDALRaster</a>を使います。バンドを指定せず、1バンドか3より多いバンドがある場合には、1番バンドを使用します。3バンドのみ指定した場合には、3バンドを使用します。この関数には多数の任意引数が付くさまざまな形式があります。引数については次の通りです。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="varname">nband</code> 単一バンド出力のためのものです。 </p></li><li class="listitem"><p><code class="varname">nbands</code> 出力バンドの配列 (JPEGでは3要素が最大です)で、バンドの並び順はRGBです。たとえばARRAY[3,2,1]は、3番バンドを赤、2番バンドを緑、1番バンドを青にそれぞれ対応させます。 </p></li><li class="listitem"><p><code class="varname">quality</code> 0から100の数値です。高いほどしっかりした画像になります。 </p></li><li class="listitem"><p><code class="varname">options</code> JPEGのために定義するGDALオプションの文字列配列です (<a class="xref" href="#RT_ST_GDALDrivers" title="ST_GDALDrivers">ST_GDALDrivers</a>のcreate_optionsを見てください)。JPEGの妥当なパラメタは <code class="varname">PROGRESSIVE</code>の'ON'または'OFF'と、<code class="varname">QUALITY</code>の0から100までの数 (デフォルトは75)です。詳細については <a class="ulink" href="http://www.gdal.org/frmt_various.html" target="_top">GDAL Raster format options</a>をご覧下さい。 </p></li></ul></div><p>Availability: 2.0.0 - GDAL 1.6.0以上が必要です。 </p></div><div class="refsection"><a name="idp93147720"></a><h2>例: 出力</h2><pre class="programlisting">-- 前から3バンドを75%品質で出力
SELECT ST_AsJPEG(rast) As rastjpg
    FROM dummy_rast WHERE rid=2;

-- 1番バンドのみ90%品質で出力
SELECT ST_AsJPEG(rast,1,90) As rastjpg
    FROM dummy_rast WHERE rid=2;

-- 前から3バンドを、2番を赤、1番を緑、3番を青とし、プログレッシブ、90%品質で出力します
SELECT ST_AsJPEG(rast,ARRAY[2,1,3],ARRAY['QUALITY=90','PROGRESSIVE=ON']) As rastjpg
    FROM dummy_rast WHERE rid=2;</pre></div><div class="refsection"><a name="idp93149256"></a><h2>関連情報</h2><p><a class="xref" href="#RT_Raster_Applications" title="5.3. PostGISラスタを使ったカスタムアプリケーションの構築">「PostGISラスタを使ったカスタムアプリケーションの構築」</a>, <a class="xref" href="#RT_ST_GDALDrivers" title="ST_GDALDrivers">ST_GDALDrivers</a>, <a class="xref" href="#RT_ST_AsGDALRaster" title="ST_AsGDALRaster">ST_AsGDALRaster</a>, <a class="xref" href="#RT_ST_AsPNG" title="ST_AsPNG">ST_AsPNG</a>, <a class="xref" href="#RT_ST_AsTIFF" title="ST_AsTIFF">ST_AsTIFF</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_AsPNG"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsPNG — ラスタの選択されたバンドを、単一のportable network graphics (PNG)画像としてバイト配列で返します。バンドを指定せず、1バンドか3バンドか4バンドある場合には、全てのバンドを使用します。バンドを指定せず、2バンドか4より多いバンドがある場合には、1番バンドを使用します。対象バンドはRGBまたはRGBAに対応付けられます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">bytea <b class="fsfunc">ST_AsPNG</b>(</code>raster  <var class="pdparam">rast</var>, text[]  <var class="pdparam">options=NULL</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsPNG</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, integer  <var class="pdparam">compression</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsPNG</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, text[]  <var class="pdparam">options=NULL</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsPNG</b>(</code>raster  <var class="pdparam">rast</var>, integer[]  <var class="pdparam">nbands</var>, integer  <var class="pdparam">compression</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsPNG</b>(</code>raster  <var class="pdparam">rast</var>, integer[]  <var class="pdparam">nbands</var>, text[]  <var class="pdparam">options=NULL</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp93174984"></a><h2>説明</h2><p>ラスタの選択されたバンドを、単一のportable network graphics (PNG)画像として返します。より一般でないラスタタイプで出力する必要がある場合には、<a class="xref" href="#RT_ST_AsGDALRaster" title="ST_AsGDALRaster">ST_AsGDALRaster</a>を使います。バンドを指定しない場合には、前から3バンドを出力します。この関数には多数の任意引数が付くさまざまな形式があります。<code class="varname">srid</code>が指定されない場合には、sridはラスタが使用しているSRIDを指定します。引数の一覧は次の通りです。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="varname">nband</code> 単一バンド出力のためのものです。 </p></li><li class="listitem"><p><code class="varname">nbands</code> 出力バンドの配列 (PNGでは4要素が最大です)で、バンドの並び順はRGBAです。たとえばARRAY[3,2,1]は、3番バンドを赤、2番バンドを緑、1番バンドを青にそれぞれ対応させます。 </p></li><li class="listitem"><p><code class="varname">compression</code> 1から9の数を指定します。大きいほど圧縮効率が上がります。 </p></li><li class="listitem"><p><code class="varname">options</code> PNGのために定義するGDALオプションの文字列配列です (<a class="xref" href="#RT_ST_GDALDrivers" title="ST_GDALDrivers">ST_GDALDrivers</a>のcreate_optionsを見てください)。PNGの妥当なパラメタはZLEVEL (圧縮に費やす時間の合計で、デフォルトは6)です。ARRAY['ZLEVEL=9']というようにします。この関数が二つの出力を行う必要があるため、ワールドファイルはPNGでは許されません。詳細については<a class="ulink" href="http://www.gdal.org/frmt_various.html" target="_top">GDAL Raster format options</a>をご覧下さい。 </p></li></ul></div><p>Availability: 2.0.0 - GDAL 1.6.0以上が必要です。 </p></div><div class="refsection"><a name="idp93186888"></a><h2>例</h2><pre class="programlisting">SELECT ST_AsPNG(rast) As rastpng
FROM dummy_rast WHERE rid=2;

-- 前から3バンドを出力し、3番を赤、1番を緑、2番を青に対応付けます
SELECT ST_AsPNG(rast, ARRAY[3,1,2]) As rastpng
FROM dummy_rast WHERE rid=2;
                                </pre></div><div class="refsection"><a name="idp93188424"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_AsGDALRaster" title="ST_AsGDALRaster">ST_AsGDALRaster</a>, <a class="xref" href="#RT_ST_ColorMap" title="ST_ColorMap">ST_ColorMap</a>, <a class="xref" href="#RT_ST_GDALDrivers" title="ST_GDALDrivers">ST_GDALDrivers</a>, <a class="xref" href="#RT_Raster_Applications" title="5.3. PostGISラスタを使ったカスタムアプリケーションの構築">「PostGISラスタを使ったカスタムアプリケーションの構築」</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_AsTIFF"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AsTIFF — ラスタの選択されたバンドを、単一のTIFF画像 (バイト配列)として返します。バンドを指定しないか指定したバンドがラスタ内に無い場合には、全てのバンドの使用を試みます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">bytea <b class="fsfunc">ST_AsTIFF</b>(</code>raster  <var class="pdparam">rast</var>, text[]  <var class="pdparam">options=''</var>, integer  <var class="pdparam">srid=sameassource</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsTIFF</b>(</code>raster  <var class="pdparam">rast</var>, text  <var class="pdparam">compression=''</var>, integer  <var class="pdparam">srid=sameassource</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsTIFF</b>(</code>raster  <var class="pdparam">rast</var>, integer[]  <var class="pdparam">nbands</var>, text  <var class="pdparam">compression=''</var>, integer  <var class="pdparam">srid=sameassource</var><code>)</code>;</p><p><code class="funcdef">bytea <b class="fsfunc">ST_AsTIFF</b>(</code>raster  <var class="pdparam">rast</var>, integer[]  <var class="pdparam">nbands</var>, text[]  <var class="pdparam">options</var>, integer  <var class="pdparam">srid=sameassource</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp93216840"></a><h2>説明</h2><p>ラスタの選択されたバンドを、単一のTagged Image File Format (TIFF)画像として返します。バンドを指定しない場合には、全てのバンドの使用を試みます。この関数は<a class="xref" href="#RT_ST_AsGDALRaster" title="ST_AsGDALRaster">ST_AsGDALRaster</a>のラッパです。より一般でないラスタタイプで出力する必要がある場合には、<a class="xref" href="#RT_ST_AsGDALRaster" title="ST_AsGDALRaster">ST_AsGDALRaster</a>を使います。この関数には多数の任意引数が付くさまざまな形式があります。空間参照系 (SRS)の文字列表現が指定されていない場合には、ラスタの空間参照系を使います。引数については次の通りです。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="varname">nbands</code> 出力バンドの配列 (PNGでは3要素が最大です)で、バンドの並び順はRGBです。たとえばARRAY[3,2,1]は、3番バンドを赤、2番バンドを緑、1番バンドを青にそれぞれ対応させます。 </p></li><li class="listitem"><p><code class="varname">compression</code> 圧縮式 -- JPEG90 (または他のパーセント値), LZW, JPEG, DEFLATE9のいずれかです。 </p></li><li class="listitem"><p><code class="varname">options</code> GTiffを定義するGDALオプションの文字列配列です (<a class="xref" href="#RT_ST_GDALDrivers" title="ST_GDALDrivers">ST_GDALDrivers</a>のGTiff用のcreate_optionsを見てください)。詳細については<a class="ulink" href="http://www.gdal.org/frmt_various.html" target="_top">GDAL Raster format options</a>をご覧下さい。 </p></li><li class="listitem"><p><code class="varname">srid</code> ラスタのspatial_ref_sysのSRIDです。地理参照情報を登録するために使われます。 </p></li></ul></div><p>Availability: 2.0.0 - GDAL 1.6.0以上が必要です。 </p></div><div class="refsection"><a name="idp93224648"></a><h2>例: JPEG90%品質圧縮の使用</h2><pre class="programlisting">SELECT ST_AsTIFF(rast, 'JPEG90') As rasttiff
FROM dummy_rast WHERE rid=2;
                                </pre></div><div class="refsection"><a name="idp93226184"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_GDALDrivers" title="ST_GDALDrivers">ST_GDALDrivers</a>, <a class="xref" href="#RT_ST_AsGDALRaster" title="ST_AsGDALRaster">ST_AsGDALRaster</a>, <a class="xref" href="#RT_ST_SRID" title="ST_SRID">ST_SRID</a></p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Raster_Processing"></a>9.12. ラスタ処理</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="#Raster_Processing_MapAlgebra">9.12.1. 地図代数</a></span></dt><dt><span class="sect2"><a href="#Raster_Processing_MapAlgebra_Callbacks">9.12.2. 組み込み地図代数コールバック関数</a></span></dt><dt><span class="sect2"><a href="#Raster_Processing_DEM">9.12.3. DEM (標高)</a></span></dt><dt><span class="sect2"><a href="#Raster_Processing_Geometry">9.12.4. ラスタからジオメトリ</a></span></dt></dl></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="Raster_Processing_MapAlgebra"></a>9.12.1. 地図代数</h3></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#RT_ST_Clip">ST_Clip</a></span><span class="refpurpose"> — 入力ジオメトリで切り取ったラスタを返します。バンドが指定されていない場合には、全てのバンドが返されます。<code class="varname">crop</code>が指定されていない場合には、TRUEと仮定され、出力ラスタをクロップします。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_ColorMap">ST_ColorMap</a></span><span class="refpurpose"> — 元のラスタと指定したバンドから4個までの8BUIバンド (grayscale, RGB, RGBA)からなる新しいラスタを生成します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Grayscale">ST_Grayscale</a></span><span class="refpurpose"> — 元のラスタと指定したバンドを赤、緑、青バンドとして一つの8BUIバンドを持つラスタを生成します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Intersection">ST_Intersection</a></span><span class="refpurpose"> — 二つのラスタの共有部分またはベクタ化したラスタとジオメトリとのインタセクトした部分を表現する、ラスタまたはジオメトリとピクセル値の組の集合を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_MapAlgebra">ST_MapAlgebra (コールバック関数版)</a></span><span class="refpurpose"> — コールバック関数版 - 一つ以上の入力ラスタ、バンドインデクスと一つのユーザ定義コールバック関数から、一つのバンドからなるラスタを返します。 </span></dt><dt><span class="refentrytitle"><a href="#RT_ST_MapAlgebra_expr">ST_MapAlgebra (数式版)</a></span><span class="refpurpose"> — 数式版 - 一つか二つの入力ラスタ、バンド番号、一つ以上のユーザ定義SQL式から一つのバンドを持つラスタを返します。 </span></dt><dt><span class="refentrytitle"><a href="#RT_ST_MapAlgebraExpr">ST_MapAlgebraExpr</a></span><span class="refpurpose"> — 1バンド版: 入力バンドに対する妥当なPostgreSQL代数演算で形成された、指定したピクセルタイプとなる1バンドラスタを生成します。バンドを指定しない場合には、1番を仮定します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_MapAlgebraExpr2">ST_MapAlgebraExpr</a></span><span class="refpurpose"> — 2バンド版: 二つの入力バンドに対する妥当なPostgreSQL代数演算で形成された、指定したピクセルタイプとなる1バンドラスタを生成します。バンドを指定しない場合には、どちらも1番と仮定します。結果ラスタは、一つ目のラスタのアラインメント (スケール、スキュー、ピクセル角位置)にあわされます。範囲は"extenttype"引数で定義されます。取りうる"extenttype"の値はINTERSECTION, UNION, FIRST, SECONDです。 </span></dt><dt><span class="refentrytitle"><a href="#RT_ST_MapAlgebraFct">ST_MapAlgebraFct</a></span><span class="refpurpose"> — 1バンド版 - 入力バンドに対する妥当なPostgreSQL関数で形成された、指定したピクセルタイプとなる1バンドラスタを生成します。バンドを指定しない場合には、1番と仮定します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_MapAlgebraFct2">ST_MapAlgebraFct</a></span><span class="refpurpose"> — 2バンド版 - 二つの入力バンドに対する妥当なPostgreSQL関数で形成された、指定したピクセルタイプとなる1バンドラスタを生成します。バンドを指定しない場合には、1番と仮定します。"extenttype"のデフォルトはINTERSECTIONです。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a></span><span class="refpurpose"> — 1バンド版: ユーザ定義PostgreSQL関数を使用する最近傍地図代数関数です。入力ラスタバンドの近傍の値を与えたPL/pgSQLユーザ定義関数の結果からなるラスタを返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Reclass">ST_Reclass</a></span><span class="refpurpose"> — 元のラスタから再分類したバンドタイプからなるラスタを生成します。nbandは変更するバンドです。nbandが指定されていない場合には、1と仮定します。他の全てのバンドは変更せずに返します。可視画像の書式としてより単純な描画を行うために、16BUIバンドを8BUIバンドに変換する、等のために使います。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Union">ST_Union</a></span><span class="refpurpose"> — ラスタタイルの集合を結合して1以上のバンドからなる単一ラスタを返します。</span></dt></dl></div><div class="refentry"><a name="RT_ST_Clip"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Clip — 入力ジオメトリで切り取ったラスタを返します。バンドが指定されていない場合には、全てのバンドが返されます。<code class="varname">crop</code>が指定されていない場合には、TRUEと仮定され、出力ラスタをクロップします。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_Clip</b>(</code>raster  <var class="pdparam">rast</var>, integer[]  <var class="pdparam">nband</var>, geometry  <var class="pdparam">geom</var>, double precision[]  <var class="pdparam">nodataval=NULL</var>, boolean  <var class="pdparam">crop=TRUE</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Clip</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, geometry  <var class="pdparam">geom</var>, double precision  <var class="pdparam">nodataval</var>, boolean  <var class="pdparam">crop=TRUE</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Clip</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, geometry  <var class="pdparam">geom</var>, boolean  <var class="pdparam">crop</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Clip</b>(</code>raster  <var class="pdparam">rast</var>, geometry  <var class="pdparam">geom</var>, double precision[]  <var class="pdparam">nodataval=NULL</var>, boolean  <var class="pdparam">crop=TRUE</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Clip</b>(</code>raster  <var class="pdparam">rast</var>, geometry  <var class="pdparam">geom</var>, double precision  <var class="pdparam">nodataval</var>, boolean  <var class="pdparam">crop=TRUE</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Clip</b>(</code>raster  <var class="pdparam">rast</var>, geometry  <var class="pdparam">geom</var>, boolean  <var class="pdparam">crop</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp93278152"></a><h2>説明</h2><p>入力ジオメトリ<code class="varname">geom</code>で切り取ったラスタを返します。バンドが指定されていない場合には、全てのバンドが処理されます。 </p><p>ST_Clipが返すラスタは、バンド毎に一つずつ必ず切り取った領域に適用するNODATA値を持ちます。NODATA値が渡されず、入力ラスタがNODATA値を持たない場合には、結果ラスタのNODATA値はST_MinPossibleValue(ST_BandPixelType(rast, band))に設定されます。配列におけるNODATA値の要素数がバンド数より小さい場合には、配列の最後の要素が残りのバンドに適用されます。NODATA値の要素数がバンド数より多い場合には、超過分は無視されます。全てのNODATA値配列を受け付ける形式では、バンド毎に適用される単一値も受け付けます。 </p><p><code class="varname">crop</code>が指定されていない場合には、TRUEと仮定され、出力ラスタを <code class="varname">geom</code>範囲と<code class="varname">rast</code>範囲とのインタセクトした範囲にクロップします。cropがFALSEに設定されている場合には、新しいラスタは<code class="varname">rast</code>と同じ範囲になります。 </p><p>Availability: 2.0.0 </p><p>Enhanced: 2.1.0 C言語で記述されました</p><p>MassGISサイト<a class="ulink" href="http://www.mass.gov/mgis/colororthos2008.htm" target="_top">MassGIS Aerial Orthos</a>にあるマサチューセッツ空中写真データを使った例です。座標はメートル単位のマサチューセッツ州平面です。 </p></div><div class="refsection"><a name="idp93283528"></a><h2>例: 1バンドの切り取り</h2><pre class="programlisting">-- 空中写真タイルの1番バンドを中心から20メートルのバッファで切り取ります
SELECT ST_Clip(rast, 1,
                ST_Buffer(ST_Centroid(ST_Envelope(rast)),20)
        ) from aerials.boston
WHERE rid = 4;
                                        </pre><pre class="programlisting">--ラスタの最終的なピクセル範囲についてのクロップの効果のデモンストレーション
-- crop=trueでは、どのように最終的な範囲がジオメトリに切り取られるかをみます
SELECT ST_XMax(ST_Envelope(ST_Clip(rast, 1, clipper, true))) As xmax_w_trim,
        ST_XMax(clipper) As xmax_clipper,
        ST_XMax(ST_Envelope(ST_Clip(rast, 1, clipper, false))) As xmax_wo_trim,
        ST_XMax(ST_Envelope(rast)) As xmax_rast_orig
FROM (SELECT rast, ST_Buffer(ST_Centroid(ST_Envelope(rast)),6) As clipper
        FROM aerials.boston
WHERE rid = 6) As foo;

   xmax_w_trim    |   xmax_clipper   |   xmax_wo_trim   |  xmax_rast_orig
------------------+------------------+------------------+------------------
 230657.436173996 | 230657.436173996 | 230666.436173996 | 230666.436173996
                                        </pre><div class="informaltable"><table class="informaltable" border="1"><colgroup><col><col></colgroup><tbody><tr><td>
										<p>
											</p><div class="informalfigure"><div class="mediaobject"><img src="images/st_clip01.png"><div class="caption"><p>切り取り前の完全なラスタタイル</p></div></div></div><p>
										</p>
									</td><td>
										<p>
											</p><div class="informalfigure"><div class="mediaobject"><img src="images/st_clip02.png"><div class="caption"><p>切り取り後</p></div></div></div><p>
										</p>
									</td></tr></tbody></table></div></div><div class="refsection"><a name="idp91790152"></a><h2>例: クロップがなく他のバンドは切り取らず1バンドを切り取る</h2><pre class="programlisting">-- 前の例と同じですが、
-- ST_AddBandは全てのバンドが同じピクセル範囲を持っている必要があるので
-- ST_AddBandを使えるようにするためcropをFALSEに設定しなければなりません
SELECT ST_AddBand(ST_Clip(rast, 1,
                ST_Buffer(ST_Centroid(ST_Envelope(rast)),20),false
        ), ARRAY[ST_Band(rast,2),ST_Band(rast,3)] ) from aerials.boston
WHERE rid = 6;
                                        </pre><div class="informaltable"><table class="informaltable" border="1"><colgroup><col><col></colgroup><tbody><tr><td>
										<p>
											</p><div class="informalfigure"><div class="mediaobject"><img src="images/st_clip04.png"><div class="caption"><p>切り取り前の完全なラスタタイル</p></div></div></div><p>
										</p>
									</td><td>
										<p>
											</p><div class="informalfigure"><div class="mediaobject"><img src="images/st_clip05.png"><div class="caption"><p>切り取り後 - シュールですね</p></div></div></div><p>
										</p>
									</td></tr></tbody></table></div></div><div class="refsection"><a name="idp91799496"></a><h2>例: 全バンドの切り取り</h2><pre class="programlisting">-- 空中写真タイルの全バンドを20メートルバッファで切り取ります
-- 違いは、全バンドの切り取りのため
-- 切り取り対象のバンドを指定しないことだけです
SELECT ST_Clip(rast,
          ST_Buffer(ST_Centroid(ST_Envelope(rast)), 20),
          false
        ) from aerials.boston
WHERE rid = 4;
                                        </pre><div class="informaltable"><table class="informaltable" border="1"><colgroup><col><col></colgroup><tbody><tr><td>
										<p>
											</p><div class="informalfigure"><div class="mediaobject"><img src="images/st_clip01.png"><div class="caption"><p>切り取り前の完全なラスタタイル</p></div></div></div><p>
										</p>
									</td><td>
										<p>
											</p><div class="informalfigure"><div class="mediaobject"><img src="images/st_clip03.png"><div class="caption"><p>切り取り後</p></div></div></div><p>
										</p>
									</td></tr></tbody></table></div></div><div class="refsection"><a name="idp93308232"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_AddBand" title="ST_AddBand">ST_AddBand</a>, <a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>, <a class="xref" href="#RT_ST_Intersection" title="ST_Intersection">ST_Intersection</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_ColorMap"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ColorMap — 元のラスタと指定したバンドから4個までの8BUIバンド (grayscale, RGB, RGBA)からなる新しいラスタを生成します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_ColorMap</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband=1</var>, text  <var class="pdparam">colormap=grayscale</var>, text  <var class="pdparam">method=INTERPOLATE</var><code>)</code>;</p></div><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_ColorMap</b>(</code>raster  <var class="pdparam">rast</var>, text  <var class="pdparam">colormap</var>, text  <var class="pdparam">method=INTERPOLATE</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp93322952"></a><h2>説明</h2><p><code class="varname">rast</code>の<code class="varname">nband</code>で示されるバンドに<code class="varname">colormap</code>を適用し、4個までの8BUIバンドからなる新しいラスタを返します。新しいラスタの8BUIバンドの数は<code class="varname">colormap</code>で定義された色要素の数で決まります。 </p><p><code class="varname">nband</code>が指定されていない場合には、1番と仮定します。</p><p><code class="varname">colormap</code>は事前定義された色マップまたは値を定義する行の集合と色要素のキーワードです。 </p><p>妥当な事前定義された<code class="varname">colormap</code>キーワードは次の通りです。 </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="varname">grayscale</code>または<code class="varname">greyscale</code> 1個の8BUIバンドからなるラスタで、グレーの陰影です。 </p></li><li class="listitem"><p><code class="varname">pseudocolor</code> 4個の8BUIバンド (RGBA)からなるラスタで、青から緑、赤に移るものです。 </p></li><li class="listitem"><p><code class="varname">fire</code> 4個の8BUIバンド (RGBA)からなるラスタで、黒から赤、淡黄色に移るものです。 </p></li><li class="listitem"><p><code class="varname">bluered</code>  4個の8BUIバンド (RGBA)からなるラスタで、青からペールホワイト、赤に移るものです。 </p></li></ul></div><p>カスタムカラーマップを指定するためにエントリ (1行1エントリ)の集合を<code class="varname">colormap</code>に渡すことができます。それぞれのエントリは一般的に、ピクセル値、ピクセル値と対応する赤、緑、青、アルファ要素(0から255の間の色要素)からなる5個の値を持ちます。ピクセル値の替わりに百分率値を使うことができ、0%がラスタバンドでの最小値、100%が最大値になります。値はコンマ('.')、タブ、コロン(':')、空白で区切られます。NODATA値に対しては、ピクセル値を<span class="emphasis"><em>nv</em></span>, <span class="emphasis"><em>null</em></span>, <span class="emphasis"><em>nodata</em></span>のいずれかに設定できます。例を次に示します。 </p><pre class="programlisting">5 0 0 0 255
4 100:50 55 255
1 150,100 150 255
0% 255 255 255 255
nv 0 0 0 0
                                        </pre><p><code class="varname">colormap</code>の構文は、GDALツールの<a class="ulink" href="http://www.gdal.org/gdaldem.html#gdaldem_color_relief" target="_top">gdaldem</a>の起伏モードに似ています。 </p><p><code class="varname">method</code>の妥当なキーワードは次の通りです。 </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="varname">INTERPOLATE</code> 与えられたピクセル値の間での滑らかな色合成のための線形補間に使います。 </p></li><li class="listitem"><p><code class="varname">EXACT</code> カラーマップで見つかったピクセル値だけを厳格に一致させます。カラーマップエントリに一致しないピクセルに対しては0 0 0 0 (RGBA)が設定されます。 </p></li><li class="listitem"><p><code class="varname">NEAREST</code> ピクセル値に最も近い値にあうカラーマップエントリを使います。 </p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>カラーマップの偉大な参考情報は<a class="ulink" href="http://www.colorbrewer2.org" target="_top">ColorBrewer</a>にあります。 </p></td></tr></table></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>新しいラスタの結果バンドにはNODATA値が入りません。NODATA値が必要な場合には、 <a class="xref" href="#RT_ST_SetBandNoDataValue" title="ST_SetBandNoDataValue">ST_SetBandNoDataValue</a>を使ってNODATA値をセットします。 </p></td></tr></table></div><p>Availability: 2.1.0 </p></div><div class="refsection"><a name="idp93343176"></a><h2>例</h2><p>これは試行のためのがらくたテーブルです。</p><pre class="programlisting">-- 試験ラスタテーブルの作成 --
DROP TABLE IF EXISTS funky_shapes;
CREATE TABLE funky_shapes(rast raster);

INSERT INTO funky_shapes(rast)
WITH ref AS (
        SELECT ST_MakeEmptyRaster( 200, 200, 0, 200, 1, -1, 0, 0) AS rast
)
SELECT
        ST_Union(rast)
FROM (
        SELECT
                ST_AsRaster(
                        ST_Rotate(
                                ST_Buffer(
                                        ST_GeomFromText('LINESTRING(0 2,50 50,150 150,125 50)'),
                                        i*2
                                ),
                                pi() * i * 0.125, ST_Point(50,50)
                        ),
                        ref.rast, '8BUI'::text, i * 5
                ) AS rast
        FROM ref
        CROSS JOIN generate_series(1, 10, 3) AS i
) AS shapes;
                                        </pre><pre class="programlisting">SELECT
        ST_NumBands(rast) As n_orig,
        ST_NumBands(ST_ColorMap(rast,1, 'greyscale')) As ngrey,
        ST_NumBands(ST_ColorMap(rast,1, 'pseudocolor')) As npseudo,
        ST_NumBands(ST_ColorMap(rast,1, 'fire')) As nfire,
        ST_NumBands(ST_ColorMap(rast,1, 'bluered')) As nbluered,
        ST_NumBands(ST_ColorMap(rast,1, '
100% 255   0   0
 80% 160   0   0
 50% 130   0   0
 30%  30   0   0
 20%  60   0   0
  0%   0   0   0
  nv 255 255 255
        ')) As nred
FROM funky_shapes;
                                        </pre><pre class="screen">n_orig | ngrey | npseudo | nfire | nbluered | nred
--------+-------+---------+-------+----------+------
      1 |     1 |       4 |     4 |        4 |    3
                                        </pre></div><div class="refsection"><a name="idp93345864"></a><h2>例: ST_AsPNGを使用して異なるカラーマップを比較する</h2><pre class="programlisting">SELECT
        ST_AsPNG(rast) As orig_png,
        ST_AsPNG(ST_ColorMap(rast,1,'greyscale')) As grey_png,
        ST_AsPNG(ST_ColorMap(rast,1, 'pseudocolor')) As pseudo_png,
        ST_AsPNG(ST_ColorMap(rast,1, 'nfire')) As fire_png,
        ST_AsPNG(ST_ColorMap(rast,1, 'bluered')) As bluered_png,
        ST_AsPNG(ST_ColorMap(rast,1, '
100% 255   0   0
 80% 160   0   0
 50% 130   0   0
 30%  30   0   0
 20%  60   0   0
  0%   0   0   0
  nv 255 255 255
        ')) As red_png
FROM funky_shapes;
                                        </pre><div class="informaltable"><table class="informaltable" border="1"><colgroup><col><col><col></colgroup><tbody><tr><td>
										<p>
											</p><div class="informalfigure"><div class="mediaobject"><img src="images/st_colormap_orig.png"><div class="caption"><p>orig_png</p></div></div></div><p>
										</p>
									</td><td>
										<p>
											</p><div class="informalfigure"><div class="mediaobject"><img src="images/st_colormap_grey.png"><div class="caption"><p>grey_png</p></div></div></div><p>
										</p>
									</td><td>
										<p>
											</p><div class="informalfigure"><div class="mediaobject"><img src="images/st_colormap_pseudo.png"><div class="caption"><p>pseudo_png</p></div></div></div><p>
										</p>
									</td></tr><tr><td>
										<p>
											</p><div class="informalfigure"><div class="mediaobject"><img src="images/st_colormap_fire.png"><div class="caption"><p>fire_png</p></div></div></div><p>
										</p>
									</td><td>
										<p>
											</p><div class="informalfigure"><div class="mediaobject"><img src="images/st_colormap_bluered.png"><div class="caption"><p>bluered_png</p></div></div></div><p>
										</p>
									</td><td>
										<p>
											</p><div class="informalfigure"><div class="mediaobject"><img src="images/st_colormap_red.png"><div class="caption"><p>red_png</p></div></div></div><p>
										</p>
									</td></tr></tbody></table></div></div><div class="refsection"><a name="idp93372488"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_AsPNG" title="ST_AsPNG">ST_AsPNG</a>, <a class="xref" href="#RT_ST_AsRaster" title="ST_AsRaster">ST_AsRaster</a> <a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>, <a class="xref" href="#RT_ST_Grayscale" title="ST_Grayscale">ST_Grayscale</a> <a class="xref" href="#RT_ST_NumBands" title="ST_NumBands">ST_NumBands</a>, <a class="xref" href="#RT_ST_Reclass" title="ST_Reclass">ST_Reclass</a>, <a class="xref" href="#RT_ST_SetBandNoDataValue" title="ST_SetBandNoDataValue">ST_SetBandNoDataValue</a>, <a class="xref" href="#RT_ST_Union" title="ST_Union">ST_Union</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Grayscale"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Grayscale — 元のラスタと指定したバンドを赤、緑、青バンドとして一つの8BUIバンドを持つラスタを生成します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">(1) raster <b class="fsfunc">ST_Grayscale</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">redband=1</var>, integer  <var class="pdparam">greenband=2</var>, integer  <var class="pdparam">blueband=3</var>, text  <var class="pdparam">extenttype=INTERSECTION</var><code>)</code>;</p></div><div class="funcsynopsis"><p><code class="funcdef">(2) raster <b class="fsfunc">ST_Grayscale</b>(</code>rastbandarg[]  <var class="pdparam">rastbandargset</var>, text  <var class="pdparam">extenttype=INTERSECTION</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp93405640"></a><h2>説明</h2><p>三つの入力バンド (一つ以上のラスタ)を与えられ、一つの8BUIバンドを持つラスタを生成します。タイプが8BUIでない入力バンドは全て<a class="xref" href="#RT_ST_Reclass" title="ST_Reclass">ST_Reclass</a>で再分類されます。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数は<code class="varname">grayscale</code>キーワードを与えた場合の<a class="xref" href="#RT_ST_ColorMap" title="ST_ColorMap">ST_ColorMap</a>とは違います。ST_ColorMapでは一つのバンドを扱いますが、この関数ではRGBの3バンドを期待します。この関数は 0.2989 * 赤 + 0.5870 * 緑 + 0.1140 * 青 という式を適用してRGBをグレースケールにしています。 </p></td></tr></table></div><p>Availability: 2.5.0 </p></div><div class="refsection"><a name="idp93409096"></a><h2>例: 一つ目の形式</h2><pre class="programlisting">SET postgis.gdal_enabled_drivers = 'ENABLE_ALL';
SET postgis.enable_outdb_rasters = True;

WITH apple AS (
        SELECT ST_AddBand(
                ST_MakeEmptyRaster(350, 246, 0, 0, 1, -1, 0, 0, 0),
                '/tmp/apple.png'::text,
                NULL::int[]
        ) AS rast
)
SELECT
        ST_AsPNG(rast) AS original_png,
        ST_AsPNG(ST_Grayscale(rast)) AS grayscale_png
FROM apple;
                                        </pre><div class="informaltable"><table class="informaltable" border="1"><colgroup><col><col></colgroup><tbody><tr><td>
										<p>
											</p><div class="informalfigure"><div class="mediaobject"><img src="images/apple.png"><div class="caption"><p>original_png</p></div></div></div><p>
										</p>
									</td><td>
										<p>
											</p><div class="informalfigure"><div class="mediaobject"><img src="images/apple_st_grayscale.png"><div class="caption"><p>grayscale_png</p></div></div></div><p>
										</p>
									</td></tr></tbody></table></div></div><div class="refsection"><a name="idp93418440"></a><h2>例: 二つ目の形式</h2><pre class="programlisting">SET postgis.gdal_enabled_drivers = 'ENABLE_ALL';
SET postgis.enable_outdb_rasters = True;

WITH apple AS (
        SELECT ST_AddBand(
                ST_MakeEmptyRaster(350, 246, 0, 0, 1, -1, 0, 0, 0),
                '/tmp/apple.png'::text,
                NULL::int[]
        ) AS rast
)
SELECT
        ST_AsPNG(rast) AS original_png,
        ST_AsPNG(ST_Grayscale(
                ARRAY[
                        ROW(rast, 1)::rastbandarg, -- red
                        ROW(rast, 2)::rastbandarg, -- green
                        ROW(rast, 3)::rastbandarg, -- blue
                ]::rastbandarg[]
        )) AS grayscale_png
FROM apple;
                                        </pre></div><div class="refsection"><a name="idp93419720"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_AsPNG" title="ST_AsPNG">ST_AsPNG</a>, <a class="xref" href="#RT_ST_Reclass" title="ST_Reclass">ST_Reclass</a>, <a class="xref" href="#RT_ST_ColorMap" title="ST_ColorMap">ST_ColorMap</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Intersection"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Intersection — 二つのラスタの共有部分またはベクタ化したラスタとジオメトリとのインタセクトした部分を表現する、ラスタまたはジオメトリとピクセル値の組の集合を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">setof geomval <b class="fsfunc">ST_Intersection</b>(</code>geometry  <var class="pdparam">geom</var>, raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">band_num=1</var><code>)</code>;</p><p><code class="funcdef">setof geomval <b class="fsfunc">ST_Intersection</b>(</code>raster  <var class="pdparam">rast</var>, geometry  <var class="pdparam">geom</var><code>)</code>;</p><p><code class="funcdef">setof geomval <b class="fsfunc">ST_Intersection</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">band</var>, geometry  <var class="pdparam">geomin</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Intersection</b>(</code>raster  <var class="pdparam">rast1</var>, raster  <var class="pdparam">rast2</var>, double precision[]  <var class="pdparam">nodataval</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Intersection</b>(</code>raster  <var class="pdparam">rast1</var>, raster  <var class="pdparam">rast2</var>, text  <var class="pdparam">returnband</var>, double precision[]  <var class="pdparam">nodataval</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Intersection</b>(</code>raster  <var class="pdparam">rast1</var>, integer  <var class="pdparam">band1</var>, raster  <var class="pdparam">rast2</var>, integer  <var class="pdparam">band2</var>, double precision[]  <var class="pdparam">nodataval</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Intersection</b>(</code>raster  <var class="pdparam">rast1</var>, integer  <var class="pdparam">band1</var>, raster  <var class="pdparam">rast2</var>, integer  <var class="pdparam">band2</var>, text  <var class="pdparam">returnband</var>, double precision[]  <var class="pdparam">nodataval</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp93459528"></a><h2>説明</h2><p>二つのラスタの共有部分またはベクタ化したラスタとジオメトリとのインタセクトした部分を表現する、ラスタまたはジオメトリとピクセル値の組の集合を返します。 </p><p>前半の三つの形式は、geomvalの集合を返すもので、ベクタ形状を引数に取ります。ラスタは初めにgeomval行の集合にベクトル化されます (ST_DumpAsPolygonを使用)。これらの行はPostGIS関数のST_Intersection(geometry, geometry)を使ってジオメトリとインタセクトさせます。NODATA値の領域とだけインタセクトするジオメトリについては空ジオメトリを返します。通常はWHERE節でST_Intersectsを使って結果から確実に排除します。 </p><p>丸括弧でくくって式の末尾に'.geom'や'.val'をつけることにより、geomvalの結果集合のジオメトリや値の部分にアクセスすることができます。たとえば(ST_Intersection(rast, geom)).geom等とします。 </p><p>他の形式は、ラスタを引数に取り、ラスタを返します。ST_MapAlgebraExprの二つのラスタを取る形式を使って、インタセクトしている部分を取得します。 </p><p>結果ラスタの範囲は、二つのラスタの範囲についてインタセクトしている部分です。結果ラスタは、<code class="varname">returnband</code>引数として渡されたものにあわせられた'BAND1','BAND2','BOTH'バンドを含みます。どのバンドでもNODATA値の領域は、結果ラスタの全てのバンドのNODATA値領域に現れます。言い換えると、あらゆるNODATA値ピクセルとインタセクトしているピクセルは、結果ラスタではNODATA値ピクセルになります。 </p><p>インタセクトしなかった領域にNODATA値を入れるために、ST_Intersectionからの結果ラスタは、NODATA値を持たなければなりません。結果ラスタのどのバンドにも、一つか二つのNODATA値を持つ<code class="varname">nodataval[]</code>配列を与えることでNODATA値を定義したり置き換えたりできます。この配列は、引数で与えた'BAND1','BAND2','BOTH'バンドに依存します。 配列の一つ目の値は、一つ目のバンドのNODATA値を入れ替えるものです。二つ目の値は二つ目のバンドのNODATA値を入れ替えるものです。入力バンドの一つがNODATA値を持っておらず、かつ配列を渡さなかった場合には、ST_MinPossibleValue関数を使ってNODATA値が選ばれます。NODATA値の配列を受け付ける形式の全てが、単一値を受け付けます。単一値は結果ラスタのそれぞれのバンドに適用されます。 </p><p>全ての形式で、バンド番号を指定していない場合には、1番と仮定します。ラスタとジオメトリを引数にとり、ラスタを得たい場合には、<a class="xref" href="#RT_ST_Clip" title="ST_Clip">ST_Clip</a>を参照して下さい。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>NODATA値に遭遇した時の、結果範囲や返された物に関して、より多くの制御を行いたい場合には、<a class="xref" href="#RT_ST_MapAlgebraExpr2" title="ST_MapAlgebraExpr">ST_MapAlgebraExpr</a>の二つのラスタを取る形式を使います。 </p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ラスタバンドとジオメトリとがインタセクトする部分を計算するには、<a class="xref" href="#RT_ST_Clip" title="ST_Clip">ST_Clip</a>を使います。ST_Clipは複数のバンドで動作し、ラスタ化されたジオメトリに従ったバンドを返すことはしません。 </p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_IntersectionはST_Intersectsと併用して、ラスタカラムとジオメトリカラムのインデクスを使うべきです。 </p></td></tr></table></div><p>Enhanced: 2.0.0 - ラスタ空間のインタセクションが導入されました。2.0.0より前の版では、ベクタ空間でのインタセクションの計算のみに対応していました。 </p></div><div class="refsection"><a name="idp93488072"></a><h2>例: ジオメトリとラスタ -- ジオメトリと値を得る</h2><pre class="programlisting">SELECT
        foo.rid,
        foo.gid,
        ST_AsText((foo.geomval).geom) As geomwkt,
        (foo.geomval).val
FROM (
        SELECT
                A.rid,
                g.gid,
                ST_Intersection(A.rast, g.geom) As geomval
        FROM dummy_rast AS A
        CROSS JOIN (
                VALUES
                        (1, ST_Point(3427928, 5793243.85) ),
                        (2, ST_GeomFromText('LINESTRING(3427927.85 5793243.75,3427927.8 5793243.75,3427927.8 5793243.8)')),
                        (3, ST_GeomFromText('LINESTRING(1 2, 3 4)'))
        ) As g(gid,geom)
        WHERE A.rid = 2
) As foo;

 rid | gid |      geomwkt                                                                                                | val
-----+-----+---------------------------------------------------------------------------------------------
   2 |   1 | POINT(3427928 5793243.85)                                                                        | 249
   2 |   1 | POINT(3427928 5793243.85)                                                                        | 253
   2 |   2 | POINT(3427927.85 5793243.75)                                                                | 254
   2 |   2 | POINT(3427927.8 5793243.8)                                                                        | 251
   2 |   2 | POINT(3427927.8 5793243.8)                                                                        | 253
   2 |   2 | LINESTRING(3427927.8 5793243.75,3427927.8 5793243.8)        | 252
   2 |   2 | MULTILINESTRING((3427927.8 5793243.8,3427927.8 5793243.75),...) | 250
   2 |   3 | GEOMETRYCOLLECTION EMPTY
                                        </pre></div><div class="refsection"><a name="idp93489352"></a><h2>関連情報</h2><p><a class="xref" href="#geomval" title="geomval">geomval</a>, <a class="xref" href="#RT_ST_Intersects" title="ST_Intersects">ST_Intersects</a>, <a class="xref" href="#RT_ST_MapAlgebraExpr2" title="ST_MapAlgebraExpr">ST_MapAlgebraExpr</a>, <a class="xref" href="#RT_ST_Clip" title="ST_Clip">ST_Clip</a>, <a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_MapAlgebra"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MapAlgebra (コールバック関数版) — コールバック関数版 - 一つ以上の入力ラスタ、バンドインデクスと一つのユーザ定義コールバック関数から、一つのバンドからなるラスタを返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebra</b>(</code>rastbandarg[]  <var class="pdparam">rastbandargset</var>, regprocedure  <var class="pdparam">callbackfunc</var>, text  <var class="pdparam">pixeltype=NULL</var>, text  <var class="pdparam">extenttype=INTERSECTION</var>, raster  <var class="pdparam">customextent=NULL</var>, integer  <var class="pdparam">distancex=0</var>, integer  <var class="pdparam">distancey=0</var>, text[]  <var class="pdparam">VARIADIC userargs=NULL</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebra</b>(</code>raster  <var class="pdparam">rast</var>, integer[]  <var class="pdparam">nband</var>, regprocedure  <var class="pdparam">callbackfunc</var>, text  <var class="pdparam">pixeltype=NULL</var>, text  <var class="pdparam">extenttype=FIRST</var>, raster  <var class="pdparam">customextent=NULL</var>, integer  <var class="pdparam">distancex=0</var>, integer  <var class="pdparam">distancey=0</var>, text[]  <var class="pdparam">VARIADIC userargs=NULL</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebra</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, regprocedure  <var class="pdparam">callbackfunc</var>, text  <var class="pdparam">pixeltype=NULL</var>, text  <var class="pdparam">extenttype=FIRST</var>, raster  <var class="pdparam">customextent=NULL</var>, integer  <var class="pdparam">distancex=0</var>, integer  <var class="pdparam">distancey=0</var>, text[]  <var class="pdparam">VARIADIC userargs=NULL</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebra</b>(</code>raster  <var class="pdparam">rast1</var>, integer  <var class="pdparam">nband1</var>, raster  <var class="pdparam">rast2</var>, integer  <var class="pdparam">nband2</var>, regprocedure  <var class="pdparam">callbackfunc</var>, text  <var class="pdparam">pixeltype=NULL</var>, text  <var class="pdparam">extenttype=INTERSECTION</var>, raster  <var class="pdparam">customextent=NULL</var>, integer  <var class="pdparam">distancex=0</var>, integer  <var class="pdparam">distancey=0</var>, text[]  <var class="pdparam">VARIADIC userargs=NULL</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebra</b>(</code>nband <var class="pdparam">integer</var>, regprocedure  <var class="pdparam">callbackfunc</var>, float8[]  <var class="pdparam">mask</var>, boolean  <var class="pdparam">weighted</var>, text  <var class="pdparam">pixeltype=NULL</var>, text  <var class="pdparam">extenttype=INTERSECTION</var>, raster  <var class="pdparam">customextent=NULL</var>, text[]  <var class="pdparam">VARIADIC userargs=NULL</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp93558216"></a><h2>説明</h2><p>一つ以上の入力ラスタ、バンドインデクスと一つのユーザ定義コールバック関数から、一つのバンドからなるラスタを返します。 </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">rast,rast1,rast2, rastbandargset</span></dt><dd><p>地図代数処理が行われるラスタです。</p><p><code class="varname">rastbandargset</code>によって、多数のラスタと多数のバンドにおいて地図代数処理が使用できます。一つ目の形式の例を見て下さい。 </p></dd><dt><span class="term">nband, nband1, nband2</span></dt><dd><p>処理を行うラスタのバンド番号です。nbandはバンドを示す整数スカラまたは整数配列です。2ラスタ/2バンドの場合では、nband1はrast1のバンド、nband2はrast2のバンドです。 </p></dd><dt><span class="term">callbackfunc</span></dt><dd><p><code class="varname">callbackfunc</code>引数は、SQLまたはPL/pgSQL関数の名前とシグニチャでなければならず、regprocedureにキャストしなければなりません。PL/pgSQL関数の例は次の通りです。</p><pre class="programlisting">
CREATE OR REPLACE FUNCTION sample_callbackfunc(value double precision[][][], position integer[][], VARIADIC userargs text[])
        RETURNS double precision
        AS $$
        BEGIN
                RETURN 0;
        END;
        $$ LANGUAGE 'plpgsql' IMMUTABLE;
                                                                        </pre><p> <code class="varname">callbackfunc</code>は、三つの引数を持たなければなりません。すなわち、3次元倍精度浮動小数点数配列、2次元整数配列、VARIADICの1次元文字列配列です。一つ目の引数<code class="varname">value</code>は、全ての入力ラスタからの値 (倍精度浮動小数点数)の配列です。3次元 (1始まり)は、ラスタ番号、行、列です。二つ目の引数<code class="varname">position</code>は、出力ラスタと入力ラスタからのピクセル位置の集合です。一つ目の次元の添え字 (0はじまりです)はラスタ番号です。一つ目の次元の添え字が0の場合に指される位置は、出力ラスタのピクセル位置です。二つ目の次元はXとYからなる二つの要素を持ちます。三つ目の引数<code class="varname">userargs</code>はユーザ定義関数特有の引数としてそのまま渡されます。 </p><p><span class="type">regprocedure</span>引数をSQL関数に渡すには、完全な関数シグネチャが求められます。<span class="type">regprocedure</span>へのキャストが必要です。上のPL/pgSQL関数を引数として渡すには、引数のSQLは次のようにします。</p><pre class="programlisting">
'sample_callbackfunc(double precision[], integer[], text[])'::regprocedure
                                                                        </pre><p> 引数は関数名と引数の型を含み、関数名と引数を引用符で括り、かつ<span class="type">regprocedure</span>にキャストする点に注意が必要です。 </p></dd><dt><span class="term">mask</span></dt><dd><p>N次元の数値配列 (行列)で、地図代数コールバック関数に渡すセルを決めるためのフィルタに使われます。0は近隣セル値をNODATAとして扱うべきであることを示し、1はデータとして扱うべきであることをそれぞれ意味します。weightがTRUEに指定されいる場合には、この配列の値は、近隣セルのピクセル値に対して掛け算を行うための数になります。 </p></dd><dt><span class="term">weighted</span></dt><dd><p>マスク値に重みづけを施す (元の値に対して乗算を行う)か、施さない (マスク処理だけを行う)かを示す真偽値です。 </p></dd><dt><span class="term">pixeltype</span></dt><dd><p><code class="varname">pixeltype</code>を渡した場合には、新しいラスタの一つのバンドが、そのピクセルタイプになります。pixeltypeにNULLを渡したり指定しなかった場合には、新しいラスタのピクセルタイプは、一つ目のラスタ (extenttypeがINTERSECTION, UNION, FIRST, CUSTOMの場合)か、適切なラスタ (extenttypeがSECOND, LASTの場合)の指定したバンドと同じピクセルタイプになります。疑問を感じたら常に<code class="varname">pixeltype</code>を渡します。 </p><p>出力ラスタのピクセルタイプは、必ず<a class="xref" href="#RT_ST_BandPixelType" title="ST_BandPixelType">ST_BandPixelType</a>に挙げられたものの一つになるか、省略されるか、NULLに設定されます。 </p></dd><dt><span class="term">extenttype</span></dt><dd><p>INTERSECTION (デフォルト), UNION, FIRST (一つのラスタを取る形式でのデフォルト), SECOND, LAST, CUSTOMのいずれかになります。 </p></dd><dt><span class="term">customextent</span></dt><dd><p><code class="varname">extentype</code>がCUSTOMである場合には、ラスタは<code class="varname">customextent</code>で提供されます。一つ目の形式の例4をご覧下さい。 </p></dd><dt><span class="term">distancex</span></dt><dd><p>参照セルからのピクセル単位の距離です。結果として得られる行列の幅は<code class="code">2*distancex + 1</code>となります。指定しない場合には、参照セルだけが対象となります (0の距離の近隣ピクセル)。 </p></dd><dt><span class="term">distancey</span></dt><dd><p>参照セルからのピクセル単位の距離です。結果として得られる行列の高さは<code class="code">2*distancey + 1</code>となります。指定しない場合には、参照セルが対象となります (0の距離の近隣ピクセル)。 </p></dd><dt><span class="term">userargs</span></dt><dd><p><code class="varname">callbackfunc</code>の三つ目の引数は<span class="type">variadic text</span>配列です。全ての文字列引数は指定された<code class="varname">callbackfunc</code>にそのまま渡され、<code class="varname">userargs</code>引数に含まれます。 </p></dd></dl></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>VARIADICキーワードに関する詳細情報については、PostgreSQL文書と<a class="ulink" href="http://www.postgresql.org/docs/current/static/xfunc-sql.html" target="_top">Query Language (SQL) Functions</a> (訳注: 日本語版は「<a class="ulink" href="http://www.postgresql.jp/document/current/html/xfunc-sql.html" target="_top">問い合わせ言語 （SQL）関数</a>」です)の"SQL Functions with Variable Numbers of Arguments" (訳注: 日本語版は「可変長引数を取るSQL関数」)節を参照して下さい。 </p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">callbackfunc</code>への<span class="type">text[]</span>引数は、あらゆる引数を処理のためにユーザ関数に渡すかどうかの選択にかかわらず求められます。 </p></td></tr></table></div><p>一つ目の形式では、多数のラスタやバンドで地図代数演算が使えるようになるための<code class="varname">rastbandarg</code>配列を受け付けます。一つ目の形式の例をご覧下さい。 </p><p>二つ目と三つ目の形式では、一つのラスタにおける一つ以上のバンドについて演算を行います。二つ目の形式と三つ目の形式の例をご覧下さい。 </p><p>四つ目の形式では、二つのラスタにおいて、それぞれ一つずつのバンドについて演算を行います。四つ目の形式の例をご覧下さい。 </p><p>Availability: 2.2.0: マスクが追加されました。</p><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp93591496"></a><h2>例: 一つ目の形式</h2><p>一つのラスタ、一つのバンド</p><pre class="programlisting">WITH foo AS (
        SELECT 1 AS rid, ST_AddBand(ST_MakeEmptyRaster(2, 2, 0, 0, 1, -1, 0, 0, 0), 1, '16BUI', 1, 0) AS rast
)
SELECT
        ST_MapAlgebra(
                ARRAY[ROW(rast, 1)]::rastbandarg[],
                'sample_callbackfunc(double precision[], int[], text[])'::regprocedure
        ) AS rast
FROM foo
                                        </pre><p>一つのラスタ、複数のバンド</p><pre class="programlisting">WITH foo AS (
        SELECT 1 AS rid, ST_AddBand(ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(2, 2, 0, 0, 1, -1, 0, 0, 0), 1, '16BUI', 1, 0), 2, '8BUI', 10, 0), 3, '32BUI', 100, 0) AS rast
)
SELECT
        ST_MapAlgebra(
                ARRAY[ROW(rast, 3), ROW(rast, 1), ROW(rast, 3), ROW(rast, 2)]::rastbandarg[],
                'sample_callbackfunc(double precision[], int[], text[])'::regprocedure
        ) AS rast
FROM foo
                                        </pre><p>複数のラスタ、複数のバンド</p><pre class="programlisting">WITH foo AS (
        SELECT 1 AS rid, ST_AddBand(ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(2, 2, 0, 0, 1, -1, 0, 0, 0), 1, '16BUI', 1, 0), 2, '8BUI', 10, 0), 3, '32BUI', 100, 0) AS rast UNION ALL
        SELECT 2 AS rid, ST_AddBand(ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(2, 2, 0, 1, 1, -1, 0, 0, 0), 1, '16BUI', 2, 0), 2, '8BUI', 20, 0), 3, '32BUI', 300, 0) AS rast
)
SELECT
        ST_MapAlgebra(
                ARRAY[ROW(t1.rast, 3), ROW(t2.rast, 1), ROW(t2.rast, 3), ROW(t1.rast, 2)]::rastbandarg[],
                'sample_callbackfunc(double precision[], int[], text[])'::regprocedure
        ) AS rast
FROM foo t1
CROSS JOIN foo t2
WHERE t1.rid = 1
        AND t2.rid = 2
                                        </pre><p>近隣ピクセルを併用したカバレッジのタイルの完全な例です。クエリはPostgreSQL 9.1以上でのみ動作します。</p><pre class="programlisting">WITH foo AS (
        SELECT 0 AS rid, ST_AddBand(ST_MakeEmptyRaster(2, 2, 0, 0, 1, -1, 0, 0, 0), 1, '16BUI', 1, 0) AS rast UNION ALL
        SELECT 1, ST_AddBand(ST_MakeEmptyRaster(2, 2, 2, 0, 1, -1, 0, 0, 0), 1, '16BUI', 2, 0) AS rast UNION ALL
        SELECT 2, ST_AddBand(ST_MakeEmptyRaster(2, 2, 4, 0, 1, -1, 0, 0, 0), 1, '16BUI', 3, 0) AS rast UNION ALL

        SELECT 3, ST_AddBand(ST_MakeEmptyRaster(2, 2, 0, -2, 1, -1, 0, 0, 0), 1, '16BUI', 10, 0) AS rast UNION ALL
        SELECT 4, ST_AddBand(ST_MakeEmptyRaster(2, 2, 2, -2, 1, -1, 0, 0, 0), 1, '16BUI', 20, 0) AS rast UNION ALL
        SELECT 5, ST_AddBand(ST_MakeEmptyRaster(2, 2, 4, -2, 1, -1, 0, 0, 0), 1, '16BUI', 30, 0) AS rast UNION ALL

        SELECT 6, ST_AddBand(ST_MakeEmptyRaster(2, 2, 0, -4, 1, -1, 0, 0, 0), 1, '16BUI', 100, 0) AS rast UNION ALL
        SELECT 7, ST_AddBand(ST_MakeEmptyRaster(2, 2, 2, -4, 1, -1, 0, 0, 0), 1, '16BUI', 200, 0) AS rast UNION ALL
        SELECT 8, ST_AddBand(ST_MakeEmptyRaster(2, 2, 4, -4, 1, -1, 0, 0, 0), 1, '16BUI', 300, 0) AS rast
)
SELECT
        t1.rid,
        ST_MapAlgebra(
                ARRAY[ROW(ST_Union(t2.rast), 1)]::rastbandarg[],
                'sample_callbackfunc(double precision[], int[], text[])'::regprocedure,
                '32BUI',
                'CUSTOM', t1.rast,
                1, 1
        ) AS rast
FROM foo t1
CROSS JOIN foo t2
WHERE t1.rid = 4
        AND t2.rid BETWEEN 0 AND 8
        AND ST_Intersects(t1.rast, t2.rast)
GROUP BY t1.rid, t1.rast
                                        </pre><p>前の例である近隣ピクセルを併用したカバレッジのタイルに似ていますがPostgreSQL 9.0で動作します。</p><pre class="programlisting">WITH src AS (
        SELECT 0 AS rid, ST_AddBand(ST_MakeEmptyRaster(2, 2, 0, 0, 1, -1, 0, 0, 0), 1, '16BUI', 1, 0) AS rast UNION ALL
        SELECT 1, ST_AddBand(ST_MakeEmptyRaster(2, 2, 2, 0, 1, -1, 0, 0, 0), 1, '16BUI', 2, 0) AS rast UNION ALL
        SELECT 2, ST_AddBand(ST_MakeEmptyRaster(2, 2, 4, 0, 1, -1, 0, 0, 0), 1, '16BUI', 3, 0) AS rast UNION ALL

        SELECT 3, ST_AddBand(ST_MakeEmptyRaster(2, 2, 0, -2, 1, -1, 0, 0, 0), 1, '16BUI', 10, 0) AS rast UNION ALL
        SELECT 4, ST_AddBand(ST_MakeEmptyRaster(2, 2, 2, -2, 1, -1, 0, 0, 0), 1, '16BUI', 20, 0) AS rast UNION ALL
        SELECT 5, ST_AddBand(ST_MakeEmptyRaster(2, 2, 4, -2, 1, -1, 0, 0, 0), 1, '16BUI', 30, 0) AS rast UNION ALL

        SELECT 6, ST_AddBand(ST_MakeEmptyRaster(2, 2, 0, -4, 1, -1, 0, 0, 0), 1, '16BUI', 100, 0) AS rast UNION ALL
        SELECT 7, ST_AddBand(ST_MakeEmptyRaster(2, 2, 2, -4, 1, -1, 0, 0, 0), 1, '16BUI', 200, 0) AS rast UNION ALL
        SELECT 8, ST_AddBand(ST_MakeEmptyRaster(2, 2, 4, -4, 1, -1, 0, 0, 0), 1, '16BUI', 300, 0) AS rast
)
WITH foo AS (
        SELECT
                t1.rid,
                ST_Union(t2.rast) AS rast
        FROM src t1
        JOIN src t2
                ON ST_Intersects(t1.rast, t2.rast)
                AND t2.rid BETWEEN 0 AND 8
        WHERE t1.rid = 4
        GROUP BY t1.rid
), bar AS (
        SELECT
                t1.rid,
                ST_MapAlgebra(
                        ARRAY[ROW(t2.rast, 1)]::rastbandarg[],
                        'raster_nmapalgebra_test(double precision[], int[], text[])'::regprocedure,
                        '32BUI',
                        'CUSTOM', t1.rast,
                        1, 1
                ) AS rast
        FROM src t1
        JOIN foo t2
                ON t1.rid = t2.rid
)
SELECT
        rid,
        (ST_Metadata(rast)),
        (ST_BandMetadata(rast, 1)),
        ST_Value(rast, 1, 1, 1)
FROM bar;
                                        </pre></div><div class="refsection"><a name="idp93596744"></a><h2>例: 二つ目の形式と三つ目の形式</h2><p>一つのラスタ、複数のバンド</p><pre class="programlisting">WITH foo AS (
        SELECT 1 AS rid, ST_AddBand(ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(2, 2, 0, 0, 1, -1, 0, 0, 0), 1, '16BUI', 1, 0), 2, '8BUI', 10, 0), 3, '32BUI', 100, 0) AS rast
)
SELECT
        ST_MapAlgebra(
                rast, ARRAY[3, 1, 3, 2]::integer[],
                'sample_callbackfunc(double precision[], int[], text[])'::regprocedure
        ) AS rast
FROM foo
                                        </pre><p>一つのラスタ、一つのバンド</p><pre class="programlisting">WITH foo AS (
        SELECT 1 AS rid, ST_AddBand(ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(2, 2, 0, 0, 1, -1, 0, 0, 0), 1, '16BUI', 1, 0), 2, '8BUI', 10, 0), 3, '32BUI', 100, 0) AS rast
)
SELECT
        ST_MapAlgebra(
                rast, 2,
                'sample_callbackfunc(double precision[], int[], text[])'::regprocedure
        ) AS rast
FROM foo
                                        </pre></div><div class="refsection"><a name="idp93599304"></a><h2>例: 四つ目の形式</h2><p>二つのラスタ、二つのバンド</p><pre class="programlisting">WITH foo AS (
        SELECT 1 AS rid, ST_AddBand(ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(2, 2, 0, 0, 1, -1, 0, 0, 0), 1, '16BUI', 1, 0), 2, '8BUI', 10, 0), 3, '32BUI', 100, 0) AS rast UNION ALL
        SELECT 2 AS rid, ST_AddBand(ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(2, 2, 0, 1, 1, -1, 0, 0, 0), 1, '16BUI', 2, 0), 2, '8BUI', 20, 0), 3, '32BUI', 300, 0) AS rast
)
SELECT
        ST_MapAlgebra(
                t1.rast, 2,
                t2.rast, 1,
                'sample_callbackfunc(double precision[], int[], text[])'::regprocedure
        ) AS rast
FROM foo t1
CROSS JOIN foo t2
WHERE t1.rid = 1
        AND t2.rid = 2
                                        </pre></div><div class="refsection"><a name="idp93609160"></a><h2>例: マスクの使用</h2><pre class="programlisting">WITH foo AS (SELECT
   ST_SetBandNoDataValue(
ST_SetValue(ST_SetValue(ST_AsRaster(
                ST_Buffer(
                        ST_GeomFromText('LINESTRING(50 50,100 90,100 50)'), 5,'join=bevel'),
                        200,200,ARRAY['8BUI'], ARRAY[100], ARRAY[0]), ST_Buffer('POINT(70 70)'::geometry,10,'quad_segs=1') ,50),
  'LINESTRING(20 20, 100 100, 150 98)'::geometry,1),0)  AS rast )
SELECT 'original' AS title, rast
FROM foo
UNION ALL
SELECT 'no mask mean value' AS title, ST_MapAlgebra(rast,1,'ST_mean4ma(double precision[], int[], text[])'::regprocedure) AS rast
FROM foo
UNION ALL
SELECT 'mask only consider neighbors, exclude center' AS title, ST_MapAlgebra(rast,1,'ST_mean4ma(double precision[], int[], text[])'::regprocedure,
    '{{1,1,1}, {1,0,1}, {1,1,1}}'::double precision[], false) As rast
FROM foo

UNION ALL
SELECT 'mask weighted only consider neighbors, exclude center multi otehr pixel values by 2' AS title, ST_MapAlgebra(rast,1,'ST_mean4ma(double precision[], int[], text[])'::regprocedure,
    '{{2,2,2}, {2,0,2}, {2,2,2}}'::double precision[], true) As rast
FROM foo;
                                        </pre><div class="informaltable"><table class="informaltable" border="1"><colgroup><col><col></colgroup><tbody><tr><td>
										<p>
											</p><div class="informalfigure"><div class="mediaobject"><img src="images/st_mapalgebramask01.png"><div class="caption"><p>original</p></div></div></div><p>
										</p>
									</td><td>
										<p>
											</p><div class="informalfigure"><div class="mediaobject"><img src="images/st_mapalgebramask02.png"><div class="caption"><p>no mask mean value (マスクなし平均値) (マスク配列に全て1があるのと同じ)</p></div></div></div><p>
										</p>
									</td></tr><tr><td>
										<p>
											</p><div class="informalfigure"><div class="mediaobject"><img src="images/st_mapalgebramask03.png"><div class="caption"><p>mask only consider neighbors, exclude center (近隣セルのみ注目し、中心セルを除くマスク)</p></div></div></div><p>
										</p>
									</td><td>
										<p>
											</p><div class="informalfigure"><div class="mediaobject"><img src="images/st_mapalgebramask04.png"><div class="caption"><p>mask weighted only consider neighbors, exclude center multi other pixel values by 2 (近隣のみ考慮に入れて中心を除き、2を掛けるウェイトマスク)</p></div></div></div><p>
										</p>
									</td></tr></tbody></table></div></div><div class="refsection"><a name="idp93625288"></a><h2>関連情報</h2><p><a class="xref" href="#rastbandarg" title="rastbandarg">rastbandarg</a>, <a class="xref" href="#RT_ST_Union" title="ST_Union">ST_Union</a>, <a class="xref" href="#RT_ST_MapAlgebra_expr" title="ST_MapAlgebra (数式版)">ST_MapAlgebra (数式版)</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_MapAlgebra_expr"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MapAlgebra (数式版) — 数式版 - 一つか二つの入力ラスタ、バンド番号、一つ以上のユーザ定義SQL式から一つのバンドを持つラスタを返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebra</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, text  <var class="pdparam">pixeltype</var>, text  <var class="pdparam">expression</var>, double precision  <var class="pdparam">nodataval=NULL</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebra</b>(</code>raster  <var class="pdparam">rast</var>, text  <var class="pdparam">pixeltype</var>, text  <var class="pdparam">expression</var>, double precision  <var class="pdparam">nodataval=NULL</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebra</b>(</code>raster  <var class="pdparam">rast1</var>, integer  <var class="pdparam">nband1</var>, raster  <var class="pdparam">rast2</var>, integer  <var class="pdparam">nband2</var>, text  <var class="pdparam">expression</var>, text  <var class="pdparam">pixeltype=NULL</var>, text  <var class="pdparam">extenttype=INTERSECTION</var>, text  <var class="pdparam">nodata1expr=NULL</var>, text  <var class="pdparam">nodata2expr=NULL</var>, double precision  <var class="pdparam">nodatanodataval=NULL</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebra</b>(</code>raster  <var class="pdparam">rast1</var>, raster  <var class="pdparam">rast2</var>, text  <var class="pdparam">expression</var>, text  <var class="pdparam">pixeltype=NULL</var>, text  <var class="pdparam">extenttype=INTERSECTION</var>, text  <var class="pdparam">nodata1expr=NULL</var>, text  <var class="pdparam">nodata2expr=NULL</var>, double precision  <var class="pdparam">nodatanodataval=NULL</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp93688136"></a><h2>説明</h2><p>数式版 - 一つか二つの入力ラスタ、バンド番号、一つ以上のユーザ定義SQL式から一つのバンドを持つラスタを返します。 </p><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp93689672"></a><h2>説明: 一つ目の形式と二つ目の形式 (一つのラスタ)</h2><p><code class="varname">expression</code>で定義された妥当なPostgreSQL代数演算を入力ラスタ (<code class="varname">rast</code>)に適用して、一つのバンドを持つラスタを生成します。<code class="varname">nband</code>が指定されない場合には、1番バンドと仮定します。新しいラスタは、元のラスタと同じ地理参照、幅、高さになりますが、バンドは一つだけとなります。 </p><p><code class="varname">pixeltype</code>が渡された場合には、新しいラスタのバンドは、そのピクセルタイプになります。pixeltypeにNULLが渡された場合には、新しいラスタは入力<code class="varname">rast</code>のバンドのピクセルタイプと同じになります。 </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="varname">expression</code>のキーワードは次の通りです。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><code class="varname">[rast]</code> - 演算対象ピクセルの値</p></li><li class="listitem"><p><code class="varname">[rast.val]</code> - 演算対象ピクセルの値</p></li><li class="listitem"><p><code class="varname">[rast.x]</code> - 演算対象ピクセルの列 (1始まり)</p></li><li class="listitem"><p><code class="varname">[rast.y]</code> - 演算対象ピクセルの行 (1始まり)</p></li></ol></div></li></ul></div></div><div class="refsection"><a name="idp93698888"></a><h2>説明: 三つ目と四つ目の形式 (二つのラスタ)</h2><p><code class="varname">expression</code>で定義された妥当な二つのバンドへのPostgreSQL代数演算を入力ラスタ (rast1, rast2)に適用して、一つのバンドを持つラスタを生成します。nband1, nband2が指定されない場合には、1番バンドと仮定します。新しいラスタは、一つ目のラスタと同じアラインメント (スケール、スキュー、ピクセル隅)を持ちます。新しいラスタは、<code class="varname">extenttype</code>引数で定義される範囲になります。 </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">expression</span></dt><dd><p>二つのラスタとPostgreSQL定義済み関数/演算子を含むPostgreSQL代数式です。関数と演算子は、二つのピクセルがインタセクトするピクセルの値を定めます。たとえば(([rast1] + [rast2])/2.0)::integerといったふうになります。 </p></dd><dt><span class="term">pixeltype</span></dt><dd><p>出力ラスタのピクセルタイプです。必ず<a class="xref" href="#RT_ST_BandPixelType" title="ST_BandPixelType">ST_BandPixelType</a>に挙げられたものの一つになるか、省略されるか、NULLに設定されます。引数として渡されないかNULLが渡された場合には、一つ目のラスタのピクセルタイプになります。 </p></dd><dt><span class="term">extenttype</span></dt><dd><p>新しいラスタの範囲を制御します。 </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><code class="varname">INTERSECTION</code> - 新しいラスタの範囲は二つのラスタのインタセクトした領域です。これがデフォルトです。 </p></li><li class="listitem"><p><code class="varname">UNION</code> - 新しいラスタの範囲は二つのラスタの結合です。 </p></li><li class="listitem"><p><code class="varname">FIRST</code> - 新しいラスタの範囲は一つ目のラスタと同じです。 </p></li><li class="listitem"><p><code class="varname">SECOND</code> - 新しいラスタの範囲は二つ目のラスタと同じです。 </p></li></ol></div></dd><dt><span class="term">nodata1expr</span></dt><dd><p><code class="varname">rast1</code>がNODATA値で、特にrast2ピクセルに値がある時に、<code class="varname">rast2</code>だけを返すか返すべき値を定義する定数を含む代数式です。 </p></dd><dt><span class="term">nodata2expr</span></dt><dd><p><code class="varname">rast2</code>がNODATA値で、特にrast2ピクセルに値がある時に、<code class="varname">rast1</code>だけを返すか返すべき値を定義する定数を含む代数式です。 </p></dd><dt><span class="term">nodatanodataval</span></dt><dd><p>rast1とrast2のピクセルの両方がNOADTA値になる場合に返すべき定数です。 </p></dd></dl></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>有効な<code class="varname">expression</code>, <code class="varname">nodata1expr</code>, <code class="varname">nodata2expr</code>のキーワードは次の通りです。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><code class="varname">[rast1]</code> - <code class="varname">rast1</code>の演算対象ピクセルの値</p></li><li class="listitem"><p><code class="varname">[rast1.val]</code> - <code class="varname">rast1</code>の演算対象ピクセルの値</p></li><li class="listitem"><p><code class="varname">[rast1.x]</code> - <code class="varname">rast1</code>の演算対象ピクセルの列 (1始まり)</p></li><li class="listitem"><p><code class="varname">[rast1.y]</code> - <code class="varname">rast1</code>の演算対象ピクセルの行 (1始まり)</p></li><li class="listitem"><p><code class="varname">[rast2]</code> - <code class="varname">rast2</code>の演算対象ピクセルの値</p></li><li class="listitem"><p><code class="varname">[rast2.val]</code> - <code class="varname">rast2</code>の演算対象ピクセルの値</p></li><li class="listitem"><p><code class="varname">[rast2.x]</code> - <code class="varname">rast2</code>の演算対象ピクセルの列 (1始まり)</p></li><li class="listitem"><p><code class="varname">[rast2.y]</code> - <code class="varname">rast2</code>の演算対象ピクセルの行 (1始まり)</p></li></ol></div></li></ul></div></div><div class="refsection"><a name="idp93730760"></a><h2>例: 一つ目の形式と二つ目の形式</h2><pre class="programlisting">WITH foo AS (
        SELECT ST_AddBand(ST_MakeEmptyRaster(10, 10, 0, 0, 1, 1, 0, 0, 0), '32BF'::text, 1, -1) AS rast
)
SELECT
        ST_MapAlgebra(rast, 1, NULL, 'ceil([rast]*[rast.x]/[rast.y]+[rast.val])')
FROM foo;
                                        </pre></div><div class="refsection"><a name="idp93744328"></a><h2>例: 三つ目の形式と四つ目の形式</h2><pre class="programlisting">WITH foo AS (
        SELECT 1 AS rid, ST_AddBand(ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(2, 2, 0, 0, 1, -1, 0, 0, 0), 1, '16BUI', 1, 0), 2, '8BUI', 10, 0), 3, '32BUI'::text, 100, 0) AS rast UNION ALL
        SELECT 2 AS rid, ST_AddBand(ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(2, 2, 0, 1, 1, -1, 0, 0, 0), 1, '16BUI', 2, 0), 2, '8BUI', 20, 0), 3, '32BUI'::text, 300, 0) AS rast
)
SELECT
        ST_MapAlgebra(
                t1.rast, 2,
                t2.rast, 1,
                '([rast2] + [rast1.val]) / 2'
        ) AS rast
FROM foo t1
CROSS JOIN foo t2
WHERE t1.rid = 1
        AND t2.rid = 2;
                                        </pre></div><div class="refsection"><a name="idp93745608"></a><h2>関連情報</h2><p><a class="xref" href="#rastbandarg" title="rastbandarg">rastbandarg</a>, <a class="xref" href="#RT_ST_Union" title="ST_Union">ST_Union</a>, <a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_MapAlgebraExpr"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MapAlgebraExpr — 1バンド版: 入力バンドに対する妥当なPostgreSQL代数演算で形成された、指定したピクセルタイプとなる1バンドラスタを生成します。バンドを指定しない場合には、1番を仮定します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebraExpr</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">band</var>, text  <var class="pdparam">pixeltype</var>, text  <var class="pdparam">expression</var>, double precision  <var class="pdparam">nodataval=NULL</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebraExpr</b>(</code>raster  <var class="pdparam">rast</var>, text  <var class="pdparam">pixeltype</var>, text  <var class="pdparam">expression</var>, double precision  <var class="pdparam">nodataval=NULL</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp93761864"></a><h2>説明</h2><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><a class="xref" href="#RT_ST_MapAlgebraExpr" title="ST_MapAlgebraExpr">ST_MapAlgebraExpr</a> は2.1.0で非推奨になりました。代わりに<a class="xref" href="#RT_ST_MapAlgebra_expr" title="ST_MapAlgebra (数式版)">ST_MapAlgebra (数式版)</a> を使います。 </p></td></tr></table></div><p>入力ラスタ (<code class="varname">rast</code>)に対して<code class="varname">expression</code>で定義される妥当なPostgreSQL代数演算で形成されるラスタを返します。生成されるラスタは指定したピクセルタイプとなる1バンドラスタです。<code class="varname">band</code>を指定しない場合には、1番と仮定します。新しいラスタは、元のラスタと同じ地理参照、幅、高さを持ちますが、一つのバンドしか持ちません。 </p><p><code class="varname">pixeltype</code>が渡された場合には、新しいラスタのバンドは、そのピクセルタイプになります。pixeltypeにNULLが渡された場合には、新しいラスタは入力<code class="varname">rast</code>のバンドのピクセルタイプと同じになります。 </p><p>数式の中では、<code class="varname">[rast]</code>で元のバンドのピクセル値を、<code class="varname">[rast.x]</code>で1始まりの列番号、<code class="varname">[rast.y]</code>で1始まりの行番号を、それぞれ参照することができます。 </p><p>Availability: 2.0.0 </p></div><div class="refsection"><a name="idp93768520"></a><h2>例</h2><p>元のラスタから1バンドラスタを生成します。元のラスタバンドの値について2で割った余りが入ります。</p><pre class="programlisting">ALTER TABLE dummy_rast ADD COLUMN map_rast raster;
UPDATE dummy_rast SET map_rast = ST_MapAlgebraExpr(rast,NULL,'mod([rast]::numeric,2)') WHERE rid = 2;

SELECT
        ST_Value(rast,1,i,j) As origval,
        ST_Value(map_rast, 1, i, j) As mapval
FROM dummy_rast
CROSS JOIN generate_series(1, 3) AS i
CROSS JOIN generate_series(1,3) AS j
WHERE rid = 2;

 origval | mapval
---------+--------
     253 |      1
     254 |      0
     253 |      1
     253 |      1
     254 |      0
     254 |      0
     250 |      0
     254 |      0
     254 |      0
                                        </pre><p>ピクセルタイプが2BUIの1バンドラスタを生成します。元のラスタに対して再分類を行った値が入り、NODATA値を0に設定します。</p><pre class="programlisting">ALTER TABLE dummy_rast ADD COLUMN map_rast2 raster;
UPDATE dummy_rast SET
        map_rast2 = ST_MapAlgebraExpr(rast,'2BUI'::text,'CASE WHEN [rast] BETWEEN 100 and 250 THEN 1 WHEN [rast] = 252 THEN 2 WHEN [rast] BETWEEN 253 and 254 THEN 3 ELSE 0 END'::text, '0')
WHERE rid = 2;

SELECT DISTINCT
        ST_Value(rast,1,i,j) As origval,
        ST_Value(map_rast2, 1, i, j) As mapval
FROM dummy_rast
CROSS JOIN generate_series(1, 5) AS i
CROSS JOIN generate_series(1,5) AS j
WHERE rid = 2;

 origval | mapval
---------+--------
     249 |      1
     250 |      1
     251 |
     252 |      2
     253 |      3
     254 |      3

SELECT
        ST_BandPixelType(map_rast2) As b1pixtyp
FROM dummy_rast
WHERE rid = 2;

 b1pixtyp
----------
 2BUI
                                        </pre><div class="informaltable"><table class="informaltable" border="1"><colgroup><col><col></colgroup><tbody><tr><td>
										<p>
											</p><div class="informalfigure"><div class="mediaobject"><img src="images/st_mapalgebraexpr01.png"><div class="caption"><p>元のラスタ (rast_viewカラム)</p></div></div></div><p>
										</p>
									</td><td>
										<p>
											</p><div class="informalfigure"><div class="mediaobject"><img src="images/st_mapalgebraexpr02.png"><div class="caption"><p>rast_view_ma</p></div></div></div><p>
										</p>
									</td></tr></tbody></table></div><p>新しいバンドを三つ持つラスタを生成します。元のバンドを三つ持つラスタと同じピクセルタイプです。1番バンドは地図代数関数によって変更され、残りの二つのバンドは値が代わりません。</p><pre class="programlisting">SELECT
        ST_AddBand(
                ST_AddBand(
                        ST_AddBand(
                                ST_MakeEmptyRaster(rast_view),
                                ST_MapAlgebraExpr(rast_view,1,NULL,'tan([rast])*[rast]')
                        ),
                        ST_Band(rast_view,2)
                ),
                ST_Band(rast_view, 3)
        )  As rast_view_ma
FROM wind
WHERE rid=167;
                                        </pre></div><div class="refsection"><a name="idp93780040"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_MapAlgebraExpr2" title="ST_MapAlgebraExpr">ST_MapAlgebraExpr</a>, <a class="xref" href="#RT_ST_MapAlgebraFct" title="ST_MapAlgebraFct">ST_MapAlgebraFct</a>, <a class="xref" href="#RT_ST_BandPixelType" title="ST_BandPixelType">ST_BandPixelType</a>, <a class="xref" href="#RT_ST_GeoReference" title="ST_GeoReference">ST_GeoReference</a>, <a class="xref" href="#RT_ST_Value" title="ST_Value">ST_Value</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_MapAlgebraExpr2"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MapAlgebraExpr — 2バンド版: 二つの入力バンドに対する妥当なPostgreSQL代数演算で形成された、指定したピクセルタイプとなる1バンドラスタを生成します。バンドを指定しない場合には、どちらも1番と仮定します。結果ラスタは、一つ目のラスタのアラインメント (スケール、スキュー、ピクセル角位置)にあわされます。範囲は"extenttype"引数で定義されます。取りうる"extenttype"の値はINTERSECTION, UNION, FIRST, SECONDです。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebraExpr</b>(</code>raster  <var class="pdparam">rast1</var>, raster  <var class="pdparam">rast2</var>, text  <var class="pdparam">expression</var>, text  <var class="pdparam">pixeltype=same_as_rast1_band</var>, text  <var class="pdparam">extenttype=INTERSECTION</var>, text  <var class="pdparam">nodata1expr=NULL</var>, text  <var class="pdparam">nodata2expr=NULL</var>, double precision  <var class="pdparam">nodatanodataval=NULL</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebraExpr</b>(</code>raster  <var class="pdparam">rast1</var>, integer  <var class="pdparam">band1</var>, raster  <var class="pdparam">rast2</var>, integer  <var class="pdparam">band2</var>, text  <var class="pdparam">expression</var>, text  <var class="pdparam">pixeltype=same_as_rast1_band</var>, text  <var class="pdparam">extenttype=INTERSECTION</var>, text  <var class="pdparam">nodata1expr=NULL</var>, text  <var class="pdparam">nodata2expr=NULL</var>, double precision  <var class="pdparam">nodatanodataval=NULL</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp93807304"></a><h2>説明</h2><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><a class="xref" href="#RT_ST_MapAlgebraExpr2" title="ST_MapAlgebraExpr">ST_MapAlgebraExpr</a> は2.1.0で非推奨になりました。代わりに<a class="xref" href="#RT_ST_MapAlgebra_expr" title="ST_MapAlgebra (数式版)">ST_MapAlgebra (数式版)</a> を使います。 </p></td></tr></table></div><p><code class="varname">expression</code>で定義された妥当な二つのバンドへのPostgreSQL代数演算を入力ラスタ (rast1, rast2)に適用して、一つのバンドを持つラスタを生成します。nband1, nband2が指定されない場合には、1番バンドと仮定します。新しいラスタは、一つ目のラスタと同じアラインメント (スケール、スキュー、ピクセル隅)を持ちます。新しいラスタは、<code class="varname">extenttype</code>引数で定義される範囲になります。 </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">expression</span></dt><dd><p>二つのラスタとPostgreSQL定義済み関数/演算子を含むPostgreSQL代数式です。関数と演算子は、二つのピクセルがインタセクトするピクセルの値を定めます。たとえば(([rast1] + [rast2])/2.0)::integerといったふうになります。 </p></dd><dt><span class="term">pixeltype</span></dt><dd><p>出力ラスタのピクセルタイプです。必ず<a class="xref" href="#RT_ST_BandPixelType" title="ST_BandPixelType">ST_BandPixelType</a>に挙げられたものの一つになるか、省略されるか、NULLに設定されます。引数として渡されないかNULLが渡された場合には、一つ目のラスタのピクセルタイプになります。 </p></dd><dt><span class="term">extenttype</span></dt><dd><p>新しいラスタの範囲を制御します。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><code class="varname">INTERSECTION</code> - 新しいラスタの範囲は二つのラスタのインタセクトした領域です。これがデフォルトです。 </p></li><li class="listitem"><p><code class="varname">UNION</code> - 新しいラスタの範囲は二つのラスタの結合です。 </p></li><li class="listitem"><p><code class="varname">FIRST</code> - 新しいラスタの範囲は一つ目のラスタと同じです。 </p></li><li class="listitem"><p><code class="varname">SECOND</code> - 新しいラスタの範囲は二つ目のラスタと同じです。 </p></li></ol></div></dd><dt><span class="term">nodata1expr</span></dt><dd><p><code class="varname">rast1</code>がNODATA値で、特にrast2ピクセルに値がある時に、<code class="varname">rast2</code>だけを返すか返すべき値を定義する定数を含む代数式です。 </p></dd><dt><span class="term">nodata2expr</span></dt><dd><p><code class="varname">rast2</code>がNODATA値で、特にrast2ピクセルに値がある時に、<code class="varname">rast1</code>だけを返すか返すべき値を定義する定数を含む代数式です。 </p></dd><dt><span class="term">nodatanodataval</span></dt><dd><p>rast1とrast2のピクセルの両方がNOADTA値になる場合に返すべき定数です。 </p></dd></dl></div><p><code class="varname">pixeltype</code>が渡された場合には、新しいラスタは、指定されたピクセルタイプのバンドを持ちます。pixeltypeとしてNULLが渡されたりピクセルタイプを指定しない場合には、新しいラスタは<code class="varname">rast1</code>と同じピクセルタイプになります。 </p><p>数式の中で使える語は、元バンドのピクセル値を参照する <code class="varname">[rast1.val]</code>, <code class="varname">[rast2.val]</code>、1始まりの列/行インデクスを参照する<code class="varname">[rast1.x]</code>, <code class="varname">[rast1.y]</code>などです。 </p><p>Availability: 2.0.0 </p></div><div class="refsection"><a name="idp93842120"></a><h2>例: 2バンドの共有と結合</h2><p>元のラスタから1バンドラスタを生成します。元のラスタバンドの値について2で割った余りが入ります。</p><pre class="programlisting">-- ラスタの集合の生成 --
DROP TABLE IF EXISTS fun_shapes;
CREATE TABLE fun_shapes(rid serial PRIMARY KEY, fun_name text, rast raster);

-- 空間参照系をメートル単位のマサチューセッツ平面として、ボストンのまわりの形状を挿入 --
INSERT INTO fun_shapes(fun_name, rast)
VALUES ('ref', ST_AsRaster(ST_MakeEnvelope(235229, 899970, 237229, 901930,26986),200,200,'8BUI',0,0));

INSERT INTO fun_shapes(fun_name,rast)
WITH ref(rast) AS (SELECT rast FROM fun_shapes WHERE fun_name = 'ref' )
SELECT 'area' AS fun_name, ST_AsRaster(ST_Buffer(ST_SetSRID(ST_Point(236229, 900930),26986), 1000),
                        ref.rast,'8BUI', 10, 0) As rast
FROM ref
UNION ALL
SELECT 'rand bubbles',
                        ST_AsRaster(
                        (SELECT ST_Collect(geom)
        FROM (SELECT ST_Buffer(ST_SetSRID(ST_Point(236229 + i*random()*100, 900930 + j*random()*100),26986), random()*20) As geom
                        FROM generate_series(1,10) As i, generate_series(1,10) As j
                        ) As foo ), ref.rast,'8BUI', 200, 0)
FROM ref;

-- 共有と結合の生成 --
SELECT  ST_MapAlgebraExpr(
                area.rast, bub.rast, '[rast2.val]', '8BUI', 'INTERSECTION', '[rast2.val]', '[rast1.val]') As interrast,
                ST_MapAlgebraExpr(
                        area.rast, bub.rast, '[rast2.val]', '8BUI', 'UNION', '[rast2.val]', '[rast1.val]') As unionrast
FROM
  (SELECT rast FROM fun_shapes WHERE
 fun_name = 'area') As area
CROSS JOIN  (SELECT rast
FROM fun_shapes WHERE
 fun_name = 'rand bubbles') As bub
                                        </pre><div class="informaltable"><table class="informaltable" border="1"><colgroup><col><col></colgroup><tbody><tr><td>
										<p>
											</p><div class="informalfigure"><div class="mediaobject"><img src="images/st_mapalgebraexpr2_01.png"><div class="caption"><p>インタセクションの場合</p></div></div></div><p>
										</p>
									</td><td>
										<p>
											</p><div class="informalfigure"><div class="mediaobject"><img src="images/st_mapalgebraexpr2_02.png"><div class="caption"><p>結合の場合</p></div></div></div><p>
										</p>
									</td></tr></tbody></table></div></div><div class="refsection"><a name="idp93851848"></a><h2>例: 別個のバンドとしてキャンバス上にラスタをオーバレイする</h2><pre class="programlisting">-- ST_AsPNGを使って1バンドで灰色に見える画像を作成します --
WITH mygeoms 
    AS ( SELECT 2 As bnum, ST_Buffer(ST_Point(1,5),10) As geom
            UNION ALL
            SELECT 3 AS bnum, 
                ST_Buffer(ST_GeomFromText('LINESTRING(50 50,150 150,150 50)'), 10,'join=bevel') As geom
            UNION ALL
            SELECT 1 As bnum, 
                ST_Buffer(ST_GeomFromText('LINESTRING(60 50,150 150,150 50)'), 5,'join=bevel') As geom
            ),
   -- ジオメトリと1対1に対応するキャンバスを定義
   canvas
    AS (SELECT ST_AddBand(ST_MakeEmptyRaster(200, 
        200, 
        ST_XMin(e)::integer, ST_YMax(e)::integer, 1, -1, 0, 0) , '8BUI'::text,0) As rast
        FROM (SELECT ST_Extent(geom) As e,
                    Max(ST_SRID(geom)) As srid 
                    from mygeoms 
                    ) As foo
            ),
   rbands AS (SELECT ARRAY(SELECT ST_MapAlgebraExpr(canvas.rast, ST_AsRaster(m.geom, canvas.rast, '8BUI', 100),
                 '[rast2.val]', '8BUI', 'FIRST', '[rast2.val]', '[rast1.val]') As rast
                FROM mygeoms AS m CROSS JOIN canvas
                ORDER BY m.bnum) As rasts
                )
          SELECT rasts[1] As rast1 , rasts[2] As rast2, rasts[3] As rast3, ST_AddBand(
                    ST_AddBand(rasts[1],rasts[2]), rasts[3]) As final_rast
            FROM rbands;
                                        </pre><div class="informaltable"><table class="informaltable" border="1"><colgroup><col><col></colgroup><tbody><tr><td>
										<p>
											</p><div class="informalfigure"><div class="mediaobject"><img src="images/st_mapalgebraexpr2_04.png"><div class="caption"><p>rast1</p></div></div></div><p>
										</p>
									</td><td>
										<p>
											</p><div class="informalfigure"><div class="mediaobject"><img src="images/st_mapalgebraexpr2_05.png"><div class="caption"><p>rast2</p></div></div></div><p>
										</p>
									</td></tr><tr><td>
										<p>
											</p><div class="informalfigure"><div class="mediaobject"><img src="images/st_mapalgebraexpr2_06.png"><div class="caption"><p>rast3</p></div></div></div><p>
										</p>
									</td><td>
										<p>
											</p><div class="informalfigure"><div class="mediaobject"><img src="images/st_mapalgebraexpr2_07.png"><div class="caption"><p>final_rast</p></div></div></div><p>
										</p>
									</td></tr></tbody></table></div></div><div class="refsection"><a name="idp93867720"></a><h2>例: 選択した区画の2メートル幅境界線を空中写真にオーバレイする</h2><pre class="programlisting">-- 前二つの切り取ったバンドと
-- 3番バンドにジオメトリをオーバレイしたバンドからなる
-- 3バンドのラスタを生成します
-- このクエリはWindows 64ビット版のPostGISで3.6秒かかりました
WITH pr AS
-- 演算の順序の注意: 全てのラスタを必要なピクセル範囲に切り抜いています
(SELECT ST_Clip(rast,ST_Expand(geom,50) ) As rast, g.geom
        FROM aerials.o_2_boston AS r INNER JOIN
-- union our parcels of interest so they form a single geometry we can later intersect with
                (SELECT ST_Union(ST_Transform(the_geom,26986)) AS geom
                  FROM landparcels WHERE pid IN('0303890000', '0303900000')) As g
                ON ST_Intersects(rast::geometry, ST_Expand(g.geom,50))
),
-- ラスタの破片を結合します
-- ラスタのST_Unionは非常に遅いですがラスタを小さくすれば速度が上がります
-- 先に切り出しておいてから結合しているのはこのためです
prunion AS
(SELECT ST_AddBand(NULL, ARRAY[ST_Union(rast,1),ST_Union(rast,2),ST_Union(rast,3)] ) As clipped,geom
FROM pr
GROUP BY geom)
-- ラスタの破片を結合し、区画境界線のオーバレイも持った
-- 最終のラスタを返します
-- 最初の二つのバンドと3番バンド+ジオメトリの地図代数関数とを追加します

SELECT ST_AddBand(ST_Band(clipped,ARRAY[1,2])
        , ST_MapAlgebraExpr(ST_Band(clipped,3), ST_AsRaster(ST_Buffer(ST_Boundary(geom),2),clipped, '8BUI',250),
         '[rast2.val]', '8BUI', 'FIRST', '[rast2.val]', '[rast1.val]') ) As rast
FROM prunion;
                                        </pre><div class="informaltable"><table class="informaltable" border="1"><colgroup><col></colgroup><tbody><tr><td>
										<p>
											</p><div class="informalfigure"><div class="mediaobject"><img src="images/st_mapalgebraexpr2_08.png"><div class="caption"><p>青線が対象区画の境界です</p></div></div></div><p>
										</p>
									</td></tr></tbody></table></div></div><div class="refsection"><a name="idp93873864"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_MapAlgebraExpr" title="ST_MapAlgebraExpr">ST_MapAlgebraExpr</a>, <a class="xref" href="#RT_ST_AddBand" title="ST_AddBand">ST_AddBand</a>, <a class="xref" href="#RT_ST_AsPNG" title="ST_AsPNG">ST_AsPNG</a>, <a class="xref" href="#RT_ST_AsRaster" title="ST_AsRaster">ST_AsRaster</a>, <a class="xref" href="#RT_ST_MapAlgebraFct" title="ST_MapAlgebraFct">ST_MapAlgebraFct</a>, <a class="xref" href="#RT_ST_BandPixelType" title="ST_BandPixelType">ST_BandPixelType</a>, <a class="xref" href="#RT_ST_GeoReference" title="ST_GeoReference">ST_GeoReference</a>, <a class="xref" href="#RT_ST_Value" title="ST_Value">ST_Value</a>, <a class="xref" href="#RT_ST_Union" title="ST_Union">ST_Union</a>, <a class="xref" href="#ST_Union" title="ST_Union">ST_Union</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_MapAlgebraFct"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MapAlgebraFct — 1バンド版 - 入力バンドに対する妥当なPostgreSQL関数で形成された、指定したピクセルタイプとなる1バンドラスタを生成します。バンドを指定しない場合には、1番と仮定します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebraFct</b>(</code>raster <var class="pdparam">rast</var>, regprocedure <var class="pdparam">onerasteruserfunc</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebraFct</b>(</code>raster <var class="pdparam">rast</var>, regprocedure <var class="pdparam">onerasteruserfunc</var>, text[] <var class="pdparam">VARIADIC args</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebraFct</b>(</code>raster <var class="pdparam">rast</var>, text <var class="pdparam">pixeltype</var>, regprocedure <var class="pdparam">onerasteruserfunc</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebraFct</b>(</code>raster <var class="pdparam">rast</var>, text <var class="pdparam">pixeltype</var>, regprocedure <var class="pdparam">onerasteruserfunc</var>, text[] <var class="pdparam">VARIADIC args</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebraFct</b>(</code>raster <var class="pdparam">rast</var>, integer <var class="pdparam">band</var>, regprocedure <var class="pdparam">onerasteruserfunc</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebraFct</b>(</code>raster <var class="pdparam">rast</var>, integer <var class="pdparam">band</var>, regprocedure <var class="pdparam">onerasteruserfunc</var>, text[] <var class="pdparam">VARIADIC args</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebraFct</b>(</code>raster <var class="pdparam">rast</var>, integer <var class="pdparam">band</var>, text <var class="pdparam">pixeltype</var>, regprocedure <var class="pdparam">onerasteruserfunc</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebraFct</b>(</code>raster <var class="pdparam">rast</var>, integer <var class="pdparam">band</var>, text <var class="pdparam">pixeltype</var>, regprocedure <var class="pdparam">onerasteruserfunc</var>, text[] <var class="pdparam">VARIADIC args</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp93923016"></a><h2>説明</h2><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><a class="xref" href="#RT_ST_MapAlgebraFct" title="ST_MapAlgebraFct">ST_MapAlgebraFct</a> は2.1.0で非推奨になりました。代わりに<a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>を使います。 </p></td></tr></table></div><p>入力ラスタ (<code class="varname">rast</code>)に対して<code class="varname">onerasteruserfunc</code>で指定される妥当なPostgreSQL関数で形成されたラスタを返します。生成されるラスタは指定したピクセルタイプとなる1バンドラスタです。<code class="varname">band</code>を指定しない場合には、1番と仮定します。新しいラスタは、元のラスタと同じ地理参照、幅、高さを持ちますが、一つのバンドしか持ちません。</p><p><code class="varname">pixeltype</code>が渡された場合には、新しいラスタのバンドは、そのピクセルタイプになります。pixeltypeにNULLが渡された場合には、新しいラスタは入力<code class="varname">rast</code>のバンドのピクセルタイプと同じになります。</p><p><code class="varname">onerasteruserfunc</code>引数は SQL関数またはPL/pgSQL関数のシグネチャで、regprocedureにキャストします。大変単純で本当に使えないPL/pgSQL関数の例を挙げます。</p><pre class="programlisting">CREATE OR REPLACE FUNCTION simple_function(pixel FLOAT, pos INTEGER[], VARIADIC args TEXT[])
    RETURNS FLOAT
    AS $$ BEGIN
        RETURN 0.0;
    END; $$
    LANGUAGE 'plpgsql' IMMUTABLE;</pre><p> <code class="varname">userfunction</code>は、2または3の引数を受け付けます。すなわち、float8値、任意の整数配列、VARIADIC文字列配列です。第1引数はラスタセルごとの値です (ラスタのデータ型に関係なく)。第2引数は現在の処理セルの位置で、'{x,y}'であらわされます。第3引数は、<a class="xref" href="#RT_ST_MapAlgebraFct" title="ST_MapAlgebraFct">ST_MapAlgebraFct</a>へのパラメータの残っているもの全てが<code class="varname">userfunction</code>に渡されることを示します </p><p><span class="type">regprodedure</span>引数をSQL関数に渡す際は完全な関数シグネチャと<span class="type">regprocedure</span>型へのキャストが求められます。 上のPL/pgSQL関数を引数に取るには、引数のSQLは次のようにします。</p><pre class="programlisting">'simple_function(float,integer[],text[])'::regprocedure</pre><p> 引数は関数名と引数の型を含み、関数名と引数を引用符で括り、かつ<span class="type">regprocedure</span>にキャストする点に注意が必要です。 </p><p><code class="varname">userfunction</code>の第3引数は<span class="type">variadic text</span>配列です。どの<a class="xref" href="#RT_ST_MapAlgebraFct" title="ST_MapAlgebraFct">ST_MapAlgebraFct</a>にもついてくる全ての文字列引数は、指定された<code class="varname">userfunction</code>に、そのまま渡されて、<code class="varname">args</code>引数内に入ります。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>VARIADICキーワードに関する詳細情報については、PostgreSQL文書と<a class="ulink" href="http://www.postgresql.org/docs/current/static/xfunc-sql.html" target="_top">Query Language (SQL) Functions</a> (訳注: 日本語版は「<a class="ulink" href="http://www.postgresql.jp/document/current/html/xfunc-sql.html" target="_top">問い合わせ言語 （SQL）関数</a>」です)の"SQL Functions with Variable Numbers of Arguments" (訳注: 日本語版は「可変長引数を取るSQL関数」)節を参照して下さい。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">userfunction</code>への<span class="type">text[]</span>引数は、あらゆる引数を処理のためにユーザ関数に渡すかどうかの選択にかかわらず求められます。</p></td></tr></table></div><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp93937736"></a><h2>例</h2><p>元のラスタから1バンドラスタを生成します。元のラスタバンドの値について2で割った余りが入ります。</p><pre class="programlisting">ALTER TABLE dummy_rast ADD COLUMN map_rast raster;
CREATE FUNCTION mod_fct(pixel float, pos integer[], variadic args text[])
RETURNS float
AS $$
BEGIN
    RETURN pixel::integer % 2;
END;
$$
LANGUAGE 'plpgsql' IMMUTABLE;

UPDATE dummy_rast SET map_rast = ST_MapAlgebraFct(rast,NULL,'mod_fct(float,integer[],text[])'::regprocedure) WHERE rid = 2;

SELECT ST_Value(rast,1,i,j) As origval, ST_Value(map_rast, 1, i, j) As mapval
FROM dummy_rast CROSS JOIN generate_series(1, 3) AS i CROSS JOIN generate_series(1,3) AS j
WHERE rid = 2;

 origval | mapval
---------+--------
     253 |      1
     254 |      0
     253 |      1
     253 |      1
     254 |      0
     254 |      0
     250 |      0
     254 |      0
     254 |      0
                                        </pre><p>ピクセルタイプが2BUIの1バンドラスタを生成します。元のラスタに対して再分類を行った値が入り、NODATA値をユーザ関数に渡される引数の値 (0)に設定します。</p><pre class="programlisting">ALTER TABLE dummy_rast ADD COLUMN map_rast2 raster;
CREATE FUNCTION classify_fct(pixel float, pos integer[], variadic args text[])
RETURNS float
AS
$$
DECLARE
    nodata float := 0;
BEGIN
    IF NOT args[1] IS NULL THEN
        nodata := args[1];
    END IF;
    IF pixel &lt; 251 THEN
        RETURN 1;
    ELSIF pixel = 252 THEN
        RETURN 2;
    ELSIF pixel &gt; 252 THEN
        RETURN 3;
    ELSE
        RETURN nodata;
    END IF;
END;
$$
LANGUAGE 'plpgsql';
UPDATE dummy_rast SET map_rast2 = ST_MapAlgebraFct(rast,'2BUI','classify_fct(float,integer[],text[])'::regprocedure, '0') WHERE rid = 2;

SELECT DISTINCT ST_Value(rast,1,i,j) As origval, ST_Value(map_rast2, 1, i, j) As mapval
FROM dummy_rast CROSS JOIN generate_series(1, 5) AS i CROSS JOIN generate_series(1,5) AS j
WHERE rid = 2;

 origval | mapval
---------+--------
     249 |      1
     250 |      1
     251 |
     252 |      2
     253 |      3
     254 |      3

SELECT ST_BandPixelType(map_rast2) As b1pixtyp
FROM dummy_rast WHERE rid = 2;

 b1pixtyp
----------
 2BUI
                                        </pre><div class="informaltable"><table class="informaltable" border="1"><colgroup><col><col></colgroup><tbody><tr><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_mapalgebraexpr01.png"><div class="caption"><p>元のラスタ (rast_viewカラム)</p></div></div></div></td><td><div class="informalfigure"><div class="mediaobject"><img src="images/st_mapalgebraexpr02.png"><div class="caption"><p>rast_view_ma</p></div></div></div></td></tr></tbody></table></div><p>新しいバンドを三つ持つラスタを生成します。元のバンドを三つ持つラスタと同じピクセルタイプです。1番バンドは地図代数関数によって変更され、残りの二つのバンドは値が代わりません。</p><pre class="programlisting">CREATE FUNCTION rast_plus_tan(pixel float, pos integer[], variadic args text[])
RETURNS float
AS
$$
BEGIN
        RETURN tan(pixel) * pixel;
END;
$$
LANGUAGE 'plpgsql';

SELECT ST_AddBand(
        ST_AddBand(
                ST_AddBand(
                        ST_MakeEmptyRaster(rast_view),
                        ST_MapAlgebraFct(rast_view,1,NULL,'rast_plus_tan(float,integer[],text[])'::regprocedure)
                ),
                ST_Band(rast_view,2)
        ),
        ST_Band(rast_view, 3) As rast_view_ma
)
FROM wind
WHERE rid=167;
                                        </pre></div><div class="refsection"><a name="idp93947720"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_MapAlgebraExpr" title="ST_MapAlgebraExpr">ST_MapAlgebraExpr</a>, <a class="xref" href="#RT_ST_BandPixelType" title="ST_BandPixelType">ST_BandPixelType</a>, <a class="xref" href="#RT_ST_GeoReference" title="ST_GeoReference">ST_GeoReference</a>, <a class="xref" href="#RT_ST_SetValue" title="ST_SetValue">ST_SetValue</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_MapAlgebraFct2"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MapAlgebraFct — 2バンド版 - 二つの入力バンドに対する妥当なPostgreSQL関数で形成された、指定したピクセルタイプとなる1バンドラスタを生成します。バンドを指定しない場合には、1番と仮定します。"extenttype"のデフォルトはINTERSECTIONです。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebraFct</b>(</code>raster <var class="pdparam">rast1</var>, raster <var class="pdparam">rast2</var>, regprocedure <var class="pdparam">tworastuserfunc</var>, text <var class="pdparam">pixeltype=same_as_rast1</var>, text <var class="pdparam">extenttype=INTERSECTION</var>, text[] <var class="pdparam">VARIADIC userargs</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebraFct</b>(</code>raster <var class="pdparam">rast1</var>, integer <var class="pdparam">band1</var>, raster <var class="pdparam">rast2</var>, integer <var class="pdparam">band2</var>, regprocedure <var class="pdparam">tworastuserfunc</var>, text <var class="pdparam">pixeltype=same_as_rast1</var>, text <var class="pdparam">extenttype=INTERSECTION</var>, text[] <var class="pdparam">VARIADIC userargs</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp94035272"></a><h2>説明</h2><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><a class="xref" href="#RT_ST_MapAlgebraFct2" title="ST_MapAlgebraFct">ST_MapAlgebraFct</a> は2.1.0で非推奨になりました。代わりに<a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>を使います。 </p></td></tr></table></div><p>二つの入力ラスタ (<code class="varname">rast1</code>, <code class="varname">rast2</code>)に対して<code class="varname">tworastuserfunc</code>で指定される妥当なPostgreSQL関数で形成されるラスタを返します。<code class="varname">band1</code>または<code class="varname">band2</code>が指定されていない場合には、1番と仮定します。新しいラスタは、元のラスタと同じ地理参照、幅、高さを持ちますが、一つのバンドしか持ちません。 </p><p><code class="varname">pixeltype</code>が渡された場合には、新しいラスタはそのピクセルタイプのバンドを持ちます。pixelteypeとしてNULLが渡されたりピクセルタイプを指定しない場合には、新しいラスタは<code class="varname">rast1</code>の入力バンドと同じピクセルタイプになります。 </p><p><code class="varname">tworastuserfunc</code>引数はSQL関数またはPL/pgSQL関数のシグネチャで、regprocedureにキャストします。大変単純で本当に使えないPL/pgSQL関数の例を挙げます。</p><pre class="programlisting">CREATE OR REPLACE FUNCTION simple_function_for_two_rasters(pixel1 FLOAT, pixel2 FLOAT, pos INTEGER[], VARIADIC args TEXT[])
    RETURNS FLOAT
    AS $$ BEGIN
        RETURN 0.0;
    END; $$
    LANGUAGE 'plpgsql' IMMUTABLE;</pre><p> <code class="varname">tworastuserfunc</code>は、3または4の引数を受け付けます。すなわち、倍精度浮動小数点数、倍精度浮動小数点数、任意の整数配列、VARIADIC文字列配列です。第1引数は<code class="varname">rast1</code>のラスタセルごとの値です (ラスタのデータ型に関係なく)。第2引数は<code class="varname">rast2</code>のラスタセルごとの値です。第3引数は現在の処理セルの位置で、'{x,y}'であらわされます。第4引数は、<a class="xref" href="#RT_ST_MapAlgebraFct2" title="ST_MapAlgebraFct">ST_MapAlgebraFct</a>へのパラメータの残っているもの全てが<code class="varname">tworastuserfunc</code>に渡されることを示します。 </p><p><span class="type">regprodedure</span>引数をSQL関数に渡す際は完全な関数シグネチャと<span class="type">regprocedure</span>型へのキャストが求められます。上のPL/pgSQL関数を引数に取るには、引数のSQLは次のようにします。</p><pre class="programlisting">'simple_function(double precision, double precision, integer[], text[])'::regprocedure</pre><p> 引数は関数名と引数の型を含み、関数名と引数を引用符で括り、かつ<span class="type">regprocedure</span>にキャストする点に注意が必要です。 </p><p><code class="varname">tworastuserfunc</code>引数は <span class="type">variadic text</span>配列です。どの<a class="xref" href="#RT_ST_MapAlgebraFct2" title="ST_MapAlgebraFct">ST_MapAlgebraFct</a>にもついてくる全ての文字列引数は、指定された<code class="varname">tworastuserfunc</code>に、そのまま渡されて、<code class="varname">userargs</code>引数内に入ります。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>VARIADICキーワードに関する詳細情報については、PostgreSQL文書と<a class="ulink" href="http://www.postgresql.org/docs/current/static/xfunc-sql.html" target="_top">Query Language (SQL) Functions</a> (訳注: 日本語版は「<a class="ulink" href="http://www.postgresql.jp/document/current/html/xfunc-sql.html" target="_top">問い合わせ言語 （SQL）関数</a>」です)の"SQL Functions with Variable Numbers of Arguments" (訳注: 日本語版は「可変長引数を取るSQL関数」)節を参照して下さい。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">tworastuserfunc</code>への<span class="type">text[]</span>引数は、あらゆる引数を処理のためにユーザ関数に渡すかどうかの選択にかかわらず求められます。</p></td></tr></table></div><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp94051528"></a><h2>例: 別個のバンドとしてキャンバス上にラスタをオーバレイする</h2><pre class="programlisting">-- ユーザ関数の定義 --
CREATE OR REPLACE FUNCTION raster_mapalgebra_union(
        rast1 double precision,
        rast2 double precision,
    pos integer[],
        VARIADIC userargs text[]
)
        RETURNS double precision
        AS $$
        DECLARE
        BEGIN
                CASE
                        WHEN rast1 IS NOT NULL AND rast2 IS NOT NULL THEN
                                RETURN ((rast1 + rast2)/2.);
                        WHEN rast1 IS NULL AND rast2 IS NULL THEN
                                RETURN NULL;
                        WHEN rast1 IS NULL THEN
                                RETURN rast2;
                        ELSE
                                RETURN rast1;
                END CASE;

                RETURN NULL;
        END;
        $$ LANGUAGE 'plpgsql' IMMUTABLE COST 1000;

-- ラスタの試験テーブルの用意
DROP TABLE IF EXISTS map_shapes;
CREATE TABLE map_shapes(rid serial PRIMARY KEY, rast raster, bnum integer, descrip text);
INSERT INTO map_shapes(rast,bnum, descrip)
WITH mygeoms
    AS ( SELECT 2 As bnum, ST_Buffer(ST_Point(90,90),30) As geom, 'circle' As descrip
            UNION ALL
            SELECT 3 AS bnum,
                ST_Buffer(ST_GeomFromText('LINESTRING(50 50,150 150,150 50)'), 15) As geom, 'big road' As descrip
            UNION ALL
            SELECT 1 As bnum,
                ST_Translate(ST_Buffer(ST_GeomFromText('LINESTRING(60 50,150 150,150 50)'), 8,'join=bevel'), 10,-6) As geom, 'small road' As descrip
            ),
   -- ジオメトリと1対1に対応するキャンバスを定義
   canvas
    AS ( SELECT ST_AddBand(ST_MakeEmptyRaster(250,
        250,
        ST_XMin(e)::integer, ST_YMax(e)::integer, 1, -1, 0, 0 ) , '8BUI'::text,0) As rast
        FROM (SELECT ST_Extent(geom) As e,
                    Max(ST_SRID(geom)) As srid
                    from mygeoms
                    ) As foo
            )
-- キャンバスとアラインメントの合ったラスタを返します
SELECT ST_AsRaster(m.geom, canvas.rast, '8BUI', 240) As rast, bnum, descrip
                FROM mygeoms AS m CROSS JOIN canvas
UNION ALL
SELECT canvas.rast, 4, 'canvas'
FROM canvas;

-- 1バンド版の地図代数関数を実行し、あとでST_AddBandで集めます
INSERT INTO map_shapes(rast,bnum,descrip)
SELECT ST_AddBand(ST_AddBand(rasts[1], rasts[2]),rasts[3]), 4, 'map bands overlay fct union (canvas)'
        FROM (SELECT ARRAY(SELECT ST_MapAlgebraFct(m1.rast, m2.rast,
                        'raster_mapalgebra_union(double precision, double precision, integer[], text[])'::regprocedure, '8BUI', 'FIRST')
                FROM map_shapes As m1 CROSS JOIN map_shapes As m2
        WHERE m1.descrip = 'canvas' AND m2.descrip &lt;&gt; 'canvas' ORDER BY m2.bnum) As rasts) As foo;
                                        </pre><div class="informaltable"><table class="informaltable" border="1"><colgroup><col></colgroup><tbody><tr><td>
										<p>
											</p><div class="informalfigure"><div class="mediaobject"><img src="images/st_mapalgebrafct2_01.png"><div class="caption"><p>バンドオーバレイ (キャンバス)の図 (赤:小さい道 緑:円、青:大きな道)</p></div></div></div><p>
										</p>
									</td></tr></tbody></table></div></div><div class="refsection"><a name="idp94057416"></a><h2>追加引数を取るユーザ定義関数</h2><pre class="programlisting">CREATE OR REPLACE FUNCTION raster_mapalgebra_userargs(
        rast1 double precision,
        rast2 double precision,
    pos integer[],
        VARIADIC userargs text[]
)
        RETURNS double precision
        AS $$
        DECLARE
        BEGIN
                CASE
                        WHEN rast1 IS NOT NULL AND rast2 IS NOT NULL THEN
                                RETURN least(userargs[1]::integer,(rast1 + rast2)/2.);
                        WHEN rast1 IS NULL AND rast2 IS NULL THEN
                                RETURN userargs[2]::integer;
                        WHEN rast1 IS NULL THEN
                                RETURN greatest(rast2,random()*userargs[3]::integer)::integer;
                        ELSE
                                RETURN greatest(rast1, random()*userargs[4]::integer)::integer;
                END CASE;

                RETURN NULL;
        END;
        $$ LANGUAGE 'plpgsql' VOLATILE COST 1000;

SELECT ST_MapAlgebraFct(m1.rast, 1, m1.rast, 3,
                        'raster_mapalgebra_userargs(double precision, double precision, integer[], text[])'::regprocedure,
                                '8BUI', 'INTERSECT', '100','200','200','0')
                FROM map_shapes As m1
        WHERE m1.descrip = 'map bands overlay fct union (canvas)';
                                        </pre><p>
						</p><div class="informalfigure"><div class="mediaobject"><img src="images/st_mapalgebrafct2_02.png"><div class="caption"><p>追加引数を持つユーザ定義関数と同じラスタからの異なるバンド</p></div></div></div><p>
					</p></div><div class="refsection"><a name="idp94061256"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_MapAlgebraExpr2" title="ST_MapAlgebraExpr">ST_MapAlgebraExpr</a>, <a class="xref" href="#RT_ST_BandPixelType" title="ST_BandPixelType">ST_BandPixelType</a>, <a class="xref" href="#RT_ST_GeoReference" title="ST_GeoReference">ST_GeoReference</a>, <a class="xref" href="#RT_ST_SetValue" title="ST_SetValue">ST_SetValue</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_MapAlgebraFctNgb"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MapAlgebraFctNgb — 1バンド版: ユーザ定義PostgreSQL関数を使用する最近傍地図代数関数です。入力ラスタバンドの近傍の値を与えたPL/pgSQLユーザ定義関数の結果からなるラスタを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_MapAlgebraFctNgb</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">band</var>, text  <var class="pdparam">pixeltype</var>, integer  <var class="pdparam">ngbwidth</var>, integer  <var class="pdparam">ngbheight</var>, regprocedure  <var class="pdparam">onerastngbuserfunc</var>, text  <var class="pdparam">nodatamode</var>, text[]  <var class="pdparam">VARIADIC args</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp94079560"></a><h2>説明</h2><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a> は2.1.0で非推奨になりました。代わりに<a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>を使います。 </p></td></tr></table></div><p>(1バンド版) 入力ラスタバンドの近傍の値を与えたPL/pgSQLユーザ定義関数の結果からなるラスタを返します。ユーザ定義関数は近傍のピクセル値を数の配列として取り、ピクセル毎に、ユーザ定義関数からの結果を返し、現在の対象ピクセルのピクセル値を関数の返り値に置き換えます。 </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">rast</span></dt><dd><p>ユーザ定義関数が評価されるラスタです。</p></dd><dt><span class="term">band</span></dt><dd><p>評価されるラスタのバンド番号です。デフォルトは1です。</p></dd><dt><span class="term">pixeltype</span></dt><dd><p>出力ラスタのピクセルタイプです。<a class="xref" href="#RT_ST_BandPixelType" title="ST_BandPixelType">ST_BandPixelType</a>の一覧にあるものか、指定しないか、NULLを指定します。指定しないかNULLを指定した場合には、<code class="varname">rast</code>のピクセルタイプがデフォルトになります。結果ピクセル値がピクセルタイプが許容する範囲を超える場合には、切り詰められます。</p></dd><dt><span class="term">ngbwidth</span></dt><dd><p>セル単位の近傍の幅です。</p></dd><dt><span class="term">ngbheight</span></dt><dd><p>セル単位の近傍の高さです。</p></dd><dt><span class="term">onerastngbuserfunc</span></dt><dd><p>ラスタの単一バンドの近傍ピクセルに適用されるPL/pgSQLユーザ定義関数です。一つ目の要素は、近傍ピクセルの四角形を表現する数値の2次元配列です。</p></dd><dt><span class="term">nodatamode</span></dt><dd><p>NODATAまたはNULLとなる近傍ピクセルにおける関数に渡す値を定義します。</p><p>'ignore': 近傍で遭遇したNODATA値全てが計算から除外されます。ユーザ定義関数に必ず送られ、ユーザ定義関数が対処方法を決定します。</p><p>'NULL': 近傍で遭遇したNODATA値全てが結果をNULLとします。この場合はユーザ定義関数が呼び出されません。</p><p>'value': 近傍で遭遇したNODATA値全てが参照ピクセル (近傍の中心にあるピクセル)の値に置き換えられます。この値がNODATAになった場合には、'NULL'と同じ挙動を取ります (影響のある近傍について)。</p></dd><dt><span class="term">args</span></dt><dd><p>ユーザ定義関数に渡される引数です。</p></dd></dl></div><p>Availability: 2.0.0 </p></div><div class="refsection"><a name="idp94095304"></a><h2>例</h2><p>単一タイルとしてロードされたカトリーナのラスタを使った例です。<a class="ulink" href="http://trac.osgeo.org/gdal/wiki/frmts_wtkraster.html" target="_top">http://trac.osgeo.org/gdal/wiki/frmts_wtkraster.html</a>に説明があります。また、<a class="xref" href="#RT_ST_Rescale" title="ST_Rescale">ST_Rescale</a>の例で準備を行っています。 </p><pre class="programlisting">--
-- 近傍の値の全てに関する平均を計算する、単純なユーザ定義の「コールバック」関数
--
CREATE OR REPLACE FUNCTION rast_avg(matrix float[][], nodatamode text, variadic args text[])
    RETURNS float AS
    $$
    DECLARE
                _matrix float[][];
        x1 integer;
        x2 integer;
        y1 integer;
        y2 integer;
        sum float;
    BEGIN
                _matrix := matrix;
        sum := 0;
        FOR x in array_lower(matrix, 1)..array_upper(matrix, 1) LOOP
            FOR y in array_lower(matrix, 2)..array_upper(matrix, 2) LOOP
                sum := sum + _matrix[x][y];
            END LOOP;
        END LOOP;
        RETURN (sum*1.0/(array_upper(matrix,1)*array_upper(matrix,2) ))::integer ;
    END;
    $$
LANGUAGE 'plpgsql' IMMUTABLE COST 1000;

-- ラスタに対してX,Y軸でそれぞれ2ピクセル内の平均を計算するようにしています --
SELECT ST_MapAlgebraFctNgb(rast, 1,  '8BUI', 4,4,
                'rast_avg(float[][], text, text[])'::regprocedure, 'NULL', NULL) As nn_with_border
        FROM katrinas_rescaled
        limit 1;
                                        </pre><div class="informaltable"><table class="informaltable" border="1"><colgroup><col><col></colgroup><tbody><tr><td>
										<p>
											</p><div class="informalfigure"><div class="mediaobject"><img src="images/st_mapalgebrafctngb01.png"><div class="caption"><p>ラスタの1番バンド</p></div></div></div><p>
										</p>
									</td><td>
										<p>
											</p><div class="informalfigure"><div class="mediaobject"><img src="images/st_mapalgebrafctngb02.png"><div class="caption"><p>ピクセル毎に4x4ピクセル内のピクセル平均を計算したラスタ</p></div></div></div><p>
										</p>
									</td></tr></tbody></table></div></div><div class="refsection"><a name="idp94106184"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_MapAlgebraFct" title="ST_MapAlgebraFct">ST_MapAlgebraFct</a>, <a class="xref" href="#RT_ST_MapAlgebraExpr" title="ST_MapAlgebraExpr">ST_MapAlgebraExpr</a>, <a class="xref" href="#RT_ST_Rescale" title="ST_Rescale">ST_Rescale</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Reclass"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Reclass — 元のラスタから再分類したバンドタイプからなるラスタを生成します。nbandは変更するバンドです。nbandが指定されていない場合には、1と仮定します。他の全てのバンドは変更せずに返します。可視画像の書式としてより単純な描画を行うために、16BUIバンドを8BUIバンドに変換する、等のために使います。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_Reclass</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, text  <var class="pdparam">reclassexpr</var>, text  <var class="pdparam">pixeltype</var>, double precision  <var class="pdparam">nodataval=NULL</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Reclass</b>(</code>raster  <var class="pdparam">rast</var>, reclassarg[]  <var class="pdparam">VARIADIC reclassargset</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Reclass</b>(</code>raster  <var class="pdparam">rast</var>, text  <var class="pdparam">reclassexpr</var>, text  <var class="pdparam">pixeltype</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp94124488"></a><h2>説明</h2><p>入力ラスタ (<code class="varname">rast</code>)に<code class="varname">reclassexpr</code>で定義する妥当なPostgreSQL代数演算子を適用して新しいラスタを生成します。<code class="varname">band</code>が指定されていない場合には、1番と仮定します。新しいラスタは、元のラスタと同じ地理参照、幅、高さを持ちます。指示されていないバンドは変更せずに返ります。妥当な再分類の数式の説明については<a class="xref" href="#reclassarg" title="reclassarg">reclassarg</a>を参照して下さい。</p><p>新しいラスタのバンドは<code class="varname">pixeltype</code>で指定するピクセルタイプになります。<code class="varname">reclassargset</code>を渡した場合は、個々のreclassargが生成されるバンド毎の挙動を定義します。</p><p>Availability: 2.0.0 </p></div><div class="refsection"><a name="idp94128712"></a><h2>基本的な例</h2><p>元ラスタから新しいラスタを生成しますが、2番バンドを8BUIから4BUIに変換して、101-254をNODATA値にします。</p><pre class="programlisting">ALTER TABLE dummy_rast ADD COLUMN reclass_rast raster;
UPDATE dummy_rast SET reclass_rast = ST_Reclass(rast,2,'0-87:1-10, 88-100:11-15, 101-254:0-0', '4BUI',0) WHERE rid = 2;

SELECT i as col, j as row, ST_Value(rast,2,i,j) As origval,
    ST_Value(reclass_rast, 2, i, j) As reclassval,
    ST_Value(reclass_rast, 2, i, j, false) As reclassval_include_nodata
FROM dummy_rast CROSS JOIN generate_series(1, 3) AS i CROSS JOIN generate_series(1,3) AS j
WHERE rid = 2;

 col | row | origval | reclassval | reclassval_include_nodata
-----+-----+---------+------------+---------------------------
   1 |   1 |      78 |          9 |                         9
   2 |   1 |      98 |         14 |                        14
   3 |   1 |     122 |            |                         0
   1 |   2 |      96 |         14 |                        14
   2 |   2 |     118 |            |                         0
   3 |   2 |     180 |            |                         0
   1 |   3 |      99 |         15 |                        15
   2 |   3 |     112 |            |                         0
   3 |   3 |     169 |            |                         0
                                        </pre></div><div class="refsection"><a name="idp94130376"></a><h2>例: 複数の再分類を使った高度な例</h2><p>元ラスタから新しいラスタを生成しますが、1番、2番、3番バンドを1BB, 4BUI, 4BUIにそれぞれ変換して再分類します。再分類の識別番号 (理論的には元ラスタと同数のバンド)を入力するために取るVARIADIC reclassarg引数を使っています。 </p><pre class="programlisting">UPDATE dummy_rast SET reclass_rast =
    ST_Reclass(rast,
        ROW(2,'0-87]:1-10, (87-100]:11-15, (101-254]:0-0', '4BUI',NULL)::reclassarg,
        ROW(1,'0-253]:1, 254:0', '1BB', NULL)::reclassarg,
        ROW(3,'0-70]:1, (70-86:2, [86-150):3, [150-255:4', '4BUI', NULL)::reclassarg
        ) WHERE rid = 2;

SELECT i as col, j as row,ST_Value(rast,1,i,j) As ov1,  ST_Value(reclass_rast, 1, i, j) As rv1,
    ST_Value(rast,2,i,j) As ov2, ST_Value(reclass_rast, 2, i, j) As rv2,
    ST_Value(rast,3,i,j) As ov3, ST_Value(reclass_rast, 3, i, j) As rv3
FROM dummy_rast CROSS JOIN generate_series(1, 3) AS i CROSS JOIN generate_series(1,3) AS j
WHERE rid = 2;

col | row | ov1 | rv1 | ov2 | rv2 | ov3 | rv3
----+-----+-----+-----+-----+-----+-----+-----
  1 |   1 | 253 |   1 |  78 |   9 |  70 |   1
  2 |   1 | 254 |   0 |  98 |  14 |  86 |   3
  3 |   1 | 253 |   1 | 122 |   0 | 100 |   3
  1 |   2 | 253 |   1 |  96 |  14 |  80 |   2
  2 |   2 | 254 |   0 | 118 |   0 | 108 |   3
  3 |   2 | 254 |   0 | 180 |   0 | 162 |   4
  1 |   3 | 250 |   1 |  99 |  15 |  90 |   3
  2 |   3 | 254 |   0 | 112 |   0 | 108 |   3
  3 |   3 | 254 |   0 | 169 |   0 | 175 |   4
                                        </pre></div><div class="refsection"><a name="idp94132040"></a><h2>例: 単一バンドで32BFのラスタをの可視ラスタへの高度な対応付け</h2><p>32BFバンドを一つ持つだけのラスタから三つのバンド (8BUI, 8BUI, 8BUI可視ラスタ)を生成します。 </p><pre class="programlisting">ALTER TABLE wind ADD COLUMN rast_view raster;
UPDATE wind
        set rast_view = ST_AddBand( NULL,
        ARRAY[
        ST_Reclass(rast, 1,'0.1-10]:1-10,9-10]:11,(11-33:0'::text, '8BUI'::text,0),
        ST_Reclass(rast,1, '11-33):0-255,[0-32:0,(34-1000:0'::text, '8BUI'::text,0),
        ST_Reclass(rast,1,'0-32]:0,(32-100:100-255'::text, '8BUI'::text,0)
        ]
        );
                                        </pre></div><div class="refsection"><a name="idp94133704"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_AddBand" title="ST_AddBand">ST_AddBand</a>, <a class="xref" href="#RT_ST_Band" title="ST_Band">ST_Band</a>, <a class="xref" href="#RT_ST_BandPixelType" title="ST_BandPixelType">ST_BandPixelType</a>, <a class="xref" href="#RT_ST_MakeEmptyRaster" title="ST_MakeEmptyRaster">ST_MakeEmptyRaster</a>, <a class="xref" href="#reclassarg" title="reclassarg">reclassarg</a>, <a class="xref" href="#RT_ST_Value" title="ST_Value">ST_Value</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Union"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Union — ラスタタイルの集合を結合して1以上のバンドからなる単一ラスタを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_Union</b>(</code>setof raster  <var class="pdparam">rast</var><code>)</code>;</p></div><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_Union</b>(</code>setof raster  <var class="pdparam">rast</var>, unionarg[]  <var class="pdparam">unionargset</var><code>)</code>;</p></div><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_Union</b>(</code>setof raster <var class="pdparam">rast</var>, integer <var class="pdparam">nband</var><code>)</code>;</p></div><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_Union</b>(</code>setof raster <var class="pdparam">rast</var>, text <var class="pdparam">uniontype</var><code>)</code>;</p></div><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_Union</b>(</code>setof raster <var class="pdparam">rast</var>, integer <var class="pdparam">nband</var>, text <var class="pdparam">uniontype</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp94160456"></a><h2>説明</h2><p>ラスタタイルの集合を結合して少なくとも一つのバンドからなる単一ラスタを返します。結果ラスタの範囲は集合全体の範囲です。インタセクトする場合には、結果値は、LAST (デフォルト), FIRST, MIN, MAX, COUNT, SUM, MEAN, RANGEのいずれかとなる<code class="varname">uniontype</code>で定義されます。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ラスタを結合するには、全てが同じアラインメントを持たなくてはなりません。<a class="xref" href="#RT_ST_SameAlignment" title="ST_SameAlignment">ST_SameAlignment</a>と<a class="xref" href="#RT_ST_NotSameAlignmentReason" title="ST_NotSameAlignmentReason">ST_NotSameAlignmentReason</a>で詳細情報や助けとなる情報が得られます。アラインメント問題を修正する一つの方法として、<a class="xref" href="#RT_ST_Resample" title="ST_Resample">ST_Resample</a>を使い、アラインメントの同じ参照ラスタを使います。</p></td></tr></table></div><p>Availability: 2.0.0 </p><p>Enhanced: 2.1.0 速度が改善されました (完全にC言語で記述しました)</p><p>Availability: 2.1.0 ST_Union(rast, unionarg)の形式が導入されました。</p><p>Enhanced: 2.1.0 ST_Union(rast) (一つ目の形式)で、全ての入力ラスタの全てのバンドを結合するようになりました。以前の版のPostGISでは、一つ目のバンドと仮定していました。</p><p>Enhanced: 2.1.0 ST_Union(rast, uniontype) (四つ目の形式)で、全ての入力ラスタの全てのバンドを結合するようになりました。</p></div><div class="refsection"><a name="idp94165832"></a><h2>例: 塊になっているラスタタイルの単一バンドへの再構成</h2><pre class="programlisting">-- ファイルシステムタイルの1番バンドから新しい単一バンドを生成します
SELECT filename, ST_Union(rast,1) As file_rast
FROM sometable WHERE filename IN('dem01', 'dem02') GROUP BY filename;
                                        </pre></div><div class="refsection"><a name="idp94167112"></a><h2>例: タイルのジオメトリとインタセクトするタイルを結合した複数バンドのラスタ</h2><pre class="programlisting">-- ラインとインタセクトするタイルを結合した複数バンドラスタを生成します
-- ご注意: 2.0では、単一バンドのラスタを帰すだけです
--   これはunionargで
--   ARRAY[ROW(1, 'LAST'), ROW(2, 'LAST'), ROW(3, 'LAST')]::unionarg[]
--   を指定するのと同じです。
SELECT ST_Union(rast)
FROM aerials.boston
WHERE ST_Intersects(rast,  ST_GeomFromText('LINESTRING(230486 887771, 230500 88772)',26986) );
                                        </pre></div><div class="refsection"><a name="idp94168392"></a><h2>例: タイルのジオメトリとインタセクトするタイルを結合した複数バンドのラスタ</h2><p>バンドの部分集合が欲しいだけの場合や、バンドの並び順を変更したい場合には、より長い書き方にします。</p><pre class="programlisting">-- ラインとインタセクトするタイルを結合した複数バンドラスタを生成します
SELECT ST_Union(rast,ARRAY[ROW(2, 'LAST'), ROW(1, 'LAST'), ROW(3, 'LAST')]::unionarg[])
FROM aerials.boston
WHERE ST_Intersects(rast,  ST_GeomFromText('LINESTRING(230486 887771, 230500 88772)',26986) );
                                        </pre></div><div class="refsection"><a name="idp94170312"></a><h2>関連情報</h2><p><a class="xref" href="#unionarg" title="unionarg">unionarg</a>, <a class="xref" href="#RT_ST_Envelope" title="ST_Envelope">ST_Envelope</a>, <a class="xref" href="#RT_ST_ConvexHull" title="ST_ConvexHull">ST_ConvexHull</a>, <a class="xref" href="#RT_ST_Clip" title="ST_Clip">ST_Clip</a>, <a class="xref" href="#ST_Union" title="ST_Union">ST_Union</a> </p></div></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="Raster_Processing_MapAlgebra_Callbacks"></a>9.12.2. 組み込み地図代数コールバック関数</h3></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#RT_ST_Distinct4ma">ST_Distinct4ma</a></span><span class="refpurpose"> — 近隣のピクセル値のうち一意となるものを数えるラスタ処理関数です。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_InvDistWeight4ma">ST_InvDistWeight4ma</a></span><span class="refpurpose"> — 近隣のピクセル値の内挿補間を行うラスタ処理関数です。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Max4ma">ST_Max4ma</a></span><span class="refpurpose"> — 近隣のピクセル値の最大値を計算するラスタ処理関数です。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Mean4ma">ST_Mean4ma</a></span><span class="refpurpose"> — 近隣のピクセル値の平均値を計算するラスタ処理関数です。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Min4ma">ST_Min4ma</a></span><span class="refpurpose"> — 近隣のピクセル値の最小値を計算するラスタ処理関数です。 </span></dt><dt><span class="refentrytitle"><a href="#RT_ST_MinDist4ma">ST_MinDist4ma</a></span><span class="refpurpose"> — 対象ピクセルと値を持つ近隣ピクセルとの最短距離をピクセル単位で返すラスタ処理関数です。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Range4ma">ST_Range4ma</a></span><span class="refpurpose"> — 近隣のピクセル値の範囲を計算するラスタ処理関数です。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_StdDev4ma">ST_StdDev4ma</a></span><span class="refpurpose"> — 近隣のピクセル値の標準偏差を計算するラスタ処理関数です。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Sum4ma">ST_Sum4ma</a></span><span class="refpurpose"> — 近隣のピクセル値の合計を計算するラスタ処理関数です。</span></dt></dl></div><div class="refentry"><a name="RT_ST_Distinct4ma"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Distinct4ma — 近隣のピクセル値のうち一意となるものを数えるラスタ処理関数です。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float8 <b class="fsfunc">ST_Distinct4ma</b>(</code>float8[][] <var class="pdparam">matrix</var>, text <var class="pdparam">nodatamode</var>, text[] <var class="pdparam">VARIADIC args</var><code>)</code>;</p><p><code class="funcdef">double precision <b class="fsfunc">ST_Distinct4ma</b>(</code>double precision[][][] <var class="pdparam">value</var>, integer[][]  <var class="pdparam">pos</var>, text[] <var class="pdparam">VARIADIC userargs</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp94189256"></a><h2>説明</h2><p>近隣のピクセル値のうち一意となるものを数えます。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>一つ目の形式は、<a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a>へのコールバック引数として使用する専用コールバック関数です。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>二つ目の形式は、<a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>へのコールバック引数として使用する専用コールバック関数です。 </p></td></tr></table></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>一つ目の形式は、<a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a>が2.1.0で非推奨となったので、使用しないようになります。 </p></td></tr></table></div><p>Availability: 2.0.0</p><p>Enhanced: 2.1.0 二つ目の形式の追加</p></div><div class="refsection"><a name="idp94194632"></a><h2>例</h2><pre class="programlisting">SELECT
    rid,
    st_value(
        st_mapalgebrafctngb(rast, 1, NULL, 1, 1, 'st_distinct4ma(float[][],text,text[])'::regprocedure, 'ignore', NULL), 2, 2
    )
FROM dummy_rast
WHERE rid = 2;
 rid | st_value
-----+----------
   2 |        3
(1 row)
                                </pre></div><div class="refsection"><a name="idp94195912"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a>, <a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>, <a class="xref" href="#RT_ST_Min4ma" title="ST_Min4ma">ST_Min4ma</a>, <a class="xref" href="#RT_ST_Max4ma" title="ST_Max4ma">ST_Max4ma</a>, <a class="xref" href="#RT_ST_Sum4ma" title="ST_Sum4ma">ST_Sum4ma</a>, <a class="xref" href="#RT_ST_Mean4ma" title="ST_Mean4ma">ST_Mean4ma</a>, <a class="xref" href="#RT_ST_Distinct4ma" title="ST_Distinct4ma">ST_Distinct4ma</a>, <a class="xref" href="#RT_ST_StdDev4ma" title="ST_StdDev4ma">ST_StdDev4ma</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_InvDistWeight4ma"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_InvDistWeight4ma — 近隣のピクセル値の内挿補間を行うラスタ処理関数です。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">double precision <b class="fsfunc">ST_InvDistWeight4ma</b>(</code>double precision[][][] <var class="pdparam">value</var>, integer[][] <var class="pdparam">pos</var>, text[] <var class="pdparam">VARIADIC userargs</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp94210632"></a><h2>説明</h2><p>近隣のピクセル値の逆距離加重法 (IDW=Inverse Distance Weighted method)による内挿補間を行います。</p><p><code class="varname">userargsに</code>渡される、二つの任意引数があります。一つ目は、逆距離加重法の式に与える0から1の間を取る冪数 (下の式の変数k)です。指定しない場合には、デフォルトは1とします。二つ目は、対象ピクセルの値が近隣セルからの補間値に含まれている場合にのみ適用される重み率です。指定せず、かつ対象ピクセルが値を持っている場合には、そのピクセルの持つ値が返されます。 </p><p>基本的な逆距離加重法の方程式は次の通りです。 </p><div class="informalfigure"><div class="mediaobject"><img src="images/st_invdistweight4ma_equation.png"><div class="caption"><p>k = 冪数で、0から1の浮動小数点数を取ります。 </p></div></div></div><p>
				</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数は<a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>へのコールバック引数として使用する専用コールバック関数です。</p></td></tr></table></div><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp92586696"></a><h2>例</h2><pre class="programlisting">-- 例が必要
                                </pre></div><div class="refsection"><a name="idp92587976"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>, <a class="xref" href="#RT_ST_MinDist4ma" title="ST_MinDist4ma">ST_MinDist4ma</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Max4ma"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Max4ma — 近隣のピクセル値の最大値を計算するラスタ処理関数です。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float8 <b class="fsfunc">ST_Max4ma</b>(</code>float8[][] <var class="pdparam">matrix</var>, text <var class="pdparam">nodatamode</var>, text[] <var class="pdparam">VARIADIC args</var><code>)</code>;</p><p><code class="funcdef">double precision <b class="fsfunc">ST_Max4ma</b>(</code>double precision[][][] <var class="pdparam">value</var>, integer[][]  <var class="pdparam">pos</var>, text[] <var class="pdparam">VARIADIC userargs</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp94230728"></a><h2>説明</h2><p>近隣のピクセル値の最大値を計算します。</p><p>二つ目の形式では、userargsに渡す値でNODATAピクセルに代入する値を指定できます。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>一つ目の形式は、<a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a>へのコールバック引数として使用する専用コールバック関数です。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>二つ目の形式は、<a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>へのコールバック引数として使用する専用コールバック関数です。 </p></td></tr></table></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>一つ目の形式は、<a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a>が2.1.0で非推奨となったので、使用しないようになります。 </p></td></tr></table></div><p>Availability: 2.0.0</p><p>Enhanced: 2.1.0 二つ目の形式の追加</p></div><div class="refsection"><a name="idp94236488"></a><h2>例</h2><pre class="programlisting">SELECT
    rid,
    st_value(
        st_mapalgebrafctngb(rast, 1, NULL, 1, 1, 'st_max4ma(float[][],text,text[])'::regprocedure, 'ignore', NULL), 2, 2
    )
FROM dummy_rast
WHERE rid = 2;
 rid | st_value
-----+----------
   2 |      254
(1 row)
                                </pre></div><div class="refsection"><a name="idp94237768"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a>, <a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>, <a class="xref" href="#RT_ST_Min4ma" title="ST_Min4ma">ST_Min4ma</a>, <a class="xref" href="#RT_ST_Sum4ma" title="ST_Sum4ma">ST_Sum4ma</a>, <a class="xref" href="#RT_ST_Mean4ma" title="ST_Mean4ma">ST_Mean4ma</a>, <a class="xref" href="#RT_ST_Range4ma" title="ST_Range4ma">ST_Range4ma</a>, <a class="xref" href="#RT_ST_Distinct4ma" title="ST_Distinct4ma">ST_Distinct4ma</a>, <a class="xref" href="#RT_ST_StdDev4ma" title="ST_StdDev4ma">ST_StdDev4ma</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Mean4ma"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Mean4ma — 近隣のピクセル値の平均値を計算するラスタ処理関数です。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float8 <b class="fsfunc">ST_Mean4ma</b>(</code>float8[][] <var class="pdparam">matrix</var>, text <var class="pdparam">nodatamode</var>, text[] <var class="pdparam">VARIADIC args</var><code>)</code>;</p><p><code class="funcdef">double precision <b class="fsfunc">ST_Mean4ma</b>(</code>double precision[][][] <var class="pdparam">value</var>, integer[][]  <var class="pdparam">pos</var>, text[] <var class="pdparam">VARIADIC userargs</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp94252616"></a><h2>説明</h2><p>近隣のピクセル値の平均値を計算します。</p><p>二つ目の形式では、userargsに渡す値でNODATAピクセルに代入する値を指定できます。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>一つ目の形式は、<a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a>へのコールバック引数として使用する専用コールバック関数です。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>二つ目の形式は、<a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>へのコールバック引数として使用する専用コールバック関数です。 </p></td></tr></table></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>一つ目の形式は、<a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a>が2.1.0で非推奨となったので、使用しないようになります。 </p></td></tr></table></div><p>Availability: 2.0.0</p><p>Enhanced: 2.1.0 二つ目の形式の追加</p></div><div class="refsection"><a name="idp94258376"></a><h2>例: 一つ目の形式</h2><pre class="programlisting">SELECT
    rid,
    st_value(
        st_mapalgebrafctngb(rast, 1, '32BF', 1, 1, 'st_mean4ma(float[][],text,text[])'::regprocedure, 'ignore', NULL), 2, 2
    )
FROM dummy_rast
WHERE rid = 2;
 rid |     st_value
-----+------------------
   2 | 253.222229003906
(1 row)
                                </pre></div><div class="refsection"><a name="idp94259656"></a><h2>例: 二つ目の形式</h2><pre class="programlisting">SELECT
    rid,
    st_value(
              ST_MapAlgebra(rast, 1, 'st_mean4ma(double precision[][][], integer[][], text[])'::regprocedure,'32BF', 'FIRST', NULL, 1, 1)
       ,  2, 2)
  FROM dummy_rast
   WHERE rid = 2;
 rid |     st_value
-----+------------------
   2 | 253.222229003906
(1 row)</pre></div><div class="refsection"><a name="idp94260936"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a>, <a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>, <a class="xref" href="#RT_ST_Min4ma" title="ST_Min4ma">ST_Min4ma</a>, <a class="xref" href="#RT_ST_Max4ma" title="ST_Max4ma">ST_Max4ma</a>, <a class="xref" href="#RT_ST_Sum4ma" title="ST_Sum4ma">ST_Sum4ma</a>, <a class="xref" href="#RT_ST_Range4ma" title="ST_Range4ma">ST_Range4ma</a>, <a class="xref" href="#RT_ST_StdDev4ma" title="ST_StdDev4ma">ST_StdDev4ma</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Min4ma"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Min4ma — 近隣のピクセル値の最小値を計算するラスタ処理関数です。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float8 <b class="fsfunc">ST_Min4ma</b>(</code>float8[][] <var class="pdparam">matrix</var>, text  <var class="pdparam">nodatamode</var>, text[] <var class="pdparam">VARIADIC args</var><code>)</code>;</p><p><code class="funcdef">double precision <b class="fsfunc">ST_Min4ma</b>(</code>double precision[][][] <var class="pdparam">value</var>, integer[][]  <var class="pdparam">pos</var>, text[] <var class="pdparam">VARIADIC userargs</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp94287688"></a><h2>説明</h2><p>近隣のピクセル値の最小値を計算します。 </p><p>二つ目の形式では、userargsに渡す値でNODATAピクセルに代入する値を指定できます。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>一つ目の形式は、<a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a>へのコールバック引数として使用する専用コールバック関数です。 </p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>二つ目の形式は、<a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>へのコールバック引数として使用する専用コールバック関数です。 </p></td></tr></table></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>一つ目の形式は、<a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a>が2.1.0で非推奨となったので、使用しないようになります。 </p></td></tr></table></div><p>Availability: 2.0.0</p><p>Enhanced: 2.1.0 二つ目の形式の追加</p></div><div class="refsection"><a name="idp94293448"></a><h2>例</h2><pre class="programlisting">SELECT
    rid,
    st_value(
        st_mapalgebrafctngb(rast, 1, NULL, 1, 1, 'st_min4ma(float[][],text,text[])'::regprocedure, 'ignore', NULL), 2, 2
    )
FROM dummy_rast
WHERE rid = 2;
 rid | st_value
-----+----------
   2 |      250
(1 row)
                                </pre></div><div class="refsection"><a name="idp94294728"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a>, <a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>, <a class="xref" href="#RT_ST_Max4ma" title="ST_Max4ma">ST_Max4ma</a>, <a class="xref" href="#RT_ST_Sum4ma" title="ST_Sum4ma">ST_Sum4ma</a>, <a class="xref" href="#RT_ST_Mean4ma" title="ST_Mean4ma">ST_Mean4ma</a>, <a class="xref" href="#RT_ST_Range4ma" title="ST_Range4ma">ST_Range4ma</a>, <a class="xref" href="#RT_ST_Distinct4ma" title="ST_Distinct4ma">ST_Distinct4ma</a>, <a class="xref" href="#RT_ST_StdDev4ma" title="ST_StdDev4ma">ST_StdDev4ma</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_MinDist4ma"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MinDist4ma — 対象ピクセルと値を持つ近隣ピクセルとの最短距離をピクセル単位で返すラスタ処理関数です。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">double precision <b class="fsfunc">ST_MinDist4ma</b>(</code>double precision[][][] <var class="pdparam">value</var>, integer[][] <var class="pdparam">pos</var>, text[] <var class="pdparam">VARIADIC userargs</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp94305352"></a><h2>説明</h2><p>対象ピクセルと値を持つ近隣ピクセルとの最短距離をピクセル単位で返します。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数の意図は、<a class="xref" href="#RT_ST_InvDistWeight4ma" title="ST_InvDistWeight4ma">ST_InvDistWeight4ma</a>から対象ピクセルの内挿補間された値の有用性を判断することを補助するのに有益なデータポイントを提供することです。この関数は近隣セルの密度が小さい時に特に使えます。 </p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数は<a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>へのコールバック引数として使用する専用コールバック関数です。</p></td></tr></table></div><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp94309192"></a><h2>例</h2><pre class="programlisting">-- 例が必要
                                </pre></div><div class="refsection"><a name="idp94310472"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>, <a class="xref" href="#RT_ST_InvDistWeight4ma" title="ST_InvDistWeight4ma">ST_InvDistWeight4ma</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Range4ma"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Range4ma — 近隣のピクセル値の範囲を計算するラスタ処理関数です。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float8 <b class="fsfunc">ST_Range4ma</b>(</code>float8[][] <var class="pdparam">matrix</var>, text <var class="pdparam">nodatamode</var>, text[] <var class="pdparam">VARIADIC args</var><code>)</code>;</p><p><code class="funcdef">double precision <b class="fsfunc">ST_Range4ma</b>(</code>double precision[][][] <var class="pdparam">value</var>, integer[][]  <var class="pdparam">pos</var>, text[] <var class="pdparam">VARIADIC userargs</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp94323016"></a><h2>説明</h2><p>近隣のピクセル値の範囲を計算します。</p><p>二つ目の形式では、userargsに渡す値でNODATAピクセルに代入する値を指定できます。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>一つ目の形式は、<a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a>へのコールバック引数として使用する専用コールバック関数です。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>二つ目の形式は、<a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>へのコールバック引数として使用する専用コールバック関数です。 </p></td></tr></table></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>一つ目の形式は、<a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a>が2.1.0で非推奨となったので、使用しないようになります。 </p></td></tr></table></div><p>Availability: 2.0.0</p><p>Enhanced: 2.1.0 二つ目の形式の追加</p></div><div class="refsection"><a name="idp94328776"></a><h2>例</h2><pre class="programlisting">SELECT
    rid,
    st_value(
        st_mapalgebrafctngb(rast, 1, NULL, 1, 1, 'st_range4ma(float[][],text,text[])'::regprocedure, 'ignore', NULL), 2, 2
    )
FROM dummy_rast
WHERE rid = 2;
 rid | st_value
-----+----------
   2 |        4
(1 row)
                                </pre></div><div class="refsection"><a name="idp94330056"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a>, <a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>, <a class="xref" href="#RT_ST_Min4ma" title="ST_Min4ma">ST_Min4ma</a>, <a class="xref" href="#RT_ST_Max4ma" title="ST_Max4ma">ST_Max4ma</a>, <a class="xref" href="#RT_ST_Sum4ma" title="ST_Sum4ma">ST_Sum4ma</a>, <a class="xref" href="#RT_ST_Mean4ma" title="ST_Mean4ma">ST_Mean4ma</a>, <a class="xref" href="#RT_ST_Distinct4ma" title="ST_Distinct4ma">ST_Distinct4ma</a>, <a class="xref" href="#RT_ST_StdDev4ma" title="ST_StdDev4ma">ST_StdDev4ma</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_StdDev4ma"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_StdDev4ma — 近隣のピクセル値の標準偏差を計算するラスタ処理関数です。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float8 <b class="fsfunc">ST_StdDev4ma</b>(</code>float8[][] <var class="pdparam">matrix</var>, text  <var class="pdparam">nodatamode</var>, text[] <var class="pdparam">VARIADIC args</var><code>)</code>;</p><p><code class="funcdef">double precision <b class="fsfunc">ST_StdDev4ma</b>(</code>double precision[][][] <var class="pdparam">value</var>, integer[][]  <var class="pdparam">pos</var>, text[] <var class="pdparam">VARIADIC userargs</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp94344904"></a><h2>説明</h2><p>近隣のピクセル値の標準偏差を計算します。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>一つ目の形式は、<a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a>へのコールバック引数として使用する専用コールバック関数です。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>二つ目の形式は、<a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>へのコールバック引数として使用する専用コールバック関数です。 </p></td></tr></table></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>一つ目の形式は、<a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a>が2.1.0で非推奨となったので、使用しないようになります。 </p></td></tr></table></div><p>Availability: 2.0.0</p><p>Enhanced: 2.1.0 二つ目の形式の追加</p></div><div class="refsection"><a name="idp94350280"></a><h2>例</h2><pre class="programlisting">SELECT
    rid,
    st_value(
        st_mapalgebrafctngb(rast, 1, '32BF', 1, 1, 'st_stddev4ma(float[][],text,text[])'::regprocedure, 'ignore', NULL), 2, 2
    )
FROM dummy_rast
WHERE rid = 2;
 rid |     st_value
-----+------------------
   2 | 1.30170822143555
(1 row)
                                </pre></div><div class="refsection"><a name="idp94351560"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a>, <a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>, <a class="xref" href="#RT_ST_Min4ma" title="ST_Min4ma">ST_Min4ma</a>, <a class="xref" href="#RT_ST_Max4ma" title="ST_Max4ma">ST_Max4ma</a>, <a class="xref" href="#RT_ST_Sum4ma" title="ST_Sum4ma">ST_Sum4ma</a>, <a class="xref" href="#RT_ST_Mean4ma" title="ST_Mean4ma">ST_Mean4ma</a>, <a class="xref" href="#RT_ST_Distinct4ma" title="ST_Distinct4ma">ST_Distinct4ma</a>, <a class="xref" href="#RT_ST_StdDev4ma" title="ST_StdDev4ma">ST_StdDev4ma</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Sum4ma"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Sum4ma — 近隣のピクセル値の合計を計算するラスタ処理関数です。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">float8 <b class="fsfunc">ST_Sum4ma</b>(</code>float8[][] <var class="pdparam">matrix</var>, text <var class="pdparam">nodatamode</var>, text[] <var class="pdparam">VARIADIC args</var><code>)</code>;</p><p><code class="funcdef">double precision <b class="fsfunc">ST_Sum4ma</b>(</code>double precision[][][] <var class="pdparam">value</var>, integer[][]  <var class="pdparam">pos</var>, text[] <var class="pdparam">VARIADIC userargs</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp94390984"></a><h2>説明</h2><p>近隣のピクセル値の合計を計算します。</p><p>二つ目の形式では、userargsに渡す値でNODATAピクセルに代入する値を指定できます。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>一つ目の形式は、<a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a>へのコールバック引数として使用する専用コールバック関数です。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>二つ目の形式は、<a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>へのコールバック引数として使用する専用コールバック関数です。 </p></td></tr></table></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>一つ目の形式は、<a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a>が2.1.0で非推奨となったので、使用しないようになります。 </p></td></tr></table></div><p>Availability: 2.0.0</p><p>Enhanced: 2.1.0 二つ目の形式の追加</p></div><div class="refsection"><a name="idp94400840"></a><h2>例</h2><pre class="programlisting">SELECT
    rid,
    st_value(
        st_mapalgebrafctngb(rast, 1, '32BF', 1, 1, 'st_sum4ma(float[][],text,text[])'::regprocedure, 'ignore', NULL), 2, 2
    )
FROM dummy_rast
WHERE rid = 2;
 rid | st_value
-----+----------
   2 |     2279
(1 row)
                                </pre></div><div class="refsection"><a name="idp94402120"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a>, <a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>, <a class="xref" href="#RT_ST_Min4ma" title="ST_Min4ma">ST_Min4ma</a>, <a class="xref" href="#RT_ST_Max4ma" title="ST_Max4ma">ST_Max4ma</a>, <a class="xref" href="#RT_ST_Mean4ma" title="ST_Mean4ma">ST_Mean4ma</a>, <a class="xref" href="#RT_ST_Range4ma" title="ST_Range4ma">ST_Range4ma</a>, <a class="xref" href="#RT_ST_Distinct4ma" title="ST_Distinct4ma">ST_Distinct4ma</a>, <a class="xref" href="#RT_ST_StdDev4ma" title="ST_StdDev4ma">ST_StdDev4ma</a> </p></div></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="Raster_Processing_DEM"></a>9.12.3. DEM (標高)</h3></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#RT_ST_Aspect">ST_Aspect</a></span><span class="refpurpose"> — 標高ラスタバンドの傾斜方向 (デフォルトの単位は度)を返します。地形解析に使えます。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_HillShade">ST_HillShade</a></span><span class="refpurpose"> — 与えられた方位、高度、明度、スケールの入力を使って標高ラスタバンドの仮想照明を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Roughness">ST_Roughness</a></span><span class="refpurpose"> — DEMの「粗度」を計算したラスタを返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Slope">ST_Slope</a></span><span class="refpurpose"> — 標高ラスタバンドの傾斜角 (デフォルトでは度単位)を返します。地形解析に使えます。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_TPI">ST_TPI</a></span><span class="refpurpose"> — 地形的位置指数を計算したラスタを返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_TRI">ST_TRI</a></span><span class="refpurpose"> — 起伏指標を計算したラスタを返します。</span></dt></dl></div><div class="refentry"><a name="RT_ST_Aspect"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Aspect — 標高ラスタバンドの傾斜方向 (デフォルトの単位は度)を返します。地形解析に使えます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_Aspect</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">band=1</var>, text  <var class="pdparam">pixeltype=32BF</var>, text  <var class="pdparam">units=DEGREES</var>, boolean  <var class="pdparam">interpolate_nodata=FALSE</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Aspect</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">band</var>, raster  <var class="pdparam">customextent</var>, text  <var class="pdparam">pixeltype=32BF</var>, text  <var class="pdparam">units=DEGREES</var>, boolean  <var class="pdparam">interpolate_nodata=FALSE</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp94424264"></a><h2>説明</h2><p>標高ラスタバンドの傾斜方向 (デフォルトの単位は度)を返します。地図代数を利用して、傾斜方向方程式を隣接ピクセルに適用します。</p><p><code class="varname">units</code>は、傾斜方向の単位を示します。取りえる値はRADIANS, DEGREES (デフォルト)です。 </p><p><code class="varname">units</code>がRADIANSの時、値は0から2πラジアンの間で、北から時計回りに計ります。 </p><p><code class="varname">units</code>がDEGREESの時、値は0から360度の間で、北から時計回りに計ります。 </p><p>ピクセルの傾斜角が0の場合には、傾斜方向は-1とします。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>傾斜角、傾斜方および陰影起伏に関する詳細情報については、<a class="ulink" href="http://webhelp.esri.com/arcgisdesktop/9.3/index.cfm?TopicName=How%20Hillshade%20works" target="_top">ESRI - How hillshade works</a>および<a class="ulink" href="http://e2b.erdas.com/fieldguide/wwhelp/wwhimpl/common/html/wwhelp.htm?context=FieldGuide&amp;file=Aspect_Images.html" target="_top">ERDAS Field Guide - Aspect Images</a>を参照して下さい。 </p></td></tr></table></div><p>Availability: 2.0.0 </p><p>Enhanced: 2.1.0 ST_MapAlgebra()を使用するようにし、<code class="varname">interpolate_nodata</code>任意引数を追加しました。</p><p>Changed: 2.1.0 以前の版では、返り値はラジアン単位でした。現在は、デフォルトでは度で返します。</p></div><div class="refsection"><a name="idp94431304"></a><h2>例: 一つ目の形式</h2><pre class="programlisting">WITH foo AS (
        SELECT ST_SetValues(
                ST_AddBand(ST_MakeEmptyRaster(5, 5, 0, 0, 1, -1, 0, 0, 0), 1, '32BF', 0, -9999),
                1, 1, 1, ARRAY[
                        [1, 1, 1, 1, 1],
                        [1, 2, 2, 2, 1],
                        [1, 2, 3, 2, 1],
                        [1, 2, 2, 2, 1],
                        [1, 1, 1, 1, 1]
                ]::double precision[][]
        ) AS rast
)
SELECT
        ST_DumpValues(ST_Aspect(rast, 1, '32BF'))
FROM foo

                                                                                                    st_dumpvalues

------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
----------------------------------
 (1,"{{315,341.565063476562,0,18.4349479675293,45},{288.434936523438,315,0,45,71.5650482177734},{270,270,-1,90,90},{251.565048217773,225,180,135,108.434951782227},{225,198.43495178
2227,180,161.565048217773,135}}")
(1 row)
                                        </pre></div><div class="refsection"><a name="idp94432584"></a><h2>例: 二つ目の形式</h2><p>カバレッジのタイルの完全な例です。このクエリはPostgreSQL 9.1以上でのみ動作します。</p><pre class="programlisting">WITH foo AS (
        SELECT ST_Tile(
                ST_SetValues(
                        ST_AddBand(
                                ST_MakeEmptyRaster(6, 6, 0, 0, 1, -1, 0, 0, 0),
                                1, '32BF', 0, -9999
                        ),
                        1, 1, 1, ARRAY[
                                [1, 1, 1, 1, 1, 1],
                                [1, 1, 1, 1, 2, 1],
                                [1, 2, 2, 3, 3, 1],
                                [1, 1, 3, 2, 1, 1],
                                [1, 2, 2, 1, 2, 1],
                                [1, 1, 1, 1, 1, 1]
                        ]::double precision[]
                ),
                2, 2
        ) AS rast
)
SELECT
        t1.rast,
        ST_Aspect(ST_Union(t2.rast), 1, t1.rast)
FROM foo t1
CROSS JOIN foo t2
WHERE ST_Intersects(t1.rast, t2.rast)
GROUP BY t1.rast;
                                        </pre></div><div class="refsection"><a name="idp94434376"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>, <a class="xref" href="#RT_ST_TRI" title="ST_TRI">ST_TRI</a>, <a class="xref" href="#RT_ST_TPI" title="ST_TPI">ST_TPI</a>, <a class="xref" href="#RT_ST_Roughness" title="ST_Roughness">ST_Roughness</a>, <a class="xref" href="#RT_ST_HillShade" title="ST_HillShade">ST_HillShade</a>, <a class="xref" href="#RT_ST_Slope" title="ST_Slope">ST_Slope</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_HillShade"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_HillShade — 与えられた方位、高度、明度、スケールの入力を使って標高ラスタバンドの仮想照明を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_HillShade</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">band=1</var>, text  <var class="pdparam">pixeltype=32BF</var>, double precision  <var class="pdparam">azimuth=315</var>, double precision  <var class="pdparam">altitude=45</var>, double precision  <var class="pdparam">max_bright=255</var>, double precision  <var class="pdparam">scale=1.0</var>, boolean  <var class="pdparam">interpolate_nodata=FALSE</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_HillShade</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">band</var>, raster  <var class="pdparam">customextent</var>, text  <var class="pdparam">pixeltype=32BF</var>, double precision  <var class="pdparam">azimuth=315</var>, double precision  <var class="pdparam">altitude=45</var>, double precision  <var class="pdparam">max_bright=255</var>, double precision  <var class="pdparam">scale=1.0</var>, boolean  <var class="pdparam">interpolate_nodata=FALSE</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp94469576"></a><h2>説明</h2><p>与えられた方位、高度、明度、スケールの入力を使って標高ラスタバンドの仮想照明を返します。地図代数を使って、陰影図方程式を隣接ピクセルに適用します。返されるピクセル値は0と255の間です。</p><p><code class="varname">azimuth</code>は0から360度の間の値で、北から時計回りに計ります。 </p><p><code class="varname">altitude</code>は0から90度の間で、0が水平、90が鉛直上向きです。 </p><p><code class="varname">max_bright</code>は0から255までの間で、0は明度なしで、255が最大明度です。 </p><p><code class="varname">scale</code>は鉛直単位と水平単位との比です。フィート:経度緯度ではscale=370400となり、メートル:経度緯度ではscale=111120となります。 </p><p><code class="varname">interpolate_nodata</code>がTRUEの場合には、入力ラスタのNODATAピクセルの値は陰影図を計算する前に<a class="xref" href="#RT_ST_InvDistWeight4ma" title="ST_InvDistWeight4ma">ST_InvDistWeight4ma</a>を使って内挿を行います。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>陰影図に関する詳細情報については <a class="ulink" href="http://webhelp.esri.com/arcgisdesktop/9.3/index.cfm?TopicName=How%20Hillshade%20works" target="_top">How hillshade works</a>をご覧下さい。 </p></td></tr></table></div><p>Availability: 2.0.0 </p><p>Enhanced: 2.1.0 ST_MapAlgebra()を使用するようにし、<code class="varname">interpolate_nodata</code>任意引数を追加しました。</p><p>Changed: 2.1.0 以前の版ではazimuthとaltitudeはラジアン単位で表現しました。現在はazimuthとaltitudeは度単位で表現します。</p></div><div class="refsection"><a name="idp94477256"></a><h2>例: 一つ目の形式</h2><pre class="programlisting">WITH foo AS (
        SELECT ST_SetValues(
                ST_AddBand(ST_MakeEmptyRaster(5, 5, 0, 0, 1, -1, 0, 0, 0), 1, '32BF', 0, -9999),
                1, 1, 1, ARRAY[
                        [1, 1, 1, 1, 1],
                        [1, 2, 2, 2, 1],
                        [1, 2, 3, 2, 1],
                        [1, 2, 2, 2, 1],
                        [1, 1, 1, 1, 1]
                ]::double precision[][]
        ) AS rast
)
SELECT
        ST_DumpValues(ST_Hillshade(rast, 1, '32BF'))
FROM foo

                                                                                                                       st_dumpvalues

------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-----------------------------------------------------------------------
 (1,"{{NULL,NULL,NULL,NULL,NULL},{NULL,251.32763671875,220.749786376953,147.224319458008,NULL},{NULL,220.749786376953,180.312225341797,67.7497863769531,NULL},{NULL,147.224319458008
,67.7497863769531,43.1210060119629,NULL},{NULL,NULL,NULL,NULL,NULL}}")
(1 row)
                                        </pre></div><div class="refsection"><a name="idp94478536"></a><h2>例: 二つ目の形式</h2><p>カバレッジのタイルの完全な例です。このクエリはPostgreSQL 9.1以上でのみ動作します。</p><pre class="programlisting">WITH foo AS (
        SELECT ST_Tile(
                ST_SetValues(
                        ST_AddBand(
                                ST_MakeEmptyRaster(6, 6, 0, 0, 1, -1, 0, 0, 0),
                                1, '32BF', 0, -9999
                        ),
                        1, 1, 1, ARRAY[
                                [1, 1, 1, 1, 1, 1],
                                [1, 1, 1, 1, 2, 1],
                                [1, 2, 2, 3, 3, 1],
                                [1, 1, 3, 2, 1, 1],
                                [1, 2, 2, 1, 2, 1],
                                [1, 1, 1, 1, 1, 1]
                        ]::double precision[]
                ),
                2, 2
        ) AS rast
)
SELECT
        t1.rast,
        ST_Hillshade(ST_Union(t2.rast), 1, t1.rast)
FROM foo t1
CROSS JOIN foo t2
WHERE ST_Intersects(t1.rast, t2.rast)
GROUP BY t1.rast;
                                        </pre></div><div class="refsection"><a name="idp94480328"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>, <a class="xref" href="#RT_ST_TRI" title="ST_TRI">ST_TRI</a>, <a class="xref" href="#RT_ST_TPI" title="ST_TPI">ST_TPI</a>, <a class="xref" href="#RT_ST_Roughness" title="ST_Roughness">ST_Roughness</a>, <a class="xref" href="#RT_ST_Aspect" title="ST_Aspect">ST_Aspect</a>, <a class="xref" href="#RT_ST_Slope" title="ST_Slope">ST_Slope</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Roughness"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Roughness — DEMの「粗度」を計算したラスタを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_Roughness</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, raster  <var class="pdparam">customextent</var>, text  <var class="pdparam">pixeltype="32BF"</var> , boolean  <var class="pdparam"> interpolate_nodata=FALSE </var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp94505160"></a><h2>説明</h2><p>指定された領域の最大値から最小値を減じることでDEMの「粗度」を計算したラスタを返します。</p><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp94506696"></a><h2>例</h2><pre class="programlisting">-- 例が必要
                                        </pre></div><div class="refsection"><a name="idp94508104"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>, <a class="xref" href="#RT_ST_TRI" title="ST_TRI">ST_TRI</a>, <a class="xref" href="#RT_ST_TPI" title="ST_TPI">ST_TPI</a>, <a class="xref" href="#RT_ST_Slope" title="ST_Slope">ST_Slope</a>, <a class="xref" href="#RT_ST_HillShade" title="ST_HillShade">ST_HillShade</a>, <a class="xref" href="#RT_ST_Aspect" title="ST_Aspect">ST_Aspect</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Slope"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Slope — 標高ラスタバンドの傾斜角 (デフォルトでは度単位)を返します。地形解析に使えます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_Slope</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband=1</var>, text  <var class="pdparam">pixeltype=32BF</var>, text  <var class="pdparam">units=DEGREES</var>, double precision  <var class="pdparam">scale=1.0</var>, boolean  <var class="pdparam">interpolate_nodata=FALSE</var><code>)</code>;</p><p><code class="funcdef">raster <b class="fsfunc">ST_Slope</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, raster  <var class="pdparam">customextent</var>, text  <var class="pdparam">pixeltype=32BF</var>, text  <var class="pdparam">units=DEGREES</var>, double precision  <var class="pdparam">scale=1.0</var>, boolean  <var class="pdparam">interpolate_nodata=FALSE</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp94534728"></a><h2>説明</h2><p>標高ラスタバンドの傾斜角 (デフォルトでは度単位)を返します。地図代数を使って、傾斜角方程式を隣接ピクセルに適用します。</p><p><code class="varname">units</code>は傾斜角の単位を示します。取りえる値はRADIANS, DEGREES (デフォルト), PERCENTです。 </p><p><code class="varname">scale</code>は鉛直単位と水平単位との比です。フィート:経度緯度ではscale=370400となり、メートル:経度緯度ではscale=111120となります。 </p><p><code class="varname">interpolate_nodata</code>がTRUEの場合には、入力ラスタのNODATAピクセルの値は表面傾斜角を計算する前に<a class="xref" href="#RT_ST_InvDistWeight4ma" title="ST_InvDistWeight4ma">ST_InvDistWeight4ma</a>を使って内挿を行います。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>傾斜角、傾斜方および陰影起伏に関する詳細情報については、<a class="ulink" href="http://webhelp.esri.com/arcgisdesktop/9.3/index.cfm?TopicName=How%20Hillshade%20works" target="_top">ESRI - How hillshade works</a>および<a class="ulink" href="http://e2b.erdas.com/fieldguide/wwhelp/wwhimpl/common/html/wwhelp.htm?context=FieldGuide&amp;file=Slope_Images.html" target="_top">ERDAS Field Guide - Slope Images</a>を参照して下さい。 </p></td></tr></table></div><p>Availability: 2.0.0 </p><p>Enhanced: 2.1.0 ST_MapAlgebra()を使用するようにし、<code class="varname">units</code>, <code class="varname">scale</code>, <code class="varname">interpolate_nodata</code>任意引数を追加しました。</p><p>Changed: 2.1.0 以前の版では、返り値はラジアン単位でした。現在は、デフォルトでは度で返します。</p></div><div class="refsection"><a name="idp94542408"></a><h2>例: 一つ目の形式</h2><pre class="programlisting">WITH foo AS (
        SELECT ST_SetValues(
                ST_AddBand(ST_MakeEmptyRaster(5, 5, 0, 0, 1, -1, 0, 0, 0), 1, '32BF', 0, -9999),
                1, 1, 1, ARRAY[
                        [1, 1, 1, 1, 1],
                        [1, 2, 2, 2, 1],
                        [1, 2, 3, 2, 1],
                        [1, 2, 2, 2, 1],
                        [1, 1, 1, 1, 1]
                ]::double precision[][]
        ) AS rast
)
SELECT
        ST_DumpValues(ST_Slope(rast, 1, '32BF'))
FROM foo

                            st_dumpvalues

------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------
 (1,"{{10.0249881744385,21.5681285858154,26.5650520324707,21.5681285858154,10.0249881744385},{21.5681285858154,35.2643890380859,36.8698959350586,35.2643890380859,21.5681285858154},
{26.5650520324707,36.8698959350586,0,36.8698959350586,26.5650520324707},{21.5681285858154,35.2643890380859,36.8698959350586,35.2643890380859,21.5681285858154},{10.0249881744385,21.
5681285858154,26.5650520324707,21.5681285858154,10.0249881744385}}")
(1 row)
                                        </pre></div><div class="refsection"><a name="idp94543688"></a><h2>例: 二つ目の形式</h2><p>カバレッジのタイルの完全な例です。このクエリはPostgreSQL 9.1以上でのみ動作します。</p><pre class="programlisting">WITH foo AS (
        SELECT ST_Tile(
                ST_SetValues(
                        ST_AddBand(
                                ST_MakeEmptyRaster(6, 6, 0, 0, 1, -1, 0, 0, 0),
                                1, '32BF', 0, -9999
                        ),
                        1, 1, 1, ARRAY[
                                [1, 1, 1, 1, 1, 1],
                                [1, 1, 1, 1, 2, 1],
                                [1, 2, 2, 3, 3, 1],
                                [1, 1, 3, 2, 1, 1],
                                [1, 2, 2, 1, 2, 1],
                                [1, 1, 1, 1, 1, 1]
                        ]::double precision[]
                ),
                2, 2
        ) AS rast
)
SELECT
        t1.rast,
        ST_Slope(ST_Union(t2.rast), 1, t1.rast)
FROM foo t1
CROSS JOIN foo t2
WHERE ST_Intersects(t1.rast, t2.rast)
GROUP BY t1.rast;
                                        </pre></div><div class="refsection"><a name="idp94545480"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>, <a class="xref" href="#RT_ST_TRI" title="ST_TRI">ST_TRI</a>, <a class="xref" href="#RT_ST_TPI" title="ST_TPI">ST_TPI</a>, <a class="xref" href="#RT_ST_Roughness" title="ST_Roughness">ST_Roughness</a>, <a class="xref" href="#RT_ST_HillShade" title="ST_HillShade">ST_HillShade</a>, <a class="xref" href="#RT_ST_Aspect" title="ST_Aspect">ST_Aspect</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_TPI"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_TPI — 地形的位置指数を計算したラスタを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_TPI</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, raster  <var class="pdparam">customextent</var>, text  <var class="pdparam">pixeltype="32BF"</var> , boolean  <var class="pdparam"> interpolate_nodata=FALSE </var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp94557896"></a><h2>説明</h2><p>地形的位置指数 (TPI=Topographic Position Index)を計算します。地形的位置指数は、半径1における近傍平均値から中心セルの値を引いたものです。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数は、近傍平均値半径が1についてのみ対応しています。</p></td></tr></table></div><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp94560200"></a><h2>例</h2><pre class="programlisting">-- 例が必要
                                        </pre></div><div class="refsection"><a name="idp94561608"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>, <a class="xref" href="#RT_ST_TRI" title="ST_TRI">ST_TRI</a>, <a class="xref" href="#RT_ST_Roughness" title="ST_Roughness">ST_Roughness</a>, <a class="xref" href="#RT_ST_Slope" title="ST_Slope">ST_Slope</a>, <a class="xref" href="#RT_ST_HillShade" title="ST_HillShade">ST_HillShade</a>, <a class="xref" href="#RT_ST_Aspect" title="ST_Aspect">ST_Aspect</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_TRI"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_TRI — 起伏指標を計算したラスタを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">raster <b class="fsfunc">ST_TRI</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband</var>, raster  <var class="pdparam">customextent</var>, text  <var class="pdparam">pixeltype="32BF"</var> , boolean  <var class="pdparam"> interpolate_nodata=FALSE </var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp94574024"></a><h2>説明</h2><p>起伏指標 (TRI=Terrain Ruggedness Index)は、中心ピクセルと隣接ピクセルを、差の絶対値の平均を取って比較することで計算されます。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数は、近傍平均値半径が1についてのみ対応しています。</p></td></tr></table></div><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp94576328"></a><h2>例</h2><pre class="programlisting">-- 例が必要
                                        </pre></div><div class="refsection"><a name="idp94577736"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a>, <a class="xref" href="#RT_ST_Roughness" title="ST_Roughness">ST_Roughness</a>, <a class="xref" href="#RT_ST_TPI" title="ST_TPI">ST_TPI</a>, <a class="xref" href="#RT_ST_Slope" title="ST_Slope">ST_Slope</a>, <a class="xref" href="#RT_ST_HillShade" title="ST_HillShade">ST_HillShade</a>, <a class="xref" href="#RT_ST_Aspect" title="ST_Aspect">ST_Aspect</a> </p></div></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="Raster_Processing_Geometry"></a>9.12.4. ラスタからジオメトリ</h3></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#RT_Box3D">Box3D</a></span><span class="refpurpose"> — ラスタを囲むボックスのbox3d表現を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_ConvexHull">ST_ConvexHull</a></span><span class="refpurpose"> — BandNoDataValueと等しいピクセル値を含むラスタの凸包ジオメトリを返します。一般的な形状でスキューのないラスタでは、ST_Envelopeと同じ結果になります。不規則な形状をしているか回転しているラスタでのみ使います。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_DumpAsPolygons">ST_DumpAsPolygons</a></span><span class="refpurpose"> — 指定されたラスタバンドからgeomval (geom,val)行の集合を返します。バンドを指定しない場合のデフォルトは1です。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Envelope">ST_Envelope</a></span><span class="refpurpose"> — ラスタの範囲のポリゴン表現を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_MinConvexHull">ST_MinConvexHull</a></span><span class="refpurpose"> — NODATA値を除いたラスタの凸包ジオメトリを返します。 </span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Polygon">ST_Polygon</a></span><span class="refpurpose"> — NODATA値でないピクセル値を持つピクセルの結合で形成されるマルチポリゴンジオメトリを返します。バンドを指定しない場合のデフォルトは1です。</span></dt></dl></div><div class="refentry"><a name="RT_Box3D"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Box3D — ラスタを囲むボックスのbox3d表現を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">box3d <b class="fsfunc">Box3D</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp94586696"></a><h2>説明</h2><p>ラスタの範囲を表現するボックスを返します。</p><p>ポリゴンは、バウンディングボックス ((<code class="varname">MINX</code>, <code class="varname">MINY</code>), (<code class="varname">MAXX</code>, <code class="varname">MAXY</code>))の4隅のポイントにより定義されます。 </p><p>Changed: 2.0.0 以前の版では、box3dでなくbox2dを使っていました。box2dは非推奨型となり、box3dに変更しました。</p></div><div class="refsection"><a name="idp94590152"></a><h2>例</h2><pre class="programlisting">SELECT
        rid,
        Box3D(rast) AS rastbox
FROM dummy_rast;

rid |        rastbox
----+-------------------------------------------------
1   | BOX3D(0.5 0.5 0,20.5 60.5 0)
2   | BOX3D(3427927.75 5793243.5 0,3427928 5793244 0)
                                        </pre></div><div class="refsection"><a name="idp94591432"></a><h2>関連情報</h2><p>
						<a class="xref" href="#RT_ST_Envelope" title="ST_Envelope">ST_Envelope</a>
					</p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_ConvexHull"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ConvexHull — BandNoDataValueと等しいピクセル値を含むラスタの凸包ジオメトリを返します。一般的な形状でスキューのないラスタでは、ST_Envelopeと同じ結果になります。不規則な形状をしているか回転しているラスタでのみ使います。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_ConvexHull</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp94597448"></a><h2>説明</h2><p>NoDataValue値のピクセルを含むラスタの凸包ジオメトリを返します。一般的な形状でスキューのないラスタでは、ST_Envelopeと同じ結果になります。不規則な形状をしているかスキューのあるラスタでのみ使います。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_Envelopeは、座標値の小数部を切り捨て、ラスタのまわりに小さなバッファを追加します。小数部の切り捨てを行わないST_ConvexHullの答と若干異なります。</p></td></tr></table></div></div><div class="refsection"><a name="idp94599240"></a><h2>例</h2><p>これの図については<a class="ulink" href="http://trac.osgeo.org/postgis/wiki/WKTRaster/SpecificationWorking01" target="_top">PostGIS Raster Specification</a>を参照して下さい。</p><pre class="programlisting">-- ST_EnvelopeとST_ConvexHullはだいたい同じです
SELECT ST_AsText(ST_ConvexHull(rast)) As convhull,
        ST_AsText(ST_Envelope(rast)) As env
FROM dummy_rast WHERE rid=1;

                        convhull                        |                env
--------------------------------------------------------+------------------------------------
 POLYGON((0.5 0.5,20.5 0.5,20.5 60.5,0.5 60.5,0.5 0.5)) | POLYGON((0 0,20 0,20 60,0 60,0 0))
                                </pre><pre class="programlisting">-- ラスタをスキューします
-- 凸包とエンベロープがどのくらい異なるかをみます
SELECT ST_AsText(ST_ConvexHull(rast)) As convhull,
        ST_AsText(ST_Envelope(rast)) As env
FROM (SELECT ST_SetRotation(rast, 0.1, 0.1) As rast
        FROM dummy_rast WHERE rid=1) As foo;

                        convhull                        |                env
--------------------------------------------------------+------------------------------------
 POLYGON((0.5 0.5,20.5 1.5,22.5 61.5,2.5 60.5,0.5 0.5)) | POLYGON((0 0,22 0,22 61,0 61,0 0))
                                        </pre></div><div class="refsection"><a name="idp94602184"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Envelope" title="ST_Envelope">ST_Envelope</a>, <a class="xref" href="#RT_ST_MinConvexHull" title="ST_MinConvexHull">ST_MinConvexHull</a>, <a class="xref" href="#ST_ConvexHull" title="ST_ConvexHull">ST_ConvexHull</a>, <a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_DumpAsPolygons"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_DumpAsPolygons — 指定されたラスタバンドからgeomval (geom,val)行の集合を返します。バンドを指定しない場合のデフォルトは1です。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">setof geomval <b class="fsfunc">ST_DumpAsPolygons</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">band_num=1</var>, boolean  <var class="pdparam">exclude_nodata_value=TRUE</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp94623816"></a><h2>説明</h2><p>集合を返す関数 (SRF=set-returning function)です。geomval行の集合を返します。geomvalはジオメトリ (geom)とピクセルバンド値 (val)からなります。それぞれのポリゴンは、指定したバンドの、valで示される値と同じピクセル値を持っている全てのピクセルの結合です。</p><p>ST_DumpAsPolygonはラスタのポリゴン化に使えます。新しい行を生成するのでGROUP BYの逆です。たとえば、単一ラスタを複数のPOLYGON/MULTIPOLYGONに展開できます。</p><p>Availability: GDAL 1.7以上が必要です。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>バンドにNODATA値が設定されている場合には、exclude_nodata_value=falseが設定されている場合を除いて、NODATA値を持つピクセルは返りません。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ラスタ内の与えられた値を持つピクセルの数にのみ注意する場合には<a class="xref" href="#RT_ST_ValueCount" title="ST_ValueCount">ST_ValueCount</a>を使う方が速いです。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これは、ピクセル値にかかわらずピクセルごとに一つのジオメトリを返すST_PixelAsPolygonsと違います。 </p></td></tr></table></div></div><div class="refsection"><a name="idp94627912"></a><h2>例</h2><pre class="programlisting">-- PostgreSQL 9.3以上では、次のような文法になります
SELECT val, ST_AsText(geom) As geomwkt
FROM (
SELECT dp.*
FROM dummy_rast, LATERAL ST_DumpAsPolygons(rast) AS dp
WHERE rid = 2
) As foo
WHERE val BETWEEN 249 and 251
ORDER BY val;

 val |                                                       geomwkt
-----+--------------------------------------------------------------------------
 249 | POLYGON((3427927.95 5793243.95,3427927.95 5793243.85,3427928 5793243.85,
                3427928 5793243.95,3427927.95 5793243.95))
 250 | POLYGON((3427927.75 5793243.9,3427927.75 5793243.85,3427927.8 5793243.85,
                3427927.8 5793243.9,3427927.75 5793243.9))
 250 | POLYGON((3427927.8 5793243.8,3427927.8 5793243.75,3427927.85 5793243.75,
                3427927.85 5793243.8, 3427927.8 5793243.8))
 251 | POLYGON((3427927.75 5793243.85,3427927.75 5793243.8,3427927.8 5793243.8,
                3427927.8 5793243.85,3427927.75 5793243.85))
                                        </pre></div><div class="refsection"><a name="idp94629192"></a><h2>関連情報</h2><p><a class="xref" href="#geomval" title="geomval">geomval</a>, <a class="xref" href="#RT_ST_Value" title="ST_Value">ST_Value</a>, <a class="xref" href="#RT_ST_Polygon" title="ST_Polygon">ST_Polygon</a>, <a class="xref" href="#RT_ST_ValueCount" title="ST_ValueCount">ST_ValueCount</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Envelope"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Envelope — ラスタの範囲のポリゴン表現を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Envelope</b>(</code>raster  <var class="pdparam">rast</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp94656712"></a><h2>説明</h2><p>SRIDで定義されている空間参照系上でのラスタの範囲のポリゴン表現を返します。ポリゴンで表現されるfloat8の最小バウンディングボックスです。 </p><p>ポリゴンはバウンディングボックスの隅のポイント、すなわち ((<code class="varname">MINX</code>, <code class="varname">MINY</code>), (<code class="varname">MINX</code>, <code class="varname">MAXY</code>), (<code class="varname">MAXX</code>, <code class="varname">MAXY</code>), (<code class="varname">MAXX</code>, <code class="varname">MINY</code>), (<code class="varname">MINX</code>, <code class="varname">MINY</code>))です。 </p></div><div class="refsection"><a name="idp94662088"></a><h2>例</h2><pre class="programlisting">SELECT rid, ST_AsText(ST_Envelope(rast)) As envgeomwkt
FROM dummy_rast;

 rid |                                         envgeomwkt
-----+--------------------------------------------------------------------
   1 | POLYGON((0 0,20 0,20 60,0 60,0 0))
   2 | POLYGON((3427927 5793243,3427928 5793243,
                3427928 5793244,3427927 5793244, 3427927 5793243))
                                        </pre></div><div class="refsection"><a name="idp94663368"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Envelope" title="ST_Envelope">ST_Envelope</a>, <a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a>, <a class="xref" href="#RT_ST_SRID" title="ST_SRID">ST_SRID</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_MinConvexHull"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MinConvexHull — NODATA値を除いたラスタの凸包ジオメトリを返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_MinConvexHull</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">nband=NULL</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp94671176"></a><h2>説明</h2><p>NODATA値を除いたラスタの凸包ジオメトリを返します。<code class="varname">nband</code>がNULLの場合には、ラスタの全てのバンドが考慮されます。 </p><p>Availability: 2.1.0 </p></div><div class="refsection"><a name="idp94673096"></a><h2>例</h2><pre class="programlisting">WITH foo AS (
        SELECT
                ST_SetValues(
                        ST_SetValues(
                                ST_AddBand(ST_AddBand(ST_MakeEmptyRaster(9, 9, 0, 0, 1, -1, 0, 0, 0), 1, '8BUI', 0, 0), 2, '8BUI', 1, 0),
                                1, 1, 1,
                                ARRAY[
                                        [0, 0, 0, 0, 0, 0, 0, 0, 0],
                                        [0, 0, 0, 0, 0, 0, 0, 0, 0],
                                        [0, 0, 0, 0, 0, 0, 0, 0, 0],
                                        [0, 0, 0, 1, 0, 0, 0, 0, 1],
                                        [0, 0, 0, 1, 1, 0, 0, 0, 0],
                                        [0, 0, 0, 1, 0, 0, 0, 0, 0],
                                        [0, 0, 0, 0, 0, 0, 0, 0, 0],
                                        [0, 0, 0, 0, 0, 0, 0, 0, 0],
                                        [0, 0, 0, 0, 0, 0, 0, 0, 0]
                                ]::double precision[][]
                        ),
                        2, 1, 1,
                        ARRAY[
                                [0, 0, 0, 0, 0, 0, 0, 0, 0],
                                [0, 0, 0, 0, 0, 0, 0, 0, 0],
                                [0, 0, 0, 0, 0, 0, 0, 0, 0],
                                [1, 0, 0, 0, 0, 1, 0, 0, 0],
                                [0, 0, 0, 0, 1, 1, 0, 0, 0],
                                [0, 0, 0, 0, 0, 1, 0, 0, 0],
                                [0, 0, 0, 0, 0, 0, 0, 0, 0],
                                [0, 0, 0, 0, 0, 0, 0, 0, 0],
                                [0, 0, 1, 0, 0, 0, 0, 0, 0]
                        ]::double precision[][]
                ) AS rast
)
SELECT
        ST_AsText(ST_ConvexHull(rast)) AS hull,
        ST_AsText(ST_MinConvexHull(rast)) AS mhull,
        ST_AsText(ST_MinConvexHull(rast, 1)) AS mhull_1,
        ST_AsText(ST_MinConvexHull(rast, 2)) AS mhull_2
FROM foo

               hull               |                mhull                |               mhull_1               |               mhull_2
----------------------------------+-------------------------------------+-------------------------------------+-------------------------------------
 POLYGON((0 0,9 0,9 -9,0 -9,0 0)) | POLYGON((0 -3,9 -3,9 -9,0 -9,0 -3)) | POLYGON((3 -3,9 -3,9 -6,3 -6,3 -3)) | POLYGON((0 -3,6 -3,6 -9,0 -9,0 -3))
                                        </pre></div><div class="refsection"><a name="idp94674376"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Envelope" title="ST_Envelope">ST_Envelope</a>, <a class="xref" href="#RT_ST_ConvexHull" title="ST_ConvexHull">ST_ConvexHull</a>, <a class="xref" href="#ST_ConvexHull" title="ST_ConvexHull">ST_ConvexHull</a>, <a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Polygon"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Polygon — NODATA値でないピクセル値を持つピクセルの結合で形成されるマルチポリゴンジオメトリを返します。バンドを指定しない場合のデフォルトは1です。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Polygon</b>(</code>raster  <var class="pdparam">rast</var>, integer  <var class="pdparam">band_num=1</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp94682568"></a><h2>説明</h2><p>Availability: 0.1.6 GDAL 1.7以上が必要です。</p><p>Enhanced: 2.1.0 速度を改善し (完全にC言語で記述しました)、確実に妥当なマルチポリゴンを返すようにしました。</p><p>Changed: 2.1.0 以前の版では、時々ポリゴンを返しましたが、常にマルチポリゴンを返すように変更しました。</p></div><div class="refsection"><a name="idp94684488"></a><h2>例</h2><pre class="programlisting">-- デフォルトではNODATA値は0になるか設定されていないので
--  ST_Polygon()は四角形のポリゴンを返します
SELECT ST_AsText(ST_Polygon(rast)) As geomwkt
FROM dummy_rast
WHERE rid = 2;

geomwkt
--------------------------------------------
MULTIPOLYGON(((3427927.75 5793244,3427928 5793244,3427928 5793243.75,3427927.75 5793243.75,3427927.75 5793244)))


-- 1番目のバンドのNODATA値を変更します
UPDATE dummy_rast SET rast = ST_SetBandNoDataValue(rast,1,254)
WHERE rid = 2;
SELECt rid, ST_BandNoDataValue(rast)
from dummy_rast where rid = 2;

-- ST_Polygonはピクセル値254を除外してマルチポリゴンを返します

SELECT ST_AsText(ST_Polygon(rast)) As geomwkt
FROM dummy_rast
WHERE rid = 2;

geomwkt
---------------------------------------------------------
MULTIPOLYGON(((3427927.9 5793243.95,3427927.85 5793243.95,3427927.85 5793244,3427927.9 5793244,3427927.9 5793243.95)),((3427928 5793243.85,3427928 5793243.8,3427927.95 5793243.8,3427927.95 5793243.85,3427927.9 5793243.85,3427927.9 5793243.9,3427927.9 5793243.95,3427927.95 5793243.95,3427928 5793243.95,3427928 5793243.85)),((3427927.8 5793243.75,3427927.75 5793243.75,3427927.75 5793243.8,3427927.75 5793243.85,3427927.75 5793243.9,3427927.75 5793244,3427927.8 5793244,3427927.8 5793243.9,3427927.8 5793243.85,3427927.85 5793243.85,3427927.85 5793243.8,3427927.85 5793243.75,3427927.8 5793243.75)))

-- 異なるNODATA値が1回だけ欲しい場合には、次のようにします

SELECT ST_AsText(
        ST_Polygon(
                ST_SetBandNoDataValue(rast,1,252)
                )
        ) As geomwkt
FROM dummy_rast
WHERE rid =2;

geomwkt
---------------------------------
MULTIPOLYGON(((3427928 5793243.85,3427928 5793243.8,3427928 5793243.75,3427927.85 5793243.75,3427927.8 5793243.75,3427927.8 5793243.8,3427927.75 5793243.8,3427927.75 5793243.85,3427927.75 5793243.9,3427927.75 5793244,3427927.8 5793244,3427927.85 5793244,3427927.9 5793244,3427928 5793244,3427928 5793243.95,3427928 5793243.85),(3427927.9 5793243.9,3427927.9 5793243.85,3427927.95 5793243.85,3427927.95 5793243.9,3427927.9 5793243.9)))
                                        </pre></div><div class="refsection"><a name="idp94685768"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Value" title="ST_Value">ST_Value</a>, <a class="xref" href="#RT_ST_DumpAsPolygons" title="ST_DumpAsPolygons">ST_DumpAsPolygons</a> </p></div></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="RT_Operators"></a>9.13. ラスタ演算子</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#RT_Raster_Intersect">&amp;&amp;</a></span><span class="refpurpose"> — AのバウンディングボックスがBのバウンディングボックスとインタセクトする場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_Raster_OverLeft">&amp;&lt;</a></span><span class="refpurpose"> — AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの左にある場合に<code class="varname">TRUE</code>を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_Raster_OverRight">&amp;&gt;</a></span><span class="refpurpose"> — AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの右にある場合に <code class="varname">TRUE</code> を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_Raster_EQ">=</a></span><span class="refpurpose"> — AのバウンディングボックスがBのバウンディングボックスと同じ場合に<code class="varname">TRUE</code>を返します。倍精度浮動小数点数のバウンディングボックスを使います。</span></dt><dt><span class="refentrytitle"><a href="#RT_Raster_Contained">@</a></span><span class="refpurpose"> — AのバウンディングボックスがBのバウンディングボックスに含まれる場合に<code class="varname">TRUE</code>を返します。倍精度浮動小数点数のバウンディングボックスを使います。</span></dt><dt><span class="refentrytitle"><a href="#RT_Raster_Same">~=</a></span><span class="refpurpose"> — AのバウンディングボックスがBのバウンディングボックスと同じ場合にTRUEを返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_Raster_Contains">~</a></span><span class="refpurpose"> — AのバウンディングボックスがBのバウンディングボックスを含む場合に<code class="varname">TRUE</code>を返します。倍精度浮動小数点数のバウンディングボックスを使います。</span></dt></dl></div><div class="refentry"><a name="RT_Raster_Intersect"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>&amp;&amp; — AのバウンディングボックスがBのバウンディングボックスとインタセクトする場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">&amp;&amp;</b>(</code> raster  <var class="pdparam">A</var> ,  raster  <var class="pdparam">B</var> <code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">&amp;&amp;</b>(</code> raster  <var class="pdparam">A</var> ,  geometry  <var class="pdparam">B</var> <code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">&amp;&amp;</b>(</code> geometry  <var class="pdparam">B</var> ,  raster  <var class="pdparam">A</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp94706760"></a><h2>説明</h2><p><code class="varname">&amp;&amp;</code>演算子は、AのバウンディングボックスがBのバウンディングボックスにインタセクトする場合に <code class="varname">TRUE</code>を返します。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これのオペランドは、ラスタで使用できるインデクスを使用します。</p></td></tr></table></div><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp94709448"></a><h2>例</h2><pre class="programlisting">SELECT A.rid As a_rid, B.rid As b_rid, A.rast &amp;&amp; B.rast As intersect
 FROM dummy_rast AS A CROSS JOIN dummy_rast AS B LIMIT 3;

 a_rid | b_rid | intersect
-------+-------+---------
     2 |     2 | t
     2 |     3 | f
     2 |     1 | f
</pre></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_Raster_OverLeft"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>&amp;&lt; — AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの左にある場合に<code class="varname">TRUE</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">&amp;&lt;</b>(</code> raster  <var class="pdparam">A</var> ,  raster  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp93635784"></a><h2>説明</h2><p><code class="varname">&amp;&lt;</code>演算子は、AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの左にある場合に<code class="varname">TRUE</code>を返します。条件についてより詳細に言うと、BのバウンディングボックスをオーバラップするかBのバウンディングボックスの右に*ない*場合です。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これのオペランドは、ラスタで使用できるインデクスを使用します。</p></td></tr></table></div></div><div class="refsection"><a name="idp93638088"></a><h2>例</h2><pre class="programlisting">SELECT A.rid As a_rid, B.rid As b_rid, A.rast &amp;&lt; B.rast As overleft
 FROM dummy_rast AS A CROSS JOIN dummy_rast AS B;

a_rid | b_rid | overleft
------+-------+----------
    2 |     2 | t
    2 |     3 | f
    2 |     1 | f
    3 |     2 | t
    3 |     3 | t
    3 |     1 | f
    1 |     2 | t
    1 |     3 | t
    1 |     1 | t
</pre></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_Raster_OverRight"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>&amp;&gt; — AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの右にある場合に <code class="varname">TRUE</code> を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">&amp;&gt;</b>(</code> raster  <var class="pdparam">A</var> ,  raster  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp94714824"></a><h2>説明</h2><p><code class="varname">&amp;&gt;</code>演算子は、AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの右にある場合に<code class="varname">TRUE</code>を返します。条件についてより詳細に言うと、BのバウンディングボックスをオーバラップするかBのバウンディングボックスの左に*ない*場合です。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これのオペランドは、ジオメトリで使用できるインデクスを使用します。</p></td></tr></table></div></div><div class="refsection"><a name="idp94717128"></a><h2>例</h2><pre class="programlisting">SELECT A.rid As a_rid, B.rid As b_rid, A.rast &amp;&gt; B.rast As overright
 FROM dummy_rast AS A CROSS JOIN dummy_rast AS B;

 a_rid | b_rid | overright
-------+-------+----------
     2 |     2 | t
     2 |     3 | t
     2 |     1 | t
     3 |     2 | f
     3 |     3 | t
     3 |     1 | f
     1 |     2 | f
     1 |     3 | t
     1 |     1 | t
</pre></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_Raster_EQ"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>= — AのバウンディングボックスがBのバウンディングボックスと同じ場合に<code class="varname">TRUE</code>を返します。倍精度浮動小数点数のバウンディングボックスを使います。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">=</b>(</code> raster  <var class="pdparam">A</var> ,  raster  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp94724808"></a><h2>説明</h2><p><code class="varname">=</code>演算子は、AのバウンディングボックスがBのバウンディングボックスと同じ場合にTRUEを返します。PostgreSQLは内部でラスタの順序決定や比較 (GROUP BY節やORDER BY節など)を行うためにラスタ用として定義している=, &lt;, &gt;演算子を使用します。</p><div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Caution"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注意]" src="images/caution.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これのオペランドは、ラスタで利用できるインデクスを使いません。代わりに<a class="xref" href="#RT_Raster_Same" title="~=">~=</a>を使います。この演算子はラスタカラムのGROUP BYに使うのがほとんどです。</p></td></tr></table></div><p>Availability: 2.1.0 </p></div><div class="refsection"><a name="idp94727496"></a><h2>関連情報</h2><p><a class="xref" href="#RT_Raster_Same" title="~=">~=</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_Raster_Contained"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>@ — AのバウンディングボックスがBのバウンディングボックスに含まれる場合に<code class="varname">TRUE</code>を返します。倍精度浮動小数点数のバウンディングボックスを使います。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">@</b>(</code> raster  <var class="pdparam">A</var> ,  raster  <var class="pdparam">B</var> <code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">@</b>(</code> geometry  <var class="pdparam">A</var> ,  raster  <var class="pdparam">B</var> <code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">@</b>(</code> raster  <var class="pdparam">B</var> ,  geometry  <var class="pdparam">A</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp94771272"></a><h2>説明</h2><p><code class="varname">@</code>は、ラスタまたはジオメトリであるAのバウンディングボックスが、ラスタまたはジオメトリであるBのバウンディングボックスに含まれる場合に<code class="varname">TRUE</code>を返します。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これのオペランドは、ラスタのインデクスを使用します。 </p></td></tr></table></div><p>Availability: 2.0.0 raster @ raster, raster @ geometry が導入されました。</p><p>Availability: 2.0.5 geometry @ raster が導入されました。 </p></div><div class="refsection"><a name="idp94774344"></a><h2>関連情報</h2><p><a class="xref" href="#RT_Raster_Contains" title="~">~</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_Raster_Same"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>~= — AのバウンディングボックスがBのバウンディングボックスと同じ場合にTRUEを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">~=</b>(</code> raster  <var class="pdparam">A</var> ,  raster  <var class="pdparam">B</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp94802120"></a><h2>説明</h2><p><code class="varname">~=</code>演算子は、AのバウンディングボックスがBのバウンディングボックスと同じ場合に<code class="varname">TRUE</code>を返します。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これのオペランドは、ラスタで使用できるインデクスを使用します。</p></td></tr></table></div><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp94804808"></a><h2>例</h2><p>大変便利な利用局面として、単一バンドを持つラスタ集合が二つあって、これらは同じデータなのに異なる主題を表現する場合で、これらを取って複数バンドのラスタを生成する局面です。</p><pre class="programlisting">SELECT ST_AddBand(prec.rast, alt.rast) As new_rast
    FROM prec INNER JOIN alt ON (prec.rast ~= alt.rast);
        </pre></div><div class="refsection"><a name="idp94806600"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_AddBand" title="ST_AddBand">ST_AddBand</a>, <a class="xref" href="#RT_Raster_EQ" title="=">=</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_Raster_Contains"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>~ — AのバウンディングボックスがBのバウンディングボックスを含む場合に<code class="varname">TRUE</code>を返します。倍精度浮動小数点数のバウンディングボックスを使います。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">~</b>(</code> raster  <var class="pdparam">A</var> ,  raster  <var class="pdparam">B</var> <code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">~</b>(</code> geometry  <var class="pdparam">A</var> ,  raster  <var class="pdparam">B</var> <code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">~</b>(</code> raster  <var class="pdparam">B</var> ,  geometry  <var class="pdparam">A</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp94822088"></a><h2>説明</h2><p><code class="varname">~</code>演算子は、ラスタまたはジオメトリであるAのバウンディングボックスがラスタまたはジオメトリであるBのバウンディングボックスを含む場合に<code class="varname">TRUE</code>を返します。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これのオペランドは、ラスタのインデクスを使用します。 </p></td></tr></table></div><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp94824776"></a><h2>関連情報</h2><p><a class="xref" href="#RT_Raster_Contained" title="@">@</a></p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Raster_Relationships"></a>9.14. ラスタとラスタバンドの空間関係関数</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#RT_ST_Contains">ST_Contains</a></span><span class="refpurpose"> — rastAの外にrastBの点が無く、rastAの内部にrastBの内部の点が一つ以上ある場合にTRUEを返します。 </span></dt><dt><span class="refentrytitle"><a href="#RT_ST_ContainsProperly">ST_ContainsProperly</a></span><span class="refpurpose"> — rastBがrastAの内部でインタセクトし、かつrastAの境界とも外部ともインタセクトしない場合にTRUEを返します。 </span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Covers">ST_Covers</a></span><span class="refpurpose"> — rastBがrastAの外部に点を持たない場合にTRUEを返します。 </span></dt><dt><span class="refentrytitle"><a href="#RT_ST_CoveredBy">ST_CoveredBy</a></span><span class="refpurpose"> — rastAがrastBの外部に点を持たない場合にTRUEを返します。 </span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Disjoint">ST_Disjoint</a></span><span class="refpurpose"> — rastAがrastBとインタセクトしない場合にTRUEを返します。 </span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Intersects">ST_Intersects</a></span><span class="refpurpose"> — rastAがrastBとインタセクトする場合にTRUEを返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Overlaps">ST_Overlaps</a></span><span class="refpurpose"> — rastAとrastBがインタセクトして、かつ一方がもう一方に完全には包含されない場合にはTRUEを返します。 </span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Touches">ST_Touches</a></span><span class="refpurpose"> — rastAとrastBが少なくとも一つの共通の点を持ち、かつ二つのラスタの内部同士がインタセクトしない場合にTRUEを返します。 </span></dt><dt><span class="refentrytitle"><a href="#RT_ST_SameAlignment">ST_SameAlignment</a></span><span class="refpurpose"> — ラスタが同じスキュー、スケール、空間参照系、オフセットを持つ (ピクセルが分割されることなく同じグリッドに置かれている)場合にTRUEを返し、そうでない場合は問題を詳述する通知とともにFALSEを返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_NotSameAlignmentReason">ST_NotSameAlignmentReason</a></span><span class="refpurpose"> — ラスタが同じアラインメントを持つかどうか、また、持たない場合にはその理由を示す文字列を返します。</span></dt><dt><span class="refentrytitle"><a href="#RT_ST_Within">ST_Within</a></span><span class="refpurpose"> — rastAがrastBの外部に点を持たず、rastAの内部の少なくとも一つの点がrastBの内部にある場合にTRUEを返します。 </span></dt><dt><span class="refentrytitle"><a href="#RT_ST_DWithin">ST_DWithin</a></span><span class="refpurpose"> — rastAとrastBが指定した距離内にある場合にTRUEを返します。 </span></dt><dt><span class="refentrytitle"><a href="#RT_ST_DFullyWithin">ST_DFullyWithin</a></span><span class="refpurpose"> — rastAとrastBが指定した距離内に完全に収まる場合にTRUEを返します。 </span></dt></dl></div><div class="refentry"><a name="RT_ST_Contains"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Contains — rastAの外にrastBの点が無く、rastAの内部にrastBの内部の点が一つ以上ある場合にTRUEを返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_Contains</b>(</code> raster  <var class="pdparam">rastA</var> ,  integer  <var class="pdparam">nbandA</var> ,  raster  <var class="pdparam">rastB</var> ,  integer  <var class="pdparam">nbandB</var> <code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">ST_Contains</b>(</code> raster  <var class="pdparam">rastA</var> ,  raster  <var class="pdparam">rastB</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp94839240"></a><h2>説明</h2><p>rastAの外にrastBの点が無く、rastAの内部にrastBの内部の点が一つ以上ある場合に限って、rastAはrastBを包含しています。バンド番号が指定されていないかNULLに指定されている場合には、ラスタの凸包のみを考慮してテストします。バンド番号が指定されている場合には、値を持つ (NODATAでない)ピクセルについてテストします。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はラスタで利用できるインデクスを使用します。 </p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ラスタとジオメトリの空間関係をテストするには、ST_Contains(ST_Polygon(raster), geometry)またはST_Contains(geometry, ST_Polygon(raster))というふうに、ラスタにST_Polygonを使います。 </p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_Contains()はST_Within()の逆です。ST_Contains(rastA, rastB)はST_Within(rastB, rastA)を示します。 </p></td></tr></table></div><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp94843080"></a><h2>例</h2><pre class="programlisting">-- バンド番号指定
SELECT r1.rid, r2.rid, ST_Contains(r1.rast, 1, r2.rast, 1) FROM dummy_rast r1 CROSS JOIN dummy_rast r2 WHERE r1.rid = 1;

NOTICE:  The first raster provided has no bands
 rid | rid | st_contains
-----+-----+-------------
   1 |   1 |
   1 |   2 | f
                        </pre><pre class="programlisting">-- バンド番号不指定
SELECT r1.rid, r2.rid, ST_Contains(r1.rast, r2.rast) FROM dummy_rast r1 CROSS JOIN dummy_rast r2 WHERE r1.rid = 1;
 rid | rid | st_contains
-----+-----+-------------
   1 |   1 | t
   1 |   2 | f
                        </pre></div><div class="refsection"><a name="idp94844872"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Intersects" title="ST_Intersects">ST_Intersects</a>, <a class="xref" href="#RT_ST_Within" title="ST_Within">ST_Within</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_ContainsProperly"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ContainsProperly — rastBがrastAの内部でインタセクトし、かつrastAの境界とも外部ともインタセクトしない場合にTRUEを返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_ContainsProperly</b>(</code> raster  <var class="pdparam">rastA</var> ,  integer  <var class="pdparam">nbandA</var> ,  raster  <var class="pdparam">rastB</var> ,  integer  <var class="pdparam">nbandB</var> <code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">ST_ContainsProperly</b>(</code> raster  <var class="pdparam">rastA</var> ,  raster  <var class="pdparam">rastB</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp94858952"></a><h2>説明</h2><p>rastBがrastAの内部でインタセクトし、かつrastAの境界とも外部ともインタセクトしない場合には、rastAはrastBに対してContainsProperly (確実に包含している)です。バンド番号が指定されていないかNULLに指定されている場合には、ラスタの凸包のみを考慮してテストします。バンド番号が指定されている場合には、値を持つ (NODATAでない)ピクセルについてテストします。 </p><p>rastAは自身にはContainsProperlyではありませんが、Containsです。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はラスタで利用できるインデクスを使用します。 </p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ラスタとジオメトリの空間関係をテストするには、ST_ContainsProperly(ST_Polygon(raster), geometry)またはST_ContainsProperly(geometry, ST_Polygon(raster))というふうに、ラスタにST_Polygonを使います。 </p></td></tr></table></div><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp94862408"></a><h2>例</h2><pre class="programlisting">SELECT r1.rid, r2.rid, ST_ContainsProperly(r1.rast, 1, r2.rast, 1) FROM dummy_rast r1 CROSS JOIN dummy_rast r2 WHERE r1.rid = 2;

 rid | rid | st_containsproperly
-----+-----+---------------------
   2 |   1 | f
   2 |   2 | f
                        </pre></div><div class="refsection"><a name="idp94863688"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Intersects" title="ST_Intersects">ST_Intersects</a>, <a class="xref" href="#RT_ST_Contains" title="ST_Contains">ST_Contains</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Covers"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Covers — rastBがrastAの外部に点を持たない場合にTRUEを返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_Covers</b>(</code> raster  <var class="pdparam">rastA</var> ,  integer  <var class="pdparam">nbandA</var> ,  raster  <var class="pdparam">rastB</var> ,  integer  <var class="pdparam">nbandB</var> <code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">ST_Covers</b>(</code> raster  <var class="pdparam">rastA</var> ,  raster  <var class="pdparam">rastB</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp94898248"></a><h2>説明</h2><p>rastAの外部にrastBの点が無い場合には、rastAはrastBに対してCoversです。バンド番号が指定されていないかNULLに指定されている場合には、ラスタの凸包のみを考慮してテストします。バンド番号が指定されている場合には、値を持つ (NODATAでない)ピクセルについてテストします。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はラスタで利用できるインデクスを使用します。 </p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ラスタとジオメトリの空間関係をテストするには、ST_Covers(ST_Polygon(raster), geometry)またはST_Covers(geometry, ST_Polygon(raster))というふうに、ラスタにST_Polygonを使います。 </p></td></tr></table></div><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp94901320"></a><h2>例</h2><pre class="programlisting">SELECT r1.rid, r2.rid, ST_Covers(r1.rast, 1, r2.rast, 1) FROM dummy_rast r1 CROSS JOIN dummy_rast r2 WHERE r1.rid = 2;

 rid | rid | st_covers
-----+-----+-----------
   2 |   1 | f
   2 |   2 | t
                        </pre></div><div class="refsection"><a name="idp94902600"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Intersects" title="ST_Intersects">ST_Intersects</a>, <a class="xref" href="#RT_ST_CoveredBy" title="ST_CoveredBy">ST_CoveredBy</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_CoveredBy"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_CoveredBy — rastAがrastBの外部に点を持たない場合にTRUEを返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_CoveredBy</b>(</code> raster  <var class="pdparam">rastA</var> ,  integer  <var class="pdparam">nbandA</var> ,  raster  <var class="pdparam">rastB</var> ,  integer  <var class="pdparam">nbandB</var> <code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">ST_CoveredBy</b>(</code> raster  <var class="pdparam">rastA</var> ,  raster  <var class="pdparam">rastB</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp93294664"></a><h2>説明</h2><p>rastAがrastBの外部に点を持たない場合には、rastAはrastBに対してCoveredByです。バンド番号が指定されていないかNULLに指定されている場合には、ラスタの凸包のみを考慮してテストします。バンド番号が指定されている場合には、値を持つ (NODATAでない)ピクセルについてテストします。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はラスタで利用できるインデクスを使用します。 </p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ラスタとジオメトリの空間関係をテストするには、ST_CoveredBy(ST_Polygon(raster), geometry)またはST_CoveredBy(geometry, ST_Polygon(raster))というふうに、ラスタにST_Polygonを使います。 </p></td></tr></table></div><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp93297736"></a><h2>例</h2><pre class="programlisting">SELECT r1.rid, r2.rid, ST_CoveredBy(r1.rast, 1, r2.rast, 1) FROM dummy_rast r1 CROSS JOIN dummy_rast r2 WHERE r1.rid = 2;

 rid | rid | st_coveredby
-----+-----+--------------
   2 |   1 | f
   2 |   2 | t
                        </pre></div><div class="refsection"><a name="idp93299016"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Intersects" title="ST_Intersects">ST_Intersects</a>, <a class="xref" href="#RT_ST_Covers" title="ST_Covers">ST_Covers</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Disjoint"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Disjoint — rastAがrastBとインタセクトしない場合にTRUEを返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_Disjoint</b>(</code> raster  <var class="pdparam">rastA</var> ,  integer  <var class="pdparam">nbandA</var> ,  raster  <var class="pdparam">rastB</var> ,  integer  <var class="pdparam">nbandB</var> <code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">ST_Disjoint</b>(</code> raster  <var class="pdparam">rastA</var> ,  raster  <var class="pdparam">rastB</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp94914632"></a><h2>説明</h2><p>rastAがrastBとインタセクトしない場合には、rastAとrastBはDisjointです。バンド番号が指定されていないかNULLに指定されている場合には、ラスタの凸包のみを考慮してテストします。バンド番号が指定されている場合には、値を持つ (NODATAでない)ピクセルについてテストします。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はインデクスを*使いません*。 </p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ラスタとジオメトリの空間関係をテストするには、ST_Disjoint(ST_Polygon(raster), geometry)というふうに、ラスタにST_Polygonを使います。 </p></td></tr></table></div><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp94917704"></a><h2>例</h2><pre class="programlisting">-- rid=1のラスタはバンドを持っていないので、
-- 警告が出て、ST_DisjointでNULL値が出ます
SELECT r1.rid, r2.rid, ST_Disjoint(r1.rast, 1, r2.rast, 1) FROM dummy_rast r1 CROSS JOIN dummy_rast r2 WHERE r1.rid = 2;

NOTICE:  The second raster provided has no bands
 rid | rid | st_disjoint
-----+-----+-------------
   2 |   1 |
   2 |   2 | f
                        </pre><pre class="programlisting">-- 今度はバンド番号を指定しません
SELECT r1.rid, r2.rid, ST_Disjoint(r1.rast, r2.rast) FROM dummy_rast r1 CROSS JOIN dummy_rast r2 WHERE r1.rid = 2;

 rid | rid | st_disjoint
-----+-----+-------------
   2 |   1 | t
   2 |   2 | f
                        </pre></div><div class="refsection"><a name="idp94939976"></a><h2>関連情報</h2><p>
				<a class="xref" href="#RT_ST_Intersects" title="ST_Intersects">ST_Intersects</a>
			</p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Intersects"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Intersects — rastAがrastBとインタセクトする場合にTRUEを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_Intersects</b>(</code> raster  <var class="pdparam">rastA</var> ,  integer  <var class="pdparam">nbandA</var> ,  raster  <var class="pdparam">rastB</var> ,  integer  <var class="pdparam">nbandB</var> <code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">ST_Intersects</b>(</code> raster  <var class="pdparam">rastA</var> ,  raster  <var class="pdparam">rastB</var> <code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">ST_Intersects</b>(</code> raster  <var class="pdparam">rast</var> ,  integer  <var class="pdparam">nband</var> ,  geometry  <var class="pdparam">geommin</var> <code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">ST_Intersects</b>(</code> raster  <var class="pdparam">rast</var> ,  geometry  <var class="pdparam">geommin</var> ,  integer  <var class="pdparam">nband=NULL</var> <code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">ST_Intersects</b>(</code> geometry  <var class="pdparam">geommin</var> ,  raster  <var class="pdparam">rast</var> ,  integer  <var class="pdparam">nband=NULL</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp94969032"></a><h2>説明</h2><p>rastAがrastBとインタセクトする場合にTRUEを返します。バンド番号が指定されていないかNULLに指定されている場合には、ラスタの凸包のみを考慮してテストします。バンド番号が指定されている場合には、値を持つ (NODATAでない)ピクセルについてテストします。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はラスタで利用できるインデクスを使用します。 </p></td></tr></table></div><p>Enhanced: 2.0.0 ラスタ/ラスタのインタセクト対応が導入されました。 </p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[警告]" src="images/warning.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Changed: 2.1.0 ST_Intersects(raster, geometry)形式の挙動が ST_Intersects(geometry, raster)とあうように変更されました。 </p></td></tr></table></div></div><div class="refsection"><a name="idp94972104"></a><h2>例</h2><pre class="programlisting">-- 同じラスタの別のバンド
SELECT ST_Intersects(rast, 2, rast, 3) FROM dummy_rast WHERE rid = 2;

 st_intersects
---------------
 t
                        </pre></div><div class="refsection"><a name="idp94973384"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Intersection" title="ST_Intersection">ST_Intersection</a>, <a class="xref" href="#RT_ST_Disjoint" title="ST_Disjoint">ST_Disjoint</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Overlaps"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Overlaps — rastAとrastBがインタセクトして、かつ一方がもう一方に完全には包含されない場合にはTRUEを返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_Overlaps</b>(</code> raster  <var class="pdparam">rastA</var> ,  integer  <var class="pdparam">nbandA</var> ,  raster  <var class="pdparam">rastB</var> ,  integer  <var class="pdparam">nbandB</var> <code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">ST_Overlaps</b>(</code> raster  <var class="pdparam">rastA</var> ,  raster  <var class="pdparam">rastB</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp95024328"></a><h2>説明</h2><p>rastAがrastBをオーバラップする場合にTRUEを返します。rastAとrastBがインタセクトして、かつ一方がもう一方に完全には包含されない場合にはいう意味です。バンド番号が指定されていないかNULLに指定されている場合には、ラスタの凸包のみを考慮してテストします。バンド番号が指定されている場合には、値を持つ (NODATAでない)ピクセルについてテストします。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はラスタで利用できるインデクスを使用します。 </p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ラスタとジオメトリの空間関係をテストするには、ST_Overlaps(ST_Polygon(raster), geometry)というふうに、ラスタにST_Polygonを使います。 </p></td></tr></table></div><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp95027400"></a><h2>例</h2><pre class="programlisting">-- 同じラスタの別のバンドの比較
SELECT ST_Overlaps(rast, 1, rast, 2) FROM dummy_rast WHERE rid = 2;

 st_overlaps
-------------
 f
                        </pre></div><div class="refsection"><a name="idp95028680"></a><h2>関連情報</h2><p>
				<a class="xref" href="#RT_ST_Intersects" title="ST_Intersects">ST_Intersects</a>
			</p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Touches"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Touches — rastAとrastBが少なくとも一つの共通の点を持ち、かつ二つのラスタの内部同士がインタセクトしない場合にTRUEを返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_Touches</b>(</code> raster  <var class="pdparam">rastA</var> ,  integer  <var class="pdparam">nbandA</var> ,  raster  <var class="pdparam">rastB</var> ,  integer  <var class="pdparam">nbandB</var> <code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">ST_Touches</b>(</code> raster  <var class="pdparam">rastA</var> ,  raster  <var class="pdparam">rastB</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp92498888"></a><h2>説明</h2><p>rastAがrastBに接触する場合にTRUEを返します。rastAとrastBが少なくとも一つの共通の点を持ち、かつ二つのラスタの内部同士がインタセクトしないという意味です。バンド番号が指定されていないかNULLに指定されている場合には、ラスタの凸包のみを考慮してテストします。バンド番号が指定されている場合には、値を持つ (NODATAでない)ピクセルについてテストします。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はラスタで利用できるインデクスを使用します。 </p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ラスタとジオメトリの空間関係をテストするには、ST_Touches(ST_Polygon(raster), geometry)というふうに、ラスタにST_Polygonを使います。 </p></td></tr></table></div><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp92501960"></a><h2>例</h2><pre class="programlisting">SELECT r1.rid, r2.rid, ST_Touches(r1.rast, 1, r2.rast, 1) FROM dummy_rast r1 CROSS JOIN dummy_rast r2 WHERE r1.rid = 2;

 rid | rid | st_touches
-----+-----+------------
   2 |   1 | f
   2 |   2 | f
                        </pre></div><div class="refsection"><a name="idp92503240"></a><h2>関連情報</h2><p>
				<a class="xref" href="#RT_ST_Intersects" title="ST_Intersects">ST_Intersects</a>
			</p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_SameAlignment"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_SameAlignment — ラスタが同じスキュー、スケール、空間参照系、オフセットを持つ (ピクセルが分割されることなく同じグリッドに置かれている)場合にTRUEを返し、そうでない場合は問題を詳述する通知とともにFALSEを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_SameAlignment</b>(</code> raster  <var class="pdparam">rastA</var> ,  raster  <var class="pdparam">rastB</var> <code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">ST_SameAlignment</b>(</code> double precision  <var class="pdparam">ulx1</var> ,  double precision  <var class="pdparam">uly1</var> ,  double precision  <var class="pdparam">scalex1</var> ,  double precision  <var class="pdparam">scaley1</var> ,  double precision  <var class="pdparam">skewx1</var> ,  double precision  <var class="pdparam">skewy1</var> ,  double precision  <var class="pdparam">ulx2</var> ,  double precision  <var class="pdparam">uly2</var> ,  double precision  <var class="pdparam">scalex2</var> ,  double precision  <var class="pdparam">scaley2</var> ,  double precision  <var class="pdparam">skewx2</var> ,  double precision  <var class="pdparam">skewy2</var> <code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">ST_SameAlignment</b>(</code> raster set  <var class="pdparam">rastfield</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp95077448"></a><h2>説明</h2><p>非集計版 (一つ目と二つ目の形式): 二つのラスタ (直接与えたラスタでも左上隅、スケール、スキュー、SRIDを使って作ったものでも)が同じスキュー、スケール、空間参照系、を持ち、少なくとも4隅の一つがもう一方のラスタのグリッド隅に落ちる場合にTRUEを返します。そうでない場合には、問題に言及した警告を出します。 </p><p>集約関数版 (三つ目の形式): ラスタ集合から、全てのラスタが同じアラインメントを持つ場合にTRUEを返します。ST_SameAlignment()関数はPostgreSQLの用語で言うところの「集約」関数です。SUM()やAVG()といった複数のデータ行での操作を意味します。 </p><p>Availability: 2.0.0</p><p>Enhanced: 2.1.0 集約関数版の追加</p></div><div class="refsection"><a name="idp95079752"></a><h2>例: ラスタ</h2><pre class="programlisting">SELECT ST_SameAlignment(
        ST_MakeEmptyRaster(1, 1, 0, 0, 1, 1, 0, 0),
        ST_MakeEmptyRaster(1, 1, 0, 0, 1, 1, 0, 0)
) as sm;

sm
----
t
</pre><pre class="programlisting">SELECT ST_SameAlignment(A.rast,b.rast)
 FROM dummy_rast AS A CROSS JOIN dummy_rast AS B;

 NOTICE:  The two rasters provided have different SRIDs
NOTICE:  The two rasters provided have different SRIDs
 st_samealignment
------------------
 t
 f
 f
 f
</pre></div><div class="refsection"><a name="idp95081544"></a><h2>関連情報</h2><p><a class="xref" href="#RT_Loading_Rasters" title="5.1. ラスタのロードと生成">「ラスタのロードと生成」</a>, <a class="xref" href="#RT_ST_NotSameAlignmentReason" title="ST_NotSameAlignmentReason">ST_NotSameAlignmentReason</a>, <a class="xref" href="#RT_ST_MakeEmptyRaster" title="ST_MakeEmptyRaster">ST_MakeEmptyRaster</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_NotSameAlignmentReason"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_NotSameAlignmentReason — ラスタが同じアラインメントを持つかどうか、また、持たない場合にはその理由を示す文字列を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_NotSameAlignmentReason</b>(</code>raster <var class="pdparam">rastA</var>, raster <var class="pdparam">rastB</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp95088968"></a><h2>説明</h2><p>ラスタが同じアラインメントを持つかどうか、また、持たない場合にはその理由を示す文字列を返します。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ラスタが同じアラインメントを持たない理由が複数ある場合には、一つだけ （最初のテストで失敗した)理由を返します。 </p></td></tr></table></div><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp95095368"></a><h2>例</h2><pre class="programlisting">SELECT
        ST_SameAlignment(
                ST_MakeEmptyRaster(1, 1, 0, 0, 1, 1, 0, 0),
                ST_MakeEmptyRaster(1, 1, 0, 0, 1.1, 1.1, 0, 0)
        ),
        ST_NotSameAlignmentReason(
                ST_MakeEmptyRaster(1, 1, 0, 0, 1, 1, 0, 0),
                ST_MakeEmptyRaster(1, 1, 0, 0, 1.1, 1.1, 0, 0)
        )
;

 st_samealignment |            st_notsamealignmentreason
------------------+-------------------------------------------------
 f                | The rasters have different scales on the X axis
(1 row)
                                </pre></div><div class="refsection"><a name="idp95096648"></a><h2>関連情報</h2><p><a class="xref" href="#RT_Loading_Rasters" title="5.1. ラスタのロードと生成">「ラスタのロードと生成」</a>, <a class="xref" href="#RT_ST_SameAlignment" title="ST_SameAlignment">ST_SameAlignment</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_Within"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Within — rastAがrastBの外部に点を持たず、rastAの内部の少なくとも一つの点がrastBの内部にある場合にTRUEを返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_Within</b>(</code> raster  <var class="pdparam">rastA</var> ,  integer  <var class="pdparam">nbandA</var> ,  raster  <var class="pdparam">rastB</var> ,  integer  <var class="pdparam">nbandB</var> <code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">ST_Within</b>(</code> raster  <var class="pdparam">rastA</var> ,  raster  <var class="pdparam">rastB</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp95110728"></a><h2>説明</h2><p>rastAがrastBの外部に点を持たず、rastAの内部の少なくとも一つの点がrastBの内部にある場合にrastAはrastBに対してWithinです。バンド番号が指定されていないかNULLに指定されている場合には、ラスタの凸包のみを考慮してテストします。バンド番号が指定されている場合には、値を持つ (NODATAでない)ピクセルについてテストします。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これのオペランドは、ラスタで使用できるインデクスを使用します。 </p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ラスタとジオメトリの空間関係をテストするには、ST_Within(ST_Polygon(raster), geometry)またはST_Within(geometry, ST_Polygon(raster))というふうに、ラスタにST_Polygonを使います。 </p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ST_Within()はST_Contains()の逆です。ST_Within(rastA, rastB)はST_Contains(rastB, rastA)を示します。 </p></td></tr></table></div><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp95114568"></a><h2>例</h2><pre class="programlisting">SELECT r1.rid, r2.rid, ST_Within(r1.rast, 1, r2.rast, 1) FROM dummy_rast r1 CROSS JOIN dummy_rast r2 WHERE r1.rid = 2;

 rid | rid | st_within
-----+-----+-----------
   2 |   1 | f
   2 |   2 | t
                        </pre></div><div class="refsection"><a name="idp95115848"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Intersects" title="ST_Intersects">ST_Intersects</a>, <a class="xref" href="#RT_ST_Contains" title="ST_Contains">ST_Contains</a>, <a class="xref" href="#RT_ST_DWithin" title="ST_DWithin">ST_DWithin</a>, <a class="xref" href="#RT_ST_DFullyWithin" title="ST_DFullyWithin">ST_DFullyWithin</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_DWithin"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_DWithin — rastAとrastBが指定した距離内にある場合にTRUEを返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_DWithin</b>(</code> raster  <var class="pdparam">rastA</var> ,  integer  <var class="pdparam">nbandA</var> ,  raster  <var class="pdparam">rastB</var> ,  integer  <var class="pdparam">nbandB</var> ,  double precision  <var class="pdparam">distance_of_srid</var> <code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">ST_DWithin</b>(</code> raster  <var class="pdparam">rastA</var> ,  raster  <var class="pdparam">rastB</var> ,  double precision  <var class="pdparam">distance_of_srid</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp95133256"></a><h2>説明</h2><p>rastAとrastBが指定した距離内にある場合にTRUEを返します。バンド番号が指定されていないかNULLに指定されている場合には、ラスタの凸包のみを考慮してテストします。バンド番号が指定されている場合には、値を持つ (NODATAでない)ピクセルについてテストします。 </p><p>distanceはラスタの空間参照系で定義される単位です。この関数が意味あるものにするには、元のラスタが両方とも同じ空間参照系である、つまり同じSRIDを持たなければなりません。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これのオペランドは、ラスタで使用できるインデクスを使用します。 </p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ラスタとジオメトリの空間関係をテストするには、ST_DWithin(ST_Polygon(raster), geometry)というふうに、ラスタにST_Polygonを使います。 </p></td></tr></table></div><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp95140808"></a><h2>例</h2><pre class="programlisting">SELECT r1.rid, r2.rid, ST_DWithin(r1.rast, 1, r2.rast, 1, 3.14) FROM dummy_rast r1 CROSS JOIN dummy_rast r2 WHERE r1.rid = 2;

 rid | rid | st_dwithin
-----+-----+------------
   2 |   1 | f
   2 |   2 | t
                        </pre></div><div class="refsection"><a name="idp95142088"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Within" title="ST_Within">ST_Within</a>, <a class="xref" href="#RT_ST_DFullyWithin" title="ST_DFullyWithin">ST_DFullyWithin</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="RT_ST_DFullyWithin"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_DFullyWithin — rastAとrastBが指定した距離内に完全に収まる場合にTRUEを返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">ST_DFullyWithin</b>(</code> raster  <var class="pdparam">rastA</var> ,  integer  <var class="pdparam">nbandA</var> ,  raster  <var class="pdparam">rastB</var> ,  integer  <var class="pdparam">nbandB</var> ,  double precision  <var class="pdparam">distance_of_srid</var> <code>)</code>;</p><p><code class="funcdef">boolean <b class="fsfunc">ST_DFullyWithin</b>(</code> raster  <var class="pdparam">rastA</var> ,  raster  <var class="pdparam">rastB</var> ,  double precision  <var class="pdparam">distance_of_srid</var> <code>)</code>;</p></div></div><div class="refsection"><a name="idp95158728"></a><h2>説明</h2><p>rastAとrastBが指定した距離内に完全に収まる場合にTRUEを返します。バンド番号が指定されていないかNULLに指定されている場合には、ラスタの凸包のみを考慮してテストします。バンド番号が指定されている場合には、値を持つ (NODATAでない)ピクセルについてテストします。 </p><p>distanceはラスタの空間参照系で定義される単位です。この関数が意味あるものにするには、元のラスタが両方とも同じ空間参照系である、つまり同じSRIDを持たなければなりません。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>これのオペランドは、ラスタで使用できるインデクスを使用します。 </p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ラスタとジオメトリの空間関係をテストするには、ST_DFullyWithin(ST_Polygon(raster), geometry)というふうに、ラスタにST_Polygonを使います。 </p></td></tr></table></div><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp95162184"></a><h2>例</h2><pre class="programlisting">SELECT r1.rid, r2.rid, ST_DFullyWithin(r1.rast, 1, r2.rast, 1, 3.14) FROM dummy_rast r1 CROSS JOIN dummy_rast r2 WHERE r1.rid = 2;

 rid | rid | st_dfullywithin
-----+-----+-----------------
   2 |   1 | f
   2 |   2 | t
                        </pre></div><div class="refsection"><a name="idp95163464"></a><h2>関連情報</h2><p><a class="xref" href="#RT_ST_Within" title="ST_Within">ST_Within</a>, <a class="xref" href="#RT_ST_DWithin" title="ST_DWithin">ST_DWithin</a> </p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Raster_Tips"></a>9.15. ラスタに関する技法</h2></div><div><div class="abstract"><p class="title"><b>概要</b></p><p>本節では、PostGISラスタに関連する様々な落とし穴や技法について説明します。</p></div></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="#outdb">9.15.1. データベース外ラスタ</a></span></dt></dl></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="outdb"></a>9.15.1. データベース外ラスタ</h3></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect3"><a href="#gdal_readdir">9.15.1.1. 多数のファイルを持つディレクトリ</a></span></dt><dt><span class="sect3"><a href="#max_open_files">9.15.1.2. 開くことができるファイルの最大数</a></span></dt></dl></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="gdal_readdir"></a>9.15.1.1. 多数のファイルを持つディレクトリ</h4></div></div></div><p>GDALはファイルを開く時に、そのファイルのディレクトリを熱心にスキャンして、他のファイルのカタログを構築します。このディレクトリに多数のファイル (千とか万とか)あるとします。一つのファイルを開くと動作が非常に遅くなります (特にNFSのようなネットワークドライブの場合)。 </p><p>この振る舞いを制御するために、GDALには<a class="ulink" href="https://trac.osgeo.org/gdal/wiki/ConfigOptions#GDAL_DISABLE_READDIR_ON_OPEN" target="_top">GDAL_DISABLE_READDIR_ON_OPEN</a>という環境変数があります。<code class="varname">GDAL_DISABLE_READDIR_ON_OPEN</code>を<code class="varname">TRUE</code>に設定すると、ディレクトリのスキャンを無効にします。 </p><p>Ubuntuでは (Ubuntu用PostgreSQLのパッケージを使っていると仮定します)、<code class="varname">GDAL_DISABLE_READDIR_ON_OPEN</code>が<span class="emphasis"><em>/etc/postgresql/POSTGRESQL_VERSION/CLUSTER_NAME/environment</em></span>内で設定できます (POSTGRESQL_VERSIONは9.6等のPostgreSQLのバージョンで、CLUSTER_NAMEはmaindb等のクラスタ名です)。PostGIS環境変数もここで同じく設定できます。 </p><pre class="programlisting"># postmasterプロセスの環境変数
# このファイルはpostgresql.confと同じ文法で、次のように書きます。
#  VARIABLE = simple_value
#  VARIABLE2 = 'any value!'
# 例えば、英数文字と'-', '_', '.' (のシングルクォート内)以外の文字を含む値を囲む必要があります。
# シェルコマンドは評価されません。
POSTGIS_GDAL_ENABLED_DRIVERS = 'ENABLE_ALL'

POSTGIS_ENABLE_OUTDB_RASTERS = 1

<span class="strong"><strong>GDAL_DISABLE_READDIR_ON_OPEN = 'TRUE'</strong></span>
                                        </pre><p>
				</p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="max_open_files"></a>9.15.1.2. 開くことができるファイルの最大数</h4></div></div></div><p>LinuxとPostgreSQLが許している、開くことができるファイルの最大数は、通常は増加していません (通常、プロセスあたり1024ファイルです)。システムは人間のユーザが使用するという仮定に立っているからです。データベース外ラスタは、一つの妥当なクエリで簡単に制限超過させることができます (例えば、10年分のラスタからなるデータセットで、個々のラスタは日別最低気温、最大気温を持っていて、データセット内の最大値と最小値を得たい場合などです)。 </p><p>最も簡単な変更方法は、PostgreSQL設定<a class="ulink" href="https://www.postgresql.org/docs/current/static/runtime-config-resource.html#GUC-MAX-FILES-PER-PROCESS" target="_top">max_files_per_process</a>です。デフォルトとして1000が設定されていますが、データベース外ラスタとしては非常に低い値です。安全な開始値は65536でしょう。ただし、実際には、これはデータベースとデータベースに対して実行されるクエリに依存します。サーバ開始時のみ、かつPostgreSQLコンフィギュレーションファイル (例: Ubuntu環境では<span class="emphasis"><em>/etc/postgresql/POSTGRESQL_VERSION/CLUSTER_NAME/postgresql.conf</em></span>)内のみで設定できます。 </p><pre class="programlisting">...
# - カーネルリソースの使用状況 -

<span class="strong"><strong>max_files_per_process = 65536</strong></span>           # min 25
                                        # (change requires restart)
...
                                        </pre><p>
				</p><p>主な変更はLinuxカーネルのファイルを開く制限です。次の通り、二つに分かれます。 </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>システム全体で開くことができるファイルの最大数</p></li><li class="listitem"><p>プロセスごとに開くことができるファイルの最大数</p></li></ul></div><p>
				</p><div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a name="max_open_files_per_system"></a>9.15.1.2.1. システム全体で開くことができるファイルの最大数</h5></div></div></div><p>次の例で、システム全体の、現在の開くことができるファイルの最大値を調べることができます。 </p><pre class="programlisting">$ sysctl -a | grep fs.file-max
fs.file-max = 131072
                                        </pre><p>返された値が十分には大きくない場合には、次に示す例に従って、<span class="emphasis"><em>/etc/sysctl.d/</em></span>にファイルを追加します。 </p><pre class="programlisting">$ echo "fs.file-max = 6145324" 
&gt;
&gt; /etc/sysctl.d/fs.conf

$ cat /etc/sysctl.d/fs.conf
fs.file-max = 6145324

$ sysctl -p --system
* Applying /etc/sysctl.d/fs.conf ...
fs.file-max = 2097152
* Applying /etc/sysctl.conf ...

$ sysctl -a | grep fs.file-max
fs.file-max = 6145324
                                        </pre></div><div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a name="max_open_files_per_process"></a>9.15.1.2.2. プロセスごとの開けるファイルの最大数</h5></div></div></div><p>PostgreSQLのサーバプロセスごとに開けるファイルの最大数を増やす必要があります。 </p><p>現在のPostgreSQLサービスのプロセスは開くことができるファイルの最大数を使っていて、次の例のようになっています (PostgreSQLが実行されていることを確認して下さい)。 </p><pre class="programlisting">$ ps aux | grep postgres
postgres 31713  0.0  0.4 179012 17564 pts/0    S    Dec26   0:03 /home/dustymugs/devel/postgresql/sandbox/10/usr/local/bin/postgres -D /home/dustymugs/devel/postgresql/sandbox/10/pgdata
postgres 31716  0.0  0.8 179776 33632 ?        Ss   Dec26   0:01 postgres: checkpointer process
postgres 31717  0.0  0.2 179144  9416 ?        Ss   Dec26   0:05 postgres: writer process
postgres 31718  0.0  0.2 179012  8708 ?        Ss   Dec26   0:06 postgres: wal writer process
postgres 31719  0.0  0.1 179568  7252 ?        Ss   Dec26   0:03 postgres: autovacuum launcher process
postgres 31720  0.0  0.1  34228  4124 ?        Ss   Dec26   0:09 postgres: stats collector process
postgres 31721  0.0  0.1 179308  6052 ?        Ss   Dec26   0:00 postgres: bgworker: logical replication launcher

$ cat /proc/31718/limits
Limit                     Soft Limit           Hard Limit           Units
Max cpu time              unlimited            unlimited            seconds
Max file size             unlimited            unlimited            bytes
Max data size             unlimited            unlimited            bytes
Max stack size            8388608              unlimited            bytes
Max core file size        0                    unlimited            bytes
Max resident set          unlimited            unlimited            bytes
Max processes             15738                15738                processes
<span class="strong"><strong>Max open files            1024                 4096                 files</strong></span>
Max locked memory         65536                65536                bytes
Max address space         unlimited            unlimited            bytes
Max file locks            unlimited            unlimited            locks
Max pending signals       15738                15738                signals
Max msgqueue size         819200               819200               bytes
Max nice priority         0                    0
Max realtime priority     0                    0
Max realtime timeout      unlimited            unlimited            us
                                        </pre><p>上の例では、プロセスに対する開くことができるファイルの制限が31718になっています。どのプロセスがどうするかは問題ではありません。関心を持っている応答は<span class="emphasis"><em>Max open files</em></span>です。 </p><p><span class="emphasis"><em>Max open files</em></span>の<span class="emphasis"><em>Soft Limit</em></span>と<span class="emphasis"><em>Hard Limit</em></span>をPostgreSQLの設定で指定した<code class="varname">max_files_per_process</code>よりも多くなるようにしたいと思っています。この例では、<code class="varname">max_files_per_process</code>を65536にしています。 </p><p>Ubuntu (かつ、Ubuntu用PostgreSQLパッケージを使用しているものとします)では、<span class="emphasis"><em>Soft Limit</em></span>と<span class="emphasis"><em>Hard Limit</em></span>の変更については、<span class="strong"><strong>/etc/init.d/postgresql</strong></span> (SysV)または<span class="strong"><strong>/lib/systemd/system/postgresql*.service</strong></span> (systemd)を編集するのが簡単な方法です。 </p><p>まず、SysV Ubuntuを扱います。<span class="strong"><strong>ulimit -H -n 262144</strong></span>と<span class="strong"><strong>ulimit -n 131072</strong></span>を<span class="strong"><strong>/etc/init.d/postgresql</strong></span>に追加します。 </p><pre class="programlisting">...
case "$1" in
    start|stop|restart|reload)
        if [ "$1" = "start" ]; then
            create_socket_directory
        fi
        if [ -z "`pg_lsclusters -h`" ]; then
            log_warning_msg 'No PostgreSQL clusters exist; see "man pg_createcluster"'
            exit 0
        fi
<span class="strong"><strong>
        ulimit -H -n 262144
        ulimit -n 131072
</strong></span>
        for v in $versions; do
            $1 $v || EXIT=$?
        done
        exit ${EXIT:-0}
        ;;
    status)
...
</pre><p>Ubuntuのsystemdを扱います。<span class="strong"><strong>LimitNOFILE=131072</strong></span>を<span class="strong"><strong>/lib/systemd/system/postgresql*.service</strong></span>の各ファイルの<span class="strong"><strong>[Service]</strong></span>セクション内に記述します。 </p><pre class="programlisting">...
[Service]
<span class="strong"><strong>
LimitNOFILE=131072
</strong></span>
...

[Install]
WantedBy=multi-user.target
...
</pre><p>必要なシステムの変更を行った後、デーモンのリロードを必ず行ってください。 </p><pre class="programlisting">systemctl daemon-reload
</pre></div></div></div></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="RT_FAQ"></a>第10章 PostGISラスタ よくある質問</h1></div></div></div><div class="qandaset"><a name="idp99983304"></a><dl><dt>10.1. <a href="#idp99983560">PostGISラスタプロジェクトに関するより多くの情報はどこにありますか?</a></dt><dt>10.2. <a href="#idp100075976">この素晴らしいものを始めるための書籍やチュートリアルはありますか?</a></dt><dt>10.3. <a href="#idp100080840">PostGISデータベースにラスタ機能をインストールするにはどうすればよいでしょうか?</a></dt><dt>10.4. <a href="#idp100086088">"C:/Program Files/PostgreSQL/8.4/lib/rtpostgis.dll": The specified module could not be found.エラーがでました。また、Linux上でrtpostgis.sql実行時にライブラリのロードができませんでした。</a></dt><dt>10.5. <a href="#idp100088392">ラスタデータをPostGISにロードするにはどうすればよいでしょうか?</a></dt><dt>10.6. <a href="#idp100091080">ロード可能なラスタファイルの種類は何ですか?</a></dt><dt>10.7. <a href="#idp100094408">PostGISラスタデータを他のラスタ形式に出力できますか?</a></dt><dt>10.8. <a href="#idp100104136">GDALバイナリはPostGISラスタ機能付きでコンパイルされていますか?</a></dt><dt>10.9. <a href="#idp100107976">PostGISラスタデータを見るのに使うことができるツールは何ですか?</a></dt><dt>10.10. <a href="#idp100110792">MapServerの地図にPostGISラスタレイヤを追加するにはどうすればいいですか?</a></dt><dt>10.11. <a href="#idp100115912">現在ラスタデータで使用できる関数は何ですか?</a></dt><dt>10.12. <a href="#qa_raster_function_not_unique">「ERROR: function st_intersects(raster, unknown) is not unique or st_union(geometry,text) is not unique.」というエラーが出ました。解消するにはどうすればいいでしょうか?</a></dt><dt>10.13. <a href="#idp100151496">PostGISラスタとOracle GeoRaster (SDO_GEORATGER)およびSDO_RASTERとどの位違うのでしょうか?</a></dt><dt>10.14. <a href="#qa_raster_fails_encoding_conversion">raster2pgsqlにより巨大なファイルのロードがString of N bytes is too long for encoding conversionと言われて失敗しますがどうすればよいでしょうか?</a></dt><dt>10.15. <a href="#faq_security_change_1">ST_FromGDALRasterを使うとERROR: RASTER_fromGDALRaster: Could not open bytea with GDAL. Check that the bytea is of a GDAL supported format.というエラーが出ます。また、ST_AsPNGや他の入力関数を使おうとするとERROR: rt_raster_to_gdal: Could not load the output GDAL driverというエラーが出ます。</a></dt></dl><table border="0" style="width: 100%;"><colgroup><col align="left" width="1%"><col></colgroup><tbody><tr class="question"><td align="left" valign="top"><a name="idp99983560"></a><a name="idp99983816"></a><p><b>10.1.</b></p></td><td align="left" valign="top"><p>PostGISラスタプロジェクトに関するより多くの情報はどこにありますか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p><a class="ulink" href="http://trac.osgeo.org/postgis/wiki/WKTRaster" target="_top">PostGIS Raster home page</a>をご覧下さい。</p></td></tr><tr class="question"><td align="left" valign="top"><a name="idp100075976"></a><a name="idp100076232"></a><p><b>10.2.</b></p></td><td align="left" valign="top"><p>この素晴らしいものを始めるための書籍やチュートリアルはありますか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>網羅的な初心者用チュートリアルは<a class="ulink" href="http://trac.osgeo.org/postgis/wiki/WKTRasterTutorial01" target="_top">Intersecting vector buffers with large raster coverage using PostGIS Raster</a>にあります。PostGISラスタに関するJorgeさんの一連のブログに、ラスタデータのロード方法、Oracle GeoRasterのタスクとのクロス比較があります。<a class="ulink" href="http://gis4free.wordpress.com/category/postgis-raster/" target="_top">Jorge's PostGIS Raster / Oracle GeoRaster Series</a>をご覧ください。 <a class="ulink" href="https://www.manning.com/books/postgis-in-action-second-edition" target="_top">PostGIS in Action - Raster chapter</a>では、章全体(35ページ超)がPostGISラスタにささげられていて、フリーのコードとデータがついています。 Manningからハードコピー本または電子書籍版を<a class="ulink" href="http://www.postgis.us/page_buy_book" target="_top">Buy PostGIS in Action</a>から購入することができます (大量発注によるかなりの割引があります)。また、Amazon等書籍販売サイトで購入することも可能です。全てのハードコピー本は電子書籍版の無償ダウンロードのクーポンが付きます。  </p><p>PostGISラスタのユーザからのレビューが<a class="ulink" href="http://fuzzytolerance.info/blog/2010/10/26/2010-10-26-postgis-raster-ftw/" target="_top">PostGIS raster applied to land classification urban forestry</a>にあります。</p></td></tr><tr class="question"><td align="left" valign="top"><a name="idp100080840"></a><a name="idp100081096"></a><p><b>10.3.</b></p></td><td align="left" valign="top"><p>PostGISデータベースにラスタ機能をインストールするにはどうすればよいでしょうか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>PostGIS 2.0から、PostGISラスタが完全に統合されていて、PostGISコンパイル時に併せてコンパイルされます。</p><p>Windows下でのインストールと実行の説明は<a class="ulink" href="http://gis4free.wordpress.com/2011/03/10/how-to-install-and-configure-postgis-raster-on-windows/" target="_top">How to Install and Configure PostGIS raster on windows</a>にあります。</p><p>Windows下でコンパイルすることができますし、<a class="ulink" href="http://postgis.net/windows_downloads" target="_top">コンパイル済みPostGISラスタのバイナリ</a>を使うこともできます。MacOS X LeopardまたはSnow Leopardでは、<a class="ulink" href="http://www.kyngchaos.com/software/postgres" target="_top">Kyng Chaos Mac OSX PostgreSQL/GIS binaries</a>バイナリがあります。 </p><p>他のプラットフォームでは、ソフトウェアレポジトリからPostGISをインストールします。ソースからのコンパイルについては、<a class="ulink" href="http://trac.osgeo.org/postgis/wiki/WKTRaster/Documentation01#a2.3-CompilingandInstallingfromSources" target="_top">Installing PostGIS Raster from source</a>を参照して下さい。</p></td></tr><tr class="question"><td align="left" valign="top"><a name="idp100086088"></a><a name="idp100086344"></a><p><b>10.4.</b></p></td><td align="left" valign="top"><p>"C:/Program Files/PostgreSQL/8.4/lib/rtpostgis.dll": The specified module could not be found.エラーがでました。また、Linux上でrtpostgis.sql実行時にライブラリのロードができませんでした。</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>rtpostgis.dll/soは、libgdal.dll/soに依存します。Windowsではlibgdal-1.dllをPostgreSQLインストール先のbinフォルダに置いてください。Linuxについてはlibgdalがパスまたはbinフォルダの中に置いて下さい。 </p><p>また、PostGISをデータベースにインストールしていない場合には別のエラーが出ます。PostGISをまずデータベースにインストールしてから、ラスタ機能をインストールしてみてください。</p></td></tr><tr class="question"><td align="left" valign="top"><a name="idp100088392"></a><a name="idp100088648"></a><p><b>10.5.</b></p></td><td align="left" valign="top"><p>ラスタデータをPostGISにロードするにはどうすればよいでしょうか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>PostGIS最新版には、ラスタローダ<code class="varname">raster2pgsql</code>があります。多種のラスタのロードが可能で、低解像度のオーバビューを作成することが可能な実行可能ファイルで、他のソフトウェアを要しません。詳細情報については<a class="xref" href="#RT_Raster_Loader" title="5.1.1. raster2pgsqlを使ってラスタをロードする">「raster2pgsqlを使ってラスタをロードする」</a>を参照して下さい。</p></td></tr><tr class="question"><td align="left" valign="top"><a name="idp100091080"></a><a name="idp100091336"></a><p><b>10.6.</b></p></td><td align="left" valign="top"><p>ロード可能なラスタファイルの種類は何ですか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>GDALライブラリがサポートするもの全てです。GDALがサポートする形式については<a class="ulink" href="http://www.gdal.org/formats_list.html" target="_top">GDAL File Formats</a>にあります。</p><p>インストールで、一部の形式に対応していない可能性があります。インストールしたGDALがサポートする形式を確認するには、次を実行してください。</p><pre class="programlisting">raster2pgsql -G</pre></td></tr><tr class="question"><td align="left" valign="top"><a name="idp100094408"></a><a name="idp100094664"></a><p><b>10.7.</b></p></td><td align="left" valign="top"><p>PostGISラスタデータを他のラスタ形式に出力できますか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>はい</p><p>GDALにはPostGISラスタのドライバがあります。ただしPostgreSQLサポートを付けてコンパイルするようにした場合に限ります。 </p><p>PostGISラスタ型に不規則なブロックのラスタを格納できますが、GDALドライバは現在のところ不規則なブロックのラスタには対応していません。</p><p>ソースからコンパイルする場合、ドライバを有効にするには、コンフィギュアに</p><pre class="programlisting">--with-pg=path/to/pg_config</pre><p>を入れる必要があります。まざまなプラットフォーム上でGDALをビルドする際の各種情報については、<a class="ulink" href="http://trac.osgeo.org/gdal/wiki/BuildHints" target="_top">GDAL Build Hints</a>を参照して下さい。 </p><p>GDALをPostGISラスタドライバ付きでコンパイルしているなら、次のコマンドを実行すると、リストにPostGIS Rasterが現れます。 </p><pre class="programlisting">gdalinfo --formats</pre><p>GDALからラスタに関する要約を得るには、gdalinfoを使います。 </p><pre class="programlisting">gdalinfo  "PG:host=localhost port=5432 dbname='mygisdb' user='postgres' password='whatever' schema='someschema' table=sometable"</pre><p>
		 </p><p>他のラスタ書式へデータを出力するには、gdal_translateを使います。下で示すものは、テーブルからのデータ全体を10%のサイズのPNGファイルにして出力します。</p><p>ピクセルバンドタイプについて、出力書式がサポートしない場合は、変換が機能しないことがあります。たとえば、浮動小数点数と32ビット符号なし整数は、JPGや他の書式に簡単には変換しません。</p><p>次に単純な変換の例を示します。</p><pre class="programlisting">gdal_translate -of PNG -outsize 10% 10% "PG:host=localhost port=5432 dbname='mygisdb' user='postgres' password='whatever' schema='someschema' table=sometable" C:\somefile.png</pre><p>また、ドライバ接続文字列内でwhere=...を使って、SQLのWHERE節を使うことができます。次に例を示します。</p><pre class="programlisting">gdal_translate -of PNG -outsize 10% 10% "PG:host=localhost port=5432 dbname='mygisdb' user='postgres' password='whatever' schema='someschema' table=sometable where='filename=\'abcd.sid\''" " C:\somefile.png</pre><pre class="programlisting">gdal_translate -of PNG -outsize 10% 10% "PG:host=localhost port=5432 dbname='mygisdb' user='postgres' password='whatever' schema='someschema' table=sometable where='ST_Intersects(rast, ST_SetSRID(ST_Point(-71.032,42.3793),4326) )' " C:\intersectregion.png</pre><p>より多くの例、構文については<a class="ulink" href="http://trac.osgeo.org/gdal/wiki/frmts_wtkraster.html#a3.2-Readingrasterdatafromthedatabase" target="_top">Reading Raster Data of PostGIS Raster section</a>を参照してください。</p></td></tr><tr class="question"><td align="left" valign="top"><a name="idp100104136"></a><a name="idp100104392"></a><p><b>10.8.</b></p></td><td align="left" valign="top"><p>GDALバイナリはPostGISラスタ機能付きでコンパイルされていますか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>はい。<a class="ulink" href="http://trac.osgeo.org/gdal/wiki/DownloadingGdalBinaries" target="_top">GDAL Binaries</a>のページをご覧下さい。PostgreSQL対応でコンパイルされているものはPostGISラスタを持っています。 </p><p>PostGISラスタは多数の変更が行われているところです。Windows用の最新のナイトリビルドを得るには、Visual StudioでビルドしたTamas Szekeresナイトリビルドを見てみて下さい。GDALの開発途中版とPythonバインディングとMapServer実行ファイルとPostGISラスタドライバが組み込まれています。 SDKバッチファイルをクリックして、そこからコマンドを実行します。 <a class="ulink" href="www.gisinternals.com" target="_top">http://www.gisinternals.com</a>にあります。Visual Studioプロジェクトファイルもあります。</p><p><a class="ulink" href="http://fwtools.maptools.org/" target="_top">Windows用FWTools最新の安定版はラスタサポート付きでコンパイルされています</a>。</p></td></tr><tr class="question"><td align="left" valign="top"><a name="idp100107976"></a><a name="idp100108232"></a><p><b>10.9.</b></p></td><td align="left" valign="top"><p>PostGISラスタデータを見るのに使うことができるツールは何ですか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>GDAL 1.7以上とPostGISラスタドライバサポートとを付けてコンパイルしたMapServerでラスタデータの閲覧に使うことが可能です。QGISは、PostGISラスタドライバをインストールすると、PostGISラスタの閲覧が可能です。</p><p>理論上、GDALを使用してデータをレンダリングするツールはPostGISラスタに対応できるか、ごく小さな労力で対応できます。ご自身でコンパイルする面倒を望まないなら、Tamasさんのバイナ<a class="ulink" href="www.gisinternals.com" target="_top">http://www.gisinternals.com</a>が良い選択です (訳注: Windows用バイナリです)。</p></td></tr><tr class="question"><td align="left" valign="top"><a name="idp100110792"></a><a name="idp100111048"></a><p><b>10.10.</b></p></td><td align="left" valign="top"><p>MapServerの地図にPostGISラスタレイヤを追加するにはどうすればいいですか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>まずGDAL 1.7以上をPostGISラスタサポート付きでコンパイルします。多数の問題が1.8で解消したので、GDAL 1.8以上が望ましいです。また、より多くのPostGISラスタの問題は開発中の版で解消しています。</p><p>他のラスタでできることと同じことができます。MapServerラスタレイヤで使うことができる様々な処理機能のリストを得るには<a class="ulink" href="http://mapserver.org/input/raster.html" target="_top">MapServer Raster processing options</a>を参照して下さい。</p><p>PostGISラスタデータを特に興味深くするのは、それぞれのタイルが様々な標準的なデータベースカラムを持ち得るので、データソースで分割することができる点です。</p><p>次に示す例は、PostGISラスタレイヤをMapServer内で定義する方法です。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>mode=2 では、タイル化されたラスタが求められるもので、PostGIS 2.0とGDAL 1.8ドライバで追加されています。これはGDAL 1.7ドライバにはありません。</p></td></tr></table></div><pre class="programlisting">-- 標準的なラスタの設定を付けてラスタを表示する
LAYER
        NAME coolwktraster
        TYPE raster
        STATUS ON
        DATA "PG:host=localhost port=5432 dbname='somedb' user='someuser' password='whatever'
                schema='someschema' table='cooltable' mode='2'"
        PROCESSING "NODATA=0"
        PROCESSING "SCALE=AUTO"
        #... 他の標準的なラスタ処理関数はここに入ります
        #... クラスは必須ではないですが1バンドデータに使えます
        CLASS
                NAME "boring"
                EXPRESSION ([pixel] &lt; 20)
                COLOR 250 250 250
        END
        CLASS
                NAME "mildly interesting"
                EXPRESSION ([pixel] &gt; 20 AND [pixel] &lt; 1000)
                COLOR 255 0 0
        END
        CLASS
                NAME "very interesting"
                EXPRESSION ([pixel] &gt;= 1000)
                COLOR 0 255 0
        END
END
        </pre><pre class="programlisting">-- 標準的なラスタの設定と、WHERE節をつけてラスタを表示する
LAYER
        NAME soil_survey2009
        TYPE raster
        STATUS ON
        DATA "PG:host=localhost port=5432 dbname='somedb' user='someuser' password='whatever'
                schema='someschema' table='cooltable' where='survey_year=2009' mode='2'"
        PROCESSING "NODATA=0"
        #... other standard raster processing functions here
        #... classes are optional but useful for 1 band data
END
        </pre></td></tr><tr class="question"><td align="left" valign="top"><a name="idp100115912"></a><a name="idp100116168"></a><p><b>10.11.</b></p></td><td align="left" valign="top"><p>現在ラスタデータで使用できる関数は何ですか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p><a class="xref" href="#RT_reference" title="第9章 ラスタ リファレンス">9章<i>ラスタ リファレンス</i></a>のリストを参照して下さい。これよりも多くの関数がありますが、開発途中です。</p><p>将来的に期待できる関数の詳細情報については<a class="ulink" href="http://trac.osgeo.org/postgis/wiki/WKTRaster/PlanningAndFunding" target="_top">PostGIS Raster roadmap page</a>をご覧下さい。</p></td></tr><tr class="question"><td align="left" valign="top"><a name="qa_raster_function_not_unique"></a><a name="idp100143944"></a><p><b>10.12.</b></p></td><td align="left" valign="top"><p>「ERROR: function st_intersects(raster, unknown) is not unique or st_union(geometry,text) is not unique.」というエラーが出ました。解消するにはどうすればいいでしょうか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>引数のひとつがジオメトリでなくジオメトリの文字列表現である場合、一意でない関数エラーが発生します。この場合、PostgreSQLは文字列表現を未知の型とします。そうするとst_intersects(raster, geometry)かst_intersects(raster,raster)かのどちらかになります。理論上両方の関数ともにリクエストに沿うことになるので、一意でないことになります。これを回避するには、GEOMETRY型にキャストして下さい。</p><p>たとえば次のようになっているとします。</p><pre class="programlisting">SELECT rast
 FROM my_raster
   WHERE ST_Intersects(rast, 'SRID=4326;POINT(-10 10)');</pre><p>次の通りにコードを変更すれば文字列表現をジオメトリにキャストします。</p><pre class="programlisting">SELECT rast
 FROM my_raster
   WHERE ST_Intersects(rast, 'SRID=4326;POINT(-10 10)'::geometry);</pre></td></tr><tr class="question"><td align="left" valign="top"><a name="idp100151496"></a><a name="idp100151752"></a><p><b>10.13.</b></p></td><td align="left" valign="top"><p>PostGISラスタとOracle GeoRaster (SDO_GEORATGER)およびSDO_RASTERとどの位違うのでしょうか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>この話題に関するより広範囲な議論については、Jorge Arévaloさんの<a class="ulink" href="http://gis4free.wordpress.com/2010/07/19/oracle-georaster-part-i/" target="_top">Oracle GeoRaster and PostGIS Raster: First impressions </a>をご覧ください。</p><p>ラスタごとのジオリファレンスがレイヤごとのジオリファレンスより優れいていることの主たるものは次の通りです。</p><p>* カバレッジが必ずしも長方形でなくてよいこと (この長方形はしばしば広範囲におよぶラスタカバレッジになります。この文書内にある可能なラスタの配置をご覧ください)</p><p>* オーバラップするラスタ (ベクタからラスタへの変換で欠損無く実装できる点で重要) </p><p>これらの配置はOracleでも可能ですが、多数のSDO_RASTERテーブルと関連付けられる複数のSDO_GEORASTERオブジェクトを格納することになります。複雑なカバレッジになると、データベース上の数百のテーブルにおよぶこともあります。PostGISラスタを使うと、似たようなラスタ配置を一つのテーブルで行うことができます。</p><p>PostGISがユーザに隙間やオーバラップの無い長方形ベクタカバレッジ (完全な長方形トポロジのレイヤ)を強制するのに少し似ています。これは、いくつかのアプリケーションにおいては非常に実際的ですが、実際に行うと、ほとんどのカバレッジにとって、現実的でなく望ましくもないことが分かりました。ベクタ構造には、不連続かつ非長方形のカバレッジを格納する柔軟性が必要です。ラスタ構造が同様に利益を受けることについて、私たちは大きな利点であると考えます。 </p></td></tr><tr class="question"><td align="left" valign="top"><a name="qa_raster_fails_encoding_conversion"></a><a name="idp100156232"></a><p><b>10.14.</b></p></td><td align="left" valign="top"><p>raster2pgsqlにより巨大なファイルのロードがString of N bytes is too long for encoding conversionと言われて失敗しますがどうすればよいでしょうか?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>raster2pgsqlは、ロード用ファイルを生成するときにデータベース接続を行いません。データベースに明示的にデータベースの文字エンコーディングと異なるものを設定している場合には、巨大な (30MB以上)ラスタファイルをロードするときに、<code class="code">bytes is too long for encoding conversion</code>になることがあります。</p><p>これは、一般的には、たとえばデータベースがUTF-8であるのに、Windowsアプリケーションに対応するために、クライアントの文字エンコーディングが<code class="code">WIN1252</code>に設定されている場合に発生します。</p><p>これを回避策するには、ロードする間、クライアントの文字エンコーディングをデータベースと同じにします。明示的な文字エンコーディング設定をスクリプトに入れることで実現できます。たとえば、Windows上では次のようにします。 </p><pre class="programlisting">set PGCLIENTENCODING=UTF8</pre><p>Unix/Linuxの場合には、次のようにします。 </p><pre class="programlisting">export PGCLIENTENCODING=UTF8</pre><p>Goryさんがこの問題の詳細を<a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2209" target="_top">http://trac.osgeo.org/postgis/ticket/2209</a>に記述しています。</p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq_security_change_1"></a><a name="idp100190664"></a><p><b>10.15.</b></p></td><td align="left" valign="top"><p>ST_FromGDALRasterを使うと<code class="code">ERROR: RASTER_fromGDALRaster: Could not open bytea with GDAL. Check that the bytea is of a GDAL supported format.</code>というエラーが出ます。また、ST_AsPNGや他の入力関数を使おうとすると<code class="code">ERROR: rt_raster_to_gdal: Could not load the output GDAL driver</code>というエラーが出ます。</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>PostGIS 2.1.3と2.0.5では、セキュリティ変更が行われ、全てのGDALドライバとデータベース外ラスタは、デフォルトでは使えなくなりました。リリースノートは<a class="ulink" href="http://postgis.net/2014/05/19/postgis-2.0.6_and_2.1.3" target="_top">PostGIS 2.0.6, 2.1.3 security release</a>にあります。特定のドライバまたは全てのドライバを再有効化する方法と、データベース外ラスタ機能を再有効化する方法については、<a class="xref" href="#install_short_version" title="2.1. 簡略版">「簡略版」</a>をご覧下さい。</p></td></tr></tbody></table></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="Topology"></a>第11章 トポロジ</h1></div></div></div><div class="toc"><p><b>目次</b></p><dl class="toc"><dt><span class="sect1"><a href="#Topology_Types">11.1. トポロジ型</a></span></dt><dt><span class="sect1"><a href="#Topology_Domains">11.2. トポロジドメイン</a></span></dt><dt><span class="sect1"><a href="#Topology_ManagementFunctions">11.3. トポロジ管理とTopoGeometry管理</a></span></dt><dt><span class="sect1"><a href="#Topology_Constructors">11.4. トポロジコンストラクタ</a></span></dt><dt><span class="sect1"><a href="#Topology_Editing">11.5. トポロジエディタ</a></span></dt><dt><span class="sect1"><a href="#Topology_Accessors">11.6. トポロジアクセサ</a></span></dt><dt><span class="sect1"><a href="#Topology_Processing">11.7. トポロジ処理</a></span></dt><dt><span class="sect1"><a href="#TopoGeometry_Constructors">11.8. TopoGeometryコンストラクタ</a></span></dt><dt><span class="sect1"><a href="#TopoGeometry_Editors">11.9. TopoGeometryエディタ</a></span></dt><dt><span class="sect1"><a href="#TopoGeom_Accessors">11.10. TopoGeometryアクセサ</a></span></dt><dt><span class="sect1"><a href="#TopoGeometry_Outputs">11.11. TopoGeometry出力</a></span></dt><dt><span class="sect1"><a href="#Topology_Relationships">11.12. トポロジ空間関係関数</a></span></dt></dl></div><p>PostGISトポロジ型と関数は、フェイス、エッジ、ノード等のトロポジオブジェクトを管理するために使います。 </p><p>PostGIS Day Paris 2011におけるSandro Santilliさんの講演が、PostGISトポロジの概略説明として良いです。<a class="ulink" href="http://strk.keybit.net/projects/postgis/Paris2011_TopologyWithPostGIS_2_0.pdf" target="_top">Topology with PostGIS 2.0 slide deck</a>にあります。</p><p>Vincent Picavetさんはトポロジとは何か、どのように使われるか、および、対応するFOSS4Gツールに関する良い概略説明を<a class="ulink" href="https://github.com/Oslandia/presentations/blob/master/pgconf_eu_2012/pgconfeu2012_vincent_picavet_postgis_topology.pdf?raw=true" target="_top">PostGIS Topology PGConf EU 2012</a>で出しています。</p><p>トポロジベースのGISデータベースの例として<a class="ulink" href="https://www.census.gov/geo/maps-data/data/tiger.html" target="_top">US Census Topologically Integrated Geographic Encoding and Referencing System (TIGER)</a>があります。PostGISトポロジの試験がしたくて、何らかのデータが必要なら<a class="xref" href="#Topology_Load_Tiger" title="Topology_Load_Tiger">Topology_Load_Tiger</a>をご覧下さい</p><p>PostGISトポロジモジュールは前の版にもありましたが、正式なPostGIS文書の中には入れていませんでした。PostGIS 2.0.0 では、全ての非推奨関数を無くし、知られていた使いやすさの問題を解決し、機能と関数の文書をより良くし、新しい関数を追加し、SQL-MM標準により準拠させるために、大整理を行っています。</p><p>このプロジェクトの詳細情報は<a class="ulink" href="http://trac.osgeo.org/postgis/wiki/UsersWikiPostgisTopology" target="_top">PostGIS Topology Wiki</a>にあります。</p><p>このモジュールに関する全ての関数とテーブルは、<code class="varname">topology</code>スキーマにインストールされます。</p><p>SQL/MM標準で定義される関数はST_プリフィクスを持ち、PostGIS特有の関数はこのプリフィクスを持ちません。</p><p>PostGIS 2.0から、トポロジ対応はデフォルトでビルドされます。<a class="xref" href="#postgis_installation" title="第2章 PostGISインストール">2章<i>PostGISインストール</i></a>に書かれている通り、ビルド時のコンフィギュアオプションで、--without-topology を指定すると無効化できます。</p><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Topology_Types"></a>11.1. トポロジ型</h2></div><div><div class="abstract"><p class="title"><b>概要</b></p><p>本節では、PostGISトポロジでインストールされるPostgreSQLデータ型の一覧を挙げます。独自に関数をデザインする際に特に重要となる、キャストでの挙動を記述していることにご注意ください。 </p></div></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#getfaceedges_returntype">getfaceedges_returntype</a></span><span class="refpurpose"> — 順列番号とエッジ番号の複合型です。<code class="varname">ST_GetFaceEdges</code>が返す型です。</span></dt><dt><span class="refentrytitle"><a href="#topogeometry">TopoGeometry</a></span><span class="refpurpose"> — トポロジとして定義されたジオメトリを表現する型です。</span></dt><dt><span class="refentrytitle"><a href="#validatetopology_returntype">validatetopology_returntype</a></span><span class="refpurpose"> — エラーメッセージとエラーの場所を示す、id1とid2からなる複合型です。これは<code class="varname">ValidateTopology</code>が返す型です。</span></dt></dl></div><div class="refentry"><a name="getfaceedges_returntype"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>getfaceedges_returntype — 順列番号とエッジ番号の複合型です。<code class="varname">ST_GetFaceEdges</code>が返す型です。</p></div><div class="refsection"><a name="idp100335816"></a><h2>説明</h2><p>順列番号とエッジ番号の複合型です<code class="varname">ST_GetFaceEdges</code>関数が返す型です。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><code class="varname">sequence</code> (整数): トポロジスキーマとSRIDを定義するtopology.topologyテーブルで定義されるトポロジへの参照です。</p></li><li class="listitem"><p><code class="varname">edge</code> (整数): エッジの識別番号です。</p></li></ol></div></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="topogeometry"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>TopoGeometry — トポロジとして定義されたジオメトリを表現する型です。</p></div><div class="refsection"><a name="idp100341704"></a><h2>説明</h2><p>特定のトポロジレイヤ内のトポロジジオメトリを参照する複合型で、特定のタイプと特定のIDを持ちます。TopoGeometryの要素はtopology_id, layer_id, id integer, type integerの各属性です。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><code class="varname">topology_id</code> (整数): トポロジスキーマとSRIDを定義するtopology.topologyテーブルで定義されているトポロジへの参照です。</p></li><li class="listitem"><p><code class="varname">layer_id</code> (整数): TopoGeometryが属するlayersテーブルにおけるlayer_idです。topology_idとlayer_idとの組み合わせで、topology.layersテーブルを一意に参照できます。</p></li><li class="listitem"><p><code class="varname">id</code> (整数): それぞれのトポロジでTopoGeometryを一意にするための順序整数で、自動生成されます。</p></li><li class="listitem"><p><code class="varname">type</code> (1から4の整数でジオメトリタイプを定義): 1:[multi]point, 2:[multi]line, 3:[multi]poly, 4:collectionとなります。</p></li></ol></div></div><div class="refsection"><a name="idp100347592"></a><h2>キャストの挙動</h2><p>本節では、このデータ型で許容される明示的なキャストと自動キャストの一覧を挙げます。</p><div class="informaltable"><table class="informaltable" border="1"><colgroup><col><col></colgroup><tbody><tr><td>キャスト先</td><td>挙動</td></tr><tr><td>geometry</td><td>自動</td></tr></tbody></table></div></div><div class="refsection"><a name="idp100352968"></a><h2>関連情報</h2><p><a class="xref" href="#CreateTopoGeom" title="CreateTopoGeom">CreateTopoGeom</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="validatetopology_returntype"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>validatetopology_returntype — エラーメッセージとエラーの場所を示す、id1とid2からなる複合型です。これは<code class="varname">ValidateTopology</code>が返す型です。</p></div><div class="refsection"><a name="idp100360392"></a><h2>説明</h2><p>エラーメッセージと二つの整数からなる複合型です。<a class="xref" href="#ValidateTopology" title="ValidateTopology">ValidateTopology</a>関数は、これの集合を返します。評価エラーを示し、id1とid2でエラーを含むトポロジオブジェクトの識別番号を示します。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><code class="varname">error</code> (varchar): エラーのタイプを示します。 </p><p>現在のエラー記述: coincident nodes (訳注: ノード重複), edge crosses node (訳注: エッジとノードのクロス), edge not simple (訳注: 単純でないエッジ), edge end node geometry mis-match (訳注: 終了ノードジオメトリの不整合), edge start node geometry mismatch (訳注: 開始ノードジオメトリの不整合), face overlaps face (訳注: フェイス同士のオーバラップ), face within face (訳注: フェイス間の包含) </p></li><li class="listitem"><p><code class="varname">id1</code> (整数): エラーを持つエッジ/フェイス/ノードの識別番号を示します。</p></li><li class="listitem"><p><code class="varname">id2</code> (整数): 2オブジェクトでのエラーにおける二つ目のエッジ/ノードの識別番号を示します。</p></li></ol></div></div><div class="refsection"><a name="idp100366280"></a><h2>関連情報</h2><p><a class="xref" href="#ValidateTopology" title="ValidateTopology">ValidateTopology</a></p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Topology_Domains"></a>11.2. トポロジドメイン</h2></div><div><div class="abstract"><p class="title"><b>概要</b></p><p>本節では、PostGISトポロジでインストールされるPostgreSQLドメインの一覧を挙げます。ドメインは、オブジェクト型のように扱え、関数やテーブルカラムのオブジェクトを返します。ドメインは存在するチェック制約を持つ既存の型である点で、型とは違います。 </p></div></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#topoelement">TopoElement</a></span><span class="refpurpose"> — 二つの整数の配列で、通常TopoGeometry要素を識別するために使われます。</span></dt><dt><span class="refentrytitle"><a href="#topoelementarray">TopoElementArray</a></span><span class="refpurpose"> — TopoElementオブジェクトの配列</span></dt></dl></div><div class="refentry"><a name="topoelement"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>TopoElement — 二つの整数の配列で、通常TopoGeometry要素を識別するために使われます。</p></div><div class="refsection"><a name="idp100375368"></a><h2>説明</h2><p>二つの整数の配列で、単純または階層を持つ<a class="xref" href="#topogeometry" title="TopoGeometry">TopoGeometry</a>の一つのコンポーネントを表現するために使われます。 </p><p>単純なTopoGeometryの場合は、配列の最初の要素がトポロジのプリミティブの識別を表現し、二つ目の要素がタイプ (1:ノード 2:エッジ, 3:フェイス)を表現します。階層的なTopoGeometryの場合は、一つ目の要素が子のTopoGeometryの識別子を表現し、二つ目の要素はレイヤ識別子を表現します。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>階層的なTopoGeometryについては、全ての子のTopoGeometry要素は同じ子レイヤから来ます。子レイヤは、定義されたTopoGeometryのレイヤのtopology.layerレコード内で指定されます。 </p></td></tr></table></div></div><div class="refsection"><a name="idp100377800"></a><h2>例</h2><pre class="programlisting">SELECT te[1] AS id, te[2] AS type FROM
( SELECT ARRAY[1,2]::topology.topoelement AS te ) f;
 id | type
----+------
  1 |    2
                 </pre><pre class="programlisting">SELECT ARRAY[1,2]::topology.topoelement;
  te
-------
 {1,2}
                 </pre><pre class="programlisting">-- 3要素配列をtopoelementに使った際に発生するエラーの例
-- ご注意: topoelementは、必ず2要素を持ちます。次元チェックにひっかかります。
SELECT ARRAY[1,2,3]::topology.topoelement;
ERROR:  value for domain topology.topoelement violates check constraint "dimensions"
                 </pre></div><div class="refsection"><a name="idp100384456"></a><h2>関連情報</h2><p><a class="xref" href="#GetTopoGeomElements" title="GetTopoGeomElements">GetTopoGeomElements</a>, <a class="xref" href="#topoelementarray" title="TopoElementArray">TopoElementArray</a>, <a class="xref" href="#topogeometry" title="TopoGeometry">TopoGeometry</a>, <a class="xref" href="#TopoGeom_addElement" title="TopoGeom_addElement">TopoGeom_addElement</a>, <a class="xref" href="#TopoGeom_remElement" title="TopoGeom_remElement">TopoGeom_remElement</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="topoelementarray"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>TopoElementArray — TopoElementオブジェクトの配列</p></div><div class="refsection"><a name="idp100389064"></a><h2>説明</h2><p>1以上のTopoElementオブジェクトの配列で、通常はTopoGeometryオブジェクトのコンポーネントを分配するために使われます。</p></div><div class="refsection"><a name="idp100390216"></a><h2>例</h2><pre class="programlisting">SELECT '{{1,2},{4,3}}'::topology.topoelementarray As tea;
  tea
-------
{{1,2},{4,3}}

-- より長く書いた等価なもの --
SELECT ARRAY[ARRAY[1,2], ARRAY[4,3]]::topology.topoelementarray As tea;

  tea
-------
{{1,2},{4,3}}

-- トポロジに同梱されている配列集約関数 --
SELECT topology.TopoElementArray_Agg(ARRAY[e,t]) As tea
  FROM generate_series(1,4) As e CROSS JOIN generate_series(1,3) As t;
  tea
--------------------------------------------------------------------------
{{1,1},{1,2},{1,3},{2,1},{2,2},{2,3},{3,1},{3,2},{3,3},{4,1},{4,2},{4,3}}
                 </pre><pre class="programlisting">SELECT '{{1,2,4},{3,4,5}}'::topology.topoelementarray As tea;
ERROR:  value for domain topology.topoelementarray violates check constraint "dimensions"
                 </pre></div><div class="refsection"><a name="idp100392264"></a><h2>関連情報</h2><p><a class="xref" href="#topoelement" title="TopoElement">TopoElement</a>, <a class="xref" href="#GetTopoGeomElementArray" title="GetTopoGeomElementArray">GetTopoGeomElementArray</a>, <a class="xref" href="#TopoElementArray_Agg" title="TopoElementArray_Agg">TopoElementArray_Agg</a> </p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Topology_ManagementFunctions"></a>11.3. トポロジ管理とTopoGeometry管理</h2></div><div><div class="abstract"><p class="title"><b>概要</b></p><p>本節では、新しいトポロジスキーマの構築、トポロジの評価、TopoGeometryカラムの管理のためのトポロジ関数の一覧を挙げます。</p></div></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#AddTopoGeometryColumn">AddTopoGeometryColumn</a></span><span class="refpurpose"> — 既存のテーブルにTopoGeometryカラムを追加し、topology.layer内に新しいレイヤとして新しいカラムを登録して、新しい layer_id を返します。</span></dt><dt><span class="refentrytitle"><a href="#DropTopology">DropTopology</a></span><span class="refpurpose"> — 使用上の注意: この関数によって、トポロジスキーマが削除され、topology.topologyテーブルからの参照が削除され、geometry_columnsテーブルから削除対象スキーマ内のテーブルへの参照が削除されます。</span></dt><dt><span class="refentrytitle"><a href="#DropTopoGeometryColumn">DropTopoGeometryColumn</a></span><span class="refpurpose"> — <code class="varname">schema_name</code>で指定されたスキーマ内にある<code class="varname">table_name</code>で指定されたテーブルからTopoGeometryカラムを削除し、topology.layerテーブルにある登録を解除します。</span></dt><dt><span class="refentrytitle"><a href="#Populate_Topology_Layer">Populate_Topology_Layer</a></span><span class="refpurpose"> — テーブルからメタデータを読み、topology.layerテーブルに不足しているものを追加します。</span></dt><dt><span class="refentrytitle"><a href="#TopologySummary">TopologySummary</a></span><span class="refpurpose"> — トポロジ名を取り、トポロジ内のオブジェクトの型に関する概要の全体を提供します。</span></dt><dt><span class="refentrytitle"><a href="#ValidateTopology">ValidateTopology</a></span><span class="refpurpose"> — トポロジの問題についての詳細を示すvalidatetopology_returntypeの集合を返します。</span></dt></dl></div><div class="refentry"><a name="AddTopoGeometryColumn"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>AddTopoGeometryColumn — 既存のテーブルにTopoGeometryカラムを追加し、topology.layer内に新しいレイヤとして新しいカラムを登録して、新しい layer_id を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">AddTopoGeometryColumn</b>(</code>varchar  <var class="pdparam">topology_name</var>, varchar  <var class="pdparam">schema_name</var>, varchar  <var class="pdparam">table_name</var>, varchar  <var class="pdparam">column_name</var>, varchar  <var class="pdparam">feature_type</var><code>)</code>;</p><p><code class="funcdef">integer <b class="fsfunc">AddTopoGeometryColumn</b>(</code>varchar  <var class="pdparam">topology_name</var>, varchar  <var class="pdparam">schema_name</var>, varchar  <var class="pdparam">table_name</var>, varchar  <var class="pdparam">column_name</var>, varchar  <var class="pdparam">feature_type</var>, integer  <var class="pdparam">child_layer</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp100412360"></a><h2>説明</h2><p>それぞれのTopoGeometryオブジェクトは、特定のトポロジの特定のレイヤに属します。TopoGeometryオブジェクト生成の前に、トポロジレイヤの生成が必要です。トポロジレイヤは地物テーブルとトポロジとで組織されます。また、タイプと階層の情報を持ちます。レイヤの生成にはAddTopoGeometryColumn()を使います。 </p><p>この関数は、リクエストされたカラムをテーブルに追加し、topology.layerテーブルに、与えられた全ての情報のレコードを追加します。</p><p>[child_layer]を指定しない (またはNULLを指定する)場合、このレイヤは、基本的なTopoGeometry (プリミティブなトポロジ要素で構成)を含みます。指定する場合、このレイヤは階層的なTopoGeometry (child_layerからのTopoGeometryで構成)を持ちます。</p><p>レイヤが生成される (これの識別番号は、AddTopoGeometryColumn関数が返します)と、TopoGeometryオブジェクトをこの中に構築する準備ができます。</p><p>妥当な<code class="varname">feature_type</code>は、POINT, LINE, POLYGON, COLLECTIONです。</p><p>Availability: 1.?</p></div><div class="refsection"><a name="idp100416072"></a><h2>例</h2><pre class="programlisting">-- この例では、topology_nameとshecma_nameが異なる場合には、
-- 異なるスキーマに作ることができましたが、
-- ma_topoスキーマに新しいテーブルを作ったことに注意して下さい。

CREATE SCHEMA ma;
CREATE TABLE ma.parcels(gid serial, parcel_id varchar(20) PRIMARY KEY, address text);
SELECT topology.AddTopoGeometryColumn('ma_topo', 'ma', 'parcels', 'topo', 'POLYGON');</pre><pre class="programlisting">CREATE SCHEMA ri;
CREATE TABLE ri.roads(gid serial PRIMARY KEY, road_name text);
SELECT topology.AddTopoGeometryColumn('ri_topo', 'ri', 'roads', 'topo', 'LINE');
</pre></div><div class="refsection"><a name="idp100418120"></a><h2>関連情報</h2><p><a class="xref" href="#CreateTopology" title="CreateTopology">CreateTopology</a>, <a class="xref" href="#CreateTopoGeom" title="CreateTopoGeom">CreateTopoGeom</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="DropTopology"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>DropTopology — 使用上の注意: この関数によって、トポロジスキーマが削除され、topology.topologyテーブルからの参照が削除され、geometry_columnsテーブルから削除対象スキーマ内のテーブルへの参照が削除されます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">DropTopology</b>(</code>varchar  <var class="pdparam">topology_schema_name</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp100424264"></a><h2>説明</h2><p>トポロジスキーマを削除し、topology.topologyテーブルからの参照を削除し、geometry_columnsテーブルから削除対象スキーマ内のテーブルへの参照を削除します。この関数は *十分に注意してご使用下さい*。残しておきたかったデータが破壊される可能性があります。スキーマが存在しない場合、スキーマへの参照に関するエントリの削除だけを行います。</p><p>Availability: 1.?</p></div><div class="refsection"><a name="idp100426056"></a><h2>例</h2><p>ma_topoスキーマをカスケード削除し、topology.topologyにある参照のうち関係するものを全て削除します。</p><pre class="programlisting">SELECT topology.DropTopology('ma_topo');</pre></div><div class="refsection"><a name="idp100427976"></a><h2>関連情報</h2><p></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="DropTopoGeometryColumn"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>DropTopoGeometryColumn — <code class="varname">schema_name</code>で指定されたスキーマ内にある<code class="varname">table_name</code>で指定されたテーブルからTopoGeometryカラムを削除し、topology.layerテーブルにある登録を解除します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">DropTopoGeometryColumn</b>(</code>varchar  <var class="pdparam">schema_name</var>, varchar  <var class="pdparam">table_name</var>, varchar  <var class="pdparam">column_name</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp100448456"></a><h2>説明</h2><p><code class="varname">schema_name</code>で指定されたスキーマ内にある<code class="varname">table_name</code>で指定されたテーブルからTopoGeometryカラムを削除し、topology.layerテーブルにある登録を解除します。削除の概要報告を返します。ご注意: この関数は、参照整合性チェックをすり抜けるために、まずNULL値に上書きしてから削除します。</p><p>Availability: 1.?</p></div><div class="refsection"><a name="idp100450888"></a><h2>例</h2><pre class="programlisting">SELECT topology.DropTopoGeometryColumn('ma_topo', 'parcel_topo', 'topo');</pre></div><div class="refsection"><a name="idp100452424"></a><h2>関連情報</h2><p><a class="xref" href="#AddTopoGeometryColumn" title="AddTopoGeometryColumn">AddTopoGeometryColumn</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="Populate_Topology_Layer"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Populate_Topology_Layer — テーブルからメタデータを読み、topology.layerテーブルに不足しているものを追加します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">setof record <b class="fsfunc">Populate_Topology_Layer</b>(</code><code>)</code>;</p></div></div><div class="refsection"><a name="idp100457544"></a><h2>説明</h2><p>テーブルの制約を読み、<code class="varname">topology.layer</code>テーブルに不足しているものを追加します。トポロジデータをスキーマに格納した後に、トポロジカタログで抜けているものを訂正するのに使います。</p><p>生成されたもののリストを返します。返されるカラムは <code class="varname">schema_name</code>, <code class="varname">table_name</code>, <code class="varname">feature_column</code>です。</p><p>Availability: 2.3.0</p></div><div class="refsection"><a name="idp100461256"></a><h2>例</h2><pre class="programlisting">SELECT CreateTopology('strk_topo');
CREATE SCHEMA strk;
CREATE TABLE strk.parcels(gid serial, parcel_id varchar(20) PRIMARY KEY, address text);
SELECT topology.AddTopoGeometryColumn('strk_topo', 'strk', 'parcels', 'topo', 'POLYGON');
-- この地物はすでに登録されているので返されるレコードはありません
SELECT *
  FROM topology.Populate_Topology_Layer();

-- 再構築してみます
TRUNCATE TABLE topology.layer;

SELECT *
  FROM topology.Populate_Topology_Layer();

SELECT topology_id,layer_id, schema_name As sn, table_name As tn, feature_column As fc
FROM topology.layer;

                                </pre><pre class="screen">schema_name | table_name | feature_column
-------------+------------+----------------
 strk        | parcels    | topo
(1 row)

 topology_id | layer_id |  sn  |   tn    |  fc
-------------+----------+------+---------+------
           2 |        2 | strk | parcels | topo
(1 row)</pre></div><div class="refsection"><a name="idp100463304"></a><h2>関連情報</h2><p><a class="xref" href="#AddTopoGeometryColumn" title="AddTopoGeometryColumn">AddTopoGeometryColumn</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="TopologySummary"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>TopologySummary — トポロジ名を取り、トポロジ内のオブジェクトの型に関する概要の全体を提供します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">TopologySummary</b>(</code>varchar  <var class="pdparam">topology_schema_name</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp100469192"></a><h2>説明</h2><p>トポロジ名を取り、トポロジ内のオブジェクトの型に関する概要の全体を提供します。</p><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp100471112"></a><h2>例</h2><pre class="programlisting">SELECT topology.topologysummary('city_data');
                    topologysummary
--------------------------------------------------------
 Topology city_data (329), SRID 4326, precision: 0
 22 nodes, 24 edges, 10 faces, 29 topogeoms in 5 layers
 Layer 1, type Polygonal (3), 9 topogeoms
  Deploy: features.land_parcels.feature
 Layer 2, type Puntal (1), 8 topogeoms
  Deploy: features.traffic_signs.feature
 Layer 3, type Lineal (2), 8 topogeoms
  Deploy: features.city_streets.feature
 Layer 4, type Polygonal (3), 3 topogeoms
  Hierarchy level 1, child layer 1
  Deploy: features.big_parcels.feature
 Layer 5, type Puntal (1), 1 topogeoms
  Hierarchy level 1, child layer 2
  Deploy: features.big_signs.feature</pre></div><div class="refsection"><a name="idp100472648"></a><h2>関連情報</h2><p><a class="xref" href="#Topology_Load_Tiger" title="Topology_Load_Tiger">Topology_Load_Tiger</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ValidateTopology"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ValidateTopology — トポロジの問題についての詳細を示すvalidatetopology_returntypeの集合を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">setof validatetopology_returntype <b class="fsfunc">ValidateTopology</b>(</code>varchar  <var class="pdparam">topology_schema_name</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp100478408"></a><h2>説明</h2><p>トポロジの問題についての詳細を示す<a class="xref" href="#validatetopology_returntype" title="validatetopology_returntype">validatetopology_returntype</a>の集合を返します。ありえるエラーと返されたIDが表現するものの一覧は次のとおりです。</p><div class="informaltable"><table class="informaltable" border="1"><colgroup><col><col><col></colgroup><thead><tr><th>Error</th><th>id1</th><th>id2</th></tr></thead><tbody><tr><td>edge crosses node (訳注: エッジとノードのクロス)</td><td>edge_id</td><td>node_id</td></tr><tr><td>invalid edge (訳注: 不正なエッジ)</td><td>edge_id</td><td>null</td></tr><tr><td>edge not simple (訳注: 単純でないエッジ)</td><td>edge_id</td><td>null</td></tr><tr><td>edge crosses edge (訳注: エッジとエッジのクロス)</td><td>edge_id</td><td>edge_id</td></tr><tr><td>edge start node geometry mis-match (訳注: 開始ノードジオメトリの不整合)</td><td>edge_id</td><td>node_id</td></tr><tr><td>edge end node geometry mis-match (訳注: 終了ノードジオメトリの不整合)</td><td>edge_id</td><td>node_id</td></tr><tr><td>face without edges (訳注: エッジのないフェイス)</td><td>face_id</td><td>null</td></tr><tr><td>face has no rings (訳注: 環のないフェイス)</td><td>face_id</td><td>null</td></tr><tr><td>face overlaps face (訳注: フェイス同士のオーバラップ)</td><td>face_id</td><td>face_id</td></tr><tr><td>face within face (訳注: フェイス間の包含) </td><td>内側のface_id</td><td>外側のface_id</td></tr></tbody></table></div><p>Availability: 1.0.0</p><p>Enhanced: 2.0.0では、より効果的なエッジ交差検出が可能になり、以前の版で残っていた偽陽性を解決しています。</p><p>Changed: 2.2.0 エラーの記述と矛盾しないように'edge crosses node'のid1とid2の値が入れ替わっています。</p></div><div class="refsection"><a name="idp100500168"></a><h2>例</h2><pre class="programlisting">SELECT * FROM  topology.ValidateTopology('ma_topo');
      error        | id1 | id2
-------------------+-----+-----
face without edges |   0 |
                                </pre></div><div class="refsection"><a name="idp100501704"></a><h2>関連情報</h2><p><a class="xref" href="#validatetopology_returntype" title="validatetopology_returntype">validatetopology_returntype</a>, <a class="xref" href="#Topology_Load_Tiger" title="Topology_Load_Tiger">Topology_Load_Tiger</a></p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Topology_Constructors"></a>11.4. トポロジコンストラクタ</h2></div><div><div class="abstract"><p class="title"><b>概要</b></p><p>本節では、新しいトポロジを生成するトポロジ関数を挙げます。</p></div></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#CreateTopology">CreateTopology</a></span><span class="refpurpose"> — 新しいトポロジスキーマを生成し、新しいスキーマをtopology.topologyテーブルに登録します。</span></dt><dt><span class="refentrytitle"><a href="#CopyTopology">CopyTopology</a></span><span class="refpurpose"> — トポロジ構造 (ノード、エッジ、フェイス、レイヤ、TopoGeometry)を複写します。</span></dt><dt><span class="refentrytitle"><a href="#ST_InitTopoGeo">ST_InitTopoGeo</a></span><span class="refpurpose"> — 新しいトポロジスキーマを生成し、topology.topologyテーブルに新しいスキーマを登録し、処理の概要を表示します。</span></dt><dt><span class="refentrytitle"><a href="#ST_CreateTopoGeo">ST_CreateTopoGeo</a></span><span class="refpurpose"> — 空のトポロジにジオメトリのコレクションを追加し、成否を示すメッセージを返します。  </span></dt><dt><span class="refentrytitle"><a href="#TopoGeo_AddPoint">TopoGeo_AddPoint</a></span><span class="refpurpose"> — 許容差を使って既存のトポロジにポイントを追加し、可能ならエッジを分割します。  </span></dt><dt><span class="refentrytitle"><a href="#TopoGeo_AddLineString">TopoGeo_AddLineString</a></span><span class="refpurpose"> — 許容差を使って既存のトポロジにラインストリングを追加し、可能ならエッジ/フェイスを分割します。 </span></dt><dt><span class="refentrytitle"><a href="#TopoGeo_AddPolygon">TopoGeo_AddPolygon</a></span><span class="refpurpose"> — 許容差を使って既存のトポロジにポリゴンを追加し、可能ならエッジ/フェイスを分割します。 </span></dt></dl></div><div class="refentry"><a name="CreateTopology"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>CreateTopology — 新しいトポロジスキーマを生成し、新しいスキーマをtopology.topologyテーブルに登録します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">CreateTopology</b>(</code>varchar  <var class="pdparam">topology_schema_name</var><code>)</code>;</p><p><code class="funcdef">integer <b class="fsfunc">CreateTopology</b>(</code>varchar  <var class="pdparam">topology_schema_name</var>, integer  <var class="pdparam">srid</var><code>)</code>;</p><p><code class="funcdef">integer <b class="fsfunc">CreateTopology</b>(</code>varchar  <var class="pdparam">topology_schema_name</var>, integer  <var class="pdparam">srid</var>, double precision  <var class="pdparam">prec</var><code>)</code>;</p><p><code class="funcdef">integer <b class="fsfunc">CreateTopology</b>(</code>varchar  <var class="pdparam">topology_schema_name</var>, integer  <var class="pdparam">srid</var>, double precision  <var class="pdparam">prec</var>, boolean  <var class="pdparam">hasz</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp100534984"></a><h2>説明</h2><p><code class="varname">topology_name</code>で指定したスキーマを生成し、テーブル (<code class="varname">edge_data</code>, <code class="varname">face</code>, <code class="varname">node</code>, <code class="varname">relation</code>)を生成し、topology.topologyテーブルに新しいトポロジを登録します。トポロジテーブルにおけるトポロジのIDを返します。sridは、spatial_ref_sysテーブルで定義されている空間参照系識別番号です。トポロジの名称は一意でなければなりません。許容差は、空間参照系で規定される単位です。<code class="varname">prec</code>で許容差を指定しない場合は 0 とされます。</p><p>SQL/MMの<a class="xref" href="#ST_InitTopoGeo" title="ST_InitTopoGeo">ST_InitTopoGeo</a>に似ていますが、少しだけこちらの方が機能追加されています。<code class="varname">hasz</code>は、指定されていない場合はfalseとされます。</p><p>Availability: 1.?</p></div><div class="refsection"><a name="idp100540104"></a><h2>例</h2><p>本例ではメートル単位マサチューセッツ州平面のエッジ、フェイスとリレーションを保存するための、ma_topoという新しいスキーマを生成します。空間参照系はメートルを単位としているので、許容差は0.5メートルとなります。</p><pre class="programlisting">SELECT topology.CreateTopology('ma_topo',26986, 0.5);</pre><p>ロードアイランド州トポロジをフィート単位州平面で生成</p><pre class="programlisting">SELECT topology.CreateTopology('ri_topo',3438) As topoid;
topoid
------
2</pre></div><div class="refsection"><a name="idp100542920"></a><h2>関連情報</h2><p><a class="xref" href="#spatial_ref_sys" title="4.3.1. SPATIAL_REF_SYSテーブルと空間参照系">「SPATIAL_REF_SYSテーブルと空間参照系」</a>, <a class="xref" href="#ST_InitTopoGeo" title="ST_InitTopoGeo">ST_InitTopoGeo</a>, <a class="xref" href="#Topology_Load_Tiger" title="Topology_Load_Tiger">Topology_Load_Tiger</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="CopyTopology"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>CopyTopology — トポロジ構造 (ノード、エッジ、フェイス、レイヤ、TopoGeometry)を複写します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">CopyTopology</b>(</code>varchar  <var class="pdparam">existing_topology_name</var>, varchar  <var class="pdparam">new_name</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp100550472"></a><h2>説明</h2><p><code class="varname">new_topology_name</code>で指定した名前のトポロジを生成し、<code class="varname">existing_topology_name</code>から取得されるSRIDと精度にして、ノード、エッジ、フェイス、レイヤ、TopoGeometryを複製します。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>topology.layerの新しい行には、schema_name, table_name, feature_columnの統合された値が入ります。TopoGeometryが定義には存在しても、どのユーザレベルのテーブルにも存在しないためです。 </p></td></tr></table></div><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp100553416"></a><h2>例</h2><p>本例では、ma_topoという名前のトポロジにバックアップをとっています。 </p><pre class="programlisting">SELECT topology.CopyTopology('ma_topo', 'ma_topo_bakup');</pre></div><div class="refsection"><a name="idp100555336"></a><h2>関連情報</h2><p><a class="xref" href="#spatial_ref_sys" title="4.3.1. SPATIAL_REF_SYSテーブルと空間参照系">「SPATIAL_REF_SYSテーブルと空間参照系」</a>, <a class="xref" href="#CreateTopology" title="CreateTopology">CreateTopology</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_InitTopoGeo"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_InitTopoGeo — 新しいトポロジスキーマを生成し、topology.topologyテーブルに新しいスキーマを登録し、処理の概要を表示します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_InitTopoGeo</b>(</code>varchar  <var class="pdparam">topology_schema_name</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp100561480"></a><h2>説明</h2><p>これはCreateTopologyのSQL-MM互換ですが、CreateTopologyにある空間参照系とtoleranceオプションがありません。また、トポロジIDを返すのではなく、生成に関する記述を出力します。</p><p>Availability: 1.?</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.17</p></div><div class="refsection"><a name="idp100564680"></a><h2>例</h2><pre class="programlisting">SELECT topology.ST_InitTopoGeo('topo_schema_to_create') AS topocreation;
                      astopocreation
------------------------------------------------------------
 Topology-Geometry 'topo_schema_to_create' (id:7) created.
                                </pre></div><div class="refsection"><a name="idp100566216"></a><h2>関連情報</h2><p><a class="xref" href="#CreateTopology" title="CreateTopology">CreateTopology</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_CreateTopoGeo"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_CreateTopoGeo — 空のトポロジにジオメトリのコレクションを追加し、成否を示すメッセージを返します。  </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_CreateTopoGeo</b>(</code>varchar  <var class="pdparam">atopology</var>, geometry  <var class="pdparam">acollection</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp100573128"></a><h2>説明</h2><p>空のトポロジにジオメトリのコレクションを追加し、成否を示すメッセージを返します。  </p><p>空トポロジの追加に使えます。</p><p>Availability: 2.0 </p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.18</p></div><div class="refsection"><a name="idp100576840"></a><h2>例</h2><pre class="programlisting">-- トポロジの投入 --
SELECT topology.ST_CreateTopoGeo('ri_topo',
 ST_GeomFromText('MULTILINESTRING((384744 236928,384750 236923,384769 236911,384799 236895,384811 236890,384833 236884,
  384844 236882,384866 236881,384879 236883,384954 236898,385087 236932,385117 236938,
  385167 236938,385203 236941,385224 236946,385233 236950,385241 236956,385254 236971,
  385260 236979,385268 236999,385273 237018,385273 237037,385271 237047,385267 237057,
  385225 237125,385210 237144,385192 237161,385167 237192,385162 237202,385159 237214,
  385159 237227,385162 237241,385166 237256,385196 237324,385209 237345,385234 237375,
  385237 237383,385238 237399,385236 237407,385227 237419,385213 237430,385193 237439,
  385174 237451,385170 237455,385169 237460,385171 237475,385181 237503,385190 237521,
  385200 237533,385206 237538,385213 237541,385221 237542,385235 237540,385242 237541,
  385249 237544,385260 237555,385270 237570,385289 237584,385292 237589,385291 237596,385284 237630))',3438)
  );

      st_createtopogeo
----------------------------
 Topology ri_topo populated


-- テーブルとTopoGeometryの生成--
CREATE TABLE ri.roads(gid serial PRIMARY KEY, road_name text);

SELECT topology.AddTopoGeometryColumn('ri_topo', 'ri', 'roads', 'topo', 'LINE');
                                </pre></div><div class="refsection"><a name="idp100578376"></a><h2>関連情報</h2><p><a class="xref" href="#AddTopoGeometryColumn" title="AddTopoGeometryColumn">AddTopoGeometryColumn</a>, <a class="xref" href="#CreateTopology" title="CreateTopology">CreateTopology</a>, <a class="xref" href="#DropTopology" title="DropTopology">DropTopology</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="TopoGeo_AddPoint"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>TopoGeo_AddPoint — 許容差を使って既存のトポロジにポイントを追加し、可能ならエッジを分割します。  </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">TopoGeo_AddPoint</b>(</code>varchar  <var class="pdparam">toponame</var>, geometry  <var class="pdparam">apoint</var>, float8  <var class="pdparam">tolerance</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp100587208"></a><h2>説明</h2><p>既存のトポロジにポイントを追加し、その識別番号を返します。指定されたポイントは、許容差の範囲内で既存のノードまたはエッジにスナップします。既存のエッジはスナップされたポイントで分割されることがあります。 </p><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp100589256"></a><h2>関連情報</h2><p><a class="xref" href="#TopoGeo_AddLineString" title="TopoGeo_AddLineString">TopoGeo_AddLineString</a>, <a class="xref" href="#TopoGeo_AddPolygon" title="TopoGeo_AddPolygon">TopoGeo_AddPolygon</a>, <a class="xref" href="#AddNode" title="AddNode">AddNode</a>, <a class="xref" href="#CreateTopology" title="CreateTopology">CreateTopology</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="TopoGeo_AddLineString"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>TopoGeo_AddLineString — 許容差を使って既存のトポロジにラインストリングを追加し、可能ならエッジ/フェイスを分割します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">SETOF integer <b class="fsfunc">TopoGeo_AddLineString</b>(</code>varchar  <var class="pdparam">toponame</var>, geometry  <var class="pdparam">aline</var>, float8  <var class="pdparam">tolerance</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp100598472"></a><h2>説明</h2><p>既存のトポロジにラインストリングを追加し、これを構成するエッジの識別番号の集合を返します。指定されたラインは、許容差の範囲内で既存のノードまたはエッジにスナップします。既存のエッジとフェイスはラインで分割されることがあります。 </p><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp100600520"></a><h2>関連情報</h2><p><a class="xref" href="#TopoGeo_AddPoint" title="TopoGeo_AddPoint">TopoGeo_AddPoint</a>, <a class="xref" href="#TopoGeo_AddPolygon" title="TopoGeo_AddPolygon">TopoGeo_AddPolygon</a>, <a class="xref" href="#AddEdge" title="AddEdge">AddEdge</a>, <a class="xref" href="#CreateTopology" title="CreateTopology">CreateTopology</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="TopoGeo_AddPolygon"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>TopoGeo_AddPolygon — 許容差を使って既存のトポロジにポリゴンを追加し、可能ならエッジ/フェイスを分割します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">TopoGeo_AddPolygon</b>(</code>varchar  <var class="pdparam">atopology</var>, geometry  <var class="pdparam">apoly</var>, float8  <var class="pdparam">atolerance</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp100613832"></a><h2>説明</h2><p>既存のトポロジにポリゴンを追加し、これを構成するフェイスの識別番号の集合を返します。指定されたポリゴンの境界線は、許容差の範囲内で既存のノードまたはエッジにスナップします。既存のエッジとフェイスはポリゴンの境界線で分割されることがあります。 </p><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp100615880"></a><h2>関連情報</h2><p><a class="xref" href="#TopoGeo_AddPoint" title="TopoGeo_AddPoint">TopoGeo_AddPoint</a>, <a class="xref" href="#TopoGeo_AddLineString" title="TopoGeo_AddLineString">TopoGeo_AddLineString</a>, <a class="xref" href="#AddFace" title="AddFace">AddFace</a>, <a class="xref" href="#CreateTopology" title="CreateTopology">CreateTopology</a> </p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Topology_Editing"></a>11.5. トポロジエディタ</h2></div><div><div class="abstract"><p class="title"><b>概要</b></p><p>本節では、エッジ、フェイス、ノードの追加、移動、削除、分割に関する関数を挙げます。本節の関数はすべてISO SQL/MMで定義されています。</p></div></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#ST_AddIsoNode">ST_AddIsoNode</a></span><span class="refpurpose"> — フェイスに孤立ノードを追加し、新しいノードの識別番号を返します。フェイスがNULLの場合でもノードは生成されます。</span></dt><dt><span class="refentrytitle"><a href="#ST_AddIsoEdge">ST_AddIsoEdge</a></span><span class="refpurpose"> — <code class="varname">anode</code>と<code class="varname">anothernode</code>で指定される二つの既存孤立ノードを接続するトポロジに、ジオメトリ<code class="varname">alinestring</code>で定義される孤立エッジを追加し、新しいエッジの識別番号を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_AddEdgeNewFaces">ST_AddEdgeNewFaces</a></span><span class="refpurpose"> — 新しいエッジを追加します。新しいエッジがフェイスを分割する場合には、もとのフェイスを削除して、分割した二つのフェイスに置き換えます。</span></dt><dt><span class="refentrytitle"><a href="#ST_AddEdgeModFace">ST_AddEdgeModFace</a></span><span class="refpurpose"> — 新しいエッジを追加します。新しいエッジがフェイスを分割する場合には、もとのフェイスを編集し、一つのフェイスを追加します。</span></dt><dt><span class="refentrytitle"><a href="#ST_RemEdgeNewFace">ST_RemEdgeNewFace</a></span><span class="refpurpose"> — エッジを削除し、消去対象エッジでフェイスが二つに分割されているなら元の二つのフェイスを削除し、一つの新しいフェイスに置き換えます。 </span></dt><dt><span class="refentrytitle"><a href="#ST_RemEdgeModFace">ST_RemEdgeModFace</a></span><span class="refpurpose"> — エッジを削除し、削除対象エッジでフェイスが二つに分割されているなら、両方の空間をとるため、一つを削除して、もう一つを編集します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_ChangeEdgeGeom">ST_ChangeEdgeGeom</a></span><span class="refpurpose"> — トポロジ構造に影響を与えることなくエッジの形状を変更します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_ModEdgeSplit">ST_ModEdgeSplit</a></span><span class="refpurpose"> — 既存のエッジに沿って新しいノードを生成してエッジを分割します。もとのエッジは変更され、新しいエッジが一つ追加されます。</span></dt><dt><span class="refentrytitle"><a href="#ST_ModEdgeHeal">ST_ModEdgeHeal</a></span><span class="refpurpose"> — 二つのエッジについて、接続しているノードを削除して修復します。1番目のエッジを編集して、2番目のエッジを削除します。削除されたノードの識別番号を返します。 </span></dt><dt><span class="refentrytitle"><a href="#ST_NewEdgeHeal">ST_NewEdgeHeal</a></span><span class="refpurpose"> — 二つのエッジについて、接続しているノードを削除して修復します。両方のエッジを削除し、1番目のエッジと同じ方向のエッジに置き換えます。 </span></dt><dt><span class="refentrytitle"><a href="#ST_MoveIsoNode">ST_MoveIsoNode</a></span><span class="refpurpose"> — トポロジ内の孤立ノードを別の位置に移動させます。新しい<code class="varname">apoint</code>ジオメトリがノードとして存在しているなら、エラーが投げられます。移動に関する説明を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_NewEdgesSplit">ST_NewEdgesSplit</a></span><span class="refpurpose"> — 新しいノードを既存のエッジに沿って作成して、エッジを分割します。もとのエッジは削除され、二つのエッジに置き換えられます。二つの新しいエッジに接続する新しいノードの識別番号を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_RemoveIsoNode">ST_RemoveIsoNode</a></span><span class="refpurpose"> — 孤立ノードを削除し、実行結果が返されます。ノードが孤立していない (エッジの始端または終端である)場合には、例外が投げられます。</span></dt><dt><span class="refentrytitle"><a href="#ST_RemoveIsoEdge">ST_RemoveIsoEdge</a></span><span class="refpurpose"> — 孤立エッジを削除し、実行結果の記述を返します。エッジが孤立していない場合には、例外が投げられます。</span></dt></dl></div><div class="refentry"><a name="ST_AddIsoNode"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AddIsoNode — フェイスに孤立ノードを追加し、新しいノードの識別番号を返します。フェイスがNULLの場合でもノードは生成されます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_AddIsoNode</b>(</code>varchar  <var class="pdparam">atopology</var>, integer  <var class="pdparam">aface</var>, geometry  <var class="pdparam">apoint</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp100627016"></a><h2>説明</h2><p><code class="varname">atopology</code>で指定されたトポロジの<code class="varname">aface</code>の識別番号で示された既存のフェイスに対して、<code class="varname">apoint</code>で示された位置に孤立ノードを追加します。</p><p>ポイントジオメトリの空間参照系 (SRID)がトポロジと同じでない場合、<code class="varname">apoint</code>がポイントジオメトリでない場合、ポイントがNULLである場合、または、ポイントが既存のエッジ (境界も含む)とインタセクトする場合には、例外が投げられます。また、ポイントが既にノードとして存在する場合、例外が投げられます。 </p><p><code class="varname">aface</code>がNULLでなく、かつ<code class="varname">apoint</code>がフェイス内に無い場合には、例外が投げられます。</p><p>Availability: 1.? </p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X 3.1</p></div><div class="refsection"><a name="idp100653512"></a><h2>例</h2><p></p></div><div class="refsection"><a name="idp100655048"></a><h2>関連情報</h2><p><a class="xref" href="#AddNode" title="AddNode">AddNode</a>, <a class="xref" href="#CreateTopology" title="CreateTopology">CreateTopology</a>, <a class="xref" href="#DropTopology" title="DropTopology">DropTopology</a>, <a class="xref" href="#ST_Intersects" title="ST_Intersects">ST_Intersects</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_AddIsoEdge"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AddIsoEdge — <code class="varname">anode</code>と<code class="varname">anothernode</code>で指定される二つの既存孤立ノードを接続するトポロジに、ジオメトリ<code class="varname">alinestring</code>で定義される孤立エッジを追加し、新しいエッジの識別番号を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_AddIsoEdge</b>(</code>varchar  <var class="pdparam">atopology</var>, integer  <var class="pdparam">anode</var>, integer  <var class="pdparam">anothernode</var>, geometry  <var class="pdparam">alinestring</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp100670152"></a><h2>説明</h2><p><code class="varname">anode</code>と<code class="varname">anothernode</code>で指定される二つの既存孤立ノードを接続するトポロジに、ジオメトリ<code class="varname">alinestring</code>で定義される孤立エッジを追加し、新しいエッジの識別番号を返します。</p><p><code class="varname">alinestring</code>ジオメトリとトポロジとで空間参照系 (SRID)が異なる場合、引数がNULLである場合、ノードが一つ以上のフェイスに含まれている場合には、二つのノードが既存エッジの始端または終端である場合には、例外が投げられます。 </p><p><code class="varname">alinestring</code>が<code class="varname">anode</code>と<code class="varname">anothernode</code>に属するフェイス内に無い場合には、例外が投げられます。 </p><p><code class="varname">anode</code>と<code class="varname">anothernode</code>が、<code class="varname">alinestring</code>の始端と終端でない場合には、例外が投げられます。</p><p>Availability: 1.? </p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.4</p></div><div class="refsection"><a name="idp100677832"></a><h2>例</h2><p></p></div><div class="refsection"><a name="idp100679368"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AddIsoNode" title="ST_AddIsoNode">ST_AddIsoNode</a>, <a class="xref" href="#ST_IsSimple" title="ST_IsSimple">ST_IsSimple</a>, <a class="xref" href="#ST_Within" title="ST_Within">ST_Within</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_AddEdgeNewFaces"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AddEdgeNewFaces — 新しいエッジを追加します。新しいエッジがフェイスを分割する場合には、もとのフェイスを削除して、分割した二つのフェイスに置き換えます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_AddEdgeNewFaces</b>(</code>varchar  <var class="pdparam">atopology</var>, integer  <var class="pdparam">anode</var>, integer  <var class="pdparam">anothernode</var>, geometry  <var class="pdparam">acurve</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp100688968"></a><h2>説明</h2><p>新しいエッジを追加します。新しいエッジがフェイスを分割する場合には、もとのフェイスを削除して、分割した二つのフェイスに置き換えます。新しいエッジの識別番号を返します。 </p><p>この関数によって、既存の接続されているエッジとリレーションシップが更新されます。 </p><p>引数がNULLの場合、与えられたノードが不明な場合(トポロジスキーマの<code class="varname">node</code>テーブル内に既に存在していなければなりません)、<code class="varname">acurve</code>が<code class="varname">LINESTRING</code>でない場合、<code class="varname">anode</code>と<code class="varname">anothernode</code>が始端、終端でない場合には、例外が投げられます。</p><p><code class="varname">acurve</code>ジオメトリの空間参照系 (SRID) がトポロジと同じでない場合、例外が投げられます。</p><p>Availability: 2.0 </p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.12</p></div><div class="refsection"><a name="idp100708040"></a><h2>例</h2><p></p></div><div class="refsection"><a name="idp100709576"></a><h2>関連情報</h2><p><a class="xref" href="#ST_RemEdgeNewFace" title="ST_RemEdgeNewFace">ST_RemEdgeNewFace</a></p><p><a class="xref" href="#ST_AddEdgeModFace" title="ST_AddEdgeModFace">ST_AddEdgeModFace</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_AddEdgeModFace"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_AddEdgeModFace — 新しいエッジを追加します。新しいエッジがフェイスを分割する場合には、もとのフェイスを編集し、一つのフェイスを追加します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_AddEdgeModFace</b>(</code>varchar  <var class="pdparam">atopology</var>, integer  <var class="pdparam">anode</var>, integer  <var class="pdparam">anothernode</var>, geometry  <var class="pdparam">acurve</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp100718920"></a><h2>説明</h2><p>新しいエッジを追加します。新しいエッジがフェイスを分割する場合には、もとのフェイスを編集し、一つのフェイスを追加します。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>可能なら、新しいフェイスは新しいエッジの左側に作られます。左側のフェイスがユニバースフェイス (境界がない)でなければならない場合には、可能ではありません。 </p></td></tr></table></div><p>新しく追加されたエッジの識別番号を返します。 </p><p>この関数によって、既存の接続されているエッジとリレーションシップが更新されます。 </p><p>引数がNULLの場合、与えられたノードが不明な場合(トポロジスキーマの<code class="varname">node</code>テーブル内に既に存在していなければなりません)、<code class="varname">acurve</code>が<code class="varname">LINESTRING</code>でない場合、<code class="varname">anode</code>と<code class="varname">anothernode</code>が始端、終端でない場合には、例外が投げられます。</p><p><code class="varname">acurve</code>ジオメトリの空間参照系 (SRID) がトポロジと同じでない場合、例外が投げられます。</p><p>Availability: 2.0 </p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.13</p></div><div class="refsection"><a name="idp100726600"></a><h2>例</h2><p></p></div><div class="refsection"><a name="idp100728136"></a><h2>関連情報</h2><p><a class="xref" href="#ST_RemEdgeModFace" title="ST_RemEdgeModFace">ST_RemEdgeModFace</a></p><p><a class="xref" href="#ST_AddEdgeNewFaces" title="ST_AddEdgeNewFaces">ST_AddEdgeNewFaces</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_RemEdgeNewFace"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_RemEdgeNewFace — エッジを削除し、消去対象エッジでフェイスが二つに分割されているなら元の二つのフェイスを削除し、一つの新しいフェイスに置き換えます。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_RemEdgeNewFace</b>(</code>varchar  <var class="pdparam">atopology</var>, integer  <var class="pdparam">anedge</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp100735432"></a><h2>説明</h2><p>エッジを削除し、消去対象エッジでフェイスが二つに分割されているなら元の二つのフェイスを削除し、一つの新しいフェイスに置き換えます。 </p><p>新しく作成されたフェイスの識別番号を返します。新しいフェイスが生成されない場合にはNULLを返します。削除対象エッジがダングルである (訳注: 「ぶらさがる」状態、すなわち一方の端が孤立ノードでなく、かつもう一方が孤立ノード)場合か、孤立している場合か、 ユニバースフェイスとの境界になっている (おそらく反対側のフェイスにユニバースが侵入します)場合には、フェイスは生成されません。 </p><p>この関数によって、既存の接続されているエッジとリレーションシップが更新されます。 </p><p>既存のTopoGeometryの定義に入り込んでいるエッジは削除を拒絶されます。TopoGeometryが二つのフェイスのうちひとつだけで定義されている (かつ他方は定義に使われていない)場合、二つのフェイスの修復は拒絶されます。 </p><p>引数がNULLである場合、与えられたエッジが不明である場合 (トポロジスキーマの<code class="varname">edge</code>テーブル内に既に存在していなければなりません)、トポロジ名が不正である場合、例外が投げられます。 </p><p>Availability: 2.0 </p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.14</p></div><div class="refsection"><a name="idp100761160"></a><h2>例</h2><p></p></div><div class="refsection"><a name="idp100762696"></a><h2>関連情報</h2><p><a class="xref" href="#ST_RemEdgeModFace" title="ST_RemEdgeModFace">ST_RemEdgeModFace</a></p><p><a class="xref" href="#ST_AddEdgeNewFaces" title="ST_AddEdgeNewFaces">ST_AddEdgeNewFaces</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_RemEdgeModFace"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_RemEdgeModFace — エッジを削除し、削除対象エッジでフェイスが二つに分割されているなら、両方の空間をとるため、一つを削除して、もう一つを編集します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_RemEdgeModFace</b>(</code>varchar  <var class="pdparam">atopology</var>, integer  <var class="pdparam">anedge</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp100769992"></a><h2>説明</h2><p>エッジを削除し、削除対象エッジでフェイスが二つに分割されているなら、両方の空間をとるため、一つを削除して、もう一つを編集します。ST_AddEdgeModFaceと対称となるよう、右側のフェイスを優先して保持します。削除対象エッジの代わりに残存するフェイスの識別番号を返します。 </p><p>この関数によって、既存の接続されているエッジとリレーションシップが更新されます。 </p><p>既存のTopoGeometryの定義に入り込んでいるエッジは削除を拒絶されます。TopoGeometryが二つのフェイスのうちひとつだけで定義されている (かつ他方は定義に使われていない)場合、二つのフェイスの修復は拒絶されます。 </p><p>引数がNULLである場合、与えられたエッジが不明である場合 (トポロジスキーマの<code class="varname">edge</code>テーブル内に既に存在していなければなりません)、トポロジ名が不正である場合、例外が投げられます。 </p><p>Availability: 2.0 </p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.15</p></div><div class="refsection"><a name="idp100774856"></a><h2>例</h2><p></p></div><div class="refsection"><a name="idp100776392"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AddEdgeModFace" title="ST_AddEdgeModFace">ST_AddEdgeModFace</a></p><p><a class="xref" href="#ST_RemEdgeNewFace" title="ST_RemEdgeNewFace">ST_RemEdgeNewFace</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_ChangeEdgeGeom"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ChangeEdgeGeom — トポロジ構造に影響を与えることなくエッジの形状を変更します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_ChangeEdgeGeom</b>(</code>varchar  <var class="pdparam">atopology</var>, integer  <var class="pdparam">anedge</var>, geometry  <var class="pdparam">acurve</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp100788808"></a><h2>説明</h2><p>トポロジ構造に影響を与えることなくエッジの形状を変更します。 </p><p>NULLの引数があった場合、与えられたエッジがtopologyスキーマの<code class="varname">edge</code>テーブルに存在しない場合、<code class="varname">acurve</code>が<code class="varname">LINESTRING</code>でない場合、<code class="varname">anode</code>と<code class="varname">anothernode</code>が<code class="varname">acurve</code>の開始点と終了点でない場合、または、変更によってトポロジが変わる場合には、エラーが投げられます。 </p><p><code class="varname">acurve</code>ジオメトリの空間参照系 (SRID) がトポロジと同じでない場合、例外が投げられます。</p><p>新しい<code class="varname">acurve</code>が単純でない場合には、エラーが投げられます。</p><p>古い位置から新しい位置へのエッジ移動で障害物にあたった場合はエラーが投げられます。 </p><p>Availability: 1.1.0</p><p>Enhanced: 2.0.0版で、トポロジ整合性の強制を追加しました。 </p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.6</p></div><div class="refsection"><a name="idp100797384"></a><h2>例</h2><pre class="programlisting">SELECT topology.ST_ChangeEdgeGeom('ma_topo', 1,
                ST_GeomFromText('LINESTRING(227591.9 893900.4,227622.6 893844.3,227641.6 893816.6, 227704.5 893778.5)', 26986) );
 ----
 Edge 1 changed</pre></div><div class="refsection"><a name="idp100798920"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AddEdgeModFace" title="ST_AddEdgeModFace">ST_AddEdgeModFace</a></p><p><a class="xref" href="#ST_RemEdgeModFace" title="ST_RemEdgeModFace">ST_RemEdgeModFace</a></p><p><a class="xref" href="#ST_ModEdgeSplit" title="ST_ModEdgeSplit">ST_ModEdgeSplit</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_ModEdgeSplit"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ModEdgeSplit — 既存のエッジに沿って新しいノードを生成してエッジを分割します。もとのエッジは変更され、新しいエッジが一つ追加されます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_ModEdgeSplit</b>(</code>varchar  <var class="pdparam">atopology</var>, integer  <var class="pdparam">anedge</var>, geometry  <var class="pdparam">apoint</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp100807752"></a><h2>説明</h2><p>既存のエッジに沿って新しいノードを生成してエッジを分割します。もとのエッジは変更され、新しいエッジが一つ追加されます。この関数によって、既存の接続されているエッジとリレーションシップが更新されます。新しく追加されたノードの識別番号が返ります。 </p><p>Availability: 1.? </p><p>Changed: 2.0 - 以前の版では名前を間違えてST_ModEdgesSplitになっていました。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.9</p></div><div class="refsection"><a name="idp100811336"></a><h2>例</h2><pre class="programlisting">-- エッジの追加 --
 SELECT topology.AddEdge('ma_topo', ST_GeomFromText('LINESTRING(227592 893910, 227600 893910)', 26986) ) As edgeid;

-- edgeid --
3


-- エッジの分割 --
SELECT topology.ST_ModEdgeSplit('ma_topo',  3, ST_SetSRID(ST_Point(227594,893910),26986)  ) As node_id;
        node_id
-------------------------
7
</pre></div><div class="refsection"><a name="idp100812872"></a><h2>関連情報</h2><p><a class="xref" href="#ST_NewEdgesSplit" title="ST_NewEdgesSplit">ST_NewEdgesSplit</a>, <a class="xref" href="#ST_ModEdgeHeal" title="ST_ModEdgeHeal">ST_ModEdgeHeal</a>, <a class="xref" href="#ST_NewEdgeHeal" title="ST_NewEdgeHeal">ST_NewEdgeHeal</a>, <a class="xref" href="#AddEdge" title="AddEdge">AddEdge</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_ModEdgeHeal"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_ModEdgeHeal — 二つのエッジについて、接続しているノードを削除して修復します。1番目のエッジを編集して、2番目のエッジを削除します。削除されたノードの識別番号を返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">int <b class="fsfunc">ST_ModEdgeHeal</b>(</code>varchar  <var class="pdparam">atopology</var>, integer  <var class="pdparam">anedge</var>, integer  <var class="pdparam">anotheredge</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp100821960"></a><h2>説明</h2><p>二つのエッジについて、接続しているノードを削除して修復します。1番目のエッジを編集して、2番目のエッジを削除します。削除されたノードの識別番号を返します。この関数によって、既存の接続されているエッジとリレーションシップが更新されます。 </p><p>Availability: 2.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.9</p></div><div class="refsection"><a name="idp100825416"></a><h2>関連情報</h2><p>
				<a class="xref" href="#ST_ModEdgeSplit" title="ST_ModEdgeSplit">ST_ModEdgeSplit</a>
				<a class="xref" href="#ST_NewEdgesSplit" title="ST_NewEdgesSplit">ST_NewEdgesSplit</a>
				</p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_NewEdgeHeal"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_NewEdgeHeal — 二つのエッジについて、接続しているノードを削除して修復します。両方のエッジを削除し、1番目のエッジと同じ方向のエッジに置き換えます。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">int <b class="fsfunc">ST_NewEdgeHeal</b>(</code>varchar  <var class="pdparam">atopology</var>, integer  <var class="pdparam">anedge</var>, integer  <var class="pdparam">anotheredge</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp100833864"></a><h2>説明</h2><p>二つのエッジについて、接続しているノードを削除して修復します。両方のエッジを削除し、1番目のエッジと同じ方向のエッジに置き換えます。 修復されたエッジに置き換えられた新しいエッジの識別番号を返します。 この関数によって、既存の接続されているエッジとリレーションシップが更新されます。 </p><p>Availability: 2.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.9</p></div><div class="refsection"><a name="idp100837320"></a><h2>関連情報</h2><p>
				<a class="xref" href="#ST_ModEdgeHeal" title="ST_ModEdgeHeal">ST_ModEdgeHeal</a>
				<a class="xref" href="#ST_ModEdgeSplit" title="ST_ModEdgeSplit">ST_ModEdgeSplit</a>
				<a class="xref" href="#ST_NewEdgesSplit" title="ST_NewEdgesSplit">ST_NewEdgesSplit</a>
				</p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_MoveIsoNode"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_MoveIsoNode — トポロジ内の孤立ノードを別の位置に移動させます。新しい<code class="varname">apoint</code>ジオメトリがノードとして存在しているなら、エラーが投げられます。移動に関する説明を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_MoveIsoNode</b>(</code>varchar  <var class="pdparam">atopology</var>, integer  <var class="pdparam">anedge</var>, geometry  <var class="pdparam">apoint</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp100846536"></a><h2>説明</h2><p>トポロジ内の孤立ノードを別の位置に移動させます。新しい<code class="varname">apoint</code>ジオメトリがノードとして存在しているなら、エラーが投げられます。</p><p>引数がNULLである場合、<code class="varname">apoint</code>がポイントでない場合、既存のノードが孤立していない (既存エッジの始端または終端)場合、 新しいノード位置が既存のエッジとインタセクトする (終端も含む)場合、例外が投げられます。</p><p>ポイントジオメトリの空間参照系 (SRID)がトポロジと異なる場合には、例外が投げられます。</p><p>Availability: 1.? </p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.2</p></div><div class="refsection"><a name="idp100851400"></a><h2>例</h2><pre class="programlisting">-- フェイスの無い孤立ノードの追加 --
SELECT topology.ST_AddIsoNode('ma_topo',  NULL, ST_GeomFromText('POINT(227579 893916)', 26986) ) As nodeid;
 nodeid
--------
      7
-- 新しいノードの移動 --
SELECT topology.ST_MoveIsoNode('ma_topo', 7,  ST_GeomFromText('POINT(227579.5 893916.5)', 26986) ) As descrip;
                      descrip
----------------------------------------------------
Isolated Node 7 moved to location 227579.5,893916.5</pre></div><div class="refsection"><a name="idp100852936"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AddIsoNode" title="ST_AddIsoNode">ST_AddIsoNode</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_NewEdgesSplit"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_NewEdgesSplit — 新しいノードを既存のエッジに沿って作成して、エッジを分割します。もとのエッジは削除され、二つのエッジに置き換えられます。二つの新しいエッジに接続する新しいノードの識別番号を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">ST_NewEdgesSplit</b>(</code>varchar  <var class="pdparam">atopology</var>, integer  <var class="pdparam">anedge</var>, geometry  <var class="pdparam">apoint</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp100860744"></a><h2>説明</h2><p><code class="varname">anedge</code>で指定される既存のエッジに沿った<code class="varname">apoint</code>の位置に新しいノードを作成して、エッジを分割します。もとのエッジは削除され、二つつのエッジに置き換えられます。二つの新しいエッジに接続する新しいノードの識別番号を返します。この関数によって、既存の接続されているエッジとリレーションシップが更新されます。 </p><p>ポイントジオメトリの空間参照系 (SRID)がトポロジと異なる場合、<code class="varname">apoint</code>がポイントジオメトリでない場合、ポイントがNULLの場合、ポイントが既にノードとして存在する場合、エッジが既存のエッジと一致しない場合、ポイントがエッジ内にない場合、例外が投げられます。</p><p>Availability: 1.? </p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.8</p></div><div class="refsection"><a name="idp100865352"></a><h2>例</h2><pre class="programlisting">-- エッジの追加  --
SELECT topology.AddEdge('ma_topo', ST_GeomFromText('LINESTRING(227575 893917,227592 893900)', 26986) ) As edgeid;
-- 結果 --
edgeid
------
        2
-- 新しいエッジの分割 --
SELECT topology.ST_NewEdgesSplit('ma_topo', 2,  ST_GeomFromText('POINT(227578.5 893913.5)', 26986) ) As newnodeid;
 newnodeid
---------
       6</pre></div><div class="refsection"><a name="idp100866888"></a><h2>関連情報</h2><p>
				<a class="xref" href="#ST_ModEdgeSplit" title="ST_ModEdgeSplit">ST_ModEdgeSplit</a>
				<a class="xref" href="#ST_ModEdgeHeal" title="ST_ModEdgeHeal">ST_ModEdgeHeal</a>
				<a class="xref" href="#ST_NewEdgeHeal" title="ST_NewEdgeHeal">ST_NewEdgeHeal</a>
				<a class="xref" href="#AddEdge" title="AddEdge">AddEdge</a>
				</p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_RemoveIsoNode"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_RemoveIsoNode — 孤立ノードを削除し、実行結果が返されます。ノードが孤立していない (エッジの始端または終端である)場合には、例外が投げられます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_RemoveIsoNode</b>(</code>varchar  <var class="pdparam">atopology</var>, integer  <var class="pdparam">anode</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp100875080"></a><h2>説明</h2><p>孤立ノードを削除し、実行結果が返されます。ノードが孤立していない (エッジの始端または終端である)場合には、例外が投げられます。</p><p>Availability: 1.? </p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.3</p></div><div class="refsection"><a name="idp100878280"></a><h2>例</h2><pre class="programlisting">-- フェイスの無い孤立ノードの削除 --
SELECT topology.ST_RemoveIsoNode('ma_topo',  7 ) As result;
         result
-------------------------
 Isolated node 7 removed
</pre></div><div class="refsection"><a name="idp100879816"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AddIsoNode" title="ST_AddIsoNode">ST_AddIsoNode</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_RemoveIsoEdge"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_RemoveIsoEdge — 孤立エッジを削除し、実行結果の記述を返します。エッジが孤立していない場合には、例外が投げられます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">ST_RemoveIsoEdge</b>(</code>varchar  <var class="pdparam">atopology</var>, integer  <var class="pdparam">anedge</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp100886600"></a><h2>説明</h2><p>孤立エッジを削除し、実行結果の記述を返します。エッジが孤立していない場合には、例外が投げられます。</p><p>Availability: 1.? </p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.3</p></div><div class="refsection"><a name="idp100889800"></a><h2>例</h2><pre class="programlisting">-- フェイスの無い孤立ノードの削除 --
SELECT topology.ST_RemoveIsoNode('ma_topo',  7 ) As result;
         result
-------------------------
 Isolated node 7 removed
</pre></div><div class="refsection"><a name="idp100891336"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AddIsoNode" title="ST_AddIsoNode">ST_AddIsoNode</a></p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Topology_Accessors"></a>11.6. トポロジアクセサ</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#GetEdgeByPoint">GetEdgeByPoint</a></span><span class="refpurpose"> — 与えられたポイントにインタセクトするエッジの識別番号を探索します。</span></dt><dt><span class="refentrytitle"><a href="#GetFaceByPoint">GetFaceByPoint</a></span><span class="refpurpose"> — 与えられたポイントにインタセクトするフェイスの識別番号を探索します。</span></dt><dt><span class="refentrytitle"><a href="#GetNodeByPoint">GetNodeByPoint</a></span><span class="refpurpose"> — ポイント位置にあるノードの識別番号を探索します。</span></dt><dt><span class="refentrytitle"><a href="#GetTopologyID">GetTopologyID</a></span><span class="refpurpose"> — トポロジ名からtopology.topologyテーブル内にあるトポロジの識別番号を返します。</span></dt><dt><span class="refentrytitle"><a href="#GetTopologySRID">GetTopologySRID</a></span><span class="refpurpose"> — トポロジ名からtopology.topologyテーブル内にあるトポロジのSRIDを返します。</span></dt><dt><span class="refentrytitle"><a href="#GetTopologyName">GetTopologyName</a></span><span class="refpurpose"> — 識別番号からトポロジ (スキーマ)の名前を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_GetFaceEdges">ST_GetFaceEdges</a></span><span class="refpurpose"> — 順序番号を含む、<code class="varname">aface</code>の境界となる、整列したエッジの集合を返します。</span></dt><dt><span class="refentrytitle"><a href="#ST_GetFaceGeometry">ST_GetFaceGeometry</a></span><span class="refpurpose"> — 指定されたトポロジの中の、フェイス識別番号で指定されたポリゴンを返します。</span></dt><dt><span class="refentrytitle"><a href="#GetRingEdges">GetRingEdges</a></span><span class="refpurpose"> — 与えられた側を歩いて得られた、正負符号付きエッジ識別番号の集合を、順序通りに返します。 </span></dt><dt><span class="refentrytitle"><a href="#GetNodeEdges">GetNodeEdges</a></span><span class="refpurpose"> — 与えられたノードに付随するエッジの集合を整列して返します。 </span></dt></dl></div><div class="refentry"><a name="GetEdgeByPoint"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>GetEdgeByPoint — 与えられたポイントにインタセクトするエッジの識別番号を探索します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">GetEdgeByPoint</b>(</code>varchar  <var class="pdparam">atopology</var>, geometry  <var class="pdparam">apoint</var>, float8  <var class="pdparam">tol</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp100900040"></a><h2>与えられたポイントにインタセクトするエッジの識別番号を探索します。</h2><p>この関数は、トポロジ、ポイント、許容差を引数にして、整数 (エッジの識別番号)を返します。許容差が0の場合、ポイントはエッジとインタセクトしていなければなりません。</p><p>ポイントがエッジにインタセクトしない場合には0を返します。</p><p>許容差を0より大きくして、ポイント付近のエッジが一つより多い場合には、例外が投げられます。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>許容差が0の場合はST_Intersectsを使い、それ以外ではST_DWinthinを使います。</p></td></tr></table></div><p>Availability: 2.0.0 - GEOS 3.3.0以上が必要  </p></div><div class="refsection"><a name="idp100903624"></a><h2>例</h2><p>本例では<a class="xref" href="#AddEdge" title="AddEdge">AddEdge</a>で作ったエッジを使います。</p><pre class="programlisting">SELECT topology.GetEdgeByPoint('ma_topo',geom, 1) As with1mtol, topology.GetEdgeByPoint('ma_topo',geom,0) As withnotol
FROM ST_GeomFromEWKT('SRID=26986;POINT(227622.6 893843)') As geom;
 with1mtol | withnotol
-----------+-----------
         2 |         0
</pre><pre class="programlisting">SELECT topology.GetEdgeByPoint('ma_topo',geom, 1) As nearnode
FROM ST_GeomFromEWKT('SRID=26986;POINT(227591.9 893900.4)') As geom;

-- エラー発生 --
ERROR:  Two or more edges found</pre></div><div class="refsection"><a name="idp100906440"></a><h2>関連情報</h2><p><a class="xref" href="#AddEdge" title="AddEdge">AddEdge</a>, <a class="xref" href="#GetNodeByPoint" title="GetNodeByPoint">GetNodeByPoint</a>, <a class="xref" href="#GetFaceByPoint" title="GetFaceByPoint">GetFaceByPoint</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="GetFaceByPoint"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>GetFaceByPoint — 与えられたポイントにインタセクトするフェイスの識別番号を探索します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">GetFaceByPoint</b>(</code>varchar  <var class="pdparam">atopology</var>, geometry  <var class="pdparam">apoint</var>, float8  <var class="pdparam">tol</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp100935624"></a><h2>説明</h2><p>与えられたポイントにインタセクトするフェイスの識別番号を探索します。</p><p>この関数は、トポロジ、ポイント、許容差を引数にして、整数 (フェイスの識別番号)を返します。許容差が0の場合には、ポイントはフェイスとインタセクトしていなければなりません。</p><p>ポイントがフェイスにインタセクトしない場合には.、0を返します。</p><p>許容差を0より大きくして、ポイント付近のフェイスが一つより多い場合には、例外が投げられます。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>許容差が0の場合には、ST_Intersectsを使い、それ以外では、ST_DWinthinを使います。</p></td></tr></table></div><p>Availability: 2.0.0 - GEOS 3.3.0以上が必要  </p></div><div class="refsection"><a name="idp100939592"></a><h2>例</h2><p>本例では<a class="xref" href="#AddFace" title="AddFace">AddFace</a>で作ったフェイスを使います。</p><pre class="programlisting">SELECT topology.GetFaceByPoint('ma_topo',geom, 10) As with1mtol, topology.GetFaceByPoint('ma_topo',geom,0) As withnotol
        FROM ST_GeomFromEWKT('POINT(234604.6 899382.0)') As geom;

         with1mtol | withnotol
        -----------+-----------
                         1 |         0</pre><pre class="programlisting">SELECT topology.GetFaceByPoint('ma_topo',geom, 1) As nearnode
        FROM ST_GeomFromEWKT('POINT(227591.9 893900.4)') As geom;

-- エラー発生--
ERROR:  Two or more faces found</pre></div><div class="refsection"><a name="idp100942408"></a><h2>関連情報</h2><p><a class="xref" href="#AddFace" title="AddFace">AddFace</a>, <a class="xref" href="#GetNodeByPoint" title="GetNodeByPoint">GetNodeByPoint</a>, <a class="xref" href="#GetEdgeByPoint" title="GetEdgeByPoint">GetEdgeByPoint</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="GetNodeByPoint"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>GetNodeByPoint — ポイント位置にあるノードの識別番号を探索します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">GetNodeByPoint</b>(</code>varchar  <var class="pdparam">atopology</var>, geometry  <var class="pdparam">point</var>, float8  <var class="pdparam">tol</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp100951112"></a><h2>ポイント位置にあるノードの識別番号を探索します。</h2><p>この関数は、トポロジ、ポイント、許容差を引数にして、整数 (ノードの識別番号) を返します。許容差が0の場合には、完全にインタセクトしているかで判断し、他の場合には、ある程度の間隔で探索します。</p><p>ポイントで指定した位置にノードが無い場合には、0を返します。</p><p>許容差を0より大きくして、ポイント付近のノードが一つより多い場合には、例外が投げられます。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>許容差が0の場合には、ST_Intersectsを使い、それ以外では、ST_DWinthinを使います。</p></td></tr></table></div><p>Availability: 2.0.0 - GEOS 3.3.0以上が必要  </p></div><div class="refsection"><a name="idp100954696"></a><h2>例</h2><p>本例では<a class="xref" href="#AddEdge" title="AddEdge">AddEdge</a>で作ったエッジを使います。</p><pre class="programlisting">SELECT topology.GetNodeByPoint('ma_topo',geom, 1) As nearnode
 FROM ST_GeomFromEWKT('SRID=26986;POINT(227591.9 893900.4)') As geom;
  nearnode
----------
        2
 </pre><pre class="programlisting">SELECT topology.GetNodeByPoint('ma_topo',geom, 1000) As too_much_tolerance
 FROM ST_GeomFromEWKT('SRID=26986;POINT(227591.9 893900.4)') As geom;

 -- エラー発生 --
 ERROR:  Two or more nodes found
 </pre></div><div class="refsection"><a name="idp100957512"></a><h2>関連情報</h2><p><a class="xref" href="#AddEdge" title="AddEdge">AddEdge</a>, <a class="xref" href="#GetEdgeByPoint" title="GetEdgeByPoint">GetEdgeByPoint</a>, <a class="xref" href="#GetFaceByPoint" title="GetFaceByPoint">GetFaceByPoint</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="GetTopologyID"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>GetTopologyID — トポロジ名からtopology.topologyテーブル内にあるトポロジの識別番号を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">GetTopologyID</b>(</code>varchar <var class="pdparam">toponame</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp100964168"></a><h2>説明</h2><p>トポロジ名からtopology.topologyテーブル内にあるトポロジの識別番号を返します。</p><p>Availability: 1.?</p></div><div class="refsection"><a name="idp100965960"></a><h2>例</h2><pre class="programlisting">SELECT topology.GetTopologyID('ma_topo') As topo_id;
 topo_id
---------
       1</pre></div><div class="refsection"><a name="idp100967496"></a><h2>関連情報</h2><p><a class="xref" href="#CreateTopology" title="CreateTopology">CreateTopology</a>, <a class="xref" href="#DropTopology" title="DropTopology">DropTopology</a>, <a class="xref" href="#GetTopologyName" title="GetTopologyName">GetTopologyName</a>, <a class="xref" href="#GetTopologySRID" title="GetTopologySRID">GetTopologySRID</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="GetTopologySRID"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>GetTopologySRID — トポロジ名からtopology.topologyテーブル内にあるトポロジのSRIDを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">GetTopologyID</b>(</code>varchar <var class="pdparam">toponame</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp100974536"></a><h2>説明</h2><p>与えられたトポロジ名からtopology.topologyテーブル内のトポロジの空間参照系識別番号を返します。</p><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp100976328"></a><h2>例</h2><pre class="programlisting">SELECT topology.GetTopologySRID('ma_topo') As SRID;
 SRID
-------
  4326</pre></div><div class="refsection"><a name="idp100977864"></a><h2>関連情報</h2><p><a class="xref" href="#CreateTopology" title="CreateTopology">CreateTopology</a>, <a class="xref" href="#DropTopology" title="DropTopology">DropTopology</a>, <a class="xref" href="#GetTopologyName" title="GetTopologyName">GetTopologyName</a>, <a class="xref" href="#GetTopologyID" title="GetTopologyID">GetTopologyID</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="GetTopologyName"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>GetTopologyName — 識別番号からトポロジ (スキーマ)の名前を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">varchar <b class="fsfunc">GetTopologyName</b>(</code>integer <var class="pdparam">topology_id</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp100984904"></a><h2>説明</h2><p>識別番号からトポロジ (スキーマ)の名前を返します。</p><p>Availability: 1.?</p></div><div class="refsection"><a name="idp100986696"></a><h2>例</h2><pre class="programlisting">SELECT topology.GetTopologyName(1) As topo_name;
 topo_name
-----------
 ma_topo</pre></div><div class="refsection"><a name="idp100988232"></a><h2>関連情報</h2><p><a class="xref" href="#CreateTopology" title="CreateTopology">CreateTopology</a>, <a class="xref" href="#DropTopology" title="DropTopology">DropTopology</a>, <a class="xref" href="#GetTopologyID" title="GetTopologyID">GetTopologyID</a>, <a class="xref" href="#GetTopologySRID" title="GetTopologySRID">GetTopologySRID</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_GetFaceEdges"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_GetFaceEdges — 順序番号を含む、<code class="varname">aface</code>の境界となる、整列したエッジの集合を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">getfaceedges_returntype <b class="fsfunc">ST_GetFaceEdges</b>(</code>varchar  <var class="pdparam">atopology</var>, integer  <var class="pdparam">aface</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp100996680"></a><h2>説明</h2><p>順序番号を含む、<code class="varname">aface</code>の境界となる、整列したエッジの集合を返します。それぞれの出力は、順序番号とエッジ識別番号からなります。順序番号は1から始まります。</p><p>環ごとのエッジの列挙は、識別番号が最も小さいものから始まります。エッジの順序は左手の法則に従います (境界フェイスは各有向辺の左側にあるようにします)。 </p><p>Availability: 2.0 </p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.5</p></div><div class="refsection"><a name="idp101000648"></a><h2>例</h2><pre class="programlisting">-- 1番フェイスの境界を返します。
SELECT (topology.ST_GetFaceEdges('tt', 1)).*;
-- 結果 --
 sequence | edge
----------+------
        1 |   -4
        2 |    5
        3 |    7
        4 |   -6
        5 |    1
        6 |    2
        7 |    3
(7 rows)
</pre><pre class="programlisting">-- 1番フェイスの順序番号、エッジ識別番号とジオメトリを返します。
-- geomとseqが欲しいだけならST_GetFaceGeometryを使います。
SELECT t.seq, t.edge, geom
FROM topology.ST_GetFaceEdges('tt',1) As t(seq,edge)
        INNER JOIN tt.edge AS e ON abs(t.edge) = e.edge_id;
</pre></div><div class="refsection"><a name="idp101002696"></a><h2>関連情報</h2><p><a class="xref" href="#GetRingEdges" title="GetRingEdges">GetRingEdges</a>, <a class="xref" href="#AddFace" title="AddFace">AddFace</a>, <a class="xref" href="#ST_GetFaceGeometry" title="ST_GetFaceGeometry">ST_GetFaceGeometry</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="ST_GetFaceGeometry"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_GetFaceGeometry — 指定されたトポロジの中の、フェイス識別番号で指定されたポリゴンを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_GetFaceGeometry</b>(</code>varchar  <var class="pdparam">atopology</var>, integer  <var class="pdparam">aface</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp101010376"></a><h2>説明</h2><p>指定されたトポロジの中の、フェイス識別番号で指定されたポリゴンを返します。フェイスを作るエッジからポリゴンを構築します。</p><p>Availability: 1.? </p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.16</p></div><div class="refsection"><a name="idp101013576"></a><h2>例</h2><pre class="programlisting">-- AddFaceで追加したポリゴンのWKTを返します。
SELECT ST_AsText(topology.ST_GetFaceGeometry('ma_topo', 1)) As facegeomwkt;
-- 結果 --
               facegeomwkt

--------------------------------------------------------------------------------
 POLYGON((234776.9 899563.7,234896.5 899456.7,234914 899436.4,234946.6 899356.9,
234872.5 899328.7,234891 899285.4,234992.5 899145,234890.6 899069,
234755.2 899255.4,234612.7 899379.4,234776.9 899563.7))
</pre></div><div class="refsection"><a name="idp101015112"></a><h2>関連情報</h2><p><a class="xref" href="#AddFace" title="AddFace">AddFace</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="GetRingEdges"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>GetRingEdges — 与えられた側を歩いて得られた、正負符号付きエッジ識別番号の集合を、順序通りに返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">getfaceedges_returntype <b class="fsfunc">GetRingEdges</b>(</code>varchar  <var class="pdparam">atopology</var>, integer  <var class="pdparam">aring</var>, integer  <var class="pdparam">max_edges=null</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp101023048"></a><h2>説明</h2><p>与えられた側を歩いて得られた、正負符号付きエッジ識別番号の集合を、順序通りに返します。出力は順序番号と正負符号付きエッジ識別番号からなります。順序番号は1始まりです。 </p><p>正のエッジ識別番号を渡すと、対応するエッジの左側を歩き、エッジを順方向に進みます。負のエッジ識別番号を渡すと、右側を歩き、エッジを逆方向に進みます。 </p><p><code class="varname">max_edges</code>がNULLでな場合には、返されるレコードを超えることはありません。これは、不正なトポロジを扱うときの安全確保のためのパラメータであることを意味します。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はメタデータとリンクするエッジ環を使います。 </p></td></tr></table></div><p>Availability: 2.0.0 </p></div><div class="refsection"><a name="idp101026632"></a><h2>関連情報</h2><p><a class="xref" href="#ST_GetFaceEdges" title="ST_GetFaceEdges">ST_GetFaceEdges</a>, <a class="xref" href="#GetNodeEdges" title="GetNodeEdges">GetNodeEdges</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="GetNodeEdges"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>GetNodeEdges — 与えられたノードに付随するエッジの集合を整列して返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">getfaceedges_returntype <b class="fsfunc">GetNodeEdges</b>(</code>varchar  <var class="pdparam">atopology</var>, integer  <var class="pdparam">anode</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp101033928"></a><h2>説明</h2><p>与えられたノードに付随するエッジの集合を整列して返します。 出力は、連続する、正負符号を持つエッジ識別番号からなります。順序番号は1から始まります。 正のエッジは与えられたノードから始まるものです。 負のエッジは与えられたノードで終わるものです。 閉じたエッジは2回現れます (正と負になります)。 並び順は北側から時計回りになります。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数は、並び順を計算していて、メタデータからのデータを使わないので、 連結しているエッジ環を構築するのに使えます。 </p></td></tr></table></div><p>Availability: 2.0 </p></div><div class="refsection"><a name="idp101036744"></a><h2>関連情報</h2><p><a class="xref" href="#GetRingEdges" title="GetRingEdges">GetRingEdges</a>, <a class="xref" href="#ST_Azimuth" title="ST_Azimuth">ST_Azimuth</a> </p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Topology_Processing"></a>11.7. トポロジ処理</h2></div><div><div class="abstract"><p class="title"><b>概要</b></p><p>本節では、非標準の手法でのトポロジ処理の関数を挙げます。</p></div></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#TopologyPolygonize">Polygonize</a></span><span class="refpurpose"> — トポロジエッジで定義される全てのフェイスを探索し、追加します。</span></dt><dt><span class="refentrytitle"><a href="#AddNode">AddNode</a></span><span class="refpurpose"> — 指定したトポロジスキーマのノードテーブルにポイントノードを追加し、新しいノードの識別番号を返します。指定したポイントに既にノードがある場合は既存のノード識別番号を返します。</span></dt><dt><span class="refentrytitle"><a href="#AddEdge">AddEdge</a></span><span class="refpurpose"> — 指定したラインストリングジオメトリを使って、ラインストリングエッジをエッジテーブルに追加し、指定したトポロジスキーマの始点終点をポイントノードテーブルに追加し、新しい (または既存の)エッジの識別番号を返します。</span></dt><dt><span class="refentrytitle"><a href="#AddFace">AddFace</a></span><span class="refpurpose"> — フェイスプリミティブをトポロジに登録し、その識別番号を得ます。  </span></dt><dt><span class="refentrytitle"><a href="#TP_ST_Simplify">ST_Simplify</a></span><span class="refpurpose"> — 与えたTopoGeometryを「シンプル化した」ジオメトリを返します。ダグラス-ポーカーのアルゴリズムを使います。</span></dt></dl></div><div class="refentry"><a name="TopologyPolygonize"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Polygonize — トポロジエッジで定義される全てのフェイスを探索し、追加します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">Polygonize</b>(</code>varchar  <var class="pdparam">toponame</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp101061448"></a><h2>説明</h2><p>トポロジエッジプリミティブで構築することができる全てのフェイスを登録します。</p><p>対象トポロジは自己インタセクトするエッジが無いと仮定しています。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>既に登録されているフェイスは認識されているので、同じトポロジに対してPolygonizeを複数回呼んでも問題ありません。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はエッジテーブルのnext_left_edgeとnext_right_edgeフィールドの読み書きを行いません。 </p></td></tr></table></div><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp101065160"></a><h2>関連情報</h2><p><a class="xref" href="#AddFace" title="AddFace">AddFace</a>, <a class="xref" href="#ST_Polygonize" title="ST_Polygonize">ST_Polygonize</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="AddNode"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>AddNode — 指定したトポロジスキーマのノードテーブルにポイントノードを追加し、新しいノードの識別番号を返します。指定したポイントに既にノードがある場合は既存のノード識別番号を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">AddNode</b>(</code>varchar  <var class="pdparam">toponame</var>, geometry  <var class="pdparam">apoint</var>, boolean  <var class="pdparam">allowEdgeSplitting=false</var>, boolean  <var class="pdparam">computeContainingFace=false</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp101074632"></a><h2>説明</h2><p>指定したトポロジスキーマのノードテーブルにポイントノードを追加します。 <a class="xref" href="#AddEdge" title="AddEdge">AddEdge</a>関数は、呼ばれると自動的にエッジの始端と終端のポイントを追加するので、明示的にエッジのノードを追加する必要はあまりありません。 </p><p>ノードとクロスするエッジが発見された場合は、例外が発生するか、エッジが分割されます。<code class="varname">allowEdgeSplitting</code>パラメータの値に依存します。 </p><p><code class="varname">computeContainingFace</code>がtrueの場合には、新しく追加されたノードによって、ノードを含む正しいフェイスが計算されます。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">apoint</code>ジオメトリが既にノードとして存在する場合、ノードは追加されずに、既存ノードの識別番号を返します。</p></td></tr></table></div><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp101079112"></a><h2>例</h2><pre class="programlisting">SELECT topology.AddNode('ma_topo', ST_GeomFromText('POINT(227641.6 893816.5)', 26986) ) As nodeid;
-- 結果 --
nodeid
--------
 4

</pre></div><div class="refsection"><a name="idp100027976"></a><h2>関連情報</h2><p><a class="xref" href="#AddEdge" title="AddEdge">AddEdge</a>, <a class="xref" href="#CreateTopology" title="CreateTopology">CreateTopology</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="AddEdge"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>AddEdge — 指定したラインストリングジオメトリを使って、ラインストリングエッジをエッジテーブルに追加し、指定したトポロジスキーマの始点終点をポイントノードテーブルに追加し、新しい (または既存の)エッジの識別番号を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">AddEdge</b>(</code>varchar  <var class="pdparam">toponame</var>, geometry  <var class="pdparam">aline</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp100035144"></a><h2>説明</h2><p>指定したラインストリングジオメトリを使って、指定した<code class="varname">toponame</code>スキーマのノードテーブルにノードを追加し、新しいまたは既存のレコードのエッジ識別番号を返します。ラインストリングエッジをエッジテーブルに追加し、指定したトポロジスキーマの始点終点をポイントノードテーブルに追加し、新規または既存のエッジの識別番号を返します。新しく追加されたエッジは両側にユニバースフェイスを持ち、自分自身にリンクしています。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">aline</code>ジオメトリが既存のエッジとクロスしたり、既存のエッジをオーバラップしたり、既存のエッジを包含したり、既存のエッジに包含されたりする場合には、エラーが投げられ、エッジは追加されません。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">aline</code>のジオメトリは<code class="varname">srid</code>がトポロジで指定されたものと同じである必要があり、異なる場合には、不正な空間参照系エラーが投げられます。</p></td></tr></table></div><p>Availability: 2.0.0 GEOS 3.3.0以降が必要です。</p></div><div class="refsection"><a name="idp100043336"></a><h2>例</h2><pre class="programlisting">SELECT topology.AddEdge('ma_topo', ST_GeomFromText('LINESTRING(227575.8 893917.2,227591.9 893900.4)', 26986) ) As edgeid;
-- 結果 --
edgeid
--------
 1

SELECT topology.AddEdge('ma_topo', ST_GeomFromText('LINESTRING(227591.9 893900.4,227622.6 893844.2,227641.6 893816.5,
 227704.5 893778.5)', 26986) ) As edgeid;
-- 結果 --
edgeid
--------
 2

 SELECT topology.AddEdge('ma_topo', ST_GeomFromText('LINESTRING(227591.2 893900, 227591.9 893900.4,
  227704.5 893778.5)', 26986) ) As edgeid;
 -- エラー発生 --
 ERROR:  Edge intersects (not on endpoints) with existing edge 1
</pre></div><div class="refsection"><a name="idp100044872"></a><h2>関連情報</h2><p><a class="xref" href="#TopoGeo_AddLineString" title="TopoGeo_AddLineString">TopoGeo_AddLineString</a>, <a class="xref" href="#CreateTopology" title="CreateTopology">CreateTopology</a>, <a class="xref" href="#spatial_ref_sys" title="4.3.1. SPATIAL_REF_SYSテーブルと空間参照系">「SPATIAL_REF_SYSテーブルと空間参照系」</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="AddFace"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>AddFace — フェイスプリミティブをトポロジに登録し、その識別番号を得ます。  </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">integer <b class="fsfunc">AddFace</b>(</code>varchar  <var class="pdparam">toponame</var>, geometry  <var class="pdparam">apolygon</var>, boolean  <var class="pdparam">force_new=false</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp101085896"></a><h2>説明</h2><p>フェイスプリミティブをトポロジに登録し、その識別番号を得ます。  </p><p>新しく追加されたフェイスのために、境界を形成するエッジとフェイスに含まれるエッジはleft_faceとright_faceフィールドに正しい値を持つよう更新されます。フェイスに含まれる孤立ノードも正しいcontaining_faceフィールド値を持つよう更新されます。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はエッジテーブルのnext_left_edgeとnext_right_edgeフィールドの読み書きを行いません。 </p></td></tr></table></div><p>対象トポロジは妥当 (自己インタセクトするエッジが無い)と仮定しています。ポリゴンの境界が既存のエッジでは完全には定義されない場合や、ポリゴンが既存のフェイスにオーバラップする場合には、例外が投げられます。</p><p><code class="varname">apolygon</code>ジオメトリが既にフェイスとして存在している場合には、
<code class="varname">force_new</code>がfalse (デフォルト)の場合は、既存フェイスのフェイス識別番号が返り、<code class="varname">force_new</code>がtrueの場合は、新しい識別番号が </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>既存フェイスの新規登録が実行される時(force_new=true)、そのエッジ内の既存のフェイスへの参照のダングルを解決しません。また、関連テーブルのノードと既存フェイスのレコードのMBR(訳注: 最小境界矩形)フィールドの更新も行いません。これに対応するのは、この関数を呼び出した側です。 </p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">apolygon</code>ジオメトリはトポロジと同じ<code class="varname">srid</code>である必要があり、異なる場合には、不正な空間参照系エラーが投げられます。</p></td></tr></table></div><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp101092168"></a><h2>例</h2><pre class="programlisting">-- 最初に、反復子にgenerate_seriesを使用してエッジを追加
-- (generate_seriesの最大値の関係上、
-- 頂点が10000個未満のポリゴンでのみ動作します)

SELECT topology.AddEdge('ma_topo', ST_MakeLine(ST_PointN(geom,i), ST_PointN(geom, i + 1) )) As edgeid
    FROM (SELECT  ST_NPoints(geom) AS npt, geom
            FROM
                (SELECT ST_Boundary(ST_GeomFromText('POLYGON((234896.5 899456.7,234914 899436.4,234946.6 899356.9,234872.5 899328.7,
                234891 899285.4,234992.5 899145, 234890.6 899069,234755.2 899255.4,
                234612.7 899379.4,234776.9 899563.7,234896.5 899456.7))', 26986) )  As geom
            )  As geoms) As facen CROSS JOIN generate_series(1,10000) As i
         WHERE i &lt; npt;
-- 結果 --
 edgeid
--------
      3
      4
      5
      6
      7
      8
      9
     10
     11
     12
(10 rows)
-- フェイスの追加

SELECT topology.AddFace('ma_topo',
    ST_GeomFromText('POLYGON((234896.5 899456.7,234914 899436.4,234946.6 899356.9,234872.5 899328.7,
    234891 899285.4,234992.5 899145, 234890.6 899069,234755.2 899255.4,
    234612.7 899379.4,234776.9 899563.7,234896.5 899456.7))', 26986) ) As faceid;
-- 結果 --
faceid
--------
 1

</pre></div><div class="refsection"><a name="idp101093704"></a><h2>関連情報</h2><p><a class="xref" href="#AddEdge" title="AddEdge">AddEdge</a>, <a class="xref" href="#CreateTopology" title="CreateTopology">CreateTopology</a>, <a class="xref" href="#spatial_ref_sys" title="4.3.1. SPATIAL_REF_SYSテーブルと空間参照系">「SPATIAL_REF_SYSテーブルと空間参照系」</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="TP_ST_Simplify"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>ST_Simplify — 与えたTopoGeometryを「シンプル化した」ジオメトリを返します。ダグラス-ポーカーのアルゴリズムを使います。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">geometry <b class="fsfunc">ST_Simplify</b>(</code>TopoGeometry <var class="pdparam">geomA</var>, float <var class="pdparam">tolerance</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp98471624"></a><h2>説明</h2><p>与えたTopoGeometryを「シンプル化した」ジオメトリを返します。個々の要素エッジに対してダグラス-ポーカーのアルゴリズムを使います。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>返されるジオメトリは単純でなかったり不正であったりする場合があります。</p><p>要素エッジの分割によって単純性/妥当性を維持することがあります。</p></td></tr></table></div><p>GEOSモジュールで実現しています。</p><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp98474440"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Simplify" title="ST_Simplify">ST_Simplify</a> (ジオメトリ), <a class="xref" href="#ST_IsSimple" title="ST_IsSimple">ST_IsSimple</a>, <a class="xref" href="#ST_IsValid" title="ST_IsValid">ST_IsValid</a>, <a class="xref" href="#ST_ModEdgeSplit" title="ST_ModEdgeSplit">ST_ModEdgeSplit</a></p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="TopoGeometry_Constructors"></a>11.8. TopoGeometryコンストラクタ</h2></div><div><div class="abstract"><p class="title"><b>概要</b></p><p>本節では、新しいTopoGeometryを生成するトポロジ関数を挙げます。</p></div></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#CreateTopoGeom">CreateTopoGeom</a></span><span class="refpurpose"> — 新しいTopoGeometryオブジェクトをtopoエレメント配列から生成します - tg_type: 1:[multi]point, 2:[multi]line, 3:[multi]poly, 4:collection</span></dt><dt><span class="refentrytitle"><a href="#toTopoGeom">toTopoGeom</a></span><span class="refpurpose"> — 単純なジオメトリからTopoGeometryを生成します。 </span></dt><dt><span class="refentrytitle"><a href="#TopoElementArray_Agg">TopoElementArray_Agg</a></span><span class="refpurpose"> — element_idとタイプの配列 (topoelements)からなる<code class="varname">topoelementarray</code>を返します。</span></dt></dl></div><div class="refentry"><a name="CreateTopoGeom"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>CreateTopoGeom — 新しいTopoGeometryオブジェクトをtopoエレメント配列から生成します - tg_type: 1:[multi]point, 2:[multi]line, 3:[multi]poly, 4:collection</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">topogeometry <b class="fsfunc">CreateTopoGeom</b>(</code>varchar  <var class="pdparam">toponame</var>, integer  <var class="pdparam">tg_type</var>, integer <var class="pdparam">layer_id</var>, topoelementarray <var class="pdparam">tg_objs</var><code>)</code>;</p><p><code class="funcdef">topogeometry <b class="fsfunc">CreateTopoGeom</b>(</code>varchar  <var class="pdparam">toponame</var>, integer  <var class="pdparam">tg_type</var>, integer <var class="pdparam">layer_id</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp100063560"></a><h2>説明</h2><p>layer_idで示されたレイヤでTopoGeometryオブジェクトを生成し、<code class="varname">toponame</code>スキーマの関連テーブルに登録します。</p><p>tg_typeは次の整数値とします: 1:[multi]point (punctal), 2:[multi]line (lineal), 3:[multi]poly (areal), 4:collection。layer_idは、topology.layerテーブル内のレイヤ識別番号です。</p><p>点レイヤはノードの集合から形成され、線レイヤはエッジの集合から形成され、面レイヤはフェイスの集合から形成され、コレクションはノード、エッジ、フェイスの混合から形成されます。</p><p>要素の配列を省略した場合、空のTopoGeometryオブジェクトが生成されます。</p><p>Availability: 1.?</p></div><div class="refsection"><a name="idp98485832"></a><h2>例: 既存エッジからの形成</h2><p>ri_topoスキーマ内 (<code class="varname">ST_CreateTopoGeo</code>の例でロードしてあります)で、ラインタイプ (整数値で2)の、layer_idが2のレイヤ (ri_roads)の最初のエッジからTopoGeometryを生成します。</p><pre class="programlisting">INSERT INTO ri.ri_roads(road_name, topo) VALUES('Unknown', topology.CreateTopoGeom('ri_topo',2,2,'{{1,2}}'::topology.topoelementarray);</pre></div><div class="refsection"><a name="idp98487880"></a><h2>例: 面ジオメトリから最善と推測されるTopoGeometryへの変換</h2><p>フェイスのコレクションから形成されるジオメトリがあるとします。blockgroupsテーブルがあり、それぞれの区画群のTopoGeometryを知りたいとします。データが完全に整列しているなら、次のようにできます。</p><pre class="programlisting">-- TopoGeometryカラムの生成 --
SELECT topology.AddTopoGeometryColumn(
        'topo_boston',
        'boston', 'blockgroups', 'topo', 'POLYGON');

-- addtopgeometrycolumn --
1

-- 全てがエッジに沿っている前提でのカラムのアップデート
UPDATE boston.blockgroups AS bg
        SET topo = topology.CreateTopoGeom('topo_boston'
        ,3,1
        , foo.bfaces)
FROM (SELECT b.gid,  topology.TopoElementArray_Agg(ARRAY[f.face_id,3]) As bfaces
        FROM boston.blockgroups As b
            INNER JOIN topo_boston.face As f ON b.geom &amp;&amp; f.mbr
        WHERE ST_Covers(b.geom, topology.ST_GetFaceGeometry('topo_boston', f.face_id))
            GROUP BY b.gid) As foo
WHERE foo.gid = bg.gid;
</pre><pre class="programlisting">-- 世界が誤差を完璧に許容することは、ほぼありません。
-- 50%がblockgroupの境界の内側に落ちるフェイスを数えます。
UPDATE boston.blockgroups AS bg
        SET topo = topology.CreateTopoGeom('topo_boston'
        ,3,1
        , foo.bfaces)
FROM (SELECT b.gid,  topology.TopoElementArray_Agg(ARRAY[f.face_id,3]) As bfaces
        FROM boston.blockgroups As b
            INNER JOIN topo_boston.face As f ON b.geom &amp;&amp; f.mbr
        WHERE ST_Covers(b.geom, topology.ST_GetFaceGeometry('topo_boston', f.face_id))
        OR
 (  ST_Intersects(b.geom, topology.ST_GetFaceGeometry('topo_boston', f.face_id))
            AND ST_Area(ST_Intersection(b.geom, topology.ST_GetFaceGeometry('topo_boston', f.face_id) ) ) &gt;
                ST_Area(topology.ST_GetFaceGeometry('topo_boston', f.face_id))*0.5
                )
            GROUP BY b.gid) As foo
WHERE foo.gid = bg.gid;

-- TopoGeometryを、ジオメトリに戻したい場合には、
-- topoをgeometry型にキャストします。
-- 戻されたジオメトリは、トポロジの規則に関わりませんが、
-- フェイスとエッジに沿ったものになります。
-- 新しいジオメトリはTigerの道路中心線に沿っていて、とても素晴らしいです。
UPDATE boston.blockgroups SET new_geom = topo::geometry;
</pre></div><div class="refsection"><a name="idp98490312"></a><h2>関連情報</h2><p><a class="xref" href="#AddTopoGeometryColumn" title="AddTopoGeometryColumn">AddTopoGeometryColumn</a>, <a class="xref" href="#toTopoGeom" title="toTopoGeom">toTopoGeom</a> <a class="xref" href="#ST_CreateTopoGeo" title="ST_CreateTopoGeo">ST_CreateTopoGeo</a>, <a class="xref" href="#ST_GetFaceGeometry" title="ST_GetFaceGeometry">ST_GetFaceGeometry</a>, <a class="xref" href="#topoelementarray" title="TopoElementArray">TopoElementArray</a>, <a class="xref" href="#TopoElementArray_Agg" title="TopoElementArray_Agg">TopoElementArray_Agg</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="toTopoGeom"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>toTopoGeom — 単純なジオメトリからTopoGeometryを生成します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">topogeometry <b class="fsfunc">toTopoGeom</b>(</code>geometry  <var class="pdparam">geom</var>, varchar  <var class="pdparam">toponame</var>, integer <var class="pdparam">layer_id</var>, float8 <var class="pdparam">tolerance</var><code>)</code>;</p><p><code class="funcdef">topogeometry <b class="fsfunc">toTopoGeom</b>(</code>geometry  <var class="pdparam">geom</var>, topogeometry  <var class="pdparam">topogeom</var>, float8 <var class="pdparam">tolerance</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp101188552"></a><h2>説明</h2><p>単純なジオメトリから<a class="xref" href="#topogeometry" title="TopoGeometry">TopoGeometry</a>を生成します。 </p><p>入力ジオメトリを表現するために必要なトポロジプリミティブが、下位にあるトポロジに追加されます。既存のものを分割することもあります。<code class="varname">relation</code>テーブル内のTopoGeometryの出力に紐づきます。 </p><p>既存のTopoGeometryオブジェクトは形状を維持します (<code class="varname">topogeom</code>が与えられている場合には、それが例外となる可能性があります)。 </p><p><code class="varname">tolerance</code>は、与えられた場合には、入力ジオメトリを既存のプリミティブにスナップさせるために使われます。 </p><p>1番目の形式では、新しいTopoGeometryは、与えられたトポロジ (<code class="varname">toponame</code>)の与えられたレイヤ (<code class="varname">layer_id</code>)に作られます。 </p><p>2番目の形式では、変換結果のプリミティブが、既存のTopoGeometry (<code class="varname">topogeom</code>)に追加されます。また、最終の形状にスペースを追加することがあります。新しい形状を完全に持つには、古いものを入れ替えます。<a class="xref" href="#clearTopoGeom" title="clearTopoGeom">clearTopoGeom</a>を参照して下さい。 </p><p>Availability: 2.0</p><p>Enhanced: 2.1.0版では、既存のTopoGeometryを取る形式が追加されました。</p></div><div class="refsection"><a name="idp101195592"></a><h2>例</h2><p>これは完全に全て揃ったワークフローです。</p><pre class="programlisting">-- トポロジのセットアップがまだ終わっていない場合に実行します。
-- 許容値を許可しません。
SELECT topology.CreateTopology('topo_boston_test', 2249);
-- 新しいテーブルの生成
CREATE TABLE nei_topo(gid serial primary key, nei varchar(30));
-- TopoGeometryカラムの追加
SELECT topology.AddTopoGeometryColumn('topo_boston_test', 'public', 'nei_topo', 'topo', 'MULTIPOLYGON') As new_layer_id;
new_layer_id
-----------
1

-- 新しいTopoGeometryカラムの投入に新しいレイヤIDを使います。
-- TopoGeometryを新しいレイヤに許容値0で追加します。
INSERT INTO nei_topo(nei, topo)
SELECT nei,  topology.toTopoGeom(geom, 'topo_boston_test', 1)
FROM neighborhoods
WHERE gid BETWEEN 1 and 15;

-- 何が発生したかの確認
SELECT * FROM
    topology.TopologySummary('topo_boston_test');

-- 結果--
Topology topo_boston_test (5), SRID 2249, precision 0
61 nodes, 87 edges, 35 faces, 15 topogeoms in 1 layers
Layer 1, type Polygonal (3), 15 topogeoms
 Deploy: public.nei_topo.topo</pre><pre class="programlisting">-- 全てのTopoGeometryポリゴンを10メートル縮小
UPDATE nei_topo SET topo = ST_Buffer(clearTopoGeom(topo), -10);

-- 上の操作で何も無いようになった土地の取得
-- GRASSでは"polygon0 layer"と呼ばれているものと思います
SELECT ST_GetFaceGeometry('topo_boston_test', f.face_id)
  FROM topo_boston_test.face f
  WHERE f.face_id 
&gt; 0 -- don't consider the universe face
  AND NOT EXISTS ( -- check that no TopoGeometry references the face
    SELECT * FROM topo_boston_test.relation
    WHERE layer_id = 1 AND element_id = f.face_id
  );
        </pre></div><div class="refsection"><a name="idp101198024"></a><h2>関連情報</h2><p><a class="xref" href="#CreateTopology" title="CreateTopology">CreateTopology</a>, <a class="xref" href="#AddTopoGeometryColumn" title="AddTopoGeometryColumn">AddTopoGeometryColumn</a>, <a class="xref" href="#CreateTopoGeom" title="CreateTopoGeom">CreateTopoGeom</a>, <a class="xref" href="#TopologySummary" title="TopologySummary">TopologySummary</a>, <a class="xref" href="#clearTopoGeom" title="clearTopoGeom">clearTopoGeom</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="TopoElementArray_Agg"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>TopoElementArray_Agg — element_idとタイプの配列 (topoelements)からなる<code class="varname">topoelementarray</code>を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">topoelementarray <b class="fsfunc">TopoElementArray_Agg</b>(</code>topoelement set <var class="pdparam">tefield</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp101218248"></a><h2>説明</h2><p><a class="xref" href="#topoelementarray" title="TopoElementArray">TopoElementArray</a>を<a class="xref" href="#topoelement" title="TopoElement">TopoElement</a>の集合から生成するために使います。</p><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp101220680"></a><h2>例</h2><pre class="programlisting">SELECT topology.TopoElementArray_Agg(ARRAY[e,t]) As tea
  FROM generate_series(1,3) As e CROSS JOIN generate_series(1,4) As t;
  tea
--------------------------------------------------------------------------
{{1,1},{1,2},{1,3},{1,4},{2,1},{2,2},{2,3},{2,4},{3,1},{3,2},{3,3},{3,4}}</pre></div><div class="refsection"><a name="idp101221960"></a><h2>関連情報</h2><p><a class="xref" href="#topoelement" title="TopoElement">TopoElement</a>, <a class="xref" href="#topoelementarray" title="TopoElementArray">TopoElementArray</a></p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="TopoGeometry_Editors"></a>11.9. TopoGeometryエディタ</h2></div><div><div class="abstract"><p class="title"><b>概要</b></p><p>本節では、既存のTopoGeometryを編集する関数を挙げます。</p></div></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#clearTopoGeom">clearTopoGeom</a></span><span class="refpurpose"> — TopoGeometryの中身を消去します。</span></dt><dt><span class="refentrytitle"><a href="#TopoGeom_addElement">TopoGeom_addElement</a></span><span class="refpurpose"> — TopoGeometryの定義に要素を追加します。</span></dt><dt><span class="refentrytitle"><a href="#TopoGeom_remElement">TopoGeom_remElement</a></span><span class="refpurpose"> — TopoGeometryの定義から要素を削除します。</span></dt><dt><span class="refentrytitle"><a href="#toTopoGeom_editor_proxy">toTopoGeom</a></span><span class="refpurpose"> — ジオメトリの形状を既存のTopoGeometryに追加します。</span></dt></dl></div><div class="refentry"><a name="clearTopoGeom"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>clearTopoGeom — TopoGeometryの中身を消去します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">topogeometry <b class="fsfunc">clearTopoGeom</b>(</code>topogeometry  <var class="pdparam">topogeom</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp101242440"></a><h2>説明</h2><p><a class="xref" href="#topogeometry" title="TopoGeometry">TopoGeometry</a>の中身を消去し、空にします。<a class="xref" href="#toTopoGeom" title="toTopoGeom">toTopoGeom</a>と併用して、既存オブジェクトと上位にある依存オブジェクトの形状の置換に、だいたい便利です。 </p><p>Availability: 2.1</p></div><div class="refsection"><a name="idp101244872"></a><h2>例</h2><pre class="programlisting">-- 全てのTopoGeometryポリゴンを10メートル縮める
UPDATE nei_topo SET topo = ST_Buffer(clearTopoGeom(topo), -10);
                                </pre></div><div class="refsection"><a name="idp101246408"></a><h2>関連情報</h2><p>
<a class="xref" href="#toTopoGeom" title="toTopoGeom">toTopoGeom</a>
        </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="TopoGeom_addElement"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>TopoGeom_addElement — TopoGeometryの定義に要素を追加します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">topogeometry <b class="fsfunc">TopoGeom_addElement</b>(</code>topogeometry  <var class="pdparam">tg</var>, topoelement  <var class="pdparam">el</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp100004168"></a><h2>説明</h2><p><a class="xref" href="#topoelement" title="TopoElement">TopoElement</a>をTopoGeometryオブジェクトの定義に追加します。要素がすでに定義の一部になっていても、エラーは発生しません。 </p><p>Availability: 2.3</p></div><div class="refsection"><a name="idp100006216"></a><h2>例</h2><pre class="programlisting">-- 5番エッジをTopoGeometry tgに追加
UPDATE mylayer SET tg = TopoGeom_addElement(tg, '{5,2}');
                                </pre></div><div class="refsection"><a name="idp101248840"></a><h2>関連情報</h2><p><a class="xref" href="#TopoGeom_remElement" title="TopoGeom_remElement">TopoGeom_remElement</a>, <a class="xref" href="#CreateTopoGeom" title="CreateTopoGeom">CreateTopoGeom</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="TopoGeom_remElement"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>TopoGeom_remElement — TopoGeometryの定義から要素を削除します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">topogeometry <b class="fsfunc">TopoGeom_remElement</b>(</code>topogeometry  <var class="pdparam">tg</var>, topoelement  <var class="pdparam">el</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp101256136"></a><h2>説明</h2><p>TopoGeometryオブジェクトの定義から<a class="xref" href="#topoelement" title="TopoElement">TopoElement</a>を削除します。 </p><p>Availability: 2.3</p></div><div class="refsection"><a name="idp101258312"></a><h2>例</h2><pre class="programlisting">-- TopoGeometry tgから43番フェイスを削除します
UPDATE mylayer SET tg = TopoGeom_remElement(tg, '{43,3}');
                                </pre></div><div class="refsection"><a name="idp101259848"></a><h2>関連情報</h2><p><a class="xref" href="#TopoGeom_addElement" title="TopoGeom_addElement">TopoGeom_addElement</a>, <a class="xref" href="#CreateTopoGeom" title="CreateTopoGeom">CreateTopoGeom</a> </p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="toTopoGeom_editor_proxy"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>toTopoGeom — ジオメトリの形状を既存のTopoGeometryに追加します。</p></div><div class="refsection"><a name="idp101263304"></a><h2>説明</h2><p><a class="xref" href="#toTopoGeom" title="toTopoGeom">toTopoGeom</a>を参照して下さい。 </p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="TopoGeom_Accessors"></a>11.10. TopoGeometryアクセサ</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#GetTopoGeomElementArray">GetTopoGeomElementArray</a></span><span class="refpurpose"> — 与えられたTopoGeometry (プリミティブ要素)のトポロジ要素とタイプを含む<code class="varname">topoelementarray</code> (topoelementの配列)を返します。</span></dt><dt><span class="refentrytitle"><a href="#GetTopoGeomElements">GetTopoGeomElements</a></span><span class="refpurpose"> — 与えられたTopoGeometry (プリミティブ要素)の、トポロジのelement_idとelement_typeを含む<code class="varname">topoelement</code>オブジェクトの集合を返します。</span></dt></dl></div><div class="refentry"><a name="GetTopoGeomElementArray"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>GetTopoGeomElementArray — 与えられたTopoGeometry (プリミティブ要素)のトポロジ要素とタイプを含む<code class="varname">topoelementarray</code> (topoelementの配列)を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">topoelementarray <b class="fsfunc">GetTopoGeomElementArray</b>(</code>varchar  <var class="pdparam">toponame</var>, integer  <var class="pdparam">layer_id</var>, integer <var class="pdparam">tg_id</var><code>)</code>;</p></div><div class="funcsynopsis"><p><code class="funcdef">topoelementarray topoelement <b class="fsfunc">GetTopoGeomElementArray</b>(</code>topogeometry  <var class="pdparam">tg</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp101274952"></a><h2>説明</h2><p>トポロジ要素と与えられたTopoGeometry (プリミティブ要素)のタイプを含む<a class="xref" href="#topoelementarray" title="TopoElementArray">TopoElementArray</a>を返します。GetTopoGeomElementsに近いですが、これは、要素群をデータセットでなく配列で返しています。</p><p>tg_idは、topology.layerテーブル内の<code class="varname">layer_id</code>で指定されたレイヤのトポロジにおけるTopoGeometryオブジェクトの識別番号です。</p><p>Availability: 1.?</p></div><div class="refsection"><a name="idp101277896"></a><h2>例</h2><p></p></div><div class="refsection"><a name="idp101279432"></a><h2>関連情報</h2><p><a class="xref" href="#GetTopoGeomElements" title="GetTopoGeomElements">GetTopoGeomElements</a>, <a class="xref" href="#topoelementarray" title="TopoElementArray">TopoElementArray</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="GetTopoGeomElements"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>GetTopoGeomElements — 与えられたTopoGeometry (プリミティブ要素)の、トポロジのelement_idとelement_typeを含む<code class="varname">topoelement</code>オブジェクトの集合を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">setof topoelement <b class="fsfunc">GetTopoGeomElements</b>(</code>varchar  <var class="pdparam">toponame</var>, integer  <var class="pdparam">layer_id</var>, integer <var class="pdparam">tg_id</var><code>)</code>;</p></div><div class="funcsynopsis"><p><code class="funcdef">setof topoelement <b class="fsfunc">GetTopoGeomElements</b>(</code>topogeometry  <var class="pdparam">tg</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp101290440"></a><h2>説明</h2><p><code class="varname">toponame</code>スキーマ内の、与えられたTopoGeometryのelement_idとelement_type (topoelements)の集合を返します。</p><p>tg_idは、topology.layerテーブル内の<code class="varname">layer_id</code>で指定されたレイヤのトポロジにおけるTopoGeometryオブジェクトの識別番号です。</p><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp101293384"></a><h2>例</h2><p></p></div><div class="refsection"><a name="idp101294920"></a><h2>関連情報</h2><p><a class="xref" href="#GetTopoGeomElementArray" title="GetTopoGeomElementArray">GetTopoGeomElementArray</a>, <a class="xref" href="#topoelement" title="TopoElement">TopoElement</a>, <a class="xref" href="#TopoGeom_addElement" title="TopoGeom_addElement">TopoGeom_addElement</a>, <a class="xref" href="#TopoGeom_remElement" title="TopoGeom_remElement">TopoGeom_remElement</a> </p></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="TopoGeometry_Outputs"></a>11.11. TopoGeometry出力</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#AsGML">AsGML</a></span><span class="refpurpose"> — TopoGeometryのGML表現を返します。</span></dt><dt><span class="refentrytitle"><a href="#AsTopoJSON">AsTopoJSON</a></span><span class="refpurpose"> — opoGeometryのTopoJSON表現を返します。</span></dt></dl></div><div class="refentry"><a name="AsGML"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>AsGML — TopoGeometryのGML表現を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">AsGML</b>(</code>topogeometry  <var class="pdparam">tg</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">AsGML</b>(</code>topogeometry  <var class="pdparam">tg</var>, text  <var class="pdparam">nsprefix_in</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">AsGML</b>(</code>topogeometry  <var class="pdparam">tg</var>, regclass  <var class="pdparam">visitedTable</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">AsGML</b>(</code>topogeometry  <var class="pdparam">tg</var>, regclass  <var class="pdparam">visitedTable</var>, text  <var class="pdparam">nsprefix</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">AsGML</b>(</code>topogeometry  <var class="pdparam">tg</var>, text  <var class="pdparam">nsprefix_in</var>, integer  <var class="pdparam">precision</var>, integer  <var class="pdparam">options</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">AsGML</b>(</code>topogeometry  <var class="pdparam">tg</var>, text  <var class="pdparam">nsprefix_in</var>, integer  <var class="pdparam">precision</var>, integer  <var class="pdparam">options</var>, regclass  <var class="pdparam">visitedTable</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">AsGML</b>(</code>topogeometry  <var class="pdparam">tg</var>, text  <var class="pdparam">nsprefix_in</var>, integer  <var class="pdparam">precision</var>, integer  <var class="pdparam">options</var>, regclass  <var class="pdparam">visitedTable</var>, text  <var class="pdparam">idprefix</var><code>)</code>;</p><p><code class="funcdef">text <b class="fsfunc">AsGML</b>(</code>topogeometry  <var class="pdparam">tg</var>, text  <var class="pdparam">nsprefix_in</var>, integer  <var class="pdparam">precision</var>, integer  <var class="pdparam">options</var>, regclass  <var class="pdparam">visitedTable</var>, text  <var class="pdparam">idprefix</var>, int  <var class="pdparam">gmlversion</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp100017608"></a><h2>説明</h2><p>GML3の書式でTopoGeometryのGML表現を返します。<code class="varname">nsprefix_in</code>が指定されていない場合には、<code class="varname">gml</code>が使われます。非修飾名前空間を得るにはnsprefixに空文字列を渡します。精度 (デフォルトは15)とoptions (デフォルトは1)パラメタは、与えられた場合には、裏で呼んでいるST_AsGMLにそのまま渡します。</p><p><code class="varname">visitedTable</code>パラメタは、与えられた場合には、訪問したノード要素とエッジ要素のトラックを保持するために使われ、重複定義になるところで相互参照 (xlink:xref)を使います。テーブルは 整数カラムである'element_type'と'element_id'とを持つことを期待されます。この関数を呼び出したユーザは、このテーブルへの読み込み権限と書き込み権限とが必要です。効率よくするには、element_typeとelement_idに、この順序でインデクスを定義します。インデクスは一意制約をカラムに追加すると自動的に生成されます。例を示します。 </p><pre class="programlisting">CREATE TABLE visited (
  element_type integer, element_id integer,
  unique(element_type, element_id)
);
</pre><p>
		</p><p><code class="varname">idprefix</code>パラメタは、指定された場合には、Edgeタグ識別子とNodeタグ識別子の前に付きます。</p><p><code class="varname">gmlver</code>パラメタは、指定された場合には、裏で呼んでいるST_AsGMLに渡されます。デフォルトは3です。</p><p>Availability: 2.0.0 </p></div><div class="refsection"><a name="idp100022984"></a><h2>例</h2><p>ここでは<a class="xref" href="#CreateTopoGeom" title="CreateTopoGeom">CreateTopoGeom</a>で生成したTopoGeometryを使用しています。</p><pre class="programlisting">SELECT topology.AsGML(topo) As rdgml
  FROM ri.roads
  WHERE road_name = 'Unknown';

-- rdgml--
&lt;gml:TopoCurve&gt;
    &lt;gml:directedEdge&gt;
        &lt;gml:Edge gml:id="E1"&gt;
            &lt;gml:directedNode orientation="-"&gt;
                &lt;gml:Node gml:id="N1"/&gt;
            &lt;/gml:directedNode&gt;
            &lt;gml:directedNode
&gt;&lt;/gml:directedNode&gt;
            &lt;gml:curveProperty&gt;
                &lt;gml:Curve srsName="urn:ogc:def:crs:EPSG::3438"&gt;
                    &lt;gml:segments&gt;
                        &lt;gml:LineStringSegment&gt;
                            &lt;gml:posList srsDimension="2"
&gt;384744 236928 384750 236923 384769 236911 384799 236895 384811 236890
                            384833 236884 384844 236882 384866 236881 384879 236883 384954 236898 385087 236932 385117 236938
                            385167 236938 385203 236941 385224 236946 385233 236950 385241 236956 385254 236971
                            385260 236979 385268 236999 385273 237018 385273 237037 385271 237047 385267 237057 385225 237125
                            385210 237144 385192 237161 385167 237192 385162 237202 385159 237214 385159 237227 385162 237241
                            385166 237256 385196 237324 385209 237345 385234 237375 385237 237383 385238 237399 385236 237407
                            385227 237419 385213 237430 385193 237439 385174 237451 385170 237455 385169 237460 385171 237475
                            385181 237503 385190 237521 385200 237533 385206 237538 385213 237541 385221 237542 385235 237540 385242 237541
                            385249 237544 385260 237555 385270 237570 385289 237584 385292 237589 385291 237596 385284 237630&lt;/gml:posList&gt;
                        &lt;/gml:LineStringSegment&gt;
                    &lt;/gml:segments&gt;
                &lt;/gml:Curve&gt;
            &lt;/gml:curveProperty&gt;
        &lt;/gml:Edge&gt;
    &lt;/gml:directedEdge&gt;
&lt;/gml:TopoCurve
&gt;
</pre><p>上の例から名前空間を取った例です。</p><pre class="programlisting">SELECT topology.AsGML(topo,'') As rdgml
  FROM ri.roads
  WHERE road_name = 'Unknown';

-- rdgml--
&lt;TopoCurve&gt;
    &lt;directedEdge&gt;
        &lt;Edge id="E1"&gt;
            &lt;directedNode orientation="-"&gt;
                &lt;Node id="N1"/&gt;
            &lt;/directedNode&gt;
            &lt;directedNode
&gt;&lt;/directedNode&gt;
            &lt;curveProperty&gt;
                &lt;Curve srsName="urn:ogc:def:crs:EPSG::3438"&gt;
                    &lt;segments&gt;
                        &lt;LineStringSegment&gt;
                            &lt;posList srsDimension="2"
&gt;384744 236928 384750 236923 384769 236911 384799 236895 384811 236890
                            384833 236884 384844 236882 384866 236881 384879 236883 384954 236898 385087 236932 385117 236938
                            385167 236938 385203 236941 385224 236946 385233 236950 385241 236956 385254 236971
                            385260 236979 385268 236999 385273 237018 385273 237037 385271 237047 385267 237057 385225 237125
                            385210 237144 385192 237161 385167 237192 385162 237202 385159 237214 385159 237227 385162 237241
                            385166 237256 385196 237324 385209 237345 385234 237375 385237 237383 385238 237399 385236 237407
                            385227 237419 385213 237430 385193 237439 385174 237451 385170 237455 385169 237460 385171 237475
                            385181 237503 385190 237521 385200 237533 385206 237538 385213 237541 385221 237542 385235 237540 385242 237541
                            385249 237544 385260 237555 385270 237570 385289 237584 385292 237589 385291 237596 385284 237630&lt;/posList&gt;
                         &lt;/LineStringSegment&gt;
                    &lt;/segments&gt;
                &lt;/Curve&gt;
            &lt;/curveProperty&gt;
        &lt;/Edge&gt;
    &lt;/directedEdge&gt;
&lt;/TopoCurve
&gt;
</pre></div><div class="refsection"><a name="idp100026184"></a><h2>関連情報</h2><p><a class="xref" href="#CreateTopoGeom" title="CreateTopoGeom">CreateTopoGeom</a>, <a class="xref" href="#ST_CreateTopoGeo" title="ST_CreateTopoGeo">ST_CreateTopoGeo</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="AsTopoJSON"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>AsTopoJSON — opoGeometryのTopoJSON表現を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">AsTopoJSON</b>(</code>topogeometry  <var class="pdparam">tg</var>, regclass  <var class="pdparam">edgeMapTable</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp101360456"></a><h2>説明</h2><p>TopoGeometryのTopoJSON表現を返します。<code class="varname">edgeMapTable</code>がNULLでない場合には、エッジ識別番号とアーク添え字のルックアップと格納のマッピングに使われます。これは、最終的な文書内のコンパクトな"arcs"配列ができるようにするためです。 </p><p>このテーブルは、与えられた場合には、"serial"型の"arc_id"カラムと整数型の"edge_id"とを持つことが期待されます。関数はこのテーブルに"edge_id"を問い合わせるので、このカラムにインデクスを追加することが推奨されます。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>TopoJSONでのアークのインデックスは0始まりですが、"edgeMapTable"テーブルでは1始まりです。 </p></td></tr></table></div><p>完全なTopoJSON文書は、この関数が返すスニペットだけでなく、実際のarcsメンバと、いくつかのヘッダを含む必要があります。 <a class="ulink" href="http://github.com/mbostock/topojson-specification/blob/master/README.md" target="_top">TopoJSON specification</a>をご覧ください。 </p><p>Availability: 2.1.0 </p><p>Enhanced: 2.2.1 点入力に対応するようになりました</p></div><div class="refsection"><a name="idp101365320"></a><h2>関連情報</h2><p><a class="xref" href="#ST_AsGeoJSON" title="ST_AsGeoJSON">ST_AsGeoJSON</a></p></div><div class="refsection"><a name="idp101366600"></a><h2>例</h2><pre class="programlisting">CREATE TEMP TABLE edgemap(arc_id serial, edge_id int unique);

-- ヘッダ
SELECT '{ "type": "Topology", "transform": { "scale": [1,1], "translate": [0,0] }, "objects": {'

-- オブジェクトn
UNION ALL SELECT '"' || feature_name || '": ' || AsTopoJSON(feature, 'edgemap')
FROM features.big_parcels WHERE feature_name = 'P3P4';

-- アーク
WITH edges AS (
  SELECT m.arc_id, e.geom FROM edgemap m, city_data.edge e
  WHERE e.edge_id = m.edge_id
), points AS (
  SELECT arc_id, (st_dumppoints(geom)).* FROM edges
), compare AS (
  SELECT p2.arc_id,
         CASE WHEN p1.path IS NULL THEN p2.geom
              ELSE ST_Translate(p2.geom, -ST_X(p1.geom), -ST_Y(p1.geom))
         END AS geom
  FROM points p2 LEFT OUTER JOIN points p1
  ON ( p1.arc_id = p2.arc_id AND p2.path[1] = p1.path[1]+1 )
  ORDER BY arc_id, p2.path
), arcsdump AS (
  SELECT arc_id, (regexp_matches( ST_AsGeoJSON(geom), '\[.*\]'))[1] as t
  FROM compare
), arcs AS (
  SELECT arc_id, '[' || array_to_string(array_agg(t), ',') || ']' as a FROM arcsdump
  GROUP BY arc_id
  ORDER BY arc_id
)
SELECT '}, "arcs": [' UNION ALL
SELECT array_to_string(array_agg(a), E',\n') from arcs

-- フッタ
UNION ALL SELECT ']}'::text as t;

-- 結果 --
{ "type": "Topology", "transform": { "scale": [1,1], "translate": [0,0] }, "objects": {
"P3P4": { "type": "MultiPolygon", "arcs": [[[-1]],[[6,5,-5,-4,-3,1]]]}
}, "arcs": [
 [[25,30],[6,0],[0,10],[-14,0],[0,-10],[8,0]],
 [[35,6],[0,8]],
 [[35,6],[12,0]],
 [[47,6],[0,8]],
 [[47,14],[0,8]],
 [[35,22],[12,0]],
 [[35,14],[0,8]]
 ]}
</pre></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Topology_Relationships"></a>11.12. トポロジ空間関係関数</h2></div><div><div class="abstract"><p class="title"><b>概要</b></p><p>本節では、TopoGeometryとトポロジプリミティブとの間の関係を見るトポロジ関数の一覧を挙げます。</p></div></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#TG_Equals">Equals</a></span><span class="refpurpose"> — 二つのTopoGeometryが同じトポロジプリミティブで成っている場合にtrueを返します。</span></dt><dt><span class="refentrytitle"><a href="#TG_Intersects">Intersects</a></span><span class="refpurpose"> — 二つのTopoGeometryからのプリミティブの組がインタセクトする場合にtrueを返します。 </span></dt></dl></div><div class="refentry"><a name="TG_Equals"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Equals — 二つのTopoGeometryが同じトポロジプリミティブで成っている場合にtrueを返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">Equals</b>(</code>topogeometry  <var class="pdparam">tg1</var>, topogeometry  <var class="pdparam">tg2</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp101375432"></a><h2>説明</h2><p>二つTopoGeometryが同じトポロジプリミティブで成っている場合にtrueを返します。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はジオメトリコレクションのTopoGeometryに対応していません。異なるトポロジからなるTopoGeometryとの比較もできません。</p></td></tr></table></div><p>Availability: 1.1.0 </p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp101379912"></a><h2>例</h2><pre class="programlisting"></pre></div><div class="refsection"><a name="idp101381448"></a><h2>関連情報</h2><p><a class="xref" href="#GetTopoGeomElements" title="GetTopoGeomElements">GetTopoGeomElements</a>, <a class="xref" href="#ST_Equals" title="ST_Equals">ST_Equals</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="TG_Intersects"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Intersects — 二つのTopoGeometryからのプリミティブの組がインタセクトする場合にtrueを返します。 </p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">Intersects</b>(</code>topogeometry  <var class="pdparam">tg1</var>, topogeometry  <var class="pdparam">tg2</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp101388744"></a><h2>説明</h2><p>二つのTopoGeometryからのプリミティブがインタセクトする場合にtrueを返します。 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はジオメトリコレクションのTopoGeometryに対応していません。異なるトポロジからなるTopoGeometryとの比較もできません。また、現在のところ、階層TopoGeometry (他のTopoGeometryからなるTopoGeometry)に対応していません。</p></td></tr></table></div><p>Availability: 1.1.0 </p><p><span class="inlinemediaobject"><img src="images/check.png"></span>
 This function supports 3d and will not drop the z-index.</p></div><div class="refsection"><a name="idp101393224"></a><h2>例</h2><pre class="programlisting"></pre></div><div class="refsection"><a name="idp101394760"></a><h2>関連情報</h2><p><a class="xref" href="#ST_Intersects" title="ST_Intersects">ST_Intersects</a></p></div></div></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="Address_Standardizer"></a>第12章 住所標準化</h1></div></div></div><div class="toc"><p><b>目次</b></p><dl class="toc"><dt><span class="sect1"><a href="#Address_Standardizer_Basics">12.1. パーサの動作</a></span></dt><dt><span class="sect1"><a href="#Address_Standardizer_Types">12.2. 住所標準化の型</a></span></dt><dt><span class="sect1"><a href="#Address_Standardizer_Tables">12.3. 住所標準化テーブル</a></span></dt><dt><span class="sect1"><a href="#Address_Standardizer_Functions">12.4. 住所標準化関数</a></span></dt></dl></div><p>これは、<a class="ulink" href="http://www.pagcgeo.org/docs/html/pagc-11.html" target="_top">PAGC standardizer</a>から分かれたものです (オリジナルのコードは<a class="ulink" href="http://sourceforge.net/p/pagc/code/360/tree/branches/sew-refactor/postgresql" target="_top">PAGC PostgreSQL Address Standardizer</a>にあります)。 </p><p>住所標準化は単一行の住所のパーサで、入力に住所を取り、テーブルに保存された規則と、補助テーブルlex (lexicon, 語彙)およびgaz (gazetteer, 地名集)とを基に正規化します。</p><p>コードは、<code class="code">address_standardizer</code>という名前の、1つのPostgreSQLエクステンションとしてビルドされます。<code class="code">CREATE EXTENSION address_standardizer;</code>でインストールできます。address_standardizerエクステンションとともに、<code class="code">address_standardizer_data_us</code>というサンプルデータのエクステンションがビルドされます。これには、アメリカのgaz, lexとrulesテーブルデータがあります。このエクステンションは<code class="code">CREATE EXTENSION address_standardizer_data_us;</code>でインストールできます。</p><p>このエクステンションのコードはPostGISの<code class="filename">extensions/address_standardizer</code>内にあり、現在は自己充足しています。</p><p>インストール手順については、<a class="xref" href="#installing_pagc_address_standardizer" title="2.7. PAGC住所標準化ツールのインストールと使用">「PAGC住所標準化ツールのインストールと使用」</a>を参照してください。</p><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Address_Standardizer_Basics"></a>12.1. パーサの動作</h2></div></div></div><p>パーサは右から左に見ます。最初に郵便番号、州/県、市のMACRO (訳注: マクロ)要素を見ます。その後、番地または交差点もしくはランドマークを扱う場合には、MICRO (訳注: マイクロ)要素を見ます。現在は、国別コードや国名を見ませんが、将来的には導入できると思います。</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">国別コード</span></dt><dd><p>USまたはCAを仮定します。郵便番号か州/県で米国かカナダを分けますが、判別できない場合は米国とします。</p></dd><dt><span class="term">郵便番号</span></dt><dd><p>Perl互換の正規表現を使用して認識します。正規表現は現在はparseaddress-api.cにあり、必要な際の変更は比較的簡単です。</p></dd><dt><span class="term">州/県</span></dt><dd><p>Perl互換の正規表現を使用して認識します。正規表現は現在はparseaddress-api.cにありますが、将来的には、メンテナンスを簡単にするためにインクルードファイルに移動するかも知れません。</p></dd></dl></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Address_Standardizer_Types"></a>12.2. 住所標準化の型</h2></div><div><div class="abstract"><p class="title"><b>概要</b></p><p>本節では住所標準化でインストールされたPostgreSQLデータ型の一覧を挙げます。独自関数をデザインする時に特に重要となるキャストの振る舞いを記述しています。 </p></div></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#stdaddr">stdaddr</a></span><span class="refpurpose"> — 住所の要素からなる複合型です。<code class="varname">standardize_address</code>関数が返す型です。</span></dt></dl></div><div class="refentry"><a name="stdaddr"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>stdaddr — 住所の要素からなる複合型です。<code class="varname">standardize_address</code>関数が返す型です。</p></div><div class="refsection"><a name="idp102495944"></a><h2>説明</h2><p>住所の要素からなる複合型です。<code class="varname">standardize_address</code>関数が返す型です。要素の記述のいくつかは<a class="ulink" href="http://www.pagcgeo.org/docs/html/pagc-12.html#ss12.1" target="_top">PAGC Postal Attributes</a>から借りています。</p><p>トークン番号は、<a class="xref" href="#rulestab" title="規則テーブル">規則テーブル</a>内の出力参照番号を示します。</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method needs address_standardizer extension.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">building</span></dt><dd><p>文字列 (トークン番号<code class="code">0</code>): 建物番号や建物名を参照します。解析されていない建物識別子と型です。一般的に、ほとんどの住所では空白です。</p></dd><dt><span class="term">house_num</span></dt><dd><p>文字列 (トークン番号<code class="code">1</code>): ストリートの番号です。<code class="code">75 State Street</code>では<span class="emphasis"><em>75</em></span>にあたります。</p></dd><dt><span class="term">predir</span></dt><dd><p>文字列 (トークン番号<code class="code">2</code>): North, South, East, Westといった、ストリート名の方角前置語です。</p></dd><dt><span class="term">qual</span></dt><dd><p>文字列 (トークン番号 <code class="code">3</code>): ストリート名の修飾前置語です。<code class="code">3715 OLD HIGHWAY 99</code>では<span class="emphasis"><em>OLD</em></span>にあたります。</p></dd><dt><span class="term">pretype</span></dt><dd><p>文字列 (トークン番号 <code class="code">4</code>): STREET PREFIX TYPE (ストリート名の前置詞の種別)</p></dd><dt><span class="term">name</span></dt><dd><p>文字列 (トークン番号 <code class="code">5</code>): ストリート名</p></dd><dt><span class="term">suftype</span></dt><dd><p>文字列 (トークン番号 <code class="code">6</code>): St, Ave, Cir等の、後置詞の種別。ストリート名に続いて記述されるものです。<code class="code">75 State Street</code>では<span class="emphasis"><em>STREET</em></span>が該当します。</p></dd><dt><span class="term">sufdir</span></dt><dd><p>文字列 (トークン番号 <code class="code">7</code>): ストリート名に続くNorth, South, East, Westといった、ストリート名の方角前置語です。<code class="code">3715 TENTH AVENUE WEST</code>では<span class="emphasis"><em>WEST</em></span>が該当します。</p></dd><dt><span class="term">ruralroute</span></dt><dd><p>文字列 (トークン番号 <code class="code">8</code>): RURAL ROUTE (地方集配路線)。<code class="code">RR 7</code>では<span class="emphasis"><em>7</em></span>が該当します。</p></dd><dt><span class="term">extra</span></dt><dd><p>文字列: 階番号のような追加的情報です。</p></dd><dt><span class="term">city</span></dt><dd><p>文字列 (トークン番号 <code class="code">10</code>): 市名です。Boston等が該当します。</p></dd><dt><span class="term">state</span></dt><dd><p>文字列 (トークン番号 <code class="code">11</code>): 州名です。<code class="code">MASSACHUSETTS</code>が該当します。</p></dd><dt><span class="term">country</span></dt><dd><p>文字列 (トークン番号 <code class="code">12</code>): 国名です。<code class="code">USA</code>が該当します。</p></dd><dt><span class="term">postcode</span></dt><dd><p>文字列 (トークン番号 <code class="code">13</code>): 郵便番号 (POSTAL CODE, ZIP CODE)です。<code class="code">02109</code>等です。</p></dd><dt><span class="term">box</span></dt><dd><p>文字列 (トークン番号 <code class="code">14</code>と<code class="code">15</code>): 私書箱番号です。<code class="code">02109</code>等です。</p></dd><dt><span class="term">unit</span></dt><dd><p>文字列 (トークン番号 <code class="code">17</code>): 部屋番号です。<code class="code">APT 3B</code>の<span class="emphasis"><em>3B</em></span>が該当します。</p></dd></dl></div></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Address_Standardizer_Tables"></a>12.3. 住所標準化テーブル</h2></div><div><div class="abstract"><p class="title"><b>概要</b></p><p>本節では、住所標準化が住所の正規化に使うPostgreSQLテーブルの書式を挙げます。これらのテーブルはここで参照している名前と同じである必要はありません。例または独自ジオコーダのために、国ごとに異なるlex (lexicon, 語彙)、gaz (gazetteer, 地名集)およびrulesテーブルを持つことができます。これらのテーブルの名前は、住所標準化関数に渡されます。 </p><p>同梱されている<code class="varname">address_standardizer_data_us</code>エクステンションには、米国の住所標準化のためのデータがあります。</p></div></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#rulestab">規則テーブル</a></span><span class="refpurpose"> — 規則テーブルには、住所入力順列トークンから標準化した出力順列への対応付けに関する規則の集合が入ります。それぞれの規則は、入力トークン、-1 (終端)、出力トークン、-1、規則の種類を示す数字、規則の階級、からなります。</span></dt><dt><span class="refentrytitle"><a href="#lextab">lexテーブル</a></span><span class="refpurpose"> — lexテーブルは英数字の入力をクラス分けして (a) 入力トークン (「入力トークン」 参照)と (b)  標準化表現 とに関連付けます。</span></dt><dt><span class="refentrytitle"><a href="#gaztab">gaz table</a></span><span class="refpurpose"> — gazテーブルは、地名を標準化し、入力と、(a)入力トークン (「入力トークン」を参照して下さい)および (b) 標準化された表現とを関連付けるために使われます。</span></dt></dl></div><div class="refentry"><a name="rulestab"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>規則テーブル — 規則テーブルには、住所入力順列トークンから標準化した出力順列への対応付けに関する規則の集合が入ります。それぞれの規則は、入力トークン、-1 (終端)、出力トークン、-1、規則の種類を示す数字、規則の階級、からなります。</p></div><div class="refsection"><a name="idp102561480"></a><h2>説明</h2><p>規則テーブルには、少なくとも次に示すカラムが必要です。それ以外にカラムを追加してもかまいません。 </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">id</span></dt><dd><p>テーブルの主キー。</p></dd><dt><span class="term">rule</span></dt><dd><p>規則を示す文字列フィールド。 <a class="ulink" href="http://www.pagcgeo.org/docs/html/pagc-12.html#--r-rec--" target="_top">PAGC Address Standardizer Rule records</a>に詳細情報があります。</p><p>ruleには、入力トークンを表現する非負の整数、終端を示す-1、郵便属性を表現する非負の整数、終端を示す-1、規則種別を表現する整数、規則の階級を示す整数からなる集合が入ります。規則は0 (最低)から17 (最高)まであります。</p><p>たとえば、<code class="code">2 0 2 22 3 -1 5 5 6 7 3 -1 2 6</code>は、<span class="emphasis"><em>TYPE NUMBER TYPE DIRECT QUALIF</em></span>なる入力トークン順列が、<span class="emphasis"><em>STREET STREET SUFTYP SUFDIR QUALIF</em></span>なる出力トークン順列に対応付けされ、規則はARC_Cで、階級は6となります。 </p><p>対応する出力トークンは<a class="xref" href="#stdaddr" title="stdaddr">stdaddr</a>に挙げています。</p></dd></dl></div></div><div class="refsection"><a name="rule_input_tokens"></a><h2>入力トークン</h2><p>個々の規則は、入力トークン順列、終端を示す<code class="code">-1</code>の順です。<a class="ulink" href="http://www.pagcgeo.org/docs/html/pagc-12.html#ss12.2" target="_top">PAGC Input Tokens</a>から引用した正当な入力トークンは次の通りです。</p><p><span class="bold"><strong>書式ベースの入力トークン</strong></span></p><div class="variablelist"><dl class="variablelist"><dt><span class="term">AMPERS</span></dt><dd><p>(13) アンパサンド (&amp;)は、"and"という語を短縮するために、よく使われます</p></dd><dt><span class="term">DASH</span></dt><dd><p>(9) 区切り記号。</p></dd><dt><span class="term">DOUBLE</span></dt><dd><p>(21) 二つの文字の順列。しばしば識別子に用いられます。</p></dd><dt><span class="term">FRACT</span></dt><dd><p>(25) ときどき"civic nunber"または"unit number" (訳注: 各戸に付けられる番号)で使われます。</p></dd><dt><span class="term">MIXED</span></dt><dd><p>(23) 英数文字列。識別子に用います。</p></dd><dt><span class="term">NUMBER</span></dt><dd><p>(0) 数字からなる文字列。</p></dd><dt><span class="term">ORD</span></dt><dd><p>(15) "First"や"1st"といったものを表現する文字列。しばしばストリート名の中で使われています。</p></dd><dt><span class="term">ORD</span></dt><dd><p>(18) 一つの文字</p></dd><dt><span class="term">WORD</span></dt><dd><p>(1) 任意長を持つ文字列です。一つの文字はSINGLEおよびWORDの両方になりえます。</p></dd></dl></div><p><span class="bold"><strong>機能ベースの入力トークン</strong></span></p><div class="variablelist"><dl class="variablelist"><dt><span class="term">BOXH</span></dt><dd><p>(14) 私書箱を示すために使われる語です。たとえば <span class="emphasis"><em>Box</em></span>または<span class="emphasis"><em>PO Box</em></span>です。</p></dd><dt><span class="term">BUILDH</span></dt><dd><p>(19) 建物またはその複合体を示すための語で、通常は前置語になります。たとえば<span class="emphasis"><em>Tower 7A</em></span>では<span class="emphasis"><em>Tower</em></span>が該当します。</p></dd><dt><span class="term">BUILDT</span></dt><dd><p>(24) 建物またはその複合体を示すために使われる語または略語で、通常は後置語になります。たとえば<span class="emphasis"><em>Shopping Centre</em></span>です。</p></dd><dt><span class="term">DIRECT</span></dt><dd><p>(22) 方位を示す語です。たとえば <span class="emphasis"><em>North</em></span>です。</p></dd><dt><span class="term">MILE</span></dt><dd><p>(20) 距離標の住所を示す語です。</p></dd><dt><span class="term">ROAD</span></dt><dd><p>(6) 高速道路と道路を示す語または略語です。たとえば<span class="emphasis"><em>Interstate 5</em></span>の<span class="emphasis"><em>Interstate</em></span>です。</p></dd><dt><span class="term">RR</span></dt><dd><p>(8) 地方集配路線を示す語または略語です。たとえば<span class="emphasis"><em>RR</em></span>です。</p></dd><dt><span class="term">TYPE</span></dt><dd><p>(2) ストリート種別を示す語または略語です。たとえば<span class="emphasis"><em>ST</em></span>や<span class="emphasis"><em>AVE</em></span>です。</p></dd><dt><span class="term">UNITH</span></dt><dd><p>(16) 内部の部分住所を示す語または略語です。たとえば<span class="emphasis"><em>APT</em></span>や<span class="emphasis"><em>UNIT</em></span>です。</p></dd></dl></div><p><span class="bold"><strong>郵便型入力トークン</strong></span></p><div class="variablelist"><dl class="variablelist"><dt><span class="term">QUINT</span></dt><dd><p>(28) 5桁の番号。ZIPコードです。</p></dd><dt><span class="term">QUAD</span></dt><dd><p>(29) 4桁の番号。ZIP4です。</p></dd><dt><span class="term">PCH</span></dt><dd><p>(27) 英数3文字の順列です。カナダの郵便番号の先頭3文字であるFSAを示します。</p></dd><dt><span class="term">PCT</span></dt><dd><p>(26) 英数3文字の順列です。カナダの郵便番号の末尾3文字です。</p></dd></dl></div><p><span class="bold"><strong>ストップワード</strong></span></p><p>STOPWORD (訳注: 処理対象外とする語)はWORDと結合します。規則で、複数のWORDとSTOPWORDの列は、単一のWORDトークンで表現されます。</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">STOPWORD</span></dt><dd><p>(7) 重要性が低い語で、パース時に省かれます。たとえば<span class="emphasis"><em>THE</em></span>が該当します。</p></dd></dl></div></div><div class="refsection"><a name="idp102591816"></a><h2>出力トークン</h2><p>1番目の-1 (終端)の後に、出力トークンが続き、その後に<code class="code">-1</code>が続きます。対応する出力トークンの番号は、<a class="xref" href="#stdaddr" title="stdaddr">stdaddr</a>に挙げています。許されるものは、規則の種類に依存します。それぞれの規則種別で有効なトークンは<a class="xref" href="#rule_types_rank" title="規則種別と階級">「規則種別と階級」</a>に挙げています。</p></div><div class="refsection"><a name="rule_types_rank"></a><h2>規則種別と階級</h2><p>規則の最後の部分は規則種別で、次に挙げるものの一つが示すものです。この後には階級が続きます。規則は0 (最低) から17 (最高)までに階級付けされます。</p><p><span class="bold"><strong>MACRO_C</strong></span></p><p>(トークン番号 = "<span class="bold"><strong>0</strong></span>") <span class="emphasis"><em>PLACE STATE ZIP</em></span>のようなMACRO節をパースするための規則のクラス。</p><p><span class="bold"><strong>MACRO_C出力トークン</strong></span> (<a class="ulink" href="http://www.pagcgeo.org/docs/html/pagc-12.html#--r-typ--" target="_top">http://www.pagcgeo.org/docs/html/pagc-12.html#--r-typ--</a>からの引用)</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">CITY</span></dt><dd><p>(トークン番号 "10") たとえば"Albany" (訳注: ニューヨーク州の州都)等。</p></dd><dt><span class="term">STATE</span></dt><dd><p>(トークン番号 "11") たとえば"NY" (訳注: ニューヨーク州)等。</p></dd><dt><span class="term">NATION</span></dt><dd><p>(トークン番号 "12") ほとんどの参照ファイル内で使われない属性です。たとえば"USA"等。</p></dd><dt><span class="term">POSTAL</span></dt><dd><p>(トークン番号 "13") (SADS elements "ZIP CODE" , "PLUS 4" ). 米国Zip (郵便番号)とカナダ郵便番号の両方で使われます。</p></dd></dl></div><p><span class="bold"><strong>MICRO_C</strong></span></p><p>(トークン番号 = "<span class="bold"><strong>1</strong></span>") 完全なMICRO節 (House, street, sufdir, predir, pretyp, suftype, qualif等)をパースするための規則のクラス (ARC_CとCIVIC_Cの和)。建物フェーズでは使われません。</p><p><span class="bold"><strong>MICRO_C 出力トークン</strong></span> (<a class="ulink" href="http://www.pagcgeo.org/docs/html/pagc-12.html#--r-typ--" target="_top">http://www.pagcgeo.org/docs/html/pagc-12.html#--r-typ--</a>からの引用)</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">HOUSE</span></dt><dd><p>文字列 (トークン番号<code class="code">1</code>): ストリートの番号です。<code class="code">75 State Street</code>では<span class="emphasis"><em>75</em></span>にあたります。</p></dd><dt><span class="term">predir</span></dt><dd><p>文字列 (トークン番号<code class="code">2</code>): North, South, East, Westといった、ストリート名の方角前置語です。</p></dd><dt><span class="term">qual</span></dt><dd><p>文字列 (トークン番号 <code class="code">3</code>): ストリート名の修飾前置語です。<code class="code">3715 OLD HIGHWAY 99</code>では<span class="emphasis"><em>OLD</em></span>にあたります。</p></dd><dt><span class="term">pretype</span></dt><dd><p>文字列 (トークン番号 <code class="code">4</code>): STREET PREFIX TYPE (ストリート名の前置詞の種別)</p></dd><dt><span class="term">street</span></dt><dd><p>文字列 (トークン番号 <code class="code">5</code>): ストリート名</p></dd><dt><span class="term">suftype</span></dt><dd><p>文字列 (トークン番号 <code class="code">6</code>): St, Ave, Cir等の、後置詞の種別。ストリート名に続いて記述されるものです。<code class="code">75 State Street</code>では<span class="emphasis"><em>STREET</em></span>が該当します。</p></dd><dt><span class="term">sufdir</span></dt><dd><p>文字列 (トークン番号 <code class="code">7</code>): ストリート名に続くNorth, South, East, Westといった、ストリート名の方角前置語です。<code class="code">3715 TENTH AVENUE WEST</code>では<span class="emphasis"><em>WEST</em></span>が該当します。</p></dd></dl></div><p><span class="bold"><strong>ARC_C</strong></span></p><p>(トークン番号 = "<span class="bold"><strong>2</strong></span>") HOUSE属性を除いたMICRO節をパースするための規則のクラス。MICRO_CからHOUSEトークンを除いた出力トークン集合と同じです。</p><p><span class="bold"><strong>CIVIC_C</strong></span></p><p>(トークン番号 = "<span class="bold"><strong>3</strong></span>") HOUSE属性をパースするための規則のクラス。</p><p><span class="bold"><strong>EXTRA_C</strong></span></p><p>(トークン番号 = "<span class="bold"><strong>4</strong></span>") EXTRA属性 (ジオコーディングから除かれる属性)をパースするための規則のクラス。</p><p><span class="bold"><strong>EXTRA_C 出力トークン</strong></span> (<a class="ulink" href="http://www.pagcgeo.org/docs/html/pagc-12.html#--r-typ--" target="_top">http://www.pagcgeo.org/docs/html/pagc-12.html#--r-typ--</a>からの引用)</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">BLDNG</span></dt><dd><p>(トークン番号 <code class="code">0</code>): パースされていない建物識別子と種別。</p></dd><dt><span class="term">BOXH</span></dt><dd><p>(トークン番号 <code class="code">14</code>): <code class="code">BOX 3B</code>内の<span class="bold"><strong>BOX</strong></span>にあたります。</p></dd><dt><span class="term">BOXT</span></dt><dd><p>(トークン番号 <code class="code">15</code>): <code class="code">BOX 3B</code>内の<span class="bold"><strong>3B</strong></span>にあたります。</p></dd><dt><span class="term">RR</span></dt><dd><p>(トークン番号 <code class="code">8</code>): <code class="code">RR 7</code>内の<span class="bold"><strong>RR</strong></span>にあたります。</p></dd><dt><span class="term">UNITH</span></dt><dd><p>(トークン番号 <code class="code">16</code>): <code class="code">APT 3B</code>内の<span class="bold"><strong>APT</strong></span>にあたります。</p></dd><dt><span class="term">UNITT</span></dt><dd><p>(トークン番号<code class="code">17</code>): <code class="code">APT 3B</code>内の<span class="bold"><strong>3B</strong></span>にあたります。</p></dd><dt><span class="term">UNKNWN</span></dt><dd><p>(トークン番号<code class="code">9</code>): その他分類対象外の出力。</p></dd></dl></div></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="lextab"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>lexテーブル — lexテーブルは英数字の入力をクラス分けして (a) 入力トークン (<a class="xref" href="#rule_input_tokens" title="入力トークン">「入力トークン」</a> 参照)と (b)  標準化表現 とに関連付けます。</p></div><div class="refsection"><a name="idp102649288"></a><h2>説明</h2><p>lex (lexiconの略語)テーブルは、英数入力を分類し、入力を (a) <a class="xref" href="#rule_input_tokens" title="入力トークン">「入力トークン」</a>および (b) 標準化された表現、に関連付けます。</p><p>lexは少なくとも次のカラムを持ちます。追加できます。</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">id</span></dt><dd><p>テーブルの主キー。</p></dd><dt><span class="term">seq</span></dt><dd><p>整数: 定義番号？</p></dd><dt><span class="term">word</span></dt><dd><p>文字列: 入力単語</p></dd><dt><span class="term">stdword</span></dt><dd><p>文字列: 正規化した置き換え語</p></dd><dt><span class="term">token</span></dt><dd><p>整数: その語の種別。このコンテキストで使われる場合のみ置き換えられます。<a class="ulink" href="http://www.pagcgeo.org/docs/html/pagc-12.html#--i-tok--" target="_top">PAGC Tokens</a>を参照して下さい。</p></dd></dl></div></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="gaztab"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>gaz table — gazテーブルは、地名を標準化し、入力と、(a)入力トークン (<a class="xref" href="#rule_input_tokens" title="入力トークン">「入力トークン」</a>を参照して下さい)および (b) 標準化された表現とを関連付けるために使われます。</p></div><div class="refsection"><a name="idp100158664"></a><h2>説明</h2><p>gaz (gazeteerの略語)テーブルは、地名の標準化を行い、(a) <a class="xref" href="#rule_input_tokens" title="入力トークン">「入力トークン」</a>と (b) 標準化された表現とを入力に関連付けるために使用します。たとえば、米国にいる場合には、州名と、関連する略語を使用してロードすることができます。</p><p>gazテーブルは少なくとも次のカラムを持ちます。独自の目的のために追加することができます。</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">id</span></dt><dd><p>テーブルの主キー。</p></dd><dt><span class="term">seq</span></dt><dd><p>整数: 定義番号？ - 語のインスタンスに使われる識別子</p></dd><dt><span class="term">word</span></dt><dd><p>文字列: 入力単語</p></dd><dt><span class="term">stdword</span></dt><dd><p>文字列: 正規化した置き換え語</p></dd><dt><span class="term">token</span></dt><dd><p>整数: その語の種別。このコンテキストで使われる場合のみ置き換えられます。<a class="ulink" href="http://www.pagcgeo.org/docs/html/pagc-12.html#--i-tok--" target="_top">PAGC Tokens</a>を参照して下さい。</p></dd></dl></div></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Address_Standardizer_Functions"></a>12.4. 住所標準化関数</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#parse_address">parse_address</a></span><span class="refpurpose"> — 1行の住所を取り、分割します。</span></dt><dt><span class="refentrytitle"><a href="#standardize_address">standardize_address</a></span><span class="refpurpose"> — lexテーブル、gazテーブルおよび規則テーブルを使って、入力住所をstdaddr形式で返します。</span></dt></dl></div><div class="refentry"><a name="parse_address"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>parse_address — 1行の住所を取り、分割します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">record <b class="fsfunc">parse_address</b>(</code>text  <var class="pdparam">address</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp100173896"></a><h2>説明</h2><p>一つの住所を入力に取り、<span class="emphasis"><em>num</em></span>、<span class="emphasis"><em>street</em></span>、<span class="emphasis"><em>street2</em></span>、<span class="emphasis"><em>address1</em></span>、<span class="emphasis"><em>city</em></span>、<span class="emphasis"><em>state</em></span>、<span class="emphasis"><em>zip</em></span>、<span class="emphasis"><em>zipplus</em></span>、<span class="emphasis"><em>country</em></span>からなるレコードを一つ返します。</p><p>初出: 2.2.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method needs address_standardizer extension.</p></div><div class="refsection"><a name="idp100180552"></a><h2>例</h2><p>単一の住所</p><pre class="programlisting">SELECT num, street, city, zip, zipplus
        FROM parse_address('1 Devonshire Place, Boston, MA 02109-1234') AS a;</pre><pre class="screen">num |      street      |  city  |  zip  | zipplus
-----+------------------+--------+-------+---------
 1   | Devonshire Place | Boston | 02109 | 1234                </pre><p>住所テーブル</p><pre class="programlisting">-- 基本テーブル
CREATE TABLE places(addid serial PRIMARY KEY, address text);

INSERT INTO places(address)
VALUES ('529 Main Street, Boston MA, 02129'),
 ('77 Massachusetts Avenue, Cambridge, MA 02139'),
 ('25 Wizard of Oz, Walaford, KS 99912323'),
 ('26 Capen Street, Medford, MA'),
 ('124 Mount Auburn St, Cambridge, Massachusetts 02138'),
 ('950 Main Street, Worcester, MA 01610');

 -- 住所のパース
 -- 全てのフィールドで使う場合には (a).* が使えます
SELECT addid, (a).num, (a).street, (a).city, (a).state, (a).zip, (a).zipplus
FROM (SELECT addid, parse_address(address) As a
 FROM places) AS p;</pre><pre class="screen">addid | num |        street        |   city    | state |  zip  | zipplus
-------+-----+----------------------+-----------+-------+-------+---------
     1 | 529 | Main Street          | Boston    | MA    | 02129 |
     2 | 77  | Massachusetts Avenue | Cambridge | MA    | 02139 |
     3 | 25  | Wizard of Oz         | Walaford  | KS    | 99912 | 323
     4 | 26  | Capen Street         | Medford   | MA    |       |
     5 | 124 | Mount Auburn St      | Cambridge | MA    | 02138 |
     6 | 950 | Main Street          | Worcester | MA    | 01610 |
(6 rows)</pre></div><div class="refsection"><a name="idp100184520"></a><h2>関連情報</h2><p></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="standardize_address"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>standardize_address — lexテーブル、gazテーブルおよび規則テーブルを使って、入力住所をstdaddr形式で返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">stdaddr <b class="fsfunc">standardize_address</b>(</code>text  <var class="pdparam">lextab</var>, text  <var class="pdparam">gaztab</var>, text  <var class="pdparam">rultab</var>, text  <var class="pdparam">address</var><code>)</code>;</p><p><code class="funcdef">stdaddr <b class="fsfunc">standardize_address</b>(</code>text  <var class="pdparam">lextab</var>, text  <var class="pdparam">gaztab</var>, text  <var class="pdparam">rultab</var>, text  <var class="pdparam">micro</var>, text  <var class="pdparam">macro</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp102710216"></a><h2>説明</h2><p>指定された<a class="xref" href="#lextab" title="lexテーブル">lexテーブル</a>、<a class="xref" href="#gaztab" title="gaz table">gaz table</a>および<a class="xref" href="#rulestab" title="規則テーブル">規則テーブル</a>のテーブルを使って、入力住所を<a class="xref" href="#stdaddr" title="stdaddr">stdaddr</a>形式で返します。</p><p>1番目の形式: 単一行で住所を取る形式です。</p><p>2番目の形式: 住所を二つの部分から取ります。<code class="varname">micro</code>は<code class="code">house_num street</code>等のような、標準的な宛先書式の1行目です。<code class="varname">macro</code>は、<code class="code">city, state postal_code country</code>等のような、標準的な宛先書式の2行目です。</p><p>初出: 2.2.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method needs address_standardizer extension.</p></div><div class="refsection"><a name="idp102717512"></a><h2>例</h2><p>address_standardizer_data_usエクステンションを使います。</p><pre class="programlisting">CREATE EXTENSION address_standardizer_data_us; -- only needs to be done once</pre><p>一つ目の版: 単一行住所。米国でない住所では十分に働きません。</p><pre class="programlisting">SELECT house_num, name, suftype, city, country, state, unit  FROM standardize_address('us_lex',
                           'us_gaz', 'us_rules', 'One Devonshire Place, PH 301, Boston, MA 02109');</pre><pre class="screen">house_num |    name    | suftype |  city  | country |     state     |      unit
----------+------------+---------+--------+---------+---------------+-----------------
1         | DEVONSHIRE | PLACE   | BOSTON | USA     | MASSACHUSETTS | # PENTHOUSE 301</pre><p>Tigerジオコーダに同梱されているテーブルを使います。この例は<code class="varname">postgis_tiger_geocoder</code>をインストールしている場合のみ動作します。</p><pre class="programlisting">SELECT *  FROM standardize_address('tiger.pagc_lex',
         'tiger.pagc_gaz', 'tiger.pagc_rules', 'One Devonshire Place, PH 301, Boston, MA 02109-1234');</pre><p>読みやすくするために、hstoreエクステンションを使ってダウンぷします。必要なら CREATE EXTENSION hstore; を実行します。</p><pre class="programlisting">SELECT (each(hstore(p))).*
 FROM standardize_address('tiger.pagc_lex', 'tiger.pagc_gaz',
   'tiger.pagc_rules', 'One Devonshire Place, PH 301, Boston, MA 02109') As p;</pre><pre class="screen">key     |      value
------------+-----------------
 box        |
 city       | BOSTON
 name       | DEVONSHIRE
 qual       |
 unit       | # PENTHOUSE 301
 extra      |
 state      | MA
 predir     |
 sufdir     |
 country    | USA
 pretype    |
 suftype    | PL
 building   |
 postcode   | 02109
 house_num  | 1
 ruralroute |
(16 rows)
                        </pre><p>二つ目の形式: 二つの部分からなる住所</p><pre class="programlisting">SELECT (each(hstore(p))).*
 FROM standardize_address('tiger.pagc_lex', 'tiger.pagc_gaz',
   'tiger.pagc_rules', 'One Devonshire Place, PH 301', 'Boston, MA 02109, US') As p;</pre><pre class="screen">key     |      value
------------+-----------------
 box        |
 city       | BOSTON
 name       | DEVONSHIRE
 qual       |
 unit       | # PENTHOUSE 301
 extra      |
 state      | MA
 predir     |
 sufdir     |
 country    | USA
 pretype    |
 suftype    | PL
 building   |
 postcode   | 02109
 house_num  | 1
 ruralroute |
(16 rows)</pre></div><div class="refsection"><a name="idp101119304"></a><h2>関連情報</h2><p><a class="xref" href="#stdaddr" title="stdaddr">stdaddr</a>, <a class="xref" href="#rulestab" title="規則テーブル">規則テーブル</a>, <a class="xref" href="#lextab" title="lexテーブル">lexテーブル</a>, <a class="xref" href="#gaztab" title="gaz table">gaz table</a>, <a class="xref" href="#Pagc_Normalize_Address" title="Pagc_Normalize_Address文字列のストリート住所を与えると、道路後置辞、前置辞、標準タイプ、番地、ストリート名等を複数フィールドに分解して持つnorm_addy複合型を返します。この関数は、tiger_geocoder同梱のルックアップテーブルだけを使います (Tigerデータは不要です)。住所標準化エクステンションが必要です。">Pagc_Normalize_Address文字列のストリート住所を与えると、道路後置辞、前置辞、標準タイプ、番地、ストリート名等を複数フィールドに分解して持つ<code class="varname">norm_addy</code>複合型を返します。この関数は、tiger_geocoder同梱のルックアップテーブルだけを使います (Tigerデータは不要です)。住所標準化エクステンションが必要です。</a></p></div></div></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="Extras"></a>第13章 PostGIS追加機能</h1></div></div></div><div class="toc"><p><b>目次</b></p><dl class="toc"><dt><span class="sect1"><a href="#Tiger_Geocoder">13.1. Tigerジオコーダ</a></span></dt></dl></div><p>本章では、PostGISのソースアーカイブとソースレポジトリのextrasフォルダにある機能を記述します。 これらは必ずPostGISバイナリ版に同梱されているものではありませんが、通常は実行可能なplpgsqlベースのものまたは標準的なシェルスクリプトです。</p><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Tiger_Geocoder"></a>13.1. Tigerジオコーダ</h2></div><div><div class="abstract"><p class="title"><b>概要</b></p><p>米国国勢調査局が公開している<a class="ulink" href="http://www.census.gov/geo/www/tiger/" target="_top">TIGER (Topologically Integrated Geographic Encoding and Referencing system ) / Line and Master Address database export</a>で動作するよう書かれた、PL/pgSQLベースのジオコーダです。 </p><p>データローダ機能、住所正規化、住所ジオコーダおよび逆ジオコーダ、の四つの要素があります。 </p><p>米国のための設計ですが、概念および機能の多くは適用可能で、他国の住所と道路ネットワークで動作するように適合させることができます (訳注: 日本の地名については未知です)。</p><p>Tiger関連の関数、道路型前置辞・道路型後置辞・州といった再利用可能な参照データ、データロード管理のための様々な制御テーブル、全てのロードされたテーブルが継承するスケルトンテーブル、を収容するための<code class="varname">tiger</code>というスキーマが、スクリプトによって作成されます。</p><p><code class="varname">tiger_data</code>という、もう一つのスキーマが作られます。ここに、ローダが米国国勢調査サイトからダウンロードしてデータベースにロードした州ごとの全ての国勢調査データが収容されます。現在のモデルでは、州ごとのテーブルは、<code class="varname">ma_addr</code>や<code class="varname">ma_edges</code>といったように名前の先頭に州コードを付けていて、州データのみに強制する制約が付いています。これらのテーブルは<code class="varname">tiger schema</code>にある<code class="varname">addr</code>, <code class="varname">faces</code>, <code class="varname">edges</code>等から継承されています。 </p><p>全てのジオコード関数は基底テーブルを参照するだけです。そのため、<code class="varname">tiger_data</code>データスキーマやそのデータを他のスキーマに分割できないという条件はありません。例えば、州ごとに異なるスキーマにしても、<code class="varname">tiger</code>内のテーブルから継承されているなら使用可能です。</p><p>お手持ちのデータベース内のエクステンションを有効にし、使用するデータをロードする方法については、<a class="xref" href="#install_tiger_geocoder_extension" title="2.8.1. TigerジオコーダをPostGISデータベースで有効にする: エクステンションを使用">「TigerジオコーダをPostGISデータベースで有効にする: エクステンションを使用」</a>を参照して下さい。</p><p> </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Tigerジオコーダ (tiger_2010)を使っている場合には、extras/tiger内にあるupgrade_geocoder.bat / .sh を使ってアップグレードすることができます。<code class="varname">tiger_2010</code>と<code class="varname">tiger_2011以上</code>での大きな変更点は、<code class="varname">county</code>テーブルと<code class="varname">state</code>テーブルが、stateごとに出現することがなくなっています。tiger_2010からのデータを持っていて、tiger_2015に置き換えたい場合には、<a class="xref" href="#upgrade_tiger_geocoder" title="2.8.5. Tigerジオコーダのアップグレード">「Tigerジオコーダのアップグレード」</a>を参照して下さい。 </p></td></tr></table></div><p>

              </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>PostGIS 2.2.0での新規機能は、Tiger 2015データに対応したことと、住所標準化がPostGISの一部に取り入れられたことです。</p><p>PostGIS 2.1.0での新規機能は、PostgreSQL 9.1以上では、TigerジオコーダをPostgreSQLエクステンションモデルでインストールすることができるようになったことです。詳細については<a class="xref" href="#install_tiger_geocoder_extension" title="2.8.1. TigerジオコーダをPostGISデータベースで有効にする: エクステンションを使用">「TigerジオコーダをPostGISデータベースで有効にする: エクステンションを使用」</a>を参照して下さい。</p></td></tr></table></div><p>
              </p><p>PostGISが用意している<a class="xref" href="#Normalize_Address" title="Normalize_Address">Normalize_Address</a>の代替として<a class="xref" href="#Pagc_Normalize_Address" title="Pagc_Normalize_Address文字列のストリート住所を与えると、道路後置辞、前置辞、標準タイプ、番地、ストリート名等を複数フィールドに分解して持つnorm_addy複合型を返します。この関数は、tiger_geocoder同梱のルックアップテーブルだけを使います (Tigerデータは不要です)。住所標準化エクステンションが必要です。">Pagc_Normalize_Address文字列のストリート住所を与えると、道路後置辞、前置辞、標準タイプ、番地、ストリート名等を複数フィールドに分解して持つ<code class="varname">norm_addy</code>複合型を返します。この関数は、tiger_geocoder同梱のルックアップテーブルだけを使います (Tigerデータは不要です)。住所標準化エクステンションが必要です。</a>関数があります。コンパイルとインストールの方法については、<a class="xref" href="#installing_pagc_address_standardizer" title="2.7. PAGC住所標準化ツールのインストールと使用">「PAGC住所標準化ツールのインストールと使用」</a>を参照して下さい。</p><p>設計:</p><p>このプロジェクトの目標は、任意の米国住所文字列を処理し、正規化したTiger国勢調査データを使ってポイントジオメトリを生成し、与えられた住所の位置や、位置のもっともらしさを反映した評価値を算出する、十分に実用的なジオコーダを構築することです。なお、評価値は高いほど悪い結果とします。</p><p>PostGIS 2.0.0で導入された<code class="varname">reverse_geocode</code>は、GPS位置のストリート住所と交差点を得るのに便利です。</p><p>ジオコーダは、PostGISに慣れている方ならだれでもインストールと使用が容易な程度に単純であるべきで、PostGISがサポートする全てのプラットフォームで簡便にインストール、使用ができるべきです。</p><p>書式や綴りの誤りがあっても確実に機能するための十分なロバスト性があるべきです。</p><p>将来のデータ更新が使えるか、最小のプログラムの変更で他のデータが使えるための十分な拡張性もあるべきです。</p><p>
                </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>関数が確実に動作するために、<code class="varname">tiger</code>スキーマは、データベース検索パスに追加されていなければなりません。</p></td></tr></table></div><p>
            </p></div></div></div></div><div class="toc"><dl class="toc"><dt><span class="refentrytitle"><a href="#Drop_Indexes_Generate_Script">Drop_Indexes_Generate_Script</a></span><span class="refpurpose"> — tigerスキーマとユーザが指定したスキーマ上の、全ての主キーでなく、かつユニークでないインデックスを削除します。スキーマを指定しない場合のデフォルトスキーマは、<code class="varname">tiger_data</code>です。</span></dt><dt><span class="refentrytitle"><a href="#Drop_Nation_Tables_Generate_Script">Drop_Nation_Tables_Generate_Script</a></span><span class="refpurpose"> — 指定したスキーマ内のテーブルのうち、<code class="varname">county_all</code>, <code class="varname">state_all</code>または、<code class="varname">county</code> or <code class="varname">state</code>を削除するスクリプトを生成します。</span></dt><dt><span class="refentrytitle"><a href="#Drop_State_Tables_Generate_Script">Drop_State_Tables_Generate_Script</a></span><span class="refpurpose"> — 指定したスキーマ内の、名前が州コードから始まるテーブルを全て削除するスクリプトを生成します。スキーマが指定されていない場合のデフォルトスキーマは<code class="varname">tiger_data</code>です。</span></dt><dt><span class="refentrytitle"><a href="#Geocode">Geocode</a></span><span class="refpurpose"> — 住所を文字列 (もしくは他の正規化された住所)として取り、可能性のある位置の集合を返します。返される集合の要素は、NAD 83経度緯度のポイントジオメトリ、正規化された住所と評価値を持ちます。評価値は低いほど可能性が高いことを示しています。結果は評価値の低い順に並べ替えられます。オプションにmax_result (最大結果数、デフォルトは10)とrestrict_region (制限領域、デフォルトはNULL)を渡すことができます。</span></dt><dt><span class="refentrytitle"><a href="#Geocode_Intersection">Geocode_Intersection</a></span><span class="refpurpose"> — インタセクトする二つのストリート、州コード、市名、郵便番号を引数に取り、最初の交差点の可能性のある位置の集合を出力します。geomoutにNAD83経度緯度のポイント、<code class="varname">normalized_address</code>にそれぞれの位置、ratingに評価値がそれぞれ入ります。評価値が低いほど合致度が高くなります。結果は評価値の低い順にソートされます。最大結果数を渡すことができ、デフォルトは10です。Tigerデータ (エッジ、フェイス、住所)と、PostgreSQLあいまい文字列合致 (soundex, levenshtein)を使います。</span></dt><dt><span class="refentrytitle"><a href="#Get_Geocode_Setting">Get_Geocode_Setting</a></span><span class="refpurpose"> — tiger.geocode_settingsテーブルに格納されている設定のうち指定したものの値を返します。</span></dt><dt><span class="refentrytitle"><a href="#Get_Tract">Get_Tract</a></span><span class="refpurpose"> — ジオメトリで指定した位置の米国国勢調査統計区またはtractテーブルのフィールドを返します。デフォルトでは、統計区の短縮名を返します。</span></dt><dt><span class="refentrytitle"><a href="#Install_Missing_Indexes">Install_Missing_Indexes</a></span><span class="refpurpose"> — ジオコーダで結合や検索条件に使われ、インデックスが付いていなキーカラムを持つ全てのテーブルを探し、インデックスを追加します。</span></dt><dt><span class="refentrytitle"><a href="#Loader_Generate_Census_Script">Loader_Generate_Census_Script</a></span><span class="refpurpose"> — 指定した州について、tract (統計区)、bg (block group, 細分区グループ)、tabblock (ブロック)をダウンロードし、<code class="varname">tiger_data</code>に格納するための、指定したプラットフォーム用のシェルスクリプトを生成します。行ごとに州ごとのスクリプトが返されます。</span></dt><dt><span class="refentrytitle"><a href="#Loader_Generate_Script">Loader_Generate_Script</a></span><span class="refpurpose"> — 指定したプラットフォーム用の、指定した州のTigerデータをダウンロードし、格納準備を行い、<code class="varname">tiger_data</code>スキーマに格納するシェルスクリプトを生成します。行ごとに州ごとのスクリプトが返ります。最新版ではTiger 2010のデータ構造変更に対応していて、国勢統計区、細分区グループ、細分区 (tabblocks)テーブルをダウンロードすることができます。</span></dt><dt><span class="refentrytitle"><a href="#Loader_Generate_Nation_Script">Loader_Generate_Nation_Script</a></span><span class="refpurpose"> — 指定したプラットフォーム用の、国と州のルックアップテーブルをロードするシェルスクリプトを生成します。</span></dt><dt><span class="refentrytitle"><a href="#Missing_Indexes_Generate_Script">Missing_Indexes_Generate_Script</a></span><span class="refpurpose"> — ジオコーダで結合に使われるキーカラムを持ち、インデックスが付いていないキーカラムを持つすべてのテーブルを検索し、インデックスを追加するSQLデータ定義言語を出力します。</span></dt><dt><span class="refentrytitle"><a href="#Normalize_Address">Normalize_Address</a></span><span class="refpurpose"> — 文字列で住所が与えられると、道路後置辞、前置辞、正規化された種別、番地、ストリート名等をフィールドに分けて持つ<code class="varname">norm_addy</code>複合型を返します。tiger_geocoderに同梱されているルックアップデータで動作します (Tigerデータ自体は不要です)。</span></dt><dt><span class="refentrytitle"><a href="#Pagc_Normalize_Address">Pagc_Normalize_Address文字列のストリート住所を与えると、道路後置辞、前置辞、標準タイプ、番地、ストリート名等を複数フィールドに分解して持つ<code class="varname">norm_addy</code>複合型を返します。この関数は、tiger_geocoder同梱のルックアップテーブルだけを使います (Tigerデータは不要です)。住所標準化エクステンションが必要です。</a></span><span class="refpurpose"> — 文字列のストリート住所を与えると、道路後置辞、前置辞、標準タイプ、番地、ストリート名等を複数フィールドに分解して持つ<code class="varname">norm_addy</code>複合型を返します。この関数は、tiger_geocoder同梱のルックアップテーブルだけを使います (Tigerデータは不要です)。住所標準化エクステンションが必要です。</span></dt><dt><span class="refentrytitle"><a href="#Pprint_Addy">Pprint_Addy</a></span><span class="refpurpose"> — <code class="varname">norm_addy</code>複合型オブジェクトを与えると、印刷表現を返します。通常はnormalize_addressと併用します。</span></dt><dt><span class="refentrytitle"><a href="#Reverse_Geocode">Reverse_Geocode</a></span><span class="refpurpose"> — 登録されている空間参照系に基づくポイントジオメトリを引数に取り、理論的に可能性のある住所の配列と交差するストリートの配列を一つのレコードで返します。include_strnum_range = trueの場合には、交差するストリートに番地範囲を追加します。</span></dt><dt><span class="refentrytitle"><a href="#Topology_Load_Tiger">Topology_Load_Tiger</a></span><span class="refpurpose"> — Tigerデータの定義領域をPostGISトポロジにロードして、Tigerデータをトポロジの空間参照系に投影変換し、トポロジの許容精度にスナップします。</span></dt><dt><span class="refentrytitle"><a href="#Set_Geocode_Setting">Set_Geocode_Setting</a></span><span class="refpurpose"> — ジオコーダ関数の振る舞いに影響を与える設定を行います。</span></dt></dl></div><p>PostGIS用の二つのオープンソースジオコーダがあります。これらはTigerジオコーダと違い、他国のジオコーディングに対応している利点があります。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="ulink" href="http://wiki.openstreetmap.org/wiki/Nominatim" target="_top">Nominatim</a>は、OpenStreetMapの地名集データを使います。データのロードにはosm2pgsqlが必要です。PostgreSQL 8.4以上とPostGIS 1.5以上が必要です。Webサービスのインタフェースとして作られていて、Webサービスと呼ばれるような設計に見えます。Tigerジオコーダと同じように、ジオコーダと逆ジオコーダの要素を持ちます。文書からでは、Tigerジオコーダのような純粋なSQLインタフェースを持っているのか、多くの処理がWebインタフェースに実装されているのか、は明確ではありません。</p></li><li class="listitem"><p><a class="ulink" href="http://www.gisgraphy.com/" target="_top">GIS Graphy</a>も、PostGISを使用したもので、NominatimのようにOpenStreetMap (OSM)データを使用します。OSMデータのロードを行うローダとNominatimのように米国だけでなくジオコーディングを行う能力があります。Nominatimとよく似ていて、Webサービスとして動作し、Java 1.5、サーブレットアプリケーション、Apache Solrに依存しています。GisGraphyは、複数プラットフォームで動作し、他の機能の中には逆ジオコーダがあります。</p></li></ul></div><div class="refentry"><a name="Drop_Indexes_Generate_Script"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Drop_Indexes_Generate_Script — tigerスキーマとユーザが指定したスキーマ上の、全ての主キーでなく、かつユニークでないインデックスを削除します。スキーマを指定しない場合のデフォルトスキーマは、<code class="varname">tiger_data</code>です。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">Drop_Indexes_Generate_Script</b>(</code>text  <var class="pdparam">param_schema=tiger_data</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp103088200"></a><h2>説明</h2><p>tigerスキーマとユーザが指定したスキーマ上の、全ての主キーでなく、かつユニークでないインデックスを削除します。スキーマを指定しない場合のデフォルトスキーマは、<code class="varname">tiger_data</code>です。</p><p>PostgreSQLのクエリプランナを混乱させる可能性があり、不要なディスク容量を取る、インデックスの膨張を最小化するために使います。ジオコーダで使われるインデックスを追加する関数<a class="xref" href="#Install_Missing_Indexes" title="Install_Missing_Indexes">Install_Missing_Indexes</a>を併用します。</p><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp103090888"></a><h2>例</h2><pre class="programlisting">SELECT drop_indexes_generate_script() As actionsql;
actionsql
---------------------------------------------------------
DROP INDEX tiger.idx_tiger_countysub_lookup_lower_name;
DROP INDEX tiger.idx_tiger_edges_countyfp;
DROP INDEX tiger.idx_tiger_faces_countyfp;
DROP INDEX tiger.tiger_place_the_geom_gist;
DROP INDEX tiger.tiger_edges_the_geom_gist;
DROP INDEX tiger.tiger_state_the_geom_gist;
DROP INDEX tiger.idx_tiger_addr_least_address;
DROP INDEX tiger.idx_tiger_addr_tlid;
DROP INDEX tiger.idx_tiger_addr_zip;
DROP INDEX tiger.idx_tiger_county_countyfp;
DROP INDEX tiger.idx_tiger_county_lookup_lower_name;
DROP INDEX tiger.idx_tiger_county_lookup_snd_name;
DROP INDEX tiger.idx_tiger_county_lower_name;
DROP INDEX tiger.idx_tiger_county_snd_name;
DROP INDEX tiger.idx_tiger_county_the_geom_gist;
DROP INDEX tiger.idx_tiger_countysub_lookup_snd_name;
DROP INDEX tiger.idx_tiger_cousub_countyfp;
DROP INDEX tiger.idx_tiger_cousub_cousubfp;
DROP INDEX tiger.idx_tiger_cousub_lower_name;
DROP INDEX tiger.idx_tiger_cousub_snd_name;
DROP INDEX tiger.idx_tiger_cousub_the_geom_gist;
DROP INDEX tiger_data.idx_tiger_data_ma_addr_least_address;
DROP INDEX tiger_data.idx_tiger_data_ma_addr_tlid;
DROP INDEX tiger_data.idx_tiger_data_ma_addr_zip;
DROP INDEX tiger_data.idx_tiger_data_ma_county_countyfp;
DROP INDEX tiger_data.idx_tiger_data_ma_county_lookup_lower_name;
DROP INDEX tiger_data.idx_tiger_data_ma_county_lookup_snd_name;
DROP INDEX tiger_data.idx_tiger_data_ma_county_lower_name;
DROP INDEX tiger_data.idx_tiger_data_ma_county_snd_name;
:
:
</pre></div><div class="refsection"><a name="idp103092424"></a><h2>関連情報</h2><p><a class="xref" href="#Install_Missing_Indexes" title="Install_Missing_Indexes">Install_Missing_Indexes</a>, <a class="xref" href="#Missing_Indexes_Generate_Script" title="Missing_Indexes_Generate_Script">Missing_Indexes_Generate_Script</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="Drop_Nation_Tables_Generate_Script"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Drop_Nation_Tables_Generate_Script — 指定したスキーマ内のテーブルのうち、<code class="varname">county_all</code>, <code class="varname">state_all</code>または、<code class="varname">county</code> or <code class="varname">state</code>を削除するスクリプトを生成します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">Drop_Nation_Tables_Generate_Script</b>(</code>text  <var class="pdparam">param_schema=tiger_data</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp103104328"></a><h2>説明</h2><p>指定したスキーマ内のテーブルのうち、名前が<code class="varname">county_all</code>、<code class="varname">state_all</code>、<code class="varname">(州コード)_county</code>、<code class="varname">(州コード)_state</code>で始まるテーブルを全て削除するスクリプトを生成します。 <code class="varname">tiger_2010</code>データから<code class="varname">tiger_2011</code>データに更新する際に必要です。</p><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp103108168"></a><h2>例</h2><pre class="programlisting">SELECT drop_nation_tables_generate_script();
DROP TABLE tiger_data.county_all;
DROP TABLE tiger_data.county_all_lookup;
DROP TABLE tiger_data.state_all;
DROP TABLE tiger_data.ma_county;
DROP TABLE tiger_data.ma_state;</pre></div><div class="refsection"><a name="idp103109704"></a><h2>関連情報</h2><p><a class="xref" href="#Loader_Generate_Nation_Script" title="Loader_Generate_Nation_Script">Loader_Generate_Nation_Script</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="Drop_State_Tables_Generate_Script"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Drop_State_Tables_Generate_Script — 指定したスキーマ内の、名前が州コードから始まるテーブルを全て削除するスクリプトを生成します。スキーマが指定されていない場合のデフォルトスキーマは<code class="varname">tiger_data</code>です。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">Drop_State_Tables_Generate_Script</b>(</code>text  <var class="pdparam">param_state</var>, text  <var class="pdparam">param_schema=tiger_data</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp103121096"></a><h2>説明</h2><p>指定したスキーマ内の、名前が州コードから始まるテーブルを全て削除するスクリプトを生成します。スキーマが指定されていない場合のデフォルトスキーマは<code class="varname">tiger_data</code>です。ある州の以前のデータのロードがうまくいかずに再ロードする際に使います。</p><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp103123144"></a><h2>例</h2><pre class="programlisting">SELECT drop_state_tables_generate_script('PA');
DROP TABLE tiger_data.pa_addr;
DROP TABLE tiger_data.pa_county;
DROP TABLE tiger_data.pa_county_lookup;
DROP TABLE tiger_data.pa_cousub;
DROP TABLE tiger_data.pa_edges;
DROP TABLE tiger_data.pa_faces;
DROP TABLE tiger_data.pa_featnames;
DROP TABLE tiger_data.pa_place;
DROP TABLE tiger_data.pa_state;
DROP TABLE tiger_data.pa_zip_lookup_base;
DROP TABLE tiger_data.pa_zip_state;
DROP TABLE tiger_data.pa_zip_state_loc;
        </pre></div><div class="refsection"><a name="idp103124680"></a><h2>関連情報</h2><p><a class="xref" href="#Loader_Generate_Script" title="Loader_Generate_Script">Loader_Generate_Script</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="Geocode"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Geocode — 住所を文字列 (もしくは他の正規化された住所)として取り、可能性のある位置の集合を返します。返される集合の要素は、NAD 83経度緯度のポイントジオメトリ、正規化された住所と評価値を持ちます。評価値は低いほど可能性が高いことを示しています。結果は評価値の低い順に並べ替えられます。オプションにmax_result (最大結果数、デフォルトは10)とrestrict_region (制限領域、デフォルトはNULL)を渡すことができます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">setof record <b class="fsfunc">geocode</b>(</code>varchar  <var class="pdparam">address</var>, integer  <var class="pdparam">max_results=10</var>, geometry  <var class="pdparam">restrict_region=NULL</var>, norm_addy  <var class="pdparam">OUT addy</var>, geometry  <var class="pdparam">OUT geomout</var>, integer  <var class="pdparam">OUT rating</var><code>)</code>;</p><p><code class="funcdef">setof record <b class="fsfunc">geocode</b>(</code>norm_addy  <var class="pdparam">in_addy</var>, integer  <var class="pdparam">max_results=10</var>, geometry  <var class="pdparam">restrict_region=NULL</var>, norm_addy  <var class="pdparam">OUT addy</var>, geometry  <var class="pdparam">OUT geomout</var>, integer  <var class="pdparam">OUT rating</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp103155656"></a><h2>説明</h2><p>文字列住所 (または正規化された住所)を引数に取り、NAD 83経度緯度のポイントジオメトリ (geomout)、個々の<code class="varname">normalized_address</code> (addy)、評価値 (rating)からなる、可能性のある位置の集合を出力します。評価値が低いほど合致度が高くなります。Tigerデータ (エッジ、フェイス、住所)、PostgreSQLあいまい文字列合致 (soundex,levenshtein)を使い、Tigerデータのエッジに沿った住所の補間のためにPostGIS線補間関数を使用っています。評価値が高いほどジオコードの正確度が低くなります。ジオコードされたポイントは、ストリート住所を中心線から左/右に移動しますが、デフォルトでは10メートルです。</p><p>Enhanced: 2.0.0 Tiger 2010構造のデータに対応しました。実行速度とジオコーディング精度を改善し、ストリート住所の位置を中心線から側線に移動するための改訂を行いました。また、良い結果の数を指定したり、最も良い結果だけを返すようにするのに使う新しいパラメータ<code class="varname">max_results</code>を導入しました。</p></div><div class="refsection"><a name="idp103157960"></a><h2>例: 基本</h2><p>下の例は、3.0GHzの単一プロセッサと2GBのメモリを持つWindows 7機で、PostgreSQL 9.1rc1/PostGIS 2.0を走らせて、MA, MN, CA, RI の各州のTigerデータをロードしたものです。</p><p>完全一致は速いです (61ミリ秒)</p><pre class="programlisting">SELECT g.rating, ST_X(g.geomout) As lon, ST_Y(g.geomout) As lat,
    (addy).address As stno, (addy).streetname As street,
    (addy).streettypeabbrev As styp, (addy).location As city, (addy).stateabbrev As st,(addy).zip
    FROM geocode('75 State Street, Boston MA 02109', 1) As g;
 rating |        lon        |      lat       | stno | street | styp |  city  | st |  zip
--------+-------------------+----------------+------+--------+------+--------+----+-------
      0 | -71.0557505845646 | 42.35897920691 |   75 | State  | St   | Boston | MA | 02109
</pre><p>郵便番号を渡さない場合でも推測可能です (122-150ミリ秒かかりました)</p><pre class="programlisting">SELECT g.rating, ST_AsText(ST_SnapToGrid(g.geomout,0.00001)) As wktlonlat,
    (addy).address As stno, (addy).streetname As street,
    (addy).streettypeabbrev As styp, (addy).location As city, (addy).stateabbrev As st,(addy).zip
    FROM geocode('226 Hanover Street, Boston, MA',1) As g;
 rating |         wktlonlat         | stno | street  | styp |  city  | st |  zip
--------+---------------------------+------+---------+------+--------+----+-------
      1 | POINT(-71.05528 42.36316) |  226 | Hanover | St   | Boston | MA | 02113
</pre><p>綴りの誤りを処理して、一つ以上の可能性のある答を評価値付きで提供すると遅くなります (500ミリ秒)。</p><pre class="programlisting">SELECT g.rating, ST_AsText(ST_SnapToGrid(g.geomout,0.00001)) As wktlonlat,
    (addy).address As stno, (addy).streetname As street,
    (addy).streettypeabbrev As styp, (addy).location As city, (addy).stateabbrev As st,(addy).zip
    FROM geocode('31 - 37 Stewart Street, Boston, MA 02116',1) As g;
 rating |         wktlonlat         | stno | street | styp |  city  | st |  zip
--------+---------------------------+------+--------+------+--------+----+-------
     70 | POINT(-71.06466 42.35114) |   31 | Stuart | St   | Boston | MA | 02116
    </pre><p>複数住所のジオコードバッチ処理を行います。<code class="varname">max_results=1</code>とすると最も簡単です。まだジオコードを行っていない (評価値が無い)もののみ処理します。</p><pre class="programlisting">CREATE TABLE addresses_to_geocode(addid serial PRIMARY KEY, address text,
        lon numeric, lat numeric, new_address text, rating integer);

INSERT INTO addresses_to_geocode(address)
VALUES ('529 Main Street, Boston MA, 02129'),
 ('77 Massachusetts Avenue, Cambridge, MA 02139'),
 ('25 Wizard of Oz, Walaford, KS 99912323'),
 ('26 Capen Street, Medford, MA'),
 ('124 Mount Auburn St, Cambridge, Massachusetts 02138'),
 ('950 Main Street, Worcester, MA 01610');


-- ジオコード全体は一度コミットしなければならず、
-- 多数の住所があって、一度に全てを更新したくないので、
-- 最初の三つのアドレスだけ更新します。
-- (323-704ミリ秒 - キャッシュと共有メモリがあるので、最初のジオコーディングは必ず遅くなります)
-- この例では、間違った住所の再ジオコーディングをしないよう、
-- LEFT JOINで再結合して、合致しないものには-1の評価値を設定しています。
UPDATE addresses_to_geocode
  SET  (rating, new_address, lon, lat)
    = ( COALESCE(g.rating,-1), pprint_addy(g.addy),
       ST_X(g.geomout)::numeric(8,5), ST_Y(g.geomout)::numeric(8,5) )
FROM (SELECT addid, address
    FROM addresses_to_geocode
    WHERE rating IS NULL ORDER BY addid LIMIT 3) As a
    LEFT JOIN LATERAL geocode(a.address,1) As g ON true
WHERE a.addid = addresses_to_geocode.addid;

result
-----
Query returned successfully: 3 rows affected, 480 ms execution time.

SELECT * FROM addresses_to_geocode WHERE rating is not null;

 addid |                   address                    |    lon    |   lat    |                new_address                | rating
-------+----------------------------------------------+-----------+----------+-------------------------------------------+--------
     1 | 529 Main Street, Boston MA, 02129            | -71.07177 | 42.38357 | 529 Main St, Boston, MA 02129             |      0
     2 | 77 Massachusetts Avenue, Cambridge, MA 02139 | -71.09396 | 42.35961 | 77 Massachusetts Ave, Cambridge, MA 02139 |      0
     3 | 25 Wizard of Oz, Walaford, KS 99912323       | -97.92913 | 38.12717 | Willowbrook, KS 67502                     |    108
(3 rows)</pre></div><div class="refsection"><a name="idp103163208"></a><h2>例: ジオメトリフィルタの使用</h2><pre class="programlisting">SELECT g.rating, ST_AsText(ST_SnapToGrid(g.geomout,0.00001)) As wktlonlat,
    (addy).address As stno, (addy).streetname As street,
    (addy).streettypeabbrev As styp,
    (addy).location As city, (addy).stateabbrev As st,(addy).zip
  FROM geocode('100 Federal Street, MA',
        3,
        (SELECT ST_Union(the_geom)
            FROM place WHERE statefp = '25' AND name = 'Lynn')::geometry
        ) As g;

 rating |         wktlonlat         | stno | street  | styp | city | st |  zip
--------+---------------------------+------+---------+------+------+----+-------
      7 | POINT(-70.96796 42.4659)  |  100 | Federal | St   | Lynn | MA | 01905
     16 | POINT(-70.96786 42.46853) | NULL | Federal | St   | Lynn | MA | 01905
(2 rows)

Time: 622.939 ms
          </pre></div><div class="refsection"><a name="idp103185224"></a><h2>関連情報</h2><p><a class="xref" href="#Normalize_Address" title="Normalize_Address">Normalize_Address</a>, <a class="xref" href="#Pprint_Addy" title="Pprint_Addy">Pprint_Addy</a>, <a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a>, <a class="xref" href="#ST_SnapToGrid" title="ST_SnapToGrid">ST_SnapToGrid</a>, <a class="xref" href="#ST_X" title="ST_X">ST_X</a>, <a class="xref" href="#ST_Y" title="ST_Y">ST_Y</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="Geocode_Intersection"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Geocode_Intersection — インタセクトする二つのストリート、州コード、市名、郵便番号を引数に取り、最初の交差点の可能性のある位置の集合を出力します。geomoutにNAD83経度緯度のポイント、<code class="varname">normalized_address</code>にそれぞれの位置、ratingに評価値がそれぞれ入ります。評価値が低いほど合致度が高くなります。結果は評価値の低い順にソートされます。最大結果数を渡すことができ、デフォルトは10です。Tigerデータ (エッジ、フェイス、住所)と、PostgreSQLあいまい文字列合致 (soundex, levenshtein)を使います。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">setof record <b class="fsfunc">geocode_intersection</b>(</code>text  <var class="pdparam"> roadway1</var>, text  <var class="pdparam"> roadway2</var>, text  <var class="pdparam"> in_state</var>, text  <var class="pdparam"> in_city</var>, text  <var class="pdparam"> in_zip</var>, integer  <var class="pdparam">max_results=10</var>, norm_addy  <var class="pdparam">OUT addy</var>, geometry  <var class="pdparam">OUT geomout</var>, integer  <var class="pdparam">OUT rating</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp103201864"></a><h2>説明</h2><p>インタセクトする二つのストリート、州コード、市名、郵便番号を引数に取り、最初の交差点の可能性のある位置の集合を出力します。集合の要素は、NAD83経度緯度のポイント、正規化された住所、評価値を持ちます。評価値が低いほど合致度が高くなります。結果は評価値の低い順にソートされます。最大結果数を渡すことができ、デフォルトは10です。<code class="varname">normalized_address</code> (addy)、NAD83経度緯度のポイントとしてgeomout、評価値としてratingを返します。評価値が低いほど合致度が高くなります。結果は評価値の低い順にソートされます。Tigerデータ (エッジ、フェイス、住所)と、PostgreSQLあいまい文字列合致 (soundex, levenshtein)を使います。 </p><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp103203784"></a><h2>例: 基本</h2><p>下の例では、3.0GHz単一プロセッサで2GBメモリのWindows 7機上でPostgreSQL 9.0/PostGIS 1.5を走らせ、マサチューセッツ州のTigerデータをロードしています。この場合は、少し遅いです (3000ミリ秒)。</p><p>Windows 2003 64ビット 8GBでPostGIS 2.0、PostgreSQL 64ビット版を動かし、Tiger 2011データがロードされている場合もテストしています (41ミリ秒)。</p><pre class="programlisting">SELECT pprint_addy(addy), st_astext(geomout),rating
            FROM geocode_intersection( 'Haverford St','Germania St', 'MA', 'Boston', '02130',1);
           pprint_addy            |         st_astext          | rating
----------------------------------+----------------------------+--------
98 Haverford St, Boston, MA 02130 | POINT(-71.101375 42.31376) |      0
</pre><p>郵便番号をジオコーダに渡さない場合でも動作し、Windows 2003 64ビットで741ミリ秒でした(Windows 7機で3500ミリ秒)。</p><pre class="programlisting">SELECT pprint_addy(addy), st_astext(geomout),rating
                FROM geocode_intersection('Weld', 'School', 'MA', 'Boston');
          pprint_addy          |        st_astext         | rating
-------------------------------+--------------------------+--------
 98 Weld Ave, Boston, MA 02119 | POINT(-71.099 42.314234) |      3
 99 Weld Ave, Boston, MA 02119 | POINT(-71.099 42.314234) |      3
</pre></div><div class="refsection"><a name="idp103206984"></a><h2>関連情報</h2><p><a class="xref" href="#Geocode" title="Geocode">Geocode</a>, <a class="xref" href="#Pprint_Addy" title="Pprint_Addy">Pprint_Addy</a>, <a class="xref" href="#ST_AsText" title="ST_AsText">ST_AsText</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="Get_Geocode_Setting"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Get_Geocode_Setting — tiger.geocode_settingsテーブルに格納されている設定のうち指定したものの値を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">Get_Geocode_Setting</b>(</code>text  <var class="pdparam"> setting_name</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp103225800"></a><h2>説明</h2><p>tiger.geocode_settingsテーブルに格納されている設定のうち指定したものの値を返します。設定によって、関数のデバッグの制御が可能です。今後の予定では、評価値の制御ができるようにします。現在の設定は次の通りです。</p><pre class="screen">name              | setting |  unit   | category  |                                                             short_desc
--------------------------------+---------+---------+-----------+------------------------------------------------------------------------------------------------------------------------------
 debug_geocode_address          | false   | boolean | debug     | trueの場合には、geocode_addressが呼ばれた時に、クエリ等のデバッグ情報をNOTICEログに出力します
 debug_geocode_intersection     | false   | boolean | debug     | trueの場合には、geocode_intersectionが呼ばれた時に、クエリ等のデバッグ情報をNOTICEログに出力します
 debug_normalize_address        | false   | boolean | debug     | trueの場合には、normalize_addressが呼ばれた時に、クエリや中間表現等のデバッグ情報をNOTICEログに出力します
 debug_reverse_geocode          | false   | boolean | debug     | trueの場合には、reverse_geocodeが呼ばれた時に、クエリや中間表現等のデバッグ情報をNOTICEログに出力します
 reverse_geocode_numbered_roads | 0       | integer | rating    | 州道名と郡道名について、0-どの名前でもよい、1-道路番号優先、2-州/郡名優先
 use_pagc_address_parser        | false   | boolean | normalize | trueの場合には、address_standardizer (pagc_normalize_address経由)を使おうと試みます。    </pre><p>Changed: 2.2.0 : デフォルト設定をgeocode_settingsに保存するようにしました。ユーザが設定したものだけがgeocode_settings内にあります。</p><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp103228232"></a><h2>デバッグ設定を返す例</h2><pre class="programlisting">SELECT get_geocode_setting('debug_geocode_address) As result;
result
---------
false
        </pre></div><div class="refsection"><a name="idp103229768"></a><h2>関連情報</h2><p><a class="xref" href="#Set_Geocode_Setting" title="Set_Geocode_Setting">Set_Geocode_Setting</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="Get_Tract"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Get_Tract — ジオメトリで指定した位置の米国国勢調査統計区またはtractテーブルのフィールドを返します。デフォルトでは、統計区の短縮名を返します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">get_tract</b>(</code>geometry  <var class="pdparam"> loc_geom</var>, text  <var class="pdparam"> output_field=name</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp103248968"></a><h2>説明</h2><p>ジオメトリを与えると、ジオメトリの位置の米国国勢調査統計区を返します。空間参照系を指定しない場合には、NAD83経度緯度と仮定します。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数は、デフォルトではロードされないセンサスの<code class="varname">tract</code>を使います。すでに州テーブルをロードしている場合には、<a class="xref" href="#Loader_Generate_Census_Script" title="Loader_Generate_Census_Script">Loader_Generate_Census_Script</a>を使用して、bgと同様にtract、tabblockをロードできます。</p><p>まだ州データをロードしていおらず、これらの追加テーブルを求めるなら、次を実行します。</p><pre class="programlisting">UPDATE tiger.loader_lookuptables SET load = true WHERE load = false AND lookup_name IN('tract', 'bg', 'tabblock');</pre><p>これで<a class="xref" href="#Loader_Generate_Script" title="Loader_Generate_Script">Loader_Generate_Script</a>を使用して取り込みます。</p></td></tr></table></div><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp103253832"></a><h2>例: 基本</h2><pre class="programlisting">SELECT get_tract(ST_Point(-71.101375, 42.31376) ) As tract_name;
tract_name
---------
1203.01
        </pre><pre class="programlisting">-- Tigerの地理識別子を返します
SELECT get_tract(ST_Point(-71.101375, 42.31376), 'tract_id' ) As tract_id;
tract_id
---------
25025120301</pre></div><div class="refsection"><a name="idp103255880"></a><h2>関連情報</h2><p><a class="xref" href="#Geocode" title="Geocode">Geocode</a>
&gt;</p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="Install_Missing_Indexes"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Install_Missing_Indexes — ジオコーダで結合や検索条件に使われ、インデックスが付いていなキーカラムを持つ全てのテーブルを探し、インデックスを追加します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">boolean <b class="fsfunc">Install_Missing_Indexes</b>(</code><code>)</code>;</p></div></div><div class="refsection"><a name="idp103261000"></a><h2>説明</h2><p>ジオコーダで結合や検索条件に使われ、インデックスが付いていなキーカラムを持つ、<code class="varname">tiger</code>スキーマと<code class="varname">tiger_data</code>スキーマ内の全てのテーブルを探し、これらのテーブルにインデックスを追加するためのSQLデータ定義言語を出力し、実行します。これは、クエリの動作速度を上げるのに必要であるのにロード処理で失われたインデックスを追加するのを助ける関数です。インデックス追加スクリプトの生成と実行を行う<a class="xref" href="#Missing_Indexes_Generate_Script" title="Missing_Indexes_Generate_Script">Missing_Indexes_Generate_Script</a>の仲間です。この関数は<code class="filename">update_geocode.sql</code>更新スクリプトの一部として呼ばれます。</p><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp103264328"></a><h2>例</h2><pre class="programlisting">SELECT install_missing_indexes();
         install_missing_indexes
-------------------------
 t
        </pre></div><div class="refsection"><a name="idp103265864"></a><h2>関連情報</h2><p><a class="xref" href="#Loader_Generate_Script" title="Loader_Generate_Script">Loader_Generate_Script</a>, <a class="xref" href="#Missing_Indexes_Generate_Script" title="Missing_Indexes_Generate_Script">Missing_Indexes_Generate_Script</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="Loader_Generate_Census_Script"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Loader_Generate_Census_Script — 指定した州について、tract (統計区)、bg (block group, 細分区グループ)、tabblock (ブロック)をダウンロードし、<code class="varname">tiger_data</code>に格納するための、指定したプラットフォーム用のシェルスクリプトを生成します。行ごとに州ごとのスクリプトが返されます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">setof text <b class="fsfunc">loader_generate_census_script</b>(</code>text[] <var class="pdparam">param_states</var>, text <var class="pdparam">os</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp103273416"></a><h2>説明</h2><p>指定した州について、<code class="varname">tract</code> (統計区)、<code class="varname">bg</code> (block group, 細分区グループ)、<code class="varname">tabblock</code> (ブロック)をダウンロードし、<code class="varname">tiger_data</code>に格納するための、指定したプラットフォーム用のシェルスクリプトを生成します。行ごとに州ごとのスクリプトが返されます。</p><p>ダウンロードには、Linuxではunzip (Windowsのデフォルトは7-zip)とwgetとを使います。データの格納には<a class="xref" href="#shp2pgsql_usage" title="4.4.2. shp2pgsql: ESRIシェープファイルローダを使う">「shp2pgsql: ESRIシェープファイルローダを使う」</a>を使います。最小単位は州全体です。生成されるスクリプトは、格納準備中の一時フォルダ内にあるファイルのみ処理します。</p><p>プロセスの制御や異なるOSのシェルの書式の制御のために、次の制御テーブルを使います。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><code class="varname">loader_variables</code> 国勢調査ダウンロードサイト、年度、データと準備スキーマといった種々の変数の軌跡を保持します。</p></li><li class="listitem"><p><code class="varname">loader_platform</code> 種々のプラットフォームのプロファイルと種々の実行ファイルを置いてある位置です。windowsとLinux/unixを備えています。追加も可能です。</p></li><li class="listitem"><p>レコードごとにテーブルの種類 (州、国)、レコード処理の有無、ロード方法を定義しています。データインポート方法、データ格納準備、カラム追加、カラム削除、インデックス、制約がそれぞれで定義されています。個々のテーブルは、名前の先頭に州コードを持ち、tigerスキーマのテーブルから継承されています。たとえば、<code class="varname">tiger.faces</code>から継承された<code class="varname">tiger_data.ma_faces</code>する、といったことが行われます。</p></li></ol></div><p>Availability: 2.0.0 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><a class="xref" href="#Loader_Generate_Script" title="Loader_Generate_Script">Loader_Generate_Script</a> は、このロジックを含んでいますが、PostGIS 2.0.0 alpha 5より前にTigerジオコーダをインストールしてLoader_Generate_Scriptを実行した場合には、これを実行する必要があります。</p></td></tr></table></div></div><div class="refsection"><a name="idp103282760"></a><h2>例</h2><p>Windowsシェルスクリプト書式での選択した州のデータをロードするスクリプトの生成。</p><pre class="programlisting">SELECT loader_generate_census_script(ARRAY['MA'], 'windows');
-- 結果 --
set STATEDIR="\gisdata\www2.census.gov\geo\pvs\tiger2010st\25_Massachusetts"
set TMPDIR=\gisdata\temp\
set UNZIPTOOL="C:\Program Files\7-Zip\7z.exe"
set WGETTOOL="C:\wget\wget.exe"
set PGBIN=C:\projects\pg\pg91win\bin\
set PGPORT=5432
set PGHOST=localhost
set PGUSER=postgres
set PGPASSWORD=yourpasswordhere
set PGDATABASE=tiger_postgis20
set PSQL="%PGBIN%psql"
set SHP2PGSQL="%PGBIN%shp2pgsql"
cd \gisdata

%WGETTOOL% http://www2.census.gov/geo/pvs/tiger2010st/25_Massachusetts/25/ --no-parent --relative --accept=*bg10.zip,*tract10.zip,*tabblock10.zip --mirror --reject=html
del %TMPDIR%\*.* /Q
%PSQL% -c "DROP SCHEMA tiger_staging CASCADE;"
%PSQL% -c "CREATE SCHEMA tiger_staging;"
cd %STATEDIR%
for /r %%z in (*.zip) do %UNZIPTOOL% e %%z  -o%TMPDIR%
cd %TMPDIR%
%PSQL% -c "CREATE TABLE tiger_data.MA_tract(CONSTRAINT pk_MA_tract PRIMARY KEY (tract_id) ) INHERITS(tiger.tract); "
%SHP2PGSQL% -c -s 4269 -g the_geom   -W "latin1" tl_2010_25_tract10.dbf tiger_staging.ma_tract10 | %PSQL%
%PSQL% -c "ALTER TABLE tiger_staging.MA_tract10 RENAME geoid10 TO tract_id;  SELECT loader_load_staged_data(lower('MA_tract10'), lower('MA_tract')); "
%PSQL% -c "CREATE INDEX tiger_data_MA_tract_the_geom_gist ON tiger_data.MA_tract USING gist(the_geom);"
%PSQL% -c "VACUUM ANALYZE tiger_data.MA_tract;"
%PSQL% -c "ALTER TABLE tiger_data.MA_tract ADD CONSTRAINT chk_statefp CHECK (statefp = '25');"
: </pre><p>shスクリプトの生成</p><pre class="programlisting">STATEDIR="/gisdata/www2.census.gov/geo/pvs/tiger2010st/25_Massachusetts"
TMPDIR="/gisdata/temp/"
UNZIPTOOL=unzip
WGETTOOL="/usr/bin/wget"
export PGBIN=/usr/pgsql-9.0/bin
export PGPORT=5432
export PGHOST=localhost
export PGUSER=postgres
export PGPASSWORD=yourpasswordhere
export PGDATABASE=geocoder
PSQL=${PGBIN}/psql
SHP2PGSQL=${PGBIN}/shp2pgsql
cd /gisdata

wget http://www2.census.gov/geo/pvs/tiger2010st/25_Massachusetts/25/ --no-parent --relative --accept=*bg10.zip,*tract10.zip,*tabblock10.zip --mirror --reject=html
rm -f ${TMPDIR}/*.*
${PSQL} -c "DROP SCHEMA tiger_staging CASCADE;"
${PSQL} -c "CREATE SCHEMA tiger_staging;"
cd $STATEDIR
for z in *.zip; do $UNZIPTOOL -o -d $TMPDIR $z; done
:
: </pre></div><div class="refsection"><a name="idp103285576"></a><h2>関連情報</h2><p><a class="xref" href="#Loader_Generate_Script" title="Loader_Generate_Script">Loader_Generate_Script</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="Loader_Generate_Script"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Loader_Generate_Script — 指定したプラットフォーム用の、指定した州のTigerデータをダウンロードし、格納準備を行い、<code class="varname">tiger_data</code>スキーマに格納するシェルスクリプトを生成します。行ごとに州ごとのスクリプトが返ります。最新版ではTiger 2010のデータ構造変更に対応していて、国勢統計区、細分区グループ、細分区 (tabblocks)テーブルをダウンロードすることができます。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">setof text <b class="fsfunc">loader_generate_script</b>(</code>text[] <var class="pdparam">param_states</var>, text <var class="pdparam">os</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp103313224"></a><h2>説明</h2><p>指定したプラットフォーム用の、指定した州のTigerデータをダウンロードし、格納準備を行い、<code class="varname">tiger_data</code>スキーマに格納するシェルスクリプトを生成します。行ごとに州ごとのスクリプトが返ります。</p><p>ダウンロードには、Linuxではunzip (Windowsのデフォルトは7-zip)とwgetとを使います。データの格納には<a class="xref" href="#shp2pgsql_usage" title="4.4.2. shp2pgsql: ESRIシェープファイルローダを使う">「shp2pgsql: ESRIシェープファイルローダを使う」</a>を使います。ダウンロードの最小単位は州全体ですが、ファイルを手動でダウンロードすることで上書きできます。生成されるスクリプトは、格納準備中の一時フォルダ内にあるファイルのみ処理します。</p><p>プロセスの制御や異なるOSのシェルの書式の制御のために、次の制御テーブルを使います。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><code class="varname">loader_variables</code> 国勢調査ダウンロードサイト、年度、データと準備スキーマといった種々の変数の軌跡を保持します。</p></li><li class="listitem"><p><code class="varname">loader_platform</code> 種々のプラットフォームのプロファイルと種々の実行ファイルを置いてある位置です。windowsとLinux/unixを備えています。追加も可能です。</p></li><li class="listitem"><p>レコードごとにテーブルの種類 (州、国)、レコード処理の有無、ロード方法を定義しています。データインポート方法、データ格納準備、カラム追加、カラム削除、インデックス、制約がそれぞれで定義されています。個々のテーブルは、名前の先頭に州コードを持ち、tigerスキーマのテーブルから継承されています。たとえば、<code class="varname">tiger.faces</code>から継承された<code class="varname">tiger_data.ma_faces</code>する、といったことが行われます。</p></li></ol></div><p>Availability: 2.0.0 Tiger 2010構造のデータに対応しました。国勢統計区 (tract)、細分区グループ ("block groups", bg)、細分区 (tabblocks)テーブルをダウンロードします。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>pgAdmin IIIを使用している場合には、pgAdmin IIIのデフォルトでは長い文字列が切られることに注意して下さい。<span class="emphasis"><em>ファイル -&gt; オプション -&gt; クエリーツール -&gt; Query Editor - &gt; 欄あたりの最大文字数</em></span>を50000文字以上に変更します。</p></td></tr></table></div></div><div class="refsection"><a name="idp103321544"></a><h2>例</h2><p>gistestというデータベースがあり、<code class="filename">/gisdata/data_load.sh</code>がシェルスクリプトのパスとするなら、次のようになります。</p><pre class="programlisting">psql -U postgres -h localhost -d gistest -A -t \
 -c "SELECT Loader_Generate_Script(ARRAY['MA'], 'gistest')" 
&gt; /gisdata/data_load.sh;
</pre><p>Windowsシェルスクリプト書式で二つの州のデータをロードするスクリプトを生成します。</p><pre class="programlisting">SELECT loader_generate_script(ARRAY['MA','RI'], 'windows') AS result;
-- 結果 --
set TMPDIR=\gisdata\temp\
set UNZIPTOOL="C:\Program Files\7-Zip\7z.exe"
set WGETTOOL="C:\wget\wget.exe"
set PGBIN=C:\Program Files\PostgreSQL\9.4\bin\
set PGPORT=5432
set PGHOST=localhost
set PGUSER=postgres
set PGPASSWORD=yourpasswordhere
set PGDATABASE=geocoder
set PSQL="%PGBIN%psql"
set SHP2PGSQL="%PGBIN%shp2pgsql"
cd \gisdata

cd \gisdata
%WGETTOOL% ftp://ftp2.census.gov/geo/tiger/TIGER2015/PLACE/tl_*_25_* --no-parent --relative --recursive --level=2 --accept=zip --mirror --reject=html
cd \gisdata/ftp2.census.gov/geo/tiger/TIGER2015/PLACE
:
:</pre><p>shスクリプトの生成</p><pre class="programlisting">SELECT loader_generate_script(ARRAY['MA','RI'], 'sh') AS result;
-- 結果 --
TMPDIR="/gisdata/temp/"
UNZIPTOOL=unzip
WGETTOOL="/usr/bin/wget"
export PGBIN=/usr/lib/postgresql/9.4/bin
-- psqlが使う変数: https://www.postgresql.org/docs/current/static/libpq-envars.html
export PGPORT=5432
export PGHOST=localhost
export PGUSER=postgres
export PGPASSWORD=yourpasswordhere
export PGDATABASE=geocoder
PSQL=${PGBIN}/psql
SHP2PGSQL=${PGBIN}/shp2pgsql
cd /gisdata

cd /gisdata
wget ftp://ftp2.census.gov/geo/tiger/TIGER2015/PLACE/tl_*_25_* --no-parent --relative --recursive --level=2 --accept=zip --mirror --reject=html
cd /gisdata/ftp2.census.gov/geo/tiger/TIGER2015/PLACE
rm -f ${TMPDIR}/*.*
:
:</pre></div><div class="refsection"><a name="idp103325768"></a><h2>関連情報</h2><p><a class="xref" href="#install_tiger_geocoder_extension" title="2.8.1. TigerジオコーダをPostGISデータベースで有効にする: エクステンションを使用">「TigerジオコーダをPostGISデータベースで有効にする: エクステンションを使用」</a>, <a class="xref" href="#Loader_Generate_Nation_Script" title="Loader_Generate_Nation_Script">Loader_Generate_Nation_Script</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="Loader_Generate_Nation_Script"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Loader_Generate_Nation_Script — 指定したプラットフォーム用の、国と州のルックアップテーブルをロードするシェルスクリプトを生成します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">loader_generate_nation_script</b>(</code>text <var class="pdparam">os</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp103368776"></a><h2>説明</h2><p><code class="varname">tiger_data</code>スキーマに<code class="varname">county_all</code>, <code class="varname">county_all_lookup</code>, <code class="varname">state_all</code>テーブルをロードする、指定したプラットフォーム用のシェルスクリプトを生成します。それぞれ<code class="varname">tiger</code>スキーマの<code class="varname">county</code>, <code class="varname">county_lookup</code>, <code class="varname">state</code>から継承されます。</p><p>ダウンロードには、Linuxではunzip (Windowsのデフォルトは7-zip)とwgetとを使います。データの格納には<a class="xref" href="#shp2pgsql_usage" title="4.4.2. shp2pgsql: ESRIシェープファイルローダを使う">「shp2pgsql: ESRIシェープファイルローダを使う」</a>を使います。 </p><p>プロセスの制御や異なるOSのシェルの書式の制御のために、制御テーブル<code class="varname">tiger.loader_platform</code>, <code class="varname">tiger.loader_variables</code>,  <code class="varname">tiger.loader_lookuptables</code>を使います。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><code class="varname">loader_variables</code> 国勢調査ダウンロードサイト、年度、データと準備スキーマといった種々の変数の軌跡を保持します。</p></li><li class="listitem"><p><code class="varname">loader_platform</code>には、種々のプラットフォームのプロファイルや実行可能ファイルの置いてある位置を持ちます。windowsとLinux/unixを備えています。追加も可能です。</p></li><li class="listitem"><p>レコードごとにテーブルの種類 (州、国)、レコード処理の有無、ロード方法を定義しています。データインポート方法、データ格納準備、カラム追加、カラム削除、インデックス、制約がそれぞれで定義されています。個々のテーブルは、名前の先頭に州コードを持ち、tigerスキーマのテーブルから継承されています。たとえば、<code class="varname">tiger.faces</code>から継承された<code class="varname">tiger_data.ma_faces</code>する、といったことが行われます。</p></li></ol></div><p>Enhanced: 2.4.1 ZCTA5 (Zip Code 5 Tabulation Area)ロード手順は修正され、有効になった時に、ZCTA5データは、国スクリプトのロードの一部として、zcta5_allという名前の単一テーブルにロードされます。</p><p>Availability: 2.1.0 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>国スクリプトのロードにZCTA5 (Zip Code 5 Tabulation Area)を取り込みたい場合には、次のようにします。</p><pre class="programlisting">UPDATE tiger.loader_lookuptables SET load = true WHERE table_name = 'zcta510';</pre></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="varname">tiger_2010</code>を実行していて、新しいTigerデータで州を再読み込みを行いたくなった場合には、このスクリプトを実行する前に、最初に、<a class="xref" href="#Drop_Nation_Tables_Generate_Script" title="Drop_Nation_Tables_Generate_Script">Drop_Nation_Tables_Generate_Script</a>によって、テーブル削除スクリプトを生成、実行する必要があります。</p></td></tr></table></div></div><div class="refsection"><a name="idp103386440"></a><h2>例</h2><p>国データをWindowsにロードするスクリプトを生成します。</p><pre class="programlisting">SELECT loader_generate_nation_script('windows'); </pre><p>国データをLinux/Unixシステムにロードするスクリプトを生成します。</p><pre class="programlisting">SELECT loader_generate_nation_script('sh'); </pre></div><div class="refsection"><a name="idp103389256"></a><h2>関連情報</h2><p><a class="xref" href="#Loader_Generate_Script" title="Loader_Generate_Script">Loader_Generate_Script</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="Missing_Indexes_Generate_Script"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Missing_Indexes_Generate_Script — ジオコーダで結合に使われるキーカラムを持ち、インデックスが付いていないキーカラムを持つすべてのテーブルを検索し、インデックスを追加するSQLデータ定義言語を出力します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">Missing_Indexes_Generate_Script</b>(</code><code>)</code>;</p></div></div><div class="refsection"><a name="idp103406536"></a><h2>説明</h2><p><code class="varname">tiger</code>スキーマと<code class="varname">tiger_data</code>スキーマ内のジオコーダで結合に使われ、インデックスが付いていないキーカラムを持つ全てのテーブルを検索し、インデックスを付けるSQLデータ定義言語を出力します。これは、クエリの動作速度を上げるのに必要であるのにロード処理で失われたインデックスを追加するのを助ける関数です。ジオコーダが改善されますが、使用される新しいインデックスを受け入れるために、この関数は更新されます。この関数の出力が無い場合がありますが、これは、全てのテーブルにインデックスが付いていると考えられます。</p><p>Availability: 2.0.0</p></div><div class="refsection"><a name="idp103408712"></a><h2>例</h2><pre class="programlisting">SELECT missing_indexes_generate_script();
-- 出力: 多数の修正がロードスクリプトで行われる前のデータベースで実行しました ---
CREATE INDEX idx_tiger_county_countyfp ON tiger.county USING btree(countyfp);
CREATE INDEX idx_tiger_cousub_countyfp ON tiger.cousub USING btree(countyfp);
CREATE INDEX idx_tiger_edges_tfidr ON tiger.edges USING btree(tfidr);
CREATE INDEX idx_tiger_edges_tfidl ON tiger.edges USING btree(tfidl);
CREATE INDEX idx_tiger_zip_lookup_all_zip ON tiger.zip_lookup_all USING btree(zip);
CREATE INDEX idx_tiger_data_ma_county_countyfp ON tiger_data.ma_county USING btree(countyfp);
CREATE INDEX idx_tiger_data_ma_cousub_countyfp ON tiger_data.ma_cousub USING btree(countyfp);
CREATE INDEX idx_tiger_data_ma_edges_countyfp ON tiger_data.ma_edges USING btree(countyfp);
CREATE INDEX idx_tiger_data_ma_faces_countyfp ON tiger_data.ma_faces USING btree(countyfp);
        </pre></div><div class="refsection"><a name="idp103410248"></a><h2>関連情報</h2><p><a class="xref" href="#Loader_Generate_Script" title="Loader_Generate_Script">Loader_Generate_Script</a>, <a class="xref" href="#Install_Missing_Indexes" title="Install_Missing_Indexes">Install_Missing_Indexes</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="Normalize_Address"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Normalize_Address — 文字列で住所が与えられると、道路後置辞、前置辞、正規化された種別、番地、ストリート名等をフィールドに分けて持つ<code class="varname">norm_addy</code>複合型を返します。tiger_geocoderに同梱されているルックアップデータで動作します (Tigerデータ自体は不要です)。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">norm_addy <b class="fsfunc">normalize_address</b>(</code>varchar  <var class="pdparam">in_address</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp103461832"></a><h2>説明</h2><p>文字列で住所が与えられると、道路後置辞、前置辞、正規化された種別、番地、ストリート名等をフィールドに分けて持つ<code class="varname">norm_addy</code>複合型を返します。全ての住所を正規化した郵便形式にするジオコーディング処理の第一段階です。ジオコーダに同梱されるもの以外で必要な者はありません。</p><p>tiger_geocoderによって前もってロードされ、<code class="varname">tiger</code>スキーマに格納される、様々な方角/州/後置辞のルックアップテーブルを使います。よって、Tigerデータをダウンロードしたり、追加データをする必要はありません。<code class="varname">tiger</code>スキーマ内のルックアップテーブルに略語や別名の追加が必要になることがあります。</p><p><code class="varname">tiger</code>スキーマ内に、入力アドレスを正規化するための、多様な制御ルックアップテーブルを使います。</p><p>この関数が返す<code class="varname">norm_addy</code>型オブジェクトのフィールドは、次に示す順序です。()はジオコーダの必須フィールド、[]は任意フィールドです。</p><p>(address) [predirAbbrev] (streetName) [streetTypeAbbrev] [postdirAbbrev] [internal] [location] [stateAbbrev] [zip] [parsed] [zip4] [address_alphanumeric]</p><p>Enhanced: 2.4.0 norm_addyオブジェクトにzip4とaddress_alphanumericが追加されました。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><code class="varname">address</code> 整数: 番地</p></li><li class="listitem"><p><code class="varname">predirAbbrev</code> varchar型: N, S, E, W等といった道路の方向前置辞。<code class="varname">direction_lookup</code>テーブルに制御されます。</p></li><li class="listitem"><p><code class="varname">streetName</code> varchar型</p></li><li class="listitem"><p><code class="varname">streetTypeAbbrev</code> varchar型 ストリート種別の短縮名: St, Ave, Cir等。<code class="varname">street_type_lookup</code>テーブルに制御されます。</p></li><li class="listitem"><p><code class="varname">postdirAbbrev</code> varchar型 N, S, E, W等の道路名の方向後置辞。<code class="varname">direction_lookup</code>テーブルに制御されます。</p></li><li class="listitem"><p><code class="varname">internal</code> varchar型 部屋番号といった内部住所。</p></li><li class="listitem"><p><code class="varname">location</code> varchar型 通常は市名や県名です。</p></li><li class="listitem"><p><code class="varname">stateAbbrev</code> varchar型 MA, NY, MI等のような米国の州名の2文字表示です。<code class="varname">state_lookup</code>テーブルに制御されます。</p></li><li class="listitem"><p><code class="varname">zip</code> varchar型 02109等の5桁の数字です。</p></li><li class="listitem"><p><code class="varname">parsed</code> 真偽型 - 住所が正規化処理で整形されたかを示します。normalize_addressは、住所を返す前にこれをTRUEにします。</p></li><li class="listitem"><p><code class="varname">zip4</code> 9桁のZIPコードの最後4桁です。Availability: PostGIS 2.4.0.</p></li><li class="listitem"><p><code class="varname">address_alphanumeric</code> 17Rのように英字が入る場合の完全なストリート番号。これのパースには<a class="xref" href="#Pagc_Normalize_Address" title="Pagc_Normalize_Address文字列のストリート住所を与えると、道路後置辞、前置辞、標準タイプ、番地、ストリート名等を複数フィールドに分解して持つnorm_addy複合型を返します。この関数は、tiger_geocoder同梱のルックアップテーブルだけを使います (Tigerデータは不要です)。住所標準化エクステンションが必要です。">Pagc_Normalize_Address文字列のストリート住所を与えると、道路後置辞、前置辞、標準タイプ、番地、ストリート名等を複数フィールドに分解して持つ<code class="varname">norm_addy</code>複合型を返します。この関数は、tiger_geocoder同梱のルックアップテーブルだけを使います (Tigerデータは不要です)。住所標準化エクステンションが必要です。</a>関数を使う方が良いです。Availability: PostGIS 2.4.0.</p></li></ol></div></div><div class="refsection"><a name="idp103481928"></a><h2>例</h2><p>フィールドを選択して出力します。きれいな文字列を求める場合には、<a class="xref" href="#Pprint_Addy" title="Pprint_Addy">Pprint_Addy</a>を使います。</p><pre class="programlisting">SELECT address As orig, (g.na).streetname, (g.na).streettypeabbrev
 FROM (SELECT address, normalize_address(address) As na
        FROM addresses_to_geocode) As g;

                        orig                         |  streetname   | streettypeabbrev
-----------------------------------------------------+---------------+------------------
 28 Capen Street, Medford, MA                        | Capen         | St
 124 Mount Auburn St, Cambridge, Massachusetts 02138 | Mount Auburn  | St
 950 Main Street, Worcester, MA 01610                | Main          | St
 529 Main Street, Boston MA, 02129                   | Main          | St
 77 Massachusetts Avenue, Cambridge, MA 02139        | Massachusetts | Ave
 25 Wizard of Oz, Walaford, KS 99912323              | Wizard of Oz  |
        </pre></div><div class="refsection"><a name="idp103484232"></a><h2>関連情報</h2><p><a class="xref" href="#Geocode" title="Geocode">Geocode</a>, <a class="xref" href="#Pprint_Addy" title="Pprint_Addy">Pprint_Addy</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="Pagc_Normalize_Address"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Pagc_Normalize_Address文字列のストリート住所を与えると、道路後置辞、前置辞、標準タイプ、番地、ストリート名等を複数フィールドに分解して持つ<code class="varname">norm_addy</code>複合型を返します。この関数は、tiger_geocoder同梱のルックアップテーブルだけを使います (Tigerデータは不要です)。住所標準化エクステンションが必要です。 — 文字列のストリート住所を与えると、道路後置辞、前置辞、標準タイプ、番地、ストリート名等を複数フィールドに分解して持つ<code class="varname">norm_addy</code>複合型を返します。この関数は、tiger_geocoder同梱のルックアップテーブルだけを使います (Tigerデータは不要です)。住所標準化エクステンションが必要です。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">norm_addy <b class="fsfunc">pagc_normalize_address</b>(</code>varchar  <var class="pdparam">in_address</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp103491144"></a><h2>説明</h2><p>文字列で住所が与えられると、道路後置辞、前置辞、正規化された種別、番地、ストリート名等をフィールドに分けて持つ<code class="varname">norm_addy</code>複合型を返します。全ての住所を正規化した郵便形式にするジオコーディング処理の第一段階です。ジオコーダに同梱されるもの以外で必要な者はありません。</p><p>この関数は、Tigerジオコーダとともにロードされ、<code class="varname">tiger</code>スキーマに置かれる、種々のpagc_+ルックアップテーブルだけを使うので、Tigerデータや他のデータをダウンロードする必要はありません。略語や別名を<code class="varname">tiger</code>スキーマのルックアップテーブルに追加しなければならない場合もあります。</p><p><code class="varname">tiger</code>スキーマ内に、入力アドレスを正規化するための、多様な制御ルックアップテーブルを使います。</p><p>この関数が返す<code class="varname">norm_addy</code>型オブジェクトのフィールドは、次に示す順序です。()はジオコーダの必須フィールド、[]は任意フィールドです。</p><p>処理と書式について<a class="xref" href="#Normalize_Address" title="Normalize_Address">Normalize_Address</a>と若干の違いがあります。</p><p>Availability: 2.1.0</p><p><span class="inlinemediaobject"><img src="images/check.png"></span> This method needs address_standardizer extension.</p><p>(address) [predirAbbrev] (streetName) [streetTypeAbbrev] [postdirAbbrev] [internal] [location] [stateAbbrev] [zip]</p><p>住所標準化エクステンションのstandardaddrは、他国の住所への対応 (countryも含む)があるため、norm_addyより若干フィールドが多くなります。standardaddrの、norm_addyと等価なフィールドは次の通りです。</p><p>house_num,predir, name, suftype, sufdir, unit, city, state, postcode</p><p>Enhanced: 2.4.0 norm_addyオブジェクトにzip4とaddress_alphanumericが追加されました。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><code class="varname">address</code> 整数: 番地</p></li><li class="listitem"><p><code class="varname">predirAbbrev</code> varchar型: N, S, E, W等といった道路の方向前置辞。<code class="varname">direction_lookup</code>テーブルに制御されます。</p></li><li class="listitem"><p><code class="varname">streetName</code> varchar型</p></li><li class="listitem"><p><code class="varname">streetTypeAbbrev</code> varchar型 ストリート種別の短縮名: St, Ave, Cir等。<code class="varname">street_type_lookup</code>テーブルに制御されます。</p></li><li class="listitem"><p><code class="varname">postdirAbbrev</code> varchar型 N, S, E, W等の道路名の方向後置辞。<code class="varname">direction_lookup</code>テーブルに制御されます。</p></li><li class="listitem"><p><code class="varname">internal</code> varchar型 部屋番号といった内部住所。</p></li><li class="listitem"><p><code class="varname">location</code> varchar型 通常は市名や県名です。</p></li><li class="listitem"><p><code class="varname">stateAbbrev</code> varchar型 MA, NY, MI等のような米国の州名の2文字表示です。<code class="varname">state_lookup</code>テーブルに制御されます。</p></li><li class="listitem"><p><code class="varname">zip</code> varchar型 02109等の5桁の数字です。</p></li><li class="listitem"><p><code class="varname">parsed</code> 真偽型 - 住所が正規化処理で整形されたかを示します。normalize_addressは、住所を返す前にこれをTRUEにします。</p></li><li class="listitem"><p><code class="varname">zip4</code> 9桁のZIPコードの最後4桁です。Availability: PostGIS 2.4.0.</p></li><li class="listitem"><p><code class="varname">address_alphanumeric</code> 17Rのように英字が入る場合の完全なストリート番号。これのパースには<a class="xref" href="#Pagc_Normalize_Address" title="Pagc_Normalize_Address文字列のストリート住所を与えると、道路後置辞、前置辞、標準タイプ、番地、ストリート名等を複数フィールドに分解して持つnorm_addy複合型を返します。この関数は、tiger_geocoder同梱のルックアップテーブルだけを使います (Tigerデータは不要です)。住所標準化エクステンションが必要です。">Pagc_Normalize_Address文字列のストリート住所を与えると、道路後置辞、前置辞、標準タイプ、番地、ストリート名等を複数フィールドに分解して持つ<code class="varname">norm_addy</code>複合型を返します。この関数は、tiger_geocoder同梱のルックアップテーブルだけを使います (Tigerデータは不要です)。住所標準化エクステンションが必要です。</a>関数を使う方が良いです。Availability: PostGIS 2.4.0.</p></li></ol></div></div><div class="refsection"><a name="idp103514440"></a><h2>例</h2><p>単一呼び出しの例を示します。</p><pre class="programlisting">SELECT addy.*
FROM pagc_normalize_address('9000 E ROO ST STE 999, Springfield, CO') AS addy;


 address | predirabbrev | streetname | streettypeabbrev | postdirabbrev | internal  |  location   | stateabbrev | zip | parsed
---------+--------------+------------+------------------+---------------+-----------+-------------+-------------+-----+--------
    9000 | E            | ROO        | ST               |               | SUITE 999 | SPRINGFIELD | CO          |     | t</pre><p>バッチ呼び出しの例です。現在は、postgis_tiger_geocoderはaddress_standardizerを使用しているため、速度の問題があります。うまくいけば、今後解決されることでしょう。
normaddyへのジオコーディングのバッチ処理で速度が必要な場合には、住所標準化エクステンションのstandaridze_address関数を直接呼ぶことで回避できます。<a class="xref" href="#Geocode" title="Geocode">Geocode</a>で生成されたデータを使う<a class="xref" href="#Normalize_Address" title="Normalize_Address">Normalize_Address</a>で行っていることと似ています。例を次に示します。</p><pre class="programlisting">WITH g AS (SELECT address, ROW((sa).house_num, (sa).predir, (sa).name
  , (sa).suftype, (sa).sufdir, (sa).unit , (sa).city, (sa).state, (sa).postcode, true)::norm_addy As na
 FROM (SELECT address, standardize_address('tiger.pagc_lex'
       , 'tiger.pagc_gaz'
       , 'tiger.pagc_rules', address) As sa
        FROM addresses_to_geocode) As g)
SELECT address As orig, (g.na).streetname, (g.na).streettypeabbrev
 FROM  g;

 orig                                                |  streetname   | streettypeabbrev
-----------------------------------------------------+---------------+------------------
 529 Main Street, Boston MA, 02129                   | MAIN          | ST
 77 Massachusetts Avenue, Cambridge, MA 02139        | MASSACHUSETTS | AVE
 25 Wizard of Oz, Walaford, KS 99912323              | WIZARD OF     |
 26 Capen Street, Medford, MA                        | CAPEN         | ST
 124 Mount Auburn St, Cambridge, Massachusetts 02138 | MOUNT AUBURN  | ST
 950 Main Street, Worcester, MA 01610                | MAIN          | ST</pre></div><div class="refsection"><a name="idp103518024"></a><h2>関連情報</h2><p><a class="xref" href="#Normalize_Address" title="Normalize_Address">Normalize_Address</a>, <a class="xref" href="#Geocode" title="Geocode">Geocode</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="Pprint_Addy"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Pprint_Addy — <code class="varname">norm_addy</code>複合型オブジェクトを与えると、印刷表現を返します。通常はnormalize_addressと併用します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">varchar <b class="fsfunc">pprint_addy</b>(</code>norm_addy  <var class="pdparam">in_addy</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp103524552"></a><h2>説明</h2><p><code class="varname">norm_addy</code>複合型オブジェクトを与えると、印刷表現を返します。Tigerジオコーダ同梱のデータ以外は不要です。</p><p>通常は<a class="xref" href="#Normalize_Address" title="Normalize_Address">Normalize_Address</a>と併用します。</p></div><div class="refsection"><a name="idp103526728"></a><h2>例</h2><p>単一住所の印刷表現</p><pre class="programlisting">SELECT pprint_addy(normalize_address('202 East Fremont Street, Las Vegas, Nevada 89101')) As pretty_address;
            pretty_address
---------------------------------------
 202 E Fremont St, Las Vegas, NV 89101
        </pre><p>住所テーブルの印刷表現</p><pre class="programlisting">SELECT address As orig, pprint_addy(normalize_address(address)) As pretty_address
        FROM addresses_to_geocode;

                        orig                         |              pretty_address
-----------------------------------------------------+-------------------------------------------
 529 Main Street, Boston MA, 02129                   | 529 Main St, Boston MA, 02129
 77 Massachusetts Avenue, Cambridge, MA 02139        | 77 Massachusetts Ave, Cambridge, MA 02139
 28 Capen Street, Medford, MA                        | 28 Capen St, Medford, MA
 124 Mount Auburn St, Cambridge, Massachusetts 02138 | 124 Mount Auburn St, Cambridge, MA 02138
 950 Main Street, Worcester, MA 01610                | 950 Main St, Worcester, MA 01610</pre></div><div class="refsection"><a name="idp103529544"></a><h2>関連情報</h2><p><a class="xref" href="#Normalize_Address" title="Normalize_Address">Normalize_Address</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="Reverse_Geocode"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Reverse_Geocode — 登録されている空間参照系に基づくポイントジオメトリを引数に取り、理論的に可能性のある住所の配列と交差するストリートの配列を一つのレコードで返します。include_strnum_range = trueの場合には、交差するストリートに番地範囲を追加します。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">record <b class="fsfunc">Reverse_Geocode</b>(</code>geometry  <var class="pdparam">pt</var>, boolean  <var class="pdparam">include_strnum_range=false</var>, geometry[]  <var class="pdparam">OUT intpt</var>, norm_addy[]  <var class="pdparam">OUT addy</var>, varchar[]  <var class="pdparam">OUT street</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp103539528"></a><h2>説明</h2><p>登録されている空間参照系に基づくポイントジオメトリを引数に取り、理論的に可能性のある住所の配列と交差するストリートの配列を一つのレコードで返します。include_strnum_range = trueの場合には、交差するストリートに番地範囲を追加します。include_strnum_rangeは、していない場合のデフォルトはFALSEです。住所は、ポイントから近い順の道路でソートされるので、最初の要素が最も正解に近くなります。</p><p>実際の住所ではなく理論的な住所と書いているのには理由があります。Tigerデータは本当の住所ではなく、番地の範囲を持っています。そのため、理論的な住所は番地範囲に基づいて補間したものです。補間する場合には、たとえば、26 Court Sq.が存在しないにもかかわらず、26 Court St. と 26 Court Sq.が返る、といったことがあります。これは、ポイントが二つのストリートの角にあるのが原因で、両方のストリートに沿って補間を行うためです。住所はストリートに沿って等間隔になっていると仮定しています。非常に多くの番地範囲を取ってしまっている自治体の建物があり、他の建物がストリートの終わりにかたまっているため、ストリートの方向が悪いです。</p><p>ご注意: この関数はTigerデータに依存しています。指定した点を含む領域のデータが無い場合には、NULLで満たされた一つのレコードが返されます。</p><p>返されるレコードの要素は次の通りです。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><code class="varname">intpt</code> ポイント配列: 入力ポイントに最も近いストリートの中心線のポイントです。住所と同じだけポイントがあります。</p></li><li class="listitem"><p><code class="varname">addy</code> norm_addy (正規化された住所)の配列: 入力ポイントに合わせた、可能性のある住所の配列です。最初の要素が最も可能性が高いものです。一般的に、一つだけになるべきですが、ポイントが二つか三つのストリートの角にあったり、ポイントが道路上のどこかにあって側線から離れている場合には、数出現します。</p></li><li class="listitem"><p><code class="varname">street</code> varchar型の配列: 交差するストリート (ストリートがインタセクトする場合)または一つのストリート (指定したポイントが乗るストリートである場合)です。</p></li></ol></div><p>Enhanced: 2.4.1 ZCTA5データセットを追加でロードする場合には、reverse_geocode関数は、特定の州データがロードされていなくても、州とZIPを解決することができます。ZTCA5データのロードに関する詳細については<a class="xref" href="#Loader_Generate_Nation_Script" title="Loader_Generate_Nation_Script">Loader_Generate_Nation_Script</a>を参照して下さい。</p><p>Availability: 2.0.0 </p></div><div class="refsection"><a name="idp103575368"></a><h2>例</h2><p>二つの近いストリートの角となる点の例です。MIT (Massachusetts Ave, Cambridge, MA 02139 )に近い位置です。ストリートは三つはないですが、PostgreSQLは配列の範囲からはみ出してもNULLを返すので安全です。番地範囲を含んでいます。</p><pre class="programlisting">SELECT pprint_addy(r.addy[1]) As st1, pprint_addy(r.addy[2]) As st2, pprint_addy(r.addy[3]) As st3,
            array_to_string(r.street, ',') As cross_streets
        FROM reverse_geocode(ST_GeomFromText('POINT(-71.093902 42.359446)',4269),true) As r;

 結果t
 ------
      st1                                  | st2 | st3 |               cross_streets
-------------------------------------------+-----+-----+----------------------------------------------
 67 Massachusetts Ave, Cambridge, MA 02139 |     |     | 67 - 127 Massachusetts Ave,32 - 88 Vassar St</pre><p>交差するストリートの番地範囲を含めないことを選択しました。また、二つの異なる住所が分かるよう、二つのストリートの角に本当に近い位置を指定しました。</p><pre class="programlisting">SELECT pprint_addy(r.addy[1]) As st1, pprint_addy(r.addy[2]) As st2,
pprint_addy(r.addy[3]) As st3, array_to_string(r.street, ',') As cross_str
FROM reverse_geocode(ST_GeomFromText('POINT(-71.06941 42.34225)',4269)) As r;

結果
--------
               st1               |               st2               | st3 | cross_str
---------------------------------+---------------------------------+-----+------------------------
 5 Bradford St, Boston, MA 02118 | 49 Waltham St, Boston, MA 02118 |     | Waltham St
</pre><p><a class="xref" href="#Geocode" title="Geocode">Geocode</a>からジオコーディングの例を再利用しています。主要な住所と、せいぜい二つの交差するストリートを求めているだけです。</p><pre class="programlisting">SELECT actual_addr, lon, lat, pprint_addy((rg).addy[1]) As int_addr1,
    (rg).street[1] As cross1, (rg).street[2] As cross2
FROM (SELECT address As actual_addr, lon, lat,
    reverse_geocode( ST_SetSRID(ST_Point(lon,lat),4326) ) As rg
    FROM addresses_to_geocode WHERE rating 
&gt; -1) As foo;

                     actual_addr                     |    lon    |   lat    |                 int_addr1                 |     cross1      |   cross2
-----------------------------------------------------+-----------+----------+-------------------------------------------+-----------------+------------
 529 Main Street, Boston MA, 02129                   | -71.07181 | 42.38359 | 527 Main St, Boston, MA 02129             | Medford St      |
 77 Massachusetts Avenue, Cambridge, MA 02139        | -71.09428 | 42.35988 | 77 Massachusetts Ave, Cambridge, MA 02139 | Vassar St       |
 26 Capen Street, Medford, MA                        | -71.12377 | 42.41101 | 9 Edison Ave, Medford, MA 02155           | Capen St        | Tesla Ave
 124 Mount Auburn St, Cambridge, Massachusetts 02138 | -71.12304 | 42.37328 | 3 University Rd, Cambridge, MA 02138      | Mount Auburn St |
 950 Main Street, Worcester, MA 01610                | -71.82368 | 42.24956 | 3 Maywood St, Worcester, MA 01603         | Main St         | Maywood Pl
</pre></div><div class="refsection"><a name="idp103579336"></a><h2>関連情報</h2><p><a class="xref" href="#Pprint_Addy" title="Pprint_Addy">Pprint_Addy</a>, <a class="xref" href="#Geocode" title="Geocode">Geocode</a>, <a class="xref" href="#Loader_Generate_Nation_Script" title="Loader_Generate_Nation_Script">Loader_Generate_Nation_Script</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="Topology_Load_Tiger"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Topology_Load_Tiger — Tigerデータの定義領域をPostGISトポロジにロードして、Tigerデータをトポロジの空間参照系に投影変換し、トポロジの許容精度にスナップします。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">Topology_Load_Tiger</b>(</code>varchar  <var class="pdparam">topo_name</var>, varchar  <var class="pdparam">region_type</var>, varchar  <var class="pdparam">region_id</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp103587912"></a><h2>説明</h2><p>Tigerデータの定義領域をPostGISトポロジにロードします。フェイス、ノード、エッジは対象トポロジの空間参照系に投影変換され、点は対象トポロジの許容精度にスナップされます。生成されたフェイス、ノード、エッジは、元のTigerデータのフェイス、ノード、エッジの識別値を維持するので、将来、データセットをより簡単にTigerデータに一致させることができます。処理の詳細に関する要約を返します。</p><p>これはデータの区域改訂に使えますが、ストリートの中心線に沿って新たに形成されるポリゴンと重ならないポリゴンとが必要です。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>この関数はPostGISトポロジモジュールとTigerデータに依存しています。詳細情報については、<a class="xref" href="#Topology" title="第11章 トポロジ">11章<i>トポロジ</i></a>と<a class="xref" href="#installation_configuration" title="2.4.1. コンフィギュレーション">「コンフィギュレーション」</a>を参照して下さい。対象領域を含むデータを持っていない場合には、トポロジは作られません。トポロジ関数を使ってトポロジが生成されない場合も失敗します。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ほとんどのトポロジ評価エラーは許容範囲の問題です。エッジの投影変換の後にポイントが準備できなかったり、エッジからずれる場合にあたります。トポロジ評価に失敗する状況を改善するには、精度を下げます。</p></td></tr></table></div><p>必須引数:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><code class="varname">topo_name</code> データを納めるPostGISトポロジの名前</p></li><li class="listitem"><p><code class="varname">region_type</code> 境界種別。現在は<code class="varname">place</code> と<code class="varname">county</code>とだけに対応しています。今後増やす予定です。これは境界を定義するために見るテーブルです。<code class="varname">tiger.place</code>や<code class="varname">tiger.county</code>等があたります。</p></li><li class="listitem"><p><code class="varname">region_id</code> TIGERではgeoidと呼ばれるものです。テーブルで領域の一意の識別子です。placeでは<code class="varname">tiger.place</code>テーブルの<code class="varname">plcidfp</code>カラムで、郡では<code class="varname">tiger.country</code>テーブルの<code class="varname">cntyidfp</code>カラムで保持します。 </p></li></ol></div><p>Availability: 2.0.0 </p></div><div class="refsection"><a name="idp103599176"></a><h2>例: マサチューセッツ州ボストン市のトポロジ</h2><p>マサチューセッツ州ボストンのトポロジをマサチューセッツ州フィート平面 (2249)、許容範囲0.25フィートで生成し、ボストンのTigerデータのフェイス、エッジ、ノードをロードします。</p><pre class="programlisting">SELECT topology.CreateTopology('topo_boston', 2249, 0.25);
createtopology
--------------
   15
-- Windows 7 デスクトップ PostgreSQL 9.1 (5州のTigerデータを格納)で 60,902ミリ秒 (約1分)
SELECT tiger.topology_load_tiger('topo_boston', 'place', '2507000');
-- topology_loader_tiger --
29722 edges holding in temporary. 11108 faces added. 1875 edges of faces added.  20576 nodes added.
19962 nodes contained in a face.  0 edge start end corrected.  31597 edges added.

-- 41ミリ秒 --
SELECT topology.TopologySummary('topo_boston');
 -- topologysummary--
Topology topo_boston (15), SRID 2249, precision 0.25
20576 nodes, 31597 edges, 11109 faces, 0 topogeoms in 0 layers

-- 評価に28,797ミリ秒 エラーなしでよかった --
SELECT * FROM
    topology.ValidateTopology('topo_boston');

       error       |   id1    |    id2
-------------------+----------+-----------
      </pre></div><div class="refsection"><a name="idp103600840"></a><h2>例: マサチューセッツ州サフォーク郡のトポロジ</h2><p>マサチューセッツ州サフォークのトポロジを、マサチューセッツ州メートル平面 (26986)、許容範囲0.25メートルで生成し、サフォークのTigerデータのフェイス、エッジ、ノードをロードします。</p><pre class="programlisting">SELECT topology.CreateTopology('topo_suffolk', 26986, 0.25);
-- Windows 7 32ビット Tigerデータ5州 で 56,275秒 (約1分)かかりました
-- ボストンのロードのあとウォームアップされたに違いありません
SELECT tiger.topology_load_tiger('topo_suffolk', 'county', '25025');
-- topology_loader_tiger --
 36003 edges holding in temporary. 13518 faces added. 2172 edges of faces added.
 24761 nodes added.  24075 nodes contained in a face.  0 edge start end corrected.  38175 edges added.
-- 31ミリ秒 --
SELECT topology.TopologySummary('topo_suffolk');
 -- topologysummary--
 Topology topo_suffolk (14), SRID 26986, precision 0.25
24761 nodes, 38175 edges, 13519 faces, 0 topogeoms in 0 layers

-- 評価に 33,606ミリ秒 --
SELECT * FROM
    topology.ValidateTopology('topo_suffolk');

       error       |   id1    |    id2
-------------------+----------+-----------
 coincident nodes  | 81045651 |  81064553
 edge crosses node | 81045651 |  85737793
 edge crosses node | 81045651 |  85742215
 edge crosses node | 81045651 | 620628939
 edge crosses node | 81064553 |  85697815
 edge crosses node | 81064553 |  85728168
 edge crosses node | 81064553 |  85733413
      </pre></div><div class="refsection"><a name="idp103602504"></a><h2>関連情報</h2><p><a class="xref" href="#CreateTopology" title="CreateTopology">CreateTopology</a>, <a class="xref" href="#CreateTopoGeom" title="CreateTopoGeom">CreateTopoGeom</a>, <a class="xref" href="#TopologySummary" title="TopologySummary">TopologySummary</a>, <a class="xref" href="#ValidateTopology" title="ValidateTopology">ValidateTopology</a></p></div></div><div class="refentry"><div class="refentry.separator"><hr></div><a name="Set_Geocode_Setting"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>Set_Geocode_Setting — ジオコーダ関数の振る舞いに影響を与える設定を行います。</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="funcsynopsis"><p><code class="funcdef">text <b class="fsfunc">Set_Geocode_Setting</b>(</code>text  <var class="pdparam"> setting_name</var>, text  <var class="pdparam"> setting_value</var><code>)</code>;</p></div></div><div class="refsection"><a name="idp103610440"></a><h2>説明</h2><p><code class="varname">tiger.geocode_settings</code>テーブルに格納されている設定の値を設定します。設定によって、関数のデバッグの切り替えができます。今後、評価値の制御を設定から行えるようにする予定です。現在の設定リストは<a class="xref" href="#Get_Geocode_Setting" title="Get_Geocode_Setting">Get_Geocode_Setting</a>にあります。</p><p>Availability: 2.1.0</p></div><div class="refsection"><a name="idp103612616"></a><h2>デバッグ設定を返す例</h2><p>この関数がTRUEを返す場合に<a class="xref" href="#Geocode" title="Geocode">Geocode</a>を実行すると、時刻とクエリがNOTICEログに出力されます。</p><pre class="programlisting">SELECT set_geocode_setting('debug_geocode_address', 'true') As result;
result
---------
true</pre></div><div class="refsection"><a name="idp103614920"></a><h2>関連情報</h2><p><a class="xref" href="#Get_Geocode_Setting" title="Get_Geocode_Setting">Get_Geocode_Setting</a></p></div></div></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="PostGIS_Special_Functions_Index"></a>第14章 PostGIS関数索引</h1></div></div></div><div class="toc"><p><b>目次</b></p><dl class="toc"><dt><span class="sect1"><a href="#PostGIS_Aggregate_Functions">14.1. PostGIS集約関数</a></span></dt><dt><span class="sect1"><a href="#PostGIS_Window_Functions">14.2. PostGISウィンドウ関数</a></span></dt><dt><span class="sect1"><a href="#PostGIS_SQLMM_Functions">14.3. PostGIS SQL-MM準拠関数</a></span></dt><dt><span class="sect1"><a href="#PostGIS_GeographyFunctions">14.4. PostGISジオグラフィ対応関数</a></span></dt><dt><span class="sect1"><a href="#PostGIS_RasterFunctions">14.5. PostGISラスタ対応関数</a></span></dt><dt><span class="sect1"><a href="#PostGIS_Geometry_DumpFunctions">14.6. PostGISジオメトリ/ジオグラフィ/ラスタのダンプ関数</a></span></dt><dt><span class="sect1"><a href="#PostGIS_BoxFunctions">14.7. PostGISボックス関数</a></span></dt><dt><span class="sect1"><a href="#PostGIS_3D_Functions">14.8. 3次元対応PostGIS関数</a></span></dt><dt><span class="sect1"><a href="#PostGIS_Curved_GeometryFunctions">14.9. PostGIS曲線ジオメトリ対応関数</a></span></dt><dt><span class="sect1"><a href="#PostGIS_PS_GeometryFunctions">14.10. PostGIS多面体サーフェス対応関数</a></span></dt><dt><span class="sect1"><a href="#PostGIS_TypeFunctionMatrix">14.11. PostGIS関数対応マトリクス</a></span></dt><dt><span class="sect1"><a href="#NewFunctions">14.12. 新規作成/機能強化/変更されたPostGIS関数</a></span></dt><dd><dl><dt><span class="sect2"><a href="#NewFunctions_2_5">14.12.1. PostGIS 2.5で新規作成/機能強化された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_2_4">14.12.2. PostGIS 2.4で新規作成/機能強化された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_2_3">14.12.3. PostGIS 2.3で新規作成/機能強化された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_2_2">14.12.4. PostGIS 2.2で新規作成/機能強化された関数</a></span></dt><dt><span class="sect2"><a href="#ChangedFunctions_2_2">14.12.5. PostGIS 2.2で大幅に変更された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_2_1">14.12.6. PostGIS 2.1で新規作成/機能強化された関数</a></span></dt><dt><span class="sect2"><a href="#ChangedFunctions_2_1">14.12.7. PostGIS 2.1で大幅に変更された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_2_0">14.12.8. PostGIS 2.0で新規作成/機能強化/変更された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_2_0_Changed">14.12.9. PostGIS 2.0で変更された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_1_5">14.12.10. PostGIS 1.5で新規作成/機能強化/変更された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_1_4">14.12.11. PostGIS 1.4で新規作成/機能強化/変更された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_1_3">14.12.12. PostGIS 1.3で新規作成された関数</a></span></dt></dl></dd></dl></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="PostGIS_Aggregate_Functions"></a>14.1. PostGIS集約関数</h2></div></div></div><p>次に示す関数は、PostGISが提供する空間集約関数です。sumやaverageといった他のSQL集約関数のように使います。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#ST_3DExtent" title="ST_3DExtent">ST_3DExtent</a> - ジオメトリのbox3Dバウンディングボックスを返す集約関数です。</li><li class="listitem"><a class="link" href="#ST_Accum" title="ST_Accum">ST_Accum</a> - 集約関数です。ジオメトリの配列を生成します。</li><li class="listitem"><a class="link" href="#ST_AsGeobuf" title="ST_AsGeobuf">ST_AsGeobuf</a> - 行集合のGeobuf表現を返します。</li><li class="listitem"><a class="link" href="#ST_AsMVT" title="ST_AsMVT">ST_AsMVT</a> - 行集合のMapbox Vector Tile表現を返します。</li><li class="listitem"><a class="link" href="#ST_ClusterIntersecting" title="ST_ClusterIntersecting">ST_ClusterIntersecting</a> - 集約関数です。ジオメトリの集合の接続された要素の配列を返します。</li><li class="listitem"><a class="link" href="#ST_ClusterWithin" title="ST_ClusterWithin">ST_ClusterWithin</a> - 集計関数です。ジオメトリコレクションの配列を返します。要素は、指定した距離以内となるよう分けられたジオメトリの集合です。</li><li class="listitem"><a class="link" href="#ST_Collect" title="ST_Collect">ST_Collect</a> - 他のジオメトリのコレクションから、指定したST_Geometry値を返します。</li><li class="listitem"><a class="link" href="#ST_Extent" title="ST_Extent">ST_Extent</a> - ジオメトリのバウンディングボックスを返す集約関数です。</li><li class="listitem"><a class="link" href="#ST_MakeLine" title="ST_MakeLine">ST_MakeLine</a> - ポイント、マルチポイント、ラインジオメトリからラインストリングを生成します。</li><li class="listitem"><a class="link" href="#ST_MemUnion" title="ST_MemUnion">ST_MemUnion</a> - ST_Unionと同じですが、メモリフレンドリ (少ないメモリ使用、多いCPU時間)です。</li><li class="listitem"><a class="link" href="#ST_Polygonize" title="ST_Polygonize">ST_Polygonize</a> - 集約関数。ジオメトリの集合のラインから形成されうるポリゴンを含むジオメトリコレクションを生成します。</li><li class="listitem"><a class="link" href="#RT_ST_SameAlignment" title="ST_SameAlignment">ST_SameAlignment</a> - ラスタが同じスキュー、スケール、空間参照系、オフセットを持つ (ピクセルが分割されることなく同じグリッドに置かれている)場合にTRUEを返し、そうでない場合は問題を詳述する通知とともにFALSEを返します。</li><li class="listitem"><a class="link" href="#ST_Union" title="ST_Union">ST_Union</a> - ジオメトリの結合の点集合を表現するジオメトリを返します。</li><li class="listitem"><a class="link" href="#TopoElementArray_Agg" title="TopoElementArray_Agg">TopoElementArray_Agg</a> - element_idとタイプの配列 (topoelements)からなるtopoelementarrayを返します。</li></ul></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="PostGIS_Window_Functions"></a>14.2. PostGISウィンドウ関数</h2></div></div></div><p>次に示す関数は、PostGISが提供する空間ウィンドウ関数です。row_numer(), lead(), lag()等のような他のSQLウィンドウ関数のように使います。全ての関数で、SQLのOVER()句が必要です。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#ST_ClusterDBSCAN" title="ST_ClusterDBSCAN">ST_ClusterDBSCAN</a> - DBSCAN (ノイズ適用可能な密度に基づいた空間クラスタリング)アルゴリズムの2次元実装に基づいて、それぞれの入力ジオメトリが入るクラスタの整数識別子を返すウィンドウ関数です。</li><li class="listitem"><a class="link" href="#ST_ClusterKMeans" title="ST_ClusterKMeans">ST_ClusterKMeans</a> - 個々のジオメトリが入るクラスタの整数識別子を返すウィンドウ関数です。</li></ul></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="PostGIS_SQLMM_Functions"></a>14.3. PostGIS SQL-MM準拠関数</h2></div></div></div><p>次に示す関数は、SQL/MM 3標準に準拠したPostGIS関数です。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>SQL-MMでは、全てのジオメトリコンストラクタのデフォルトSRIDを0としています。PostGISは-1としています (訳注: 2.0.0以降は0です)。</p></td></tr></table></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#ST_3DDWithin" title="ST_3DDWithin">ST_3DDWithin</a> - 3次元 (XYZ)ジオメトリ型について、二つのジオメトリの3次元距離が指定した数の内にある場合にtrueを返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM ?</li><li class="listitem"><a class="link" href="#ST_3DDistance" title="ST_3DDistance">ST_3DDistance</a> - ジオメトリ型について、二つのジオメトリの、3次元の最小デカルト距離 (空間参照系に基づきます)を、投影法の単位で返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM ?</li><li class="listitem"><a class="link" href="#ST_3DIntersects" title="ST_3DIntersects">ST_3DIntersects</a> - ジオメトリが3次元で「空間的にインタセクトする」場合にTRUEを返します。ポイント、ラインストリング、ポリゴン、多面体サーフェス (面)のみ対応します。SFCGALバックエンドによってTINも対応します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: ?</li><li class="listitem"><a class="link" href="#ST_AddEdgeModFace" title="ST_AddEdgeModFace">ST_AddEdgeModFace</a> - 新しいエッジを追加します。新しいエッジがフェイスを分割する場合には、もとのフェイスを編集し、一つのフェイスを追加します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.13</li><li class="listitem"><a class="link" href="#ST_AddEdgeNewFaces" title="ST_AddEdgeNewFaces">ST_AddEdgeNewFaces</a> - 新しいエッジを追加します。新しいエッジがフェイスを分割する場合には、もとのフェイスを削除して、分割した二つのフェイスに置き換えます。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.12</li><li class="listitem"><a class="link" href="#ST_AddIsoEdge" title="ST_AddIsoEdge">ST_AddIsoEdge</a> - anodeとanothernodeで指定される二つの既存孤立ノードを接続するトポロジに、ジオメトリalinestringで定義される孤立エッジを追加し、新しいエッジの識別番号を返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.4</li><li class="listitem"><a class="link" href="#ST_AddIsoNode" title="ST_AddIsoNode">ST_AddIsoNode</a> - フェイスに孤立ノードを追加し、新しいノードの識別番号を返します。フェイスがNULLの場合でもノードは生成されます。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X 3.1</li><li class="listitem"><a class="link" href="#ST_Area" title="ST_Area">ST_Area</a> - ポリゴンまたはマルチポリゴンの場合にはサーフェスの面積を返します。ジオメトリ型の面積はSRIDに基づく単位です。ジオグラフィ型の面積は曲面上で計算され、単位は平方メートルです。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 8.1.2, 9.5.3</li><li class="listitem"><a class="link" href="#ST_AsBinary" title="ST_AsBinary">ST_AsBinary</a> - ジオメトリ/ジオグラフィのSRIDメタデータのないWell-Known Binary (WKB)表現を返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 5.1.37</li><li class="listitem"><a class="link" href="#ST_AsText" title="ST_AsText">ST_AsText</a> - ジオメトリ/ジオグラフィのSRIDメタデータのないWell-Known Text (WKT)表現を返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 5.1.25</li><li class="listitem"><a class="link" href="#ST_Boundary" title="ST_Boundary">ST_Boundary</a> - ジオメトリの組み合わせ境界の閉包を返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 5.1.14</li><li class="listitem"><a class="link" href="#ST_Buffer" title="ST_Buffer">ST_Buffer</a> - (T) このジオメトリからの距離が指定された距離以下となる点全てを表現するジオメトリを返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 5.1.17</li><li class="listitem"><a class="link" href="#ST_Centroid" title="ST_Centroid">ST_Centroid</a> - ジオメトリの幾何学的重心を返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 8.1.4, 9.5.5</li><li class="listitem"><a class="link" href="#ST_ChangeEdgeGeom" title="ST_ChangeEdgeGeom">ST_ChangeEdgeGeom</a> - トポロジ構造に影響を与えることなくエッジの形状を変更します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.6</li><li class="listitem"><a class="link" href="#ST_Contains" title="ST_Contains">ST_Contains</a> - Bの点がAの外部に無く、かつBの内部の少なくとも一つの点がAの内部にある場合に限って、TRUEを返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 5.1.31</li><li class="listitem"><a class="link" href="#ST_ConvexHull" title="ST_ConvexHull">ST_ConvexHull</a> - 凸包は与えられた集合の全てのジオメトリを含む最小の閉じた凸ジオメトリです。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 5.1.16</li><li class="listitem"><a class="link" href="#ST_CoordDim" title="ST_CoordDim">ST_CoordDim</a> - ST_Geometry値の座標次元を返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 5.1.3</li><li class="listitem"><a class="link" href="#ST_CreateTopoGeo" title="ST_CreateTopoGeo">ST_CreateTopoGeo</a> - 空のトポロジにジオメトリのコレクションを追加し、成否を示すメッセージを返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.18</li><li class="listitem"><a class="link" href="#ST_Crosses" title="ST_Crosses">ST_Crosses</a> - 与えられたジオメトリが共通の内部の点を持ち、かつそうでない点を持つ場合に、TRUEを返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 5.1.29</li><li class="listitem"><a class="link" href="#ST_CurveToLine" title="ST_CurveToLine">ST_CurveToLine</a> - CIRCULARSTRING/CURVEPOLYGONをLINESTRING/POLYGONに変換します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 7.1.7</li><li class="listitem"><a class="link" href="#ST_Difference" title="ST_Difference">ST_Difference</a> - ジオメトリBにインタセクトしないジオメトリAの部分を表現するジオメトリを返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 5.1.20</li><li class="listitem"><a class="link" href="#ST_Dimension" title="ST_Dimension">ST_Dimension</a> - ジオメトリの固有次元を返します。ジオメトリは座標次元以下でなければなりません。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 5.1.2</li><li class="listitem"><a class="link" href="#ST_Disjoint" title="ST_Disjoint">ST_Disjoint</a> - ジオメトリが「空間的にインタセクトし」ていない、すなわち、空間を共有していない場合に、TRUEを返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 5.1.26</li><li class="listitem"><a class="link" href="#ST_Distance" title="ST_Distance">ST_Distance</a> - ジオメトリ型については、二つのジオメトリの、2次元の最小デカルト距離 (空間参照系に基づきます)を、投影法の単位で返します。ジオグラフィ型については、デフォルトでは、二つのジオメトリ間の測地距離をメートル単位で返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 5.1.23</li><li class="listitem"><a class="link" href="#ST_EndPoint" title="ST_EndPoint">ST_EndPoint</a> - LINESTRINGの最後のポイントをPOINTで返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 7.1.4</li><li class="listitem"><a class="link" href="#ST_Envelope" title="ST_Envelope">ST_Envelope</a> - ジオメトリの浮動小数点数 (float8)バウンディングボックスを表現するジオメトリを返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 5.1.15</li><li class="listitem"><a class="link" href="#ST_Equals" title="ST_Equals">ST_Equals</a> - 与えられたジオメトリ表現が同じ場合にTRUEを返します。方向は無視されます。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 5.1.24</li><li class="listitem"><a class="link" href="#ST_ExteriorRing" title="ST_ExteriorRing">ST_ExteriorRing</a> - POLYGONの外環を表現するラインストリングを返します。ジオメトリがポリゴンでない場合はNULLを返します。マルチポリゴンでは動作しません。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 8.2.3, 8.3.3</li><li class="listitem"><a class="link" href="#ST_GMLToSQL" title="ST_GMLToSQL">ST_GMLToSQL</a> - GML表現から指定したST_Geometry値を返します。これはST_GeomFromGMLの別名です。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 5.1.50 (曲線対応を除く)</li><li class="listitem"><a class="link" href="#ST_GeomCollFromText" title="ST_GeomCollFromText">ST_GeomCollFromText</a> - WKT表現と与えられたSRIDからジオメトリのコレクションを生成します。SRIDが与えられていない場合は0とします。
   
     
   
  This method implements the SQL/MM specification.</li><li class="listitem"><a class="link" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a> - Well-Known Text表現 (WKT)から指定したST_Geometryを返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 5.1.40</li><li class="listitem"><a class="link" href="#ST_GeomFromWKB" title="ST_GeomFromWKB">ST_GeomFromWKB</a> - Well-Knwon Binaryジオメトリ表現 (WKB)と任意パラメタのSRIDからジオメトリインスタンスを生成します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 5.1.41</li><li class="listitem"><a class="link" href="#ST_GeometryFromText" title="ST_GeometryFromText">ST_GeometryFromText</a> - Well-Knwon Text表現 (WKT)から指定したST_Geometry値を返します。これはST_GeomFromTextの別名です。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 5.1.40</li><li class="listitem"><a class="link" href="#ST_GeometryN" title="ST_GeometryN">ST_GeometryN</a> - GEOMETRYCOLLECTION, (MULTI)POINT, (MULTI)LINESTRING, MULTICURVE, (MULTI)POLYGON, POLYHEDRALSURFACEの場合には、1始まりでN番目のジオメトリを返します。それ以外の場合にはNULLを返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 9.1.5</li><li class="listitem"><a class="link" href="#ST_GeometryType" title="ST_GeometryType">ST_GeometryType</a> - ST_Geometry値のジオメトリ型を返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 5.1.4</li><li class="listitem"><a class="link" href="#ST_GetFaceEdges" title="ST_GetFaceEdges">ST_GetFaceEdges</a> - 順序番号を含む、afaceの境界となる、整列したエッジの集合を返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.5</li><li class="listitem"><a class="link" href="#ST_GetFaceGeometry" title="ST_GetFaceGeometry">ST_GetFaceGeometry</a> - 指定されたトポロジの中の、フェイス識別番号で指定されたポリゴンを返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.16</li><li class="listitem"><a class="link" href="#ST_InitTopoGeo" title="ST_InitTopoGeo">ST_InitTopoGeo</a> - 新しいトポロジスキーマを生成し、topology.topologyテーブルに新しいスキーマを登録し、処理の概要を表示します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.17</li><li class="listitem"><a class="link" href="#ST_InteriorRingN" title="ST_InteriorRingN">ST_InteriorRingN</a> - ポリゴンのN番目の内環を返します。ジオメトリがポリゴンでないかNが範囲外の場合はNULLを返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 8.2.6, 8.3.5</li><li class="listitem"><a class="link" href="#ST_Intersection" title="ST_Intersection">ST_Intersection</a> - (T) geomAとgeomBの共有する部分を表現するジオメトリを返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 5.1.18</li><li class="listitem"><a class="link" href="#ST_Intersects" title="ST_Intersects">ST_Intersects</a> - ジオメトリ/ジオグラフィが「2次元空間で空間的にインタセクトする」 (空間に共有部分がある)場合にTRUEを返します。そうでない (非接続)場合はFALSEを返します。ジオグラフィについては、許容量は0.00001メートルです (近い点はインタセクトと考えられてしまいます)。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 5.1.27</li><li class="listitem"><a class="link" href="#ST_IsClosed" title="ST_IsClosed">ST_IsClosed</a> - LINESTRINGの始点と終点が一致する場合にTRUEを返します。多面体サーフェスの場合は閉じているかどうか (ボリュームであるかどうか)を返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 7.1.5, 9.3.3</li><li class="listitem"><a class="link" href="#ST_IsEmpty" title="ST_IsEmpty">ST_IsEmpty</a> - ジオメトリが、空のジオメトリコレクション、ポリゴン、ポイント等の場合に、trueを返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 5.1.7</li><li class="listitem"><a class="link" href="#ST_IsRing" title="ST_IsRing">ST_IsRing</a> - LINESTRINGが閉じていて、かつ単純である場合にTRUEを返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 7.1.6</li><li class="listitem"><a class="link" href="#ST_IsSimple" title="ST_IsSimple">ST_IsSimple</a> - ジオメトリが自己インタセクションや自己接触のような異常な幾何学ポイントを持っていない場合にTRUEを返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 5.1.8</li><li class="listitem"><a class="link" href="#ST_IsValid" title="ST_IsValid">ST_IsValid</a> - ST_Geometryが整形されている場合には、trueを返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 5.1.9</li><li class="listitem"><a class="link" href="#ST_Length" title="ST_Length">ST_Length</a> - ジオメトリがLINESTRINGまたはMULTILINESTRINGの場合には、それらの2次元長を返します。ジオメトリでは、単位は空間参照系の単位です。ジオグラフィでは、メートル単位です (回転楕円体がデフォルトです)。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 7.1.2, 9.3.4</li><li class="listitem"><a class="link" href="#ST_LineFromText" title="ST_LineFromText">ST_LineFromText</a> - WKT表現と与えられたSRIDからジオメトリを生成します。SRIDが与えられていない場合は0 (不明)となります。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 7.2.8</li><li class="listitem"><a class="link" href="#ST_LineFromWKB" title="ST_LineFromWKB">ST_LineFromWKB</a> - WKB表現と与えられたSRIDからLINESTRINGを生成します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 7.2.9</li><li class="listitem"><a class="link" href="#ST_LinestringFromWKB" title="ST_LinestringFromWKB">ST_LinestringFromWKB</a> - WKB表現と与えられたSRIDからジオメトリを生成します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 7.2.9</li><li class="listitem"><a class="link" href="#ST_M" title="ST_M">ST_M</a> - ポイントのM座標値を返し、有効でないならNULLを返します。入力はポイントでなければなりません。
   
     
   
  This method implements the SQL/MM specification.</li><li class="listitem"><a class="link" href="#ST_MLineFromText" title="ST_MLineFromText">ST_MLineFromText</a> - WKT表現から指定したST_MultiLineString値を返します。
   
     
   
  This method implements the SQL/MM specification.SQL-MM 3: 9.4.4</li><li class="listitem"><a class="link" href="#ST_MPointFromText" title="ST_MPointFromText">ST_MPointFromText</a> - Well-Known Text (WKT)表現と与えられたSRIDからジオメトリを生成します。SRIDを与えない場合は0 (不明)となります。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 9.2.4</li><li class="listitem"><a class="link" href="#ST_MPolyFromText" title="ST_MPolyFromText">ST_MPolyFromText</a> - Well-Known Text (WKT)表現と与えられたSRIDからマルチポリゴンを生成します。SRIDが与えられていない場合は0 (不明)となります。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 9.6.4</li><li class="listitem"><a class="link" href="#ST_ModEdgeHeal" title="ST_ModEdgeHeal">ST_ModEdgeHeal</a> - 二つのエッジについて、接続しているノードを削除して修復します。1番目のエッジを編集して、2番目のエッジを削除します。削除されたノードの識別番号を返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.9</li><li class="listitem"><a class="link" href="#ST_ModEdgeSplit" title="ST_ModEdgeSplit">ST_ModEdgeSplit</a> - 既存のエッジに沿って新しいノードを生成してエッジを分割します。もとのエッジは変更され、新しいエッジが一つ追加されます。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.9</li><li class="listitem"><a class="link" href="#ST_MoveIsoNode" title="ST_MoveIsoNode">ST_MoveIsoNode</a> - トポロジ内の孤立ノードを別の位置に移動させます。新しいapointジオメトリがノードとして存在しているなら、エラーが投げられます。移動に関する説明を返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.2</li><li class="listitem"><a class="link" href="#ST_NewEdgeHeal" title="ST_NewEdgeHeal">ST_NewEdgeHeal</a> - 二つのエッジについて、接続しているノードを削除して修復します。両方のエッジを削除し、1番目のエッジと同じ方向のエッジに置き換えます。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.9</li><li class="listitem"><a class="link" href="#ST_NewEdgesSplit" title="ST_NewEdgesSplit">ST_NewEdgesSplit</a> - 新しいノードを既存のエッジに沿って作成して、エッジを分割します。もとのエッジは削除され、二つのエッジに置き換えられます。二つの新しいエッジに接続する新しいノードの識別番号を返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.8</li><li class="listitem"><a class="link" href="#ST_NumGeometries" title="ST_NumGeometries">ST_NumGeometries</a> - ジオメトリがジオメトリコレクションまたはマルチ系の場合はジオメトリの数を、単一のジオメトリの場合は1を返し、それ以外の場合はNULLを返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 9.1.4</li><li class="listitem"><a class="link" href="#ST_NumInteriorRings" title="ST_NumInteriorRings">ST_NumInteriorRings</a> - ポリゴンジオメトリの内環の数を返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 8.2.5</li><li class="listitem"><a class="link" href="#ST_NumPatches" title="ST_NumPatches">ST_NumPatches</a> - 多面体サーフェスのフェイス数を返します。多面体でないジオメトリの場合にはNULLを返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: ?</li><li class="listitem"><a class="link" href="#ST_NumPoints" title="ST_NumPoints">ST_NumPoints</a> - ST_LineStringまたはST_CircularStringのポイント数を返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 7.2.4</li><li class="listitem"><a class="link" href="#ST_OrderingEquals" title="ST_OrderingEquals">ST_OrderingEquals</a> - 与えられたジオメトリが同じジオメトリを示し、ポイントの順序が同じである場合にTRUEを返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 5.1.43</li><li class="listitem"><a class="link" href="#ST_Overlaps" title="ST_Overlaps">ST_Overlaps</a> - ジオメトリが共有空間を持ち、同じ次元で、かつ完全には一方に含まれていない場合にTRUEを返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 5.1.32</li><li class="listitem"><a class="link" href="#ST_PatchN" title="ST_PatchN">ST_PatchN</a> - ジオメトリがPOLYHEDRALSURFACEかPOLYHEDRALSURFACEMの場合には、1始まりでN番目のジオメトリ (フェイス)を返します。それ以外の場合には、NULLを返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: ?</li><li class="listitem"><a class="link" href="#ST_Perimeter" title="ST_Perimeter">ST_Perimeter</a> - ST_SrrfaceまたはST_MultiSurface (POLYGONまたはMULTIPOLYGON)の境界の長さの計測値を返します。ジオメトリでは単位は空間参照系によります。ジオグラフィではメートル単位になります。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 8.1.3, 9.5.4</li><li class="listitem"><a class="link" href="#ST_Point" title="ST_Point">ST_Point</a> - 与えられた座標値のST_Pointを返します。ST_MakePointのOGC別名です。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 6.1.2</li><li class="listitem"><a class="link" href="#ST_PointFromText" title="ST_PointFromText">ST_PointFromText</a> - WKTと与えられたSRIDからポイントジオメトリを生成します。SRIDが与えられていない場合は0 (不明)とします。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 6.1.8</li><li class="listitem"><a class="link" href="#ST_PointFromWKB" title="ST_PointFromWKB">ST_PointFromWKB</a> - WKBと与えられたSRIDからジオメトリを生成します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 6.1.9</li><li class="listitem"><a class="link" href="#ST_PointN" title="ST_PointN">ST_PointN</a> - ラインストリングまたは曲線ストリングのN番目の点を返します。負数はラインストリングの終端から逆方向に遡って数えます。ジオメトリにラインストリングが無い場合には、NULLを返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 7.2.5, 7.3.5</li><li class="listitem"><a class="link" href="#ST_PointOnSurface" title="ST_PointOnSurface">ST_PointOnSurface</a> - サーフェス上にあることを保障されたPOINTを返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 8.1.5, 9.5.6. 仕様によると、ST_PointOnSurfaceは面ジオメトリ (POLYGON, MULTIPOLYGON, 曲線ポリゴン)で動作します。PostGISは、仕様で許される以上に拡張しているように見えます。Oracle, DB II, ESRI SDEといったほとんどのデータベースでは、面ジオメトリにのみ対応しているように見えます。SQL Server 2008は、PostGISのように全ての一般的なジオメトリに対応しています。</li><li class="listitem"><a class="link" href="#ST_Polygon" title="ST_Polygon">ST_Polygon</a> - 指定されたラインストリングとSRIDからポリゴンを生成します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 8.3.2</li><li class="listitem"><a class="link" href="#ST_PolygonFromText" title="ST_PolygonFromText">ST_PolygonFromText</a> - Well-Known Text (WKT)表現と与えられたSRIDからジオメトリを生成します。SRIDを与えない場合は0 (不明)となります。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 8.3.6</li><li class="listitem"><a class="link" href="#ST_Relate" title="ST_Relate">ST_Relate</a> - intersectionMatrixPatternの値について、二つのジオメトリの内部、境界、外部のインタセクションを見て、指定したジオメトリがもうひとつのジオメトリと空間的に関係している場合に、TRUEを返します。intersectionMatrixPatternが無い場合には、二つのジオメトリについての最大のintersectionMatrixPatternを返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 5.1.25</li><li class="listitem"><a class="link" href="#ST_RemEdgeModFace" title="ST_RemEdgeModFace">ST_RemEdgeModFace</a> - エッジを削除し、削除対象エッジでフェイスが二つに分割されているなら、両方の空間をとるため、一つを削除して、もう一つを編集します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.15</li><li class="listitem"><a class="link" href="#ST_RemEdgeNewFace" title="ST_RemEdgeNewFace">ST_RemEdgeNewFace</a> - エッジを削除し、消去対象エッジでフェイスが二つに分割されているなら元の二つのフェイスを削除し、一つの新しいフェイスに置き換えます。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.14</li><li class="listitem"><a class="link" href="#ST_RemoveIsoEdge" title="ST_RemoveIsoEdge">ST_RemoveIsoEdge</a> - 孤立エッジを削除し、実行結果の記述を返します。エッジが孤立していない場合には、例外が投げられます。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.3</li><li class="listitem"><a class="link" href="#ST_RemoveIsoNode" title="ST_RemoveIsoNode">ST_RemoveIsoNode</a> - 孤立ノードを削除し、実行結果が返されます。ノードが孤立していない (エッジの始端または終端である)場合には、例外が投げられます。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3 トポロジ-ジオメトリ および トポロジ-ネットワーク 3: ルーチン詳細: X.3.3</li><li class="listitem"><a class="link" href="#ST_SRID" title="ST_SRID">ST_SRID</a> - ST_Geometryのspatial_ref_sysテーブルで定義されている空間参照系の識別番号を返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 5.1.5</li><li class="listitem"><a class="link" href="#ST_StartPoint" title="ST_StartPoint">ST_StartPoint</a> - LINESTRINGの最初のポイントをPOINTとして返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 7.1.3</li><li class="listitem"><a class="link" href="#ST_SymDifference" title="ST_SymDifference">ST_SymDifference</a> - AとBの、インタセクトしていない部分を表現するジオメトリを返します。対称と呼ばれるのは、ST_SymDifference(A,B) = ST_SymDifference(B,A) となるからです。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 5.1.21</li><li class="listitem"><a class="link" href="#ST_Touches" title="ST_Touches">ST_Touches</a> - ジオメトリが共通のポイントを少なくとも一つ持ち、かつ内部でインタセクトしない場合に、TRUEを返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 5.1.28</li><li class="listitem"><a class="link" href="#ST_Transform" title="ST_Transform">ST_Transform</a> - 異なる空間参照系に投影変換された新しいジオメトリを返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 5.1.6</li><li class="listitem"><a class="link" href="#ST_Union" title="ST_Union">ST_Union</a> - ジオメトリの結合の点集合を表現するジオメトリを返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 5.1.19 ポリゴンが含まれる時、Z値 (標高)を持ちます。</li><li class="listitem"><a class="link" href="#ST_WKBToSQL" title="ST_WKBToSQL">ST_WKBToSQL</a> - Well-Known Binary表現 (WKB)からST_Geometry値を生成します。これはSRIDを取らないST_GeomFromWKBの別名です。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 5.1.36</li><li class="listitem"><a class="link" href="#ST_WKTToSQL" title="ST_WKTToSQL">ST_WKTToSQL</a> - Well-Knwon Text表現 (WKT)から指定したST_Geometry値を返します。これはST_GeomFromTextの別名です。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 5.1.34</li><li class="listitem"><a class="link" href="#ST_Within" title="ST_Within">ST_Within</a> - ジオメトリAが完全にジオメトリBの内側にある場合にTRUEを返します。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 5.1.30</li><li class="listitem"><a class="link" href="#ST_X" title="ST_X">ST_X</a> - ポイントのX座標値を返し、有効でないならNULLを返します。入力はポイントでなければなりません。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 6.1.3</li><li class="listitem"><a class="link" href="#ST_Y" title="ST_Y">ST_Y</a> - ポイントのY座標値を返し、有効でないならNULLを返します。入力はポイントでなければなりません。
   
     
   
  This method implements the SQL/MM specification. SQL-MM 3: 6.1.4</li><li class="listitem"><a class="link" href="#ST_Z" title="ST_Z">ST_Z</a> - ポイントのZ座標値を返し、有効でないならNULLを返します。入力はポイントでなければなりません。
   
     
   
  This method implements the SQL/MM specification.</li></ul></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="PostGIS_GeographyFunctions"></a>14.4. PostGISジオグラフィ対応関数</h2></div></div></div><p>次に示す関数と演算子は、<a class="link" href="#PostGIS_Geography" title="4.2. PostGISジオグラフィ型">ジオグラフィ</a>データ型を入力または出力に取るPostGIS関数/演算子です。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>(T)の付いた関数はネイティブなジオグラフィ関数ではなく、実行時にST_Transformを使ってジオメトリとの変換を行います。結果として、日付変更線や極を超えたり、ひとつのUTMゾーンではカバーできない巨大なジオメトリを使用する場合に、予期しない挙動になることがあります。基本的な変換としては、UTMが望ましいですが、ランベルト正積方位図法(北/南)、最悪のシナリオでメルカトルに頼ります。</p></td></tr></table></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#ST_Area" title="ST_Area">ST_Area</a> - ポリゴンまたはマルチポリゴンの場合にはサーフェスの面積を返します。ジオメトリ型の面積はSRIDに基づく単位です。ジオグラフィ型の面積は曲面上で計算され、単位は平方メートルです。</li><li class="listitem"><a class="link" href="#ST_AsBinary" title="ST_AsBinary">ST_AsBinary</a> - ジオメトリ/ジオグラフィのSRIDメタデータのないWell-Known Binary (WKB)表現を返します。</li><li class="listitem"><a class="link" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a> - ジオメトリのSRIDメタデータが付いたWell-Known Text (WKT)表現を返します。</li><li class="listitem"><a class="link" href="#ST_AsGML" title="ST_AsGML">ST_AsGML</a> - GML第2版または第3版としてジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_AsGeoJSON" title="ST_AsGeoJSON">ST_AsGeoJSON</a> - GeoJSON要素としてジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_AsKML" title="ST_AsKML">ST_AsKML</a> - ジオメトリをKML要素で返します。いくつかの形式があります。デフォルトはversion=2, maxdecimaldigits=15です。</li><li class="listitem"><a class="link" href="#ST_AsSVG" title="ST_AsSVG">ST_AsSVG</a> - ジオメトリまたはジオグラフィで与えられたSVGパスデータによるジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_AsText" title="ST_AsText">ST_AsText</a> - ジオメトリ/ジオグラフィのSRIDメタデータのないWell-Known Text (WKT)表現を返します。</li><li class="listitem"><a class="link" href="#ST_Azimuth" title="ST_Azimuth">ST_Azimuth</a> - pointAの鉛直線からPointBへの右回りの方位を北を基準にしたラジアン単位で返します。</li><li class="listitem"><a class="link" href="#ST_Buffer" title="ST_Buffer">ST_Buffer</a> - (T) このジオメトリからの距離が指定された距離以下となる点全てを表現するジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_Centroid" title="ST_Centroid">ST_Centroid</a> - ジオメトリの幾何学的重心を返します。</li><li class="listitem"><a class="link" href="#ST_CoveredBy" title="ST_CoveredBy">ST_CoveredBy</a> - ジオメトリ/ジオグラフィAの点がジオメトリ/ジオグラフィBの外に無い場合に、1 (TRUE)を返します。</li><li class="listitem"><a class="link" href="#ST_Covers" title="ST_Covers">ST_Covers</a> - ジオメトリBにジオメトリAの外となるポイントが無い場合には、1 (TRUE)を返します。</li><li class="listitem"><a class="link" href="#ST_DWithin" title="ST_DWithin">ST_DWithin</a> - ジオメトリが指定したジオメトリから指定した距離内にある場合にTRUEを返します。ジオメトリについては、距離は空間参照系で定義されている単位になります。ジオグラフィについては、メートル単位で、デフォルトではuse_spheroid=true (回転楕円体を使った計算)となり、速いチェックをするにはuse_spheroid=falseとして球面を使って計算します。</li><li class="listitem"><a class="link" href="#ST_Distance" title="ST_Distance">ST_Distance</a> - ジオメトリ型については、二つのジオメトリの、2次元の最小デカルト距離 (空間参照系に基づきます)を、投影法の単位で返します。ジオグラフィ型については、デフォルトでは、二つのジオメトリ間の測地距離をメートル単位で返します。</li><li class="listitem"><a class="link" href="#ST_GeogFromText" title="ST_GeogFromText">ST_GeogFromText</a> - Well-Known Text表現または拡張WKTから指定したジオグラフィ値を返します。</li><li class="listitem"><a class="link" href="#ST_GeogFromWKB" title="ST_GeogFromWKB">ST_GeogFromWKB</a> - Well-Known Binaryジオメトリ表現(WKB)または拡張WKB(EWKB)からジオグラフィインスタンスを生成します。</li><li class="listitem"><a class="link" href="#ST_GeographyFromText" title="ST_GeographyFromText">ST_GeographyFromText</a> - Well-Known Text表現または拡張WKTから指定したジオグラフィ値を返します。</li><li class="listitem"><a class="link" href="#ST_Geometry_EQ" title="=">=</a> - ジオメトリ/ジオグラフィ Aの座標と座標の並び順がジオメトリ/ジオグラフィ Bと同じ場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#ST_Intersection" title="ST_Intersection">ST_Intersection</a> - (T) geomAとgeomBの共有する部分を表現するジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_Intersects" title="ST_Intersects">ST_Intersects</a> - ジオメトリ/ジオグラフィが「2次元空間で空間的にインタセクトする」 (空間に共有部分がある)場合にTRUEを返します。そうでない (非接続)場合はFALSEを返します。ジオグラフィについては、許容量は0.00001メートルです (近い点はインタセクトと考えられてしまいます)。</li><li class="listitem"><a class="link" href="#ST_Length" title="ST_Length">ST_Length</a> - ジオメトリがLINESTRINGまたはMULTILINESTRINGの場合には、それらの2次元長を返します。ジオメトリでは、単位は空間参照系の単位です。ジオグラフィでは、メートル単位です (回転楕円体がデフォルトです)。</li><li class="listitem"><a class="link" href="#ST_Perimeter" title="ST_Perimeter">ST_Perimeter</a> - ST_SrrfaceまたはST_MultiSurface (POLYGONまたはMULTIPOLYGON)の境界の長さの計測値を返します。ジオメトリでは単位は空間参照系によります。ジオグラフィではメートル単位になります。</li><li class="listitem"><a class="link" href="#ST_Project" title="ST_Project">ST_Project</a> - メートル単位の距離とラジアン単位の方位とを使って始点から算出されたPOINTを返します。</li><li class="listitem"><a class="link" href="#ST_Segmentize" title="ST_Segmentize">ST_Segmentize</a> - 与えた距離を超える線分を持たないよう変更したジオメトリ/ジオグラフィを返します。</li><li class="listitem"><a class="link" href="#ST_Summary" title="ST_Summary">ST_Summary</a> - ジオメトリについての要約文を返します。</li><li class="listitem"><a class="link" href="#geometry_distance_knn" title="&lt;-&gt;">&lt;-&gt;</a> - AとBの2次元距離を返します。</li><li class="listitem"><a class="link" href="#geometry_overlaps" title="&amp;&amp;">&amp;&amp;</a> - Aの2次元バウンディングボックスがBの2次元バウンディングボックスとインタセクトする場合にTRUEを返します。</li></ul></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="PostGIS_RasterFunctions"></a>14.5. PostGISラスタ対応関数</h2></div></div></div><p>次に示す関数と演算子は、<a class="xref" href="#raster" title="raster">raster</a>データ型を入力または出力に取るPostGIS関数/演算子です。アルファベット順に示します。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#RT_Box3D" title="Box3D">Box3D</a> - ラスタを囲むボックスのbox3d表現を返します。</li><li class="listitem"><a class="link" href="#RT_Raster_Contained" title="@">@</a> - AのバウンディングボックスがBのバウンディングボックスに含まれる場合にTRUEを返します。倍精度浮動小数点数のバウンディングボックスを使います。</li><li class="listitem"><a class="link" href="#RT_Raster_Contains" title="~">~</a> - AのバウンディングボックスがBのバウンディングボックスを含む場合にTRUEを返します。倍精度浮動小数点数のバウンディングボックスを使います。</li><li class="listitem"><a class="link" href="#RT_Raster_EQ" title="=">=</a> - AのバウンディングボックスがBのバウンディングボックスと同じ場合にTRUEを返します。倍精度浮動小数点数のバウンディングボックスを使います。</li><li class="listitem"><a class="link" href="#RT_Raster_Intersect" title="&amp;&amp;">&amp;&amp;</a> - AのバウンディングボックスがBのバウンディングボックスとインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#RT_Raster_OverLeft" title="&amp;&lt;">&amp;&lt;</a> - AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの左にある場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#RT_Raster_OverRight" title="&amp;&gt;">&amp;&gt;</a> - AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの右にある場合に TRUE を返します。</li><li class="listitem"><a class="link" href="#RT_Raster_Same" title="~=">~=</a> - AのバウンディングボックスがBのバウンディングボックスと同じ場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#RT_Retile" title="ST_Retile">ST_Retile</a> - 任意のタイル化されたラスタカバレッジから構成されたタイルの集合を返します。</li><li class="listitem"><a class="link" href="#RT_ST_AddBand" title="ST_AddBand">ST_AddBand</a> - 与えられたタイプで、与えられた初期値にした新しいバンドを、与えられたインデクス位置に追加したラスタを返します。インデクス位置を指定していない場合には、バンドは末尾に追加されます。</li><li class="listitem"><a class="link" href="#RT_ST_AsBinary" title="ST_AsBinary/ST_AsWKB">ST_AsBinary/ST_AsWKB</a> - ラスタのWell-Known Binary (WKB)表現を返します。</li><li class="listitem"><a class="link" href="#RT_ST_AsGDALRaster" title="ST_AsGDALRaster">ST_AsGDALRaster</a> - 指定されたGDALラスタ書式でラスタタイルを返します。ラスタ書式はコンパイルしたライブラリが対応するものです。ライブラリが対応する書式の一覧を得るにはST_GDALRasters()を使います。</li><li class="listitem"><a class="link" href="#RT_ST_AsHexWKB" title="ST_AsHexWKB">ST_AsHexWKB</a> - Well-Known Binary (WKB)ラスタを16進数表現で返します。</li><li class="listitem"><a class="link" href="#RT_ST_AsJPEG" title="ST_AsJPEG">ST_AsJPEG</a> - ラスタの選択されたバンドを、単一のJoint Photographic Exports Group (JPEG)画像としてバイト配列で返します。バンドを指定せず、1バンドか3より多いバンドがある場合には、1番バンドを使用します。3バンドのみ指定した場合には、3バンドを使用し、RGBに対応付けます。</li><li class="listitem"><a class="link" href="#RT_ST_AsPNG" title="ST_AsPNG">ST_AsPNG</a> - ラスタの選択されたバンドを、単一のportable network graphics (PNG)画像としてバイト配列で返します。バンドを指定せず、1バンドか3バンドか4バンドある場合には、全てのバンドを使用します。バンドを指定せず、2バンドか4より多いバンドがある場合には、1番バンドを使用します。対象バンドはRGBまたはRGBAに対応付けられます。</li><li class="listitem"><a class="link" href="#RT_ST_AsRaster" title="ST_AsRaster">ST_AsRaster</a> - PostGISジオメトリをPostGISラスタに変換します。</li><li class="listitem"><a class="link" href="#RT_ST_AsTIFF" title="ST_AsTIFF">ST_AsTIFF</a> - ラスタの選択されたバンドを、単一のTIFF画像 (バイト配列)として返します。バンドを指定しないか指定したバンドがラスタ内に無い場合には、全てのバンドの使用を試みます。</li><li class="listitem"><a class="link" href="#RT_ST_Aspect" title="ST_Aspect">ST_Aspect</a> - 標高ラスタバンドの傾斜方向 (デフォルトの単位は度)を返します。地形解析に使えます。</li><li class="listitem"><a class="link" href="#RT_ST_Band" title="ST_Band">ST_Band</a> - 既存のラスタの、一つ以上のバンドを新しいラスタとして返します。既存のラスタから新しいラスタを構築する際に使えます。</li><li class="listitem"><a class="link" href="#RT_ST_BandFileSize" title="ST_BandFileSize">ST_BandFileSize</a> - ファイルシステムに格納されているバンドのファイルサイズを返します。バンド番号が指定されていない場合には、1番と仮定します。</li><li class="listitem"><a class="link" href="#RT_ST_BandFileTimestamp" title="ST_BandFileTimestamp">ST_BandFileTimestamp</a> - ファイルシステムに格納されているバンドのファイルタイムスタンプ返します。バンド番号が指定されていない場合には、1番と仮定します。</li><li class="listitem"><a class="link" href="#RT_ST_BandIsNoData" title="ST_BandIsNoData">ST_BandIsNoData</a> - 指定したバンドがNODATA値だけで満たされている場合には、TRUEを返します。</li><li class="listitem"><a class="link" href="#RT_ST_BandMetaData" title="ST_BandMetaData">ST_BandMetaData</a> - 指定したラスタバンドの基本的なメタデータを返します。バンド番号を指定しない場合には、1番と仮定します。</li><li class="listitem"><a class="link" href="#RT_ST_BandNoDataValue" title="ST_BandNoDataValue">ST_BandNoDataValue</a> - 指定されたバンドについてデータが無いことを表現する値を返します。バンド番号を指定しない場合には、1番と仮定します。</li><li class="listitem"><a class="link" href="#RT_ST_BandPath" title="ST_BandPath">ST_BandPath</a> - ファイルシステムに格納されているバンドのシステムファイルパスを返します。バンド番号が指定されていない場合には、1番と仮定します。</li><li class="listitem"><a class="link" href="#RT_ST_BandPixelType" title="ST_BandPixelType">ST_BandPixelType</a> - 指定したバンドのピクセルタイプを返します。バンド番号が指定されていない場合には、1番と仮定します。</li><li class="listitem"><a class="link" href="#RT_ST_Clip" title="ST_Clip">ST_Clip</a> - 入力ジオメトリで切り取ったラスタを返します。バンドが指定されていない場合には、全てのバンドが返されます。cropが指定されていない場合には、TRUEと仮定され、出力ラスタをクロップします。</li><li class="listitem"><a class="link" href="#RT_ST_ColorMap" title="ST_ColorMap">ST_ColorMap</a> - 元のラスタと指定したバンドから4個までの8BUIバンド (grayscale, RGB, RGBA)からなる新しいラスタを生成します。</li><li class="listitem"><a class="link" href="#RT_ST_Contains" title="ST_Contains">ST_Contains</a> - rastAの外にrastBの点が無く、rastAの内部にrastBの内部の点が一つ以上ある場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#RT_ST_ContainsProperly" title="ST_ContainsProperly">ST_ContainsProperly</a> - rastBがrastAの内部でインタセクトし、かつrastAの境界とも外部ともインタセクトしない場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#RT_ST_ConvexHull" title="ST_ConvexHull">ST_ConvexHull</a> - BandNoDataValueと等しいピクセル値を含むラスタの凸包ジオメトリを返します。一般的な形状でスキューのないラスタでは、ST_Envelopeと同じ結果になります。不規則な形状をしているか回転しているラスタでのみ使います。</li><li class="listitem"><a class="link" href="#RT_ST_Count" title="ST_Count">ST_Count</a> - ラスタまたはラスタカバレッジの指定したバンドのピクセル数を返します。バンドを指定しない場合には、1番と仮定します。exclude_nodata_valueをTRUEに設定している場合には、NODATA値と等しくないピクセルのみを数えます。</li><li class="listitem"><a class="link" href="#RT_ST_CountAgg" title="ST_CountAgg">ST_CountAgg</a> - 集約関数です。ラスタ集合の与えられたバンドのピクセル数を返します。バンドが指定されていない場合には、1番と仮定します。exclude_nodata_valueをTRUEに設定している場合には、NODATA値と等しくないピクセルのみを数えます。</li><li class="listitem"><a class="link" href="#RT_ST_CoveredBy" title="ST_CoveredBy">ST_CoveredBy</a> - rastAがrastBの外部に点を持たない場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#RT_ST_Covers" title="ST_Covers">ST_Covers</a> - rastBがrastAの外部に点を持たない場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#RT_ST_DFullyWithin" title="ST_DFullyWithin">ST_DFullyWithin</a> - rastAとrastBが指定した距離内に完全に収まる場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#RT_ST_DWithin" title="ST_DWithin">ST_DWithin</a> - rastAとrastBが指定した距離内にある場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#RT_ST_Disjoint" title="ST_Disjoint">ST_Disjoint</a> - rastAがrastBとインタセクトしない場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#RT_ST_DumpAsPolygons" title="ST_DumpAsPolygons">ST_DumpAsPolygons</a> - 指定されたラスタバンドからgeomval (geom,val)行の集合を返します。バンドを指定しない場合のデフォルトは1です。</li><li class="listitem"><a class="link" href="#RT_ST_DumpValues" title="ST_DumpValues">ST_DumpValues</a> - 指定したバンドの値を2次元で得ます。</li><li class="listitem"><a class="link" href="#RT_ST_Envelope" title="ST_Envelope">ST_Envelope</a> - ラスタの範囲のポリゴン表現を返します。</li><li class="listitem"><a class="link" href="#RT_ST_FromGDALRaster" title="ST_FromGDALRaster">ST_FromGDALRaster</a> - 対応するGDALラスタファイルからラスタを返します。</li><li class="listitem"><a class="link" href="#RT_ST_GeoReference" title="ST_GeoReference">ST_GeoReference</a> - GDAL書式または一般的にワールドファイルでみられるESRI書式の地理参照メタデータを返します。デフォルトはGDALです。</li><li class="listitem"><a class="link" href="#RT_ST_Grayscale" title="ST_Grayscale">ST_Grayscale</a> - 元のラスタと指定したバンドを赤、緑、青バンドとして一つの8BUIバンドを持つラスタを生成します。</li><li class="listitem"><a class="link" href="#RT_ST_HasNoBand" title="ST_HasNoBand">ST_HasNoBand</a> - 指定したバンド番号のバンドが無い場合には、TRUEを返します。バンド番号を指定していない場合には、1番と仮定します。</li><li class="listitem"><a class="link" href="#RT_ST_Height" title="ST_Height">ST_Height</a> - ラスタの高さをピクセル単位で返します。</li><li class="listitem"><a class="link" href="#RT_ST_HillShade" title="ST_HillShade">ST_HillShade</a> - 与えられた方位、高度、明度、スケールの入力を使って標高ラスタバンドの仮想照明を返します。</li><li class="listitem"><a class="link" href="#RT_ST_Histogram" title="ST_Histogram">ST_Histogram</a> - ラスタまたはラスタカバレッジのビン範囲で分割したデータ分布をまとめるヒストグラムの集合を返します。ビン数を指定しない場合には自動計算されます。</li><li class="listitem"><a class="link" href="#RT_ST_Intersection" title="ST_Intersection">ST_Intersection</a> - 二つのラスタの共有部分またはベクタ化したラスタとジオメトリとのインタセクトした部分を表現する、ラスタまたはジオメトリとピクセル値の組の集合を返します。</li><li class="listitem"><a class="link" href="#RT_ST_Intersects" title="ST_Intersects">ST_Intersects</a> - rastAがrastBとインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#RT_ST_IsEmpty" title="ST_IsEmpty">ST_IsEmpty</a> - ラスタが空 (幅が0で高さが0)の場合にはTRUEを返します。他の場合には、FALSEを返します。</li><li class="listitem"><a class="link" href="#RT_ST_MakeEmptyCoverage" title="ST_MakeEmptyCoverage">ST_MakeEmptyCoverage</a> - 空のラスタタイルのグリッドでジオリファレンスを施されている領域を生成します。</li><li class="listitem"><a class="link" href="#RT_ST_MakeEmptyRaster" title="ST_MakeEmptyRaster">ST_MakeEmptyRaster</a> - 与えられたピクセル範囲 (width &amp; height)、左上のX,Y、ピクセルサイズ、回転 (scalex, scaley, skewx, skewy)と空間参照系 (srid)が指定された空ラスタ (バンドを持たないラスタ)を返します。ラスタが渡されると、新しいラスタは渡されたラスタと同じサイズ、アラインメント、SRIDになります。SRIDが指定されていない場合には、空間参照系は不明 (0)とされます。</li><li class="listitem"><a class="link" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a> - コールバック関数版 - 一つ以上の入力ラスタ、バンドインデクスと一つのユーザ定義コールバック関数から、一つのバンドからなるラスタを返します。</li><li class="listitem"><a class="link" href="#RT_ST_MapAlgebraExpr" title="ST_MapAlgebraExpr">ST_MapAlgebraExpr</a> - 1バンド版: 入力バンドに対する妥当なPostgreSQL代数演算で形成された、指定したピクセルタイプとなる1バンドラスタを生成します。バンドを指定しない場合には、1番を仮定します。</li><li class="listitem"><a class="link" href="#RT_ST_MapAlgebraExpr2" title="ST_MapAlgebraExpr">ST_MapAlgebraExpr</a> - 2バンド版: 二つの入力バンドに対する妥当なPostgreSQL代数演算で形成された、指定したピクセルタイプとなる1バンドラスタを生成します。バンドを指定しない場合には、どちらも1番と仮定します。結果ラスタは、一つ目のラスタのアラインメント (スケール、スキュー、ピクセル角位置)にあわされます。範囲は"extenttype"引数で定義されます。取りうる"extenttype"の値はINTERSECTION, UNION, FIRST, SECONDです。</li><li class="listitem"><a class="link" href="#RT_ST_MapAlgebraFct" title="ST_MapAlgebraFct">ST_MapAlgebraFct</a> - 1バンド版 - 入力バンドに対する妥当なPostgreSQL関数で形成された、指定したピクセルタイプとなる1バンドラスタを生成します。バンドを指定しない場合には、1番と仮定します。</li><li class="listitem"><a class="link" href="#RT_ST_MapAlgebraFct2" title="ST_MapAlgebraFct">ST_MapAlgebraFct</a> - 2バンド版 - 二つの入力バンドに対する妥当なPostgreSQL関数で形成された、指定したピクセルタイプとなる1バンドラスタを生成します。バンドを指定しない場合には、1番と仮定します。"extenttype"のデフォルトはINTERSECTIONです。</li><li class="listitem"><a class="link" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a> - 1バンド版: ユーザ定義PostgreSQL関数を使用する最近傍地図代数関数です。入力ラスタバンドの近傍の値を与えたPL/pgSQLユーザ定義関数の結果からなるラスタを返します。</li><li class="listitem"><a class="link" href="#RT_ST_MapAlgebra_expr" title="ST_MapAlgebra (数式版)">ST_MapAlgebra (数式版)</a> - 数式版 - 一つか二つの入力ラスタ、バンド番号、一つ以上のユーザ定義SQL式から一つのバンドを持つラスタを返します。</li><li class="listitem"><a class="link" href="#RT_ST_MemSize" title="ST_MemSize">ST_MemSize</a> - ラスタが取る領域の合計をバイト単位で返します。</li><li class="listitem"><a class="link" href="#RT_ST_MetaData" title="ST_MetaData">ST_MetaData</a> - ピクセル数、回転 (スキュー)、左上隅位置等のラスタオブジェクトに関する基本的なメタデータを返します。</li><li class="listitem"><a class="link" href="#RT_ST_MinConvexHull" title="ST_MinConvexHull">ST_MinConvexHull</a> - NODATA値を除いたラスタの凸包ジオメトリを返します。</li><li class="listitem"><a class="link" href="#RT_ST_NearestValue" title="ST_NearestValue">ST_NearestValue</a> - 与えられたバンドの、columnxとrowyで指定されるか、またはラスタと同じ空間参照系で表現されたポイントで指定されたピクセルに最も近いNODATAでない値を返します。</li><li class="listitem"><a class="link" href="#RT_ST_Neighborhood" title="ST_Neighborhood">ST_Neighborhood</a> - 与えられたバンドのcolumnX, columnYか、ラスタと同じ空間参照系のジオメトリポイントで指定されたピクセルの周囲にある、NODATAでない2次元倍精度浮動小数点数配列を返します。</li><li class="listitem"><a class="link" href="#RT_ST_NotSameAlignmentReason" title="ST_NotSameAlignmentReason">ST_NotSameAlignmentReason</a> - ラスタが同じアラインメントを持つかどうか、また、持たない場合にはその理由を示す文字列を返します。</li><li class="listitem"><a class="link" href="#RT_ST_NumBands" title="ST_NumBands">ST_NumBands</a> - ラスタオブジェクトのバンド数を返します。</li><li class="listitem"><a class="link" href="#RT_ST_Overlaps" title="ST_Overlaps">ST_Overlaps</a> - rastAとrastBがインタセクトして、かつ一方がもう一方に完全には包含されない場合にはTRUEを返します。</li><li class="listitem"><a class="link" href="#RT_ST_PixelAsCentroid" title="ST_PixelAsCentroid">ST_PixelAsCentroid</a> - ピクセルで表現される面の重心 (ポイントジオメトリ)を返します。</li><li class="listitem"><a class="link" href="#RT_ST_PixelAsCentroids" title="ST_PixelAsCentroids">ST_PixelAsCentroids</a> - 全てのピクセルについて重心 (ポイントジオメト)リを、ピクセルごとのピクセル値とラスタ座標系のXとYとを付けて返します。ポイントジオメトリの座標はピクセルで表現される面の重心です。</li><li class="listitem"><a class="link" href="#RT_ST_PixelAsPoint" title="ST_PixelAsPoint">ST_PixelAsPoint</a> - ピクセルの左上隅のポイントジオメトリを返します。</li><li class="listitem"><a class="link" href="#RT_ST_PixelAsPoints" title="ST_PixelAsPoints">ST_PixelAsPoints</a> - 全てのピクセルについてポイントジオメトリを、ピクセルごとのピクセル値とラスタ座標系のXとYとを付けて返します。ポイントジオメトリの座標はピクセルの左上隅です。</li><li class="listitem"><a class="link" href="#RT_ST_PixelAsPolygon" title="ST_PixelAsPolygon">ST_PixelAsPolygon</a> - 指定した行と列のピクセルの境界となるジオメトリを返します。</li><li class="listitem"><a class="link" href="#RT_ST_PixelAsPolygons" title="ST_PixelAsPolygons">ST_PixelAsPolygons</a> - 全てのピクセルについて境界となるジオメトリを、ピクセルごとのピクセル値とラスタ座標系のXとYとを付けて返します。</li><li class="listitem"><a class="link" href="#RT_ST_PixelHeight" title="ST_PixelHeight">ST_PixelHeight</a> - 空間参照系の地理的な単位でのピクセルの高さを返します。</li><li class="listitem"><a class="link" href="#RT_ST_PixelOfValue" title="ST_PixelOfValue">ST_PixelOfValue</a> - 検索値と同じ値を持つピクセルのcolumnx, rowyピクセル座標を得ます。</li><li class="listitem"><a class="link" href="#RT_ST_PixelWidth" title="ST_PixelWidth">ST_PixelWidth</a> - 空間参照系の地理的な単位でのピクセルの幅を返します。</li><li class="listitem"><a class="link" href="#RT_ST_Polygon" title="ST_Polygon">ST_Polygon</a> - NODATA値でないピクセル値を持つピクセルの結合で形成されるマルチポリゴンジオメトリを返します。バンドを指定しない場合のデフォルトは1です。</li><li class="listitem"><a class="link" href="#RT_ST_Quantile" title="ST_Quantile">ST_Quantile</a> - ラスタまたはラスタテーブルカバレッジのサンプルまたは母集団の分位数を計算します。値がラスタの25%,50%,75%にあるかを調べることができます。</li><li class="listitem"><a class="link" href="#RT_ST_RastFromHexWKB" title="ST_RastFromHexWKB">ST_RastFromHexWKB</a> - Well-Knownバイナリ (WKB)ラスタの16進数表現からラスタを返します。</li><li class="listitem"><a class="link" href="#RT_ST_RastFromWKB" title="ST_RastFromWKB">ST_RastFromWKB</a> - Well-Known Binary (WKB)ラスタからラスタ値を返します。</li><li class="listitem"><a class="link" href="#RT_ST_RasterToWorldCoord" title="ST_RasterToWorldCoord">ST_RasterToWorldCoord</a> - ラスタの指定した列と行における左上隅の地理座標X値とY値 (経度と緯度)を返します。列と行の番号は1始まりです。</li><li class="listitem"><a class="link" href="#RT_ST_RasterToWorldCoordX" title="ST_RasterToWorldCoordX">ST_RasterToWorldCoordX</a> - ラスタの指定した列と行における左上隅の地理座標のX値を返します。列と行の番号は1始まりです。</li><li class="listitem"><a class="link" href="#RT_ST_RasterToWorldCoordY" title="ST_RasterToWorldCoordY">ST_RasterToWorldCoordY</a> - ラスタの指定した列と行における左上隅の地理座標のY値を返します。列と行の番号は1始まりです。</li><li class="listitem"><a class="link" href="#RT_ST_Reclass" title="ST_Reclass">ST_Reclass</a> - 元のラスタから再分類したバンドタイプからなるラスタを生成します。nbandは変更するバンドです。nbandが指定されていない場合には、1と仮定します。他の全てのバンドは変更せずに返します。可視画像の書式としてより単純な描画を行うために、16BUIバンドを8BUIバンドに変換する、等のために使います。</li><li class="listitem"><a class="link" href="#RT_ST_Resample" title="ST_Resample">ST_Resample</a> - 指定したリサンプリングアルゴリズム、新しいピクセル範囲、グリッドの隅、定義するか他のラスタから借りてきた地理参照属性を使ってリサンプリングを行います。</li><li class="listitem"><a class="link" href="#RT_ST_Rescale" title="ST_Rescale">ST_Rescale</a> - スケール (ピクセルサイズ)だけを調整するリサンプリングを行います。新しいピクセル値のリサンプリングアルゴリズムとして最近傍補間 ('NearestNeighbor' (米式綴り方))、双線形補間 ('Bilinear')、3次補間 ('Cubic')、3次スプライン補間 ('CubicSpline')、ランチョス補間 ('Lanczos')を用います。デフォルトは最近傍補間です。</li><li class="listitem"><a class="link" href="#RT_ST_Resize" title="ST_Resize">ST_Resize</a> - ラスタを新しい幅、高さにサイズ再設定を行います。</li><li class="listitem"><a class="link" href="#RT_ST_Reskew" title="ST_Reskew">ST_Reskew</a> - キュー (回転パラメタ)だけを調整するリサンプリングを行います。新しいピクセル値のリサンプリングアルゴリズムとして最近傍補間 ('NearestNeighbor' (米式綴り方))、双線形補間 ('Bilinear')、3次補間 ('Cubic')、3次スプライン補間 ('CubicSpline')、ランチョス補間 ('Lanczos')を用います。デフォルトは最近傍補間です。</li><li class="listitem"><a class="link" href="#RT_ST_Rotation" title="ST_Rotation">ST_Rotation</a> - ラスタの回転をラジアンで返します。</li><li class="listitem"><a class="link" href="#RT_ST_Roughness" title="ST_Roughness">ST_Roughness</a> - DEMの「粗度」を計算したラスタを返します。</li><li class="listitem"><a class="link" href="#RT_ST_SRID" title="ST_SRID">ST_SRID</a> - ラスタのspatial_ref_sysテーブルで定義されている空間参照系識別番号を返します。</li><li class="listitem"><a class="link" href="#RT_ST_SameAlignment" title="ST_SameAlignment">ST_SameAlignment</a> - ラスタが同じスキュー、スケール、空間参照系、オフセットを持つ (ピクセルが分割されることなく同じグリッドに置かれている)場合にTRUEを返し、そうでない場合は問題を詳述する通知とともにFALSEを返します。</li><li class="listitem"><a class="link" href="#RT_ST_ScaleX" title="ST_ScaleX">ST_ScaleX</a> - 空間参照系の地理的な単位でのピクセル幅のX成分を返します。</li><li class="listitem"><a class="link" href="#RT_ST_ScaleY" title="ST_ScaleY">ST_ScaleY</a> - 空間参照系の地理的な単位でのピクセル幅のY成分を返します。</li><li class="listitem"><a class="link" href="#RT_ST_SetBandIndex" title="ST_SetBandIndex">ST_SetBandIndex</a> - データベース外バンドの外部バンド番号の更新</li><li class="listitem"><a class="link" href="#RT_ST_SetBandIsNoData" title="ST_SetBandIsNoData">ST_SetBandIsNoData</a> - バンドのisnodataフラグをTRUEにします。</li><li class="listitem"><a class="link" href="#RT_ST_SetBandNoDataValue" title="ST_SetBandNoDataValue">ST_SetBandNoDataValue</a> - 指定したバンドにNODATAを表現する値を設定します。バンドを指定しない場合には、1番と仮定します。NODATA値を持たないようにするには、nodatavalueにNULLを指定します。</li><li class="listitem"><a class="link" href="#RT_ST_SetBandPath" title="ST_SetBandPath">ST_SetBandPath</a> - データベース外バンドの外部パスとバンド番号を更新します。</li><li class="listitem"><a class="link" href="#RT_ST_SetGeoReference" title="ST_SetGeoReference">ST_SetGeoReference</a> - 地理参照6パラメタを一度に設定します。数値は空白で区切ります。GDALまたはESRI書式の入力を受け付けます。デフォルトはGDALです。</li><li class="listitem"><a class="link" href="#RT_ST_SetRotation" title="ST_SetRotation">ST_SetRotation</a> - ラスタの回転をラジアン単位で設定します。</li><li class="listitem"><a class="link" href="#RT_ST_SetSRID" title="ST_SetSRID">ST_SetSRID</a> - スタのSRIDをspatial_ref_sysに定義されている特定の整数値に設定します。</li><li class="listitem"><a class="link" href="#RT_ST_SetScale" title="ST_SetScale">ST_SetScale</a> - ピクセルサイズのX値とY値を空間参照系の単位で設定します。数値は単位/ピクセルの幅または高さです。</li><li class="listitem"><a class="link" href="#RT_ST_SetSkew" title="ST_SetSkew">ST_SetSkew</a> - 地理参照のスキュー (回転パラメタ)のX値とY値を設定します。一つだけ渡した場合には、X値とY値は同じ値に設定されます。</li><li class="listitem"><a class="link" href="#RT_ST_SetUpperLeft" title="ST_SetUpperLeft">ST_SetUpperLeft</a> - ラスタの左上隅の投影座標系のX値とY値を設定します。</li><li class="listitem"><a class="link" href="#RT_ST_SetValue" title="ST_SetValue">ST_SetValue</a> - 与えられたバンドのcolumnX, columnYか、ラスタと同じ空間参照系のジオメトリポイントで指定されたピクセルの値または指定したジオメトリとインタセクトするピクセル群の値を設定することから得られる、変更されたラスタを返します。バンド番号は1始まりで、指定しない場合には、1番と仮定します。</li><li class="listitem"><a class="link" href="#RT_ST_SetValues" title="ST_SetValues">ST_SetValues</a> - 与えられたバンドに複数の値を設定して、変更されたラスタを返します。</li><li class="listitem"><a class="link" href="#RT_ST_SkewX" title="ST_SkewX">ST_SkewX</a> - 空間参照のXスキュー (回転パラメータ)を返します。</li><li class="listitem"><a class="link" href="#RT_ST_SkewY" title="ST_SkewY">ST_SkewY</a> - 空間参照のYスキュー (回転パラメータ)を返します。</li><li class="listitem"><a class="link" href="#RT_ST_Slope" title="ST_Slope">ST_Slope</a> - 標高ラスタバンドの傾斜角 (デフォルトでは度単位)を返します。地形解析に使えます。</li><li class="listitem"><a class="link" href="#RT_ST_SnapToGrid" title="ST_SnapToGrid">ST_SnapToGrid</a> - グリッドにスナップすることでラスタをリサンプリングします。新しいピクセル値のリサンプリングアルゴリズムとして最近傍補間 ('NearestNeighbor' (米式綴り方))、双線形補間 ('Bilinear')、3次補間 ('Cubic')、3次スプライン補間 ('CubicSpline')、ランチョス補間('Lanczos')を用います。デフォルトは最近傍補間です。</li><li class="listitem"><a class="link" href="#RT_ST_Summary" title="ST_Summary">ST_Summary</a> - ラスタの中身の概要が文字列で返されます。</li><li class="listitem"><a class="link" href="#RT_ST_SummaryStats" title="ST_SummaryStats">ST_SummaryStats</a> - ラスタまたはラスタカバレッジの指定したバンドについて、ピクセル数、合計値、平均値、標準偏差、最小値、最大値からなる統計情報の概要を返します。バンドを指定しない場合には、1番と仮定します。</li><li class="listitem"><a class="link" href="#RT_ST_SummaryStatsAgg" title="ST_SummaryStatsAgg">ST_SummaryStatsAgg</a> - 集約関数です。ラスタ集合の指定したバンドについて、ピクセル数、合計値、平均値、標準偏差、最小値、最大値からなる統計情報の概要を返します。バンドを指定しない場合には、1番と仮定します。</li><li class="listitem"><a class="link" href="#RT_ST_TPI" title="ST_TPI">ST_TPI</a> - 地形的位置指数を計算したラスタを返します。</li><li class="listitem"><a class="link" href="#RT_ST_TRI" title="ST_TRI">ST_TRI</a> - 起伏指標を計算したラスタを返します。</li><li class="listitem"><a class="link" href="#RT_ST_Tile" title="ST_Tile">ST_Tile</a> - 求められた出力ラスタのピクセル数に基づいて入力ラスタを分割した結果のラスタ集合を返します。</li><li class="listitem"><a class="link" href="#RT_ST_Touches" title="ST_Touches">ST_Touches</a> - rastAとrastBが少なくとも一つの共通の点を持ち、かつ二つのラスタの内部同士がインタセクトしない場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#RT_ST_Transform" title="ST_Transform">ST_Transform</a> - ラスタを既知の空間参照系から他の既知の空間参照系に、指定したリサンプリングアルゴリズムで投影変換します。新しいピクセル値のリサンプリングアルゴリズムとして最近傍補間 ('NearestNeighbor' (米式綴り方))、双線形補間 ('Bilinear')、3次補間 ('Cubic')、3次スプライン補間 ('CubicSpline')、ランチョス補間 ('Lanczos')を用います。デフォルトは最近傍補間です。</li><li class="listitem"><a class="link" href="#RT_ST_Union" title="ST_Union">ST_Union</a> - ラスタタイルの集合を結合して1以上のバンドからなる単一ラスタを返します。</li><li class="listitem"><a class="link" href="#RT_ST_UpperLeftX" title="ST_UpperLeftX">ST_UpperLeftX</a> - 適用されている空間参照系でのラスタの左上隅のX座標値を返します。</li><li class="listitem"><a class="link" href="#RT_ST_UpperLeftY" title="ST_UpperLeftY">ST_UpperLeftY</a> - 適用されている空間参照系でのラスタの左上隅のY座標値を返します。</li><li class="listitem"><a class="link" href="#RT_ST_Value" title="ST_Value">ST_Value</a> - 指定したバンドにおけるcolumnx, rowyで指定したピクセルまたは指定したジオメトリポイントに対応するピクセルの値を返します。 バンド番号は1始まりで、指定しない場合には、1番と仮定します。exclude_nodata_valueがFALSEに設定された場合には、NODATAピクセルを含む全てのピクセルがインタセクトするかが考慮され、値を返します。exclude_nodata_valueを渡さない場合には、ラスタのメタデータから読みます。</li><li class="listitem"><a class="link" href="#RT_ST_ValueCount" title="ST_ValueCount">ST_ValueCount</a> - ラスタ　(またはラスタカバレッジ)の指定されたバンドで、指定した値を持つピクセルを対象として、ピクセルバンド値とピクセル数からなるレコードの集合を返します。バンドを指定しない場合には、1番と仮定します。デフォルトではNODATA値のピクセルは数えられず、ピクセルの他の値は出力され、ピクセルバンド値は最も近い整数に丸められます。</li><li class="listitem"><a class="link" href="#RT_ST_Width" title="ST_Width">ST_Width</a> - ラスタの幅をピクセル単位で返します。</li><li class="listitem"><a class="link" href="#RT_ST_Within" title="ST_Within">ST_Within</a> - rastAがrastBの外部に点を持たず、rastAの内部の少なくとも一つの点がrastBの内部にある場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#RT_ST_WorldToRasterCoord" title="ST_WorldToRasterCoord">ST_WorldToRasterCoord</a> - ラスタの空間参照系による地理座標のX値とY値 (経度と緯度)またはポイントジオメトリに対応するピクセルの左上隅を返します。</li><li class="listitem"><a class="link" href="#RT_ST_WorldToRasterCoordX" title="ST_WorldToRasterCoordX">ST_WorldToRasterCoordX</a> - ラスタの空間参照系に基づくポイントジオメトリ (pt)またはX,Y座標値 (xw,yw)に対応するラスタの列を返します。</li><li class="listitem"><a class="link" href="#RT_ST_WorldToRasterCoordY" title="ST_WorldToRasterCoordY">ST_WorldToRasterCoordY</a> - ラスタの空間参照系に基づくポイントジオメトリ (pt)またはX,Y座標値 (xw,yw)に対応するラスタの行を返します。</li><li class="listitem"><a class="link" href="#RT_UpdateRasterSRID" title="UpdateRasterSRID">UpdateRasterSRID</a> - ユーザが指定したカラムとテーブルにあるラスタの全てについてSRIDを変更します。</li></ul></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="PostGIS_Geometry_DumpFunctions"></a>14.6. PostGISジオメトリ/ジオグラフィ/ラスタのダンプ関数</h2></div></div></div><p>次に示す関数は、<a class="link" href="#geometry_dump" title="geometry_dump">geometry_dump</a>または<a class="link" href="#geomval" title="geomval">geomval</a>データ型の集合または単一データを入力または出力に取るPostGIS関数です。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#RT_ST_DumpAsPolygons" title="ST_DumpAsPolygons">ST_DumpAsPolygons</a> - 指定されたラスタバンドからgeomval (geom,val)行の集合を返します。バンドを指定しない場合のデフォルトは1です。</li><li class="listitem"><a class="link" href="#RT_ST_Intersection" title="ST_Intersection">ST_Intersection</a> - 二つのラスタの共有部分またはベクタ化したラスタとジオメトリとのインタセクトした部分を表現する、ラスタまたはジオメトリとピクセル値の組の集合を返します。</li><li class="listitem"><a class="link" href="#ST_Dump" title="ST_Dump">ST_Dump</a> - ジオメトリg1から作られたgeometry_dump(geom, path)行の集合を返します。</li><li class="listitem"><a class="link" href="#ST_DumpPoints" title="ST_DumpPoints">ST_DumpPoints</a> - ジオメトリを作る全ての点のgometry_dump(geom,path)行の集合を返します。</li><li class="listitem"><a class="link" href="#ST_DumpRings" title="ST_DumpRings">ST_DumpRings</a> - ポリゴンの外環と内環を表すgeometry_dump行の集合を返します。</li></ul></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="PostGIS_BoxFunctions"></a>14.7. PostGISボックス関数</h2></div></div></div><p>次に示す関数は、PostGIS空間型のbox系の型を入力または出力に取るPostGIS関数です。ボックス系には<a class="link" href="#box2d_type" title="box2d">box2d</a>と<a class="link" href="#box3d_type" title="box3d">box3d</a>があります。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#Box2D" title="Box2D">Box2D</a> - ジオメトリの最大範囲を表すBOX2Dを返します。</li><li class="listitem"><a class="link" href="#Box3D" title="Box3D">Box3D</a> - ジオメトリの最大範囲を表すBOX3Dを返します。</li><li class="listitem"><a class="link" href="#RT_Box3D" title="Box3D">Box3D</a> - ラスタを囲むボックスのbox3d表現を返します。</li><li class="listitem"><a class="link" href="#ST_3DExtent" title="ST_3DExtent">ST_3DExtent</a> - ジオメトリのbox3Dバウンディングボックスを返す集約関数です。</li><li class="listitem"><a class="link" href="#ST_3DMakeBox" title="ST_3DMakeBox">ST_3DMakeBox</a> - 与えられた3次元ポイントジオメトリから定義されるBOX3Dを生成します。</li><li class="listitem"><a class="link" href="#ST_AsMVTGeom" title="ST_AsMVTGeom">ST_AsMVTGeom</a> - ジオメトリをMapbox Vector Tileの座標空間に変換します。</li><li class="listitem"><a class="link" href="#ST_AsTWKB" title="ST_AsTWKB">ST_AsTWKB</a> - TWKB (Tiny Well-Known Binary)としてジオメトリを出力します。</li><li class="listitem"><a class="link" href="#ST_Box2dFromGeoHash" title="ST_Box2dFromGeoHash">ST_Box2dFromGeoHash</a> - GeoHash文字列からBOX2Dを返します。</li><li class="listitem"><a class="link" href="#ST_ClipByBox2D" title="ST_ClipByBox2D">ST_ClipByBox2D</a> - 長方形内に落ちるジオメトリの一部を返します。</li><li class="listitem"><a class="link" href="#ST_EstimatedExtent" title="ST_EstimatedExtent">ST_EstimatedExtent</a> - 与えられた空間テーブルの「見積もられた」範囲を返します。ジオメトリカラムの統計情報から見積もります。指定されていない場合は現在のスキーマが使われます。</li><li class="listitem"><a class="link" href="#ST_Expand" title="ST_Expand">ST_Expand</a> - 入力ジオメトリのバウンディングボックスから全ての方向に拡張されたバウンディングボックスを返します。倍精度浮動小数点数を使います。</li><li class="listitem"><a class="link" href="#ST_Extent" title="ST_Extent">ST_Extent</a> - ジオメトリのバウンディングボックスを返す集約関数です。</li><li class="listitem"><a class="link" href="#ST_MakeBox2D" title="ST_MakeBox2D">ST_MakeBox2D</a> - 与えられたポイントジオメトリから定義されるBOX2Dを生成します。</li><li class="listitem"><a class="link" href="#ST_XMax" title="ST_XMax">ST_XMax</a> - 2次元、3次元バウンディングボックスまたはジオメトリにおけるXの最大値を返します。</li><li class="listitem"><a class="link" href="#ST_XMin" title="ST_XMin">ST_XMin</a> - 2次元、3次元バウンディングボックスまたはジオメトリにおけるXの最小値を返します。</li><li class="listitem"><a class="link" href="#ST_YMax" title="ST_YMax">ST_YMax</a> - 2次元、3次元バウンディングボックスまたはジオメトリにおけるYの最大値を返します。</li><li class="listitem"><a class="link" href="#ST_YMin" title="ST_YMin">ST_YMin</a> - 2次元、3次元バウンディングボックスまたはジオメトリにおけるYの最小値を返します。</li><li class="listitem"><a class="link" href="#ST_ZMax" title="ST_ZMax">ST_ZMax</a> - 2次元、3次元バウンディングボックスまたはジオメトリにおけるZの最大値を返します。</li><li class="listitem"><a class="link" href="#ST_ZMin" title="ST_ZMin">ST_ZMin</a> - 2次元、3次元バウンディングボックスまたはジオメトリにおけるZの最大値を返します。</li><li class="listitem"><a class="link" href="#contains_box2df_box2df" title="~(box2df,box2df)">~(box2df,box2df)</a> - 二つの単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)の一方がもう一方を包含する場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#contains_box2df_geometry" title="~(box2df,geometry)">~(box2df,geometry)</a> - 単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)をジオメトリの (キャッシュされている)2次元バウンディングボックスが包含する場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#contains_geometry_box2df" title="~(geometry,box2df)">~(geometry,box2df)</a> - ジオメトリの (キャッシュされている)2次元バウンディングボックスが単精度浮動小数点数によるn次元バウンディングボックス (GIDX)を包含する場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#is_contained_box2df_box2df" title="@(box2df,box2df)">@(box2df,box2df)</a> - 二つの単精度浮動小数点数によるn次元バウンディングボックス (GIDX)の一方がもう一方を包含する場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#is_contained_box2df_geometry" title="@(box2df,geometry)">@(box2df,geometry)</a> - 単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)がジオメトリの2次元バウンディングボックスに包含される場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#is_contained_geometry_box2df" title="@(geometry,box2df)">@(geometry,box2df)</a> - ジオメトリの2次元バウンディングボックスが単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)に包含される場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#overlaps_box2df_box2df" title="&amp;&amp;(box2df,box2df)">&amp;&amp;(box2df,box2df)</a> - 二つの単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)が相互にインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#overlaps_box2df_geometry" title="&amp;&amp;(box2df,geometry)">&amp;&amp;(box2df,geometry)</a> - 単精度浮動小数点数による2次元バウンディングボックスがジオメトリの (キャッシュされている)2次元バウンディングボックスとインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#overlaps_geometry_box2df" title="&amp;&amp;(geometry,box2df)">&amp;&amp;(geometry,box2df)</a> - ジオメトリの (キャッシュされている)2次元バウンディングボックスが単精度浮動小数点数による2次元バウンディングボックスとインタセクトする場合にTRUEを返します。</li></ul></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="PostGIS_3D_Functions"></a>14.8. 3次元対応PostGIS関数</h2></div></div></div><p>次に示す関数は、Zインデクスを放り出さないPostGIS関数です。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#AddGeometryColumn" title="AddGeometryColumn">AddGeometryColumn</a> - ジオメトリカラムを既存の属性テーブルに追加します。デフォルトでは、制約の定義でなく型の変更を使います。use_typmodにfalseを渡すと制約ベースの古い挙動で動作します。</li><li class="listitem"><a class="link" href="#Box3D" title="Box3D">Box3D</a> - ジオメトリの最大範囲を表すBOX3Dを返します。</li><li class="listitem"><a class="link" href="#DropGeometryColumn" title="DropGeometryColumn">DropGeometryColumn</a> - ジオメトリカラムを空間テーブルから除去します。</li><li class="listitem"><a class="link" href="#GeometryType" title="GeometryType">GeometryType</a> - ジオメトリ型を'LINESTRING', 'POLYGON', 'MULTIPOINT'などの文字列で返します。</li><li class="listitem"><a class="link" href="#ST_3DArea" title="ST_3DArea">ST_3DArea</a> - 3次元の面ジオメトリの面積を計算します。立体の場合は0を返します。</li><li class="listitem"><a class="link" href="#ST_3DClosestPoint" title="ST_3DClosestPoint">ST_3DClosestPoint</a> - g1上の、g2に最も近い3次元ポイントを返します。3次元最短線の一つ目のポイントです。</li><li class="listitem"><a class="link" href="#ST_3DDFullyWithin" title="ST_3DDFullyWithin">ST_3DDFullyWithin</a> - 3次元ジオメトリが他のジオメトリとの距離が指定した範囲内ならtrueを返します。</li><li class="listitem"><a class="link" href="#ST_3DDWithin" title="ST_3DDWithin">ST_3DDWithin</a> - 3次元 (XYZ)ジオメトリ型について、二つのジオメトリの3次元距離が指定した数の内にある場合にtrueを返します。</li><li class="listitem"><a class="link" href="#ST_3DDifference" title="ST_3DDifference">ST_3DDifference</a> - 3次元の差分を計算します。</li><li class="listitem"><a class="link" href="#ST_3DDistance" title="ST_3DDistance">ST_3DDistance</a> - ジオメトリ型について、二つのジオメトリの、3次元の最小デカルト距離 (空間参照系に基づきます)を、投影法の単位で返します。</li><li class="listitem"><a class="link" href="#ST_3DExtent" title="ST_3DExtent">ST_3DExtent</a> - ジオメトリのbox3Dバウンディングボックスを返す集約関数です。</li><li class="listitem"><a class="link" href="#ST_3DIntersection" title="ST_3DIntersection">ST_3DIntersection</a> - 3次元のインタセクトした (共有する)部分を計算します。</li><li class="listitem"><a class="link" href="#ST_3DIntersects" title="ST_3DIntersects">ST_3DIntersects</a> - ジオメトリが3次元で「空間的にインタセクトする」場合にTRUEを返します。ポイント、ラインストリング、ポリゴン、多面体サーフェス (面)のみ対応します。SFCGALバックエンドによってTINも対応します。</li><li class="listitem"><a class="link" href="#ST_3DLength" title="ST_3DLength">ST_3DLength</a> - LINESTRINGまたはMULTILINESTRINGに対して、ジオメトリの3次元長または2次元長を返します。</li><li class="listitem"><a class="link" href="#ST_3DLongestLine" title="ST_3DLongestLine">ST_3DLongestLine</a> - 二つのジオメトリの3次元長が最長となるラインを返します。</li><li class="listitem"><a class="link" href="#ST_3DMaxDistance" title="ST_3DMaxDistance">ST_3DMaxDistance</a> - ジオメトリ型について、二つのジオメトリの、3次元の最大デカルト距離 (空間参照系に基づきます)を、投影法の単位で返します。</li><li class="listitem"><a class="link" href="#ST_3DPerimeter" title="ST_3DPerimeter">ST_3DPerimeter</a> - POLYGONまたはMULTIPOLYGONジオメトリの場合には、3次元周囲長を返します。</li><li class="listitem"><a class="link" href="#ST_3DShortestLine" title="ST_3DShortestLine">ST_3DShortestLine</a> - 二つのジオメトリの3次元長が最短となるラインを返します。</li><li class="listitem"><a class="link" href="#ST_3DUnion" title="ST_3DUnion">ST_3DUnion</a> - 3次元の結合を計算します。</li><li class="listitem"><a class="link" href="#ST_Accum" title="ST_Accum">ST_Accum</a> - 集約関数です。ジオメトリの配列を生成します。</li><li class="listitem"><a class="link" href="#ST_AddMeasure" title="ST_AddMeasure">ST_AddMeasure</a> - 始点と終点の間を線型補完した、M値を持つ派生ジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_AddPoint" title="ST_AddPoint">ST_AddPoint</a> - ラインストリングにポイントを追加します。</li><li class="listitem"><a class="link" href="#ST_Affine" title="ST_Affine">ST_Affine</a> - 3次元アフィン変換をジオメトリに適用します。</li><li class="listitem"><a class="link" href="#ST_ApproximateMedialAxis" title="ST_ApproximateMedialAxis">ST_ApproximateMedialAxis</a> - 面ジオメトリの近似的な中心軸を計算します。</li><li class="listitem"><a class="link" href="#ST_AsBinary" title="ST_AsBinary">ST_AsBinary</a> - ジオメトリ/ジオグラフィのSRIDメタデータのないWell-Known Binary (WKB)表現を返します。</li><li class="listitem"><a class="link" href="#ST_AsEWKB" title="ST_AsEWKB">ST_AsEWKB</a> - ジオメトリのSRIDメタデータが付いたWell-Known Binary (WKB)表現を返します。</li><li class="listitem"><a class="link" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a> - ジオメトリのSRIDメタデータが付いたWell-Known Text (WKT)表現を返します。</li><li class="listitem"><a class="link" href="#ST_AsGML" title="ST_AsGML">ST_AsGML</a> - GML第2版または第3版としてジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_AsGeoJSON" title="ST_AsGeoJSON">ST_AsGeoJSON</a> - GeoJSON要素としてジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_AsHEXEWKB" title="ST_AsHEXEWKB">ST_AsHEXEWKB</a> - ジオメトリのHEXEWKB表現を (文字列として)返します。リトルエンディアン (NDR)またはビッグエンディアン (XDR)のどちらかのエンコーディングを使います。</li><li class="listitem"><a class="link" href="#ST_AsKML" title="ST_AsKML">ST_AsKML</a> - ジオメトリをKML要素で返します。いくつかの形式があります。デフォルトはversion=2, maxdecimaldigits=15です。</li><li class="listitem"><a class="link" href="#ST_AsX3D" title="ST_AsX3D">ST_AsX3D</a> - ジオメトリをX3Dノード要素書式　(ISO-IEC-19776-1.2-X3DEncodings-XML)で返します。</li><li class="listitem"><a class="link" href="#ST_Boundary" title="ST_Boundary">ST_Boundary</a> - ジオメトリの組み合わせ境界の閉包を返します。</li><li class="listitem"><a class="link" href="#ST_BoundingDiagonal" title="ST_BoundingDiagonal">ST_BoundingDiagonal</a> - 与えられたジオメトリのバウンディングボックスの対角線を返します。</li><li class="listitem"><a class="link" href="#ST_CPAWithin" title="ST_CPAWithin">ST_CPAWithin</a> - トラジェクトリの最接近点が空間的な距離内にある場合にはTRUEを返します。</li><li class="listitem"><a class="link" href="#ST_ClosestPointOfApproach" title="ST_ClosestPointOfApproach">ST_ClosestPointOfApproach</a> - 二つのラインの最も近くなる内挿補間点のM値を返します。</li><li class="listitem"><a class="link" href="#ST_Collect" title="ST_Collect">ST_Collect</a> - 他のジオメトリのコレクションから、指定したST_Geometry値を返します。</li><li class="listitem"><a class="link" href="#ST_ConvexHull" title="ST_ConvexHull">ST_ConvexHull</a> - 凸包は与えられた集合の全てのジオメトリを含む最小の閉じた凸ジオメトリです。</li><li class="listitem"><a class="link" href="#ST_CoordDim" title="ST_CoordDim">ST_CoordDim</a> - ST_Geometry値の座標次元を返します。</li><li class="listitem"><a class="link" href="#ST_CurveToLine" title="ST_CurveToLine">ST_CurveToLine</a> - CIRCULARSTRING/CURVEPOLYGONをLINESTRING/POLYGONに変換します。</li><li class="listitem"><a class="link" href="#ST_DelaunayTriangles" title="ST_DelaunayTriangles">ST_DelaunayTriangles</a> - 与えられたポイントの周りのドロネー三角形を返します。</li><li class="listitem"><a class="link" href="#ST_Difference" title="ST_Difference">ST_Difference</a> - ジオメトリBにインタセクトしないジオメトリAの部分を表現するジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_DistanceCPA" title="ST_DistanceCPA">ST_DistanceCPA</a> - 二つのトラジェクトリの最接近時の距離を返します。</li><li class="listitem"><a class="link" href="#ST_Dump" title="ST_Dump">ST_Dump</a> - ジオメトリg1から作られたgeometry_dump(geom, path)行の集合を返します。</li><li class="listitem"><a class="link" href="#ST_DumpPoints" title="ST_DumpPoints">ST_DumpPoints</a> - ジオメトリを作る全ての点のgometry_dump(geom,path)行の集合を返します。</li><li class="listitem"><a class="link" href="#ST_DumpRings" title="ST_DumpRings">ST_DumpRings</a> - ポリゴンの外環と内環を表すgeometry_dump行の集合を返します。</li><li class="listitem"><a class="link" href="#ST_EndPoint" title="ST_EndPoint">ST_EndPoint</a> - LINESTRINGの最後のポイントをPOINTで返します。</li><li class="listitem"><a class="link" href="#ST_ExteriorRing" title="ST_ExteriorRing">ST_ExteriorRing</a> - POLYGONの外環を表現するラインストリングを返します。ジオメトリがポリゴンでない場合はNULLを返します。マルチポリゴンでは動作しません。</li><li class="listitem"><a class="link" href="#ST_Extrude" title="ST_Extrude">ST_Extrude</a> - 関連するボリュームにサーフェスを押し出します。</li><li class="listitem"><a class="link" href="#ST_FlipCoordinates" title="ST_FlipCoordinates">ST_FlipCoordinates</a> - 与えられたジオメトリのX軸とY軸とを入れ替えたものを返します。緯度/経度のフィーチャーを構築して、これを訂正したい場合に使えます。</li><li class="listitem"><a class="link" href="#ST_Force2D" title="ST_Force2D">ST_Force2D</a> - ジオメトリを2次元モードに強制します。</li><li class="listitem"><a class="link" href="#ST_ForceCurve" title="ST_ForceCurve">ST_ForceCurve</a> - 該当する場合は、ジオメトリを曲線タイプに変換します。</li><li class="listitem"><a class="link" href="#ST_ForceLHR" title="ST_ForceLHR">ST_ForceLHR</a> - LHR (Left Hand Rule)方向に強制します。</li><li class="listitem"><a class="link" href="#ST_ForcePolygonCCW" title="ST_ForcePolygonCCW">ST_ForcePolygonCCW</a> - 全ての外環を反時計回りに、全ての内環を時計回りに、それぞれ強制します。</li><li class="listitem"><a class="link" href="#ST_ForcePolygonCW" title="ST_ForcePolygonCW">ST_ForcePolygonCW</a> - 全ての外環を時計回りに、全ての内環を反時計回りに、それぞれ強制します。</li><li class="listitem"><a class="link" href="#ST_ForceRHR" title="ST_ForceRHR">ST_ForceRHR</a> - ポリゴンの頂点の方向を右回りに強制します。</li><li class="listitem"><a class="link" href="#ST_ForceSFS" title="ST_ForceSFS">ST_ForceSFS</a> - SFS 1.1ジオメトリタイプのみ使うようジオメトリに強制します。</li><li class="listitem"><a class="link" href="#ST_Force_3D" title="ST_Force3D">ST_Force_3D</a> - ジオメトリをXYZモードに強制します。これはST_Force3DZの別名です。</li><li class="listitem"><a class="link" href="#ST_Force_3DZ" title="ST_Force3DZ">ST_Force_3DZ</a> - ジオメトリをXYZモードに強制します。</li><li class="listitem"><a class="link" href="#ST_Force_4D" title="ST_Force4D">ST_Force_4D</a> - ジオメトリをXYZMモードに強制します。</li><li class="listitem"><a class="link" href="#ST_Force_Collection" title="ST_ForceCollection">ST_Force_Collection</a> - ジオメトリをジオメトリコレクションに変換します。</li><li class="listitem"><a class="link" href="#ST_GeomFromEWKB" title="ST_GeomFromEWKB">ST_GeomFromEWKB</a> - 拡張Well-Known Binary表現 (EWKB)から指定したST_Geometry値を返します。</li><li class="listitem"><a class="link" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a> - 拡張Well-Known Text表現 (EWKT)から指定されたST_Geometry値を返します。</li><li class="listitem"><a class="link" href="#ST_GeomFromGML" title="ST_GeomFromGML">ST_GeomFromGML</a> - GML表現からPostGISジオメトリオブジェクトを出力します。</li><li class="listitem"><a class="link" href="#ST_GeomFromGeoJSON" title="ST_GeomFromGeoJSON">ST_GeomFromGeoJSON</a> - ジオメトリのGeoJSON表現を入力として、PostGISジオメトリオブジェクトを出力します。</li><li class="listitem"><a class="link" href="#ST_GeomFromKML" title="ST_GeomFromKML">ST_GeomFromKML</a> - ジオメトリのKML表現の入力をとり、PostGISジオメトリオブジェクトを出力します。</li><li class="listitem"><a class="link" href="#ST_GeometricMedian" title="ST_GeometricMedian">ST_GeometricMedian</a> - マルチポイントの幾何学的中央値を返します。</li><li class="listitem"><a class="link" href="#ST_GeometryN" title="ST_GeometryN">ST_GeometryN</a> - GEOMETRYCOLLECTION, (MULTI)POINT, (MULTI)LINESTRING, MULTICURVE, (MULTI)POLYGON, POLYHEDRALSURFACEの場合には、1始まりでN番目のジオメトリを返します。それ以外の場合にはNULLを返します。</li><li class="listitem"><a class="link" href="#ST_GeometryType" title="ST_GeometryType">ST_GeometryType</a> - ST_Geometry値のジオメトリ型を返します。</li><li class="listitem"><a class="link" href="#ST_HasArc" title="ST_HasArc">ST_HasArc</a> - ジオメトリまたはジオメトリコレクションが曲線ストリングを含む場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#ST_InteriorRingN" title="ST_InteriorRingN">ST_InteriorRingN</a> - ポリゴンのN番目の内環を返します。ジオメトリがポリゴンでないかNが範囲外の場合はNULLを返します。</li><li class="listitem"><a class="link" href="#ST_InterpolatePoint" title="ST_InterpolatePoint">ST_InterpolatePoint</a> - ジオメトリの、指定したポイントに近いポイントにおけるM値を返します。</li><li class="listitem"><a class="link" href="#ST_IsClosed" title="ST_IsClosed">ST_IsClosed</a> - LINESTRINGの始点と終点が一致する場合にTRUEを返します。多面体サーフェスの場合は閉じているかどうか (ボリュームであるかどうか)を返します。</li><li class="listitem"><a class="link" href="#ST_IsCollection" title="ST_IsCollection">ST_IsCollection</a> - 引数がコレクション(MULTI*, GEOMETRYCOLLECTION, ...)の場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#ST_IsPlanar" title="ST_IsPlanar">ST_IsPlanar</a> - サーフェスが平面であるかないかをチェックします。</li><li class="listitem"><a class="link" href="#ST_IsPolygonCCW" title="ST_IsPolygonCCW">ST_IsPolygonCCW</a> - 全ての外環が反時計回りで、全ての内環が時計回りならTRUEを返します。</li><li class="listitem"><a class="link" href="#ST_IsPolygonCW" title="ST_IsPolygonCW">ST_IsPolygonCW</a> - 入力ジオメトリの全てのポリゴン要素の外環については時計回りで、全ての内環については反時計回りである場合には、TRUEを返します。</li><li class="listitem"><a class="link" href="#ST_IsSimple" title="ST_IsSimple">ST_IsSimple</a> - ジオメトリが自己インタセクションや自己接触のような異常な幾何学ポイントを持っていない場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#ST_IsSolid" title="ST_IsSolid">ST_IsSolid</a> - ジオメトリが立体であるかどうかをテストします。妥当性チェックは行いません。</li><li class="listitem"><a class="link" href="#ST_IsValidTrajectory" title="ST_IsValidTrajectory">ST_IsValidTrajectory</a> - ジオメトリが妥当なトラジェクトリの場合にはtrueを返します。</li><li class="listitem"><a class="link" href="#ST_Length_Spheroid" title="ST_LengthSpheroid">ST_Length_Spheroid</a> - 回転楕円体上のジオメトリの2次元長/周囲長または3次元長/周囲長を計算します。これは、ジオメトリの座標が経度/緯度になっていて、投影変換を行わずに距離を求めたい場合に使います。</li><li class="listitem"><a class="link" href="#ST_LineFromMultiPoint" title="ST_LineFromMultiPoint">ST_LineFromMultiPoint</a> - マルチポイントジオメトリからラインストリングを生成します。</li><li class="listitem"><a class="link" href="#ST_LineInterpolatePoint" title="ST_LineInterpolatePoint">ST_LineInterpolatePoint</a> - 線に沿った内挿点を返します。第2引数はfloat8で0から1の区間で、そのポイントが位置するラインストリングの総延長についての割合です。</li><li class="listitem"><a class="link" href="#ST_LineInterpolatePoints" title="ST_LineInterpolatePoints">ST_LineInterpolatePoints</a> - 線に沿った内挿点を一つ以上返します。</li><li class="listitem"><a class="link" href="#ST_LineSubstring" title="ST_LineSubstring">ST_LineSubstring</a> - 次元長に対する割合で示された開始位置と終了位置で切り取られた部分ラインストリングを返します。第2引数と第3引数は、float8で0から1の区間です。</li><li class="listitem"><a class="link" href="#ST_LineToCurve" title="ST_LineToCurve">ST_LineToCurve</a> - LINESTRING/POLYGONをCIRCULARSTRINGかCURVEPOLYGONに変換します。</li><li class="listitem"><a class="link" href="#ST_LocateBetweenElevations" title="ST_LocateBetweenElevations">ST_LocateBetweenElevations</a> - 指定したZ値の範囲内にある要素からなる、派生ジオメトリ (コレクション)値を返します。3次元、4次元のLINESTRINGSとMULTILINESTRINGSのみに対応しています。</li><li class="listitem"><a class="link" href="#ST_M" title="ST_M">ST_M</a> - ポイントのM座標値を返し、有効でないならNULLを返します。入力はポイントでなければなりません。</li><li class="listitem"><a class="link" href="#ST_MakeLine" title="ST_MakeLine">ST_MakeLine</a> - ポイント、マルチポイント、ラインジオメトリからラインストリングを生成します。</li><li class="listitem"><a class="link" href="#ST_MakePoint" title="ST_MakePoint">ST_MakePoint</a> - 2次元、XYZの3次元または4次元のポイントジオメトリを生成します。</li><li class="listitem"><a class="link" href="#ST_MakePolygon" title="ST_MakePolygon">ST_MakePolygon</a> - 与えられた外環で形成されるポリゴンを生成します。入力ジオメトリは閉じたラインストリングでなければなりません。</li><li class="listitem"><a class="link" href="#ST_MakeSolid" title="ST_MakeSolid">ST_MakeSolid</a> - ジオメトリを立体にキャストします。チェックはしません。妥当な立体を得るには、入力ジオメトリは閉じた多面体サーフェスか閉じたTINでなければなりません。</li><li class="listitem"><a class="link" href="#ST_MakeValid" title="ST_MakeValid">ST_MakeValid</a> - 頂点を失うことなしに不正なジオメトリを妥当なジオメトリにしようと試みます。</li><li class="listitem"><a class="link" href="#ST_MemSize" title="ST_MemSize">ST_MemSize</a> - ジオメトリが取る容量 (バイト単位)を返します。</li><li class="listitem"><a class="link" href="#ST_MemUnion" title="ST_MemUnion">ST_MemUnion</a> - ST_Unionと同じですが、メモリフレンドリ (少ないメモリ使用、多いCPU時間)です。</li><li class="listitem"><a class="link" href="#ST_NDims" title="ST_NDims">ST_NDims</a> - ジオメトリの座標次元をsmall intで返します。値は2, 3, 4のいずれかです。</li><li class="listitem"><a class="link" href="#ST_NPoints" title="ST_NPoints">ST_NPoints</a> - ジオメトリのポイント (頂点)数を返します。</li><li class="listitem"><a class="link" href="#ST_NRings" title="ST_NRings">ST_NRings</a> - ジオメトリがポリゴンまたはマルチポリゴンの場合、リング数を返します。</li><li class="listitem"><a class="link" href="#ST_Node" title="ST_Node">ST_Node</a> - ラインストリングの集合にノードを作成します。</li><li class="listitem"><a class="link" href="#ST_NumGeometries" title="ST_NumGeometries">ST_NumGeometries</a> - ジオメトリがジオメトリコレクションまたはマルチ系の場合はジオメトリの数を、単一のジオメトリの場合は1を返し、それ以外の場合はNULLを返します。</li><li class="listitem"><a class="link" href="#ST_NumPatches" title="ST_NumPatches">ST_NumPatches</a> - 多面体サーフェスのフェイス数を返します。多面体でないジオメトリの場合にはNULLを返します。</li><li class="listitem"><a class="link" href="#ST_Orientation" title="ST_Orientation">ST_Orientation</a> - サーフェスの方向を判定します。</li><li class="listitem"><a class="link" href="#ST_PatchN" title="ST_PatchN">ST_PatchN</a> - ジオメトリがPOLYHEDRALSURFACEかPOLYHEDRALSURFACEMの場合には、1始まりでN番目のジオメトリ (フェイス)を返します。それ以外の場合には、NULLを返します。</li><li class="listitem"><a class="link" href="#ST_PointFromWKB" title="ST_PointFromWKB">ST_PointFromWKB</a> - WKBと与えられたSRIDからジオメトリを生成します。</li><li class="listitem"><a class="link" href="#ST_PointN" title="ST_PointN">ST_PointN</a> - ラインストリングまたは曲線ストリングのN番目の点を返します。負数はラインストリングの終端から逆方向に遡って数えます。ジオメトリにラインストリングが無い場合には、NULLを返します。</li><li class="listitem"><a class="link" href="#ST_PointOnSurface" title="ST_PointOnSurface">ST_PointOnSurface</a> - サーフェス上にあることを保障されたPOINTを返します。</li><li class="listitem"><a class="link" href="#ST_Points" title="ST_Points">ST_Points</a> - ジオメトリの全ての座標値からなるマルチポイントを返します。</li><li class="listitem"><a class="link" href="#ST_Polygon" title="ST_Polygon">ST_Polygon</a> - 指定されたラインストリングとSRIDからポリゴンを生成します。</li><li class="listitem"><a class="link" href="#ST_RemovePoint" title="ST_RemovePoint">ST_RemovePoint</a> - ラインストリングからポイントを削除します。</li><li class="listitem"><a class="link" href="#ST_RemoveRepeatedPoints" title="ST_RemoveRepeatedPoints">ST_RemoveRepeatedPoints</a> - 入力ジオメトリから重複ポイントを除いたものを返します。</li><li class="listitem"><a class="link" href="#ST_Reverse" title="ST_Reverse">ST_Reverse</a> - 頂点の順序を逆にしたジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_Rotate" title="ST_Rotate">ST_Rotate</a> - ジオメトリを、原点について反時計回りにrotRadiasnぶん回転させます。</li><li class="listitem"><a class="link" href="#ST_RotateX" title="ST_RotateX">ST_RotateX</a> - ジオメトリをX軸についてrotRadiansぶん回転させます。</li><li class="listitem"><a class="link" href="#ST_RotateY" title="ST_RotateY">ST_RotateY</a> - ジオメトリgeomAをY軸についてrotRadiansぶん回転させます。</li><li class="listitem"><a class="link" href="#ST_RotateZ" title="ST_RotateZ">ST_RotateZ</a> - ジオメトリをZ軸についてrotRadiansぶん回転させます。</li><li class="listitem"><a class="link" href="#ST_Scale" title="ST_Scale">ST_Scale</a> - 与えた係数でジオメトリを拡大縮小します。</li><li class="listitem"><a class="link" href="#ST_SetPoint" title="ST_SetPoint">ST_SetPoint</a> - ラインストリングのポイントを与えられたポイントに置き換えます。</li><li class="listitem"><a class="link" href="#ST_Shift_Longitude" title="ST_ShiftLongitude">ST_Shift_Longitude</a> - ジオメトリの座標値を-180度から180度の範囲と0度から360度の範囲に揃えます。</li><li class="listitem"><a class="link" href="#ST_SnapToGrid" title="ST_SnapToGrid">ST_SnapToGrid</a> - 入力ジオメトリの全ての点を規則的なグリッドにスナップします。</li><li class="listitem"><a class="link" href="#ST_StartPoint" title="ST_StartPoint">ST_StartPoint</a> - LINESTRINGの最初のポイントをPOINTとして返します。</li><li class="listitem"><a class="link" href="#ST_StraightSkeleton" title="ST_StraightSkeleton">ST_StraightSkeleton</a> - ジオメトリからストレートスケルトンを計算します。</li><li class="listitem"><a class="link" href="#ST_SwapOrdinates" title="ST_SwapOrdinates">ST_SwapOrdinates</a> - 与えられたジオメトリにおいて与えられた座標の値を入れ替えたジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_SymDifference" title="ST_SymDifference">ST_SymDifference</a> - AとBの、インタセクトしていない部分を表現するジオメトリを返します。対称と呼ばれるのは、ST_SymDifference(A,B) = ST_SymDifference(B,A) となるからです。</li><li class="listitem"><a class="link" href="#ST_Tesselate" title="ST_Tesselate">ST_Tesselate</a> - ポリゴンまたは多面体サーフェスのテッセレーションを計算し、TINまたはTINコレクションを返します。</li><li class="listitem"><a class="link" href="#ST_TransScale" title="ST_TransScale">ST_TransScale</a> - 与えられた係数とオフセットでジオメトリを変換します。</li><li class="listitem"><a class="link" href="#ST_Translate" title="ST_Translate">ST_Translate</a> - 与えられたオフセットでジオメトリを変換します。</li><li class="listitem"><a class="link" href="#ST_UnaryUnion" title="ST_UnaryUnion">ST_UnaryUnion</a> - ST_Unionに似ていますが、ジオメトリ要素レベルで動作します。</li><li class="listitem"><a class="link" href="#ST_Volume" title="ST_Volume">ST_Volume</a> - 3次元立体の体積を計算します。面ジオメトリは (閉じていても)0を返します。</li><li class="listitem"><a class="link" href="#ST_WrapX" title="ST_WrapX">ST_WrapX</a> - ジオメトリをX値で回り込ませます。</li><li class="listitem"><a class="link" href="#ST_X" title="ST_X">ST_X</a> - ポイントのX座標値を返し、有効でないならNULLを返します。入力はポイントでなければなりません。</li><li class="listitem"><a class="link" href="#ST_XMax" title="ST_XMax">ST_XMax</a> - 2次元、3次元バウンディングボックスまたはジオメトリにおけるXの最大値を返します。</li><li class="listitem"><a class="link" href="#ST_XMin" title="ST_XMin">ST_XMin</a> - 2次元、3次元バウンディングボックスまたはジオメトリにおけるXの最小値を返します。</li><li class="listitem"><a class="link" href="#ST_Y" title="ST_Y">ST_Y</a> - ポイントのY座標値を返し、有効でないならNULLを返します。入力はポイントでなければなりません。</li><li class="listitem"><a class="link" href="#ST_YMax" title="ST_YMax">ST_YMax</a> - 2次元、3次元バウンディングボックスまたはジオメトリにおけるYの最大値を返します。</li><li class="listitem"><a class="link" href="#ST_YMin" title="ST_YMin">ST_YMin</a> - 2次元、3次元バウンディングボックスまたはジオメトリにおけるYの最小値を返します。</li><li class="listitem"><a class="link" href="#ST_Z" title="ST_Z">ST_Z</a> - ポイントのZ座標値を返し、有効でないならNULLを返します。入力はポイントでなければなりません。</li><li class="listitem"><a class="link" href="#ST_ZMax" title="ST_ZMax">ST_ZMax</a> - 2次元、3次元バウンディングボックスまたはジオメトリにおけるZの最大値を返します。</li><li class="listitem"><a class="link" href="#ST_ZMin" title="ST_ZMin">ST_ZMin</a> - 2次元、3次元バウンディングボックスまたはジオメトリにおけるZの最大値を返します。</li><li class="listitem"><a class="link" href="#ST_Zmflag" title="ST_Zmflag">ST_Zmflag</a> - ポイントのZM (次元の意味)フラグをsmall intで返します。値は 0=XY, 1=XYM, 2=XYZ, 3=XYZMとなります。</li><li class="listitem"><a class="link" href="#TG_Equals" title="Equals">TG_Equals</a> - 二つのTopoGeometryが同じトポロジプリミティブで成っている場合にtrueを返します。</li><li class="listitem"><a class="link" href="#TG_Intersects" title="Intersects">TG_Intersects</a> - 二つのTopoGeometryからのプリミティブの組がインタセクトする場合にtrueを返します。</li><li class="listitem"><a class="link" href="#UpdateGeometrySRID" title="UpdateGeometrySRID">UpdateGeometrySRID</a> - ジオメトリカラムの全てのフィーチャーのSRID、geometry_columnsメタデータとSRIDテーブル制約を更新します。制約付きの場合には、制約が新しいSRID制約に更新されます。型定義付きの場合は、型定義が変更されます。</li><li class="listitem"><a class="link" href="#geometry_overlaps_nd" title="&amp;&amp;&amp;">geometry_overlaps_nd</a> - Aのn次元バウンディングボックスがBのn次元バウンディングボックスとインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#overlaps_nd_geometry_gidx" title="&amp;&amp;&amp;(geometry,gidx)">overlaps_nd_geometry_gidx</a> - ジオメトリの (キャッシュされている)n次元バウンディングボックスが単精度浮動小数点数によるn次元バウンディングボックス (GIDX)とインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#overlaps_nd_gidx_geometry" title="&amp;&amp;&amp;(gidx,geometry)">overlaps_nd_gidx_geometry</a> - 単精度浮動小数点数によるn次元バウンディングボックス (GIDX)がジオメトリの (キャッシュされている)n次元バウンディングボックスとインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#overlaps_nd_gidx_gidx" title="&amp;&amp;&amp;(gidx,gidx)">overlaps_nd_gidx_gidx</a> - 二つの単精度浮動小数点数によるn次元バウンディングボックス (GIDX)が相互にインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#postgis_sfcgal_version" title="postgis_sfcgal_version">postgis_sfcgal_version</a> - 使用しているSFCGALの版を返します</li></ul></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="PostGIS_Curved_GeometryFunctions"></a>14.9. PostGIS曲線ジオメトリ対応関数</h2></div></div></div><p>次に示す関数は、CIRCULARSTRING, CURVEDPOLYGON等の曲線ジオメトリ型が使えるPostGIS関数です。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#AddGeometryColumn" title="AddGeometryColumn">AddGeometryColumn</a> - ジオメトリカラムを既存の属性テーブルに追加します。デフォルトでは、制約の定義でなく型の変更を使います。use_typmodにfalseを渡すと制約ベースの古い挙動で動作します。</li><li class="listitem"><a class="link" href="#Box2D" title="Box2D">Box2D</a> - ジオメトリの最大範囲を表すBOX2Dを返します。</li><li class="listitem"><a class="link" href="#Box3D" title="Box3D">Box3D</a> - ジオメトリの最大範囲を表すBOX3Dを返します。</li><li class="listitem"><a class="link" href="#DropGeometryColumn" title="DropGeometryColumn">DropGeometryColumn</a> - ジオメトリカラムを空間テーブルから除去します。</li><li class="listitem"><a class="link" href="#GeometryType" title="GeometryType">GeometryType</a> - ジオメトリ型を'LINESTRING', 'POLYGON', 'MULTIPOINT'などの文字列で返します。</li><li class="listitem"><a class="link" href="#PostGIS_AddBBox" title="PostGIS_AddBBox">PostGIS_AddBBox</a> - ジオメトリにバウンディングボックスを追加します。</li><li class="listitem"><a class="link" href="#PostGIS_DropBBox" title="PostGIS_DropBBox">PostGIS_DropBBox</a> - ジオメトリからバウンディングボックスのキャッシュを削除します。</li><li class="listitem"><a class="link" href="#PostGIS_HasBBox" title="PostGIS_HasBBox">PostGIS_HasBBox</a> - ジオメトリのバウンディングボックスがキャッシュされている場合にはTRUEを返し、他の場合にはFALSEを返します。</li><li class="listitem"><a class="link" href="#ST_3DExtent" title="ST_3DExtent">ST_3DExtent</a> - ジオメトリのbox3Dバウンディングボックスを返す集約関数です。</li><li class="listitem"><a class="link" href="#ST_Accum" title="ST_Accum">ST_Accum</a> - 集約関数です。ジオメトリの配列を生成します。</li><li class="listitem"><a class="link" href="#ST_Affine" title="ST_Affine">ST_Affine</a> - 3次元アフィン変換をジオメトリに適用します。</li><li class="listitem"><a class="link" href="#ST_AsBinary" title="ST_AsBinary">ST_AsBinary</a> - ジオメトリ/ジオグラフィのSRIDメタデータのないWell-Known Binary (WKB)表現を返します。</li><li class="listitem"><a class="link" href="#ST_AsEWKB" title="ST_AsEWKB">ST_AsEWKB</a> - ジオメトリのSRIDメタデータが付いたWell-Known Binary (WKB)表現を返します。</li><li class="listitem"><a class="link" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a> - ジオメトリのSRIDメタデータが付いたWell-Known Text (WKT)表現を返します。</li><li class="listitem"><a class="link" href="#ST_AsHEXEWKB" title="ST_AsHEXEWKB">ST_AsHEXEWKB</a> - ジオメトリのHEXEWKB表現を (文字列として)返します。リトルエンディアン (NDR)またはビッグエンディアン (XDR)のどちらかのエンコーディングを使います。</li><li class="listitem"><a class="link" href="#ST_AsText" title="ST_AsText">ST_AsText</a> - ジオメトリ/ジオグラフィのSRIDメタデータのないWell-Known Text (WKT)表現を返します。</li><li class="listitem"><a class="link" href="#ST_Collect" title="ST_Collect">ST_Collect</a> - 他のジオメトリのコレクションから、指定したST_Geometry値を返します。</li><li class="listitem"><a class="link" href="#ST_CoordDim" title="ST_CoordDim">ST_CoordDim</a> - ST_Geometry値の座標次元を返します。</li><li class="listitem"><a class="link" href="#ST_CurveToLine" title="ST_CurveToLine">ST_CurveToLine</a> - CIRCULARSTRING/CURVEPOLYGONをLINESTRING/POLYGONに変換します。</li><li class="listitem"><a class="link" href="#ST_Distance" title="ST_Distance">ST_Distance</a> - ジオメトリ型については、二つのジオメトリの、2次元の最小デカルト距離 (空間参照系に基づきます)を、投影法の単位で返します。ジオグラフィ型については、デフォルトでは、二つのジオメトリ間の測地距離をメートル単位で返します。</li><li class="listitem"><a class="link" href="#ST_Dump" title="ST_Dump">ST_Dump</a> - ジオメトリg1から作られたgeometry_dump(geom, path)行の集合を返します。</li><li class="listitem"><a class="link" href="#ST_DumpPoints" title="ST_DumpPoints">ST_DumpPoints</a> - ジオメトリを作る全ての点のgometry_dump(geom,path)行の集合を返します。</li><li class="listitem"><a class="link" href="#ST_EndPoint" title="ST_EndPoint">ST_EndPoint</a> - LINESTRINGの最後のポイントをPOINTで返します。</li><li class="listitem"><a class="link" href="#ST_EstimatedExtent" title="ST_EstimatedExtent">ST_EstimatedExtent</a> - 与えられた空間テーブルの「見積もられた」範囲を返します。ジオメトリカラムの統計情報から見積もります。指定されていない場合は現在のスキーマが使われます。</li><li class="listitem"><a class="link" href="#ST_FlipCoordinates" title="ST_FlipCoordinates">ST_FlipCoordinates</a> - 与えられたジオメトリのX軸とY軸とを入れ替えたものを返します。緯度/経度のフィーチャーを構築して、これを訂正したい場合に使えます。</li><li class="listitem"><a class="link" href="#ST_Force2D" title="ST_Force2D">ST_Force2D</a> - ジオメトリを2次元モードに強制します。</li><li class="listitem"><a class="link" href="#ST_ForceCurve" title="ST_ForceCurve">ST_ForceCurve</a> - 該当する場合は、ジオメトリを曲線タイプに変換します。</li><li class="listitem"><a class="link" href="#ST_ForceSFS" title="ST_ForceSFS">ST_ForceSFS</a> - SFS 1.1ジオメトリタイプのみ使うようジオメトリに強制します。</li><li class="listitem"><a class="link" href="#ST_Force_3D" title="ST_Force3D">ST_Force3D</a> - ジオメトリをXYZモードに強制します。これはST_Force3DZの別名です。</li><li class="listitem"><a class="link" href="#ST_Force_3DM" title="ST_Force3DM">ST_Force3DM</a> - ジオメトリをXYMモードに強制します。</li><li class="listitem"><a class="link" href="#ST_Force_3DZ" title="ST_Force3DZ">ST_Force3DZ</a> - ジオメトリをXYZモードに強制します。</li><li class="listitem"><a class="link" href="#ST_Force_4D" title="ST_Force4D">ST_Force4D</a> - ジオメトリをXYZMモードに強制します。</li><li class="listitem"><a class="link" href="#ST_Force_Collection" title="ST_ForceCollection">ST_ForceCollection</a> - ジオメトリをジオメトリコレクションに変換します。</li><li class="listitem"><a class="link" href="#ST_GeoHash" title="ST_GeoHash">ST_GeoHash</a> - ジオメトリのGeoHash表現を返します。</li><li class="listitem"><a class="link" href="#ST_GeogFromWKB" title="ST_GeogFromWKB">ST_GeogFromWKB</a> - Well-Known Binaryジオメトリ表現(WKB)または拡張WKB(EWKB)からジオグラフィインスタンスを生成します。</li><li class="listitem"><a class="link" href="#ST_GeomFromEWKB" title="ST_GeomFromEWKB">ST_GeomFromEWKB</a> - 拡張Well-Known Binary表現 (EWKB)から指定したST_Geometry値を返します。</li><li class="listitem"><a class="link" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a> - 拡張Well-Known Text表現 (EWKT)から指定されたST_Geometry値を返します。</li><li class="listitem"><a class="link" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a> - Well-Known Text表現 (WKT)から指定したST_Geometryを返します。</li><li class="listitem"><a class="link" href="#ST_GeomFromWKB" title="ST_GeomFromWKB">ST_GeomFromWKB</a> - Well-Knwon Binaryジオメトリ表現 (WKB)と任意パラメタのSRIDからジオメトリインスタンスを生成します。</li><li class="listitem"><a class="link" href="#ST_GeometryN" title="ST_GeometryN">ST_GeometryN</a> - GEOMETRYCOLLECTION, (MULTI)POINT, (MULTI)LINESTRING, MULTICURVE, (MULTI)POLYGON, POLYHEDRALSURFACEの場合には、1始まりでN番目のジオメトリを返します。それ以外の場合にはNULLを返します。</li><li class="listitem"><a class="link" href="#ST_Geometry_EQ" title="=">=</a> - ジオメトリ/ジオグラフィ Aの座標と座標の並び順がジオメトリ/ジオグラフィ Bと同じ場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#ST_Geometry_Overbelow" title="&amp;&lt;|">&amp;&lt;|</a> - AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの下にある場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#ST_HasArc" title="ST_HasArc">ST_HasArc</a> - ジオメトリまたはジオメトリコレクションが曲線ストリングを含む場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#ST_IsClosed" title="ST_IsClosed">ST_IsClosed</a> - LINESTRINGの始点と終点が一致する場合にTRUEを返します。多面体サーフェスの場合は閉じているかどうか (ボリュームであるかどうか)を返します。</li><li class="listitem"><a class="link" href="#ST_IsCollection" title="ST_IsCollection">ST_IsCollection</a> - 引数がコレクション(MULTI*, GEOMETRYCOLLECTION, ...)の場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#ST_IsEmpty" title="ST_IsEmpty">ST_IsEmpty</a> - ジオメトリが、空のジオメトリコレクション、ポリゴン、ポイント等の場合に、trueを返します。</li><li class="listitem"><a class="link" href="#ST_LineToCurve" title="ST_LineToCurve">ST_LineToCurve</a> - LINESTRING/POLYGONをCIRCULARSTRINGかCURVEPOLYGONに変換します。</li><li class="listitem"><a class="link" href="#ST_MemSize" title="ST_MemSize">ST_MemSize</a> - ジオメトリが取る容量 (バイト単位)を返します。</li><li class="listitem"><a class="link" href="#ST_NPoints" title="ST_NPoints">ST_NPoints</a> - ジオメトリのポイント (頂点)数を返します。</li><li class="listitem"><a class="link" href="#ST_NRings" title="ST_NRings">ST_NRings</a> - ジオメトリがポリゴンまたはマルチポリゴンの場合、リング数を返します。</li><li class="listitem"><a class="link" href="#ST_PointFromWKB" title="ST_PointFromWKB">ST_PointFromWKB</a> - WKBと与えられたSRIDからジオメトリを生成します。</li><li class="listitem"><a class="link" href="#ST_PointN" title="ST_PointN">ST_PointN</a> - ラインストリングまたは曲線ストリングのN番目の点を返します。負数はラインストリングの終端から逆方向に遡って数えます。ジオメトリにラインストリングが無い場合には、NULLを返します。</li><li class="listitem"><a class="link" href="#ST_Points" title="ST_Points">ST_Points</a> - ジオメトリの全ての座標値からなるマルチポイントを返します。</li><li class="listitem"><a class="link" href="#ST_Rotate" title="ST_Rotate">ST_Rotate</a> - ジオメトリを、原点について反時計回りにrotRadiasnぶん回転させます。</li><li class="listitem"><a class="link" href="#ST_RotateZ" title="ST_RotateZ">ST_RotateZ</a> - ジオメトリをZ軸についてrotRadiansぶん回転させます。</li><li class="listitem"><a class="link" href="#ST_SRID" title="ST_SRID">ST_SRID</a> - ST_Geometryのspatial_ref_sysテーブルで定義されている空間参照系の識別番号を返します。</li><li class="listitem"><a class="link" href="#ST_Scale" title="ST_Scale">ST_Scale</a> - 与えた係数でジオメトリを拡大縮小します。</li><li class="listitem"><a class="link" href="#ST_SetSRID" title="ST_SetSRID">ST_SetSRID</a> - ジオメトリのSRIDを特定の整数値に設定します。</li><li class="listitem"><a class="link" href="#ST_StartPoint" title="ST_StartPoint">ST_StartPoint</a> - LINESTRINGの最初のポイントをPOINTとして返します。</li><li class="listitem"><a class="link" href="#ST_Summary" title="ST_Summary">ST_Summary</a> - ジオメトリについての要約文を返します。</li><li class="listitem"><a class="link" href="#ST_SwapOrdinates" title="ST_SwapOrdinates">ST_SwapOrdinates</a> - 与えられたジオメトリにおいて与えられた座標の値を入れ替えたジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_TransScale" title="ST_TransScale">ST_TransScale</a> - 与えられた係数とオフセットでジオメトリを変換します。</li><li class="listitem"><a class="link" href="#ST_Transform" title="ST_Transform">ST_Transform</a> - 異なる空間参照系に投影変換された新しいジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_Translate" title="ST_Translate">ST_Translate</a> - 与えられたオフセットでジオメトリを変換します。</li><li class="listitem"><a class="link" href="#ST_XMax" title="ST_XMax">ST_XMax</a> - 2次元、3次元バウンディングボックスまたはジオメトリにおけるXの最大値を返します。</li><li class="listitem"><a class="link" href="#ST_XMin" title="ST_XMin">ST_XMin</a> - 2次元、3次元バウンディングボックスまたはジオメトリにおけるXの最小値を返します。</li><li class="listitem"><a class="link" href="#ST_YMax" title="ST_YMax">ST_YMax</a> - 2次元、3次元バウンディングボックスまたはジオメトリにおけるYの最大値を返します。</li><li class="listitem"><a class="link" href="#ST_YMin" title="ST_YMin">ST_YMin</a> - 2次元、3次元バウンディングボックスまたはジオメトリにおけるYの最小値を返します。</li><li class="listitem"><a class="link" href="#ST_ZMax" title="ST_ZMax">ST_ZMax</a> - 2次元、3次元バウンディングボックスまたはジオメトリにおけるZの最大値を返します。</li><li class="listitem"><a class="link" href="#ST_ZMin" title="ST_ZMin">ST_ZMin</a> - 2次元、3次元バウンディングボックスまたはジオメトリにおけるZの最大値を返します。</li><li class="listitem"><a class="link" href="#ST_Zmflag" title="ST_Zmflag">ST_Zmflag</a> - ポイントのZM (次元の意味)フラグをsmall intで返します。値は 0=XY, 1=XYM, 2=XYZ, 3=XYZMとなります。</li><li class="listitem"><a class="link" href="#UpdateGeometrySRID" title="UpdateGeometrySRID">UpdateGeometrySRID</a> - ジオメトリカラムの全てのフィーチャーのSRID、geometry_columnsメタデータとSRIDテーブル制約を更新します。制約付きの場合には、制約が新しいSRID制約に更新されます。型定義付きの場合は、型定義が変更されます。</li><li class="listitem"><a class="link" href="#contains_box2df_box2df" title="~(box2df,box2df)">~(box2df,box2df)</a> - 二つの単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)の一方がもう一方を包含する場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#contains_box2df_geometry" title="~(box2df,geometry)">~(box2df,geometry)</a> - 単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)をジオメトリの (キャッシュされている)2次元バウンディングボックスが包含する場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#contains_geometry_box2df" title="~(geometry,box2df)">~(geometry,box2df)</a> - ジオメトリの (キャッシュされている)2次元バウンディングボックスが単精度浮動小数点数によるn次元バウンディングボックス (GIDX)を包含する場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#geometry_overlaps" title="&amp;&amp;">&amp;&amp;</a> - Aの2次元バウンディングボックスがBの2次元バウンディングボックスとインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#geometry_overlaps_nd" title="&amp;&amp;&amp;">&amp;&amp;&amp;</a> - Aのn次元バウンディングボックスがBのn次元バウンディングボックスとインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#is_contained_box2df_box2df" title="@(box2df,box2df)">@(box2df,box2df)</a> - 二つの単精度浮動小数点数によるn次元バウンディングボックス (GIDX)の一方がもう一方を包含する場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#is_contained_box2df_geometry" title="@(box2df,geometry)">@(box2df,geometry)</a> - 単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)がジオメトリの2次元バウンディングボックスに包含される場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#is_contained_geometry_box2df" title="@(geometry,box2df)">@(geometry,box2df)</a> - ジオメトリの2次元バウンディングボックスが単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)に包含される場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#overlaps_box2df_box2df" title="&amp;&amp;(box2df,box2df)">&amp;&amp;(box2df,box2df)</a> - 二つの単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)が相互にインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#overlaps_box2df_geometry" title="&amp;&amp;(box2df,geometry)">&amp;&amp;(box2df,geometry)</a> - 単精度浮動小数点数による2次元バウンディングボックスがジオメトリの (キャッシュされている)2次元バウンディングボックスとインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#overlaps_geometry_box2df" title="&amp;&amp;(geometry,box2df)">&amp;&amp;(geometry,box2df)</a> - ジオメトリの (キャッシュされている)2次元バウンディングボックスが単精度浮動小数点数による2次元バウンディングボックスとインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#overlaps_nd_geometry_gidx" title="&amp;&amp;&amp;(geometry,gidx)">&amp;&amp;&amp;(geometry,gidx)</a> - ジオメトリの (キャッシュされている)n次元バウンディングボックスが単精度浮動小数点数によるn次元バウンディングボックス (GIDX)とインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#overlaps_nd_gidx_geometry" title="&amp;&amp;&amp;(gidx,geometry)">&amp;&amp;&amp;(gidx,geometry)</a> - 単精度浮動小数点数によるn次元バウンディングボックス (GIDX)がジオメトリの (キャッシュされている)n次元バウンディングボックスとインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#overlaps_nd_gidx_gidx" title="&amp;&amp;&amp;(gidx,gidx)">&amp;&amp;&amp;(gidx,gidx)</a> - 二つの単精度浮動小数点数によるn次元バウンディングボックス (GIDX)が相互にインタセクトする場合にTRUEを返します。</li></ul></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="PostGIS_PS_GeometryFunctions"></a>14.10. PostGIS多面体サーフェス対応関数</h2></div></div></div><p>次に示す関数は、POLYHEDRALSURFACE, POLYHEDRALSURFACEMジオメトリが使えるPostGIS関数です。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#Box2D" title="Box2D">Box2D</a> - ジオメトリの最大範囲を表すBOX2Dを返します。</li><li class="listitem"><a class="link" href="#Box3D" title="Box3D">Box3D</a> - ジオメトリの最大範囲を表すBOX3Dを返します。</li><li class="listitem"><a class="link" href="#GeometryType" title="GeometryType">GeometryType</a> - ジオメトリ型を'LINESTRING', 'POLYGON', 'MULTIPOINT'などの文字列で返します。</li><li class="listitem"><a class="link" href="#ST_3DArea" title="ST_3DArea">ST_3DArea</a> - 3次元の面ジオメトリの面積を計算します。立体の場合は0を返します。</li><li class="listitem"><a class="link" href="#ST_3DClosestPoint" title="ST_3DClosestPoint">ST_3DClosestPoint</a> - g1上の、g2に最も近い3次元ポイントを返します。3次元最短線の一つ目のポイントです。</li><li class="listitem"><a class="link" href="#ST_3DDFullyWithin" title="ST_3DDFullyWithin">ST_3DDFullyWithin</a> - 3次元ジオメトリが他のジオメトリとの距離が指定した範囲内ならtrueを返します。</li><li class="listitem"><a class="link" href="#ST_3DDWithin" title="ST_3DDWithin">ST_3DDWithin</a> - 3次元 (XYZ)ジオメトリ型について、二つのジオメトリの3次元距離が指定した数の内にある場合にtrueを返します。</li><li class="listitem"><a class="link" href="#ST_3DDifference" title="ST_3DDifference">ST_3DDifference</a> - 3次元の差分を計算します。</li><li class="listitem"><a class="link" href="#ST_3DDistance" title="ST_3DDistance">ST_3DDistance</a> - ジオメトリ型について、二つのジオメトリの、3次元の最小デカルト距離 (空間参照系に基づきます)を、投影法の単位で返します。</li><li class="listitem"><a class="link" href="#ST_3DExtent" title="ST_3DExtent">ST_3DExtent</a> - ジオメトリのbox3Dバウンディングボックスを返す集約関数です。</li><li class="listitem"><a class="link" href="#ST_3DIntersection" title="ST_3DIntersection">ST_3DIntersection</a> - 3次元のインタセクトした (共有する)部分を計算します。</li><li class="listitem"><a class="link" href="#ST_3DIntersects" title="ST_3DIntersects">ST_3DIntersects</a> - ジオメトリが3次元で「空間的にインタセクトする」場合にTRUEを返します。ポイント、ラインストリング、ポリゴン、多面体サーフェス (面)のみ対応します。SFCGALバックエンドによってTINも対応します。</li><li class="listitem"><a class="link" href="#ST_3DLongestLine" title="ST_3DLongestLine">ST_3DLongestLine</a> - 二つのジオメトリの3次元長が最長となるラインを返します。</li><li class="listitem"><a class="link" href="#ST_3DMaxDistance" title="ST_3DMaxDistance">ST_3DMaxDistance</a> - ジオメトリ型について、二つのジオメトリの、3次元の最大デカルト距離 (空間参照系に基づきます)を、投影法の単位で返します。</li><li class="listitem"><a class="link" href="#ST_3DShortestLine" title="ST_3DShortestLine">ST_3DShortestLine</a> - 二つのジオメトリの3次元長が最短となるラインを返します。</li><li class="listitem"><a class="link" href="#ST_3DUnion" title="ST_3DUnion">ST_3DUnion</a> - 3次元の結合を計算します。</li><li class="listitem"><a class="link" href="#ST_Accum" title="ST_Accum">ST_Accum</a> - 集約関数です。ジオメトリの配列を生成します。</li><li class="listitem"><a class="link" href="#ST_Affine" title="ST_Affine">ST_Affine</a> - 3次元アフィン変換をジオメトリに適用します。</li><li class="listitem"><a class="link" href="#ST_ApproximateMedialAxis" title="ST_ApproximateMedialAxis">ST_ApproximateMedialAxis</a> - 面ジオメトリの近似的な中心軸を計算します。</li><li class="listitem"><a class="link" href="#ST_Area" title="ST_Area">ST_Area</a> - ポリゴンまたはマルチポリゴンの場合にはサーフェスの面積を返します。ジオメトリ型の面積はSRIDに基づく単位です。ジオグラフィ型の面積は曲面上で計算され、単位は平方メートルです。</li><li class="listitem"><a class="link" href="#ST_AsBinary" title="ST_AsBinary">ST_AsBinary</a> - ジオメトリ/ジオグラフィのSRIDメタデータのないWell-Known Binary (WKB)表現を返します。</li><li class="listitem"><a class="link" href="#ST_AsEWKB" title="ST_AsEWKB">ST_AsEWKB</a> - ジオメトリのSRIDメタデータが付いたWell-Known Binary (WKB)表現を返します。</li><li class="listitem"><a class="link" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a> - ジオメトリのSRIDメタデータが付いたWell-Known Text (WKT)表現を返します。</li><li class="listitem"><a class="link" href="#ST_AsGML" title="ST_AsGML">ST_AsGML</a> - GML第2版または第3版としてジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_AsX3D" title="ST_AsX3D">ST_AsX3D</a> - ジオメトリをX3Dノード要素書式　(ISO-IEC-19776-1.2-X3DEncodings-XML)で返します。</li><li class="listitem"><a class="link" href="#ST_CoordDim" title="ST_CoordDim">ST_CoordDim</a> - ST_Geometry値の座標次元を返します。</li><li class="listitem"><a class="link" href="#ST_Dimension" title="ST_Dimension">ST_Dimension</a> - ジオメトリの固有次元を返します。ジオメトリは座標次元以下でなければなりません。</li><li class="listitem"><a class="link" href="#ST_Dump" title="ST_Dump">ST_Dump</a> - ジオメトリg1から作られたgeometry_dump(geom, path)行の集合を返します。</li><li class="listitem"><a class="link" href="#ST_DumpPoints" title="ST_DumpPoints">ST_DumpPoints</a> - ジオメトリを作る全ての点のgometry_dump(geom,path)行の集合を返します。</li><li class="listitem"><a class="link" href="#ST_Expand" title="ST_Expand">ST_Expand</a> - 入力ジオメトリのバウンディングボックスから全ての方向に拡張されたバウンディングボックスを返します。倍精度浮動小数点数を使います。</li><li class="listitem"><a class="link" href="#ST_Extent" title="ST_Extent">ST_Extent</a> - ジオメトリのバウンディングボックスを返す集約関数です。</li><li class="listitem"><a class="link" href="#ST_Extrude" title="ST_Extrude">ST_Extrude</a> - 関連するボリュームにサーフェスを押し出します。</li><li class="listitem"><a class="link" href="#ST_FlipCoordinates" title="ST_FlipCoordinates">ST_FlipCoordinates</a> - 与えられたジオメトリのX軸とY軸とを入れ替えたものを返します。緯度/経度のフィーチャーを構築して、これを訂正したい場合に使えます。</li><li class="listitem"><a class="link" href="#ST_Force2D" title="ST_Force2D">ST_Force2D</a> - ジオメトリを2次元モードに強制します。</li><li class="listitem"><a class="link" href="#ST_ForceLHR" title="ST_ForceLHR">ST_ForceLHR</a> - LHR (Left Hand Rule)方向に強制します。</li><li class="listitem"><a class="link" href="#ST_ForceRHR" title="ST_ForceRHR">ST_ForceRHR</a> - ポリゴンの頂点の方向を右回りに強制します。</li><li class="listitem"><a class="link" href="#ST_ForceSFS" title="ST_ForceSFS">ST_ForceSFS</a> - SFS 1.1ジオメトリタイプのみ使うようジオメトリに強制します。</li><li class="listitem"><a class="link" href="#ST_Force_3D" title="ST_Force3D">ST_Force3D</a> - ジオメトリをXYZモードに強制します。これはST_Force3DZの別名です。</li><li class="listitem"><a class="link" href="#ST_Force_3DZ" title="ST_Force3DZ">ST_Force3DZ</a> - ジオメトリをXYZモードに強制します。</li><li class="listitem"><a class="link" href="#ST_Force_Collection" title="ST_ForceCollection">ST_ForceCollection</a> - ジオメトリをジオメトリコレクションに変換します。</li><li class="listitem"><a class="link" href="#ST_GeomFromEWKB" title="ST_GeomFromEWKB">ST_GeomFromEWKB</a> - 拡張Well-Known Binary表現 (EWKB)から指定したST_Geometry値を返します。</li><li class="listitem"><a class="link" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a> - 拡張Well-Known Text表現 (EWKT)から指定されたST_Geometry値を返します。</li><li class="listitem"><a class="link" href="#ST_GeomFromGML" title="ST_GeomFromGML">ST_GeomFromGML</a> - GML表現からPostGISジオメトリオブジェクトを出力します。</li><li class="listitem"><a class="link" href="#ST_GeometryN" title="ST_GeometryN">ST_GeometryN</a> - GEOMETRYCOLLECTION, (MULTI)POINT, (MULTI)LINESTRING, MULTICURVE, (MULTI)POLYGON, POLYHEDRALSURFACEの場合には、1始まりでN番目のジオメトリを返します。それ以外の場合にはNULLを返します。</li><li class="listitem"><a class="link" href="#ST_GeometryType" title="ST_GeometryType">ST_GeometryType</a> - ST_Geometry値のジオメトリ型を返します。</li><li class="listitem"><a class="link" href="#ST_Geometry_EQ" title="=">=</a> - ジオメトリ/ジオグラフィ Aの座標と座標の並び順がジオメトリ/ジオグラフィ Bと同じ場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#ST_Geometry_Overbelow" title="&amp;&lt;|">&amp;&lt;|</a> - AのバウンディングボックスがBのバウンディングボックスをオーバラップするか、Bのバウンディングボックスの下にある場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#ST_Geometry_Same" title="~=">~=</a> - AのバウンディングボックスがBのバウンディングボックスと同じ場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#ST_IsClosed" title="ST_IsClosed">ST_IsClosed</a> - LINESTRINGの始点と終点が一致する場合にTRUEを返します。多面体サーフェスの場合は閉じているかどうか (ボリュームであるかどうか)を返します。</li><li class="listitem"><a class="link" href="#ST_IsPlanar" title="ST_IsPlanar">ST_IsPlanar</a> - サーフェスが平面であるかないかをチェックします。</li><li class="listitem"><a class="link" href="#ST_IsSolid" title="ST_IsSolid">ST_IsSolid</a> - ジオメトリが立体であるかどうかをテストします。妥当性チェックは行いません。</li><li class="listitem"><a class="link" href="#ST_MakeSolid" title="ST_MakeSolid">ST_MakeSolid</a> - ジオメトリを立体にキャストします。チェックはしません。妥当な立体を得るには、入力ジオメトリは閉じた多面体サーフェスか閉じたTINでなければなりません。</li><li class="listitem"><a class="link" href="#ST_MemSize" title="ST_MemSize">ST_MemSize</a> - ジオメトリが取る容量 (バイト単位)を返します。</li><li class="listitem"><a class="link" href="#ST_NPoints" title="ST_NPoints">ST_NPoints</a> - ジオメトリのポイント (頂点)数を返します。</li><li class="listitem"><a class="link" href="#ST_NumGeometries" title="ST_NumGeometries">ST_NumGeometries</a> - ジオメトリがジオメトリコレクションまたはマルチ系の場合はジオメトリの数を、単一のジオメトリの場合は1を返し、それ以外の場合はNULLを返します。</li><li class="listitem"><a class="link" href="#ST_NumPatches" title="ST_NumPatches">ST_NumPatches</a> - 多面体サーフェスのフェイス数を返します。多面体でないジオメトリの場合にはNULLを返します。</li><li class="listitem"><a class="link" href="#ST_PatchN" title="ST_PatchN">ST_PatchN</a> - ジオメトリがPOLYHEDRALSURFACEかPOLYHEDRALSURFACEMの場合には、1始まりでN番目のジオメトリ (フェイス)を返します。それ以外の場合には、NULLを返します。</li><li class="listitem"><a class="link" href="#ST_RemoveRepeatedPoints" title="ST_RemoveRepeatedPoints">ST_RemoveRepeatedPoints</a> - 入力ジオメトリから重複ポイントを除いたものを返します。</li><li class="listitem"><a class="link" href="#ST_Reverse" title="ST_Reverse">ST_Reverse</a> - 頂点の順序を逆にしたジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_Rotate" title="ST_Rotate">ST_Rotate</a> - ジオメトリを、原点について反時計回りにrotRadiasnぶん回転させます。</li><li class="listitem"><a class="link" href="#ST_RotateX" title="ST_RotateX">ST_RotateX</a> - ジオメトリをX軸についてrotRadiansぶん回転させます。</li><li class="listitem"><a class="link" href="#ST_RotateY" title="ST_RotateY">ST_RotateY</a> - ジオメトリgeomAをY軸についてrotRadiansぶん回転させます。</li><li class="listitem"><a class="link" href="#ST_RotateZ" title="ST_RotateZ">ST_RotateZ</a> - ジオメトリをZ軸についてrotRadiansぶん回転させます。</li><li class="listitem"><a class="link" href="#ST_Scale" title="ST_Scale">ST_Scale</a> - 与えた係数でジオメトリを拡大縮小します。</li><li class="listitem"><a class="link" href="#ST_Shift_Longitude" title="ST_ShiftLongitude">ST_ShiftLongitude</a> - ジオメトリの座標値を-180度から180度の範囲と0度から360度の範囲に揃えます。</li><li class="listitem"><a class="link" href="#ST_StraightSkeleton" title="ST_StraightSkeleton">ST_StraightSkeleton</a> - ジオメトリからストレートスケルトンを計算します。</li><li class="listitem"><a class="link" href="#ST_Summary" title="ST_Summary">ST_Summary</a> - ジオメトリについての要約文を返します。</li><li class="listitem"><a class="link" href="#ST_SwapOrdinates" title="ST_SwapOrdinates">ST_SwapOrdinates</a> - 与えられたジオメトリにおいて与えられた座標の値を入れ替えたジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_Tesselate" title="ST_Tesselate">ST_Tesselate</a> - ポリゴンまたは多面体サーフェスのテッセレーションを計算し、TINまたはTINコレクションを返します。</li><li class="listitem"><a class="link" href="#ST_Transform" title="ST_Transform">ST_Transform</a> - 異なる空間参照系に投影変換された新しいジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_Volume" title="ST_Volume">ST_Volume</a> - 3次元立体の体積を計算します。面ジオメトリは (閉じていても)0を返します。</li><li class="listitem"><a class="link" href="#contains_box2df_box2df" title="~(box2df,box2df)">~(box2df,box2df)</a> - 二つの単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)の一方がもう一方を包含する場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#contains_box2df_geometry" title="~(box2df,geometry)">~(box2df,geometry)</a> - 単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)をジオメトリの (キャッシュされている)2次元バウンディングボックスが包含する場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#contains_geometry_box2df" title="~(geometry,box2df)">~(geometry,box2df)</a> - ジオメトリの (キャッシュされている)2次元バウンディングボックスが単精度浮動小数点数によるn次元バウンディングボックス (GIDX)を包含する場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#geometry_overlaps" title="&amp;&amp;">&amp;&amp;</a> - Aの2次元バウンディングボックスがBの2次元バウンディングボックスとインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#geometry_overlaps_nd" title="&amp;&amp;&amp;">&amp;&amp;&amp;</a> - Aのn次元バウンディングボックスがBのn次元バウンディングボックスとインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#is_contained_box2df_box2df" title="@(box2df,box2df)">@(box2df,box2df)</a> - 二つの単精度浮動小数点数によるn次元バウンディングボックス (GIDX)の一方がもう一方を包含する場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#is_contained_box2df_geometry" title="@(box2df,geometry)">@(box2df,geometry)</a> - 単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)がジオメトリの2次元バウンディングボックスに包含される場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#is_contained_geometry_box2df" title="@(geometry,box2df)">@(geometry,box2df)</a> - ジオメトリの2次元バウンディングボックスが単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)に包含される場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#overlaps_box2df_box2df" title="&amp;&amp;(box2df,box2df)">&amp;&amp;(box2df,box2df)</a> - 二つの単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)が相互にインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#overlaps_box2df_geometry" title="&amp;&amp;(box2df,geometry)">&amp;&amp;(box2df,geometry)</a> - 単精度浮動小数点数による2次元バウンディングボックスがジオメトリの (キャッシュされている)2次元バウンディングボックスとインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#overlaps_geometry_box2df" title="&amp;&amp;(geometry,box2df)">&amp;&amp;(geometry,box2df)</a> - ジオメトリの (キャッシュされている)2次元バウンディングボックスが単精度浮動小数点数による2次元バウンディングボックスとインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#overlaps_nd_geometry_gidx" title="&amp;&amp;&amp;(geometry,gidx)">&amp;&amp;&amp;(geometry,gidx)</a> - ジオメトリの (キャッシュされている)n次元バウンディングボックスが単精度浮動小数点数によるn次元バウンディングボックス (GIDX)とインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#overlaps_nd_gidx_geometry" title="&amp;&amp;&amp;(gidx,geometry)">&amp;&amp;&amp;(gidx,geometry)</a> - 単精度浮動小数点数によるn次元バウンディングボックス (GIDX)がジオメトリの (キャッシュされている)n次元バウンディングボックスとインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#overlaps_nd_gidx_gidx" title="&amp;&amp;&amp;(gidx,gidx)">&amp;&amp;&amp;(gidx,gidx)</a> - 二つの単精度浮動小数点数によるn次元バウンディングボックス (GIDX)が相互にインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#postgis_sfcgal_version" title="postgis_sfcgal_version">postgis_sfcgal_version</a> - 使用しているSFCGALの版を返します</li></ul></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="PostGIS_TypeFunctionMatrix"></a>14.11. PostGIS関数対応マトリクス</h2></div></div></div><p>次に示す表は、アルファベット順に並べたPostGIS空間関数と、動作する空間タイプの種類、対応しようとしているOGC/SQL準拠を示しています。</p><p>
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span> は、ネイティブで、その型と派生型とに対応しています。</li><li class="listitem"><span class="inlinemediaobject"><img src="images/matrix_transform.png"></span>  は、動作しますが、ジオメトリにキャストして「最善のSRID」に投影変換したうえでジオグラフィに戻す、組み込み変換キャストを使います。大きな面積の領域や、極にある領域については、予期しない結果になることがありますし、浮動小数点数のごみを蓄積することがあります。</li><li class="listitem"><span class="inlinemediaobject"><img src="images/matrix_autocast.png"></span> は、直接的な対応でなくbox3dへの変換といった他からの自動キャストで動作します。</li><li class="listitem"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span> は、PostGISをSFCGAL対応でコンパイルした場合にのみ利用可能な関数です。</li><li class="listitem"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_enhanced.png"></span> は、PostGISをSFCGAL対応でコンパイルした場合には、SFCGALが提供し、その他の場合には、GEOSまたは組み込み関数で対応します。</li><li class="listitem">geom - 基本的な2次元ジオメトリ (x,y)に対応しています。</li><li class="listitem">geog - 基本的な2次元ジオグラフィ (x,y)に対応しています。</li><li class="listitem">2.5D - 3次元/4次元 (ZまたはM座標を持つ)空間内の基本的な2次元ジオメトリに対応しています。</li><li class="listitem">PS - 多面体サーフェス (Polyhedral Surface)に対応しています。</li><li class="listitem">T - 三角形と不規則三角網 (TIN)に対応しています。</li></ul></div><p>
    </p><p>
      </p><div class="informaltable"><table class="informaltable" border="1"><colgroup><col align="left" class="function"><col align="center" class="geometry"><col align="center" class="geography"><col align="center" class="25D"><col align="center" class="Curves"><col align="center" class="SQLMM"><col align="center" class="PS"><col align="center" class="T"></colgroup><thead><tr><th align="left">関数</th><th align="center">geom</th><th align="center">geog</th><th align="center">2.5D</th><th align="center">Curves</th><th align="center">SQL MM</th><th align="center">PS</th><th align="center">T</th></tr></thead><tbody><tr><td align="left">
                <a class="link" href="#Box2D" title="Box2D">Box2D</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#Box3D" title="Box3D">Box3D</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#Find_SRID" title="Find_SRID">Find_SRID</a>
              </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#GeometryType" title="GeometryType">GeometryType</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_3DArea" title="ST_3DArea">ST_3DArea</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_3DClosestPoint" title="ST_3DClosestPoint">ST_3DClosestPoint</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_3DDFullyWithin" title="ST_3DDFullyWithin">ST_3DDFullyWithin</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_3DDWithin" title="ST_3DDWithin">ST_3DDWithin</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_3DDifference" title="ST_3DDifference">ST_3DDifference</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_3DDistance" title="ST_3DDistance">ST_3DDistance</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_enhanced.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_enhanced.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_enhanced.png"></span></td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_3DExtent" title="ST_3DExtent">ST_3DExtent</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_3DIntersection" title="ST_3DIntersection">ST_3DIntersection</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_3DIntersects" title="ST_3DIntersects">ST_3DIntersects</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_enhanced.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_enhanced.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_enhanced.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_enhanced.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_3DLength" title="ST_3DLength">ST_3DLength</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_3DLongestLine" title="ST_3DLongestLine">ST_3DLongestLine</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_3DMakeBox" title="ST_3DMakeBox">ST_3DMakeBox</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_3DMaxDistance" title="ST_3DMaxDistance">ST_3DMaxDistance</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_3DPerimeter" title="ST_3DPerimeter">ST_3DPerimeter</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_3DShortestLine" title="ST_3DShortestLine">ST_3DShortestLine</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_3DUnion" title="ST_3DUnion">ST_3DUnion</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_Accum" title="ST_Accum">ST_Accum</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_AddMeasure" title="ST_AddMeasure">ST_AddMeasure</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_AddPoint" title="ST_AddPoint">ST_AddPoint</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Affine" title="ST_Affine">ST_Affine</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_Angle" title="ST_Angle">ST_Angle</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_ApproximateMedialAxis" title="ST_ApproximateMedialAxis">ST_ApproximateMedialAxis</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_Area" title="ST_Area">ST_Area</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_enhanced.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_enhanced.png"></span></td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_AsBinary" title="ST_AsBinary">ST_AsBinary</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_AsEWKB" title="ST_AsEWKB">ST_AsEWKB</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_AsEncodedPolyline" title="ST_AsEncodedPolyline">ST_AsEncodedPolyline</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_AsGML" title="ST_AsGML">ST_AsGML</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_AsGeoJSON" title="ST_AsGeoJSON">ST_AsGeoJSON</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_AsGeobuf" title="ST_AsGeobuf">ST_AsGeobuf</a>
              </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_AsHEXEWKB" title="ST_AsHEXEWKB">ST_AsHEXEWKB</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_AsKML" title="ST_AsKML">ST_AsKML</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_AsLatLonText" title="ST_AsLatLonText">ST_AsLatLonText</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_AsMVT" title="ST_AsMVT">ST_AsMVT</a>
              </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_AsMVTGeom" title="ST_AsMVTGeom">ST_AsMVTGeom</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_AsSVG" title="ST_AsSVG">ST_AsSVG</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_AsTWKB" title="ST_AsTWKB">ST_AsTWKB</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_AsText" title="ST_AsText">ST_AsText</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_AsX3D" title="ST_AsX3D">ST_AsX3D</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_Azimuth" title="ST_Azimuth">ST_Azimuth</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_BdMPolyFromText" title="ST_BdMPolyFromText">ST_BdMPolyFromText</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_BdPolyFromText" title="ST_BdPolyFromText">ST_BdPolyFromText</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Boundary" title="ST_Boundary">ST_Boundary</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_BoundingDiagonal" title="ST_BoundingDiagonal">ST_BoundingDiagonal</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Box2dFromGeoHash" title="ST_Box2dFromGeoHash">ST_Box2dFromGeoHash</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_autocast.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Buffer" title="ST_Buffer">ST_Buffer</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_transform.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_BuildArea" title="ST_BuildArea">ST_BuildArea</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_CPAWithin" title="ST_CPAWithin">ST_CPAWithin</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Centroid" title="ST_Centroid">ST_Centroid</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_ChaikinSmoothing" title="ST_ChaikinSmoothing">ST_ChaikinSmoothing</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_ClipByBox2D" title="ST_ClipByBox2D">ST_ClipByBox2D</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_ClosestPoint" title="ST_ClosestPoint">ST_ClosestPoint</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_ClosestPointOfApproach" title="ST_ClosestPointOfApproach">ST_ClosestPointOfApproach</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_ClusterDBSCAN" title="ST_ClusterDBSCAN">ST_ClusterDBSCAN</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_ClusterIntersecting" title="ST_ClusterIntersecting">ST_ClusterIntersecting</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_ClusterKMeans" title="ST_ClusterKMeans">ST_ClusterKMeans</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_ClusterWithin" title="ST_ClusterWithin">ST_ClusterWithin</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Collect" title="ST_Collect">ST_Collect</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_CollectionExtract" title="ST_CollectionExtract">ST_CollectionExtract</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_CollectionHomogenize" title="ST_CollectionHomogenize">ST_CollectionHomogenize</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_ConcaveHull" title="ST_ConcaveHull">ST_ConcaveHull</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Contains" title="ST_Contains">ST_Contains</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_ContainsProperly" title="ST_ContainsProperly">ST_ContainsProperly</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_ConvexHull" title="ST_ConvexHull">ST_ConvexHull</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_CoordDim" title="ST_CoordDim">ST_CoordDim</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_CoveredBy" title="ST_CoveredBy">ST_CoveredBy</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Covers" title="ST_Covers">ST_Covers</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Crosses" title="ST_Crosses">ST_Crosses</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_CurveToLine" title="ST_CurveToLine">ST_CurveToLine</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_DFullyWithin" title="ST_DFullyWithin">ST_DFullyWithin</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_DWithin" title="ST_DWithin">ST_DWithin</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_DelaunayTriangles" title="ST_DelaunayTriangles">ST_DelaunayTriangles</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_Difference" title="ST_Difference">ST_Difference</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Dimension" title="ST_Dimension">ST_Dimension</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_Disjoint" title="ST_Disjoint">ST_Disjoint</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Distance" title="ST_Distance">ST_Distance</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_enhanced.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_DistanceCPA" title="ST_DistanceCPA">ST_DistanceCPA</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_DistanceSphere" title="ST_DistanceSphere">ST_DistanceSphere</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Distance_Spheroid" title="ST_DistanceSpheroid">ST_DistanceSpheroid</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Dump" title="ST_Dump">ST_Dump</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_DumpPoints" title="ST_DumpPoints">ST_DumpPoints</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_DumpRings" title="ST_DumpRings">ST_DumpRings</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_EndPoint" title="ST_EndPoint">ST_EndPoint</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Envelope" title="ST_Envelope">ST_Envelope</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Equals" title="ST_Equals">ST_Equals</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_EstimatedExtent" title="ST_EstimatedExtent">ST_EstimatedExtent</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_autocast.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Expand" title="ST_Expand">ST_Expand</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_Extent" title="ST_Extent">ST_Extent</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_ExteriorRing" title="ST_ExteriorRing">ST_ExteriorRing</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Extrude" title="ST_Extrude">ST_Extrude</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_FilterByM" title="ST_FilterByM">ST_FilterByM</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_FlipCoordinates" title="ST_FlipCoordinates">ST_FlipCoordinates</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_Force2D" title="ST_Force2D">ST_Force2D</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_ForceCurve" title="ST_ForceCurve">ST_ForceCurve</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_ForceLHR" title="ST_ForceLHR">ST_ForceLHR</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_ForcePolygonCCW" title="ST_ForcePolygonCCW">ST_ForcePolygonCCW </a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_ForcePolygonCW" title="ST_ForcePolygonCW">ST_ForcePolygonCW </a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_ForceRHR" title="ST_ForceRHR">ST_ForceRHR</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_ForceSFS" title="ST_ForceSFS">ST_ForceSFS</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_Force_3D" title="ST_Force3D">ST_Force3D</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Force_3DM" title="ST_Force3DM">ST_Force3DM</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Force_3DZ" title="ST_Force3DZ">ST_Force3DZ</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Force_4D" title="ST_Force4D">ST_Force4D</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Force_Collection" title="ST_ForceCollection">ST_ForceCollection</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_FrechetDistance" title="ST_FrechetDistance">ST_FrechetDistance</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_GMLToSQL" title="ST_GMLToSQL">ST_GMLToSQL</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_GeneratePoints" title="ST_GeneratePoints">ST_GeneratePoints</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_GeoHash" title="ST_GeoHash">ST_GeoHash</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_GeogFromText" title="ST_GeogFromText">ST_GeogFromText</a>
              </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_GeogFromWKB" title="ST_GeogFromWKB">ST_GeogFromWKB</a>
              </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_GeographyFromText" title="ST_GeographyFromText">ST_GeographyFromText</a>
              </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_GeomCollFromText" title="ST_GeomCollFromText">ST_GeomCollFromText</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_GeomFromEWKB" title="ST_GeomFromEWKB">ST_GeomFromEWKB</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_GeomFromGML" title="ST_GeomFromGML">ST_GeomFromGML</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_GeomFromGeoHash" title="ST_GeomFromGeoHash">ST_GeomFromGeoHash</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_GeomFromGeoJSON" title="ST_GeomFromGeoJSON">ST_GeomFromGeoJSON</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_GeomFromKML" title="ST_GeomFromKML">ST_GeomFromKML</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_GeomFromTWKB" title="ST_GeomFromTWKB">ST_GeomFromTWKB</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_GeomFromWKB" title="ST_GeomFromWKB">ST_GeomFromWKB</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_GeometricMedian" title="ST_GeometricMedian">ST_GeometricMedian </a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_GeometryFromText" title="ST_GeometryFromText">ST_GeometryFromText</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_GeometryN" title="ST_GeometryN">ST_GeometryN</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_GeometryType" title="ST_GeometryType">ST_GeometryType</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Geometry_Above" title="|&gt;&gt;">|&gt;&gt;</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Geometry_Below" title="&lt;&lt;|">&lt;&lt;|</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Geometry_Contain" title="~">~</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Geometry_Contained" title="@">@</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Geometry_EQ" title="=">=</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Geometry_Left" title="&lt;&lt;">&lt;&lt;</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Geometry_Overabove" title="|&amp;&gt;">|&amp;&gt;</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Geometry_Overbelow" title="&amp;&lt;|">&amp;&lt;|</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Geometry_Overleft" title="&amp;&lt;">&amp;&lt;</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Geometry_Overright" title="&amp;&gt;">&amp;&gt;</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Geometry_Right" title="&gt;&gt;">&gt;&gt;</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Geometry_Same" title="~=">~=</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_HasArc" title="ST_HasArc">ST_HasArc</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_HausdorffDistance" title="ST_HausdorffDistance">ST_HausdorffDistance</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_InteriorRingN" title="ST_InteriorRingN">ST_InteriorRingN</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_InterpolatePoint" title="ST_InterpolatePoint">ST_InterpolatePoint</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Intersection" title="ST_Intersection">ST_Intersection</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_transform.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_enhanced.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Intersects" title="ST_Intersects">ST_Intersects</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_enhanced.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_IsClosed" title="ST_IsClosed">ST_IsClosed</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_IsCollection" title="ST_IsCollection">ST_IsCollection</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_IsEmpty" title="ST_IsEmpty">ST_IsEmpty</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_IsPlanar" title="ST_IsPlanar">ST_IsPlanar</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_IsPolygonCCW" title="ST_IsPolygonCCW">ST_IsPolygonCCW </a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_IsPolygonCW" title="ST_IsPolygonCW">ST_IsPolygonCW </a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_IsRing" title="ST_IsRing">ST_IsRing</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_IsSimple" title="ST_IsSimple">ST_IsSimple</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_IsSolid" title="ST_IsSolid">ST_IsSolid</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_IsValid" title="ST_IsValid">ST_IsValid</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_IsValidDetail" title="ST_IsValidDetail">ST_IsValidDetail</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_IsValidReason" title="ST_IsValidReason">ST_IsValidReason</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_IsValidTrajectory" title="ST_IsValidTrajectory">ST_IsValidTrajectory</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Length" title="ST_Length">ST_Length</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_enhanced.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Length2D" title="ST_Length2D">ST_Length2D</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Length2D_Spheroid" title="ST_Length2D_Spheroid">ST_Length2D_Spheroid</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Length_Spheroid" title="ST_LengthSpheroid">ST_LengthSpheroid</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_LineCrossingDirection" title="ST_LineCrossingDirection">ST_LineCrossingDirection</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_LineFromEncodedPolyline" title="ST_LineFromEncodedPolyline">ST_LineFromEncodedPolyline</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_LineFromMultiPoint" title="ST_LineFromMultiPoint">ST_LineFromMultiPoint</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_LineFromText" title="ST_LineFromText">ST_LineFromText</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_LineFromWKB" title="ST_LineFromWKB">ST_LineFromWKB</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_LineInterpolatePoint" title="ST_LineInterpolatePoint">ST_LineInterpolatePoint</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_LineInterpolatePoints" title="ST_LineInterpolatePoints">ST_LineInterpolatePoints</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_LineLocatePoint" title="ST_LineLocatePoint">ST_LineLocatePoint</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_LineMerge" title="ST_LineMerge">ST_LineMerge</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_LineSubstring" title="ST_LineSubstring">ST_LineSubstring</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_LineToCurve" title="ST_LineToCurve">ST_LineToCurve</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_LinestringFromWKB" title="ST_LinestringFromWKB">ST_LinestringFromWKB</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_LocateAlong" title="ST_LocateAlong">ST_LocateAlong</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_LocateBetween" title="ST_LocateBetween">ST_LocateBetween</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_LocateBetweenElevations" title="ST_LocateBetweenElevations">ST_LocateBetweenElevations</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_LongestLine" title="ST_LongestLine">ST_LongestLine</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_M" title="ST_M">ST_M</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_MLineFromText" title="ST_MLineFromText">ST_MLineFromText</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_MPointFromText" title="ST_MPointFromText">ST_MPointFromText</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_MPolyFromText" title="ST_MPolyFromText">ST_MPolyFromText</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_MakeBox2D" title="ST_MakeBox2D">ST_MakeBox2D</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_MakeEnvelope" title="ST_MakeEnvelope">ST_MakeEnvelope</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_MakeLine" title="ST_MakeLine">ST_MakeLine</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_MakePoint" title="ST_MakePoint">ST_MakePoint</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_MakePointM" title="ST_MakePointM">ST_MakePointM</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_MakePolygon" title="ST_MakePolygon">ST_MakePolygon</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_MakeSolid" title="ST_MakeSolid">ST_MakeSolid</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_MakeValid" title="ST_MakeValid">ST_MakeValid</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_MaxDistance" title="ST_MaxDistance">ST_MaxDistance</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_MemSize" title="ST_MemSize">ST_MemSize</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_MemUnion" title="ST_MemUnion">ST_MemUnion</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_MinimumBoundingCircle" title="ST_MinimumBoundingCircle">ST_MinimumBoundingCircle</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_MinimumBoundingRadius" title="ST_MinimumBoundingRadius">ST_MinimumBoundingRadius</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_MinimumClearance" title="ST_MinimumClearance">ST_MinimumClearance</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_MinimumClearanceLine" title="ST_MinimumClearanceLine">ST_MinimumClearanceLine</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_MinkowskiSum" title="ST_MinkowskiSum">ST_MinkowskiSum</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Multi" title="ST_Multi">ST_Multi</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_NDims" title="ST_NDims">ST_NDims</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_NPoints" title="ST_NPoints">ST_NPoints</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_NRings" title="ST_NRings">ST_NRings</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Node" title="ST_Node">ST_Node</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Normalize" title="ST_Normalize">ST_Normalize</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_NumGeometries" title="ST_NumGeometries">ST_NumGeometries</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_NumInteriorRing" title="ST_NumInteriorRing">ST_NumInteriorRing</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_NumInteriorRings" title="ST_NumInteriorRings">ST_NumInteriorRings</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_NumPatches" title="ST_NumPatches">ST_NumPatches</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_NumPoints" title="ST_NumPoints">ST_NumPoints</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_OffsetCurve" title="ST_OffsetCurve">ST_OffsetCurve</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_OrderingEquals" title="ST_OrderingEquals">ST_OrderingEquals</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Orientation" title="ST_Orientation">ST_Orientation</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_OrientedEnvelope" title="ST_OrientedEnvelope">ST_OrientedEnvelope</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Overlaps" title="ST_Overlaps">ST_Overlaps</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_PatchN" title="ST_PatchN">ST_PatchN</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Perimeter" title="ST_Perimeter">ST_Perimeter</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Perimeter2D" title="ST_Perimeter2D">ST_Perimeter2D</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Point" title="ST_Point">ST_Point</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_PointFromGeoHash" title="ST_PointFromGeoHash">ST_PointFromGeoHash</a>
              </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_PointFromText" title="ST_PointFromText">ST_PointFromText</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_PointFromWKB" title="ST_PointFromWKB">ST_PointFromWKB</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_PointN" title="ST_PointN">ST_PointN</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_PointOnSurface" title="ST_PointOnSurface">ST_PointOnSurface</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Point_Inside_Circle" title="ST_PointInsideCircle">ST_PointInsideCircle</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Points" title="ST_Points">ST_Points</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Polygon" title="ST_Polygon">ST_Polygon</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_PolygonFromText" title="ST_PolygonFromText">ST_PolygonFromText</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Polygonize" title="ST_Polygonize">ST_Polygonize</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Project" title="ST_Project">ST_Project</a>
              </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_QuantizeCoordinates" title="ST_QuantizeCoordinates">ST_QuantizeCoordinates </a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Relate" title="ST_Relate">ST_Relate</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_RelateMatch" title="ST_RelateMatch">ST_RelateMatch</a>
              </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_RemovePoint" title="ST_RemovePoint">ST_RemovePoint</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_RemoveRepeatedPoints" title="ST_RemoveRepeatedPoints">ST_RemoveRepeatedPoints</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Reverse" title="ST_Reverse">ST_Reverse</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Rotate" title="ST_Rotate">ST_Rotate</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_RotateX" title="ST_RotateX">ST_RotateX</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_RotateY" title="ST_RotateY">ST_RotateY</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_RotateZ" title="ST_RotateZ">ST_RotateZ</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_SRID" title="ST_SRID">ST_SRID</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Scale" title="ST_Scale">ST_Scale</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_Segmentize" title="ST_Segmentize">ST_Segmentize</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_SetEffectiveArea" title="ST_SetEffectiveArea">ST_SetEffectiveArea</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_SetPoint" title="ST_SetPoint">ST_SetPoint</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_SetSRID" title="ST_SetSRID">ST_SetSRID</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_SharedPaths" title="ST_SharedPaths">ST_SharedPaths</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Shift_Longitude" title="ST_ShiftLongitude">ST_ShiftLongitude</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_ShortestLine" title="ST_ShortestLine">ST_ShortestLine</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Simplify" title="ST_Simplify">ST_Simplify</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_SimplifyPreserveTopology" title="ST_SimplifyPreserveTopology">ST_SimplifyPreserveTopology</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_SimplifyVW" title="ST_SimplifyVW">ST_SimplifyVW</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Snap" title="ST_Snap">ST_Snap</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_SnapToGrid" title="ST_SnapToGrid">ST_SnapToGrid</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Split" title="ST_Split">ST_Split</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_StartPoint" title="ST_StartPoint">ST_StartPoint</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_StraightSkeleton" title="ST_StraightSkeleton">ST_StraightSkeleton</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_Subdivide" title="ST_Subdivide">ST_Subdivide</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Summary" title="ST_Summary">ST_Summary</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_SwapOrdinates" title="ST_SwapOrdinates">ST_SwapOrdinates</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_SymDifference" title="ST_SymDifference">ST_SymDifference</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Tesselate" title="ST_Tesselate">ST_Tesselate</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_Touches" title="ST_Touches">ST_Touches</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_TransScale" title="ST_TransScale">ST_TransScale</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Transform" title="ST_Transform">ST_Transform</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Translate" title="ST_Translate">ST_Translate</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_UnaryUnion" title="ST_UnaryUnion">ST_UnaryUnion</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Union" title="ST_Union">ST_Union</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Volume" title="ST_Volume">ST_Volume</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#ST_VoronoiLines" title="ST_VoronoiLines">ST_VoronoiLines</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_VoronoiPolygons" title="ST_VoronoiPolygons">ST_VoronoiPolygons</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_WKBToSQL" title="ST_WKBToSQL">ST_WKBToSQL</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_WKTToSQL" title="ST_WKTToSQL">ST_WKTToSQL</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Within" title="ST_Within">ST_Within</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_WrapX" title="ST_WrapX">ST_WrapX</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_X" title="ST_X">ST_X</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_XMax" title="ST_XMax">ST_XMax</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_autocast.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_XMin" title="ST_XMin">ST_XMin</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_autocast.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Y" title="ST_Y">ST_Y</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_YMax" title="ST_YMax">ST_YMax</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_autocast.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_YMin" title="ST_YMin">ST_YMin</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_autocast.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Z" title="ST_Z">ST_Z</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_ZMax" title="ST_ZMax">ST_ZMax</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_autocast.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_ZMin" title="ST_ZMin">ST_ZMin</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_autocast.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#ST_Zmflag" title="ST_Zmflag">ST_Zmflag</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#contains_box2df_box2df" title="~(box2df,box2df)">~(box2df,box2df)</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_autocast.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#contains_box2df_geometry" title="~(box2df,geometry)">~(box2df,geometry)</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#contains_geometry_box2df" title="~(geometry,box2df)">~(geometry,box2df)</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#geometry_distance_box" title="&lt;#&gt;">&lt;#&gt;</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#geometry_distance_box_nd" title="&lt;&lt;#&gt;&gt;">&lt;&lt;#&gt;&gt;</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#geometry_distance_centroid_nd" title="&lt;&lt;-&gt;&gt;">&lt;&lt;-&gt;&gt;</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#geometry_distance_cpa" title="|=|">|=|</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#geometry_distance_knn" title="&lt;-&gt;">&lt;-&gt;</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#geometry_overlaps" title="&amp;&amp;">&amp;&amp;</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#geometry_overlaps_nd" title="&amp;&amp;&amp;">&amp;&amp;&amp;</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#is_contained_box2df_box2df" title="@(box2df,box2df)">@(box2df,box2df)</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_autocast.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#is_contained_box2df_geometry" title="@(box2df,geometry)">@(box2df,geometry)</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#is_contained_geometry_box2df" title="@(geometry,box2df)">@(geometry,box2df)</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#overlaps_box2df_box2df" title="&amp;&amp;(box2df,box2df)">&amp;&amp;(box2df,box2df)</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_autocast.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#overlaps_box2df_geometry" title="&amp;&amp;(box2df,geometry)">&amp;&amp;(box2df,geometry)</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#overlaps_geometry_box2df" title="&amp;&amp;(geometry,box2df)">&amp;&amp;(geometry,box2df)</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#overlaps_nd_geometry_gidx" title="&amp;&amp;&amp;(geometry,gidx)">&amp;&amp;&amp;(geometry,gidx)</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#overlaps_nd_gidx_geometry" title="&amp;&amp;&amp;(gidx,geometry)">&amp;&amp;&amp;(gidx,geometry)</a>
              </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#overlaps_nd_gidx_gidx" title="&amp;&amp;&amp;(gidx,gidx)">&amp;&amp;&amp;(gidx,gidx)</a>
              </td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_checkmark.png"></span></td></tr><tr><td align="left">
                <a class="link" href="#postgis_backend" title="postgis.backend">postgis.backend</a>
              </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#postgis_enable_outdb_rasters" title="postgis.enable_outdb_rasters">postgis.enable_outdb_rasters</a>
              </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#postgis_gdal_datapath" title="postgis.gdal_datapath">postgis.gdal_datapath</a>
              </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#postgis_gdal_enabled_drivers" title="postgis.gdal_enabled_drivers">postgis.gdal_enabled_drivers</a>
              </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">
                <a class="link" href="#postgis_sfcgal_version" title="postgis_sfcgal_version">postgis_sfcgal_version</a>
              </td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td align="center"> </td><td align="center"> </td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td><td align="center"><span class="inlinemediaobject"><img src="images/matrix_sfcgal_required.png"></span></td></tr></tbody></table></div><p>
    </p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="NewFunctions"></a>14.12. 新規作成/機能強化/変更されたPostGIS関数</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="#NewFunctions_2_5">14.12.1. PostGIS 2.5で新規作成/機能強化された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_2_4">14.12.2. PostGIS 2.4で新規作成/機能強化された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_2_3">14.12.3. PostGIS 2.3で新規作成/機能強化された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_2_2">14.12.4. PostGIS 2.2で新規作成/機能強化された関数</a></span></dt><dt><span class="sect2"><a href="#ChangedFunctions_2_2">14.12.5. PostGIS 2.2で大幅に変更された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_2_1">14.12.6. PostGIS 2.1で新規作成/機能強化された関数</a></span></dt><dt><span class="sect2"><a href="#ChangedFunctions_2_1">14.12.7. PostGIS 2.1で大幅に変更された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_2_0">14.12.8. PostGIS 2.0で新規作成/機能強化/変更された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_2_0_Changed">14.12.9. PostGIS 2.0で変更された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_1_5">14.12.10. PostGIS 1.5で新規作成/機能強化/変更された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_1_4">14.12.11. PostGIS 1.4で新規作成/機能強化/変更された関数</a></span></dt><dt><span class="sect2"><a href="#NewFunctions_1_3">14.12.12. PostGIS 1.3で新規作成された関数</a></span></dt></dl></div>
+            <div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="NewFunctions_2_5"></a>14.12.1. PostGIS 2.5で新規作成/機能強化された関数</h3></div></div></div><p>次に示す関数は、新規作成または機能強化されたPostGIS関数です。</p><p>PostGIS 2.5で新規作成された関数</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#PostGIS_Extensions_Upgrade" title="PostGIS_Extensions_Upgrade">PostGIS_Extensions_Upgrade</a> - Availability: 2.5.0 インストールされたPostGISエクステンション (例: postgis_sfcgal, postgis_topology, postgis_tiger_geocoder)について、インストールされている最新版にアップグレードします。その後、完全なPostGISの版とビルド時のコンフィギュレーション情報を報告します。</li><li class="listitem"><a class="link" href="#ST_Angle" title="ST_Angle">ST_Angle</a> - Availability: 2.5.0 三つのポイントまたは二つのベクタ (4ポイントまたは2ライン)の間の角度を返します。</li><li class="listitem"><a class="link" href="#RT_ST_AsHexWKB" title="ST_AsHexWKB">ST_AsHexWKB</a> - Availability: 2.5.0  Well-Known Binary (WKB)ラスタを16進数表現で返します。</li><li class="listitem"><a class="link" href="#RT_ST_BandFileSize" title="ST_BandFileSize">ST_BandFileSize</a> - Availability: 2.5.0 ファイルシステムに格納されているバンドのファイルサイズを返します。バンド番号が指定されていない場合には、1番と仮定します。</li><li class="listitem"><a class="link" href="#RT_ST_BandFileTimestamp" title="ST_BandFileTimestamp">ST_BandFileTimestamp</a> - Availability: 2.5.0 ファイルシステムに格納されているバンドのファイルタイムスタンプ返します。バンド番号が指定されていない場合には、1番と仮定します。</li><li class="listitem"><a class="link" href="#ST_ChaikinSmoothing" title="ST_ChaikinSmoothing">ST_ChaikinSmoothing</a> - Availability: 2.5.0 チャイキンのアルゴリズムを使って、与えられたジオメトリが「平滑化された」ものを返します。</li><li class="listitem"><a class="link" href="#ST_FilterByM" title="ST_FilterByM">ST_FilterByM</a> - Availability: 2.5.0 M値に基づく頂点のフィルタリングを行います。</li><li class="listitem"><a class="link" href="#RT_ST_Grayscale" title="ST_Grayscale">ST_Grayscale</a> - Availability: 2.5.0  元のラスタと指定したバンドを赤、緑、青バンドとして一つの8BUIバンドを持つラスタを生成します。</li><li class="listitem"><a class="link" href="#ST_LineInterpolatePoints" title="ST_LineInterpolatePoints">ST_LineInterpolatePoints</a> - Availability: 2.5.0 線に沿った内挿点を一つ以上返します。</li><li class="listitem"><a class="link" href="#ST_OrientedEnvelope" title="ST_OrientedEnvelope">ST_OrientedEnvelope</a> - Availability: 2.5.0  ジオメトリを囲む最小の回転した四角形を返します。</li><li class="listitem"><a class="link" href="#ST_QuantizeCoordinates" title="ST_QuantizeCoordinates">ST_QuantizeCoordinates </a> - Availability: 2.5.0 座標値の最下位ビットを0にします。</li><li class="listitem"><a class="link" href="#RT_ST_RastFromHexWKB" title="ST_RastFromHexWKB">ST_RastFromHexWKB</a> - Availability: 2.5.0 Well-Knownバイナリ (WKB)ラスタの16進数表現からラスタを返します。</li><li class="listitem"><a class="link" href="#RT_ST_RastFromWKB" title="ST_RastFromWKB">ST_RastFromWKB</a> - Availability: 2.5.0 Well-Known Binary (WKB)ラスタからラスタ値を返します。</li><li class="listitem"><a class="link" href="#RT_ST_SetBandIndex" title="ST_SetBandIndex">ST_SetBandIndex</a> - Availability: 2.5.0 データベース外バンドの外部バンド番号の更新</li><li class="listitem"><a class="link" href="#RT_ST_SetBandPath" title="ST_SetBandPath">ST_SetBandPath</a> - Availability: 2.5.0 データベース外バンドの外部パスとバンド番号を更新します。</li></ul></div><p>PostGIS 2.5で機能強化された関数</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#RT_ST_AsBinary" title="ST_AsBinary/ST_AsWKB">ST_AsBinary/ST_AsWKB</a> - Enhanced: 2.5.0 ST_AsWKBの追加 ラスタのWell-Known Binary (WKB)表現を返します。</li><li class="listitem"><a class="link" href="#ST_AsMVT" title="ST_AsMVT">ST_AsMVT</a> - Enhanced: 2.5.0 - パラレルクエリ対応が追加されました。 行集合のMapbox Vector Tile表現を返します。</li><li class="listitem"><a class="link" href="#ST_AsText" title="ST_AsText">ST_AsText</a> - Enhanced: 2.5 - 任意パラメータprecisionが導入されました。 ジオメトリ/ジオグラフィのSRIDメタデータのないWell-Known Text (WKT)表現を返します。</li><li class="listitem"><a class="link" href="#RT_ST_BandMetaData" title="ST_BandMetaData">ST_BandMetaData</a> - Enhanced: 2.5.0 outdbラスタにoutdbbandnum, filesizeとfiletimestampを取り入れました。 指定したラスタバンドの基本的なメタデータを返します。バンド番号を指定しない場合には、1番と仮定します。</li><li class="listitem"><a class="link" href="#ST_Buffer" title="ST_Buffer">ST_Buffer</a> - Enhanced: 2.5.0 - ST_Bufferジオメトリ対応において、side=both|left|rightでバッファ方向を指定できるようになりました。 (T) このジオメトリからの距離が指定された距離以下となる点全てを表現するジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_GeomFromGeoJSON" title="ST_GeomFromGeoJSON">ST_GeomFromGeoJSON</a> - Enhanced: 2.5.0 JSONとJSONBの入力を受け付けるようになりました。 ジオメトリのGeoJSON表現を入力として、PostGISジオメトリオブジェクトを出力します。</li><li class="listitem"><a class="link" href="#ST_GeometricMedian" title="ST_GeometricMedian">ST_GeometricMedian </a> - Enhanced: 2.5.0 ポイントの重みとしてのM値の対応が追加されました。 マルチポイントの幾何学的中央値を返します。</li><li class="listitem"><a class="link" href="#ST_Intersects" title="ST_Intersects">ST_Intersects</a> - Enhanced: 2.5.0 ジオメトリコレクションに対応しました。 ジオメトリ/ジオグラフィが「2次元空間で空間的にインタセクトする」 (空間に共有部分がある)場合にTRUEを返します。そうでない (非接続)場合はFALSEを返します。ジオグラフィについては、許容量は0.00001メートルです (近い点はインタセクトと考えられてしまいます)。</li><li class="listitem"><a class="link" href="#ST_OffsetCurve" title="ST_OffsetCurve">ST_OffsetCurve</a> - Enhanced: 2.5 - GEOMETRYCOLLECTIONとMULTILINESTRINGに対応するようになりました。  与えられた距離と方面に入力ラインをずらしたラインを返します。中心線と平行する線を引く際に使えます。</li><li class="listitem"><a class="link" href="#ST_Split" title="ST_Split">ST_Split</a> - Enhanced: 2.5.0 マルチラインによるポリゴン分割への対応が導入されました。 ジオメトリを分割したジオメトリのコレクションを返します。</li><li class="listitem"><a class="link" href="#ST_Subdivide" title="ST_Subdivide">ST_Subdivide</a> - Enhanced: 2.5.0 ポリゴン分割で存在するポイントの再利用、頂点数の最小値を8から5に変更。 指定した数より多い頂点を持たないジオメトリの集合を返します。</li></ul></div><p>PostGIS 2.5で変更された関数</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#RT_ST_GDALDrivers" title="ST_GDALDrivers">ST_GDALDrivers</a> - Changed: 2.5.0 - can_readカラムとcan_writeカラムを追加 使用しているGDALライブラリが対応するラスタ書式の一覧を返します。この一覧でcan_write=TrueとなっているものだけがST_AsGDALRasterで使えます。</li></ul></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="NewFunctions_2_4"></a>14.12.2. PostGIS 2.4で新規作成/機能強化された関数</h3></div></div></div><p>次に示す関数は、新規作成または機能強化されたPostGIS関数です。</p><p>PostGIS 2.4で新規作成された関数</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#ST_AsGeobuf" title="ST_AsGeobuf">ST_AsGeobuf</a> - Availability: 2.4.0 行集合のGeobuf表現を返します。</li><li class="listitem"><a class="link" href="#ST_AsMVT" title="ST_AsMVT">ST_AsMVT</a> - Availability: 2.4.0 行集合のMapbox Vector Tile表現を返します。</li><li class="listitem"><a class="link" href="#ST_AsMVTGeom" title="ST_AsMVTGeom">ST_AsMVTGeom</a> - Availability: 2.4.0 ジオメトリをMapbox Vector Tileの座標空間に変換します。</li><li class="listitem"><a class="link" href="#ST_Centroid" title="ST_Centroid">ST_Centroid</a> - Availability: 2.4.0 ジオグラフィが導入されました。 ジオメトリの幾何学的重心を返します。</li><li class="listitem"><a class="link" href="#ST_FrechetDistance" title="ST_FrechetDistance">ST_FrechetDistance</a> - Availability: 2.4.0 - GEOS 3.7.0以上が必要です。 二つのジオメトリのフレシェ距離を返します。曲線の位置と点の並び順とを考慮に入れた曲線間の類似度を計測するものです。単位はジオメトリの空間参照系の単位です。</li><li class="listitem"><a class="link" href="#RT_ST_MakeEmptyCoverage" title="ST_MakeEmptyCoverage">ST_MakeEmptyCoverage</a> - Availability: 2.4.0  空のラスタタイルのグリッドでジオリファレンスを施されている領域を生成します。</li></ul></div><p>PostGIS 2.4で機能強化された関数</p><p>全てのPostGIS集約関数はパラレル安全のラベル付けが施されます。これにより、並列処理を使用できるクエリプランで使うことができるようになります。</p><p>PostGIS 2.4.1のpostgis_tiger_geocoderはTiger 2017データをロードするように設定されています。必要に応じて、zip code 5-digit tabulation (zcta)を<a class="xref" href="#Loader_Generate_Nation_Script" title="Loader_Generate_Nation_Script">Loader_Generate_Nation_Script</a>の一部としてロードすることができます。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#Loader_Generate_Nation_Script" title="Loader_Generate_Nation_Script">Loader_Generate_Nation_Script</a> - Enhanced: 2.4.1 ZCTA5 (Zip Code 5 Tabulation Area)ロード手順は修正され、有効になった時に、ZCTA5データは、国スクリプトのロードの一部として、zcta5_allという名前の単一テーブルにロードされます。 指定したプラットフォーム用の、国と州のルックアップテーブルをロードするシェルスクリプトを生成します。</li><li class="listitem"><a class="link" href="#Normalize_Address" title="Normalize_Address">Normalize_Address</a> - Enhanced: 2.4.0 norm_addyオブジェクトにzip4とaddress_alphanumericが追加されました。 文字列で住所が与えられると、道路後置辞、前置辞、正規化された種別、番地、ストリート名等をフィールドに分けて持つnorm_addy複合型を返します。tiger_geocoderに同梱されているルックアップデータで動作します (Tigerデータ自体は不要です)。</li><li class="listitem"><a class="link" href="#Pagc_Normalize_Address" title="Pagc_Normalize_Address文字列のストリート住所を与えると、道路後置辞、前置辞、標準タイプ、番地、ストリート名等を複数フィールドに分解して持つnorm_addy複合型を返します。この関数は、tiger_geocoder同梱のルックアップテーブルだけを使います (Tigerデータは不要です)。住所標準化エクステンションが必要です。">Pagc_Normalize_Address文字列のストリート住所を与えると、道路後置辞、前置辞、標準タイプ、番地、ストリート名等を複数フィールドに分解して持つnorm_addy複合型を返します。この関数は、tiger_geocoder同梱のルックアップテーブルだけを使います (Tigerデータは不要です)。住所標準化エクステンションが必要です。</a> - Enhanced: 2.4.0 norm_addyオブジェクトにzip4とaddress_alphanumericが追加されました。 文字列のストリート住所を与えると、道路後置辞、前置辞、標準タイプ、番地、ストリート名等を複数フィールドに分解して持つnorm_addy複合型を返します。この関数は、tiger_geocoder同梱のルックアップテーブルだけを使います (Tigerデータは不要です)。住所標準化エクステンションが必要です。</li><li class="listitem"><a class="link" href="#Reverse_Geocode" title="Reverse_Geocode">Reverse_Geocode</a> - Enhanced: 2.4.1 ZCTA5データセットを追加でロードする場合には、reverse_geocode関数は、特定の州データがロードされていなくても、州とZIPを解決することができます。ZTCA5データのロードに関する詳細についてはを参照して下さい。 登録されている空間参照系に基づくポイントジオメトリを引数に取り、理論的に可能性のある住所の配列と交差するストリートの配列を一つのレコードで返します。include_strnum_range = trueの場合には、交差するストリートに番地範囲を追加します。</li><li class="listitem"><a class="link" href="#ST_AsTWKB" title="ST_AsTWKB">ST_AsTWKB</a> - Enhanced: 2.4.0 メモリと実行速度の改善 TWKB (Tiny Well-Known Binary)としてジオメトリを出力します。</li><li class="listitem"><a class="link" href="#ST_Covers" title="ST_Covers">ST_Covers</a> - Enhanced: 2.4.0 ジオグラフィ型を使う形式においてポリゴンの中のポリゴンとポリゴンの中のラインストリングへの対応を追加 ジオメトリBにジオメトリAの外となるポイントが無い場合には、1 (TRUE)を返します。</li><li class="listitem"><a class="link" href="#ST_CurveToLine" title="ST_CurveToLine">ST_CurveToLine</a> - Enhanced: 2.4.0 最大距離差による許容範囲と最大角度による許容範囲に対応し、対称出力に対応しました。 CIRCULARSTRING/CURVEPOLYGONをLINESTRING/POLYGONに変換します。</li><li class="listitem"><a class="link" href="#ST_Project" title="ST_Project">ST_Project</a> - Enhanced: 2.4.0 負の距離と非正規化方位を許容するようになりました メートル単位の距離とラジアン単位の方位とを使って始点から算出されたPOINTを返します。</li><li class="listitem"><a class="link" href="#ST_Reverse" title="ST_Reverse">ST_Reverse</a> - Enhanced: 2.4.0 曲線対応が導入されました。 頂点の順序を逆にしたジオメトリを返します。</li></ul></div><p>PostGIS 2.4で変更された関数</p><p>全てのPostGIS集約関数はパラレル安全のラベル付けが施されます。これにより集約関数の削除と再作成が強制的に行われます。この際、ユーザ定義のビューまたはSQL関数がPostGIS集約関数に依っている場合に失敗することがあります。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#ST_Geometry_EQ" title="=">=</a> - Changed: 2.4.0, 以前の版では、ジオメトリ自体の等価性でなくバウンディングボックスが等価かどうかを見ていました。バウンディングボックスが等価かどうかを知る必要がある場合には、替わりにを使います。 ジオメトリ/ジオグラフィ Aの座標と座標の並び順がジオメトリ/ジオグラフィ Bと同じ場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#ST_Node" title="ST_Node">ST_Node</a> - Changed: 2.4.0 この関数は内部でGEOSUnaryUnionの替わりにGEOSNodeを使用しています。ラインストリングの並び順と方向がPostGIS 2.4より前のものと違うことになるかも知れません。  ラインストリングの集合にノードを作成します。</li></ul></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="NewFunctions_2_3"></a>14.12.3. PostGIS 2.3で新規作成/機能強化された関数</h3></div></div></div><p>次に示す関数は、新規作成または機能強化されたPostGIS関数です。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>PostGIS 2.3.0: PostgreSQL 9.6以上で、並列クエリに対応します。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>PostGIS 2.3.0:データベースのリストアにおける問題を低減するために、PostGISエクステンションの全ての関数に対してスキーマ修飾を可能にしました。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>PostGIS 2.3.0: PostgreSQL 9.4以上で、BRINインデックスに対応します。<a class="xref" href="#brin_indexes" title="4.6.2. BRINインデックス">「BRINインデックス」</a>を参照して下さい。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>PostGIS 2.3.0: Tigerジオコーダは、TIGER 2016データで動作するように更新されました。</p></td></tr></table></div><p>PostGIS 2.3で新規作成された関数</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#overlaps_nd_geometry_gidx" title="&amp;&amp;&amp;(geometry,gidx)">&amp;&amp;&amp;(geometry,gidx)</a> - Availability: 2.3.0 BRIN (Block Range INdexes)が導入されました。PostgreSQL 9.5以上が必要です。 ジオメトリの (キャッシュされている)n次元バウンディングボックスが単精度浮動小数点数によるn次元バウンディングボックス (GIDX)とインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#overlaps_nd_gidx_geometry" title="&amp;&amp;&amp;(gidx,geometry)">&amp;&amp;&amp;(gidx,geometry)</a> - Availability: 2.3.0 BRIN (Block Range INdexes)が導入されました。PostgreSQL 9.5以上が必要です。 単精度浮動小数点数によるn次元バウンディングボックス (GIDX)がジオメトリの (キャッシュされている)n次元バウンディングボックスとインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#overlaps_nd_gidx_gidx" title="&amp;&amp;&amp;(gidx,gidx)">&amp;&amp;&amp;(gidx,gidx)</a> - Availability: 2.3.0 BRIN (Block Range INdexes)が導入されました。PostgreSQL 9.5以上が必要です。 二つの単精度浮動小数点数によるn次元バウンディングボックス (GIDX)が相互にインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#overlaps_box2df_box2df" title="&amp;&amp;(box2df,box2df)">&amp;&amp;(box2df,box2df)</a> - Availability: 2.3.0 BRIN (Block Range INdexes)が導入されました。PostgreSQL 9.5以上が必要です。 二つの単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)が相互にインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#overlaps_box2df_geometry" title="&amp;&amp;(box2df,geometry)">&amp;&amp;(box2df,geometry)</a> - Availability: 2.3.0 BRIN (Block Range INdexes)が導入されました。PostgreSQL 9.5以上が必要です。 単精度浮動小数点数による2次元バウンディングボックスがジオメトリの (キャッシュされている)2次元バウンディングボックスとインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#overlaps_geometry_box2df" title="&amp;&amp;(geometry,box2df)">&amp;&amp;(geometry,box2df)</a> - Availability: 2.3.0 BRIN (Block Range INdexes)が導入されました。PostgreSQL 9.5以上が必要です。 ジオメトリの (キャッシュされている)2次元バウンディングボックスが単精度浮動小数点数による2次元バウンディングボックスとインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#is_contained_box2df_box2df" title="@(box2df,box2df)">@(box2df,box2df)</a> - Availability: 2.3.0 BRIN (Block Range INdexes)が導入されました。PostgreSQL 9.5以上が必要です。 二つの単精度浮動小数点数によるn次元バウンディングボックス (GIDX)の一方がもう一方を包含する場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#is_contained_box2df_geometry" title="@(box2df,geometry)">@(box2df,geometry)</a> - Availability: 2.3.0 BRIN (Block Range INdexes)が導入されました。PostgreSQL 9.5以上が必要です。 単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)がジオメトリの2次元バウンディングボックスに包含される場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#is_contained_geometry_box2df" title="@(geometry,box2df)">@(geometry,box2df)</a> - Availability: 2.3.0 BRIN (Block Range INdexes)が導入されました。PostgreSQL 9.5以上が必要です。 ジオメトリの2次元バウンディングボックスが単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)に包含される場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#Populate_Topology_Layer" title="Populate_Topology_Layer">Populate_Topology_Layer</a> - Availability: 2.3.0 テーブルからメタデータを読み、topology.layerテーブルに不足しているものを追加します。</li><li class="listitem"><a class="link" href="#ST_ClusterDBSCAN" title="ST_ClusterDBSCAN">ST_ClusterDBSCAN</a> - Availability: 2.3.0 - GEOSが必要です。  DBSCAN (ノイズ適用可能な密度に基づいた空間クラスタリング)アルゴリズムの2次元実装に基づいて、それぞれの入力ジオメトリが入るクラスタの整数識別子を返すウィンドウ関数です。</li><li class="listitem"><a class="link" href="#ST_ClusterKMeans" title="ST_ClusterKMeans">ST_ClusterKMeans</a> - Availability: 2.3.0 - GEOSが必要です。  個々のジオメトリが入るクラスタの整数識別子を返すウィンドウ関数です。</li><li class="listitem"><a class="link" href="#ST_GeneratePoints" title="ST_GeneratePoints">ST_GeneratePoints</a> - Availability: 2.3.0 ポリゴンまたはマルチポリゴンから、元の領域の内部の、乱数で決められた位置に置かれた点からなるマルチポイントに変換します。</li><li class="listitem"><a class="link" href="#ST_GeometricMedian" title="ST_GeometricMedian">ST_GeometricMedian </a> - Availability: 2.3.0 マルチポイントの幾何学的中央値を返します。</li><li class="listitem"><a class="link" href="#ST_MakeLine" title="ST_MakeLine">ST_MakeLine</a> - Availability: 2.3.0 - マルチポイントの入力要素に対応するようになりました。 ポイント、マルチポイント、ラインジオメトリからラインストリングを生成します。</li><li class="listitem"><a class="link" href="#ST_MinimumBoundingRadius" title="ST_MinimumBoundingRadius">ST_MinimumBoundingRadius</a> - Availability: 2.3.0 ジオメトリを完全に包含する最小円の中心ポイントと半径を返します。</li><li class="listitem"><a class="link" href="#ST_MinimumClearance" title="ST_MinimumClearance">ST_MinimumClearance</a> - Availability: 2.3.0 - GEOS 3.6.0以上が必要です。 ジオメトリのクリアランスの最小値を返します。この値はジオメトリのロバスト性を示すものです。</li><li class="listitem"><a class="link" href="#ST_MinimumClearanceLine" title="ST_MinimumClearanceLine">ST_MinimumClearanceLine</a> - Availability: 2.3.0 - GEOS 3.6.0以上が必要です。 ジオメトリの最小クリアランスを示す、2点のラインストリングを返します。</li><li class="listitem"><a class="link" href="#ST_Normalize" title="ST_Normalize">ST_Normalize</a> - Availability: 2.3.0 標準的な形式に変えたジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_Points" title="ST_Points">ST_Points</a> - Availability: 2.3.0 ジオメトリの全ての座標値からなるマルチポイントを返します。</li><li class="listitem"><a class="link" href="#ST_VoronoiLines" title="ST_VoronoiLines">ST_VoronoiLines</a> - Availability: 2.3.0 - GEOS 3.5.0以上が必要です。 ジオメトリの頂点からボロノイ図のセル間の境界を返します。</li><li class="listitem"><a class="link" href="#ST_VoronoiPolygons" title="ST_VoronoiPolygons">ST_VoronoiPolygons</a> - Availability: 2.3.0 - GEOS 3.5.0以上が必要です。 ジオメトリの頂点からボロノイ図のセルを返します。</li><li class="listitem"><a class="link" href="#ST_WrapX" title="ST_WrapX">ST_WrapX</a> - Availability: 2.3.0 ジオメトリをX値で回り込ませます。</li><li class="listitem"><a class="link" href="#TopoGeom_addElement" title="TopoGeom_addElement">TopoGeom_addElement</a> - Availability: 2.3 TopoGeometryの定義に要素を追加します。</li><li class="listitem"><a class="link" href="#TopoGeom_remElement" title="TopoGeom_remElement">TopoGeom_remElement</a> - Availability: 2.3 TopoGeometryの定義から要素を削除します。</li><li class="listitem"><a class="link" href="#contains_box2df_box2df" title="~(box2df,box2df)">~(box2df,box2df)</a> - Availability: 2.3.0 BRIN (Block Range INdexes)が導入されました。PostgreSQL 9.5以上が必要です。 二つの単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)の一方がもう一方を包含する場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#contains_box2df_geometry" title="~(box2df,geometry)">~(box2df,geometry)</a> - Availability: 2.3.0 BRIN (Block Range INdexes)が導入されました。PostgreSQL 9.5以上が必要です。 単精度浮動小数点数による2次元バウンディングボックス (BOX2DF)をジオメトリの (キャッシュされている)2次元バウンディングボックスが包含する場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#contains_geometry_box2df" title="~(geometry,box2df)">~(geometry,box2df)</a> - Availability: 2.3.0 BRIN (Block Range INdexes)が導入されました。PostgreSQL 9.5以上が必要です。 ジオメトリの (キャッシュされている)2次元バウンディングボックスが単精度浮動小数点数によるn次元バウンディングボックス (GIDX)を包含する場合にTRUEを返します。</li></ul></div><p>PostGIS 2.3で機能強化された関数</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#ST_Contains" title="ST_Contains">ST_Contains</a> - Enhanced: 2.3.0 PIP short-circuit (ポリゴンとポイントに限定した高速判定)を少ないポイントからなるマルチポイントに対応することができるよう拡張しました。以前の版ではポリゴンとポイントの組み合わせにだけ対応していました。</li><li class="listitem"><a class="link" href="#ST_Covers" title="ST_Covers">ST_Covers</a> - Enhanced: 2.3.0 ジオメトリについて、PIP short-circuit (ポリゴンとポイントに限定した高速判定)を少ないポイントからなるマルチポイントに対応することができるよう拡張しました。以前の版ではポリゴンとポイントの組み合わせにだけ対応していました。</li><li class="listitem"><a class="link" href="#ST_Expand" title="ST_Expand">ST_Expand</a> - Enhanced: 2.3.0 異なる次元の異なる量によるボックスの拡張に対応するようになりました。</li><li class="listitem"><a class="link" href="#ST_Intersects" title="ST_Intersects">ST_Intersects</a> - Enhanced: 2.3.0 PIP short-circuit (ポリゴンとポイントに限定した高速判定)を少ないポイントからなるマルチポイントに対応することができるよう拡張しました。以前の版ではポリゴンとポイントの組み合わせにだけ対応していました。</li><li class="listitem"><a class="link" href="#ST_Segmentize" title="ST_Segmentize">ST_Segmentize</a> - Enhanced: 2.3.0 ジオグラフィの分割において、現在は、同じ長さに分割しています。</li><li class="listitem"><a class="link" href="#ST_Transform" title="ST_Transform">ST_Transform</a> - Enhanced: 2.3.0 直接のPROJ.4文字列への対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_Within" title="ST_Within">ST_Within</a> - Enhanced: 2.3.0 ジオメトリについて、PIP short-circuit (ポリゴンとポイントに限定した高速判定)を少ないポイントからなるマルチポイントに対応することができるよう拡張しました。以前の版ではポリゴンとポイントの組み合わせにだけ対応していました。</li></ul></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="NewFunctions_2_2"></a>14.12.4. PostGIS 2.2で新規作成/機能強化された関数</h3></div></div></div><p>次に示す関数は、追加または機能強化されたPostGIS関数です。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>postgis_sfcgalは、現在はエクステンションとしてインストールできます。CREATE EXTENSION postgis_sfcgal;とします。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>PostGIS 2.2.0:Tigerジオコーダは、TIGER 2015データで動作するように更新されました。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>住所正規化のための address_standardizer, address_standardizer_data_us エクステンションの詳細情報については<a class="xref" href="#Address_Standardizer" title="第12章 住所標準化">12章<i>住所標準化</i></a>を参照して下さい。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>トポロジの多くの関数は、性能向上のためにC関数で再記述されました。</p></td></tr></table></div><p>PostGIS 2.2で新規作成された関数</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#ST_3DDifference" title="ST_3DDifference">ST_3DDifference</a> - Availability: 2.2.0 3次元の差分を計算します。</li><li class="listitem"><a class="link" href="#ST_3DUnion" title="ST_3DUnion">ST_3DUnion</a> - Availability: 2.2.0 3次元の結合を計算します。</li><li class="listitem"><a class="link" href="#ST_ApproximateMedialAxis" title="ST_ApproximateMedialAxis">ST_ApproximateMedialAxis</a> - Availability: 2.2.0 面ジオメトリの近似的な中心軸を計算します。</li><li class="listitem"><a class="link" href="#ST_AsEncodedPolyline" title="ST_AsEncodedPolyline">ST_AsEncodedPolyline</a> - Availability: 2.2.0 ラインストリングジオメトリから符号化したポリラインを返します。</li><li class="listitem"><a class="link" href="#ST_AsTWKB" title="ST_AsTWKB">ST_AsTWKB</a> - Availability: 2.2.0 TWKB (Tiny Well-Known Binary)としてジオメトリを出力します。</li><li class="listitem"><a class="link" href="#ST_BoundingDiagonal" title="ST_BoundingDiagonal">ST_BoundingDiagonal</a> - Availability: 2.2.0 与えられたジオメトリのバウンディングボックスの対角線を返します。</li><li class="listitem"><a class="link" href="#ST_ClipByBox2D" title="ST_ClipByBox2D">ST_ClipByBox2D</a> - Availability: 2.2.0 - GEOS 3.5.0以上が必要です。 長方形内に落ちるジオメトリの一部を返します。</li><li class="listitem"><a class="link" href="#ST_ClusterIntersecting" title="ST_ClusterIntersecting">ST_ClusterIntersecting</a> - Availability: 2.2.0 - GEOSが必要です。  集約関数です。ジオメトリの集合の接続された要素の配列を返します。</li><li class="listitem"><a class="link" href="#ST_ClusterWithin" title="ST_ClusterWithin">ST_ClusterWithin</a> - Availability: 2.2.0 - GEOSが必要です。 集計関数です。ジオメトリコレクションの配列を返します。要素は、指定した距離以内となるよう分けられたジオメトリの集合です。</li><li class="listitem"><a class="link" href="#RT_ST_CountAgg" title="ST_CountAgg">ST_CountAgg</a> - Availability: 2.2.0  集約関数です。ラスタ集合の与えられたバンドのピクセル数を返します。バンドが指定されていない場合には、1番と仮定します。exclude_nodata_valueをTRUEに設定している場合には、NODATA値と等しくないピクセルのみを数えます。</li><li class="listitem"><a class="link" href="#RT_CreateOverview" title="ST_CreateOverview">ST_CreateOverview</a> - Availability: 2.2.0 与えられたラスタカバレッジから解像度を落としたものを生成します。</li><li class="listitem"><a class="link" href="#ST_ForceCurve" title="ST_ForceCurve">ST_ForceCurve</a> - Availability: 2.2.0 該当する場合は、ジオメトリを曲線タイプに変換します。</li><li class="listitem"><a class="link" href="#ST_IsPlanar" title="ST_IsPlanar">ST_IsPlanar</a> - Availability: 2.2.0: これは2.1.0のマニュアルに記述されていましたが、2.1版では偶然に外れてしまいました。 サーフェスが平面であるかないかをチェックします。</li><li class="listitem"><a class="link" href="#ST_IsSolid" title="ST_IsSolid">ST_IsSolid</a> - Availability: 2.2.0 ジオメトリが立体であるかどうかをテストします。妥当性チェックは行いません。</li><li class="listitem"><a class="link" href="#ST_LineFromEncodedPolyline" title="ST_LineFromEncodedPolyline">ST_LineFromEncodedPolyline</a> - Availability: 2.2.0 エンコード化ポリラインからラインストリングを生成します。</li><li class="listitem"><a class="link" href="#ST_MakeSolid" title="ST_MakeSolid">ST_MakeSolid</a> - Availability: 2.2.0 ジオメトリを立体にキャストします。チェックはしません。妥当な立体を得るには、入力ジオメトリは閉じた多面体サーフェスか閉じたTINでなければなりません。</li><li class="listitem"><a class="link" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a> - Availability: 2.2.0: マスクが追加されました。 コールバック関数版 - 一つ以上の入力ラスタ、バンドインデクスと一つのユーザ定義コールバック関数から、一つのバンドからなるラスタを返します。</li><li class="listitem"><a class="link" href="#RT_ST_MemSize" title="ST_MemSize">ST_MemSize</a> - Availability: 2.2.0 ラスタが取る領域の合計をバイト単位で返します。</li><li class="listitem"><a class="link" href="#ST_RemoveRepeatedPoints" title="ST_RemoveRepeatedPoints">ST_RemoveRepeatedPoints</a> - Availability: 2.2.0 入力ジオメトリから重複ポイントを除いたものを返します。</li><li class="listitem"><a class="link" href="#RT_Retile" title="ST_Retile">ST_Retile</a> - Availability: 2.2.0 任意のタイル化されたラスタカバレッジから構成されたタイルの集合を返します。</li><li class="listitem"><a class="link" href="#ST_SetEffectiveArea" title="ST_SetEffectiveArea">ST_SetEffectiveArea</a> - Availability: 2.2.0 個々の頂点について有効範囲を設定し、M値として保存します。M値でフィルタリングすると、単純化したジオメトリを生成できます。</li><li class="listitem"><a class="link" href="#ST_SimplifyVW" title="ST_SimplifyVW">ST_SimplifyVW</a> - Availability: 2.2.0 Visvalingam-Whyattアルゴリズムを用いて、入力ジオメトリを「簡略化」したジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_Subdivide" title="ST_Subdivide">ST_Subdivide</a> - Availability: 2.2.0 GEOS 3.5.0以上が必要です。 指定した数より多い頂点を持たないジオメトリの集合を返します。</li><li class="listitem"><a class="link" href="#RT_ST_SummaryStatsAgg" title="ST_SummaryStatsAgg">ST_SummaryStatsAgg</a> - Availability: 2.2.0  集約関数です。ラスタ集合の指定したバンドについて、ピクセル数、合計値、平均値、標準偏差、最小値、最大値からなる統計情報の概要を返します。バンドを指定しない場合には、1番と仮定します。</li><li class="listitem"><a class="link" href="#ST_SwapOrdinates" title="ST_SwapOrdinates">ST_SwapOrdinates</a> - Availability: 2.2.0 与えられたジオメトリにおいて与えられた座標の値を入れ替えたジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_Volume" title="ST_Volume">ST_Volume</a> - Availability: 2.2.0 3次元立体の体積を計算します。面ジオメトリは (閉じていても)0を返します。</li><li class="listitem"><a class="link" href="#postgis_enable_outdb_rasters" title="postgis.enable_outdb_rasters">postgis.enable_outdb_rasters</a> - Availability: 2.2.0 データベース外ラスタのバンドにアクセスできるようにする、真偽型のコンフィギュレーションオプション。</li><li class="listitem"><a class="link" href="#postgis_gdal_datapath" title="postgis.gdal_datapath">postgis.gdal_datapath</a> - Availability: 2.2.0 GDALのGDAL_DATAオプションの値を設定するためのコンフィギュレーションオプションです。設定しない場合には、GDAL_DATA環境変数が使われます。</li><li class="listitem"><a class="link" href="#postgis_gdal_enabled_drivers" title="postgis.gdal_enabled_drivers">postgis.gdal_enabled_drivers</a> - Availability: 2.2.0 PostGIS環境でGDALドライバを有効にするコンフィギュレーションオプションです。GDALコンフィギュレーション変数GDAL_SKIPに影響を与えます。</li></ul></div><p>PostGIS 2.2で機能強化された関数</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#AsTopoJSON" title="AsTopoJSON">AsTopoJSON</a> - Enhanced: 2.2.1 点入力に対応するようになりました</li><li class="listitem"><a class="link" href="#ST_Area" title="ST_Area">ST_Area</a> - Enhanced: 2.2.0 - 精度とロバスト性の向上のためにGeographicLibを使って回転楕円体面上での計測を行うようにしています。この新機能を使うには、Proj 4.9.0以上が必要です。</li><li class="listitem"><a class="link" href="#ST_AsX3D" title="ST_AsX3D">ST_AsX3D</a> - Enhanced: 2.2.0: GeoCoordinatesと軸 (x/y, 経度/緯度)の反転に対応しました。詳細はoptionsを見て下さい。</li><li class="listitem"><a class="link" href="#ST_Azimuth" title="ST_Azimuth">ST_Azimuth</a> - Enhanced: 2.2.0 精度とロバスト性向上のために回転楕円体面上の計測をGeographicLibで行うようにしました。この新機能を使うには、Proj 4.9.0以上が必要です。</li><li class="listitem"><a class="link" href="#ST_Distance" title="ST_Distance">ST_Distance</a> - Enhanced: 2.2.0 - 精度とロバスト性の向上のためにGeographicLibを使って回転楕円体面上での計測を行うようにしています。この新機能を使うには、Proj 4.9.0以上が必要です。</li><li class="listitem"><a class="link" href="#ST_Scale" title="ST_Scale">ST_Scale</a> - Enhanced: 2.2.0 全ての次元の拡大縮小の対応 (ジオメトリによる引数指定)を導入しました</li><li class="listitem"><a class="link" href="#ST_Split" title="ST_Split">ST_Split</a> - Enhanced: 2.2.0 マルチライン、マルチポイントおよびポリゴン並びにマルチポリゴンの境界によるラインの分割への対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_Summary" title="ST_Summary">ST_Summary</a> - Enhanced: 2.2.0 TINと曲線の対応が追加されました。</li><li class="listitem"><a class="link" href="#geometry_distance_knn" title="&lt;-&gt;">&lt;-&gt;</a> - Enhanced: 2.2.0 ジオメトリとジオグラフィとのKNN (k近傍法)の動作が本当のものになりました。ジオグラフィのKNNは回転楕円体面上でなく球面上の計算となることに注意して下さい。PostgreSQL 9.4以下では、ジオグラフィに対応していますが、バウンディングボックスの重心に対応するだけです。</li></ul></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="ChangedFunctions_2_2"></a>14.12.5. PostGIS 2.2で大幅に変更された関数</h3></div></div></div><p>次に示す関数は、PostGIS 2.2で、たぶん大幅に変更されたものです。これらを使用している場合には、既存のコードを確認する必要があるかも知れません。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#Get_Geocode_Setting" title="Get_Geocode_Setting">Get_Geocode_Setting</a> - Changed: 2.2.0 : デフォルト設定をgeocode_settingsに保存するようにしました。ユーザが設定したものだけがgeocode_settings内にあります。</li><li class="listitem"><a class="link" href="#ST_3DClosestPoint" title="ST_3DClosestPoint">ST_3DClosestPoint</a> - Changed: 2.2.0 - 二つの2次元ジオメトリが入力である場合には、2次元ポイントが返ります (古い挙動では、存在しないZの値について0を仮定していました)。2次元と3次元の場合には、もはや、存在しないZの値について0を仮定しません。</li><li class="listitem"><a class="link" href="#ST_3DDistance" title="ST_3DDistance">ST_3DDistance</a> - Changed: 2.2.0 - 2次元と3次元の場合には、もはや、存在しないZの値について0を仮定しません。</li><li class="listitem"><a class="link" href="#ST_3DLongestLine" title="ST_3DLongestLine">ST_3DLongestLine</a> - Changed: 2.2.0 - 二つの2次元ジオメトリが入力である場合には、2次元ポイントが返ります (古い挙動では、存在しないZの値について0を仮定していました)。2次元と3次元の場合には、もはや、存在しないZの値について0を仮定しません。</li><li class="listitem"><a class="link" href="#ST_3DMaxDistance" title="ST_3DMaxDistance">ST_3DMaxDistance</a> - Changed: 2.2.0 - 2次元と3次元の場合には、もはや、存在しないZの値について0を仮定しません。</li><li class="listitem"><a class="link" href="#ST_3DShortestLine" title="ST_3DShortestLine">ST_3DShortestLine</a> - Changed: 2.2.0 - 二つの2次元ジオメトリが入力である場合には、2次元ポイントが返ります (古い挙動では、存在しないZの値について0を仮定していました)。2次元と3次元の場合には、もはや、存在しないZの値について0を仮定しません。</li><li class="listitem"><a class="link" href="#ST_DistanceSphere" title="ST_DistanceSphere">ST_DistanceSphere</a> - Changed: 2.2.0 前の版ではこの関数はST_Distance_Sphereと呼ばれていました。</li><li class="listitem"><a class="link" href="#ST_Distance_Spheroid" title="ST_DistanceSpheroid">ST_DistanceSpheroid</a> - Changed: 2.2.0 前の版ではST_Distance_Spheroidと呼ばれていました。</li><li class="listitem"><a class="link" href="#ST_Equals" title="ST_Equals">ST_Equals</a> - Changed: 2.2.0 この関数は、どちらのジオメトリも不正であっても、バイナリで同じ場合ならTRUEを返します。</li><li class="listitem"><a class="link" href="#ST_Length_Spheroid" title="ST_LengthSpheroid">ST_LengthSpheroid</a> - Changed: 2.2.0 前の版ではST_Length_Spheroidと呼ばれていました。また、ST_3DLength_Spheroidの別名でした。</li><li class="listitem"><a class="link" href="#ST_MemSize" title="ST_MemSize">ST_MemSize</a> - Changed: 2.2.0 命名規則に従うためにST_MemSizeに変更しました。以前の版では、この関数はST_Mem_Sizeと呼ばれていました。古い名前は非推奨ですが現在のところは有効です。</li><li class="listitem"><a class="link" href="#ST_Point_Inside_Circle" title="ST_PointInsideCircle">ST_PointInsideCircle</a> - Changed: 2.2.0 以前の版ではST_Point_Inside_Circleと呼ばれていました。</li><li class="listitem"><a class="link" href="#ValidateTopology" title="ValidateTopology">ValidateTopology</a> - Changed: 2.2.0 エラーの記述と矛盾しないように'edge crosses node'のid1とid2の値が入れ替わっています。</li><li class="listitem"><a class="link" href="#geometry_distance_knn" title="&lt;-&gt;">&lt;-&gt;</a> - Changed: 2.2.0 PostgreSQL 9.5では、古いハイブリッド書式は遅くなりる可能性があります。そのため、PostGIS 2.2以上かつPostgreSQL 9.5以上においてのみ動作させる場合には、そのやり方をり除きたくなるでしょう。</li></ul></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="NewFunctions_2_1"></a>14.12.6. PostGIS 2.1で新規作成/機能強化された関数</h3></div></div></div><p>次に示す関数は、追加または機能強化されたPostGIS関数です。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>トポロジの効率が改善されています。詳細情報については<a class="xref" href="#Topology" title="第11章 トポロジ">11章<i>トポロジ</i></a>を参照して下さい。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>バグ訂正 (特にバンド外ラスタ)、多くの新しい関数 (しばしばユーザが共通のタスクを果たすために記述するコードを短くできます)、ラスタ機能における大規模の速度改善があります。詳細情報については<a class="xref" href="#RT_reference" title="第9章 ラスタ リファレンス">9章<i>ラスタ リファレンス</i></a>を参照して下さい。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>PostGIS 2.1.0: Tigerジオコーダは、TIGER 2012データで動作するように更新されました。また、デバッグと格付け設定変更のために<code class="varname">geocode_settings</code>が追加され、ローダのロード量を抑制して、現在はロードするべきテーブルをダウンロードするだけになりました。PostGIS 2.1.1: Tigerジオコーダは、TIGER 2013データで動作するように更新されました。詳細情報については、<a class="xref" href="#Tiger_Geocoder" title="13.1. Tigerジオコーダ">「Tigerジオコーダ」</a>を参照して下さい。</p></td></tr></table></div><p>PostGIS 2.1で新規作成された関数</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#RT_Raster_EQ" title="=">=</a> - Availability: 2.1.0  AのバウンディングボックスがBのバウンディングボックスと同じ場合にTRUEを返します。倍精度浮動小数点数のバウンディングボックスを使います。</li><li class="listitem"><a class="link" href="#AsTopoJSON" title="AsTopoJSON">AsTopoJSON</a> - Availability: 2.1.0  opoGeometryのTopoJSON表現を返します。</li><li class="listitem"><a class="link" href="#Drop_Nation_Tables_Generate_Script" title="Drop_Nation_Tables_Generate_Script">Drop_Nation_Tables_Generate_Script</a> - Availability: 2.1.0 指定したスキーマ内のテーブルのうち、county_all, state_allまたは、county or stateを削除するスクリプトを生成します。</li><li class="listitem"><a class="link" href="#Get_Geocode_Setting" title="Get_Geocode_Setting">Get_Geocode_Setting</a> - Availability: 2.1.0 tiger.geocode_settingsテーブルに格納されている設定のうち指定したものの値を返します。</li><li class="listitem"><a class="link" href="#Loader_Generate_Nation_Script" title="Loader_Generate_Nation_Script">Loader_Generate_Nation_Script</a> - Availability: 2.1.0  指定したプラットフォーム用の、国と州のルックアップテーブルをロードするシェルスクリプトを生成します。</li><li class="listitem"><a class="link" href="#Pagc_Normalize_Address" title="Pagc_Normalize_Address文字列のストリート住所を与えると、道路後置辞、前置辞、標準タイプ、番地、ストリート名等を複数フィールドに分解して持つnorm_addy複合型を返します。この関数は、tiger_geocoder同梱のルックアップテーブルだけを使います (Tigerデータは不要です)。住所標準化エクステンションが必要です。">Pagc_Normalize_Address文字列のストリート住所を与えると、道路後置辞、前置辞、標準タイプ、番地、ストリート名等を複数フィールドに分解して持つnorm_addy複合型を返します。この関数は、tiger_geocoder同梱のルックアップテーブルだけを使います (Tigerデータは不要です)。住所標準化エクステンションが必要です。</a> - Availability: 2.1.0 文字列のストリート住所を与えると、道路後置辞、前置辞、標準タイプ、番地、ストリート名等を複数フィールドに分解して持つnorm_addy複合型を返します。この関数は、tiger_geocoder同梱のルックアップテーブルだけを使います (Tigerデータは不要です)。住所標準化エクステンションが必要です。</li><li class="listitem"><a class="link" href="#ST_3DArea" title="ST_3DArea">ST_3DArea</a> - Availability: 2.1.0 3次元の面ジオメトリの面積を計算します。立体の場合は0を返します。</li><li class="listitem"><a class="link" href="#ST_3DIntersection" title="ST_3DIntersection">ST_3DIntersection</a> - Availability: 2.1.0 3次元のインタセクトした (共有する)部分を計算します。</li><li class="listitem"><a class="link" href="#ST_Box2dFromGeoHash" title="ST_Box2dFromGeoHash">ST_Box2dFromGeoHash</a> - Availability: 2.1.0 GeoHash文字列からBOX2Dを返します。</li><li class="listitem"><a class="link" href="#RT_ST_ColorMap" title="ST_ColorMap">ST_ColorMap</a> - Availability: 2.1.0  元のラスタと指定したバンドから4個までの8BUIバンド (grayscale, RGB, RGBA)からなる新しいラスタを生成します。</li><li class="listitem"><a class="link" href="#RT_ST_Contains" title="ST_Contains">ST_Contains</a> - Availability: 2.1.0 rastAの外にrastBの点が無く、rastAの内部にrastBの内部の点が一つ以上ある場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#RT_ST_ContainsProperly" title="ST_ContainsProperly">ST_ContainsProperly</a> - Availability: 2.1.0 rastBがrastAの内部でインタセクトし、かつrastAの境界とも外部ともインタセクトしない場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#RT_ST_CoveredBy" title="ST_CoveredBy">ST_CoveredBy</a> - Availability: 2.1.0 rastAがrastBの外部に点を持たない場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#RT_ST_Covers" title="ST_Covers">ST_Covers</a> - Availability: 2.1.0 rastBがrastAの外部に点を持たない場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#RT_ST_DFullyWithin" title="ST_DFullyWithin">ST_DFullyWithin</a> - Availability: 2.1.0 rastAとrastBが指定した距離内に完全に収まる場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#RT_ST_DWithin" title="ST_DWithin">ST_DWithin</a> - Availability: 2.1.0 rastAとrastBが指定した距離内にある場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#ST_DelaunayTriangles" title="ST_DelaunayTriangles">ST_DelaunayTriangles</a> - Availability: 2.1.0 - GEOS 3.4.0以上が必要です。 与えられたポイントの周りのドロネー三角形を返します。</li><li class="listitem"><a class="link" href="#RT_ST_Disjoint" title="ST_Disjoint">ST_Disjoint</a> - Availability: 2.1.0 rastAがrastBとインタセクトしない場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#RT_ST_DumpValues" title="ST_DumpValues">ST_DumpValues</a> - Availability: 2.1.0 指定したバンドの値を2次元で得ます。</li><li class="listitem"><a class="link" href="#ST_Extrude" title="ST_Extrude">ST_Extrude</a> - Availability: 2.1.0 関連するボリュームにサーフェスを押し出します。</li><li class="listitem"><a class="link" href="#ST_ForceLHR" title="ST_ForceLHR">ST_ForceLHR</a> - Availability: 2.1.0 LHR (Left Hand Rule)方向に強制します。</li><li class="listitem"><a class="link" href="#RT_ST_FromGDALRaster" title="ST_FromGDALRaster">ST_FromGDALRaster</a> - Availability: 2.1.0 対応するGDALラスタファイルからラスタを返します。</li><li class="listitem"><a class="link" href="#ST_GeomFromGeoHash" title="ST_GeomFromGeoHash">ST_GeomFromGeoHash</a> - Availability: 2.1.0 GeoHash文字列からジオメトリを返します。</li><li class="listitem"><a class="link" href="#RT_ST_InvDistWeight4ma" title="ST_InvDistWeight4ma">ST_InvDistWeight4ma</a> - Availability: 2.1.0 近隣のピクセル値の内挿補間を行うラスタ処理関数です。</li><li class="listitem"><a class="link" href="#RT_ST_MapAlgebra" title="ST_MapAlgebra (コールバック関数版)">ST_MapAlgebra (コールバック関数版)</a> - Availability: 2.1.0 コールバック関数版 - 一つ以上の入力ラスタ、バンドインデクスと一つのユーザ定義コールバック関数から、一つのバンドからなるラスタを返します。</li><li class="listitem"><a class="link" href="#RT_ST_MapAlgebra_expr" title="ST_MapAlgebra (数式版)">ST_MapAlgebra (数式版)</a> - Availability: 2.1.0 数式版 - 一つか二つの入力ラスタ、バンド番号、一つ以上のユーザ定義SQL式から一つのバンドを持つラスタを返します。</li><li class="listitem"><a class="link" href="#RT_ST_MinConvexHull" title="ST_MinConvexHull">ST_MinConvexHull</a> - Availability: 2.1.0  NODATA値を除いたラスタの凸包ジオメトリを返します。</li><li class="listitem"><a class="link" href="#RT_ST_MinDist4ma" title="ST_MinDist4ma">ST_MinDist4ma</a> - Availability: 2.1.0 対象ピクセルと値を持つ近隣ピクセルとの最短距離をピクセル単位で返すラスタ処理関数です。</li><li class="listitem"><a class="link" href="#ST_MinkowskiSum" title="ST_MinkowskiSum">ST_MinkowskiSum</a> - Availability: 2.1.0 ミンコフスキー和を求めます。</li><li class="listitem"><a class="link" href="#RT_ST_NearestValue" title="ST_NearestValue">ST_NearestValue</a> - Availability: 2.1.0 与えられたバンドの、columnxとrowyで指定されるか、またはラスタと同じ空間参照系で表現されたポイントで指定されたピクセルに最も近いNODATAでない値を返します。</li><li class="listitem"><a class="link" href="#RT_ST_Neighborhood" title="ST_Neighborhood">ST_Neighborhood</a> - Availability: 2.1.0 与えられたバンドのcolumnX, columnYか、ラスタと同じ空間参照系のジオメトリポイントで指定されたピクセルの周囲にある、NODATAでない2次元倍精度浮動小数点数配列を返します。</li><li class="listitem"><a class="link" href="#RT_ST_NotSameAlignmentReason" title="ST_NotSameAlignmentReason">ST_NotSameAlignmentReason</a> - Availability: 2.1.0 ラスタが同じアラインメントを持つかどうか、また、持たない場合にはその理由を示す文字列を返します。</li><li class="listitem"><a class="link" href="#ST_Orientation" title="ST_Orientation">ST_Orientation</a> - Availability: 2.1.0 サーフェスの方向を判定します。</li><li class="listitem"><a class="link" href="#RT_ST_Overlaps" title="ST_Overlaps">ST_Overlaps</a> - Availability: 2.1.0 rastAとrastBがインタセクトして、かつ一方がもう一方に完全には包含されない場合にはTRUEを返します。</li><li class="listitem"><a class="link" href="#RT_ST_PixelAsCentroid" title="ST_PixelAsCentroid">ST_PixelAsCentroid</a> - Availability: 2.1.0 ピクセルで表現される面の重心 (ポイントジオメトリ)を返します。</li><li class="listitem"><a class="link" href="#RT_ST_PixelAsCentroids" title="ST_PixelAsCentroids">ST_PixelAsCentroids</a> - Availability: 2.1.0 全てのピクセルについて重心 (ポイントジオメト)リを、ピクセルごとのピクセル値とラスタ座標系のXとYとを付けて返します。ポイントジオメトリの座標はピクセルで表現される面の重心です。</li><li class="listitem"><a class="link" href="#RT_ST_PixelAsPoint" title="ST_PixelAsPoint">ST_PixelAsPoint</a> - Availability: 2.1.0 ピクセルの左上隅のポイントジオメトリを返します。</li><li class="listitem"><a class="link" href="#RT_ST_PixelAsPoints" title="ST_PixelAsPoints">ST_PixelAsPoints</a> - Availability: 2.1.0 全てのピクセルについてポイントジオメトリを、ピクセルごとのピクセル値とラスタ座標系のXとYとを付けて返します。ポイントジオメトリの座標はピクセルの左上隅です。</li><li class="listitem"><a class="link" href="#RT_ST_PixelOfValue" title="ST_PixelOfValue">ST_PixelOfValue</a> - Availability: 2.1.0 検索値と同じ値を持つピクセルのcolumnx, rowyピクセル座標を得ます。</li><li class="listitem"><a class="link" href="#ST_PointFromGeoHash" title="ST_PointFromGeoHash">ST_PointFromGeoHash</a> - Availability: 2.1.0 GeoHash文字列からポイントを返します。</li><li class="listitem"><a class="link" href="#RT_ST_RasterToWorldCoord" title="ST_RasterToWorldCoord">ST_RasterToWorldCoord</a> - Availability: 2.1.0 ラスタの指定した列と行における左上隅の地理座標X値とY値 (経度と緯度)を返します。列と行の番号は1始まりです。</li><li class="listitem"><a class="link" href="#RT_ST_Resize" title="ST_Resize">ST_Resize</a> - Availability: 2.1.0 GDAL 1.6.1以上が必要です。 ラスタを新しい幅、高さにサイズ再設定を行います。</li><li class="listitem"><a class="link" href="#RT_ST_Roughness" title="ST_Roughness">ST_Roughness</a> - Availability: 2.1.0 DEMの「粗度」を計算したラスタを返します。</li><li class="listitem"><a class="link" href="#RT_ST_SetValues" title="ST_SetValues">ST_SetValues</a> - Availability: 2.1.0 与えられたバンドに複数の値を設定して、変更されたラスタを返します。</li><li class="listitem"><a class="link" href="#TP_ST_Simplify" title="ST_Simplify">ST_Simplify</a> - Availability: 2.1.0 与えたTopoGeometryを「シンプル化した」ジオメトリを返します。ダグラス-ポーカーのアルゴリズムを使います。</li><li class="listitem"><a class="link" href="#ST_StraightSkeleton" title="ST_StraightSkeleton">ST_StraightSkeleton</a> - Availability: 2.1.0 ジオメトリからストレートスケルトンを計算します。</li><li class="listitem"><a class="link" href="#RT_ST_Summary" title="ST_Summary">ST_Summary</a> - Availability: 2.1.0 ラスタの中身の概要が文字列で返されます。</li><li class="listitem"><a class="link" href="#RT_ST_TPI" title="ST_TPI">ST_TPI</a> - Availability: 2.1.0 地形的位置指数を計算したラスタを返します。</li><li class="listitem"><a class="link" href="#RT_ST_TRI" title="ST_TRI">ST_TRI</a> - Availability: 2.1.0 起伏指標を計算したラスタを返します。</li><li class="listitem"><a class="link" href="#ST_Tesselate" title="ST_Tesselate">ST_Tesselate</a> - Availability: 2.1.0 ポリゴンまたは多面体サーフェスのテッセレーションを計算し、TINまたはTINコレクションを返します。</li><li class="listitem"><a class="link" href="#RT_ST_Tile" title="ST_Tile">ST_Tile</a> - Availability: 2.1.0 求められた出力ラスタのピクセル数に基づいて入力ラスタを分割した結果のラスタ集合を返します。</li><li class="listitem"><a class="link" href="#RT_ST_Touches" title="ST_Touches">ST_Touches</a> - Availability: 2.1.0 rastAとrastBが少なくとも一つの共通の点を持ち、かつ二つのラスタの内部同士がインタセクトしない場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#RT_ST_Union" title="ST_Union">ST_Union</a> - Availability: 2.1.0 ST_Union(rast, unionarg)の形式が導入されました。 ラスタタイルの集合を結合して1以上のバンドからなる単一ラスタを返します。</li><li class="listitem"><a class="link" href="#RT_ST_Within" title="ST_Within">ST_Within</a> - Availability: 2.1.0 rastAがrastBの外部に点を持たず、rastAの内部の少なくとも一つの点がrastBの内部にある場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#RT_ST_WorldToRasterCoord" title="ST_WorldToRasterCoord">ST_WorldToRasterCoord</a> - Availability: 2.1.0 ラスタの空間参照系による地理座標のX値とY値 (経度と緯度)またはポイントジオメトリに対応するピクセルの左上隅を返します。</li><li class="listitem"><a class="link" href="#Set_Geocode_Setting" title="Set_Geocode_Setting">Set_Geocode_Setting</a> - Availability: 2.1.0 ジオコーダ関数の振る舞いに影響を与える設定を行います。</li><li class="listitem"><a class="link" href="#RT_UpdateRasterSRID" title="UpdateRasterSRID">UpdateRasterSRID</a> - Availability: 2.1.0 ユーザが指定したカラムとテーブルにあるラスタの全てについてSRIDを変更します。</li><li class="listitem"><a class="link" href="#clearTopoGeom" title="clearTopoGeom">clearTopoGeom</a> - Availability: 2.1 TopoGeometryの中身を消去します。</li><li class="listitem"><a class="link" href="#postgis_backend" title="postgis.backend">postgis.backend</a> - Availability: 2.1.0 GEOSとSFCGALで重複する関数を提供するバックエンドです。GEOSまたはSFCGALを選択します。デフォルトはGEOSです。</li><li class="listitem"><a class="link" href="#postgis_sfcgal_version" title="postgis_sfcgal_version">postgis_sfcgal_version</a> - Availability: 2.1.0 使用しているSFCGALの版を返します</li></ul></div><p>PostGIS 2.1で機能強化された関数</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#RT_ST_AddBand" title="ST_AddBand">ST_AddBand</a> - Enhanced: 2.1.0 addbandarg対応が追加されました。</li><li class="listitem"><a class="link" href="#RT_ST_AddBand" title="ST_AddBand">ST_AddBand</a> - Enhanced: 2.1.0 out-dbバンドが追加されました。</li><li class="listitem"><a class="link" href="#RT_ST_AsBinary" title="ST_AsBinary/ST_AsWKB">ST_AsBinary/ST_AsWKB</a> - Enhanced: 2.1.0 outasinの追加</li><li class="listitem"><a class="link" href="#RT_ST_Aspect" title="ST_Aspect">ST_Aspect</a> - Enhanced: 2.1.0 ST_MapAlgebra()を使用するようにし、interpolate_nodata任意引数を追加しました。</li><li class="listitem"><a class="link" href="#RT_ST_Clip" title="ST_Clip">ST_Clip</a> - Enhanced: 2.1.0 C言語で記述されました</li><li class="listitem"><a class="link" href="#RT_ST_Distinct4ma" title="ST_Distinct4ma">ST_Distinct4ma</a> - Enhanced: 2.1.0 二つ目の形式の追加</li><li class="listitem"><a class="link" href="#RT_ST_HillShade" title="ST_HillShade">ST_HillShade</a> - Enhanced: 2.1.0 ST_MapAlgebra()を使用するようにし、interpolate_nodata任意引数を追加しました。</li><li class="listitem"><a class="link" href="#RT_ST_Max4ma" title="ST_Max4ma">ST_Max4ma</a> - Enhanced: 2.1.0 二つ目の形式の追加</li><li class="listitem"><a class="link" href="#RT_ST_Mean4ma" title="ST_Mean4ma">ST_Mean4ma</a> - Enhanced: 2.1.0 二つ目の形式の追加</li><li class="listitem"><a class="link" href="#RT_ST_Min4ma" title="ST_Min4ma">ST_Min4ma</a> - Enhanced: 2.1.0 二つ目の形式の追加</li><li class="listitem"><a class="link" href="#RT_ST_PixelAsPolygons" title="ST_PixelAsPolygons">ST_PixelAsPolygons</a> - Enhanced: 2.1.0 任意引数exclude_nodata_valueが追加されました。</li><li class="listitem"><a class="link" href="#RT_ST_Polygon" title="ST_Polygon">ST_Polygon</a> - Enhanced: 2.1.0 速度を改善し (完全にC言語で記述しました)、確実に妥当なマルチポリゴンを返すようにしました。</li><li class="listitem"><a class="link" href="#RT_ST_Range4ma" title="ST_Range4ma">ST_Range4ma</a> - Enhanced: 2.1.0 二つ目の形式の追加</li><li class="listitem"><a class="link" href="#RT_ST_SameAlignment" title="ST_SameAlignment">ST_SameAlignment</a> - Enhanced: 2.1.0 集約関数版の追加</li><li class="listitem"><a class="link" href="#RT_ST_SetGeoReference" title="ST_SetGeoReference">ST_SetGeoReference</a> - Enhanced: 2.1.0 ST_SetGeoReference(raster, double precision, ...)形式を追加しました。</li><li class="listitem"><a class="link" href="#RT_ST_SetValue" title="ST_SetValue">ST_SetValue</a> - Enhanced: 2.1.0 ST_SetValueでジオメトリを用いる形式が、ポイントだけでなくあらゆるジオメトリタイプに対応するようになりました。ジオメトリを用いる形式はST_SetValuesのgeomval[]を用いる形式をラップしたものです。</li><li class="listitem"><a class="link" href="#RT_ST_Slope" title="ST_Slope">ST_Slope</a> - Enhanced: 2.1.0 ST_MapAlgebra()を使用するようにし、units, scale, interpolate_nodata任意引数を追加しました。</li><li class="listitem"><a class="link" href="#RT_ST_StdDev4ma" title="ST_StdDev4ma">ST_StdDev4ma</a> - Enhanced: 2.1.0 二つ目の形式の追加</li><li class="listitem"><a class="link" href="#RT_ST_Sum4ma" title="ST_Sum4ma">ST_Sum4ma</a> - Enhanced: 2.1.0 二つ目の形式の追加</li><li class="listitem"><a class="link" href="#RT_ST_Transform" title="ST_Transform">ST_Transform</a> - Enhanced: 2.1.0 ST_Tranfrorm(rast, alignto)の形式を追加しました。</li><li class="listitem"><a class="link" href="#RT_ST_Union" title="ST_Union">ST_Union</a> - Enhanced: 2.1.0 速度が改善されました (完全にC言語で記述しました)</li><li class="listitem"><a class="link" href="#RT_ST_Union" title="ST_Union">ST_Union</a> - Enhanced: 2.1.0 ST_Union(rast) (一つ目の形式)で、全ての入力ラスタの全てのバンドを結合するようになりました。以前の版のPostGISでは、一つ目のバンドと仮定していました。</li><li class="listitem"><a class="link" href="#RT_ST_Union" title="ST_Union">ST_Union</a> - Enhanced: 2.1.0 ST_Union(rast, uniontype) (四つ目の形式)で、全ての入力ラスタの全てのバンドを結合するようになりました。</li><li class="listitem"><a class="link" href="#ST_AsGML" title="ST_AsGML">ST_AsGML</a> - Enhanced: 2.1.0 GML 3用にidが導入されました。</li><li class="listitem"><a class="link" href="#ST_Boundary" title="ST_Boundary">ST_Boundary</a> - Enhanced: 2.1.0で三角対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_DWithin" title="ST_DWithin">ST_DWithin</a> - Enhanced: 2.1.0で、ジオグラフィでの速度が向上しました。詳細についてはMaking Geography fasterを参照して下さい。</li><li class="listitem"><a class="link" href="#ST_DWithin" title="ST_DWithin">ST_DWithin</a> - Enhanced: 2.1.0 曲線ジオメトリ対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_Distance" title="ST_Distance">ST_Distance</a> - Enhanced: 2.1.0 ジオグラフィでの速度が改善されました。詳細はMaking Geography fasterをご覧ください。</li><li class="listitem"><a class="link" href="#ST_Distance" title="ST_Distance">ST_Distance</a> - Enhanced: 2.1.0 - 曲線ジオメトリ対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_DumpPoints" title="ST_DumpPoints">ST_DumpPoints</a> - Enhanced: 2.1.0 速度向上しました。C言語で実装しなおしました。</li><li class="listitem"><a class="link" href="#ST_MakeValid" title="ST_MakeValid">ST_MakeValid</a> - Enhanced: 2.1.0 GEOMETRYCOLLECTIONとMULTIPOINTに対応するようになりました。</li><li class="listitem"><a class="link" href="#ST_Segmentize" title="ST_Segmentize">ST_Segmentize</a> - Enhanced: 2.1.0 ジオグラフィ対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_Summary" title="ST_Summary">ST_Summary</a> - Enhanced: 2.1.0 空間参照系を持つかを示すSフラグが追加されました。</li><li class="listitem"><a class="link" href="#toTopoGeom" title="toTopoGeom">toTopoGeom</a> - Enhanced: 2.1.0版では、既存のTopoGeometryを取る形式が追加されました。</li></ul></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="ChangedFunctions_2_1"></a>14.12.7. PostGIS 2.1で大幅に変更された関数</h3></div></div></div><p>次に示す関数は、PostGIS 2.1で、たぶん大幅に変更されたものです。これらを使用している場合には、既存のコードを確認する必要があるかも知れません。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#RT_ST_Aspect" title="ST_Aspect">ST_Aspect</a> - Changed: 2.1.0 以前の版では、返り値はラジアン単位でした。現在は、デフォルトでは度で返します。</li><li class="listitem"><a class="link" href="#RT_ST_HillShade" title="ST_HillShade">ST_HillShade</a> - Changed: 2.1.0 以前の版ではazimuthとaltitudeはラジアン単位で表現しました。現在はazimuthとaltitudeは度単位で表現します。</li><li class="listitem"><a class="link" href="#RT_ST_Intersects" title="ST_Intersects">ST_Intersects</a> - Changed: 2.1.0 ST_Intersects(raster, geometry)形式の挙動が ST_Intersects(geometry, raster)とあうように変更されました。 </li><li class="listitem"><a class="link" href="#RT_ST_PixelAsCentroids" title="ST_PixelAsCentroids">ST_PixelAsCentroids</a> - Changed: 2.1.1 exclude_nodata_valueの挙動を変更しました。</li><li class="listitem"><a class="link" href="#RT_ST_PixelAsPoints" title="ST_PixelAsPoints">ST_PixelAsPoints</a> - Changed: 2.1.1 exclude_nodata_valueの挙動を変更しました。</li><li class="listitem"><a class="link" href="#RT_ST_PixelAsPolygons" title="ST_PixelAsPolygons">ST_PixelAsPolygons</a> - Changed: 2.1.1 exclude_nodata_valueの挙動を変更しました。</li><li class="listitem"><a class="link" href="#RT_ST_Polygon" title="ST_Polygon">ST_Polygon</a> - Changed: 2.1.0 以前の版では、時々ポリゴンを返しましたが、常にマルチポリゴンを返すように変更しました。</li><li class="listitem"><a class="link" href="#RT_ST_RasterToWorldCoordX" title="ST_RasterToWorldCoordX">ST_RasterToWorldCoordX</a> - Changed: 2.1.0 以前の版ではST_Raster2WorldCoordXと呼ばれていました。</li><li class="listitem"><a class="link" href="#RT_ST_RasterToWorldCoordY" title="ST_RasterToWorldCoordY">ST_RasterToWorldCoordY</a> - Changed: 2.1.0 以前の版ではST_Raster2WorldCoordYと呼ばれていました。</li><li class="listitem"><a class="link" href="#RT_ST_Resample" title="ST_Resample">ST_Resample</a> - Changed: 2.1.0 srid引数を削除しました。参照ラスタを使う形式では、もはや参照ラスタのSRIDを適用しません。ラスタの投影変換にはST_Transform()を使います。SRIDなしで動作します。</li><li class="listitem"><a class="link" href="#RT_ST_Rescale" title="ST_Rescale">ST_Rescale</a> - Changed: 2.1.0 SRIDなしのラスタで動作するようになりました。</li><li class="listitem"><a class="link" href="#RT_ST_Reskew" title="ST_Reskew">ST_Reskew</a> - Changed: 2.1.0 SRIDなしのラスタで動作するようになりました。</li><li class="listitem"><a class="link" href="#RT_ST_Slope" title="ST_Slope">ST_Slope</a> - Changed: 2.1.0 以前の版では、返り値はラジアン単位でした。現在は、デフォルトでは度で返します。</li><li class="listitem"><a class="link" href="#RT_ST_SnapToGrid" title="ST_SnapToGrid">ST_SnapToGrid</a> - Changed: 2.1.0 SRIDなしのラスタで動作するようになりました。</li><li class="listitem"><a class="link" href="#RT_ST_WorldToRasterCoordX" title="ST_WorldToRasterCoordX">ST_WorldToRasterCoordX</a> - Changed: 2.1.0 以前の版ではST_World2RasterCoordXと呼ばれていました。</li><li class="listitem"><a class="link" href="#RT_ST_WorldToRasterCoordY" title="ST_WorldToRasterCoordY">ST_WorldToRasterCoordY</a> - Changed: 2.1.0 以前の版ではST_World2RasterCoordYと呼ばれていました。</li><li class="listitem"><a class="link" href="#ST_EstimatedExtent" title="ST_EstimatedExtent">ST_EstimatedExtent</a> - Changed: 2.1.0 2.0.xまではST_Estimated_Extentと呼ばれていました。</li><li class="listitem"><a class="link" href="#ST_Force2D" title="ST_Force2D">ST_Force2D</a> - Changed: 2.1.0 2.0.xの間はST_Force_2Dと呼ばれていました。</li><li class="listitem"><a class="link" href="#ST_Force_3D" title="ST_Force3D">ST_Force3D</a> - Changed: 2.1.0 2.0.xの間はST_Force_3Dと呼ばれていました。</li><li class="listitem"><a class="link" href="#ST_Force_3DM" title="ST_Force3DM">ST_Force3DM</a> - Changed: 2.1.0 2.0.xの間はST_Force_3DMと呼ばれていました。</li><li class="listitem"><a class="link" href="#ST_Force_3DZ" title="ST_Force3DZ">ST_Force3DZ</a> - Changed: 2.1.0 2.0.xの間はST_Force_3DZと呼ばれていました。</li><li class="listitem"><a class="link" href="#ST_Force_4D" title="ST_Force4D">ST_Force4D</a> - Changed: 2.1.0 2.0.xの間はST_Force_4Dと呼ばれていました。</li><li class="listitem"><a class="link" href="#ST_Force_Collection" title="ST_ForceCollection">ST_ForceCollection</a> - Changed: 2.1.0 2.0.xの間はST_Force_Collectionと呼ばれていました。</li><li class="listitem"><a class="link" href="#ST_LineInterpolatePoint" title="ST_LineInterpolatePoint">ST_LineInterpolatePoint</a> - Changed: 2.1.0 2.0.xまでではST_Line_Interpolate_Pointと呼んでいました。</li><li class="listitem"><a class="link" href="#ST_LineLocatePoint" title="ST_LineLocatePoint">ST_LineLocatePoint</a> - Changed: 2.1.0 2.0.xまでではST_Line_Locate_Pointと呼んでいました。</li><li class="listitem"><a class="link" href="#ST_LineSubstring" title="ST_LineSubstring">ST_LineSubstring</a> - Changed: 2.1.0 2.0.xではST_Line_Substringと呼ばれていました。</li><li class="listitem"><a class="link" href="#ST_Segmentize" title="ST_Segmentize">ST_Segmentize</a> - Changed: 2.1.0 ジオグラフィ対応導入の結果として、SELECT ST_Segmentize('LINESTRING(1 2, 3 4)',0.5);では、あいまいな関数呼び出しエラーとなります。確実にタイプを指定したオブジェクトを持たせる必要があります。たとえば、ジオメトリ/ジオグラフィカラムであったり、ST_GeomFromText, ST_GeogFromTextを使ったり、SELECT ST_Segmentize('LINESTRING(1 2, 3 4)'::geometry,0.5);としたりします。</li></ul></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="NewFunctions_2_0"></a>14.12.8. PostGIS 2.0で新規作成/機能強化/変更された関数</h3></div></div></div><p>次に示す関数は、2.0リリースで新規作成/機能強化/大幅な変更 (<a class="xref" href="#NewFunctions_2_0_Changed" title="14.12.9. PostGIS 2.0で変更された関数">「PostGIS 2.0で変更された関数」</a>)がなされたPostGIS関数です。</p><p>新ジオメトリタイプ: TINと多面体サーフェスが2.0で導入されました。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>トポロジ機能の大幅な改良がありました。詳細情報については<a class="xref" href="#Topology" title="第11章 トポロジ">11章<i>トポロジ</i></a>を参照して下さい。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>PostGIS 2.0では、ラスタ型とラスタ機能がPostGISに統合されました。ここに一覧を出すには、新しいラスタ関数はあまりに多く、全ての関数が新しいので、有効なラスタ関数の詳細については<a class="xref" href="#RT_reference" title="第9章 ラスタ リファレンス">9章<i>ラスタ リファレンス</i></a>を参照して下さい。2.0より前では、raster_columnsとraster_overviewsは実際のテーブルでした。2.0リリースでビューに変更されました。<code class="varname">ST_AddRasterColumn</code>等の関数は削除され、<a class="xref" href="#RT_AddRasterConstraints" title="AddRasterConstraints">AddRasterConstraints</a>, <a class="xref" href="#RT_DropRasterConstraints" title="DropRasterConstraints">DropRasterConstraints</a>に置き換えられました。結果として、ラスタテーブルを生成するアプリケーションは変更が必要になるかも知れなくなりました。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Tigerジオコーダは、TIGER 2010センサスデータで動作するように更新され、PostGISの中核文書に入れられました。また、逆ジオコーダ関数が新規作成されました。詳細情報については<a class="xref" href="#Tiger_Geocoder" title="13.1. Tigerジオコーダ">「Tigerジオコーダ」</a>を参照して下さい。</p></td></tr></table></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#RT_Raster_Intersect" title="&amp;&amp;">&amp;&amp;</a> - Availability: 2.0.0 AのバウンディングボックスがBのバウンディングボックスとインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#geometry_overlaps_nd" title="&amp;&amp;&amp;">&amp;&amp;&amp;</a> - Availability: 2.0.0 Aのn次元バウンディングボックスがBのn次元バウンディングボックスとインタセクトする場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#geometry_distance_box" title="&lt;#&gt;">&lt;#&gt;</a> - Availability: 2.0.0 PostgreSQL 9.1以上でのみ有効です。 AのバウンディングボックスとBのバウンディングボックスの2次元距離を返します。</li><li class="listitem"><a class="link" href="#geometry_distance_knn" title="&lt;-&gt;">&lt;-&gt;</a> - Availability: 2.0.0 弱いKNNによって、実際の距離の代わりにジオメトリの重心による近傍が得られます。ポイントは確実な結果を得て、他のタイプは全て不確実な結果を得ます。PostgreSQL 9.1以上で有効です。 AとBの2次元距離を返します。</li><li class="listitem"><a class="link" href="#geometry_distance_box_nd" title="&lt;&lt;#&gt;&gt;">&lt;&lt;#&gt;&gt;</a> - Availability: 2.0.0 KNNはPostgreSQL 9.1以上でのみ有効です。 AのバウンディングボックスとBのバウンディングボックスのn次元距離を返します。</li><li class="listitem"><a class="link" href="#geometry_distance_centroid_nd" title="&lt;&lt;-&gt;&gt;">&lt;&lt;-&gt;&gt;</a> - Availability: 2.0.0 KNNはPostgreSQL 9.1以上でのみ有効です。 AのバウンディングボックスとBのバウンディングボックスのn次元距離を返します。</li><li class="listitem"><a class="link" href="#RT_Raster_Contained" title="@">@</a> - Availability: 2.0.0 raster @ raster, raster @ geometry が導入されました。 AのバウンディングボックスがBのバウンディングボックスに含まれる場合にTRUEを返します。倍精度浮動小数点数のバウンディングボックスを使います。</li><li class="listitem"><a class="link" href="#RT_Raster_Contained" title="@">@</a> - Availability: 2.0.5 geometry @ raster が導入されました。  AのバウンディングボックスがBのバウンディングボックスに含まれる場合にTRUEを返します。倍精度浮動小数点数のバウンディングボックスを使います。</li><li class="listitem"><a class="link" href="#AddEdge" title="AddEdge">AddEdge</a> - Availability: 2.0.0 GEOS 3.3.0以降が必要です。 指定したラインストリングジオメトリを使って、ラインストリングエッジをエッジテーブルに追加し、指定したトポロジスキーマの始点終点をポイントノードテーブルに追加し、新しい (または既存の)エッジの識別番号を返します。</li><li class="listitem"><a class="link" href="#AddFace" title="AddFace">AddFace</a> - Availability: 2.0.0 フェイスプリミティブをトポロジに登録し、その識別番号を得ます。</li><li class="listitem"><a class="link" href="#AddNode" title="AddNode">AddNode</a> - Availability: 2.0.0 指定したトポロジスキーマのノードテーブルにポイントノードを追加し、新しいノードの識別番号を返します。指定したポイントに既にノードがある場合は既存のノード識別番号を返します。</li><li class="listitem"><a class="link" href="#RT_AddOverviewConstraints" title="AddOverviewConstraints">AddOverviewConstraints</a> - Availability: 2.0.0 ラスタカラムに対して、他のオーバビューであることをタグ付けします。</li><li class="listitem"><a class="link" href="#RT_AddRasterConstraints" title="AddRasterConstraints">AddRasterConstraints</a> - Availability: 2.0.0 ロードされたラスタテーブルの特定のカラムにラスタ制約を追加します。制約には空間参照系、スケール、ブロックサイズ、アラインメント、バンド数、バンド型、ラスタカラムが規則正しいブロックかどうかを示すフラグがあります。テーブルは制約が推論されるためのデータがロードされなければなりません。制約の設定が完了するとtrueを返し、問題があると通知を返します。</li><li class="listitem"><a class="link" href="#AsGML" title="AsGML">AsGML</a> - Availability: 2.0.0  TopoGeometryのGML表現を返します。</li><li class="listitem"><a class="link" href="#CopyTopology" title="CopyTopology">CopyTopology</a> - Availability: 2.0.0 トポロジ構造 (ノード、エッジ、フェイス、レイヤ、TopoGeometry)を複写します。</li><li class="listitem"><a class="link" href="#RT_DropOverviewConstraints" title="DropOverviewConstraints">DropOverviewConstraints</a> - Availability: 2.0.0 ラスタカラムに対して他のオーバビューであることをタグ付けしているのを解除します。</li><li class="listitem"><a class="link" href="#RT_DropRasterConstraints" title="DropRasterConstraints">DropRasterConstraints</a> - Availability: 2.0.0 ラスタテーブルカラムを参照するPostGISラスタ制約を削除します。データの再読み込みやラスタカラムデータの更新の際に使えます。</li><li class="listitem"><a class="link" href="#Drop_Indexes_Generate_Script" title="Drop_Indexes_Generate_Script">Drop_Indexes_Generate_Script</a> - Availability: 2.0.0 tigerスキーマとユーザが指定したスキーマ上の、全ての主キーでなく、かつユニークでないインデックスを削除します。スキーマを指定しない場合のデフォルトスキーマは、tiger_dataです。</li><li class="listitem"><a class="link" href="#Drop_State_Tables_Generate_Script" title="Drop_State_Tables_Generate_Script">Drop_State_Tables_Generate_Script</a> - Availability: 2.0.0 指定したスキーマ内の、名前が州コードから始まるテーブルを全て削除するスクリプトを生成します。スキーマが指定されていない場合のデフォルトスキーマはtiger_dataです。</li><li class="listitem"><a class="link" href="#Geocode_Intersection" title="Geocode_Intersection">Geocode_Intersection</a> - Availability: 2.0.0 インタセクトする二つのストリート、州コード、市名、郵便番号を引数に取り、最初の交差点の可能性のある位置の集合を出力します。geomoutにNAD83経度緯度のポイント、normalized_addressにそれぞれの位置、ratingに評価値がそれぞれ入ります。評価値が低いほど合致度が高くなります。結果は評価値の低い順にソートされます。最大結果数を渡すことができ、デフォルトは10です。Tigerデータ (エッジ、フェイス、住所)と、PostgreSQLあいまい文字列合致 (soundex, levenshtein)を使います。</li><li class="listitem"><a class="link" href="#GetEdgeByPoint" title="GetEdgeByPoint">GetEdgeByPoint</a> - Availability: 2.0.0 - GEOS 3.3.0以上が必要   与えられたポイントにインタセクトするエッジの識別番号を探索します。</li><li class="listitem"><a class="link" href="#GetFaceByPoint" title="GetFaceByPoint">GetFaceByPoint</a> - Availability: 2.0.0 - GEOS 3.3.0以上が必要   与えられたポイントにインタセクトするフェイスの識別番号を探索します。</li><li class="listitem"><a class="link" href="#GetNodeByPoint" title="GetNodeByPoint">GetNodeByPoint</a> - Availability: 2.0.0 - GEOS 3.3.0以上が必要   ポイント位置にあるノードの識別番号を探索します。</li><li class="listitem"><a class="link" href="#GetNodeEdges" title="GetNodeEdges">GetNodeEdges</a> - Availability: 2.0  与えられたノードに付随するエッジの集合を整列して返します。</li><li class="listitem"><a class="link" href="#GetRingEdges" title="GetRingEdges">GetRingEdges</a> - Availability: 2.0.0  与えられた側を歩いて得られた、正負符号付きエッジ識別番号の集合を、順序通りに返します。</li><li class="listitem"><a class="link" href="#GetTopoGeomElements" title="GetTopoGeomElements">GetTopoGeomElements</a> - Availability: 2.0.0 与えられたTopoGeometry (プリミティブ要素)の、トポロジのelement_idとelement_typeを含むtopoelementオブジェクトの集合を返します。</li><li class="listitem"><a class="link" href="#GetTopologySRID" title="GetTopologySRID">GetTopologySRID</a> - Availability: 2.0.0 トポロジ名からtopology.topologyテーブル内にあるトポロジのSRIDを返します。</li><li class="listitem"><a class="link" href="#Get_Tract" title="Get_Tract">Get_Tract</a> - Availability: 2.0.0 ジオメトリで指定した位置の米国国勢調査統計区またはtractテーブルのフィールドを返します。デフォルトでは、統計区の短縮名を返します。</li><li class="listitem"><a class="link" href="#Install_Missing_Indexes" title="Install_Missing_Indexes">Install_Missing_Indexes</a> - Availability: 2.0.0 ジオコーダで結合や検索条件に使われ、インデックスが付いていなキーカラムを持つ全てのテーブルを探し、インデックスを追加します。</li><li class="listitem"><a class="link" href="#Loader_Generate_Census_Script" title="Loader_Generate_Census_Script">Loader_Generate_Census_Script</a> - Availability: 2.0.0  指定した州について、tract (統計区)、bg (block group, 細分区グループ)、tabblock (ブロック)をダウンロードし、tiger_dataに格納するための、指定したプラットフォーム用のシェルスクリプトを生成します。行ごとに州ごとのスクリプトが返されます。</li><li class="listitem"><a class="link" href="#Loader_Generate_Script" title="Loader_Generate_Script">Loader_Generate_Script</a> - Availability: 2.0.0 Tiger 2010構造のデータに対応しました。国勢統計区 (tract)、細分区グループ ("block groups", bg)、細分区 (tabblocks)テーブルをダウンロードします。 指定したプラットフォーム用の、指定した州のTigerデータをダウンロードし、格納準備を行い、tiger_dataスキーマに格納するシェルスクリプトを生成します。行ごとに州ごとのスクリプトが返ります。最新版ではTiger 2010のデータ構造変更に対応していて、国勢統計区、細分区グループ、細分区 (tabblocks)テーブルをダウンロードすることができます。</li><li class="listitem"><a class="link" href="#Missing_Indexes_Generate_Script" title="Missing_Indexes_Generate_Script">Missing_Indexes_Generate_Script</a> - Availability: 2.0.0 ジオコーダで結合に使われるキーカラムを持ち、インデックスが付いていないキーカラムを持つすべてのテーブルを検索し、インデックスを追加するSQLデータ定義言語を出力します。</li><li class="listitem"><a class="link" href="#TopologyPolygonize" title="Polygonize">Polygonize</a> - Availability: 2.0.0 トポロジエッジで定義される全てのフェイスを探索し、追加します。</li><li class="listitem"><a class="link" href="#Reverse_Geocode" title="Reverse_Geocode">Reverse_Geocode</a> - Availability: 2.0.0  登録されている空間参照系に基づくポイントジオメトリを引数に取り、理論的に可能性のある住所の配列と交差するストリートの配列を一つのレコードで返します。include_strnum_range = trueの場合には、交差するストリートに番地範囲を追加します。</li><li class="listitem"><a class="link" href="#ST_3DClosestPoint" title="ST_3DClosestPoint">ST_3DClosestPoint</a> - Availability: 2.0.0 g1上の、g2に最も近い3次元ポイントを返します。3次元最短線の一つ目のポイントです。</li><li class="listitem"><a class="link" href="#ST_3DDFullyWithin" title="ST_3DDFullyWithin">ST_3DDFullyWithin</a> - Availability: 2.0.0 3次元ジオメトリが他のジオメトリとの距離が指定した範囲内ならtrueを返します。</li><li class="listitem"><a class="link" href="#ST_3DDWithin" title="ST_3DDWithin">ST_3DDWithin</a> - Availability: 2.0.0 3次元 (XYZ)ジオメトリ型について、二つのジオメトリの3次元距離が指定した数の内にある場合にtrueを返します。</li><li class="listitem"><a class="link" href="#ST_3DDistance" title="ST_3DDistance">ST_3DDistance</a> - Availability: 2.0.0 ジオメトリ型について、二つのジオメトリの、3次元の最小デカルト距離 (空間参照系に基づきます)を、投影法の単位で返します。</li><li class="listitem"><a class="link" href="#ST_3DIntersects" title="ST_3DIntersects">ST_3DIntersects</a> - Availability: 2.0.0 ジオメトリが3次元で「空間的にインタセクトする」場合にTRUEを返します。ポイント、ラインストリング、ポリゴン、多面体サーフェス (面)のみ対応します。SFCGALバックエンドによってTINも対応します。</li><li class="listitem"><a class="link" href="#ST_3DLongestLine" title="ST_3DLongestLine">ST_3DLongestLine</a> - Availability: 2.0.0 二つのジオメトリの3次元長が最長となるラインを返します。</li><li class="listitem"><a class="link" href="#ST_3DMaxDistance" title="ST_3DMaxDistance">ST_3DMaxDistance</a> - Availability: 2.0.0 ジオメトリ型について、二つのジオメトリの、3次元の最大デカルト距離 (空間参照系に基づきます)を、投影法の単位で返します。</li><li class="listitem"><a class="link" href="#ST_3DShortestLine" title="ST_3DShortestLine">ST_3DShortestLine</a> - Availability: 2.0.0 二つのジオメトリの3次元長が最短となるラインを返します。</li><li class="listitem"><a class="link" href="#ST_AddEdgeModFace" title="ST_AddEdgeModFace">ST_AddEdgeModFace</a> - Availability: 2.0  新しいエッジを追加します。新しいエッジがフェイスを分割する場合には、もとのフェイスを編集し、一つのフェイスを追加します。</li><li class="listitem"><a class="link" href="#ST_AddEdgeNewFaces" title="ST_AddEdgeNewFaces">ST_AddEdgeNewFaces</a> - Availability: 2.0  新しいエッジを追加します。新しいエッジがフェイスを分割する場合には、もとのフェイスを削除して、分割した二つのフェイスに置き換えます。</li><li class="listitem"><a class="link" href="#RT_ST_AsGDALRaster" title="ST_AsGDALRaster">ST_AsGDALRaster</a> - Availability: 2.0.0 - GDAL 1.6.0以上が必要です。  指定されたGDALラスタ書式でラスタタイルを返します。ラスタ書式はコンパイルしたライブラリが対応するものです。ライブラリが対応する書式の一覧を得るにはST_GDALRasters()を使います。</li><li class="listitem"><a class="link" href="#RT_ST_AsJPEG" title="ST_AsJPEG">ST_AsJPEG</a> - Availability: 2.0.0 - GDAL 1.6.0以上が必要です。  ラスタの選択されたバンドを、単一のJoint Photographic Exports Group (JPEG)画像としてバイト配列で返します。バンドを指定せず、1バンドか3より多いバンドがある場合には、1番バンドを使用します。3バンドのみ指定した場合には、3バンドを使用し、RGBに対応付けます。</li><li class="listitem"><a class="link" href="#ST_AsLatLonText" title="ST_AsLatLonText">ST_AsLatLonText</a> - Availability: 2.0 与えられたポイントの度・分・秒表現を返します。</li><li class="listitem"><a class="link" href="#RT_ST_AsPNG" title="ST_AsPNG">ST_AsPNG</a> - Availability: 2.0.0 - GDAL 1.6.0以上が必要です。  ラスタの選択されたバンドを、単一のportable network graphics (PNG)画像としてバイト配列で返します。バンドを指定せず、1バンドか3バンドか4バンドある場合には、全てのバンドを使用します。バンドを指定せず、2バンドか4より多いバンドがある場合には、1番バンドを使用します。対象バンドはRGBまたはRGBAに対応付けられます。</li><li class="listitem"><a class="link" href="#RT_ST_AsRaster" title="ST_AsRaster">ST_AsRaster</a> - Availability: 2.0.0 - GDAL 1.6.0以上が必要です。  PostGISジオメトリをPostGISラスタに変換します。</li><li class="listitem"><a class="link" href="#RT_ST_AsTIFF" title="ST_AsTIFF">ST_AsTIFF</a> - Availability: 2.0.0 - GDAL 1.6.0以上が必要です。  ラスタの選択されたバンドを、単一のTIFF画像 (バイト配列)として返します。バンドを指定しないか指定したバンドがラスタ内に無い場合には、全てのバンドの使用を試みます。</li><li class="listitem"><a class="link" href="#ST_AsX3D" title="ST_AsX3D">ST_AsX3D</a> - Availability: 2.0.0: ISO-IEC-19776-1.2-X3DEncodings-XML ジオメトリをX3Dノード要素書式　(ISO-IEC-19776-1.2-X3DEncodings-XML)で返します。</li><li class="listitem"><a class="link" href="#RT_ST_Aspect" title="ST_Aspect">ST_Aspect</a> - Availability: 2.0.0  標高ラスタバンドの傾斜方向 (デフォルトの単位は度)を返します。地形解析に使えます。</li><li class="listitem"><a class="link" href="#RT_ST_Band" title="ST_Band">ST_Band</a> - Availability: 2.0.0 既存のラスタの、一つ以上のバンドを新しいラスタとして返します。既存のラスタから新しいラスタを構築する際に使えます。</li><li class="listitem"><a class="link" href="#RT_ST_BandIsNoData" title="ST_BandIsNoData">ST_BandIsNoData</a> - Availability: 2.0.0 指定したバンドがNODATA値だけで満たされている場合には、TRUEを返します。</li><li class="listitem"><a class="link" href="#RT_ST_Clip" title="ST_Clip">ST_Clip</a> - Availability: 2.0.0  入力ジオメトリで切り取ったラスタを返します。バンドが指定されていない場合には、全てのバンドが返されます。cropが指定されていない場合には、TRUEと仮定され、出力ラスタをクロップします。</li><li class="listitem"><a class="link" href="#ST_CollectionHomogenize" title="ST_CollectionHomogenize">ST_CollectionHomogenize</a> - Availability: 2.0.0 ジオメトリコレクションを与えると、「最も単純な」表現を返します。</li><li class="listitem"><a class="link" href="#ST_ConcaveHull" title="ST_ConcaveHull">ST_ConcaveHull</a> - Availability: 2.0.0 凹包は、集合の範囲内におけるすべてのジオメトリーを囲む、できる限り凹となるジオメトリを表現するものです。収縮包装とみることができます。</li><li class="listitem"><a class="link" href="#RT_ST_Count" title="ST_Count">ST_Count</a> - Availability: 2.0.0  ラスタまたはラスタカバレッジの指定したバンドのピクセル数を返します。バンドを指定しない場合には、1番と仮定します。exclude_nodata_valueをTRUEに設定している場合には、NODATA値と等しくないピクセルのみを数えます。</li><li class="listitem"><a class="link" href="#ST_CreateTopoGeo" title="ST_CreateTopoGeo">ST_CreateTopoGeo</a> - Availability: 2.0  空のトポロジにジオメトリのコレクションを追加し、成否を示すメッセージを返します。</li><li class="listitem"><a class="link" href="#RT_ST_Distinct4ma" title="ST_Distinct4ma">ST_Distinct4ma</a> - Availability: 2.0.0 近隣のピクセル値のうち一意となるものを数えるラスタ処理関数です。</li><li class="listitem"><a class="link" href="#ST_FlipCoordinates" title="ST_FlipCoordinates">ST_FlipCoordinates</a> - Availability: 2.0.0 与えられたジオメトリのX軸とY軸とを入れ替えたものを返します。緯度/経度のフィーチャーを構築して、これを訂正したい場合に使えます。</li><li class="listitem"><a class="link" href="#RT_ST_GDALDrivers" title="ST_GDALDrivers">ST_GDALDrivers</a> - Availability: 2.0.0 - GDAL 1.6.0以上が必要です。  使用しているGDALライブラリが対応するラスタ書式の一覧を返します。この一覧でcan_write=TrueとなっているものだけがST_AsGDALRasterで使えます。</li><li class="listitem"><a class="link" href="#ST_GeomFromGeoJSON" title="ST_GeomFromGeoJSON">ST_GeomFromGeoJSON</a> - Availability: 2.0.0 JSON-C 0.9以上が必要です。 ジオメトリのGeoJSON表現を入力として、PostGISジオメトリオブジェクトを出力します。</li><li class="listitem"><a class="link" href="#ST_GetFaceEdges" title="ST_GetFaceEdges">ST_GetFaceEdges</a> - Availability: 2.0  順序番号を含む、afaceの境界となる、整列したエッジの集合を返します。</li><li class="listitem"><a class="link" href="#RT_ST_HasNoBand" title="ST_HasNoBand">ST_HasNoBand</a> - Availability: 2.0.0 指定したバンド番号のバンドが無い場合には、TRUEを返します。バンド番号を指定していない場合には、1番と仮定します。</li><li class="listitem"><a class="link" href="#RT_ST_HillShade" title="ST_HillShade">ST_HillShade</a> - Availability: 2.0.0  与えられた方位、高度、明度、スケールの入力を使って標高ラスタバンドの仮想照明を返します。</li><li class="listitem"><a class="link" href="#RT_ST_Histogram" title="ST_Histogram">ST_Histogram</a> - Availability: 2.0.0  ラスタまたはラスタカバレッジのビン範囲で分割したデータ分布をまとめるヒストグラムの集合を返します。ビン数を指定しない場合には自動計算されます。</li><li class="listitem"><a class="link" href="#ST_InterpolatePoint" title="ST_InterpolatePoint">ST_InterpolatePoint</a> - Availability: 2.0.0 ジオメトリの、指定したポイントに近いポイントにおけるM値を返します。</li><li class="listitem"><a class="link" href="#RT_ST_IsEmpty" title="ST_IsEmpty">ST_IsEmpty</a> - Availability: 2.0.0 ラスタが空 (幅が0で高さが0)の場合にはTRUEを返します。他の場合には、FALSEを返します。</li><li class="listitem"><a class="link" href="#ST_IsValidDetail" title="ST_IsValidDetail">ST_IsValidDetail</a> - Availability: 2.0.0 - GEOS 3.3.0以上が必要  ジオメトリが妥当か否かを示すvalid_detail (valid,reason,location)行を返します。不正である場合には、理由と位置を示します。</li><li class="listitem"><a class="link" href="#ST_IsValidReason" title="ST_IsValidReason">ST_IsValidReason</a> - Availability: 2.0 - flagsを受け付ける形式はGEOS 3.3.0以上が必要です。 ジオメトリが妥当か否かを示す文字列を返し、不正な場合は理由を返します。</li><li class="listitem"><a class="link" href="#ST_MakeLine" title="ST_MakeLine">ST_MakeLine</a> - Availability: 2.0.0 - ラインストリング入力要素が導入されました。 ポイント、マルチポイント、ラインジオメトリからラインストリングを生成します。</li><li class="listitem"><a class="link" href="#ST_MakeValid" title="ST_MakeValid">ST_MakeValid</a> - Availability: 2.0.0, GEOS 3.3.0以上が必要です。 頂点を失うことなしに不正なジオメトリを妥当なジオメトリにしようと試みます。</li><li class="listitem"><a class="link" href="#RT_ST_MapAlgebraExpr" title="ST_MapAlgebraExpr">ST_MapAlgebraExpr</a> - Availability: 2.0.0  1バンド版: 入力バンドに対する妥当なPostgreSQL代数演算で形成された、指定したピクセルタイプとなる1バンドラスタを生成します。バンドを指定しない場合には、1番を仮定します。</li><li class="listitem"><a class="link" href="#RT_ST_MapAlgebraExpr2" title="ST_MapAlgebraExpr">ST_MapAlgebraExpr</a> - Availability: 2.0.0  2バンド版: 二つの入力バンドに対する妥当なPostgreSQL代数演算で形成された、指定したピクセルタイプとなる1バンドラスタを生成します。バンドを指定しない場合には、どちらも1番と仮定します。結果ラスタは、一つ目のラスタのアラインメント (スケール、スキュー、ピクセル角位置)にあわされます。範囲は"extenttype"引数で定義されます。取りうる"extenttype"の値はINTERSECTION, UNION, FIRST, SECONDです。</li><li class="listitem"><a class="link" href="#RT_ST_MapAlgebraFct" title="ST_MapAlgebraFct">ST_MapAlgebraFct</a> - Availability: 2.0.0 1バンド版 - 入力バンドに対する妥当なPostgreSQL関数で形成された、指定したピクセルタイプとなる1バンドラスタを生成します。バンドを指定しない場合には、1番と仮定します。</li><li class="listitem"><a class="link" href="#RT_ST_MapAlgebraFct2" title="ST_MapAlgebraFct">ST_MapAlgebraFct</a> - Availability: 2.0.0 2バンド版 - 二つの入力バンドに対する妥当なPostgreSQL関数で形成された、指定したピクセルタイプとなる1バンドラスタを生成します。バンドを指定しない場合には、1番と仮定します。"extenttype"のデフォルトはINTERSECTIONです。</li><li class="listitem"><a class="link" href="#RT_ST_MapAlgebraFctNgb" title="ST_MapAlgebraFctNgb">ST_MapAlgebraFctNgb</a> - Availability: 2.0.0  1バンド版: ユーザ定義PostgreSQL関数を使用する最近傍地図代数関数です。入力ラスタバンドの近傍の値を与えたPL/pgSQLユーザ定義関数の結果からなるラスタを返します。</li><li class="listitem"><a class="link" href="#RT_ST_Max4ma" title="ST_Max4ma">ST_Max4ma</a> - Availability: 2.0.0 近隣のピクセル値の最大値を計算するラスタ処理関数です。</li><li class="listitem"><a class="link" href="#RT_ST_Mean4ma" title="ST_Mean4ma">ST_Mean4ma</a> - Availability: 2.0.0 近隣のピクセル値の平均値を計算するラスタ処理関数です。</li><li class="listitem"><a class="link" href="#RT_ST_Min4ma" title="ST_Min4ma">ST_Min4ma</a> - Availability: 2.0.0 近隣のピクセル値の最小値を計算するラスタ処理関数です。</li><li class="listitem"><a class="link" href="#ST_ModEdgeHeal" title="ST_ModEdgeHeal">ST_ModEdgeHeal</a> - Availability: 2.0 二つのエッジについて、接続しているノードを削除して修復します。1番目のエッジを編集して、2番目のエッジを削除します。削除されたノードの識別番号を返します。</li><li class="listitem"><a class="link" href="#ST_NewEdgeHeal" title="ST_NewEdgeHeal">ST_NewEdgeHeal</a> - Availability: 2.0 二つのエッジについて、接続しているノードを削除して修復します。両方のエッジを削除し、1番目のエッジと同じ方向のエッジに置き換えます。</li><li class="listitem"><a class="link" href="#ST_Node" title="ST_Node">ST_Node</a> - Availability: 2.0.0 - GEOS 3.3.0以上が必要  ラインストリングの集合にノードを作成します。</li><li class="listitem"><a class="link" href="#ST_NumPatches" title="ST_NumPatches">ST_NumPatches</a> - Availability: 2.0.0 多面体サーフェスのフェイス数を返します。多面体でないジオメトリの場合にはNULLを返します。</li><li class="listitem"><a class="link" href="#ST_OffsetCurve" title="ST_OffsetCurve">ST_OffsetCurve</a> - Availability: 2.0 - GEOS 3.2以上、GEOS 3.3以上で改善されました。  与えられた距離と方面に入力ラインをずらしたラインを返します。中心線と平行する線を引く際に使えます。</li><li class="listitem"><a class="link" href="#ST_PatchN" title="ST_PatchN">ST_PatchN</a> - Availability: 2.0.0 ジオメトリがPOLYHEDRALSURFACEかPOLYHEDRALSURFACEMの場合には、1始まりでN番目のジオメトリ (フェイス)を返します。それ以外の場合には、NULLを返します。</li><li class="listitem"><a class="link" href="#ST_Perimeter" title="ST_Perimeter">ST_Perimeter</a> - Availability: 2.0.0 ジオグラフィ対応が導入されました。 ST_SrrfaceまたはST_MultiSurface (POLYGONまたはMULTIPOLYGON)の境界の長さの計測値を返します。ジオメトリでは単位は空間参照系によります。ジオグラフィではメートル単位になります。</li><li class="listitem"><a class="link" href="#RT_ST_PixelAsPolygon" title="ST_PixelAsPolygon">ST_PixelAsPolygon</a> - Availability: 2.0.0 指定した行と列のピクセルの境界となるジオメトリを返します。</li><li class="listitem"><a class="link" href="#RT_ST_PixelAsPolygons" title="ST_PixelAsPolygons">ST_PixelAsPolygons</a> - Availability: 2.0.0 全てのピクセルについて境界となるジオメトリを、ピクセルごとのピクセル値とラスタ座標系のXとYとを付けて返します。</li><li class="listitem"><a class="link" href="#ST_Project" title="ST_Project">ST_Project</a> - Availability: 2.0.0 メートル単位の距離とラジアン単位の方位とを使って始点から算出されたPOINTを返します。</li><li class="listitem"><a class="link" href="#RT_ST_Quantile" title="ST_Quantile">ST_Quantile</a> - Availability: 2.0.0  ラスタまたはラスタテーブルカバレッジのサンプルまたは母集団の分位数を計算します。値がラスタの25%,50%,75%にあるかを調べることができます。</li><li class="listitem"><a class="link" href="#RT_ST_Range4ma" title="ST_Range4ma">ST_Range4ma</a> - Availability: 2.0.0 近隣のピクセル値の範囲を計算するラスタ処理関数です。</li><li class="listitem"><a class="link" href="#RT_ST_Reclass" title="ST_Reclass">ST_Reclass</a> - Availability: 2.0.0  元のラスタから再分類したバンドタイプからなるラスタを生成します。nbandは変更するバンドです。nbandが指定されていない場合には、1と仮定します。他の全てのバンドは変更せずに返します。可視画像の書式としてより単純な描画を行うために、16BUIバンドを8BUIバンドに変換する、等のために使います。</li><li class="listitem"><a class="link" href="#ST_RelateMatch" title="ST_RelateMatch">ST_RelateMatch</a> - Availability: 2.0.0 - GEOS 3.3.0以上が必要  intersectionMattrixPattern1がintersectionMatrixPattern2を含む場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#ST_RemEdgeModFace" title="ST_RemEdgeModFace">ST_RemEdgeModFace</a> - Availability: 2.0  エッジを削除し、削除対象エッジでフェイスが二つに分割されているなら、両方の空間をとるため、一つを削除して、もう一つを編集します。</li><li class="listitem"><a class="link" href="#ST_RemEdgeNewFace" title="ST_RemEdgeNewFace">ST_RemEdgeNewFace</a> - Availability: 2.0  エッジを削除し、消去対象エッジでフェイスが二つに分割されているなら元の二つのフェイスを削除し、一つの新しいフェイスに置き換えます。</li><li class="listitem"><a class="link" href="#RT_ST_Resample" title="ST_Resample">ST_Resample</a> - Availability: 2.0.0 GDAL 1.6.1以上が必要です。 指定したリサンプリングアルゴリズム、新しいピクセル範囲、グリッドの隅、定義するか他のラスタから借りてきた地理参照属性を使ってリサンプリングを行います。</li><li class="listitem"><a class="link" href="#RT_ST_Rescale" title="ST_Rescale">ST_Rescale</a> - Availability: 2.0.0 GDAL 1.6.1以上が必要です。 スケール (ピクセルサイズ)だけを調整するリサンプリングを行います。新しいピクセル値のリサンプリングアルゴリズムとして最近傍補間 ('NearestNeighbor' (米式綴り方))、双線形補間 ('Bilinear')、3次補間 ('Cubic')、3次スプライン補間 ('CubicSpline')、ランチョス補間 ('Lanczos')を用います。デフォルトは最近傍補間です。</li><li class="listitem"><a class="link" href="#RT_ST_Reskew" title="ST_Reskew">ST_Reskew</a> - Availability: 2.0.0 GDAL 1.6.1以上が必要です。 キュー (回転パラメタ)だけを調整するリサンプリングを行います。新しいピクセル値のリサンプリングアルゴリズムとして最近傍補間 ('NearestNeighbor' (米式綴り方))、双線形補間 ('Bilinear')、3次補間 ('Cubic')、3次スプライン補間 ('CubicSpline')、ランチョス補間 ('Lanczos')を用います。デフォルトは最近傍補間です。</li><li class="listitem"><a class="link" href="#RT_ST_SameAlignment" title="ST_SameAlignment">ST_SameAlignment</a> - Availability: 2.0.0 ラスタが同じスキュー、スケール、空間参照系、オフセットを持つ (ピクセルが分割されることなく同じグリッドに置かれている)場合にTRUEを返し、そうでない場合は問題を詳述する通知とともにFALSEを返します。</li><li class="listitem"><a class="link" href="#RT_ST_SetBandIsNoData" title="ST_SetBandIsNoData">ST_SetBandIsNoData</a> - Availability: 2.0.0 バンドのisnodataフラグをTRUEにします。</li><li class="listitem"><a class="link" href="#ST_SharedPaths" title="ST_SharedPaths">ST_SharedPaths</a> - Availability: 2.0.0 GEOS 3.3.0以降が必要です。 二つのLINESTRING/MULTILINESTRINGの入力が共有するパスのコレクションを返します。</li><li class="listitem"><a class="link" href="#RT_ST_Slope" title="ST_Slope">ST_Slope</a> - Availability: 2.0.0  標高ラスタバンドの傾斜角 (デフォルトでは度単位)を返します。地形解析に使えます。</li><li class="listitem"><a class="link" href="#ST_Snap" title="ST_Snap">ST_Snap</a> - Availability: 2.0.0 GEOS 3.3.0以降が必要です。 入力ジオメトリの辺と頂点を参照ジオメトリの頂点にスナップします。</li><li class="listitem"><a class="link" href="#RT_ST_SnapToGrid" title="ST_SnapToGrid">ST_SnapToGrid</a> - Availability: 2.0.0 GDAL 1.6.1以上が必要です。 グリッドにスナップすることでラスタをリサンプリングします。新しいピクセル値のリサンプリングアルゴリズムとして最近傍補間 ('NearestNeighbor' (米式綴り方))、双線形補間 ('Bilinear')、3次補間 ('Cubic')、3次スプライン補間 ('CubicSpline')、ランチョス補間('Lanczos')を用います。デフォルトは最近傍補間です。</li><li class="listitem"><a class="link" href="#ST_Split" title="ST_Split">ST_Split</a> - Availability: 2.0.0 ジオメトリを分割したジオメトリのコレクションを返します。</li><li class="listitem"><a class="link" href="#RT_ST_StdDev4ma" title="ST_StdDev4ma">ST_StdDev4ma</a> - Availability: 2.0.0 近隣のピクセル値の標準偏差を計算するラスタ処理関数です。</li><li class="listitem"><a class="link" href="#RT_ST_Sum4ma" title="ST_Sum4ma">ST_Sum4ma</a> - Availability: 2.0.0 近隣のピクセル値の合計を計算するラスタ処理関数です。</li><li class="listitem"><a class="link" href="#RT_ST_SummaryStats" title="ST_SummaryStats">ST_SummaryStats</a> - Availability: 2.0.0  ラスタまたはラスタカバレッジの指定したバンドについて、ピクセル数、合計値、平均値、標準偏差、最小値、最大値からなる統計情報の概要を返します。バンドを指定しない場合には、1番と仮定します。</li><li class="listitem"><a class="link" href="#RT_ST_Transform" title="ST_Transform">ST_Transform</a> - Availability: 2.0.0 GDAL 1.6.1以上が必要です。 ラスタを既知の空間参照系から他の既知の空間参照系に、指定したリサンプリングアルゴリズムで投影変換します。新しいピクセル値のリサンプリングアルゴリズムとして最近傍補間 ('NearestNeighbor' (米式綴り方))、双線形補間 ('Bilinear')、3次補間 ('Cubic')、3次スプライン補間 ('CubicSpline')、ランチョス補間 ('Lanczos')を用います。デフォルトは最近傍補間です。</li><li class="listitem"><a class="link" href="#ST_UnaryUnion" title="ST_UnaryUnion">ST_UnaryUnion</a> - Availability: 2.0.0 - GEOS 3.3.0以上が必要  ST_Unionに似ていますが、ジオメトリ要素レベルで動作します。</li><li class="listitem"><a class="link" href="#RT_ST_Union" title="ST_Union">ST_Union</a> - Availability: 2.0.0  ラスタタイルの集合を結合して1以上のバンドからなる単一ラスタを返します。</li><li class="listitem"><a class="link" href="#RT_ST_ValueCount" title="ST_ValueCount">ST_ValueCount</a> - Availability: 2.0.0  ラスタ　(またはラスタカバレッジ)の指定されたバンドで、指定した値を持つピクセルを対象として、ピクセルバンド値とピクセル数からなるレコードの集合を返します。バンドを指定しない場合には、1番と仮定します。デフォルトではNODATA値のピクセルは数えられず、ピクセルの他の値は出力され、ピクセルバンド値は最も近い整数に丸められます。</li><li class="listitem"><a class="link" href="#TopoElementArray_Agg" title="TopoElementArray_Agg">TopoElementArray_Agg</a> - Availability: 2.0.0 element_idとタイプの配列 (topoelements)からなるtopoelementarrayを返します。</li><li class="listitem"><a class="link" href="#TopoGeo_AddLineString" title="TopoGeo_AddLineString">TopoGeo_AddLineString</a> - Availability: 2.0.0 許容差を使って既存のトポロジにラインストリングを追加し、可能ならエッジ/フェイスを分割します。</li><li class="listitem"><a class="link" href="#TopoGeo_AddPoint" title="TopoGeo_AddPoint">TopoGeo_AddPoint</a> - Availability: 2.0.0 許容差を使って既存のトポロジにポイントを追加し、可能ならエッジを分割します。</li><li class="listitem"><a class="link" href="#TopoGeo_AddPolygon" title="TopoGeo_AddPolygon">TopoGeo_AddPolygon</a> - Availability: 2.0.0 許容差を使って既存のトポロジにポリゴンを追加し、可能ならエッジ/フェイスを分割します。</li><li class="listitem"><a class="link" href="#TopologySummary" title="TopologySummary">TopologySummary</a> - Availability: 2.0.0 トポロジ名を取り、トポロジ内のオブジェクトの型に関する概要の全体を提供します。</li><li class="listitem"><a class="link" href="#Topology_Load_Tiger" title="Topology_Load_Tiger">Topology_Load_Tiger</a> - Availability: 2.0.0  Tigerデータの定義領域をPostGISトポロジにロードして、Tigerデータをトポロジの空間参照系に投影変換し、トポロジの許容精度にスナップします。</li><li class="listitem"><a class="link" href="#toTopoGeom" title="toTopoGeom">toTopoGeom</a> - Availability: 2.0 単純なジオメトリからTopoGeometryを生成します。</li><li class="listitem"><a class="link" href="#RT_Raster_Contains" title="~">~</a> - Availability: 2.0.0 AのバウンディングボックスがBのバウンディングボックスを含む場合にTRUEを返します。倍精度浮動小数点数のバウンディングボックスを使います。</li><li class="listitem"><a class="link" href="#RT_Raster_Same" title="~=">~=</a> - Availability: 2.0.0 AのバウンディングボックスがBのバウンディングボックスと同じ場合にTRUEを返します。</li></ul></div><p>PostGIS 2.0で機能強化された関数</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#AddGeometryColumn" title="AddGeometryColumn">AddGeometryColumn</a> - Enhanced: 2.0.0 use_typmod引数が導入されました。デフォルトでは制約を基にしたものでなくtypmodジオメトリカラムが生成されます。</li><li class="listitem"><a class="link" href="#Box2D" title="Box2D">Box2D</a> - Enhanced: 2.0.0 多面体サーフェス対応、三角対応、TIN対応が導入されました。</li><li class="listitem"><a class="link" href="#Box3D" title="Box3D">Box3D</a> - Enhanced: 2.0.0 多面体サーフェス対応、三角対応、TIN対応が導入されました。</li><li class="listitem"><a class="link" href="#Geocode" title="Geocode">Geocode</a> - Enhanced: 2.0.0 Tiger 2010構造のデータに対応しました。実行速度とジオコーディング精度を改善し、ストリート住所の位置を中心線から側線に移動するための改訂を行いました。また、良い結果の数を指定したり、最も良い結果だけを返すようにするのに使う新しいパラメータmax_resultsを導入しました。</li><li class="listitem"><a class="link" href="#GeometryType" title="GeometryType">GeometryType</a> - Enhanced: 2.0.0 多面体サーフェス対応、三角対応、TIN対応が導入されました。</li><li class="listitem"><a class="link" href="#Populate_Geometry_Columns" title="Populate_Geometry_Columns">Populate_Geometry_Columns</a> - Enhanced: 2.0.0 use_typmod任意引数が導入されました。カラムが型修飾子で生成されるか制約チェックで作られるかの制御ができます。</li><li class="listitem"><a class="link" href="#RT_ST_Intersection" title="ST_Intersection">ST_Intersection</a> - Enhanced: 2.0.0 - ラスタ空間のインタセクションが導入されました。2.0.0より前の版では、ベクタ空間でのインタセクションの計算のみに対応していました。 </li><li class="listitem"><a class="link" href="#RT_ST_Intersects" title="ST_Intersects">ST_Intersects</a> - Enhanced: 2.0.0 ラスタ/ラスタのインタセクト対応が導入されました。 </li><li class="listitem"><a class="link" href="#RT_ST_Value" title="ST_Value">ST_Value</a> - Enhanced: 2.0.0 任意引数exclude_nodata_valueが追加されました。</li><li class="listitem"><a class="link" href="#ST_3DExtent" title="ST_3DExtent">ST_3DExtent</a> - Enhanced: 2.0.0 多面体サーフェス対応、三角対応、TIN対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_Accum" title="ST_Accum">ST_Accum</a> - Enhanced: 2.0.0 多面体サーフェス対応、三角対応、TIN対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_Affine" title="ST_Affine">ST_Affine</a> - Enhanced: 2.0.0 多面体サーフェス対応、三角対応、TIN対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_Area" title="ST_Area">ST_Area</a> - Enhanced: 2.0.0 - 2次元多面体サーフェス対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_AsBinary" title="ST_AsBinary">ST_AsBinary</a> - Enhanced: 2.0.0 多面体サーフェス対応、三角対応、TIN対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_AsBinary" title="ST_AsBinary">ST_AsBinary</a> - Enhanced: 2.0.0 高次元が導入されました。</li><li class="listitem"><a class="link" href="#ST_AsBinary" title="ST_AsBinary">ST_AsBinary</a> - Enhanced: 2.0.0 ジオグラフィでのエンディアン指定が導入されました。</li><li class="listitem"><a class="link" href="#ST_AsEWKB" title="ST_AsEWKB">ST_AsEWKB</a> - Enhanced: 2.0.0 多面体サーフェス対応、三角対応、TIN対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_AsEWKT" title="ST_AsEWKT">ST_AsEWKT</a> - Enhanced: 2.0.0 ジオグラフィ対応、多面体サーフェス対応、三角形対応、TIN対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_AsGML" title="ST_AsGML">ST_AsGML</a> - Enhanced: 2.0.0 プレフィクスが導入されました。 GML 3用であるoptionsの4は、曲線のかわりにラインストリングを使えるようにするためのものです。GML 3の多面体サーフェスとTINが導入されました。optionsの32はボックスを出力するために導入されました。</li><li class="listitem"><a class="link" href="#ST_AsKML" title="ST_AsKML">ST_AsKML</a> - Enhanced: 2.0.0 - プレフィクス名前空間を追加しました。デフォルトではプリフィクス無しです。</li><li class="listitem"><a class="link" href="#ST_Azimuth" title="ST_Azimuth">ST_Azimuth</a> - Enhanced: 2.0.0 ジオグラフィ対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_ChangeEdgeGeom" title="ST_ChangeEdgeGeom">ST_ChangeEdgeGeom</a> - Enhanced: 2.0.0版で、トポロジ整合性の強制を追加しました。 </li><li class="listitem"><a class="link" href="#ST_Dimension" title="ST_Dimension">ST_Dimension</a> - Enhanced: 2.0.0 多面体サーフェス対応とTIN対応が導入されました。空ジオメトリを与えた場合に例外を投げなくなりました。</li><li class="listitem"><a class="link" href="#ST_Dump" title="ST_Dump">ST_Dump</a> - Enhanced: 2.0.0 多面体サーフェス対応、三角対応、TIN対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_DumpPoints" title="ST_DumpPoints">ST_DumpPoints</a> - Enhanced: 2.0.0 多面体サーフェス対応、三角対応、TIN対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_Expand" title="ST_Expand">ST_Expand</a> - Enhanced: 2.0.0 多面体サーフェス対応、三角対応、TIN対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_Extent" title="ST_Extent">ST_Extent</a> - Enhanced: 2.0.0 多面体サーフェス対応、三角対応、TIN対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_Force2D" title="ST_Force2D">ST_Force2D</a> - Enhanced: 2.0.0 多面体サーフェス対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_ForceRHR" title="ST_ForceRHR">ST_ForceRHR</a> - Enhanced: 2.0.0 多面体サーフェス対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_Force_3D" title="ST_Force3D">ST_Force3D</a> - Enhanced: 2.0.0 多面体サーフェス対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_Force_3DZ" title="ST_Force3DZ">ST_Force3DZ</a> - Enhanced: 2.0.0 多面体サーフェス対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_Force_Collection" title="ST_ForceCollection">ST_ForceCollection</a> - Enhanced: 2.0.0 多面体サーフェス対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_GMLToSQL" title="ST_GMLToSQL">ST_GMLToSQL</a> - Enhanced: 2.0.0 多面体サーフェス対応とTIN対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_GMLToSQL" title="ST_GMLToSQL">ST_GMLToSQL</a> - Enhanced: 2.0.0 SRID任意引数が追加されました。</li><li class="listitem"><a class="link" href="#ST_GeomFromEWKB" title="ST_GeomFromEWKB">ST_GeomFromEWKB</a> - Enhanced: 2.0.0 多面体サーフェス対応とTIN対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_GeomFromEWKT" title="ST_GeomFromEWKT">ST_GeomFromEWKT</a> - Enhanced: 2.0.0 多面体サーフェス対応とTIN対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_GeomFromGML" title="ST_GeomFromGML">ST_GeomFromGML</a> - Enhanced: 2.0.0 多面体サーフェス対応とTIN対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_GeomFromGML" title="ST_GeomFromGML">ST_GeomFromGML</a> - Enhanced: 2.0.0 SRID任意引数が追加されました。</li><li class="listitem"><a class="link" href="#ST_GeometryN" title="ST_GeometryN">ST_GeometryN</a> - Enhanced: 2.0.0 多面体サーフェス対応、三角対応、TIN対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_GeometryType" title="ST_GeometryType">ST_GeometryType</a> - Enhanced: 2.0.0 多面体サーフェス対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_IsClosed" title="ST_IsClosed">ST_IsClosed</a> - Enhanced: 2.0.0 多面体サーフェス対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_MakeEnvelope" title="ST_MakeEnvelope">ST_MakeEnvelope</a> - Enhanced: 2.0 SRID指定なしでエンベロープを指定できるようになりました。</li><li class="listitem"><a class="link" href="#ST_MakeValid" title="ST_MakeValid">ST_MakeValid</a> - Enhanced: 2.0.1 速度向上しました。GEOS 3.3.4が必要です。</li><li class="listitem"><a class="link" href="#ST_NPoints" title="ST_NPoints">ST_NPoints</a> - Enhanced: 2.0.0 多面体サーフェス対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_NumGeometries" title="ST_NumGeometries">ST_NumGeometries</a> - Enhanced: 2.0.0 多面体サーフェス対応、三角対応、TIN対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_Relate" title="ST_Relate">ST_Relate</a> - Enhanced: 2.0.0 - 境界ノード規則が追加されました (GEOS 3.0以上が必要です)。</li><li class="listitem"><a class="link" href="#ST_Rotate" title="ST_Rotate">ST_Rotate</a> - Enhanced: 2.0.0 多面体サーフェス対応、三角対応、TIN対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_Rotate" title="ST_Rotate">ST_Rotate</a> - Enhanced: 2.0.0 回転の原点を指定するパラメタを追加しました。</li><li class="listitem"><a class="link" href="#ST_RotateX" title="ST_RotateX">ST_RotateX</a> - Enhanced: 2.0.0 多面体サーフェス対応、三角対応、TIN対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_RotateY" title="ST_RotateY">ST_RotateY</a> - Enhanced: 2.0.0 多面体サーフェス対応、三角対応、TIN対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_RotateZ" title="ST_RotateZ">ST_RotateZ</a> - Enhanced: 2.0.0 多面体サーフェス対応、三角対応、TIN対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_Scale" title="ST_Scale">ST_Scale</a> - Enhanced: 2.0.0 多面体サーフェス対応、三角対応、TIN対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_Shift_Longitude" title="ST_ShiftLongitude">ST_ShiftLongitude</a> - Enhanced: 2.0.0 多面体サーフェス対応とTIN対応が導入されました。</li><li class="listitem"><a class="link" href="#ST_Summary" title="ST_Summary">ST_Summary</a> - Enhanced: 2.0.0でジオグラフィ対応が追加されました。</li><li class="listitem"><a class="link" href="#ST_Transform" title="ST_Transform">ST_Transform</a> - Enhanced: 2.0.0 多面体サーフェス対応が導入されました。</li><li class="listitem"><a class="link" href="#ValidateTopology" title="ValidateTopology">ValidateTopology</a> - Enhanced: 2.0.0では、より効果的なエッジ交差検出が可能になり、以前の版で残っていた偽陽性を解決しています。</li><li class="listitem"><a class="link" href="#geometry_overlaps" title="&amp;&amp;">&amp;&amp;</a> - Enhanced: 2.0.0 多面体サーフェス対応が導入されました。</li></ul></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="NewFunctions_2_0_Changed"></a>14.12.9. PostGIS 2.0で変更された関数</h3></div></div></div><p>次に示す関数は、PostGIS2.0で変更されたもので、アプリケーションの変更が必要になる場合があります。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ほとんどの非推奨関数は削除されました。これらは、1.2から文書には出ていないか、絶対に文書化されない内部関数です。文書に無い関数を使用している場合には、非推奨関数になっているか、非推奨になろうとしているか、内部関数の可能性があります。これらは避けるべきです。非推奨関数を使っているアプリケーションやツールの対応に関する詳細情報については<a class="xref" href="#legacy_faq" title="3.2.">問： 3.2</a>をご覧下さい。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>ジオメトリのバウンディングボックスはfloat4から倍精度浮動小数点数 (float8)に変わりました。バウンディングボックス演算子を使う場合とバウンディングボックスからジオメトリへのキャストに影響が出ます。たとえば、ST_SetSRID(abbox)は、しばしば、以前の版ではビューポートクエリの答をわずかに変更する可能性がありますが、PostGIS 2.0以上では、それとは異なる、より精度の良い答えを返します。</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>hasnodata引数は、同じ意味ですがより目的がはっきり分かるexclude_nodata_valueに置き換えられました。</p></td></tr></table></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#AddGeometryColumn" title="AddGeometryColumn">AddGeometryColumn</a> - Changed: 2.0.0 geometry_columnsがシステムカタログを読むビューになったため、geometry_columnsを更新しないようになりました。デフォルトでは制約を生成せず、PostgreSQLの型修飾子を使います。この関数によるWGS 84のPOINTカラムの構築とALTER TABLE some_table ADD COLUMN geom geometry(Point,4326);とは等価です。 </li><li class="listitem"><a class="link" href="#AddGeometryColumn" title="AddGeometryColumn">AddGeometryColumn</a> - Changed: 2.0.0 制約を使う必要がある場合には、use_typmodをFALSEにします。</li><li class="listitem"><a class="link" href="#AddGeometryColumn" title="AddGeometryColumn">AddGeometryColumn</a> - Changed: 2.0.0 ビューについては、geometry_columnsへの手動登録はできなくなりました。しかし、typmodテーブルジオメトリに対して構築されていて、かつラッパ関数が無いビューは、親テーブルカラムのtypmodの挙動を継承するので、正しく登録されます。他のジオメトリを出力するジオメトリ関数を使うビューについては、ビューのジオメトリカラムが正しく登録されるようにするため、typmodジオメトリへのキャストが必要です。を参照して下さい。 </li><li class="listitem"><a class="link" href="#DropGeometryColumn" title="DropGeometryColumn">DropGeometryColumn</a> - Changed: 2.0.0 この関数は後方互換のためのものです。geometry_columnsは現在はシステムカタログに対するビューですので、他のテーブルのカラムと同じようにALTER TABLEを使った削除が可能です。</li><li class="listitem"><a class="link" href="#DropGeometryTable" title="DropGeometryTable">DropGeometryTable</a> - Changed: 2.0.0で この関数は後方互換のためのものです。geometry_columnsは現在はシステムカタログに対するビューですので、他のテーブルのカラムと同じようにDROP TABLEを使った削除が可能です。</li><li class="listitem"><a class="link" href="#Populate_Geometry_Columns" title="Populate_Geometry_Columns">Populate_Geometry_Columns</a> - Changed: 2.0.0 デフォルトでは、ジオメトリタイプの制限について、制約を確認する代わりに型修飾子を使います。新しいuse_typmodをFALSEに設定して使うことで、制約確認を使用することができます。</li><li class="listitem"><a class="link" href="#RT_Box3D" title="Box3D">Box3D</a> - Changed: 2.0.0 以前の版では、box3dでなくbox2dを使っていました。box2dは非推奨型となり、box3dに変更しました。</li><li class="listitem"><a class="link" href="#RT_ST_GDALDrivers" title="ST_GDALDrivers">ST_GDALDrivers</a> - Changed: 2.0.6, 2.1.3 - GUC (訳注: Grand Unified Configurationの略で、動的に変更できるPostgreSQLパラメータ)または環境変数gdal_enabled_driversが設定されていないデフォルトではドライバが全て無効になりました。</li><li class="listitem"><a class="link" href="#RT_ST_ScaleX" title="ST_ScaleX">ST_ScaleX</a> - Changed: 2.0.0. WKTRaster版ではST_PixelSizeXと呼ばれていました。</li><li class="listitem"><a class="link" href="#RT_ST_ScaleY" title="ST_ScaleY">ST_ScaleY</a> - Changed: 2.0.0. WKTRaster版ではST_PixelSizeYと呼ばれていました。</li><li class="listitem"><a class="link" href="#RT_ST_SetScale" title="ST_SetScale">ST_SetScale</a> - Changed: 2.0.0 WKTRaster版では、ST_SetPixelSizeと呼ばれていました。2.0.0で変更されました。</li><li class="listitem"><a class="link" href="#ST_3DExtent" title="ST_3DExtent">ST_3DExtent</a> - Changed: 2.0.0 以前の版ではST_Extent3Dと呼ばれていました。</li><li class="listitem"><a class="link" href="#ST_3DLength" title="ST_3DLength">ST_3DLength</a> - Changed: 2.0.0 以前の版ではST_Length3Dと呼ばれていました。</li><li class="listitem"><a class="link" href="#ST_3DMakeBox" title="ST_3DMakeBox">ST_3DMakeBox</a> - Changed: 2.0.0以前の版ではST_MakeBox3Dと呼ばれていました。</li><li class="listitem"><a class="link" href="#ST_3DPerimeter" title="ST_3DPerimeter">ST_3DPerimeter</a> - Changed: 2.0.0 以前の版ではST_Perimeter3Dと呼ばれていました。</li><li class="listitem"><a class="link" href="#ST_AsBinary" title="ST_AsBinary">ST_AsBinary</a> - Changed: 2.0.0 この関数への入力は不明な型にすることができなくなり、必ずジオメトリでなければなりません。ST_AsBinary('POINT(1 2)')といった構築ではもはや妥当ではなく、n st_asbinary(unknown) is not unique errorが得られます。このようなコードはST_AsBinary('POINT(1 2)'::geometry);に変更する必要があります。これが不可能な場合にはlegacy.sqlをインストールして下さい。</li><li class="listitem"><a class="link" href="#ST_AsGML" title="ST_AsGML">ST_AsGML</a> - Changed: 2.0.0 デフォルトの名前付き引数を使います。</li><li class="listitem"><a class="link" href="#ST_AsGeoJSON" title="ST_AsGeoJSON">ST_AsGeoJSON</a> - Changed: 2.0.0 デフォルト引数と名前付き引数に対応しました。</li><li class="listitem"><a class="link" href="#ST_AsKML" title="ST_AsKML">ST_AsKML</a> - Changed: 2.0.0 - デフォルト引数と名前付き引数に対応しました。</li><li class="listitem"><a class="link" href="#ST_AsSVG" title="ST_AsSVG">ST_AsSVG</a> - Changed: 2.0.0 - デフォルト引数と名前付き引数に対応しました。</li><li class="listitem"><a class="link" href="#ST_EndPoint" title="ST_EndPoint">ST_EndPoint</a> - Changed: 2.0.0では単一ジオメトリのMULTILINESTRINGで動作しなくなりました。単一のラインストリングからなるMULTILINESTRINGについては幸運にも動いていて、最初のポイントを返していました。2.0.0では他のMULTILINESTRINGと同様にNULLを返すようになりました。古い挙動は記載されていませんでしたが、LINESTRINGとして格納されているデータを持っていると思われる人々は2.0でNULLが返って来ることを経験することでしょう。</li><li class="listitem"><a class="link" href="#ST_GeomFromText" title="ST_GeomFromText">ST_GeomFromText</a> - Changed: 2.0.0 前の版ではST_GeomFromText('GEOMETRYCOLLECTION(EMPTY)')が許されていました。SQL/MM標準への適合のためPostGIS 2.0.0では不正とされます。今はST_GeomFromText('GEOMETRYCOLLECTION EMPTY')となります。</li><li class="listitem"><a class="link" href="#ST_GeometryN" title="ST_GeometryN">ST_GeometryN</a> - Changed: 2.0.0 以前の版では非マルチのジオメトリではNULLが返りました。ST_GeometryN(..,1)の場合にはジオメトリを返すよう変更されました。</li><li class="listitem"><a class="link" href="#ST_IsEmpty" title="ST_IsEmpty">ST_IsEmpty</a> - Changed: 2.0.0 以前の版のPostGISではST_GeomFromText('GEOMETRYCOLLECTION(EMPTY)')を許しました。PostGIS 2.0.0では、SQL/MM標準により準拠させるため、これは不正となります。</li><li class="listitem"><a class="link" href="#ST_Length" title="ST_Length">ST_Length</a> - Changed: 2.0.0 大幅な変更 -- 以前の版ではジオグラフィのPOLYGONやMULTIPOLYGONへの適用によってPOLYGONやMULTIPOLYGONの周囲長を返しました。2.0.0版ではジオメトリの挙動に従うため0を返すように変更しました。ポリゴンの周囲長を求める場合は、ST_Perimeterを使います。</li><li class="listitem"><a class="link" href="#ST_LocateAlong" title="ST_LocateAlong">ST_LocateAlong</a> - Changed: 2.0.0 以前の版ではST_Locate_Along_Measureと呼ばれていましたが、古い名前は非推奨となり、将来的には削除しますが現時点では有効です。</li><li class="listitem"><a class="link" href="#ST_LocateBetween" title="ST_LocateBetween">ST_LocateBetween</a> - Changed: 2.0.0 以前の版でST_Locate_Between_Measuresと呼ばれていましたが、古い名前は非推奨となり、将来的には削除しますが現時点では後方互換のため有効になっています。</li><li class="listitem"><a class="link" href="#ST_ModEdgeSplit" title="ST_ModEdgeSplit">ST_ModEdgeSplit</a> - Changed: 2.0 - 以前の版では名前を間違えてST_ModEdgesSplitになっていました。</li><li class="listitem"><a class="link" href="#ST_NumGeometries" title="ST_NumGeometries">ST_NumGeometries</a> - Changed: 2.0.0 前の版では、ジオメトリがコレクション/マルチ系でない場合にはNULLを返しました。2.0.0以上では、POLYGON, LINESTRING, POINTといった単一ジオメトリについては1を返します。</li><li class="listitem"><a class="link" href="#ST_NumInteriorRings" title="ST_NumInteriorRings">ST_NumInteriorRings</a> - Changed: 2.0.0 - 以前の版では、MULTIPOLYGONを渡して最初のPOLYGONの内環の数を返すことができました。</li><li class="listitem"><a class="link" href="#ST_PointN" title="ST_PointN">ST_PointN</a> - Changed: 2.0.0 単一ジオメトリのMULTILINESTRINGで動作しなくなりました。単一のラインストリングからなるMULTILINESTRINGについては幸運にも動いていて、最初のポイントを返していました。2.0.0では他のMULTILINESTRINGと同様にNULLを返すようになりました。</li><li class="listitem"><a class="link" href="#ST_StartPoint" title="ST_StartPoint">ST_StartPoint</a> - Changed: 2.0.0では単一ジオメトリのMULTILINESTRINGで動作しなくなりました。単一のラインストリングからなるMULTILINESTRINGについては幸運にも動いていて、最初のポイントを返していました。2.0.0では他のMULTILINESTRINGと同様にNULLを返すようになりました。古い挙動は記載されていませんでしたが、LINESTRINGとして格納されているデータを持っていると思われる人々は2.0でNULLが返って来ることを経験することでしょう。</li></ul></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="NewFunctions_1_5"></a>14.12.10. PostGIS 1.5で新規作成/機能強化/変更された関数</h3></div></div></div><p>次に示す関数は、新規作成または機能強化されたPostGIS関数です。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#PostGIS_LibXML_Version" title="PostGIS_LibXML_Version">PostGIS_LibXML_Version</a> - Availability: 1.5 LibXML2ライブラリのバージョン番号を返します。</li><li class="listitem"><a class="link" href="#ST_AddMeasure" title="ST_AddMeasure">ST_AddMeasure</a> - Availability: 1.5.0 始点と終点の間を線型補完した、M値を持つ派生ジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_AsBinary" title="ST_AsBinary">ST_AsBinary</a> - Availability: 1.5.0 ジオグラフィが導入されました。 ジオメトリ/ジオグラフィのSRIDメタデータのないWell-Known Binary (WKB)表現を返します。</li><li class="listitem"><a class="link" href="#ST_AsGML" title="ST_AsGML">ST_AsGML</a> - Availability: 1.5.0 ジオグラフィが導入されました。 GML第2版または第3版としてジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_AsGeoJSON" title="ST_AsGeoJSON">ST_AsGeoJSON</a> - Availability: 1.5.0 ジオグラフィが導入されました。 GeoJSON要素としてジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_AsText" title="ST_AsText">ST_AsText</a> - Availability: 1.5 - ジオグラフィ対応が導入されました。 ジオメトリ/ジオグラフィのSRIDメタデータのないWell-Known Text (WKT)表現を返します。</li><li class="listitem"><a class="link" href="#ST_Buffer" title="ST_Buffer">ST_Buffer</a> - Availability: 1.5 - ST_Bufferが異なる終端と継ぎ目の型に対応するよう強化されました。たとえば、道路ラインストリングを、丸の代わりに平坦や四角形の終端を持つ道路ポリゴンに変換するのに使います。ジオグラフィ用の薄いラッパが追加されました。最新のジオメトリ機能の利点を得るにはGEOS 3.2以上が必要です。  (T) このジオメトリからの距離が指定された距離以下となる点全てを表現するジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_ClosestPoint" title="ST_ClosestPoint">ST_ClosestPoint</a> - Availability: 1.5.0 g2に最も接近するg1上の2次元のポイントを返します。これは最短線の最初のポイントです。</li><li class="listitem"><a class="link" href="#ST_CollectionExtract" title="ST_CollectionExtract">ST_CollectionExtract</a> - Availability: 1.5.0 (マルチ)ジオメトリを与えると、指定したタイプの要素でのみ構成される (マルチ)ジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_Covers" title="ST_Covers">ST_Covers</a> - Availability: 1.5 - ジオグラフィ対応が導入されました。  ジオメトリBにジオメトリAの外となるポイントが無い場合には、1 (TRUE)を返します。</li><li class="listitem"><a class="link" href="#ST_DFullyWithin" title="ST_DFullyWithin">ST_DFullyWithin</a> - Availability: 1.5.0 全てのジオメトリが指定したジオメトリから指定した距離内にある場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#ST_DWithin" title="ST_DWithin">ST_DWithin</a> - Availability: 1.5.0 ジオグラフィが導入されました。 ジオメトリが指定したジオメトリから指定した距離内にある場合にTRUEを返します。ジオメトリについては、距離は空間参照系で定義されている単位になります。ジオグラフィについては、メートル単位で、デフォルトではuse_spheroid=true (回転楕円体を使った計算)となり、速いチェックをするにはuse_spheroid=falseとして球面を使って計算します。</li><li class="listitem"><a class="link" href="#ST_Distance" title="ST_Distance">ST_Distance</a> - Availability: 1.5.0 1.5でジオグラフィ対応が導入されました。大きいジオメトリや頂点の多いジオメトリについての速度が改善しました。 ジオメトリ型については、二つのジオメトリの、2次元の最小デカルト距離 (空間参照系に基づきます)を、投影法の単位で返します。ジオグラフィ型については、デフォルトでは、二つのジオメトリ間の測地距離をメートル単位で返します。</li><li class="listitem"><a class="link" href="#ST_DistanceSphere" title="ST_DistanceSphere">ST_DistanceSphere</a> - Availability: 1.5 - ポイント以外のジオメトリが導入されました。以前の版ではポイントでのみ動作しました。 二つの経度緯度ジオメトリの間の最短距離をメートル単位で返します。SRIDで定義された回転楕円体に由来する半径となる球面を使います。より高速ですが、精度が悪くなります。PostGISの1.5より前の版ではポイント間の計測のみ実装していました。</li><li class="listitem"><a class="link" href="#ST_Distance_Spheroid" title="ST_DistanceSpheroid">ST_DistanceSpheroid</a> - Availability: 1.5 - ポイント以外のジオメトリが導入されました。以前の版ではポイントでのみ動作しました。 指定した回転楕円体による、二つの経度緯度ジオメトリ間の最小距離を返します。PostGIS 1.5より前ではポイント間の計測のみ対応していました。</li><li class="listitem"><a class="link" href="#ST_DumpPoints" title="ST_DumpPoints">ST_DumpPoints</a> - Availability: 1.5.0 ジオメトリを作る全ての点のgometry_dump(geom,path)行の集合を返します。</li><li class="listitem"><a class="link" href="#ST_Envelope" title="ST_Envelope">ST_Envelope</a> - Availability: 1.5.0 挙動が変更され出力がfloat4からfloat8になりました。 ジオメトリの浮動小数点数 (float8)バウンディングボックスを表現するジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_GMLToSQL" title="ST_GMLToSQL">ST_GMLToSQL</a> - Availability: 1.5 libxml2 1.6+が必要です。 GML表現から指定したST_Geometry値を返します。これはST_GeomFromGMLの別名です。</li><li class="listitem"><a class="link" href="#ST_GeomFromGML" title="ST_GeomFromGML">ST_GeomFromGML</a> - Availability: 1.5 libxml2 1.6+が必要です。 GML表現からPostGISジオメトリオブジェクトを出力します。</li><li class="listitem"><a class="link" href="#ST_GeomFromKML" title="ST_GeomFromKML">ST_GeomFromKML</a> - Availability: 1.5 libxml2 2.6以上が必要です。 ジオメトリのKML表現の入力をとり、PostGISジオメトリオブジェクトを出力します。</li><li class="listitem"><a class="link" href="#ST_Geometry_Same" title="~=">~=</a> - Availability: 1.5.0 挙動が変更されました AのバウンディングボックスがBのバウンディングボックスと同じ場合にTRUEを返します。</li><li class="listitem"><a class="link" href="#ST_HausdorffDistance" title="ST_HausdorffDistance">ST_HausdorffDistance</a> - Availability: 1.5.0 - GEOS 3.2.0以上が必要です。 二つのジオメトリ間のハウスドルフ距離を返します。基本的にジオメトリが似ているかどうかを計測するものです。単位はジオメトリの空間参照系の単位です。</li><li class="listitem"><a class="link" href="#ST_Intersection" title="ST_Intersection">ST_Intersection</a> - Availability: 1.5 ジオグラフィ型が導入されました。 (T) geomAとgeomBの共有する部分を表現するジオメトリを返します。</li><li class="listitem"><a class="link" href="#ST_Intersects" title="ST_Intersects">ST_Intersects</a> - Availability: 1.5 ジオグラフィ対応が導入されました。 ジオメトリ/ジオグラフィが「2次元空間で空間的にインタセクトする」 (空間に共有部分がある)場合にTRUEを返します。そうでない (非接続)場合はFALSEを返します。ジオグラフィについては、許容量は0.00001メートルです (近い点はインタセクトと考えられてしまいます)。</li><li class="listitem"><a class="link" href="#ST_Length" title="ST_Length">ST_Length</a> - Availability: 1.5.0 ジオグラフィt対応が導入されました。 ジオメトリがLINESTRINGまたはMULTILINESTRINGの場合には、それらの2次元長を返します。ジオメトリでは、単位は空間参照系の単位です。ジオグラフィでは、メートル単位です (回転楕円体がデフォルトです)。</li><li class="listitem"><a class="link" href="#ST_LongestLine" title="ST_LongestLine">ST_LongestLine</a> - Availability: 1.5.0 二つのジオメトリの2次元長が最長となるラインを返します。見つかったラインが複数ある場合は、最初のもののみ返します。返されるラインは常にg1側を始点、g2側を終点とします。この関数が返すラインの長さは、常に始点をg1に終点をg2にそれぞれ指定した場合のST_MaxDistanceが返す値と同じになります。</li><li class="listitem"><a class="link" href="#ST_MakeEnvelope" title="ST_MakeEnvelope">ST_MakeEnvelope</a> - Availability: 1.5 与えられた最小値と最大値から長方形ポリゴンを生成します。入力値はSRIDで指定された空間参照系でなければなりません。</li><li class="listitem"><a class="link" href="#ST_MaxDistance" title="ST_MaxDistance">ST_MaxDistance</a> - Availability: 1.5.0 二つのジオメトリ間の2次元距離の最大値を、投影法の単位で返します。</li><li class="listitem"><a class="link" href="#ST_ShortestLine" title="ST_ShortestLine">ST_ShortestLine</a> - Availability: 1.5.0 二つのジオメトリの2次元長が最短となるラインを返します。</li><li class="listitem"><a class="link" href="#geometry_overlaps" title="&amp;&amp;">&amp;&amp;</a> - Availability: 1.5.0 ジオグラフィ対応が導入されました。 Aの2次元バウンディングボックスがBの2次元バウンディングボックスとインタセクトする場合にTRUEを返します。</li></ul></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="NewFunctions_1_4"></a>14.12.11. PostGIS 1.4で新規作成/機能強化/変更された関数</h3></div></div></div><p>次に示す関数は、新規作成または機能強化されたPostGIS関数です。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#Populate_Geometry_Columns" title="Populate_Geometry_Columns">Populate_Geometry_Columns</a> - ジオメトリカラムが型修飾子で定義されるか、適切な制約を持つことを確実にします。ジオメトリカラムがgeometry_columnsに正しく登録されることを確実にします。デフォルトでは、型修飾子によらないジオメトリカラムを型修飾子によるジオメトリカラムに変換します。以前の挙動にするにはuse_typmod=falseとします。 Availability: 1.4.0</li><li class="listitem"><a class="link" href="#ST_AsSVG" title="ST_AsSVG">ST_AsSVG</a> - ジオメトリまたはジオグラフィで与えられたSVGパスデータによるジオメトリを返します。 
		  Availability: 1.2.2. Availability: 1.4.0 PostGIS 1.4.0でhttp://www.w3.org/TR/SVG/paths.html#PathDataBNFに従うため、絶対パスにLコマンドが入りました。
		</li><li class="listitem"><a class="link" href="#ST_Collect" title="ST_Collect">ST_Collect</a> - 他のジオメトリのコレクションから、指定したST_Geometry値を返します。 Availability: 1.4.0 - ST_Collect(geometry)が導入されました。ST_Collectがより多くのジオメトリをより早く扱えるよう強化されました。</li><li class="listitem"><a class="link" href="#ST_ContainsProperly" title="ST_ContainsProperly">ST_ContainsProperly</a> - BがAの内部にインタセクトするが境界 (または外部)にインタセクトしない場合に、TRUEを返します。Aは自身には、ContainsProperlyではありませんが、Containsです。 Availability: 1.4.0 - GEOS 3.1.0以上が必要です。</li><li class="listitem"><a class="link" href="#ST_Extent" title="ST_Extent">ST_Extent</a> - ジオメトリのバウンディングボックスを返す集約関数です。 
		  Availability: 1.4.0
		</li><li class="listitem"><a class="link" href="#ST_GeoHash" title="ST_GeoHash">ST_GeoHash</a> - ジオメトリのGeoHash表現を返します。 Availability: 1.4.0</li><li class="listitem"><a class="link" href="#ST_IsValidReason" title="ST_IsValidReason">ST_IsValidReason</a> - ジオメトリが妥当か否かを示す文字列を返し、不正な場合は理由を返します。 Availability: 1.4 - GEOS 3.1.0以上が必要です</li><li class="listitem"><a class="link" href="#ST_LineCrossingDirection" title="ST_LineCrossingDirection">ST_LineCrossingDirection</a> - 与えられた二つのラインストリングに関するクロスの種類を-3から3の区間の数で返します。0の場合はクロスしていません Availability: 1.4</li><li class="listitem"><a class="link" href="#ST_LocateBetweenElevations" title="ST_LocateBetweenElevations">ST_LocateBetweenElevations</a> - 指定したZ値の範囲内にある要素からなる、派生ジオメトリ (コレクション)値を返します。3次元、4次元のLINESTRINGSとMULTILINESTRINGSのみに対応しています。 Availability: 1.4.0</li><li class="listitem"><a class="link" href="#ST_MakeLine" title="ST_MakeLine">ST_MakeLine</a> - ポイント、マルチポイント、ラインジオメトリからラインストリングを生成します。 Availability: 1.4.0 - ST_MakeLine(geomarray)が導入されました。ST_MakeLine集約関数はより多くのポイントをより早く扱うための強化が施されています。</li><li class="listitem"><a class="link" href="#ST_MinimumBoundingCircle" title="ST_MinimumBoundingCircle">ST_MinimumBoundingCircle</a> - ジオメトリを完全に含む最小の円ポリゴンを返します。デフォルトでは、4分の1円に対して48区分を使用します。 Availability: 1.4.0 - GEOSが必要です。</li><li class="listitem"><a class="link" href="#ST_Union" title="ST_Union">ST_Union</a> - ジオメトリの結合の点集合を表現するジオメトリを返します。 Availability: 1.4.0 - ST_Unionが強化されました。ST_Union(geomarray)が導入され、また、PostgreSQL内での集計が速くなりました。GEOS 3.1.0以上を使用している場合は、ST_Unionは、http://blog.cleverelephant.ca/2009/01/must-faster-unions-in-postgis-14.htmlに記述がある、Cascaded Unionアルゴリズムを使います。</li></ul></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="NewFunctions_1_3"></a>14.12.12. PostGIS 1.3で新規作成された関数</h3></div></div></div><p>次に示す関数は、新規作成されたPostGIS関数です。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><a class="link" href="#ST_AsGML" title="ST_AsGML">ST_AsGML</a> - GML第2版または第3版としてジオメトリを返します。 Availability: 1.3.2</li><li class="listitem"><a class="link" href="#ST_AsGeoJSON" title="ST_AsGeoJSON">ST_AsGeoJSON</a> - GeoJSON要素としてジオメトリを返します。 Availability: 1.3.4</li><li class="listitem"><a class="link" href="#ST_CurveToLine" title="ST_CurveToLine">ST_CurveToLine</a> - CIRCULARSTRING/CURVEPOLYGONをLINESTRING/POLYGONに変換します。 Availability: 1.3.0</li><li class="listitem"><a class="link" href="#ST_LineToCurve" title="ST_LineToCurve">ST_LineToCurve</a> - LINESTRING/POLYGONをCIRCULARSTRINGかCURVEPOLYGONに変換します。 Availability: 1.3.0</li><li class="listitem"><a class="link" href="#ST_SimplifyPreserveTopology" title="ST_SimplifyPreserveTopology">ST_SimplifyPreserveTopology</a> - 与えられたジオメトリを「簡略化」したものを返します。Douglas-Peukerアルゴリズムを使用します。不正な派生ジオメトリ (特にポリゴン)の生成を回避します。 Availability: 1.3.3</li></ul></div></div></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="idp111106632"></a>第15章 問題を報告する</h1></div></div></div><div class="toc"><p><b>目次</b></p><dl class="toc"><dt><span class="sect1"><a href="#idp111107272">15.1. ソフトウェアのバグを報告する</a></span></dt><dt><span class="sect1"><a href="#idp111119944">15.2. 文書の問題を報告する</a></span></dt></dl></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp111107272"></a>15.1. ソフトウェアのバグを報告する</h2></div></div></div><p>効率的なバグの報告はPostGISの開発を助ける本質的な方法です。最も効率的なバグ報告は、PostGIS開発者がそれを再現できるようにすることで、それの引き金となったスクリプトと検出された環境に沿った全ての情報を含んでいるのが理想です。<code class="code">SELECT postgis_full_version()</code>[PostGIS]と<code class="code">SELECT version()</code>[PostgreSQL]とを実行することで十分に良い情報を得ることができます。</p><p>最新版を使っていない場合には<a class="ulink" href="http://svn.osgeo.org/postgis/trunk/NEWS" target="_top">release changelog</a>をまず見て、既にバグフィクスされていないかを探すのは価値のあることです。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/" target="_top">PostGIS bug tracker</a>を使うと、レポートが捨てられず、それの対応プロセスが通知されることを保証します。新しいバグを報告する前にデータベースに問い合わせて、既知のバグかどうかを見て下さい。既知のものでしたら、それに関して持っているあらゆる新しい情報を追加して下さい。</p><p>新しいレポートを記入する前にSimon Tathamさんの<a class="ulink" href="http://www.chiark.greenend.org.uk/~sgtatham/bugs.html" target="_top">How to Report Bugs Effectively</a>に関するページを読むと良いでしょう。</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp111119944"></a>15.2. 文書の問題を報告する</h2></div></div></div><p>文書は、ソフトウェアの機能と挙動を正確に反映するべきものです。正確でない場合は、ソフトウェアのバグがあるか、または文書に誤り若しくは不十分な箇所があることが考えられます。</p><p>文書の問題も<a class="ulink" href="http://trac.osgeo.org/postgis" target="_top">PostGIS bug tracker</a>に報告することができます。</p><p>訂正が小さいものなら、バグトラッカの新しい問題の中に、文書内の位置を特定して記述して下さい。</p><p>変更が大きい場合は、Subversion パッチが確実に好まれます。Unix上で次の4ステップの処理を行います (既に<a class="ulink" href="http://subversion.apache.org/" target="_top">Subversion</a>をインストールしていると仮定します)。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>PostGISのSubversionトランクをチェックアウトします。Unixでは次のように入力します。</p><p><span class="command"><strong>svn checkout http://svn.osgeo.org/postgis/trunk/</strong></span></p><p>これで./trunkディレクトリに格納されます。</p></li><li class="listitem"><p>お使いのテキストエディタで文書に変更を加えます。Unixでは、たとえば次のようにします。</p><p><span class="command"><strong>vim trunk/doc/postgis.xml</strong></span></p><p>文書はHTMLでなくDocBook XMLで書かれていますので、慣れていないなら、残りの文書の例にならって下さい。</p></li><li class="listitem"><p>文書のマスタコピーからパッチファイルを作成します。Unixでは次のように入力します。</p><p><span class="command"><strong>svn diff trunk/doc/postgis.xml &gt; doc.patch</strong></span></p></li><li class="listitem"><p>バグトラッカ内の新しい問題にパッチが取り付けられます。</p></li></ol></div></div></div><div class="appendix"><div class="titlepage"><div><div><h1 class="title"><a name="release_notes"></a>付録A 付録</h1></div><div><h3 class="subtitle"><i>リリースノート</i></h3></div></div></div><div class="toc"><p><b>目次</b></p><dl class="toc"><dt><span class="sect1"><a href="#idp111187528">A.1. Release 2.5.0</a></span></dt><dt><span class="sect1"><a href="#idp111209416">A.2. リリース 2.4.4</a></span></dt><dt><span class="sect1"><a href="#idp111217992">A.3. リリース 2.4.3</a></span></dt><dt><span class="sect1"><a href="#idp111222984">A.4. リリース 2.4.2</a></span></dt><dt><span class="sect1"><a href="#idp111226568">A.5. リリース 2.4.1</a></span></dt><dt><span class="sect1"><a href="#idp111263432">A.6. リリース 2.4.0</a></span></dt><dt><span class="sect1"><a href="#idp111281096">A.7. リリース 2.3.3</a></span></dt><dt><span class="sect1"><a href="#idp111287368">A.8. リリース 2.3.2</a></span></dt><dt><span class="sect1"><a href="#idp111291592">A.9. リリース 2.3.1</a></span></dt><dt><span class="sect1"><a href="#idp111297992">A.10. リリース 2.3.0</a></span></dt><dt><span class="sect1"><a href="#idp111333064">A.11. リリース 2.2.2</a></span></dt><dt><span class="sect1"><a href="#idp111339976">A.12. リリース 2.2.1</a></span></dt><dt><span class="sect1"><a href="#idp111351112">A.13. リリース 2.2.0</a></span></dt><dt><span class="sect1"><a href="#idp111429576">A.14. リリース 2.1.8</a></span></dt><dt><span class="sect1"><a href="#idp111434952">A.15. リリース 2.1.7</a></span></dt><dt><span class="sect1"><a href="#idp111438408">A.16. リリース 2.1.6</a></span></dt><dt><span class="sect1"><a href="#idp111459272">A.17. リリース 2.1.5</a></span></dt><dt><span class="sect1"><a href="#idp111469512">A.18. リリース 2.1.4</a></span></dt><dt><span class="sect1"><a href="#idp111517896">A.19. リリース 2.1.3</a></span></dt><dt><span class="sect1"><a href="#idp111524808">A.20. リリース 2.1.2</a></span></dt><dt><span class="sect1"><a href="#idp111561928">A.21. リリース 2.1.1</a></span></dt><dt><span class="sect1"><a href="#idp111576264">A.22. リリース 2.1.0</a></span></dt><dt><span class="sect1"><a href="#idp111699272">A.23. リリース 2.0.5</a></span></dt><dt><span class="sect1"><a href="#idp111717704">A.24. リリース 2.0.4</a></span></dt><dt><span class="sect1"><a href="#idp111742664">A.25. リリース 2.0.3</a></span></dt><dt><span class="sect1"><a href="#idp111755080">A.26. リリース 2.0.2</a></span></dt><dt><span class="sect1"><a href="#idp111826632">A.27. リリース 2.0.1</a></span></dt><dt><span class="sect1"><a href="#idp111866440">A.28. リリース 2.0.0</a></span></dt><dt><span class="sect1"><a href="#idp111926216">A.29. リリース 1.5.4</a></span></dt><dt><span class="sect1"><a href="#idp111949512">A.30. リリース 1.5.3</a></span></dt><dt><span class="sect1"><a href="#idp111978056">A.31. リリース 1.5.2</a></span></dt><dt><span class="sect1"><a href="#idp111994696">A.32. リリース 1.5.1</a></span></dt><dt><span class="sect1"><a href="#idp112004168">A.33. リリース 1.5.0</a></span></dt><dt><span class="sect1"><a href="#idp112026056">A.34. リリース 1.4.0</a></span></dt><dt><span class="sect1"><a href="#idp112070984">A.35. リリース 1.3.6</a></span></dt><dt><span class="sect1"><a href="#idp112072520">A.36. リリース 1.3.5</a></span></dt><dt><span class="sect1"><a href="#idp112074056">A.37. リリース 1.3.4</a></span></dt><dt><span class="sect1"><a href="#idp112075976">A.38. リリース 1.3.3</a></span></dt><dt><span class="sect1"><a href="#idp112077512">A.39. リリース 1.3.2</a></span></dt><dt><span class="sect1"><a href="#idp112079048">A.40. リリース 1.3.1</a></span></dt><dt><span class="sect1"><a href="#idp112080584">A.41. リリース 1.3.0</a></span></dt><dt><span class="sect1"><a href="#idp112088136">A.42. リリース 1.2.1</a></span></dt><dt><span class="sect1"><a href="#idp112092488">A.43. リリース 1.2.0</a></span></dt><dt><span class="sect1"><a href="#idp112095688">A.44. リリース 1.1.6</a></span></dt><dt><span class="sect1"><a href="#idp112118344">A.45. リリース 1.1.5</a></span></dt><dt><span class="sect1"><a href="#idp112128456">A.46. リリース 1.1.4</a></span></dt><dt><span class="sect1"><a href="#idp112159816">A.47. リリース 1.1.3</a></span></dt><dt><span class="sect1"><a href="#idp112179400">A.48. リリース 1.1.2</a></span></dt><dt><span class="sect1"><a href="#idp112191816">A.49. リリース 1.1.1</a></span></dt><dt><span class="sect1"><a href="#idp112203720">A.50. リリース 1.1.0</a></span></dt><dt><span class="sect1"><a href="#idp112233288">A.51. リリース 1.0.6</a></span></dt><dt><span class="sect1"><a href="#idp112247752">A.52. リリース 1.0.5</a></span></dt><dt><span class="sect1"><a href="#idp112260168">A.53. リリース 1.0.4</a></span></dt><dt><span class="sect1"><a href="#rel_1.0.3_upgrading">A.54. リリース 1.0.3</a></span></dt><dt><span class="sect1"><a href="#idp112286280">A.55. リリース 1.0.2</a></span></dt><dt><span class="sect1"><a href="#idp112294088">A.56. リリース 1.0.1</a></span></dt><dt><span class="sect1"><a href="#idp112303816">A.57. リリース 1.0.0</a></span></dt><dt><span class="sect1"><a href="#idp112313160">A.58. リリース 1.0.0RC6</a></span></dt><dt><span class="sect1"><a href="#idp112320712">A.59. リリース 1.0.0RC5</a></span></dt><dt><span class="sect1"><a href="#idp112327752">A.60. リリース 1.0.0RC4</a></span></dt><dt><span class="sect1"><a href="#idp112340168">A.61. リリース 1.0.0RC3</a></span></dt><dt><span class="sect1"><a href="#idp112356808">A.62. リリース 1.0.0RC2</a></span></dt><dt><span class="sect1"><a href="#idp112391368">A.63. リリース 1.0.0RC1</a></span></dt></dl></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp111187528"></a>A.1. Release 2.5.0</h2></div></div></div><p>Release date: 2018/09/23</p><p>If compiling with PostgreSQL+JIT, LLVM 
&gt;= 6 is required</p><p>Supported PostgreSQL versions for this release are: PostgreSQL 9.4 - PostgreSQL 12 (in development) GEOS &gt;= 3.5</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111189320"></a>新機能</h3></div></div></div><p>#1847, PostgreSQL 11以上のSP-GiSTの2次元と3次元の対応 (Esteban ZimányiさんとArthur Lesuisseさん (以上Université Libre de Bruxelles (ULB)から)、Darafei Praliaskouskiさん)</p><p>#4056, ST_FilterByM (Nicklas Avénさん)</p><p>#4050, ST_ChaikinSmoothing (Nicklas Avénさん)</p><p>#3989, ST_Buffer single sided option (Stephen Knoxさん)</p><p>#3876, ST_Angle function (Rémi Curaさん)</p><p>#3564, ST_LineInterpolatePoints (Dan Bastonさん)</p><p>#3896, PostGIS_Extensions_Upgrade() (Regina Obeさん)</p><p>#3913, パッケージに含まれていないものからのエクステンション生成時のアップグレード (Sandro Santilliさん)</p><p>#2256, _postgis_index_extent() for extent from index (Paul Ramseyさん)</p><p>#3176, Add ST_OrientedEnvelope (Dan Bastonさん)</p><p>#4029, Add ST_QuantizeCoordinates (Dan Bastonさん)</p><p>#4063, ST_Scaleの仮想原点任意引数 (Paul Ramseyさん)</p><p>#4082, ST_BandFileSizeとST_BandFileTimestampの追加とST_BandMetadataの拡張 (Even Rouaultさん)</p><p>#2597, Add ST_Grayscale (Bborie Parkさん)</p><p>#4007, Add ST_SetBandPath (Bborie Parkさん)</p><p>#4008, Add ST_SetBandIndex (Bborie Parkさん)</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111196488"></a>大幅な変更</h3></div></div></div><p>Upgrade scripts from multiple old versions are now all symlinks to a single upgrade script (Sandro Santilli)</p><p>#3944, EPSG第9.2版へのアップデート (Even Rouaultさん)</p><p>#3927, ST_AsMVTのパラレル実装</p><p>#3925, MVT生成前のジオメトリの簡略化で地図のグリッドセルサイズを使うようにしました</p><p>#3899, 空ジオメトリおよび同じ接頭辞のジオメトリについてのB木のソートの並び順は、現在は、定義されています (Darafei Praliaskouskiさん)</p><p>#3864, POINTジオメトリのソートの効率改善 (Darafei Praliaskouskiさん)</p><p>#3900, GCC warnings fixed, make -j is now working (Darafei Praliaskouski) - TopoGeo_addLinestring robustness improvements (Sandro Santilli) #1855, #1946, #3718, #3838</p><p>#3234, 空ポイントをトポロジのノードとして追加するのを禁止しました (Sandro Santilliさん)</p><p>#1014, ジオメトリがハッシュ可能になり、共通テーブル式のシグネチャに直接使えるようになりました (Paul Ramseyさん)</p><p>#3097, ST_Split()でMULTILINESTRINGで刃ができるようにしました (Paul Ramseyさん)</p><p>#3942, geojson: Do not include private header for json-c &gt;= 0.13 (Björn Esser)</p><p>#3954, ST_GeometricMedianがポイントの重みに対応しました (Darafei Praliaskouskiさん)</p><p>#3965, #3971, #3977, #4071 ST_ClusterKMeans rewritten: better initialization, faster convergence, K=2 even faster (Darafei Praliaskouski)</p><p>#3982, ST_AsEncodedPolylineがLINESTRING EMPTYとMULTIPOINT EMPTYに対応しました (Darafei Praliaskouskiさん)</p><p>#3986, ST_AsTextに桁数を制限するための第2引数が導入されました (Marc Ducobuさん, Darafei Praliaskouskiさん)</p><p>#4020, BOX3Dからジオメトリへのキャストで、正しくつながった多面体サーフェイスが返るようになりました (Matthias Bayさん)</p><p>#2508, ST_OffsetCurveがジオメトリコレクションで動作するようになりました (Darafei Praliaskouskiさん)</p><p>#4006, ST_GeomFromGeoJSONの入力としてjsonとjsonbに対応するようになりました (Paul Ramseyさん, Regina Obeさん)</p><p>#4038, ST_Subdivide now selects pivot for geometry split that reuses input vertices. (Darafei Praliaskouski)</p><p>#4025, #4032 ST_ClosestPointOfApproach, ST_DistanceCPAおよびST_CPAWithinの精度の問題の修正 (Paul Ramseyさん, Darafei Praliaskouskiさん)</p><p>#4076, トポロジ実装でのGEOS使用頻度の低減 (Björn Harrtellさん)</p><p>#4080, Add external raster band index to ST_BandMetaData - Add Raster Tips section to Documentation for information about Raster behavior (e.g. Out-DB performance, maximum open files)</p><p>#4084: BOX3Dの前後に対する間違ったコード内コメントを訂正 (Matthias Bayさん)</p><p>#4060, #4094, PostgreSQL JIT対応 (Raúl Marínさん, Laurenz Albeさん)</p><p>#3960, ST_Centroid now uses lwgeom_centroid (Darafei Praliaskouski)</p><p>#4027, Remove duplicated code in lwgeom_geos (Darafei Praliaskouski, Daniel Baston)</p><p>#4115, Fix a bug that created MVTs with incorrect property values under parallel plans (Raúl Marín).</p><p>#4120, ST_AsMVTGeom: タイル座標系を使ったクリップ (Raúl Marínさん)。</p><p>#4132, ST_Intersection on Raster now works without throwing TopologyException (Vinícius A.B. Schmidt, Darafei Praliaskouski)</p><p>#4177, #4180 Support for PostgreSQL 12 dev branch (Laurenz Albe, Raúl Marín)</p><p>#4156, ST_ChaikinSmoothing: also smooth start/end point of polygon by default (Darafei Praliaskouski)</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp111209416"></a>A.2. リリース 2.4.4</h2></div></div></div><p>リリース日: 2018/04/08</p><p>誤り訂正と性能改善のリリースです。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111210824"></a>誤り訂正</h3></div></div></div><p>#3055, [ラスタ] バンドの無いラスタでST_Clip()を実行するとサーバが異常終了する (Regina Obeさん)</p><p>#3942, geojson: json-c &gt;= 0.13でプライベートのヘッダを取り込まないようにしました (Björn Esserさん)</p><p>#3952, 並列モードでST_Transformが失敗する (Paul Ramseyさん)</p><p>#3978, 2.1以前からのアップグレード時にKNNを訂正するようにしました (Sandro Santilliさん)</p><p>#4003, lwpoly_construct_circle: 0で割る問題を回避 (Raúl Marín Rodríguezさん)</p><p>#4004, B木インデックス構築時のメモリ枯渇を回避 (Edmund Hornerさん)</p><p>#4016, Proj 5.0.0対応 (Raúl Marín Rodríguezさん)</p><p>#4017, lwgeomの字句解析器でメモリ破損 (Peter Eさん)</p><p>#4020, BOX3Dからジオメトリへのキャストで、正しくつながった多面体サーフェイスが返るようになりました (Matthias Bayさん)</p><p>#4025, #4032 時間的に「ほとんどオーバラップしている」範囲に対する不正な答 (Paul Ramseyさん, Darafei Praliaskouskiさん)</p><p>#4052, いくつかのジオグラフィ関数のスキーマ修飾 (Regina Obeさん)</p><p>#4055, ST_ClusterIntersectingの返り値からSRIDが落ちている (Daniel Bastonさん)</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111216072"></a>性能強化</h3></div></div></div><p>#3946, PostgreSQL 11へのコンパイルの対応 (Paul Ramseyさん)</p><p>#3992, pkg-config検出のためにpkg.m4のPKG_PROG_PKG_CONFIGマクロを使用するようにしました (Bas Couwenbergさん)</p><p>#4044, アップグレードのPostgreSQL 11 への対応 (Regina Obeさん)</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp111217992"></a>A.3. リリース 2.4.3</h2></div></div></div><p>リリース日: 2018/01/17</p><p>誤り訂正と性能改善のリリースです。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111219400"></a>誤り訂正と機能強化</h3></div></div></div><p>#3713, '\'文字を出力することがあるエンコーディングへの対応</p><p>#3827, コンフィギュアのデフォルトを、多くの人にとっては偽陰性の原因となる、テストの中断をしないように設定 (Regina Obeさん)、#3988での標準準拠のために改訂 (Greg Troxelさん)</p><p>#3930, 32ビットプラットフォームでの円の最小バウンディングの問題</p><p>#3965, ST_ClusterKMeansで初期化時にいくつかのクラスタが失われる (Darafei Praliaskouskiさん)</p><p>#3956, BRINのopclassオブジェクトのアップデートが確実でない (Sandro Santilliさん)</p><p>#3982, ST_AsEncodedPolylineがLINESTRING EMPTYとMULTIPOINT EMPTYに対応しました (Darafei Praliaskouskiさん)</p><p>#3975, ST_Transformがスキーマ修飾なしでspatial_ref_sysのクエリを実行する。レストア時に発生。 (Paul Ramseyさん)</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp111222984"></a>A.4. リリース 2.4.2</h2></div></div></div><p>リリース日: 2017/11/15</p><p>誤り訂正と性能改善のリリースです。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111224392"></a>誤り訂正と機能強化</h3></div></div></div><p>#3917, zcta5のロードを修正</p><p>#3667, ジオグラフィ版のST_Segmentizeの誤り修正</p><p>#3926, 2.2.6と2.3.4のアップグレード行程が失われていたのを追加 (Muhammad Usamaさん)</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp111226568"></a>A.5. リリース 2.4.1</h2></div></div></div><p>リリース日: 2017/10/18</p><p>誤り訂正と性能改善のリリースです。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111227976"></a>誤り訂正と機能強化</h3></div></div></div><p>#3864, B木演算子のメモリリークを修正</p><p>#3869, goldリンカを用いたビルドの修正</p><p>#3845, 小さなM値を素直に扱う問題</p><p>#3871, ジオメトリ比較関数の性能調整</p><p>#3879, 弧によっては0で割る</p><p>#3878, ヘッダのsignumの一文定義</p><p>#3880, TYPMOD_GET_SRIDに未定義の振る舞い</p><p>#3875, ビットシフト演算子の振る舞いが不定なのを修正</p><p>#3864,B木ジオメトリソートの性能改善</p><p>#3874, lw_dist2d_pt_arcに0で割る箇所</p><p>#3882, 入力が負数の時にzigzagの振る舞いが不定</p><p>#3891, pointarray_to_encoded_polylineに未定義の振る舞い</p><p>#3895, 不正なWKB入力についてエラーが投げられる</p><p>#3886, ジオメトリの細分でまれにボックスが無くなる問題を修正</p><p>#3907, 全ての可能性のあるGBOX文字列出力にとって十分なメモリの確保 (Raúl Marín Rodríguezさん)</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp111263432"></a>A.6. リリース 2.4.0</h2></div></div></div><p>リリース日: 2017/09/30</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111264456"></a>新機能</h3></div></div></div><p>#3822, postgis_full_version()が、スクリプトのビルドに使ったPostgreSQLの版の表示と確認を行うようになりました (Sandro Santilliさん)</p><p>#2411, ST_Reverseの曲線への対応 (Sandro Santilliさん)</p><p>#2951, ジオグラフィのST_Centroid (Danny Götteさん)</p><p>#3788, postgis_restore.plがディレクトリ形式 (-Fd)で動作するようになりました (Roger Crew)</p><p>#3772, 方向に依存しないST_CurveToLine出力 (Sandro Santilliさん / KKGeo)</p><p>#2464, MaxError許容値を持つST_CurveToLine (Sandro Santilliさん / KKGeo)</p><p>#3599, ST_AsGeobufを介したGeobuf出力対応 (Björn Harrtellさん)</p><p>#3661, ST_AsMVTを介したMapboxベクタタイル出力対応 (Björn Harrtellさん / CartoDB)</p><p>#3689, 方向のチェックと強制を行う関数の追加 (Dan Bastonさん)</p><p>#3753, 2次元とN次元のポイントのGiSTペナルティの速度改善 (Darafei Praliaskouskiさん, Andrey Borodinさん)</p><p>#3677, ST_FrechetDistance (Shinichi Sugiyamaさん)</p><p>ほとんどの集約関数 (ラスタとジオメトリ)、および全てのSTABLE / IMMUTABLEラベルの付いた (ラスタとジオメトリ)関数にパラレル安全のラベル付けが施されました</p><p>#2249, ラスタのST_MakeEmptyCoverage (David Zwarg, ainomieliさん)</p><p>#3709, ST_Projectで符号付き距離が可能になりました (Darafei Praliaskouskiさん)</p><p>#524, ジオグラフィのポリゴン上のポリゴン、ライン上のライン、ライン上のポイントに対するCoversの対応 (Danny Götte)</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111271112"></a>機能強化と訂正</h3></div></div></div><p>文書への多くの補正やいくつかの翻訳が完成しました。中核文書の多くの修正を行ったAndreas Schildさん。PostGIS日本語翻訳チームが最初の翻訳完成に達しました。</p><p>PostgreSQL 10対応</p><p>PostgreSQL 11への予備的な対応</p><p>#3645, シェープファイルのロードで論理的に削除されたレコードを避けるようにしました</p><p>#3747, Tigerジオコーダのnorm_addy複合型へのzip4とaddress_alphanumericの属性追加</p><p>#3748, 住所標準化のルックアップテーブルを更新してpagc_normalize_addressの略語を改善</p><p>#3647, GEOSNodeを使ってST_Nodeのノード化処理の改善 (Wouter Geraedtsさん)</p><p>#3684, EPSG第9版へのアップデート (Even Rouaultさん)</p><p>#3830, 住所標準化のinitialization from incompatible pointer typeの訂正 (9.6以上)</p><p>#3662, Make shp2pgsqlデバッグ情報を標準エラー出力に送ることでデバッグモードで動作するようにしました</p><p>#3405, lwgeom_to_pointsでのメモリリークの訂正</p><p>#3832, shp2pgsqlでint8のワイド整数に対応しました</p><p>#3841, 決定性ソートをジオグラフィのB木内で空ジオメトリに対応できるようにしました</p><p>#3844, Make =演算子を厳密な等価性テストにし、&lt; &gt;を荒い「空間ソート」にしました。</p><p>#3855, ST_AsTWKBのメモリと実行速度の改善</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111278024"></a>大幅な変更</h3></div></div></div><p>PostgreSQL 9.2への対応終了</p><p>#3810, GEOS 3.4.0以上をコンパイルに必要となりました</p><p>ほとんどの集約関数がパラレル安全のラベル付けが施されました。ほとんどの集約関数が削除と再作成されます。PostGIS集約関数を使っているビューがある場合には、アップグレード前に削除し、アップグレード後に再作成する必要があります。</p><p>#3578, ST_NumInteriorRings(POLYGON EMPTY)でNULLでなく0を返すようにしました</p><p>ST_DumpPointsをCで再実装したPostGIS 2.1.0以降不要となっていた_ST_DumpPointsを削除</p><p>B木インデックス演算子&lt; = &gt;を変更し、ソートでより良い空間局所性を提供しGROUP BYで期待される振る舞いとなるよう変更しました。ジオメトリまたはジオグラフィのB木インデックスが存在している場合には、REINDEXを実行して下さい。B木インデックスが偶然作られてGiSTインデックスに置き換える必要があるかを確認してください。オーダーの比較でボックスの左右で見る古いコードに依存する場合には、&lt;&lt; &gt;&gt;演算子を使うよう更新して下さい。</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp111281096"></a>A.7. リリース 2.3.3</h2></div></div></div><p>リリース日: 2017/07/01</p><p>誤り訂正と性能改善のリリースです。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111282504"></a>誤り訂正と機能強化</h3></div></div></div><p>#3777, GROUP BYが空ジオメトリを含むと不規則になる</p><p>#3711, 2.5次元のエッジをトポロジに追加すると方位エラーが発生する</p><p>#3726, dblatexからのPDFマニュアルでprogramlistingの引用部を良い感じに描画するようになりました (Mike Toewsさん)</p><p>#3738, ラスタ: raster2pgsqlで-Y無しで-sを使うとSRIDを設定するのではなく変換を行う</p><p>#3744, ST_Subdivideで逆方向のジオメトリの一部が無くなる (Darafei Praliaskouski Komzpaさん)</p><p>#3750, @と~演算子がスキーマ修飾を施したジオメトリ関数とラスタ関数が動かない場合がある。レストア問題が原因。 (Axiom Data ScienceのShane StClairさん)</p><p>#3682, pgsql2shpの結果で真偽値のフィールド内がおかしい</p><p>#3701, pgsql2shpの2重引用符問題から脱出</p><p>#3704, 空のジオメトリでST_AsX3Dが異常終了する</p><p>#3730, ST_Clipがバンドを計算できなかった時のエラーレベルをErrorからNoticeに変更</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp111287368"></a>A.8. リリース 2.3.2</h2></div></div></div><p>リリース日: 2017/01/31</p><p>誤り訂正と性能改善のリリースです。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111288776"></a>誤り訂正と機能強化</h3></div></div></div><p>#3418, PostgreSQL 9.5以上でのKNNの再確認が、誤った順序でタプルを返すインデックスのため、失敗する</p><p>#3675, 関係関数でインデックスが使われない場合がある</p><p>#3680, PostGIS更新スクリプトで、ビューにGRANTを実行していなかった</p><p>#3683, PostgreSQL 9.5未満から9.4より後へのpg_upgradeの後PostGISが更新できない</p><p>#3688, ST_AsLatLonText: 分の丸めがおかしい</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp111291592"></a>A.9. リリース 2.3.1</h2></div></div></div><p>リリース日: 2016/11/28</p><p>誤り訂正と性能改善のリリースです。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111293000"></a>誤り訂正と機能強化</h3></div></div></div><p>#1973, st_concavehull()が空ジオメトリコレクションを返すことがある gdeさんが訂正</p><p>#3501, ラスタへの最大範囲制約を追加する際に大きなテーブルでは配列サイズが範囲を超える</p><p>#3643, 最新のOSX XCodeでPostGISがビルドできない</p><p>#3644, 割り込みでデッドロックが発生する</p><p>#3650, ST_Extent, ST_3DExtentとST_Mem系の集約関数にパラレル安全のラベル付けを施し、パラレル化できるようになりました</p><p>#3652, Collection(MultiCurve())での異常終了</p><p>#3656, 2.2版以下からの集約関数の更新の訂正</p><p>#3659, CREATE EXTENSIONの後にGUCを定義すると間違ったメモリコンテキストを使い異常終了する (manaeemさん)</p><p>#3665, BRINインデックスでのインデックス崩壊とメモリリークに対するJulien Rouhaudさん (Dalibo)からのパッチ</p><p>#3667, ジオグラフィを引数に取るST_Segmentizeの誤りに対するHugo Mercierさん (Oslandia)からのパッチ</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp111297992"></a>A.10. リリース 2.3.0</h2></div></div></div><p>リリース日: 2016/09/26</p><p>新機能リリースです。新しい関数、効率改善、PostGIS 2.2.3からの関連する誤りの訂正、その他の素敵なことがあります。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111299400"></a>重大/大幅な変更</h3></div></div></div><p>#3466, box3dからジオメトリへのキャストが3次元ジオメトリを返すようになりました (Julien Rouhaud of Daliboさん)</p><p>#3396, ST_EstimatedExtentでエラーでなく警告が投げられる (Regina Obeさん)</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111300936"></a>新機能</h3></div></div></div><p>postgis_restore.plでユーザ定義のTOCへの対応を追加 (Christoph Moench-Tegederさん)</p><p>ST_PointNとST_SetPointについて負数のインデックスに対応 (Rémi Curaさん)</p><p>ジオグラフィを引数に取るST_Bufferへのパラメータ追加 (Thomas Bonfortさん)</p><p>TopoGeom_addElement, TopoGeom_remElement (Sandro Santilliさん)</p><p>populate_topology_layer (Sandro Santilliさん)</p><p>#454, ST_WrapXとlwgeom_wrapx (Sandro Santilliさん)</p><p>#1758, ST_Normalize (Sandro Santilliさん)</p><p>#2236, shp2pgsql -dについて"DROP TABLE IF EXISTS"を出すようにしました</p><p>#2259, ST_VoronoiPolygonsとST_VoronoiLines (Dan Bastonさん)</p><p>#2841と#2996, ST_MinimumBoundingRadiusと新規追加のST_MinimumBoundingCircleとをにヴェルツェルのアルゴリズムを使用して実装 (Dan Bastonさん)</p><p>#2991, ST_TransformについてPROJ.4文字列を使えるようにしました (Mike Toewsさん)</p><p>#3059, ST_Expandについて座標軸ごとのパラメータ受け渡しを可能にしました (Dan Bastonさん)</p><p>#3339, ST_GeneratePoints (Paul Ramseyさん)</p><p>#3362, ST_ClusterDBSCAN (Dan Bastonさん)</p><p>#3364, ST_GeometricMedian (Dan Bastonさん)</p><p>#3391, ST_EstimatedExtentで派生テーブルへの対応を追加 (Alessandro Pasottiさん)</p><p>#3424, ST_MinimumClearance (Dan Bastonさん)</p><p>#3428, ST_Points (Dan Bastonさん)</p><p>#3465, ST_ClusterKMeans (Paul Ramseyさん)</p><p>#3469, MULTIPOINTを引数に取るST_MakeLine (Paul Normanさん)</p><p>#3549, PostgreSQL 9.6のパラレルクエリモードにできる限り対応 (Paul Ramseyさん, Regina Obeさん)</p><p>#3557, ジオメトリ関数に対してクエリ統計情報に基づくコストを設定 (Paul Norman)</p><p>#3591, BRINインデックスへの対応を追加。PostgreSQL 9.4以上が必要です。 (2nd QuadrantのGiuseppe Broccoloさん, Julien RouhaudさんとDiagloのRonan Dunklauさん)</p><p>#3496, エクステンションによってインストールされたPostGISを再配置できないようにし、関数内ではスキーマ修飾の呼び出しを行うようにしました (Regina Obeさん) これはエクステンションでの#3494, #3486, #3076を最終的に解決するものでした</p><p>#3547, Tigerジオコーダを更新し、TIGER 2016に対応するようになり、httpとftpの両方に対応するようになりました。</p><p>#3613, 等しい長さの線分を使う分割 (OslandiaのHugo Mercierさん)</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111328200"></a>誤り訂正</h3></div></div></div><p>PostGIS 2.2.3からの全ての関連した誤りの訂正</p><p>#2841, ST_MinimumBoundingCircleが元の地物を覆い切らない</p><p>#3604, pgcommon/Makefile.inによるCFLAGS指定が不正で、liblwgeom.hが誤ったものになる (Greg Troxel)</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111330248"></a>性能強化</h3></div></div></div><p>#75, PIP簡略版の強化 (Dan Bastonさん)</p><p>#3383, インデックス演算中に小さいジオメトリをデシリアライズするのを避けるようにしました (Dan Bastonさん)</p><p>#3400, PIPルーティンの若干の最適化 (Dan Bastonさん)</p><p>トポロジへのラインの追加を割り込み可能にしました (Sandro Santilliさん)</p><p>Mike Toewsさんからの文書更新</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp111333064"></a>A.11. リリース 2.2.2</h2></div></div></div><p>リリース日: 2016/03/22</p><p>誤り訂正と性能改善のリリースです。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111334472"></a>新機能</h3></div></div></div><p>#3463, フェイス崩壊によるエッジの変更で異常終了するのを訂正</p><p>#3422, 標準の倍精度システム (arm64, ppc64el, s390c, powerpc, ...)におけるST_Splitのロバスト性の改善</p><p>#3427, spatial_ref_sysをEPSG 8.8版に更新</p><p>#3433, マルチポイントを引数に取るST_ClusterIntersectingが正しくない</p><p>#3435, ST_AsX3Dで凹ジオメトリのレンダリングの訂正</p><p>#3436, ptarray_clone_deepでメモリの扱いに間違いがある</p><p>#3437, マルチポイントを引数に取るST_Intersectsが正しくない</p><p>#3461, ST_GeomFromKMLでinnerBoundaryIsがあり、かつouterBoundaryIsが無い場合にPostGISが異常終了する</p><p>#3429, いくつかのプラットフォームで2.1から2.3へのアップデートの際に無限ループやハングが発生する</p><p>#3460, アップグレード後にST_ClusterWithinで'Tolerance not defined'エラーが発生する</p><p>#3490, ラスタデータとマテリアライズドビューのリストア問題。postgis_proc_set_search_path.sqlとrtpostgis_proc_set_search_path.sqlのスクリプトを使います。http://postgis.net/docs/manual-2.2/RT_FAQ.html#faq_raster_data_not_restoreを参照してください。</p><p>#3426, POINT EMPTYのテストが愉快なアーキテクチャでは失敗する</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp111339976"></a>A.12. リリース 2.2.1</h2></div></div></div><p>リリース日: 2016/01/06</p><p>誤り訂正と性能改善のリリースです。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111341384"></a>新機能</h3></div></div></div><p># 2232, SVGの丸め誤差蓄積の回避</p><p>#3321, トポロジのロードにおけるパフォーマンス不具合の訂正</p><p>#3329, TopoGeo_addPointにおけるロバスト性の不具合の訂正</p><p>#3349, postgis_topologyスクリプトのインストールパスの訂正</p><p>#3351, ST_RemoveIsoEdge (とlwt_RemIsoEdge)で終端ノードが孤立するようにしました</p><p>#3355, ジオグラフィ型を引数に取るST_Segmentizeがジオメトリボックスを持つ </p><p>#3359, toTopoGeomでTopoGeometry定義から低いIDのプリミティブの欠損を訂正</p><p>#3360, _raster_constraint_info_scaleへの不正な入力書式</p><p>#3375, コレクション (ポイント)に対する繰り返したポイント除去で異常終了する</p><p>#3378, 複数トポロジが存在する階層的なTopoGeometryの処理の訂正</p><p>#3380, #3402, トポロジのロードでラインが時々削除される</p><p>#3388, #3410, ST_Removepointsで終点がなくなるのを訂正</p><p>#3389, lwgeom_to_geojsonでのバッファオーバフロー</p><p>#3390, Alpine Linux 3.2でのビルドで、postgisとpostgis_topologyエクステンションのコンパイル時にエラーが発生する</p><p>#3393, ST_AreaがNaNを返すポリゴンがある</p><p>#3401, 32ビットシステムでのST_Splitの堅牢性の改善</p><p>#3404, ST_ClusterWithinでバックエンドが異常終了する</p><p>#3407, 複数のTopoGeometryオブジェクトを定義するフェイスまたはエッジを分割する時に異常終了するのを訂正</p><p>#3411, クラスタリング関数が空間インデックスを使っていない</p><p>#3412, TopoGeo_addLinestringでスナップ段階の堅牢性の改善</p><p>#3415, OSX 10.9でpkgsrcを使ったビルドの訂正</p><p>lwt_ChangeEdgeGeom [liblwgeom]のメモリリークの訂正</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp111351112"></a>A.13. リリース 2.2.0</h2></div></div></div><p>リリース日: 2015/10/07</p><p>新機能リリースです。新しい関数、効率改善、その他の素敵なことがあります。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111352520"></a>新機能</h3></div></div></div><p>トポロジAPIがliblwgeom内になりました (Sandro Santilliさん / Regione Toscanaさん - SITA)</p><p>liblwgeomの新しいlwgeom_unaryunion</p><p>liblwgeomの新しいlwgeom_linemerge</p><p>liblwgeomの新しいlwgeom_is_simple</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/3169" target="_top">#3169</a>, SFCGAL 1.1に対応: ST_3DDifference, ST_3DUnion, ST_Volume, ST_MakeSolid, ST_IsSolid追加 (Vincent Moraさん / Oslandia)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/3169" target="_top">#3169</a>, ST_ApproximateMedialAxis (Sandro Santilliさん)</p><p>ST_CPAWithin (Sandro Santilliさん / Boundless)</p><p>CPAの意味を持つ|=|演算子の追加とPostgreSQL 9.5以上のKNN対応 (Sandro Santilliさん / Boundless)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/3131" target="_top">#3131</a>, ジオグラフィ型のKNN対応 (Paul Ramseyさん / CartoDB)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/3023" target="_top">#3023</a>, ST_ClusterIntersecting / ST_ClusterWithin (Dan Bastonさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2703" target="_top">#2703</a>, 全てのジオメトリタイプで確かなKNNの結果が出るようにしました、別名「KNN再確認」 (Paul Ramseyさん / CartoDB)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1137" target="_top">#1137</a>, ST_RemoveRepeatedPointsに許容誤差値を与えることが可能になりました (Paul Ramseyさん / CartoDB)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/3062" target="_top">#3062</a>, Allow passing M factor to ST_ScaleにM値に対する乗数を渡せるようになりました (Sandro Santilliさん / Boundless)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/3139" target="_top">#3139</a>, ST_BoundingDiagonal (Sandro Santilliさん / Boundless)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/3129" target="_top">#3129</a>, ST_IsValidTrajectory (Sandro Santilliさん / Boundless)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/3128" target="_top">#3128</a>, ST_ClosestPointOfApproach (Sandro Santilliさん / Boundless)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/3152" target="_top">#3152</a>, ST_DistanceCPA (Sandro Santilliさん / Boundless)</p><p>インデックスキーの型の正準な出力</p><p>ST_SwapOrdinates (Sandro Santilliさん / Boundless)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2918" target="_top">#2918</a>, 測地線についてGeographicLib関数を使うようにしました (Mike Toewsさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/3074" target="_top">#3074</a>, 大きなジオメトリを分解するST_Subdivide (Paul Ramseyさん / CartoDB)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/3040" target="_top">#3040</a>, 重心に基づくKNN GiSTインデックス  (&lt;&lt;-&gt;&gt;) n次元距離演算子 (Sandro Santilliさん / Boundless)</p><p>liblwgeomの相互運用性API (Sandro Santilliさん / CartoDB)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2939" target="_top">#2939</a>, ST_ClipByBox2D (Sandro Santilliさん / CartoDB)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2247" target="_top">#2247</a>, ST_Retile, ST_CreateOverview: データベース内ラスタのオーバビューの生成 (Sandro Santilliさん / Vizzuality)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/899" target="_top">#899</a>, shp2pgsqlの属性名マッピングを行う-mスイッチ (Regina Obeさん / Sandro Santilliさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1678" target="_top">#1678</a>, GDALコンフィギュレーション変数GDAL_DATAを指定するGUC postgis.gdal_datapathを追加</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2843" target="_top">#2843</a>, ラスタ入力での投影変換に対応 (Sandro Santilliさん / Vizzuality)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2349" target="_top">#2349</a>, Support for encoded_polyline入出力の対応 (Kashif Rasulさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2159" target="_top">#2159</a>, postgis_full_version()からのlibjsonの版の報告</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2770" target="_top">#2770</a>, ST_MemSize(raster)</p><p>postgis_noop(raster)追加</p><p>ST_TPI(), ST_TRI(), ST_Roughness()の存在しない形式を追加</p><p>GDALコンフィギュレーション変数GDAL_SKIPを指定するGUC postgis.gdal_enabled_driversの追加</p><p>データベース外バンドへのアクセスを有効にするGUC postgis.enable_outdb_rastersを追加</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2387" target="_top">#2387</a>, PostGISの一部としてのaddress_standardizerエクステンション (Stephen Woodbridgeさん / imaptools.com, Walter Sinclairさん, Regina Obeさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2816" target="_top">#2816</a>, address_standardizerの参考となるlexテーブル, gazテーブル, 規則テーブルを提供するaddress_standardizer_data_usエクステンション (Stephen Woodbridgeさん / imaptools.com, Walter Sinclairさん, Regina Obeさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2341" target="_top">#2341</a>, ST_MapAlgebraの新しいマスクパラメータ</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2397" target="_top">#2397</a>, シェープファイルローダのエンコーディングの自動読み取り</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2430" target="_top">#2430</a>, ST_ForceCurve</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2565" target="_top">#2565</a>, ST_SummaryStatsAgg()</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2567" target="_top">#2567</a>, ST_CountAgg()</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2632" target="_top">#2632</a>, ST_AsGML()が曲線地物に対応するようになりました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2652" target="_top">#2652</a>, run_test.plに--upgrade-pathスイッチを追加</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2754" target="_top">#2754</a>, エクステンションとしてのSFCGALラッパー</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2227" target="_top">#2227</a>, Visvalingam-Whyattアルゴリズムによる簡略化ST_SimplifyVW, ST_SetEffectiveArea (Nicklas Avénさん)</p><p>TWKBエンコード関数とデコード関数 ST_AsTWKB, ST_GeomFromTWKB (Paul Ramseyさん / Nicklas Avénさん / CartoDB)</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111409480"></a>性能強化</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/3223" target="_top">#3223</a>, ST_Equalsへの簡略版memcmpの追加 (Daniel Bastonさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/3227" target="_top">#3227</a>, Tiger 2015センサス対応のためのTigerジオコーダのアップグレード</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2278" target="_top">#2278</a>, マイナーリリース間のliblwgeomの互換性確保</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/897" target="_top">#897</a>, ST_AsX3DがGeoCodinates要素に対応し、"GD" "WE"とx/y軸反転とに対応しました (optionsに2, 3を使用)</p><p>ST_Split: マルチライン、マルチポイント、(マルチ)ポリゴンの境界によるライン分割を可能にしました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/3070" target="_top">#3070</a>, ジオメトリタイプ制約の簡略化</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2839" target="_top">#2839</a>, 関数インデックスへの選択度見積りの実装、ラスタテーブルでの空間クエリの速度向上。 (Sandro Santilliさん / Vizzuality)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2361" target="_top">#2361</a>, raster_columnsビューへのspatial_indexカラムの追加</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2390" target="_top">#2390</a>, pgsql2shpのテストスイート</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2527" target="_top">#2527</a>, raster2pgsqlへの、バンドのNODATAの有無のチェックを行わない-kフラグの追加</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2616" target="_top">#2616</a>, トポロジの構築とエクスポートでのテキストへのキャストを低減</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2717" target="_top">#2717</a>, 複合曲線がstartpoint, endpoint, pointn, numpointsに対応しました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2747" target="_top">#2747</a>, GDAL 2.0対応への追加</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2754" target="_top">#2754</a>, SFCGALがCREATE EXTENSIONでインストールできるようになりました (Vincent Moraさん @ Oslandia)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2828" target="_top">#2828</a>, ST_Envelope(raster)をSQLからCに変更</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2829" target="_top">#2829</a>, ジオメトリが完全にラスタを含みかつNODATAが指定されていない場合のST_Clip(raster)の短縮動作</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2906" target="_top">#2906</a>, TigerジオコーダのTiger 2014データ処理のための更新</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/3048" target="_top">#3048</a>, ジオメトリ簡略化の速度向上 (J.Santanaさん @ CartoDB)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/3092" target="_top">#3092</a>, 多数のテーブルがある場合にgeometry_columnsが遅い</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp111429576"></a>A.14. リリース 2.1.8</h2></div></div></div><p>リリース日: 2015/07/07</p><p>重大な誤り訂正のリリースです。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111430984"></a>誤り訂正</h3></div></div></div><p>#3159, ST_Affineでbboxキャッシュを強制しないようにしました</p><p>#3018, ジオグラフィに対するGROUP BYで時々重複行が返される</p><p>#3048, shp2pgsql - 特定のシステムロケールセットで数字の書式が不正になる</p><p>#3094, 不正な形式のGeoJSON入力でバックエンドが異常終了する</p><p>#3104, st_asgmlででたらめな文字をIDフィールドに入ってしまう</p><p>#3155, make uninstallでliblwgeom.hを消すようにしました</p><p>#3177, ネストされた空を引数に取る場合にgserialized_is_emptyが処理できない</p><p>ST_LineLocatePointの異常終了の訂正</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp111434952"></a>A.15. リリース 2.1.7</h2></div></div></div><p>リリース日: 2015/03/30</p><p>重大な誤り訂正のリリースです。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111436360"></a>誤り訂正</h3></div></div></div><p>#3086, ST_DumpValues()に不正なバンド番号を渡すとバックエンドが異常終了する</p><p>#3088, liblwgeom.hでstrcasestrを(再)定義しないようにしました</p><p>#3094, 不正な形式のGeoJSON入力でバックエンドが異常終了する</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp111438408"></a>A.16. リリース 2.1.6</h2></div></div></div><p>リリース日: 2015/03/20</p><p>誤り訂正と性能改善のリリースです。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111439816"></a>性能強化</h3></div></div></div><p>#3000, エッジ分割修復で確実にインデックスを使うようにしました</p><p>#3048, ジオメトリ簡略化の速度向上 (J.Santanaさん @ CartoDB)</p><p>#3050, ジオメトリ型の読み取りの高速化 (J.Santana @ CartoDB)</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111441736"></a>誤り訂正</h3></div></div></div><p>#2941, ジオグラフィカラムに4326以外のSRIDが入るようになりました</p><p>#3069, 小さいオブジェクトがボックスを伴うことで不適切に膨らむ</p><p>#3068, 制約されていない次元でpostgis_typmod_dimsがNULLを返すようにしました</p><p>#3061, JSON, GML, GML ST_GeomFrom*関数で重複ポイントが可能になりました</p><p>#3058, N次元GiSTのpicksplitメソッドを最適な平面で分割するよう訂正</p><p>#3052, PostgreSQL 9.1より後で有効な&lt;-&gt;, &lt;#&gt;演算子を作成</p><p>#3045, &amp;&amp;&amp;演算子での次元の混乱を訂正</p><p>#3016, 壊れたトポロジのレイヤの削除が可能になりました</p><p>#3015, TopologySummaryで例外を避けるようにしました</p><p>#3020, データベース外のST_AddBandで高さの値であるべきところを幅の値にする誤り</p><p>#3031, 空のジオメトリ (ポイント)テーブルをダンプしたものをレストアできるようになりました</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp111459272"></a>A.17. リリース 2.1.5</h2></div></div></div><p>リリース日: 2014/12/18</p><p>誤り訂正と性能改善のリリースです。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111460680"></a>性能強化</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2933" target="_top">#2933</a>, 巨大なマルチジオメトリオブジェクトの構築の速度向上</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111462472"></a>誤り訂正</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2947" target="_top">#2947</a>, lwgeom_make_validが1要素のコレクションを入力に取る場合に発生するメモリリークを訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2949" target="_top">#2949</a>, lwgeom_mindistance2dが曲線を入力に取る場合に発生するメモリリークを訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2931" target="_top">#2931</a>, BOX表現が大文字小文字の区別をする</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2942" target="_top">#2942</a>, PostgreSQL 9.5対応</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2953" target="_top">#2953</a>, Z値/M値が極端な時に2次元の統計情報が生成されない</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/3009" target="_top">#3009</a>, ジオグラフィにキャストすると基になるタプルに影響を与えることがある</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp111469512"></a>A.18. リリース 2.1.4</h2></div></div></div><p>リリース日: 2014/09/10</p><p>誤り訂正と性能改善のリリースです。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111470920"></a>性能強化</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2745" target="_top">#2745</a>, ポイントに対するST_Simplifyの速度向上</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2747" target="_top">#2747</a>, GDAL 2.0に対応</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2749" target="_top">#2749</a>, rtpostgis_upgrade_20_21.sqlをACIDになるようにしました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2811" target="_top">#2811</a>, シェープファイル/ラスタをロードする時にインデックス名を指定しないようにしました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2829" target="_top">#2829</a>, ジオメトリが完全にラスタを含みかつNODATAが指定されていない場合のST_Clip(raster)の短縮動作</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2895" target="_top">#2895</a>, クエリプランを良くするためにST_ConvexHull(raster)のコストを300に増加</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111477832"></a>誤り訂正</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2605" target="_top">#2605</a>, armel: _ST_Covers()が穴の中のポイントでTRUEを返す</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2911" target="_top">#2911</a>, スケールが1/-1でオフセットが0/0のラスタのST_Rescale/ST_Resample/ST_Resizeの出力を訂正。</p><p>ST_Union(raster)が異常終了するのを訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2704" target="_top">#2704</a>, gml:pos配列でST_GeomFromGML()が正しく動作しない (Even Roualtさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2708" target="_top">#2708</a>, スキーマを指定していないとupdategeometrysridがsridのチェックを更新しない。Marc Jansenさんからのパッチ</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2720" target="_top">#2720</a>, lwpoly_add_ringはreallocの後に最大環数を更新するべき</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2759" target="_top">#2759</a>, 複数行のSQLコメントを埋め込んだオブジェクトコメントの処理でpostgis_restore.plを訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2774" target="_top">#2774</a>, ptarray_calculate_gbox_geodeticで未定義の振る舞いを訂正</p><p>ST_MakeValidの潜在的なメモリフォールトの訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2784" target="_top">#2784</a>, --with-sfcgalへの偽の引数の処理の訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2772" target="_top">#2772</a>, RASTER_getBandPath (ST_BandPath)内の早すぎるメモリ解放</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2755" target="_top">#2755</a>, SFCGALの全ての版に対する回帰テストを訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2775" target="_top">#2775</a>, lwline_from_lwmpointでメモリリークが発生する</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2802" target="_top">#2802</a>, ST_MapAlgebraが正当なコールバック関数の返り値か確認するようにしました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2803" target="_top">#2803</a>, ST_MapAlgebraがuserargを使わないSTRICTのコールバック関数を処理するようになりました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2834" target="_top">#2834</a>, ST_Estimated_Extentと大文字小文字の混じったテーブル名 (回帰テストでの問題)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2845" target="_top">#2845</a>, ST_AddPointから悪いジオメトリが発生する</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2870" target="_top">#2870</a>, ジオグラフィカラムへのバイナリ挿入なのにジオメトリが挿入される</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2872" target="_top">#2872</a>, make install による文書構築(Greg Troxellさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2819" target="_top">#2819</a>, Centos5 / Solariでisfiniteを見つけるか置き換えるようにしました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2899" target="_top">#2899</a>, geocodeでlimit 1を指定した時に最善の答えが返らない (Tigerジオコーダ)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2903" target="_top">#2903</a>, FreeBSDでコンパイルできない</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2927" target="_top">#2927</a> reverse_geocode (Tigerジオコーダ)が方角プレフィクスを埋めないし、ST_Line_Locate_Pointが呼ばれる</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp111517896"></a>A.19. リリース 2.1.3</h2></div></div></div><p>リリース日: 2014/05/13</p><p>誤り訂正とセキュリティ対策のリリースです。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111519304"></a>重要な変更</h3></div></div></div><p>この版から、オフラインでのラスタへのアクセスとGDALドライバの利用はデフォルトでは無効になりました。 </p><p>環境変数POSTGIS_GDAL_ENABLED_DRIVERSで特定のGDALドライバを有効にできます。デフォルトでは全てのGDALドライバは無効になっています。 </p><p>環境変数POSTGIS_ENABLE_OUTDB_RASTERSでデータベース外ラスタバンドを有効にできます。デフォルトでは、データベース外ラスタバンドは無効です。 </p><p>これらの環境変数はPostgreSQLプロセスに設定しなければなりません。また、クラスタ全体の振る舞いを決定するものです。 </p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111521608"></a>誤り訂正</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2697" target="_top">#2697</a>, 不正なGeoJSONポリゴン入力でサーバプロセスが異常終了する</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2700" target="_top">#2700</a>, NULL行を持つ高次元データセットのダンプの訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2706" target="_top">#2706</a>, ST_DumpPointsに空ジオメトリを与えるとサーバが異常終了する</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp111524808"></a>A.20. リリース 2.1.2</h2></div></div></div><p>リリース日: 2014/03/31</p><p>この版は誤り訂正版です。2.1.1版以降に送られた問題の処理が行われました。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111526216"></a>誤り訂正</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2666" target="_top">#2666</a>, コンフィギュア時にSQLプリプロセッサが発見できないとエラーになる</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2534" target="_top">#2534</a>, st_distanceが大きなジオグラフィでは正しくない結果を返す</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2539" target="_top">#2539</a>, json-c/json.hが存在し、以前のjson/json.hのように使用可能であるかの確認</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2543" target="_top">#2543</a>, 単純なクエリからの不正なJOIN選択度エラー</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2546" target="_top">#2546</a>, 文字列座標値を持つGeoJSONのパースが不正 </p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2547" target="_top">#2547</a>, 階層的なTopoGeometryに対するST_Simplify(TopoGeometry)の訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2552" target="_top">#2552</a>, ST_AsPNG, ST_AsTIFF, ST_AsJPEGのNULLラスタ処理の訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2555" target="_top">#2555</a>, ST_Reclassのrange引数のパースの問題の訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2556" target="_top">#2556</a>, ジオグラフィのST_Intersectsの結果が行挿入順序によって異なる</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2580" target="_top">#2580</a>, 同じデータベースに2回PostGISをインストールさせないようにしました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2589" target="_top">#2589</a>, 必須でないvoidポインタの使用の削除</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2607" target="_top">#2607</a>, 1プロセスで1024以上のデータベース外ファイルを開くことができない</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2610" target="_top">#2610</a>, フェイス分割アルゴリズムでエッジインデックスの使用を確実にしました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2615" target="_top">#2615</a>, EstimatedExtent (その下にある統計情報に由来)がおかしいbboxを集める</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2619" target="_top">#2619</a>, GeoJSONで環の配列が空の場合に異常終了する</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2634" target="_top">#2634</a>, 球面距離のコードの回帰テスト</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2638" target="_top">#2638</a>, M値を持つジオグラフィの距離が時々おかしい</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2648" target="_top">#2648</a>, <a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2653" target="_top">#2653</a>, ”topology”がsearch_pathに無い時のトポロジ関数の訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2654" target="_top">#2654</a>, トポロジでの非推奨呼び出しの削除</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2655" target="_top">#2655</a>, トポロジの権限を持たないユーザがpostgis_full_version()を呼ぶ時の問題</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2674" target="_top">#2674</a>, 欠損した=演算子と演算子クラスhash_raster_opsの訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2675" target="_top">#2675</a>, <a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2534" target="_top">#2534</a>, <a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2636" target="_top">#2636</a>, <a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2634" target="_top">#2634</a>, <a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2638" target="_top">#2638</a>, 木構造の最適化でのジオグラフィの距離の問題</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111559496"></a>性能強化</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2494" target="_top">#2494</a>, GiSTインデックスでmemcopyを避けるようにしました (hayamizさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2560" target="_top">#2560</a>, ソフトアップグレード: 変更されていない集約関数の削除/置換を避けるようにしました</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp111561928"></a>A.21. リリース 2.1.1</h2></div></div></div><p>リリース日: 2013/11/06</p><p>この版は誤り訂正版です。2.1.0版以降に送られた問題の処理が行われました。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111563336"></a>重要な変更</h3></div></div></div><p>#<a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2514" target="_top">#2514</a>, PostGIS ExtensionをGPLv2で配布できるようにラスタのラインセンスをGPL v3+からv2+に変更</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111565000"></a>誤り訂正</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2396" target="_top">#2396</a>, 回帰テストをよりエンディアン不明なテストにしました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2434" target="_top">#2434</a>, 珍しい状況でのST_Intersection(geog,geog)の回帰テストの訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2454" target="_top">#2454</a>, exclude_nodata_valueパラメータに沿うST_PixelAsXXX関数の振る舞いの訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2489" target="_top">#2489</a>, 2.0からのアップグレードで古い関数のシグネチャが残されているのを訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2525" target="_top">#2525</a>, 入れ子のコレクションのSRIDの処理の訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2449" target="_top">#2449</a>, インデックス構築の潜在的な永久ループの訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2493" target="_top">#2493</a>, 空ラスタを渡した時のST_DumpValuesの挙動の訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2502" target="_top">#2502</a>, postgis_topology_scripts_installed()のインストールスキーマの訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2504" target="_top">#2504</a>, pgsql2shpの正しくない呼び出しでセグメンテーション違反が発生するのを訂正 </p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2512" target="_top">#2512</a>, raster_columnsとraster_overviewsの外部テーブルと体現ビューへの対応</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111573704"></a>性能強化</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2478" target="_top">#2478</a>, Tiger 2013への対応</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2463" target="_top">#2463</a>, 弧ジオメトリの精密な距離計算への対応</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp111576264"></a>A.22. リリース 2.1.0</h2></div></div></div><p>リリース日: 2013/08/17</p><p>マイナーリリースです。2.0.3以降に送られた誤り訂正、性能向上、機能向上を行いました。2.0以上からアップグレードする場合には、ソフトアップグレードだけが必要です。1.5以前からアップグレードする場合には、ハードアップグレードが必要です。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111577672"></a>重大/大幅な変更</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1653" target="_top">#1653</a>, ST_Resample(raster)からSRIDパラメータを削除し、参照ラスタを使う形式でラスタのSRIDの参照を適用しなくしました。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1962" target="_top">#1962</a> ST_Segmentize - ジオグラフィ対応の紹介での結果として、<code class="code">SELECT ST_Segmentize('LINESTRING(1 2, 3 4)',0.5);</code>で関数の曖昧エラーが出る</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2026" target="_top">#2026</a>, ST_Union(raster)が全てのラスタの全てのバンドを結合するようになりました。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2089" target="_top">#2089</a>, liblwgeom: lwgeom_set_handlersがlwgeom_init_allocatorsに取って代わりました。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2150" target="_top">#2150</a>, regular_blockingは制約ではなくなりました。raster_columns内の同名のカラムは、patially_unique制約とcoverage_tile制約の存在を確認しています。</p><p>ST_Intersects(raster, geometry)をST_Intersects(geometry, raster)と同じに振る舞うようにしました。</p><p>ポイント形式のST_SetValue(raster)が入力ポリゴンとラスタのSRIDを確認していなかった。</p><p>ST_Hillshadeのazimuthとaltitudeパラメータをラジアンから度に変更。</p><p>ST_SlopeとST_Aspectが返すピクセル値をラジアンから度に変更。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2104" target="_top">#2104</a>, ST_World2RasterCoord, ST_World2RasterCoordX, ST_World2RasterCoordYをST_WorldToRasterCoord, ST_WorldToRasterCoordX, ST_WorldToRasterCoordYにそれぞれ関数名変更。ST_Raster2WorldCoord, ST_Raster2WorldCoordX, ST_Raster2WorldCoordYをST_RasterToWorldCoord, ST_RasterToWorldCoordX, ST_RasterToWorldCoordYにそれぞれ関数名変更。</p><p>ST_Estimated_ExtentをST_EstimatedExtentに関数名変更</p><p>ST_Line_Interpolate_PointをST_LineInterpolatePointに関数名変更</p><p>ST_Line_SubstringをST_LineSubstringに関数名変更</p><p>ST_Line_Locate_PointをST_LineLocatePointに関数名変更</p><p>ST_Force_XXX をST_ForceXXXに関数名変更</p><p>ST_MapAlgebraFctNgbとST_MapAlgebraFctの1ラスタ形式と2ラスタ形式。代わりにST_MapAlgebraを使います。</p><p>ST_MapAlgebraExprの1ラスタ形式と2ラスタ形式。代わりに数式形式のST_MapAlgebraを使います。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111588040"></a>新機能</h3></div></div></div><p>- 新しい関数の完全なリストは http://postgis.net/docs/manual-2.1/PostGIS_Special_Functions_Index.html#NewFunctions_2_1 を参照</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/310" target="_top">#310</a>, ST_DumpPointsのC言語関数への変換 (Nathan Wagnerさん)と速度向上</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/739" target="_top">#739</a>, UpdateRasterSRID()</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/945" target="_top">#945</a>, JOIN選択度、N次元選択度計算、ユーザがアクセス可能な選択度およびテスト用統計情報取得関数の改善 (Paul Ramseyさん / OpenGeo)</p><p>toTopoGeom with TopoGeometry sink (Sandro Santilliさん / Vizzuality)</p><p>clearTopoGeom (Sandro Santilliさん / Vizzuality)</p><p>ST_Segmentize(geography) (Paul Ramseyさん / OpenGeo)</p><p>ST_DelaunayTriangles (Sandro Santilliさん / Vizzuality)</p><p>ST_NearestValue, ST_Neighborhood (Bborie Parkさん / UC Davis)</p><p>ST_PixelAsPoint, ST_PixelAsPoints (Bborie Parkさん / UC Davis)</p><p>ST_PixelAsCentroid, ST_PixelAsCentroids (Bborie Parkさん / UC Davis)</p><p>ST_Raster2WorldCoord, ST_World2RasterCoord (Bborie Parkさん / UC Davis)</p><p>ラスタ/ラスタ空間関係関数 (ST_Contains, ST_ContainsProperly, ST_Covers, ST_CoveredBy, ST_Disjoint, ST_Overlaps, ST_Touches, ST_Within, ST_DWithin, ST_DFullyWithin)の追加 (Bborie Parkさん / UC Davis)</p><p>ST_SetValues()でのバンド内の多数のピクセル値を入れる形式の追加 (Bborie Parkさん / UC Davis)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1293" target="_top">#1293</a>, 幅/高さに基づくラスタのサイズ再設定を行うST_Resize(raster)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1627" target="_top">#1627</a>, PostgreSQLエクステンションとしてのtiger_geocoderパッケージ</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1643" target="_top">#1643</a>, <a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2076" target="_top">#2076</a>, Tiger 2011と2012のロードに対応したTigerジオコーダのアップグレード (Regina Obeさん / Paragon Corporation) Funded by Hunter Systems Groupの資金提供</p><p>ST_MakeValidがジオメトリコレクションに対応しました (Sandro Santilliさん / Vizzuality)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1709" target="_top">#1709</a>, ST_NotSameAlignmentReason(raster, raster)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1818" target="_top">#1818</a>, ST_GeomFromGeoHashと仲間 (Jason Smithさん (darkpanda))</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1856" target="_top">#1856</a>, Tigerジオコーダ: 逆ジオコーディングの評価で道路番号が好ましい場合に設定できるようになりました</p><p>ST_PixelOfValue (Bborie Parkさん / UC Davis)</p><p>PostgreSQLの幾何データ型 (point/path/polygon)との相互キャスト</p><p>1つのバンドにジオメトリ集合と該当値を使って1回の呼び出しで多数のピクセル値を入れるためにST_SetValues()にgeomval配列の形式を追加 (Bborie Parkさん / UC Davis)</p><p>ラスタをタイルに分解するST_Tile(raster) (Bborie Parkさん / UC Davis)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1895" target="_top">#1895</a>, 新しいR木のノード分割アルゴリズム (Alex Korotkovさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2011" target="_top">#2011</a>, ラスタを配列で出力するST_DumpValues (Bborie Parkさん / UC Davis)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2018" target="_top">#2018</a>, ST_DistanceがCircularString, CurvePolygon, MultiCurve, MultiSurface, CompoundCurveに対応しました </p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2030" target="_top">#2030</a>, 任意数のラスタ (と任意数のバンド)のST_MapAlgebra (Bborie Parkさん / UC Davis)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2193" target="_top">#2193</a>, PAGCパーサをTiger住所正規化の置き換えとして使用可能にしました (Steve Woodbridgeさん, Regina Obeさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2210" target="_top">#2210</a>, ST_MinConvexHull(raster)</p><p>liblwgeom内のlwgeom_from_geojson (Sandro Santilliさん / Vizzuality)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1687" target="_top">#1687</a>, TopoGeometryのためのST_Simplify (Sandro Santilliさん / Vizzuality)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2228" target="_top">#2228</a>, TopoGeometryのためのTopoJSON出力 (Sandro Santilliさん / Vizzuality)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2123" target="_top">#2123</a>, ST_FromGDALRaster</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/613" target="_top">#613</a>, 文字列パラメータの代わりに数値パラメータを与えるST_SetGeoReference</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2276" target="_top">#2276</a>, データベース外バンド用のST_AddBand(raster)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2280" target="_top">#2280</a>, ST_Summary(raster)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2163" target="_top">#2163</a>, ラスタ用のST_TPI (Nathaniel Clayさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2164" target="_top">#2164</a>, ラスタ用のST_TRI (Nathaniel Clayさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2302" target="_top">#2302</a>, ラスタ用のST_Roughness (Nathaniel Clayさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2290" target="_top">#2290</a>, RGBAバンドを生成するST_ColorMap(raster)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2254" target="_top">#2254</a>, SFCGALバックエンドへの対応。 (バックエンド選択はpostgis.backend変数で行います) GEOSとSFCGALの両方で有効な関数はST_Intersects, ST_3DIntersects, ST_Intersection, ST_Area, ST_Distance, ST_3DDistanceです。SFCGALのみ有効な関数はST_3DIntersection, ST_Tesselate, ST_3DArea, ST_Extrude, ST_ForceLHR ST_Orientation, ST_Minkowski, ST_StraightSkeleton postgis_sfcgal_versionです。PostGISへの新規追加関数はST_ForceSFS (Olivier CourtinさんとHugo Mercier / Oslandia)です</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111620424"></a>性能強化</h3></div></div></div><p>新関数と関数改善の詳細については、<a class="xref" href="#NewFunctions_2_1" title="14.12.6. PostGIS 2.1で新規作成/機能強化された関数">「PostGIS 2.1で新規作成/機能強化された関数」</a>を参照して下さい。</p><p>ラスタ版ST_UnionとST_Clipの高速化と多くの関数の追加操作</p><p>ジオメトリ/ジオグラフィでのプランナの選択度の向上と多数の関数</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/823" target="_top">#823</a>, Tigerジオコーダ: loader_generate_scriptのダウンロード部分の貪欲さを低減</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/826" target="_top">#826</a>, raster2pgsqlの詰め物タイルはデフォルトでなくなりました。-Pフラグで詰め物タイルにできます</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1363" target="_top">#1363</a>, ST_AddBand(raster, ...)配列版のC言語による再記述</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1364" target="_top">#1364</a>, ST_Union(raster, ...)集約関数のC言語による再記述</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1655" target="_top">#1655</a>, ST_Slopeのパラメータの追加的なデフォルト値</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1661" target="_top">#1661</a>, 集約関数形式のST_SameAlignmentを追加</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1719" target="_top">#1719</a>, ST_MakeValidのポイントとジオメトリコレクション入力への対応の追加</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1780" target="_top">#1780</a>, ST_GeoHashのジオグラフィ対応の追加</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1796" target="_top">#1796</a>, ジオグラフィの距離計算の非常に大きな効率改善</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1802" target="_top">#1802</a>, 関数の割り込み可能性について改善。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1823" target="_top">#1823</a>, ST_AsGMLへのGML 3出力用の識別子カラム (GML 3.2.1から必須)を使用するためのパラメータの追加</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1856" target="_top">#1856</a>, Tigerジオコーダ: 逆ジオコーディングの評価で道路番号が好ましい場合に設定できるようになりました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1938" target="_top">#1938</a>, 1回の呼び出しで複数の新しいバンドを追加するようST_AddBandを基本からリファクタリング</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1978" target="_top">#1978</a>, 閉じた円弧 (円)の距離計算で悪い答が出る</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1989" target="_top">#1989</a>, 入力ジオメトリをクリップされるべきラスタとの交差だけに処理するようにしました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2021" target="_top">#2021</a>, ST_Union(raster, ...)集約関数に複数バンド対応を追加</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2006" target="_top">#2006</a>, 極や日付線をまたぐST_Area(geography)への対応の改善</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2065" target="_top">#2065</a>, ST_Clip(raster, ...)がC言語の関数になりました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2069" target="_top">#2069</a>, ST_Tile(raster)にタイルの詰め物に関するパラメータ追加</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2078" target="_top">#2078</a>, ST_Slope, ST_AspectとST_HillShadeにカバレッジのタイルの処理を解決するための形式を追加</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2097" target="_top">#2097</a>, ST_Union(raster)のuniontypeオプションにRANGEを追加</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2105" target="_top">#2105</a>, 出力を参照ラスタに整列させるためのST_Transform(raster)の形式を追加</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2119" target="_top">#2119</a>, Rasters passed to ST_Resample(), ST_Rescale(), ST_Reskew()とST_SnapToGrid()に渡すラスタはSRIDを必須としなくなりました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2141" target="_top">#2141</a>, 制約がラスタカラムに追加できない場合の出力がより詳細になりました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2143" target="_top">#2143</a>, ラスタのblocksize制約で複数値を許容するようになりました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2148" target="_top">#2148</a>, ラスタのcoverage_tile制約の追加</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2149" target="_top">#2149</a>, ラスタのspatially_unique制約の追加</p><p>TopologySummary出力に登録されていないレイヤとレイヤから欠落しているTopoGeometryオブジェクトの個数が含まれるようになりました</p><p>ST_HillShade(), ST_Aspect()とST_Slope()に、実行前に行うNODATAピクセルの補間のための新しいパラメータを追加。</p><p>ポイント版ST_SetValue(raster)は現在はgeomval版 ST_SetValues(rast)をラップするようになっています。</p><p>中核APIとローダでラスタバンドのisnodataフラグへの確実な対応</p><p>ST_AspectとST_HillShadeのパラメータのデフォルト値の追加</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2178" target="_top">#2178</a>, ST_Summaryは[S]フラグでSRIDの有無が分かるようになりました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2202" target="_top">#2202</a>, libjson-cの任意化 (コンフィギュアスイッチ--without-json)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2213" target="_top">#2213</a>, libjson-c 0.10以上への新規対応</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2231" target="_top">#2231</a>, raster2pgsqlがファイル名カラムのカラム名を-nで指定できるようになりました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2200" target="_top">#2200</a>, ST_Union(raster, uniontype)で全ての入力ラスタの全てのバンドを結合するようになりました。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2264" target="_top">#2264</a>, postgis_restore.plがカスタムスキーマでPostGISを使っているデータベースへの再格納に対応しました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2244" target="_top">#2244</a>, ラスタにデータベース外バンドがある場合にジオリファレンスが変わったときに警告が出る</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2222" target="_top">#2222</a>, ST_AsBinaryに、データベース外バンドをデータベース内バンドのように返すべきかを決めるフラグOutAsInパラメータの追加</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111652424"></a>訂正</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1839" target="_top">#1839</a>, raster2pgsqlでGeoTIFFのサブデータセットの処理</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1840" target="_top">#1840</a>, raster2pgsqlでタイル数を計算する時機のロジックを訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1870" target="_top">#1870</a>, ラスタのST_Intersectsの文書と実際の振る舞いとをあわせました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1872" target="_top">#1872</a>, ST_ApproxSummarystatsでゼロで割らないようにしました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1875" target="_top">#1875</a>, パラメータのcountが0で他が全てNULLの時にST_SummaryStatsがNULLを返す</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1932" target="_top">#1932</a>, raster2pgsqlでインデックスのテーブル空間についての書式を訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1936" target="_top">#1936</a>, ST_GeomFromGMLにCurvePolygonを与えると異常終了する</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1939" target="_top">#1939</a>, 独自データ型: summarystats, histogram, quantile, valuecountを削除</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1951" target="_top">#1951</a>, 距離が0のラインストリングで異常終了するのを削除</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1957" target="_top">#1957</a>, 1点のラインストリングを与えるとST_DistanceがNULLを返す</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1976" target="_top">#1976</a>, ジオグラフィの環内ポイントのコードを信頼性向上のため見直し</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1981" target="_top">#1981</a>, gcc 4.6以上で警告の原因となる未使用変数の削除</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1996" target="_top">#1996</a>, GeoJSON出力でPOINT EMPTYに対応</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2062" target="_top">#2062</a>, 距離計算の効率改善</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2057" target="_top">#2057</a>, raster2psqlからlibpqへのリンクの問題を訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2077" target="_top">#2077</a>, ST_Hillshade()が正しくない値を返すのを訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2019" target="_top">#2019</a>, ST_FlipCoordinatesがバウンダリボックスを更新しない</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2100" target="_top">#2100</a>, ST_AsRasterが指定したピクセル型によってはラスタを返さないことがある</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2126" target="_top">#2126</a>, ST_ConvexHull()からの空のラスタの処理を改善</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2165" target="_top">#2165</a>, ST_NumPointsの回帰テストがCircularStringだと失敗する</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2168" target="_top">#2168</a>, ST_Distanceが交換可能にならないときがある</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2182" target="_top">#2182</a>, データベース外ラスタで、SRIDなしでST_Resizeを実行する際の問題訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2188" target="_top">#2188</a>, GDALデータセットからデータをｈ区政する時に問題となる関数パラメータ値のオーバフローの訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2198" target="_top">#2198</a>, ST_Tile()内でデータベース外ラスタのバンドを生成する時に正しくない寸法を使うのを訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2201" target="_top">#2201</a>, 境界上のST_GeoHashが間違っている</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2203" target="_top">#2203</a>, GDAL Warp APIに渡す時の、未知のSRIDを持つラストとデフォルトのgeotransformを処理する方法を変更</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2215" target="_top">#2215</a>, 暗黙のインデックスの名前の衝突のためラスタ除外制約
Fixed raster exclusion constraint for conflicting name of implicit index</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2251" target="_top">#2251</a>, デフォルトのgeotransform行列でラスタを再スケーリングすると次元がおかしくなるのを訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2133" target="_top">#2133</a>, ST_MapAlgebraの数式版における効率性回帰テストの訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2257" target="_top">#2257</a>, 空ジオメトリでテストする時にGBOX変数が初期化されない</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2271" target="_top">#2271</a>, ラスタの並列ビルドの阻止</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2282" target="_top">#2282</a>, デバッグモードで未定義関数nd_stats_to_grid()を呼ぶのを訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2307" target="_top">#2307</a>, ST_MakeValidが不正なジオメトリを出力する</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2309" target="_top">#2309</a>, SRS情報取得時の紛らわしいINFOメッセージを削除</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2336" target="_top">#2336</a>, wgetを使って全てのファイルを得るのにFIPS 20 (KS)がワイルドカード展開を行う</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2348" target="_top">#2348</a>, 2.0から2.1へのラスタのアップグレードパスの提供</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2351" target="_top">#2351</a>, ジオグラフィ間のst_distanceが間違っている</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2359" target="_top">#2359</a>, オーバビュー制約の追加時のスキーマ名の処理の訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2371" target="_top">#2371</a>, サポートするGEOSの版のマイナー以下の桁が違う</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2383" target="_top">#2383</a>, 警告メッセージから安全でない \" の使用を削除</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2384" target="_top">#2384</a>, ST_Neighborhoodの変数型が不正</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111697736"></a>既知の問題</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2111" target="_top">#2111</a>, ラスタバンドはデータベース外ラスタの最初の256バンドだけ参照可能</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp111699272"></a>A.23. リリース 2.0.5</h2></div></div></div><p>リリース日: 2014/03/31</p><p>この版は誤り訂正版です。2.0.4版以降に送られた問題の処理が行われました。PostGIS 2.0以上を使っている場合にはソフトアップデートが必要です。PostGIS 1.5以前を使っている場合には、ハードアップグレードが必要です。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111704776"></a>誤り訂正</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2494" target="_top">#2494</a>, GiSTインデックスでのmemcpyを回避</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2502" target="_top">#2502</a>, postgis_topology_scripts_installed()のインストールスキーマの訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2504" target="_top">#2504</a>, pgsql2shpの正しくない呼び出しでセグメンテーション違反が発生するのを訂正 </p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2528" target="_top">#2528</a>, ST_Split / lwline_split_by_lineでのメモリリークを訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2532" target="_top">#2532</a>, ラスタ/ジオメトリの交換演算子の追加</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2533" target="_top">#2533</a>, 重複シグネチャの削除</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2552" target="_top">#2552</a>, ST_AsPNG, ST_AsTIFF, ST_AsJPEGのNULLラスタ処理の訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2555" target="_top">#2555</a>, ST_Reclassのrange引数のパースの問題の訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2589" target="_top">#2589</a>, 必須でないvoidポインタの使用の削除</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2607" target="_top">#2607</a>, 処理時に1024以上のデータベース外ファイルが開けない</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2610" target="_top">#2610</a>, フェイス分割アルゴリズムでエッジインデックスの使用を確実にしました </p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2619" target="_top">#2619</a>, GeoJSONポリゴンで空の環があると異常終了する</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2638" target="_top">#2638</a>, M値を持つジオグラフィの距離が時々おかしい</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111716040"></a>重要な変更</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2514" target="_top">#2514</a>, ラスタライセンスをGPL v3以上からv2以上に変更し、PostGISエクステンションをGPL v2で配布できるようにしました。</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp111717704"></a>A.24. リリース 2.0.4</h2></div></div></div><p>リリース日: 2013/09/06</p><p>この版は誤り訂正版です。2.0.3版以降に送られた問題の処理が行われました。PostGIS 2.0以上を使っている場合にはソフトアップデートが必要です。PostGIS 1.5以前を使っている場合には、ハードアップグレードが必要です。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111719112"></a>誤り訂正</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2110" target="_top">#2110</a>, EMPTYと原点上のポイントとの等価演算</p><p>TopoGeo_addPointで精度距離でのポイントの追加が可能になりました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1968" target="_top">#1968</a>,toTopoGeomからエッジがなくなって返るのを訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2165" target="_top">#2165</a>, ST_NumPointsの回帰テストがCircularStringだと失敗する</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2168" target="_top">#2168</a>, ST_Distanceが交換可能にならないときがある</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2186" target="_top">#2186</a>, GUIのプログレスバーの更新が頻繁に過ぎる</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2201" target="_top">#2201</a>, 境界上のST_GeoHashが間違っている</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2257" target="_top">#2257</a>, 空ジオメトリでテストする時にGBOX変数が初期化されない</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2271" target="_top">#2271</a>, ラスタの並列ビルドの阻止</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2267" target="_top">#2267</a>, テーブルの解析からサーバが異常終了する</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2277" target="_top">#2277</a>, 潜在的なセグメンテーション違反を削除</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2307" target="_top">#2307</a>, ST_MakeValidが不正なジオメトリを出力する</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2351" target="_top">#2351</a>, ジオグラフィ間のst_distanceが間違っている</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2359" target="_top">#2359</a>, overview制約のスキーマの処理が不正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2371" target="_top">#2371</a>, サポートするGEOSの版のマイナー以下の桁が違う</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2372" target="_top">#2372</a>, KMLの座標に空白を入れたらパースできない</p><p>システム全体でインストールされるliblwgeomでビルドするよう訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2383" target="_top">#2383</a>, 警告メッセージ内の安全でない \' の使用を訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2410" target="_top">#2410</a>, 頂点が同一線上にある曲線の分割の訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2412" target="_top">#2412</a>, ST_LineToCurveが4頂点未満のラインに対応</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2415" target="_top">#2415</a>, ST_MultiがCOMPOUNDCURVEとCURVEPOLYGONに対応</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2420" target="_top">#2420</a>, ST_LineToCurve: 閉じた円の定義に少なくとも8エッジが必要</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2423" target="_top">#2423</a>, ST_LineToCurve: 同じ角度を形成する全てのアークが必要</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2424" target="_top">#2424</a>, ST_CurveToLine: MULTICURVEのCOMPOUNDCURVEに対応</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2427" target="_top">#2427</a>, ST_CurveToLineでの曲線の1番目のポイントの維持を確実にするようにしました</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111739464"></a>性能強化</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2269" target="_top">#2269</a>, ANALYZEでジオメトリ全体のTOASTを解除する無駄を排除</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111741000"></a>既知の問題</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2111" target="_top">#2111</a>, ラスタバンドはデータベース外ラスタの最初の256バンドだけ参照可能</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp111742664"></a>A.25. リリース 2.0.3</h2></div></div></div><p>リリース日: 2013/03/01</p><p>この版は誤り訂正版です。2.0.2版以降に送られた問題の処理が行われました。PostGIS 2.0以上を使っている場合にはソフトアップデートが必要です。PostGIS 1.5以前を使っている場合には、ハードアップグレードが必要です。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111744072"></a>誤り訂正</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2126" target="_top">#2126</a>, ST_ConvexHull()からの空のラスタの処理を改善</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2134" target="_top">#2134</a>, GDAL関数に渡す前のSRS処理を確実にしました</p><p>liblwgeomの様々なメモリリークを訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2173" target="_top">#2173</a>, ラインを頂点で分割する際の堅牢性の訂正とトポロジ構築への波及(<a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2172" target="_top">#2172</a>)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2174" target="_top">#2174</a>, 間違った関数lwpoly_free()の使用法の訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2176" target="_top">#2176</a>, ST_ChangeEdgeGeomの堅牢性問題の訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2184" target="_top">#2184</a>, Z値を持つトポロジの複写を正しくしました </p><p>postgis_restore.plでダンプでジオメトリカラム名の混合する場合への対応</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2188" target="_top">#2188</a>, GDALデータセットからデータをｈ区政する時に問題となる関数パラメータ値のオーバフローの訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2216" target="_top">#2216</a>, マルチポリゴンのGeoJSON (穴のあるもの)のパーシングで多数のメモリエラー</p><p>GeoJSONパーサのメモリリークの訂正</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111753032"></a>性能強化</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2141" target="_top">#2141</a>, 制約がラスタカラムに追加できない場合の出力がより詳細になりました</p><p>ST_ChangeEdgeGeomの速度向上</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp111755080"></a>A.26. リリース 2.0.2</h2></div></div></div><p>リリース日: 2012/12/03</p><p>この版は誤り訂正版です。2.0.1版以降に送られた問題の処理が行われました。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111756488"></a>誤り訂正</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1287" target="_top">#1287</a>, "gist_geometry_ops"の削除によって、この場合のクライアントのlegacy_gist.sqlのパッケージが壊れた</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1391" target="_top">#1391</a>, 1.5版からのアップデートでエラーが発生する</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1828" target="_top">#1828</a>, ST_DWithinで選択度見積もりが貧弱</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1838" target="_top">#1838</a>, Tigerのラインデータのインポートでエラー</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1869" target="_top">#1869</a>, ST_AsBinaryがlegacy_minor/legacy.sqlスクリプトに一意に追加されない</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1885" target="_top">#1885</a>, Tiger2010のcensus_loader.sqlでtabblockテーブルのフィールド欠損</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1891" target="_top">#1891</a>, liblwgeomのビルドでLDFLAGS環境変数を使うようにしました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1900" target="_top">#1900</a>, ビッグエンディアン機でのpgsql2shpの訂正 </p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1932" target="_top">#1932</a>, raster2pgsqlでインデックスのテーブル空間設定が不正な書式になるのを訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1936" target="_top">#1936</a>, ST_GeomFromGMLにCurvePolygonを与えると異常終了する</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1955" target="_top">#1955</a>, 二重接続されたエッジのST_ModEdgeHealとST_NewEdgeHeal</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1957" target="_top">#1957</a>, 1点のラインストリングを与えるとST_DistanceがNULLを返す</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1976" target="_top">#1976</a>, ジオグラフィの環内ポイントのコードを信頼性向上のため見直し</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1978" target="_top">#1978</a>, 閉じた円弧 (円)の長さの計算が間違っている</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1981" target="_top">#1981</a>, gcc 4.6以上で発見された、使われないけれども宣言されている変数の削除</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1987" target="_top">#1987</a>, ST_Simplifyの挙動を1.5.x版に戻しました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1989" target="_top">#1989</a>, 入力ジオメトリをクリップされるべきラスタとの交差だけに処理するようにしました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1991" target="_top">#1991</a>, PostgreSQL 9.2上でのジオコーディングが本当に遅い</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1996" target="_top">#1996</a>, GeoJSON出力でPOINT EMPTYに対応</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1998" target="_top">#1998</a>, 両方の終端を共有するエッジをつなげるST_{Mod,New}EdgeHealの訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2001" target="_top">#2001</a>, ST_CurveToLineで、ジオメトリが実際に弧を含んでいない場合に効果が無い</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2015" target="_top">#2015</a>, ST_IsEmpty('POLYGON(EMPTY)')がFALSEを返す</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2019" target="_top">#2019</a>, ST_FlipCoordinatesがバウンダリボックスを更新しない</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2025" target="_top">#2025</a>, TopoGeo_AddLineStringでサイドの位置が衝突するのを訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2026" target="_top">#2026</a>, 距離計算の効率改善</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2033" target="_top">#2033</a>, 2.5次元トポロジへの分割ポイント追加の訂正 </p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2051" target="_top">#2051</a>, ST_AsGeoJSON出力での精度過剰の訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2052" target="_top">#2052</a>, lwgeom_to_geojsonでのバッファオーバフローの訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2056" target="_top">#2056</a>, ST_SetValue()でのラスタとジオメトリのSRIDチェックの欠落を訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2057" target="_top">#2057</a>, raster2psqlからlibpqへのリンクの問題を訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2060" target="_top">#2060</a>, GetTopoGeomElementArrayで「次元」チェック違反になるのを訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2072" target="_top">#2072</a>, ST_Intersects(raster)がデータベース外バンドで動作することを予防する旧式のチェックの削除</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2077" target="_top">#2077</a>, ST_Hillshade(raster)が正しくない答えを出すのを訂正 </p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2092" target="_top">#2092</a>, libxml2.8以上でのST_GeomFromKML,ST_GeomFromGMLの名前空間の問題</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2099" target="_top">#2099</a>, ST_OffsetCurveでの例外発生時に二度メモリ開放をしているのを訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2100" target="_top">#2100</a>, ST_AsRaster()が指定したピクセルタイプでラスタを返さないことがある</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2108" target="_top">#2108</a>, ST_Line_Interpolate_Pointが常にポイントを返すのを確実にしました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2109" target="_top">#2109</a>, ST_Centroidが常にポイントを返すのを確実にしました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2117" target="_top">#2117</a>, ST_PointOnSurfaceが常にポイントを返すのを確実にしました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2129" target="_top">#2129</a>, 入力がコレクションの場合のST_Homogenizeで出力のSRIDを訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2130" target="_top">#2130</a>, マルチポリゴンのGeoJson読み込みでメモリエラーが出るのを訂正</p><p>Maven jarのURLを更新</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111822664"></a>性能強化</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1581" target="_top">#1581</a>, ST_Clip(raster, ...)は、現在では、引数のラスタにNODATAが無い場合に、バンドのNODATAを強制しません</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1928" target="_top">#1928</a>, Accept array properties in GML input 入力GMLのマルチ系ジオメトリでの配列を受け付けるようにしました (Kashif RasulさんとShoaib Burqさん / SpacialDB)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2082" target="_top">#2082</a>, トポロジのエッジテーブルの始端ノードと終端ノードにインデックスを追加</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/2087" target="_top">#2087</a>, 再帰的共通テーブル式の使用でtopology.GetRingEdgesの速度向上</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp111826632"></a>A.27. リリース 2.0.1</h2></div></div></div><p>リリース日: 2012/06/22</p><p>この版は誤り訂正版です。2.0.0版以降に送られた問題の処理が行われました。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111828040"></a>誤り訂正</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1264" target="_top">#1264</a>, st_dwithin(geog, geog, 0)の訂正。 </p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1468" target="_top">#1468</a> shp2pgsql-guiのテーブル、カラム、スキーマの入力テキストボックスがずれる</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1694" target="_top">#1694</a>, clangでのビルドの訂正 (vinceさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1708" target="_top">#1708</a>, PostGIS 2.0より前のバックアップの再格納の改善。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1714" target="_top">#1714</a>, トポロジでの広い許容範囲の処理の堅牢性向上</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1755" target="_top">#1755</a>, ST_GeographyFromTextの高次元への対応。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1759" target="_top">#1759</a>, ラスタが有効なデータベースで投影変換されたシェープファイルのロード。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1761" target="_top">#1761</a>, raster2pgsqlでのNetCDF, HDF4およびHDF5のサブデータセットの処理。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1763" target="_top">#1763</a>, topology.toTopoGeomで独自のsearch_pathを使っている。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1766" target="_top">#1766</a>, ST_RemEdge*が周辺のTopoGeometryオブジェクトを破壊しないようにしました。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1774" target="_top">#1774</a>, エッジ塩ｍ、餌取を不正なものに設定した時のエラーを明確にしました。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1775" target="_top">#1775</a>, 2頂点を対象とするST_ChangeEdgeGeomの衝突検出。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1776" target="_top">#1776</a>, ST_SymDifference(empty, geom)がgeomを返すよう訂正。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1779" target="_top">#1779</a>, SQLコメントファイルをインストールするようにしました。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1782" target="_top">#1782</a>, ラスタでの空間参照系文字列の処理の訂正。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1789" target="_top">#1789</a>, ValidateTopologyで、エッジとノードのクロスを虚偽報告する問題を訂正。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1790" target="_top">#1790</a>, toTopoGeomの重複するプリミティブの処理の訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1791" target="_top">#1791</a>, 非常に近いが重ならない2ポイントを引数に取るST_Azimuthの訂正。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1797" target="_top">#1797</a>, (ValidateTopology(xxx)).*構文の呼び出しに関する訂正。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1805" target="_top">#1805</a>, put back the 900913 SRID登録を戻しました。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1813" target="_top">#1813</a>, メタデータテーブル内の読むことができるリレーションだけを表示するよう変更。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1819" target="_top">#1819</a>, ST_World2RasterCoordとST_Raster2WorldCoord の浮動小数点数の問題の訂正。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1820" target="_top">#1820</a> PostgreSQL 9.2beta1でのコンパイル。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1822" target="_top">#1822</a>, PostgreSQL 9.2beta1でのトポロジのロード。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1825" target="_top">#1825</a>, 準備されたジオメトリキャッシュの抽出について訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1829" target="_top">#1829</a>, GeoJSONパーサで初期化されていない値の読み込みの訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1834" target="_top">#1834</a>, ユーザ定義の空間参照系をバックアップするためだけのPostGISエクステンションの改訂</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1839" target="_top">#1839</a>, raster2pgsqlでGeoTIFFのサブデータセットの処理</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1840" target="_top">#1840</a>, raster2pgsqlでタイル数を計算する時機のロジックを訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1851" target="_top">#1851</a>, EPSG:3844の空間参照系パラメータの訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1857" target="_top">#1857</a>, ST_AddEdge*Face*での終点不整合の検出失敗を訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1865" target="_top">#1865</a>, postgis_restore.plで、先頭にダッシュ(訳注: "--")が付く行が欠損する。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1867" target="_top">#1867</a>, topogeo_add*に不正なトポロジ名を渡した際の例外</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1872" target="_top">#1872</a>, ST_ApproxSummarystatsでゼロで割らないようにしました</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1873" target="_top">#1873</a>, ptarray_locate_pointを、線上にある場合にZ/M補間値を返すよう訂正</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1875" target="_top">#1875</a>, パラメータのcountが0で他が全てNULLの時にST_SummaryStatsがNULLを返す </p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1881" target="_top">#1881</a>, shp2pgsql-gui -- 時々、フィールドの編集をきっかけに行が削除される</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1883" target="_top">#1883</a>, ジオコーダのインストールで、create_census_base_tables()を実行し要素すると失敗する (Brian Panullaさん)</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111862856"></a>性能強化</h3></div></div></div><p>トポロジ編集関数からの例外メッセージをより詳細にしました。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1786" target="_top">#1786</a>, ビルドの依存関係を改善。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1806" target="_top">#1806</a>, ST_BuildArea, ST_MakeValidおよびST_GetFaceGeometryの速度向上。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1812" target="_top">#1812</a>, より安定的なテストのためにLIBLWGEOMにlwgeom_normalizeを追加。</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp111866440"></a>A.28. リリース 2.0.0</h2></div></div></div><p>リリース日: 2012/04/03</p><p>メジャーリリースです。ハードアップグレードが必要です。完全なダンプの再読み込みと、古い関数を使用している場合には特別な準備が必要です。アップグレードの詳細は<a class="xref" href="#hard_upgrade" title="2.10.2. ハードアップグレード">「ハードアップグレード」</a>をご覧ください。本版の詳細情報や変更/追加された関数については<a class="xref" href="#NewFunctions_2_0" title="14.12.8. PostGIS 2.0で新規作成/機能強化/変更された関数">「PostGIS 2.0で新規作成/機能強化/変更された関数」</a>をご覧ください。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111868616"></a>テスター - 影のヒーロー</h3></div></div></div><p>PostGISコミュニティ内の、このリリースの新しい機能をテストしてくれる勇敢なメンバー多数にお世話になっています。この方々なしにメジャーリリースは成功しえません。</p><p>勇敢で、非常に詳細かつ徹底したバグレポートを出し、詳細に分析をしてくれた方々を次に示します。</p><table border="0" summary="Simple list" class="simplelist"><tr><td>Andrea Periさん - トポロジの多数のテスト、正確性の確認</td></tr><tr><td>Andreas Forø Tollefsenさん - ラスタのテスト</td></tr><tr><td>Chris Englishさん - トポロジのローダ機能のストレステスト</td></tr><tr><td>Salvatore Larosaさん - トポロジのロバスト性のテスト</td></tr><tr><td>Brian Hamlinさん - ベンチマーク (コアに組み込む前の試験ブランチも)、Tigerとトポロジを含む多数の要素の全体的なテスト、多種の仮想サーバ上でのテスト。</td></tr><tr><td>Mike Peaseさん - Tigerジオコーダのテスト - 問題の非常に詳細な報告</td></tr><tr><td>Tom van Tilburgさん - ラスタのテスト</td></tr></table></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111885640"></a>重大/大幅な変更</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/722" target="_top">#722</a>, <a class="ulink" href="http://trac.osgeo.org/postgis/ticket/302" target="_top">#302</a>, 多数の非推奨関数の削除 (250関数以上) (Regina Obeさん, Paul Ramseyさん)</p><p>不定SRIDを-1から0に変更 (Paul Ramseyさん)</p><p>-- (1.2で非推奨になっている) buffer, length, intersectsといったSTの付いていない別名で残っている関数の削除と内部関数の名前変更。 </p><p>-- 非推奨関数を使っている場合には、アプリケーションを変更するか、変更しないで得た結果に耐えるかして下さい。文書が無い関数は、サポートから外れる関数か内部関数です。古いテーブルの制約は、非推奨関数を使っています。再格納した際にpopulate_geometry_columns()でテーブルの制約の再構築を行います。非推奨関数にイオｚンするアプリケーションやツールを持っている場合には、<a class="xref" href="#legacy_faq" title="3.2.">問： 3.2</a>をご覧ください。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/944" target="_top">#944</a> geometry_columnsは現在はテーブルでなくビューです (Paul Ramseyさん, Regina Obeさん)。テーブルだった時は古い方法で制約 (SRID, タイプ, 次元)を読み、型修飾子で生成されたジオメトリカラムについては生のカラム定義を読みます。</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1081" target="_top">#1081</a>, <a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1082" target="_top">#1082</a>, <a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1084" target="_top">#1084</a>, <a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1088" target="_top">#1088</a> - 管理関数が型修飾子ジオメトリカラムの生成関数に対応し、現在は型修飾子による生成がデフォルトです (Regina Obeさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1083" target="_top">#1083</a> probe_geometry_columns(), rename_geometry_table_constraints(), fix_geometry_columns()を削除 - geometry_columnビューでは廃止されています (Regina Obeさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/817" target="_top">#817</a> 古い3D関数をST_3Dに名前変更 (Nicklas Avénさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/548%E3%81%8C" target="_top">#548</a> (sorta), ST_NumGeometries,ST_GeometryNが単一ジオメトリに対してNULLでなく1 (またはジオメトリ)を返す (Sandro Santilliさん, Maxime van Noppenさん)</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111894728"></a>新機能</h3></div></div></div><p><a class="ulink" href="http://blog.opengeo.org/2011/09/28/indexed-nearest-neighbour-search-in-postgis/" target="_top">KNN GiSTインデクスに基づく重心 (&lt;-&gt;)とボックス (&lt;#&gt;)の距離演算子 (Paul Ramseyさん / 資金提供 Vizzuality)</a></p><p>TINと多面体サーフェスの対応と多数の3次元対応関数の強化 (Olivier Courtinさん / Oslandia)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/wiki/WKTRaster/PlanningAndFunding" target="_top">ラスター機能の統合と文書化</a>(Pierre Racineさん, Jorge Arévaloさん, Mateusz Loskotさん, Sandro Santilliさん, David Zwargさん, Regina Obeさん, Bborie Parkさん)  (企業の開発者と資金提供: University Laval, Deimos Space, CadCorp, Michigan Tech Research Institute, Azavea, Paragon Corporation, UC Davis Center for Vectorborne Diseases)</p><p>空間インデックスを3次元を意識したものに変更 - 作業中 (Paul Ramseyさん, Mark Cave-Aylandさん)</p><p>トポロジ機能の改善 (関数の追加)、文書化、テスト  (Sandro Santilliさん / Faunalia for RT-SIGTA), Andrea Periさん, Regina Obeさん, Jose Carlos Martinez Llari</p><p>3次元関係関数と3次元計測関数 (Nicklas Avénさん)</p><p>ST_3DDistance, ST_3DClosestPoint, ST_3DIntersects, ST_3DShortestLine等多数</p><p>N次元空間インデックス (Paul Ramseyさん / OpenGeo)</p><p>ST_Split (Sandro Santilliさん / Faunalia for RT-SIGTA)</p><p>ST_IsValidDetail (Sandro Santilliさん / Faunalia for RT-SIGTA)</p><p>ST_MakeValid (Sandro Santilliさん / Faunalia for RT-SIGTA)</p><p>ST_RemoveRepeatedPoints (Sandro Santilliさん / Faunalia for RT-SIGTA)</p><p>ST_GeometryNとST_NumGeometriesの非コレクションへの対応 (Sandro Santilliさん)</p><p>ST_IsCollection (Sandro Santilliさん, Maxime van Noppenさん)</p><p>ST_SharedPaths (Sandro Santilliさん / Faunalia for RT-SIGTA)</p><p>ST_Snap (Sandro Santilliさん)</p><p>ST_RelateMatch (Sandro Santilliさん / Faunalia for RT-SIGTA)</p><p>ST_ConcaveHull (Regina Obe and Leo Hsuさん / Paragon Corporation)</p><p>ST_UnaryUnion (Sandro Santilliさん / Faunalia for RT-SIGTA)</p><p>ST_AsX3D (Regina Obeさん / Arrival 3D funding)</p><p>ST_OffsetCurve (Sandro Santilliさん, Rafal Magdaさん)</p><p><a class="ulink" href="http://blog.opengeo.org/2011/11/21/st_geomfromgeojson/" target="_top">ST_GeomFromGeoJSON (Kashif Rasulさん, Paul Ramseyさん / Vizzuality funding)</a></p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111918280"></a>性能強化</h3></div></div></div><p>シェープファイルローダについて、無償配布の世界規模のシェープファイルの一部でみられる、切り詰められたマルチバイト値を許容するようにしました (Sandro Santilliさん)</p><p>shp2pgsqlの多数の誤り訂正と強化、ローダの回帰テストの増強、インポート時のジオメトリとジオグラフィの両方の投影変換 (Jeff Adamsさん / Azaveaさん, Mark Cave-Aylandさん)</p><p>pgsql2shpの事前に定義されたリストからの変換  (Loic Dacharyさん / Mark Cave-Aylandさん)</p><p>Shp-pgsql GUIローダ - 複数ファイルを一度にロードするできるようにしました (Mark Leslieさん)</p><p>Extras - Tigerジオコーダの、古いTigerの書式から新しいTigerのシェープとファイル構造の書式へのアップグレード (Stephen Frostさん)</p><p>Extras - Tigerジオコーダについて、TIGER 2010データ対応、逆ジオコーダ関数の追加、多数の誤り訂正、精度強化、最大結果数の制限、速度改善、ルーティンのロード の改訂(Regina Obeさん, Leo Hsuさん / Paragon Corporation / Hunter Systems Groupからの資金提供)</p><p>文書全体の校正と修正 (Kasif Rasulさん)</p><p>PostGIS JDBCクラスの整理、Mavenビルドの改訂 (Maria Arias de Reynaさん, Sandro Santilliさん)</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111922120"></a>誤り訂正</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1335" target="_top">#1335</a> ST_AddPointがLinuxでは不正な結果を返す (Even Rouaultさん)</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111923656"></a>リリースの特別クレジット</h3></div></div></div><p>PostGIS 2.0の公開にあたって経済支援を行ってくれた<a class="ulink" href="http://blog.opengeo.org/2012/02/01/it-goes-up-to-2-0/" target="_top">米国国務省人道情報ユニット (HIU)</a>および<a class="ulink" href="http://blog.cartodb.com/post/17318840209/postgis-core-committer-sandro-santilli-joins-cartodb" target="_top">Vizzuality</a>に感謝します。</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp111926216"></a>A.29. リリース 1.5.4</h2></div></div></div><p>リリース日: 2012/05/07</p><p>この版は誤り訂正版です。1.5.3版以降に送られた問題の処理が行われました。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111927624"></a>誤り訂正</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/547" target="_top">#547</a>, ST_Containsのメモリの問題 (Sandro Santilliさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/621" target="_top">#621</a>, ジオグラフィのインタセクトする部分の探索の問題 (Paul Ramseyさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/627" target="_top">#627</a>, 不正なジオメトリでPostGIS/PostgreSQLのプロセスが落ちる (Paul Ramseyさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/810" target="_top">#810</a>, 面積計算の精度向上 (Paul Ramseyさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/852" target="_top">#852</a>, 空間述語のロバスト性の改良 (Sandro Santilliさん, Nicklas Avénさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/877" target="_top">#877</a>, ST_Estimated_Extentが空のテーブルに対してNULLを返す (Sandro Santilliさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1028" target="_top">#1028</a>, ST_AsSVGが失敗するとPostgreSQLサーバプロセス全体を落とす (Paul Ramsey)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1056" target="_top">#1056</a>, 弧と円のバウンダリボックスを訂正 (Paul Ramseyさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1121" target="_top">#1121</a>, populate_geometry_columnsが非推奨関数を使っている (Regin Obeさん, Paul Ramseyさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1135" target="_top">#1135</a>, テストスィートの予見可能性を改善 (Andreas 'ads' Scherbaumさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1146" target="_top">#1146</a>, 画像生成機能の異常終了 (bronaughさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1170" target="_top">#1170</a>, 北極のインタセクションが失敗する (Paul Ramsey)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1179" target="_top">#1179</a>, 悪い値を与えるとST_AsTextが異常終了する (kjurka)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1184" target="_top">#1184</a>, honour DESTDIR in documentation Makefile (Bryce L Nordgren)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1227" target="_top">#1227</a>, 不正なGMLでサーバが異常終了する </p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1252" target="_top">#1252</a>, WKTでSRIDが出現する (Paul Ramseyさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1264" target="_top">#1264</a>, st_dwithin(g, g, 0)が動作しない (Paul Ramseyさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1344" target="_top">#1344</a>, 不正なジオメトリを持つテーブルのエクスポートを許す (Sandro Santilliさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1389" target="_top">#1389</a>, SRID 31300と31370のproj4textが間違っている (Paul Ramseyさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1406" target="_top">#1406</a>, shp2pgsqlでジオグラフィをロードすると異常終了する (Sandro Santilliさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1595" target="_top">#1595</a>, ST_Line_SubStringのSRIDが冗長になるのを訂正 (Sandro Santilliさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1596" target="_top">#1596</a>, UpdateGeometrySRID内のSRIDのチェック (Mike Toewsさん, Sandro Santilliさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1602" target="_top">#1602</a>, ST_PolygonizeをZ値を保持するよう訂正 (Sandro Santilliさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1697" target="_top">#1697</a>, GiSTインデックス内で空エントリがあると異常終了する問題を訂正 (Paul Ramseyさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1772" target="_top">#1772</a>, 崩壊した入力を与えた際のST_Line_Locate_Pointを訂正 (Sandro Santilliさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1799" target="_top">#1799</a>, ST_Segmentizeをmax_length=0から防ぐ (Sandro Santilliさん)</p><p>900913のパラメータの順序の変更　(Paul Ramseyさん)</p><p>"gmake"でのビルドに対応 (Greg Troxelさん)</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp111949512"></a>A.30. リリース 1.5.3</h2></div></div></div><p>リリース日: 2011/06/25</p><p>この版は誤り訂正版です。1.5.2版以降に送られた問題の処理が行われました。PostGIS 1.3以上を実行している場合には、ソフトアップグレードで十分です。そうでない場合には、ハードアップグレードが推奨されます。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111963208"></a>誤り訂正</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1056" target="_top">#1056</a>, アークジオメトリからの正しいバウンダリボックスの作成とインデックスの誤り訂正 (Paul Ramseyさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/1007" target="_top">#1007</a>, ST_IsValidが異常終了する問題を訂正、GEOS 3.3.0以上か3.2.3以上が必要 (Sandro Santilliさん、報告はBirgit Laggnerさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/940" target="_top">#940</a>, PostgreSQL 9.1 beta 1への対応 (Regina Obeさん、Paul Ramseyさん、パッチはstlさんが提出)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/845" target="_top">#845</a>, ST_Intersectsの精度の誤り (Sandro Santilliさん、Nicklas Avénさん) cdestigterさんの報告</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/884" target="_top">#884</a>, ST_Within, ST_Intersectsの結果が不安定 (Chris Hodgsonさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/779" target="_top">#779</a>, shp2pgsqlの-Sオプションがポイントでは失敗しているように見える (Jeff Adamsさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/666" target="_top">#666</a>, ST_DumpPointsがNULLセーフでない (Regina Obeさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/631" target="_top">#631</a>, NZの投影を更新してグリッド変換に対応 (jpalmerさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/630" target="_top">#630</a>, ST_Collect内の配列の奇妙なNULL対処 (Chris Hodgsonさん) David Bitnerさん報告</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/624" target="_top">#624</a>, ST_GeogFromTextのメモリリーク (ryangさん, Paul Ramseyさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/609" target="_top">#609</a>, マニュアル5.2節のJavaクライアントのソースが間違っている (simocさん、Regina Obeさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/604" target="_top">#604</a>, shp2pgsqlの利用法表示の添削 (Mike Toewsさん、Paul Ramseyさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/573" target="_top">#573</a> ラインストリングのグループでST_Unionが失敗する、PostGISでなくGEOS 3.3.0の誤り</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/457" target="_top">#457</a> ST_CollectionExtractが所望のタイプでないものを返す (Nicklas Avénさん、Paul Ramseyさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/441" target="_top">#441</a> ST_AsGeoJsonでジオメトリコレクションのバウンダリボックスがおかしい (Olivier Courtinさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/411" target="_top">#411</a> 不正なジオメトリのバックアップできない (Sando Santilliさん) Regione Toscanaさんの報告</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/409" target="_top">#409</a> ST_AsSVGが劣化している (Olivier Courtinさん) Sdikiyの報告</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/373" target="_top">#373</a> マニュアルのハードアップグレードで文法誤り (Paul Ramseyさん) psvenssoさんの報告</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp111978056"></a>A.31. リリース 1.5.2</h2></div></div></div><p>リリース日: 2010/09/27</p><p>この版は誤り訂正版です。1.5.1版以降に送られた問題の処理が行われました。PostGIS 1.3以上を実行している場合には、ソフトアップグレードで十分です。そうでない場合には、ハードアップグレードが推奨されます。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111979464"></a>誤り訂正</h3></div></div></div><p>ローダ: シェープファイルの空ジオメトリ (頂点が全くない)の扱いの訂正 (Sandro Santilliさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/536" target="_top">#536</a>, ジオグラフィを引数に取るST_Intersects, ST_Covers, ST_CoveredBy およびジオメトリを引数に取るST_Equalsが空間インデックスを使っていない (Regina Obeさん, Nicklas Avenさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/573" target="_top">#573</a>, ジオグラフィを引数に取るST_Containsの改良 (Paul Ramseyさん)</p><p>ローダ: Mac GTKビルドでコマンド-qで終了する機能を追加 (Paul Ramseyさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/393" target="_top">#393</a>, ローダ: 大きなDBFファイルのための一時的なパッチを追加 (Maxime Guillaudさん, Paul Ramseyさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/507" target="_top">#507</a>, GeoJSONとGML出力で間違っているOGC URNを訂正 (Olivier Courtinさん)</p><p>spatial_ref_sys.sql SRID 3021投影のための測地系変換を追加 (Paul Ramsey)</p><p>ジオグラフィ - 全てのジオグラフィが見積もり範囲外である場合に異常終了するのを訂正 (Paul Ramseyさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/469" target="_top">#469</a>, array_aggregationの誤りを訂正 (Greg Starkさん, Paul Ramseyさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/532" target="_top">#532</a>, 一時的なジオグラフィテーブルが他のユーザのセッションから見える (Paul Ramseyさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/562" target="_top">#562</a>, 大きなジオグラフィを引数に取った際のST_Dwithinでエラー (Paul Ramsey)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/513" target="_top">#513</a>, ローダGUIがDBFのみモードの時に空間インデックスを作ろうとする (Paul Ramseyさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/527" target="_top">#527</a>, ローダGUIは、常にログメッセージを末尾に追加するべき (Mark Cave-Aylandさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/504" target="_top">#504</a>, shp2pgsqlは、xmin/xmaxフィールドの名前を変えるべき (Sandro Santilliさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/458" target="_top">#458</a>, postgis_commentsが版フォルダでなくcontribにインストールされる (Mark Cave-Aylandさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/474" target="_top">#474</a>, ジオグラフィカラムを持つテーブルにanalyzeを実行するとサーバが落ちる (Paul Ramseyさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/581" target="_top">#581</a>, LWGEOMのexpand関数で矛盾した結果が生成される (Mark Cave-Aylandさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/513" target="_top">#513</a>, shp2pgsql-guiへのdbfフィルタの追加とdbfのみのロード機能の追加 (Paul Ramseyさん)</p><p>PostgreSQL 9.0に対するビルドのさらなる問題の訂正 (Mark Cave-Aylandさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/572" target="_top">#572</a>, シェープファイルのためのパスワードの空白 (Mark Cave-Aylandさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/603" target="_top">#603</a>, shp2pgsql: "-w"でマルチ系オブジェクトの不正なWKTを生成する (Mark Cave-Aylandさん)</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp111994696"></a>A.32. リリース 1.5.1</h2></div></div></div><p>リリース日: 2010/03/11</p><p>この版は誤り訂正版です。1.4.1版以降に送られた問題の処理が行われました。PostGIS 1.3以上を実行している場合には、ソフトアップグレードで十分です。そうでない場合には、ハードアップグレードが推奨されます。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp111996104"></a>誤り訂正</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/410" target="_top">#410</a>, ST_SetPoint, ST_AddPoint, ST_RemovePointをラインストリングに適用した際に、組み込みバウンダリボックスを更新するようにしました (Paul Ramseyさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/411" target="_top">#411</a>, 不正なジオメトリを持つテーブルのダンプを可能にしました (Sandro Santilliさん, for Regione Toscana-SIGTAさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/414" target="_top">#414</a>, アップグレードスクリプト実行時にgeography_columnsビューを含むようにしました (Paul Ramseyさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/419" target="_top">#419</a>, ST_Line_Substringがマルチラインストリング対応になりました (Paul Ramseyさん, Lidwala Consulting Engineersのみなさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/421" target="_top">#421</a>, ST_AsGML()の文字列長の計算の訂正 (Olivier Courtinさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/441" target="_top">#441</a>, 複数種類を持つコレクションからのGML生成を訂正 (Olivier Courtinさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/443" target="_top">#443</a>, GML3での座標値が逆になる (Olivier Courtinさん)</p><p><a class="ulink" href="http://trac.osgeo.org/postgis/ticket/450" target="_top">#450</a>, <a class="ulink" href="http://trac.osgeo.org/postgis/ticket/451" target="_top">#451</a>, 日付変更線をまたぐジオグラフィ型地物の面積計算が間違っている (Paul Ramseyさん)</p><p>間もなくリリースされる PostgreSQL 9.0への対応 (Paul Ramseyさん)</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp112004168"></a>A.33. リリース 1.5.0</h2></div></div></div><p>リリース日: 2010/02/04</p><p>このリリースでは、新しいGEOGRAPHY型を介した地理座標 (緯度/経度)への対応、能率強化、新しい入力書式対応 (GML, KML)、全体的な維持が行われました。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112005576"></a>API安定性</h3></div></div></div><p>PostGISのパブリックAPIはマイナーリリース (0.0.X)の間は変更しません</p><p>=~演算子をジオメトリ等価性チェックからバウンダリボックス等価性チェックに変更</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112007112"></a>互換性</h3></div></div></div><p>GEOS, Proj4およびLibXML2は必須となりました</p><p>次に示すライブラリのバージョンは、PostGIS 1.5で必要となる最低限です。</p><p>全てのプラットフォームでPostgreSQL 8.3以上</p><p>GEOS 3.1以上のみ (全ての機能の利点を得るにはGEOS 3.2以上)</p><p>新しいST_GeomFromGML/KML関数に関連してLibXML2 2.5以上</p><p>Proj4 4.5以上のみ</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112010184"></a>新機能</h3></div></div></div><p><a class="xref" href="#NewFunctions_1_5" title="14.12.10. PostGIS 1.5で新規作成/機能強化/変更された関数">「PostGIS 1.5で新規作成/機能強化/変更された関数」</a></p><p>ハウスドルフ距離計算の追加 (<a class="ulink" href="http://trac.osgeo.org/postgis/ticket/209" target="_top">#209</a>) (Vincent Picavetさん)</p><p>ST_Buffer処理で、一方のみのバッファリングと他のバッファリングスタイルに対応するためのパラメータの追加 (Sandro Santilliさん)</p><p>可視化と解析の関数に関連した、他の距離の追加 (Nicklas Avenさん)</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>ST_ClosestPoint</p></li><li class="listitem"><p>ST_DFullyWithin</p></li><li class="listitem"><p>ST_LongestLine</p></li><li class="listitem"><p>ST_MaxDistance</p></li><li class="listitem"><p>ST_ShortestLine</p></li></ul></div><p>ST_DumpPoints (Maxime van Noppenさん)</p><p>ST_GeomFromGMLとST_GeomFromKMLを介したGML, KMLの入力 (Olivier Courtinさん)</p><p>ST_CollectionExtractによる同種のコレクションの抽出 (Paul Ramseyさん)</p><p>ST_AddMeasureによる既存のラインストリングへのM値の追加 (Paul Ramseyさん)</p><p>utilsでのヒストリテーブルの実装 (George Silvaさん)</p><p>ジオグラフィ型と対応関数</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>球面アルゴリズム (Dave Skeaさん)</p></li><li class="listitem"><p>オブジェクト/インデックス実装 (Paurl Ramseyさん)</p></li><li class="listitem"><p>選択度の実装 (Mark Cave-Aylandさん)</p></li><li class="listitem"><p>KML, GMLおよびJSONへのシリアライズ (Olivier Courtin)</p></li><li class="listitem"><p>ST_Area, ST_Distance, ST_DWithin, ST_GeogFromText, ST_GeogFromWKB, ST_Intersects, ST_Covers, ST_Buffer (Paul Ramseyさん)</p></li></ul></div></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112021448"></a>性能強化</h3></div></div></div><p>ST_Distanceの能率改善 (Nicklas Avenさん)</p><p>文書の更新と改善 (Regina Obeさん、Kevin Neufeldさん)</p><p>テストと品質管理 (Regina Obe)</p><p>PostGIS 1.5のPostgreSQL 8.5 trunkへの対応( Guillaume Lelargeさん)</p><p>shp2pgsql-guiの中核のWin32対応と改善 (Mark Cave-Aylandさん)</p><p>適切な'make check'対応 (Paul Ramseyさん)</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112024520"></a>誤り訂正</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/query?status=closed&amp;milestone=PostGIS+1.5.0&amp;order=priority" target="_top">http://trac.osgeo.org/postgis/query?status=closed&amp;milestone=PostGIS+1.5.0&amp;order=priority</a></p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp112026056"></a>A.34. リリース 1.4.0</h2></div></div></div><p>リリース日: 2009/07/24</p><p>このリリースでは、能率改善、内部構造とテストの改善、新機能、文書の更新が行われました。PostGIS 1.1以上を実行している場合には、ソフトアップグレードで十分です。そうでない場合には、ハードアップグレードが推奨されます。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112027464"></a>API安定性</h3></div></div></div><p>1.4リリース以降は、PostGISの公開APIはマイナーリリースの間は変更しません。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112028616"></a>互換性</h3></div></div></div><p>PostGIS 1.4に必須の*最低*のバージョン</p><p>全てのプラットフォームのPostgreSQL 8.2以上</p><p>GEOS 3.0以上のみ</p><p>PROJ4 4.5以上のみ</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112030920"></a>新機能</h3></div></div></div><p>GEOS 3.1以上でコンパイルした場合には、ST_Union()で高速なカスケードユニオンを使うようにしました (Paul Ramseyさん)</p><p>ST_ContainsProperly()はGEOS 3.1以上が必要です</p><p>ST_Intersects(), ST_Contains(), ST_Within()について、GEOS 3.1以上で高速なキャッシュジオメトリを使うようにしました (Paul Ramseyさん / 資金提供 Zonar Systems)</p><p>文書とマニュアルの大幅改善 (Regina ObeさんとKevin Neufeldさん)</p><p>マニュアル内の図とダイアグラム (Kevin Neufeldさん)</p><p>正当性評価に失敗した場合の、人が読める説明を返すST_IsValidReason() (Paul Ramseyさん)</p><p>ジオメトリからgeohash.orgの符号を返すST_GeoHash() (Paul Ramseyさん)</p><p>シェープファイルをロードするためのGTK+マルチプラットフォームGUI (Paul Ramseyさん)</p><p>交差方向を返すST_LineCrossingDirection() (Paul Ramseyさん)</p><p>Z軸に基づく部分列を返すST_LocateBetweenElevations() (Paul Ramseyさん)</p><p>ジオメトリのパーサが文法エラーの位置に関する明示的なエラーメッセージを返すようにしました (Mark Cave-Aylandさん)</p><p>JSON書式のジオメトリを返すST_AsGeoJSON() (Olivier Courtinさん)</p><p>Populate_Geometry_Columns() -- テーブルとビューについて自動的にgeometry_columnsに追加するようにしました (Kevin Neufeldさん)</p><p>ST_MinimumBoundingCircle()  --包含する円ポリゴンをより小さくできるようにしました (Bruce Rindahlさん)</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112057544"></a>性能強化</h3></div></div></div><p>核のジオメトリシステムを独立したライブラリliglwgeomに移動 (Mark Cave-Aylandさん)</p><p>PostgreSQLのビルドブートストラップコマンドpgxsを使った新しいビルドシステム</p><p>デバッグフレームワークの形式化と単純化 (Mark Cave-Aylandさん)</p><p>クロスプラットフォーム対応を用意にするためにヘッダに全てのビルド時の#defineをコンフィギュア時に生成しヘッダに入れるようにしました</p><p>ログ作成フレームワークの形式化と単純化 (Mark Cave-Aylandさん)</p><p>CIRCULARSTRING, COMPOUNDCURVEとCURVEPOLYGONの対応の拡張と安定性向上、パースの改善、対応関数強化 (Mark LeslieさんとMark Cave-Aylandさん)</p><p>OpenSolarisビルドへの対応改善 (Paul Ramseyさん)</p><p>MSVCビルドの対応改善 (Mateusz Loskot)</p><p>KML対応の更新 (Olivier Courtin)</p><p>liblwgeom用ユニットテストフレームワーク (Paul Ramseyさん)</p><p>全てのPostGIS関数を包括的に試験できる新しい試験フレームワーク (Regine Obeさん)</p><p>全てのジオメトリ集約関数の能率改善 (Paul Ramseyさん)</p><p>まもなく登場するPostgreSQL 8.4の対応 (Mark Cave-Aylandさん, Talha Bin Rizwanさん)</p><p>shp2pgsqとpgsql2shpをliblwgeomのパース/アンパースの共通部分に依存させるために再作成しました。</p><p>PDF文書のビルドと予備的なビルドの説明にPDF DbLaTeXを使用するようにしました (Jean David Techerさん)</p><p>ユーザ文書 (PDFとHTML)とDoxygen開発者文書の自動ビルド (Kevin Neufeldさん)</p><p>ImageMagickによるWKTジオメトリテキストファイルから文書画像への自動ビルド (Kevin Neufeldさん)</p><p>HTML文書用CSSをより魅力的にしました (Dane Springmeyerさん)</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112069448"></a>誤り訂正</h3></div></div></div><p><a class="ulink" href="http://trac.osgeo.org/postgis/query?status=closed&amp;milestone=PostGIS+1.4.0&amp;order=priority" target="_top">http://trac.osgeo.org/postgis/query?status=closed&amp;milestone=PostGIS+1.4.0&amp;order=priority</a></p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp112070984"></a>A.35. リリース 1.3.6</h2></div></div></div><p>リリース日: 2009/05/04</p><p>PostGIS 1.1以上を実行している場合には、ソフトアップグレードで十分です。そうでない場合には、ハードアップグレードが推奨されます。このリリースでは、PostgreSQL 8.4への対応、シェープファイルへの出力時のprjファイル出力とが追加され、shp2pgsqlの異常終了に関する訂正と、曲線タイプの処理とdbfファイルだけのインポートでの論理エラーとに関する小さな誤り訂正、AddGeometryColumnsのエラー処理の改善がなされています。</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp112072520"></a>A.36. リリース 1.3.5</h2></div></div></div><p>リリース日: 2008/12/15</p><p>PostGIS 1.1以上を実行している場合には、ソフトアップグレードで十分です。そうでない場合には、ハードアップグレードが推奨されます。このリリースは誤り訂正リリースです。ST_ForceCollectionの実行失敗への対応と、MapServerでラインストリングのレイヤを使う場合に重大な影響を受ける関連関数への対応を行っています。</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp112074056"></a>A.37. リリース 1.3.4</h2></div></div></div><p>リリース日: 2008/11/24</p><p>このリリースでは、GeoJSON出力とPostgreSQL 8.4でのビルドへの対応、文書品質と出力の美しさの改善、関数レベルのSQL文書を追加し、空間述語の性能改善 (ポリゴン内のポイントのテスト)が行われました。</p><p>誤り訂正として、多数の関数で曲線ラインストリングの処理で異常終了する問題、メモリリーク、線形参照が頂点上での計測で失敗する問題等の排除が挙げられます。詳細についてはNEWSファイルをご覧下さい。</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp112075976"></a>A.38. リリース 1.3.3</h2></div></div></div><p>リリース日: 2008/04/12</p><p>このリリースでは、shp2gpsqlの誤り訂正、SVGとKMLへの対応の強化、ST_SimplifyPreserveTopology関数の追加、GEOSの版に注意を払ったビルド、厳格かつ稀な失敗ケースの訂正が行われました。</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp112077512"></a>A.39. リリース 1.3.2</h2></div></div></div><p>リリース日: 2007/12/01</p><p>このリリースでは、ST_EndPoint()とST_Envelope()の誤り訂正、JDBCビルドとOS/Xへの対応の改善、GML3出力を含むST_AsGML()でのGML出力の対応の改善が行われました。</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp112079048"></a>A.40. リリース 1.3.1</h2></div></div></div><p>リリース日: 2007/08/13</p><p>このリリースでは、以前のリリースでの見落としていた、版番号、文書、タグ等に関する問題の訂正が行われました。</p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp112080584"></a>A.41. リリース 1.3.0</h2></div></div></div><p>リリース日: 2007/08/09</p><p>このリリースでは、空間関係関数の性能改善、新しい空間関係関数の追加、関数名のSQL-MMへの変換 (空間型(Spatial Type)前置辞 (SP)を使います)が行われました。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112081992"></a>機能追加</h3></div></div></div><p>JDBC: Hibernate Dialectの追加 (Norman Barkerさんに感謝)</p><p>空間関係関数ST_CoversとST_CoveredByの追加。こららの関数の説明と根拠は<a class="ulink" href="http://lin-ear-th-inking.blogspot.com/2007/06/subtleties-of-ogc-covers-spatial.html" target="_top">http://lin-ear-th-inking.blogspot.com/2007/06/subtleties-of-ogc-covers-spatial.html</a>にあります。</p><p>空間関係関数ST_DWithinの追加。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112084552"></a>性能強化</h3></div></div></div><p>ST_Contains, ST_Intersects, ST_WithinとST_Disjoint用のキャッシュとインデックスを用いたポリゴン内ポイントの簡略版の追加。</p><p>空間関係関数のインラインインデックス対応の追加 (ST_Disjointを除く)</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112086088"></a>他の変更</h3></div></div></div><p>ジオメトリアクセサと処理関数における曲線ジオメトリ対応の拡張</p><p>空間型 (ST)前置辞を使用するSQL-MM命名規則への移動の開始。</p><p>PostgreSQL 8.3への最初の対応</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp112088136"></a>A.42. リリース 1.2.1</h2></div></div></div><p>リリース日: 2007/01/11</p><p>このリリースでは、PostgreSQL 8.2対応の誤り訂正と若干の性能改善が行われています。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112089672"></a>変更</h3></div></div></div><p>Within()のポリゴン内ポイントの短縮動作の訂正。</p><p>PostgreSQL 8.2のインデックスに対するNULL処理の訂正。</p><p>RPM specファイルの更新。</p><p>Transform()で処理を行わなくて良い場合の短縮版を追加。</p><p>JDBC: 多次元ジオメトリに対するJTS処理の訂正 (Thomas Martiさんのヒントと部分的なパッチに感謝)。さらに、Javadocがコンパイルされ同梱されるようになりました。GCJ使用時のCLASSPATH問題が訂正されました。pgjdbc 8.2互換性への対応の訂正、JDK 1.3以前の対応欠落の訂正が行われました。</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp112092488"></a>A.43. リリース 1.2.0</h2></div></div></div><p>リリース日: 2006/12/08</p><p>このリリースでは、SQL-MM定義の曲線ジオメトリのシリアライズ/デシリアライズ能力に沿ったタイプ定義と、性能改善が行われました。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112093896"></a>変更</h3></div></div></div><p>シリアライズ/デシリアライズの曲線ジオメトリタイプへの対応を追加</p><p>性能改善のためにContains()とWithin()にポリゴン内ポイントの短縮版を追加してました。</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp112095688"></a>A.44. リリース 1.1.6</h2></div></div></div><p>リリース日: 2006/11/02</p><p>これは誤り訂正のリリースです。特に64ビット機におけるGEOSインタフェースの重大なエラーを訂正しています。SRSパラメータの更新と投影変換の改善 (Z軸を取る)が行われました。アップグレードが<span class="emphasis"><em>必要です</em></span>。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112097480"></a>アップグレード</h3></div></div></div><p>1.0.3以上からアップグレードする場合には、<a class="link" href="#soft_upgrade" title="2.10.1. ソフトアップグレード">soft upgrade</a>の手続きを行います。</p><p><span class="emphasis"><em>1.0.0RC6から1.0.2まで</em></span>のリリースからアップグレードする場合には、リリース 1.0.3にある<a class="link" href="#rel_1.0.3_upgrading" title="A.54. リリース 1.0.3">アップグレード</a>をご覧ください。</p><p>1.0.0RC6より前のリリースからのアップグレードは、<a class="link" href="#hard_upgrade" title="2.10.2. ハードアップグレード">ハードアップグレード</a>が必要です。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112113608"></a>誤り訂正</h3></div></div></div><p>64ビット機で壊れていたCAPIの訂正</p><p>ローダ/ダンパ: 回帰テストと使用法出力の訂正</p><p>JDBCにおけるsetSRID()の誤り訂正。Thomas Martiさんに感謝。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112115528"></a>他の変更</h3></div></div></div><p>投影変換でのZ軸の使用</p><p>spatial_ref_sys.sqlをEPSG 6.11.1に更新</p><p>全体のためのバージョン変数を単一で使うためVersion.config基盤を単純化</p><p>ローダ/ダンパの使用法メッセージにVersion.configを含むようにしました</p><p>手作りで脆いJDBCのバージョンパーサをPropertiesに置き換え</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp112118344"></a>A.45. リリース 1.1.5</h2></div></div></div><p>リリース日: 2006/10/13</p><p>誤り訂正版です。Win32での重大なセグメンテーション違反を含みます。アップグレードは<span class="emphasis"><em>推奨されます</em></span>。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112120264"></a>アップグレード</h3></div></div></div><p>1.0.3以上からアップグレードする場合には、<a class="link" href="#soft_upgrade" title="2.10.1. ソフトアップグレード">soft upgrade</a>の手続きを行います。</p><p><span class="emphasis"><em>1.0.0RC6から1.0.2まで</em></span>のリリースからアップグレードする場合には、リリース 1.0.3にある<a class="link" href="#rel_1.0.3_upgrading" title="A.54. リリース 1.0.3">アップグレード</a>をご覧ください。</p><p>1.0.0RC6より前のリリースからのアップグレードは、<a class="link" href="#hard_upgrade" title="2.10.2. ハードアップグレード">ハードアップグレード</a>が必要です。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112124104"></a>誤り訂正</h3></div></div></div><p>PostgreSQL 8.2用でコンパイルした際に発生する、Win32上のpgsql2shpでセグメンテーション違反を引き起こすMingWのリンクの誤りの訂正</p><p>JavaのGeometry.equals()メソッドでNULLポインタ例外が発生する問題を訂正</p><p>GPL要求「変更の好まれる形式」の配布を満たすようEJB3Spatial.odtを追加</p><p>JDBC JTSコードから用いられていない同期を削除。</p><p>shp2pgsql/pgsql2shpのREADMEファイルが非常に古くなっていたのを、マニュアルページにマージして更新。</p><p>JDBCの版のタグが"1.1.4"なのに"1.1.3"になっていた問題を訂正。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112127176"></a>新機能</h3></div></div></div><p>非マルチ系ジオメトリのための-Sオプションをshp2pgsqlに追加</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp112128456"></a>A.46. リリース 1.1.4</h2></div></div></div><p>リリース日: 2006/09/27</p><p>Javaインタフェースでのいくつかの改善を含む誤り訂正版です。アップグレードは<span class="emphasis"><em>推奨されます</em></span>。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112130248"></a>アップグレード</h3></div></div></div><p>1.0.3以上からアップグレードする場合には、<a class="link" href="#soft_upgrade" title="2.10.1. ソフトアップグレード">soft upgrade</a>の手続きを行います。</p><p><span class="emphasis"><em>1.0.0RC6から1.0.2まで</em></span>のリリースからアップグレードする場合には、リリース 1.0.3にある<a class="link" href="#rel_1.0.3_upgrading" title="A.54. リリース 1.0.3">アップグレード</a>をご覧ください。</p><p>1.0.0RC6より前のリリースからのアップグレードは、<a class="link" href="#hard_upgrade" title="2.10.2. ハードアップグレード">ハードアップグレード</a>が必要です。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112154568"></a>誤り訂正</h3></div></div></div><p>PostgreSQL 8.2対応で訂正</p><p>collect()関数の入力のSRIDを捨てる問題を訂正</p><p>MakeBox2dとMakeBox3dでSRID合致確認を追加</p><p>GEOS 3.0.0が通るよう回帰テストの訂正</p><p>pgsql2shp同時実行の改善。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112157384"></a>Javaの変更</h3></div></div></div><p>SRID処理への新しいJTS開発者の姿勢を反映したJTS対応の再作業。コードの単純化とGNU Trove依存のビルドの削除。</p><p>"Geodetix s.r.l. Company"からの寄付によるEJB2対応の追加 </p><p>Norman Barker &lt;nbarker@ittvis.com&gt;さんの寄付によるEJB3チュートリアル/例の追加</p><p>Javaディレクトリ編成の若干の再編</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp112159816"></a>A.47. リリース 1.1.3</h2></div></div></div><p>リリース日: 2006/06/30</p><p>誤り訂正リリースです。新しい関数 (特にロングトランザクション対応)とポータビリティ強化を含みます。アップグレードは<span class="emphasis"><em>推奨されます</em></span>。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112161608"></a>アップグレード</h3></div></div></div><p>1.0.3以上からアップグレードする場合には、<a class="link" href="#soft_upgrade" title="2.10.1. ソフトアップグレード">soft upgrade</a>の手続きを行います。</p><p><span class="emphasis"><em>1.0.0RC6から1.0.2まで</em></span>のリリースからアップグレードする場合には、リリース 1.0.3にある<a class="link" href="#rel_1.0.3_upgrading" title="A.54. リリース 1.0.3">アップグレード</a>をご覧ください。</p><p>1.0.0RC6より前のリリースからのアップグレードは、<a class="link" href="#hard_upgrade" title="2.10.2. ハードアップグレード">ハードアップグレード</a>が必要です。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112165448"></a>誤り訂正/修正</h3></div></div></div><p>distance(ポリゴン, ポリゴン)で誤った結果となる誤り訂正</p><p>pgsql2shpの成功時の終了ステータスの誤り訂正。</p><p>shp2gpsqlにおけるマルチラインWKTの処理の誤り訂正</p><p>affine()でバウンディングボックス更新がある場合に失敗する誤り訂正</p><p>WKTパーサ: EMPTY要素を持つマルチ系ジオメトリの構築の禁止(GEOMETRYCOLLECTIONは対応)。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112172360"></a>新機能</h3></div></div></div><p>ロングトランザクション対応の新規追加。</p><p>DumpRings()関数の新規追加。</p><p>AsHEXEWKB(geom, XDR|NDR)関数の新規追加。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112174280"></a>JDBC変更</h3></div></div></div><p>回帰テストの改善: マルチポイントとXY以外の座標値</p><p>JDBCコードの小規模な訂正</p><p>全てのフィールドを今後非公開にする準備として適切なアクセサ関数の追加。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112176200"></a>他の変更</h3></div></div></div><p>ローダ/ダンパに対応する新しい回帰テスト。</p><p>コンフィギュアスイッチ--with-proj-libdirと--with-geos-libdirの追加</p><p>Tru64のビルドへの対応。</p><p>文書生成のためにJadeを使用。</p><p>pgsql2shpを求める以上のライブラリにリンクしないようにしました。</p><p>PostgreSQL 8.2への最初の対応。</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp112179400"></a>A.48. リリース 1.1.2</h2></div></div></div><p>リリース日: 2006/03/30</p><p>誤り訂正リリースで、新しい関数とポータビリティ強化を含みます。アップグレードは<span class="emphasis"><em>推奨されます</em></span>。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112181320"></a>アップグレード</h3></div></div></div><p>1.0.3以上からアップグレードする場合には、<a class="link" href="#soft_upgrade" title="2.10.1. ソフトアップグレード">soft upgrade</a>の手続きを行います。</p><p><span class="emphasis"><em>1.0.0RC6から1.0.2まで</em></span>のリリースからアップグレードする場合には、リリース 1.0.3にある<a class="link" href="#rel_1.0.3_upgrading" title="A.54. リリース 1.0.3">アップグレード</a>をご覧ください。</p><p>1.0.0RC6より前のリリースからのアップグレードは、<a class="link" href="#hard_upgrade" title="2.10.2. ハードアップグレード">ハードアップグレード</a>が必要です。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112185160"></a>誤り訂正</h3></div></div></div><p>SnapToGrid()内の出力バウンディングボックスの計算の誤り訂正</p><p>EnforceRHR()の誤り訂正</p><p>JDBC2のJTSコード内のSRID処理の訂正</p><p>64ビット対応の訂正</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112187464"></a>新機能</h3></div></div></div><p>回帰試験をPostGISのインストール*前に*実行できるようになりました</p><p>新しいafiine()行列変形関数</p><p>新しいrotate{,X,Y,Z}()関数</p><p>古い翻訳とaffine()を内部で使用している拡大縮小関数</p><p>pgsql 8.0.0以上に対するビルドで、estimated_extent()内にアクセス制御を埋め込みました</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112190152"></a>他の変更</h3></div></div></div><p>./configureスクリプトをよりポータブルにしました</p><p>./run_testスクリプトを、デフォルトの振る舞いがより健全になるよう変更しました。</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp112191816"></a>A.49. リリース 1.1.1</h2></div></div></div><p>リリース日: 2006/01/23</p><p>重要な誤り訂正リリースです。アップグレードを<span class="emphasis"><em>強くお勧めします</em></span>。前の版では、postgis_restore.plに<a class="link" href="#hard_upgrade" title="2.10.2. ハードアップグレード">ハードアップグレード</a>を阻害する誤りがあります。また、GEOS 2.2以上のコネクタで、ジオメトリコレクションのオブジェクトがトポロジ演算子で使われるのを阻害される誤りがあります。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112194120"></a>アップグレード</h3></div></div></div><p>1.0.3以上からアップグレードする場合には、<a class="link" href="#soft_upgrade" title="2.10.1. ソフトアップグレード">soft upgrade</a>の手続きを行います。</p><p><span class="emphasis"><em>1.0.0RC6から1.0.2まで</em></span>のリリースからアップグレードする場合には、リリース 1.0.3にある<a class="link" href="#rel_1.0.3_upgrading" title="A.54. リリース 1.0.3">アップグレード</a>をご覧ください。</p><p>1.0.0RC6より前のリリースからのアップグレードは、<a class="link" href="#hard_upgrade" title="2.10.2. ハードアップグレード">ハードアップグレード</a>が必要です。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112197960"></a>誤り訂正</h3></div></div></div><p>postgis_restore.plで早すぎるexitがある誤り訂正</p><p>GEOS-CAPIコネクタのジオメトリコレクションの処理に関する誤り訂正</p><p>Solaris 2.7とMingWへの対応を改善</p><p>line_locate_point()の誤り訂正</p><p>PostgreSQLのパスの処理を訂正</p><p>line_substring()の誤り訂正</p><p>回帰テストで局所化されたクラスタへの対応を追加</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112201544"></a>新機能</h3></div></div></div><p>line_substring()でZ値とM値の補間を新規追加</p><p>line_interpolate_point()でZ値とM値の補間を新規追加</p><p>OpenGISのあいまいさのためNumInteriorRing()の別名を追加</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp112203720"></a>A.50. リリース 1.1.0</h2></div></div></div><p>リリース日: 2005/12/21</p><p>多数の改善と新規追加が行われたマイナーリリースです。最も注意して頂きたいのは、ビルド手続きが非常に単純化したこと、transform()の速度が大幅に改善したこと、GEOSとの接続の安定化 (CAPI対応)、多数の新規関数、トポロジ対応の草案、です。</p><p>PostGISをインストールする前にGEOS-2.2.xにアップグレードすることを<span class="emphasis"><em>強くお勧めします</em></span>。これによって、将来のGEOSのアップグレードでPostGISライブラリの再構築が必要になることが無くなることが保証されます。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112205896"></a>貢献者</h3></div></div></div><p>このリリースには、Mark Cave Aylandさんからのproj4オブジェクトのキャッシュ機能のコードが含まれています。Markus Schaberさんは、JDBC2コードの多数の改善点を追加しました。Alex Bodnaruさんは、PostgreSQLソース依存の除去を助け、Debianのspecファイルを提供しました。Michael Fuhrさんは、Solarisアーキテクチャの新しい点をテストしました。David TecherさんとGerald Fenoyさんは、GEOS C言語APIコネクタの試験を助けました。Hartmut Tschaunerは、azimuth()関数のコードを提供しました。Devrim GUNDUZさんは、RPMのspecファイルを提供しました。Carl Andersonさんは、新しい面構築関数の作成を助けました。より多くの貢献者情報については<a class="link" href="#credits_other_contributors" title="1.4. 他の貢献者">他の貢献者</a>をご覧下さい。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112207560"></a>アップグレード</h3></div></div></div><p>1.0.3以降から更新する場合には、ダンプ/リロードは<span class="emphasis"><em>不要です</em></span>。全ての存在するデータベースで、新しいlwpostgis_upgrade.sqlスクリプトが単純に取り込まれます。詳細情報については<a class="link" href="#soft_upgrade" title="2.10.1. ソフトアップグレード">ソフトアップグレード</a>の章をご覧下さい。</p><p><span class="emphasis"><em>1.0.0RC6から1.0.2まで</em></span>のリリースからアップグレードする場合には、リリース 1.0.3にある<a class="link" href="#rel_1.0.3_upgrading" title="A.54. リリース 1.0.3">アップグレード</a>をご覧ください。</p><p>1.0.0RC6より前のリリースからのアップグレードは、<a class="link" href="#hard_upgrade" title="2.10.2. ハードアップグレード">ハードアップグレード</a>が必要です。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112211656"></a>新しい関数</h3></div></div></div><p>translate()が使用する関数scale()とtransscale()</p><p>line_substring()</p><p>line_locate_point()</p><p>M(point)</p><p>LineMerge(geometry)</p><p>shift_longitude(geometry)</p><p>azimuth(geometry)</p><p>locate_along_measure(geometry, float8)</p><p>locate_between_measures(geometry, float8, float8)</p><p>ポイントによるオフセットを行うSnapToGrid (4次元まで対応)</p><p>BuildArea(any_geometry)</p><p>OGC BdPolyFromText(linestring_wkt, srid)</p><p>OGC BdMPolyFromText(linestring_wkt, srid)</p><p>RemovePoint(linestring, offset)</p><p>ReplacePoint(linestring, offset, point)</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112218184"></a>誤り訂正</h3></div></div></div><p>polygonize()のメモリリークの誤り訂正</p><p>キャスト関数lwgeom_as_anytypeの誤り訂正</p><p>psotgis_version()の出力のUSE_GEOS, USE_PROJ , USE_STATS要素を常にライブラリの状態に合わせるよう誤り訂正</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112220104"></a>関数の内容の変更</h3></div></div></div><p>SnapToGridにおける高次元値を破棄しなくなりました</p><p>Z()関数を、Z値を持たない場合にNULLを返すよう変更</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112221640"></a>速度改善</h3></div></div></div><p>transform()関数の大幅な高速化、proj4オブジェクトのキャッシュ機能</p><p>AddGeometryColumns()とupdate_geometry_stats()からのfix_geometry_columns()の自動呼出しの削除</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112223176"></a>JDBC2での作業</h3></div></div></div><p>Mkaefileの改善</p><p>JTS対応の改善</p><p>回帰テストシステムの改善</p><p>ジオメトリコレクションの基本的な整合性検査メソッド</p><p>(HEX)(E)wkbへの対応</p><p>HexWKB / EWKT の切り替えのための自動検出機能DriverWrapper</p><p>古いJDKリリースのValueSetterで発生するコンパイルの誤り訂正。</p><p>EWKTコンストラクタを"SRID=4711;"といった表現を受け取れるよう誤り訂正</p><p>予備的な読み込み専用のJava2Dのジオメトリへの対応</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112227400"></a>他の新しいこと</h3></div></div></div><p>PostgreSQLソース依存を除去した完全なautoconfを用いたコンフィギュレーション</p><p>GEOS C-API対応 (2.2.0以上)</p><p>トポロジモデリングの最初の対応</p><p>DebianとRPMのspecファイル</p><p>lwpostgis_upgrade.sqlスクリプトの追加</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112230088"></a>他の変更</h3></div></div></div><p>JTS対応の改善</p><p>DBFとSQLの間における整数と文字列の属性の対応付けの厳格化</p><p>回帰テスト群の範囲拡大と見やすさ改善</p><p>古いjdbcコードはこの版で削除</p><p>postgis_proc_upgrade.plの直接の使用を廃止</p><p>スクリプトの版とリリースの版とを合わせました</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp112233288"></a>A.51. リリース 1.0.6</h2></div></div></div><p>リリース日: 2005/12/06</p><p>若干の誤り訂正と改善があります</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112234696"></a>アップグレード</h3></div></div></div><p>1.0.3以降から更新する場合には、ダンプ/リロードは<span class="emphasis"><em>不要です</em></span></p><p><span class="emphasis"><em>1.0.0RC6から1.0.2まで</em></span>のリリースからアップグレードする場合には、リリース 1.0.3にある<a class="link" href="#rel_1.0.3_upgrading" title="A.54. リリース 1.0.3">アップグレード</a>をご覧ください。</p><p>1.0.0RC6より前のリリースからのアップグレードは、<a class="link" href="#hard_upgrade" title="2.10.2. ハードアップグレード">ハードアップグレード</a>が必要です。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112242248"></a>誤り訂正</h3></div></div></div><p>コレクションのデシリアライザでpalloc(0)を呼ぶ誤り訂正 (--enable-cassertがある場合のみ)</p><p>バウンディングボックスキャッシュ処理の誤り訂正</p><p>geom_accum(NULL, NULL)のセグメンテーション違反の誤り訂正</p><p>addPoint()のセグメンテーション違反の誤り訂正</p><p>lwcollection_clone()の短時間メモリ確保の訂正</p><p>segmentize()の誤り訂正</p><p>SnapToGrid出力の固定バウンディングボックスの計算</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112246088"></a>改善</h3></div></div></div><p>PostgreSQL 8.2への最初の対応</p><p>GEOSオプションでSRID整合性検査が無かったのを追加</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp112247752"></a>A.52. リリース 1.0.5</h2></div></div></div><p>リリース日: 2005/11/25</p><p>ライブラリにおけるメモリのアラインメントの訂正、ローダのUTF8属性値の処理におけるセグメンテーション違反の訂正、若干の改善と整理を行っています。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>shp2pgsqlのコードを以前の版からUNIX標準に適合する (成功時に0を返す)ように変更</p></td></tr></table></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112249928"></a>アップグレード</h3></div></div></div><p>1.0.3以降から更新する場合には、ダンプ/リロードは<span class="emphasis"><em>不要です</em></span></p><p><span class="emphasis"><em>1.0.0RC6から1.0.2まで</em></span>のリリースからアップグレードする場合には、リリース 1.0.3にある<a class="link" href="#rel_1.0.3_upgrading" title="A.54. リリース 1.0.3">アップグレード</a>をご覧ください。</p><p>1.0.0RC6より前のリリースからのアップグレードは、<a class="link" href="#hard_upgrade" title="2.10.2. ハードアップグレード">ハードアップグレード</a>が必要です。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112253384"></a>ライブラリの変更</h3></div></div></div><p>メモリのアラインメントの訂正</p><p>アナライザにおける少量のNULL値の計算の訂正</p><p>低水準関数getPoint4d_p()の小さな誤り訂正。</p><p>シリアライズ関数の速度向上</p><p>force_3dm(), force_3dz() およびorce_4d()における誤り訂正</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112256072"></a>ローダの変更</h3></div></div></div><p>shp2pgsqlの終了ステータスに関する誤り訂正</p><p>ローダの後方互換に関する誤りを訂正 (NULLシェープファイルのロード)</p><p>DBFの数値の属性値について最後にドットが付く場合の処理の誤りを訂正</p><p>shp2pgsql (utf8エンコーディング)でのセグメンテーション違反が出る誤りを訂正</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112258504"></a>他の変更</h3></div></div></div><p>スキーマ対応のpostgis_proc_upgrade.pl、PostgreSQL 7.2以上に対応</p><p>マニュアルに「問題を報告する 」の章を追加</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp112260168"></a>A.53. リリース 1.0.4</h2></div></div></div><p>リリース日: 2005/09/09</p><p>重大な誤り訂正と若干の改善があります。特に、大きな地理空間テーブルでのGiSTインデックスの構築で起こるメモリリークを訂正しています。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112261576"></a>アップグレード</h3></div></div></div><p>1.0.3から更新する場合には、ダンプ/リロードは<span class="emphasis"><em>不要です</em></span></p><p><span class="emphasis"><em>1.0.0RC6から1.0.2まで</em></span>のリリースからアップグレードする場合には、リリース 1.0.3にある<a class="link" href="#rel_1.0.3_upgrading" title="A.54. リリース 1.0.3">アップグレード</a>をご覧ください。</p><p>1.0.0RC6より前のリリースからのアップグレードは、<a class="link" href="#hard_upgrade" title="2.10.2. ハードアップグレード">ハードアップグレード</a>が必要です。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112265160"></a>誤り訂正</h3></div></div></div><p>GiSTインデックスのメモリリーク</p><p>proj4のtransform()処理でのセグメンテーション違反の誤り訂正</p><p>spatial_ref_sysのproj4の誤り訂正 (+projが無かった)</p><p>ローダ: 文字列関数の使用の訂正、NULLオブジェクトチェックの改定、MULTILINESTRING入力でのセグメンテーション違反になる誤りの訂正。</p><p>MakeLineの次元処理に関する誤り訂正</p><p>translate()で出力バウンディングボックスが壊れることに関する誤り訂正</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112268360"></a>改善</h3></div></div></div><p>文書の改善</p><p>選択度推測器の堅牢性向上</p><p>distance()の少しの速度向上</p><p>小規模な整理</p><p>GiSTインデックスの整理</p><p>BOX3Dパーサでより緩い構文を受け付けるようにしました</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="rel_1.0.3_upgrading"></a>A.54. リリース 1.0.3</h2></div></div></div><p>リリース日: 2005/08/08</p><p>いくつかの誤り訂正 - <span class="emphasis"><em>格納されているジオメトリの正しさに厳しい影響を与えるものを含みます</em></span> - および若干の改善。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112277576"></a>アップグレード</h3></div></div></div><p>バウンディングボックスの計算ルーティンの誤りのため、データベースにキャッシュされているバウンディングボックスが正しくない可能性があり、アップグレード手続きでは特別な注意が必要となりました。</p><p><a class="link" href="#hard_upgrade" title="2.10.2. ハードアップグレード">ハードアップグレード</a>手続き (ダンプ/リロード)によって、全てのバウンディングボックス (ダンプ内にない)の再計算が強制的に行われます。これは、1.0.0RC6より前のリリースからのアップグレードには<span class="emphasis"><em>必要です</em></span>。</p><p>1.0.0RC6以上からアップグレードする場合には、このリリースには、ジオメトリのバウンディングボックスの再計算と、その結果として発生する変更を伝播させる全ての処理を強制するPerlスクリプト(utils/rebuild_bbox_caches.pl)を持っています。インストール後にこのスクリプトを実行します (引数無しで走らせるとヘルプが出ます)。もしくは、utils/postgis_proc_upgrade.pを実行して、PostGISのプロシージャと関数を更新します (<a class="link" href="#soft_upgrade" title="2.10.1. ソフトアップグレード">ソフトアップグレード</a>を参照して下さい)。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112280776"></a>誤り訂正</h3></div></div></div><p>lwgeomの2次元バンディングボックス計算の厳しい誤り訂正</p><p>ローダのWKT (-w)ポイント処理の誤り訂正</p><p>64ビット機のダンパの誤り訂正</p><p>ユーザ定義クエリの処理を行うダンパの誤り訂正</p><p>create_undef.plスクリプトの誤り訂正</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112283464"></a>改善</h3></div></div></div><p>カノニカル入力関数の少しの能率改善</p><p>ローダの小規模な整理</p><p>ローダの多バイト文字によるフィールド名への対応</p><p>postgis_restore.plスクリプトの改善</p><p>ユーティリティスクリプトrebuild_bbox_caches.plの再構築</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp112286280"></a>A.55. リリース 1.0.2</h2></div></div></div><p>リリース日: 2005/07/04</p><p>若干の誤り訂正と改善があります</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112287688"></a>アップグレード</h3></div></div></div><p>1.0.0RC6から更新する場合には、ダンプ/リロードは<span class="emphasis"><em>不要です</em></span></p><p>前のリリースからアップグレードするにはダンプ/リロードが必要です。詳細については<a class="link" href="#upgrading" title="2.10. アップグレード">アップグレード</a>をご覧下さい。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112290120"></a>誤り訂正</h3></div></div></div><p>B木オプションの誤り許容</p><p>pg_errorでのメモリリーク</p><p>R木インデックスの訂正</p><p>ビルドスクリプトの整理 (CFLAGSとCXXFLAGSの混在の回避)</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112292424"></a>改善</h3></div></div></div><p>ローダにおける新しいインデックス生成機能 (-lスイッチ)</p><p>PostgreSQL 8.1devへの最初の対応</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp112294088"></a>A.56. リリース 1.0.1</h2></div></div></div><p>リリース日: 2005/05/24</p><p>若干の誤り訂正といくつかの改善があります。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112295496"></a>アップグレード</h3></div></div></div><p>1.0.0RC6から更新する場合には、ダンプ/リロードは<span class="emphasis"><em>不要です</em></span></p><p>前のリリースからアップグレードするにはダンプ/リロードが必要です。詳細については<a class="link" href="#upgrading" title="2.10. アップグレード">アップグレード</a>をご覧下さい。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112297928"></a>ライブラリの変更</h3></div></div></div><p>length_spheroid()の3次元計算の誤り訂正</p><p>JOIN選択推定器の誤り訂正</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112299464"></a>他の変更追加</h3></div></div></div><p>shp2pgsqlのエスケープ関数の誤り訂正</p><p>複数スキーマで同時発生するPostGISに対するより良い対応</p><p>文書の訂正</p><p>jdbc2: コンパイル時に"-target 1.2 -source 1.2"をデフォルトとするよう変更</p><p>pgsql2shpの-kスイッチの追加</p><p>postgis_restore.plの独自のcreatedへの対応</p><p>pgsql2shp属性名の一意性強制の誤り訂正</p><p>NTF (Paris)の投影定義の誤り訂正</p><p>postgis_restore.plの整理</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp112303816"></a>A.57. リリース 1.0.0</h2></div></div></div><p>リリース日: 2005/04/19</p><p>最後の1.0.0リリースです。若干の誤り訂正、ローダのいくつかの改良 (古いPostGISへの対応が特筆すべき点)、文書の追加がありました。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112305224"></a>アップグレード</h3></div></div></div><p>1.0.0RC6から更新する場合には、ダンプ/リロードは<span class="emphasis"><em>不要です</em></span></p><p>前のリリースからアップグレードするにはダンプ/リロードが必要です。詳細については<a class="link" href="#upgrading" title="2.10. アップグレード">アップグレード</a>をご覧下さい。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112307656"></a>ライブラリの変更</h3></div></div></div><p>transform()が不規則なメモリアドレスを解放する問題を訂正</p><p>force_3dm()のメモリ確保が必要より小さい問題を訂正</p><p>JOIN選択度見積もりの誤り (デフォルト値、メモリリーク、行カウント、SD)訂正</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112309576"></a>他の変更追加</h3></div></div></div><p>shp2pgsqlがタブまたはシングルクォートで始まる値を読み飛ばす誤りを訂正</p><p>マニュアルへのローダ/ダンパの追加</p><p>古い (HWGEOM)PostGISに対応するshp2gsql</p><p>shp2pgsqlのフラグに -p (prepare)を追加</p><p>マニュアルにOGC互換の強制に関する新章追加</p><p>JTSライブラリに対応する新しいautoconf</p><p>推測器のテストの誤り訂正 (LWGEOMとスキーマの構文解析への対応)</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp112313160"></a>A.58. リリース 1.0.0RC6</h2></div></div></div><p>リリース日: 2005/03/30</p><p>1.0.0の6番目のリリース候補、若干の誤り訂正と整理を行っています。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112314568"></a>アップグレード</h3></div></div></div><p>前のリリースからアップグレードするにはダンプ/リロードが必要です。詳細については<a class="link" href="#upgrading" title="2.10. アップグレード">アップグレード</a>をご覧下さい。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112316360"></a>ライブラリの変更</h3></div></div></div><p>multi()の誤り訂正</p><p>noop時にmulti()からの早い復帰</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112317896"></a>スクリプトの変更</h3></div></div></div><p>{x,y}{min,max}(box2d)関数の削除</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112319048"></a>他の変更</h3></div></div></div><p>postgis_restore.plスクリプトの誤り訂正</p><p>64ビット対応のダンパの誤り訂正</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp112320712"></a>A.59. リリース 1.0.0RC5</h2></div></div></div><p>リリース日: 2005/03/25</p><p>1.0.0の5番目のリリース候補、若干の誤り訂正と改善があります</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112322120"></a>アップグレード</h3></div></div></div><p>1.0.0RC4から更新する場合には、ダンプ/リロードは<span class="emphasis"><em>不要です</em></span></p><p>前のリリースからアップグレードするにはダンプ/リロードが必要です。詳細については<a class="link" href="#upgrading" title="2.10. アップグレード">アップグレード</a>をご覧下さい。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112324552"></a>ライブラリの変更</h3></div></div></div><p>box3d計算の問題 (セグメンテーションフォールト)の訂正 (ほかにもあります)</p><p>estimated_extent()でのセグメンテーションフォールトの訂正</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112326088"></a>他の変更</h3></div></div></div><p>ビルドスクリプトとユーティリティの若干の改良</p><p>性能向上に関する技法の文章の追加</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp112327752"></a>A.60. リリース 1.0.0RC4</h2></div></div></div><p>リリース日: 2005/03/18</p><p>1.0.0の4番目のリリース候補、誤り訂正と若干の改善があります</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112329160"></a>アップグレード</h3></div></div></div><p>前のリリースからアップグレードするにはダンプ/リロードが必要です。詳細については<a class="link" href="#upgrading" title="2.10. アップグレード">アップグレード</a>をご覧下さい。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112330952"></a>ライブラリの変更</h3></div></div></div><p>geom_accum()のセグメンテーションフォールトの誤り訂正</p><p>64ビットアーキテクチャ対応の誤り訂正</p><p>コレクションを引数に取るbox3d計算関数の誤りの訂正</p><p>副問い合わせの選択度推定への対応</p><p>force_collectionからの早い復帰</p><p>SnapToGrid()の一貫性検査の訂正</p><p>Box2d出力精度を15桁に後退</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112334408"></a>スクリプトの変更</h3></div></div></div><p>distance_sphere()の追加</p><p>get_proj4_from_sridの実装をSQLからPL/pgSQLに変更</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112336072"></a>他の変更</h3></div></div></div><p>ローダとダンパのMULTOLINEシェープの処理の問題を訂正</p><p>ローダでポリゴンの最初の穴を読み飛ばす誤りを訂正。</p><p>jdbc2: コードの整理、Makefileの改善</p><p>FLEX変数とYACC変数がpgsqlのMakefile.globalが取り込まれた*後*で、pgsqlの*空白を除いた*ものが空文字列と評価された場合に限って設定される</p><p>既に作成されていたパーサの追加</p><p>ビルドスクリプトの改良</p><p>Version.configの改善を中心とした版処理の改善</p><p>postgis_restore.plの改善</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp112340168"></a>A.61. リリース 1.0.0RC3</h2></div></div></div><p>リリース日: 2005/02/24</p><p>1.0.0の3番目のリリース候補、多数の誤り訂正と改善があります。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112341576"></a>アップグレード</h3></div></div></div><p>前のリリースからアップグレードするにはダンプ/リロードが必要です。詳細については<a class="link" href="#upgrading" title="2.10. アップグレード">アップグレード</a>をご覧下さい。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112343368"></a>ライブラリの変更</h3></div></div></div><p>transform()でSRIDが消える問題を訂正、エラー処理を改善。</p><p>メモリアラインメントのハンドリングに関する誤り訂正</p><p>force_collection()で単純な (単一)ジオメトリ型でMapServerの接続が切れる問題を訂正。</p><p>GeometryFromText()でbboxキャッシュを追加しない誤り訂正。</p><p>box2d出力の精度低下。</p><p>pgsqlで異常終了する問題を避けるため、DEBUGマクロにPGIS_の前置辞を付加</p><p>GEOS2POSTGISコンバータのリークを訂正</p><p>pallocで確保したクエリコンテキストのメモリを早く開放することによるメモリ使用の削減</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112347208"></a>スクリプトの変更</h3></div></div></div><p>PostgreSQL 7.2のインデックスのバインディングを訂正しました。</p><p>PG72での動作と、1テーブルに複数カラムの場合への対応のため、probe_geometry_columns()の誤り訂正</p><p>boolからtextへのキャストの更新</p><p>動作効率改善のため、いくつかの関数をSTABLEからIMMUTABLEに変更</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112349512"></a>JDBC変更</h3></div></div></div><p>jdbc2: 小さなパッチ、box2d/box3dの試験、文書とライセンスの改定</p><p>jdbc2: pgjdbc 8.0の型の自動登録の誤り訂正とテストケース作成</p><p>jdbc2: 古いjdkリリースでの構築を有効にするためためにjdk1.4使用箇所の削除</p><p>jdbc2: pg72jdbc2.jarに対するビルドへの対応の追加</p><p>jdbc2: Makefileの更新と無駄の除去</p><p>jdbc2: JTSジオメトリクラス対応のベータ版を追加</p><p>jdbc2: 古いPostGISサーバに対して失敗するのが判明しているテストをスキップするようにしました。</p><p>jdbc2: EWKTのM値を持つジオメトリの処理の訂正</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112353608"></a>他の変更</h3></div></div></div><p>性能向上に関する技法の新章追加</p><p>ドキュメント更新: pgsql72に必要なもの、lwpostgis.sql</p><p>autoconfの若干の変更</p><p>BUILDDATE抽出の移植可能範囲を広げました</p><p>spatial_ref_sys.sqlを訂正してvacuumが全体のデータベースに及ぶのを避けるようにしました。</p><p>spatial_ref_sys: NTF (Paris)を0.xで配布していたものに合うよう変更。</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp112356808"></a>A.62. リリース 1.0.0RC2</h2></div></div></div><p>リリース日: 2005/01/26</p><p>1.0.0の第2リリース候補版。誤り訂正と若干の改善。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112358216"></a>アップグレード</h3></div></div></div><p>前のリリースからアップグレードするにはダンプ/リロードが必要です。詳細については<a class="link" href="#upgrading" title="2.10. アップグレード">アップグレード</a>をご覧下さい。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112380488"></a>ライブラリの変更</h3></div></div></div><p>ポイント配列からのbox3d計算に関する誤り訂正</p><p>distance_spheroid定義に関する誤り訂正</p><p>bboxキャッシュ更新がtransform()無かったことに関する誤り訂正</p><p>新しいJDBCドライバ (jdbc2)</p><p>後方互換のためのGEOMETRYCOLLECTION(EMPTY)書式への対応</p><p>バイナリ出力の高速化</p><p>OGC WKB/WKTコンストラクタの厳格化</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112383944"></a>スクリプトの変更</h3></div></div></div><p>lwpostgis.sql内でのSTABLE, IMMUTABLE, STRICTの訂正</p><p>OGC WKB/WKTコンストラクタの厳格化</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112389704"></a>他の変更</h3></div></div></div><p>ローダ (i18n、非i18nの両方)の高速化と堅牢化</p><p>最初のautoconfスクリプト</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp112391368"></a>A.63. リリース 1.0.0RC1</h2></div></div></div><p>リリース日: 2005/01/13</p><p>最初のPostGISメジャーリリース候補版。格納領域の低減とインデックス使用クエリの高速化のためのPostGIS型の内部格納の再設計。</p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112392776"></a>アップグレード</h3></div></div></div><p>前のリリースからアップグレードするにはダンプ/リロードが必要です。詳細については<a class="link" href="#upgrading" title="2.10. アップグレード">アップグレード</a>をご覧下さい。</p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a name="idp112394568"></a>変更</h3></div></div></div><p>標準形式入力パースの高速化。</p><p>標準形式出力の可逆化。</p><p>PostgreSQL 7.3以上でのEWKBの標準形式バイナリ入出力対応。</p><p>4次元座標以上の対応、可逆shapefile-&gt;postgis-&gt;shapefile変換。</p><p>新関数: UpdateGeometrySRID(), AsGML(), SnapToGrid(), ForceRHR(), estimated_extent(), accum().</p><p>垂直方向位置インデックス演算子。</p><p>JOIN選択関数。</p><p>ジオメトリコンストラクタとエディタの強化。</p><p>PostGISエクステンションAPI。</p><p>ローダのUTF-8対応。</p></div></div></div></div></body></html>
